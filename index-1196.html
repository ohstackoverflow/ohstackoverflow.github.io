<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1196) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1196.html">
<link rel="prev" href="index-1197.html" type="text/html">
<link rel="next" href="index-1195.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/php-xiang-dang-yu-net-java-de-tostring/" class="u-url">PHP 相当于 .NET/Java 的 toString()</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/php-xiang-dang-yu-net-java-de-tostring/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T03:47:12+08:00" itemprop="datePublished" title="2023-02-18 03:47">2023-02-18 03:47</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>如何将 PHP 变量的值转换为字符串？</p>
<p>我一直在寻找比连接空字符串更好的东西：</p>
<div class="code"><pre class="code literal-block">$myText = $myVar . '';
</pre></div>

<p>就像<code>ToString()</code>Java 或 .NET 中的方法一样。</p>
<p><br><br></p>
<h2>解答</h2>
<p>您可以使用铸造运算符：</p>
<div class="code"><pre class="code literal-block">$myText = (string)$myVar;
</pre></div>

<p>在PHP 手册的字符串部分中有更多关于字符串转换和转换的详细信息，包括对布尔值和空值的特殊处理。</p>
<p><br></p>
<h3>更多建议</h3>
<p>这是通过类型转换完成的：</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="n">strvar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="o">$</span><span class="k">var</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Casts</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">string</span>
<span class="n">echo</span><span class="w"> </span><span class="o">$</span><span class="k">var</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Will</span><span class="w"> </span><span class="n">cast</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">implicitly</span>
<span class="n">var_dump</span><span class="p">(</span><span class="o">$</span><span class="k">var</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Will</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="bp">true</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">variable</span>
</pre></div>

<p>在类中，您可以使用魔法方法定义输出内容<code>__toString</code>。一个例子如下：</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">Bottles</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">__toString</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s1">'Ninety nine green bottles'</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="o">$</span><span class="n">ex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Bottles</span><span class="p">;</span>
<span class="n">var_dump</span><span class="p">(</span><span class="o">$</span><span class="n">ex</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="o">$</span><span class="n">ex</span><span class="p">);</span>
<span class="o">//</span><span class="w"> </span><span class="n">Returns</span><span class="p">:</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Bottles</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">"Ninety nine green bottles"</span>
</pre></div>

<p>更多类型转换示例：</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="mi">1</span>
<span class="n">var_dump</span><span class="p">((</span><span class="nb nb-Type">int</span><span class="p">)</span><span class="w"> </span><span class="o">$</span><span class="n">i</span><span class="p">);</span>

<span class="o">//</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="bp">true</span>
<span class="n">var_dump</span><span class="p">((</span><span class="nb nb-Type">bool</span><span class="p">)</span><span class="w"> </span><span class="o">$</span><span class="n">i</span><span class="p">);</span>

<span class="o">//</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="s2">"1"</span>
<span class="n">var_dump</span><span class="p">((</span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</pre></div>

<p><br><br><a href="posts/php-equivalent-of-net-java-s-tostring/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jian-ce-liu-lan-qi-he-shi-shou-dao-wen-jian-xia-zai/" class="u-url">检测浏览器何时收到文件下载</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/jian-ce-liu-lan-qi-he-shi-shou-dao-wen-jian-xia-zai/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T03:46:40+08:00" itemprop="datePublished" title="2023-02-18 03:46">2023-02-18 03:46</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我有一个页面允许用户下载动态生成的文件。生成需要很长时间，所以我想显示一个“等待”指示器。问题是，我不知道如何检测浏览器何时收到文件以便隐藏指示器。</p>
<p>我正在请求一个隐藏的表单，该表单发送到服务器，并针对其结果定位一个隐藏的 iframe。这是，所以我不会用结果替换整个浏览器窗口。我在 iframe
上监听“加载”事件，希望它会在下载完成时触发。</p>
<p>我返回一个<code>Content-Disposition: attachment</code>带有文件的“”标题，这会导致浏览器显示“保存”对话框。但是浏览器不会在
iframe 中触发“加载”事件。</p>
<p>我尝试的一种方法是使用<code>multi-part</code>响应。所以它会发送一个空的 HTML 文件，以及附加的可下载文件。</p>
<p>例如：</p>
<div class="code"><pre class="code literal-block"><span class="nt">Content-type</span><span class="o">:</span><span class="w"> </span><span class="nt">multipart</span><span class="o">/</span><span class="nt">x-mixed-replace</span><span class="o">;</span><span class="nt">boundary</span><span class="o">=</span><span class="s2">"abcde"</span>

<span class="nt">--abcde</span>
<span class="nt">Content-type</span><span class="o">:</span><span class="w"> </span><span class="nt">text</span><span class="o">/</span><span class="nt">html</span>

<span class="nt">--abcde</span>
<span class="nt">Content-type</span><span class="o">:</span><span class="w"> </span><span class="nt">application</span><span class="o">/</span><span class="nt">vnd</span><span class="p">.</span><span class="nc">fdf</span>
<span class="nt">Content-Disposition</span><span class="o">:</span><span class="w"> </span><span class="nt">attachment</span><span class="o">;</span><span class="w"> </span><span class="nt">filename</span><span class="o">=</span><span class="nt">foo</span><span class="p">.</span><span class="nc">fdf</span>

<span class="nt">file-content</span>
<span class="nt">--abcde</span>
</pre></div>

<p>这适用于 Firefox；它接收空的 HTML 文件，触发 <em>“加载”</em> 事件，然后显示可下载文件的 <em>“保存”对话框。</em> 但它在Internet
Explorer和Safari上失败；Internet Explorer 触发“加载”事件，但它不下载文件， <em>Safari 下载</em>
文件（名称和内容类型错误）但不触发 <em>“加载”</em> 事件。</p>
<p>一种不同的方法可能是调用开始文件创建，轮询服务器直到它准备好，然后下载已经创建的文件。但我宁愿避免在服务器上创建临时文件。</p>
<p>我应该怎么办？</p>
<p><br><br></p>
<h2>解答</h2>
<p>一种可能的解决方案是在客户端使用 JavaScript。</p>
<p>客户端算法：</p>
<ol>
<li>生成一个随机的唯一令牌。</li>
<li>提交下载请求，并将令牌包含在 GET/POST 字段中。</li>
<li>显示“等待”指示器。</li>
<li>启动计时器，每隔一秒左右查找一个名为“fileDownloadToken”（或您决定的任何名称）的 cookie。</li>
<li>如果 cookie 存在，并且它的值与令牌匹配，则隐藏“等待”指示符。</li>
</ol>
<p>服务器算法：</p>
<ol>
<li>在请求中查找 GET/POST 字段。</li>
<li>如果它有一个非空值，则删除一个 cookie（例如“fileDownloadToken”），并将其值设置为令牌的值。</li>
</ol>
<hr>
<p>客户端源代码（JavaScript）：</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">getCookie</span><span class="p">(</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">cookie</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"="</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parts</span><span class="o">.</span><span class="n">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">function</span><span class="w"> </span><span class="n">expireCookie</span><span class="p">(</span><span class="w"> </span><span class="n">cName</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">document</span><span class="o">.</span><span class="n">cookie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">        </span><span class="n">encodeURIComponent</span><span class="p">(</span><span class="n">cName</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"=deleted; expires="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="o">.</span><span class="n">toUTCString</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">function</span><span class="w"> </span><span class="n">setCursor</span><span class="p">(</span><span class="w"> </span><span class="n">docStyle</span><span class="p">,</span><span class="w"> </span><span class="n">buttonStyle</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="w"> </span><span class="s2">"doc"</span><span class="w"> </span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">cursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">docStyle</span><span class="p">;</span>
<span class="w">    </span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="w"> </span><span class="s2">"button-id"</span><span class="w"> </span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">cursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buttonStyle</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">function</span><span class="w"> </span><span class="n">setFormToken</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">downloadToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">()</span><span class="o">.</span><span class="n">getTime</span><span class="p">();</span>
<span class="w">    </span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="w"> </span><span class="s2">"downloadToken"</span><span class="w"> </span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">downloadToken</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">downloadToken</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">var</span><span class="w"> </span><span class="n">downloadTimer</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">Prevents</span><span class="w"> </span><span class="n">double</span><span class="o">-</span><span class="n">submits</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">waiting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">cookie</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="o">.</span>
<span class="n">function</span><span class="w"> </span><span class="n">blockResubmit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">downloadToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">setFormToken</span><span class="p">();</span>
<span class="w">    </span><span class="n">setCursor</span><span class="p">(</span><span class="w"> </span><span class="s2">"wait"</span><span class="p">,</span><span class="w"> </span><span class="s2">"wait"</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="n">downloadTimer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="o">.</span><span class="n">setInterval</span><span class="p">(</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getCookie</span><span class="p">(</span><span class="w"> </span><span class="s2">"downloadToken"</span><span class="w"> </span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">token</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">downloadToken</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">attempts</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">unblockSubmit</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">attempts</span><span class="o">--</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="n">function</span><span class="w"> </span><span class="n">unblockSubmit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">setCursor</span><span class="p">(</span><span class="w"> </span><span class="s2">"auto"</span><span class="p">,</span><span class="w"> </span><span class="s2">"pointer"</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="n">window</span><span class="o">.</span><span class="n">clearInterval</span><span class="p">(</span><span class="w"> </span><span class="n">downloadTimer</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="n">expireCookie</span><span class="p">(</span><span class="w"> </span><span class="s2">"downloadToken"</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="n">attempts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>示例服务器代码 (PHP)：</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="n">TOKEN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"downloadToken"</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">Sets</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">cookie</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">begins</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">browser</span><span class="w"> </span><span class="n">can</span>
<span class="o">//</span><span class="w"> </span><span class="n">unblock</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">submit</span><span class="w"> </span><span class="n">button</span><span class="w"> </span><span class="p">(</span><span class="n">thus</span><span class="w"> </span><span class="n">helping</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">clicks</span><span class="p">)</span><span class="o">.</span>
<span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="bp">false</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">allows</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cookie</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">exposed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">JavaScript</span><span class="o">.</span>
<span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">setCookieToken</span><span class="p">(</span><span class="w"> </span><span class="o">$</span><span class="n">TOKEN</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">_GET</span><span class="p">[</span><span class="w"> </span><span class="o">$</span><span class="n">TOKEN</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="bp">false</span><span class="w"> </span><span class="p">);</span>

<span class="o">$</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">sendFile</span><span class="p">();</span>
</pre></div>

<p>在哪里：</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span> <span class="n">function</span> <span class="n">setCookieToken</span>(
    <span class="nv">$cookieName</span>, <span class="nv">$cookieValue</span>, <span class="nv">$httpOnly</span> = <span class="n">true</span>, <span class="nv">$secure</span> = <span class="n">false</span> ) {

    // <span class="n">See:</span> <span class="n">http:</span>//<span class="n">stackoverflow</span>.<span class="n">com</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="mi">1459794</span><span class="o">/</span><span class="mi">59087</span>
    // <span class="n">See:</span> <span class="n">http:</span>//<span class="n">shiflett</span>.<span class="n">org</span><span class="o">/</span><span class="n">blog</span><span class="o">/</span><span class="mi">2006</span><span class="o">/</span><span class="n">mar</span><span class="o">/</span><span class="n">server-name-versus-http-host</span>
    // <span class="n">See:</span> <span class="n">http:</span>//<span class="n">stackoverflow</span>.<span class="n">com</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="mi">3290474</span><span class="o">/</span><span class="mi">59087</span>
    <span class="n">setcookie</span>(
        <span class="nv">$cookieName</span>,
        <span class="nv">$cookieValue</span>,
        <span class="mi">2147483647</span>,<span class="sr">            //</span> <span class="n">expires</span> <span class="n">January</span> <span class="mi">1</span>, <span class="mi">2038</span>
        <span class="s">"/"</span>,<span class="sr">                   //</span> <span class="n">your</span> <span class="nb">path</span>
        <span class="nv">$_SERVER</span>[<span class="s">"HTTP_HOST"</span>],<span class="sr"> //</span> <span class="n">your</span> <span class="n">domain</span>
        <span class="nv">$secure</span>,<span class="sr">               //</span> <span class="n">Use</span> <span class="n">true</span> <span class="n">over</span> <span class="n">HTTPS</span>
        <span class="nv">$httpOnly</span>              // <span class="nb">Set</span> <span class="n">true</span> <span class="k">for</span> <span class="nv">$AUTH_COOKIE_NAME</span>
    );
}
</pre></div>

<p><br></p>
<h3>更多建议</h3>
<p>一个非常简单（而且蹩脚）的单行解决方案是使用<code>window.onblur()</code>事件来关闭加载对话框。当然，如果加载时间过长并且用户决定做其他事情（比如阅读电子邮件），加载对话框将关闭。</p>
<p><br><br><a href="posts/detect-when-a-browser-receives-a-file-download/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jiang-ping-mian-biao-jie-xi-wei-shu-de-zui-you-xiao-you-ya-de-fang-fa-shi-shi-yao/" class="u-url">将平面表解析为树的最有效/优雅的方法是什么？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/jiang-ping-mian-biao-jie-xi-wei-shu-de-zui-you-xiao-you-ya-de-fang-fa-shi-shi-yao/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T03:46:10+08:00" itemprop="datePublished" title="2023-02-18 03:46">2023-02-18 03:46</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>假设您有一个存储有序树层次结构的平面表：</p>
<div class="code"><pre class="code literal-block">Id   Name         ParentId   Order
 1   'Node 1'            0      10
 2   'Node 1.1'          1      10
 3   'Node 2'            0      20
 4   'Node 1.1.1'        2      10
 5   'Node 2.1'          3      10
 6   'Node 1.2'          1      20
</pre></div>

<p>这是一个图表，我们有<code>[id] Name</code>. 根节点 0 是虚构的。</p>
<div class="code"><pre class="code literal-block">                       [0]根
                          / \
              [1] 节点 1 [3] 节点 2
              / \ \
    [2] 节点 1.1 [6] 节点 1.2 [5] 节点 2.1
          /          
 [4] 节点 1.1.1
</pre></div>

<p>您将使用哪种简约方法将其作为正确排序、正确缩进的树输出到 HTML（或文本，就此而言）？</p>
<p>进一步假设您只有基本的数据结构（数组和哈希图），没有带有父/子引用的奇特对象，没有 ORM，没有框架，只有您的两只手。该表表示为一个结果集，可以随机访问。</p>
<p>伪代码或者简单的英文都可以，这纯粹是个概念题。</p>
<p>奖励问题：是否有更好的方法在 RDBMS 中存储这样的树结构？</p>
<hr>
<p><strong>编辑和补充</strong></p>
<p>回答一位评论者（Mark Bessey的）问题：根节点不是必需的，因为它无论如何都不会显示。ParentId = 0 是表达“这些是顶级”的约定。Order
列定义了如何对具有相同父节点的节点进行排序。</p>
<p>我所说的“结果集”可以被描绘成哈希图数组（保留在该术语中）。因为我的例子本来就已经存在了。有些答案更进一步并首先构建它，但这没关系。</p>
<p>树可以任意深。每个节点可以有 N 个孩子。不过，我并没有完全想到“数百万条目”树。</p>
<p>不要将我选择的节点命名（“节点 1.1.1”）误认为是可以依赖的东西。这些节点同样可以称为“Frank”或“Bob”，没有暗示命名结构，这只是为了使其可读。</p>
<p><em>我已经发布了我自己的解决方案，所以你们可以把它拆散。</em></p>
<p><br><br></p>
<h2>解答</h2>
<p>既然MySQL 8.0 支持递归查询，那么可以说所有流行的 SQL 数据库都支持标准语法的递归查询。</p>
<div class="code"><pre class="code literal-block">WITH RECURSIVE MyTree AS (
    SELECT * FROM MyTable WHERE ParentId IS NULL
    UNION ALL
    SELECT m.* FROM MyTABLE AS m JOIN MyTree AS t ON m.ParentId = t.Id
)
SELECT * FROM MyTree;
</pre></div>

<p>我在 2017 年的演讲Recursive Query Throwdown中测试了 MySQL 8.0 中的递归查询。</p>
<p>以下是我 2008 年的原始答案：</p>
<hr>
<p>有几种方法可以将树结构数据存储在关系数据库中。您在示例中显示的内容使用两种方法：</p>
<ul>
<li>
<strong>邻接列表</strong> （“父”列）和</li>
<li>
<strong>路径枚举</strong> （名称列中的虚线数字）。</li>
</ul>
<p>另一种解决方案称为 <strong>Nested Sets</strong> ，它也可以存储在同一个表中。阅读 Joe Celko 的“ Smarties SQL
中的树和层次结构”，了解有关这些设计的更多信息。</p>
<p>我通常更喜欢一种称为 <strong>闭包表</strong> （又名“邻接关系”）的设计来存储树结构数据。它需要另一个表，但是查询树非常容易。</p>
<p>我在我的演示文稿Models for Hierarchical Data with SQL and PHP和我的书SQL Antipatterns
Volume 1: Avoiding the Pitfalls of Database Programming中介绍了 Closure Table 。</p>
<div class="code"><pre class="code literal-block">CREATE TABLE ClosureTable (
  ancestor_id   INT NOT NULL REFERENCES FlatTable(id),
  descendant_id INT NOT NULL REFERENCES FlatTable(id),
  PRIMARY KEY (ancestor_id, descendant_id)
);
</pre></div>

<p>将所有路径存储在闭包表中，其中存在从一个节点到另一个节点的直接祖先。为每个节点包含一行以引用自身。例如，使用您在问题中显示的数据集：</p>
<div class="code"><pre class="code literal-block">INSERT INTO ClosureTable (ancestor_id, descendant_id) VALUES
  (1,1), (1,2), (1,4), (1,6),
  (2,2), (2,4),
  (3,3), (3,5),
  (4,4),
  (5,5),
  (6,6);
</pre></div>

<p>现在你可以得到一棵从节点 1 开始的树，如下所示：</p>
<div class="code"><pre class="code literal-block">SELECT f.* 
FROM FlatTable f 
  JOIN ClosureTable a ON (f.id = a.descendant_id)
WHERE a.ancestor_id = 1;
</pre></div>

<p>输出（在 MySQL 客户端中）如下所示：</p>
<div class="code"><pre class="code literal-block">+----+
| id |
+----+
|  1 | 
|  2 | 
|  4 | 
|  6 | 
+----+
</pre></div>

<p>换句话说，节点 3 和 5 被排除在外，因为它们是单独层次结构的一部分，而不是节点 1 的下级。</p>
<hr>
<p>回复：来自 e-satis 关于直系子女（或直系父母）的评论。<code>path_length</code>您可以向 中添加“
”列<code>ClosureTable</code>，以便更轻松地专门查询直系子级或父级（或任何其他距离）。</p>
<div class="code"><pre class="code literal-block">INSERT INTO ClosureTable (ancestor_id, descendant_id, path_length) VALUES
  (1,1,0), (1,2,1), (1,4,2), (1,6,1),
  (2,2,0), (2,4,1),
  (3,3,0), (3,5,1),
  (4,4,0),
  (5,5,0),
  (6,6,0);
</pre></div>

<p>然后您可以在搜索中添加一个术语以查询给定节点的直接子节点。这些是<code>path_length</code>1 的后代。</p>
<div class="code"><pre class="code literal-block">SELECT f.* 
FROM FlatTable f 
  JOIN ClosureTable a ON (f.id = a.descendant_id)
WHERE a.ancestor_id = 1
  AND path_length = 1;

+----+
| id |
+----+
|  2 | 
|  6 | 
+----+
</pre></div>

<hr>
<p>来自@ashraf 的评论：“[按名称] 对整棵树进行排序怎么样？”</p>
<p>下面是一个示例查询，用于返回节点 1 的所有后代节点，将它们连接到包含其他节点属性（例如 ）的 FlatTable，<code>name</code>并按名称排序。</p>
<div class="code"><pre class="code literal-block">SELECT f.name
FROM FlatTable f 
JOIN ClosureTable a ON (f.id = a.descendant_id)
WHERE a.ancestor_id = 1
ORDER BY f.name;
</pre></div>

<hr>
<p>来自@Nate 的评论：</p>
<div class="code"><pre class="code literal-block">SELECT f.name, GROUP_CONCAT(b.ancestor_id order by b.path_length desc) AS breadcrumbs
FROM FlatTable f 
JOIN ClosureTable a ON (f.id = a.descendant_id) 
JOIN ClosureTable b ON (b.descendant_id = a.descendant_id) 
WHERE a.ancestor_id = 1 
GROUP BY a.descendant_id 
ORDER BY f.name

+------------+-------------+
| name       | breadcrumbs |
+------------+-------------+
| Node 1     | 1           |
| Node 1.1   | 1,2         |
| Node 1.1.1 | 1,2,4       |
| Node 1.2   | 1,6         |
+------------+-------------+
</pre></div>

<hr>
<p>今天有用户建议修改。所以版主批准了编辑，但我正在撤销它。</p>
<p>编辑建议上面最后一个查询中的 ORDER BY 应该是<code>ORDER BY b.path_length,
f.name</code>，大概是为了确保排序与层次结构匹配。但这不起作用，因为它会在“Node 1.2”之后订购“Node 1.1.1”。</p>
<p>如果您希望排序以合理的方式匹配层次结构，那是可能的，但不是简单地按路径长度排序。例如，请参阅我对MySQL Closure Table
hierarchical database - How to pull information out in the correct order 的回答。</p>
<p><br></p>
<h3>更多建议</h3>
<p>如果您使用嵌套集（有时称为修改后的预序树遍历），您可以使用单个查询以树顺序提取整个树结构或其中的任何子树，但插入的成本更高，因为您需要管理描述通过树结构的有序路径的列。</p>
<p>对于django-mptt，我使用了这样的结构：</p>
<div class="code"><pre class="code literal-block">id parent_id tree_id level lft right
-- ---------- ------ ------ --- ----
 1 空 1 0 1 14
 2 1 1 1 2 7
 3 2 1 2 3 4
 4 2 1 2 5 6
 5 1 1 1 8 13
 6 5 1 2 9 10
 7 5 1 2 11 12
</pre></div>

<p>它描述了一棵看起来像这样的树（代表<code>id</code>每个项目）：</p>
<div class="code"><pre class="code literal-block"><span class="mf">1</span><span class="n">个</span>
<span class="w"> </span><span class="o">+--</span><span class="w"> </span><span class="mf">2</span>
<span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="o">+--</span><span class="w"> </span><span class="mf">3</span>
<span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="o">+--</span><span class="w"> </span><span class="mf">4</span>
<span class="w"> </span><span class="err">|</span>
<span class="w"> </span><span class="o">+--</span><span class="w"> </span><span class="mf">5</span>
<span class="w">     </span><span class="o">+--</span><span class="w"> </span><span class="mf">6</span>
<span class="w">     </span><span class="o">+--</span><span class="w"> </span><span class="mf">7</span>
</pre></div>

<p>或者，作为一个嵌套的集合图，它使<code>lft</code>和<code>rght</code>值的工作方式更加明显：</p>
<div class="code"><pre class="code literal-block">________________________________________________________________________
| 根 1 |
| __________________________________ ____________________________ | |
| | 儿童 1.1 | | 儿童 1.2 | |
| | __________ __________ | | __________ __________ | |
| | | C 1.1.1 | | C 1.1.2 | | | | C 1.2.1 | | C 1.2.2 | | |
1 2 3__________4 5__________6 7 8 9__________10 11__________12 13 14
| |____________________________________| |____________________________________| |
|________________________________________________________________________|
</pre></div>

<p>如您所见，要按树顺序获取给定节点的整个子树，您只需选择具有<code>lft</code>和<code>rght</code>值介于其<code>lft</code>和<code>rght</code>值之间的所有行。检索给定节点的祖先树也很简单。</p>
<p>为了方便起见，该<code>level</code>列进行了一些非规范化，并且该列允许您为每个顶级节点<code>tree_id</code>重新开始<code>lft</code>和编号，这减少了受插入、移动和删除影响的列数，因为和列必须是在这些操作发生时进行相应调整，以创造或缩小差距。当我试图围绕每个操作所需的查询进行思考时，我做了一些开发笔记。<code>rght``lft``rght</code></p>
<p>在实际使用这些数据来显示树方面，我创建了一个<code>tree_item_iterator</code>实用函数，对于每个节点，它应该为您提供足够的信息来生成您想要的任何类型的显示。</p>
<p>有关 MPTT 的更多信息：</p>
<ul>
<li>SQL 中的树</li>
<li>在数据库中存储分层数据</li>
<li>在 MySQL 中管理分层数据</li>
</ul>
<p><br><br><a href="posts/what-is-the-most-efficient-elegant-way-to-parse-a-flat-table-into-a-tree/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1197.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1195.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
