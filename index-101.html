<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 101) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-101.html">
<link rel="prev" href="index-102.html" type="text/html">
<link rel="next" href="index-100.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/lei-jing-tai-bian-liang-he-fang-fa/" class="u-url">类（静态）变量和方法</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/lei-jing-tai-bian-liang-he-fang-fa/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T21:24:08+08:00" itemprop="datePublished" title="2023-02-16 21:24">2023-02-16 21:24</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>如何在 Python 中创建类（即静态）变量或方法？</p>
<p><br><br></p>
<h2>解答</h2>
<p>在类定义内声明但不在方法内声明的变量是类或静态变量：</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; class MyClass:
...     i = 3
...
&gt;&gt;&gt; MyClass.i
3
</pre></div>

<p>正如@millerdev指出的那样，这会创建一个类级<code>i</code>变量，但这与任何实例级<code>i</code>变量不同，因此您可以</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; m = MyClass()
&gt;&gt;&gt; m.i = 4
&gt;&gt;&gt; MyClass.i, m.i
&gt;&gt;&gt; (3, 4)
</pre></div>

<p>这与 C++ 和 Java 不同，但与 C# 没有太大区别，在 C# 中无法使用对实例的引用来访问静态成员。</p>
<p>看看Python 教程关于类和类对象的主题是怎么说的。</p>
<p>@Steve Johnson 已经回答了有关static methods 的问题，也在Python Library Reference
的“内置函数”下进行了记录。</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="nl">C</span><span class="p">:</span>
<span class="w">    </span><span class="nv">@staticmethod</span>
<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="err">:</span><span class="w"> </span><span class="p">...</span>
</pre></div>

<p>@beidy 推荐classmethod优于 staticmethod，因为该方法随后接收类类型作为第一个参数。</p>
<p><br></p>
<h3>更多建议</h3>
<p>@Blair Conrad 说在类定义内而不是在方法内声明的静态变量是类或“静态”变量：</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; class Test(object):
...     i = 3
...
&gt;&gt;&gt; Test.i
3
</pre></div>

<p>这里有一些问题。承接上面的例子：</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Test</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">i</span><span class="w">     </span><span class="c1"># "static" variable accessed via instance</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="c1"># but if we assign to the instance ...</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">Test</span><span class="o">.</span><span class="n">i</span><span class="w">  </span><span class="c1"># we have not changed the "static" variable</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">i</span><span class="w">     </span><span class="c1"># we have overwritten Test.i on t by creating a new attribute t.i</span>
<span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">Test</span><span class="o">.</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="c1"># to change the "static" variable we do it by assigning to the class</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">i</span>
<span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">Test</span><span class="o">.</span><span class="n">i</span>
<span class="mi">6</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Test</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">u</span><span class="o">.</span><span class="n">i</span>
<span class="mi">6</span><span class="w">           </span><span class="c1"># changes to t do not affect new instances of Test</span>

<span class="c1"># Namespaces are one honking great idea -- let's do more of those!</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">Test</span><span class="o">.</span><span class="n">__dict__</span>
<span class="p">{</span><span class="s1">'i'</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="o">...</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">__dict__</span>
<span class="p">{</span><span class="s1">'i'</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">u</span><span class="o">.</span><span class="n">__dict__</span>
<span class="p">{}</span>
</pre></div>

<p>请注意，当直接在
上设置属性时，实例变量如何<code>t.i</code>与“静态”类变量不同步。这是因为在命名空间内重新绑定，这与命名空间不同。如果要更改“静态”变量的值，则必须在最初定义它的范围（或对象）内更改它。我将“static”放在引号中是因为
Python 并没有真正意义上的 C++ 和 Java 那样的静态变量。<code>i``t``i``t``Test</code></p>
<p>虽然它没有说任何关于静态变量或方法的具体信息，但Python 教程有一些关于类和类对象的相关信息。</p>
<p>@Steve Johnson 还回答了有关静态方法的问题，也记录在 Python 库参考中的“内置函数”下。</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">Test</span><span class="p">(</span><span class="k">object</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="nv">@staticmethod</span>
<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="err">:</span>
<span class="w">        </span><span class="p">...</span>
</pre></div>

<p>@beid也提到了classmethod，它类似于staticmethod。类方法的第一个参数是类对象。例子：</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">Test</span><span class="p">(</span><span class="n">object</span><span class="p">):</span>
<span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="c1"># class (or static) variable</span>
<span class="w">    </span><span class="err">@</span><span class="n">classmethod</span>
<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">g</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">):</span>
<span class="w">        </span><span class="c1"># here we can use 'cls' instead of the class name (Test)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">cls</span><span class="o">.</span><span class="n">i</span><span class="p">:</span>
<span class="w">            </span><span class="n">cls</span><span class="o">.</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="c1"># would be the same as Test.i = arg1</span>
</pre></div>

<p><img alt="上述示例的图形表示" src="images/xqnxe.jpg"></p>
<p><br><br><a href="posts/class-static-variables-and-methods/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/shi-yao-shi-san-fa-ze/" class="u-url">什么是三法则？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/shi-yao-shi-san-fa-ze/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T21:23:23+08:00" itemprop="datePublished" title="2023-02-16 21:23">2023-02-16 21:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <ul>
<li>
<em>复制对象</em> 是什么意思？</li>
<li>什么是 <em>复制构造函数</em> 和 <em>复制赋值运算符</em> ？</li>
<li>我什么时候需要自己申报？</li>
<li>如何防止我的对象被复制？</li>
</ul>
<p><br><br></p>
<h2>解答</h2>
<h2>介绍</h2>
<p><em>C++ 使用值语义</em> 来处理用户定义类型的变量。这意味着对象在各种上下文中被隐式复制，我们应该理解“复制对象”的实际含义。</p>
<p>让我们考虑一个简单的例子：</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">person</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>

<span class="n">public</span><span class="p">:</span>

<span class="w">    </span><span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="nb nb-Type">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">person</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="s2">"Bjarne Stroustrup"</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">);</span>
<span class="w">    </span><span class="n">person</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">What</span><span class="w"> </span><span class="n">happens</span><span class="w"> </span><span class="n">here</span><span class="err">?</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">         </span><span class="o">//</span><span class="w"> </span><span class="n">And</span><span class="w"> </span><span class="n">here</span><span class="err">?</span>
<span class="p">}</span>
</pre></div>

<p>（如果您对这<code>name(name), age(age)</code>部分感到困惑，这称为成员初始化列表。）</p>
<h2>特殊成员函数</h2>
<p>复制一个<code>person</code>对象是什么意思？该<code>main</code>函数显示了两种不同的复制方案。初始化由 <em>复制构造函数</em><code>person
b(a);</code>执行。它的工作是根据现有对象的状态构造一个新对象。赋值由 <em>复制赋值运算</em>
符执行。它的工作通常稍微复杂一些，因为目标对象已经处于需要处理的某个有效状态。 <strong><code>b = a</code> </strong></p>
<p>因为我们自己既没有声明复制构造函数也没有声明赋值运算符（也没有析构函数），所以这些都是为我们隐式定义的。引用自标准：</p>
<blockquote>
<p>[...] 复制构造函数和复制赋值运算符、[...] 和析构函数是特殊成员函数。[ <em>注意</em> ：
<strong>当程序没有显式声明它们时，实现将隐式声明某些类类型的这些成员函数。</strong> 如果使用它们，实现将隐式定义它们。[...] <em>尾注</em> ]
[n3126.pdf 第 12 节 §1]</p>
</blockquote>
<p>默认情况下，复制对象意味着复制其成员：</p>
<blockquote>
<p>非联合类 X 的隐式定义的复制构造函数执行其子对象的成员复制。[n3126.pdf 第 12.8 节 §16]</p>
<p>非联合类 X 的隐式定义的复制赋值运算符执行其子对象的成员复制赋值。[n3126.pdf 第 12.8 节 §30]</p>
</blockquote>
<h3>隐式定义</h3>
<p>隐式定义的特殊成员函数<code>person</code>如下所示：</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">constructor</span>
<span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="n">operator</span>
<span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">age</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="n">destructor</span>
<span class="o">~</span><span class="n">person</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>

<p>在这种情况下，成员复制正是我们想要的：<code>name</code>和<code>age</code>被复制，所以我们得到一个自包含的、独立的<code>person</code>对象。隐式定义的析构函数始终为空。在这种情况下这也很好，因为我们没有在构造函数中获取任何资源。成员的析构函数在<code>person</code>析构函数完成后隐式调用：</p>
<blockquote>
<p>在执行析构函数的主体并销毁主体内分配的任何自动对象之后，类 X 的析构函数调用 X 的直接 [...] 成员的析构函数 [n3126.pdf 12.4
§6]</p>
</blockquote>
<h2>管理资源</h2>
<p>那么我们什么时候应该显式声明那些特殊的成员函数呢？当我们的类 <em>管理一个资源的时候</em> ，也就是这个类的一个对象 <em>负责</em>
那个资源的时候。这通常意味着资源在构造函数中 <em>获取</em> （或传递到构造函数中）并在析构函数中 <em>释放。</em></p>
<p>让我们回到准标准 C++ 的时代。没有这样的东西<code>std::string</code>，程序员都爱上了指针。该类<code>person</code>可能看起来像这样：</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">person</span>
<span class="p">{</span>
<span class="w">    </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>

<span class="n">public</span><span class="p">:</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="n">acquires</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">resource</span><span class="p">:</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">case</span><span class="p">,</span><span class="w"> </span><span class="n">dynamic</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">obtained</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">new</span><span class="p">[]</span>
<span class="w">    </span><span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">the_name</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">the_age</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb">char</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">the_name</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="n">strcpy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">the_name</span><span class="p">);</span>
<span class="w">        </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_age</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">destructor</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">delete</span><span class="p">[]</span>
<span class="w">    </span><span class="o">~</span><span class="n">person</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>

<p>即使在今天，人们仍然以这种方式编写类并陷入困境：“ <em>我将一个人推入一个向量中，现在我出现了疯狂的内存错误！</em>
”请记住，默认情况下，复制对象意味着复制其成员，但<code>name</code>仅复制成员复制一个指针， <em>而不是</em> 它指向的字符数组！这有几个不愉快的影响：</p>
<ol>
<li>
<code>a</code>通过 可以观察到变化<code>b</code>。</li>
<li>一旦<code>b</code>被销毁，<code>a.name</code>就是一个悬空指针。</li>
<li>如果<code>a</code>被销毁，删除悬挂指针会产生未定义的行为。</li>
<li>由于赋值不考虑<code>name</code>赋值之前指向的内容，迟早会到处都是内存泄漏。</li>
</ol>
<h3>显式定义</h3>
<p>由于按成员复制没有达到预期的效果，我们必须显式定义复制构造函数和复制赋值运算符来制作字符数组的深度复制：</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">constructor</span>
<span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb">char</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">age</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="n">operator</span>
<span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">that</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">dangerous</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">flow</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">execution</span><span class="o">!</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">temporarily</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">invariants</span><span class="p">,</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="n">statement</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">exception</span><span class="p">,</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">leaving</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="p">:(</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb">char</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="n">strcpy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">);</span>
<span class="w">        </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">age</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>请注意初始化和赋值之间的区别：我们必须在将旧状态分配给之前拆除旧状态以<code>name</code>防止内存泄漏。此外，我们必须防止 form 的自我分配<code>x =
x</code>。如果没有该检查，将删除包含 <em>源</em><code>delete[] name</code>字符串的数组，因为当您编写 时， 和都包含相同的指针。 __<code>x =
x``this-&gt;name``that.name</code></p>
<h3>异常安全</h3>
<p><code>new char[...]</code>不幸的是，如果由于内存耗尽而抛出异常，此解决方案将失败。一种可能的解决方案是引入局部变量并对语句重新排序：</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="n">operator</span>
<span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">local_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb">char</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">statement</span><span class="w"> </span><span class="n">throws</span><span class="p">,</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">before</span><span class="o">.</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">statements</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="p">:)</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">local_name</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="n">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">local_name</span><span class="p">;</span>
<span class="w">    </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">age</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>This also takes care of self-assignment without an explicit check. An even
more robust solution to this problem is the copy-and-swap idiom, but I will
not go into the details of exception safety here. I only mentioned exceptions
to make the following point: <strong>Writing classes that manage resources is
hard.</strong></p>
<h3>Noncopyable resources</h3>
<p>Some resources cannot or should not be copied, such as file handles or
mutexes. In that case, simply declare the copy constructor and copy assignment
operator as <code>private</code> without giving a definition:</p>
<div class="code"><pre class="code literal-block"><span class="kd">private</span><span class="o">:</span>

<span class="w">    </span><span class="n">person</span><span class="o">(</span><span class="kd">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="o">);</span>
<span class="w">    </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=(</span><span class="kd">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="o">);</span>
</pre></div>

<p>Alternatively, you can inherit from <code>boost::noncopyable</code> or declare them as
deleted (in C++11 and above):</p>
<div class="code"><pre class="code literal-block"><span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delete</span><span class="p">;</span>
<span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delete</span><span class="p">;</span>
</pre></div>

<h3>The rule of three</h3>
<p>Sometimes you need to implement a class that manages a resource. (Never manage
multiple resources in a single class, this will only lead to pain.) In that
case, remember the <strong>rule of three</strong> :</p>
<blockquote>
<p>If you need to explicitly declare either the destructor, copy constructor or
copy assignment operator yourself, you probably need to explicitly declare
all three of them.</p>
</blockquote>
<p>(Unfortunately, this "rule" is not enforced by the C++ standard or any
compiler I am aware of.)</p>
<h3>The rule of five</h3>
<p>From C++11 on, an object has 2 extra special member functions: the move
constructor and move assignment. The rule of five states to implement these
functions as well.</p>
<p>An example with the signatures:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">person</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>

<span class="n">public</span><span class="p">:</span>
<span class="w">    </span><span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">age</span><span class="p">);</span><span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Ctor</span>
<span class="w">    </span><span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default</span><span class="p">;</span><span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">Copy</span><span class="w"> </span><span class="n">Ctor</span>
<span class="w">    </span><span class="n">person</span><span class="p">(</span><span class="n">person</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="p">)</span><span class="w"> </span><span class="n">noexcept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default</span><span class="p">;</span><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="mi">4</span><span class="o">/</span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">Move</span><span class="w"> </span><span class="n">Ctor</span>
<span class="w">    </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default</span><span class="p">;</span><span class="w">     </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="o">/</span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">Copy</span><span class="w"> </span><span class="n">Assignment</span>
<span class="w">    </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="n">person</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="p">)</span><span class="w"> </span><span class="n">noexcept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">5</span><span class="o">/</span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">Move</span><span class="w"> </span><span class="n">Assignment</span>
<span class="w">    </span><span class="o">~</span><span class="n">person</span><span class="p">()</span><span class="w"> </span><span class="n">noexcept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default</span><span class="p">;</span><span class="w">                    </span><span class="o">//</span><span class="w"> </span><span class="mi">3</span><span class="o">/</span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">Dtor</span>
<span class="p">};</span>
</pre></div>

<h3>The rule of zero</h3>
<p>The rule of 3/5 is also referred to as the rule of 0/3/5. The zero part of the
rule states that you are allowed to not write any of the special member
functions when creating your class.</p>
<h2>Advice</h2>
<p>Most of the time, you do not need to manage a resource yourself, because an
existing class such as <code>std::string</code> already does it for you. Just compare the
simple code using a <code>std::string</code> member to the convoluted and error-prone
alternative using a <code>char*</code> and you should be convinced. As long as you stay
away from raw pointer members, the rule of three is unlikely to concern your
own code.</p>
<p><br></p>
<h3>更多建议</h3>
<p>三法则是C++ 的经验法则，基本上是说</p>
<blockquote>
<p>如果你的班级需要任何</p>
<ul>
<li>一个 <strong>复制构造函数</strong> ，</li>
<li>一个 <strong>赋值运算符</strong> ，</li>
<li>或 <strong>析构函数</strong> ，
</li>
</ul>
<p>明确定义，那么很可能需要 <strong>这三个</strong> 。</p>
</blockquote>
<p>这样做的原因是它们三个通常都用于管理资源，如果您的类管理资源，它通常需要管理复制和释放。</p>
<p>如果复制类管理的资源没有良好的语义，则考虑通过声明（不 <em>定义</em> ）复制构造函数和赋值运算符来禁止复制<code>private</code>。</p>
<p>（请注意，即将发布的 C++ 标准新版本（即 C++11）向 C++ 添加了移动语义，这可能会改变三规则。但是，我对此知之甚少，无法编写 C++11
部分关于三法则。）</p>
<p><br><br><a href="posts/what-is-the-rule-of-three/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ru-he-zhi-zuo-chu-se-de-r-ke-zhong-xian-shi-li/" class="u-url">如何制作出色的 R 可重现示例</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ru-he-zhi-zuo-chu-se-de-r-ke-zhong-xian-shi-li/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T21:22:53+08:00" itemprop="datePublished" title="2023-02-16 21:22">2023-02-16 21:22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><strong>这个问题的答案是 社区的努力</strong>。编辑现有答案以改进这篇文章。它目前不接受新的答案或互动。</p>
<p>在与同事讨论性能、教学、发送错误报告或在邮件列表和 Stack Overflow 上搜索指导时，经常会询问可重现的示例并且总是有帮助的。</p>
<p>创建优秀示例的技巧是什么？你如何粘贴数据结构r以文本格式？您还应该包括哪些其他信息？</p>
<p>除了使用<code>dput()</code>,<code>dump()</code>还是还有其他技巧吗<code>structure()</code>？什么时候应该包含<code>library()</code>or<code>require()</code>语句？除了<code>c</code>,
<code>df</code>, <code>data</code>, 等，还应该避免使用哪些保留字？</p>
<p>一个人如何成为伟大的r可重现的例子？</p>
<p><br><br></p>
<h2>解答</h2>
<p>基本上， <strong>最小可重现示例 (MRE)</strong> 应该能让其他人在他们的机器上 <em>准确重现您的问题。</em></p>
<p><strong>请不要发布您的数据、代码或控制台输出的图像！</strong></p>
<h2>tl；博士</h2>
<p>MRE 由以下项目组成：</p>
<ul>
<li>一个 <strong>最小的数据集</strong> ，是证明问题所必需的</li>
<li>重现问题所需的最小可运行代码，可以在给定数据 <strong>集 <em>上</em> 运行</strong>
</li>
<li>关于所使用的s、R 版本和它运行的操作系统的所有 <strong>必要信息，也许是</strong><code>library``sessionInfo()</code>
</li>
<li>在随机过程的情况下，一个 <strong>种子</strong> （由 设置<code>set.seed()</code>）使其他人能够复制与您完全相同的结果</li>
</ul>
<p>有关良好 MRE 的示例，请参阅您正在使用的函数的帮助页面底部的“示例”部分。只需在 R 控制台中键入 eg<code>help(mean)</code>或
short即可。<code>?mean</code></p>
<h2>提供最小数据集</h2>
<p>通常，共享庞大的数据集是没有必要的，而且可能会阻止其他人阅读您的问题。因此，最好使用内置数据集或创建一个类似于原始数据的小型“玩具”示例，这实际上就是
<em>minimal</em> 的意思。如果出于某种原因您确实需要共享您的原始数据，您应该使用一种方法，例如<code>dput()</code>允许其他人获得您的数据的精确副本。</p>
<h4>内置数据集</h4>
<p>您可以使用其中一个内置数据集。内置数据集的完整列表可以通过<code>data()</code>. 每个数据集都有一个简短的描述，并且可以获得更多信息，例如<code>?iris</code>，对于
R 附带的“iris”数据集。已安装的包可能包含其他数据集。</p>
<h4>创建示例数据集</h4>
<p><em>初步说明：</em> 有时您可能需要特殊格式（即类），例如因子、日期或时间序列。对于这些，请使用以下函数：<code>as.factor</code>, <code>as.Date</code>,
<code>as.xts</code>, ... <em>示例：</em></p>
<div class="code"><pre class="code literal-block"><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="s">"2020-12-30"</span><span class="p">)</span>
</pre></div>

<p>在哪里</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span>(<span class="nb">d</span>)
<span class="c1"># [1] "Date"</span>
</pre></div>

<p><strong>载体</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1">## random vector normal distributed</span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1">## random vector uniformly distributed    </span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1">## 10 random draws out of 1, 2, ..., 100    </span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1">## 10 random draws out of built-in latin alphabet</span>
</pre></div>

<p><strong>矩阵</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">dimnames</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="w"> </span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]))</span>
<span class="n">m</span>
<span class="c1">#   A B C  D</span>
<span class="c1"># A 1 4 7 10</span>
<span class="c1"># B 2 5 8 11</span>
<span class="c1"># C 3 6 9 12</span>
</pre></div>

<p><strong>数据框</strong></p>
<div class="code"><pre class="code literal-block"><span class="nf">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span><span class="w">  </span><span class="c1">## for sake of reproducibility</span>
<span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">6</span>
<span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="w"> </span>
<span class="w">                  </span><span class="n">date</span><span class="o">=</span><span class="nf">seq.Date</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="s">"2020-12-26"</span><span class="p">),</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="s">"2020-12-31"</span><span class="p">),</span><span class="w"> </span><span class="s">"day"</span><span class="p">),</span>
<span class="w">                  </span><span class="n">group</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">n</span><span class="o">/</span><span class="m">2</span><span class="p">),</span>
<span class="w">                  </span><span class="n">age</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="m">18</span><span class="o">:</span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span>
<span class="w">                  </span><span class="n">type</span><span class="o">=</span><span class="nf">factor</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">"type"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">)),</span>
<span class="w">                  </span><span class="n">x</span><span class="o">=</span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">dat</span>
<span class="c1">#   id       date group age   type         x</span>
<span class="c1"># 1  1 2020-12-26     A  27 type 1 0.0356312</span>
<span class="c1"># 2  2 2020-12-27     B  19 type 2 1.3149588</span>
<span class="c1"># 3  3 2020-12-28     A  20 type 3 0.9781675</span>
<span class="c1"># 4  4 2020-12-29     B  26 type 4 0.8817912</span>
<span class="c1"># 5  5 2020-12-30     A  26 type 5 0.4822047</span>
<span class="c1"># 6  6 2020-12-31     B  28 type 6 0.9657529</span>
</pre></div>

<p><strong>注意：</strong> 虽然它被广泛使用，但最好不要命名你的数据框<code>df</code>，因为它是F 分布的<code>df()</code>密度（即曲线在点处的高度）的 R
函数，你可能会与它发生冲突。<code>x</code></p>
<h4>复制原始数据</h4>
<p>如果您有特定原因，或者数据太难构建示例，您可以提供原始数据的一小部分，最好使用<code>dput</code>.</p>
<p><strong>为什么使用<code>dput()</code>？</strong></p>
<p><code>dput</code>抛出在控制台上准确重现数据所需的所有信息。您可以简单地复制输出并将其粘贴到您的问题中。</p>
<p><code>dat</code>如果您在问题中共享调用（从上面）产生的输出仍然缺少有关变量类和其他功能的信息。此外，列中的空格<code>type</code>使得很难对其进行任何操作。即使我们开始使用这些数据，我们也无法正确获取您数据的重要特征。</p>
<div class="code"><pre class="code literal-block">  id       date group age   type         x
1  1 2020-12-26     A  27 type 1 0.0356312
2  2 2020-12-27     B  19 type 2 1.3149588
3  3 2020-12-28     A  20 type 3 0.9781675
</pre></div>

<p><strong>子集你的数据</strong></p>
<p>要共享子集，请使用<code>head()</code>或<code>subset()</code>索引<code>iris[1:4, ]</code>。然后把它包起来<code>dput()</code>给其他人一些可以立即放入R的东西。
<em>例子</em></p>
<div class="code"><pre class="code literal-block">dput(iris[1:4, ]) # first four rows of the iris data set
</pre></div>

<p><em>控制台输出以分享您的问题：</em></p>
<div class="code"><pre class="code literal-block">structure(list(Sepal.Length = c(5.1, 4.9, 4.7, 4.6), Sepal.Width = c(3.5, 
3, 3.2, 3.1), Petal.Length = c(1.4, 1.4, 1.3, 1.5), Petal.Width = c(0.2, 
0.2, 0.2, 0.2), Species = structure(c(1L, 1L, 1L, 1L), .Label = c("setosa", 
"versicolor", "virginica"), class = "factor")), row.names = c(NA, 
4L), class = "data.frame")
</pre></div>

<p>使用 时<code>dput</code>，您可能还想只包含相关列，例如 dput(mtcars[1:3, c(2, 5, 6)])</p>
<p><strong>注意：</strong>
如果您的数据框具有多个级别的因子，则<code>dput</code>输出可能会很笨拙，因为它仍会列出所有可能的因子级别，即使它们不存在于您的数据子集中。要解决此问题，您可以使用该<code>droplevels()</code>功能。请注意下面的物种如何成为只有一个水平的因素，例如<code>dput(droplevels(iris[1:4,
]))</code>。另一个警告是它<code>dput</code>不适用于键控<code>data.table</code>对象或<code>tbl_df</code>来自.
在这些情况下，您可以在共享之前转换回常规数据框，.<code>grouped_df``tidyverse``dput(as.data.frame(my_data))</code></p>
<h2>生成最少的代码</h2>
<p>结合最少的数据（见上文），您的代码应该通过简单的复制和粘贴在另一台机器上准确地重现问题。</p>
<p>这应该是容易的部分，但通常不是。你不应该做什么：</p>
<ul>
<li>显示各种数据转换；确保提供的数据已经是正确的格式（当然，除非这是问题所在）</li>
<li>复制粘贴整个脚本，在某处给出错误。尝试找出导致错误的确切行。通常情况下，您会发现问题出在自己身上。</li>
</ul>
<p>你应该做什么：</p>
<ul>
<li>添加你使用的包，如果你使用任何（使用<code>library()</code>）</li>
<li>在新的 R 会话中测试运行您的代码，以确保代码可运行。人们应该能够在控制台中复制粘贴您的数据和代码，并获得与您相同的结果。</li>
<li>如果您打开连接或创建文件，请添加一些代码以关闭它们或删除文件（使用<code>unlink()</code>）</li>
<li>如果您更改选项，请确保代码包含将它们还原为原始选项的语句。（例如<code>op &lt;- par(mfrow=c(1,2)) ...some code... par(op)</code>）</li>
</ul>
<h2>提供必要的信息</h2>
<p>在大多数情况下，只需 R 版本和操作系统就足够了。当与包发生冲突时，提供
的输出<code>sessionInfo()</code>真的很有帮助。在谈论与其他应用程序的连接时（无论是通过 ODBC
还是其他任何方式），还应提供这些应用程序的版本号，如果可能，还应提供有关设置的必要信息。</p>
<p><em>如果您在R Studio</em> 中运行 R ，使用<code>rstudioapi::versionInfo()</code>可以帮助报告您的 RStudio 版本。</p>
<p>如果您对特定包有问题，您可能希望通过提供<code>packageVersion("name of the package")</code>.</p>
<h2>种子</h2>
<p>使用<code>set.seed()</code>您可以指定一个种子1，即特定状态，R
的随机数生成器是固定的。这使得随机函数（例如<code>sample()</code>、<code>rnorm()</code>和<code>runif()</code>许多其他函数）始终返回相同的结果成为可能，
<em>示例：</em></p>
<div class="code"><pre class="code literal-block">set.seed(42)
rnorm(3)
# [1]  1.3709584 -0.5646982  0.3631284

set.seed(42)
rnorm(3)
# [1]  1.3709584 -0.5646982  0.3631284
</pre></div>

<p>1 <strong>注意：</strong> R &gt;3.6.0 和之前版本的输出不同。指定您用于随机过程的 R
版本，如果您在遵循旧问题时得到略有不同的结果，请不要感到惊讶。要在这种情况下获得相同的结果，您可以在之前使用 -function （例如：）。
****<code>set.seed()``RNGversion()``set.seed()``RNGversion("3.5.2")</code></p>
<p><br></p>
<h3>更多建议</h3>
<p>（这是我从How to write a reproducible example中得到的建议。我试图让它简短但有趣）。</p>
<h2>如何编写可重现的示例</h2>
<p>如果您提供可重现的示例，您最有可能在解决 R 问题时得到很好的帮助。一个可重现的例子允许其他人通过复制和粘贴 R 代码来重现你的问题。</p>
<p>您需要包括四样东西才能使您的示例可重现：所需的包、数据、代码和 R 环境的描述。</p>
<ul>
<li>
<p><strong>包</strong> 应该在脚本的顶部加载，所以很容易看出示例需要哪些包。</p>
</li>
<li>
<p>在电子邮件或 Stack Overflow 问题中包含 <strong>数据的</strong><code>dput()</code>最简单方法是使用生成 R 代码来重新创建它。例如，要<code>mtcars</code>在 R 中重新创建数据集，我将执行以下步骤：</p>
<ol>
<li>
<code>dput(mtcars)</code>在 R 中运行</li>
<li>复制输出</li>
<li>在我的可重现脚本中，键入<code>mtcars &lt;-</code>然后粘贴。</li>
<li>
<p>花一点时间确保您的 <strong>代码</strong> 易于他人阅读：</p>
</li>
<li>
<p>确保您使用了空格并且您的变量名称简洁但信息丰富</p>
</li>
<li>
<p>使用评论指出您的问题所在</p>
</li>
<li>
<p>尽力删除与问题无关的所有内容。<br>
你的代码越短，就越容易理解。</p>
</li>
</ol>
</li>
<li>
<p><code>sessionInfo()</code>在代码的注释中包含 的输出。这总结了您的 <strong>R 环境</strong> ，并且可以轻松检查您是否使用了过时的包。</p>
</li>
</ul>
<p>您可以通过启动一个新的 R 会话并粘贴您的脚本来检查您是否确实制作了一个可重现的示例。</p>
<p>在将所有代码放入电子邮件之前，请考虑将其放在Gist github上。它会给你的代码很好的语法高亮显示，你不必担心任何东西被电子邮件系统破坏。</p>
<p><br><br><a href="posts/how-to-make-a-great-r-reproducible-example/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-102.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-100.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
