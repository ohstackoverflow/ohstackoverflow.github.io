<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 991) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-991.html">
<link rel="prev" href="index-992.html" type="text/html">
<link rel="next" href="index-990.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-s-the-difference-between-git-clone-mirror-and-git-clone-bare/" class="u-url">What's the difference between git clone --mirror and git clone --bare</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-s-the-difference-between-git-clone-mirror-and-git-clone-bare/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T21:49:59+08:00" itemprop="datePublished" title="2023-02-17 21:49">2023-02-17 21:49</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>The git clone help page has this to say about <code>--mirror</code>:</p>
<blockquote>
<p>Set up a mirror of the remote repository. This implies <code>--bare</code>.</p>
</blockquote>
<p>But doesn't go into detail about how the <code>--mirror</code> clone is different from a
<code>--bare</code> clone.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The difference is that when using <code>--mirror</code>, <em>all</em> refs are copied <em>as-is</em>.
This means everything: remote-tracking branches, notes, refs/originals/*
(backups from filter-branch). The cloned repo has it all. It's also set up so
that a remote update will re-fetch everything from the origin (overwriting the
copied refs). The idea is really to mirror the repository, to have a total
copy, so that you could for example host your central repo in multiple places,
or back it up. Think of just straight-up copying the repo, except in a much
more elegant git way.</p>
<p>The new documentation pretty much says all this:</p>
<blockquote>
<p><code>--mirror</code></p>
<p>Set up a mirror of the source repository. This implies <code>--bare</code>. Compared to
<code>--bare</code>, <code>--mirror</code> not only maps local branches of the source to local
branches of the target, it maps all refs (including remote branches, notes
etc.) and sets up a refspec configuration such that all these refs are
overwritten by a <code>git remote update</code> in the target repository.</p>
</blockquote>
<p>My original answer also noted the differences between a bare clone and a
normal (non-bare) clone - the non-bare clone sets up remote tracking branches,
only creating a local branch for <code>HEAD</code>, while the bare clone copies the
branches directly.</p>
<p>Suppose origin has a few branches (<code>master (HEAD)</code>, <code>next</code>, <code>pu</code>, and
<code>maint</code>), some tags (<code>v1</code>, <code>v2</code>, <code>v3</code>), some remote branches (<code>devA/master</code>,
<code>devB/master</code>), and some other refs (<code>refs/foo/bar</code>, <code>refs/foo/baz</code>, which
might be notes, stashes, other devs' namespaces, who knows).</p>
<ul>
<li>
<p><strong><code>git clone origin-url</code> (non-bare):</strong> You will get all of the tags copied, a local branch <code>master (HEAD)</code> tracking a remote branch <code>origin/master</code>, and remote branches <code>origin/next</code>, <code>origin/pu</code>, and <code>origin/maint</code>. The tracking branches are set up so that if you do something like <code>git fetch origin</code>, they'll be fetched as you expect. Any remote branches (in the cloned remote) and other refs are completely ignored.</p>
</li>
<li>
<p><strong><code>git clone --bare origin-url</code>:</strong> You will get all of the tags copied, local branches <code>master (HEAD)</code>, <code>next</code>, <code>pu</code>, and <code>maint</code>, no remote tracking branches. That is, all branches are copied as is, and it's set up completely independent, with no expectation of fetching again. Any remote branches (in the cloned remote) and other refs are completely ignored.</p>
</li>
<li>
<p><strong><code>git clone --mirror origin-url</code>:</strong> Every last one of those refs will be copied as-is. You'll get all the tags, local branches <code>master (HEAD)</code>, <code>next</code>, <code>pu</code>, and <code>maint</code>, remote branches <code>devA/master</code> and <code>devB/master</code>, other refs <code>refs/foo/bar</code> and <code>refs/foo/baz</code>. Everything is exactly as it was in the cloned remote. Remote tracking is set up so that if you run <code>git remote update</code> all refs will be overwritten from origin, as if you'd just deleted the mirror and recloned it. As the docs originally said, it's a mirror. It's supposed to be a functionally identical copy, interchangeable with the original.</p>
</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--mirror<span class="w"> </span><span class="nv">$URL</span>
</pre></div>

<p>is a short-hand for</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--bare<span class="w"> </span><span class="nv">$URL</span>
$<span class="w"> </span><span class="o">(</span><span class="nb">cd</span><span class="w"> </span><span class="k">$(</span>basename<span class="w"> </span><span class="nv">$URL</span><span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>--mirror<span class="o">=</span>fetch<span class="w"> </span>origin<span class="w"> </span><span class="nv">$URL</span><span class="o">)</span>
</pre></div>

<p>(Copied directly from here)</p>
<p>How the current man-page puts it:</p>
<blockquote>
<p>Compared to <code>--bare</code>, <code>--mirror</code> not only maps local branches of the source
to local branches of the target, it maps all refs (including remote
branches, notes etc.) and sets up a refspec configuration such that all
these refs are overwritten by a <code>git remote update</code> in the target
repository.</p>
</blockquote>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-retrieve-an-element-from-a-set-without-removing-it/" class="u-url">How to retrieve an element from a set without removing it?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-retrieve-an-element-from-a-set-without-removing-it/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T21:49:23+08:00" itemprop="datePublished" title="2023-02-17 21:49">2023-02-17 21:49</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Suppose the following:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; s = set([1, 2, 3])
</pre></div>

<p>How do I get a value (any value) out of <code>s</code> without doing <code>s.pop()</code>? I want to
leave the item in the set until I am sure I can remove it - something I can
only be sure of after an asynchronous call to another host.</p>
<p>Quick and dirty:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; elem = s.pop()
&gt;&gt;&gt; s.add(elem)
</pre></div>

<p>But do you know of a better way? Ideally in constant time.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Two options that don't require copying the whole set:</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="w"> </span><span class="nv">e</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">s</span>:
<span class="w">    </span><span class="k">break</span>
#<span class="w"> </span><span class="nv">e</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">now</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">element</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">s</span>
</pre></div>

<p>Or...</p>
<div class="code"><pre class="code literal-block"><span class="nv">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">next</span><span class="ss">(</span><span class="nv">iter</span><span class="ss">(</span><span class="nv">s</span><span class="ss">))</span>
</pre></div>

<p>But in general, sets don't support indexing or slicing.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Least code would be:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; s = set([1, 2, 3])
&gt;&gt;&gt; list(s)[0]
1
</pre></div>

<p>Obviously this would create a new list which contains each member of the set,
so not great if your set is very large.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/find-and-replace-in-file-and-overwrite-file-doesn-t-work-it-empties-the-file/" class="u-url">Find and replace in file and overwrite file doesn't work, it empties the file</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/find-and-replace-in-file-and-overwrite-file-doesn-t-work-it-empties-the-file/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T21:48:49+08:00" itemprop="datePublished" title="2023-02-17 21:48">2023-02-17 21:48</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I would like to run a find and replace on an HTML file through the command
line.</p>
<p>My command looks something like this:</p>
<div class="code"><pre class="code literal-block">sed -e s/STRING_TO_REPLACE/STRING_TO_REPLACE_IT/g index.html &gt; index.html
</pre></div>

<p>When I run this and look at the file afterward, it is empty. It deleted the
contents of my file.</p>
<p>When I run this after restoring the file again:</p>
<div class="code"><pre class="code literal-block">sed -e s/STRING_TO_REPLACE/STRING_TO_REPLACE_IT/g index.html
</pre></div>

<p>The <code>stdout</code> is the contents of the file, and the find and replace has been
executed.</p>
<p>Why is this happening?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>When the <strong>shell</strong> sees <code>&gt; index.html</code> in the command line it opens the file
<code>index.html</code> for <strong>writing</strong> , wiping off all its previous contents.</p>
<p>To fix this you need to pass the <code>-i</code> option to <code>sed</code> to make the changes
inline and create a backup of the original file before it does the changes in-
place:</p>
<div class="code"><pre class="code literal-block">sed -i.bak s/STRING_TO_REPLACE/STRING_TO_REPLACE_IT/g index.html
</pre></div>

<p>Without the .bak the command will fail on some platforms, such as Mac OSX.</p>
<p><br></p>
<h3>Suggest</h3>
<p>An alternative, useful, pattern is:</p>
<div class="code"><pre class="code literal-block">sed -e 'script script' index.html &gt; index.html.tmp &amp;&amp; mv index.html.tmp index.html
</pre></div>

<p>That has much the same effect, without using the <code>-i</code> option, and additionally
means that, if the sed script fails for some reason, the input file isn't
clobbered. Further, if the edit is successful, there's no backup file left
lying around. This sort of idiom can be useful in Makefiles.</p>
<p>Quite a lot of seds have the <code>-i</code> option, but not all of them; the posix sed
is one which doesn't. If you're aiming for portability, therefore, it's best
avoided.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-992.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-990.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
