<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2390) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2390.html">
<link rel="prev" href="index-2391.html" type="text/html">
<link rel="next" href="index-2389.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-evaluate-a-math-expression-given-in-string-form/" class="u-url">How to evaluate a math expression given in string form?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-evaluate-a-math-expression-given-in-string-form/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T12:35:04+08:00" itemprop="datePublished" title="2023-03-04 12:35">2023-03-04 12:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to write a Java routine to evaluate math expressions from <code>String</code>
values like:</p>
<ol>
<li><code>"5+3"</code></li>
<li><code>"10-4*5"</code></li>
<li><code>"(1+10)*3"</code></li>
</ol>
<p>I want to avoid a lot of if-then-else statements. How can I do this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>With JDK1.6, you can use the built-in Javascript engine.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">javax.script.ScriptEngineManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.script.ScriptEngine</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.script.ScriptException</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">Test</span> <span class="p">{</span>
  <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="n">throws</span> <span class="n">ScriptException</span> <span class="p">{</span>
    <span class="n">ScriptEngineManager</span> <span class="n">mgr</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ScriptEngineManager</span><span class="p">();</span>
    <span class="n">ScriptEngine</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">mgr</span><span class="o">.</span><span class="n">getEngineByName</span><span class="p">(</span><span class="s2">"JavaScript"</span><span class="p">);</span>
    <span class="n">String</span> <span class="n">foo</span> <span class="o">=</span> <span class="s2">"40+2"</span><span class="p">;</span>
    <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">engine</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">foo</span><span class="p">));</span>
    <span class="p">}</span> 
<span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I've written this <code>eval</code> method for arithmetic expressions to answer this
question. It does addition, subtraction, multiplication, division,
exponentiation (using the <code>^</code> symbol), and a few basic functions like <code>sqrt</code>.
It supports grouping using <code>(</code>...<code>)</code>, and it gets the operator precedence and
associativity rules correct.</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="n">eval</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="nb">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ch</span><span class="p">;</span>

<span class="w">        </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">nextChar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">str</span><span class="o">.</span><span class="n">length</span><span class="p">())</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="nb">str</span><span class="o">.</span><span class="n">charAt</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">boolean</span><span class="w"> </span><span class="n">eat</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">charToEat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">' '</span><span class="p">)</span><span class="w"> </span><span class="n">nextChar</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">charToEat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">nextChar</span><span class="p">();</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">double</span><span class="w"> </span><span class="n">parse</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">nextChar</span><span class="p">();</span>
<span class="w">            </span><span class="n">double</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseExpression</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">str</span><span class="o">.</span><span class="n">length</span><span class="p">())</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s2">"Unexpected: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nb">char</span><span class="p">)</span><span class="n">ch</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Grammar</span><span class="p">:</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="err">`</span><span class="o">+</span><span class="err">`</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="err">`</span><span class="o">-</span><span class="err">`</span><span class="w"> </span><span class="n">term</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="err">`</span><span class="o">*</span><span class="err">`</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="err">`</span><span class="w"> </span><span class="n">factor</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="o">+</span><span class="err">`</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">`</span><span class="o">-</span><span class="err">`</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">`</span><span class="p">(</span><span class="err">`</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="err">`</span><span class="p">)</span><span class="err">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">number</span>
<span class="w">        </span><span class="o">//</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">functionName</span><span class="w"> </span><span class="err">`</span><span class="p">(</span><span class="err">`</span><span class="w"> </span><span class="n">expression</span><span class="w"> </span><span class="err">`</span><span class="p">)</span><span class="err">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">functionName</span><span class="w"> </span><span class="n">factor</span>
<span class="w">        </span><span class="o">//</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="err">`</span><span class="o">^</span><span class="err">`</span><span class="w"> </span><span class="n">factor</span>

<span class="w">        </span><span class="n">double</span><span class="w"> </span><span class="n">parseExpression</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">double</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseTerm</span><span class="p">();</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w">      </span><span class="p">(</span><span class="n">eat</span><span class="p">(</span><span class="s1">'+'</span><span class="p">))</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">parseTerm</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">addition</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eat</span><span class="p">(</span><span class="s1">'-'</span><span class="p">))</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">parseTerm</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">subtraction</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">double</span><span class="w"> </span><span class="n">parseTerm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">double</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseFactor</span><span class="p">();</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w">      </span><span class="p">(</span><span class="n">eat</span><span class="p">(</span><span class="s1">'*'</span><span class="p">))</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">parseFactor</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">multiplication</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eat</span><span class="p">(</span><span class="s1">'/'</span><span class="p">))</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">parseFactor</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">division</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">double</span><span class="w"> </span><span class="n">parseFactor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eat</span><span class="p">(</span><span class="s1">'+'</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">+</span><span class="n">parseFactor</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">unary</span><span class="w"> </span><span class="n">plus</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eat</span><span class="p">(</span><span class="s1">'-'</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">-</span><span class="n">parseFactor</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">unary</span><span class="w"> </span><span class="n">minus</span>

<span class="w">            </span><span class="n">double</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">            </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">startPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">pos</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eat</span><span class="p">(</span><span class="s1">'('</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">parentheses</span>
<span class="w">                </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseExpression</span><span class="p">();</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">eat</span><span class="p">(</span><span class="s1">')'</span><span class="p">))</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s2">"Missing ')'"</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">'0'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="s1">'9'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'.'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">numbers</span>
<span class="w">                </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">'0'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="s1">'9'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'.'</span><span class="p">)</span><span class="w"> </span><span class="n">nextChar</span><span class="p">();</span>
<span class="w">                </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Double</span><span class="o">.</span><span class="n">parseDouble</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="n">startPos</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">pos</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">'a'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="s1">'z'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">functions</span>
<span class="w">                </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ch</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">'a'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="s1">'z'</span><span class="p">)</span><span class="w"> </span><span class="n">nextChar</span><span class="p">();</span>
<span class="w">                </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="k">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">str</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="n">startPos</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">pos</span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eat</span><span class="p">(</span><span class="s1">'('</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseExpression</span><span class="p">();</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">eat</span><span class="p">(</span><span class="s1">')'</span><span class="p">))</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s2">"Missing ')' after argument to "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">func</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseFactor</span><span class="p">();</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">func</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="s2">"sqrt"</span><span class="p">))</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">func</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="s2">"sin"</span><span class="p">))</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">toRadians</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">func</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="s2">"cos"</span><span class="p">))</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">toRadians</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">func</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="s2">"tan"</span><span class="p">))</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">toRadians</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s2">"Unknown function: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">func</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s2">"Unexpected: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nb">char</span><span class="p">)</span><span class="n">ch</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">eat</span><span class="p">(</span><span class="s1">'^'</span><span class="p">))</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">parseFactor</span><span class="p">());</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">exponentiation</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="o">.</span><span class="n">parse</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>Example:</p>
<div class="code"><pre class="code literal-block">System.out.println(eval("((4 - 2^3 + 1) * -sqrt(3*3+4*4)) / 2"));
</pre></div>

<p>Output: 7.5 (which is correct)</p>
<hr>
<p>The parser is a recursive descent parser, so internally uses separate parse
methods for each level of operator precedence in its grammar. I deliberately
kept it <strong>short</strong> , but here are some ideas you might want to expand it with:</p>
<ul>
<li><strong>Variables:</strong></li>
</ul>
<p>The bit of the parser that reads the names for functions can easily be changed
to handle custom variables too, by looking up names in a variable table passed
to the <code>eval</code> method, such as a <code>Map&lt;String,Double&gt; variables</code>.</p>
<ul>
<li><strong>Separate compilation and evaluation:</strong></li>
</ul>
<p>What if, having added support for variables, you wanted to evaluate the same
expression millions of times with changed variables, without parsing it every
time? It's possible. First define an interface to use to evaluate the
precompiled expression:</p>
<div class="code"><pre class="code literal-block"><span class="w">      </span><span class="nv">@FunctionalInterface</span>
<span class="w">  </span><span class="n">interface</span><span class="w"> </span><span class="n">Expression</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="k">double</span><span class="w"> </span><span class="n">eval</span><span class="p">();</span>
<span class="w">  </span><span class="err">}</span>
</pre></div>

<p>Now to rework the original "eval" function into a "parse" function, change all
the methods that return <code>double</code>s, so instead they return an instance of that
interface. Java 8's lambda syntax works well for this. Example of one of the
changed methods:</p>
<div class="code"><pre class="code literal-block"><span class="w">      </span><span class="n">Expression</span><span class="w"> </span><span class="n">parseExpression</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">Expression</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseTerm</span><span class="p">();</span>
<span class="w">      </span><span class="n">for</span><span class="w"> </span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">eat</span><span class="p">(</span><span class="s">'+'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// addition</span>
<span class="w">              </span><span class="n">Expression</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseTerm</span><span class="p">();</span>
<span class="w">              </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">eval</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">eval</span><span class="p">());</span>
<span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">eat</span><span class="p">(</span><span class="s">'-'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// subtraction</span>
<span class="w">              </span><span class="n">Expression</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseTerm</span><span class="p">();</span>
<span class="w">              </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">eval</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">eval</span><span class="p">());</span>
<span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="n">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="kr">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>

<p>That builds a recursive tree of <code>Expression</code> objects representing the compiled
expression (an abstract syntax tree). Then you can compile it once and
evaluate it repeatedly with different values:</p>
<div class="code"><pre class="code literal-block"><span class="w">      </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="nb nb-Type">String</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">Map</span><span class="o">&lt;</span><span class="nb nb-Type">String</span><span class="p">,</span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">      </span><span class="n">Expression</span><span class="w"> </span><span class="nb">exp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse</span><span class="p">(</span><span class="s2">"x^2 - x + 2"</span><span class="p">,</span><span class="w"> </span><span class="n">variables</span><span class="p">);</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">double</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">20</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="o">+</span><span class="mi">20</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">variables</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">          </span><span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">" =&gt; "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">exp</span><span class="o">.</span><span class="n">eval</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>

<ul>
<li><strong>Different datatypes:</strong></li>
</ul>
<p>Instead of <code>double</code>, you could change the evaluator to use something more
powerful like <code>BigDecimal</code>, or a class that implements complex numbers, or
rational numbers (fractions). You could even use <code>Object</code>, allowing some mix
of datatypes in expressions, just like a real programming language. :)</p>
<hr>
<p>All code in this answer released to the public domain. Have fun!</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/uilongpressgesturerecognizer-gets-called-twice-when-pressing-down/" class="u-url">UILongPressGestureRecognizer gets called twice when pressing down</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/uilongpressgesturerecognizer-gets-called-twice-when-pressing-down/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T12:33:38+08:00" itemprop="datePublished" title="2023-03-04 12:33">2023-03-04 12:33</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am detecting if the user has pressed down for 2 seconds:</p>
<div class="code"><pre class="code literal-block"><span class="bp">UILongPressGestureRecognizer</span><span class="w"> </span><span class="o">*</span><span class="n">longPress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">UILongPressGestureRecognizer</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span>
<span class="w">                                             </span><span class="nl">initWithTarget</span><span class="p">:</span><span class="nb">self</span><span class="w"> </span>
<span class="w">                                             </span><span class="nl">action</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">handleLongPress</span><span class="o">:</span><span class="p">)];</span>
<span class="w">        </span><span class="n">longPress</span><span class="p">.</span><span class="n">minimumPressDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span>
<span class="w">        </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">addGestureRecognizer</span><span class="o">:</span><span class="n">longPress</span><span class="p">];</span>
<span class="w">        </span><span class="p">[</span><span class="n">longPress</span><span class="w"> </span><span class="k">release</span><span class="p">];</span>
</pre></div>

<p>This is how I handle the long press:</p>
<div class="code"><pre class="code literal-block"><span class="p">-(</span><span class="kt">void</span><span class="p">)</span><span class="nf">handleLongPress:</span><span class="p">(</span><span class="bp">UILongPressGestureRecognizer</span><span class="o">*</span><span class="p">)</span><span class="nv">recognizer</span><span class="p">{</span>
<span class="w">    </span><span class="n">NSLog</span><span class="p">(</span><span class="s">@"double oo"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>The text "double oo" gets printed twice when I press down for longer than 2
seconds. Why is this? How can I fix?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>UILongPressGestureRecognizer is a continuous event recognizer. You have to
look at the state to see if this is the start, middle or end of the event and
act accordingly. i.e. you can throw away all events after the start, or only
look at movement as you need. From the Class Reference:</p>
<blockquote>
<p>Long-press gestures are continuous. The gesture begins
(UIGestureRecognizerStateBegan) when the number of allowable fingers
(numberOfTouchesRequired) have been pressed for the specified period
(minimumPressDuration) and the touches do not move beyond the allowable
range of movement (allowableMovement). The gesture recognizer transitions to
the Change state whenever a finger moves, and it ends
(UIGestureRecognizerStateEnded) when any of the fingers are lifted.</p>
</blockquote>
<p>Now You Can Track The State Like This</p>
<div class="code"><pre class="code literal-block"><span class="p">-</span>  <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">handleLongPress:</span><span class="p">(</span><span class="bp">UILongPressGestureRecognizer</span><span class="o">*</span><span class="p">)</span><span class="nv">sender</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sender</span><span class="p">.</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UIGestureRecognizerStateEnded</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">NSLog</span><span class="p">(</span><span class="s">@"UIGestureRecognizerStateEnded"</span><span class="p">);</span>
<span class="w">    </span><span class="c1">//Do Whatever You want on End of Gesture</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sender</span><span class="p">.</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UIGestureRecognizerStateBegan</span><span class="p">){</span>
<span class="w">       </span><span class="n">NSLog</span><span class="p">(</span><span class="s">@"UIGestureRecognizerStateBegan."</span><span class="p">);</span>
<span class="w">   </span><span class="c1">//Do Whatever You want on Began of Gesture</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>To check the state of the UILongPressGestureRecognizer just add an if
statement on the selector method:</p>
<div class="code"><pre class="code literal-block"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">handleLongPress:</span><span class="p">(</span><span class="bp">UILongPressGestureRecognizer</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">sender</span><span class="w"> </span><span class="p">{</span><span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sender</span><span class="p">.</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UIGestureRecognizerStateEnded</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NSLog</span><span class="p">(</span><span class="s">@"Long press Ended"</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sender</span><span class="p">.</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UIGestureRecognizerStateBegan</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NSLog</span><span class="p">(</span><span class="s">@"Long press detected."</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/nginx-default-public-www-location/" class="u-url">NGinx Default public www location?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/nginx-default-public-www-location/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T12:32:12+08:00" itemprop="datePublished" title="2023-03-04 12:32">2023-03-04 12:32</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have worked with Apache before, so I am aware that the default public web
root is typically <code>/var/www/</code>.</p>
<p>I recently started working with nginx, but I can't seem to find the default
public web root.</p>
<p>Where can I find the default public web root for nginx?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>If your configuration does not include a <code>root /some/absolute/path;</code>
statement, or it includes one that uses a relative path like <code>root
some/relative/path;</code>, then the resulting path depends on compile-time options.</p>
<p>Probably the only case that would allow you to make an educated guess as to
what this means for you would be, if you downloaded and compiled the source
yourself. In that case, the paths would be relative to whatever <code>--prefix</code> was
used. If you didn't change it, it defaults to <code>/usr/local/nginx</code>. You can find
the parameters nginx was compiled with via <code>nginx -V</code>, it lists <code>--prefix</code> as
the first one.</p>
<p>Since the <code>root</code> directive defaults to <code>html</code>, this would, of course, result
in <code>/usr/local/nginx/html</code> being the answer to your question.</p>
<p>However, if you installed nginx in any other way, all bets are off. Your
distribution might use entirely different default paths. Learning to figure
out what kind of defaults your distribution of choice uses for things is
another task entirely.</p>
<p><br></p>
<h3>Suggest</h3>
<p>If your configuration does not include a <code>root /some/absolute/path;</code>
statement, or it includes one that uses a relative path like <code>root
some/relative/path;</code>, then the resulting path depends on compile-time options.</p>
<p>Probably the only case that would allow you to make an educated guess as to
what this means for you would be, if you downloaded and compiled the source
yourself. In that case, the paths would be relative to whatever <code>--prefix</code> was
used. If you didn't change it, it defaults to <code>/usr/local/nginx</code>. You can find
the parameters nginx was compiled with via <code>nginx -V</code>, it lists <code>--prefix</code> as
the first one.</p>
<p>Since the <code>root</code> directive defaults to <code>html</code>, this would, of course, result
in <code>/usr/local/nginx/html</code> being the answer to your question.</p>
<p>However, if you installed nginx in any other way, all bets are off. Your
distribution might use entirely different default paths. Learning to figure
out what kind of defaults your distribution of choice uses for things is
another task entirely.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2391.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2389.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
