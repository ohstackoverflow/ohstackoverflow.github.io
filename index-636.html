<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 636) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-636.html">
<link rel="prev" href="index-637.html" type="text/html">
<link rel="next" href="index-635.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-exactly-do-u-and-r-string-prefixes-do-and-what-are-raw-string-literals/" class="u-url">What exactly do "u" and "r" string prefixes do, and what are raw string literals?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-exactly-do-u-and-r-string-prefixes-do-and-what-are-raw-string-literals/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T11:58:16+08:00" itemprop="datePublished" title="2023-02-17 11:58">2023-02-17 11:58</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>While asking this question, I realized I didn't know much about raw strings.
For somebody claiming to be a Django trainer, this sucks.</p>
<p>I know what an encoding is, and I know what <code>u''</code> alone does since I get what
is Unicode.</p>
<ul>
<li>
<p>But what does <code>r''</code> do exactly? What kind of string does it result in?</p>
</li>
<li>
<p>And above all, what the heck does <code>ur''</code> do?</p>
</li>
<li>
<p>Finally, is there any reliable way to go back from a Unicode string to a simple raw string?</p>
</li>
<li>
<p>Ah, and by the way, if your system and your text editor charset are set to UTF-8, does <code>u''</code> actually do anything?</p>
</li>
</ul>
<p><br><br></p>
<h2>Answer</h2>
<p>There's not really any "raw <em>string</em> "; there are raw <em>string literals</em> ,
which are exactly the string literals marked by an <code>'r'</code> before the opening
quote.</p>
<p>A "raw string literal" is a slightly different syntax for a string literal, in
which a backslash, <code>\</code>, is taken as meaning "just a backslash" (except when it
comes right before a quote that would otherwise terminate the literal) -- no
"escape sequences" to represent newlines, tabs, backspaces, form-feeds, and so
on. In normal string literals, each backslash must be doubled up to avoid
being taken as the start of an escape sequence.</p>
<p>This syntax variant exists mostly because the syntax of regular expression
patterns is heavy with backslashes (but never at the end, so the "except"
clause above doesn't matter) and it looks a bit better when you avoid doubling
up each of them -- that's all. It also gained some popularity to express
native Windows file paths (with backslashes instead of regular slashes like on
other platforms), but that's very rarely needed (since normal slashes mostly
work fine on Windows too) and imperfect (due to the "except" clause above).</p>
<p><code>r'...'</code> is a byte string (in Python 2.<em>), <code>ur'...'</code> is a Unicode string
(again, in Python 2.</em>), and any of the other three kinds of quoting also
produces exactly the same types of strings (so for example <code>r'...'</code>,
<code>r'''...'''</code>, <code>r"..."</code>, <code>r"""..."""</code> are all byte strings, and so on).</p>
<p>Not sure what you mean by "going <em>back</em> " - there is no intrinsically back and
forward directions, because there's no raw string <strong>type</strong> , it's just an
alternative syntax to express perfectly normal string objects, byte or unicode
as they may be.</p>
<p>And yes, in Python 2.<em>, <code>u'...'</code> </em><em>is</em>* of course always distinct from just
<code>'...'</code> -- the former is a unicode string, the latter is a byte string. What
encoding the literal might be expressed in is a completely orthogonal issue.</p>
<p>E.g., consider (Python 2.6):</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; sys.getsizeof('ciao')
28
&gt;&gt;&gt; sys.getsizeof(u'ciao')
34
</pre></div>

<p>The Unicode object of course takes more memory space (very small difference
for a very short string, obviously ;-).</p>
<p><br></p>
<h3>Suggest</h3>
<p>There are two types of string in Python 2: the traditional <code>str</code> type and the
newer <code>unicode</code> type. If you type a string literal without the <code>u</code> in front
you get the old <code>str</code> type which stores 8-bit characters, and with the <code>u</code> in
front you get the newer <code>unicode</code> type that can store any Unicode character.</p>
<p>The <code>r</code> doesn't change the type at all, it just changes how the string literal
is interpreted. Without the <code>r</code>, backslashes are treated as escape characters.
With the <code>r</code>, backslashes are treated as literal. Either way, the type is the
same.</p>
<p><code>ur</code> is of course a Unicode string where backslashes are literal backslashes,
not part of escape codes.</p>
<p>You can try to convert a Unicode string to an old string using the <code>str()</code>
function, but if there are any unicode characters that cannot be represented
in the old string, you will get an exception. You could replace them with
question marks first if you wish, but of course this would cause those
characters to be unreadable. It is not recommended to use the <code>str</code> type if
you want to correctly handle unicode characters.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-do-a-full-outer-join-in-mysql/" class="u-url">How can I do a FULL OUTER JOIN in MySQL?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-do-a-full-outer-join-in-mysql/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T11:57:49+08:00" itemprop="datePublished" title="2023-02-17 11:57">2023-02-17 11:57</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to do a <em>full outer join</em> in MySQL. Is this possible? Is a <em>full outer
join</em> supported by MySQL?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You don't have <em>full joins</em> in MySQL, but you can sure emulate them.</p>
<p>For a code <em>sample</em> transcribed from this Stack Overflow question you have:</p>
<p>With two tables t1, t2:</p>
<div class="code"><pre class="code literal-block">SELECT * FROM t1
LEFT JOIN t2 ON t1.id = t2.id
UNION
SELECT * FROM t1
RIGHT JOIN t2 ON t1.id = t2.id
</pre></div>

<hr>
<p>The query above works for special cases where a <em>full outer join</em> operation
would not produce any duplicate rows. The query above depends on the <code>UNION</code>
set operator to remove duplicate rows introduced by the query pattern. We can
avoid introducing duplicate rows by using an <em>anti-join</em> pattern for the
second query, and then use a UNION ALL set operator to combine the two sets.
In the more general case, where a full outer join would return duplicate rows,
we can do this:</p>
<div class="code"><pre class="code literal-block">SELECT * FROM t1
LEFT JOIN t2 ON t1.id = t2.id
UNION ALL
SELECT * FROM t1
RIGHT JOIN t2 ON t1.id = t2.id
WHERE t1.id IS NULL
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>The answer that Pablo Santa Cruz gave is correct; however, in case anybody
stumbled on this page and wants more clarification, here is a detailed
breakdown.</p>
<h3>Example Tables</h3>
<p>Suppose we have the following tables:</p>
<div class="code"><pre class="code literal-block">-- t1
id  name
1   Tim
2   Marta

-- t2
id  name
1   Tim
3   Katarina
</pre></div>

<h3>Inner Joins</h3>
<p>An inner join, like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n n-Quoted">`t1`</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n n-Quoted">`t1`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="p">;</span>
</pre></div>

<p>Would get us only records that appear in both tables, like this:</p>
<div class="code"><pre class="code literal-block"><span class="mf">1</span><span class="w"> </span><span class="n">Tim</span><span class="w">  </span><span class="mf">1</span><span class="w"> </span><span class="n">Tim</span>
</pre></div>

<p>Inner joins don't have a direction (like left or right) because they are
explicitly bidirectional - we require a match on both sides.</p>
<h3>Outer Joins</h3>
<p>Outer joins, on the other hand, are for finding records that may not have a
match in the other table. As such, you have to specify <strong>which side</strong> of the
join is allowed to have a missing record.</p>
<p><code>LEFT JOIN</code> and <code>RIGHT JOIN</code> are shorthand for <code>LEFT OUTER JOIN</code> and <code>RIGHT
OUTER JOIN</code>; I will use their full names below to reinforce the concept of
outer joins vs inner joins.</p>
<h4>Left Outer Join</h4>
<p>A left outer join, like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n n-Quoted">`t1`</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n n-Quoted">`t1`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="p">;</span>
</pre></div>

<p>...would get us all the records from the left table regardless of whether or
not they have a match in the right table, like this:</p>
<div class="code"><pre class="code literal-block"><span class="mf">1</span><span class="w"> </span><span class="n">Tim</span><span class="w">   </span><span class="mf">1</span><span class="w">    </span><span class="n">Tim</span>
<span class="mf">2</span><span class="w"> </span><span class="n">Marta</span><span class="w"> </span><span class="n">NULL</span><span class="w"> </span><span class="n">NULL</span>
</pre></div>

<h4>Right Outer Join</h4>
<p>A right outer join, like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n n-Quoted">`t1`</span>
<span class="k">RIGHT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n n-Quoted">`t1`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="p">;</span>
</pre></div>

<p>...would get us all the records from the right table regardless of whether or
not they have a match in the left table, like this:</p>
<div class="code"><pre class="code literal-block"><span class="mf">1</span><span class="w">    </span><span class="n">Tim</span><span class="w">   </span><span class="mf">1</span><span class="w">  </span><span class="n">Tim</span>
<span class="n">NULL</span><span class="w"> </span><span class="n">NULL</span><span class="w">  </span><span class="mf">3</span><span class="w">  </span><span class="n">Katarina</span>
</pre></div>

<h4>Full Outer Join</h4>
<p>A full outer join would give us all records from both tables, whether or not
they have a match in the other table, with NULLs on both sides where there is
no match. The result would look like this:</p>
<div class="code"><pre class="code literal-block"><span class="mf">1</span><span class="w">    </span><span class="n">Tim</span><span class="w">   </span><span class="mf">1</span><span class="w">    </span><span class="n">Tim</span>
<span class="mf">2</span><span class="w">    </span><span class="n">Marta</span><span class="w"> </span><span class="n">NULL</span><span class="w"> </span><span class="n">NULL</span>
<span class="n">NULL</span><span class="w"> </span><span class="n">NULL</span><span class="w">  </span><span class="mf">3</span><span class="w">    </span><span class="n">Katarina</span>
</pre></div>

<p>However, as Pablo Santa Cruz pointed out, MySQL doesn't support this. We can
emulate it by doing a UNION of a left join and a right join, like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n n-Quoted">`t1`</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n n-Quoted">`t1`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="p">.</span><span class="n n-Quoted">`id`</span>

<span class="k">UNION</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n n-Quoted">`t1`</span>
<span class="k">RIGHT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n n-Quoted">`t1`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="p">;</span>
</pre></div>

<p>You can think of a <code>UNION</code> as meaning "run both of these queries, then stack
the results on top of each other"; some of the rows will come from the first
query and some from the second.</p>
<p>It should be noted that a <code>UNION</code> in MySQL will eliminate exact duplicates:
Tim would appear in both of the queries here, but the result of the <code>UNION</code>
only lists him once. My database guru colleague feels that this behavior
should not be relied upon. So to be more explicit about it, we could add a
<code>WHERE</code> clause to the second query:</p>
<div class="code"><pre class="code literal-block"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n n-Quoted">`t1`</span>
<span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n n-Quoted">`t1`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="p">.</span><span class="n n-Quoted">`id`</span>

<span class="k">UNION</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span>
<span class="k">FROM</span><span class="w"> </span><span class="n n-Quoted">`t1`</span>
<span class="k">RIGHT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n n-Quoted">`t1`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n n-Quoted">`t2`</span><span class="p">.</span><span class="n n-Quoted">`id`</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n n-Quoted">`t1`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="no">NULL</span><span class="p">;</span>
</pre></div>

<p>On the other hand, if you <strong>wanted</strong> to see duplicates for some reason, you
could use <code>UNION ALL</code>.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/random-number-generator-only-generating-one-random-number/" class="u-url">Random number generator only generating one random number</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/random-number-generator-only-generating-one-random-number/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T11:57:01+08:00" itemprop="datePublished" title="2023-02-17 11:57">2023-02-17 11:57</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have the following function:</p>
<div class="code"><pre class="code literal-block"><span class="c1">//Function to get random number</span>
<span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">RandomNumber</span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="nb">min</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="nb">max</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Random</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Random</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">random</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="w"> </span><span class="nb">max</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>How I call it:</p>
<div class="code"><pre class="code literal-block"><span class="n">byte</span><span class="err">[]</span><span class="w"> </span><span class="n">mac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">byte</span><span class="o">[</span><span class="n">6</span><span class="o">]</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">x</span><span class="p">)</span>
<span class="w">    </span><span class="n">mac</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">byte</span><span class="p">)(</span><span class="n">Misc</span><span class="p">.</span><span class="n">RandomNumber</span><span class="p">((</span><span class="nc">int</span><span class="p">)</span><span class="mh">0xFFFF</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nc">int</span><span class="p">)</span><span class="mh">0xFFFFFF</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">256</span><span class="p">);</span>
</pre></div>

<p>If I step that loop with the debugger during runtime I get different values
(which is what I want). However, if I put a breakpoint two lines below that
code, all members of the <code>mac</code> array have equal value.</p>
<p>Why does that happen?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Every time you do <code>new Random()</code> it is initialized using the clock. This means
that in a tight loop you get the same value lots of times. You should keep a
single Random instance and keep using Next on the <strong>same</strong> instance.</p>
<div class="code"><pre class="code literal-block"><span class="c1">//Function to get a random number </span>
<span class="n">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">readonly</span><span class="w"> </span><span class="n">Random</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Random</span><span class="p">();</span><span class="w"> </span>
<span class="n">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">readonly</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">syncLock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">object</span><span class="p">();</span><span class="w"> </span>
<span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">RandomNumber</span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="nb">min</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="nb">max</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">lock</span><span class="p">(</span><span class="n">syncLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// synchronize</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">random</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="w"> </span><span class="nb">max</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<hr>
<p>Edit (see comments): why do we need a <code>lock</code> here?</p>
<p>Basically, <code>Next</code> is going to change the internal state of the <code>Random</code>
instance. If we do that at the same time from multiple threads, you <em>could</em>
argue "we've just made the outcome even more random", but what we are
<em>actually</em> doing is potentially breaking the internal implementation, and we
could also start getting the same numbers from different threads, which
<em>might</em> be a problem - and might not. The guarantee of what happens internally
is the bigger issue, though; since <code>Random</code> does <strong>not</strong> make any guarantees
of thread-safety. Thus there are two valid approaches:</p>
<ul>
<li>Synchronize so that we don't access it at the same time from different threads</li>
<li>Use different <code>Random</code> instances per thread</li>
</ul>
<p>Either can be fine; but mutexing a <strong>single</strong> instance from multiple callers
at the same time is just asking for trouble.</p>
<p>The <code>lock</code> achieves the first (and simpler) of these approaches; however,
another approach might be:</p>
<div class="code"><pre class="code literal-block"><span class="nv">private</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">readonly</span><span class="w"> </span><span class="nv">ThreadLocal</span><span class="o">&lt;</span><span class="k">Random</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">appRandom</span>
<span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ThreadLocal</span><span class="o">&lt;</span><span class="k">Random</span><span class="o">&gt;</span><span class="ss">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="k">Random</span><span class="ss">())</span><span class="c1">;</span>
</pre></div>

<p>this is then per-thread, so you don't need to synchronize.</p>
<p><br></p>
<h3>Suggest</h3>
<p>For ease of re-use throughout your application a static class may help.</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">StaticRandom</span>
{
<span class="w">    </span><span class="nv">private</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">int</span><span class="w"> </span><span class="nv">seed</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">private</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">ThreadLocal</span><span class="o">&lt;</span><span class="k">Random</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">threadLocal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ThreadLocal</span><span class="o">&lt;</span><span class="k">Random</span><span class="o">&gt;</span>
<span class="w">        </span><span class="ss">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="k">Random</span><span class="ss">(</span><span class="nv">Interlocked</span>.<span class="nv">Increment</span><span class="ss">(</span><span class="nv">ref</span><span class="w"> </span><span class="nv">seed</span><span class="ss">)))</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">static</span><span class="w"> </span><span class="nv">StaticRandom</span><span class="ss">()</span>
<span class="w">    </span>{
<span class="w">        </span><span class="nv">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Environment</span>.<span class="nv">TickCount</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="k">Random</span><span class="w"> </span><span class="nv">Instance</span><span class="w"> </span>{<span class="w"> </span><span class="nv">get</span><span class="w"> </span>{<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">threadLocal</span>.<span class="nv">Value</span><span class="c1">; } }</span>
}
</pre></div>

<p>You can use then use static random instance with code such as</p>
<div class="code"><pre class="code literal-block"><span class="nv">StaticRandom</span>.<span class="nv">Instance</span>.<span class="k">Next</span><span class="ss">(</span><span class="mi">1</span>,<span class="w"> </span><span class="mi">100</span><span class="ss">)</span><span class="c1">;</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-637.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-635.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
