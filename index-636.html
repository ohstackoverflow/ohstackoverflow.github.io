<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 636) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-636.html">
<link rel="prev" href="index-637.html" type="text/html">
<link rel="next" href="index-635.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jin-yong-only-full-group-by/" class="u-url">禁用 ONLY_FULL_GROUP_BY</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/jin-yong-only-full-group-by/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T12:05:44+08:00" itemprop="datePublished" title="2023-02-17 12:05">2023-02-17 12:05</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我不小心启用了 ONLY_FULL_GROUP_BY 模式，如下所示：</p>
<div class="code"><pre class="code literal-block">SET sql_mode = 'ONLY_FULL_GROUP_BY';
</pre></div>

<p>我该如何禁用它？</p>
<p><br><br></p>
<h2>解答</h2>
<p><strong>解决方案 1：</strong> 从 mysql 控制台删除 <strong>ONLY_FULL_GROUP_BY</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">mysql</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">sql_mode</span><span class="o">=</span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">REPLACE</span><span class="p">(</span><span class="nb">@@sql_mode</span><span class="p">,</span><span class="s1">'ONLY_FULL_GROUP_BY'</span><span class="p">,</span><span class="s1">''</span><span class="p">));</span>
</pre></div>

<p>你可以在这里阅读更多</p>
<p><strong>解决方案 2：</strong> 从 phpmyadmin 中删除 <strong>ONLY_FULL_GROUP_BY</strong></p>
<ul>
<li>打开 phpmyadmin 并选择本地主机</li>
<li>单击菜单变量并向下滚动到 sql 模式</li>
<li>单击编辑按钮更改值并删除 <strong>ONLY_FULL_GROUP_BY</strong> 并单击保存。<img alt="在此处输入图像描述" src="images/5CQdo.png">
</li>
</ul>
<p><br></p>
<h3>更多建议</h3>
<h3><strong>更新：</strong></h3>
<p><img alt="在此处输入图像描述" src="images/DToeZ.png"></p>
<p>要保留您当前的 mysql 设置并禁用<code>ONLY_FULL_GROUP_BY</code>我建议访问您的 phpmyadmin 或您正在使用的任何客户端并键入：</p>
<p><code>SELECT REPLACE(@@sql_mode,'ONLY_FULL_GROUP_BY','') copy_me</code></p>
<p>下一步将结果复制到您的<code>my.ini</code>文件。</p>
<p><strong>薄荷</strong> ：<code>sudo nano /etc/mysql/my.cnf</code></p>
<p><strong>Ubuntu 16 及更高版本</strong> ：<code>sudo nano /etc/mysql/my.cnf</code></p>
<p><strong>Ubuntu 14-16</strong> ：<code>/etc/mysql/mysql.conf.d/mysqld.cnf</code></p>
<h3>警告！<code>copy_me</code>结果可以包含一个长文本，默认情况下可能会被修剪。确保复制整个文本！</h3>
<hr>
<p><strong>旧答案：</strong></p>
<p>如果要 <strong>永久</strong> 禁用错误“ <em>SELECT 列表的表达式#N 不在 GROUP BY
子句中并且包含非聚合列‘db.table.COL’，它在功能上不依赖于 GROUP BY 子句中的列；这与
sql_mode=only_full_group_by 不兼容</em> " 执行这些步骤：</p>
<ol>
<li><code>sudo nano /etc/mysql/my.cnf</code></li>
<li>
<p>将此添加到文件末尾</p>
<div class="code"><pre class="code literal-block"><span class="o">[</span><span class="n">mysqld</span><span class="o">]</span>
</pre></div>

<p>sql_mode = "STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION"</p>
</li>
<li>
<p><code>sudo service mysql restart</code>重启MySQL</p>
</li>
</ol>
<p>这将为<code>ONLY_FULL_GROUP_BY</code>所有 <strong>用户</strong> 禁用</p>
<p><br><br><a href="posts/disable-only-full-group-by/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ru-he-xiu-fu-php-zhong-de-biao-tou-yi-fa-song-cuo-wu/" class="u-url">如何修复 PHP 中的“标头已发送”错误</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ru-he-xiu-fu-php-zhong-de-biao-tou-yi-fa-song-cuo-wu/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T12:05:11+08:00" itemprop="datePublished" title="2023-02-17 12:05">2023-02-17 12:05</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><strong>这个问题的答案是 社区的努力</strong>。编辑现有答案以改进这篇文章。它目前不接受新的答案或互动。</p>
<p>运行我的脚本时，出现如下几个错误：</p>
<blockquote>
<p><strong>警告：无法修改标头信息 -第 23 行</strong> /some/file.php <strong>中</strong> 的标头已发送（ <strong>输出开始于
/some/file.php:12</strong> ） <strong><em>* </em></strong>*</p>
</blockquote>
<p>错误消息中提到的行包含<code>header()</code>和<code>setcookie()</code>调用。</p>
<p>这可能是什么原因？以及如何解决？</p>
<p><br><br></p>
<h2>解答</h2>
<h3>发送标题前没有输出！</h3>
<p><em><strong>必须在进行任何输出之前</strong></em> 调用发送/修改 HTTP 标头的函数。<code>**summary ⇊**</code> 否则调用失败：</p>
<blockquote>
<p>警告：无法修改标头信息 - 标头已发送（输出从 <em>script:line</em> 开始）</p>
</blockquote>
<p>一些修改 HTTP 标头的函数是：</p>
<ul>
<li>
<code>header</code>/<code>header_remove</code>
</li>
<li>
<code>session_start</code>/<code>session_regenerate_id</code>
</li>
<li>
<code>setcookie</code>/<code>setrawcookie</code>
</li>
</ul>
<p>输出可以是：</p>
<ul>
<li>
<p><em>无意的：</em></p>
<ul>
<li>
<code>&lt;?php</code>之前或之后的空格<code>?&gt;</code>
</li>
<li>UTF -8 字节顺序标记具体</li>
<li>以前的错误消息或通知</li>
</ul>
</li>
<li>
<p><em>故意的：</em></p>
<ul>
<li>
<code>print</code>，<code>echo</code>以及其他产生输出的函数</li>
<li>原始<code>&lt;html&gt;</code>部分优先于<code>&lt;?php</code>代码。</li>
</ul>
</li>
</ul>
<h3>为什么会这样？</h3>
<p>要理解为什么必须在输出之前发送标头，有必要查看典型的HTTP响应。PHP 脚本主要生成 HTML 内容，但也会将一组 HTTP/CGI
标头传递给网络服务器：</p>
<div class="code"><pre class="code literal-block">HTTP/1.1<span class="w"> </span>200<span class="w"> </span>OK
Powered-By:<span class="w"> </span>PHP/5.3.7
Vary:<span class="w"> </span>Accept-Encoding
Content-Type:<span class="w"> </span>text/html;<span class="w"> </span>charset=utf-8

<span class="nt">&lt;html&gt;&lt;head&gt;&lt;title&gt;</span>PHP<span class="w"> </span>page<span class="w"> </span>output<span class="w"> </span>page<span class="nt">&lt;/title&gt;&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;&lt;h1&gt;</span>Content<span class="nt">&lt;/h1&gt;</span><span class="w"> </span><span class="nt">&lt;p&gt;</span>Some<span class="w"> </span>more<span class="w"> </span>output<span class="w"> </span>follows...<span class="nt">&lt;/p&gt;</span>
and<span class="w"> </span><span class="nt">&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"/"</span><span class="nt">&gt;</span><span class="w"> </span><span class="nt">&lt;img</span><span class="w"> </span><span class="na">src=</span><span class="s">internal-icon-delayed</span><span class="nt">&gt;</span><span class="w"> </span><span class="nt">&lt;/a&gt;</span>
</pre></div>

<p>页面/输出始终 <em>跟在</em> 标题之后。PHP 必须首先将标头传递给网络服务器。它只能这样做一次。在双换行之后，它再也不能修改它们了。</p>
<p>当 PHP 收到第一个输出 ( <code>print</code>, <code>echo</code>, <code>&lt;html&gt;</code>) 时，它将 <em>刷新</em>
所有收集的标头。之后它可以发送它想要的所有输出。但是发送更多的 HTTP 标头是不可能的。</p>
<h3>您如何找出过早输出发生的位置？</h3>
<p>警告<code>header()</code>包含所有相关信息以定位问题原因：</p>
<blockquote>
<p><strong>警告：无法修改标头信息</strong> - 标头已发送 _ <strong>（输出从</strong>_ /www/usr2345/htdocs/auth.php:52开始）在
/www/usr2345/htdocs/index.php 第 100 行 ****</p>
</blockquote>
<p><code>header()</code> <em>这里“第 100 行”是指调用</em> 失败的脚本。</p>
<p>括号内的“ <em>输出开始于”注释更重要。</em> 它指定了先前输出的来源。在这个例子中，它是<code>auth.php</code>和
<strong>线<code>52</code></strong>。这就是您必须寻找过早输出的地方。</p>
<p><em>典型原因：</em></p>
<ol>
<li>
<h4>打印、回显</h4>
</li>
</ol>
<p><code>print</code>和语句的故意输出<code>echo</code>将终止发送 HTTP
标头的机会。必须重组应用程序流程以避免这种情况。使用函数和模板方案。确保<code>header()</code>调用发生在消息写出 <em>之前。</em></p>
<p>产生输出的函数包括</p>
<div class="code"><pre class="code literal-block"><span class="o">*</span><span class="w"> </span><span class="n n-Quoted">`print`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`echo`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`printf`</span><span class="p">,</span><span class="n n-Quoted">`vprintf`</span>
<span class="o">*</span><span class="w"> </span><span class="n n-Quoted">`trigger_error`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`ob_flush`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`ob_end_flush`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`var_dump`</span><span class="p">,</span><span class="n n-Quoted">`print_r`</span>
<span class="o">*</span><span class="w"> </span><span class="n n-Quoted">`readfile`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`passthru`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`flush`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`imagepng`</span><span class="p">,</span><span class="n n-Quoted">`imagejpeg`</span>
</pre></div>

<p>等等和用户定义的函数。</p>
<ol>
<li>
<h4>原始 HTML 区域</h4>
</li>
</ol>
<p>文件中未解析的 HTML 部分<code>.php</code>也是直接输出。将触发调用的脚本条件必须在 <em>任何</em> 原始块<code>header()</code>之前注明。 __<code>&lt;html&gt;</code></p>
<div class="code"><pre class="code literal-block">    <span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="cp">&lt;?php</span>
    <span class="c1">// Too late for headers already.</span>
</pre></div>

<p>使用模板方案将处理与输出逻辑分开。</p>
<div class="code"><pre class="code literal-block">* 将表单处理代码置于脚本之上。
* 使用临时字符串变量来延迟消息。
* 实际的输出逻辑和混合的 HTML 输出应该放在最后。
</pre></div>

<ol>
<li>
<h4>
<code>&lt;?php</code>“script.php <strong>line 1</strong> ”警告前的空格</h4>
</li>
</ol>
<p>如果警告涉及 output inline <strong><code>1</code></strong> ，那么它主要是在开始标记之前的前导 <strong>空白</strong><code>&lt;?php</code>、文本或 HTML 。</p>
<div class="code"><pre class="code literal-block"><span class="w">     </span><span class="cp">&lt;?php</span>
<span class="c1"># There's a SINGLE space/newline before &lt;? - Which already seals it.</span>
</pre></div>

<p>类似地，它可能发生在附加脚本或脚本部分：</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="o">?&gt;</span>

<span class="cp">&lt;?php</span>
</pre></div>

<p>PHP 实际上在关闭标签后占用了一个 <em>换行符</em> 。但它不会补偿多个换行符或制表符或空格转移到这样的差距。</p>
<ol>
<li>
<h4>UTF-8 物料清单</h4>
</li>
</ol>
<p>单独的换行符和空格可能是个问题。但也有可能导致这种情况的“不可见”字符序列。最著名的是大多数文本编辑器都不显示的 <strong>UTF-8 BOM</strong>
（字节顺序标记） 。它是 byte sequence <code>EF BB BF</code>，对于 UTF-8 编码的文档来说是可选的和冗余的。然而，PHP
必须将其视为原始输出。它可能显示为<code>ï»¿</code>输出中的字符（如果客户端将文档解释为 Latin-1）或类似的“垃圾”。</p>
<p>特别是图形编辑器和基于 Java 的 IDE 不会注意到它的存在。他们没有将其可视化（Unicode
标准强制要求）。然而，大多数程序员和控制台编辑器都这样做：</p>
<p><img alt="joes 编辑器显示 UTF-8 BOM 占位符，MC 编辑器显示一个点" src="images/aXgWY.png"></p>
<p>There it's easy to recognize the problem early on. Other editors may identify
its presence in a file/settings menu (Notepad++ on Windows can identify and
remedy the problem), Another option to inspect the BOMs presence is resorting
to an <strong>hexeditor</strong>. On *nix systems <code>hexdump</code> is usually available, if not a
graphical variant which simplifies auditing these and other issues:</p>
<p><img alt="beav hexeditor 显示 utf-8 bom" src="images/QyqUr.png"></p>
<p>An easy fix is to set the text editor to save files as "UTF-8 (no BOM)" or
similar to such nomenclature. Often newcomers otherwise resort to creating new
files and just copy&amp;pasting the previous code back in.</p>
<h4>Correction utilities <img alt="" src="images/wnAS9.gif">
</h4>
<p>There are also automated tools to examine and rewrite text files (<code>sed</code>/<code>awk</code>
or <code>recode</code>). For PHP specifically there's the <code>phptags</code> tag tidier. It
rewrites close and open tags into long and short forms, but also easily fixes
leading and trailing whitespace, Unicode and UTF-x BOM issues:</p>
<div class="code"><pre class="code literal-block">    phptags  --whitespace  *.php
</pre></div>

<p>It's safe to use on a whole include or project directory.</p>
<ol>
<li>
<h4>Whitespace after <code>?&gt;</code>
</h4>
</li>
</ol>
<p>If the error source is mentioned as behind the closing <code>?&gt;</code> then this is where
some whitespace or the raw text got written out. The PHP end marker does not
terminate script execution at this point. Any text/space characters after it
will be written out as page content still.</p>
<p>It's commonly advised, in particular to newcomers, that trailing <code>?&gt;</code> PHP
close tags should be omitted. This <em>eschews</em> a small portion of these cases.
(Quite commonly <code>include()d</code> scripts are the culprit.)</p>
<ol>
<li>
<h4>Error source mentioned as "Unknown on line 0"</h4>
</li>
</ol>
<p>It's typically a PHP extension or php.ini setting if no error source is
concretized.</p>
<div class="code"><pre class="code literal-block"><span class="o">*</span><span class="w"> </span><span class="n">It</span><span class="s1">'s occasionally the `gzip` stream encoding setting or the `ob_gzhandler`.</span>
<span class="s1">* But it could also be any doubly loaded `extension=` module generating an implicit PHP startup/warning message.</span>
</pre></div>

<ol>
<li>
<h4>Preceding error messages</h4>
</li>
</ol>
<p>If another PHP statement or expression causes a warning message or notice
being printed out, that also counts as premature output.</p>
<p>In this case you need to eschew the error, delay the statement execution, or
suppress the message with e.g. <code>isset()</code> or <code>@()</code> - when either doesn't
obstruct debugging later on.</p>
<h3>No error message</h3>
<p>If you have <code>error_reporting</code> or <code>display_errors</code> disabled per <code>php.ini</code>, then
no warning will show up. But ignoring errors won't make the problem go away.
Headers still can't be sent after premature output.</p>
<p>So when <code>header("Location: ...")</code> redirects silently fail it's very advisable
to probe for warnings. Reenable them with two simple commands atop the
invocation script:</p>
<div class="code"><pre class="code literal-block">error_reporting(E_ALL);
ini_set("display_errors", 1);
</pre></div>

<p>Or <code>set_error_handler("var_dump");</code> if all else fails.</p>
<p>Speaking of redirect headers, you should often use an idiom like this for
final code paths:</p>
<div class="code"><pre class="code literal-block"><span class="nt">exit</span><span class="o">(</span><span class="nt">header</span><span class="o">(</span><span class="s2">"Location: /finished.html"</span><span class="o">));</span>
</pre></div>

<p>Preferably even a utility function, which prints a user message in case of
<code>header()</code> failures.</p>
<h3>Output buffering as a workaround</h3>
<p>PHPs output buffering is a workaround to alleviate this issue. It often works
reliably, but shouldn't substitute for proper application structuring and
separating output from control logic. Its actual purpose is minimizing chunked
transfers to the webserver.</p>
<ol>
<li>
<p>The <code>output_buffering=</code> setting nevertheless can help. Configure it in the php.ini or via .htaccess or even .user.ini on modern FPM/FastCGI setups.<br>
Enabling it will allow PHP to buffer output instead of passing it to the
webserver instantly. PHP thus can aggregate HTTP headers.</p>
</li>
<li>
<p>It can likewise be engaged with a call to <code>ob_start();</code> atop the invocation script. Which however is less reliable for multiple reasons:</p>
<ul>
<li>
<p>Even if <code>&lt;?php ob_start(); ?&gt;</code> starts the first script, whitespace or a BOM might get shuffled before, rendering it ineffective.</p>
</li>
<li>
<p>It can conceal whitespace for HTML output. But as soon as the application logic attempts to send binary content (a generated image for example), the buffered extraneous output becomes a problem. (Necessitating <code>ob_clean()</code> as a further workaround.)</p>
</li>
<li>
<p>The buffer is limited in size, and can easily overrun when left to defaults. And that's not a rare occurrence either, difficult to track down when it happens.</p>
</li>
</ul>
</li>
</ol>
<p>Both approaches therefore may become unreliable - in particular when switching
between development setups and/or production servers. This is why output
buffering is widely considered just a crutch / strictly a workaround.</p>
<p>See also the basic usage example in the manual, and for more pros and cons:</p>
<ul>
<li>What is output buffering?</li>
<li>Why use output buffering in PHP?</li>
<li>Is using output buffering considered a bad practice?</li>
<li>Use case for output buffering as the correct solution to "headers already sent"</li>
</ul>
<h4>But it worked on the other server!?</h4>
<p>If you didn't get the headers warning before, then the output buffering
php.ini setting has changed. It's likely unconfigured on the current/new
server.</p>
<h3>Checking with <code>headers_sent()</code>
</h3>
<p>You can always use <code>headers_sent()</code> to probe if it's still possible to... send
headers. Which is useful to conditionally print info or apply other fallback
logic.</p>
<div class="code"><pre class="code literal-block"><span class="nt">if</span><span class="w"> </span><span class="o">(</span><span class="nt">headers_sent</span><span class="o">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">die("Redirect</span><span class="w"> </span><span class="err">failed.</span><span class="w"> </span><span class="err">Please</span><span class="w"> </span><span class="err">click</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="n">link</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">a</span><span class="w"> </span><span class="n">href</span><span class="o">=...&gt;</span><span class="s2">");</span>
<span class="s2">}</span>
<span class="s2">else{</span>
<span class="s2">    exit(header("</span><span class="n">Location</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">user</span><span class="o">.</span><span class="n">php</span><span class="err">"</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

<p>Useful fallback workarounds are:</p>
<ul>
<li>
<h4>HTML <code>&lt;meta&gt;</code> tag</h4>
</li>
</ul>
<p>If your application is structurally hard to fix, then an easy (but somewhat
unprofessional) way to allow redirects is injecting a HTML <code>&lt;meta&gt;</code> tag. A
redirect can be achieved with:</p>
<div class="code"><pre class="code literal-block">     &lt;meta http-equiv="Location" content="http://example.com/"&gt;
</pre></div>

<p>Or with a short delay:</p>
<div class="code"><pre class="code literal-block">     &lt;meta http-equiv="Refresh" content="2; url=../target.html"&gt;
</pre></div>

<p>This leads to non-valid HTML when utilized past the <code>&lt;head&gt;</code> section. Most
browsers still accept it.</p>
<ul>
<li>
<h4>JavaScript redirect</h4>
</li>
</ul>
<p>As alternative a JavaScript redirect can be used for page redirects:</p>
<div class="code"><pre class="code literal-block"><span class="w">     </span><span class="nt">&lt;script&gt;</span><span class="w"> </span>location.replace("target.html");<span class="w"> </span><span class="nt">&lt;/script&gt;</span>
</pre></div>

<p>While this is often more HTML compliant than the <code>&lt;meta&gt;</code> workaround, it
incurs a reliance on JavaScript-capable clients.</p>
<p>Both approaches however make acceptable fallbacks when genuine HTTP header()
calls fail. Ideally you'd always combine this with a user-friendly message and
clickable link as last resort. (Which for instance is what the http_redirect()
PECL extension does.)</p>
<h3>Why <code>setcookie()</code> and <code>session_start()</code> are also affected</h3>
<p>Both <code>setcookie()</code> and <code>session_start()</code> need to send a <code>Set-Cookie:</code> HTTP
header. The same conditions therefore apply, and similar error messages will
be generated for premature output situations.</p>
<p>(Of course, they're furthermore affected by disabled cookies in the browser or
even proxy issues. The session functionality obviously also depends on free
disk space and other php.ini settings, etc.)</p>
<h3>Further links</h3>
<ul>
<li>Google provides a lengthy list of similar discussions.</li>
<li>And of course many specific cases have been covered on Stack Overflow as well.</li>
<li>The WordPress FAQ explains How do I solve the Headers already sent warning problem? in a generic manner.</li>
<li>Adobe Community: PHP development: why redirects don't work (headers already sent)</li>
<li>Nucleus FAQ: What does "page headers already sent" mean?</li>
<li>One of the more thorough explanations is HTTP Headers and the PHP header() Function - A tutorial by NicholasSolutions (Internet Archive link). It covers HTTP in detail and gives a few guidelines for rewriting scripts.</li>
</ul>
<p><br></p>
<h3>更多建议</h3>
<p>在发送 HTTP 标头（使用或）之前发送 <em>任何内容</em> 时，都会触发此错误消息。在 HTTP
标头之前输出内容的常见原因是：<code>setcookie``header</code></p>
<ul>
<li>意外的空格，通常出现在文件的开头或结尾，如下所示：<div class="code"><pre class="code literal-block"><span class="w">   </span><span class="cp">&lt;?php</span>
</pre></div>

<p>// Note the space before "&lt;?php"
  ?&gt;</p>
</li>
</ul>
<p>为避免这种情况，只需省略关闭<code>?&gt;</code>- 无论如何都不需要。</p>
<ul>
<li>php 文件开头的字节顺序标记。用十六进制编辑器检查你的 php 文件，看看是否是这种情况。它们应该以字节开头<code>3F 3C</code>。<code>EF BB BF</code>您可以安全地从文件开头删除 BOM 。</li>
<li>显式输出，例如调用<code>echo</code>, <code>printf</code>, <code>readfile</code>, <code>passthru</code>, 之前的代码<code>&lt;?</code>等。</li>
<li>如果设置了 php.ini 属性，则由 php 输出警告<code>display_errors</code>。php 不会因为程序员的错误而崩溃，而是默默地修复错误并发出警告。虽然您可以修改<code>display_errors</code>或error_reporting配置，但您应该解决问题。<br>
常见原因是访问数组的未定义元素（例如<code>$_POST['input']</code>不使用<code>empty</code>或<code>isset</code>测试输入是否已设置），或使用未定义的常量而不是字符串文字（如在
中<code>$_POST[input]</code>，注意缺少引号）。</li>
</ul>
<p>打开输出缓冲应该可以解决问题；调用后的所有输出都<code>ob_start</code>缓冲在内存中，直到您释放缓冲区，例如使用<code>ob_end_flush</code>.</p>
<p>然而，虽然输出缓冲避免了这些问题，但您应该真正确定为什么您的应用程序在 HTTP 标头之前输出 HTTP
正文。这就像打电话并讨论你的一天和天气，然后告诉来电者他打错了号码。</p>
<p><br><br><a href="posts/how-to-fix-headers-already-sent-error-in-php/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ru-he-shan-chu-mu-lu-zhong-de-suo-you-wen-jian-he-wen-jian-jia/" class="u-url">如何删除目录中的所有文件和文件夹？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ru-he-shan-chu-mu-lu-zhong-de-suo-you-wen-jian-he-wen-jian-jia/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T12:04:42+08:00" itemprop="datePublished" title="2023-02-17 12:04">2023-02-17 12:04</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>使用 C#，如何从目录中删除所有文件和文件夹，但仍保留根目录？</p>
<p><br><br></p>
<h2>解答</h2>
<div class="code"><pre class="code literal-block">System.IO.DirectoryInfo di = new DirectoryInfo("YourPath");

foreach (FileInfo file in di.GetFiles())
{
    file.Delete(); 
}
foreach (DirectoryInfo dir in di.GetDirectories())
{
    dir.Delete(true); 
}
</pre></div>

<hr>
<p>如果您的目录可能有很多文件，<code>EnumerateFiles()</code>则比
更有效<code>GetFiles()</code>，因为当您使用时，<code>EnumerateFiles()</code>您可以在返回整个集合之前开始枚举它，而不是<code>GetFiles()</code>在开始枚举之前需要将整个集合加载到内存中。在这里看到这句话：</p>
<blockquote>
<p>因此，当您处理许多文件和目录时，EnumerateFiles() 会更有效率。</p>
</blockquote>
<p>这同样适用于<code>EnumerateDirectories()</code>和<code>GetDirectories()</code>。所以代码是：</p>
<div class="code"><pre class="code literal-block">foreach (FileInfo file in di.EnumerateFiles())
{
    file.Delete(); 
}
foreach (DirectoryInfo dir in di.EnumerateDirectories())
{
    dir.Delete(true); 
}
</pre></div>

<p>对于这个问题的目的，确实没有理由使用<code>GetFiles()</code>and <code>GetDirectories()</code>。</p>
<p><br></p>
<h3>更多建议</h3>
<p>是的，这是正确的做法。如果您希望给自己一个“干净”（或者，我更愿意称之为“空”函数），您可以创建一个扩展方法。</p>
<div class="code"><pre class="code literal-block">public static void Empty(this System.IO.DirectoryInfo directory)
{
    foreach(System.IO.FileInfo file in directory.GetFiles()) file.Delete();
    foreach(System.IO.DirectoryInfo subDirectory in directory.GetDirectories()) subDirectory.Delete(true);
}
</pre></div>

<p>然后，这将允许您执行类似...</p>
<div class="code"><pre class="code literal-block"><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">DirectoryInfo</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">DirectoryInfo</span><span class="p">(</span><span class="s">@"C:\..."</span><span class="p">);</span>

<span class="n">directory</span><span class="p">.</span><span class="n">Empty</span><span class="p">();</span>
</pre></div>

<p><br><br><a href="posts/how-to-delete-all-files-and-folders-in-a-directory/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-637.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-635.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
