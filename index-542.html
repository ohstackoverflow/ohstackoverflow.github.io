<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 542) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-542.html">
<link rel="prev" href="index-543.html" type="text/html">
<link rel="next" href="index-541.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/list-comprehension-vs-map/" class="u-url">List comprehension vs map</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/list-comprehension-vs-map/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T09:31:06+08:00" itemprop="datePublished" title="2023-02-17 09:31">2023-02-17 09:31</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Is there a reason to prefer using map() over list comprehension or vice versa?
Is either of them generally more efficient or considered generally more
Pythonic than the other?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><em>map</em> may be microscopically faster in some cases (when you're <em>not</em> making a
lambda for the purpose, but using the same function in map and a list
comprehension). List comprehensions may be faster in other cases and most (not
all) Pythonistas consider them more direct and clearer.</p>
<p>An example of the tiny speed advantage of <em>map</em> when using exactly the same
function:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>timeit<span class="w"> </span>-s<span class="s1">'xs=range(10)'</span><span class="w"> </span><span class="s1">'map(hex, xs)'</span>
<span class="m">100000</span><span class="w"> </span>loops,<span class="w"> </span>best<span class="w"> </span>of<span class="w"> </span><span class="m">3</span>:<span class="w"> </span><span class="m">4</span>.86<span class="w"> </span>usec<span class="w"> </span>per<span class="w"> </span>loop

$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>timeit<span class="w"> </span>-s<span class="s1">'xs=range(10)'</span><span class="w"> </span><span class="s1">'[hex(x) for x in xs]'</span>
<span class="m">100000</span><span class="w"> </span>loops,<span class="w"> </span>best<span class="w"> </span>of<span class="w"> </span><span class="m">3</span>:<span class="w"> </span><span class="m">5</span>.58<span class="w"> </span>usec<span class="w"> </span>per<span class="w"> </span>loop
</pre></div>

<p>An example of how performance comparison gets completely reversed when map
needs a lambda:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>timeit<span class="w"> </span>-s<span class="s1">'xs=range(10)'</span><span class="w"> </span><span class="s1">'map(lambda x: x+2, xs)'</span>
<span class="m">100000</span><span class="w"> </span>loops,<span class="w"> </span>best<span class="w"> </span>of<span class="w"> </span><span class="m">3</span>:<span class="w"> </span><span class="m">4</span>.24<span class="w"> </span>usec<span class="w"> </span>per<span class="w"> </span>loop

$<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>timeit<span class="w"> </span>-s<span class="s1">'xs=range(10)'</span><span class="w"> </span><span class="s1">'[x+2 for x in xs]'</span>
<span class="m">100000</span><span class="w"> </span>loops,<span class="w"> </span>best<span class="w"> </span>of<span class="w"> </span><span class="m">3</span>:<span class="w"> </span><span class="m">2</span>.32<span class="w"> </span>usec<span class="w"> </span>per<span class="w"> </span>loop
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p><strong>Cases</strong></p>
<ul>
<li>
<strong>Common case</strong> : Almost always, you will want to use a list comprehension in <em>python</em> because it will be more obvious what you're doing to novice programmers reading your code. (This does not apply to other languages, where other idioms may apply.) It will even be more obvious what you're doing to python programmers, since list comprehensions are the de-facto standard in python for iteration; they are <em>expected</em>.</li>
<li>
<strong>Less-common case</strong> : However if you <em>already have a function defined</em> , it is often reasonable to use <code>map</code>, though it is considered 'unpythonic'. For example, <code>map(sum, myLists)</code> is more elegant/terse than <code>[sum(x) for x in myLists]</code>. You gain the elegance of not having to make up a dummy variable (e.g. <code>sum(x) for x...</code> or <code>sum(_) for _...</code> or <code>sum(readableName) for readableName...</code>) which you have to type twice, just to iterate. The same argument holds for <code>filter</code> and <code>reduce</code> and anything from the <code>itertools</code> module: if you already have a function handy, you could go ahead and do some functional programming. This gains readability in some situations, and loses it in others (e.g. novice programmers, multiple arguments)... but the readability of your code highly depends on your comments anyway.</li>
<li>
<p><strong>Almost never</strong> : You may want to use the <code>map</code> function as a pure abstract function while doing functional programming, where you're mapping <code>map</code>, or currying <code>map</code>, or otherwise benefit from talking about <code>map</code> as a function. In Haskell for example, a functor interface called <code>fmap</code> generalizes mapping over any data structure. This is very uncommon in python because the python grammar compels you to use generator-style to talk about iteration; you can't generalize it easily. (This is sometimes good and sometimes bad.) You can probably come up with rare python examples where <code>map(f, *lists)</code> is a reasonable thing to do. The closest example I can come up with would be <code>sumEach = partial(map,sum)</code>, which is a one-liner that is very roughly equivalent to:</p>
<p>def sumEach(myLists):
    return [sum(_) for _ in myLists]</p>
</li>
<li>
<p><strong>Just using a<code>for</code>-loop</strong>: You can also of course just use a for-loop. While not as elegant from a functional-programming viewpoint, sometimes non-local variables make code clearer in imperative programming languages such as python, because people are very used to reading code that way. For-loops are also, generally, the most efficient when you are merely doing any complex operation that is not building a list like list-comprehensions and map are optimized for (e.g. summing, or making a tree, etc.) -- at least efficient in terms of memory (not necessarily in terms of time, where I'd expect at worst a constant factor, barring some rare pathological garbage-collection hiccuping).</p>
</li>
</ul>
<p><strong>"Pythonism"</strong></p>
<p>I dislike the word "pythonic" because I don't find that pythonic is always
elegant in my eyes. Nevertheless, <code>map</code> and <code>filter</code> and similar functions
(like the very useful <code>itertools</code> module) are probably considered unpythonic
in terms of style.</p>
<p><strong>Laziness</strong></p>
<p>In terms of efficiency, like most functional programming constructs, <strong>MAP CAN
BE LAZY</strong> , and in fact is lazy in python. That means you can do this (in
<em>python3</em> ) and your computer will not run out of memory and lose all your
unsaved data:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; map(str, range(10**100))
&lt;map object at 0x2201d50&gt;
</pre></div>

<p>Try doing that with a list comprehension:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span>[<span class="nv">str</span><span class="ss">(</span><span class="nv">n</span><span class="ss">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">100</span><span class="ss">)</span>]
#<span class="w"> </span><span class="k">DO</span><span class="w"> </span><span class="nv">NOT</span><span class="w"> </span><span class="nv">TRY</span><span class="w"> </span><span class="nv">THIS</span><span class="w"> </span><span class="nv">AT</span><span class="w"> </span><span class="nv">HOME</span><span class="w"> </span><span class="nv">OR</span><span class="w"> </span><span class="nv">YOU</span><span class="w"> </span><span class="nv">WILL</span><span class="w"> </span><span class="nv">BE</span><span class="w"> </span><span class="nv">SAD</span><span class="w"> </span>#
</pre></div>

<p>Do note that list comprehensions are also inherently lazy, but <em>python has
chosen to implement them as non-lazy</em>. Nevertheless, python does support lazy
list comprehensions in the form of generator expressions, as follows:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="ss">(</span><span class="nv">str</span><span class="ss">(</span><span class="nv">n</span><span class="ss">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">100</span><span class="ss">))</span>
<span class="o">&lt;</span><span class="nv">generator</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">genexpr</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="mi">0</span><span class="nv">xacbdef</span><span class="o">&gt;</span>
</pre></div>

<p>You can basically think of the <code>[...]</code> syntax as passing in a generator
expression to the list constructor, like <code>list(x for x in range(5))</code>.</p>
<p><strong>Brief contrived example</strong></p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">neg</span>
<span class="nb">print</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="n">neg</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))})</span>

<span class="nb">print</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]})</span>

<span class="nb">print</span><span class="p">({</span><span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))})</span>
</pre></div>

<p>List comprehensions are non-lazy, so may require more memory (unless you use
generator comprehensions). The square brackets <code>[...]</code> often make things
obvious, especially when in a mess of parentheses. On the other hand,
sometimes you end up being verbose like typing <code>[x for x in...</code>. As long as
you keep your iterator variables short, list comprehensions are usually
clearer if you don't indent your code. But you could always indent your code.</p>
<div class="code"><pre class="code literal-block"><span class="nv">print</span><span class="ss">(</span>
<span class="w">    </span>{<span class="nv">x</span>:<span class="nv">x</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="ss">(</span><span class="o">-</span><span class="nv">y</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="mi">5</span><span class="ss">))</span>}
<span class="ss">)</span>
</pre></div>

<p>or break things up:</p>
<div class="code"><pre class="code literal-block"><span class="nv">rangeNeg5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">(</span><span class="o">-</span><span class="nv">y</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="mi">5</span><span class="ss">))</span>
<span class="nv">print</span><span class="ss">(</span>
<span class="w">    </span>{<span class="nv">x</span>:<span class="nv">x</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">rangeNeg5</span>}
<span class="ss">)</span>
</pre></div>

<p><strong>Efficiency comparison for python3</strong></p>
<p><code>map</code> is now lazy:</p>
<div class="code"><pre class="code literal-block"><span class="c">% python3 -mtimeit -s 'xs=range(1000)' 'f=lambda x:x' 'z=map(f,xs)'</span>
<span class="n">1000000</span><span class="w"> </span><span class="s">loops,</span><span class="w"> </span><span class="s">best</span><span class="w"> </span><span class="s">of</span><span class="w"> </span><span class="s">3:</span><span class="w"> </span><span class="s">0.336</span><span class="w"> </span><span class="s">usec</span><span class="w"> </span><span class="s">per</span><span class="w"> </span><span class="s">loop</span><span class="w">            </span><span class="s">^^^^^^^^^</span>
</pre></div>

<p><em>Therefore if you will not be using all your data, or do not know ahead of
time how much data you need,<code>map</code> in python3 (and generator expressions in
python2 or python3) will avoid calculating their values until the last moment
necessary. Usually this will usually outweigh any overhead from using <code>map</code>.
The downside is that this is very limited in python as opposed to most
functional languages: you only get this benefit if you access your data left-
to-right "in order", because python generator expressions can only be
evaluated the order <code>x[0], x[1], x[2], ...</code>.</em></p>
<p>However let's say that we have a pre-made function <code>f</code> we'd like to <code>map</code>, and
we ignore the laziness of <code>map</code> by immediately forcing evaluation with
<code>list(...)</code>. We get some very interesting results:</p>
<div class="code"><pre class="code literal-block"><span class="c">% python3 -mtimeit -s 'xs=range(1000)' 'f=lambda x:x' 'z=list(map(f,xs))'                                                                                                                                                </span>
<span class="n">10000</span><span class="w"> </span><span class="s">loops,</span><span class="w"> </span><span class="s">best</span><span class="w"> </span><span class="s">of</span><span class="w"> </span><span class="s">3:</span><span class="w"> </span><span class="s">165/124/135</span><span class="w"> </span><span class="s">usec</span><span class="w"> </span><span class="s">per</span><span class="w"> </span><span class="s">loop</span><span class="w">        </span><span class="s">^^^^^^^^^^^^^^^</span>
<span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="o">&lt;</span><span class="n">map</span><span class="w"> </span><span class="n">object</span><span class="o">&gt;</span><span class="p">)</span>

<span class="c">% python3 -mtimeit -s 'xs=range(1000)' 'f=lambda x:x' 'z=[f(x) for x in xs]'                                                                                                                                      </span>
<span class="n">10000</span><span class="w"> </span><span class="s">loops,</span><span class="w"> </span><span class="s">best</span><span class="w"> </span><span class="s">of</span><span class="w"> </span><span class="s">3:</span><span class="w"> </span><span class="s">181/118/123</span><span class="w"> </span><span class="s">usec</span><span class="w"> </span><span class="s">per</span><span class="w"> </span><span class="s">loop</span><span class="w">        </span><span class="s">^^^^^^^^^^^^^^^^^^</span>
<span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="o">&lt;</span><span class="n">generator</span><span class="o">&gt;</span><span class="p">),</span><span class="w"> </span><span class="n">probably</span><span class="w"> </span><span class="n">optimized</span>

<span class="c">% python3 -mtimeit -s 'xs=range(1000)' 'f=lambda x:x' 'z=list(f(x) for x in xs)'                                                                                                                                    </span>
<span class="n">1000</span><span class="w"> </span><span class="s">loops,</span><span class="w"> </span><span class="s">best</span><span class="w"> </span><span class="s">of</span><span class="w"> </span><span class="s">3:</span><span class="w"> </span><span class="s">215/150/150</span><span class="w"> </span><span class="s">usec</span><span class="w"> </span><span class="s">per</span><span class="w"> </span><span class="s">loop</span><span class="w">         </span><span class="s">^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="o">&lt;</span><span class="n">generator</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>

<p>In results are in the form AAA/BBB/CCC where A was performed with on a
circa-2010 Intel workstation with python 3.?.?, and B and C were performed
with a circa-2013 AMD workstation with python 3.2.1, with extremely different
hardware. The result seems to be that map and list comprehensions are
comparable in performance, which is most strongly affected by other random
factors. The only thing we can tell seems to be that, oddly, while we expect
list comprehensions <code>[...]</code> to perform better than generator expressions
<code>(...)</code>, <code>map</code> is ALSO more efficient that generator expressions (again
assuming that all values are evaluated/used).</p>
<p>It is important to realize that these tests assume a very simple function (the
identity function); however this is fine because if the function were
complicated, then performance overhead would be negligible compared to other
factors in the program. (It may still be interesting to test with other simple
things like <code>f=lambda x:x+x</code>)</p>
<p>If you're skilled at reading python assembly, you can use the <code>dis</code> module to
see if that's actually what's going on behind the scenes:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">listComp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compile</span><span class="p">(</span><span class="s1">'[f(x) for x in xs]'</span><span class="p">,</span><span class="w"> </span><span class="s1">'listComp'</span><span class="p">,</span><span class="w"> </span><span class="s1">'eval'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">listComp</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w">           </span><span class="mi">0</span><span class="w"> </span><span class="n">LOAD_CONST</span><span class="w">               </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">code</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mh">0x2511a48</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="s2">"listComp"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>
<span class="w">              </span><span class="mi">3</span><span class="w"> </span><span class="n">MAKE_FUNCTION</span><span class="w">            </span><span class="mi">0</span><span class="w"> </span>
<span class="w">              </span><span class="mi">6</span><span class="w"> </span><span class="n">LOAD_NAME</span><span class="w">                </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span>
<span class="w">              </span><span class="mi">9</span><span class="w"> </span><span class="n">GET_ITER</span><span class="w">             </span>
<span class="w">             </span><span class="mi">10</span><span class="w"> </span><span class="n">CALL_FUNCTION</span><span class="w">            </span><span class="mi">1</span><span class="w"> </span>
<span class="w">             </span><span class="mi">13</span><span class="w"> </span><span class="n">RETURN_VALUE</span><span class="w">         </span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">listComp</span><span class="o">.</span><span class="n">co_consts</span>
<span class="p">(</span><span class="o">&lt;</span><span class="n">code</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">&lt;</span><span class="n">listcomp</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mh">0x2511a48</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="s2">"listComp"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,)</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">listComp</span><span class="o">.</span><span class="n">co_consts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="w">  </span><span class="mi">1</span><span class="w">           </span><span class="mi">0</span><span class="w"> </span><span class="n">BUILD_LIST</span><span class="w">               </span><span class="mi">0</span><span class="w"> </span>
<span class="w">              </span><span class="mi">3</span><span class="w"> </span><span class="n">LOAD_FAST</span><span class="w">                </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="o">&gt;&gt;</span><span class="w">    </span><span class="mi">6</span><span class="w"> </span><span class="n">FOR_ITER</span><span class="w">                </span><span class="mi">18</span><span class="w"> </span><span class="p">(</span><span class="n">to</span><span class="w"> </span><span class="mi">27</span><span class="p">)</span><span class="w"> </span>
<span class="w">              </span><span class="mi">9</span><span class="w"> </span><span class="n">STORE_FAST</span><span class="w">               </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span>
<span class="w">             </span><span class="mi">12</span><span class="w"> </span><span class="n">LOAD_GLOBAL</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span>
<span class="w">             </span><span class="mi">15</span><span class="w"> </span><span class="n">LOAD_FAST</span><span class="w">                </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span>
<span class="w">             </span><span class="mi">18</span><span class="w"> </span><span class="n">CALL_FUNCTION</span><span class="w">            </span><span class="mi">1</span><span class="w"> </span>
<span class="w">             </span><span class="mi">21</span><span class="w"> </span><span class="n">LIST_APPEND</span><span class="w">              </span><span class="mi">2</span><span class="w"> </span>
<span class="w">             </span><span class="mi">24</span><span class="w"> </span><span class="n">JUMP_ABSOLUTE</span><span class="w">            </span><span class="mi">6</span><span class="w"> </span>
<span class="w">        </span><span class="o">&gt;&gt;</span><span class="w">   </span><span class="mi">27</span><span class="w"> </span><span class="n">RETURN_VALUE</span>



<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">listComp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compile</span><span class="p">(</span><span class="s1">'list(f(x) for x in xs)'</span><span class="p">,</span><span class="w"> </span><span class="s1">'listComp2'</span><span class="p">,</span><span class="w"> </span><span class="s1">'eval'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">listComp2</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w">           </span><span class="mi">0</span><span class="w"> </span><span class="n">LOAD_NAME</span><span class="w">                </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">list</span><span class="p">)</span><span class="w"> </span>
<span class="w">              </span><span class="mi">3</span><span class="w"> </span><span class="n">LOAD_CONST</span><span class="w">               </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">code</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">&lt;</span><span class="n">genexpr</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mh">0x255bc68</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="s2">"listComp2"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>
<span class="w">              </span><span class="mi">6</span><span class="w"> </span><span class="n">MAKE_FUNCTION</span><span class="w">            </span><span class="mi">0</span><span class="w"> </span>
<span class="w">              </span><span class="mi">9</span><span class="w"> </span><span class="n">LOAD_NAME</span><span class="w">                </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span>
<span class="w">             </span><span class="mi">12</span><span class="w"> </span><span class="n">GET_ITER</span><span class="w">             </span>
<span class="w">             </span><span class="mi">13</span><span class="w"> </span><span class="n">CALL_FUNCTION</span><span class="w">            </span><span class="mi">1</span><span class="w"> </span>
<span class="w">             </span><span class="mi">16</span><span class="w"> </span><span class="n">CALL_FUNCTION</span><span class="w">            </span><span class="mi">1</span><span class="w"> </span>
<span class="w">             </span><span class="mi">19</span><span class="w"> </span><span class="n">RETURN_VALUE</span><span class="w">         </span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">listComp2</span><span class="o">.</span><span class="n">co_consts</span>
<span class="p">(</span><span class="o">&lt;</span><span class="n">code</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">&lt;</span><span class="n">genexpr</span><span class="o">&gt;</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mh">0x255bc68</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="s2">"listComp2"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,)</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">listComp2</span><span class="o">.</span><span class="n">co_consts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="w">  </span><span class="mi">1</span><span class="w">           </span><span class="mi">0</span><span class="w"> </span><span class="n">LOAD_FAST</span><span class="w">                </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="o">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="o">&gt;&gt;</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="n">FOR_ITER</span><span class="w">                </span><span class="mi">17</span><span class="w"> </span><span class="p">(</span><span class="n">to</span><span class="w"> </span><span class="mi">23</span><span class="p">)</span><span class="w"> </span>
<span class="w">              </span><span class="mi">6</span><span class="w"> </span><span class="n">STORE_FAST</span><span class="w">               </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span>
<span class="w">              </span><span class="mi">9</span><span class="w"> </span><span class="n">LOAD_GLOBAL</span><span class="w">              </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span>
<span class="w">             </span><span class="mi">12</span><span class="w"> </span><span class="n">LOAD_FAST</span><span class="w">                </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span>
<span class="w">             </span><span class="mi">15</span><span class="w"> </span><span class="n">CALL_FUNCTION</span><span class="w">            </span><span class="mi">1</span><span class="w"> </span>
<span class="w">             </span><span class="mi">18</span><span class="w"> </span><span class="n">YIELD_VALUE</span><span class="w">          </span>
<span class="w">             </span><span class="mi">19</span><span class="w"> </span><span class="n">POP_TOP</span><span class="w">              </span>
<span class="w">             </span><span class="mi">20</span><span class="w"> </span><span class="n">JUMP_ABSOLUTE</span><span class="w">            </span><span class="mi">3</span><span class="w"> </span>
<span class="w">        </span><span class="o">&gt;&gt;</span><span class="w">   </span><span class="mi">23</span><span class="w"> </span><span class="n">LOAD_CONST</span><span class="w">               </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">None</span><span class="p">)</span><span class="w"> </span>
<span class="w">             </span><span class="mi">26</span><span class="w"> </span><span class="n">RETURN_VALUE</span>



<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">evalledMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compile</span><span class="p">(</span><span class="s1">'list(map(f,xs))'</span><span class="p">,</span><span class="w"> </span><span class="s1">'evalledMap'</span><span class="p">,</span><span class="w"> </span><span class="s1">'eval'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">dis</span><span class="o">.</span><span class="n">dis</span><span class="p">(</span><span class="n">evalledMap</span><span class="p">)</span>
<span class="w">  </span><span class="mi">1</span><span class="w">           </span><span class="mi">0</span><span class="w"> </span><span class="n">LOAD_NAME</span><span class="w">                </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="n">list</span><span class="p">)</span><span class="w"> </span>
<span class="w">              </span><span class="mi">3</span><span class="w"> </span><span class="n">LOAD_NAME</span><span class="w">                </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">map</span><span class="p">)</span><span class="w"> </span>
<span class="w">              </span><span class="mi">6</span><span class="w"> </span><span class="n">LOAD_NAME</span><span class="w">                </span><span class="mi">2</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span>
<span class="w">              </span><span class="mi">9</span><span class="w"> </span><span class="n">LOAD_NAME</span><span class="w">                </span><span class="mi">3</span><span class="w"> </span><span class="p">(</span><span class="n">xs</span><span class="p">)</span><span class="w"> </span>
<span class="w">             </span><span class="mi">12</span><span class="w"> </span><span class="n">CALL_FUNCTION</span><span class="w">            </span><span class="mi">2</span><span class="w"> </span>
<span class="w">             </span><span class="mi">15</span><span class="w"> </span><span class="n">CALL_FUNCTION</span><span class="w">            </span><span class="mi">1</span><span class="w"> </span>
<span class="w">             </span><span class="mi">18</span><span class="w"> </span><span class="n">RETURN_VALUE</span>
</pre></div>

<p>It seems it is better to use <code>[...]</code> syntax than <code>list(...)</code>. Sadly the <code>map</code>
class is a bit opaque to disassembly, but we can make due with our speed test.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-are-the-special-dollar-sign-shell-variables/" class="u-url">What are the special dollar sign shell variables?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-are-the-special-dollar-sign-shell-variables/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T09:30:43+08:00" itemprop="datePublished" title="2023-02-17 09:30">2023-02-17 09:30</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In Bash, there appear to be several variables which hold special,
consistently-meaning values. For instance,</p>
<div class="code"><pre class="code literal-block">./myprogram &amp;; echo $!
</pre></div>

<p>will return the PID of the process which backgrounded <code>myprogram</code>. I know of
others, such as <code>$?</code> which I think is the current TTY. Are there others?</p>
<p><br><br></p>
<h2>Answer</h2>
<ul>
<li>
<code>$1</code>, <code>$2</code>, <code>$3</code>, ... are the positional parameters.</li>
<li>
<code>"$@"</code> is an array-like construct of all positional parameters, <code>{$1, $2, $3 ...}</code>.</li>
<li>
<code>"$*"</code> is the IFS expansion of all positional parameters, <code>$1 $2 $3 ...</code>.</li>
<li>
<code>$#</code> is the number of positional parameters.</li>
<li>
<code>$-</code> current options set for the shell.</li>
<li>
<code>$$</code> pid of the current shell (not subshell).</li>
<li>
<code>$_</code> most recent parameter (or the abs path of the command to start the current shell immediately after startup).</li>
<li>
<code>$IFS</code> is the (input) field separator.</li>
<li>
<code>$?</code> is the most recent foreground pipeline exit status.</li>
<li>
<code>$!</code> is the PID of the most recent background command.</li>
<li>
<code>$0</code> is the name of the shell or shell script.</li>
</ul>
<p>Most of the above can be found under Special Parameters in the Bash Reference
Manual. Here are all the environment variables set by the shell.</p>
<p>For a comprehensive index, please see the Reference Manual Variable Index.</p>
<p><br></p>
<h3>Suggest</h3>
<ul>
<li>
<code>$_</code> last argument of last command</li>
<li>
<code>$#</code> number of arguments passed to current script</li>
<li>
<code>$*</code> / <code>$@</code> list of arguments passed to script as string / delimited list</li>
</ul>
<p>off the top of my head. Google for bash special variables.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-you-get-the-logical-xor-of-two-variables-in-python/" class="u-url">How do you get the logical xor of two variables in Python?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-you-get-the-logical-xor-of-two-variables-in-python/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T09:30:15+08:00" itemprop="datePublished" title="2023-02-17 09:30">2023-02-17 09:30</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do you get the logical xor of two variables in Python?</p>
<p>For example, I have two variables that I expect to be strings. I want to test
that only one of them contains a True value (is not None or the empty string):</p>
<div class="code"><pre class="code literal-block"><span class="nv">str1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">raw_input</span><span class="ss">(</span><span class="s2">"Enter string one:"</span><span class="ss">)</span>
<span class="nv">str2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">raw_input</span><span class="ss">(</span><span class="s2">"Enter string two:"</span><span class="ss">)</span>
<span class="k">if</span><span class="w"> </span><span class="nv">logical_xor</span><span class="ss">(</span><span class="nv">str1</span>,<span class="w"> </span><span class="nv">str2</span><span class="ss">)</span>:
<span class="w">    </span><span class="nv">print</span><span class="w"> </span><span class="s2">"ok"</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="w"> </span><span class="s2">"bad"</span>
</pre></div>

<p>The <code>^</code> operator seems to be bitwise, and not defined on all objects:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">1</span>
<span class="mi">0</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">1</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="s2">"abc"</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="s2">""</span>
<span class="nv">Traceback</span><span class="w"> </span><span class="ss">(</span><span class="nv">most</span><span class="w"> </span><span class="nv">recent</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="nl">last</span><span class="ss">)</span>:
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;stdin&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">module</span><span class="o">&gt;</span>
<span class="nv">TypeError</span>:<span class="w"> </span><span class="nv">unsupported</span><span class="w"> </span><span class="nv">operand</span><span class="w"> </span><span class="nv">type</span><span class="ss">(</span><span class="nv">s</span><span class="ss">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">^</span>:<span class="w"> </span><span class="s1">'str'</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="s1">'str'</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>If you're already normalizing the inputs to booleans, then != is xor.</p>
<div class="code"><pre class="code literal-block">bool(a) != bool(b)
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You can always use the definition of xor to compute it from other logical
operations:</p>
<div class="code"><pre class="code literal-block">(a and not b) or (not a and b)
</pre></div>

<p>But this is a little too verbose for me, and isn't particularly clear at first
glance. Another way to do it is:</p>
<div class="code"><pre class="code literal-block">bool(a) ^ bool(b)
</pre></div>

<p>The xor operator on two booleans is logical xor (unlike on ints, where it's
bitwise). Which makes sense, since <code>bool</code> is just a subclass of <code>int</code>, but is
implemented to only have the values <code>0</code> and <code>1</code>. And logical xor is equivalent
to bitwise xor when the domain is restricted to <code>0</code> and <code>1</code>.</p>
<p>So the <code>logical_xor</code> function would be implemented like:</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">logical_xor</span><span class="ss">(</span><span class="nv">str1</span>,<span class="w"> </span><span class="nv">str2</span><span class="ss">)</span>:
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">bool</span><span class="ss">(</span><span class="nv">str1</span><span class="ss">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="nv">bool</span><span class="ss">(</span><span class="nv">str2</span><span class="ss">)</span>
</pre></div>

<p>Credit to Nick Coghlan on the Python-3000 mailing list.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-543.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-541.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
