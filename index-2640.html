<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2640) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2640.html">
<link rel="prev" href="index-2641.html" type="text/html">
<link rel="next" href="index-2639.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/search-and-replace-a-line-in-a-file-in-python/" class="u-url">Search and replace a line in a file in Python</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/search-and-replace-a-line-in-a-file-in-python/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T06:56:13+08:00" itemprop="datePublished" title="2023-03-05 06:56">2023-03-05 06:56</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to loop over the contents of a text file and do a search and replace on
some lines and write the result back to the file. I could first load the whole
file in memory and then write it back, but that probably is not the best way
to do it.</p>
<p>What is the best way to do this, within the following code?</p>
<div class="code"><pre class="code literal-block"><span class="nv">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">open</span><span class="ss">(</span><span class="nv">file</span><span class="ss">)</span>
<span class="k">for</span><span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">f</span>:
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">line</span>.<span class="nv">contains</span><span class="ss">(</span><span class="s1">'foo'</span><span class="ss">)</span>:
<span class="w">        </span><span class="nv">newline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">line</span>.<span class="nv">replace</span><span class="ss">(</span><span class="s1">'foo'</span>,<span class="w"> </span><span class="s1">'bar'</span><span class="ss">)</span>
<span class="w">        </span>#<span class="w"> </span><span class="nv">how</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">write</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">newline</span><span class="w"> </span><span class="nv">back</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">file</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>I guess something like this should do it. It basically writes the content to a
new file and replaces the old file with the new file:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">mkstemp</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">move</span><span class="p">,</span> <span class="n">copymode</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">fdopen</span><span class="p">,</span> <span class="n">remove</span>

<span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">subst</span><span class="p">):</span>
    <span class="c1">#Create temp file</span>
    <span class="n">fh</span><span class="p">,</span> <span class="n">abs_path</span> <span class="o">=</span> <span class="n">mkstemp</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">fdopen</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span><span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">new_file</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">old_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">old_file</span><span class="p">:</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">subst</span><span class="p">))</span>
    <span class="c1">#Copy the file permissions from the old file to the new file</span>
    <span class="n">copymode</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">abs_path</span><span class="p">)</span>
    <span class="c1">#Remove original file</span>
    <span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="c1">#Move new file</span>
    <span class="n">move</span><span class="p">(</span><span class="n">abs_path</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I guess something like this should do it. It basically writes the content to a
new file and replaces the old file with the new file:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">mkstemp</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">move</span><span class="p">,</span> <span class="n">copymode</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">fdopen</span><span class="p">,</span> <span class="n">remove</span>

<span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">subst</span><span class="p">):</span>
    <span class="c1">#Create temp file</span>
    <span class="n">fh</span><span class="p">,</span> <span class="n">abs_path</span> <span class="o">=</span> <span class="n">mkstemp</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">fdopen</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span><span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">new_file</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">old_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">old_file</span><span class="p">:</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">subst</span><span class="p">))</span>
    <span class="c1">#Copy the file permissions from the old file to the new file</span>
    <span class="n">copymode</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">abs_path</span><span class="p">)</span>
    <span class="c1">#Remove original file</span>
    <span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="c1">#Move new file</span>
    <span class="n">move</span><span class="p">(</span><span class="n">abs_path</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-convert-an-image-to-base64-encoding/" class="u-url">How to convert an image to Base64 encoding</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-convert-an-image-to-base64-encoding/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T06:54:06+08:00" itemprop="datePublished" title="2023-03-05 06:54">2023-03-05 06:54</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How can I convert an image from a URL to Base64 encoding?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I think that it should be:</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="nt">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'myfolder/myimage.png'</span><span class="o">;</span>
<span class="o">$</span><span class="nt">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">pathinfo</span><span class="o">($</span><span class="nt">path</span><span class="o">,</span><span class="w"> </span><span class="nt">PATHINFO_EXTENSION</span><span class="o">);</span>
<span class="o">$</span><span class="nt">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">file_get_contents</span><span class="o">($</span><span class="nt">path</span><span class="o">);</span>
<span class="o">$</span><span class="nt">base64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'data:image/'</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="o">$</span><span class="nt">type</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="s1">';base64,'</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="nt">base64_encode</span><span class="o">($</span><span class="nt">data</span><span class="o">);</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Easy:</p>
<div class="code"><pre class="code literal-block">$<span class="nv">imagedata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">file_get_contents</span><span class="ss">(</span><span class="s2">"/path/to/image.jpg"</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">             </span><span class="o">//</span><span class="w"> </span><span class="nv">alternatively</span><span class="w"> </span><span class="nv">specify</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">URL</span>,<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">PHP</span><span class="w"> </span><span class="nv">settings</span><span class="w"> </span><span class="nv">allow</span>
<span class="mh">$ba</span><span class="nv">se64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">base64_encode</span><span class="ss">(</span>$<span class="nv">imagedata</span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>Bear in mind that this will enlarge the data by 33%, and you'll have problems
with files whose size exceed your <code>memory_limit</code>.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/android-clear-the-back-stack/" class="u-url">Android: Clear the back stack</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/android-clear-the-back-stack/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T06:52:14+08:00" itemprop="datePublished" title="2023-03-05 06:52">2023-03-05 06:52</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In Android I have some activities, let's say A, B, C.</p>
<p>In A, I use this code to open B:</p>
<div class="code"><pre class="code literal-block">Intent intent = new Intent(this, B.class);
startActivity(intent);
</pre></div>

<p>In B, I use this code to open C:</p>
<div class="code"><pre class="code literal-block">Intent intent = new Intent(this, C.class);
startActivity(intent);
</pre></div>

<p>When the user taps a button in C, I want to go back to A and clear the back
stack (close both B and C). So when the user use the back button B and C will
not show up, I've been trying the following:</p>
<div class="code"><pre class="code literal-block">Intent intent = new Intent(this, A.class);
intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP); 
startActivity(intent);
</pre></div>

<p>But B and C are still showing up if I use the back button when I'm back in
activity A. How can I avoid this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Try adding <code>FLAG_ACTIVITY_NEW_TASK</code> as described in the docs for
<code>FLAG_ACTIVITY_CLEAR_TOP</code>:</p>
<blockquote>
<p>This launch mode can also be used to good effect in conjunction with
FLAG_ACTIVITY_NEW_TASK: if used to start the root activity of a task, it
will bring any currently running instance of that task to the foreground,
and then clear it to its root state. This is especially useful, for example,
when launching an activity from the notification manager.</p>
</blockquote>
<p>So your code to launch <code>A</code> would be:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Intent</span><span class="w"> </span><span class="nv">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Intent</span><span class="ss">(</span><span class="nv">this</span>,<span class="w"> </span><span class="nv">A</span>.<span class="nv">class</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">intent</span>.<span class="nv">addFlags</span><span class="ss">(</span><span class="nv">Intent</span>.<span class="nv">FLAG_ACTIVITY_CLEAR_TOP</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">Intent</span>.<span class="nv">FLAG_ACTIVITY_NEW_TASK</span><span class="ss">)</span><span class="c1">; </span>
<span class="nv">startActivity</span><span class="ss">(</span><span class="nv">intent</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">CurrentActivity</span>.<span class="nv">this</span>.<span class="nv">finish</span><span class="ss">()</span><span class="c1">; // if the activity running has it's own context</span>


<span class="o">//</span><span class="w"> </span><span class="nv">view</span>.<span class="nv">getContext</span><span class="ss">()</span>.<span class="nv">finish</span><span class="ss">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">fragments</span><span class="w"> </span><span class="nv">etc</span>.
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<div class="code"><pre class="code literal-block">intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
startActivity(intent);
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2641.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2639.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
