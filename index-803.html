<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 803) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-803.html">
<link rel="prev" href="index-804.html" type="text/html">
<link rel="next" href="index-802.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/stylesheet-not-loaded-because-of-mime-type/" class="u-url">Stylesheet not loaded because of MIME type</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/stylesheet-not-loaded-because-of-mime-type/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:22:59+08:00" itemprop="datePublished" title="2023-02-17 16:22">2023-02-17 16:22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm working on a website that uses Gulp.js to compile and browser sync to keep
the browser synchronised with my changes.</p>
<p>The Gulp.js task compiles everything properly, but on the website, I'm unable
to see any style, and the console shows this error message:</p>
<blockquote>
<p>Refused to apply style from 'http://localhost:3000/assets/styles/custom-
style.css' because its MIME type ('text/html') is not a supported stylesheet
MIME type, and strict MIME checking is enabled.</p>
</blockquote>
<p>Now, I don't really understand why this happens.</p>
<p>The HTML includes the file like this (which I am pretty sure is correct):</p>
<div class="code"><pre class="code literal-block">&lt;link rel="stylesheet" type="text/css" href="assets/styles/custom-style.css"/&gt;
</pre></div>

<p>And the style sheet is a merge between Bootstrap and Font Awesome styles for
now (nothing custom yet).</p>
<p>The path is correct as well, as this is the folder structure:</p>
<div class="code"><pre class="code literal-block">index.html
assets
|-styles
  |-custom-style.css
</pre></div>

<p>But I keep getting the error.</p>
<p>What could it be? Is this something (maybe a setting?) for gulp/browsersync
maybe?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The issue, I think, was with a CSS library starting with comments.</p>
<p>While in development, I do not minify files and I don't remove comments. This
meant that the stylesheet started with some comments, causing it to be seen as
something different from CSS.</p>
<p>Removing the library and putting it into a vendor file (which is ALWAYS
minified without comments) solved the issue.</p>
<p>Again, I'm not 100% sure this is a fix, but it's still a win for me as it
works as expected now.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The issue, I think, was with a CSS library starting with comments.</p>
<p>While in development, I do not minify files and I don't remove comments. This
meant that the stylesheet started with some comments, causing it to be seen as
something different from CSS.</p>
<p>Removing the library and putting it into a vendor file (which is ALWAYS
minified without comments) solved the issue.</p>
<p>Again, I'm not 100% sure this is a fix, but it's still a win for me as it
works as expected now.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/can-i-create-links-with-target-blank-in-markdown/" class="u-url">Can I create links with 'target="_blank"' in Markdown?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/can-i-create-links-with-target-blank-in-markdown/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:22:30+08:00" itemprop="datePublished" title="2023-02-17 16:22">2023-02-17 16:22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Is there a way to create a link in Markdown that opens in a new window? If
not, what syntax do you recommend to do this? I'll add it to the markdown
compiler I use. I think it should be an option.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>As far as the Markdown syntax is concerned, if you want to get that detailed,
you'll just have to use HTML.</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"http://example.com/"</span><span class="w"> </span><span class="na">target=</span><span class="s">"_blank"</span><span class="nt">&gt;</span>Hello,<span class="w"> </span>world!<span class="nt">&lt;/a&gt;</span>
</pre></div>

<p>Most Markdown engines I've seen allow plain old HTML, just for situations like
this where a generic text markup system just won't cut it. (The StackOverflow
engine, for example.) They then run the entire output through an HTML
whitelist filter, regardless, since even a Markdown-only document can easily
contain XSS attacks. As such, if you or your users want to create <code>_blank</code>
links, then they probably still can.</p>
<p>If that's a feature you're going to be using often, it might make sense to
create your own syntax, but it's generally not a vital feature. If I want to
launch that link in a new window, I'll ctrl-click it myself, thanks.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Kramdown supports it. It's compatible with standard Markdown syntax, but has
many extensions, too. You would use it like this:</p>
<div class="code"><pre class="code literal-block"><span class="o">[</span><span class="n">link</span><span class="o">]</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="err">{:</span><span class="n">target</span><span class="o">=</span><span class="ss">"_blank"</span><span class="err">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/" class="u-url">Speed comparison with Project Euler: C vs Python vs Erlang vs Haskell</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:21:59+08:00" itemprop="datePublished" title="2023-02-17 16:21">2023-02-17 16:21</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have taken Problem #12 from Project Euler as a programming exercise and to
compare my (surely not optimal) implementations in C, Python, Erlang and
Haskell. In order to get some higher execution times, I search for the first
triangle number with more than 1000 divisors instead of 500 as stated in the
original problem.</p>
<p>The result is the following:</p>
<p><strong>C:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">lorenzo</span><span class="nv">@enzo</span><span class="err">:</span><span class="o">~/</span><span class="n">erlang</span><span class="err">$</span><span class="w"> </span><span class="n">gcc</span><span class="w"> </span><span class="o">-</span><span class="n">lm</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">euler12</span><span class="p">.</span><span class="n">bin</span><span class="w"> </span><span class="n">euler12</span><span class="p">.</span><span class="n">c</span>
<span class="n">lorenzo</span><span class="nv">@enzo</span><span class="err">:</span><span class="o">~/</span><span class="n">erlang</span><span class="err">$</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">euler12</span><span class="p">.</span><span class="n">bin</span>
<span class="mi">842161320</span>

<span class="nc">real</span><span class="w">    </span><span class="mi">0</span><span class="n">m11</span><span class="mf">.074</span><span class="n">s</span>
<span class="k">user</span><span class="w">    </span><span class="mi">0</span><span class="n">m11</span><span class="mf">.070</span><span class="n">s</span>
<span class="n">sys</span><span class="w"> </span><span class="mi">0</span><span class="n">m0</span><span class="mf">.000</span><span class="n">s</span>
</pre></div>

<p><strong>Python:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">lorenzo</span><span class="nv">@enzo</span><span class="err">:</span><span class="o">~/</span><span class="n">erlang</span><span class="err">$</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">euler12</span><span class="p">.</span><span class="n">py</span><span class="w"> </span>
<span class="mi">842161320</span>

<span class="nc">real</span><span class="w">    </span><span class="mi">1</span><span class="n">m16</span><span class="mf">.632</span><span class="n">s</span>
<span class="k">user</span><span class="w">    </span><span class="mi">1</span><span class="n">m16</span><span class="mf">.370</span><span class="n">s</span>
<span class="n">sys</span><span class="w"> </span><span class="mi">0</span><span class="n">m0</span><span class="mf">.250</span><span class="n">s</span>
</pre></div>

<p><strong>Python with PyPy:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">lorenzo</span><span class="err">@</span><span class="n">enzo</span><span class="p">:</span><span class="o">~/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">pypy</span><span class="o">-</span><span class="n">c</span><span class="o">-</span><span class="n">jit</span><span class="o">-</span><span class="mi">43780</span><span class="o">-</span><span class="n">b590cf6de419</span><span class="o">-</span><span class="n">linux64</span><span class="o">/</span><span class="n">bin</span><span class="o">$</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">./</span><span class="n">pypy</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">lorenzo</span><span class="o">/</span><span class="n">erlang</span><span class="o">/</span><span class="n">euler12</span><span class="o">.</span><span class="n">py</span><span class="w"> </span>
<span class="mi">842161320</span>

<span class="n">real</span><span class="w">    </span><span class="mi">0</span><span class="n">m13</span><span class="o">.</span><span class="mi">082</span><span class="n">s</span>
<span class="n">user</span><span class="w">    </span><span class="mi">0</span><span class="n">m13</span><span class="o">.</span><span class="mi">050</span><span class="n">s</span>
<span class="n">sys</span><span class="w"> </span><span class="mi">0</span><span class="n">m0</span><span class="o">.</span><span class="mi">020</span><span class="n">s</span>
</pre></div>

<p><strong>Erlang:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">lorenzo</span><span class="nv">@enzo</span><span class="err">:</span><span class="o">~/</span><span class="n">erlang</span><span class="err">$</span><span class="w"> </span><span class="n">erlc</span><span class="w"> </span><span class="n">euler12</span><span class="p">.</span><span class="n">erl</span><span class="w"> </span>
<span class="n">lorenzo</span><span class="nv">@enzo</span><span class="err">:</span><span class="o">~/</span><span class="n">erlang</span><span class="err">$</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="n">erl</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="n">euler12</span><span class="w"> </span><span class="n">solve</span>
<span class="n">Erlang</span><span class="w"> </span><span class="n">R13B03</span><span class="w"> </span><span class="p">(</span><span class="n">erts</span><span class="o">-</span><span class="mf">5.7.4</span><span class="p">)</span><span class="w"> </span><span class="o">[</span><span class="n">source</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">64-bit</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">smp:4:4</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">rq:4</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">async-threads:0</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">hipe</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">kernel-poll:false</span><span class="o">]</span>

<span class="n">Eshell</span><span class="w"> </span><span class="n">V5</span><span class="mf">.7.4</span><span class="w">  </span><span class="p">(</span><span class="n">abort</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="o">^</span><span class="n">G</span><span class="p">)</span>
<span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">842161320</span>

<span class="nc">real</span><span class="w">    </span><span class="mi">0</span><span class="n">m48</span><span class="mf">.259</span><span class="n">s</span>
<span class="k">user</span><span class="w">    </span><span class="mi">0</span><span class="n">m48</span><span class="mf">.070</span><span class="n">s</span>
<span class="n">sys</span><span class="w"> </span><span class="mi">0</span><span class="n">m0</span><span class="mf">.020</span><span class="n">s</span>
</pre></div>

<p><strong>Haskell:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">lorenzo</span><span class="nv">@enzo</span><span class="err">:</span><span class="o">~/</span><span class="n">erlang</span><span class="err">$</span><span class="w"> </span><span class="n">ghc</span><span class="w"> </span><span class="n">euler12</span><span class="p">.</span><span class="n">hs</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">euler12</span><span class="p">.</span><span class="n">hsx</span>
<span class="o">[</span><span class="n">1 of 1</span><span class="o">]</span><span class="w"> </span><span class="n">Compiling</span><span class="w"> </span><span class="n">Main</span><span class="w">             </span><span class="p">(</span><span class="w"> </span><span class="n">euler12</span><span class="p">.</span><span class="n">hs</span><span class="p">,</span><span class="w"> </span><span class="n">euler12</span><span class="p">.</span><span class="n">o</span><span class="w"> </span><span class="p">)</span>
<span class="n">Linking</span><span class="w"> </span><span class="n">euler12</span><span class="p">.</span><span class="n">hsx</span><span class="w"> </span><span class="p">...</span>
<span class="n">lorenzo</span><span class="nv">@enzo</span><span class="err">:</span><span class="o">~/</span><span class="n">erlang</span><span class="err">$</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">euler12</span><span class="p">.</span><span class="n">hsx</span><span class="w"> </span>
<span class="mi">842161320</span>

<span class="nc">real</span><span class="w">    </span><span class="mi">2</span><span class="n">m37</span><span class="mf">.326</span><span class="n">s</span>
<span class="k">user</span><span class="w">    </span><span class="mi">2</span><span class="n">m37</span><span class="mf">.240</span><span class="n">s</span>
<span class="n">sys</span><span class="w"> </span><span class="mi">0</span><span class="n">m0</span><span class="mf">.080</span><span class="n">s</span>
</pre></div>

<p><strong>Summary:</strong></p>
<ul>
<li>C: 100%</li>
<li>Python: 692% (118% with PyPy)</li>
<li>Erlang: 436% (135% thanks to RichardC)</li>
<li>Haskell: 1421%</li>
</ul>
<p>I suppose that C has a big advantage as it uses long for the calculations and
not arbitrary length integers as the other three. Also it doesn't need to load
a runtime first (Do the others?).</p>
<p><strong>Question 1:</strong> Do Erlang, Python and Haskell lose speed due to using
arbitrary length integers or don't they as long as the values are less than
<code>MAXINT</code>?</p>
<p><strong>Question 2:</strong> Why is Haskell so slow? Is there a compiler flag that turns
off the brakes or is it my implementation? (The latter is quite probable as
Haskell is a book with seven seals to me.)</p>
<p><strong>Question 3:</strong> Can you offer me some hints how to optimize these
implementations without changing the way I determine the factors? Optimization
in any way: nicer, faster, more "native" to the language.</p>
<h4><strong>EDIT:</strong></h4>
<p><strong>Question 4:</strong> Do my functional implementations permit LCO (last call
optimization, a.k.a tail recursion elimination) and hence avoid adding
unnecessary frames onto the call stack?</p>
<p>I really tried to implement the same algorithm as similar as possible in the
four languages, although I have to admit that my Haskell and Erlang knowledge
is very limited.</p>
<hr>
<p>Source codes used:</p>
<div class="code"><pre class="code literal-block"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;math.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">factorCount</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">square</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">isquare</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">square</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isquare</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">square</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">candidate</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">candidate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">candidate</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">isquare</span><span class="p">;</span><span class="w"> </span><span class="n">candidate</span><span class="w"> </span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">candidate</span><span class="p">)</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">triangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">factorCount</span><span class="w"> </span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1001</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">index</span><span class="w"> </span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="n">triangle</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">index</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">"%ld</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">triangle</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<hr>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><span class="ch">#! /usr/bin/env python3.2</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><span class="kn">import</span> <span class="nn">math</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code><span class="k">def</span> <span class="nf">factorCount</span> <span class="p">(</span><span class="n">n</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code>    <span class="n">square</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code>    <span class="n">isquare</span> <span class="o">=</span> <span class="nb">int</span> <span class="p">(</span><span class="n">square</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code>    <span class="n">count</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">isquare</span> <span class="o">==</span> <span class="n">square</span> <span class="k">else</span> <span class="mi">0</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code>    <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">isquare</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-10"><code data-line-number="10"></code></a></td>
<td class="code"><code>        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="o">%</span> <span class="n">candidate</span><span class="p">:</span> <span class="n">count</span> <span class="o">+=</span> <span class="mi">2</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-11"><code data-line-number="11"></code></a></td>
<td class="code"><code>    <span class="k">return</span> <span class="n">count</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-12"><code data-line-number="12"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-13"><code data-line-number="13"></code></a></td>
<td class="code"><code><span class="n">triangle</span> <span class="o">=</span> <span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-14"><code data-line-number="14"></code></a></td>
<td class="code"><code><span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-15"><code data-line-number="15"></code></a></td>
<td class="code"><code><span class="k">while</span> <span class="n">factorCount</span> <span class="p">(</span><span class="n">triangle</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1001</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-16"><code data-line-number="16"></code></a></td>
<td class="code"><code>    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-17"><code data-line-number="17"></code></a></td>
<td class="code"><code>    <span class="n">triangle</span> <span class="o">+=</span> <span class="n">index</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-18"><code data-line-number="18"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/speed-comparison-with-project-euler-c-vs-python-vs-erlang-vs-haskell/#-19"><code data-line-number="19"></code></a></td>
<td class="code"><code><span class="nb">print</span> <span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
</code></td>
</tr>
</table></div>
<hr>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="n">module</span><span class="w"> </span><span class="p">(</span><span class="n">euler12</span><span class="p">)</span><span class="o">.</span>
<span class="o">-</span><span class="n">compile</span><span class="w"> </span><span class="p">(</span><span class="n">export_all</span><span class="p">)</span><span class="o">.</span>

<span class="n">factorCount</span><span class="w"> </span><span class="p">(</span><span class="n">Number</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">factorCount</span><span class="w"> </span><span class="p">(</span><span class="n">Number</span><span class="p">,</span><span class="w"> </span><span class="n">math</span><span class="p">:</span><span class="nb">sqrt</span><span class="w"> </span><span class="p">(</span><span class="n">Number</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="o">.</span>

<span class="n">factorCount</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">Sqrt</span><span class="p">,</span><span class="w"> </span><span class="n">Candidate</span><span class="p">,</span><span class="w"> </span><span class="n">Count</span><span class="p">)</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">Candidate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Sqrt</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Count</span><span class="p">;</span>

<span class="n">factorCount</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">Sqrt</span><span class="p">,</span><span class="w"> </span><span class="n">Candidate</span><span class="p">,</span><span class="w"> </span><span class="n">Count</span><span class="p">)</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">Candidate</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Sqrt</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="n">factorCount</span><span class="w"> </span><span class="p">(</span><span class="n">Number</span><span class="p">,</span><span class="w"> </span><span class="n">Sqrt</span><span class="p">,</span><span class="w"> </span><span class="n">Candidate</span><span class="p">,</span><span class="w"> </span><span class="n">Count</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">case</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="n">rem</span><span class="w"> </span><span class="n">Candidate</span><span class="w"> </span><span class="n">of</span>
<span class="w">        </span><span class="mi">0</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">factorCount</span><span class="w"> </span><span class="p">(</span><span class="n">Number</span><span class="p">,</span><span class="w"> </span><span class="n">Sqrt</span><span class="p">,</span><span class="w"> </span><span class="n">Candidate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">factorCount</span><span class="w"> </span><span class="p">(</span><span class="n">Number</span><span class="p">,</span><span class="w"> </span><span class="n">Sqrt</span><span class="p">,</span><span class="w"> </span><span class="n">Candidate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Count</span><span class="p">)</span>
<span class="w">    </span><span class="n">end</span><span class="o">.</span>

<span class="n">nextTriangle</span><span class="w"> </span><span class="p">(</span><span class="n">Index</span><span class="p">,</span><span class="w"> </span><span class="n">Triangle</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">Count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factorCount</span><span class="w"> </span><span class="p">(</span><span class="n">Triangle</span><span class="p">),</span>
<span class="w">    </span><span class="k">if</span>
<span class="w">        </span><span class="n">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Triangle</span><span class="p">;</span>
<span class="w">        </span><span class="bp">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">nextTriangle</span><span class="w"> </span><span class="p">(</span><span class="n">Index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Triangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">  </span>
<span class="w">    </span><span class="n">end</span><span class="o">.</span>

<span class="n">solve</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">io</span><span class="p">:</span><span class="n">format</span><span class="w"> </span><span class="p">(</span><span class="s2">"~p~n"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">nextTriangle</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">),</span>
<span class="w">    </span><span class="n">halt</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span>
</pre></div>

<hr>
<div class="code"><pre class="code literal-block"><span class="n">factorCount</span><span class="w"> </span><span class="k">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factorCount</span><span class="s1">' number isquare 1 0 - (fromEnum $ square == fromIntegral isquare)</span>
<span class="s1">    where square = sqrt $ fromIntegral number</span>
<span class="s1">          isquare = floor square</span>

<span class="s1">factorCount'</span><span class="w"> </span><span class="k">number</span><span class="w"> </span><span class="n">sqrt</span><span class="w"> </span><span class="n">candidate</span><span class="w"> </span><span class="n">count</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">fromIntegral</span><span class="w"> </span><span class="n">candidate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">sqrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="k">number</span><span class="w"> </span><span class="n n-Quoted">`mod`</span><span class="w"> </span><span class="n">candidate</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factorCount</span><span class="s1">' number sqrt (candidate + 1) (count + 2)</span>
<span class="s1">    | otherwise = factorCount'</span><span class="w"> </span><span class="k">number</span><span class="w"> </span><span class="nf">sqrt</span><span class="w"> </span><span class="p">(</span><span class="n">candidate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">count</span>

<span class="n">nextTriangle</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">triangle</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">factorCount</span><span class="w"> </span><span class="n">triangle</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">triangle</span>
<span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nextTriangle</span><span class="w"> </span><span class="p">(</span><span class="k">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">triangle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">print</span><span class="w"> </span><span class="n">$</span><span class="w"> </span><span class="n">nextTriangle</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>Using <code>GHC 7.0.3</code>, <code>gcc 4.4.6</code>, <code>Linux 2.6.29</code> on an x86_64 Core2 Duo (2.5GHz)
machine, compiling using <code>ghc -O2 -fllvm -fforce-recomp</code> for Haskell and <code>gcc
-O3 -lm</code> for C.</p>
<ul>
<li>Your C routine runs in 8.4 seconds (faster than your run probably because of <code>-O3</code>)</li>
<li>The Haskell solution runs in 36 seconds (due to the <code>-O2</code> flag)</li>
<li>Your <code>factorCount'</code> code isn't explicitly typed and defaulting to <code>Integer</code> (thanks to Daniel for correcting my misdiagnosis here!). Giving an explicit type signature (which is standard practice anyway) using <code>Int</code> and the time changes to <strong>11.1 seconds</strong>
</li>
<li>in <code>factorCount'</code> you have needlessly called <code>fromIntegral</code>. A fix results in no change though (the compiler is smart, lucky for you).</li>
<li>You used <code>mod</code> where <code>rem</code> is faster and sufficient. This changes the time to <strong>8.5 seconds</strong>.</li>
<li>
<p><code>factorCount'</code> is constantly applying two extra arguments that never change (<code>number</code>, <code>sqrt</code>). A worker/wrapper transformation gives us:</p>
<p>$ time ./so
 842161320  </p>
<p>real    0m7.954s<br>
 user    0m7.944s<br>
 sys     0m0.004s  </p>
</li>
</ul>
<p>That's right, <strong>7.95 seconds</strong>. Consistently <strong>half a second faster than the C
solution</strong>. Without the <code>-fllvm</code> flag I'm still getting <code>8.182 seconds</code>, so
the NCG backend is doing well in this case too.</p>
<p>Conclusion: Haskell is awesome.</p>
<p><strong>Resulting Code</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">factorCount</span><span class="w"> </span><span class="k">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factorCount</span><span class="s1">' number isquare 1 0 - (fromEnum $ square == fromIntegral isquare)</span>
<span class="s1">    where square = sqrt $ fromIntegral number</span>
<span class="s1">          isquare = floor square</span>

<span class="s1">factorCount'</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Int</span>
<span class="n">factorCount</span><span class="s1">' number sqrt candidate0 count0 = go candidate0 count0</span>
<span class="s1">  where</span>
<span class="s1">  go candidate count</span>
<span class="s1">    | candidate &gt; sqrt = count</span>
<span class="s1">    | number `rem` candidate == 0 = go (candidate + 1) (count + 2)</span>
<span class="s1">    | otherwise = go (candidate + 1) count</span>

<span class="s1">nextTriangle index triangle</span>
<span class="s1">    | factorCount triangle &gt; 1000 = triangle</span>
<span class="s1">    | otherwise = nextTriangle (index + 1) (triangle + index + 1)</span>

<span class="s1">main = print $ nextTriangle 1 1</span>
</pre></div>

<p>EDIT: So now that we've explored that, lets address the questions</p>
<blockquote>
<p>Question 1: Do erlang, python and haskell lose speed due to using arbitrary
length integers or don't they as long as the values are less than MAXINT?</p>
</blockquote>
<p>In Haskell, using <code>Integer</code> is slower than <code>Int</code> but how much slower depends
on the computations performed. Luckily (for 64 bit machines) <code>Int</code> is
sufficient. For portability sake you should probably rewrite my code to use
<code>Int64</code> or <code>Word64</code> (C isn't the only language with a <code>long</code>).</p>
<blockquote>
<p>Question 2: Why is haskell so slow? Is there a compiler flag that turns off
the brakes or is it my implementation? (The latter is quite probable as
haskell is a book with seven seals to me.)</p>
<p>Question 3: Can you offer me some hints how to optimize these
implementations without changing the way I determine the factors?
Optimization in any way: nicer, faster, more "native" to the language.</p>
</blockquote>
<p>That was what I answered above. The answer was</p>
<ul>
<li>0) Use optimization via <code>-O2</code>
</li>
<li>1) Use fast (notably: unbox-able) types when possible </li>
<li>2) <code>rem</code> not <code>mod</code> (a frequently forgotten optimization) and </li>
<li>3) worker/wrapper transformation (perhaps the most common optimization).</li>
</ul>
<blockquote>
<p>Question 4: Do my functional implementations permit LCO and hence avoid
adding unnecessary frames onto the call stack?</p>
</blockquote>
<p>Yes, that wasn't the issue. Good work and glad you considered this.</p>
<p><br></p>
<h3>Suggest</h3>
<p>There are some problems with the Erlang implementation. As baseline for the
following, my measured execution time for your unmodified Erlang program was
47.6 seconds, compared to 12.7 seconds for the C code.</p>
<p><em>(Edit: As of Erlang/OTP version 24, 2021, Erlang has an automatic JIT
compiler, and the old<code>+native</code> compiler option is no longer supported or
needed. I have left the paragraph below unchanged as a historical document.
The remarks about <code>export_all</code> are still somewhat valid for the JITs ability
to generate good code.)</em></p>
<p>The first thing you should do if you want to run computationally intensive
Erlang code is to use native code. Compiling with <code>erlc +native euler12</code> got
the time down to 41.3 seconds. This is however a much lower speedup (just 15%)
than expected from native compilation on this kind of code, and the problem is
your use of <code>-compile(export_all)</code>. This is useful for experimentation, but
the fact that all functions are potentially reachable from the outside causes
the native compiler to be very conservative. (The normal BEAM emulator is not
that much affected.) Replacing this declaration with <code>-export([solve/0]).</code>
gives a much better speedup: 31.5 seconds (almost 35% from the baseline).</p>
<p>But the code itself has a problem: for <em>each iteration</em> in the factorCount
loop, you perform this test:</p>
<div class="code"><pre class="code literal-block"><span class="n">factorCount</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="nf">Sqrt</span><span class="p">,</span><span class="w"> </span><span class="n">Candidate</span><span class="p">,</span><span class="w"> </span><span class="nf">Count</span><span class="p">)</span><span class="w"> </span><span class="kr">when</span><span class="w"> </span><span class="n">Candidate</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">Sqrt</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nf">Count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</pre></div>

<p>The C code doesn't do this. In general, it can be tricky to make a fair
comparison between different implementations of the same code, and in
particular if the algorithm is numerical, because you need to be sure that
they are actually doing the same thing. A slight rounding error in one
implementation due to some typecast somewhere may cause it to do many more
iterations than the other even though both eventually reach the same result.</p>
<p>To eliminate this possible error source (and get rid of the extra test in each
iteration), I rewrote the factorCount function as follows, closely modelled on
the C code:</p>
<div class="code"><pre class="code literal-block"><span class="nt">factorCount</span><span class="w"> </span><span class="o">(</span><span class="nt">N</span><span class="o">)</span><span class="w"> </span><span class="nt">-</span><span class="o">&gt;</span>
<span class="w">    </span><span class="nt">Sqrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">math</span><span class="p">:</span><span class="nd">sqrt</span><span class="w"> </span><span class="o">(</span><span class="nt">N</span><span class="o">),</span>
<span class="w">    </span><span class="nt">ISqrt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">trunc</span><span class="o">(</span><span class="nt">Sqrt</span><span class="o">),</span>
<span class="w">    </span><span class="nt">if</span><span class="w"> </span><span class="nt">ISqrt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nt">Sqrt</span><span class="w"> </span><span class="nt">-</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">factorCount</span><span class="w"> </span><span class="o">(</span><span class="nt">N</span><span class="o">,</span><span class="w"> </span><span class="nt">ISqrt</span><span class="o">,</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">-1</span><span class="o">);</span>
<span class="w">       </span><span class="nt">true</span><span class="w">          </span><span class="nt">-</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">factorCount</span><span class="w"> </span><span class="o">(</span><span class="nt">N</span><span class="o">,</span><span class="w"> </span><span class="nt">ISqrt</span><span class="o">,</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">0</span><span class="o">)</span>
<span class="w">    </span><span class="nt">end</span><span class="o">.</span>

<span class="nt">factorCount</span><span class="w"> </span><span class="o">(</span><span class="nt">_N</span><span class="o">,</span><span class="w"> </span><span class="nt">ISqrt</span><span class="o">,</span><span class="w"> </span><span class="nt">Candidate</span><span class="o">,</span><span class="w"> </span><span class="nt">Count</span><span class="o">)</span><span class="w"> </span><span class="nt">when</span><span class="w"> </span><span class="nt">Candidate</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nt">ISqrt</span><span class="w"> </span><span class="nt">-</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">Count</span><span class="o">;</span>
<span class="nt">factorCount</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="nt">N</span><span class="o">,</span><span class="w"> </span><span class="nt">ISqrt</span><span class="o">,</span><span class="w"> </span><span class="nt">Candidate</span><span class="o">,</span><span class="w"> </span><span class="nt">Count</span><span class="o">)</span><span class="w"> </span><span class="nt">-</span><span class="o">&gt;</span>
<span class="w">    </span><span class="nt">case</span><span class="w"> </span><span class="nt">N</span><span class="w"> </span><span class="nt">rem</span><span class="w"> </span><span class="nt">Candidate</span><span class="w"> </span><span class="nt">of</span>
<span class="w">        </span><span class="nt">0</span><span class="w"> </span><span class="nt">-</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">factorCount</span><span class="w"> </span><span class="o">(</span><span class="nt">N</span><span class="o">,</span><span class="w"> </span><span class="nt">ISqrt</span><span class="o">,</span><span class="w"> </span><span class="nt">Candidate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">Count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">2</span><span class="o">);</span>
<span class="w">        </span><span class="nt">_</span><span class="w"> </span><span class="nt">-</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">factorCount</span><span class="w"> </span><span class="o">(</span><span class="nt">N</span><span class="o">,</span><span class="w"> </span><span class="nt">ISqrt</span><span class="o">,</span><span class="w"> </span><span class="nt">Candidate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">1</span><span class="o">,</span><span class="w"> </span><span class="nt">Count</span><span class="o">)</span>
<span class="w">    </span><span class="nt">end</span><span class="o">.</span>
</pre></div>

<p>This rewrite, no <code>export_all</code>, and native compilation, gave me the following
run time:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>erlc<span class="w"> </span>+native<span class="w"> </span>euler12.erl
$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>erl<span class="w"> </span>-noshell<span class="w"> </span>-s<span class="w"> </span>euler12<span class="w"> </span>solve
<span class="m">842161320</span>

real<span class="w">    </span>0m19.468s
user<span class="w">    </span>0m19.450s
sys<span class="w"> </span>0m0.010s
</pre></div>

<p>which is not too bad compared to the C code:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span><span class="nb">time</span><span class="w"> </span>./a.out<span class="w"> </span>
<span class="m">842161320</span>

real<span class="w">    </span>0m12.755s
user<span class="w">    </span>0m12.730s
sys<span class="w"> </span>0m0.020s
</pre></div>

<p>considering that Erlang is not at all geared towards writing numerical code,
being only 50% slower than C on a program like this is pretty good.</p>
<p>Finally, regarding your questions:</p>
<p><strong>Question 1: Do erlang, python and haskell loose speed due to using arbitrary
length integers or don't they as long as the values are less than MAXINT?</strong></p>
<p>Yes, somewhat. In Erlang, there is no way of saying "use 32/64-bit arithmetic
with wrap-around", so unless the compiler can prove some bounds on your
integers (and it usually can't), it must check all computations to see if they
can fit in a single tagged word or if it has to turn them into heap-allocated
bignums. Even if no bignums are ever used in practice at runtime, these checks
will have to be performed. On the other hand, that means you <em>know</em> that the
algorithm will never fail because of an unexpected integer wraparound if you
suddenly give it larger inputs than before.</p>
<p><strong>Question 4: Do my functional implementations permit LCO and hence avoid
adding unnecessary frames onto the call stack?</strong></p>
<p>Yes, your Erlang code is correct with respect to last call optimization.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-804.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-802.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
