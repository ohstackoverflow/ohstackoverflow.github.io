<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1139) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1139.html">
<link rel="prev" href="index-1140.html" type="text/html">
<link rel="next" href="index-1138.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/update-and-replace-part-of-a-string/" class="u-url">UPDATE and REPLACE part of a string</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/update-and-replace-part-of-a-string/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T02:12:04+08:00" itemprop="datePublished" title="2023-02-18 02:12">2023-02-18 02:12</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've got a table with two columns, <code>ID</code> and <code>Value</code>. I want to change a part
of some strings in the second column.</p>
<p>Example of Table:</p>
<div class="code"><pre class="code literal-block">ID            Value
---------------------------------
1             c:\temp\123\abc\111
2             c:\temp\123\abc\222
3             c:\temp\123\abc\333
4             c:\temp\123\abc\444
</pre></div>

<p>Now the <code>123\</code> in the <code>Value</code> string is not needed. I tried <code>UPDATE</code> and
<code>REPLACE</code>:</p>
<div class="code"><pre class="code literal-block">UPDATE dbo.xxx
SET Value = REPLACE(Value, '%123%', '')
WHERE ID &lt;= 4
</pre></div>

<p>When I execute the script SQL Server does not report an error, but it does not
update anything either. Why is that?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You don't need wildcards in the <code>REPLACE</code> - it just finds the string you
enter for the second argument, so the following should work:</p>
<div class="code"><pre class="code literal-block">UPDATE dbo.xxx
SET Value = REPLACE(Value, '123', '')
WHERE ID &lt;=4
</pre></div>

<p>If the column to replace is type <code>text</code> or <code>ntext</code> you need to cast it to
nvarchar</p>
<div class="code"><pre class="code literal-block">UPDATE dbo.xxx
SET Value = REPLACE(CAST(Value as nVarchar(4000)), '123', '')
WHERE ID &lt;=4
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Try to remove <code>%</code> chars as below</p>
<div class="code"><pre class="code literal-block">UPDATE dbo.xxx
SET Value = REPLACE(Value, '123', '')
WHERE ID &lt;=4
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-would-git-handle-a-sha-1-collision-on-a-blob/" class="u-url">How would Git handle a SHA-1 collision on a blob?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-would-git-handle-a-sha-1-collision-on-a-blob/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T02:11:38+08:00" itemprop="datePublished" title="2023-02-18 02:11">2023-02-18 02:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>This probably never happened in the real-world yet, and may never happen, but
let's consider this: say you have a git repository, make a commit, and get
very very unlucky: one of the blobs ends up having the same SHA-1 as another
that is already in your repository. Question is, how would Git handle this?
Simply fail? Find a way to link the two blobs and check which one is needed
according to the context?</p>
<p>More a brain-teaser than an actual problem, but I found the issue interesting.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I did an experiment to find out exactly how Git would behave in this case.
This is with version 2.7.9~rc0+next.20151210 (Debian version). I basically
just reduced the hash size from 160-bit to 4-bit by applying the following
diff and rebuilding git:</p>
<div class="code"><pre class="code literal-block"><span class="gd">--- git-2.7.0~rc0+next.20151210.orig/block-sha1/sha1.c</span>
<span class="gi">+++ git-2.7.0~rc0+next.20151210/block-sha1/sha1.c</span>
<span class="gu">@@ -246,6 +246,8 @@ void blk_SHA1_Final(unsigned char hashou</span>
<span class="w"> </span>   blk_SHA1_Update(ctx, padlen, 8);

<span class="w"> </span>   /* Output hash */
<span class="gd">-   for (i = 0; i &lt; 5; i++)</span>
<span class="gd">-       put_be32(hashout + i * 4, ctx-&gt;H[i]);</span>
<span class="gi">+   for (i = 0; i &lt; 1; i++)</span>
<span class="gi">+       put_be32(hashout + i * 4, (ctx-&gt;H[i] &amp; 0xf000000));</span>
<span class="gi">+   for (i = 1; i &lt; 5; i++)</span>
<span class="gi">+       put_be32(hashout + i * 4, 0);</span>
<span class="w"> </span>}
</pre></div>

<p>Then I did a few commits and noticed the following.</p>
<ol>
<li>If a blob already exists with the same hash, you will not get any warnings at all. Everything seems to be ok, but when you push, someone clones, or you revert, you will lose the latest version (in line with what is explained above).</li>
<li>If a tree object already exists and you make a blob with the same hash: Everything will seem normal, until you either try to push or someone clones your repository. Then you will see that the repo is corrupt.</li>
<li>If a commit object already exists and you make a blob with the same hash: same as #2 - corrupt</li>
<li>If a blob already exists and you make a commit object with the same hash, it will fail when updating the "ref".</li>
<li>If a blob already exists and you make a tree object with the same hash. It will fail when creating the commit.</li>
<li>If a tree object already exists and you make a commit object with the same hash, it will fail when updating the "ref".</li>
<li>If a tree object already exists and you make a tree object with the same hash, everything will seem ok. But when you commit, all of the repository will reference the wrong tree.</li>
<li>If a commit object already exists and you make a commit object with the same hash, everything will seem ok. But when you commit, the commit will never be created, and the HEAD pointer will be moved to an old commit.</li>
<li>If a commit object already exists and you make a tree object with the same hash, it will fail when creating the commit.</li>
</ol>
<p>For #2 you will typically get an error like this when you run "git push":</p>
<div class="code"><pre class="code literal-block"><span class="n">error</span><span class="o">:</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="mi">0400000000000000000000000000000000000000</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">tree</span><span class="o">,</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">blob</span>
<span class="n">fatal</span><span class="o">:</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">blob</span><span class="w"> </span><span class="n">object</span>
<span class="n">error</span><span class="o">:</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">push</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">refs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">origin</span>
</pre></div>

<p>or:</p>
<div class="code"><pre class="code literal-block"><span class="n">error</span><span class="o">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">sha1</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">file</span><span class="o">.</span><span class="na">txt</span><span class="w"> </span><span class="o">(</span><span class="mi">0400000000000000000000000000000000000000</span><span class="o">)</span>
</pre></div>

<p>if you delete the file and then run "git checkout file.txt".</p>
<p>For #4 and #6, you will typically get an error like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">error</span><span class="o">:</span><span class="w"> </span><span class="n">Trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">commit</span><span class="w"> </span><span class="n">object</span>
<span class="n">f000000000000000000000000000000000000000</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="n">refs</span><span class="sr">/heads/</span><span class="n">master</span>
<span class="n">fatal</span><span class="o">:</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">HEAD</span><span class="w"> </span><span class="n">ref</span>
</pre></div>

<p>when running "git commit". In this case you can typically just type "git
commit" again since this will create a new hash (because of the changed
timestamp)</p>
<p>For #5 and #9, you will typically get an error like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">fatal</span><span class="o">:</span><span class="w"> </span><span class="mi">1000000000000000000000000000000000000000</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="s1">'tree'</span><span class="w"> </span><span class="n">object</span>
</pre></div>

<p>when running "git commit"</p>
<p>If someone tries to clone your corrupt repository, they will typically see
something like:</p>
<div class="code"><pre class="code literal-block">git clone (one repo with collided blob,
d000000000000000000000000000000000000000 is commit,
f000000000000000000000000000000000000000 is tree)

Cloning into 'clonedversion'...
done.
error: unable to read sha1 file of s (d000000000000000000000000000000000000000)
error: unable to read sha1 file of tullebukk
(f000000000000000000000000000000000000000)
fatal: unable to checkout working tree
warning: Clone succeeded, but checkout failed.
You can inspect what was checked out with 'git status'
and retry the checkout with 'git checkout -f HEAD'
</pre></div>

<p>What "worries" me is that in two cases (2,3) the repository becomes corrupt
without any warnings, and in 3 cases (1,7,8), everything seems ok, but the
repository content is different than what you expect it to be. People cloning
or pulling will have a different content than what you have. The cases 4,5,6
and 9 are ok, since it will stop with an error. I suppose it would be better
if it failed with an error at least in all cases.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Original answer (2012) (see <code>shattered.io</code> 2017 SHA1 collision below)</p>
<p>That old (2006) answer from Linus might still be relevant:</p>
<blockquote>
<p>Nope. If it has the same SHA1, it means that when we receive the object from
the other end, we will <em>not</em> overwrite the object we already have.</p>
<p>So what happens is that if we ever see a collision, the "earlier" object in
any particular repository will always end up overriding. But note that
"earlier" is obviously per-repository, in the sense that the git object
network generates a DAG that is not fully ordered, so while different
repositories will agree about what is "earlier" in the case of direct
ancestry, if the object came through separate and not directly related
branches, two different repos may obviously have gotten the two objects in
different order.</p>
<p>However, the "earlier will override" is very much what you want from a
security standpoint: remember that the git model is that you should
primarily trust only your <em>own</em> repository.<br>
 So if you do a "<code>git pull</code>", the new incoming objects are by definition
less trustworthy than the objects you already have, and as such it would be
wrong to allow a new object to replace an old one.</p>
<p>So you have two cases of collision:</p>
<ul>
<li>
<p>the <strong>inadvertent kind</strong> , where you somehow are very very unlucky, and
two files end up having the same SHA1.<br>
 At that point, what happens is that when you commit that file (or do a
"<code>git-update-index</code>" to move it into the index, but not committed yet), the
SHA1 of the new contents will be computed, but <strong>since it matches an old
object, a new object won't be created, and the commit-or-index ends up
pointing to the <em>old</em> object</strong>.<br>
 You won't notice immediately (since the index will match the old object
SHA1, and that means that something like "<code>git diff</code>" will use the checked-
out copy), but if you ever do a tree-level diff (or you do a clone or pull,
or force a checkout) you'll suddenly notice that that file has changed to
something <em>completely</em> different than what you expected.<br>
 So you would generally notice this kind of collision fairly quickly.<br>
 In related news, the question is what to do about the inadvertent
collision..<br>
 First off, let me remind people that the inadvertent kind of collision is
really really <em>really</em> damn unlikely, so we'll quite likely never ever see
it in the full history of the universe.<br>
 But <em>if</em> it happens, it's not the end of the world: <strong>what you'd most
likely have to do is just change the file that collided slightly, and just
force a new commit with the changed contents</strong> (add a comment saying "<code>/*
This line added to avoid collision */</code>") and then teach git about the magic
SHA1 that has been shown to be dangerous.<br>
 So over a couple of million years, maybe we'll have to add one or two
"poisoned" SHA1 values to git. It's very unlikely to be a maintenance
problem ;)</p>
</li>
<li>
<p>The <strong>attacker kind of collision</strong> because somebody broke (or brute-
forced) SHA1.<br>
 This one is clearly a <em>lot</em> more likely than the inadvertent kind, but by
definition it's always a "remote" repository. If the attacker had access to
the local repository, he'd have much easier ways to screw you up.<br>
 So in this case, <strong>the collision is entirely a non-issue</strong> : you'll get a
"bad" repository that is different from what the attacker intended, but
<strong>since you'll never actually use his colliding object, it's <em>literally</em> no
different from the attacker just not having found a collision at all</strong>, but
just using the object you already had (ie it's 100% equivalent to the
"trivial" collision of the identical file generating the same SHA1).</p>
</li>
</ul>
</blockquote>
<p>The question of using SHA-256 is regularly mentioned, but not act upon for now
(2012).<br>
Note: starting 2018 and Git 2.19, the code is being refactored to use SHA-256.</p>
<hr>
<p>Note (Humor): you can force a commit to a particular SHA1 <em>prefix</em> , with the
project <strong>gitbrute</strong> from Brad Fitzpatrick (<code>bradfitz</code>).</p>
<blockquote>
<p>gitbrute brute-forces a pair of author+committer timestamps such that the
resulting git commit has your desired prefix.</p>
</blockquote>
<p>Example: https://github.com/bradfitz/deadbeef</p>
<hr>
<p>Daniel Dinnyes points out in the comments to 7.1 Git Tools - Revision
Selection, which includes:</p>
<blockquote>
<p>A higher probability exists that every member of your programming team will
be attacked and killed by wolves in unrelated incidents on the same night.</p>
</blockquote>
<hr>
<p>Even the more recently (February 2017) <strong><code>shattered.io</code></strong> demonstrated the
possibility of forging a SHA1 collision:<br>
(see much more in my <strong>separate answer</strong> , including Linus Torvalds' Google+
post)</p>
<ul>
<li>a/ still requires over 9,223,372,036,854,775,808 SHA1 computations. This took the equivalent processing power as 6,500 years of single-CPU computations and 110 years of single-GPU computations. </li>
<li>b/ would forge <em>one</em> file (with the same SHA1), but with the additional constraint its content <em>and</em> size would produce the identical SHA1 (a collision on the content alone is not enough): see "How is the git hash calculated?"): a blob SHA1 is computed based on the content <em>and</em> size.</li>
</ul>
<p>See "Lifetimes of cryptographic hash functions" from <strong>Valerie Anita Aurora</strong>
for more.<br>
In that page, she notes:</p>
<blockquote>
<p>Google spent 6500 CPU years and 110 GPU years to convince everyone we need
to stop using SHA-1 for security critical applications.<br>
 Also because it was cool</p>
</blockquote>
<p>See more in my <strong>separate answer below</strong>.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-you-detect-credit-card-type-based-on-number/" class="u-url">How do you detect Credit card type based on number?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-you-detect-credit-card-type-based-on-number/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T02:11:09+08:00" itemprop="datePublished" title="2023-02-18 02:11">2023-02-18 02:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to figure out how to detect the type of credit card based purely on
its number. Does anyone know of a definitive, reliable way to find this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The credit/debit card number is referred to as a <strong>PAN</strong> , or <em>Primary Account
Number</em>. The first six digits of the PAN are taken from the <strong>IIN</strong> , or
<em>Issuer Identification Number</em> , belonging to the issuing bank (IINs were
previously known as BIN — Bank Identification Numbers — so you may see
references to that terminology in some documents). These six digits are
subject to an international standard, ISO/IEC 7812, and can be used to
determine the type of card from the number.</p>
<p>Unfortunately the actual ISO/IEC 7812 database is not publicly available,
however, there are unofficial lists, both commercial and free, including on
Wikipedia.</p>
<p>Anyway, to detect the type from the number, you can use a regular expression
like the ones below: Credit for original expressions</p>
<p><strong>Visa:</strong> <code>^4[0-9]{6,}$</code> Visa card numbers start with a 4.</p>
<p><strong>MasterCard:</strong>
<code>^5[1-5][0-9]{5,}|222[1-9][0-9]{3,}|22[3-9][0-9]{4,}|2[3-6][0-9]{5,}|27[01][0-9]{4,}|2720[0-9]{3,}$</code>
Before 2016, MasterCard numbers start with the numbers 51 through 55, <strong>but
this will only detect MasterCard credit cards</strong> ; there are other cards issued
using the MasterCard system that do not fall into this IIN range. In 2016,
they will add numbers in the range (222100-272099).</p>
<p><strong>American Express:</strong> <code>^3[47][0-9]{5,}$</code> American Express card numbers start
with 34 or 37.</p>
<p><strong>Diners Club:</strong> <code>^3(?:0[0-5]|[68][0-9])[0-9]{4,}$</code> Diners Club card numbers
begin with 300 through 305, 36 or 38. There are Diners Club cards that begin
with 5 and have 16 digits. These are a joint venture between Diners Club and
MasterCard and should be processed like a MasterCard.</p>
<p><strong>Discover:</strong> <code>^6(?:011|5[0-9]{2})[0-9]{3,}$</code> Discover card numbers begin with
6011 or 65.</p>
<p><strong>JCB:</strong> <code>^(?:2131|1800|35[0-9]{3})[0-9]{3,}$</code> JCB cards begin with 2131, 1800
or 35.</p>
<p>Unfortunately, there are a number of card types processed with the MasterCard
system that do not live in MasterCard’s IIN range (numbers starting 51...55);
the most important case is that of Maestro cards, many of which have been
issued from other banks’ IIN ranges and so are located all over the number
space. As a result, <strong>it may be best to assume that any card that is not of
some other type you accept must be a MasterCard</strong>.</p>
<p><strong>Important</strong> : card numbers do vary in length; for instance, Visa has in the
past issued cards with 13 digit PANs and cards with 16 digit PANs. Visa’s
documentation currently indicates that it may issue or may have issued numbers
with between 12 and 19 digits. <strong>Therefore, you should not check the length of
the card number, other than to verify that it has at least 7 digits</strong> (for a
complete IIN plus one check digit, which should match the value predicted by
the Luhn algorithm).</p>
<p>One further hint: <strong>before processing a cardholder PAN, strip any whitespace
and punctuation characters from the input</strong>. Why? Because it’s typically
<em>much</em> easier to enter the digits in groups, similar to how they’re displayed
on the front of an actual credit card, i.e.</p>
<div class="code"><pre class="code literal-block"><span class="mf">4444</span><span class="w"> </span><span class="mf">4444</span><span class="w"> </span><span class="mf">4444</span><span class="w"> </span><span class="mf">4444</span>
</pre></div>

<p>is much easier to enter correctly than</p>
<div class="code"><pre class="code literal-block"><span class="mf">4444444444444444</span>
</pre></div>

<p>There’s really no benefit in chastising the user because they’ve entered
characters you don't expect here.</p>
<p><strong>This also implies making sure that your entry fields have room for <em>at
least</em> 24 characters, otherwise users who enter spaces will run out of room.</strong>
I’d recommend that you make the field wide enough to display 32 characters and
allow up to 64; that gives plenty of headroom for expansion.</p>
<p>Here's an image that gives a little more insight:</p>
<p><strong>UPDATE (2016):</strong> Mastercard is to implement new BIN ranges starting Ach
Payment.</p>
<p><img alt="Credit Card Verification" src="images/Cu7PG.jpg"></p>
<p><br></p>
<h3>Suggest</h3>
<p>In javascript:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">detectCardType</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nf">var</span><span class="w"> </span><span class="n">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="nl">electron</span><span class="p">:</span><span class="w"> </span><span class="o">/^</span><span class="p">(</span><span class="mi">4026</span><span class="o">|</span><span class="mi">417500</span><span class="o">|</span><span class="mi">4405</span><span class="o">|</span><span class="mi">4508</span><span class="o">|</span><span class="mi">4844</span><span class="o">|</span><span class="mi">4913</span><span class="o">|</span><span class="mi">4917</span><span class="p">)</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="err">$</span><span class="o">/</span><span class="p">,</span>
<span class="w">        </span><span class="nl">maestro</span><span class="p">:</span><span class="w"> </span><span class="o">/^</span><span class="p">(</span><span class="mi">5018</span><span class="o">|</span><span class="mi">5020</span><span class="o">|</span><span class="mi">5038</span><span class="o">|</span><span class="mi">5612</span><span class="o">|</span><span class="mi">5893</span><span class="o">|</span><span class="mi">6304</span><span class="o">|</span><span class="mi">6759</span><span class="o">|</span><span class="mi">6761</span><span class="o">|</span><span class="mi">6762</span><span class="o">|</span><span class="mi">6763</span><span class="o">|</span><span class="mi">0604</span><span class="o">|</span><span class="mi">6390</span><span class="p">)</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="err">$</span><span class="o">/</span><span class="p">,</span>
<span class="w">        </span><span class="nl">dankort</span><span class="p">:</span><span class="w"> </span><span class="o">/^</span><span class="p">(</span><span class="mi">5019</span><span class="p">)</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="err">$</span><span class="o">/</span><span class="p">,</span>
<span class="w">        </span><span class="nl">interpayment</span><span class="p">:</span><span class="w"> </span><span class="o">/^</span><span class="p">(</span><span class="mi">636</span><span class="p">)</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="err">$</span><span class="o">/</span><span class="p">,</span>
<span class="w">        </span><span class="nl">unionpay</span><span class="p">:</span><span class="w"> </span><span class="o">/^</span><span class="p">(</span><span class="mi">62</span><span class="o">|</span><span class="mi">88</span><span class="p">)</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="err">$</span><span class="o">/</span><span class="p">,</span>
<span class="w">        </span><span class="nl">visa</span><span class="p">:</span><span class="w"> </span><span class="o">/^</span><span class="mi">4</span><span class="o">[</span><span class="n">0-9</span><span class="o">]</span><span class="err">{</span><span class="mi">12</span><span class="err">}</span><span class="p">(</span><span class="vm">?</span><span class="err">:</span><span class="o">[</span><span class="n">0-9</span><span class="o">]</span><span class="err">{</span><span class="mi">3</span><span class="err">}</span><span class="p">)</span><span class="vm">?</span><span class="err">$</span><span class="o">/</span><span class="p">,</span>
<span class="w">        </span><span class="nl">mastercard</span><span class="p">:</span><span class="w"> </span><span class="o">/^</span><span class="mi">5</span><span class="o">[</span><span class="n">1-5</span><span class="o">][</span><span class="n">0-9</span><span class="o">]</span><span class="err">{</span><span class="mi">14</span><span class="err">}$</span><span class="o">/</span><span class="p">,</span>
<span class="w">        </span><span class="nl">amex</span><span class="p">:</span><span class="w"> </span><span class="o">/^</span><span class="mi">3</span><span class="o">[</span><span class="n">47</span><span class="o">][</span><span class="n">0-9</span><span class="o">]</span><span class="err">{</span><span class="mi">13</span><span class="err">}$</span><span class="o">/</span><span class="p">,</span>
<span class="w">        </span><span class="nl">diners</span><span class="p">:</span><span class="w"> </span><span class="o">/^</span><span class="mi">3</span><span class="p">(</span><span class="vm">?</span><span class="err">:</span><span class="mi">0</span><span class="o">[</span><span class="n">0-5</span><span class="o">]|[</span><span class="n">68</span><span class="o">][</span><span class="n">0-9</span><span class="o">]</span><span class="p">)</span><span class="o">[</span><span class="n">0-9</span><span class="o">]</span><span class="err">{</span><span class="mi">11</span><span class="err">}$</span><span class="o">/</span><span class="p">,</span>
<span class="w">        </span><span class="nl">discover</span><span class="p">:</span><span class="w"> </span><span class="o">/^</span><span class="mi">6</span><span class="p">(</span><span class="vm">?</span><span class="err">:</span><span class="mi">011</span><span class="o">|</span><span class="mi">5</span><span class="o">[</span><span class="n">0-9</span><span class="o">]</span><span class="err">{</span><span class="mi">2</span><span class="err">}</span><span class="p">)</span><span class="o">[</span><span class="n">0-9</span><span class="o">]</span><span class="err">{</span><span class="mi">12</span><span class="err">}$</span><span class="o">/</span><span class="p">,</span>
<span class="w">        </span><span class="nl">jcb</span><span class="p">:</span><span class="w"> </span><span class="o">/^</span><span class="p">(</span><span class="vm">?</span><span class="err">:</span><span class="mi">2131</span><span class="o">|</span><span class="mi">1800</span><span class="o">|</span><span class="mi">35</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">3</span><span class="err">}</span><span class="p">)</span><span class="err">\</span><span class="n">d</span><span class="err">{</span><span class="mi">11</span><span class="err">}$</span><span class="o">/</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nf">var</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">re</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">re</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="p">.</span><span class="n">test</span><span class="p">(</span><span class="n">number</span><span class="p">))</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">key</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>Unit test:</p>
<div class="code"><pre class="code literal-block"><span class="k">describe</span><span class="p">(</span><span class="s1">'CreditCard'</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">describe</span><span class="p">(</span><span class="s1">'#detectCardType'</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>

<span class="w">        </span><span class="nf">var</span><span class="w"> </span><span class="n">cards</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="s1">'8800000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'UNIONPAY'</span><span class="p">,</span>

<span class="w">            </span><span class="s1">'4026000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'ELECTRON'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'4175000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'ELECTRON'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'4405000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'ELECTRON'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'4508000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'ELECTRON'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'4844000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'ELECTRON'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'4913000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'ELECTRON'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'4917000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'ELECTRON'</span><span class="p">,</span>

<span class="w">            </span><span class="s1">'5019000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'DANKORT'</span><span class="p">,</span>

<span class="w">            </span><span class="s1">'5018000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MAESTRO'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'5020000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MAESTRO'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'5038000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MAESTRO'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'5612000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MAESTRO'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'5893000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MAESTRO'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'6304000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MAESTRO'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'6759000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MAESTRO'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'6761000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MAESTRO'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'6762000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MAESTRO'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'6763000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MAESTRO'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'0604000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MAESTRO'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'6390000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MAESTRO'</span><span class="p">,</span>

<span class="w">            </span><span class="s1">'3528000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'JCB'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'3589000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'JCB'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'3529000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'JCB'</span><span class="p">,</span>

<span class="w">            </span><span class="s1">'6360000000000000'</span><span class="err">:</span><span class="w"> </span><span class="s1">'INTERPAYMENT'</span><span class="p">,</span>

<span class="w">            </span><span class="s1">'4916338506082832'</span><span class="err">:</span><span class="w"> </span><span class="s1">'VISA'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'4556015886206505'</span><span class="err">:</span><span class="w"> </span><span class="s1">'VISA'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'4539048040151731'</span><span class="err">:</span><span class="w"> </span><span class="s1">'VISA'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'4024007198964305'</span><span class="err">:</span><span class="w"> </span><span class="s1">'VISA'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'4716175187624512'</span><span class="err">:</span><span class="w"> </span><span class="s1">'VISA'</span><span class="p">,</span>

<span class="w">            </span><span class="s1">'5280934283171080'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MASTERCARD'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'5456060454627409'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MASTERCARD'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'5331113404316994'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MASTERCARD'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'5259474113320034'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MASTERCARD'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'5442179619690834'</span><span class="err">:</span><span class="w"> </span><span class="s1">'MASTERCARD'</span><span class="p">,</span>

<span class="w">            </span><span class="s1">'6011894492395579'</span><span class="err">:</span><span class="w"> </span><span class="s1">'DISCOVER'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'6011388644154687'</span><span class="err">:</span><span class="w"> </span><span class="s1">'DISCOVER'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'6011880085013612'</span><span class="err">:</span><span class="w"> </span><span class="s1">'DISCOVER'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'6011652795433988'</span><span class="err">:</span><span class="w"> </span><span class="s1">'DISCOVER'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'6011375973328347'</span><span class="err">:</span><span class="w"> </span><span class="s1">'DISCOVER'</span><span class="p">,</span>

<span class="w">            </span><span class="s1">'345936346788903'</span><span class="err">:</span><span class="w"> </span><span class="s1">'AMEX'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'377669501013152'</span><span class="err">:</span><span class="w"> </span><span class="s1">'AMEX'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'373083634595479'</span><span class="err">:</span><span class="w"> </span><span class="s1">'AMEX'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'370710819865268'</span><span class="err">:</span><span class="w"> </span><span class="s1">'AMEX'</span><span class="p">,</span>
<span class="w">            </span><span class="s1">'371095063560404'</span><span class="err">:</span><span class="w"> </span><span class="s1">'AMEX'</span>
<span class="w">        </span><span class="err">}</span><span class="p">;</span>

<span class="w">        </span><span class="k">Object</span><span class="p">.</span><span class="n">keys</span><span class="p">(</span><span class="n">cards</span><span class="p">).</span><span class="n">forEach</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">it</span><span class="p">(</span><span class="s1">'should detect card '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' as '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cards</span><span class="o">[</span><span class="n">number</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="n">Basket</span><span class="p">.</span><span class="n">detectCardType</span><span class="p">(</span><span class="n">number</span><span class="p">).</span><span class="n">should</span><span class="p">.</span><span class="n">equal</span><span class="p">(</span><span class="n">cards</span><span class="o">[</span><span class="n">number</span><span class="o">]</span><span class="p">);</span>
<span class="w">            </span><span class="err">}</span><span class="p">);</span>
<span class="w">        </span><span class="err">}</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span><span class="p">);</span>
<span class="err">}</span><span class="p">);</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1140.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1138.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
