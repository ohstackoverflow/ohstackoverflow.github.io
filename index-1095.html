<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1095) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1095.html">
<link rel="prev" href="index-1096.html" type="text/html">
<link rel="next" href="index-1094.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/shi-yao-shi-blob-url-yi-ji-wei-shi-yao-yao-shi-yong-ta/" class="u-url">什么是 blob URL 以及为什么要使用它？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/shi-yao-shi-blob-url-yi-ji-wei-shi-yao-yao-shi-yong-ta/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T01:21:21+08:00" itemprop="datePublished" title="2023-02-18 01:21">2023-02-18 01:21</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我在使用 URL 时遇到问题<code>blob</code>。</p>
<p>我在 YouTube 上搜索<code>src</code>一个<code>video</code>标签，发现视频<code>src</code>是这样的：</p>
<div class="code"><pre class="code literal-block">src="blob:https://video_url"
</pre></div>

<p>我打开视频<code>blob</code>中的 URL <code>src</code>，但出现错误。我无法打开链接，但它正在使用标签<code>src</code>。这怎么可能？</p>
<p>我有几个问题：</p>
<ul>
<li>什么是<code>blob</code>网址？</li>
<li>为什么使用它？</li>
<li>
<code>blob</code>我可以在服务器上创建自己的URL 吗？</li>
</ul>
<p>有关 URL 的任何其他详细信息<code>blob</code>也会有所帮助。</p>
<p><br><br></p>
<h2>解答</h2>
<p>Blob URL（参考W3C，官方名称）或对象 URL（参考MDN和方法名称）与Blob或File对象一起使用。</p>
<blockquote>
<p>src="blob:https://crap.crap" 我打开了视频 src 中的 blob url，但出现错误，我无法打开，但正在使用 src
标签，这怎么可能？</p>
</blockquote>
<p>Blob URL 只能由浏览器在内部生成。<code>URL.createObjectURL()</code>将创建对 Blob 或 File
对象的特殊引用，稍后可以使用<code>URL.revokeObjectURL()</code>. 这些 URL
只能在浏览器的单个实例和同一会话（即页面/文档的生命周期）中本地使用。</p>
<blockquote>
<p>什么是 blob 网址？<br>
为什么使用它？</p>
</blockquote>
<p>Blob URL/Object URL 是一种伪协议，允许将 Blob 和 File 对象用作图像、二进制数据的下载链接等内容的 URL 源。</p>
<p>例如，您不能将原始字节数据交给 Image 对象，因为它不知道如何处理它。例如，它需要通过 URL 加载图像（二进制数据）。这适用于任何需要 URL
作为来源的内容。与其上传二进制数据，然后通过 URL 返回数据，不如使用额外的本地步骤来直接访问数据，而无需通过服务器。</p>
<p>它也是 Data-URI 的更好替代方案，Data-URI 是编码为Base-64的字符串。Data-URI 的问题是每个字符在 JavaScript
中占用两个字节。最重要的是，由于 Base-64 编码，增加了 33%。Blob 是纯二进制字节数组，不像 Data-URI
那样有任何显着的开销，这使得它们处理起来更快、更小。</p>
<blockquote>
<p>我可以在服务器上创建自己的 blob url 吗？</p>
</blockquote>
<p>不，Blob URLs/Object URLs 只能在浏览器内部生成。您可以通过 File Reader API 创建 Blob 并获取 File
对象，尽管 BLOB 仅表示 Binary Large OBject 并存储为字节数组。客户端可以请求将数据作为 ArrayBuffer 或 Blob
发送。服务器应将数据作为纯二进制数据发送。数据库也经常使用 Blob 来描述二进制对象，本质上我们基本上是在谈论字节数组。</p>
<blockquote>
<p>如果你有 那么 其他详细信息</p>
</blockquote>
<p>您需要将二进制数据封装为 BLOB 对象，然后用于<code>URL.createObjectURL()</code>为其生成本地 URL：</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Blob</span><span class="p">([</span><span class="n">arrayBufferWithPNG</span><span class="p">],</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s2">"image/png"</span><span class="p">}),</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">URL</span><span class="o">.</span><span class="n">createObjectURL</span><span class="p">(</span><span class="n">blob</span><span class="p">),</span>
<span class="w">    </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Image</span><span class="p">();</span>

<span class="n">img</span><span class="o">.</span><span class="n">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">URL</span><span class="o">.</span><span class="n">revokeObjectURL</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">src</span><span class="p">);</span><span class="w">     </span><span class="o">//</span><span class="w"> </span><span class="n">clean</span><span class="o">-</span><span class="n">up</span><span class="w"> </span><span class="n">memory</span>
<span class="w">    </span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">this</span><span class="p">);</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">DOM</span>
<span class="p">}</span>

<span class="n">img</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="p">;</span><span class="w">                         </span><span class="o">//</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="s2">"stream"</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bytes</span>
</pre></div>

<p><br></p>
<h3>更多建议</h3>
<p>此 Javascript 函数支持显示 <strong>Blob</strong> 文件 API 和 <strong>数据</strong> API在客户端浏览器中下载 <strong>JSON文件的区别：</strong></p>
<div class="code"><pre class="code literal-block"><span class="o">/**</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Save</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">HTML</span><span class="w"> </span><span class="o">&lt;</span><span class="n">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">temporary</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">Blob</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="n">author</span><span class="w"> </span><span class="n">Loreto</span><span class="w"> </span><span class="n">Parisi</span>
<span class="w"> </span><span class="o">*/</span>

<span class="k">var</span><span class="w"> </span><span class="n">saveAsFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span><span class="w"> </span><span class="n">fileContents</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">typeof</span><span class="p">(</span><span class="n">Blob</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'undefined'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Alternative</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">Blob</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">textFileAsBlob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Blob</span><span class="p">([</span><span class="n">fileContents</span><span class="p">],</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'text/plain'</span><span class="p">});</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">downloadLink</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s2">"a"</span><span class="p">);</span>
<span class="w">        </span><span class="n">downloadLink</span><span class="o">.</span><span class="n">download</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fileName</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">webkitURL</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">downloadLink</span><span class="o">.</span><span class="n">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="o">.</span><span class="n">webkitURL</span><span class="o">.</span><span class="n">createObjectURL</span><span class="p">(</span><span class="n">textFileAsBlob</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">downloadLink</span><span class="o">.</span><span class="n">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">createObjectURL</span><span class="p">(</span><span class="n">textFileAsBlob</span><span class="p">);</span>
<span class="w">            </span><span class="n">downloadLink</span><span class="o">.</span><span class="n">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">removeChild</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">target</span><span class="p">);</span>
<span class="w">            </span><span class="n">downloadLink</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">;</span>
<span class="w">            </span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">downloadLink</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">downloadLink</span><span class="o">.</span><span class="n">click</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Alternative</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">Data</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">pp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s1">'a'</span><span class="p">);</span>
<span class="w">        </span><span class="n">pp</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">,</span><span class="w"> </span><span class="s1">'data:text/plain;charset=utf-8,'</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="n">encodeURIComponent</span><span class="p">(</span><span class="n">fileContents</span><span class="p">));</span>
<span class="w">        </span><span class="n">pp</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s1">'download'</span><span class="p">,</span><span class="w"> </span><span class="n">fileName</span><span class="p">);</span>
<span class="w">        </span><span class="n">pp</span><span class="o">.</span><span class="n">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">removeChild</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">target</span><span class="p">);</span>
<span class="w">        </span><span class="n">pp</span><span class="o">.</span><span class="n">click</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">saveAsFile</span>

<span class="o">/*</span><span class="w"> </span><span class="n">Example</span><span class="w"> </span><span class="o">*/</span>
<span class="k">var</span><span class="w"> </span><span class="n">jsonObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w"> </span><span class="s2">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="s2">"car"</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">};</span>
<span class="n">saveAsFile</span><span class="p">(</span><span class="s1">'out.json'</span><span class="p">,</span><span class="w"> </span><span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">jsonObject</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
</pre></div>

<p>该函数被称为 like <code>saveAsFile('out.json', jsonString);</code>。它将创建一个可立即被浏览器识别的
ByteStream，该浏览器将使用 File API 直接下载生成的文件<code>URL.createObjectURL</code>。</p>
<p>在 中<code>else</code>，可以看到通过<code>href</code>元素加上数据 API 获得的相同结果，但这有一些限制，而 Blob API 没有。</p>
<p><br><br><a href="posts/what-is-a-blob-url-and-why-it-is-used/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ru-he-hen-hao-di-jiang-fu-dian-shu-ge-shi-hua-wei-mei-you-bu-bi-yao-de-shi-jin-zhi-0-de-zi-fu-chuan/" class="u-url">如何很好地将浮点数格式化为没有不必要的十进制 0 的字符串</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ru-he-hen-hao-di-jiang-fu-dian-shu-ge-shi-hua-wei-mei-you-bu-bi-yao-de-shi-jin-zhi-0-de-zi-fu-chuan/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T01:20:55+08:00" itemprop="datePublished" title="2023-02-18 01:20">2023-02-18 01:20</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>64 位双精度数可以表示整数 +/- 2 53精确</p>
<p>鉴于这一事实，我选择使用双精度类型作为我所有类型的单一类型，因为我的最大整数是一个无符号的 32 位数字。</p>
<p>但是现在我必须打印这些伪整数，但问题是它们也与实际的双精度数混合在一起。</p>
<p>那么如何在 Java 中很好地打印这些双打呢？</p>
<p>我努力了<code>String.format("%f", value)</code>，这很接近，除了我得到很多小值的尾随零。</p>
<p>这是的示例输出<code>%f</code></p>
<div class="code"><pre class="code literal-block"><span class="mf">232.00000000</span>
<span class="mf">0.18000000000</span>
<span class="mf">1237875192.0</span>
<span class="mf">4.5800000000</span>
<span class="mf">0.00000000</span>
<span class="mf">1.23450000</span>
</pre></div>

<p>我想要的是：</p>
<div class="code"><pre class="code literal-block"><span class="mf">232</span>
<span class="mf">0.18</span>
<span class="mf">1237875192</span>
<span class="mf">4.58</span>
<span class="mf">0</span>
<span class="mf">1.2345</span>
</pre></div>

<p>当然，我可以编写一个函数来修剪那些零，但是由于字符串操作，性能损失很大。我可以用其他格式代码做得更好吗？</p>
<hr>
<p>Tom E. 和 Jeremy S. 的答案是不可接受的，因为他们都随意四舍五入到小数点后两位。请在回答之前了解问题。</p>
<hr>
<p>请注意，这<code>String.format(format, args...)</code>取决于 _ <strong>语言环境</strong>_ （请参阅下面的答案）。</p>
<p><br><br></p>
<h2>解答</h2>
<p>如果想法是打印存储为双精度的整数，就好像它们是整数一样，否则以最小必要精度打印双精度：</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">fmt</span><span class="ss">(</span><span class="nv">double</span><span class="w"> </span><span class="nv">d</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">if</span><span class="ss">(</span><span class="nv">d</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">(</span><span class="nv">long</span><span class="ss">)</span><span class="w"> </span><span class="nv">d</span><span class="ss">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">String</span>.<span class="nv">format</span><span class="ss">(</span><span class="s2">"%d"</span>,<span class="ss">(</span><span class="nv">long</span><span class="ss">)</span><span class="nv">d</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">String</span>.<span class="nv">format</span><span class="ss">(</span><span class="s2">"%s"</span>,<span class="nv">d</span><span class="ss">)</span><span class="c1">;</span>
}
</pre></div>

<p>生产：</p>
<div class="code"><pre class="code literal-block"><span class="mf">232</span>
<span class="mf">0.18</span>
<span class="mf">1237875192</span>
<span class="mf">4.58</span>
<span class="mf">0</span>
<span class="mf">1.2345</span>
</pre></div>

<p>并且不依赖于字符串操作。</p>
<p><br></p>
<h3>更多建议</h3>
<div class="code"><pre class="code literal-block">String.format("%.2f", value);
</pre></div>

<p><br><br><a href="posts/how-to-nicely-format-floating-numbers-to-string-without-unnecessary-decimal-0-s/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/c-rong-qi-de-die-dai-qi-shi-xiao-gui-ze/" class="u-url">C++ 容器的迭代器失效规则</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/c-rong-qi-de-die-dai-qi-shi-xiao-gui-ze/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T01:20:24+08:00" itemprop="datePublished" title="2023-02-18 01:20">2023-02-18 01:20</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><strong>这个问题的答案是 社区的努力</strong>。编辑现有答案以改进这篇文章。它目前不接受新的答案或互动。</p>
<p>C++容器的迭代器失效规则是什么？</p>
<p>（ <strong>注意：</strong> 这个问答是Stack Overflow 的 C++
FAQ中的一个条目。关于问题本身的元讨论应该发布在开始所有这些的元问题上，而不是在这里。）</p>
<p><br><br></p>
<h2>解答</h2>
<p><strong>C++17 （所有参考资料均来自 CPP17 -</strong> n4659的最终工作草案）</p>
<hr>
<h2>插入</h2>
<p><em>序列容器</em></p>
<ul>
<li>
<p><code>vector</code>: The functions <code>insert</code>, <code>emplace_back</code>, <code>emplace</code>, <code>push_back</code> cause reallocation if the new size is greater than the old capacity. Reallocation invalidates all the references, pointers, and iterators referring to the elements in the sequence. If no reallocation happens, all the iterators and references before the insertion point remain valid. [26.3.11.5/1]<br>
With respect to the <code>reserve</code> function, reallocation invalidates all the
references, pointers, and iterators referring to the elements in the sequence.
No reallocation shall take place during insertions that happen after a call to
<code>reserve()</code> until the time when an insertion would make the size of the vector
greater than the value of <code>capacity()</code>. [26.3.11.3/6]</p>
</li>
<li>
<p><code>deque</code>: An insertion in the middle of the deque invalidates all the iterators and references to elements of the deque. An insertion at either end of the deque invalidates all the iterators to the deque, but has no effect on the validity of references to elements of the deque. [26.3.8.4/1]</p>
</li>
<li>
<p><code>list</code>: Does not affect the validity of iterators and references. If an exception is thrown there are no effects. [26.3.10.4/1].<br>
The <code>insert</code>, <code>emplace_front</code>, <code>emplace_back</code>, <code>emplace</code>, <code>push_front</code>,
<code>push_back</code> functions are covered under this rule.</p>
</li>
<li>
<p><code>forward_list</code>: None of the overloads of <code>insert_after</code> shall affect the validity of iterators and references [26.3.9.5/1]</p>
</li>
<li>
<p><code>array</code>: As a rule, iterators to an array are never invalidated throughout the lifetime of the array. One should take note, however, that during swap, the iterator will continue to point to the same array element, and will thus change its value.</p>
</li>
</ul>
<p><em>Associative Containers</em></p>
<ul>
<li>
<code>All Associative Containers</code>: The <code>insert</code> and <code>emplace</code> members shall not affect the validity of iterators and references to the container [26.2.6/9]</li>
</ul>
<p><em>Unordered Associative Containers</em></p>
<ul>
<li>
<p><code>All Unordered Associative Containers</code>: Rehashing invalidates iterators, changes ordering between elements, and changes which buckets elements appear in, but does not invalidate pointers or references to elements. [26.2.7/9]<br>
The <code>insert</code> and <code>emplace</code> members shall not affect the validity of references
to container elements, but may invalidate all iterators to the container.
[26.2.7/14]<br>
The <code>insert</code> and <code>emplace</code> members shall not affect the validity of iterators
if <code>(N+n) &lt;= z * B</code>, where <code>N</code> is the number of elements in the container
prior to the insert operation, <code>n</code> is the number of elements inserted, <code>B</code> is
the container’s bucket count, and <code>z</code> is the container’s maximum load factor.
[26.2.7/15]</p>
</li>
<li>
<p><code>All Unordered Associative Containers</code>: In case of a merge operation (e.g., <code>a.merge(a2)</code>), iterators referring to the transferred elements and all iterators referring to <code>a</code> will be invalidated, but iterators to elements remaining in <code>a2</code> will remain valid. (Table 91 — Unordered associative container requirements)</p>
</li>
</ul>
<p><em>Container Adaptors</em></p>
<ul>
<li>
<code>stack</code>: inherited from underlying container</li>
<li>
<code>queue</code>: inherited from underlying container</li>
<li>
<code>priority_queue</code>: inherited from underlying container</li>
</ul>
<hr>
<h2>Erasure</h2>
<p><em>Sequence Containers</em></p>
<ul>
<li>
<p><code>vector</code>: The functions <code>erase</code> and <code>pop_back</code> invalidate iterators and references at or after the point of the erase. [26.3.11.5/3]</p>
</li>
<li>
<p><code>deque</code>: An erase operation that erases the last element of a <code>deque</code> invalidates only the past-the-end iterator and all iterators and references to the erased elements. An erase operation that erases the first element of a <code>deque</code> but not the last element invalidates only iterators and references to the erased elements. An erase operation that erases neither the first element nor the last element of a <code>deque</code> invalidates the past-the-end iterator and all iterators and references to all the elements of the <code>deque</code>. [ Note: <code>pop_front</code> and <code>pop_back</code> are erase operations. —end note ] [26.3.8.4/4]</p>
</li>
<li>
<p><code>list</code>: Invalidates only the iterators and references to the erased elements. [26.3.10.4/3]. This applies to <code>erase</code>, <code>pop_front</code>, <code>pop_back</code>, <code>clear</code> functions.<br><code>remove</code> and <code>remove_if</code> member functions: Erases all the elements in the list
referred by a list iterator <code>i</code> for which the following conditions hold: <code>*i
== value</code>, <code>pred(*i) != false</code>. Invalidates only the iterators and references
to the erased elements [26.3.10.5/15].<br><code>unique</code> member function - Erases all but the first element from every
consecutive group of equal elements referred to by the iterator <code>i</code> in the
range <code>[first + 1, last)</code> for which <code>*i == *(i-1)</code> (for the version of unique
with no arguments) or <code>pred(*i, *(i - 1))</code> (for the version of unique with a
predicate argument) holds. Invalidates only the iterators and references to
the erased elements. [26.3.10.5/19]</p>
</li>
<li>
<p><code>forward_list</code>: <code>erase_after</code> shall invalidate only iterators and references to the erased elements. [26.3.9.5/1].<br><code>remove</code> and <code>remove_if</code> member functions - Erases all the elements in the
list referred by a list iterator i for which the following conditions hold:
<code>*i == value</code> (for <code>remove()</code>), <code>pred(*i)</code> is true (for <code>remove_if()</code>).
Invalidates only the iterators and references to the erased elements.
[26.3.9.6/12].<br><code>unique</code> member function - Erases all but the first element from every
consecutive group of equal elements referred to by the iterator i in the range
[first + 1, last) for which <code>*i == *(i-1)</code> (for the version with no arguments)
or <code>pred(*i, *(i - 1))</code> (for the version with a predicate argument) holds.
Invalidates only the iterators and references to the erased elements.
[26.3.9.6/16]</p>
</li>
<li>
<p><code>All Sequence Containers</code>: <code>clear</code> invalidates all references, pointers, and iterators referring to the elements of a and may invalidate the past-the-end iterator (Table 87 — Sequence container requirements). But for <code>forward_list</code>, <code>clear</code> does not invalidate past-the-end iterators. [26.3.9.5/32]</p>
</li>
<li>
<p><code>All Sequence Containers</code>: <code>assign</code> invalidates all references, pointers and iterators referring to the elements of the container. For <code>vector</code> and <code>deque</code>, also invalidates the past-the-end iterator. (Table 87 — Sequence container requirements)</p>
</li>
</ul>
<p><em>Associative Containers</em></p>
<ul>
<li>
<p><code>All Associative Containers</code>: The <code>erase</code> members shall invalidate only iterators and references to the erased elements [26.2.6/9]</p>
</li>
<li>
<p><code>All Associative Containers</code>: The <code>extract</code> members invalidate only iterators to the removed element; pointers and references to the removed element remain valid [26.2.6/10]</p>
</li>
</ul>
<p><em>Container Adaptors</em></p>
<ul>
<li>
<code>stack</code>: inherited from underlying container</li>
<li>
<code>queue</code>: inherited from underlying container</li>
<li>
<code>priority_queue</code>: inherited from underlying container</li>
</ul>
<hr>
<p><strong>General container requirements relating to iterator invalidation:</strong></p>
<ul>
<li>
<p>Unless otherwise specified (either explicitly or by defining a function in terms of other functions), invoking a container member function or passing a container as an argument to a library function shall not invalidate iterators to, or change the values of, objects within that container. [26.2.1/12]</p>
</li>
<li>
<p>no <code>swap()</code> function invalidates any references, pointers, or iterators referring to the elements of the containers being swapped. [ Note: The end() iterator does not refer to any element, so it may be invalidated. —end note ] [26.2.1/(11.6)]</p>
</li>
</ul>
<p><em>As examples of the above requirements:</em></p>
<ul>
<li>
<p><code>transform</code> algorithm: The <code>op</code> and <code>binary_op</code> functions shall not invalidate iterators or subranges, or modify elements in the ranges [28.6.4/1]</p>
</li>
<li>
<p><code>accumulate</code> algorithm: In the range [first, last], <code>binary_op</code> shall neither modify elements nor invalidate iterators or subranges [29.8.2/1]</p>
</li>
<li>
<p><code>reduce</code> algorithm: binary_op shall neither invalidate iterators or subranges, nor modify elements in the range [first, last]. [29.8.3/5]</p>
</li>
</ul>
<p>and so on...</p>
<p><br></p>
<h3>更多建议</h3>
<p><strong>C++11</strong> （来源：迭代器失效规则（C++0x））</p>
<hr>
<h2>插入</h2>
<p><em>序列容器</em></p>
<ul>
<li>
<code>vector</code>：插入点之前的所有迭代器和引用不受影响，除非新容器大小大于以前的容量（在这种情况下所有迭代器和引用都无效）[23.3.6.5/1]</li>
<li>
<code>deque</code>：所有迭代器和引用都无效，除非插入的成员位于双端队列的末端（前面或后面）（在这种情况下所有迭代器都无效，但对元素的引用不受影响）[23.3.3.4/1]</li>
<li>
<code>list</code>: 所有迭代器和引用不受影响 [23.3.5.4/1]</li>
<li>
<code>forward_list</code>：所有迭代器和引用不受影响 <em>（适用于<code>insert_after</code>）</em> [23.3.4.5/1]</li>
<li>
<code>array</code>：（ <em>不适用）</em>
</li>
</ul>
<p><em>关联容器</em></p>
<ul>
<li>
<code>[multi]{set,map}</code>：所有迭代器和引用不受影响 [23.2.4/9]</li>
</ul>
<p><em>未排序的关联容器</em></p>
<ul>
<li>
<code>unordered_[multi]{set,map}</code>：当重新散列发生时，所有迭代器都失效，但引用不受影响 [23.2.5/8]。如果插入不会导致容器的大小超过最大负载因子和当前桶数，则不会发生<code>z * B</code>重新<code>z</code>散列<code>B</code>。[23.2.5/14]</li>
</ul>
<p><em>容器适配器</em></p>
<ul>
<li>
<code>stack</code>: 继承自底层容器</li>
<li>
<code>queue</code>: 继承自底层容器</li>
<li>
<code>priority_queue</code>: 继承自底层容器</li>
</ul>
<hr>
<h2>擦除</h2>
<p><em>序列容器</em></p>
<ul>
<li>
<code>vector</code>：擦除点处或擦除点之后的每个迭代器和引用都无效 [23.3.6.5/3]</li>
<li>
<code>deque</code>：擦除最后一个元素只会使迭代器和对已擦除元素的引用以及尾后迭代器无效；擦除第一个元素只会使迭代器和对已擦除元素的引用无效；擦除任何其他元素会使所有迭代器和引用无效（包括尾后迭代器）[23.3.3.4/4]</li>
<li>
<code>list</code>：只有对已擦除元素的迭代器和引用无效 [23.3.5.4/3]</li>
<li>
<code>forward_list</code>：只有对被擦除元素的迭代器和引用无效 <em>（适用于<code>erase_after</code>）</em> [23.3.4.5/1]</li>
<li>
<code>array</code>：（ <em>不适用）</em>
</li>
</ul>
<p><em>关联容器</em></p>
<ul>
<li>
<code>[multi]{set,map}</code>：只有迭代器和对已擦除元素的引用无效 [23.2.4/9]</li>
</ul>
<p><em>无序关联容器</em></p>
<ul>
<li>
<code>unordered_[multi]{set,map}</code>：只有对已擦除元素的迭代器和引用无效 [23.2.5/13]</li>
</ul>
<p><em>容器适配器</em></p>
<ul>
<li>
<code>stack</code>: 继承自底层容器</li>
<li>
<code>queue</code>: 继承自底层容器</li>
<li>
<code>priority_queue</code>: 继承自底层容器</li>
</ul>
<hr>
<h2>调整大小</h2>
<ul>
<li>
<code>vector</code>：根据插入/擦除 [23.3.6.5/12]</li>
<li>
<code>deque</code>：根据插入/擦除 [23.3.3.3/3]</li>
<li>
<code>list</code>：根据插入/擦除 [23.3.5.3/1]</li>
<li>
<code>forward_list</code>：根据插入/擦除 [23.3.4.5/25]</li>
<li>
<code>array</code>：（不适用）</li>
</ul>
<hr>
<h3>注1</h3>
<blockquote>
<p><strong>除非另有规定</strong> （明确或通过根据其他函数定义函数），调用容器成员函数或将容器作为参数传递给 <strong>库函数不应使迭代器无效</strong> 或更改容器内对象的值.
[23.2.1/11]</p>
</blockquote>
<h3>笔记2</h3>
<blockquote>
<p><strong><em>*没有 swap() 函数会使引用被交换容器元素的 </em>*任何引用、指针或迭代器无效。</strong> [ 注意： <strong>end() 迭代器</strong>
不引用任何元素，因此它 <strong>可能无效</strong> 。——尾注] [23.2.1/10]</p>
</blockquote>
<h3>注3</h3>
<p>除了上述警告外<code>swap()</code>，尚不清楚“结束”迭代器是否受制于上面列出的每个容器规则；无论如何，您应该假设它们是。</p>
<h3>注 4</h3>
<p><code>vector</code>并且所有 <em>无序关联容器都</em> 支持<code>reserve(n)</code>，这保证至少在容器的大小增长到之前不会发生自动调整大小<code>n</code>。应谨慎使用
<em>无序关联容器</em> ，因为未来的提议将允许指定最小加载因子，这将允许<code>insert</code>在足够的<code>erase</code>操作将容器大小减小到最小值以下后进行重新散列；在 .
之后，担保应被视为可能无效<code>erase</code>。</p>
<p><br><br><a href="posts/iterator-invalidation-rules-for-c-containers/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1096.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1094.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
