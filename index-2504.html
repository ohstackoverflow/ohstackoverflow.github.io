<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2504) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2504.html">
<link rel="prev" href="index-2505.html" type="text/html">
<link rel="next" href="index-2503.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-communicate-between-related-react-components/" class="u-url">How can I communicate between related react components?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-communicate-between-related-react-components/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T21:04:39+08:00" itemprop="datePublished" title="2023-03-04 21:04">2023-03-04 21:04</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I just got started with ReactJS and am a little stuck on a problem that I
have.</p>
<p>My application is essentially a list with filters and a button to change the
layout. At the moment I'm using three components: <code>&lt;list /&gt;</code>, <code>&lt; Filters /&gt;</code>
and <code>&lt;TopBar /&gt;</code>, now obviously when I change settings in <code>&lt; Filters /&gt;</code> I
want to trigger some method in <code>&lt;list /&gt;</code> to update my view.</p>
<p>How can I make those 3 components interact with each other, or do I need some
sort of global data model where I can just make changes to?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The best approach would depend on how you plan to arrange those components. A
few example scenarios that come to mind right now:</p>
<ol>
<li>
<code>&lt;Filters /&gt;</code> is a child component of <code>&lt;List /&gt;</code>
</li>
<li>Both <code>&lt;Filters /&gt;</code> and <code>&lt;List /&gt;</code> are children of a parent component</li>
<li>
<code>&lt;Filters /&gt;</code> and <code>&lt;List /&gt;</code> live in separate root components entirely.</li>
</ol>
<p>There may be other scenarios that I'm not thinking of. If yours doesn't fit
within these, then let me know. Here are some very rough examples of how I've
been handling the first two scenarios:</p>
<h3>Scenario #1</h3>
<p>You could pass a handler from <code>&lt;List /&gt;</code> to <code>&lt;Filters /&gt;</code>, which could then be
called on the <code>onChange</code> event to filter the list with the current value.</p>
<p>JSFiddle for #1 →</p>
<div class="code"><pre class="code literal-block"><span class="o">/**</span><span class="w"> </span><span class="err">@</span><span class="n">jsx</span><span class="w"> </span><span class="n">React</span><span class="o">.</span><span class="n">DOM</span><span class="w"> </span><span class="o">*/</span>

<span class="k">var</span><span class="w"> </span><span class="n">Filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">React</span><span class="o">.</span><span class="n">createClass</span><span class="p">({</span>
<span class="w">  </span><span class="n">handleFilterChange</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">refs</span><span class="o">.</span><span class="n">filterInput</span><span class="o">.</span><span class="n">getDOMNode</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">;</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">updateFilter</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="n">render</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="n">input</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"text"</span><span class="w"> </span><span class="n">ref</span><span class="o">=</span><span class="s2">"filterInput"</span><span class="w"> </span><span class="n">onChange</span><span class="o">=</span><span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">handleFilterChange</span><span class="p">}</span><span class="w"> </span><span class="n">placeholder</span><span class="o">=</span><span class="s2">"Filter"</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>

<span class="k">var</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">React</span><span class="o">.</span><span class="n">createClass</span><span class="p">({</span>
<span class="w">  </span><span class="n">getInitialState</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">listItems</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s1">'Chicago'</span><span class="p">,</span><span class="w"> </span><span class="s1">'New York'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Tokyo'</span><span class="p">,</span><span class="w"> </span><span class="s1">'London'</span><span class="p">,</span><span class="w"> </span><span class="s1">'San Francisco'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Amsterdam'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Hong Kong'</span><span class="p">],</span>
<span class="w">      </span><span class="n">nameFilter</span><span class="p">:</span><span class="w"> </span><span class="s1">''</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="n">handleFilterUpdate</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">filterValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">setState</span><span class="p">({</span>
<span class="w">      </span><span class="n">nameFilter</span><span class="p">:</span><span class="w"> </span><span class="n">filterValue</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="n">render</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">displayedItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">listItems</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">var</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">toLowerCase</span><span class="p">()</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">nameFilter</span><span class="o">.</span><span class="n">toLowerCase</span><span class="p">());</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="k">match</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">this</span><span class="p">));</span>

<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">content</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">displayedItems</span><span class="o">.</span><span class="n">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">var</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">displayedItems</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="p">{</span><span class="n">item</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">      </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span><span class="p">{</span><span class="n">items</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">No</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">filter</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">Filters</span><span class="w"> </span><span class="n">updateFilter</span><span class="o">=</span><span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">handleFilterUpdate</span><span class="p">}</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">Results</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="n">content</span><span class="p">}</span>
<span class="w">      </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>

<span class="n">React</span><span class="o">.</span><span class="n">renderComponent</span><span class="p">(</span><span class="o">&lt;</span><span class="n">List</span><span class="w"> </span><span class="o">/&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="p">);</span>
</pre></div>

<hr>
<h3>Scenario #2</h3>
<p>Similar to scenario #1, but the parent component will be the one passing down
the handler function to <code>&lt;Filters /&gt;</code>, and will pass the filtered list to
<code>&lt;List /&gt;</code>. I like this method better since it decouples the <code>&lt;List /&gt;</code> from
the <code>&lt;Filters /&gt;</code>.</p>
<p>JSFiddle for #2 →</p>
<div class="code"><pre class="code literal-block">/**<span class="w"> </span>@jsx<span class="w"> </span>React.DOM<span class="w"> </span>*/

var<span class="w"> </span>Filters<span class="w"> </span>=<span class="w"> </span>React.createClass({
<span class="w">  </span>handleFilterChange:<span class="w"> </span>function()<span class="w"> </span>{
<span class="w">    </span>var<span class="w"> </span>value<span class="w"> </span>=<span class="w"> </span>this.refs.filterInput.getDOMNode().value;
<span class="w">    </span>this.props.updateFilter(value);
<span class="w">  </span>},
<span class="w">  </span>render:<span class="w"> </span>function()<span class="w"> </span>{
<span class="w">    </span>return<span class="w"> </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"text"</span><span class="w"> </span><span class="na">ref=</span><span class="s">"filterInput"</span><span class="w"> </span><span class="na">onChange=</span><span class="s">{this.handleFilterChange}</span><span class="w"> </span><span class="na">placeholder=</span><span class="s">"Filter"</span><span class="w"> </span><span class="nt">/&gt;</span>;
<span class="w">  </span>}
});

var<span class="w"> </span>List<span class="w"> </span>=<span class="w"> </span>React.createClass({
<span class="w">  </span>render:<span class="w"> </span>function()<span class="w"> </span>{
<span class="w">    </span>var<span class="w"> </span>content;
<span class="w">    </span>if<span class="w"> </span>(this.props.items.length<span class="w"> </span>&gt;<span class="w"> </span>0)<span class="w"> </span>{
<span class="w">      </span>var<span class="w"> </span>items<span class="w"> </span>=<span class="w"> </span>this.props.items.map(function(item)<span class="w"> </span>{
<span class="w">        </span>return<span class="w"> </span><span class="nt">&lt;li&gt;</span>{item}<span class="nt">&lt;/li&gt;</span>;
<span class="w">      </span>});
<span class="w">      </span>content<span class="w"> </span>=<span class="w"> </span><span class="nt">&lt;ul&gt;</span>{items}<span class="nt">&lt;/ul&gt;</span>
<span class="w">    </span>}<span class="w"> </span>else<span class="w"> </span>{
<span class="w">      </span>content<span class="w"> </span>=<span class="w"> </span><span class="nt">&lt;p&gt;</span>No<span class="w"> </span>items<span class="w"> </span>matching<span class="w"> </span>this<span class="w"> </span>filter<span class="nt">&lt;/p&gt;</span>;
<span class="w">    </span>}
<span class="w">    </span>return<span class="w"> </span>(
<span class="w">      </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">className=</span><span class="s">"results"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;h4&gt;</span>Results<span class="nt">&lt;/h4&gt;</span>
<span class="w">        </span>{content}
<span class="w">      </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span>);
<span class="w">  </span>}
});

var<span class="w"> </span>ListContainer<span class="w"> </span>=<span class="w"> </span>React.createClass({
<span class="w">  </span>getInitialState:<span class="w"> </span>function()<span class="w"> </span>{
<span class="w">    </span>return<span class="w"> </span>{
<span class="w">      </span>listItems:<span class="w"> </span>['Chicago',<span class="w"> </span>'New<span class="w"> </span>York',<span class="w"> </span>'Tokyo',<span class="w"> </span>'London',<span class="w"> </span>'San<span class="w"> </span>Francisco',<span class="w"> </span>'Amsterdam',<span class="w"> </span>'Hong<span class="w"> </span>Kong'],
<span class="w">      </span>nameFilter:<span class="w"> </span>''
<span class="w">    </span>};
<span class="w">  </span>},
<span class="w">  </span>handleFilterUpdate:<span class="w"> </span>function(filterValue)<span class="w"> </span>{
<span class="w">    </span>this.setState({
<span class="w">      </span>nameFilter:<span class="w"> </span>filterValue
<span class="w">    </span>});
<span class="w">  </span>},
<span class="w">  </span>render:<span class="w"> </span>function()<span class="w"> </span>{
<span class="w">    </span>var<span class="w"> </span>displayedItems<span class="w"> </span>=<span class="w"> </span>this.state.listItems.filter(function(item)<span class="w"> </span>{
<span class="w">      </span>var<span class="w"> </span>match<span class="w"> </span>=<span class="w"> </span>item.toLowerCase().indexOf(this.state.nameFilter.toLowerCase());
<span class="w">      </span>return<span class="w"> </span>(match<span class="w"> </span>!==<span class="w"> </span>-1);
<span class="w">    </span>}.bind(this));

<span class="w">    </span>return<span class="w"> </span>(
<span class="w">      </span><span class="nt">&lt;div&gt;</span>
<span class="w">        </span><span class="nt">&lt;Filters</span><span class="w"> </span><span class="na">updateFilter=</span><span class="s">{this.handleFilterUpdate}</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;List</span><span class="w"> </span><span class="na">items=</span><span class="s">{displayedItems}</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span>);
<span class="w">  </span>}
});

React.renderComponent(<span class="nt">&lt;ListContainer</span><span class="w"> </span><span class="nt">/&gt;</span>,<span class="w"> </span>document.body);
</pre></div>

<hr>
<h3>Scenario #3</h3>
<p>When the components can't communicate between any sort of parent-child
relationship, the documentation recommends setting up a global event system.</p>
<p><br></p>
<h3>Suggest</h3>
<p>There are multiple ways to make components communicate. Some can be suited to
your usecase. Here is a list of some I've found useful to know.</p>
<h2>React</h2>
<h4>Parent / Child direct communication</h4>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">Child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">({</span><span class="n">fromChildToParentCallback</span><span class="p">})</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="n">onClick</span><span class="o">=</span><span class="p">{()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">fromChildToParentCallback</span><span class="p">(</span><span class="mi">42</span><span class="p">)}</span><span class="o">&gt;</span>
<span class="w">    </span><span class="n">Click</span><span class="w"> </span><span class="n">me</span>
<span class="w">  </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="p">);</span>

<span class="k">class</span><span class="w"> </span><span class="n">Parent</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">React</span><span class="o">.</span><span class="n">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">receiveChildValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"Parent received value from child: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="mi">42</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="o">&lt;</span><span class="n">Child</span><span class="w"> </span><span class="n">fromChildToParentCallback</span><span class="o">=</span><span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">receiveChildValue</span><span class="p">}</span><span class="o">/&gt;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Here the child component will call a callback provided by the parent with a
value, and the parent will be able to get the value provided by the children
in the parent.</p>
<p>If you build a feature/page of your app, it's better to have a single parent
managing the callbacks/state (also called <code>container</code> or <code>smart component</code>),
and all childs to be stateless, only reporting things to the parent. This way
you can easily "share" the state of the parent to any child that need it.</p>
<hr>
<h4>Context</h4>
<p>React Context permits to hold state at the root of your component hierarchy,
and be able to inject this state easily into very deeply nested components,
without the hassle to have to pass down props to every intermediate
components.</p>
<p>Until now, context was an experimental feature, but a new API is available in
React 16.3.</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">AppContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">React</span><span class="o">.</span><span class="n">createContext</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="n">App</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">React</span><span class="o">.</span><span class="n">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="o">&lt;</span><span class="n">AppContext</span><span class="o">.</span><span class="n">Provider</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="p">{{</span><span class="n">language</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">}}</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">          </span><span class="o">...</span>
<span class="w">          </span><span class="o">&lt;</span><span class="n">SomeDeeplyNestedComponent</span><span class="o">/&gt;</span>
<span class="w">          </span><span class="o">...</span>
<span class="w">        </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;/</span><span class="n">AppContext</span><span class="o">.</span><span class="n">Provider</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="k">const</span><span class="w"> </span><span class="n">SomeDeeplyNestedComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">AppContext</span><span class="o">.</span><span class="n">Consumer</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">{({</span><span class="n">language</span><span class="p">})</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="n">App</span><span class="w"> </span><span class="n">language</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">currently</span><span class="w"> </span><span class="p">{</span><span class="n">language</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">}</span>
<span class="w">  </span><span class="o">&lt;/</span><span class="n">AppContext</span><span class="o">.</span><span class="n">Consumer</span><span class="o">&gt;</span>
<span class="p">);</span>
</pre></div>

<p>The consumer is using the render prop / children function pattern</p>
<p>Check this blog post for more details.</p>
<p>Before React 16.3, I'd recommend using react-broadcast which offer quite
similar API, and use former context API.</p>
<hr>
<h4>Portals</h4>
<p>Use a portal when you'd like to keep 2 components close together to make them
communicate with simple functions, like in normal parent / child, but you
don't want these 2 components to have a parent/child relationship in the DOM,
because of visual / CSS constraints it implies (like z-index, opacity...).</p>
<p>In this case you can use a "portal". There are different react libraries using
portals, usually used for modals, popups, tooltips...</p>
<p>Consider the following:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">className=</span><span class="s">"a"</span><span class="nt">&gt;</span>
<span class="w">    </span>a<span class="w"> </span>content
<span class="w">    </span><span class="nt">&lt;Portal</span><span class="w"> </span><span class="na">target=</span><span class="s">"body"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">className=</span><span class="s">"b"</span><span class="nt">&gt;</span>
<span class="w">            </span>b<span class="w"> </span>content
<span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;/Portal&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>Could produce the following DOM when rendered inside <code>reactAppContainer</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;body&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">"reactAppContainer"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">className=</span><span class="s">"a"</span><span class="nt">&gt;</span>
<span class="w">             </span>a<span class="w"> </span>content
<span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">className=</span><span class="s">"b"</span><span class="nt">&gt;</span>
<span class="w">         </span>b<span class="w"> </span>content
<span class="w">    </span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</pre></div>

<p>More details here</p>
<hr>
<h2>Slots</h2>
<p>You define a slot somewhere, and then you fill the slot from another place of
your render tree.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="p">{</span> <span class="n">Slot</span><span class="p">,</span> <span class="n">Fill</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'react-slot-fill'</span><span class="p">;</span>

<span class="n">const</span> <span class="n">Toolbar</span> <span class="o">=</span> <span class="p">(</span><span class="n">props</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">Slot</span> <span class="n">name</span><span class="o">=</span><span class="s2">"ToolbarContent"</span> <span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>

<span class="n">export</span> <span class="n">default</span> <span class="n">Toolbar</span><span class="p">;</span>

<span class="n">export</span> <span class="n">const</span> <span class="n">FillToolbar</span> <span class="o">=</span> <span class="p">({</span><span class="n">children</span><span class="p">})</span> <span class="o">=&gt;</span>
  <span class="o">&lt;</span><span class="n">Fill</span> <span class="n">name</span><span class="o">=</span><span class="s2">"ToolbarContent"</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="n">children</span><span class="p">}</span>
  <span class="o">&lt;/</span><span class="n">Fill</span><span class="o">&gt;</span>
</pre></div>

<p>This is a bit similar to portals except the filled content will be rendered in
a slot you define, while portals generally render a new dom node (often a
children of document.body)</p>
<p>Check react-slot-fill library</p>
<hr>
<h2>Event bus</h2>
<p>As stated in the React documentation:</p>
<blockquote>
<p>For communication between two components that don't have a parent-child
relationship, you can set up your own global event system. Subscribe to
events in componentDidMount(), unsubscribe in componentWillUnmount(), and
call setState() when you receive an event.</p>
</blockquote>
<p>There are many things you can use to setup an event bus. You can just create
an array of listeners, and on event publish, all listeners would receive the
event. Or you can use something like EventEmitter or PostalJs</p>
<hr>
<h2>Flux</h2>
<p>Flux is basically an event bus, except the event receivers are stores. This is
similar to the basic event bus system except the state is managed outside of
React</p>
<p>Original Flux implementation looks like an attempt to do Event-sourcing in a
hacky way.</p>
<p>Redux is for me the Flux implementation that is the closest from event-
sourcing, an benefits many of event-sourcing advantages like the ability to
time-travel. It is not strictly linked to React and can also be used with
other functional view libraries.</p>
<p>Egghead's Redux video tutorial is really nice and explains how it works
internally (it really is simple).</p>
<hr>
<h2>Cursors</h2>
<p>Cursors are coming from ClojureScript/Om and widely used in React projects.
They permit to manage the state outside of React, and let multiple components
have read/write access to the same part of the state, without needing to know
anything about the component tree.</p>
<p>Many implementations exists, including ImmutableJS, React-cursors and
Omniscient</p>
<p><strong>Edit 2016</strong> : it seems that people agree cursors work fine for smaller apps
but it does not scale well on complex apps. Om Next does not have cursors
anymore (while it's Om that introduced the concept initially)</p>
<hr>
<h2>Elm architecture</h2>
<p>The Elm architecture is an architecture proposed to be used by the Elm
language. Even if Elm is not ReactJS, the Elm architecture can be done in
React as well.</p>
<p>Dan Abramov, the author of Redux, did an implementation of the Elm
architecture using React.</p>
<p>Both Redux and Elm are really great and tend to empower event-sourcing
concepts on the frontend, both allowing time-travel debugging, undo/redo,
replay...</p>
<p>The main difference between Redux and Elm is that Elm tend to be a lot more
strict about state management. In Elm you can't have local component state or
mount/unmount hooks and all DOM changes must be triggered by global state
changes. Elm architecture propose a scalable approach that permits to handle
<strong>ALL</strong> the state inside a single immutable object, while Redux propose an
approach that invites you to handle <strong>MOST</strong> of the state in a single
immutable object.</p>
<p>While the conceptual model of Elm is very elegant and the architecture permits
to scale well on large apps, it can in practice be difficult or involve more
boilerplate to achieve simple tasks like giving focus to an input after
mounting it, or integrating with an existing library with an imperative
interface (ie JQuery plugin). Related issue.</p>
<p>Also, Elm architecture involves more code boilerplate. It's not that verbose
or complicated to write but I think the Elm architecture is more suited to
statically typed languages.</p>
<hr>
<h2>FRP</h2>
<p>Libraries like RxJS, BaconJS or Kefir can be used to produce FRP streams to
handle communication between components.</p>
<p>You can try for example Rx-React</p>
<p>I think using these libs is quite similar to using what the ELM language
offers with signals.</p>
<p>CycleJS framework does not use ReactJS but uses vdom. It share a lot of
similarities with the Elm architecture (but is more easy to use in real life
because it allows vdom hooks) and it uses RxJs extensively instead of
functions, and can be a good source of inspiration if you want to use FRP with
React. CycleJs Egghead videos are nice to understand how it works.</p>
<hr>
<h2>CSP</h2>
<p>CSP (Communicating Sequential Processes) are currently popular (mostly because
of Go/goroutines and core.async/ClojureScript) but you can use them also in
javascript with JS-CSP.</p>
<p>James Long has done a video explaining how it can be used with React.</p>
<h2>Sagas</h2>
<p>A saga is a backend concept that comes from the DDD / EventSourcing / CQRS
world, also called "process manager". It is being popularized by the redux-
saga project, mostly as a replacement to redux-thunk for handling side-effects
(ie API calls etc). Most people currently think it only services for side-
effects but it is actually more about decoupling components.</p>
<p>It is more of a compliment to a Flux architecture (or Redux) than a totally
new communication system, because the saga emit Flux actions at the end. The
idea is that if you have widget1 and widget2, and you want them to be
decoupled, you can't fire action targeting widget2 from widget1. So you make
widget1 only fire actions that target itself, and the saga is a "background
process" that listens for widget1 actions, and may dispatch actions that
target widget2. The saga is the coupling point between the 2 widgets but the
widgets remain decoupled.</p>
<p>If you are interested take a look at my answer here</p>
<hr>
<h2>Conclusion</h2>
<p>If you want to see an example of the same little app using these different
styles, check the branches of this repository.</p>
<p>I don't know what is the best option in the long term but I really like how
Flux looks like event-sourcing.</p>
<p>If you don't know event-sourcing concepts, take a look at this very pedagogic
blog: Turning the database inside out with apache Samza, it is a must-read to
understand why Flux is nice (but this could apply to FRP as well)</p>
<p>I think the community agrees that the most promising Flux implementation is
Redux, which will progressively allow very productive developer experience
thanks to hot reloading. Impressive livecoding ala Bret Victor's Inventing on
Principle video is possible!</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-load-a-file-from-resource-folder/" class="u-url">How do I load a file from resource folder?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-load-a-file-from-resource-folder/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T21:02:59+08:00" itemprop="datePublished" title="2023-03-04 21:02">2023-03-04 21:02</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>My project has the following structure:</p>
<div class="code"><pre class="code literal-block">/src/main/java/
/src/main/resources/
/src/test/java/
/src/test/resources/
</pre></div>

<p>I have a file in <code>/src/test/resources/test.csv</code> and I want to load the file
from a unit test in <code>/src/test/java/MyTest.java</code></p>
<p>I have this code which didn't work. It complains "No such file or directory".</p>
<div class="code"><pre class="code literal-block">BufferedReader br = new BufferedReader (new FileReader(test.csv))
</pre></div>

<p>I also tried this</p>
<div class="code"><pre class="code literal-block">InputStream is = (InputStream) MyTest.class.getResourcesAsStream(test.csv))
</pre></div>

<p>This also doesn't work. It returns <code>null</code>. I am using Maven to build my
project.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Try the next:</p>
<div class="code"><pre class="code literal-block"><span class="n">ClassLoader</span><span class="w"> </span><span class="n">classloader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Thread</span><span class="o">.</span><span class="n">currentThread</span><span class="p">()</span><span class="o">.</span><span class="n">getContextClassLoader</span><span class="p">();</span>
<span class="n">InputStream</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">classloader</span><span class="o">.</span><span class="n">getResourceAsStream</span><span class="p">(</span><span class="s2">"test.csv"</span><span class="p">);</span>
</pre></div>

<hr>
<p>If the above doesn't work, various projects have been added the following
class: <strong><code>ClassLoaderUtil</code></strong> 1 (code here).2</p>
<p>Here are some examples of how that class is used:</p>
<div class="code"><pre class="code literal-block"><span class="nv">src</span>\<span class="nv">main</span>\<span class="nv">java</span>\<span class="nv">com</span>\<span class="nv">company</span>\<span class="nv">test</span>\<span class="nv">YourCallingClass</span>.<span class="nv">java</span>
<span class="nv">src</span>\<span class="nv">main</span>\<span class="nv">java</span>\<span class="nv">com</span>\<span class="nv">opensymphony</span>\<span class="nv">xwork2</span>\<span class="nv">util</span>\<span class="nv">ClassLoaderUtil</span>.<span class="nv">java</span>
<span class="nv">src</span>\<span class="nv">main</span>\<span class="nv">resources</span>\<span class="nv">test</span>.<span class="nv">csv</span>


<span class="o">//</span><span class="w"> </span><span class="nv">java</span>.<span class="nv">net</span>.<span class="nv">URL</span>
<span class="nv">URL</span><span class="w"> </span><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ClassLoaderUtil</span>.<span class="nv">getResource</span><span class="ss">(</span><span class="s2">"test.csv"</span>,<span class="w"> </span><span class="nv">YourCallingClass</span>.<span class="nv">class</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">Path</span><span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Paths</span>.<span class="nv">get</span><span class="ss">(</span><span class="nv">url</span>.<span class="nv">toURI</span><span class="ss">())</span><span class="c1">;</span>
<span class="nv">List</span><span class="o">&lt;</span><span class="nv">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Files</span>.<span class="nv">readAllLines</span><span class="ss">(</span><span class="nv">path</span>,<span class="w"> </span><span class="nv">StandardCharsets</span>.<span class="nv">UTF_8</span><span class="ss">)</span><span class="c1">;</span>



<span class="o">//</span><span class="w"> </span><span class="nv">java</span>.<span class="nv">io</span>.<span class="nv">InputStream</span>
<span class="nv">InputStream</span><span class="w"> </span><span class="nv">inputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ClassLoaderUtil</span>.<span class="nv">getResourceAsStream</span><span class="ss">(</span><span class="s2">"test.csv"</span>,<span class="w"> </span><span class="nv">YourCallingClass</span>.<span class="nv">class</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">InputStreamReader</span><span class="w"> </span><span class="nv">streamReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">InputStreamReader</span><span class="ss">(</span><span class="nv">inputStream</span>,<span class="w"> </span><span class="nv">StandardCharsets</span>.<span class="nv">UTF_8</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">BufferedReader</span><span class="w"> </span><span class="nv">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">BufferedReader</span><span class="ss">(</span><span class="nv">streamReader</span><span class="ss">)</span><span class="c1">;</span>
<span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">String</span><span class="w"> </span><span class="nv">line</span><span class="c1">; (line = reader.readLine()) != null;) {</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">Process</span><span class="w"> </span><span class="nv">line</span>
}
</pre></div>

<hr>
<p><em>Notes</em></p>
<ol>
<li>See it in <em>The Wayback Machine</em>.</li>
<li>Also in GitHub.</li>
</ol>
<p><br></p>
<h3>Suggest</h3>
<p>Try:</p>
<div class="code"><pre class="code literal-block">InputStream is = MyTest.class.getResourceAsStream("/test.csv");
</pre></div>

<p>IIRC <code>getResourceAsStream()</code> by default is relative to the class's package.</p>
<p><strong>As @Terran noted, don't forget to add the<code>/</code> at the starting of the
filename</strong></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-obtain-a-query-execution-plan-in-sql-server/" class="u-url">How do I obtain a Query Execution Plan in SQL Server?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-obtain-a-query-execution-plan-in-sql-server/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T21:01:22+08:00" itemprop="datePublished" title="2023-03-04 21:01">2023-03-04 21:01</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In Microsoft SQL Server how can I get a query execution plan for a query /
stored procedure?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>There are a number of methods of obtaining an execution plan, which one to use
will depend on your circumstances. Usually you can use SQL Server Management
Studio to get a plan, however if for some reason you can't run your query in
SQL Server Management Studio then you might find it helpful to be able to
obtain a plan via SQL Server Profiler or by inspecting the plan cache.</p>
<h3>Method 1 - Using SQL Server Management Studio</h3>
<p>SQL Server comes with a couple of neat features that make it very easy to
capture an execution plan, simply make sure that the "Include Actual Execution
Plan" menu item (found under the "Query" menu) is ticked and run your query as
normal.</p>
<p><img alt="Include Action Execution Plan menu item" src="images/0iCgU.png"></p>
<p>If you are trying to obtain the execution plan for statements in a stored
procedure then you should execute the stored procedure, like so:</p>
<div class="code"><pre class="code literal-block"><span class="k">exec</span><span class="w"> </span><span class="nv">p_Example</span><span class="w"> </span><span class="mi">42</span>
</pre></div>

<p>When your query completes you should see an extra tab entitled "Execution
plan" appear in the results pane. If you ran many statements then you may see
many plans displayed in this tab.</p>
<p><img alt="Screenshot of an Execution Plan" src="images/iHKOE.png"></p>
<p>From here you can inspect the execution plan in SQL Server Management Studio,
or right click on the plan and select "Save Execution Plan As ..." to save the
plan to a file in XML format.</p>
<h3>Method 2 - Using SHOWPLAN options</h3>
<p>This method is very similar to method 1 (in fact this is what SQL Server
Management Studio does internally), however I have included it for
completeness or if you don't have SQL Server Management Studio available.</p>
<p>Before you run your query, run <strong>one</strong> of the following statements. The
statement must be the only statement in the batch, i.e. you cannot execute
another statement at the same time:</p>
<div class="code"><pre class="code literal-block">SET SHOWPLAN_TEXT ON
SET SHOWPLAN_ALL ON
SET SHOWPLAN_XML ON
SET STATISTICS PROFILE ON
SET STATISTICS XML ON -- The is the recommended option to use
</pre></div>

<p>These are connection options and so you only need to run this once per
connection. From this point on all statements run will be acompanied by an
<strong>additional resultset</strong> containing your execution plan in the desired format
- simply run your query as you normally would to see the plan.</p>
<p>Once you are done you can turn this option off with the following statement:</p>
<div class="code"><pre class="code literal-block">SET &lt;&lt;option&gt;&gt; OFF
</pre></div>

<h4>Comparison of execution plan formats</h4>
<p>Unless you have a strong preference my recommendation is to use the
<code>STATISTICS XML</code> option. This option is equivalent to the "Include Actual
Execution Plan" option in SQL Server Management Studio and supplies the most
information in the most convenient format.</p>
<ul>
<li>
<code>SHOWPLAN_TEXT</code> - Displays a basic text based estimated execution plan, without executing the query</li>
<li>
<code>SHOWPLAN_ALL</code> - Displays a text based estimated execution plan with cost estimations, without executing the query</li>
<li>
<code>SHOWPLAN_XML</code> - Displays an XML based estimated execution plan with cost estimations, without executing the query. This is equivalent to the "Display Estimated Execution Plan..." option in SQL Server Management Studio.</li>
<li>
<code>STATISTICS PROFILE</code> - Executes the query and displays a text based actual execution plan.</li>
<li>
<code>STATISTICS XML</code> - Executes the query and displays an XML based actual execution plan. This is equivalent to the "Include Actual Execution Plan" option in SQL Server Management Studio.</li>
</ul>
<h3>Method 3 - Using SQL Server Profiler</h3>
<p>If you can't run your query directly (or your query doesn't run slowly when
you execute it directly - remember we want a plan of the query performing
badly), then you can capture a plan using a SQL Server Profiler trace. The
idea is to run your query while a trace that is capturing one of the
"Showplan" events is running.</p>
<p>Note that depending on load you <strong>can</strong> use this method on a production
environment, however you should obviously use caution. The SQL Server
profiling mechanisms are designed to minimize impact on the database but this
doesn't mean that there won't be <em>any</em> performance impact. You may also have
problems filtering and identifying the correct plan in your trace if your
database is under heavy use. You should obviously check with your DBA to see
if they are happy with you doing this on their precious database!</p>
<ol>
<li>Open SQL Server Profiler and create a new trace connecting to the desired database against which you wish to record the trace.</li>
<li>Under the "Events Selection" tab check "Show all events", check the "Performance" -&gt; "Showplan XML" row and run the trace.</li>
<li>While the trace is running, do whatever it is you need to do to get the slow running query to run.</li>
<li>Wait for the query to complete and stop the trace.</li>
<li>To save the trace right click on the plan xml in SQL Server Profiler and select "Extract event data..." to save the plan to file in XML format.</li>
</ol>
<p>The plan you get is equivalent to the "Include Actual Execution Plan" option
in SQL Server Management Studio.</p>
<h3>Method 4 - Inspecting the query cache</h3>
<p>If you can't run your query directly and you also can't capture a profiler
trace then you can still obtain an estimated plan by inspecting the SQL query
plan cache.</p>
<p>We inspect the plan cache by querying SQL Server DMVs. The following is a
basic query which will list all cached query plans (as xml) along with their
SQL text. On most database you will also need to add additional filtering
clauses to filter the results down to just the plans you are interested in.</p>
<div class="code"><pre class="code literal-block">SELECT UseCounts, Cacheobjtype, Objtype, TEXT, query_plan
FROM sys.dm_exec_cached_plans 
CROSS APPLY sys.dm_exec_sql_text(plan_handle)
CROSS APPLY sys.dm_exec_query_plan(plan_handle)
</pre></div>

<p>Execute this query and click on the plan XML to open up the plan in a new
window - right click and select "Save execution plan as..." to save the plan
to file in XML format.</p>
<h2>Notes:</h2>
<p>Because there are so many factors involved (ranging from the table and index
schema down to the data stored and the table statistics) you should <strong>always</strong>
try to obtain an execution plan from the database you are interested in
(normally the one that is experiencing a performance problem).</p>
<p>You can't capture an execution plan for encrypted stored procedures.</p>
<h3>"actual" vs "estimated" execution plans</h3>
<p>An <em>actual</em> execution plan is one where SQL Server actually runs the query,
whereas an <em>estimated</em> execution plan SQL Server works out what it <em>would</em> do
without executing the query. Although logically equivalent, an actual
execution plan is much more useful as it contains additional details and
statistics about what actually happened when executing the query. This is
essential when diagnosing problems where SQL Servers estimations are off (such
as when statistics are out of date).</p>
<ul>
<li>Estimated and Actual execution plan revisited</li>
</ul>
<h3>How do I interpret a query execution plan?</h3>
<p>This is a topic worthy enough for a (free) book in its own right.</p>
<h3>See also:</h3>
<ul>
<li>Execution Plan Basics</li>
<li>SHOWPLAN Permission and Transact-SQL Batches</li>
<li>SQL Server 2008 – Using Query Hashes and Query Plan Hashes</li>
<li>Analyzing the SQL Server Plan Cache</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>In addition to the comprehensive answer already posted sometimes it is useful
to be able to access the execution plan programatically to extract
information. Example code for this is below.</p>
<div class="code"><pre class="code literal-block"><span class="k">DECLARE</span><span class="w"> </span><span class="nv">@TraceID</span><span class="w"> </span><span class="nc">INT</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">StartCapture</span><span class="w"> </span><span class="nb">@@SPID</span><span class="p">,</span><span class="w"> </span><span class="nv">@TraceID</span><span class="w"> </span><span class="k">OUTPUT</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sp_help</span><span class="w"> </span><span class="s1">'sys.objects'</span><span class="w"> </span><span class="cm">/*&lt;-- Call your stored proc of interest here.*/</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">StopCapture</span><span class="w"> </span><span class="nv">@TraceID</span>
</pre></div>

<h3>Example <code>StartCapture</code> Definition</h3>
<div class="code"><pre class="code literal-block"><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">StartCapture</span>
<span class="nv">@Spid</span><span class="w"> </span><span class="nc">INT</span><span class="p">,</span>
<span class="nv">@TraceID</span><span class="w"> </span><span class="nc">INT</span><span class="w"> </span><span class="k">OUTPUT</span>
<span class="k">AS</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@maxfilesize</span><span class="w"> </span><span class="nc">BIGINT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@filepath</span><span class="w"> </span><span class="nc">NVARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="s1">'C:\trace_'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">LEFT</span><span class="p">(</span><span class="nf">NEWID</span><span class="p">(),</span><span class="mi">36</span><span class="p">)</span>

<span class="k">EXEC</span><span class="w"> </span><span class="n">sp_trace_create</span><span class="w"> </span><span class="nv">@TraceID</span><span class="w"> </span><span class="k">OUTPUT</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">@filepath</span><span class="p">,</span><span class="w"> </span><span class="nv">@maxfilesize</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span>

<span class="k">exec</span><span class="w"> </span><span class="n">sp_trace_setevent</span><span class="w"> </span><span class="nv">@TraceID</span><span class="p">,</span><span class="w"> </span><span class="mi">122</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="k">exec</span><span class="w"> </span><span class="n">sp_trace_setevent</span><span class="w"> </span><span class="nv">@TraceID</span><span class="p">,</span><span class="w"> </span><span class="mi">122</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="k">exec</span><span class="w"> </span><span class="n">sp_trace_setevent</span><span class="w"> </span><span class="nv">@TraceID</span><span class="p">,</span><span class="w"> </span><span class="mi">122</span><span class="p">,</span><span class="w"> </span><span class="mi">34</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="k">exec</span><span class="w"> </span><span class="n">sp_trace_setevent</span><span class="w"> </span><span class="nv">@TraceID</span><span class="p">,</span><span class="w"> </span><span class="mi">122</span><span class="p">,</span><span class="w"> </span><span class="mi">51</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="k">exec</span><span class="w"> </span><span class="n">sp_trace_setevent</span><span class="w"> </span><span class="nv">@TraceID</span><span class="p">,</span><span class="w"> </span><span class="mi">122</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<span class="o">--</span><span class="w"> </span><span class="k">filter</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">spid</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sp_trace_setfilter</span><span class="w"> </span><span class="nv">@TraceID</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">@Spid</span>
<span class="o">--</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">trace</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sp_trace_setstatus</span><span class="w"> </span><span class="nv">@TraceID</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
</pre></div>

<h3>Example <code>StopCapture</code> Definition</h3>
<div class="code"><pre class="code literal-block"><span class="k">CREATE</span><span class="w">  </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">StopCapture</span>
<span class="nv">@TraceID</span><span class="w"> </span><span class="nc">INT</span>
<span class="k">AS</span>
<span class="k">WITH</span><span class="w">  </span><span class="k">XMLNAMESPACES</span><span class="w"> </span><span class="p">(</span><span class="s1">'http://schemas.microsoft.com/sqlserver/2004/07/showplan'</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">sql</span><span class="p">),</span><span class="w"> </span>
<span class="w">      </span><span class="n">CTE</span>
<span class="w">     </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">CAST</span><span class="p">(</span><span class="n">TextData</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nc">VARCHAR</span><span class="p">(</span><span class="nf">MAX</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">TextData</span><span class="p">,</span>
<span class="w">                </span><span class="n">ObjectID</span><span class="p">,</span>
<span class="w">                </span><span class="n">ObjectName</span><span class="p">,</span>
<span class="w">                </span><span class="n">EventSequence</span><span class="p">,</span>
<span class="w">                </span><span class="cm">/*costs accumulate up the tree so the MAX should be the root*/</span>
<span class="w">                </span><span class="nf">MAX</span><span class="p">(</span><span class="n">EstimatedTotalSubtreeCost</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">EstimatedTotalSubtreeCost</span>
<span class="w">         </span><span class="k">FROM</span><span class="w">   </span><span class="n">fn_trace_getinfo</span><span class="p">(</span><span class="nv">@TraceID</span><span class="p">)</span><span class="w"> </span><span class="n">fn</span>
<span class="w">                </span><span class="k">CROSS</span><span class="w"> </span><span class="n">APPLY</span><span class="w"> </span><span class="n">fn_trace_gettable</span><span class="p">(</span><span class="nf">CAST</span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nc">NVARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)),</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                </span><span class="k">CROSS</span><span class="w"> </span><span class="n">APPLY</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">CAST</span><span class="p">(</span><span class="n">TextData</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nc">XML</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">xPlan</span><span class="p">)</span><span class="w"> </span><span class="n">x</span>
<span class="w">                </span><span class="k">CROSS</span><span class="w"> </span><span class="n">APPLY</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">T</span><span class="p">.</span><span class="n">relop</span><span class="p">.</span><span class="k">value</span><span class="p">(</span><span class="s1">'@EstimatedTotalSubtreeCost'</span><span class="p">,</span>
<span class="w">                                            </span><span class="s1">'float'</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">EstimatedTotalSubtreeCost</span>
<span class="w">                             </span><span class="k">FROM</span><span class="w">   </span><span class="n">xPlan</span><span class="p">.</span><span class="n">nodes</span><span class="p">(</span><span class="s1">'//sql:RelOp'</span><span class="p">)</span><span class="w"> </span><span class="n">T</span><span class="p">(</span><span class="n">relop</span><span class="p">))</span><span class="w"> </span><span class="n">ca</span>
<span class="w">         </span><span class="k">WHERE</span><span class="w">  </span><span class="n">property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">                </span><span class="ow">AND</span><span class="w"> </span><span class="n">TextData</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="w">                </span><span class="ow">AND</span><span class="w"> </span><span class="n">ObjectName</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="s1">'StopCapture'</span><span class="p">,</span><span class="w"> </span><span class="s1">'fn_trace_getinfo'</span><span class="w"> </span><span class="p">)</span>
<span class="w">         </span><span class="k">GROUP</span><span class="w">  </span><span class="k">BY</span><span class="w"> </span><span class="nf">CAST</span><span class="p">(</span><span class="n">TextData</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nc">VARCHAR</span><span class="p">(</span><span class="nf">MAX</span><span class="p">)),</span>
<span class="w">                   </span><span class="n">ObjectID</span><span class="p">,</span>
<span class="w">                   </span><span class="n">ObjectName</span><span class="p">,</span>
<span class="w">                   </span><span class="n">EventSequence</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">ObjectName</span><span class="p">,</span>
<span class="w">       </span><span class="nf">SUM</span><span class="p">(</span><span class="n">EstimatedTotalSubtreeCost</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">EstimatedTotalSubtreeCost</span>
<span class="k">FROM</span><span class="w">   </span><span class="n">CTE</span>
<span class="k">GROUP</span><span class="w">  </span><span class="k">BY</span><span class="w"> </span><span class="n">ObjectID</span><span class="p">,</span>
<span class="w">          </span><span class="n">ObjectName</span>

<span class="o">--</span><span class="w"> </span><span class="n">Stop</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">trace</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sp_trace_setstatus</span><span class="w"> </span><span class="nv">@TraceID</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
<span class="o">--</span><span class="w"> </span><span class="k">Close</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">trace</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">sp_trace_setstatus</span><span class="w"> </span><span class="nv">@TraceID</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span>
<span class="k">GO</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2505.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2503.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
