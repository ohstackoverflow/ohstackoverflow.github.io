<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 439) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-439.html">
<link rel="prev" href="index-440.html" type="text/html">
<link rel="next" href="index-438.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/best-way-to-use-google-s-hosted-jquery-but-fall-back-to-my-hosted-library-on-google-fail/" class="u-url">Best way to use Google's hosted jQuery, but fall back to my hosted library on Google fail</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/best-way-to-use-google-s-hosted-jquery-but-fall-back-to-my-hosted-library-on-google-fail/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T06:53:08+08:00" itemprop="datePublished" title="2023-02-17 06:53">2023-02-17 06:53</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What would be a good way to attempt to load the hosted jQuery at Google (or
other Google hosted libs), but load my copy of jQuery if the Google attempt
fails?</p>
<p>I'm not saying Google is flaky. There are cases where the Google copy is
blocked (apparently in Iran, for instance).</p>
<p>Would I set up a timer and check for the jQuery object?</p>
<p>What would be the danger of both copies coming through?</p>
<p>Not really looking for answers like "just use the Google one" or "just use
your own." I understand those arguments. I also understand that the user is
likely to have the Google version cached. I'm thinking about fallbacks for the
cloud in general.</p>
<hr>
<p>Edit: This part added...</p>
<p>Since Google suggests using google.load to load the ajax libraries, and it
performs a callback when done, I'm wondering if that's the key to serializing
this problem.</p>
<p>I know it sounds a bit crazy. I'm just trying to figure out if it can be done
in a reliable way or not.</p>
<hr>
<p>Update: jQuery now hosted on Microsoft's CDN.</p>
<p>http://www.asp.net/ajax/cdn/</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can achieve it like this:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="w">       </span>window.jQuery<span class="w"> </span>||<span class="w"> </span>document.write('<span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"/path/to/your/jquery"</span><span class="nt">&gt;</span><span class="err">&lt;</span>\/script&gt;');
<span class="nt">&lt;/script&gt;</span>
</pre></div>

<p>This should be in your page's <code>&lt;head&gt;</code> and any jQuery ready event handlers
should be in the <code>&lt;body&gt;</code> to avoid errors (although it's not fool-proof!).</p>
<p>One more reason to <strong>not</strong> use Google-hosted <strong>jQuery</strong> is that in some
countries, Google's domain name is banned.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The easiest and cleanest way to do this by far:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>window.jQuery<span class="w"> </span>||<span class="w"> </span>document.write('<span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"path/to/your/jquery"</span><span class="nt">&gt;</span><span class="err">&lt;</span>\/script&gt;')<span class="nt">&lt;/script&gt;</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-create-recyclerview-with-multiple-view-types/" class="u-url">How to create RecyclerView with multiple view types</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-create-recyclerview-with-multiple-view-types/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T06:52:40+08:00" itemprop="datePublished" title="2023-02-17 06:52">2023-02-17 06:52</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>From <em>Create dynamic lists with RecyclerView</em> :</p>
<p>When we create a <code>RecyclerView.Adapter</code> we have to specify <code>ViewHolder</code> that
will bind with the adapter.</p>
<div class="code"><pre class="code literal-block"><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">MyAdapter</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="p">.</span><span class="n">Adapter</span><span class="o">&lt;</span><span class="n">MyAdapter</span><span class="p">.</span><span class="n">ViewHolder</span><span class="o">&gt;</span><span class="w"> </span><span class="err">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">String</span><span class="err">[]</span><span class="w"> </span><span class="n">mDataset</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">MyAdapter</span><span class="p">(</span><span class="n">String</span><span class="err">[]</span><span class="w"> </span><span class="n">myDataset</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">mDataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myDataset</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ViewHolder</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="p">.</span><span class="n">ViewHolder</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">TextView</span><span class="w"> </span><span class="n">mTextView</span><span class="p">;</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="n">ViewHolder</span><span class="p">(</span><span class="n">TextView</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">super</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="w">            </span><span class="n">mTextView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">MyAdapter</span><span class="p">.</span><span class="n">ViewHolder</span><span class="w"> </span><span class="n">onCreateViewHolder</span><span class="p">(</span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">viewType</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">View</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutInflater</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="n">parent</span><span class="p">.</span><span class="n">getContext</span><span class="p">()).</span><span class="n">inflate</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">some_layout</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="n">findViewById</span><span class="p">...</span>

<span class="w">        </span><span class="n">ViewHolder</span><span class="w"> </span><span class="n">vh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ViewHolder</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">vh</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onBindViewHolder</span><span class="p">(</span><span class="n">ViewHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="k">position</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">holder</span><span class="p">.</span><span class="n">mTextView</span><span class="p">.</span><span class="n">setText</span><span class="p">(</span><span class="n">mDataset</span><span class="o">[</span><span class="n">position</span><span class="o">]</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">getItemCount</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mDataset</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>Is it possible to create <code>RecyclerView</code> with multiple view types?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Yes, it's possible. Just implement getItemViewType(), and take care of the
<code>viewType</code> parameter in <code>onCreateViewHolder()</code>.</p>
<p>So you do something like:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">MyAdapter</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">Adapter</span><span class="o">&lt;</span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">ViewHolder</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="n">ViewHolder0</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">ViewHolder</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">ViewHolder0</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">itemView</span><span class="p">){</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="n">ViewHolder2</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">ViewHolder</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">ViewHolder2</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">itemView</span><span class="p">){</span>
<span class="w">        </span><span class="o">...</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getItemViewType</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Just</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">example</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">depending</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">position</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">unlike</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">ListView</span><span class="w"> </span><span class="n">adapters</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="n">don</span><span class="s1">'t have to be contiguous</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">ViewHolder</span><span class="w"> </span><span class="n">onCreateViewHolder</span><span class="p">(</span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">viewType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">switch</span><span class="w"> </span><span class="p">(</span><span class="n">viewType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">             </span><span class="n">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ViewHolder0</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
<span class="w">             </span><span class="n">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ViewHolder2</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
<span class="w">             </span><span class="o">...</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onBindViewHolder</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">ViewHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">switch</span><span class="w"> </span><span class="p">(</span><span class="n">holder</span><span class="o">.</span><span class="n">getItemViewType</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">                </span><span class="n">ViewHolder0</span><span class="w"> </span><span class="n">viewHolder0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ViewHolder0</span><span class="p">)</span><span class="n">holder</span><span class="p">;</span>
<span class="w">                </span><span class="o">...</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>

<span class="w">            </span><span class="n">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<span class="w">                </span><span class="n">ViewHolder2</span><span class="w"> </span><span class="n">viewHolder2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ViewHolder2</span><span class="p">)</span><span class="n">holder</span><span class="p">;</span>
<span class="w">                </span><span class="o">...</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>If the layouts for view types are only a few and binding logics are simple,
follow Anton's solution. But the code will be messy if you need to manage the
complex layouts and binding logics.</p>
<p>I believe the following solution will be useful for someone who need to handle
complex view types.</p>
<p><strong>Base DataBinder class</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">abstract</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">DataBinder</span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">ViewHolder</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">DataBindAdapter</span><span class="w"> </span><span class="n">mDataBindAdapter</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">DataBinder</span><span class="p">(</span><span class="n">DataBindAdapter</span><span class="w"> </span><span class="n">dataBindAdapter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mDataBindAdapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataBindAdapter</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">abstract</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">newViewHolder</span><span class="p">(</span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">parent</span><span class="p">);</span>

<span class="w">    </span><span class="n">abstract</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">bindViewHolder</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">);</span>

<span class="w">    </span><span class="n">abstract</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getItemCount</span><span class="p">();</span>

<span class="o">......</span>

<span class="p">}</span>
</pre></div>

<p>The functions needed to define in this class are pretty much same as the
adapter class when creating the single view type.</p>
<p>For each view type, create the class by extending this DataBinder.</p>
<p><strong>Sample DataBinder class</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">Sample1Binder</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">DataBinder</span><span class="o">&lt;</span><span class="n">Sample1Binder</span><span class="o">.</span><span class="n">ViewHolder</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mDataSet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="p">();</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">Sample1Binder</span><span class="p">(</span><span class="n">DataBindAdapter</span><span class="w"> </span><span class="n">dataBindAdapter</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="n">dataBindAdapter</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ViewHolder</span><span class="w"> </span><span class="n">newViewHolder</span><span class="p">(</span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">View</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutInflater</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">getContext</span><span class="p">())</span><span class="o">.</span><span class="n">inflate</span><span class="p">(</span>
<span class="w">            </span><span class="n">R</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">layout_sample1</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ViewHolder</span><span class="p">(</span><span class="n">view</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">bindViewHolder</span><span class="p">(</span><span class="n">ViewHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mDataSet</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">position</span><span class="p">);</span>
<span class="w">        </span><span class="n">holder</span><span class="o">.</span><span class="n">mTitleText</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">title</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getItemCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mDataSet</span><span class="o">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">setDataSet</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dataSet</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mDataSet</span><span class="o">.</span><span class="n">addAll</span><span class="p">(</span><span class="n">dataSet</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ViewHolder</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">ViewHolder</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">TextView</span><span class="w"> </span><span class="n">mTitleText</span><span class="p">;</span>

<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">ViewHolder</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">view</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">super</span><span class="p">(</span><span class="n">view</span><span class="p">);</span>
<span class="w">            </span><span class="n">mTitleText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">TextView</span><span class="p">)</span><span class="w"> </span><span class="n">view</span><span class="o">.</span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">title_type1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In order to manage DataBinder classes, create an adapter class.</p>
<p><strong>Base DataBindAdapter class</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">abstract</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">DataBindAdapter</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">Adapter</span><span class="o">&lt;</span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">ViewHolder</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">ViewHolder</span><span class="w"> </span><span class="n">onCreateViewHolder</span><span class="p">(</span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">viewType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getDataBinder</span><span class="p">(</span><span class="n">viewType</span><span class="p">)</span><span class="o">.</span><span class="n">newViewHolder</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onBindViewHolder</span><span class="p">(</span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">ViewHolder</span><span class="w"> </span><span class="n">viewHolder</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">binderPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getBinderPosition</span><span class="p">(</span><span class="n">position</span><span class="p">);</span>
<span class="w">        </span><span class="n">getDataBinder</span><span class="p">(</span><span class="n">viewHolder</span><span class="o">.</span><span class="n">getItemViewType</span><span class="p">())</span><span class="o">.</span><span class="n">bindViewHolder</span><span class="p">(</span><span class="n">viewHolder</span><span class="p">,</span><span class="w"> </span><span class="n">binderPosition</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getItemCount</span><span class="p">();</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getItemViewType</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">);</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">DataBinder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">getDataBinder</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">viewType</span><span class="p">);</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getPosition</span><span class="p">(</span><span class="n">DataBinder</span><span class="w"> </span><span class="n">binder</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">binderPosition</span><span class="p">);</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getBinderPosition</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">);</span>

<span class="o">......</span>

<span class="p">}</span>
</pre></div>

<p>Create the class by extending this base class, and then instantiate DataBinder
classes and override abstract methods</p>
<ol>
<li>
<p>getItemCount <br>
Return the total item count of DataBinders</p>
</li>
<li>
<p>getItemViewType <br>
Define the mapping logic between the adapter position and view type.</p>
</li>
<li>
<p>getDataBinder <br>
Return the DataBinder instance based on the view type</p>
</li>
<li>
<p>getPosition <br>
Define convert logic to the adapter position from the position in the
specified DataBinder</p>
</li>
<li>
<p>getBinderPosition <br>
Define convert logic to the position in the DataBinder from the adapter
position</p>
</li>
</ol>
<p>I left a more detailed solution and samples on GitHub, so please refer to
<em>RecyclerView-MultipleViewTypeAdapter</em> if you need.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/understanding-the-rails-authenticity-token/" class="u-url">Understanding the Rails Authenticity Token</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/understanding-the-rails-authenticity-token/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T06:52:13+08:00" itemprop="datePublished" title="2023-02-17 06:52">2023-02-17 06:52</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What is the Authenticity Token in Rails?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>What happens</strong></p>
<p>When the user views a form to create, update, or destroy a resource, the Rails
app creates a random <code>authenticity_token</code>, stores this token in the session,
and places it in a hidden field in the form. When the user submits the form,
Rails looks for the <code>authenticity_token</code>, compares it to the one stored in the
session, and if they match the request is allowed to continue.</p>
<p><strong>Why it happens</strong></p>
<p>Since the authenticity token is stored in the session, the client cannot know
its value. This prevents people from submitting forms to a Rails app without
viewing the form within that app itself. Imagine that you are using service A,
you logged into the service and everything is OK. Now imagine that you went to
use service B, and you saw a picture you like, and pressed on the picture to
view a larger size of it. Now, if some evil code was there at service B, it
might send a request to service A (which you are logged into), and ask to
delete your account, by sending a request to
<code>http://serviceA.example/close_account</code>. This is what is known as CSRF (Cross
Site Request Forgery).</p>
<p>If service A is using authenticity tokens, this attack vector is no longer
applicable, since the request from service B would not contain the correct
authenticity token, and will not be allowed to continue.</p>
<p>API docs describes details about meta tag:</p>
<blockquote>
<p>CSRF protection is turned on with the <code>protect_from_forgery</code> method, which
checks the token and resets the session if it doesn't match what was
expected. A call to this method is generated for new Rails applications by
default. The token parameter is named <code>authenticity_token</code> by default. The
name and value of this token must be added to every layout that renders
forms by including <code>csrf_meta_tags</code> in the HTML head.</p>
</blockquote>
<p><strong>Notes</strong></p>
<p>Keep in mind, Rails only verifies not idempotent methods (POST, PUT/PATCH and
DELETE). GET request are not checked for authenticity token. Why? because the
HTTP specification states that GET requests is idempotent and should <strong>not</strong>
create, alter, or destroy resources at the server, and the request should be
idempotent (if you run the same command multiple times, you should get the
same result every time).</p>
<p>Also the real implementation is a bit more complicated as defined in the
beginning, ensuring better security. Rails does not issue the same stored
token with every form. Neither does it generate and store a different token
every time. It generates and stores a cryptographic hash in a session and
issues new cryptographic tokens, which can be matched against the stored one,
every time a page is rendered. See request_forgery_protection.rb.</p>
<p><strong>Lessons</strong></p>
<p>Use <code>authenticity_token</code> to protect your not idempotent methods (POST,
PUT/PATCH, and DELETE). Also make sure not to allow any GET requests that
could potentially modify resources on the server.</p>
<hr>
<p>Check the comment by @erturne regarding GET requests being idempotent. He
explains it in a better way than I have done here.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The authenticity token is designed so that you know your form is being
submitted from your website. It is generated from the machine on which it runs
with a unique identifier that only your machine can know, thus helping prevent
cross-site request forgery attacks.</p>
<p>If you are simply having difficulty with rails denying your AJAX script
access, you can use</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;%=</span><span class="w"> </span><span class="n">form_authenticity_token</span><span class="w"> </span><span class="cp">%&gt;</span>
</pre></div>

<p>to generate the correct token when you are creating your form.</p>
<p>You can read more about it in the documentation.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-440.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-438.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
