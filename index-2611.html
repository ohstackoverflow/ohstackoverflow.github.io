<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2611) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2611.html">
<link rel="prev" href="index-2612.html" type="text/html">
<link rel="next" href="index-2610.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jquery-event-to-trigger-action-when-a-div-is-made-visible/" class="u-url">jQuery event to trigger action when a div is made visible</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/jquery-event-to-trigger-action-when-a-div-is-made-visible/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T04:47:23+08:00" itemprop="datePublished" title="2023-03-05 04:47">2023-03-05 04:47</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm using jQuery in my site and I would like to trigger certain actions when a
certain div is made visible.</p>
<p>Is it possible to attach some sort of "isvisible" event handler to arbitrary
divs and have certain code run when they the div is made visible?</p>
<p>I would like something like the following pseudocode:</p>
<div class="code"><pre class="code literal-block">$<span class="ss">(</span><span class="nv">function</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">  </span>$<span class="ss">(</span><span class="s1">'#contentDiv'</span><span class="ss">)</span>.<span class="nv">isvisible</span><span class="ss">(</span><span class="nv">function</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">alert</span><span class="ss">(</span><span class="s2">"do something"</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">  </span>}<span class="ss">)</span><span class="c1">;</span>
}<span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>The alert("do something") code should not fire until the contentDiv is
actually made visible.</p>
<p>Thanks.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You could always add to the original .show() method so you don't have to
trigger events every time you show something or if you need it to work with
legacy code:</p>
<h4>Jquery extension:</h4>
<div class="code"><pre class="code literal-block"><span class="n">jQuery</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="o">$</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">_oldShow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$.</span><span class="n">fn</span><span class="o">.</span><span class="n">show</span><span class="p">;</span>

<span class="w">  </span><span class="o">$.</span><span class="n">fn</span><span class="o">.</span><span class="n">show</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span><span class="w"> </span><span class="n">oldCallback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">var</span><span class="w"> </span><span class="n">obj</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="n">this</span><span class="p">),</span>
<span class="w">          </span><span class="n">newCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">$.</span><span class="n">isFunction</span><span class="p">(</span><span class="n">oldCallback</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">oldCallback</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">obj</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s1">'afterShow'</span><span class="p">);</span>
<span class="w">          </span><span class="p">};</span>

<span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">trigger</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span>
<span class="w">      </span><span class="n">obj</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s1">'beforeShow'</span><span class="p">);</span>

<span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">old</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="n">passing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">callback</span>
<span class="w">      </span><span class="n">_oldShow</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">speed</span><span class="p">,</span><span class="w"> </span><span class="n">newCallback</span><span class="p">]);</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>

<h4>Usage example:</h4>
<div class="code"><pre class="code literal-block"><span class="nv">jQuery</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span>$<span class="ss">)</span><span class="w"> </span>{
<span class="w">  </span>$<span class="ss">(</span><span class="s1">'#test'</span><span class="ss">)</span>
<span class="w">    </span>.<span class="nv">bind</span><span class="ss">(</span><span class="s1">'beforeShow'</span>,<span class="w"> </span><span class="nv">function</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">      </span><span class="nv">alert</span><span class="ss">(</span><span class="s1">'beforeShow'</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}<span class="ss">)</span><span class="w"> </span>
<span class="w">    </span>.<span class="nv">bind</span><span class="ss">(</span><span class="s1">'afterShow'</span>,<span class="w"> </span><span class="nv">function</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">      </span><span class="nv">alert</span><span class="ss">(</span><span class="s1">'afterShow'</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}<span class="ss">)</span>
<span class="w">    </span>.<span class="k">show</span><span class="ss">(</span><span class="mi">1000</span>,<span class="w"> </span><span class="nv">function</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">      </span><span class="nv">alert</span><span class="ss">(</span><span class="s1">'in show callback'</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}<span class="ss">)</span>
<span class="w">    </span>.<span class="k">show</span><span class="ss">()</span><span class="c1">;</span>
}<span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>This effectively lets you do something beforeShow and afterShow while still
executing the normal behavior of the original .show() method.</p>
<p>You could also create another method so you don't have to override the
original .show() method.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The problem is being addressed by DOM mutation observers. They allow you to
bind an observer (a function) to events of changing content, text or
attributes of dom elements.</p>
<p>With the release of IE11, all major browsers support this feature, check
http://caniuse.com/mutationobserver</p>
<p>The example code is a follows:</p>
<div class="code"><pre class="code literal-block">$(function()<span class="w"> </span>{
<span class="w">  </span>$('#show').click(function()<span class="w"> </span>{
<span class="w">    </span>$('#testdiv').show();
<span class="w">  </span>});

<span class="w">  </span>var<span class="w"> </span>observer<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>MutationObserver(function(mutations)<span class="w"> </span>{
<span class="w">    </span>alert('Attributes<span class="w"> </span>changed!');
<span class="w">  </span>});
<span class="w">  </span>var<span class="w"> </span>target<span class="w"> </span>=<span class="w"> </span>document.querySelector('#testdiv');
<span class="w">  </span>observer.observe(target,<span class="w"> </span>{
<span class="w">    </span>attributes:<span class="w"> </span>true
<span class="w">  </span>});

});


<span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">"testdiv"</span><span class="w"> </span><span class="na">style=</span><span class="s">"display:none;"</span><span class="nt">&gt;</span>hidden<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;button</span><span class="w"> </span><span class="na">id=</span><span class="s">"show"</span><span class="nt">&gt;</span>Show<span class="w"> </span>hidden<span class="w"> </span>div<span class="nt">&lt;/button&gt;</span>

<span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="w"> </span><span class="na">src=</span><span class="s">"https://code.jquery.com/jquery-1.9.1.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-maven-shade-plugin-used-for-and-why-would-you-want-to-relocate-java-packages/" class="u-url">What is the maven-shade-plugin used for, and why would you want to relocate Java packages?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-maven-shade-plugin-used-for-and-why-would-you-want-to-relocate-java-packages/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T04:45:53+08:00" itemprop="datePublished" title="2023-03-05 04:45">2023-03-05 04:45</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I found the maven-shade-plugin being used in someone's pom.xml. I've never
used maven-shade-plugin before (and I'm a Maven n00b) so I tried to understand
the reason for using this and what it does.</p>
<p>I looked at the Maven docs, however I can't understand this statement:</p>
<blockquote>
<p>This plugin provides the capability to package the artifact in an uber-jar,
including its dependencies and to shade - i.e. rename - the packages of some
of the dependencies.</p>
</blockquote>
<p>The documentation on the page doesn't seem very newbie-friendly.</p>
<p>What is an "uber jar?" Why would someone want to make one? What's the point of
renaming the packages of the dependencies? I tried to go through the examples
on the maven-shade-plugin apache page such as "Selecting contents for Uber
Jar," but I still can't understand what is being accomplished with "shading."</p>
<p>Any pointers to illustrative examples/use-cases (with an explanation of why
shading was required in this case - what problem is it solving) would be
appreciated. Lastly, when should I use the maven-shade-plugin?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Uber JAR, in short, is a JAR containing everything.</p>
<p>Normally in Maven, we rely on dependency management. An artifact contains only
the classes/resources of itself. Maven will be responsible to find out all
artifacts (JARs etc) that the project depending on when the project is built.</p>
<p>An uber-jar is something that takes all dependencies, and extracts the content
of the dependencies and puts them with the classes/resources of the project
itself, in one big JAR. By having such an uber-jar, it is easy for execution,
because you will need only one big JAR instead of tons of small JARs to run
your app. It also eases distribution in some cases.</p>
<p>Just a side-note: avoid using uber-jar as a Maven dependency, as it is ruining
the dependency resolution feature of Maven. Normally we create an uber-jar
only for the final artifact for actual deployment or for manual distribution,
but not for putting to Maven repository.</p>
<hr>
<p>Update: I have just discovered I haven't answered one part of the question :
"What's the point of renaming the packages of the dependencies?". Here are
some brief updates that will hopefully help people having similar questions.</p>
<p>Creating an uber-jar for ease of deployment is one use case of the shade
plugin. There are also other common use cases which involve package renaming.</p>
<p>For example, I am developing <code>Foo</code> library, which depends on a specific
version (e.g. 1.0) of <code>Bar</code> library. Assuming I cannot make use of other
version of <code>Bar</code> lib (because API change, or other technical issues, etc). If
I simply declare <code>Bar:1.0</code> as <code>Foo</code>'s dependency in Maven, it is possible to
fall into a problem: A <code>Qux</code> project is depending on <code>Foo</code>, and also <code>Bar:2.0</code>
(and it cannot use <code>Bar:1.0</code> because <code>Qux</code> needs to use new feature in
<code>Bar:2.0</code>). Here is the dilemma: should <code>Qux</code> use <code>Bar:1.0</code> (which <code>Qux</code>'s
code will not work) or <code>Bar:2.0</code> (which <code>Foo</code>'s code will not work)?</p>
<p>In order to solve this problem, developer of <code>Foo</code> can choose to use shade
plugin to rename its usage of <code>Bar</code>, so that all classes in <code>Bar:1.0</code> jar are
embedded in <code>Foo</code> jar, and the package of the embedded <code>Bar</code> classes is
changed from <code>com.bar</code> to <code>com.foo.bar</code>. By doing so, <code>Qux</code> can safely depends
on <code>Bar:2.0</code> because now <code>Foo</code> is no longer depending on <code>Bar</code>, and it is
using its own copy of the "altered" <code>Bar</code> located in another package.</p>
<p><img alt="enter image description here" src="images/BVX9w.png"></p>
<p><br></p>
<h3>Suggest</h3>
<p>I was wondering myself recently why elasticsearch shades and relocates a few
(but not all) of its dependencies. Here's an explanation from the project's
maintainer, <strong>@kimchy</strong> :</p>
<blockquote>
<p>The shading part is intentional, the shaded libraries we use in
elasticsearch are for all intent and purpose part of elasticsearch, the
version used is tied closely into what elasticsearch exposes and how it uses
the library based on the internals of how the library works (and that
changes between versions), netty and guava are great examples.</p>
<p>Btw, I have no problem with actually providing several jars of
elasticsearch, one with lucene not shaded, and one with Lucene shaded. Not
sure how to do it with maven though. I don't want to provide a version that
does not shade netty/jackson for example, because of the deep intimiate
usage elasticsearch has with them (for example, using the upcoming
bufferring improvement with any previous version of netty except for the
current one will actually use more memory compared to using considerably
less).</p>
</blockquote>
<p><em>--
https://github.com/elasticsearch/elasticsearch/issues/2091#issuecomment-7156766</em></p>
<p>And another here from <strong>drewr</strong> :</p>
<blockquote>
<p>The shading is important to keep our dependencies (notably netty, lucene,
guava) close to our code so that we can fix an issue even if the upstream
provider lags behind. It's possible we will distributed modularized versions
of the code, which would help with your particular issue (#2091 for
example), but we can't simply remove the shaded dependencies at this time.
You can build a local version of ES for your purposes until there's a better
solution.</p>
</blockquote>
<p><em>--
https://github.com/elasticsearch/elasticsearch/pull/3244#issuecomment-20125452</em></p>
<p>So, that's one use case. As for an illustrative example, below is how maven-
shade-plugin is used in elasticsearch's pom.xml (v0.90.5). The
<code>artifactSet::include</code> lines instruct it what dependencies to pull into the
uber JAR (basically, they are unzipped and and re-packaged alongside
elasticsearch's own classes when the target elasticsearch jar is produced. (In
case you didn't know this already, a JAR file is just a ZIP file that contains
the program's classes, resources, etc., and some metadata. You can extract one
to see how it's put together.)</p>
<p>The <code>relocations::relocation</code> lines are similar, except that in each case they
also apply the specified substitutions to the dependency's classes - in this
case, bringing them under <code>org.elasticsearch.common</code>.</p>
<p>Finally the <code>filters</code> section excludes some stuff from the target JAR that
oughtn't be in there - such as JAR metadata, ant build files, text files, etc.
that are packaged with some dependencies, but which don't belong in an uber
JAR.</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;plugins&gt;</span>
<span class="w">    </span><span class="nt">&lt;plugin&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>maven-shade-plugin<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;executions&gt;</span>
<span class="w">            </span><span class="nt">&lt;execution&gt;</span>
<span class="w">                </span><span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
<span class="w">                </span><span class="nt">&lt;goals&gt;</span>
<span class="w">                    </span><span class="nt">&lt;goal&gt;</span>shade<span class="nt">&lt;/goal&gt;</span>
<span class="w">                </span><span class="nt">&lt;/goals&gt;</span>
<span class="w">            </span><span class="nt">&lt;/execution&gt;</span>
<span class="w">        </span><span class="nt">&lt;/executions&gt;</span>
<span class="w">        </span><span class="nt">&lt;configuration&gt;</span>
<span class="w">            </span><span class="nt">&lt;minimizeJar&gt;</span>true<span class="nt">&lt;/minimizeJar&gt;</span>
<span class="w">            </span><span class="nt">&lt;artifactSet&gt;</span>
<span class="w">                </span><span class="nt">&lt;includes&gt;</span>
<span class="w">                    </span><span class="nt">&lt;include&gt;</span>com.google.guava:guava<span class="nt">&lt;/include&gt;</span>
<span class="w">                    </span><span class="nt">&lt;include&gt;</span>net.sf.trove4j:trove4j<span class="nt">&lt;/include&gt;</span>
<span class="w">                    </span><span class="nt">&lt;include&gt;</span>org.mvel:mvel2<span class="nt">&lt;/include&gt;</span>
<span class="w">                    </span><span class="nt">&lt;include&gt;</span>com.fasterxml.jackson.core:jackson-core<span class="nt">&lt;/include&gt;</span>
<span class="w">                    </span><span class="nt">&lt;include&gt;</span>com.fasterxml.jackson.dataformat:jackson-dataformat-smile<span class="nt">&lt;/include&gt;</span>
<span class="w">                    </span><span class="nt">&lt;include&gt;</span>com.fasterxml.jackson.dataformat:jackson-dataformat-yaml<span class="nt">&lt;/include&gt;</span>
<span class="w">                    </span><span class="nt">&lt;include&gt;</span>joda-time:joda-time<span class="nt">&lt;/include&gt;</span>
<span class="w">                    </span><span class="nt">&lt;include&gt;</span>io.netty:netty<span class="nt">&lt;/include&gt;</span>
<span class="w">                    </span><span class="nt">&lt;include&gt;</span>com.ning:compress-lzf<span class="nt">&lt;/include&gt;</span>
<span class="w">                </span><span class="nt">&lt;/includes&gt;</span>
<span class="w">            </span><span class="nt">&lt;/artifactSet&gt;</span>
<span class="w">            </span><span class="nt">&lt;relocations&gt;</span>
<span class="w">                </span><span class="nt">&lt;relocation&gt;</span>
<span class="w">                    </span><span class="nt">&lt;pattern&gt;</span>com.google.common<span class="nt">&lt;/pattern&gt;</span>
<span class="w">                    </span><span class="nt">&lt;shadedPattern&gt;</span>org.elasticsearch.common<span class="nt">&lt;/shadedPattern&gt;</span>
<span class="w">                </span><span class="nt">&lt;/relocation&gt;</span>
<span class="w">                </span><span class="nt">&lt;relocation&gt;</span>
<span class="w">                    </span><span class="nt">&lt;pattern&gt;</span>gnu.trove<span class="nt">&lt;/pattern&gt;</span>
<span class="w">                    </span><span class="nt">&lt;shadedPattern&gt;</span>org.elasticsearch.common.trove<span class="nt">&lt;/shadedPattern&gt;</span>
<span class="w">                </span><span class="nt">&lt;/relocation&gt;</span>
<span class="w">                </span><span class="nt">&lt;relocation&gt;</span>
<span class="w">                    </span><span class="nt">&lt;pattern&gt;</span>jsr166y<span class="nt">&lt;/pattern&gt;</span>
<span class="w">                    </span><span class="nt">&lt;shadedPattern&gt;</span>org.elasticsearch.common.util.concurrent.jsr166y<span class="nt">&lt;/shadedPattern&gt;</span>
<span class="w">                </span><span class="nt">&lt;/relocation&gt;</span>
<span class="w">                </span><span class="nt">&lt;relocation&gt;</span>
<span class="w">                    </span><span class="nt">&lt;pattern&gt;</span>jsr166e<span class="nt">&lt;/pattern&gt;</span>
<span class="w">                    </span><span class="nt">&lt;shadedPattern&gt;</span>org.elasticsearch.common.util.concurrent.jsr166e<span class="nt">&lt;/shadedPattern&gt;</span>
<span class="w">                </span><span class="nt">&lt;/relocation&gt;</span>
<span class="w">                </span><span class="nt">&lt;relocation&gt;</span>
<span class="w">                    </span><span class="nt">&lt;pattern&gt;</span>org.mvel2<span class="nt">&lt;/pattern&gt;</span>
<span class="w">                    </span><span class="nt">&lt;shadedPattern&gt;</span>org.elasticsearch.common.mvel2<span class="nt">&lt;/shadedPattern&gt;</span>
<span class="w">                </span><span class="nt">&lt;/relocation&gt;</span>
<span class="w">                </span><span class="nt">&lt;relocation&gt;</span>
<span class="w">                    </span><span class="nt">&lt;pattern&gt;</span>com.fasterxml.jackson<span class="nt">&lt;/pattern&gt;</span>
<span class="w">                    </span><span class="nt">&lt;shadedPattern&gt;</span>org.elasticsearch.common.jackson<span class="nt">&lt;/shadedPattern&gt;</span>
<span class="w">                </span><span class="nt">&lt;/relocation&gt;</span>
<span class="w">                </span><span class="nt">&lt;relocation&gt;</span>
<span class="w">                    </span><span class="nt">&lt;pattern&gt;</span>org.joda<span class="nt">&lt;/pattern&gt;</span>
<span class="w">                    </span><span class="nt">&lt;shadedPattern&gt;</span>org.elasticsearch.common.joda<span class="nt">&lt;/shadedPattern&gt;</span>
<span class="w">                </span><span class="nt">&lt;/relocation&gt;</span>
<span class="w">                </span><span class="nt">&lt;relocation&gt;</span>
<span class="w">                    </span><span class="nt">&lt;pattern&gt;</span>org.jboss.netty<span class="nt">&lt;/pattern&gt;</span>
<span class="w">                    </span><span class="nt">&lt;shadedPattern&gt;</span>org.elasticsearch.common.netty<span class="nt">&lt;/shadedPattern&gt;</span>
<span class="w">                </span><span class="nt">&lt;/relocation&gt;</span>
<span class="w">                </span><span class="nt">&lt;relocation&gt;</span>
<span class="w">                    </span><span class="nt">&lt;pattern&gt;</span>com.ning.compress<span class="nt">&lt;/pattern&gt;</span>
<span class="w">                    </span><span class="nt">&lt;shadedPattern&gt;</span>org.elasticsearch.common.compress<span class="nt">&lt;/shadedPattern&gt;</span>
<span class="w">                </span><span class="nt">&lt;/relocation&gt;</span>
<span class="w">            </span><span class="nt">&lt;/relocations&gt;</span>
<span class="w">            </span><span class="nt">&lt;filters&gt;</span>
<span class="w">                </span><span class="nt">&lt;filter&gt;</span>
<span class="w">                    </span><span class="nt">&lt;artifact&gt;</span>*:*<span class="nt">&lt;/artifact&gt;</span>
<span class="w">                    </span><span class="nt">&lt;excludes&gt;</span>
<span class="w">                        </span><span class="nt">&lt;exclude&gt;</span>META-INF/license/**<span class="nt">&lt;/exclude&gt;</span>
<span class="w">                        </span><span class="nt">&lt;exclude&gt;</span>META-INF/*<span class="nt">&lt;/exclude&gt;</span>
<span class="w">                        </span><span class="nt">&lt;exclude&gt;</span>META-INF/maven/**<span class="nt">&lt;/exclude&gt;</span>
<span class="w">                        </span><span class="nt">&lt;exclude&gt;</span>LICENSE<span class="nt">&lt;/exclude&gt;</span>
<span class="w">                        </span><span class="nt">&lt;exclude&gt;</span>NOTICE<span class="nt">&lt;/exclude&gt;</span>
<span class="w">                        </span><span class="nt">&lt;exclude&gt;</span>/*.txt<span class="nt">&lt;/exclude&gt;</span>
<span class="w">                        </span><span class="nt">&lt;exclude&gt;</span>build.properties<span class="nt">&lt;/exclude&gt;</span>
<span class="w">                    </span><span class="nt">&lt;/excludes&gt;</span>
<span class="w">                </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">            </span><span class="nt">&lt;/filters&gt;</span>
<span class="w">        </span><span class="nt">&lt;/configuration&gt;</span>
<span class="w">    </span><span class="nt">&lt;/plugin&gt;</span>
<span class="nt">&lt;/plugins&gt;</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/set-nocount-on-usage/" class="u-url">SET NOCOUNT ON usage</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/set-nocount-on-usage/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T04:44:26+08:00" itemprop="datePublished" title="2023-03-05 04:44">2023-03-05 04:44</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Inspired by this question where there are differing views on SET NOCOUNT...</p>
<blockquote>
<p>Should we use SET NOCOUNT ON for SQL Server? If not, why not?</p>
</blockquote>
<p><strong>What it does</strong> Edit 6, on 22 Jul 2011</p>
<p>It suppresses the "xx rows affected" message after any DML. This is a
resultset and when sent, the client must process it. It's tiny, but measurable
(see answers below)</p>
<p>For triggers etc, the client will receive multiple "xx rows affected" and this
causes all manner of errors for some ORMs, MS Access, JPA etc (see edits
below)</p>
<p><strong>Background:</strong></p>
<p>General accepted best practice (I thought until this question) is to use <code>SET
NOCOUNT ON</code> in triggers and stored procedures in SQL Server. We use it
everywhere and a quick google shows plenty of SQL Server MVPs agreeing too.</p>
<p>MSDN says this can break a .net SQLDataAdapter.</p>
<p>Now, this means to me that the SQLDataAdapter is limited to utterly simply
CRUD processing because it expects the "n rows affected" message to match. So,
I can't use:</p>
<ul>
<li>IF EXISTS to avoid duplicates (no rows affected message) <em>Note: use with caution</em>
</li>
<li>WHERE NOT EXISTS (less rows then expected</li>
<li>Filter out trivial updates (eg no data actually changes)</li>
<li>Do any table access before (such as logging)</li>
<li>Hide complexity or denormlisation</li>
<li>etc</li>
</ul>
<p>In the question marc_s (who knows his SQL stuff) says do not use it. This
differs to what I think (and I regard myself as somewhat competent at SQL
too).</p>
<p>It's possible I'm missing something (feel free to point out the obvious), but
what do you folks out there think?</p>
<p>Note: it's been years since I saw this error because I don't use
SQLDataAdapter nowadays.</p>
<p><strong>Edits after comments and questions:</strong></p>
<p>Edit: More thoughts...</p>
<p>We have multiple clients: one may use a C# SQLDataAdaptor, another may use
nHibernate from Java. These can be affected in different ways with <code>SET
NOCOUNT ON</code>.</p>
<p>If you regard stored procs as methods, then it's bad form (anti-pattern) to
assume some internal processing works a certain way for your own purposes.</p>
<p>Edit 2: a trigger breaking nHibernate question, where <code>SET NOCOUNT ON</code> can not
be set</p>
<p>(and no, it's not a duplicate of this)</p>
<p>Edit 3: Yet more info, thanks to my MVP colleague</p>
<ul>
<li>KB 240882, issue causing disconnects on SQL 2000 and earlier</li>
<li>Demo of performance gain </li>
</ul>
<p>Edit 4: 13 May 2011</p>
<p>Breaks Linq 2 SQL too when not specified?</p>
<p>Edit 5: 14 Jun 2011</p>
<p>Breaks JPA, stored proc with table variables: Does JPA 2.0 support SQL Server
table variables?</p>
<p>Edit 6: 15 Aug 2011</p>
<p>The SSMS "Edit rows" data grid requires SET NOCOUNT ON: Update trigger with
GROUP BY</p>
<p>Edit 7: 07 Mar 2013</p>
<p>More in depth details from @RemusRusanu:<br>
Does SET NOCOUNT ON really make that much of a performance difference</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Ok now I've done my research, here is the deal:</p>
<p>In TDS protocol, <code>SET NOCOUNT ON</code> only saves 9-bytes per query while the text
"SET NOCOUNT ON" itself is a whopping 14 bytes. I used to think that <code>123
row(s) affected</code> was returned from server in plain text in a separate network
packet but that's not the case. It's in fact a small structure called
<code>DONE_IN_PROC</code> embedded in the response. It's not a separate network packet so
no roundtrips are wasted.</p>
<p>I think you can stick to default counting behavior almost always without
worrying about the performance. There are some cases though, where calculating
the number of rows beforehand would impact the performance, such as a forward-
only cursor. In that case NOCOUNT might be a necessity. Other than that, there
is absolutely no need to follow "use NOCOUNT wherever possible" motto.</p>
<p>Here is a very detailed analysis about insignificance of <code>SET NOCOUNT</code>
setting: http://daleburnett.com/2014/01/everything-ever-wanted-know-set-
nocount/</p>
<p><br></p>
<h3>Suggest</h3>
<p>It took me a lot of digging to find real benchmark figures around NOCOUNT, so
I figured I'd share a quick summary.</p>
<ul>
<li>If your stored procedure uses a cursor to perform a lot of very quick operations with no returned results, having NOCOUNT OFF can take roughly 10 times as long as having it ON. 1 This is the worst-case scenario.</li>
<li>If your stored procedure only performs a single quick operation with no returned results, setting NOCOUNT ON <em>might</em> yield around a 3% performance boost. 2 This would be consistent with a typical insert or update procedure. (See the comments on this answer for some discussion about why this may not always be faster.)</li>
<li>If your stored procedure returns results (i.e. you SELECT something), the performance difference will diminish proportionately with the size of the result set.</li>
</ul>
</div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2612.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2610.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
