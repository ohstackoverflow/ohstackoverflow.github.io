<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1055) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1055.html">
<link rel="prev" href="index-1056.html" type="text/html">
<link rel="next" href="index-1054.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ru-he-shi-yong-pil-diao-zheng-tu-xiang-da-xiao-bing-bao-chi-qi-zong-heng-bi/" class="u-url">如何使用 PIL 调整图像大小并保持其纵横比？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ru-he-shi-yong-pil-diao-zheng-tu-xiang-da-xiao-bing-bao-chi-qi-zong-heng-bi/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T00:14:16+08:00" itemprop="datePublished" title="2023-02-18 00:14">2023-02-18 00:14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>有没有明显的方法可以做到这一点，我错过了？我只是想制作缩略图。</p>
<p><br><br></p>
<h2>解答</h2>
<p>定义最大尺寸。然后，通过取 计算调整大小比率<code>min(maxwidth/width, maxheight/height)</code>。</p>
<p>合适的尺寸是<code>oldsize*ratio</code>.</p>
<p>当然还有一个库方法可以做到这一点：方法<code>Image.thumbnail</code>. 下面是PIL 文档<br>
中的一个（编辑过的）示例。</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">Image</span>

<span class="n">size</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span>

<span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">infile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">".thumbnail"</span>
    <span class="k">if</span> <span class="n">infile</span> <span class="o">!=</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
            <span class="n">im</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span>
            <span class="n">im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">"JPEG"</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">"cannot create thumbnail for '</span><span class="si">%s</span><span class="s2">'"</span> <span class="o">%</span> <span class="n">infile</span>
</pre></div>

<p><br></p>
<h3>更多建议</h3>
<p>此脚本将使用 PIL（Python 图像库）将图像 (somepic.jpg) 调整为 300 像素的宽度和与新宽度成比例的高度。它通过确定 300
像素占原始宽度 (img.size[0]) 的百分比然后将原始高度 (img.size[1])
乘以该百分比来实现此目的。将“basewidth”更改为任何其他数字以更改图像的默认宽度。</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">basewidth</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'somepic.jpg'</span><span class="p">)</span>
<span class="n">wpercent</span> <span class="o">=</span> <span class="p">(</span><span class="n">basewidth</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">hsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">wpercent</span><span class="p">)))</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">basewidth</span><span class="p">,</span><span class="n">hsize</span><span class="p">),</span> <span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">)</span>
<span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'somepic.jpg'</span><span class="p">)</span>
</pre></div>

<p><br><br><a href="posts/how-do-i-resize-an-image-using-pil-and-maintain-its-aspect-ratio/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ru-he-zai-jquery-zhong-fa-song-put-delete-qing-qiu/" class="u-url">如何在 jQuery 中发送 PUT/DELETE 请求？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ru-he-zai-jquery-zhong-fa-song-put-delete-qing-qiu/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T00:13:46+08:00" itemprop="datePublished" title="2023-02-18 00:13">2023-02-18 00:13</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><code>GET</code>:<code>$.get(..)</code></p>
<p><code>POST</code>:<code>$.post()..</code></p>
<p>怎么样<code>PUT/DELETE</code>？</p>
<p><br><br></p>
<h2>解答</h2>
<p>您可以使用ajax方法：</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="p">.</span><span class="nc">ajax</span><span class="o">(</span><span class="p">{</span>
<span class="w">    </span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="s1">'/script.cgi'</span><span class="p">,</span>
<span class="w">    </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'DELETE'</span><span class="p">,</span>
<span class="w">    </span><span class="n">success</span><span class="o">:</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">result</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">}</span><span class="o">);</span>
</pre></div>

<p><br></p>
<h3>更多建议</h3>
<p><code>$.ajax</code>将工作。</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="p">.</span><span class="nc">ajax</span><span class="o">(</span><span class="p">{</span>
<span class="w">   </span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="s1">'script.php'</span><span class="p">,</span>
<span class="w">   </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'PUT'</span><span class="p">,</span>
<span class="w">   </span><span class="n">success</span><span class="o">:</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">     </span><span class="o">//...</span>
<span class="w">   </span><span class="p">}</span>
<span class="err">}</span><span class="o">);</span>
</pre></div>

<p><br><br><a href="posts/how-to-send-a-put-delete-request-in-jquery/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ru-he-zai-androidzhong-sheng-ming-quan-ju-bian-liang/" class="u-url">如何在Android中声明全局变量？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ru-he-zai-androidzhong-sheng-ming-quan-ju-bian-liang/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T00:13:15+08:00" itemprop="datePublished" title="2023-02-18 00:13">2023-02-18 00:13</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我正在创建一个需要登录的应用程序。我创建了主要活动和登录活动。</p>
<p>在主要活动<code>onCreate</code>方法中，我添加了以下条件：</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">super</span><span class="o">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">    </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">main</span><span class="p">);</span>

<span class="w">    </span><span class="o">...</span>

<span class="w">    </span><span class="n">loadSettings</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">strSessionString</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">login</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="o">...</span>
<span class="p">}</span>
</pre></div>

<p>登录表单终止时执行的方法<code>onActivityResult</code>如下所示：</p>
<div class="code"><pre class="code literal-block"><span class="nv">@Override</span>
<span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onActivityResult</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">requestCode</span><span class="p">,</span>
<span class="w">                             </span><span class="nc">int</span><span class="w"> </span><span class="n">resultCode</span><span class="p">,</span>
<span class="w">                             </span><span class="n">Intent</span><span class="w"> </span><span class="k">data</span><span class="p">)</span>
<span class="err">{</span>
<span class="w">    </span><span class="n">super</span><span class="p">.</span><span class="n">onActivityResult</span><span class="p">(</span><span class="n">requestCode</span><span class="p">,</span><span class="w"> </span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">);</span>
<span class="w">    </span><span class="n">switch</span><span class="p">(</span><span class="n">requestCode</span><span class="p">)</span>
<span class="w">    </span><span class="err">{</span>
<span class="w">        </span><span class="k">case</span><span class="p">(</span><span class="n">SHOW_SUBACTICITY_LOGIN</span><span class="p">)</span><span class="err">:</span>
<span class="w">        </span><span class="err">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">resultCode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Activity</span><span class="p">.</span><span class="n">RESULT_OK</span><span class="p">)</span>
<span class="w">            </span><span class="err">{</span>

<span class="w">                </span><span class="n">strSessionString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">data</span><span class="p">.</span><span class="n">getStringExtra</span><span class="p">(</span><span class="n">Login</span><span class="p">.</span><span class="n">SESSIONSTRING</span><span class="p">);</span>
<span class="w">                </span><span class="n">connectionAvailable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">                </span><span class="n">strUsername</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">data</span><span class="p">.</span><span class="n">getStringExtra</span><span class="p">(</span><span class="n">Login</span><span class="p">.</span><span class="n">USERNAME</span><span class="p">);</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
</pre></div>

<p>问题是登录表单有时会出现两次（该<code>login()</code>方法被调用两次），并且当手机键盘滑动时登录表单再次出现，我猜问题出在变量上<code>strSessionString</code>。</p>
<p>有谁知道如何设置全局变量以避免在用户已经成功通过身份验证后出现登录表单？</p>
<p><br><br></p>
<h2>解答</h2>
<p>我在 09 年写下这个答案，当时 Android 还相对较新，Android
开发中有许多尚未完善的领域。我在这篇文章的底部添加了一个很长的附录，解决了一些批评，并详细说明了我对使用单例而不是子类化应用程序的哲学分歧。阅读它需要您自担风险。</p>
<p><strong>原始答案：</strong></p>
<p>您遇到的更普遍的问题是如何跨多个活动和应用程序的所有部分保存状态。静态变量（例如，单例）是实现此目的的常见 Java 方法。然而，我发现，Android
中更优雅的方法是将您的状态与应用程序上下文相关联。</p>
<p>大家知道，每一个Activity也是一个Context，广义上就是它的执行环境的信息。您的应用程序也有一个上下文，Android
保证它将作为单个实例存在于您的应用程序中。</p>
<p>这样做的方法是创建您自己的android.app.Application的子类，然后在清单的应用程序标签中指定该类。现在 Android
将自动创建该类的一个实例并使其可用于您的整个应用程序。<code>context</code>您可以使用该方法从任何地方访问它<code>Context.getApplicationContext()</code>（还提供了具有完全相同效果的<code>Activity</code>方法）。<code>getApplication()</code>以下是一个极其简化的示例，需要注意以下事项：</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">MyApp</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Application</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="n">private</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">myState</span><span class="p">;</span>

<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">getState</span><span class="p">(){</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">myState</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">setState</span><span class="p">(</span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">s</span><span class="p">){</span>
<span class="w">    </span><span class="n">myState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="n">Blah</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="err">@</span><span class="n">Override</span>
<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">b</span><span class="p">){</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="n">MyApp</span><span class="w"> </span><span class="n">appState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">MyApp</span><span class="p">)</span><span class="n">getApplicationContext</span><span class="p">());</span>
<span class="w">    </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appState</span><span class="o">.</span><span class="n">getState</span><span class="p">();</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>这与使用静态变量或单例具有基本相同的效果，但可以很好地集成到现有的 Android
框架中。请注意，这不会跨进程工作（如果您的应用程序是少数具有多个进程的应用程序之一）。</p>
<p>上例中需要注意的事项；假设我们做了类似的事情：</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">MyApp</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Application</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="n">private</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">myState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">/*</span><span class="w"> </span><span class="n">complicated</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">slow</span><span class="w"> </span><span class="n">initialization</span><span class="w"> </span><span class="o">*/</span><span class="p">;</span>

<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">getState</span><span class="p">(){</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">myState</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>现在每次实例化应用程序时都会执行这种缓慢的初始化（例如访问磁盘、访问网络、任何阻塞等）！你可能会想，好吧，这个过程只有一次，无论如何我都必须支付费用，对吧？例如，正如
Dianne Hackborn 在下面提到的那样，您的流程完全有可能被实例化 - 只是 -
来处理后台广播事件。如果您的广播处理不需要这种状态，您可能只是白白做了一系列复杂而缓慢的操作。惰性实例化是这里的游戏名称。以下是使用 Application
的一种稍微复杂的方法，除了最简单的用途之外，它对任何事情都更有意义：</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">MyApp</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Application</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="n">private</span><span class="w"> </span><span class="n">MyStateManager</span><span class="w"> </span><span class="n">myStateManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MyStateManager</span><span class="p">();</span>

<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="n">MyStateManager</span><span class="w"> </span><span class="n">getStateManager</span><span class="p">(){</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">myStateManager</span><span class="w"> </span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="n">MyStateManager</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="n">MyStateManager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">/*</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">fast</span><span class="w"> </span><span class="o">*/</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">getState</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">/*</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">necessary</span><span class="p">,</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">blocking</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="o">*/</span>
<span class="w">    </span><span class="o">/*</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">deal</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">multithreading</span><span class="o">/</span><span class="n">synchronicity</span><span class="w"> </span><span class="n">issues</span><span class="w"> </span><span class="o">*/</span>

<span class="w">    </span><span class="o">...</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">state</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="n">Blah</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="err">@</span><span class="n">Override</span>
<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">b</span><span class="p">){</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">    </span><span class="n">MyStateManager</span><span class="w"> </span><span class="n">stateManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">MyApp</span><span class="p">)</span><span class="n">getApplicationContext</span><span class="p">())</span><span class="o">.</span><span class="n">getStateManager</span><span class="p">();</span>
<span class="w">    </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stateManager</span><span class="o">.</span><span class="n">getState</span><span class="p">();</span>
<span class="w">    </span><span class="o">...</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>虽然在这里我更喜欢 Application 子类化而不是使用单例作为更优雅的解决方案，但我宁愿开发人员在确实有必要时使用单例，而不是完全不考虑将状态与
Application 子类相关联的性能和多线程影响。</p>
<p><strong>注 1：</strong> 正如 anticafe 评论的那样，为了正确地将您的应用程序覆盖与您的应用程序联系起来，清单文件中需要一个标签。同样，请参阅
Android 文档以获取更多信息。一个例子：</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;application</span>
<span class="w">     </span><span class="na">android:name=</span><span class="s">"my.application.MyApp"</span><span class="w"> </span>
<span class="w">     </span><span class="na">android:icon=</span><span class="s">"..."</span>
<span class="w">     </span><span class="na">android:label=</span><span class="s">"..."</span><span class="nt">&gt;</span>
<span class="nt">&lt;/application&gt;</span>
</pre></div>

<p><strong>注 2：</strong> user608578 在下面询问这如何与管理本机对象生命周期一起工作。我丝毫没有跟上在 Android
上使用本机代码的速度，而且我没有资格回答这将如何与我的解决方案交互。如果有人对此有答案，我愿意相信他们并将信息放在这篇文章中以获得最大的可见度。</p>
<p><strong>附录：</strong></p>
<p>正如一些人所指出的，这不是 <strong>持久</strong> <strong>状态</strong>
的解决方案，我或许应该在原始答案中更加强调这一点。也就是说，这并不是一种用于保存用户或其他旨在跨应用程序生命周期保留的信息的解决方案。因此，我认为下面大多数与应用程序随时被终止等相关的批评都是没有实际意义的，因为任何需要持久保存到磁盘的东西都不应该通过应用程序子类存储。它旨在成为一种存储临时的、易于重新创建的应用程序状态（例如用户是否登录）和本质上是单实例（例如应用程序网络管理器）（不是单例！）的组件的解决方案
<strong>。</strong></p>
<p>Dayerman 非常友善地指出了与 Reto Meier 和 Dianne Hackborn 的一次有趣对话，在对话中不鼓励使用 Application
子类以支持 Singleton 模式。Somatik 早些时候也指出了这种性质的东西，尽管我当时没有看到。由于 Reto 和 Dianne 在维护
Android 平台方面的作用，我不能真诚地建议忽略他们的建议。他们说什么，行什么。我确实不同意关于更喜欢 Singleton 而不是
Application 子类的观点。在我不同意的情况下，我将使用StackExchange 对 Singleton
设计模式的解释中最好解释的概念，这样我就不必在此答案中定义术语。我强烈建议在继续之前浏览一下链接。逐点：</p>
<p>Dianne 指出，“没有理由从 Application 继承。这与创建单例没有什么不同……”第一个声明是不正确的。这有两个主要原因。1)
Application类为应用程序开发者提供了更好的生命周期保证；它保证具有应用程序的生命周期。单例并没有明确地绑定到应用程序的生命周期（尽管它是有效的）。对于普通的应用程序开发人员来说，这可能不是问题，但我认为这正是
Android API 应该提供的合同类型，它还通过最小化相关联的生命周期为 Android 系统提供了更多的灵活性数据。2) Application
类为应用程序开发人员提供了状态的单一实例持有者，这与状态的单例持有者非常不同。有关差异的列表，请参阅上面的 Singleton 解释链接。</p>
<p>Dianne 继续说道，“...当您发现您的 Application 对象变成了本应是独立应用程序逻辑的大混乱时，您将来可能会后悔。”
这当然没有错，但这不是选择 Singleton 而不是 Application 子类的理由。Diane 的论据都没有提供使用 Singleton 比
Application 子类更好的理由，她试图证明的是使用 Singleton 并不比 Application 子类差，我认为这是错误的。</p>
<p>她继续说道，“这更自然地导致您应该如何管理这些东西——按需初始化它们。” 这忽略了一个事实，即您没有理由不能使用 Application
子类按需初始化。同样没有区别。</p>
<p>Dianne ends with "The framework itself has tons and tons of singletons for all
the little shared data it maintains for the app, such as caches of loaded
resources, pools of objects, etc. It works great." I am not arguing that using
Singletons cannot work fine or are not a legitimate alternative. I am arguing
that Singletons do not provide as strong a contract with the Android system as
using an Application subclass, and further that using Singletons generally
points to inflexible design, which is not easily modified, and leads to many
problems down the road. IMHO, the strong contract the Android API offers to
developer applications is one of the most appealing and pleasing aspects of
programming with Android, and helped lead to early developer adoption which
drove the Android platform to the success it has today. Suggesting using
Singletons is implicitly moving away from a strong API contract, and in my
opinion, weakens the Android framework.</p>
<p>Dianne has commented below as well, mentioning an additional downside to using
Application subclasses, they may encourage or make it easier to write less
performance code. This is very true, and I have edited this answer to
emphasize the importance of considering perf here, and taking the correct
approach if you're using Application subclassing. As Dianne states, it is
important to remember that your Application class will be instantiated every
time your process is loaded (could be multiple times at once if your
application runs in multiple processes!) even if the process is only being
loaded for a background broadcast event. It is therefore important to use the
Application class more as a repository for pointers to shared components of
your application rather than as a place to do any processing!</p>
<p>I leave you with the following list of downsides to Singletons, as stolen from
the earlier StackExchange link:</p>
<ul>
<li>Inability to use abstract or interface classes;</li>
<li>Inability to subclass;</li>
<li>High coupling across the application (difficult to modify);</li>
<li>Difficult to test (can't fake/mock in unit tests);</li>
<li>Difficult to parallelize in the case of mutable state (requires extensive locking);</li>
</ul>
<p>and add my own:</p>
<ul>
<li>Unclear and unmanageable lifetime contract unsuited for Android (or most other) development;</li>
</ul>
<p><br></p>
<h3>更多建议</h3>
<p>创建这个子类</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">MyApp</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Application</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">foo</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>在 AndroidManifest.xml 添加 android:name</p>
<p><strong>例子</strong></p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">application</span><span class="w"> </span><span class="nl">android</span><span class="p">:</span><span class="n">name</span><span class="o">=</span><span class="ss">".MyApp"</span><span class="w"> </span>
<span class="w">       </span><span class="nl">android</span><span class="p">:</span><span class="n">icon</span><span class="o">=</span><span class="ss">"@drawable/icon"</span><span class="w"> </span>
<span class="w">       </span><span class="nl">android</span><span class="p">:</span><span class="n">label</span><span class="o">=</span><span class="ss">"@string/app_name"</span><span class="o">&gt;</span>
</pre></div>

<p><br><br><a href="posts/how-to-declare-global-variables-in-android/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1056.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1054.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
