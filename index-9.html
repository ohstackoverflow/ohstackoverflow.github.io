<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 9) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-9.html">
<link rel="prev" href="index-10.html" type="text/html">
<link rel="next" href="index-8.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/var-functionname-function-vs-function-functionname/" class="u-url">var functionName = function() {} vs function functionName() {}</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/var-functionname-function-vs-function-functionname/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T18:25:01+08:00" itemprop="datePublished" title="2023-02-16 18:25">2023-02-16 18:25</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've recently started maintaining someone else's JavaScript code. I'm fixing
bugs, adding features and also trying to tidy up the code and make it more
consistent.</p>
<p>The previous developer used two ways of declaring functions and I can't work
out if there is a reason behind it or not.</p>
<p>The two ways are:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">functionOne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="n">code</span>
<span class="p">};</span>
</pre></div>

<p>And,</p>
<div class="code"><pre class="code literal-block">function functionTwo() {
    // Some code
}
</pre></div>

<p>What are the reasons for using these two different methods and what are the
pros and cons of each? Is there anything that can be done with one method that
can't be done with the other?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The difference is that <code>functionOne</code> is a function expression and so only
defined when that line is reached, whereas <code>functionTwo</code> is a function
declaration and is defined as soon as its surrounding function or script is
executed (due to hoisting).</p>
<p>For example, a function expression:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">TypeError</span><span class="p">:</span><span class="w"> </span><span class="n">functionOne</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span>
<span class="n">functionOne</span><span class="p">();</span>

<span class="k">var</span><span class="w"> </span><span class="n">functionOne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"Hello!"</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>

<p>And, a function declaration:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// Outputs: "Hello!"</span>
<span class="n">functionTwo</span><span class="p">();</span>

<span class="k">function</span><span class="w"> </span><span class="nf">functionTwo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">console</span><span class="p">.</span><span class="nb">log</span><span class="p">(</span><span class="s">"Hello!"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Historically, function declarations defined within blocks were handled
inconsistently between browsers. Strict mode (introduced in ES5) resolved this
by scoping function declarations to their enclosing block.</p>
<div class="code"><pre class="code literal-block">'use strict';    
{ // note this block!
  function functionThree() {
    console.log("Hello!");
  }
}
functionThree(); // ReferenceError
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>First I want to correct Greg: <code>function abc(){}</code> is scoped too — the name
<code>abc</code> is defined in the scope where this definition is encountered. Example:</p>
<div class="code"><pre class="code literal-block">function xyz(){
  function abc(){};
  // abc is defined here...
}
// ...but not here
</pre></div>

<p>Secondly, it is possible to combine both styles:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">xyz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">abc</span><span class="p">(){};</span>
</pre></div>

<p><code>xyz</code> is going to be defined as usual, <code>abc</code> is undefined in all browsers but
Internet Explorer — do not rely on it being defined. But it will be defined
inside its body:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">xyz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">abc</span><span class="p">(){</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">xyz</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">visible</span><span class="w"> </span><span class="n">here</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">abc</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">visible</span><span class="w"> </span><span class="n">here</span>
<span class="p">}</span>
<span class="o">//</span><span class="w"> </span><span class="n">xyz</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">visible</span><span class="w"> </span><span class="n">here</span>
<span class="o">//</span><span class="w"> </span><span class="n">abc</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">undefined</span><span class="w"> </span><span class="n">here</span>
</pre></div>

<p>If you want to alias functions on all browsers, use this kind of declaration:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">abc</span><span class="p">(){};</span>
<span class="k">var</span><span class="w"> </span><span class="n">xyz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abc</span><span class="p">;</span>
</pre></div>

<p>In this case, both <code>xyz</code> and <code>abc</code> are aliases of the same object:</p>
<div class="code"><pre class="code literal-block">console.log(xyz === abc); // prints "true"
</pre></div>

<p>One compelling reason to use the combined style is the "name" attribute of
function objects ( <strong>not supported by Internet Explorer</strong> ). Basically when
you define a function like</p>
<div class="code"><pre class="code literal-block">function abc(){};
console.log(abc.name); // prints "abc"
</pre></div>

<p>its name is automatically assigned. But when you define it like</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">abc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){};</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">name</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">prints</span><span class="w"> </span><span class="s2">""</span>
</pre></div>

<p>its name is empty — we created an anonymous function and assigned it to some
variable.</p>
<p>Another good reason to use the combined style is to use a short internal name
to refer to itself, while providing a long non-conflicting name for external
users:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// Assume really.long.external.scoped is {}</span>
<span class="n">really</span><span class="p">.</span><span class="n">long</span><span class="p">.</span><span class="n">external</span><span class="p">.</span><span class="n">scoped</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">shortcut</span><span class="p">(</span><span class="n">n</span><span class="p">){</span>
<span class="w">  </span><span class="c1">// Let it call itself recursively:</span>
<span class="w">  </span><span class="n">shortcut</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="w">  </span><span class="c1">// Let it pass itself as a callback:</span>
<span class="w">  </span><span class="n">someFunction</span><span class="p">(</span><span class="n">shortcut</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p>In the example above we can do the same with an external name, but it'll be
too unwieldy (and slower).</p>
<p><em>(Another way to refer to itself is to use<code>arguments.callee</code>, which is still
relatively long, and not supported in the strict mode.)</em></p>
<p>Deep down, JavaScript treats both statements differently. This is a function
declaration:</p>
<div class="code"><pre class="code literal-block">function abc(){}
</pre></div>

<p><code>abc</code> here is defined everywhere in the current scope:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// We can call it here</span>
<span class="n">abc</span><span class="p">();</span><span class="w"> </span><span class="c1">// Works</span>

<span class="c1">// Yet, it is defined down there.</span>
<span class="k">function</span><span class="w"> </span><span class="nf">abc</span><span class="p">(){}</span>

<span class="c1">// We can call it again</span>
<span class="n">abc</span><span class="p">();</span><span class="w"> </span><span class="c1">// Works</span>
</pre></div>

<p>Also, it hoisted through a <code>return</code> statement:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// We can call it here</span>
<span class="n">abc</span><span class="p">();</span><span class="w"> </span><span class="c1">// Works</span>
<span class="k">return</span><span class="p">;</span>
<span class="k">function</span><span class="w"> </span><span class="nf">abc</span><span class="p">(){}</span>
</pre></div>

<p>This is a function expression:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">xyz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){};</span>
</pre></div>

<p><code>xyz</code> here is defined from the point of assignment:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// We can't call it here</span>
<span class="n">xyz</span><span class="p">();</span><span class="w"> </span><span class="c1">// UNDEFINED!!!</span>

<span class="c1">// Now it is defined</span>
<span class="n">xyz</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">function</span><span class="p">(){}</span>

<span class="c1">// We can call it here</span>
<span class="n">xyz</span><span class="p">();</span><span class="w"> </span><span class="c1">// works</span>
</pre></div>

<p>Function declaration vs. function expression is the real reason why there is a
difference demonstrated by Greg.</p>
<p>Fun fact:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">xyz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">abc</span><span class="p">(){};</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">name</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Prints</span><span class="w"> </span><span class="s2">"abc"</span>
</pre></div>

<p>Personally, I prefer the "function expression" declaration because this way I
can control the visibility. When I define the function like</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">abc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){};</span>
</pre></div>

<p>I know that I defined the function locally. When I define the function like</p>
<div class="code"><pre class="code literal-block">abc = function(){};
</pre></div>

<p>I know that I defined it globally providing that I didn't define <code>abc</code>
anywhere in the chain of scopes. This style of definition is resilient even
when used inside <code>eval()</code>. While the definition</p>
<div class="code"><pre class="code literal-block">function abc(){};
</pre></div>

<p>depends on the context and may leave you guessing where it is actually
defined, especially in the case of <code>eval()</code> — the answer is: It depends on the
browser.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-revert-a-git-repository-to-a-previous-commit/" class="u-url">How do I revert a Git repository to a previous commit?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-revert-a-git-repository-to-a-previous-commit/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T18:24:27+08:00" itemprop="datePublished" title="2023-02-16 18:24">2023-02-16 18:24</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><strong>This question's answers are a community effort</strong>. Edit existing answers to
improve this post. It is not currently accepting new answers or interactions.</p>
<p>How do I revert from my current state to a snapshot made on a certain commit?</p>
<p>If I do <code>git log</code>, then I get the following output:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>git<span class="w"> </span>log
commit<span class="w"> </span>a867b4af366350be2e7c21b8de9cc6504678a61b<span class="sb">`</span>
Author:<span class="w"> </span>Me<span class="w"> </span>&lt;me@me.com&gt;
Date:<span class="w">   </span>Thu<span class="w"> </span>Nov<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">18</span>:59:41<span class="w"> </span><span class="m">2010</span><span class="w"> </span>-0400

blah<span class="w"> </span>blah<span class="w"> </span>blah...

commit<span class="w"> </span>25eee4caef46ae64aa08e8ab3f988bc917ee1ce4
Author:<span class="w"> </span>Me<span class="w"> </span>&lt;me@me.com&gt;
Date:<span class="w">   </span>Thu<span class="w"> </span>Nov<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">05</span>:13:39<span class="w"> </span><span class="m">2010</span><span class="w"> </span>-0400

more<span class="w"> </span>blah<span class="w"> </span>blah<span class="w"> </span>blah...

commit<span class="w"> </span>0766c053c0ea2035e90f504928f8df3c9363b8bd
Author:<span class="w"> </span>Me<span class="w"> </span>&lt;me@me.com&gt;
Date:<span class="w">   </span>Thu<span class="w"> </span>Nov<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">00</span>:55:06<span class="w"> </span><span class="m">2010</span><span class="w"> </span>-0400

And<span class="w"> </span>yet<span class="w"> </span>more<span class="w"> </span>blah<span class="w"> </span>blah...

commit<span class="w"> </span>0d1d7fc32e5a947fbd92ee598033d85bfc445a50
Author:<span class="w"> </span>Me<span class="w"> </span>&lt;me@me.com&gt;
Date:<span class="w">   </span>Wed<span class="w"> </span>Nov<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">23</span>:56:08<span class="w"> </span><span class="m">2010</span><span class="w"> </span>-0400

Yep,<span class="w"> </span>more<span class="w"> </span>blah<span class="w"> </span>blah.
</pre></div>

<p>How do I revert to the commit from November 3, i.e. commit <code>0d1d7fc</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This depends a lot on what you mean by "revert".</p>
<h3>Temporarily switch to a different commit</h3>
<p>If you want to temporarily go back to it, fool around, then come back to where
you are, all you have to do is check out the desired commit:</p>
<div class="code"><pre class="code literal-block"># This will detach your HEAD, that is, leave you with no branch checked out:
git checkout 0d1d7fc32
</pre></div>

<p>Or if you want to make commits while you're there, go ahead and make a new
branch while you're at it:</p>
<div class="code"><pre class="code literal-block">git checkout -b old-state 0d1d7fc32
</pre></div>

<p>To go back to where you were, just check out the branch you were on again. (If
you've made changes, as always when switching branches, you'll have to deal
with them as appropriate. You could reset to throw them away; you could stash,
checkout, stash pop to take them with you; you could commit them to a branch
there if you want a branch there.)</p>
<h3>Hard delete unpublished commits</h3>
<p>If, on the other hand, you want to really get rid of everything you've done
since then, there are two possibilities. One, if you haven't published any of
these commits, simply reset:</p>
<div class="code"><pre class="code literal-block">#<span class="w"> </span><span class="nv">This</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">destroy</span><span class="w"> </span><span class="nv">any</span><span class="w"> </span><span class="nv">local</span><span class="w"> </span><span class="nv">modifications</span>.
#<span class="w"> </span><span class="nv">Don</span><span class="err">'t do it if you have uncommitted work you want to keep.</span>
<span class="err">git reset --hard 0d1d7fc32</span>

#<span class="w"> </span><span class="nv">Alternatively</span>,<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">there</span><span class="err">'s work to keep:</span>
<span class="err">git stash</span>
<span class="err">git reset --hard 0d1d7fc32</span>
<span class="err">git stash pop</span>
<span class="err"># This saves the modifications, then reapplies that patch after resetting.</span>
#<span class="w"> </span><span class="nv">You</span><span class="w"> </span><span class="nv">could</span><span class="w"> </span><span class="nv">get</span><span class="w"> </span><span class="nv">merge</span><span class="w"> </span><span class="nv">conflicts</span>,<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">you</span><span class="err">'ve modified things which were</span>
<span class="err"># changed since the commit you reset to.</span>
</pre></div>

<p>If you mess up, you've already thrown away your local changes, but you can at
least get back to where you were before by resetting again.</p>
<h3>Undo published commits with new commits</h3>
<p>On the other hand, if you've published the work, you probably don't want to
reset the branch, since that's effectively rewriting history. In that case,
you could indeed revert the commits. With Git, revert has a very specific
meaning: create a commit with the reverse patch to cancel it out. This way you
don't rewrite any history.</p>
<div class="code"><pre class="code literal-block">#<span class="w"> </span><span class="nv">This</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">create</span><span class="w"> </span><span class="nv">three</span><span class="w"> </span><span class="nv">separate</span><span class="w"> </span><span class="nv">revert</span><span class="w"> </span><span class="nv">commits</span>:
<span class="nv">git</span><span class="w"> </span><span class="nv">revert</span><span class="w"> </span><span class="nv">a867b4af</span><span class="w"> </span><span class="mi">25</span><span class="nv">eee4ca</span><span class="w"> </span><span class="mi">0766</span><span class="nv">c053</span>

#<span class="w"> </span><span class="nv">It</span><span class="w"> </span><span class="nv">also</span><span class="w"> </span><span class="nv">takes</span><span class="w"> </span><span class="nv">ranges</span>.<span class="w"> </span><span class="nv">This</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">revert</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">last</span><span class="w"> </span><span class="nv">two</span><span class="w"> </span><span class="nv">commits</span>:
<span class="nv">git</span><span class="w"> </span><span class="nv">revert</span><span class="w"> </span><span class="nv">HEAD</span><span class="o">~</span><span class="mi">2</span>..<span class="nv">HEAD</span>

#<span class="nv">Similarly</span>,<span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">can</span><span class="w"> </span><span class="nv">revert</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">range</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">commits</span><span class="w"> </span><span class="nv">using</span><span class="w"> </span><span class="nv">commit</span><span class="w"> </span><span class="nv">hashes</span><span class="w"> </span><span class="ss">(</span><span class="nv">non</span><span class="w"> </span><span class="nv">inclusive</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">hash</span><span class="ss">)</span>:
<span class="nv">git</span><span class="w"> </span><span class="nv">revert</span><span class="w"> </span><span class="mi">0</span><span class="nv">d1d7fc</span>..<span class="nv">a867b4a</span>

#<span class="w"> </span><span class="nv">Reverting</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">merge</span><span class="w"> </span><span class="nv">commit</span>
<span class="nv">git</span><span class="w"> </span><span class="nv">revert</span><span class="w"> </span><span class="o">-</span><span class="nv">m</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">merge_commit_sha</span><span class="o">&gt;</span>

#<span class="w"> </span><span class="nv">To</span><span class="w"> </span><span class="nv">get</span><span class="w"> </span><span class="nv">just</span><span class="w"> </span><span class="nv">one</span>,<span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">could</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span>`<span class="nv">rebase</span><span class="w"> </span><span class="o">-</span><span class="nv">i</span>`<span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">squash</span><span class="w"> </span><span class="nv">them</span><span class="w"> </span><span class="nv">afterwards</span>
#<span class="w"> </span><span class="nv">Or</span>,<span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">could</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">manually</span><span class="w"> </span><span class="ss">(</span><span class="nv">be</span><span class="w"> </span><span class="nv">sure</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">top</span><span class="w"> </span><span class="nv">level</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">repo</span><span class="ss">)</span>
#<span class="w"> </span><span class="nv">get</span><span class="w"> </span><span class="nv">your</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">work</span><span class="w"> </span><span class="nv">tree</span><span class="w"> </span><span class="nv">into</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">desired</span><span class="w"> </span><span class="nv">state</span>,<span class="w"> </span><span class="nv">without</span><span class="w"> </span><span class="nv">changing</span><span class="w"> </span><span class="nv">HEAD</span>:
<span class="nv">git</span><span class="w"> </span><span class="nv">checkout</span><span class="w"> </span><span class="mi">0</span><span class="nv">d1d7fc32</span><span class="w"> </span>.

#<span class="w"> </span><span class="k">Then</span><span class="w"> </span><span class="nv">commit</span>.<span class="w"> </span><span class="nv">Be</span><span class="w"> </span><span class="nv">sure</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">write</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">good</span><span class="w"> </span><span class="nv">message</span><span class="w"> </span><span class="nv">describing</span><span class="w"> </span><span class="nv">what</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">just</span><span class="w"> </span><span class="nv">did</span>
<span class="nv">git</span><span class="w"> </span><span class="nv">commit</span>
</pre></div>

<p>The <code>git-revert</code> manpage actually covers a lot of this in its description.
Another useful link is this git-scm.com section discussing git-revert.</p>
<p>If you decide you didn't want to revert after all, you can revert the revert
(as described here) or reset back to before the revert (see the previous
section).</p>
<p>You may also find this answer helpful in this case:<br>
How can I move HEAD back to a previous location? (Detached head) &amp; Undo
commits</p>
<p><br></p>
<h3>Suggest</h3>
<p>Lots of complicated and dangerous answers here, but it's actually easy:</p>
<div class="code"><pre class="code literal-block">git revert --no-commit 0766c053..HEAD
git commit
</pre></div>

<p>This will revert everything from the HEAD back to the commit hash, meaning it
will recreate that commit state in the working tree <em>as if</em> every commit after
<code>0766c053</code> had been walked back. You can then commit the current tree, and it
will create a brand new commit essentially equivalent to the commit you
"reverted" to.</p>
<p>(The <code>--no-commit</code> flag lets git revert all the commits at once- otherwise
you'll be prompted for a message for each commit in the range, littering your
history with unnecessary new commits.)</p>
<p>This is a <strong>safe and easy way to rollback to a previous state</strong>. No history is
destroyed, so it can be used for commits that have already been made public.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-javascript-closures-work/" class="u-url">How do JavaScript closures work?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-javascript-closures-work/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T18:23:53+08:00" itemprop="datePublished" title="2023-02-16 18:23">2023-02-16 18:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><strong>This question's answers are a community effort</strong>. Edit existing answers to
improve this post. It is not currently accepting new answers or interactions.</p>
<p>How would you explain JavaScript closures to someone with a knowledge of the
concepts they consist of (for example functions, variables and the like), but
does not understand closures themselves?</p>
<p>I have seen the Scheme example given on Wikipedia, but unfortunately it did
not help.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>A closure is a pairing of:</p>
<ol>
<li>A function and</li>
<li>A reference to that function's outer scope (lexical environment)</li>
</ol>
<p>A lexical environment is part of every execution context (stack frame) and is
a map between identifiers (i.e. local variable names) and values.</p>
<p>Every function in JavaScript maintains a reference to its outer lexical
environment. This reference is used to configure the execution context created
when a function is invoked. This reference enables code inside the function to
"see" variables declared outside the function, regardless of when and where
the function is called.</p>
<p>If a function was called by a function, which in turn was called by another
function, then a chain of references to outer lexical environments is created.
This chain is called the scope chain.</p>
<p>In the following code, <code>inner</code> forms a closure with the lexical environment of
the execution context created when <code>foo</code> is invoked, <em>closing over</em> variable
<code>secret</code>:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="n">const</span><span class="w"> </span><span class="n">secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="k">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">inner</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n n-Quoted">`The secret number is ${secret}.`</span><span class="p">)</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span>
<span class="n">const</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`secret`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">directly</span><span class="w"> </span><span class="k">accessible</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">outside</span><span class="w"> </span><span class="n n-Quoted">`foo`</span>
<span class="n">f</span><span class="p">()</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">retrieve</span><span class="w"> </span><span class="n n-Quoted">`secret`</span><span class="p">,</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="n n-Quoted">`f`</span>
</pre></div>

<p>In other words: in JavaScript, functions carry a reference to a private "box
of state", to which only they (and any other functions declared within the
same lexical environment) have access. This box of the state is invisible to
the caller of the function, delivering an excellent mechanism for data-hiding
and encapsulation.</p>
<p>And remember: functions in JavaScript can be passed around like variables
(first-class functions), meaning these pairings of functionality and state can
be passed around your program: similar to how you might pass an instance of a
class around in C++.</p>
<p>If JavaScript did not have closures, then more states would have to be passed
between functions <em>explicitly</em> , making parameter lists longer and code
noisier.</p>
<p>So, if you want a function to always have access to a private piece of state,
you can use a closure.</p>
<p>...and frequently we <em>do</em> want to associate the state with a function. For
example, in Java or C++, when you add a private instance variable and a method
to a class, you are associating the state with functionality.</p>
<p>In C and most other common languages, after a function returns, all the local
variables are no longer accessible because the stack-frame is destroyed. In
JavaScript, if you declare a function within another function, then the local
variables of the outer function can remain accessible after returning from it.
In this way, in the code above, <code>secret</code> remains available to the function
object <code>inner</code>, <em>after</em> it has been returned from <code>foo</code>.</p>
<h3>Uses of Closures</h3>
<p>Closures are useful whenever you need a private state associated with a
function. This is a very common scenario - and remember: JavaScript did not
have a class syntax until 2015, and it still does not have a private field
syntax. Closures meet this need.</p>
<h4>Private Instance Variables</h4>
<p>In the following code, the function <code>toString</code> closes over the details of the
car.</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">Car</span><span class="p">(</span><span class="n">manufacturer</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="err">`</span><span class="o">$</span><span class="p">{</span><span class="n">manufacturer</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">model</span><span class="p">}</span><span class="w"> </span><span class="p">(</span><span class="o">$</span><span class="p">{</span><span class="n">year</span><span class="p">},</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">color</span><span class="p">})</span><span class="err">`</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Car</span><span class="p">(</span><span class="s1">'Aston Martin'</span><span class="p">,</span><span class="w"> </span><span class="s1">'V8 Vantage'</span><span class="p">,</span><span class="w"> </span><span class="s1">'2012'</span><span class="p">,</span><span class="w"> </span><span class="s1">'Quantum Silver'</span><span class="p">)</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">car</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
</pre></div>

<h4>Functional Programming</h4>
<p>In the following code, the function <code>inner</code> closes over both <code>fn</code> and <code>args</code>.</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">curry</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">inner</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">fn</span><span class="o">.</span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">fn</span><span class="p">(</span><span class="o">...</span><span class="n">args</span><span class="p">)</span>
<span class="w">    </span><span class="n">args</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">inner</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">function</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="n">curriedAdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curry</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">curriedAdd</span><span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="mi">3</span><span class="p">)())</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">5</span>
</pre></div>

<h4>Event-Oriented Programming</h4>
<p>In the following code, function <code>onClick</code> closes over variable
<code>BACKGROUND_COLOR</code>.</p>
<div class="code"><pre class="code literal-block">const<span class="w"> </span>$<span class="w"> </span>=<span class="w"> </span>document.querySelector.bind(document)
const<span class="w"> </span>BACKGROUND_COLOR<span class="w"> </span>=<span class="w"> </span>'rgba(200,<span class="w"> </span>200,<span class="w"> </span>242,<span class="w"> </span>1)'

function<span class="w"> </span>onClick()<span class="w"> </span>{
<span class="w">  </span>$('body').style.background<span class="w"> </span>=<span class="w"> </span>BACKGROUND_COLOR
}

$('button').addEventListener('click',<span class="w"> </span>onClick)


<span class="nt">&lt;button&gt;</span>Set<span class="w"> </span>background<span class="w"> </span>color<span class="nt">&lt;/button&gt;</span>
</pre></div>

<h4>Modularization</h4>
<p>In the following example, all the implementation details are hidden inside an
immediately executed function expression. The functions <code>tick</code> and <code>toString</code>
close over the private state and functions they need to complete their work.
Closures have enabled us to modularize and encapsulate our code.</p>
<div class="code"><pre class="code literal-block"><span class="n">let</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>

<span class="p">(</span><span class="n">function</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">  </span><span class="n">function</span><span class="w"> </span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Math</span><span class="o">.</span><span class="n">trunc</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">function</span><span class="w"> </span><span class="n">tick</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">numbers</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">function</span><span class="w"> </span><span class="n">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">numbers</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">format</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">n</span><span class="o">.</span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">tick</span><span class="p">,</span>
<span class="w">    </span><span class="n">toString</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}(</span><span class="n">namespace</span><span class="p">))</span>

<span class="k">const</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">namespace</span><span class="o">.</span><span class="n">counter</span>
<span class="n">counter</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span>
<span class="n">counter</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">toString</span><span class="p">())</span>
</pre></div>

<h3>Examples</h3>
<h4>Example 1</h4>
<p>This example shows that the local variables are not copied in the closure: the
closure maintains a reference to the original variables <em>themselves</em>. It is as
though the stack-frame stays alive in memory even after the outer function
exits.</p>
<div class="code"><pre class="code literal-block"><span class="nv">function</span><span class="w"> </span><span class="nv">foo</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">  </span><span class="nv">let</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span>
<span class="w">  </span><span class="nv">let</span><span class="w"> </span><span class="nv">inner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="nv">x</span><span class="ss">)</span>
<span class="w">  </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nv">inner</span>
}

<span class="nv">foo</span><span class="ss">()()</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nv">logs</span><span class="w"> </span><span class="mi">43</span>
</pre></div>

<h4>Example 2</h4>
<p>In the following code, three methods <code>log</code>, <code>increment</code>, and <code>update</code> all
close over the same lexical environment.</p>
<p>And every time <code>createObject</code> is called, a new execution context (stack frame)
is created and a completely new variable <code>x</code>, and a new set of functions
(<code>log</code> etc.) are created, that close over this new variable.</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">createObject</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">log</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="n">increment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createObject</span><span class="p">()</span>
<span class="n">o</span><span class="o">.</span><span class="n">increment</span><span class="p">()</span>
<span class="n">o</span><span class="o">.</span><span class="n">log</span><span class="p">()</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">43</span>
<span class="n">o</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">log</span><span class="p">()</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">5</span>
<span class="k">const</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createObject</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">log</span><span class="p">()</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">42</span>
</pre></div>

<h4>Example 3</h4>
<p>If you are using variables declared using <code>var</code>, be careful you understand
which variable you are closing over. Variables declared using <code>var</code> are
hoisted. This is much less of a problem in modern JavaScript due to the
introduction of <code>let</code> and <code>const</code>.</p>
<p>In the following code, each time around the loop, a new function <code>inner</code> is
created, which closes over <code>i</code>. But because <code>var i</code> is hoisted outside the
loop, all of these inner functions close over the same variable, meaning that
the final value of <code>i</code> (3) is printed, three times.</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="nf">var</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nf">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">result</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="k">function</span><span class="w"> </span><span class="k">inner</span><span class="p">()</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="err">}</span><span class="w"> </span><span class="p">)</span>
<span class="w">  </span><span class="err">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">result</span>
<span class="err">}</span>

<span class="n">const</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span>
<span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">print</span><span class="w"> </span><span class="err">`</span><span class="mi">3</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="n">times</span><span class="p">...</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nf">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="k">result</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">()</span><span class="w"> </span>
<span class="err">}</span>
</pre></div>

<h3>Final points:</h3>
<ul>
<li>Whenever a function is declared in JavaScript closure is created.</li>
<li>Returning a <code>function</code> from inside another function is the classic example of closure, because the state inside the outer function is implicitly available to the returned inner function, even after the outer function has completed execution.</li>
<li>Whenever you use <code>eval()</code> inside a function, a closure is used. The text you <code>eval</code> can reference local variables of the function, and in the non-strict mode, you can even create new local variables by using <code>eval('var foo = …')</code>.</li>
<li>When you use <code>new Function(…)</code> (the Function constructor) inside a function, it does not close over its lexical environment: it closes over the global context instead. The new function cannot reference the local variables of the outer function.</li>
<li>A closure in JavaScript is like keeping a reference ( <strong>NOT</strong> a copy) to the scope at the point of function declaration, which in turn keeps a reference to its outer scope, and so on, all the way to the global object at the top of the scope chain.</li>
<li>A closure is created when a function is declared; this closure is used to configure the execution context when the function is invoked.</li>
<li>A new set of local variables is created every time a function is called.</li>
</ul>
<h3>Links</h3>
<ul>
<li>Douglas Crockford's simulated private attributes and private methods for an object, using closures.</li>
<li>A great explanation of how closures can cause memory leaks in IE if you are not careful.</li>
<li>MDN documentation on JavaScript Closures.</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>Every function in JavaScript maintains a link to its outer lexical
environment. A lexical environment is a map of all the names (eg. variables,
parameters) within a scope, with their values.</p>
<p>So, whenever you see the <code>function</code> keyword, code inside that function has
access to variables declared outside the function.</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">  </span><span class="n">function</span><span class="w"> </span><span class="n">bar</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">tmp</span><span class="p">));</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="nb">log</span><span class="w"> </span><span class="mi">16</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">bar</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">foo</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</pre></div>

<p>This will log <code>16</code> because function <code>bar</code> closes over the parameter <code>x</code> and
the variable <code>tmp</code>, both of which exist in the lexical environment of outer
function <code>foo</code>.</p>
<p>Function <code>bar</code>, together with its link with the lexical environment of
function <code>foo</code> is a closure.</p>
<p>A function doesn't have to <em>return</em> in order to create a closure. Simply by
virtue of its declaration, every function closes over its enclosing lexical
environment, forming a closure.</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">tmp</span><span class="p">));</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="nb">log</span><span class="w"> </span><span class="mi">16</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">var</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">bar</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">16</span>
<span class="n">bar</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">17</span>
</pre></div>

<p>The above function will also log 16, because the code inside <code>bar</code> can still
refer to argument <code>x</code> and variable <code>tmp</code>, even though they are no longer
directly in scope.</p>
<p>However, since <code>tmp</code> is still hanging around inside <code>bar</code>'s closure, it is
available to be incremented. It will be incremented each time you call <code>bar</code>.</p>
<p>The simplest example of a closure is this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>

<span class="n">function</span><span class="w"> </span><span class="n">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="mi">10</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="mi">6</span>
<span class="p">}</span>
<span class="k">var</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
<span class="n">test</span><span class="p">();</span>
</pre></div>

<p>When a JavaScript function is invoked, a new execution context <code>ec</code> is
created. Together with the function arguments and the target object, this
execution context also receives a link to the lexical environment of the
calling execution context, meaning the variables declared in the outer lexical
environment (in the above example, both <code>a</code> and <code>b</code>) are available from <code>ec</code>.</p>
<p>Every function creates a closure because every function has a link to its
outer lexical environment.</p>
<p>Note that variables <em>themselves</em> are visible from within a closure, <em>not</em>
copies.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-10.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-8.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
