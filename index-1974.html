<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1974) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1974.html">
<link rel="prev" href="index-1975.html" type="text/html">
<link rel="next" href="index-1973.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-solve-error-mysql-shutdown-unexpectedly/" class="u-url">How to solve "Error: MySQL shutdown unexpectedly"?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-solve-error-mysql-shutdown-unexpectedly/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T13:50:22+08:00" itemprop="datePublished" title="2023-03-03 13:50">2023-03-03 13:50</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>When I open XAMPP and click start MySQL button and it gives me an error. I had
started it just before, but now it isn't working.</p>
<blockquote>
<p>12:19:12 PM [mysql] Attempting to start MySQL app...<br>
 12:19:12 PM [mysql] Status change detected: running<br>
 12:19:13 PM [mysql] Status change detected: stopped<br>
 12:19:13 PM [mysql] Error: MySQL shutdown unexpectedly.<br>
 12:19:13 PM [mysql] This may be due to a blocked port, missing
dependencies,<br>
 12:19:13 PM [mysql] improper privileges, a crash, or a shutdown by another
method<br>
 12:19:13 PM [mysql] Press the Logs button to view error logs and check<br>
 12:19:13 PM [mysql] the Windows Event Viewer for more clues<br>
 12:19:13 PM [mysql] If you need more help, copy and post this<br>
 12:19:13 PM [mysql] entire log window on the forums</p>
</blockquote>
<p>Here is the contents of the error log:</p>
<blockquote>
<p>2013-08-02 12:19:12 4536 [Note] Plugin 'FEDERATED' is disabled.<br>
 2013-08-02 12:19:12 f64 InnoDB: Warning: Using
innodb_additional_mem_pool_size is DEPRECATED. This option may be removed in
future releases, together with the option innodb_use_sys_malloc and with the
InnoDB's internal memory allocator.<br>
 2013-08-02 12:19:12 4536 [Note] InnoDB: The InnoDB memory heap is disabled<br>
 2013-08-02 12:19:12 4536 [Note] InnoDB: Mutexes and rw_locks use Windows
interlocked functions<br>
 2013-08-02 12:19:12 4536 [Note] InnoDB: Compressed tables use zlib 1.2.3<br>
 2013-08-02 12:19:12 4536 [Note] InnoDB: Not using CPU crc32 instructions<br>
 2013-08-02 12:19:12 4536 [Note] InnoDB: Initializing buffer pool, size =
16.0M<br>
 2013-08-02 12:19:12 4536 [Note] InnoDB: Completed initialization of buffer
pool<br>
 2013-08-02 12:19:12 4536 [Note] InnoDB: Highest supported file format is
Barracuda.<br>
 2013-08-02 12:19:12 4536 [Note] InnoDB: The log sequence numbers 0 and 0 in
ibdata files do not match the log sequence number 1616798 in the
ib_logfiles!<br>
 2013-08-02 12:19:12 4536 [Note] InnoDB: Database was not shutdown normally!<br>
 2013-08-02 12:19:12 4536 [Note] InnoDB: Starting crash recovery.<br>
 2013-08-02 12:19:12 4536 [Note] InnoDB: Reading tablespace information from
the .ibd files...</p>
</blockquote>
<p>The most important error message is here:</p>
<blockquote>
<p><strong>2013-08-02 12:19:12 4536 [ERROR] InnoDB:</strong><br>
 Attempted to open a previously opened tablespace.<br>
 Previous tablespace <em>mysql/innodb_table_stats</em> uses space ID: 1 at
filepath: <em>.\mysql\innodb_table_stats.ibd</em>.<br>
 Cannot open tablespace <em>xat/payments</em> which uses space ID: 1 at filepath:
<em>.\xat\payments.ibd</em></p>
</blockquote>
<p>The rest of the log:</p>
<blockquote>
<p>InnoDB: Error: could not open single-table tablespace file
.\xat\payments.ibd<br>
 InnoDB: We do not continue the crash recovery, because the table may become<br>
 InnoDB: corrupt if we cannot apply the log records in the InnoDB log to it.<br>
 InnoDB: To fix the problem and start mysqld:<br>
 InnoDB: 1) If there is a permission problem in the file and mysqld cannot<br>
 InnoDB: open the file, you should modify the permissions.<br>
 InnoDB: 2) If the table is not needed, or you can restore it from a backup,<br>
 InnoDB: then you can remove the .ibd file, and InnoDB will do a normal<br>
 InnoDB: crash recovery and ignore that table.<br>
 InnoDB: 3) If the file system or the disk is broken, and you cannot remove<br>
 InnoDB: the .ibd file, you can set innodb_force_recovery &gt; 0 in my.cnf<br>
 InnoDB: and force InnoDB to continue crash recovery here.</p>
</blockquote>
<p>What is the cause of these errors and how can I rectify them?</p>
<p><br><br></p>
<h2>Answer</h2>
<blockquote>
<p><strong>IMPORTANT:</strong> do <strong>NOT</strong> delete <code>ibdata1</code> file. You could destroy all your
databases.</p>
</blockquote>
<p>Instead, first try using the <strong>MySQL backup folder</strong> which is included with
XAMPP. So do next steps:</p>
<ol>
<li>Rename folder <code>mysql/data</code> to <code>mysql/data_old</code>
</li>
<li>Make a copy of <code>mysql/backup</code> folder and name it as <code>mysql/data</code>
</li>
<li>Copy all your database folders from <code>mysql/data_old</code> into <code>mysql/data</code> (except <code>mysql</code>, <code>performance_schema</code>, and <code>phpmyadmin</code> folders)</li>
<li>Copy <code>mysql/data_old/ibdata1</code> file into <code>mysql/data</code> folder</li>
<li>Start MySQL from XAMPP control panel</li>
</ol>
<p>And, voilà!</p>
<h3><strong>EDIT (January 7th 2023)</strong></h3>
<p>As mentioned by some users, this is an emergency solution, not a permanent
one. After recovering your data is <strong>strongly recommended</strong> to back it up, and
reinstalling XAMPP, because the failure is related to a malfunction from some
of the files of XAMPP, not the databases.</p>
<p><br></p>
<h3>Suggest</h3>
<blockquote>
<p><strong>IMPORTANT</strong> Deleting this file may render any existing MySQL data
unusable. Use with caution</p>
</blockquote>
<p>Hey I just did this and it worked:</p>
<ol>
<li>
<em>exit</em> Xampp server</li>
<li>go to your <code>C:\xampp\mysql\data</code> directory</li>
<li>
<em>delete</em> the <code>ibdata1</code> file</li>
<li>
<em>restart</em> xampp server</li>
</ol>
<p>It should work</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-secure-mongodb-with-username-and-password/" class="u-url">How to secure MongoDB with username and password</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-secure-mongodb-with-username-and-password/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T13:49:55+08:00" itemprop="datePublished" title="2023-03-03 13:49">2023-03-03 13:49</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to set up user name &amp; password authentication for my MongoDB instance,
so that any remote access will ask for the user name &amp; password. I tried the
tutorial from the MongoDB site and did following:</p>
<div class="code"><pre class="code literal-block">use admin
db.addUser('theadmin', '12345');
db.auth('theadmin','12345');
</pre></div>

<p>After that, I exited and ran mongo again. And I don't need password to access
it. Even if I connect to the database remotely, I am not prompted for user
name &amp; password.</p>
<hr>
<p><strong>UPDATE</strong> Here is the solution I ended up using</p>
<div class="code"><pre class="code literal-block"><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="n">At</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">mongo</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">line</span><span class="p">,</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">administrator</span><span class="p">:</span>

<span class="w">    </span><span class="n">use</span><span class="w"> </span><span class="n">admin</span><span class="p">;</span>
<span class="w">    </span><span class="n">db</span><span class="mf">.</span><span class="n">addUser</span><span class="p">(</span><span class="err">'</span><span class="n">admin</span><span class="err">'</span><span class="p">,</span><span class="err">'</span><span class="mf">123456</span><span class="err">'</span><span class="p">);</span>

<span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="n">Shutdown</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">exit</span>

<span class="w">    </span><span class="n">db</span><span class="mf">.</span><span class="n">shutdownServer</span><span class="p">();</span>
<span class="w">    </span><span class="n">exit</span>

<span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="n">Restart</span><span class="w"> </span><span class="n">mongod</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">--</span><span class="n">auth</span>

<span class="w">  </span><span class="err">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="mf">.</span><span class="o">/</span><span class="n">mongodb</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">mongod</span><span class="w"> </span><span class="o">--</span><span class="n">auth</span><span class="w"> </span><span class="o">--</span><span class="n">dbpath</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">db</span><span class="o">/</span>

<span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="kr">Run</span><span class="w"> </span><span class="n">mongo</span><span class="w"> </span><span class="n">again</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="n">ways</span><span class="p">:</span>

<span class="w">   </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="kr">run</span><span class="w"> </span><span class="n">mongo</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nb">log</span><span class="n">in</span><span class="p">:</span>

<span class="w">        </span><span class="err">$</span><span class="w"> </span><span class="mf">.</span><span class="o">/</span><span class="n">mongodb</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">mongo</span><span class="w"> </span><span class="n">localhost</span><span class="p">:</span><span class="mf">27017</span>
<span class="w">        </span><span class="n">use</span><span class="w"> </span><span class="n">admin</span>
<span class="w">        </span><span class="n">db</span><span class="mf">.</span><span class="n">auth</span><span class="p">(</span><span class="err">'</span><span class="n">admin</span><span class="err">'</span><span class="p">,</span><span class="err">'</span><span class="mf">123456</span><span class="err">'</span><span class="p">);</span>

<span class="w">  </span><span class="n">ii</span><span class="p">)</span><span class="w"> </span><span class="kr">run</span><span class="w"> </span><span class="err">&amp;</span><span class="w"> </span><span class="nb">log</span><span class="n">in</span><span class="w"> </span><span class="kr">to</span><span class="w"> </span><span class="n">mongo</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">line</span><span class="mf">.</span>

<span class="w">        </span><span class="err">$</span><span class="w"> </span><span class="mf">.</span><span class="o">/</span><span class="n">mongodb</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">mongo</span><span class="w"> </span><span class="n">localhost</span><span class="p">:</span><span class="mf">27017</span><span class="o">/</span><span class="n">admin</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">admin</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="mf">123456</span>
</pre></div>

<p>The username &amp; password will work the same way for <code>mongodump</code> and
<code>mongoexport</code>.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You need to start <code>mongod</code> with the <code>--auth</code> option after setting up the user.</p>
<p>From the MongoDB Site:</p>
<blockquote>
<p>Run the database (mongod process) with the <code>--auth</code> option to enable
security. You must either have added a user to the admin db before starting
the server with <code>--auth</code>, or add the first user from the localhost
interface.</p>
</blockquote>
<p>MongoDB Authentication</p>
<p><br></p>
<h3>Suggest</h3>
<p><strong>Wow so many complicated/confusing answers here.</strong></p>
<p>This is as of <strong>v3.4</strong>.</p>
<h3>Short answer.</h3>
<ol>
<li>
<p>Start MongoDB without access control (<code>/data/db</code> or where your db is).</p>
<div class="code"><pre class="code literal-block">mongod --dbpath /data/db
</pre></div>

</li>
<li>
<p>Connect to the instance.</p>
<div class="code"><pre class="code literal-block">mongo
</pre></div>

</li>
<li>
<p>Create the user.</p>
<div class="code"><pre class="code literal-block">use some_db
</pre></div>

<p>db.createUser(
  {
    user: "myNormalUser",
    pwd: "xyz123",
    roles: [ { role: "readWrite", db: "some_db" },
             { role: "read", db: "some_other_db" } ]
  }
)</p>
</li>
<li>
<p>Stop the MongoDB instance and start it again with access control.</p>
<div class="code"><pre class="code literal-block">mongod --auth --dbpath /data/db
</pre></div>

</li>
<li>
<p>Connect and authenticate as the user.</p>
<div class="code"><pre class="code literal-block">use some_db
</pre></div>

<p>db.auth("myNormalUser", "xyz123")
db.foo.insert({x:1})
use some_other_db
db.foo.find({})</p>
</li>
</ol>
<h3>Long answer: Read this if you want to properly understand.</h3>
<p>It's really simple. I'll dumb the following down
https://docs.mongodb.com/manual/tutorial/enable-authentication/</p>
<p><em>If you want to learn more about what the roles actually do read more here:
https://docs.mongodb.com/manual/reference/built-in-roles/</em></p>
<ol>
<li>
<p>Start MongoDB without access control.</p>
<div class="code"><pre class="code literal-block">mongod --dbpath /data/db
</pre></div>

</li>
<li>
<p>Connect to the instance.</p>
<div class="code"><pre class="code literal-block">mongo
</pre></div>

</li>
<li>
<p>Create the user administrator. <em>The following creates a user administrator in the<code>admin</code> authentication database. The user is a <code>dbOwner</code> over the <code>some_db</code> database and NOT over the <code>admin</code> database, this is important to remember.</em></p>
<div class="code"><pre class="code literal-block">use admin
</pre></div>

<p>db.createUser(
  {
    user: "myDbOwner",
    pwd: "abc123",
    roles: [ { role: "dbOwner", db: "some_db" } ]
  }
)</p>
</li>
</ol>
<p>Or if you want to create an admin which is admin over any database:</p>
<div class="code"><pre class="code literal-block">   use admin
   db.createUser(
     {
       user: "myUserAdmin",
       pwd: "abc123",
       roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]
     }
   )
</pre></div>

<ol>
<li>
<p>Stop the MongoDB instance and start it again with access control.</p>
<div class="code"><pre class="code literal-block">mongod --auth --dbpath /data/db
</pre></div>

</li>
<li>
<p>Connect and authenticate as the user administrator towards the <code>admin</code> authentication database, NOT towards the <code>some_db</code> authentication database. <em>The user administrator was created in the<code>admin</code> authentication database, the user does not exist in the <code>some_db</code> authentication database.</em></p>
<div class="code"><pre class="code literal-block">use admin
</pre></div>

<p>db.auth("myDbOwner", "abc123")</p>
</li>
</ol>
<p><em>You are now authenticated as a<code>dbOwner</code> over the <code>some_db</code> database. So now
if you wish to read/write/do stuff directly towards the <code>some_db</code> database you
can change to it.</em></p>
<div class="code"><pre class="code literal-block"><span class="nv">use</span><span class="w"> </span><span class="nv">some_db</span>
<span class="o">//</span>...<span class="k">do</span><span class="w"> </span><span class="nv">stuff</span><span class="w"> </span><span class="nv">like</span><span class="w"> </span><span class="nv">db</span>.<span class="nv">foo</span>.<span class="nv">insert</span><span class="ss">(</span>{<span class="nv">x</span>:<span class="mi">1</span>}<span class="ss">)</span>
<span class="o">//</span><span class="w"> </span><span class="nv">remember</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">user</span><span class="w"> </span><span class="nv">administrator</span><span class="w"> </span><span class="nv">had</span><span class="w"> </span><span class="nv">dbOwner</span><span class="w"> </span><span class="nv">rights</span><span class="w"> </span><span class="nv">so</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">user</span><span class="w"> </span><span class="nv">may</span><span class="w"> </span><span class="nv">write</span><span class="o">/</span><span class="nv">read</span>,<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">create</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">user</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">userAdmin</span><span class="w"> </span><span class="nv">they</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">able</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">read</span><span class="o">/</span><span class="nv">write</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">example</span>.
</pre></div>

<p>More on roles: https://docs.mongodb.com/manual/reference/built-in-roles/</p>
<p><em>If you wish to make additional users which aren't user administrators and
which are just normal users continue reading below.</em></p>
<ol>
<li>
<p>Create a normal user. <em>This user will be created in the<code>some_db</code> authentication database down below.</em></p>
<div class="code"><pre class="code literal-block">use some_db
</pre></div>

<p>db.createUser(
  {
    user: "myNormalUser",
    pwd: "xyz123",
    roles: [ { role: "readWrite", db: "some_db" },
             { role: "read", db: "some_other_db" } ]
  }
)</p>
</li>
<li>
<p>Exit the mongo shell, re-connect, authenticate as the user.</p>
<div class="code"><pre class="code literal-block">use some_db
</pre></div>

<p>db.auth("myNormalUser", "xyz123")
db.foo.insert({x:1})
use some_other_db
db.foo.find({})</p>
</li>
</ol>
<p>Last but not least due to users not reading the commands I posted correctly
regarding the <code>--auth</code> flag, you can set this value in the configuration file
for mongoDB if you do not wish to set it as a flag.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/do-dom-tree-elements-with-ids-become-global-properties/" class="u-url">Do DOM tree elements with IDs become global properties?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/do-dom-tree-elements-with-ids-become-global-properties/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T13:49:33+08:00" itemprop="datePublished" title="2023-03-03 13:49">2023-03-03 13:49</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Working on an idea for a simple <code>HTMLElement</code> wrapper I stumbled upon the
following for Internet Explorer and Chrome:</p>
<p>For a given <code>HTMLElement</code> with an <code>id</code> in the DOM tree, it is possible to
retrieve the <code>&lt;div&gt;</code> using its ID as a variable name or as a property of
<code>window</code>. So for a <code>&lt;div&gt;</code> like</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">"example"</span><span class="nt">&gt;</span>some<span class="w"> </span>text<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>in Internet Explorer 8 and Chrome you can do:</p>
<div class="code"><pre class="code literal-block">alert(example.innerHTML); // Alerts "some text".
</pre></div>

<p>or</p>
<div class="code"><pre class="code literal-block">alert(window["example"].innerHTML); // Alerts "some text".
</pre></div>

<p>So, does this mean <em>every element in the DOM tree</em> is converted to a property
on the global object? And does it also mean one can use this as a replacement
for the <code>getElementById</code> method in these browsers?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>What is supposed to happen is that ‘named elements’ are added as apparent
properties of the <code>document</code> object. This is a really bad idea, as it allows
element names to clash with real properties of <code>document</code>.</p>
<p>IE made the situation worse by also adding named elements as properties of the
<code>window</code> object. This is doubly bad in that now you have to avoid naming your
elements after any member of either the <code>document</code> or the <code>window</code> object you
(or any other library code in your project) might want to use.</p>
<p>It also means that these elements are visible as global-like variables.
Luckily in this case any real global <code>var</code> or <code>function</code> declarations in your
code shadow them, so you don't need to worry so much about naming here, but if
you try to do an assignment to a global variable with a clashing name and you
forget to declare it <code>var</code>, you'll get an error in IE as it tries to assign
the value to the element itself.</p>
<p>It's generally considered bad practice to omit <code>var</code>, as well as to rely on
named elements being visible on <code>window</code> or as globals. Stick to
<code>document.getElementById</code>, which is more widely-supported and less ambiguous.
You can write a trivial wrapper function with a shorter name if you don't like
the typing. Either way, there's no point in using an id-to-element lookup
cache, because browsers typically optimise the <code>getElementById</code> call to use a
quick lookup anyway; all you get is problems when elements change <code>id</code> or are
added/removed from the document.</p>
<p>Opera copied IE, then WebKit joined in, and now both the previously-
unstandardised practice of putting named elements on <code>document</code> properties,
and the previously-IE-only practice of putting them on <code>window</code> are being
standardised by HTML5, whose approach is to document and standardise every
terrible practice inflicted on us by browser authors, making them part of the
web forever. So Firefox 4 will also support this.</p>
<p>What are ‘named elements’? Anything with an <code>id</code>, and anything with a <code>name</code>
being used for ‘identifying’ purposes: that is, forms, images, anchors and a
few others, but not other unrelated instances of a <code>name</code> attribute, like
control-names in form input fields, parameter names in <code>&lt;param&gt;</code> or metadata
type in <code>&lt;meta&gt;</code>. ‘Identifying’ <code>name</code>s are the ones that should be avoided in
favour of <code>id</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>As mentioned in the earlier answer this behavior is known as named access on
the window object. The value of the <code>name</code> attribute for some elements and the
value of the <code>id</code> attribute for all elements are made available as properties
of the global <code>window</code> object. These are known as named elements. Since
<code>window</code> is the global object in the browser, each named element will be
accessible as a global variable.</p>
<p>This was originally added by Internet Explorer and eventually was implemented
by all other browsers simply for compatibility with sites that are dependent
on this behavior. Interestingly, Gecko (Firefox's rendering engine) chose to
implement this in quirks mode only, whereas other rendering engines left it on
in standards mode.</p>
<p>However, as of Firefox 14, Firefox now supports named access on the <code>window</code>
object in standards mode as well. Why did they change this? Turns out there's
still a lot of sites that rely on this functionality in standards mode.
Microsoft even released a marketing demo that did, preventing the demo from
working in Firefox.</p>
<p>Webkit has recently considered the opposite, relegating named access on the
<code>window</code> object to quirks mode only. They decided against it by the same
reasoning as Gecko.</p>
<p>So… crazy as it seems this behavior is now <strong>technically safe to use in the
latest version of all major browsers in standards mode</strong>. But while named
access can seem somewhat convenient , <strong>it should not be used</strong>.</p>
<p>Why? A lot of the reasoning can be summed up in this article about why global
variables are bad. Simply put, having a bunch of extra global variables leads
to more bugs. Let's say you accidentally type the name of a <code>var</code> and happen
to type an <code>id</code> of a DOM node, SURPRISE!</p>
<p>Additionally, despite being standardized there are still quite a few
discrepancies in browser's implementations of named access.</p>
<ul>
<li>IE incorrectly makes the value of the <code>name</code> attribute accessible for form elements (input, select, etc).</li>
<li>Gecko and Webkit incorrectly do NOT make <code>&lt;a&gt;</code> tags accessible via their <code>name</code> attribute.</li>
<li>Gecko incorrectly handles multiple named elements with the same name (it returns a reference to a single node instead of an array of references).</li>
</ul>
<p>And I'm sure there's more if you try using named access on edge cases.</p>
<p>As mentioned in other answers use <code>document.getElementById</code> to get a reference
to a DOM node by its <code>id</code>. If you need to get a reference to a node by its
<code>name</code> attribute use <code>document.querySelectorAll</code>.</p>
<p>Please, please do not propagate this problem by using named access in your
site. So many web developers have wasted time trying to track down this
<em>magical</em> behavior. We really need to take action and get rendering engines to
turn named access off in standards mode. In the short term it will break some
sites doing bad things, but in the long run it'll help move the web forward.</p>
<p>If you're interested I talk about this in more detail on my blog -
https://www.tjvantoll.com/2012/07/19/dom-element-references-as-global-
variables/.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1975.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1973.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
