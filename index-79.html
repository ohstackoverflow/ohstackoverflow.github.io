<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 79) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-79.html">
<link rel="prev" href="index-80.html" type="text/html">
<link rel="next" href="index-78.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/flash-cs4-refuses-to-let-go/" class="u-url">Flash CS4 refuses to let go</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/flash-cs4-refuses-to-let-go/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T20:36:03+08:00" itemprop="datePublished" title="2023-02-16 20:36">2023-02-16 20:36</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a Flash project, and it has many source files. I have a fairly heavily-
used class, call it Jenine. I recently (and, perhaps, callously) relocated
Jenine from one namespace to another. I thought we were ready - I thought it
was time. The new Jenine was better in every way - she had lost some code
bloat, she had decoupled herself from a few vestigial class relationships, and
she had finally come home to the namespace that she had always secretly known
in her heart was the one she truly belonged to. She was among her own kind.</p>
<p>Unfortunately, Flash would have none of that. Perhaps it had formed an
attachment. Perhaps it didn't <em>want</em> Jenine to be decoupled. Either way, it
clung to the old, perfect version of Jenine in its memory. It refused to move
on. It ignored her (function) calls. It tried to forget her new, public
interfaces. Instead, every instance of Jenine that it constructed was always a
copy of the old version, down to its classpath:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">jenineInstance</span><span class="p">:</span><span class="n">Jenine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Jenine</span><span class="p">();</span>
<span class="n">trace</span><span class="p">(</span><span class="w"> </span><span class="n">getQualifiedClassName</span><span class="p">(</span><span class="n">jenineInstance</span><span class="p">));</span>
<span class="o">//</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="nb">print</span><span class="p">:</span><span class="w"> </span><span class="n">com</span><span class="o">.</span><span class="n">newnamespace</span><span class="o">.</span><span class="n">subspace</span><span class="p">::</span><span class="n">Jenine</span>
<span class="o">//</span><span class="w"> </span><span class="n">Prints</span><span class="p">:</span><span class="w"> </span><span class="n">com</span><span class="o">.</span><span class="n">oldnamespace</span><span class="o">.</span><span class="n">subspace</span><span class="p">::</span><span class="n">Jenine</span>
<span class="o">//</span><span class="w"> </span><span class="n">Ah</span><span class="p">,</span><span class="w"> </span><span class="n">young</span><span class="w"> </span><span class="n">love</span><span class="o">!</span>
</pre></div>

<p>We fought. I'm not proud of some of the things I said or did. In the end, in a
towering fit of rage, I deleted all references of Jenine completely. She was
utterly, completely erased from the system. My cursor fell upon the "Empty
Trash" menu option like the cold lid of a casket.</p>
<p>I don't think Flash ever recovered. To this day it still clings to the memory
of Jenine. Her old, imperfect definitions still float through my project like
abandoned ghosts. Whenever I force Flash to compile, it still lovingly inserts
her into my movie, nestling her definition in amongst the other, living
classes, like a small shrine. I wonder if they can see her.</p>
<p>Flash and I don't really talk anymore. I write my code, it compiles it.
There's a new girl in town named Summer who looks almost identical to Jenine,
as if someone had just copied her source-code wholesale into a new class, but
Flash hasn't shown any interest. Most days it just mopes around and writes bad
poetry in my comments when it thinks I'm not looking.</p>
<p>I hope no one else has had a similar experience, that this is just a singular,
painful ripple in the horrifying dark lagoon that is the Flash code-base. Does
anyone have any idea how to erase whatever cache the compiler is using?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Flash still has the ASO file, which is the compiled byte code for your
classes. On Windows, you can see the ASO files here:</p>
<div class="code"><pre class="code literal-block">C:\Documents and Settings\username\Local Settings\Application Data\Adobe\Flash CS4\en\Configuration\Classes\aso
</pre></div>

<p>On a Mac, the directory structure is similar in
<code>/Users/username/Library/Application Support/</code></p>
<hr>
<p>You can remove those files by hand, or in Flash you can select
<code>Control-&gt;Delete ASO files</code> to remove them.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Try deleting your ASO files.</p>
<p>ASO files are cached compiled versions of your class files. Although the IDE
is a lot better at letting go of old caches when changes are made, sometimes
you have to manually delete them. To delete ASO files: Control&gt;Delete ASO
Files.</p>
<p>This is also the cause of the "I-am-not-seeing-my-changes-so-let-me-add-a-
trace-now-everything-works" bug that was introduced in CS3.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/encode-url-in-javascript/" class="u-url">Encode URL in JavaScript</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/encode-url-in-javascript/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T20:35:34+08:00" itemprop="datePublished" title="2023-02-16 20:35">2023-02-16 20:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do you safely encode a URL using JavaScript such that it can be put into a
GET string?</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">myUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://example.com/index.html?param=1&amp;anotherParam=2"</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">myOtherUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://example.com/index.html?url="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">myUrl</span><span class="p">;</span>
</pre></div>

<p>I assume that you need to encode the <code>myUrl</code> variable on that second line?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Check out the built-in function encodeURIComponent(str) and encodeURI(str).<br>
In your case, this should work:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">myOtherUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">       </span><span class="s2">"http://example.com/index.html?url="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">encodeURIComponent</span><span class="p">(</span><span class="n">myUrl</span><span class="p">);</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You have three options:</p>
<ul>
<li>
<p><code>escape()</code> will not encode: <code>@*/+</code></p>
</li>
<li>
<p><code>encodeURI()</code> will not encode: <code>~!@#$&amp;*()=:/,;?+'</code></p>
</li>
<li>
<p><code>encodeURIComponent()</code> will not encode: <code>~!*()'</code></p>
</li>
</ul>
<p>But in your case, if you want to pass a URL into a <code>GET</code> parameter of other
page, you should use <code>escape</code> or <code>encodeURIComponent</code>, but not <code>encodeURI</code>.</p>
<p>See Stack Overflow question <em>Best practice: escape, or encodeURI /
encodeURIComponent</em> for further discussion.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/using-async-await-with-a-foreach-loop/" class="u-url">Using async/await with a forEach loop</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/using-async-await-with-a-foreach-loop/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T20:35:00+08:00" itemprop="datePublished" title="2023-02-16 20:35">2023-02-16 20:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Are there any issues with using <code>async</code>/<code>await</code> in a <code>forEach</code> loop? I'm
trying to loop through an array of files and <code>await</code> on the contents of each
file.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">fs</span> <span class="kn">from</span> <span class="s1">'fs-promise'</span>

<span class="k">async</span> <span class="n">function</span> <span class="n">printFiles</span> <span class="p">()</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">files</span> <span class="o">=</span> <span class="k">await</span> <span class="n">getFilePaths</span><span class="p">()</span> <span class="o">//</span> <span class="n">Assume</span> <span class="n">this</span> <span class="n">works</span> <span class="n">fine</span>

  <span class="n">files</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">contents</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fs</span><span class="o">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">'utf8'</span><span class="p">)</span>
    <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="n">printFiles</span><span class="p">()</span>
</pre></div>

<p>This code does work, but could something go wrong with this? I had someone
tell me that you're not supposed to use <code>async</code>/<code>await</code> in a higher-order
function like this, so I just wanted to ask if there was any issue with this.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Sure the code does work, but I'm pretty sure it doesn't do what you expect it
to do. It just fires off multiple asynchronous calls, but the <code>printFiles</code>
function does immediately return after that.</p>
<h4>Reading in sequence</h4>
<p>If you want to read the files in sequence, <strong>you cannot use<code>forEach</code></strong> indeed.
Just use a modern <code>for … of</code> loop instead, in which <code>await</code> will work as
expected:</p>
<div class="code"><pre class="code literal-block"><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">printFiles</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">getFilePaths</span><span class="p">();</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">files</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="s1">'utf8'</span><span class="p">);</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">contents</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>Reading in parallel</h4>
<p>If you want to read the files in parallel, <strong>you cannot use<code>forEach</code></strong> indeed.
Each of the <code>async</code> callback function calls does return a promise, but you're
throwing them away instead of awaiting them. Just use <code>map</code> instead, and you
can await the array of promises that you'll get with <code>Promise.all</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">printFiles</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">getFilePaths</span><span class="p">();</span>

<span class="w">  </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">files</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">async</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="s1">'utf8'</span><span class="p">)</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
<span class="w">  </span><span class="p">}));</span>
<span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>With ES2018, you are able to greatly simplify all of the above answers to:</p>
<div class="code"><pre class="code literal-block"><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">printFiles</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">getFilePaths</span><span class="p">()</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">files</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">readFile</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="s1">'utf8'</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>See spec: proposal-async-iteration</p>
<p><strong>Simplified:</strong></p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">array</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">await</span><span class="w"> </span><span class="n">longRunningTask</span><span class="p">()</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'I will wait'</span><span class="p">)</span>
</pre></div>

<hr>
<p>2018-09-10: This answer has been getting a lot of attention recently, please
see Axel Rauschmayer's blog post for further information about asynchronous
iteration.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-80.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-78.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
