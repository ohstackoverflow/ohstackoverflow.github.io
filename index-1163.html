<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1163) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1163.html">
<link rel="prev" href="index-1164.html" type="text/html">
<link rel="next" href="index-1162.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/download-large-file-in-python-with-requests/" class="u-url">Download large file in python with requests</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/download-large-file-in-python-with-requests/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T02:45:19+08:00" itemprop="datePublished" title="2023-02-18 02:45">2023-02-18 02:45</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Requests is a really nice library. I'd like to use it for downloading big
files (&gt;1GB). The problem is it's not possible to keep whole file in memory; I
need to read it in chunks. And this is a problem with the following code:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">DownloadFile</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">local_filename</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_filename</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">):</span> 
        <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span> <span class="c1"># filter out keep-alive new chunks</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>

<p>For some reason it doesn't work this way; it still loads the response into
memory before it is saved to a file.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>With the following streaming code, the Python memory usage is restricted
regardless of the size of the downloaded file:</p>
<div class="code"><pre class="code literal-block"><span class="n">def</span><span class="w"> </span><span class="n">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="n">local_filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="w">    </span><span class="c1"># NOTE the stream=True parameter below</span>
<span class="w">    </span><span class="n">with</span><span class="w"> </span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="o">=</span><span class="n">True</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">r</span><span class="p">:</span>
<span class="w">        </span><span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="w">        </span><span class="n">with</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">local_filename</span><span class="p">,</span><span class="w"> </span><span class="s1">'wb'</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">f</span><span class="p">:</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">chunk</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span><span class="w"> </span>
<span class="w">                </span><span class="c1"># If you have chunk encoded response uncomment if</span>
<span class="w">                </span><span class="c1"># and set chunk_size parameter to None.</span>
<span class="w">                </span><span class="c1">#if chunk: </span>
<span class="w">                </span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">local_filename</span>
</pre></div>

<p>Note that the number of bytes returned using <code>iter_content</code> is not exactly the
<code>chunk_size</code>; it's expected to be a random number that is often far bigger,
and is expected to be different in every iteration.</p>
<p>See body-content-workflow and Response.iter_content for further reference.</p>
<p><br></p>
<h3>Suggest</h3>
<p>It's much easier if you use <code>Response.raw</code> and <code>shutil.copyfileobj()</code>:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">local_filename</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_filename</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">local_filename</span>
</pre></div>

<p>This streams the file to disk without using excessive memory, and the code is
simple.</p>
<p>Note: According to the documentation, <code>Response.raw</code> will <em>not</em> decode <code>gzip</code>
and <code>deflate</code> transfer-encodings, so you will need to do this manually.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-s-the-difference-between-text-xml-vs-application-xml-for-webservice-response/" class="u-url">What's the difference between text/xml vs application/xml for webservice response</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-s-the-difference-between-text-xml-vs-application-xml-for-webservice-response/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T02:44:58+08:00" itemprop="datePublished" title="2023-02-18 02:44">2023-02-18 02:44</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>This is more of a general question about the difference between <code>text/xml</code> and
<code>application/xml</code>. I am fairly new to writing webservices (REST - Jersey). I
have been producing <code>application/xml</code> since it is what shows up in most
tutorials / code examples that I have been using to learn, but I recently
found out about <code>text/xml</code> and was wondering what is different about it and
when would you use it over <code>application/xml</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This is an old question, but one that is frequently visited and clear
recommendations are now available from RFC 7303 which obsoletes RFC3023. In a
nutshell (section 9.2):</p>
<div class="code"><pre class="code literal-block"><span class="n">The</span><span class="w"> </span><span class="n">registration</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">xml</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">respects</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span>
<span class="n">as</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">xml</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="p">(</span><span class="n">Section</span><span class="w"> </span><span class="mf">9.1</span><span class="p">),</span><span class="w"> </span><span class="n">except</span><span class="w"> </span><span class="n">that</span>
<span class="n">the</span><span class="w"> </span><span class="s">"Type name"</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="s">"text"</span><span class="p">.</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>This is an old question, but one that is frequently visited and clear
recommendations are now available from RFC 7303 which obsoletes RFC3023. In a
nutshell (section 9.2):</p>
<div class="code"><pre class="code literal-block"><span class="n">The</span><span class="w"> </span><span class="n">registration</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">xml</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">respects</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span>
<span class="n">as</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">xml</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="p">(</span><span class="n">Section</span><span class="w"> </span><span class="mf">9.1</span><span class="p">),</span><span class="w"> </span><span class="n">except</span><span class="w"> </span><span class="n">that</span>
<span class="n">the</span><span class="w"> </span><span class="s">"Type name"</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="s">"text"</span><span class="p">.</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/should-i-commit-the-vscode-folder-to-source-control/" class="u-url">Should I commit the .vscode folder to source control?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/should-i-commit-the-vscode-folder-to-source-control/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T02:44:33+08:00" itemprop="datePublished" title="2023-02-18 02:44">2023-02-18 02:44</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Is the <code>.vscode</code> folder meant to be committed to source control?</p>
<p>In a fresh project, the folder is empty, except the <code>settings.json</code> file. What
kind of things would go into this folder? Is it machine-specific, developer-
specific like the <code>.vs</code> folder and thus not be committed? Or should all
developers share this folder and thus it should be committed?</p>
<p>The comment at the top of the file <code>.vscode/settings.json</code> states:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// Place your settings in this file to overwrite default and user settings.</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>

<p>This seems to imply that the folder should contain project-specific settings
and thus be included in source. Also, this post on UserVoice seems to imply
some typings would go in there, also suggesting that it should be committed.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Check in the <code>.vscode</code> folder if you want to share settings, task
configuration and debug configuration with the team. I think generally it
makes sense to share settings (e.g. whitespace vs tabs) with the team if you
want to enforce settings in a team. We in the VS Code team share debug and
task specific settings as well because we want our team to have the same set
of debug targets and task targets for VS Code.</p>
<p>Btw you do not need to have a <code>.vscode</code> folder in your project for settings.
You can also configure settings on a user level.</p>
<p><br></p>
<h3>Suggest</h3>
<h2>Commit some files in <code>.vscode</code> folder</h2>
<p>Recommendation is to generally exclude <code>.vscode</code> folder, but leave select JSON
files that allow other developers to recreate shared settings.</p>
<p>Examples of settings to include:</p>
<ul>
<li>Language specific test configurations to run the test suite(s) (<code>settings.json</code>)</li>
<li>Extension settings for linters and code formatting tools to enforce the language rules used in this repo (<code>settings.json</code>)</li>
<li>Run and debug configurations (<code>launch.json</code>)</li>
<li>Shared tasks - if managed with VS Code (<code>tasks.json</code>)</li>
</ul>
<p>Note that some settings can be stored in the user settings or workspace file,
or transferred to it from the <code>.vscode</code> folder. See below.</p>
<hr>
<h2>Sample <code>.gitignore</code> code</h2>
<p>Here are the settings, as suggested at https://gitignore.io. You can search
for "VisualStudioCode" there to get the latest recommended <code>.gitignore</code> file.
I use this website as a starting point for <code>.gitignore</code> for most of my new
repos:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># Created by https://www.gitignore.io/api/visualstudiocode</span>
<span class="c1"># Edit at https://www.gitignore.io/?templates=visualstudiocode</span>

<span class="c1">### VisualStudioCode ###</span>
<span class="na">.vscode</span><span class="cm">/*      # Maybe .vscode/**/</span><span class="p">*</span><span class="w"> </span><span class="no">instead</span><span class="w"> </span><span class="p">-</span><span class="w"> </span><span class="no">see</span><span class="w"> </span><span class="no">comments</span>
<span class="err">!</span><span class="na">.vscode</span><span class="err">/</span><span class="no">settings.json</span>
<span class="err">!</span><span class="na">.vscode</span><span class="err">/</span><span class="no">tasks.json</span>
<span class="err">!</span><span class="na">.vscode</span><span class="err">/</span><span class="no">launch.json</span>
<span class="err">!</span><span class="na">.vscode</span><span class="err">/</span><span class="no">extensions.json</span>

<span class="c1">### VisualStudioCode Patch ###</span>
<span class="c1"># Ignore all local history of files</span>
<span class="err">**/</span><span class="na">.history</span>

<span class="c1"># End of https://www.gitignore.io/api/visualstudiocode</span>
</pre></div>

<hr>
<p>In the above <code>.gitignore</code> file, the <code>.vscode/*</code> line (note: some debate on
whether the <code>*</code> should be included - see comments; <code>.vscode/**/*</code> may be
better to ignore nested folders as well) says to exclude everything in the
<code>.vscode</code> folder, but then the <code>!.vscode/a_specific_file</code> lines tell git to
"not" ignore some specific files in that folder (<code>settings.json</code>,
<code>launch.json</code>, etc.). The end result is that everything is excluded in the
<code>.vscode</code> folder except for the files specifically named in one of those other
lines.</p>
<hr>
<h2>Other Factors</h2>
<p>Including the <code>.vscode</code> folder in your repo doesn't actually <em>hurt</em> anyone
that uses a different IDE (or text/code editor).</p>
<p>However, it may cause issues for other people using VS Code, or some of the
settings may not load properly, if these files include generic settings that
require something specific to your environment - like the absolute path the
repo is installed in. The key is to avoid saving settings that are custom to
your local environment, only sharing those that can (or, in the case of this
repo, should) be used by everyone.</p>
<p>For example, if IDE setting files have absolute paths to the repo or any
files/libraries, etc., then that is bad, don't share. But if all the
references are relative, then they should work for anyone using the repo
(although, be careful about path specification differences between
Windows/Unix..).</p>
<hr>
<h2>About User, Workspace, and Folder settings</h2>
<p><strong>Note:</strong> the settings files in the <code>.vscode</code> folder are generally updated
when you make changes to the <em>folder</em> version of the settings - but this
appears to depend on how individual extensions are coded, because I've run
across multiple exceptions to this rule.</p>
<ul>
<li>If you make changes to the <em>user</em> settings, they are usually stored elsewhere (location depends on OS settings, usually in a home directory).</li>
<li>If you make changes to the <em>workspace</em> settings, they are usually stored in the <code>*.code-workspace</code> file that you are currently using. If you don't have a workspace (you directly opened a folder instead), then they will likely go to the <code>.vscode</code> folder, but, overall, this may depend on the extension that owns the setting anyway.</li>
</ul>
<p>So, you should generally put custom settings for your personal PC into the
<em>user</em> settings, and put generic settings into the <em>workspace</em> or <em>folder</em>
settings.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1164.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1162.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
