<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 368) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-368.html">
<link rel="prev" href="index-369.html" type="text/html">
<link rel="next" href="index-367.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/is-there-a-simple-way-to-delete-a-list-element-by-value/" class="u-url">Is there a simple way to delete a list element by value?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/is-there-a-simple-way-to-delete-a-list-element-by-value/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:04:02+08:00" itemprop="datePublished" title="2023-02-17 05:04">2023-02-17 05:04</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to remove a value from a list if it exists in the list (which it may
not).</p>
<div class="code"><pre class="code literal-block"><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">1, 2, 3, 4</span><span class="o">]</span>
<span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">index</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="n">del</span><span class="w"> </span><span class="n">a</span><span class="o">[</span><span class="n">b</span><span class="o">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>

<p>The above gives the error:</p>
<div class="code"><pre class="code literal-block"><span class="n">ValueError</span><span class="o">:</span><span class="w"> </span><span class="n">list</span><span class="o">.</span><span class="na">index</span><span class="o">(</span><span class="n">x</span><span class="o">):</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">list</span>
</pre></div>

<p>So I have to do this:</p>
<div class="code"><pre class="code literal-block"><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">1, 2, 3, 4</span><span class="o">]</span>

<span class="k">try</span><span class="err">:</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">index</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="w">    </span><span class="n">del</span><span class="w"> </span><span class="n">a</span><span class="o">[</span><span class="n">b</span><span class="o">]</span>
<span class="ow">except</span><span class="err">:</span>
<span class="w">    </span><span class="n">pass</span>

<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>

<p>But is there not a simpler way to do this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>To remove the <em>first occurrence</em> of an element, use <code>list.remove</code>:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; xs = ['a', 'b', 'c', 'd']
&gt;&gt;&gt; xs.remove('b')
&gt;&gt;&gt; print(xs)
['a', 'c', 'd']
</pre></div>

<p>To remove <em>all occurrences</em> of an element, use a list comprehension:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>[<span class="s1">'a'</span>,<span class="w"> </span><span class="s1">'b'</span>,<span class="w"> </span><span class="s1">'c'</span>,<span class="w"> </span><span class="s1">'d'</span>,<span class="w"> </span><span class="s1">'b'</span>,<span class="w"> </span><span class="s1">'b'</span>,<span class="w"> </span><span class="s1">'b'</span>,<span class="w"> </span><span class="s1">'b'</span>]
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>[<span class="nv">x</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">xs</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'b'</span>]
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">print</span><span class="ss">(</span><span class="nv">xs</span><span class="ss">)</span>
[<span class="s1">'a'</span>,<span class="w"> </span><span class="s1">'c'</span>,<span class="w"> </span><span class="s1">'d'</span>]
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Usually Python will throw an Exception if you tell it to do something it can't
so you'll have to do either:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">a</span>:
<span class="w">    </span><span class="nv">a</span>.<span class="nv">remove</span><span class="ss">(</span><span class="nv">c</span><span class="ss">)</span>
</pre></div>

<p>or:</p>
<div class="code"><pre class="code literal-block"><span class="k">try</span><span class="o">:</span>
<span class="w">    </span><span class="n">a</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">c</span><span class="o">)</span>
<span class="n">except</span><span class="w"> </span><span class="n">ValueError</span><span class="o">:</span>
<span class="w">    </span><span class="n">pass</span>
</pre></div>

<p>An Exception isn't necessarily a bad thing as long as it's one you're
expecting and handle properly.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-are-zlib-gzip-and-zip-related-what-do-they-have-in-common-and-how-are-they-different/" class="u-url">How are zlib, gzip and zip related? What do they have in common and how are they different?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-are-zlib-gzip-and-zip-related-what-do-they-have-in-common-and-how-are-they-different/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:03:39+08:00" itemprop="datePublished" title="2023-02-17 05:03">2023-02-17 05:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>The compression algorithm used in <em>zlib</em> is essentially the same as that in
<em>gzip</em> and <em>zip</em>. What are <em>gzip</em> and <em>zip</em>? How are they different and how
are they same?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><em>Short form:</em></p>
<p><code>.zip</code> is an archive format using, usually, the Deflate compression method.
The <code>.gz</code> gzip format is for single files, also using the Deflate compression
method. Often gzip is used in combination with tar to make a compressed
archive format, <code>.tar.gz</code>. The zlib library provides Deflate compression and
decompression code for use by zip, gzip, png (which uses the zlib wrapper on
deflate data), and many other applications.</p>
<p><em>Long form:</em></p>
<p>The ZIP format was developed by Phil Katz as an open format with an open
specification, where his implementation, PKZIP, was shareware. It is an
archive format that stores files and their directory structure, where each
file is individually compressed. The file type is <code>.zip</code>. The files, as well
as the directory structure, can optionally be encrypted.</p>
<p>The ZIP format supports several compression methods:</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="p">(</span><span class="n">no</span><span class="w"> </span><span class="n">compression</span><span class="p">)</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Shrunk</span>
<span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Reduced</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">compression</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Reduced</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">compression</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Reduced</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">compression</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="mi">3</span>
<span class="w">    </span><span class="mi">5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Reduced</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">compression</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="mi">4</span>
<span class="w">    </span><span class="mi">6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Imploded</span>
<span class="w">    </span><span class="mi">7</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Reserved</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Tokenizing</span><span class="w"> </span><span class="n">compression</span><span class="w"> </span><span class="n">algorithm</span>
<span class="w">    </span><span class="mi">8</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Deflated</span>
<span class="w">    </span><span class="mi">9</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Enhanced</span><span class="w"> </span><span class="n">Deflating</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">Deflate64</span><span class="p">(</span><span class="n">tm</span><span class="p">)</span>
<span class="w">   </span><span class="mi">10</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PKWARE</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">Compression</span><span class="w"> </span><span class="n">Library</span><span class="w"> </span><span class="n">Imploding</span><span class="w"> </span><span class="p">(</span><span class="n">old</span><span class="w"> </span><span class="n">IBM</span><span class="w"> </span><span class="n">TERSE</span><span class="p">)</span>
<span class="w">   </span><span class="mi">11</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Reserved</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">PKWARE</span>
<span class="w">   </span><span class="mi">12</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">compressed</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">BZIP2</span><span class="w"> </span><span class="n">algorithm</span>
<span class="w">   </span><span class="mi">13</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Reserved</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">PKWARE</span>
<span class="w">   </span><span class="mi">14</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">LZMA</span>
<span class="w">   </span><span class="mi">15</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Reserved</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">PKWARE</span>
<span class="w">   </span><span class="mi">16</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">IBM</span><span class="w"> </span><span class="n">z</span><span class="o">/</span><span class="n">OS</span><span class="w"> </span><span class="n">CMPSC</span><span class="w"> </span><span class="n">Compression</span>
<span class="w">   </span><span class="mi">17</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Reserved</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">PKWARE</span>
<span class="w">   </span><span class="mi">18</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">File</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">compressed</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">IBM</span><span class="w"> </span><span class="n">TERSE</span><span class="w"> </span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
<span class="w">   </span><span class="mi">19</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">IBM</span><span class="w"> </span><span class="n">LZ77</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="n">Architecture</span><span class="w"> </span>
<span class="w">   </span><span class="mi">20</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="p">(</span><span class="n">use</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="mi">93</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">zstd</span><span class="p">)</span>
<span class="w">   </span><span class="mi">93</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Zstandard</span><span class="w"> </span><span class="p">(</span><span class="n">zstd</span><span class="p">)</span><span class="w"> </span><span class="n">Compression</span><span class="w"> </span>
<span class="w">   </span><span class="mi">94</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">MP3</span><span class="w"> </span><span class="n">Compression</span><span class="w"> </span>
<span class="w">   </span><span class="mi">95</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">XZ</span><span class="w"> </span><span class="n">Compression</span><span class="w"> </span>
<span class="w">   </span><span class="mi">96</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">JPEG</span><span class="w"> </span><span class="n">variant</span>
<span class="w">   </span><span class="mi">97</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">WavPack</span><span class="w"> </span><span class="n">compressed</span><span class="w"> </span><span class="n">data</span>
<span class="w">   </span><span class="mi">98</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PPMd</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="n">Rev</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="mi">99</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AE</span><span class="o">-</span><span class="n">x</span><span class="w"> </span><span class="n">encryption</span><span class="w"> </span><span class="n">marker</span><span class="w"> </span><span class="p">(</span><span class="n">see</span><span class="w"> </span><span class="n">APPENDIX</span><span class="w"> </span><span class="n">E</span><span class="p">)</span>
</pre></div>

<p>Methods 1 to 7 are historical and are not in use. Methods 9 through 98 are
relatively recent additions and are in varying, small amounts of use. The only
method in truly widespread use in the ZIP format is method 8, Deflate, and to
some smaller extent method 0, which is no compression at all. Virtually every
<code>.zip</code> file that you will come across in the wild will use exclusively methods
8 and 0, likely just method 8. (Method 8 also has a means to effectively store
the data with no compression and relatively little expansion, and Method 0
cannot be streamed whereas Method 8 can be.)</p>
<p>The ISO/IEC 21320-1:2015 standard for file containers is a restricted zip
format, such as used in Java archive files (.jar), Office Open XML files
(Microsoft Office .docx, .xlsx, .pptx), Office Document Format files (.odt,
.ods, .odp), and EPUB files (.epub). That standard limits the compression
methods to 0 and 8, as well as other constraints such as no encryption or
signatures.</p>
<p>Around 1990, the Info-ZIP group wrote portable, free, open-source
implementations of <code>zip</code> and <code>unzip</code> utilities, supporting compression with
the Deflate format, and decompression of that and the earlier formats. This
greatly expanded the use of the <code>.zip</code> format.</p>
<p>In the early '90s, the gzip format was developed as a replacement for the Unix
<code>compress</code> utility, derived from the Deflate code in the Info-ZIP utilities.
Unix <code>compress</code> was designed to compress a single file or stream, appending a
<code>.Z</code> to the file name. <code>compress</code> uses the LZW compression algorithm, which at
the time was under patent and its free use was in dispute by the patent
holders. Though some specific implementations of Deflate were patented by Phil
Katz, the format was not, and so it was possible to write a Deflate
implementation that did not infringe on any patents. That implementation has
not been so challenged in the last 20+ years. The Unix <code>gzip</code> utility was
intended as a drop-in replacement for <code>compress</code>, and in fact is able to
decompress <code>compress</code>-compressed data (assuming that you were able to parse
that sentence). <code>gzip</code> appends a <code>.gz</code> to the file name. <code>gzip</code> uses the
Deflate compressed data format, which compresses quite a bit better than Unix
<code>compress</code>, has very fast decompression, and adds a CRC-32 as an integrity
check for the data. The header format also permits the storage of more
information than the <code>compress</code> format allowed, such as the original file name
and the file modification time.</p>
<p>Though <code>compress</code> only compresses a single file, it was common to use the
<code>tar</code> utility to create an archive of files, their attributes, and their
directory structure into a single <code>.tar</code> file, and then compress it with
<code>compress</code> to make a <code>.tar.Z</code> file. In fact, the <code>tar</code> utility had and still
has the option to do the compression at the same time, instead of having to
pipe the output of <code>tar</code> to <code>compress</code>. This all carried forward to the gzip
format, and <code>tar</code> has an option to compress directly to the <code>.tar.gz</code> format.
The <code>tar.gz</code> format compresses better than the <code>.zip</code> approach, since the
compression of a <code>.tar</code> can take advantage of redundancy across files,
especially many small files. <code>.tar.gz</code> is the most common archive format in
use on Unix due to its very high portability, but there are more effective
compression methods in use as well, so you will often see <code>.tar.bz2</code> and
<code>.tar.xz</code> archives.</p>
<p>Unlike <code>.tar</code>, <code>.zip</code> has a central directory at the end, which provides a
list of the contents. That and the separate compression provides random access
to the individual entries in a <code>.zip</code> file. A <code>.tar</code> file would have to be
decompressed and scanned from start to end in order to build a directory,
which is how a <code>.tar</code> file is listed.</p>
<p>Shortly after the introduction of gzip, around the mid-1990s, the same patent
dispute called into question the free use of the <code>.gif</code> image format, very
widely used on bulletin boards and the World Wide Web (a new thing at the
time). So a small group created the PNG losslessly compressed image format,
with file type <code>.png</code>, to replace <code>.gif</code>. That format also uses the Deflate
format for compression, which is applied after filters on the image data
expose more of the redundancy. In order to promote widespread usage of the PNG
format, two free code libraries were created. libpng and zlib. libpng handled
all of the features of the PNG format, and zlib provided the compression and
decompression code for use by libpng, as well as for other applications. zlib
was adapted from the <code>gzip</code> code.</p>
<p>All of the mentioned patents have since expired.</p>
<p>The zlib library supports Deflate compression and decompression, and three
kinds of wrapping around the deflate streams. Those are no wrapping at all
("raw" deflate), zlib wrapping, which is used in the PNG format data blocks,
and gzip wrapping, to provide gzip routines for the programmer. The main
difference between zlib and gzip wrapping is that the zlib wrapping is more
compact, six bytes vs. a minimum of 18 bytes for gzip, and the integrity
check, Adler-32, runs faster than the CRC-32 that gzip uses. Raw deflate is
used by programs that read and write the <code>.zip</code> format, which is another
format that wraps around deflate compressed data.</p>
<p>zlib is now in wide use for data transmission and storage. For example, most
HTTP transactions by servers and browsers compress and decompress the data
using zlib, specifically HTTP header <code>Content-Encoding: deflate</code> means deflate
compression method wrapped inside the zlib data format.</p>
<p>Different implementations of deflate can result in different compressed output
for the same input data, as evidenced by the existence of selectable
compression levels that allow trading off compression effectiveness for CPU
time. zlib and PKZIP are not the only implementations of deflate compression
and decompression. Both the 7-Zip archiving utility and Google's zopfli
library have the ability to use much more CPU time than zlib in order to
squeeze out the last few bits possible when using the deflate format, reducing
compressed sizes by a few percent as compared to zlib's highest compression
level. The pigz utility, a parallel implementation of gzip, includes the
option to use zlib (compression levels 1-9) or zopfli (compression level 11),
and somewhat mitigates the time impact of using zopfli by splitting the
compression of large files over multiple processors and cores.</p>
<p><br></p>
<h3>Suggest</h3>
<p>ZIP is a file format used for storing an arbitrary number of files and folders
together with lossless compression. It makes no strict assumptions about the
compression methods used, but is most frequently used with DEFLATE.</p>
<p>Gzip is both a compression algorithm based on DEFLATE but less encumbered with
potential patents et al, and a file format for storing a single compressed
file. It supports compressing an arbitrary number of files and folders when
combined with tar. The resulting file has an extension of <code>.tgz</code> or <code>.tar.gz</code>
and is commonly called a <em>tarball</em>.</p>
<p>zlib is a library of functions encapsulating DEFLATE in its most common LZ77
incarnation.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-expire-a-php-session-after-30-minutes/" class="u-url">How do I expire a PHP session after 30 minutes?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-expire-a-php-session-after-30-minutes/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:03:13+08:00" itemprop="datePublished" title="2023-02-17 05:03">2023-02-17 05:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I need to keep a session alive for 30 minutes and then destroy it.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You should implement a session timeout of your own. Both options mentioned by
others ( <em>session.gc_maxlifetime</em> and <em>session.cookie_lifetime</em> ) are not
reliable. I'll explain the reasons for that.</p>
<p><strong>First:</strong></p>
<blockquote>
<p><strong>session.gc_maxlifetime</strong><br><em>session.gc_maxlifetime</em> specifies the number of seconds after which data
will be seen as 'garbage' and cleaned up. Garbage collection occurs during
session start.</p>
</blockquote>
<p>But the garbage collector is only started with a probability of
<em>session.gc_probability</em> divided by <em>session.gc_divisor</em>. And using the
default values for those options (1 and 100 respectively), the chance is only
at 1%.</p>
<p>Well, you could simply adjust these values so that the garbage collector is
started more often. But when the garbage collector is started, it will check
the validity for every registered session. And that is cost-intensive.</p>
<p>Furthermore, when using PHP's default <em>session.save_handler</em> files, the
session data is stored in files in a path specified in <em>session.save_path</em>.
With that session handler, the age of the session data is calculated on the
file's last modification date and not the last access date:</p>
<blockquote>
<p><strong>Note:</strong> If you are using the default file-based session handler, your
filesystem must keep track of access times (atime). Windows FAT does not so
you will have to come up with another way to handle garbage collecting your
session if you are stuck with a FAT filesystem or any other filesystem where
atime tracking is not available. Since PHP 4.2.3 it has used mtime (modified
date) instead of atime. So, you won't have problems with filesystems where
atime tracking is not available.</p>
</blockquote>
<p>So it additionally might occur that a session data file is deleted while the
session itself is still considered as valid because the session data was not
updated recently.</p>
<p><strong>And second:</strong></p>
<blockquote>
<p><strong>session.cookie_lifetime</strong><br><em>session.cookie_lifetime</em> specifies the lifetime of the cookie in seconds
which is sent to the browser. […]</p>
</blockquote>
<p>Yes, that's right. This only affects the cookie lifetime and the session
itself may still be valid. But it's the server's task to invalidate a session,
not the client. So this doesn't help anything. In fact, having
<em>session.cookie_lifetime</em> set to <code>0</code> would make the session’s cookie a real
session cookie that is only valid until the browser is closed.</p>
<p><strong>Conclusion / best solution:</strong></p>
<p>The best solution is to implement a session timeout of your own. Use a simple
time stamp that denotes the time of the last activity (i.e. request) and
update it with every request:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isset</span><span class="p">(</span><span class="o">$</span><span class="n">_SESSION</span><span class="p">[</span><span class="s1">'LAST_ACTIVITY'</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">$</span><span class="n">_SESSION</span><span class="p">[</span><span class="s1">'LAST_ACTIVITY'</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1800</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="n">minutes</span><span class="w"> </span><span class="n">ago</span>
<span class="w">    </span><span class="n">session_unset</span><span class="p">();</span><span class="w">     </span><span class="o">//</span><span class="w"> </span><span class="n">unset</span><span class="w"> </span><span class="o">$</span><span class="n">_SESSION</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">run</span><span class="o">-</span><span class="n">time</span><span class="w"> </span>
<span class="w">    </span><span class="n">session_destroy</span><span class="p">();</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">destroy</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">storage</span>
<span class="p">}</span>
<span class="o">$</span><span class="n">_SESSION</span><span class="p">[</span><span class="s1">'LAST_ACTIVITY'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">activity</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">stamp</span>
</pre></div>

<p>Updating the session data with every request also changes the session file's
modification date so that the session is not removed by the garbage collector
prematurely.</p>
<p>You can also use an additional time stamp to regenerate the session ID
periodically to avoid attacks on sessions like session fixation:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isset</span><span class="p">(</span><span class="n">$_SESSION</span><span class="p">['</span><span class="n">CREATED</span><span class="p">']))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">$_SESSION</span><span class="p">['</span><span class="n">CREATED</span><span class="p">']</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">time</span><span class="p">();</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">$_SESSION</span><span class="p">['</span><span class="n">CREATED</span><span class="p">']</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mh">1800</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// session started more than 30 minutes ago</span>
<span class="w">    </span><span class="n">session_regenerate_id</span><span class="p">(</span><span class="n">true</span><span class="p">);</span><span class="w">    </span><span class="c1">// change session ID for the current session and invalidate old session ID</span>
<span class="w">    </span><span class="n">$_SESSION</span><span class="p">['</span><span class="n">CREATED</span><span class="p">']</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">time</span><span class="p">();</span><span class="w">  </span><span class="c1">// update creation time</span>
<span class="p">}</span>
</pre></div>

<p><strong>Notes:</strong></p>
<ul>
<li>
<code>session.gc_maxlifetime</code> should be at least equal to the lifetime of this custom expiration handler (1800 in this example);</li>
<li>if you want to expire the session after 30 minutes of <em>activity</em> instead of after 30 minutes <em>since start</em> , you'll also need to use <code>setcookie</code> with an expire of <code>time()+60*30</code> to keep the session cookie active.</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<h3>Simple way of PHP session expiry in 30 minutes.</h3>
<p>Note : if you want to change the time, just change the 30 with your desired
time and do not change * 60: this will gives the minutes.</p>
<hr>
<p>In minutes : (30 * 60)<br>
In days : (n * 24 * 60 * 60 ) n = no of days  </p>
<hr>
<h3>Login.php</h3>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
    <span class="nb">session_start</span><span class="p">();</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;html&gt;</span>
<span class="w">    </span><span class="nt">&lt;form</span><span class="w"> </span><span class="na">name=</span><span class="s">"form1"</span><span class="w"> </span><span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;table&gt;</span>
<span class="w">            </span><span class="nt">&lt;tr&gt;</span>
<span class="w">                </span><span class="nt">&lt;td&gt;</span>Username<span class="nt">&lt;/td&gt;</span>
<span class="w">                </span><span class="nt">&lt;td&gt;&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"text"</span><span class="w"> </span><span class="na">name=</span><span class="s">"text"</span><span class="nt">&gt;&lt;/td&gt;</span>
<span class="w">            </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">            </span><span class="nt">&lt;tr&gt;</span>
<span class="w">                </span><span class="nt">&lt;td&gt;</span>Password<span class="nt">&lt;/td&gt;</span>
<span class="w">                </span><span class="nt">&lt;td&gt;&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"password"</span><span class="w"> </span><span class="na">name=</span><span class="s">"pwd"</span><span class="nt">&gt;&lt;/td&gt;</span>
<span class="w">            </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">            </span><span class="nt">&lt;tr&gt;</span>
<span class="w">                </span><span class="nt">&lt;td&gt;&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"submit"</span><span class="w"> </span><span class="na">value=</span><span class="s">"SignIn"</span><span class="w"> </span><span class="na">name=</span><span class="s">"submit"</span><span class="nt">&gt;&lt;/td&gt;</span>
<span class="w">            </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">        </span><span class="nt">&lt;/table&gt;</span>
<span class="w">    </span><span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/html&gt;</span>

<span class="cp">&lt;?php</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'submit'</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$v1</span> <span class="o">=</span> <span class="s2">"FirstUser"</span><span class="p">;</span>
        <span class="nv">$v2</span> <span class="o">=</span> <span class="s2">"MyPassword"</span><span class="p">;</span>
        <span class="nv">$v3</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'text'</span><span class="p">];</span>
        <span class="nv">$v4</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'pwd'</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$v1</span> <span class="o">==</span> <span class="nv">$v3</span> <span class="o">&amp;&amp;</span> <span class="nv">$v2</span> <span class="o">==</span> <span class="nv">$v4</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'luser'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$v1</span><span class="p">;</span>
            <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'start'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span> <span class="c1">// Taking now logged in time.</span>
            <span class="c1">// Ending a session in 30 minutes from the starting time.</span>
            <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'expire'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'start'</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span><span class="p">);</span>
            <span class="nb">header</span><span class="p">(</span><span class="s1">'Location: http://localhost/somefolder/homepage.php'</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">"Please enter the username or password again!"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span>
</pre></div>

<h3>HomePage.php</h3>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
    <span class="nb">session_start</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'luser'</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"Please Login again"</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s2">"&lt;a href='http://localhost/somefolder/login.php'&gt;Click Here to Login&lt;/a&gt;"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$now</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span> <span class="c1">// Checking the time now when home page starts.</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$now</span> <span class="o">&gt;</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'expire'</span><span class="p">])</span> <span class="p">{</span>
            <span class="nb">session_destroy</span><span class="p">();</span>
            <span class="k">echo</span> <span class="s2">"Your session has expired! &lt;a href='http://localhost/somefolder/login.php'&gt;Login here&lt;/a&gt;"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span> <span class="c1">//Starting this else one [else1]</span>
<span class="cp">?&gt;</span>
<span class="w">            </span><span class="cm">&lt;!-- From here all HTML coding can be done --&gt;</span>
<span class="w">            </span><span class="nt">&lt;html&gt;</span>
<span class="w">                </span>Welcome
<span class="w">                </span><span class="cp">&lt;?php</span>
                    <span class="k">echo</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'luser'</span><span class="p">];</span>
                    <span class="k">echo</span> <span class="s2">"&lt;a href='http://localhost/somefolder/logout.php'&gt;Log out&lt;/a&gt;"</span><span class="p">;</span>
                <span class="cp">?&gt;</span>
<span class="w">            </span><span class="nt">&lt;/html&gt;</span>
<span class="cp">&lt;?php</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span>
</pre></div>

<h3>LogOut.php</h3>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
    <span class="nb">session_start</span><span class="p">();</span>
    <span class="nb">session_destroy</span><span class="p">();</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">'Location: http://localhost/somefolder/login.php'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-369.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-367.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
