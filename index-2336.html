<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2336) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2336.html">
<link rel="prev" href="index-2337.html" type="text/html">
<link rel="next" href="index-2335.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-a-span-and-when-should-i-use-one/" class="u-url">What is a "span" and when should I use one?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-a-span-and-when-should-i-use-one/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T08:37:02+08:00" itemprop="datePublished" title="2023-03-04 08:37">2023-03-04 08:37</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Recently I've gotten suggestions to use <code>span&lt;T&gt;</code>'s in my code, or have seen
some answers here on the site which use <code>span</code>'s - supposedly some kind of
container. But - I can't find anything like that in the C++17 standard
library.</p>
<p>So what is this mysterious <code>span&lt;T&gt;</code>, and why (or when) is it a good idea to
use it if it's non-standard?</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>What is it?</h3>
<p>A <code>span&lt;T&gt;</code> is:</p>
<ul>
<li>A very lightweight abstraction of a contiguous sequence of values of type <code>T</code> somewhere in memory.</li>
<li>Basically a <code>struct { T * ptr; std::size_t length; }</code> with a bunch of convenience methods.</li>
<li>A non-owning type (i.e. a "reference-type" rather than a "value type"): It never allocates nor deallocates anything and does not keep smart pointers alive.</li>
</ul>
<p>It was formerly known as an <code>array_view</code> and even earlier as <code>array_ref</code>.</p>
<h3>When should I use it?</h3>
<p>First, when <em>not</em> to use spans:</p>
<ul>
<li>Don't use a span in code that could just take any pair of start &amp; end iterators (like <code>std::sort</code>, <code>std::find_if</code>, <code>std::copy</code> and other templated functions from <code>&lt;algorithm&gt;</code>), and also not in code that takes an arbitrary range (see The C++20 ranges library for information about those). A span has stricter requirements than a pair of iterators or a range: element contiguity and presence of the elements in memory.</li>
<li>Don't use a span if you have a standard library container (or a Boost container etc.) which you know is the right fit for your code. spans are not intended to supplant existing containers.</li>
</ul>
<p>Now for when to actually use a span:</p>
<blockquote>
<p>Use <code>span&lt;T&gt;</code> (respectively, <code>span&lt;const T&gt;</code>) instead of a free-standing
<code>T*</code> (respectively <code>const T*</code>) when the allocated length or size also
matter. So, replace functions like:</p>
<div class="code"><pre class="code literal-block">void read_into(int* buffer, size_t buffer_size);
</pre></div>

<p>with:</p>
<div class="code"><pre class="code literal-block">void read_into(span&lt;int&gt; buffer);
</pre></div>

</blockquote>
<h3>Why should I use it? Why is it a good thing?</h3>
<p>Oh, spans are awesome! Using a span...</p>
<ul>
<li>
<p>means that you can work with that pointer+length / start+end pointer combination like you would with a fancy, pimped-out standard library container, e.g.:</p>
<ul>
<li><code>for (auto&amp; x : my_span) { /* do stuff */ }</code></li>
<li><code>std::find_if(my_span.cbegin(), my_span.cend(), some_predicate);</code></li>
<li>
<code>std::ranges::find_if(my_span, some_predicate);</code> (in C++20)   </li>
</ul>
</li>
</ul>
<p>... but with absolutely none of the overhead most container classes incur.</p>
<ul>
<li>lets the compiler do more work for you sometimes. For example, this:<div class="code"><pre class="code literal-block"><span class="nc">int</span><span class="w"> </span><span class="n">buffer</span><span class="o">[</span><span class="n">BUFFER_SIZE</span><span class="o">]</span><span class="p">;</span>
</pre></div>

<p>read_into(buffer, BUFFER_SIZE);</p>
</li>
</ul>
<p>becomes this:</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">buffer</span><span class="o">[</span><span class="n">BUFFER_SIZE</span><span class="o">]</span><span class="p">;</span>
<span class="n">read_into</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
</pre></div>

<p>... which will do what you would want it to do. See also Guideline P.5.</p>
<ul>
<li>
<p>is the reasonable alternative to passing <code>const vector&lt;T&gt;&amp;</code> to functions when you expect your data to be contiguous in memory. No more getting scolded by high-and-mighty C++ gurus!</p>
</li>
<li>
<p>facilitates static analysis, so the compiler might be able to help you catch silly bugs.</p>
</li>
<li>
<p>allows for debug-compilation instrumentation for runtime bounds-checking (i.e. <code>span</code>'s methods will have some bounds-checking code within <code>#ifndef NDEBUG</code> ... <code>#endif</code>)</p>
</li>
<li>
<p>indicates that your code (that's using the span) doesn't own the pointed-to memory.</p>
</li>
</ul>
<p>There's even more motivation for using <code>span</code>s, which you could find in the
C++ core guidelines - but you catch the drift.</p>
<h3>But is it in the standard library?</h3>
<p><strong>edit:</strong> Yes, <code>std::span</code> was added to C++ with the C++20 version of the
language!</p>
<p>Why only in C++20? Well, While the idea is not new - its current form was
conceived in conjunction with the C++ core guidelines project, which only
started taking shape in 2015. So it took a while.</p>
<h3>So how do I use it if I'm writing C++17 or earlier?</h3>
<p>It's part of the Core Guidelines's Support Library (GSL). Implementations:</p>
<ul>
<li>Microsoft / Neil Macintosh's GSL contains a standalone implementation: <code>gsl/span</code>
</li>
<li>GSL-Lite is a single-header implementation of the whole GSL (it's not that big, don't worry), including <code>span&lt;T&gt;</code>.</li>
</ul>
<p>The GSL implementation does generally assume a platform that implements C++14
support [12]. These alternative single-header implementations do not depend on
GSL facilities:</p>
<ul>
<li>
<code>martinmoene/span-lite</code> requires C++98 or later</li>
<li>
<code>tcbrindle/span</code> requires C++11 or later</li>
</ul>
<p>Note that these different span implementations have some differences in what
methods/support functions they come with; and they may also differ somewhat
from the version adopted into the standard library in C++20.</p>
<hr>
<p><strong>Further reading:</strong> You can find all the details and design considerations in
the final official proposal before C++17, P0122R7: span: bounds-safe views for
sequences of objects by Neal Macintosh and Stephan J. Lavavej. It's a bit long
though. Also, in C++20, the span comparison semantics changed (following this
short paper by Tony van Eerd).</p>
<p><br></p>
<h3>Suggest</h3>
<p>A <code>span&lt;T&gt;</code> is this:</p>
<div class="code"><pre class="code literal-block"><span class="n">template</span><span class="w"> </span><span class="o">&lt;</span><span class="n">typename</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span>
<span class="n">struct</span><span class="w"> </span><span class="n">span</span>
<span class="err">{</span>
<span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ptr_to_array</span><span class="p">;</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">pointer</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">contiguous</span><span class="w"> </span><span class="n">C</span><span class="o">-</span><span class="n">style</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span>
<span class="w">                        </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="n">which</span><span class="w"> </span><span class="k">memory</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">allocated</span><span class="w"> </span><span class="n">nor</span><span class="w"> </span><span class="n">deallocated</span><span class="w"> </span>
<span class="w">                        </span><span class="o">//</span><span class="w"> </span><span class="n">nor</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">any</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="n">managed</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">span</span><span class="p">)</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span><span class="w"> </span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="n n-Quoted">`T`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">array</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Plus</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">bunch</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">constructors</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">convenience</span><span class="w"> </span><span class="n">accessor</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">here</span>
<span class="err">}</span>
</pre></div>

<p>It is a light-weight wrapper around a C-style array, preferred by C++
developers whenever they are using C libraries and want to wrap them with a
C++-style data container for "type safety" and "C++-ishness" and
"feelgoodery". :)</p>
<p><em>Note: I call the struct container defined above, known as a span, a "light-
weight wrapper around a C-style array" because it points to a contiguous piece
of memory, such as a C-style array, and wraps it with accessor methods and the
array's size. This is what I mean by "light-weight wrapper": it is a wrapper
around a pointer and a length variable, plus functions.</em></p>
<p><em>Unlike a<code>std::vector&lt;&gt;</code> and other C++ standard containers, however, which may
also just have fixed class sizes and contain pointers which point to their
storage memory, a span does not own the memory it points to, and will never
delete it nor resize it nor allocate new memory automatically. Again, a
container like a vector owns the memory it points to, and will manage
(allocate, reallocate, etc.) it, but a span does not own the memory it points
to, and therefore will not manage it.</em></p>
<hr>
<h3>Going further:</h3>
<p>@einpoklum does a pretty good job of introducing what a <code>span</code> is in his
answer here. However, <em>even after reading his answer,</em> it is easy for someone
new to spans to still have a sequence of stream-of-thought questions which
aren't fully answered, such as the following:</p>
<ol>
<li>How is a <code>span</code> different from a C array? Why not just use one of those? It seems like it's just one of those with the size known as well...</li>
<li>Wait, that sounds like a <code>std::array</code>, how is a <code>span</code> different from that?</li>
<li>Oh, that reminds me, isn't a <code>std::vector</code> like a <code>std::array</code> too?</li>
<li>I'm so confused. :( What's a <code>span</code>?</li>
</ol>
<p>So, here's some additional clarity on that:</p>
<p>DIRECT QUOTE OF HIS ANSWER--WITH <strong><em>MY ADDITIONS</em> and parenthetical comments
IN BOLD</strong> and <em>my emphasis in italics</em> :</p>
<blockquote>
<h3>What is it?</h3>
<p>A <code>span&lt;T&gt;</code> is:</p>
<ul>
<li>A very lightweight abstraction of a <em>contiguous sequence of values</em> of
type <code>T</code> somewhere in memory.</li>
<li>Basically a <strong>single</strong> struct <code>{ T * ptr; std::size_t length; }</code> with a
bunch of convenience methods. <strong>(Notice this is distinctly different
from<code>std::array&lt;&gt;</code> because a <code>span</code> enables convenience accessor methods,
comparable to <code>std::array</code>, via a <em>pointer to type<code>T</code></em> and length (number of
elements) of type <code>T</code>, whereas <code>std::array</code> is an actual container which
holds one or more <em>values</em> of type <code>T</code>.)</strong>
</li>
<li>A <em>non-owning type</em> (i.e. a "reference-type" rather than a "value
type"): It <em>never allocates nor deallocates anything</em> and does not keep
smart pointers alive.
</li>
</ul>
<p>It was formerly known as an <code>array_view</code> and even earlier as <code>array_ref</code>.</p>
</blockquote>
<p>Those bold parts are <em>critical</em> to one's understanding, so don't miss them or
misread them! A <code>span</code> is NOT a C-array of structs, nor is it a struct of a
C-array of type <code>T</code> plus the length of the array (this would be essentially
what the <code>std::array</code> <em>container</em> is), NOR is it a C-array of structs of
pointers to type <code>T</code> plus the length, but rather it is a <strong>single</strong> struct
containing one single <strong>pointer to type<code>T</code></strong>, and the <strong>length</strong> , which is
the <strong>number of elements (of type<code>T</code>) in the contiguous memory block that the
pointer to type <code>T</code> points to!</strong> In this way, the only overhead you've added
by using a <code>span</code> are the variables to store the pointer and length, and any
convenience accessor functions you use which the <code>span</code> provides.</p>
<p>This is UNLIKE a <code>std::array&lt;&gt;</code> because the <code>std::array&lt;&gt;</code> actually allocates
memory for the entire contiguous block, and it is UNLIKE <code>std::vector&lt;&gt;</code>
because a <code>std::vector</code> is basically just a <code>std::array</code> that also does
<em>dynamic growing</em> (usually doubling in size) each time it fills up and you try
to add something else to it. A <code>std::array</code> is fixed in size, and <em>a
<strong><code>span</code></strong> doesn't even manage the memory of the block it points to, it just
points to the block of memory, knows how long the block of memory is, knows
what data type is in a C-array in the memory, and provides convenience
accessor functions to work with the elements in that contiguous memory</em>.</p>
<h3>It <em>is</em> part of the C++ standard:</h3>
<p><code>std::span</code> is part of the C++ standard as of C++20. You can read its
documentation here: https://en.cppreference.com/w/cpp/container/span. To see
how to use Google's <code>absl::Span&lt;T&gt;(array, length)</code> in C++11 or later <em>today</em> ,
see below.</p>
<h3>Summary Descriptions, and Key References:</h3>
<ol>
<li>
<code>std::span&lt;T, Extent&gt;</code> (<code>Extent</code> = "the number of elements in the sequence, or <code>std::dynamic_extent</code> if dynamic". A span just <em>points to</em> memory and makes it easy to access, but does NOT manage it!):</li>
<li>https://en.cppreference.com/w/cpp/container/span</li>
<li>
<code>std::array&lt;T, N&gt;</code> (notice it has a <em>fixed</em> size <code>N</code>!):</li>
<li>https://en.cppreference.com/w/cpp/container/array</li>
<li>http://www.cplusplus.com/reference/array/array/</li>
<li>
<code>std::vector&lt;T&gt;</code> (automatically dynamically grows in size as necessary):</li>
<li>https://en.cppreference.com/w/cpp/container/vector</li>
<li>http://www.cplusplus.com/reference/vector/vector/</li>
</ol>
<h3>How Can I Use <code>span</code> in C++11 or later <em>today</em>?</h3>
<p>Google has open-sourced their internal C++11 libraries in the form of their
"Abseil" library. This library is intended to provide C++14 to C++20 and
beyond features which work in C++11 and later, so that you can use tomorrow's
features, today. They say:</p>
<blockquote>
<p><strong>Compatibility with the C++ Standard</strong></p>
<p>Google has developed many abstractions that either match or closely match
features incorporated into C++14, C++17, and beyond. Using the Abseil
versions of these abstractions allows you to access these features now, even
if your code is not yet ready for life in a post C++11 world.</p>
</blockquote>
<h3>Here are some key resources and links:</h3>
<ol>
<li>Main site: https://abseil.io/</li>
<li>https://abseil.io/docs/cpp/</li>
<li>GitHub repository: https://github.com/abseil/abseil-cpp</li>
<li>
<code>span.h</code> header, and <code>absl::Span&lt;T&gt;(array, length)</code> template class: https://github.com/abseil/abseil-cpp/blob/master/absl/types/span.h#L153</li>
</ol>
<h3>Other references:</h3>
<ol>
<li>Struct with template variables in C++</li>
<li>Wikipedia: C++ classes</li>
<li>default visibility of C++ class/struct members</li>
</ol>
<h3>Related:</h3>
<ol>
<li>[another one of my answers on templates and spans] How to make span of spans</li>
</ol>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-set-environment-variables-from-java/" class="u-url">How do I set environment variables from Java?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-set-environment-variables-from-java/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T08:35:26+08:00" itemprop="datePublished" title="2023-03-04 08:35">2023-03-04 08:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I set environment variables from Java? I see that I can do this for
subprocesses using <code>ProcessBuilder</code>. I have several subprocesses to start,
though, so I'd rather modify the current process's environment and let the
subprocesses inherit it.</p>
<p>There's a <code>System.getenv(String)</code> for getting a single environment variable. I
can also get a <code>Map</code> of the complete set of environment variables with
<code>System.getenv()</code>. But, calling <code>put()</code> on that <code>Map</code> throws an
<code>UnsupportedOperationException</code> -- apparently they mean for the environment
to be read only. And, there's no <code>System.setenv()</code>.</p>
<p>So, is there any way to set environment variables in the currently running
process? If so, how? If not, what's the rationale? (Is it because this is Java
and therefore I shouldn't be doing evil nonportable obsolete things like
touching my environment?) And if not, any good suggestions for managing the
environment variable changes that I'm going to need to be feeding to several
subprocesses?</p>
<p><br><br></p>
<h2>Answer</h2>
<blockquote>
<p>(Is it because this is Java and therefore I shouldn't be doing evil
nonportable obsolete things like touching my environment?)</p>
</blockquote>
<p>I think you've hit the nail on the head.</p>
<p>A possible way to ease the burden would be to factor out a method</p>
<div class="code"><pre class="code literal-block">void setUpEnvironment(ProcessBuilder builder) {
    Map&lt;String, String&gt; env = builder.environment();
    // blah blah
}
</pre></div>

<p>and pass any <code>ProcessBuilder</code>s through it before starting them.</p>
<p>Also, you probably already know this, but you can start more than one process
with the same <code>ProcessBuilder</code>. So if your subprocesses are the same, you
don't need to do this setup over and over.</p>
<p><br></p>
<h3>Suggest</h3>
<blockquote>
<p>(Is it because this is Java and therefore I shouldn't be doing evil
nonportable obsolete things like touching my environment?)</p>
</blockquote>
<p>I think you've hit the nail on the head.</p>
<p>A possible way to ease the burden would be to factor out a method</p>
<div class="code"><pre class="code literal-block">void setUpEnvironment(ProcessBuilder builder) {
    Map&lt;String, String&gt; env = builder.environment();
    // blah blah
}
</pre></div>

<p>and pass any <code>ProcessBuilder</code>s through it before starting them.</p>
<p>Also, you probably already know this, but you can start more than one process
with the same <code>ProcessBuilder</code>. So if your subprocesses are the same, you
don't need to do this setup over and over.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/alarm-manager-example/" class="u-url">Alarm Manager Example</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/alarm-manager-example/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T08:33:38+08:00" itemprop="datePublished" title="2023-03-04 08:33">2023-03-04 08:33</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to implement a schedule function in my project. So I Googled for an
Alarm manager program but I can`t find any examples.</p>
<p>Can anyone help me with a basic alarm manager program?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>This is working code. It wakes CPU every 10 minutes until the phone turns
off.</strong></p>
<p>Add to Manifest.xml:</p>
<div class="code"><pre class="code literal-block">...
<span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.permission.WAKE_LOCK"</span><span class="nt">&gt;&lt;/uses-permission&gt;</span>
...
<span class="nt">&lt;receiver</span><span class="w"> </span><span class="na">android:process=</span><span class="s">":remote"</span><span class="w"> </span><span class="na">android:name=</span><span class="s">".Alarm"</span><span class="nt">&gt;&lt;/receiver&gt;</span>
...
</pre></div>

<p>Code in your class:</p>
<div class="code"><pre class="code literal-block"><span class="n">package</span> <span class="n">yourPackage</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.app.AlarmManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.app.PendingIntent</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.BroadcastReceiver</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.os.PowerManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.widget.Toast</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">Alarm</span> <span class="n">extends</span> <span class="n">BroadcastReceiver</span> 
<span class="p">{</span>    
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">onReceive</span><span class="p">(</span><span class="n">Context</span> <span class="n">context</span><span class="p">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> 
    <span class="p">{</span>   
        <span class="n">PowerManager</span> <span class="n">pm</span> <span class="o">=</span> <span class="p">(</span><span class="n">PowerManager</span><span class="p">)</span> <span class="n">context</span><span class="o">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="o">.</span><span class="n">POWER_SERVICE</span><span class="p">);</span>
        <span class="n">PowerManager</span><span class="o">.</span><span class="n">WakeLock</span> <span class="n">wl</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">newWakeLock</span><span class="p">(</span><span class="n">PowerManager</span><span class="o">.</span><span class="n">PARTIAL_WAKE_LOCK</span><span class="p">,</span> <span class="s2">""</span><span class="p">);</span>
        <span class="n">wl</span><span class="o">.</span><span class="n">acquire</span><span class="p">();</span>

        <span class="o">//</span> <span class="n">Put</span> <span class="n">here</span> <span class="n">YOUR</span> <span class="n">code</span><span class="o">.</span>
        <span class="n">Toast</span><span class="o">.</span><span class="n">makeText</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="s2">"Alarm !!!!!!!!!!"</span><span class="p">,</span> <span class="n">Toast</span><span class="o">.</span><span class="n">LENGTH_LONG</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> <span class="o">//</span> <span class="n">For</span> <span class="n">example</span>

        <span class="n">wl</span><span class="o">.</span><span class="n">release</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">setAlarm</span><span class="p">(</span><span class="n">Context</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">AlarmManager</span> <span class="n">am</span> <span class="o">=</span><span class="p">(</span> <span class="n">AlarmManager</span><span class="p">)</span><span class="n">context</span><span class="o">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="o">.</span><span class="n">ALARM_SERVICE</span><span class="p">);</span>
        <span class="n">Intent</span> <span class="n">i</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Intent</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">Alarm</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>
        <span class="n">PendingIntent</span> <span class="n">pi</span> <span class="o">=</span> <span class="n">PendingIntent</span><span class="o">.</span><span class="n">getBroadcast</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">am</span><span class="o">.</span><span class="n">setRepeating</span><span class="p">(</span><span class="n">AlarmManager</span><span class="o">.</span><span class="n">RTC_WAKEUP</span><span class="p">,</span> <span class="n">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="p">(),</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="n">pi</span><span class="p">);</span> <span class="o">//</span> <span class="n">Millisec</span> <span class="o">*</span> <span class="n">Second</span> <span class="o">*</span> <span class="n">Minute</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">cancelAlarm</span><span class="p">(</span><span class="n">Context</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Intent</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">Alarm</span><span class="o">.</span><span class="n">class</span><span class="p">);</span>
        <span class="n">PendingIntent</span> <span class="n">sender</span> <span class="o">=</span> <span class="n">PendingIntent</span><span class="o">.</span><span class="n">getBroadcast</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">intent</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">AlarmManager</span> <span class="n">alarmManager</span> <span class="o">=</span> <span class="p">(</span><span class="n">AlarmManager</span><span class="p">)</span> <span class="n">context</span><span class="o">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="o">.</span><span class="n">ALARM_SERVICE</span><span class="p">);</span>
        <span class="n">alarmManager</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><strong>Set Alarm from Service:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">package</span> <span class="n">yourPackage</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">android.app.Service</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.os.IBinder</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">YourService</span> <span class="n">extends</span> <span class="n">Service</span>
<span class="p">{</span>
    <span class="n">Alarm</span> <span class="n">alarm</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Alarm</span><span class="p">();</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">onCreate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">super</span><span class="o">.</span><span class="n">onCreate</span><span class="p">();</span>       
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="nb">int</span> <span class="n">onStartCommand</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">,</span> <span class="nb">int</span> <span class="n">flags</span><span class="p">,</span> <span class="nb">int</span> <span class="n">startId</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="n">alarm</span><span class="o">.</span><span class="n">setAlarm</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">START_STICKY</span><span class="p">;</span>
    <span class="p">}</span>

   <span class="nd">@Override</span>        
   <span class="n">public</span> <span class="n">void</span> <span class="n">onStart</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">,</span> <span class="nb">int</span> <span class="n">startId</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">alarm</span><span class="o">.</span><span class="n">setAlarm</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">IBinder</span> <span class="n">onBind</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><strong>If you want to set alarm repeating at phone boot time:</strong></p>
<p>Add permission and the service to Manifest.xml:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.permission.RECEIVE_BOOT_COMPLETED"</span><span class="nt">&gt;&lt;/uses-permission&gt;</span>
...
<span class="nt">&lt;receiver</span><span class="w"> </span><span class="na">android:name=</span><span class="s">".AutoStart"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;intent-filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.intent.action.BOOT_COMPLETED"</span><span class="nt">&gt;&lt;/action&gt;</span>
<span class="w">    </span><span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/receiver&gt;</span>
...
<span class="nt">&lt;service</span>
<span class="w">        </span><span class="na">android:name=</span><span class="s">".YourService"</span>
<span class="w">        </span><span class="na">android:enabled=</span><span class="s">"true"</span>
<span class="w">        </span><span class="na">android:process=</span><span class="s">":your_service"</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</pre></div>

<p>And create a new class:</p>
<div class="code"><pre class="code literal-block"><span class="n">package</span> <span class="n">yourPackage</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">android.content.BroadcastReceiver</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Intent</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">AutoStart</span> <span class="n">extends</span> <span class="n">BroadcastReceiver</span>
<span class="p">{</span>   
    <span class="n">Alarm</span> <span class="n">alarm</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Alarm</span><span class="p">();</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">onReceive</span><span class="p">(</span><span class="n">Context</span> <span class="n">context</span><span class="p">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span>
    <span class="p">{</span>   
        <span class="k">if</span> <span class="p">(</span><span class="n">intent</span><span class="o">.</span><span class="n">getAction</span><span class="p">()</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">Intent</span><span class="o">.</span><span class="n">ACTION_BOOT_COMPLETED</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">alarm</span><span class="o">.</span><span class="n">setAlarm</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I tried the solution from XXX and while it did initially work, at some point
it stopped working. The <code>onReceive</code> never got called again. I spent hours
trying to figure out what it could be. What I came to realize is that the
<code>Intent</code> for whatever mysterious reason was no longer being called. To get
around this, I discovered that you really do need to specify an action for the
receiver in the manifest. Example:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;receiver</span><span class="w"> </span><span class="na">android:name=</span><span class="s">".Alarm"</span><span class="w"> </span><span class="na">android:exported=</span><span class="s">"true"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;intent-filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"mypackage.START_ALARM"</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;/action&gt;</span>
<span class="w">    </span><span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/receiver&gt;</span>
</pre></div>

<p>Note that the name is <code>".Alarm"</code> with the period. In XXX's <code>setAlarm</code> method,
create the <code>Intent</code> as follows:</p>
<div class="code"><pre class="code literal-block">Intent i = new Intent("mypackage.START_ALARM");
</pre></div>

<p>The <code>START_ALARM</code> message can be whatever you want it to be. I just gave it
that name for demonstration purposes.</p>
<p>I have not seen receivers defined in the manifest without an intent filter
that specifies the action. Creating them the way XXX has specified it seems
kind of bogus. By specifying the action name, Android will be forced to create
an instance of the <code>BroadcastReceiver</code> using the class that corresponds to the
action. If you rely upon context, be aware that Android has several different
objects that are ALL called context and may not result in getting your
<code>BroadcastReceiver</code> created. Forcing Android to create an instance of your
class using only the action message is far better than relying upon some iffy
context that may never work.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2337.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2335.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
