<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2685) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2685.html">
<link rel="prev" href="index-2686.html" type="text/html">
<link rel="next" href="index-2684.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/programmatically-set-left-drawable-in-a-textview/" class="u-url">Programmatically set left drawable in a TextView</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/programmatically-set-left-drawable-in-a-textview/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T10:18:22+08:00" itemprop="datePublished" title="2023-03-05 10:18">2023-03-05 10:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a textView in xml here.</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">TextView</span>
<span class="w">        </span><span class="nl">android</span><span class="p">:</span><span class="n">id</span><span class="o">=</span><span class="ss">"@+id/bookTitle"</span>
<span class="w">        </span><span class="nl">android</span><span class="p">:</span><span class="n">layout_width</span><span class="o">=</span><span class="ss">"match_parent"</span>
<span class="w">        </span><span class="nl">android</span><span class="p">:</span><span class="n">layout_height</span><span class="o">=</span><span class="ss">"wrap_content"</span>
<span class="w">        </span><span class="nl">android</span><span class="p">:</span><span class="n">layout_weight</span><span class="o">=</span><span class="ss">"1"</span>
<span class="w">        </span><span class="nl">android</span><span class="p">:</span><span class="n">drawableLeft</span><span class="o">=</span><span class="ss">"@drawable/checkmark"</span>
<span class="w">        </span><span class="nl">android</span><span class="p">:</span><span class="n">gravity</span><span class="o">=</span><span class="ss">"center_vertical"</span>
<span class="w">        </span><span class="nl">android</span><span class="p">:</span><span class="n">textStyle</span><span class="o">=</span><span class="ss">"bold"</span>
<span class="w">        </span><span class="nl">android</span><span class="p">:</span><span class="k">textSize</span><span class="o">=</span><span class="ss">"24dip"</span>
<span class="w">        </span><span class="nl">android</span><span class="p">:</span><span class="n">maxLines</span><span class="o">=</span><span class="ss">"1"</span>
<span class="w">        </span><span class="nl">android</span><span class="p">:</span><span class="n">ellipsize</span><span class="o">=</span><span class="ss">"end"</span><span class="o">/&gt;</span>
</pre></div>

<p>As you can see I set the DrawableLeft in xml.</p>
<p>I would like to change the drawable in code.</p>
<p>Is there anyway to go about doing this? Or setting the drawableLeft in code
for the text view?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can use setCompoundDrawablesWithIntrinsicBounds(int left, int top, int
right, int bottom)</p>
<p>set 0 where you don't want images</p>
<p>Example for Drawable on the left:</p>
<div class="code"><pre class="code literal-block">TextView textView = (TextView) findViewById(R.id.myTxtView);
textView.setCompoundDrawablesWithIntrinsicBounds(R.drawable.icon, 0, 0, 0);
</pre></div>

<p>Alternatively, you can use setCompoundDrawablesRelativeWithIntrinsicBounds to
respect RTL/LTR layouts.</p>
<hr>
<p>Tip: Whenever you know any XML attribute but don't have clue about how to use
it at runtime. just go to the description of that property in developer doc.
There you will find <strong>Related Methods</strong> if it's supported at runtime . i.e.
For DrawableLeft</p>
<p><br></p>
<h3>Suggest</h3>
<h3>Using Kotlin:</h3>
<p>You can create an extension function or just use
<code>setCompoundDrawablesWithIntrinsicBounds</code> directly.</p>
<div class="code"><pre class="code literal-block"><span class="n">fun</span><span class="w"> </span><span class="n">TextView</span><span class="p">.</span><span class="n">leftDrawable</span><span class="p">(</span><span class="nv">@DrawableRes</span><span class="w"> </span><span class="nl">id</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">   </span><span class="n">this</span><span class="p">.</span><span class="n">setCompoundDrawablesWithIntrinsicBounds</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="err">}</span>
</pre></div>

<p>If you need to resize the drawable, you can use this extension function.</p>
<div class="code"><pre class="code literal-block"><span class="n">textView</span><span class="p">.</span><span class="n">leftDrawable</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">my_icon</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">dimen</span><span class="p">.</span><span class="n">icon_size</span><span class="p">)</span>

<span class="n">fun</span><span class="w"> </span><span class="n">TextView</span><span class="p">.</span><span class="n">leftDrawable</span><span class="p">(</span><span class="nv">@DrawableRes</span><span class="w"> </span><span class="nl">id</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">@DimenRes</span><span class="w"> </span><span class="nl">sizeRes</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="n">drawable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContextCompat</span><span class="p">.</span><span class="n">getDrawable</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">)</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resources</span><span class="p">.</span><span class="n">getDimensionPixelSize</span><span class="p">(</span><span class="n">sizeRes</span><span class="p">)</span>
<span class="w">    </span><span class="n">drawable</span><span class="vm">?</span><span class="p">.</span><span class="n">setBounds</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="p">)</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">setCompoundDrawables</span><span class="p">(</span><span class="n">drawable</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="err">}</span>
</pre></div>

<p>To get really fancy, create a wrapper that allows size and/or color
modification.</p>
<div class="code"><pre class="code literal-block"><span class="n">textView</span><span class="p">.</span><span class="n">leftDrawable</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">my_icon</span><span class="p">,</span><span class="w"> </span><span class="n">colorRes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">white</span><span class="p">)</span>

<span class="n">fun</span><span class="w"> </span><span class="n">TextView</span><span class="p">.</span><span class="n">leftDrawable</span><span class="p">(</span><span class="nv">@DrawableRes</span><span class="w"> </span><span class="nl">id</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">@DimenRes</span><span class="w"> </span><span class="nl">sizeRes</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">@ColorInt</span><span class="w"> </span><span class="nl">color</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">@ColorRes</span><span class="w"> </span><span class="nl">colorRes</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="n">drawable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">drawable</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sizeRes</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resources</span><span class="p">.</span><span class="n">getDimensionPixelSize</span><span class="p">(</span><span class="n">sizeRes</span><span class="p">)</span>
<span class="w">        </span><span class="n">drawable</span><span class="vm">?</span><span class="p">.</span><span class="n">setBounds</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="p">)</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">drawable</span><span class="vm">?</span><span class="p">.</span><span class="n">setColorFilter</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="n">PorterDuff</span><span class="p">.</span><span class="n">Mode</span><span class="p">.</span><span class="n">SRC_ATOP</span><span class="p">)</span>
<span class="w">    </span><span class="err">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">colorRes</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="n">colorInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContextCompat</span><span class="p">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">colorRes</span><span class="p">)</span>
<span class="w">        </span><span class="n">drawable</span><span class="vm">?</span><span class="p">.</span><span class="n">setColorFilter</span><span class="p">(</span><span class="n">colorInt</span><span class="p">,</span><span class="w"> </span><span class="n">PorterDuff</span><span class="p">.</span><span class="n">Mode</span><span class="p">.</span><span class="n">SRC_ATOP</span><span class="p">)</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">setCompoundDrawables</span><span class="p">(</span><span class="n">drawable</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="err">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/strip-html-from-strings-in-python/" class="u-url">Strip HTML from strings in Python</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/strip-html-from-strings-in-python/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T10:16:26+08:00" itemprop="datePublished" title="2023-03-05 10:16">2023-03-05 10:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">mechanize</span> <span class="kn">import</span> <span class="n">Browser</span>
<span class="n">br</span> <span class="o">=</span> <span class="n">Browser</span><span class="p">()</span>
<span class="n">br</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'http://somewebpage'</span><span class="p">)</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="n">response</span><span class="p">()</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">html</span><span class="p">:</span>
  <span class="nb">print</span> <span class="n">line</span>
</pre></div>

<p>When printing a line in an HTML file, I'm trying to find a way to only show
the contents of each HTML element and not the formatting itself. If it finds
<code>'&lt;a href="whatever.example"&gt;some text&lt;/a&gt;'</code>, it will only print 'some text',
<code>'&lt;b&gt;hello&lt;/b&gt;'</code> prints 'hello', etc. How would one go about doing this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I always used this function to strip HTML tags, as it requires only the Python
stdlib:</p>
<p>For Python 3:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">html.parser</span> <span class="kn">import</span> <span class="n">HTMLParser</span>

<span class="k">class</span> <span class="nc">MLStripper</span><span class="p">(</span><span class="n">HTMLParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strict</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_charrefs</span><span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">strip_tags</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">MLStripper</span><span class="p">()</span>
    <span class="n">s</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</pre></div>

<p>For Python 2:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">HTMLParser</span> <span class="kn">import</span> <span class="n">HTMLParser</span>
<span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="k">class</span> <span class="nc">MLStripper</span><span class="p">(</span><span class="n">HTMLParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">strip_tags</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">MLStripper</span><span class="p">()</span>
    <span class="n">s</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>If you need to strip HTML tags to do text processing, a simple regular
expression will do. <strong>Do not use this if you are looking to sanitize user-
generated HTML to prevent XSS attacks. It is not a secure way to remove
all<code>&lt;script&gt;</code> tags or tracking <code>&lt;img&gt;</code>s.</strong> The following regular expression
will fairly reliably strip most HTML tags:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">re</span>

<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'&lt;[^&lt;]+?&gt;'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</pre></div>

<p>For those that don't understand regex, this searches for a string <code>&lt;...&gt;</code>,
where the inner content is made of one or more (<code>+</code>) characters that isn't a
<code>&lt;</code>. The <code>?</code> means that it will match the smallest string it can find. For
example given <code>&lt;p&gt;Hello&lt;/p&gt;</code>, it will match <code>&lt;'p&gt;</code> and <code>&lt;/p&gt;</code> separately with
the <code>?</code>. Without it, it will match the entire string <code>&lt;..Hello..&gt;</code>.</p>
<p>If non-tag <code>&lt;</code> appears in html (eg. <code>2 &lt; 3</code>), it should be written as an
escape sequence <code>&amp;...</code> anyway so the <code>^&lt;</code> may be unnecessary.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/parse-a-uri-string-into-name-value-collection/" class="u-url">Parse a URI String into Name-Value Collection</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/parse-a-uri-string-into-name-value-collection/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T10:14:24+08:00" itemprop="datePublished" title="2023-03-05 10:14">2023-03-05 10:14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've got the URI like this:</p>
<div class="code"><pre class="code literal-block">https://google.com.ua/oauth/authorize?client_id=SS&amp;response_type=code&amp;scope=N_FULL&amp;access_type=offline&amp;redirect_uri=http://localhost/Callback
</pre></div>

<p>I need a collection with parsed elements:</p>
<div class="code"><pre class="code literal-block"><span class="gh">NAME               VALUE</span>
<span class="gh">------------------------</span>
client_id          SS
response_type      code
scope              N_FULL
access_type        offline
redirect_uri       http://localhost/Callback
</pre></div>

<p>To be exact, I need a Java equivalent for the C#/.NET
<code>HttpUtility.ParseQueryString</code> method.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>If you are looking for a way to achieve it without using an external library,
the following code will help you.</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">Map</span><span class="o">&lt;</span><span class="nv">String</span>,<span class="w"> </span><span class="nv">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">splitQuery</span><span class="ss">(</span><span class="nv">URL</span><span class="w"> </span><span class="nv">url</span><span class="ss">)</span><span class="w"> </span><span class="nv">throws</span><span class="w"> </span><span class="nv">UnsupportedEncodingException</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">Map</span><span class="o">&lt;</span><span class="nv">String</span>,<span class="w"> </span><span class="nv">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">query_pairs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">LinkedHashMap</span><span class="o">&lt;</span><span class="nv">String</span>,<span class="w"> </span><span class="nv">String</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">String</span><span class="w"> </span><span class="nv">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">url</span>.<span class="nv">getQuery</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">String</span>[]<span class="w"> </span><span class="nv">pairs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">query</span>.<span class="nv">split</span><span class="ss">(</span><span class="s2">"&amp;"</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">String</span><span class="w"> </span><span class="nv">pair</span><span class="w"> </span>:<span class="w"> </span><span class="nv">pairs</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">int</span><span class="w"> </span><span class="nv">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pair</span>.<span class="nv">indexOf</span><span class="ss">(</span><span class="s2">"="</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span><span class="nv">query_pairs</span>.<span class="nv">put</span><span class="ss">(</span><span class="nv">URLDecoder</span>.<span class="nv">decode</span><span class="ss">(</span><span class="nv">pair</span>.<span class="nv">substring</span><span class="ss">(</span><span class="mi">0</span>,<span class="w"> </span><span class="nv">idx</span><span class="ss">)</span>,<span class="w"> </span><span class="s2">"UTF-8"</span><span class="ss">)</span>,<span class="w"> </span><span class="nv">URLDecoder</span>.<span class="nv">decode</span><span class="ss">(</span><span class="nv">pair</span>.<span class="nv">substring</span><span class="ss">(</span><span class="nv">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span>,<span class="w"> </span><span class="s2">"UTF-8"</span><span class="ss">))</span><span class="c1">;</span>
<span class="w">    </span>}
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">query_pairs</span><span class="c1">;</span>
}
</pre></div>

<p>You can access the returned Map using <code>&lt;map&gt;.get("client_id")</code>, with the URL
given in your question this would return "SS".</p>
<p><strong>UPDATE</strong> URL-Decoding added</p>
<p><strong>UPDATE</strong> As this answer is still quite popular, I made an improved version
of the method above, which handles multiple parameters with the same key and
parameters with no value as well.</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">Map</span><span class="o">&lt;</span><span class="nv">String</span>,<span class="w"> </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nv">splitQuery</span><span class="ss">(</span><span class="nv">URL</span><span class="w"> </span><span class="nv">url</span><span class="ss">)</span><span class="w"> </span><span class="nv">throws</span><span class="w"> </span><span class="nv">UnsupportedEncodingException</span><span class="w"> </span>{
<span class="w">  </span><span class="nv">final</span><span class="w"> </span><span class="nv">Map</span><span class="o">&lt;</span><span class="nv">String</span>,<span class="w"> </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nv">query_pairs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">LinkedHashMap</span><span class="o">&lt;</span><span class="nv">String</span>,<span class="w"> </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">String</span><span class="o">&gt;&gt;</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">  </span><span class="nv">final</span><span class="w"> </span><span class="nv">String</span>[]<span class="w"> </span><span class="nv">pairs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">url</span>.<span class="nv">getQuery</span><span class="ss">()</span>.<span class="nv">split</span><span class="ss">(</span><span class="s2">"&amp;"</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">String</span><span class="w"> </span><span class="nv">pair</span><span class="w"> </span>:<span class="w"> </span><span class="nv">pairs</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">final</span><span class="w"> </span><span class="nv">int</span><span class="w"> </span><span class="nv">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pair</span>.<span class="nv">indexOf</span><span class="ss">(</span><span class="s2">"="</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">final</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">idx</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>?<span class="w"> </span><span class="nv">URLDecoder</span>.<span class="nv">decode</span><span class="ss">(</span><span class="nv">pair</span>.<span class="nv">substring</span><span class="ss">(</span><span class="mi">0</span>,<span class="w"> </span><span class="nv">idx</span><span class="ss">)</span>,<span class="w"> </span><span class="s2">"UTF-8"</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">pair</span><span class="c1">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="o">!</span><span class="nv">query_pairs</span>.<span class="nv">containsKey</span><span class="ss">(</span><span class="nv">key</span><span class="ss">))</span><span class="w"> </span>{
<span class="w">      </span><span class="nv">query_pairs</span>.<span class="nv">put</span><span class="ss">(</span><span class="nv">key</span>,<span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">LinkedList</span><span class="o">&lt;</span><span class="nv">String</span><span class="o">&gt;</span><span class="ss">())</span><span class="c1">;</span>
<span class="w">    </span>}
<span class="w">    </span><span class="nv">final</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">idx</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">pair</span>.<span class="nv">length</span><span class="ss">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span>?<span class="w"> </span><span class="nv">URLDecoder</span>.<span class="nv">decode</span><span class="ss">(</span><span class="nv">pair</span>.<span class="nv">substring</span><span class="ss">(</span><span class="nv">idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span>,<span class="w"> </span><span class="s2">"UTF-8"</span><span class="ss">)</span><span class="w"> </span>:<span class="w"> </span><span class="nv">null</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">query_pairs</span>.<span class="nv">get</span><span class="ss">(</span><span class="nv">key</span><span class="ss">)</span>.<span class="nv">add</span><span class="ss">(</span><span class="nv">value</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">  </span>}
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nv">query_pairs</span><span class="c1">;</span>
}
</pre></div>

<p><strong>UPDATE</strong> Java8 version</p>
<div class="code"><pre class="code literal-block"><span class="nt">public</span><span class="w"> </span><span class="nt">Map</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">,</span><span class="w"> </span><span class="nt">List</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nt">splitQuery</span><span class="o">(</span><span class="nt">URL</span><span class="w"> </span><span class="nt">url</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(Strings.isNullOrEmpty(url.getQuery()))</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="err">return</span><span class="w"> </span><span class="err">Collections.emptyMap()</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nt">return</span><span class="w"> </span><span class="nt">Arrays</span><span class="p">.</span><span class="nc">stream</span><span class="o">(</span><span class="nt">url</span><span class="p">.</span><span class="nc">getQuery</span><span class="o">()</span><span class="p">.</span><span class="nc">split</span><span class="o">(</span><span class="s2">"&amp;"</span><span class="o">))</span>
<span class="w">            </span><span class="p">.</span><span class="nc">map</span><span class="o">(</span><span class="nt">this</span><span class="p">::</span><span class="nd">splitQueryParameter</span><span class="o">)</span>
<span class="w">            </span><span class="p">.</span><span class="nc">collect</span><span class="o">(</span><span class="nt">Collectors</span><span class="p">.</span><span class="nc">groupingBy</span><span class="o">(</span><span class="nt">SimpleImmutableEntry</span><span class="p">::</span><span class="nd">getKey</span><span class="o">,</span><span class="w"> </span><span class="nt">LinkedHashMap</span><span class="p">::</span><span class="nd">new</span><span class="o">,</span><span class="w"> </span><span class="nt">mapping</span><span class="o">(</span><span class="nt">Map</span><span class="p">.</span><span class="nc">Entry</span><span class="p">::</span><span class="nd">getValue</span><span class="o">,</span><span class="w"> </span><span class="nt">toList</span><span class="o">())));</span>
<span class="err">}</span>

<span class="nt">public</span><span class="w"> </span><span class="nt">SimpleImmutableEntry</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">,</span><span class="w"> </span><span class="nt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">splitQueryParameter</span><span class="o">(</span><span class="nt">String</span><span class="w"> </span><span class="nt">it</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">final</span><span class="w"> </span><span class="err">int</span><span class="w"> </span><span class="err">idx</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">it.indexOf("=")</span><span class="p">;</span>
<span class="w">    </span><span class="err">final</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">key</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">idx</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">0</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="err">it.substring(0,</span><span class="w"> </span><span class="err">idx)</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="err">it</span><span class="p">;</span>
<span class="w">    </span><span class="err">final</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">idx</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">0</span><span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span><span class="err">it.length()</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">idx</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">1</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="err">it.substring(idx</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">1)</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="err">null</span><span class="p">;</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">SimpleImmutableEntry&lt;&gt;(</span>
<span class="w">        </span><span class="err">URLDecoder.decode(key,</span><span class="w"> </span><span class="err">StandardCharsets.UTF_8),</span>
<span class="w">        </span><span class="err">URLDecoder.decode(value,</span><span class="w"> </span><span class="err">StandardCharsets.UTF_8)</span>
<span class="w">    </span><span class="err">)</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Running the above method with the URL</p>
<p><code>https://stackoverflow.com?param1=value1&amp;param2=&amp;param3=value3&amp;param3</code></p>
<p>returns this Map:</p>
<div class="code"><pre class="code literal-block"><span class="err">{</span><span class="n">param1</span><span class="o">=[</span><span class="n">"value1"</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">param2</span><span class="o">=[</span><span class="n">null</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">param3</span><span class="o">=[</span><span class="n">"value3", null</span><span class="o">]</span><span class="err">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<h2>org.apache.http.client.utils.URLEncodedUtils</h2>
<p>is a well known library that can do it for you</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">org.apache.hc.client5.http.utils.URLEncodedUtils</span>

<span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s2">"http://www.example.com/something.html?one=1&amp;two=2&amp;three=3&amp;three=3a"</span><span class="p">;</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">NameValuePair</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="n">URLEncodedUtils</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">new</span> <span class="n">URI</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="n">Charset</span><span class="o">.</span><span class="n">forName</span><span class="p">(</span><span class="s2">"UTF-8"</span><span class="p">));</span>

<span class="k">for</span> <span class="p">(</span><span class="n">NameValuePair</span> <span class="n">param</span> <span class="p">:</span> <span class="n">params</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="s2">" : "</span> <span class="o">+</span> <span class="n">param</span><span class="o">.</span><span class="n">getValue</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>

<p>Outputs</p>
<div class="code"><pre class="code literal-block"><span class="n">one</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="n">two</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">2</span>
<span class="n">three</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">3</span>
<span class="n">three</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">3</span><span class="n">a</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2686.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2684.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
