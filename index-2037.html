<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2037) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2037.html">
<link rel="prev" href="index-2038.html" type="text/html">
<link rel="next" href="index-2036.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-exactly-does-attribute-constructor-work/" class="u-url">How exactly does __attribute__((constructor)) work?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-exactly-does-attribute-constructor-work/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T15:26:07+08:00" itemprop="datePublished" title="2023-03-03 15:26">2023-03-03 15:26</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>It seems pretty clear that it is supposed to set things up.</p>
<ol>
<li>When exactly does it run?</li>
<li>Why are there two parentheses?</li>
<li>Is <code>__attribute__</code> a function? A macro? Syntax?</li>
<li>Does this work in C? C++?</li>
<li>Does the function it works with need to be static?</li>
<li>When does <code>__attribute__((destructor))</code> run?</li>
</ol>
<p>Example in Objective-C:</p>
<div class="code"><pre class="code literal-block"><span class="bp">__attribute__</span><span class="p">((</span><span class="n">constructor</span><span class="p">))</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">initialize_navigationBarImages</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">navigationBarImages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">NSMutableDictionary</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">init</span><span class="p">];</span>
<span class="p">}</span>

<span class="bp">__attribute__</span><span class="p">((</span><span class="n">destructor</span><span class="p">))</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">destroy_navigationBarImages</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">[</span><span class="n">navigationBarImages</span><span class="w"> </span><span class="k">release</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<ol>
<li>It runs when a shared library is loaded, typically during program startup.</li>
<li>That's how all GCC attributes are; presumably to distinguish them from function calls.</li>
<li>GCC-specific syntax.</li>
<li>Yes, this works in C and C++.</li>
<li>No, the function does not need to be static.</li>
<li>The destructor runs when the shared library is unloaded, typically at program exit.</li>
</ol>
<p>So, the way the constructors and destructors work is that the shared object
file contains special sections (.ctors and .dtors on ELF) which contain
references to the functions marked with the constructor and destructor
attributes, respectively. When the library is loaded/unloaded the dynamic
loader program (ld.so or somesuch) checks whether such sections exist, and if
so, calls the functions referenced therein.</p>
<p>Come to think of it, there is probably some similar magic in the normal static
linker so that the same code is run on startup/shutdown regardless if the user
chooses static or dynamic linking.</p>
<p><br></p>
<h3>Suggest</h3>
<p><code>.init</code>/<code>.fini</code> isn't deprecated. It's still part of the the ELF standard and
I'd dare say it will be forever. Code in <code>.init</code>/<code>.fini</code> is run by the
loader/runtime-linker when code is loaded/unloaded. I.e. on each ELF load (for
example a shared library) code in <code>.init</code> will be run. It's still possible to
use that mechanism to achieve about the same thing as with
<code>__attribute__((constructor))/((destructor))</code>. It's old-school but it has some
benefits.</p>
<p><code>.ctors</code>/<code>.dtors</code> mechanism for example require support by system-
rtl/loader/linker-script. This is far from certain to be available on all
systems, for example deeply embedded systems where code executes on bare
metal. I.e. even if <code>__attribute__((constructor))/((destructor))</code> is supported
by GCC, it's not certain it will run as it's up to the linker to organize it
and to the loader (or in some cases, boot-code) to run it. To use
<code>.init</code>/<code>.fini</code> instead, the easiest way is to use linker flags: -init &amp; -fini
(i.e. from GCC command line, syntax would be <code>-Wl -init my_init -fini
my_fini</code>).</p>
<p>On system supporting both methods, one possible benefit is that code in
<code>.init</code> is run before <code>.ctors</code> and code in <code>.fini</code> after <code>.dtors</code>. If order is
relevant that's at least one crude but easy way to distinguish between
init/exit functions.</p>
<p>A major drawback is that you can't easily have more than one <code>_init</code> and one
<code>_fini</code> function per each loadable module and would probably have to fragment
code in more <code>.so</code> than motivated. Another is that when using the linker
method described above, one replaces the original _init and <code>_fini</code> default
functions (provided by <code>crti.o</code>). This is where all sorts of initialization
usually occur (on Linux this is where global variable assignment is
initialized). A way around that is described here</p>
<p>Notice in the link above that a cascading to the original <code>_init()</code> is not
needed as it's still in place. The <code>call</code> in the inline assembly however is
x86-mnemonic and calling a function from assembly would look completely
different for many other architectures (like ARM for example). I.e. code is
not transparent.</p>
<p><code>.init</code>/<code>.fini</code> and <code>.ctors</code>/<code>.detors</code> mechanisms are similar, but not quite.
Code in <code>.init</code>/<code>.fini</code> runs "as is". I.e. you can have several functions in
<code>.init</code>/<code>.fini</code>, but it is AFAIK syntactically difficult to put them there
fully transparently in pure C without breaking up code in many small <code>.so</code>
files.</p>
<p><code>.ctors</code>/<code>.dtors</code> are differently organized than <code>.init</code>/<code>.fini</code>.
<code>.ctors</code>/<code>.dtors</code> sections are both just tables with pointers to functions,
and the "caller" is a system-provided loop that calls each function
indirectly. I.e. the loop-caller can be architecture specific, but as it's
part of the system (if it exists at all i.e.) it doesn't matter.</p>
<p>The following snippet adds new function pointers to the <code>.ctors</code> function
array, principally the same way as <code>__attribute__((constructor))</code> does (method
can coexist with <code>__attribute__((constructor)))</code>.</p>
<div class="code"><pre class="code literal-block">#define SECTION( S ) __attribute__ ((section ( S )))
void test(void) {
   printf("Hello\n");
}
void (*funcptr)(void) SECTION(".ctors") =test;
void (*funcptr2)(void) SECTION(".ctors") =test;
void (*funcptr3)(void) SECTION(".dtors") =test;
</pre></div>

<p>One can also add the function pointers to a completely different self-invented
section. A modified linker script and an additional function mimicking the
loader <code>.ctors</code>/<code>.dtors</code> loop is needed in such case. But with it one can
achieve better control over execution order, add in-argument and return code
handling e.t.a. (In a C++ project for example, it would be useful if in need
of something running before or after global constructors).</p>
<p>I'd prefer <code>__attribute__((constructor))/((destructor))</code> where possible, it's
a simple and elegant solution even it feels like cheating. For bare-metal
coders like myself, this is just not always an option.</p>
<p>Some good reference in the book <em>Linkers &amp; loaders</em>.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/type-annotations-for-args-and-kwargs/" class="u-url">Type annotations for *args and **kwargs</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/type-annotations-for-args-and-kwargs/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T15:25:42+08:00" itemprop="datePublished" title="2023-03-03 15:25">2023-03-03 15:25</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying out Python's type annotations with abstract base classes to write
some interfaces. Is there a way to annotate the possible types of <code>*args</code> and
<code>**kwargs</code>?</p>
<p>For example, how would one express that the sensible arguments to a function
are either an <code>int</code> or two <code>int</code>s? <code>type(args)</code> gives <code>Tuple</code> so my guess was
to annotate the type as <code>Union[Tuple[int, int], Tuple[int]]</code>, but this doesn't
work.</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]]):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">i</span>

<span class="c1"># ok</span>
<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">((</span><span class="mi">1</span><span class="p">,)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="c1"># mypy does not like this</span>
<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>

<p>Error messages from mypy:</p>
<div class="code"><pre class="code literal-block"><span class="n">t</span><span class="p">.</span><span class="nl">py</span><span class="p">:</span><span class="w"> </span><span class="nl">note</span><span class="p">:</span><span class="w"> </span><span class="ow">In</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="ss">"foo"</span><span class="err">:</span>
<span class="n">t</span><span class="p">.</span><span class="nl">py</span><span class="p">:</span><span class="mi">6</span><span class="err">:</span><span class="w"> </span><span class="nl">error</span><span class="p">:</span><span class="w"> </span><span class="n">Unsupported</span><span class="w"> </span><span class="n">operand</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="ss">"tuple"</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ss">"Union[Tuple[int, int], Tuple[int]]"</span><span class="p">)</span>
<span class="n">t</span><span class="p">.</span><span class="nl">py</span><span class="p">:</span><span class="w"> </span><span class="nl">note</span><span class="p">:</span><span class="w"> </span><span class="k">At</span><span class="w"> </span><span class="k">top</span><span class="w"> </span><span class="k">level</span><span class="err">:</span>
<span class="n">t</span><span class="p">.</span><span class="nl">py</span><span class="p">:</span><span class="mi">12</span><span class="err">:</span><span class="w"> </span><span class="nl">error</span><span class="p">:</span><span class="w"> </span><span class="n">Argument</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="ss">"foo"</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">incompatible</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="ss">"int"</span><span class="p">;</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="ss">"Union[Tuple[int, int], Tuple[int]]"</span>
<span class="n">t</span><span class="p">.</span><span class="nl">py</span><span class="p">:</span><span class="mi">14</span><span class="err">:</span><span class="w"> </span><span class="nl">error</span><span class="p">:</span><span class="w"> </span><span class="n">Argument</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="ss">"foo"</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">incompatible</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="ss">"int"</span><span class="p">;</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="ss">"Union[Tuple[int, int], Tuple[int]]"</span>
<span class="n">t</span><span class="p">.</span><span class="nl">py</span><span class="p">:</span><span class="mi">15</span><span class="err">:</span><span class="w"> </span><span class="nl">error</span><span class="p">:</span><span class="w"> </span><span class="n">Argument</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="ss">"foo"</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">incompatible</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="ss">"int"</span><span class="p">;</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="ss">"Union[Tuple[int, int], Tuple[int]]"</span>
<span class="n">t</span><span class="p">.</span><span class="nl">py</span><span class="p">:</span><span class="mi">15</span><span class="err">:</span><span class="w"> </span><span class="nl">error</span><span class="p">:</span><span class="w"> </span><span class="n">Argument</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="ss">"foo"</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">incompatible</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="ss">"int"</span><span class="p">;</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="ss">"Union[Tuple[int, int], Tuple[int]]"</span>
</pre></div>

<p>It makes sense that mypy doesn't like this for the function call because it
expects there to be a <code>tuple</code> in the call itself. The addition after unpacking
also gives a typing error that I don't understand.</p>
<p>How does one annotate the sensible types for <code>*args</code> and <code>**kwargs</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>For variable positional arguments (<code>*args</code>) and variable keyword arguments
(<code>**kw</code>) you only need to specify the expected value for <em>one</em> such argument.</p>
<p>From the <em>Arbitrary argument lists and default argument values</em> section of the
<em>Type Hints</em> PEP:</p>
<blockquote>
<p>Arbitrary argument lists can as well be type annotated, so that the
definition:</p>
<div class="code"><pre class="code literal-block">def foo(*args: str, **kwds: int): ...
</pre></div>

<p>is acceptable and it means that, e.g., all of the following represent
function calls with valid types of arguments:</p>
<div class="code"><pre class="code literal-block">foo('a', 'b', 'c')
foo(x=1, y=2)
foo('', z=0)
</pre></div>

</blockquote>
<p>So you'd want to specify your method like this:</p>
<div class="code"><pre class="code literal-block">def foo(*args: int):
</pre></div>

<p>However, if your function can only accept either one or two integer values,
you should not use <code>*args</code> at all, use one explicit positional argument and a
second keyword argument:</p>
<div class="code"><pre class="code literal-block"><span class="n">def</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="k">first</span><span class="err">:</span><span class="w"> </span><span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="k">second</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">int</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="err">:</span>
</pre></div>

<p>Now your function is actually limited to one or two arguments, and both must
be integers if specified. <code>*args</code> <em>always</em> means 0 or more, and can't be
limited by type hints to a more specific range.</p>
<p><br></p>
<h3>Suggest</h3>
<h2>2022 Update</h2>
<p>The mypy team added support for <code>Unpack</code>, this is available since Mypy 0.981
or higher.</p>
<p><strong>Attention!</strong> Although this feature is complete, <code>Unpack[...]</code> is still
considered experimental, so you will need to use <code>--enable-incomplete-
features</code> to enable it.</p>
<p>You can use this feature as follows:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Unpack</span>


<span class="k">class</span> <span class="nc">RequestParams</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">allow_redirects</span><span class="p">:</span> <span class="nb">bool</span>


<span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">RequestParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>

<p>If you call the <code>request</code> function with the arguments defined in the
TypedDict, you won't get any errors:</p>
<div class="code"><pre class="code literal-block"># OK
request(url="https://example.com", allow_redirects=True)
</pre></div>

<p>If you forget to pass an argument, mypy will let you know now 😊</p>
<div class="code"><pre class="code literal-block">#<span class="w"> </span><span class="nv">error</span>:<span class="w"> </span><span class="nv">Missing</span><span class="w"> </span><span class="nv">named</span><span class="w"> </span><span class="nv">argument</span><span class="w"> </span><span class="s2">"allow_redirects"</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s2">"request"</span><span class="w">  </span>[<span class="nv">call</span><span class="o">-</span><span class="nv">arg</span>]
<span class="nv">request</span><span class="ss">(</span><span class="nv">url</span><span class="o">=</span><span class="s2">"https://example.com"</span><span class="ss">)</span>
</pre></div>

<p>You can also make the fields non-required by adding <code>total=False</code> to the
TypedDict:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">RequestParams</span>(<span class="n">TypedDict</span>, <span class="nb">total</span>=<span class="nb">False</span>):
    <span class="n">url:</span> <span class="n">str</span>
    <span class="n">allow_redirects:</span> <span class="n">bool</span>

<span class="c1"># OK</span>
<span class="n">request</span>(<span class="n">url</span>=<span class="s">"https://example.com"</span>)
</pre></div>

<p>Alternatively, you can use the <code>Required</code> and <code>NotRequired</code> annotations to
control whether a keyword argument is required or not:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Unpack</span><span class="p">,</span> <span class="n">NotRequired</span>


<span class="k">class</span> <span class="nc">RequestParams</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">allow_redirects</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Unpack</span><span class="p">[</span><span class="n">RequestParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>

<span class="c1"># OK</span>
<span class="n">request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">"https://example.com"</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

<h3>Old answer bellow:</h3>
<p>While you can annotate variadic arguments with a type, I don't find it very
useful because it assumes that all arguments are of the same type.</p>
<p>The proper type annotation of <code>*args</code> and <code>**kwargs</code> that allows specifying
each variadic argument separately is not supported by mypy yet. There is a
proposal for adding an <code>Expand</code> helper on <code>mypy_extensions</code> module, it would
work like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">Options</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="nl">timeout</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span>
<span class="w">    </span><span class="nl">alternative</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span>
<span class="w">    </span><span class="nl">on_error</span><span class="p">:</span><span class="w"> </span><span class="n">Callable</span><span class="o">[</span><span class="n">[int</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="k">None</span><span class="err">]</span>
<span class="w">    </span><span class="nl">on_timeout</span><span class="p">:</span><span class="w"> </span><span class="n">Callable</span><span class="o">[</span><span class="n">[</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="k">None</span><span class="err">]</span>
<span class="w">    </span><span class="p">...</span>

<span class="n">def</span><span class="w"> </span><span class="n">fun</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="nl">options</span><span class="p">:</span><span class="w"> </span><span class="n">Expand</span><span class="o">[</span><span class="n">Options</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>
<span class="w">    </span><span class="p">...</span>
</pre></div>

<p>The GitHub issue was opened on January 2018 but it's still not closed. Note
that while the issue is about <code>**kwargs</code>, the <code>Expand</code> syntax will likely be
used for <code>*args</code> as well.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-should-i-not-include-bits-stdc-h/" class="u-url">Why should I not #include &lt;bits/stdc++.h&gt;?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-should-i-not-include-bits-stdc-h/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T15:25:17+08:00" itemprop="datePublished" title="2023-03-03 15:25">2023-03-03 15:25</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I posted a question with my code whose only <code>#include</code> directive was the
following:</p>
<div class="code"><pre class="code literal-block"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
</pre></div>

<p>My teacher told me to do this, but in the comments section I was informed that
I shouldn't.</p>
<p>Why?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Including <code>&lt;bits/stdc++.h&gt;</code> appears to be an increasingly common thing to see
on Stack Overflow, perhaps something newly added to a national curriculum in
the current academic year.</p>
<p>I imagine the advantages are vaguely given thus:</p>
<ul>
<li>You only need write one <code>#include</code> line.</li>
<li>You do not need to look up which standard header everything is in.</li>
</ul>
<p>Unfortunately, this is a lazy hack, naming a GCC internal header directly
instead of individual standard headers like <code>&lt;string&gt;</code>, <code>&lt;iostream&gt;</code> and
<code>&lt;vector&gt;</code>. It ruins portability and fosters terrible habits.</p>
<p>The disadvantages include:</p>
<ul>
<li>It will probably only work on that compiler.</li>
<li>You have no idea what it'll do when you use it, because its contents are not set by a standard.</li>
<li>Even just upgrading your compiler to its own next version may break your program.</li>
<li>Every single standard header must be parsed and compiled along with your source code, which is slow and results in a bulky executable under certain compilation settings.</li>
</ul>
<p><strong>Don't do it!</strong></p>
<hr>
<p>More information:</p>
<ul>
<li>
<h2>include <bits> with visual studio does not compile</bits>
</h2>
</li>
<li>How does #include <bits> work in C++?</bits>
</li>
</ul>
<p>Example of why Quora is bad:</p>
<ul>
<li>Is it good practice to use #include <bits> in programming contests instead of listing a lot of includes?</bits>
</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>Why? Because it is used as if it were supposed to be a C++ standard header,
but no standard mentions it. So your code is non-portable by construction. You
won't find any documentation for it on cppreference. So it might as well not
exist. It's a figment of someone's imagination :)</p>
<p>I have discovered - to my horror and disbelief - that there is a well-known
tutorial site where <strong>every C++ example seems to include this header</strong>. The
world is mad. That's the proof.</p>
<hr>
<p><em>To anyone writing such "tutorials"</em></p>
<p>Please stop using this header. Forget about it. Don't propagate this insanity.
If you're unwilling to understand why doing this is <strong>Wrong</strong> , take my word
for it. I'm not OK being treated as a figure of authority on anything at all,
and I'm probably full of it half the time, but I'll make an exception in this
one case only. I claim that I know what I'm talking about here. Take me on my
word. I implore you.</p>
<p>P.S. I can well imagine the abominable "teaching standard" where this wicked
idea might have taken place, and the circumstances that led to it. Just
because there seemed to be a practical need for it doesn't make it acceptable
- not even in retrospect.</p>
<p>P.P.S. No, there was no practical need for it. There aren't that many C++
standard headers, and they are well documented. If you teach, you're doing
your students a disservice by adding such "magic". Producing programmers with
a magical mindset is the last thing we want. If you need to offer students a
subset of C++ to make their life easier, just produce a handout with the short
list of headers applicable to the course you teach, and with concise
documentation for the library constructs you expect the students to use.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2038.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2036.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
