<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 973) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-973.html">
<link rel="prev" href="index-974.html" type="text/html">
<link rel="next" href="index-972.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jiang-zheng-ge-javascript-wen-jian-bao-zhuang-zai-xiang-function-zhe-yang-de-ni-ming-han-shu-zhong-de-mu-de-shi-shi-yao/" class="u-url">将整个 Javascript 文件包装在像“(function(){ … })()”这样的匿名函数中的目的是什么？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/jiang-zheng-ge-javascript-wen-jian-bao-zhuang-zai-xiang-function-zhe-yang-de-ni-ming-han-shu-zhong-de-mu-de-shi-shi-yao/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T21:27:28+08:00" itemprop="datePublished" title="2023-02-17 21:27">2023-02-17 21:27</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我最近阅读了很多 Javascript，我注意到整个文件在要导入的 .js 文件中像下面这样包装。</p>
<div class="code"><pre class="code literal-block">(function() {
    ... 
    code
    ...
})();
</pre></div>

<p>这样做而不是一组简单的构造函数的原因是什么？</p>
<p><br><br></p>
<h2>解答</h2>
<p>它通常用于命名空间（见下文）并控制成员函数和/或变量的可见性。把它想象成一个对象定义。它的技术名称是 <strong>立即调用函数表达式</strong> (IIFE)。jQuery
插件通常是这样写的。</p>
<p>在 Javascript 中，您可以嵌套函数。所以，以下是合法的：</p>
<div class="code"><pre class="code literal-block">function outerFunction() {
   function innerFunction() {
      // code
   }
}
</pre></div>

<p>现在您可以调用<code>outerFunction()</code>，但是可见性<code>innerFunction()</code>仅限于范围内<code>outerFunction()</code>，这意味着它是私有的<code>outerFunction()</code>。它基本上遵循与
Javascript 中的变量相同的原则：</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">globalVariable</span><span class="p">;</span>

<span class="n">function</span><span class="w"> </span><span class="n">someFunction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">var</span><span class="w"> </span><span class="n">localVariable</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>相应地：</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">globalFunction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="k">var</span><span class="w"> </span><span class="n">localFunction1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="o">//</span><span class="n">I</span><span class="s1">'m anonymous! But localFunction1 is a reference to me!</span>
<span class="w">   </span><span class="p">};</span>

<span class="w">   </span><span class="n">function</span><span class="w"> </span><span class="n">localFunction2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="o">//</span><span class="n">I</span><span class="s1">'m named!</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>在上面的场景中，你可以<code>globalFunction()</code>从任何地方调用，但你不能调用<code>localFunction1</code>or
<code>localFunction2</code>。</p>
<p>当你写的时候<code>(function() { ...
})()</code>，你在做什么，是把第一组括号内的代码变成函数文字（意味着整个“对象”实际上是一个函数）。之后，您将自行调用<code>()</code>您刚刚定义的函数（最后一个）。因此，正如我之前提到的，这样做的主要优点是您可以拥有私有方法/函数和属性：</p>
<div class="code"><pre class="code literal-block"><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">var</span><span class="w"> </span><span class="n">private_var</span><span class="p">;</span>

<span class="w">   </span><span class="n">function</span><span class="w"> </span><span class="n">private_function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="o">//</span><span class="n">code</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">})();</span>
</pre></div>

<p>在第一个示例中，您将<code>globalFunction</code>通过名称显式调用来运行它。也就是说，您只需<code>globalFunction()</code>运行它即可。但是在上面的示例中，您不仅仅是在定义一个函数；您正在一次性定义
<em>和调用它。</em> 这意味着当加载您的 JavaScript 文件时，它会立即执行。当然，你可以这样做：</p>
<div class="code"><pre class="code literal-block">function globalFunction() {
    // code
}
globalFunction();
</pre></div>

<p>除了一个显着差异外，行为在很大程度上是相同的：当您使用 IIFE
时避免污染全局范围（因此这也意味着您不能多次调用该函数，因为它没有名称，但由于此功能仅在确实不是问题时才执行）。</p>
<p>IIFE 的巧妙之处在于，您还可以在内部定义内容，并且只向外界公开您想要的部分（命名空间示例，因此您基本上可以创建自己的库/插件）：</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">myPlugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">var</span><span class="w"> </span><span class="n">private_var</span><span class="p">;</span>

<span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">private_function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">public_function1</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="n">public_function2</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">})()</span>
</pre></div>

<p>现在可以打电话<code>myPlugin.public_function1()</code>，但是不能上网<code>private_function()</code>！与类定义非常相似。为了更好地理解这一点，我建议使用以下链接进行进一步阅读：</p>
<ul>
<li>为您的 Javascript 命名空间</li>
<li>Javascript 中的私有成员（Douglas Crockford）</li>
</ul>
<p><strong>编辑</strong></p>
<p>我忘了提。在那场决赛中<code>()</code>，你可以在里面传递任何你想要的东西。例如，当你创建 jQuery 插件时，你传入<code>jQuery</code>或<code>$</code>喜欢这样：</p>
<div class="code"><pre class="code literal-block">(function(jQ) { ... code ... })(jQuery)
</pre></div>

<p>所以你在这里做的是定义一个函数，它接受一个参数（称为<code>jQ</code>，一个局部变量，并且 <em>只有</em>
该函数知道）。然后你自己调用函数并传入一个参数（也称为<code>jQuery</code>，但 <em>这个</em> 参数来自外部世界，是对实际 jQuery
本身的引用）。没有迫切需要这样做，但有一些优点：</p>
<ul>
<li>您可以重新定义全局参数并为其指定一个在局部范围内有意义的名称。</li>
<li>有一个轻微的性能优势，因为在本地范围内查找事物比必须沿着范围链进入全局范围更快。</li>
<li>压缩（缩小）有好处。</li>
</ul>
<p>之前我描述了这些函数是如何在启动时自动运行的，但是如果它们自动运行，谁在传递参数呢？该技术假定您需要的所有参数都已定义为全局变量。因此，如果 jQuery
尚未定义为全局变量，则此示例将无法运行。正如您可能猜到的那样，jquery.js
在其初始化期间所做的一件事是定义一个“jQuery”全局变量，以及它更著名的“$”全局变量，它允许此代码在包含 jQuery 后工作。</p>
<p><br></p>
<h3>更多建议</h3>
<h2>简而言之</h2>
<h3>概括</h3>
<p>在最简单的形式中，该技术旨在将代码包装在 <strong>函数范围</strong> 内。</p>
<p>它有助于减少以下机会：</p>
<ul>
<li>与其他应用程序/库冲突</li>
<li>污染高级（全局最有可能）范围</li>
</ul>
<p>它 <strong>不会</strong> 检测文档何时准备就绪 - 它不是某种形式，<code>document.onload</code>也不是<code>window.onload</code></p>
<p>它通常被称为<code>Immediately Invoked Function Expression (IIFE)</code>or <code>Self Executing
Anonymous Function</code>。</p>
<h3>代码解释</h3>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">someFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'wagwan!'</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>

<span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">                   </span><span class="o">/*</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">starts</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="o">*/</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'start of IIFE'</span><span class="p">);</span>

<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w">             </span><span class="o">/*</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">declaration</span><span class="w"> </span><span class="o">*/</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w">  </span><span class="o">/*</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">declaration</span><span class="w"> </span><span class="o">*/</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'formidable!'</span><span class="p">);</span><span class="w"> </span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">              </span><span class="o">/*</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">declaration</span><span class="w"> </span><span class="o">*/</span>
<span class="w">    </span><span class="n">anotherNumber</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">anotherFunc</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'formidable!'</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'end of IIFE'</span><span class="p">);</span>
<span class="p">})();</span><span class="w">                           </span><span class="o">/*</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">ends</span><span class="w"> </span><span class="o">*/</span>

<span class="n">someFunction</span><span class="p">();</span><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">reachable</span><span class="p">,</span><span class="w"> </span><span class="n">hence</span><span class="w"> </span><span class="n">works</span><span class="p">:</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
<span class="n">myFunction</span><span class="p">();</span><span class="w">              </span><span class="o">//</span><span class="w"> </span><span class="n">unreachable</span><span class="p">,</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
<span class="n">myObject</span><span class="o">.</span><span class="n">anotherFunc</span><span class="p">();</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">unreachable</span><span class="p">,</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
</pre></div>

<p>在上面的示例中，函数中定义的任何变量（即声明为 using <code>var</code>）都将是“私有的”并且只能在函数范围内访问（正如 Vivin Paliath
所说）。换句话说，这些变量在函数外部不可见/不可访问。查看现场演示。</p>
<p>Javascript 具有函数作用域。“在函数中定义的参数和变量在函数外是不可见的，而在函数内任何地方定义的变量在函数内的任何地方都是可见的。”
（来自“Javascript：好的部分”）。</p>
<hr>
<h2>更多细节</h2>
<h3>替代代码</h3>
<p>最后，之前贴出的代码也可以这样实现：</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">someFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'wagwan!'</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>

<span class="k">var</span><span class="w"> </span><span class="n">myMainFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'start of IIFE'</span><span class="p">);</span>

<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'formidable!'</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">anotherNumber</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">anotherFunc</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'formidable!'</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'end of IIFE'</span><span class="p">);</span>
<span class="p">};</span>

<span class="n">myMainFunction</span><span class="p">();</span><span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">CALL</span><span class="w"> </span><span class="s2">"myMainFunction"</span><span class="w"> </span><span class="n">FUNCTION</span><span class="w"> </span><span class="n">HERE</span>
<span class="n">someFunction</span><span class="p">();</span><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">reachable</span><span class="p">,</span><span class="w"> </span><span class="n">hence</span><span class="w"> </span><span class="n">works</span><span class="p">:</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
<span class="n">myFunction</span><span class="p">();</span><span class="w">              </span><span class="o">//</span><span class="w"> </span><span class="n">unreachable</span><span class="p">,</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
<span class="n">myObject</span><span class="o">.</span><span class="n">anotherFunc</span><span class="p">();</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">unreachable</span><span class="p">,</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
</pre></div>

<p>查看现场演示。</p>
<hr>
<h3>根</h3>
<h4>迭代 1</h4>
<p>有一天，有人可能会想“一定有一种方法可以避免命名 'myMainFunction'，因为我们只想立即执行它。”</p>
<p>如果你回到基础，你会发现：</p>
<ul>
<li>
<code>expression</code>: 评估价值的东西。IE<code>3+11/x</code>
</li>
<li>
<code>statement</code>: 代码行做某事但它没有 <strong>计算</strong> 出一个值。IE<code>if(){}</code>
</li>
</ul>
<p>类似地，函数表达式计算出一个值。一个结果（我假设？）是可以立即调用它们：</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="k">var</span><span class="w"> </span><span class="n">italianSayinSomething</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'mamamia!'</span><span class="p">);</span><span class="w"> </span><span class="p">}();</span>
</pre></div>

<p>所以我们更复杂的例子变成了：</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">someFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'wagwan!'</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>

<span class="k">var</span><span class="w"> </span><span class="n">myMainFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'start of IIFE'</span><span class="p">);</span>

<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'formidable!'</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">anotherNumber</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">anotherFunc</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'formidable!'</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'end of IIFE'</span><span class="p">);</span>
<span class="p">}();</span>

<span class="n">someFunction</span><span class="p">();</span><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">reachable</span><span class="p">,</span><span class="w"> </span><span class="n">hence</span><span class="w"> </span><span class="n">works</span><span class="p">:</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
<span class="n">myFunction</span><span class="p">();</span><span class="w">              </span><span class="o">//</span><span class="w"> </span><span class="n">unreachable</span><span class="p">,</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
<span class="n">myObject</span><span class="o">.</span><span class="n">anotherFunc</span><span class="p">();</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">unreachable</span><span class="p">,</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
</pre></div>

<p>查看现场演示。</p>
<h4>迭代 2</h4>
<p>下一步是“<code>var myMainFunction =</code>如果我们甚至不使用它，为什么要拥有它！？”的想法。</p>
<p>答案很简单：尝试删除它，如下所示：</p>
<div class="code"><pre class="code literal-block"> function(){ console.log('mamamia!'); }();
</pre></div>

<p>查看现场演示。</p>
<p>它不会工作，因为 <strong>"function declarations are not invokable"</strong> 。</p>
<p>诀窍是通过删除<code>var myMainFunction =</code>我们将 <strong>函数表达式</strong> 转换为 <strong>函数声明</strong>
。有关这方面的更多详细信息，请参阅“参考资料”中的链接。</p>
<p>下一个问题是“为什么我不能将它保留为函数表达式而不是其他东西<code>var myMainFunction =</code>？</p>
<p>The answer is "you can", and there are actually many ways you could do this:
adding a <code>+</code>, a <code>!</code>, a <code>-</code>, or maybe wrapping in a pair of parenthesis (as
it's now done by convention), and more I believe. As example:</p>
<div class="code"><pre class="code literal-block"> (function(){ console.log('mamamia!'); })(); // live demo: jsbin.com/zokuwodoco/1/edit?js,console.
</pre></div>

<p>or</p>
<div class="code"><pre class="code literal-block"> +function(){ console.log('mamamia!'); }(); // live demo: jsbin.com/wuwipiyazi/1/edit?js,console
</pre></div>

<p>or</p>
<div class="code"><pre class="code literal-block"> -function(){ console.log('mamamia!'); }(); // live demo: jsbin.com/wejupaheva/1/edit?js,console
</pre></div>

<ul>
<li>What does the exclamation mark do before the function?</li>
<li>JavaScript plus sign in front of function name</li>
</ul>
<p>So once the relevant modification is added to what was once our "Alternative
Code", we return to the exact same code as the one used in the "Code
Explained" example</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">someFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'wagwan!'</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>

<span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'start of IIFE'</span><span class="p">);</span>

<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'formidable!'</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">anotherNumber</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">anotherFunc</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'formidable!'</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'end of IIFE'</span><span class="p">);</span>
<span class="p">})();</span>

<span class="n">someFunction</span><span class="p">();</span><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">reachable</span><span class="p">,</span><span class="w"> </span><span class="n">hence</span><span class="w"> </span><span class="n">works</span><span class="p">:</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
<span class="n">myFunction</span><span class="p">();</span><span class="w">              </span><span class="o">//</span><span class="w"> </span><span class="n">unreachable</span><span class="p">,</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
<span class="n">myObject</span><span class="o">.</span><span class="n">anotherFunc</span><span class="p">();</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">unreachable</span><span class="p">,</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
</pre></div>

<p>Read more about <code>Expressions vs Statements</code>:</p>
<ul>
<li>developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Expressions_and_Operators</li>
<li>developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions#Function_constructor_vs._function_declaration_vs._function_expression</li>
<li>Javascript: difference between a statement and an expression?</li>
<li>Expression Versus Statement</li>
</ul>
<hr>
<h3>Demystifying Scopes</h3>
<p>One thing one might wonder is "what happens when you do NOT define the
variable 'properly' inside the function -- i.e. do a simple assignment
instead?"</p>
<div class="code"><pre class="code literal-block"><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w">             </span><span class="o">/*</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">declaration</span><span class="w"> </span><span class="o">*/</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w">  </span><span class="o">/*</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">declaration</span><span class="w"> </span><span class="o">*/</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'formidable!'</span><span class="p">);</span><span class="w"> </span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">myObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">              </span><span class="o">/*</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">declaration</span><span class="w"> </span><span class="o">*/</span>
<span class="w">    </span><span class="n">anotherNumber</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1001</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="n">anotherFunc</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'formidable!'</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">myOtherFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w">  </span><span class="o">/*</span><span class="w"> </span><span class="n">oops</span><span class="p">,</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">declaration</span><span class="w"> </span><span class="o">*/</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'haha. got ya!'</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">})();</span>
<span class="n">myOtherFunction</span><span class="p">();</span><span class="w">         </span><span class="o">//</span><span class="w"> </span><span class="n">reachable</span><span class="p">,</span><span class="w"> </span><span class="n">hence</span><span class="w"> </span><span class="n">works</span><span class="p">:</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
<span class="n">window</span><span class="o">.</span><span class="n">myOtherFunction</span><span class="p">();</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">browser</span><span class="p">,</span><span class="w"> </span><span class="n">myOtherFunction</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">scope</span>
<span class="n">myFunction</span><span class="p">();</span><span class="w">              </span><span class="o">//</span><span class="w"> </span><span class="n">unreachable</span><span class="p">,</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">console</span>
</pre></div>

<p>See live demo.</p>
<p>Basically, if a variable that was not declared in its current scope is
assigned a value, then "a look up the scope chain occurs until it finds the
variable or hits the global scope (at which point it will create it)".</p>
<p>When in a browser environment (vs a server environment like nodejs) the global
scope is defined by the <code>window</code> object. Hence we can do
<code>window.myOtherFunction()</code>.</p>
<p>My "Good practices" tip on this topic is to <strong>always use<code>var</code> when defining
anything</strong>: whether it's a number, object or function, &amp; even when in the
global scope. This makes the code much simpler.</p>
<p>Note:</p>
<ul>
<li>javascript does <strong>not</strong> have <code>block scope</code> (Update: block scope local variables added in ES6.)</li>
<li>javascript has only <code>function scope</code> &amp; <code>global scope</code> (<code>window</code> scope in a browser environment)</li>
</ul>
<p>Read more about <code>Javascript Scopes</code>:</p>
<ul>
<li>What is the purpose of the var keyword and when to use it (or omit it)?</li>
<li>What is the scope of variables in JavaScript?</li>
</ul>
<hr>
<h2>Resources</h2>
<ul>
<li>youtu.be/i_qE1iAmjFg?t=2m15s - Paul Irish presents the IIFE at min 2:15, do watch this!</li>
<li>developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions</li>
<li>Book: Javascript, the good parts - highly recommended</li>
<li>youtu.be/i_qE1iAmjFg?t=4m36s - Paul Irish presents the module pattern at 4:36</li>
</ul>
<hr>
<h2>Next Steps</h2>
<p>Once you get this <code>IIFE</code> concept, it leads to the <code>module pattern</code>, which is
commonly done by leveraging this IIFE pattern. Have fun :)</p>
<p><br><br><a href="posts/what-is-the-purpose-of-wrapping-whole-javascript-files-in-anonymous-functions-like-function/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ru-he-fang-zhi-zhi-xing-pi-chu-li-wen-jian-hou-zi-dong-guan-bi-kong-zhi-tai/" class="u-url">如何防止执行批处理文件后自动关闭控制台</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ru-he-fang-zhi-zhi-xing-pi-chu-li-wen-jian-hou-zi-dong-guan-bi-kong-zhi-tai/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T21:26:54+08:00" itemprop="datePublished" title="2023-02-17 21:26">2023-02-17 21:26</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我可以在批处理文件末尾放置什么命令以防止在执行文件后自动关闭控制台？</p>
<p><br><br></p>
<h2>解答</h2>
<p>在 Windows/DOS 批处理文件中：</p>
<div class="code"><pre class="code literal-block"><span class="k">pause</span>
</pre></div>

<p>这会打印一条不错的<code>"Press any key to continue . . . "</code>消息</p>
<p>或者，如果您不想要该<code>"Press any key to continue . . ."</code>消息，请改为执行以下操作：</p>
<div class="code"><pre class="code literal-block"><span class="k">pause</span><span class="w"> </span><span class="o">&gt;</span><span class="nv">nul</span>
</pre></div>

<p><br></p>
<h3>更多建议</h3>
<p>取决于确切的问题！</p>
<p>通常在 <strong>.bat</strong><code>pause</code>文件中完成这项工作。 ****</p>
<p>如果您希望 <strong>cmd.exe</strong> 不关闭以便能够继续键入，请<code>cmd /k</code>在文件末尾使用命令。</p>
<p><br><br><a href="posts/how-to-prevent-auto-closing-of-console-after-the-execution-of-batch-file/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/wei-shi-yao-pageradapter-notifydatasetchanged-mei-you-geng-xin-shi-tu/" class="u-url">为什么 `PagerAdapter::notifyDataSetChanged` 没有更新视图？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/wei-shi-yao-pageradapter-notifydatasetchanged-mei-you-geng-xin-shi-tu/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T21:26:20+08:00" itemprop="datePublished" title="2023-02-17 21:26">2023-02-17 21:26</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我正在使用兼容性库中的 ViewPager。我已经成功地让它显示了几个我可以翻阅的视图。</p>
<p>但是，我很难弄清楚如何使用一组新的视图更新 ViewPager。</p>
<p>每次我想使用新的数据列表时，我都尝试过各种方法<code>mAdapter.notifyDataSetChanged()</code>，例如调用，甚至创建一个全新的适配器。<code>mViewPager.invalidate()</code></p>
<p>没有任何帮助，文本视图与原始数据保持不变。</p>
<p><strong>更新：</strong> 我做了一个小测试项目，我几乎可以更新视图了。我将在下面粘贴课程。</p>
<p>然而，似乎没有更新的是第二个视图，“B”仍然存在，按下更新按钮后它应该显示“Y”。</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ViewPagerBugActivity</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">ViewPager</span><span class="w"> </span><span class="n">myViewPager</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">main</span><span class="p">);</span>

<span class="w">        </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="nb nb-Type">String</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">data</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">"A"</span><span class="p">);</span>
<span class="w">        </span><span class="n">data</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">"B"</span><span class="p">);</span>
<span class="w">        </span><span class="n">data</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">"C"</span><span class="p">);</span>

<span class="w">        </span><span class="n">myViewPager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ViewPager</span><span class="p">)</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">my_view_pager</span><span class="p">);</span>
<span class="w">        </span><span class="n">myViewPager</span><span class="o">.</span><span class="n">setAdapter</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">MyViewPagerAdapter</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">));</span>

<span class="w">        </span><span class="n">Button</span><span class="w"> </span><span class="n">updateButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Button</span><span class="p">)</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">update_button</span><span class="p">);</span>
<span class="w">        </span><span class="n">updateButton</span><span class="o">.</span><span class="n">setOnClickListener</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">OnClickListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="err">@</span><span class="n">Override</span>
<span class="w">            </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">updateViewPager</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">updateViewPager</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">data</span><span class="o">.</span><span class="n">clear</span><span class="p">();</span>
<span class="w">        </span><span class="n">data</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">"X"</span><span class="p">);</span>
<span class="w">        </span><span class="n">data</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">"Y"</span><span class="p">);</span>
<span class="w">        </span><span class="n">data</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">"Z"</span><span class="p">);</span>
<span class="w">        </span><span class="n">myViewPager</span><span class="o">.</span><span class="n">getAdapter</span><span class="p">()</span><span class="o">.</span><span class="n">notifyDataSetChanged</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">MyViewPagerAdapter</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">PagerAdapter</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">        </span><span class="n">private</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="n">ctx</span><span class="p">;</span>

<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">MyViewPagerAdapter</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">this</span><span class="o">.</span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">;</span>
<span class="w">            </span><span class="n">this</span><span class="o">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="w"> </span><span class="n">instantiateItem</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">collection</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TextView</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">TextView</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
<span class="w">            </span><span class="n">view</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">position</span><span class="p">));</span>
<span class="w">            </span><span class="p">((</span><span class="n">ViewPager</span><span class="p">)</span><span class="n">collection</span><span class="p">)</span><span class="o">.</span><span class="n">addView</span><span class="p">(</span><span class="n">view</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">destroyItem</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">collection</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="w"> </span><span class="n">view</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">             </span><span class="p">((</span><span class="n">ViewPager</span><span class="p">)</span><span class="w"> </span><span class="n">collection</span><span class="p">)</span><span class="o">.</span><span class="n">removeView</span><span class="p">((</span><span class="n">View</span><span class="p">)</span><span class="w"> </span><span class="n">view</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">isViewFromObject</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">view</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="w"> </span><span class="n">object</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">object</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">Parcelable</span><span class="w"> </span><span class="n">saveState</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">restoreState</span><span class="p">(</span><span class="n">Parcelable</span><span class="w"> </span><span class="n">arg0</span><span class="p">,</span><span class="w"> </span><span class="n">ClassLoader</span><span class="w"> </span><span class="n">arg1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">startUpdate</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">arg0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">finishUpdate</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">arg0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><br><br></p>
<h2>解答</h2>
<p>有几种方法可以实现这一点。</p>
<p>第一个选项更容易，但效率更低。</p>
<p>像这样覆盖<code>getItemPosition</code>你<code>PagerAdapter</code>：</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">int</span><span class="w"> </span><span class="nv">getItemPosition</span><span class="ss">(</span><span class="nv">Object</span><span class="w"> </span><span class="nv">object</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">POSITION_NONE</span><span class="c1">;</span>
}
</pre></div>

<p>这样，当您调用时<code>notifyDataSetChanged()</code>，视图寻呼机将删除所有视图并重新加载它们。这样就获得了重新加载的效果。</p>
<p>Alvaro Luis Bustamante（以前的 alvarolb）建议的第二个选项是在实例化新视图时<code>setTag()</code>方法 in
。<code>instantiateItem()</code>然后<code>notifyDataSetChanged()</code>，您可以使用<code>findViewWithTag()</code>来查找要更新的视图，而不是使用
。</p>
<h3>结论</h3>
<p>如果您有很多视图，或者想要支持修改任何特定项目和/或视图（随时快速），那么第二种方法（标记）非常灵活且高性能，因为它可以防止重新创建所有未修改 <strong>的</strong>
视图.<br>
（感谢 alvarolb 的原创研究。）</p>
<p>但是，如果您的 App 只有“刷新”功能（甚至不允许更改单个项目），或者只有很少的项目，请使用第一种方法，因为它可以节省开发时间。</p>
<p><br></p>
<h3>更多建议</h3>
<p>我不认为在<code>PagerAdapter</code>. 问题是理解它是如何工作的有点复杂。查看此处解释的解决方案，存在误解，因此从我的角度来看实例化视图的使用不当。</p>
<p>最近几天我一直在使用<code>PagerAdapter</code>and <code>ViewPager</code>，我发现了以下内容：</p>
<p><code>notifyDataSetChanged()</code>上的方法只会<code>PagerAdapter</code>通知<code>ViewPager</code>基础页面已更改。例如，如果您动态地创建/删除了页面（从您的列表中添加或删除项目），则<code>ViewPager</code>应该注意这一点。在这种情况下，我认为
确定<code>ViewPager</code>是否应使用<code>getItemPosition()</code>和<code>getCount()</code>方法删除或实例化新视图。</p>
<p>我认为<code>ViewPager</code>，在<code>notifyDataSetChanged()</code>调用它的子视图并检查它们与<code>getItemPosition()</code>.
如果对于子视图此方法返回<code>POSITION_NONE</code>，则<code>ViewPager</code>理解该视图已被删除，调用<code>destroyItem()</code>并移除此视图。</p>
<p>这样，如果你只想更新页面的内容，重写<code>getItemPosition()</code>为总是返回<code>POSITION_NONE</code>是完全错误的，因为每次调用都会销毁之前创建的视图，并创建新的视图<code>notifyDatasetChanged()</code>。它可能看起来并没有那么错<code>TextView</code>，但是当你有复杂的视图时，比如从数据库中填充的
ListViews，这可能是一个真正的问题和资源浪费。</p>
<p>因此，有几种方法可以有效地更改视图的内容，而无需删除并再次实例化视图。这取决于您要解决的问题。
<strong>我的方法是将<code>setTag()</code>方法用于方法中的任何实例化视图<code>instantiateItem()</code>。因此，当您想要更改数据或使所需的视图无效时，您可以调用<code>findViewWithTag()</code>上的方法来<code>ViewPager</code>检索先前实例化的视图并根据需要修改/使用它，而不必每次都删除/创建新视图更新一些值。</strong></p>
<p>例如，假设您有 100 个页面，其中
100<code>TextView</code>秒并且您只想定期更新一个值。使用之前解释的方法，这意味着您要<code>TextView</code>在每次更新时删除和实例化 100
s。它没有任何意义...</p>
<p><br><br><a href="posts/why-pageradapter-notifydatasetchanged-is-not-updating-the-view/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-974.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-972.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
