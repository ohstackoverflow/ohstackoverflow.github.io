<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 741) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-741.html">
<link rel="prev" href="index-742.html" type="text/html">
<link rel="next" href="index-740.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/shi-yong-1-mb-ram-dui-100-mo-ge-8-wei-shi-jin-zhi-shu-zi-jin-xing-pai-xu/" class="u-url">使用 1 MB RAM 对 100 万个 8 位十进制数字进行排序</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/shi-yong-1-mb-ram-dui-100-mo-ge-8-wei-shi-jin-zhi-shu-zi-jin-xing-pai-xu/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T14:54:44+08:00" itemprop="datePublished" title="2023-02-17 14:54">2023-02-17 14:54</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我有一台 1 MB RAM 的计算机，没有其他本地存储。我必须使用它通过 TCP 连接接受 100 万个 8 位十进制数，对它们进行排序，然后通过另一个
TCP 连接发送排序后的列表。</p>
<p>数字列表可能包含重复项，我不能丢弃它们。代码将放在 ROM 中，所以我不需要从 1 MB 中减去代码的大小。我已经有了驱动以太网端口和处理 TCP/IP
连接的代码，它需要 2 KB 的状态数据，包括一个 1 KB 的缓冲区，代码将通过它读取和写入数据。这个问题有解决办法吗？</p>
<p><strong>问答来源：</strong></p>
<p>斜杠网</p>
<p>清洁网</p>
<p><br><br></p>
<h2>解答</h2>
<p>A solution is possible only because of the difference between 1 megabyte and 1
million bytes. There are about 2 to the power 8093729.5 different ways to
choose 1 million 8-digit numbers with duplicates allowed and order
unimportant, so a machine with only 1 million bytes of RAM doesn't have enough
states to represent all the possibilities. But 1M (less 2k for TCP/IP) is
1022<em>1024</em>8 = 8372224 bits, so a solution is possible.</p>
<p><strong>Part 1, initial solution</strong></p>
<p>This approach needs a little more than 1M, I'll refine it to fit into 1M
later.</p>
<p>I'll store a compact sorted list of numbers in the range 0 to 99999999 as a
sequence of sublists of 7-bit numbers. The first sublist holds numbers from 0
to 127, the second sublist holds numbers from 128 to 255, etc. 100000000/128
is exactly 781250, so 781250 such sublists will be needed.</p>
<p>Each sublist consists of a 2-bit sublist header followed by a sublist body.
The sublist body takes up 7 bits per sublist entry. The sublists are all
concatenated together, and the format makes it possible to tell where one
sublist ends and the next begins. The total storage required for a fully
populated list is 2<em>781250 + 7</em>1000000 = 8562500 bits, which is about 1.021
M-bytes.</p>
<p>The 4 possible sublist header values are:</p>
<p><strong>00</strong> Empty sublist, nothing follows.</p>
<p><strong>01</strong> Singleton, there is only one entry in the sublist and and next 7 bits
hold it.</p>
<p><strong>10</strong> The sublist holds at least 2 distinct numbers. The entries are stored
in non-decreasing order, except that the last entry is less than or equal to
the first. This allows the end of the sublist to be identified. For example,
the numbers 2,4,6 would be stored as (4,6,2). The numbers 2,2,3,4,4 would be
stored as (2,3,4,4,2).</p>
<p><strong>11</strong> The sublist holds 2 or more repetitions of a single number. The next 7
bits give the number. Then come zero or more 7-bit entries with the value 1,
followed by a 7-bit entry with the value 0. The length of the sublist body
dictates the number of repetitions. For example, the numbers 12,12 would be
stored as (12,0), the numbers 12,12,12 would be stored as (12,1,0),
12,12,12,12 would be (12,1,1,0) and so on.</p>
<p>I start off with an empty list, read a bunch of numbers in and store them as
32 bit integers, sort the new numbers in place (using heapsort, probably) and
then merge them into a new compact sorted list. Repeat until there are no more
numbers to read, then walk the compact list once more to generate the output.</p>
<p>The line below represents memory just before the start of the list merge
operation. The "O"s are the region that hold the sorted 32-bit integers. The
"X"s are the region that hold the old compact list. The "=" signs are the
expansion room for the compact list, 7 bits for each integer in the "O"s. The
"Z"s are other random overhead.</p>
<div class="code"><pre class="code literal-block">ZZZOOOOOOOOOOOOOOOOOOOOOOOOOO==========XXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></div>

<p>The merge routine starts reading at the leftmost "O" and at the leftmost "X",
and starts writing at the leftmost "=". The write pointer doesn't catch the
compact list read pointer until all of the new integers are merged, because
both pointers advance 2 bits for each sublist and 7 bits for each entry in the
old compact list, and there is enough extra room for the 7-bit entries for the
new numbers.</p>
<p><strong>Part 2, cramming it into 1M</strong></p>
<p>To Squeeze the solution above into 1M, I need to make the compact list format
a bit more compact. I'll get rid of one of the sublist types, so that there
will be just 3 different possible sublist header values. Then I can use "00",
"01" and "1" as the sublist header values and save a few bits. The sublist
types are:</p>
<p>A Empty sublist, nothing follows.</p>
<p>B Singleton, there is only one entry in the sublist and and next 7 bits hold
it.</p>
<p>C The sublist holds at least 2 distinct numbers. The entries are stored in
non-decreasing order, except that the last entry is less than or equal to the
first. This allows the end of the sublist to be identified. For example, the
numbers 2,4,6 would be stored as (4,6,2). The numbers 2,2,3,4,4 would be
stored as (2,3,4,4,2).</p>
<p>D The sublist consists of 2 or more repetitions of a single number.</p>
<p>My 3 sublist header values will be "A", "B" and "C", so I need a way to
represent D-type sublists.</p>
<p>Suppose I have the C-type sublist header followed by 3 entries, such as
"C[17][101][58]". This can't be part of a valid C-type sublist as described
above, since the third entry is less than the second but more than the first.
I can use this type of construct to represent a D-type sublist. In bit terms,
anywhere I have "C{00?????}{1??????}{01?????}" is an impossible C-type
sublist. I'll use this to represent a sublist consisting of 3 or more
repetitions of a single number. The first two 7-bit words encode the number
(the "N" bits below) and are followed by zero or more {0100001} words followed
by a {0100000} word.</p>
<div class="code"><pre class="code literal-block"><span class="k">For</span><span class="w"> </span><span class="nv">example</span>,<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nv">repetitions</span>:<span class="w"> </span><span class="s2">"C{00NNNNN}{1NN0000}{0100000}"</span>,<span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="nv">repetitions</span>:<span class="w"> </span><span class="s2">"C{00NNNNN}{1NN0000}{0100001}{0100000}"</span>,<span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">so</span><span class="w"> </span><span class="nv">on</span>.
</pre></div>

<p>That just leaves lists that hold exactly 2 repetitions of a single number.
I'll represent those with another impossible C-type sublist pattern:
"C{0??????}{11?????}{10?????}". There's plenty of room for the 7 bits of the
number in the first 2 words, but this pattern is longer than the sublist that
it represents, which makes things a bit more complex. The five question-marks
at the end can be considered not part of the pattern, so I have:
"C{0NNNNNN}{11N????}10" as my pattern, with the number to be repeated stored
in the "N"s. That's 2 bits too long.</p>
<p>I'll have to borrow 2 bits and pay them back from the 4 unused bits in this
pattern. When reading, on encountering "C{0NNNNNN}{11N00AB}10", output 2
instances of the number in the "N"s, overwrite the "10" at the end with bits A
and B, and rewind the read pointer by 2 bits. Destructive reads are ok for
this algorithm, since each compact list gets walked only once.</p>
<p>When writing a sublist of 2 repetitions of a single number, write
"C{0NNNNNN}11N00" and set the borrowed bits counter to 2. At every write where
the borrowed bits counter is non-zero, it is decremented for each bit written
and "10" is written when the counter hits zero. So the next 2 bits written
will go into slots A and B, and then the "10" will get dropped onto the end.</p>
<p>With 3 sublist header values represented by "00", "01" and "1", I can assign
"1" to the most popular sublist type. I'll need a small table to map sublist
header values to sublist types, and I'll need an occurrence counter for each
sublist type so that I know what the best sublist header mapping is.</p>
<p>The worst case minimal representation of a fully populated compact list occurs
when all the sublist types are equally popular. In that case I save 1 bit for
every 3 sublist headers, so the list size is 2<em>781250 + 7</em>1000000 - 781250/3 =
8302083.3 bits. Rounding up to a 32 bit word boundary, thats 8302112 bits, or
1037764 bytes.</p>
<p>1M minus the 2k for TCP/IP state and buffers is 1022*1024 = 1046528 bytes,
leaving me 8764 bytes to play with.</p>
<p>But what about the process of changing the sublist header mapping ? In the
memory map below, "Z" is random overhead, "=" is free space, "X" is the
compact list.</p>
<div class="code"><pre class="code literal-block">ZZZ=====XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></div>

<p>Start reading at the leftmost "X" and start writing at the leftmost "=" and
work right. When it's done the compact list will be a little shorter and it
will be at the wrong end of memory:</p>
<div class="code"><pre class="code literal-block">ZZZXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX=======
</pre></div>

<p>So then I'll need to shunt it to the right:</p>
<div class="code"><pre class="code literal-block">ZZZ=======XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</pre></div>

<p>In the header mapping change process, up to 1/3 of the sublist headers will be
changing from 1-bit to 2-bit. In the worst case these will all be at the head
of the list, so I'll need at least 781250/3 bits of free storage before I
start, which takes me back to the memory requirements of the previous version
of the compact list :(</p>
<p>To get around that, I'll split the 781250 sublists into 10 sublist groups of
78125 sublists each. Each group has its own independent sublist header
mapping. Using the letters A to J for the groups:</p>
<div class="code"><pre class="code literal-block">ZZZ=====AAAAAABBCCCCDDDDDEEEFFFGGGGGGGGGGGHHIJJJJJJJJJJJJJJJJJJJJ
</pre></div>

<p>Each sublist group shrinks or stays the same during a sublist header mapping
change:</p>
<div class="code"><pre class="code literal-block">ZZZ=====AAAAAABBCCCCDDDDDEEEFFFGGGGGGGGGGGHHIJJJJJJJJJJJJJJJJJJJJ
ZZZAAAAAA=====BBCCCCDDDDDEEEFFFGGGGGGGGGGGHHIJJJJJJJJJJJJJJJJJJJJ
ZZZAAAAAABB=====CCCCDDDDDEEEFFFGGGGGGGGGGGHHIJJJJJJJJJJJJJJJJJJJJ
ZZZAAAAAABBCCC======DDDDDEEEFFFGGGGGGGGGGGHHIJJJJJJJJJJJJJJJJJJJJ
ZZZAAAAAABBCCCDDDDD======EEEFFFGGGGGGGGGGGHHIJJJJJJJJJJJJJJJJJJJJ
ZZZAAAAAABBCCCDDDDDEEE======FFFGGGGGGGGGGGHHIJJJJJJJJJJJJJJJJJJJJ
ZZZAAAAAABBCCCDDDDDEEEFFF======GGGGGGGGGGGHHIJJJJJJJJJJJJJJJJJJJJ
ZZZAAAAAABBCCCDDDDDEEEFFFGGGGGGGGGG=======HHIJJJJJJJJJJJJJJJJJJJJ
ZZZAAAAAABBCCCDDDDDEEEFFFGGGGGGGGGGHH=======IJJJJJJJJJJJJJJJJJJJJ
ZZZAAAAAABBCCCDDDDDEEEFFFGGGGGGGGGGHHI=======JJJJJJJJJJJJJJJJJJJJ
ZZZAAAAAABBCCCDDDDDEEEFFFGGGGGGGGGGHHIJJJJJJJJJJJJJJJJJJJJ=======
ZZZ=======AAAAAABBCCCDDDDDEEEFFFGGGGGGGGGGHHIJJJJJJJJJJJJJJJJJJJJ
</pre></div>

<p>The worst case temporary expansion of a sublist group during a mapping change
is 78125/3 = 26042 bits, under 4k. If I allow 4k plus the 1037764 bytes for a
fully populated compact list, that leaves me 8764 - 4096 = 4668 bytes for the
"Z"s in the memory map.</p>
<p>That should be plenty for the 10 sublist header mapping tables, 30 sublist
header occurrence counts and the other few counters, pointers and small
buffers I'll need, and space I've used without noticing, like stack space for
function call return addresses and local variables.</p>
<p><strong>Part 3, how long would it take to run?</strong></p>
<p>With an empty compact list the 1-bit list header will be used for an empty
sublist, and the starting size of the list will be 781250 bits. In the worst
case the list grows 8 bits for each number added, so 32 + 8 = 40 bits of free
space are needed for each of the 32-bit numbers to be placed at the top of the
list buffer and then sorted and merged. In the worst case, changing the
sublist header mapping results in a space usage of 2<em>781250 + 7</em>entries -
781250/3 bits.</p>
<p>With a policy of changing the sublist header mapping after every fifth merge
once there are at least 800000 numbers in the list, a worst case run would
involve a total of about 30M of compact list reading and writing activity.</p>
<p><strong>Source:</strong></p>
<p><strong>http://nick.cleaton.net/ramsortsol.html</strong></p>
<p><br></p>
<h3>更多建议</h3>
<p>这是一些解决问题的有效 C++ 代码。</p>
<p><del>满足内存约束的证明：</del></p>
<p><strong>编者：</strong>
无论是在这篇文章还是在他的博客中，都没有证明作者提供的最大内存要求。由于编码一个值所需的位数取决于先前编码的值，因此这样的证明可能很重要。作者指出，他根据经验偶然发现的最大编码大小是<code>1011732</code>，并任意选择了缓冲区大小<code>1013000</code>。</p>
<div class="code"><pre class="code literal-block"><span class="n">typedef</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">u32</span><span class="p">;</span>

<span class="n">namespace</span><span class="w"> </span><span class="n">WorkArea</span>
<span class="err">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">circularSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">253250</span><span class="p">;</span>
<span class="w">    </span><span class="n">u32</span><span class="w"> </span><span class="n">circular</span><span class="o">[</span><span class="n">circularSize</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">}</span><span class="p">;</span><span class="w">         </span><span class="o">//</span><span class="w"> </span><span class="n">consumes</span><span class="w"> </span><span class="mi">1013000</span><span class="w"> </span><span class="n">bytes</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="n">u32</span><span class="w"> </span><span class="n">stageSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8000</span><span class="p">;</span>
<span class="w">    </span><span class="n">u32</span><span class="w"> </span><span class="n">stage</span><span class="o">[</span><span class="n">stageSize</span><span class="o">]</span><span class="p">;</span><span class="w">                       </span><span class="o">//</span><span class="w"> </span><span class="n">consumes</span><span class="w"> </span><span class="mi">32000</span><span class="w"> </span><span class="n">bytes</span>

<span class="w">    </span><span class="p">...</span>
</pre></div>

<p>这两个数组一起占用 1045000 字节的存储空间。剩下 1048576 - 1045000 - 2×1024 = 1528 字节用于剩余变量和堆栈空间。</p>
<p>它在我的 Xeon W3520 上运行大约 23 秒。您可以使用以下 Python 脚本验证该程序是否正常工作，假设程序名称为<code>sort1mb.exe</code>.</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">99999999</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)]</span>

<span class="n">sorter</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="s1">'sort1mb.exe'</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
<span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
    <span class="n">sorter</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="si">%08d</span><span class="se">\n</span><span class="s1">'</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
<span class="n">sorter</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sorter</span><span class="o">.</span><span class="n">stdout</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'OK!'</span> <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span> <span class="k">else</span> <span class="s1">'Error!'</span><span class="p">)</span>
</pre></div>

<p>该算法的详细解释可以在以下系列帖子中找到：</p>
<ul>
<li>1MB 排序说明</li>
<li>算术编码和 1MB 排序问题</li>
<li>使用定点数学的算术编码</li>
</ul>
<p><br><br><a href="posts/sorting-1-million-8-decimal-digit-numbers-with-1-mb-of-ram/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/php-jie-xi-yu-fa-cuo-wu-yi-ji-ru-he-jie-jue-ta-men/" class="u-url">PHP 解析/语法错误；以及如何解决它们</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/php-jie-xi-yu-fa-cuo-wu-yi-ji-ru-he-jie-jue-ta-men/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T14:54:14+08:00" itemprop="datePublished" title="2023-02-17 14:54">2023-02-17 14:54</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>每个人都会遇到语法错误。即使是有经验的程序员也会犯错别字。对于新人来说，这只是学习过程的一部分。但是，通常很容易解释错误消息，例如：</p>
<blockquote>
<p>PHP 解析错误：语法错误，第 20 行的 index.php 中出现意外的“{”</p>
</blockquote>
<p>意想不到的符号并不总是真正的罪魁祸首。但是行号给出了从哪里开始查找的粗略概念。</p>
<blockquote>
<p>始终查看 <strong>代码上下文</strong> 。语法错误通常隐藏在提到的 <em>或</em> <strong>前面的代码行</strong> 中。将您的代码与手册中的语法示例进行比较。</p>
</blockquote>
<p>虽然并非每个案例都相互匹配。然而，有一些通用步骤可以 <strong>解决语法错误</strong> 。该参考资料总结了常见的陷阱：</p>
<ul>
<li>
<p>意外的 T_STRING</p>
</li>
<li>
<p>意外的 T_VARIABLE<br>
意外的“$varname”（T_VARIABLE）</p>
</li>
<li>
<p>意外的 T_CONSTANT_ENCAPSED_STRING<br>
意外的 T_ENCAPSED_AND_WHITESPACE</p>
</li>
<li>
<p>意外的 $end</p>
</li>
<li>
<p>意外的 T_FUNCTION …</p>
</li>
<li>
<p>意外意外<code>{</code><br>
意外<code>}</code><br>
意外<code>(</code><br>
意外<code>)</code></p>
</li>
<li>
<p>意外<code>[</code><br>
意外<code>]</code></p>
</li>
<li>
<p>意外 T_IF<br>
意外 T_FOREACH<br>
意外 T_FOR<br>
意外 T_WHILE<br>
意外 T_DO<br>
意外 T_PRINT<br>
意外 T_ECHO</p>
</li>
<li>
<p>意外的 T_LNUMBER</p>
</li>
<li>
<p>出乎意料？</p>
</li>
<li>
<p>意外继续 (T_CONTINUE)<br>
意外继续 (T_BREAK)<br>
意外继续 (T_RETURN)</p>
</li>
<li>
<p>意外的“=”</p>
</li>
<li>
<p>意外的 T_INLINE_HTML …</p>
</li>
<li>
<p>意外的 T_PAAMAYIM_NEKUDOTAYIM …</p>
</li>
<li>
<p>意外的 T_OBJECT_OPERATOR …</p>
</li>
<li>
<p>意外的 T_DOUBLE_ARROW …</p>
</li>
<li>
<p>意外的 T_SL …</p>
</li>
<li>
<p>意外的 T_BOOLEAN_OR ...<br>
意外的 T_BOOLEAN_AND ...</p>
</li>
<li>
<p>意外 T_IS_EQUAL<br>
意外 T_IS_GREATER_OR_EQUAL<br>
意外 T_IS_IDENTICAL<br>
意外 T_IS_NOT_EQUAL<br>
意外 T_IS_NOT_IDENTICAL<br>
意外 T_IS_SMALLER_OR_EQUAL<br>
意外<code>&lt;</code><br>
意外<code>&gt;</code></p>
</li>
<li>
<p>意外的 T_NS_SEPARATOR …</p>
</li>
<li>
<p>输入中的意外字符：' <code>\</code>' (ASCII=92) state=1</p>
</li>
<li>
<p>意外的“公共”(T_PUBLIC)<br>
意外的“私有”(T_PRIVATE)<br>
意外的“受保护”(T_PROTECTED)<br>
意外的“最终”(T_FINAL) ...</p>
</li>
<li>
<p>意外的 T_STATIC …</p>
</li>
<li>
<p>意外的 T_CLASS …</p>
</li>
<li>
<p>意外的“使用”（T_USE）</p>
</li>
<li>
<p>意外的 T_DNUMBER</p>
</li>
<li>
<p>意外<code>,</code> <em>（逗号）</em></p>
</li>
<li>
<p>意外<code>.</code> <em>（期间）</em></p>
</li>
<li>
<p>意外<code>;</code> <em>（分号）</em></p>
</li>
<li>
<p>意外<code>*</code> <em>（星号）</em></p>
</li>
<li>
<p>意外<code>:</code> <em>（冒号）</em></p>
</li>
<li>
<p>意外的 ':'，期待 ',' 或 ')'</p>
</li>
<li>
<p>意外<code>&amp;</code>（调用时间传递引用）</p>
</li>
<li>
<p>意外<code>.</code></p>
</li>
</ul>
<p>密切相关的参考资料：</p>
<ul>
<li>这个错误在 PHP 中意味着什么？（运行时错误）<ul>
<li>解析错误：语法错误，意外的 T_XXX</li>
<li>解析错误：语法错误，意外的 T_ENCAPSED_AND_WHITESPACE</li>
<li>解析错误：语法错误，意外的 T_VARIABLE</li>
</ul>
</li>
<li>这个符号在 PHP 中是什么意思？（语言标记）</li>
<li>那些<code>“”</code>智能<code>‘’</code>引号对 PHP 毫无意义</li>
</ul>
<p>和：</p>
<ul>
<li>php.net 上的 PHP 手册及其各种语言标记</li>
<li>或者维基百科关于PHP的语法介绍。</li>
<li>最后当然是我们的 <strong>php</strong> tag-wiki。</li>
</ul>
<p>虽然 Stack Overflow 也欢迎菜鸟程序员，但它主要针对专业编程问题。</p>
<ul>
<li>回答每个人的编码错误和狭窄的拼写错误大多被认为是题外话。</li>
<li>因此，在发布语法修复请求之前，请花时间遵循基本步骤。</li>
<li>如果您仍然需要，请展示您自己的解决主动性、尝试修复以及您对看起来或可能是错误的地方的思考过程。</li>
</ul>
<p>如果您的 <em>浏览器</em> 显示诸如“SyntaxError: illegal character”之类的错误消息，那么它实际上并不是PHP-
相关的，但是javascript-语法错误。</p>
<hr>
<p><strong>供应商代码引发的语法错误：</strong> 最后，考虑如果语法错误不是通过编辑代码库引发的，而是在安装或升级外部供应商包后，可能是由于 PHP
版本不兼容，因此请检查供应商对您的平台的要求设置。</p>
<p><br><br></p>
<h2>解答</h2>
<h4>什么是语法错误？</h4>
<p>PHP 属于C 风格和命令式编程语言。它具有严格的语法规则，在遇到放错位置的符号或标识符时无法从中恢复。它无法猜测您的编码意图。</p>
<p><img alt="函数定义语法摘要" src="images/jY6k7.gif"></p>
<h4>最重要的提示</h4>
<p>您可以随时采取一些基本预防措施：</p>
<ul>
<li>
<p>使用适当的 <strong>代码缩进</strong> ，或采用任何高级编码风格。可读性可以防止违规行为。</p>
</li>
<li>
<p>使用带有 <strong>语法高亮显示</strong> 的 PHP <strong><em>IDE</em></strong> 或编辑器。这也有助于括号/括号平衡。 ****</p>
</li>
</ul>
<p><img alt="预期：分号" src="images/z2FBC.png"></p>
<ul>
<li>阅读手册中的语言参考和示例。两次，变得有些熟练。</li>
</ul>
<h4>如何解释解析器错误</h4>
<p>典型的语法错误消息如下：</p>
<blockquote>
<p>解析错误：语法错误，意外的 <strong>T_STRING</strong> ，期待 <em>file.php</em> 中的 <strong>“<code>;</code>”</strong>在第 <em>217</em> <strong>行</strong> <strong>
****</strong></p>
</blockquote>
<p>其中列出了语法错误的 <em>可能位置。</em> 请参阅提到的 <strong>文件名</strong> 和 <strong>行号</strong> 。</p>
<p>诸如解释解析器/标记器最终无法处理哪个符号的名字。<code>T_STRING</code>但是，这不一定是语法错误的原因。</p>
<p>查看 <strong>以前的代码行</strong> 也很重要。通常语法错误只是之前发生的意外。错误行号正是解析器最终放弃处理所有错误的地方。</p>
<h3>解决语法错误</h3>
<p>有很多方法可以缩小和修复语法问题。</p>
<ul>
<li>
<p>打开提到的源文件。查看提到的 <strong>代码行</strong> 。</p>
<ul>
<li>
<p>对于失控的字符串和放错位置的运算符，这通常是您找到罪魁祸首的地方。</p>
</li>
<li>
<p>从左到右阅读该行并想象每个符号的作用。</p>
</li>
</ul>
</li>
<li>
<p>您还需要更频繁地查看 <strong>前面的行。</strong></p>
<ul>
<li>
<p>特别是，<code>;</code>在前一行结束/语句中缺少分号。（至少从文体的角度来看。）</p>
</li>
<li>
<p>如果<code>{</code>代码块<code>}</code>被错误地关闭或嵌套，您可能需要进一步调查源代码。使用适当的 <em>代码缩进</em> 来简化它。</p>
</li>
</ul>
</li>
<li>
<p>看看 <strong>语法着色</strong> ！</p>
<ul>
<li>
<p>字符串、变量和常量都应该有不同的颜色。</p>
</li>
<li>
<p>运算符<code>+-*/.</code>也应该有不同的颜色。否则他们可能处于错误的上下文中。</p>
</li>
<li>
<p>如果您看到字符串着色延伸得太远或太短，那么您发现了一个未转义或丢失的关闭<code>"</code>或<code>'</code>字符串标记。</p>
</li>
<li>
<p>两个相同颜色的标点字符相邻也可能意味着麻烦。通常，如果运算符后面不是<code>++</code>、<code>--</code>或括号，则运算符是单独的。在大多数情况下，两个直接紧随其后的字符串/标识符是不正确的。</p>
</li>
</ul>
</li>
<li>
<p><strong>空格是你的朋友</strong> 。遵循 <em>任何</em> 编码风格。</p>
</li>
<li>
<p>暂时打破排长队。</p>
<ul>
<li>
<p>您可以在运算符或常量和字符串之间自由 <strong>添加换行符</strong> 。然后，解析器会将解析错误的行号具体化。您可以隔离丢失或放错位置的语法符号，而不是查看非常冗长的代码。</p>
</li>
<li>
<p><code>if</code>将复杂的语句拆分为不同的或嵌套的<code>if</code>条件。</p>
</li>
<li>
<p>使用临时变量来简化代码，而不是冗长的数学公式或逻辑链。（可读性更高 = 错误更少。）</p>
</li>
<li>
<p>在以下之间添加换行符：</p>
</li>
<li>
<p>您可以轻松识别为正确的代码，</p>
</li>
<li>你不确定的部分，</li>
<li>以及解析器抱怨的行。  </li>
</ul>
</li>
</ul>
<p>分割长代码块 <em>确实</em> 有助于定位语法错误的来源。</p>
<ul>
<li>
<p><strong>注释掉</strong> 有问题的代码。</p>
<ul>
<li>
<p>如果您不能隔离问题源，请开始注释掉（并因此暂时删除）代码块。</p>
</li>
<li>
<p>一旦你摆脱了解析错误，你就找到了问题的根源。仔细看看那里。</p>
</li>
<li>
<p>有时你想暂时删除完整的函数/方法块。（在大括号不匹配和代码缩进错误的情况下。）</p>
</li>
<li>
<p>当您无法解决语法问题时，请尝试 <strong>从头开始</strong> <strong>重写</strong> 被注释掉的部分。 ****</p>
</li>
</ul>
</li>
<li>
<p>作为新手，请避免一些令人困惑的语法结构。</p>
<ul>
<li>
<p>三元<code>? :</code>条件运算符可以压缩代码，确实很有用。但它并不在所有情况下都有助于提高可读性。不熟悉时更喜欢简单的<code>if</code>陈述。</p>
</li>
<li>
<p>PHP 的替代语法 ( <code>if:</code>/ <code>elseif:</code>/ ) 对于模板很常见，但可以说比普通代码块<code>endif;</code>更难理解。<code>{``}</code></p>
</li>
</ul>
</li>
<li>
<p>最普遍的新手错误是：</p>
<ul>
<li>
<p><code>;</code>终止语句/行缺少分号。</p>
</li>
<li>
<p><code>"</code>or的不匹配字符串引号<code>'</code>和其中的未转义引号。</p>
</li>
<li>
<p>被遗忘的运算符，特别是对于字符串<code>.</code>连接。</p>
</li>
<li>
<p>不平衡的<code>(</code>括号<code>)</code>。在报告的行中计算它们。它们的数量相等吗？</p>
</li>
</ul>
</li>
<li>
<p>不要忘记解决一个语法问题可以发现下一个语法问题。</p>
<ul>
<li>
<p>如果您解决了一个问题，但在下面的某些代码中出现了其他问题，那么您基本上是在正确的道路上。</p>
</li>
<li>
<p>如果在编辑后同一行出现新的语法错误，那么您尝试的更改可能是失败的。（虽然并不总是。）</p>
</li>
</ul>
</li>
<li>
<p>如果无法修复，请恢复以前工作代码的备份。</p>
<ul>
<li>采用源代码版本控制系统。您始终可以查看<code>diff</code>损坏的和最后一个工作版本。这可能对语法问题是什么很有启发。  </li>
</ul>
</li>
<li>
<p><strong>不可见的杂散 Unicode 字符</strong> ：在某些情况下，您需要在源代码上使用十六进制编辑器或不同的编辑器/查看器。有些问题不能仅通过查看您的代码来发现。</p>
<ul>
<li>
<p>尝试<code>grep --color -P -n "\[\x80-\xFF\]" file.php</code>作为查找非 ASCII 符号的第一个措施。</p>
</li>
<li>
<p>特别是 BOM、零宽度空格或不间断空格，以及智能引号经常可以找到进入源代码的方式。</p>
</li>
</ul>
</li>
<li>
<p>注意保存在文件中 <strong>的换行符类型。</strong></p>
<ul>
<li>
<p>PHP 只接受<code>\n</code>换行符，不接受<code>\r</code>回车符。</p>
</li>
<li>
<p>对于 MacOS 用户来说，这偶尔是个问题（即使在 OS X 上配置错误的编辑器）。</p>
</li>
<li>
<p>它通常仅在使用单行<code>//</code>或注释时才作为问题出现。<code>#</code>当换行符被忽略时，多行<code>/*...*/</code>注释很少会干扰解析器。</p>
</li>
</ul>
</li>
<li>
<p>如果您的 <strong>语法错误没有通过网络传输</strong> ：碰巧您的机器上有语法错误。但是在线发布完全相同的文件不再显示它。这只能意味着两件事之一：</p>
<ul>
<li>
<p>您正在查看错误的文件！</p>
</li>
<li>
<p>或者您的代码包含不可见的杂散 Unicode（见上文）。您可以很容易地发现：只需将代码从 Web 表单复制回文本编辑器即可。</p>
</li>
</ul>
</li>
<li>
<p>检查您的 <strong>PHP 版本</strong> 。并非所有语法结构在每台服务器上都可用。</p>
<ul>
<li>
<p><code>php -v</code>对于命令行解释器</p>
</li>
<li>
<p><code>&lt;?php phpinfo();</code>对于通过网络服务器调用的那个。</p>
</li>
</ul>
</li>
</ul>
<p>这些不一定相同。特别是在使用框架时，您会希望它们匹配。</p>
<ul>
<li>
<p>不要使用PHP 的保留关键字作为函数/方法、类或常量的标识符。</p>
</li>
<li>
<p>反复试验是您最后的选择。</p>
</li>
</ul>
<p>如果一切都失败了，你可以随时 <strong>用谷歌搜索</strong> 你的错误信息。语法符号不那么容易搜索（尽管 Stack Overflow
本身由SymbolHound索引）。因此，您可能需要多翻几页才能找到相关内容。</p>
<p>更多指南：</p>
<ul>
<li>__David Sklar 的 <em>PHP 调试基础知识</em>
</li>
<li>__Jason McCreary <em>修复 PHP 错误</em>
</li>
<li>
<em>PHP 错误 – 10 个常见错误</em> Mario Lurig</li>
<li><em>常见的 PHP 错误和解决方案</em></li>
<li><em>如何对您的 WordPress 网站进行故障排除和修复</em></li>
<li>
<em>给设计师的 PHP 错误信息指南</em> - Smashing Magazine</li>
</ul>
<h4>死亡白屏</h4>
<p>如果您的网站只是空白，则通常是语法错误。启用他们的显示：</p>
<ul>
<li><code>error_reporting = E_ALL</code></li>
<li><code>display_errors = 1</code></li>
</ul>
<p>在您的<code>php.ini</code>一般情况下，或通过<code>.htaccess</code>mod_php，甚至<code>.user.ini</code>使用 FastCGI 设置。</p>
<p>在损坏的脚本中启用它为时已晚，因为 PHP 甚至无法解释/运行第一行。一个快速的解决方法是制作一个包装器脚本，比如<code>test.php</code>：</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
   <span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span><span class="p">);</span>
   <span class="nb">ini_set</span><span class="p">(</span><span class="s2">"display_errors"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
   <span class="k">include</span><span class="p">(</span><span class="s2">"./broken-script.php"</span><span class="p">);</span>
</pre></div>

<p>然后通过访问此包装器脚本来调用失败的代码。</p>
<p>当脚本因 HTTP 500 响应而崩溃时，它还有助于启用 PHP<code>error_log</code>并查看您的网络服务器。<code>error.log</code></p>
<p><br></p>
<h3>更多建议</h3>
<p>我认为这个话题完全被过度讨论/过于复杂。使用 IDE 是完全避免任何语法错误的方法。我什至会说没有 IDE 的工作有点不专业。为什么？因为现代 IDE
在您键入每个字符后都会检查您的语法。当您编写代码并且您的整行都变成红色时，并且一个大警告通知会向您显示语法错误的确切类型和确切位置，那么绝对没有必要寻找其他解决方案。</p>
<h3>使用语法检查 IDE 意味着：</h3>
<p><strong>您将（有效地）永远不会再遇到语法错误，这仅仅是因为您在键入时看到它们是正确的。 严重地。</strong></p>
<p><em>具有语法检查功能的优秀 IDE（它们都适用于 Linux、Windows 和 Mac）：</em></p>
<ol>
<li>NetBeans [免费]</li>
<li>PHPStorm [199 美元]</li>
<li>带PHP 插件的Eclipse [免费]</li>
<li>Sublime [$80 USD]（主要是文本编辑器，但可通过插件扩展，如PHP Syntax Parser）</li>
</ol>
<p><br><br><a href="posts/php-parse-syntax-errors-and-how-to-solve-them/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/he-shi-zai-mysql-zhong-shi-yong-dan-yin-hao-shuang-yin-hao-he-fan-yin-hao/" class="u-url">何时在 MySQL 中使用单引号、双引号和反引号</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/he-shi-zai-mysql-zhong-shi-yong-dan-yin-hao-shuang-yin-hao-he-fan-yin-hao/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T14:53:44+08:00" itemprop="datePublished" title="2023-02-17 14:53">2023-02-17 14:53</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我正在尝试学习编写查询的最佳方式。我也明白保持一致的重要性。直到现在，我都没有经过深思熟虑就随意使用了单引号、双引号和反引号。</p>
<p>例子：</p>
<div class="code"><pre class="code literal-block">$query = 'INSERT INTO table (id, col1, col2) VALUES (NULL, val1, val2)';
</pre></div>

<p>此外，在上面的示例中，考虑<code>table</code>、<code>col1</code>、<code>val1</code>等可能是变量。</p>
<p>这个的标准是什么？你做什么工作？</p>
<p>我已经在这里阅读类似问题的答案大约 20 分钟，但似乎这个问题没有明确的答案。</p>
<p><br><br></p>
<h2>解答</h2>
<p>反引号用于表和列标识符，但仅当标识符是MySQL
保留关键字或标识符包含空白字符或超出有限集合的字符时才需要（见下文）通常建议避免使用保留关键字尽可能作为列或表标识符，避免引用问题。</p>
<p>单引号应该用于<code>VALUES()</code>列表中的字符串值。MySQL 也支持对字符串值使用双引号，但其他 RDBMS
更广泛地接受单引号，因此使用单引号而不是双引号是一个好习惯。</p>
<p>MySQL 还期望<code>DATE</code>和<code>DATETIME</code>文字值被单引号作为字符串，如<code>'2001-01-01 00:00:00'</code>.
有关更多详细信息，请参阅日期和时间文字文档，特别是<code>-</code>在日期字符串中使用连字符作为段定界符的替代方法。</p>
<p>因此，使用您的示例，我会双引号 PHP 字符串并在 values 上使用单引号<code>'val1', 'val2'</code>。<code>NULL</code>是 MySQL
关键字和特殊（非）值，因此未加引号。</p>
<p>这些表或列标识符都不是保留字或使用需要引号的字符，但无论如何我都用反引号引用了它们（稍后会详细介绍......）。</p>
<p>RDBMS 的原生函数（例如，<code>NOW()</code>在 MySQL 中）不应被引用，尽管它们的参数受制于已经提到的相同字符串或标识符引用规则。</p>
<div class="code"><pre class="code literal-block"><span class="n">反引号</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`)</span>
<span class="n n-Quoted">表格和列────────┬──────┬──┬──┬──┬──────┬──┬──────┬──┬────┬──┬ ────────┐</span>
<span class="n n-Quoted">                      ↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span>
<span class="n n-Quoted">$query = " **INSERT INTO `</span><span class="k">table</span><span class="n n-Quoted">` (`</span><span class="n">id</span><span class="n n-Quoted">`, `</span><span class="n">col1</span><span class="n n-Quoted">`, `</span><span class="n">col2</span><span class="n n-Quoted">`, `</span><span class="kt">date</span><span class="n n-Quoted">`, `</span><span class="n">updated</span><span class="n n-Quoted">`)</span>
<span class="n n-Quoted">                       VALUES (NULL, 'val1', 'val2', '2001-01-01', NOW())** ";</span>
<span class="n n-Quoted">                               ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span>
<span class="n n-Quoted">未加引号的关键字──────┴┴┴┘ │ │ │ │ │ │ │││││</span>
<span class="n n-Quoted">单引号 (') 字符串 ────────────┴──────┴──┴────┘ │ │ │││││</span>
<span class="n n-Quoted">单引号 (') DATE ────────────────────────────┴──────────┘ ││││ │</span>
<span class="n n-Quoted">未引用的函数──────────────────────────────────────────┴┴┴┴┘</span>
</pre></div>

<h4>变量插值</h4>
<p>变量的引号模式不会改变，但如果您打算直接在字符串中插入变量，则必须在 PHP 中使用双引号。只需确保您已正确转义用于 SQL
的变量。（建议改用支持准备好的语句的 API，以防止 SQL 注入）。</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">与一些变量替换相同</span>
<span class="o">//</span><span class="w"> </span><span class="n">这里一个变量表名</span><span class="w"> </span><span class="n">$table</span><span class="w"> </span><span class="n">是反引号，变量</span>
<span class="o">//</span><span class="w"> </span><span class="n">在</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="n">列表中是单引号</span>
<span class="n">$query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"INSERT INTO **`$table`** (`id`, `col1`, `col2`, `date`) VALUES (NULL, **'$val1'** , **'$val2'** , **'$date'** )"</span><span class="p">;</span>
</pre></div>

<h4>准备好的陈述</h4>
<p>使用准备好的语句时，请查阅文档以确定是否必须引用语句的占位符。PHP、PDO 和 MySQLi 中最流行的 API 需要 <em>不带</em>
引号的占位符，其他语言中的大多数准备好的语句 API 也是如此：</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">PDO</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="n">unquoted</span>
<span class="n">$query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"INSERT INTO `table` (`id`, `col1`, `col2`, `date`) VALUES (:id, :col1, :col2, :date)"</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">MySQLi</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="nv">?</span><span class="w"> </span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="n">unquoted</span>
<span class="n">$query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"INSERT INTO `table` (`id`, `col1`, `col2`, `date`) VALUES (?, ?, ?, ?)"</span><span class="p">;</span>
</pre></div>

<h4>标识符中需要反引号的字符：</h4>
<p>根据 MySQL 文档，您不需要使用以下字符集引用（反引号）标识符：</p>
<blockquote>
<p>ASCII：（<code>[0-9,a-z,A-Z$_]</code>基本拉丁字母、数字 0-9、美元、下划线）</p>
</blockquote>
<p>您可以使用该集之外的字符作为表或列标识符，例如包括空格，但您 <em>必须</em> 引用（反引号）它们。</p>
<p>此外，尽管数字是标识符的有效字符，但标识符不能仅由数字组成。如果他们这样做，他们必须用反引号括起来。</p>
<p><br></p>
<h3>更多建议</h3>
<p>MySQL 中有两种类型的引号：</p>
<ol>
<li>
<code>'</code>用于封闭字符串文字</li>
<li>```用于包含表名和列名等标识符</li>
</ol>
<p>然后是<code>"</code>一个特例。它可以一次用于上述目的之一，具体取决于 MySQL 服务器 <em>的</em><code>sql_mode</code>：</p>
<ol>
<li>
<em>默认情况下，</em> 该<code>"</code>字符可用于包围字符串文字，就像<code>'</code>
</li>
<li>在<code>ANSI_QUOTES</code>mode中<code>"</code>，字符可用于包围标识符，就像```</li>
</ol>
<h4>以下查询将根据 SQL 模式产生不同的结果（或错误）：</h4>
<div class="code"><pre class="code literal-block">SELECT "column" FROM table WHERE foo = "bar"
</pre></div>

<h4>ANSI_QUOTES 禁用</h4>
<p>查询将选择<code>"column"</code>列<code>foo</code>等于字符串的字符串文字<code>"bar"</code></p>
<h4>启用 ANSI_QUOTES</h4>
<p>查询将选择 column<code>column</code>等于<code>foo</code>column 的列<code>bar</code></p>
<h4>什么时候用什么</h4>
<ul>
<li>我建议您避免使用，<code>"</code>这样您的代码就会独立于 SQL 模式</li>
<li>总是引用标识符，因为这是一个很好的做法（很多关于 SO 的问题都在讨论这个问题）</li>
</ul>
<p><br><br><a href="posts/when-to-use-single-quotes-double-quotes-and-backticks-in-mysql/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-742.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-740.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
