<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 283) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-283.html">
<link rel="prev" href="index-284.html" type="text/html">
<link rel="next" href="index-282.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-remove-duplicate-rows/" class="u-url">How can I remove duplicate rows?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-remove-duplicate-rows/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T02:57:58+08:00" itemprop="datePublished" title="2023-02-17 02:57">2023-02-17 02:57</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I need to remove duplicate rows from a fairly large SQL Server table (i.e.
300,000+ rows).</p>
<p>The rows, of course, will not be perfect duplicates because of the existence
of the <code>RowID</code> identity field.</p>
<p><strong>MyTable</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">RowID</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="w"> </span><span class="n">identity</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">primary</span><span class="w"> </span><span class="n">key</span><span class="p">,</span>
<span class="n">Col1</span><span class="w"> </span><span class="n">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">,</span>
<span class="n">Col2</span><span class="w"> </span><span class="n">varchar</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">,</span>
<span class="n">Col3</span><span class="w"> </span><span class="n">tinyint</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nb nb-Type">null</span>
</pre></div>

<p>How can I do this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Assuming no nulls, you <code>GROUP BY</code> the unique columns, and <code>SELECT</code> the <code>MIN
(or MAX)</code> RowId as the row to keep. Then, just delete everything that didn't
have a row id:</p>
<div class="code"><pre class="code literal-block">DELETE FROM MyTable
LEFT OUTER JOIN (
   SELECT MIN(RowId) as RowId, Col1, Col2, Col3 
   FROM MyTable 
   GROUP BY Col1, Col2, Col3
) as KeepRows ON
   MyTable.RowId = KeepRows.RowId
WHERE
   KeepRows.RowId IS NULL
</pre></div>

<p>In case you have a GUID instead of an integer, you can replace</p>
<div class="code"><pre class="code literal-block">MIN(RowId)
</pre></div>

<p>with</p>
<div class="code"><pre class="code literal-block">CONVERT(uniqueidentifier, MIN(CONVERT(char(36), MyGuidColumn)))
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Another possible way of doing this is</p>
<div class="code"><pre class="code literal-block">;

--Ensure that any immediately preceding statement is terminated with a semicolon above
WITH cte
     AS (SELECT ROW_NUMBER() OVER (PARTITION BY Col1, Col2, Col3 
                                       ORDER BY ( SELECT 0)) RN
         FROM   #MyTable)
DELETE FROM cte
WHERE  RN &gt; 1;
</pre></div>

<p>I am using <code>ORDER BY (SELECT 0)</code> above as it is arbitrary which row to
preserve in the event of a tie.</p>
<p>To preserve the latest one in <code>RowID</code> order for example you could use <code>ORDER
BY RowID DESC</code></p>
<p><strong>Execution Plans</strong></p>
<p>The execution plan for this is often simpler and more efficient than that in
the accepted answer as it does not require the self join.</p>
<p><img alt="Execution Plans" src="images/ZJiWF.jpg"></p>
<p>This is not always the case however. One place where the <code>GROUP BY</code> solution
might be preferred is situations where a hash aggregate would be chosen in
preference to a stream aggregate.</p>
<p>The <code>ROW_NUMBER</code> solution will always give pretty much the same plan whereas
the <code>GROUP BY</code> strategy is more flexible.</p>
<p><img alt="Execution Plans" src="images/iUlWm.jpg"></p>
<p>Factors which might favour the hash aggregate approach would be</p>
<ul>
<li>No useful index on the partitioning columns</li>
<li>relatively fewer groups with relatively more duplicates in each group </li>
</ul>
<p>In extreme versions of this second case (if there are very few groups with
many duplicates in each) one could also consider simply inserting the rows to
keep into a new table then <code>TRUNCATE</code>-ing the original and copying them back
to minimise logging compared to deleting a very high proportion of the rows.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-difference-between-visibility-hidden-and-display-none/" class="u-url">What is the difference between visibility:hidden and display:none?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-difference-between-visibility-hidden-and-display-none/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T02:57:12+08:00" itemprop="datePublished" title="2023-02-17 02:57">2023-02-17 02:57</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>The CSS rules <code>visibility:hidden</code> and <code>display:none</code> both result in the
element not being visible. Are these synonyms?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><code>display:none</code> means that the tag in question will not appear on the page at
all (although you can still interact with it through the dom). There will be
no space allocated for it between the other tags.</p>
<p><code>visibility:hidden</code> means that unlike <code>display:none</code>, the tag is not visible,
but space is allocated for it on the page. The tag is rendered, it just isn't
seen on the page.</p>
<p>For example:</p>
<div class="code"><pre class="code literal-block">test<span class="w"> </span>|<span class="w"> </span><span class="nt">&lt;span</span><span class="w"> </span><span class="na">style=</span><span class="s">"[style-tag-value]"</span><span class="nt">&gt;</span>Appropriate<span class="w"> </span>style<span class="w"> </span>in<span class="w"> </span>this<span class="w"> </span>tag<span class="nt">&lt;/span&gt;</span><span class="w"> </span>|<span class="w"> </span>test
</pre></div>

<p>Replacing <code>[style-tag-value]</code> with <code>display:none</code> results in:</p>
<div class="code"><pre class="code literal-block">test |   | test
</pre></div>

<p>Replacing <code>[style-tag-value]</code> with <code>visibility:hidden</code> results in:</p>
<div class="code"><pre class="code literal-block">test |                        | test
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p><strong>They are not synonyms.</strong></p>
<p><code>display:none</code> removes the element from the normal flow of the page, allowing
other elements to fill in.</p>
<p><code>visibility:hidden</code> leaves the element in the normal flow of the page such
that is still occupies space.</p>
<p>Imagine you are in line for a ride at an amusement park and someone in the
line gets so rowdy that security plucks them from the line. Everyone in line
will then move forward one position to fill the now empty slot. This is like
<code>display:none</code>.</p>
<p>Contrast this with the similar situation, but that someone in front of you
puts on an invisibility cloak. While viewing the line, it will look like there
is an empty space, but people can't really fill that empty looking space
because someone is still there. This is like <code>visibility:hidden</code>.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-and-when-to-use-async-and-await/" class="u-url">How and when to use ‘async’ and ‘await’</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-and-when-to-use-async-and-await/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T02:56:41+08:00" itemprop="datePublished" title="2023-02-17 02:56">2023-02-17 02:56</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>From my understanding one of the main things that <code>async</code> and <code>await</code> do is to
make code easy to write and read - but is using them equal to spawning
background threads to perform long duration logic?</p>
<p>I'm currently trying out the most basic example. I've added some comments
inline. Can you clarify it for me?</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">don</span><span class="s1">'t understand why this method must be marked as `async`.</span>
<span class="s1">private async void button1_Click(object sender, EventArgs e)</span>
<span class="s1">{</span>
<span class="s1">    Task&lt;int&gt; access = DoSomethingAsync();</span>
<span class="s1">    // task independent stuff here</span>

<span class="s1">    // this line is reached after the 5 seconds sleep from </span>
<span class="s1">    // DoSomethingAsync() method. Shouldn'</span><span class="n">t</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">reached</span><span class="w"> </span><span class="n">immediately</span><span class="nv">?</span><span class="w"> </span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">understanding</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">waiting</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="n">here</span><span class="p">.</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">access</span><span class="p">;</span><span class="w"> </span>
<span class="err">}</span>

<span class="n">async</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">DoSomethingAsync</span><span class="p">()</span>
<span class="err">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">background</span><span class="w"> </span><span class="n">thread</span><span class="nv">?</span>
<span class="w">    </span><span class="k">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="err">}</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>When using <code>async</code> and <code>await</code> the compiler generates a state machine in the
background.</p>
<p>Here's an example on which I hope I can explain some of the high-level details
that are going on:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">async</span><span class="w"> </span><span class="nv">Task</span><span class="w"> </span><span class="nv">MyMethodAsync</span><span class="ss">()</span>
{
<span class="w">    </span><span class="nv">Task</span><span class="o">&lt;</span><span class="nv">int</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">longRunningTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">LongRunningOperationAsync</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">independent</span><span class="w"> </span><span class="nv">work</span><span class="w"> </span><span class="nv">which</span><span class="w"> </span><span class="nv">doesn</span><span class="err">'t need the result of LongRunningOperationAsync can be done here</span>

<span class="err">    //and now we call await on the task </span>
<span class="err">    int result = await longRunningTask;</span>
<span class="err">    //use the result </span>
<span class="err">    Console.WriteLine(result);</span>
<span class="err">}</span>

<span class="err">public async Task&lt;int&gt; LongRunningOperationAsync() // assume we return an int from this long running operation </span>
<span class="err">{</span>
<span class="err">    await Task.Delay(1000); // 1 second delay</span>
<span class="err">    return 1;</span>
<span class="err">}</span>
</pre></div>

<p>OK, so what happens here:</p>
<ol>
<li>
<p><code>Task&lt;int&gt; longRunningTask = LongRunningOperationAsync();</code> starts executing <code>LongRunningOperation</code></p>
</li>
<li>
<p>Independent work is done on let's assume the Main Thread (Thread ID = 1) then <code>await longRunningTask</code> is reached.</p>
</li>
</ol>
<p>Now, if the <code>longRunningTask</code> hasn't finished and it is still running,
<code>MyMethodAsync()</code> will return to its calling method, thus the main thread
doesn't get blocked. When the <code>longRunningTask</code> is done then a thread from the
ThreadPool (can be any thread) will return to <code>MyMethodAsync()</code> in its
previous context and continue execution (in this case printing the result to
the console).</p>
<p>A second case would be that the <code>longRunningTask</code> has already finished its
execution and the result is available. When reaching the <code>await
longRunningTask</code> we already have the result so the code will continue
executing on the very same thread. (in this case printing result to console).
Of course this is not the case for the above example, where there's a
<code>Task.Delay(1000)</code> involved.</p>
<p><br></p>
<h3>Suggest</h3>
<blockquote>
<p>From my understanding one of the main things that async and await do is to
make code easy to write and read.</p>
</blockquote>
<p>They're to make <em>asynchronous</em> code easy to write and read, yes.</p>
<blockquote>
<p>Is it the same thing as spawning background threads to perform long duration
logic?</p>
</blockquote>
<p>Not at all.</p>
<blockquote>
<p>// I don't understand why this method must be marked as 'async'.</p>
</blockquote>
<p>The <code>async</code> keyword enables the <code>await</code> keyword. So any method using <code>await</code>
must be marked <code>async</code>.</p>
<blockquote>
<p>// This line is reached after the 5 seconds sleep from DoSomethingAsync()
method. Shouldn't it be reached immediately?</p>
</blockquote>
<p>No, because <code>async</code> methods are not run on another thread by default.</p>
<blockquote>
<p>// Is this executed on a background thread?</p>
</blockquote>
<p>No.</p>
<hr>
<p>You may find my <code>async</code>/<code>await</code> intro helpful. The official MSDN docs are also
unusually good (particularly the TAP section), and the <code>async</code> team put out an
excellent FAQ.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-284.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-282.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
