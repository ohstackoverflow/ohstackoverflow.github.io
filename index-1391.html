<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1391) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1391.html">
<link rel="prev" href="index-1392.html" type="text/html">
<link rel="next" href="index-1390.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/anchor-boxes-in-yolo-how-are-they-decided/" class="u-url">Anchor Boxes in YOLO : How are they decided</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/anchor-boxes-in-yolo-how-are-they-decided/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T03:03:09+08:00" itemprop="datePublished" title="2023-02-28 03:03">2023-02-28 03:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have gone through a couple of <code>YOLO</code> tutorials but I am finding it some what
hard to figure if the Anchor boxes for each cell the image is to be divided
into is predetermined. In one of the guides I went through, The image was
divided into <strong>13x13</strong> cells and it stated each cell predicts <strong>5</strong> anchor
boxes(bigger than it, ok here's my first problem because it also says it would
first detect what object is present in the small cell before the prediction of
the boxes).</p>
<p>How can the small cell predict anchor boxes for an object bigger than it. Also
it's said that each cell classifies before predicting its anchor boxes how can
the small cell classify the right object in it without querying neighbouring
cells if only a small part of the object falls within the cell</p>
<p><code>E.g.</code> say one of the <strong>13</strong> cells contains only the white pocket part of a
man wearing a T-shirt how can that cell classify correctly that a man is
present without being linked to its neighbouring cells? with a normal CNN when
trying to localize a single object I know the bounding box prediction relates
to the whole image so at least I can say the network has an idea of what's
going on everywhere on the image before deciding where the box should be.</p>
<p><strong>PS:</strong> What I currently think of how the YOLO works is basically each cell is
assigned predetermined anchor boxes with a classifier at each end before the
boxes with the highest scores for each class is then selected but I am sure it
doesn't add up somewhere.</p>
<blockquote>
<p><strong>UPDATE:</strong> Made a mistake with this question, it should have been about how
regular bounding boxes were decided rather than anchor/prior boxes. So I am
marking <code>@craq</code>'s answer as correct because that's how anchor boxes are
decided according to the YOLO v2 paper</p>
</blockquote>
<p><br><br></p>
<h2>Answer</h2>
<p>I think there are two questions here. Firstly, the one in the title, asking
where the anchors come from. Secondly, how anchors are assigned to objects.
I'll try to answer both.</p>
<ol>
<li>Anchors are determined by a k-means procedure, looking at all the bounding boxes in your dataset. If you're looking at vehicles, the ones you see from the side will have an aspect ratio of about 2:1 (width = 2*height). The ones viewed from in front will be roughly square, 1:1. If your dataset includes people, the aspect ratio might be 1:3. Foreground objects will be large, background objects will be small. The k-means routine will figure out a selection of anchors that represent your dataset. k=5 for yolov3, but there are different numbers of anchors for each YOLO version.</li>
</ol>
<p>It's useful to have anchors that represent your dataset, because YOLO learns
how to make small adjustments to the anchor boxes in order to create an
accurate bounding box for your object. YOLO can learn small adjustments
better/easier than large ones.</p>
<ol>
<li>The assignment problem is trickier. As I understand it, part of the training process is for YOLO to learn which anchors to use for which object. So the "assignment" isn't deterministic like it might be for the Hungarian algorithm. Because of this, in general, multiple anchors will detect each object, and you need to do non-max-suppression afterwards in order to pick the "best" one (i.e. highest confidence).</li>
</ol>
<p>There are a couple of points that I needed to understand before I came to
grips with anchors:</p>
<ul>
<li>Anchors can be any size, so they can extend beyond the boundaries of the 13x13 grid cells. They have to be, in order to detect large objects.</li>
<li>Anchors only enter in the final layers of YOLO. YOLO's neural network makes 13x13x5=845 predictions (assuming a 13x13 grid and 5 anchors). The predictions are interpreted as offsets to anchors from which to calculate a bounding box. (The predictions also include a confidence/objectness score and a class label.)</li>
<li>YOLO's loss function compares each object in the ground truth with one anchor. It picks the anchor (before any offsets) with highest IoU compared to the ground truth. Then the predictions are added as offsets to the anchor. All other anchors are designated as background.</li>
<li>If anchors which have been assigned to objects have high IoU, their loss is small. Anchors which have not been assigned to objects should predict background by setting confidence close to zero. The final loss function is a combination from all anchors. Since YOLO tries to minimise its overall loss function, the anchor closest to ground truth gets trained to recognise the object, and the other anchors get trained to ignore it.</li>
</ul>
<p>The following pages helped my understanding of YOLO's anchors:</p>
<p>https://medium.com/@vivek.yadav/part-1-generating-anchor-boxes-for-yolo-like-
network-for-vehicle-detection-using-kitti-dataset-b2fe033e5807</p>
<p>https://github.com/pjreddie/darknet/issues/568</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-theorical-foundation-for-scikit-learn-dummy-classifier/" class="u-url">What is the theorical foundation for scikit-learn dummy classifier?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-theorical-foundation-for-scikit-learn-dummy-classifier/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T03:02:48+08:00" itemprop="datePublished" title="2023-02-28 03:02">2023-02-28 03:02</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>By the documentation I read that a dummy classifier can be used to test it
against a classification algorithm.</p>
<blockquote>
<p>This classifier is useful as a simple baseline to compare with other (real)
classifiers. Do not use it for real problems.</p>
</blockquote>
<p>What does the dummy classifier do when it uses the stratified aproach. I know
that the docummentation says that:</p>
<blockquote>
<p>generates predictions by respecting the training set’s class distribution.</p>
</blockquote>
<p>Could anybody give me a more theorical explanation of why this is a proof for
the performance of the classifier?.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The dummy classifier gives you a measure of "baseline" performance--i.e. the
success rate one should expect to achieve even if simply guessing.</p>
<p>Suppose you wish to determine whether a given object possesses or does not
possess a certain property. If you have analyzed a large number of those
objects and have found that 90% contain the target property, then guessing
that every future instance of the object possesses the target property gives
you a 90% likelihood of guessing correctly. Structuring your guesses this way
is equivalent to using the <code>most_frequent</code> method in the documentation you
cite.</p>
<p>Because many machine learning tasks attempt to increase the success rate of
(e.g.) classification tasks, evaluating the baseline success rate can afford a
floor value for the minimal value one's classifier should out-perform. In the
hypothetical discussed above, you would want your classifier to get more than
90% accuracy, because 90% is the success rate available to even "dummy"
classifiers.</p>
<p>If one trains a dummy classifier with the <code>stratified</code> parameter using the
data discussed above, that classifier will predict that there is a 90%
probability that each object it encounters possesses the target property. This
is different from training a dummy classifier with the <code>most_frequent</code>
parameter, as the latter would guess that <em>all</em> future objects possess the
target property. Here's some code to illustrate:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">sklearn.dummy</span> <span class="kn">import</span> <span class="n">DummyClassifier</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">two_dimensional_values</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">class_labels</span>           <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">90</span><span class="p">):</span>
    <span class="n">two_dimensional_values</span><span class="o">.</span><span class="kp">append</span><span class="p">(</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">class_labels</span><span class="o">.</span><span class="kp">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">two_dimensional_values</span><span class="o">.</span><span class="kp">append</span><span class="p">(</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">class_labels</span><span class="o">.</span><span class="kp">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1">#now 90% of the training data contains the target property</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">array</span><span class="p">(</span> <span class="n">two_dimensional_values</span> <span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">array</span><span class="p">(</span> <span class="n">class_labels</span> <span class="p">)</span>

<span class="c1">#train a dummy classifier to make predictions based on the most_frequent class value</span>
<span class="n">dummy_classifier</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">"most_frequent"</span><span class="p">)</span>
<span class="n">dummy_classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="p">)</span>

<span class="c1">#this produces 100 predictions that say "1"</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">two_dimensional_values</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="n">dummy_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span>

<span class="c1">#train a dummy classifier to make predictions based on the class values</span>
<span class="n">new_dummy_classifier</span> <span class="o">=</span> <span class="n">DummyClassifier</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">"stratified"</span><span class="p">)</span>
<span class="n">new_dummy_classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span> <span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="p">)</span>

<span class="c1">#this produces roughly 90 guesses that say "1" and roughly 10 guesses that say "0"</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">two_dimensional_values</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="n">new_dummy_classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span> <span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>A major motivation for Dummy Classifier is F-score, when the positive class is
in minority (i.e. imbalanced classes). This classifier is used for sanity test
of actual classifier. Actually, dummy classifier completely ignores the input
data. In case of 'most frequent' method, it checks the occurrence of most
frequent label.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/python-justifying-numpy-array/" class="u-url">Python: Justifying NumPy array</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/python-justifying-numpy-array/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T03:02:24+08:00" itemprop="datePublished" title="2023-02-28 03:02">2023-02-28 03:02</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Please I am a bit new to <code>Python</code> and it has been nice, I could comment that
python is very sexy till I needed to shift content of a 4x4 matrix which I
want to use in building a 2048 game demo of the game is here I have this
function</p>
<div class="code"><pre class="code literal-block"><span class="n">def</span><span class="w"> </span><span class="n">cover_left</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span><span class="err">:</span>
<span class="w">        </span><span class="k">new</span><span class="o">=[</span><span class="n">[0,0,0,0</span><span class="o">]</span><span class="p">,</span><span class="o">[</span><span class="n">0,0,0,0</span><span class="o">]</span><span class="p">,</span><span class="o">[</span><span class="n">0,0,0,0</span><span class="o">]</span><span class="p">,</span><span class="o">[</span><span class="n">0,0,0,0</span><span class="o">]</span><span class="err">]</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="err">:</span>
<span class="w">             </span><span class="nf">count</span><span class="o">=</span><span class="mi">0</span>
<span class="w">             </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="err">:</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">mat</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]!=</span><span class="mi">0</span><span class="err">:</span>
<span class="w">                    </span><span class="k">new</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">count</span><span class="o">]=</span><span class="n">mat</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span>
<span class="w">                    </span><span class="nf">count</span><span class="o">+=</span><span class="mi">1</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span>
</pre></div>

<p>This is what this function does if you call it like this</p>
<div class="code"><pre class="code literal-block">cover_left([
              [1,0,2,0], 
              [3,0,4,0], 
              [5,0,6,0], 
              [0,7,0,8]
          ])
</pre></div>

<p>It will cover the zeros to the left and produce</p>
<div class="code"><pre class="code literal-block">[  [1, 2, 0, 0],
   [3, 4, 0, 0],
   [5, 6, 0, 0],
   [7, 8, 0, 0]]
</pre></div>

<p>Please I need someone to help me with a <code>numpy</code> way of doing this which I
believe will be faster and require less code (I am using in a depth-first
search algo) and more importantly the implementation of <code>cover_up</code>,
<code>cover_down</code> and <code>cover_left</code>.</p>
<div class="code"><pre class="code literal-block"><span class="n n-Quoted">`cover_up`</span>
<span class="w">    </span><span class="err">[</span><span class="w">  </span><span class="err">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="err">]</span><span class="p">,</span>
<span class="w">       </span><span class="err">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="err">]</span><span class="p">,</span>
<span class="w">       </span><span class="err">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="err">]</span><span class="p">,</span>
<span class="w">       </span><span class="err">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="err">]]</span>
<span class="n n-Quoted">`cover_down`</span>
<span class="w">    </span><span class="err">[</span><span class="w">  </span><span class="err">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="err">]</span><span class="p">,</span>
<span class="w">       </span><span class="err">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="err">]</span><span class="p">,</span>
<span class="w">       </span><span class="err">[</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="err">]</span><span class="p">,</span>
<span class="w">       </span><span class="err">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="err">]]</span>
<span class="n n-Quoted">`cover_right`</span>
<span class="w">    </span><span class="err">[</span><span class="w">  </span><span class="err">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="err">]</span><span class="p">,</span>
<span class="w">       </span><span class="err">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="err">]</span><span class="p">,</span>
<span class="w">       </span><span class="err">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="err">]</span><span class="p">,</span>
<span class="w">       </span><span class="err">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="err">]]</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>Here's a vectorized approach inspired by <code>this other post</code> and generalized to
cover <code>non-zeros</code> for all four directions -</p>
<div class="code"><pre class="code literal-block"><span class="n">def</span><span class="w"> </span><span class="n">justify</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">invalid_val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">side</span><span class="o">=</span><span class="s1">'left'</span><span class="p">)</span><span class="err">:</span><span class="w">    </span>
<span class="w">    </span><span class="ss">"""</span>
<span class="ss">    Justifies a 2D array</span>

<span class="ss">    Parameters</span>
<span class="ss">    ----------</span>
<span class="ss">    A : ndarray</span>
<span class="ss">        Input array to be justified</span>
<span class="ss">    axis : int</span>
<span class="ss">        Axis along which justification is to be made</span>
<span class="ss">    side : str</span>
<span class="ss">        Direction of justification. It could be 'left', 'right', 'up', 'down'</span>
<span class="ss">        It should be 'left' or 'right' for axis=1 and 'up' or 'down' for axis=0.</span>

<span class="ss">    """</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">invalid_val</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">nan</span><span class="p">:</span>
<span class="w">        </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">np</span><span class="p">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="err">:</span>
<span class="w">        </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">!=</span><span class="n">invalid_val</span>
<span class="w">    </span><span class="n">justified_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">sort</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">side</span><span class="o">==</span><span class="s1">'up'</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">side</span><span class="o">==</span><span class="s1">'left'</span><span class="p">)</span><span class="err">:</span>
<span class="w">        </span><span class="n">justified_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">flip</span><span class="p">(</span><span class="n">justified_mask</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
<span class="w">    </span><span class="k">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">full</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span><span class="w"> </span><span class="n">invalid_val</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">axis</span><span class="o">==</span><span class="mi">1</span><span class="err">:</span>
<span class="w">        </span><span class="k">out</span><span class="o">[</span><span class="n">justified_mask</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>
<span class="w">    </span><span class="k">else</span><span class="err">:</span>
<span class="w">        </span><span class="k">out</span><span class="p">.</span><span class="n">T</span><span class="o">[</span><span class="n">justified_mask.T</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">T</span><span class="o">[</span><span class="n">mask.T</span><span class="o">]</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">out</span>
</pre></div>

<p>Sample runs -</p>
<div class="code"><pre class="code literal-block">In [473]: a # input array
Out[473]: 
array([[1, 0, 2, 0],
       [3, 0, 4, 0],
       [5, 0, 6, 0],
       [6, 7, 0, 8]])

In [474]: justify(a, axis=0, side='up')
Out[474]: 
array([[1, 7, 2, 8],
       [3, 0, 4, 0],
       [5, 0, 6, 0],
       [6, 0, 0, 0]])

In [475]: justify(a, axis=0, side='down')
Out[475]: 
array([[1, 0, 0, 0],
       [3, 0, 2, 0],
       [5, 0, 4, 0],
       [6, 7, 6, 8]])

In [476]: justify(a, axis=1, side='left')
Out[476]: 
array([[1, 2, 0, 0],
       [3, 4, 0, 0],
       [5, 6, 0, 0],
       [6, 7, 8, 0]])

In [477]: justify(a, axis=1, side='right')
Out[477]: 
array([[0, 0, 1, 2],
       [0, 0, 3, 4],
       [0, 0, 5, 6],
       [0, 6, 7, 8]])
</pre></div>

<h4>Generic case (ndarray)</h4>
<p>For a ndarray, we could modify it to -</p>
<div class="code"><pre class="code literal-block"><span class="n">def</span><span class="w"> </span><span class="n">justify_nd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">invalid_val</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="p">,</span><span class="w"> </span><span class="n">side</span><span class="p">)</span><span class="err">:</span><span class="w">    </span>
<span class="w">    </span><span class="ss">"""</span>
<span class="ss">    Justify ndarray for the valid elements (that are not invalid_val).</span>

<span class="ss">    Parameters</span>
<span class="ss">    ----------</span>
<span class="ss">    A : ndarray</span>
<span class="ss">        Input array to be justified</span>
<span class="ss">    invalid_val : scalar</span>
<span class="ss">        invalid value</span>
<span class="ss">    axis : int</span>
<span class="ss">        Axis along which justification is to be made</span>
<span class="ss">    side : str</span>
<span class="ss">        Direction of justification. Must be 'front' or 'end'.</span>
<span class="ss">        So, with 'front', valid elements are pushed to the front and</span>
<span class="ss">        with 'end' valid elements are pushed to the end along specified axis.</span>
<span class="ss">    """</span>

<span class="w">    </span><span class="n">pushax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="nl">a</span><span class="p">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">invalid_val</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">nan</span><span class="p">:</span>
<span class="w">        </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">np</span><span class="p">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="w">    </span><span class="k">else</span><span class="err">:</span>
<span class="w">        </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">!=</span><span class="n">invalid_val</span>
<span class="w">    </span><span class="n">justified_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">sort</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">side</span><span class="o">==</span><span class="s1">'front'</span><span class="err">:</span>
<span class="w">        </span><span class="n">justified_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">flip</span><span class="p">(</span><span class="n">justified_mask</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>

<span class="w">    </span><span class="k">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">full</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">shape</span><span class="p">,</span><span class="w"> </span><span class="n">invalid_val</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">axis</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">(</span><span class="n">axis</span><span class="o">==</span><span class="n">a</span><span class="p">.</span><span class="n">ndim</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="err">:</span>
<span class="w">        </span><span class="k">out</span><span class="o">[</span><span class="n">justified_mask</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>
<span class="w">    </span><span class="k">else</span><span class="err">:</span>
<span class="w">        </span><span class="n">pushax</span><span class="p">(</span><span class="k">out</span><span class="p">)</span><span class="o">[</span><span class="n">pushax(justified_mask)</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pushax</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">[</span><span class="n">pushax(mask)</span><span class="o">]</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">out</span>
</pre></div>

<p>Sample runs -</p>
<p>Input array :</p>
<div class="code"><pre class="code literal-block">In [87]: a
Out[87]: 
array([[[54, 57,  0, 77],
        [77,  0,  0, 31],
        [46,  0,  0, 98],
        [98, 22, 68, 75]],

       [[49,  0,  0, 98],
        [ 0, 47,  0, 87],
        [82, 19,  0, 90],
        [79, 89, 57, 74]],

       [[ 0,  0,  0,  0],
        [29,  0,  0, 49],
        [42, 75,  0, 67],
        [42, 41, 84, 33]],

       [[ 0,  0,  0, 38],
        [44, 10,  0,  0],
        [63,  0,  0,  0],
        [89, 14,  0,  0]]])
</pre></div>

<p>To <code>'front'</code>, along <code>axis =0</code> :</p>
<div class="code"><pre class="code literal-block">In [88]: justify_nd(a, invalid_val=0, axis=0, side='front')
Out[88]: 
array([[[54, 57,  0, 77],
        [77, 47,  0, 31],
        [46, 19,  0, 98],
        [98, 22, 68, 75]],

       [[49,  0,  0, 98],
        [29, 10,  0, 87],
        [82, 75,  0, 90],
        [79, 89, 57, 74]],

       [[ 0,  0,  0, 38],
        [44,  0,  0, 49],
        [42,  0,  0, 67],
        [42, 41, 84, 33]],

       [[ 0,  0,  0,  0],
        [ 0,  0,  0,  0],
        [63,  0,  0,  0],
        [89, 14,  0,  0]]])
</pre></div>

<p>Along <code>axis=1</code> :</p>
<div class="code"><pre class="code literal-block">In [89]: justify_nd(a, invalid_val=0, axis=1, side='front')
Out[89]: 
array([[[54, 57, 68, 77],
        [77, 22,  0, 31],
        [46,  0,  0, 98],
        [98,  0,  0, 75]],

       [[49, 47, 57, 98],
        [82, 19,  0, 87],
        [79, 89,  0, 90],
        [ 0,  0,  0, 74]],

       [[29, 75, 84, 49],
        [42, 41,  0, 67],
        [42,  0,  0, 33],
        [ 0,  0,  0,  0]],

       [[44, 10,  0, 38],
        [63, 14,  0,  0],
        [89,  0,  0,  0],
        [ 0,  0,  0,  0]]])
</pre></div>

<p>Along <code>axis=2</code> :</p>
<div class="code"><pre class="code literal-block">In [90]: justify_nd(a, invalid_val=0, axis=2, side='front')
Out[90]: 
array([[[54, 57, 77,  0],
        [77, 31,  0,  0],
        [46, 98,  0,  0],
        [98, 22, 68, 75]],

       [[49, 98,  0,  0],
        [47, 87,  0,  0],
        [82, 19, 90,  0],
        [79, 89, 57, 74]],

       [[ 0,  0,  0,  0],
        [29, 49,  0,  0],
        [42, 75, 67,  0],
        [42, 41, 84, 33]],

       [[38,  0,  0,  0],
        [44, 10,  0,  0],
        [63,  0,  0,  0],
        [89, 14,  0,  0]]])
</pre></div>

<p>To the <code>'end'</code> :</p>
<div class="code"><pre class="code literal-block"><span class="nv">In</span><span class="w"> </span>[<span class="mi">94</span>]:<span class="w"> </span><span class="nv">justify_nd</span><span class="ss">(</span><span class="nv">a</span>,<span class="w"> </span><span class="nv">invalid_val</span><span class="o">=</span><span class="mi">0</span>,<span class="w"> </span><span class="nv">axis</span><span class="o">=</span><span class="mi">2</span>,<span class="w"> </span><span class="nv">side</span><span class="o">=</span><span class="s1">'end'</span><span class="ss">)</span>
<span class="nv">Out</span>[<span class="mi">94</span>]:<span class="w"> </span>
<span class="nv">array</span><span class="ss">(</span>[[[<span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">54</span>,<span class="w"> </span><span class="mi">57</span>,<span class="w"> </span><span class="mi">77</span>],
<span class="w">        </span>[<span class="w"> </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">77</span>,<span class="w"> </span><span class="mi">31</span>],
<span class="w">        </span>[<span class="w"> </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">46</span>,<span class="w"> </span><span class="mi">98</span>],
<span class="w">        </span>[<span class="mi">98</span>,<span class="w"> </span><span class="mi">22</span>,<span class="w"> </span><span class="mi">68</span>,<span class="w"> </span><span class="mi">75</span>]],

<span class="w">       </span>[[<span class="w"> </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">49</span>,<span class="w"> </span><span class="mi">98</span>],
<span class="w">        </span>[<span class="w"> </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">47</span>,<span class="w"> </span><span class="mi">87</span>],
<span class="w">        </span>[<span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">82</span>,<span class="w"> </span><span class="mi">19</span>,<span class="w"> </span><span class="mi">90</span>],
<span class="w">        </span>[<span class="mi">79</span>,<span class="w"> </span><span class="mi">89</span>,<span class="w"> </span><span class="mi">57</span>,<span class="w"> </span><span class="mi">74</span>]],

<span class="w">       </span>[[<span class="w"> </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>],
<span class="w">        </span>[<span class="w"> </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">29</span>,<span class="w"> </span><span class="mi">49</span>],
<span class="w">        </span>[<span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">42</span>,<span class="w"> </span><span class="mi">75</span>,<span class="w"> </span><span class="mi">67</span>],
<span class="w">        </span>[<span class="mi">42</span>,<span class="w"> </span><span class="mi">41</span>,<span class="w"> </span><span class="mi">84</span>,<span class="w"> </span><span class="mi">33</span>]],

<span class="w">       </span>[[<span class="w"> </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">38</span>],
<span class="w">        </span>[<span class="w"> </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">44</span>,<span class="w"> </span><span class="mi">10</span>],
<span class="w">        </span>[<span class="w"> </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">63</span>],
<span class="w">        </span>[<span class="w"> </span><span class="mi">0</span>,<span class="w">  </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">89</span>,<span class="w"> </span><span class="mi">14</span>]]]<span class="ss">)</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1392.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1390.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
