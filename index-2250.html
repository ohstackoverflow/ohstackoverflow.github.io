<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2250) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2250.html">
<link rel="prev" href="index-2251.html" type="text/html">
<link rel="next" href="index-2249.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-add-a-custom-right-click-menu-to-a-webpage/" class="u-url">How to add a custom right-click menu to a webpage?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-add-a-custom-right-click-menu-to-a-webpage/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T02:11:42+08:00" itemprop="datePublished" title="2023-03-04 02:11">2023-03-04 02:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to add a custom right-click menu to my web application. Can this be
done without using any pre-built libraries? If so, how to display a simple
custom right-click menu which does not use a 3rd party JavaScript library?</p>
<p>I'm aiming for something like what Google Docs does. It lets users right-click
and show the users their own menu.</p>
<p><strong>NOTE:</strong> I want to learn how to make my own versus using something somebody
made already since most of the time, those 3rd party libraries are bloated
with features whereas I only want features that I need so I want it to be
completely hand-made by me.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Answering your question - use <code>contextmenu</code> event, like below:</p>
<div class="code"><pre class="code literal-block">if<span class="w"> </span>(document.addEventListener)<span class="w"> </span>{
<span class="w">  </span>document.addEventListener('contextmenu',<span class="w"> </span>function(e)<span class="w"> </span>{
<span class="w">    </span>alert("You've<span class="w"> </span>tried<span class="w"> </span>to<span class="w"> </span>open<span class="w"> </span>context<span class="w"> </span>menu");<span class="w"> </span>//here<span class="w"> </span>you<span class="w"> </span>draw<span class="w"> </span>your<span class="w"> </span>own<span class="w"> </span>menu
<span class="w">    </span>e.preventDefault();
<span class="w">  </span>},<span class="w"> </span>false);
}<span class="w"> </span>else<span class="w"> </span>{
<span class="w">  </span>document.attachEvent('oncontextmenu',<span class="w"> </span>function()<span class="w"> </span>{
<span class="w">    </span>alert("You've<span class="w"> </span>tried<span class="w"> </span>to<span class="w"> </span>open<span class="w"> </span>context<span class="w"> </span>menu");
<span class="w">    </span>window.event.returnValue<span class="w"> </span>=<span class="w"> </span>false;
<span class="w">  </span>});
}


<span class="nt">&lt;body&gt;</span>
<span class="w">  </span>Lorem<span class="w"> </span>ipsum...
<span class="nt">&lt;/body&gt;</span>
</pre></div>

<p>But you should ask yourself, do you really want to overwrite default right-
click behavior - it depends on application that you're developing.</p>
<hr>
<p><strong>JSFIDDLE</strong></p>
<p><br></p>
<h3>Suggest</h3>
<p>Was very useful for me. For the sake of people like me, expecting the drawing
of menu, I put here the code I used to make the right-click menu:</p>
<div class="code"><pre class="code literal-block"><span class="o">$(</span><span class="nt">document</span><span class="o">)</span><span class="p">.</span><span class="nc">ready</span><span class="o">(</span><span class="nt">function</span><span class="o">()</span><span class="w"> </span><span class="p">{</span>


<span class="w">  </span><span class="err">if</span><span class="w"> </span><span class="err">($("#test").addEventListener)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="err">$("#test").addEventListener('contextmenu',</span><span class="w"> </span><span class="err">function(e)</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="err">alert("You've</span><span class="w"> </span><span class="err">tried</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">open</span><span class="w"> </span><span class="err">context</span><span class="w"> </span><span class="err">menu")</span><span class="p">;</span><span class="w"> </span><span class="err">//here</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">draw</span><span class="w"> </span><span class="err">your</span><span class="w"> </span><span class="err">own</span><span class="w"> </span><span class="err">menu</span>
<span class="w">      </span><span class="err">e.preventDefault()</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="nt">false</span><span class="o">);</span>
<span class="w">  </span><span class="err">}</span><span class="w"> </span><span class="nt">else</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="err">//document.getElementById("test").attachEvent('oncontextmenu',</span><span class="w"> </span><span class="err">function()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="err">//$(".test").bind('contextmenu',</span><span class="w"> </span><span class="err">function()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="err">$('body').on('contextmenu',</span><span class="w"> </span><span class="err">'a.test',</span><span class="w"> </span><span class="err">function()</span><span class="w"> </span><span class="err">{</span>


<span class="w">      </span><span class="err">//alert("contextmenu"+event)</span><span class="p">;</span>
<span class="w">      </span><span class="err">document.getElementById("rmenu").className</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">"show"</span><span class="p">;</span>
<span class="w">      </span><span class="err">document.getElementById("rmenu").style.top</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">mouseY(event)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">'px'</span><span class="p">;</span>
<span class="w">      </span><span class="err">document.getElementById("rmenu").style.left</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">mouseX(event)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">'px'</span><span class="p">;</span>

<span class="w">      </span><span class="err">window.event.returnValue</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">false</span><span class="p">;</span>


<span class="w">    </span><span class="p">}</span><span class="o">);</span>
<span class="w">  </span><span class="err">}</span>

<span class="err">}</span><span class="o">);</span>

<span class="o">//</span><span class="w"> </span><span class="nt">this</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">from</span><span class="w"> </span><span class="nt">another</span><span class="w"> </span><span class="nt">SO</span><span class="w"> </span><span class="nt">post</span><span class="o">...</span><span class="w">  </span>
<span class="o">$(</span><span class="nt">document</span><span class="o">)</span><span class="p">.</span><span class="nc">bind</span><span class="o">(</span><span class="s2">"click"</span><span class="o">,</span><span class="w"> </span><span class="nt">function</span><span class="o">(</span><span class="nt">event</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">document.getElementById("rmenu").className</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">"hide"</span><span class="p">;</span>
<span class="p">}</span><span class="o">);</span>



<span class="nt">function</span><span class="w"> </span><span class="nt">mouseX</span><span class="o">(</span><span class="nt">evt</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">if</span><span class="w"> </span><span class="err">(evt.pageX)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">evt.pageX</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="nt">else</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="o">(</span><span class="nt">evt</span><span class="p">.</span><span class="nc">clientX</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">evt.clientX</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">(document.documentElement.scrollLeft</span><span class="w"> </span><span class="err">?</span>
<span class="w">      </span><span class="err">document.documentElement.</span><span class="n">scrollLeft</span><span class="w"> </span><span class="p">:</span>
<span class="w">      </span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">scrollLeft</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="nt">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">null</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="err">}</span>

<span class="nt">function</span><span class="w"> </span><span class="nt">mouseY</span><span class="o">(</span><span class="nt">evt</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">if</span><span class="w"> </span><span class="err">(evt.pageY)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">evt.pageY</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="nt">else</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="o">(</span><span class="nt">evt</span><span class="p">.</span><span class="nc">clientY</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">evt.clientY</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">(document.documentElement.scrollTop</span><span class="w"> </span><span class="err">?</span>
<span class="w">      </span><span class="err">document.documentElement.</span><span class="n">scrollTop</span><span class="w"> </span><span class="p">:</span>
<span class="w">      </span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">scrollTop</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="nt">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">null</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="err">}</span>


<span class="p">.</span><span class="nc">show</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<span class="w">  </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">absolute</span><span class="p">;</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#C0C0C0</span><span class="p">;</span>
<span class="w">  </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="kc">blue</span><span class="p">;</span>
<span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">block</span><span class="p">;</span>
<span class="w">  </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">list-style-type</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">  </span><span class="k">list-style</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">hide</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">show</span><span class="w"> </span><span class="nt">li</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">list-style</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">show</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="cp">!important</span><span class="p">;</span>
<span class="w">  </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">.</span><span class="nc">show</span><span class="w"> </span><span class="nt">a</span><span class="p">:</span><span class="nd">hover</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">text-decoration</span><span class="p">:</span><span class="w"> </span><span class="kc">underline</span><span class="w"> </span><span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>


<span class="o">&lt;!</span><span class="nt">--</span><span class="w"> </span><span class="nt">jQuery</span><span class="w"> </span><span class="nt">should</span><span class="w"> </span><span class="nt">be</span><span class="w"> </span><span class="nt">at</span><span class="w"> </span><span class="nt">least</span><span class="w"> </span><span class="nt">version</span><span class="w"> </span><span class="nt">1</span><span class="p">.</span><span class="nc">7</span><span class="w"> </span><span class="nt">--</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nt">script</span><span class="w"> </span><span class="nt">src</span><span class="o">=</span><span class="s2">"https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.min.js"</span><span class="o">&gt;&lt;/</span><span class="nt">script</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nt">script</span><span class="w"> </span><span class="nt">src</span><span class="o">=</span><span class="s2">"contextmenu.js"</span><span class="o">&gt;&lt;/</span><span class="nt">script</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nt">link</span><span class="w"> </span><span class="nt">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span><span class="w"> </span><span class="nt">href</span><span class="o">=</span><span class="s2">"contextmenu.css"</span><span class="w"> </span><span class="o">/&gt;</span>


<span class="o">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="nt">id</span><span class="o">=</span><span class="s2">"test1"</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="nt">a</span><span class="w"> </span><span class="nt">href</span><span class="o">=</span><span class="s2">"www.google.com"</span><span class="w"> </span><span class="nt">class</span><span class="o">=</span><span class="s2">"test"</span><span class="o">&gt;</span><span class="nt">Google</span><span class="o">&lt;/</span><span class="nt">a</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="nt">a</span><span class="w"> </span><span class="nt">href</span><span class="o">=</span><span class="s2">"www.google.com"</span><span class="w"> </span><span class="nt">class</span><span class="o">=</span><span class="s2">"test"</span><span class="o">&gt;</span><span class="nt">Link</span><span class="w"> </span><span class="nt">2</span><span class="o">&lt;/</span><span class="nt">a</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="nt">a</span><span class="w"> </span><span class="nt">href</span><span class="o">=</span><span class="s2">"www.google.com"</span><span class="w"> </span><span class="nt">class</span><span class="o">=</span><span class="s2">"test"</span><span class="o">&gt;</span><span class="nt">Link</span><span class="w"> </span><span class="nt">3</span><span class="o">&lt;/</span><span class="nt">a</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="nt">a</span><span class="w"> </span><span class="nt">href</span><span class="o">=</span><span class="s2">"www.google.com"</span><span class="w"> </span><span class="nt">class</span><span class="o">=</span><span class="s2">"test"</span><span class="o">&gt;</span><span class="nt">Link</span><span class="w"> </span><span class="nt">4</span><span class="o">&lt;/</span><span class="nt">a</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nt">div</span><span class="o">&gt;</span>

<span class="o">&lt;!</span><span class="nt">--</span><span class="w"> </span><span class="nt">initially</span><span class="w"> </span><span class="nt">hidden</span><span class="w"> </span><span class="nt">right-click</span><span class="w"> </span><span class="nt">menu</span><span class="w"> </span><span class="nt">--</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nt">div</span><span class="w"> </span><span class="nt">class</span><span class="o">=</span><span class="s2">"hide"</span><span class="w"> </span><span class="nt">id</span><span class="o">=</span><span class="s2">"rmenu"</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="nt">ul</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="nt">li</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nt">a</span><span class="w"> </span><span class="nt">href</span><span class="o">=</span><span class="s2">"http://www.google.com"</span><span class="o">&gt;</span><span class="nt">Google</span><span class="o">&lt;/</span><span class="nt">a</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;/</span><span class="nt">li</span><span class="o">&gt;</span>

<span class="w">    </span><span class="o">&lt;</span><span class="nt">li</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nt">a</span><span class="w"> </span><span class="nt">href</span><span class="o">=</span><span class="s2">"http://localhost:8080/login"</span><span class="o">&gt;</span><span class="nt">Localhost</span><span class="o">&lt;/</span><span class="nt">a</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;/</span><span class="nt">li</span><span class="o">&gt;</span>

<span class="w">    </span><span class="o">&lt;</span><span class="nt">li</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="nt">a</span><span class="w"> </span><span class="nt">href</span><span class="o">=</span><span class="err">"</span><span class="nt">C</span><span class="o">:</span><span class="err">\"</span><span class="o">&gt;</span><span class="nt">C</span><span class="o">&lt;/</span><span class="nt">a</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;/</span><span class="nt">li</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;/</span><span class="nt">ul</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nt">div</span><span class="o">&gt;</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/is-the-practice-of-returning-a-c-reference-variable-evil/" class="u-url">Is the practice of returning a C++ reference variable evil?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/is-the-practice-of-returning-a-c-reference-variable-evil/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T02:10:20+08:00" itemprop="datePublished" title="2023-03-04 02:10">2023-03-04 02:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>This is a little subjective I think; I'm not sure if the opinion will be
unanimous (I've seen a lot of code snippets where references are returned).</p>
<p>According to a comment toward this question I just asked, regarding
initializing references, returning a reference can be evil because, [as I
understand] it makes it easier to miss deleting it, which can lead to memory
leaks.</p>
<p>This worries me, as I have followed examples (unless I'm imagining things) and
done this in a fair few places... Have I misunderstood? Is it evil? If so,
just how evil?</p>
<p>I feel that because of my mixed bag of pointers and references, combined with
the fact that I'm new to C++, and total confusion over what to use when, my
applications must be memory leak hell...</p>
<p>Also, I understand that using smart/shared pointers is generally accepted as
the best way to avoid memory leaks.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>In general, returning a reference is perfectly normal and happens all the
time.</p>
<p>If you mean:</p>
<div class="code"><pre class="code literal-block"><span class="nv">int</span><span class="o">&amp;</span><span class="w"> </span><span class="nv">getInt</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">int</span><span class="w"> </span><span class="nv">i</span><span class="c1">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">i</span><span class="c1">;  // DON'T DO THIS.</span>
}
</pre></div>

<p>That is all sorts of evil. The stack-allocated <code>i</code> will go away and you are
referring to nothing. This is also evil:</p>
<div class="code"><pre class="code literal-block"><span class="nv">int</span><span class="o">&amp;</span><span class="w"> </span><span class="nv">getInt</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">int</span><span class="o">*</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">int</span><span class="c1">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="nv">i</span><span class="c1">;  // DON'T DO THIS.</span>
}
</pre></div>

<p>Because now the client has to eventually do the strange:</p>
<div class="code"><pre class="code literal-block">int&amp; myInt = getInt(); // note the &amp;, we cannot lose this reference!
delete &amp;myInt;         // must delete...totally weird and  evil

int oops = getInt(); 
delete &amp;oops; // undefined behavior, we're wrongly deleting a copy, not the original
</pre></div>

<p>Note that rvalue references are still just references, so all the evil
applications remain the same.</p>
<p>If you want to allocate something that lives beyond the scope of the function,
use a smart pointer (or in general, a container):</p>
<div class="code"><pre class="code literal-block"><span class="nt">std</span><span class="p">::</span><span class="nd">unique_ptr</span><span class="o">&lt;</span><span class="nt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">getInt</span><span class="o">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="n">std</span><span class="p">:</span><span class="o">:</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>And now the client stores a smart pointer:</p>
<div class="code"><pre class="code literal-block"><span class="nt">std</span><span class="p">::</span><span class="nd">unique_ptr</span><span class="o">&lt;</span><span class="nt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">getInt</span><span class="o">();</span>
</pre></div>

<p>References are also okay for accessing things where you know the lifetime is
being kept open on a higher-level, e.g.:</p>
<div class="code"><pre class="code literal-block"><span class="n">struct</span><span class="w"> </span><span class="n">immutableint</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">immutableint</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">i_</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="n">private</span><span class="p">:</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i_</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>

<p>Here we know it's okay to return a reference to <code>i_</code> because whatever is
calling us manages the lifetime of the class instance, so <code>i_</code> will live at
least that long.</p>
<p>And of course, there's nothing wrong with just:</p>
<div class="code"><pre class="code literal-block"><span class="nv">int</span><span class="w"> </span><span class="nv">getInt</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="c1">;</span>
}
</pre></div>

<p>If the lifetime should be left up to the caller, and you're just computing the
value.</p>
<p>Summary: it's okay to return a reference if the lifetime of the object won't
end after the call.</p>
<p><br></p>
<h3>Suggest</h3>
<p>No.</p>
<p>What is evil is making a reference to a dynamically allocated object and
losing the original pointer. When you <code>new</code> an object you assume an obligation
to have a guaranteed <code>delete</code>.</p>
<p>But have a look at, eg, <code>operator&lt;&lt;</code>: that <em>must</em> return a reference, or</p>
<div class="code"><pre class="code literal-block">cout &lt;&lt; "foo" &lt;&lt; "bar" &lt;&lt; "bletch" &lt;&lt; endl ;
</pre></div>

<p>won't work.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-get-current-page-url-in-mvc-3/" class="u-url">How to get current page URL in MVC 3</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-get-current-page-url-in-mvc-3/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T02:07:47+08:00" itemprop="datePublished" title="2023-03-04 02:07">2023-03-04 02:07</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am using the Facebook comments plugin on a blog I am building. It has some
FBXML tags that are interpreted by the facebook javascript that is referenced
on the page.</p>
<p>This all works fine, but I have to pass in the current, fully-qualified URL to
the plugin.</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">style=</span><span class="s">"width: 900px; margin: auto;"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">"fb-root"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;fb:comments</span><span class="w"> </span><span class="na">href=</span><span class="s">"URL HERE"</span><span class="w"> </span><span class="na">num_posts=</span><span class="s">"10"</span><span class="w"> </span><span class="na">width=</span><span class="s">"900"</span><span class="nt">&gt;&lt;/fb:comments&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>What is the best way to get the URL of the current page? The request URL.</p>
<h4>Solution</h4>
<p>Here is the final code of my solution:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;fb:comments</span><span class="w"> </span><span class="na">href=</span><span class="s">"@Request.Url.AbsoluteUri"</span><span class="w"> </span><span class="na">num_posts=</span><span class="s">"15"</span><span class="w"> </span><span class="na">width=</span><span class="s">"900"</span><span class="nt">&gt;&lt;/fb:comments&gt;</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>You could use the <code>Request.RawUrl</code>, <code>Request.Url.OriginalString</code>,
<code>Request.Url.ToString()</code> or <code>Request.Url.AbsoluteUri</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Add this extension method to your code:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">Uri</span><span class="w"> </span><span class="nv">UrlOriginal</span><span class="ss">(</span><span class="nv">this</span><span class="w"> </span><span class="nv">HttpRequestBase</span><span class="w"> </span><span class="nv">request</span><span class="ss">)</span>
{
<span class="w">  </span><span class="nv">string</span><span class="w"> </span><span class="nv">hostHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">request</span>.<span class="nv">Headers</span>[<span class="s2">"host"</span>]<span class="c1">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Uri</span><span class="ss">(</span><span class="nv">string</span>.<span class="nv">Format</span><span class="ss">(</span><span class="s2">"{0}://{1}{2}"</span>,
<span class="w">     </span><span class="nv">request</span>.<span class="nv">Url</span>.<span class="nv">Scheme</span>,<span class="w"> </span>
<span class="w">     </span><span class="nv">hostHeader</span>,<span class="w"> </span>
<span class="w">     </span><span class="nv">request</span>.<span class="nv">RawUrl</span><span class="ss">))</span><span class="c1">;</span>
}
</pre></div>

<p>And then you can execute it off the <code>RequestContext.HttpContext.Request</code>
property.</p>
<p>There is a bug (can be side-stepped, see below) in Asp.Net that arises on
machines that use ports other than port 80 for the local website (a big issue
if internal web sites are published via load-balancing on virtual IP and ports
are used internally for publishing rules) whereby Asp.Net will <em>always</em> add
the port on the <code>AbsoluteUri</code> property - even if the original request does not
use it.</p>
<p>This code ensures that the returned url is always equal to the Url the browser
<em>originally</em> requested (including the port - as it would be included in the
host header) before any load-balancing etc takes place.</p>
<p>At least, it does in our (rather convoluted!) environment :)</p>
<p>If there are any funky proxies in between that rewrite the host header, then
this won't work either.</p>
<p><strong>Update 30th July 2013</strong></p>
<p>As mentioned by @KevinJones in comments below - the setting I mention in the
next section has been documented here: http://msdn.microsoft.com/en-
us/library/hh975440.aspx</p>
<p>Although I have to say I couldn't get it work when I tried it - but that could
just be me making a typo or something.</p>
<p><strong>Update 9th July 2012</strong></p>
<p>I came across this a little while ago, and meant to update this answer, but
never did. When an upvote just came in on this answer I thought I should do it
now.</p>
<p>The 'bug' I mention in Asp.Net can be be controlled with an apparently
undocumented appSettings value - called <code>'aspnet:UseHostHeaderForRequest'</code> -
i.e:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;appSettings&gt;</span>
<span class="w">  </span><span class="nt">&lt;add</span><span class="w"> </span><span class="na">key=</span><span class="s">"aspnet:UseHostHeaderForRequest"</span><span class="w"> </span><span class="na">value=</span><span class="s">"true"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/appSettings&gt;</span>
</pre></div>

<p>I came across this while looking at <code>HttpRequest.Url</code> in ILSpy - indicated by
the <code>---&gt;</code> on the left of the following copy/paste from that ILSpy view:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="n">Uri</span><span class="w"> </span><span class="n">Url</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">get</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">_url</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">_wr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">null</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">QueryStringText</span><span class="p">;</span>
<span class="w">      </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"?"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">HttpEncoder</span><span class="p">.</span><span class="n">CollapsePercentUFromStringInternal</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span>
<span class="w">          </span><span class="n">this</span><span class="p">.</span><span class="n">QueryStringEncoding</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w"> </span><span class="o">---&gt;</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">AppSettings</span><span class="p">.</span><span class="n">UseHostHeaderForRequestUrl</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="n">knownRequestHeader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">_wr</span><span class="p">.</span><span class="n">GetKnownRequestHeader</span><span class="p">(</span><span class="mi">28</span><span class="p">);</span>
<span class="w">        </span><span class="n">try</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">knownRequestHeader</span><span class="p">))</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="n">this</span><span class="p">.</span><span class="n">_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Uri</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">Concat</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">string</span><span class="p">[]</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="n">this</span><span class="p">.</span><span class="n">_wr</span><span class="p">.</span><span class="n">GetProtocol</span><span class="p">(),</span>
<span class="w">              </span><span class="s">"://"</span><span class="p">,</span>
<span class="w">              </span><span class="n">knownRequestHeader</span><span class="p">,</span>
<span class="w">              </span><span class="n">this</span><span class="p">.</span><span class="n">Path</span><span class="p">,</span>
<span class="w">              </span><span class="n">text</span><span class="w"> </span>
<span class="w">            </span><span class="p">}));</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">UriFormatException</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">     </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">_url</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* build from server name and port */</span>
<span class="w">       </span><span class="p">...</span>
</pre></div>

<p>I personally haven't used it - it's undocumented and so therefore not
guaranteed to stick around - however it might do the same thing that I mention
above. To increase relevancy in search results - and to acknowledge somebody
else who seeems to have discovered this - the
<code>'aspnet:UseHostHeaderForRequest'</code> setting has also been mentioned by Nick
Aceves on Twitter</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2251.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2249.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
