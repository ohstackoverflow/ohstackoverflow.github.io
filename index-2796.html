<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2796) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2796.html">
<link rel="prev" href="index-2797.html" type="text/html">
<link rel="next" href="index-2795.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/latex-source-code-listing-like-in-professional-books/" class="u-url">LaTeX source code listing like in professional books</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/latex-source-code-listing-like-in-professional-books/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T18:34:24+08:00" itemprop="datePublished" title="2023-03-05 18:34">2023-03-05 18:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How should a latex source code listing look like to produce an output like in
known books, for example one for the Spring Framework? I've tried with the
latex listings package but wasn't able to produce something that looked as
nice as the one below. So I'm primarely interested in the formatting
instructions to produce something like the sample below (from Manning's sample
chapter for <em>Spring in Action</em> ):</p>
<p><img alt="From Manning's Spring in Action" src="images/GhMUK.png"></p>
<p><strong>EDIT</strong> With the help especially of Tormod Fjeldskår here's the complete
snippet to produce the desired look:</p>
<div class="code"><pre class="code literal-block"><span class="err">\</span><span class="n">usepackage</span><span class="err">{</span><span class="n">listings</span><span class="err">}</span>
<span class="err">\</span><span class="n">usepackage</span><span class="err">{</span><span class="n">courier</span><span class="err">}</span>
<span class="err">\</span><span class="n">lstset</span><span class="err">{</span>
<span class="w">    </span><span class="n">basicstyle</span><span class="o">=</span><span class="err">\</span><span class="n">footnotesize</span><span class="err">\</span><span class="n">ttfamily</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="k">Default</span><span class="w"> </span><span class="n">font</span>
<span class="w">    </span><span class="o">%</span><span class="w"> </span><span class="n">numbers</span><span class="o">=</span><span class="nf">left</span><span class="p">,</span><span class="w">              </span><span class="o">%</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">numbers</span>
<span class="w">    </span><span class="n">numberstyle</span><span class="o">=</span><span class="err">\</span><span class="n">tiny</span><span class="p">,</span><span class="w">          </span><span class="o">%</span><span class="w"> </span><span class="n">Style</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">numbers</span>
<span class="w">    </span><span class="o">%</span><span class="w"> </span><span class="n">stepnumber</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w">              </span><span class="o">%</span><span class="w"> </span><span class="n">Margin</span><span class="w"> </span><span class="ow">between</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">numbers</span>
<span class="w">    </span><span class="n">numbersep</span><span class="o">=</span><span class="mi">5</span><span class="n">pt</span><span class="p">,</span><span class="w">              </span><span class="o">%</span><span class="w"> </span><span class="n">Margin</span><span class="w"> </span><span class="ow">between</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nc">text</span>
<span class="w">    </span><span class="n">tabsize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w">                  </span><span class="o">%</span><span class="w"> </span><span class="k">Size</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">tabs</span>
<span class="w">    </span><span class="n">extendedchars</span><span class="o">=</span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">breaklines</span><span class="o">=</span><span class="k">true</span><span class="p">,</span><span class="w">            </span><span class="o">%</span><span class="w"> </span><span class="n">Lines</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">wrapped</span>
<span class="w">    </span><span class="n">keywordstyle</span><span class="o">=</span><span class="err">\</span><span class="n">color</span><span class="err">{</span><span class="n">red</span><span class="err">}</span><span class="p">,</span>
<span class="w">    </span><span class="n">frame</span><span class="o">=</span><span class="n">b</span><span class="p">,</span>
<span class="w">    </span><span class="o">%</span><span class="w"> </span><span class="n">keywordstyle</span><span class="o">=[</span><span class="n">1</span><span class="o">]</span><span class="err">\</span><span class="n">textbf</span><span class="p">,</span>
<span class="w">    </span><span class="o">%</span><span class="w"> </span><span class="n">keywordstyle</span><span class="o">=[</span><span class="n">2</span><span class="o">]</span><span class="err">\</span><span class="n">textbf</span><span class="p">,</span>
<span class="w">    </span><span class="o">%</span><span class="w"> </span><span class="n">keywordstyle</span><span class="o">=[</span><span class="n">3</span><span class="o">]</span><span class="err">\</span><span class="n">textbf</span><span class="p">,</span>
<span class="w">    </span><span class="o">%</span><span class="w"> </span><span class="n">keywordstyle</span><span class="o">=[</span><span class="n">4</span><span class="o">]</span><span class="err">\</span><span class="n">textbf</span><span class="p">,</span><span class="w">   </span><span class="err">\</span><span class="nf">sqrt</span><span class="err">{\</span><span class="nf">sqrt</span><span class="err">{}}</span>
<span class="w">    </span><span class="n">stringstyle</span><span class="o">=</span><span class="err">\</span><span class="n">color</span><span class="err">{</span><span class="n">white</span><span class="err">}\</span><span class="n">ttfamily</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">strings</span>
<span class="w">    </span><span class="n">showspaces</span><span class="o">=</span><span class="k">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">showtabs</span><span class="o">=</span><span class="k">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">xleftmargin</span><span class="o">=</span><span class="mi">17</span><span class="n">pt</span><span class="p">,</span>
<span class="w">    </span><span class="n">framexleftmargin</span><span class="o">=</span><span class="mi">17</span><span class="n">pt</span><span class="p">,</span>
<span class="w">    </span><span class="n">framexrightmargin</span><span class="o">=</span><span class="mi">5</span><span class="n">pt</span><span class="p">,</span>
<span class="w">    </span><span class="n">framexbottommargin</span><span class="o">=</span><span class="mi">4</span><span class="n">pt</span><span class="p">,</span>
<span class="w">    </span><span class="o">%</span><span class="w"> </span><span class="n">backgroundcolor</span><span class="o">=</span><span class="err">\</span><span class="n">color</span><span class="err">{</span><span class="n">lightgray</span><span class="err">}</span><span class="p">,</span>
<span class="w">    </span><span class="n">showstringspaces</span><span class="o">=</span><span class="k">false</span>
<span class="err">}</span>
<span class="err">\</span><span class="n">lstloadlanguages</span><span class="err">{</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="k">Check</span><span class="w"> </span><span class="n">documentation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">further</span><span class="w"> </span><span class="n">languages</span><span class="w"> </span><span class="p">...</span>
<span class="w">     </span><span class="o">%</span><span class="w"> </span><span class="o">[</span><span class="n">Visual</span><span class="o">]</span><span class="n">Basic</span><span class="p">,</span>
<span class="w">     </span><span class="o">%</span><span class="w"> </span><span class="k">Pascal</span><span class="p">,</span>
<span class="w">     </span><span class="o">%</span><span class="w"> </span><span class="n">C</span><span class="p">,</span>
<span class="w">     </span><span class="o">%</span><span class="w"> </span><span class="n">C</span><span class="o">++</span><span class="p">,</span>
<span class="w">     </span><span class="o">%</span><span class="w"> </span><span class="nc">XML</span><span class="p">,</span>
<span class="w">     </span><span class="o">%</span><span class="w"> </span><span class="n">HTML</span><span class="p">,</span>
<span class="w">     </span><span class="n">Java</span>
<span class="err">}</span>
<span class="o">%</span><span class="w"> </span><span class="err">\</span><span class="n">DeclareCaptionFont</span><span class="err">{</span><span class="n">blue</span><span class="err">}{\</span><span class="n">color</span><span class="err">{</span><span class="n">blue</span><span class="err">}}</span>

<span class="o">%</span><span class="w"> </span><span class="err">\</span><span class="n">captionsetup</span><span class="o">[</span><span class="n">lstlisting</span><span class="o">]</span><span class="err">{</span><span class="n">singlelinecheck</span><span class="o">=</span><span class="k">false</span><span class="p">,</span><span class="w"> </span><span class="n">labelfont</span><span class="o">=</span><span class="err">{</span><span class="n">blue</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="n">textfont</span><span class="o">=</span><span class="err">{</span><span class="n">blue</span><span class="err">}}</span>
<span class="err">\</span><span class="n">usepackage</span><span class="err">{</span><span class="n">caption</span><span class="err">}</span>
<span class="err">\</span><span class="n">DeclareCaptionFont</span><span class="err">{</span><span class="n">white</span><span class="err">}{\</span><span class="n">color</span><span class="err">{</span><span class="n">white</span><span class="err">}}</span>
<span class="err">\</span><span class="n">DeclareCaptionFormat</span><span class="err">{</span><span class="n">listing</span><span class="err">}{\</span><span class="n">colorbox</span><span class="o">[</span><span class="n">cmyk</span><span class="o">]</span><span class="err">{</span><span class="mf">0.43</span><span class="p">,</span><span class="w"> </span><span class="mf">0.35</span><span class="p">,</span><span class="w"> </span><span class="mf">0.35</span><span class="p">,</span><span class="mf">0.01</span><span class="err">}{\</span><span class="n">parbox</span><span class="err">{\</span><span class="n">textwidth</span><span class="err">}{\</span><span class="n">hspace</span><span class="err">{</span><span class="mi">15</span><span class="n">pt</span><span class="err">}</span><span class="n">#1#2#3</span><span class="err">}}}</span>
<span class="err">\</span><span class="n">captionsetup</span><span class="o">[</span><span class="n">lstlisting</span><span class="o">]</span><span class="err">{</span><span class="nf">format</span><span class="o">=</span><span class="n">listing</span><span class="p">,</span><span class="n">labelfont</span><span class="o">=</span><span class="n">white</span><span class="p">,</span><span class="n">textfont</span><span class="o">=</span><span class="n">white</span><span class="p">,</span><span class="w"> </span><span class="n">singlelinecheck</span><span class="o">=</span><span class="k">false</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="o">=</span><span class="mi">0</span><span class="n">pt</span><span class="p">,</span><span class="w"> </span><span class="n">font</span><span class="o">=</span><span class="err">{</span><span class="n">bf</span><span class="p">,</span><span class="n">footnotesize</span><span class="err">}}</span>
</pre></div>

<p>Use it with this in your document:</p>
<div class="code"><pre class="code literal-block">\lstinputlisting[label=samplecode, caption=A sample]{sourceCode/HelloWorld.java}
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>It seems to me that what you really want, is to customize the look of the
captions. This is most easily done using the <code>caption</code> package. For
instructions how to use this package, see the manual (PDF). You would probably
need to create your own custom caption format, as described in chapter 4 in
the manual.</p>
<p><strong>Edit:</strong> Tested with MikTex:</p>
<div class="code"><pre class="code literal-block"><span class="k">\documentclass</span><span class="nb">{</span>report<span class="nb">}</span>

<span class="k">\usepackage</span><span class="nb">{</span>color<span class="nb">}</span>
<span class="k">\usepackage</span><span class="nb">{</span>xcolor<span class="nb">}</span>
<span class="k">\usepackage</span><span class="nb">{</span>listings<span class="nb">}</span>

<span class="k">\usepackage</span><span class="nb">{</span>caption<span class="nb">}</span>
<span class="k">\DeclareCaptionFont</span><span class="nb">{</span>white<span class="nb">}{</span><span class="k">\color</span><span class="nb">{</span>white<span class="nb">}}</span>
<span class="k">\DeclareCaptionFormat</span><span class="nb">{</span>listing<span class="nb">}{</span><span class="k">\colorbox</span><span class="nb">{</span>gray<span class="nb">}{</span><span class="k">\parbox</span><span class="nb">{</span><span class="k">\textwidth</span><span class="nb">}{</span>#1#2#3<span class="nb">}}}</span>
<span class="k">\captionsetup</span><span class="na">[lstlisting]</span><span class="nb">{</span>format=listing,labelfont=white,textfont=white<span class="nb">}</span>

<span class="c">% This concludes the preamble</span>

<span class="k">\begin</span><span class="nb">{</span>document<span class="nb">}</span>

<span class="k">\begin</span><span class="nb">{</span>lstlisting<span class="nb">}</span>[label=some-code,caption=Some Code]
public void here() <span class="nb">{</span>
    goes().the().code()
<span class="nb">}</span>
<span class="k">\end</span><span class="nb">{</span>lstlisting<span class="nb">}</span>

<span class="k">\end</span><span class="nb">{</span>document<span class="nb">}</span>
</pre></div>

<p><strong>Result:</strong></p>
<p><img alt="Preview" src="images/WmL2j.png"></p>
<p><br></p>
<h3>Suggest</h3>
<p>I am happy with the <code>listings</code> package:</p>
<p><img alt="Listing example" src="https://i.imgur.com/f90FB.png"></p>
<p>Here is how I configure it:</p>
<div class="code"><pre class="code literal-block">\lstset{
language=C,
basicstyle=\small\sffamily,
numbers=left,
numberstyle=\tiny,
frame=tb,
columns=fullflexible,
showstringspaces=false
}
</pre></div>

<p>I use it like this:</p>
<div class="code"><pre class="code literal-block">\<span class="nv">begin</span>{<span class="nv">lstlisting</span>}[<span class="nv">caption</span><span class="o">=</span><span class="nv">Caption</span><span class="w"> </span><span class="nv">example</span>.,
<span class="w">  </span><span class="nv">label</span><span class="o">=</span><span class="nv">a_label</span>,
<span class="w">  </span><span class="nv">float</span><span class="o">=</span><span class="nv">t</span>]
<span class="o">//</span><span class="w"> </span><span class="nv">Insert</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="nv">here</span>
\<span class="k">end</span>{<span class="nv">lstlisting</span>}
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-include-scripts-located-inside-the-node-modules-folder/" class="u-url">How to include scripts located inside the node_modules folder?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-include-scripts-located-inside-the-node-modules-folder/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T18:33:02+08:00" itemprop="datePublished" title="2023-03-05 18:33">2023-03-05 18:33</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a question concerning best practice for including <code>node_modules</code> into a
HTML website.</p>
<p>Imagine I have Bootstrap inside my <code>node_modules</code> folder. Now for the
production version of the website, how would I include the Bootstrap script
and CSS files located inside the <code>node_modules</code> folder? Does it make sense to
leave Bootstrap inside that folder and do something like the following?</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"./node_modules/bootstrap/dist/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>

<p>Or would I have to add rules to my gulp file which then copy those files into
my dist folder? Or would it be best to let gulp somehow completely remove the
local bootstrap from my HTML file and replace it with the CDN version?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Usually, you don't want to expose any of your internal paths for how your
server is structured to the outside world. What you can is make a <code>/scripts</code>
static route in your server that fetches its files from whatever directory
they happen to reside in. So, if your files are in
<code>"./node_modules/bootstrap/dist/"</code>. Then, the script tag in your pages just
looks like this:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"/scripts/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>

<p>If you were using express with nodejs, a static route is as simple as this:</p>
<div class="code"><pre class="code literal-block">app.use('/scripts', express.static(__dirname + '/node_modules/bootstrap/dist/'));
</pre></div>

<p>Then, any browser requests from <code>/scripts/xxx.js</code> will automatically be
fetched from your <code>dist</code> directory at <code>__dirname +
/node_modules/bootstrap/dist/xxx.js</code>.</p>
<p>Note: Newer versions of NPM put more things at the top level, not nested so
deep so if you are using a newer version of NPM, then the path names will be
different than indicated in the OP's question and in the current answer. But,
the concept is still the same. You find out where the files are physically
located on your server drive and you make an <code>app.use()</code> with
<code>express.static()</code> to make a pseudo-path to those files so you aren't exposing
the actual server file system organization to the client.</p>
<hr>
<p>If you don't want to make a static route like this, then you're probably
better off just copying the public scripts to a path that your web server does
treat as <code>/scripts</code> or whatever top level designation you want to use.
Usually, you can make this copying part of your build/deployment process.</p>
<hr>
<p>If you want to make just one particular file public in a directory and not
everything found in that directory with it, then you can manually create
individual routes for each file rather than use <code>express.static()</code> such as:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>

<p>And the code to create a route for that</p>
<div class="code"><pre class="code literal-block"><span class="nv">app</span>.<span class="nv">get</span><span class="ss">(</span><span class="s1">'/bootstrap.min.js'</span>,<span class="w"> </span><span class="nv">function</span><span class="ss">(</span><span class="nv">req</span>,<span class="w"> </span><span class="nv">res</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">res</span>.<span class="k">sendFile</span><span class="ss">(</span><span class="nv">__dirname</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'/node_modules/bootstrap/dist/bootstrap.min.js'</span><span class="ss">)</span><span class="c1">;</span>
}<span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>Or, if you want to still delineate routes for scripts with <code>/scripts</code>, you
could do this:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"/scripts/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>

<p>And the code to create a route for that</p>
<div class="code"><pre class="code literal-block"><span class="nv">app</span>.<span class="nv">get</span><span class="ss">(</span><span class="s1">'/scripts/bootstrap.min.js'</span>,<span class="w"> </span><span class="nv">function</span><span class="ss">(</span><span class="nv">req</span>,<span class="w"> </span><span class="nv">res</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">res</span>.<span class="k">sendFile</span><span class="ss">(</span><span class="nv">__dirname</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'/node_modules/bootstrap/dist/bootstrap.min.js'</span><span class="ss">)</span><span class="c1">;</span>
}<span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I would use the path npm module and then do something like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'/scripts'</span><span class="p">,</span><span class="w"> </span><span class="n">express</span><span class="o">.</span><span class="k">static</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">__dirname</span><span class="p">,</span><span class="w"> </span><span class="s1">'node_modules/bootstrap/dist'</span><span class="p">)));</span>
</pre></div>

<p><strong>IMPORTANT:</strong> we use path.join to make paths joining using system agnostic
way, i.e. on windows and unix we have different path separators (/ and \)</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/catch-an-exception-thrown-by-an-async-void-method/" class="u-url">Catch an exception thrown by an async void method</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/catch-an-exception-thrown-by-an-async-void-method/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T18:31:40+08:00" itemprop="datePublished" title="2023-03-05 18:31">2023-03-05 18:31</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Using the async CTP from Microsoft for .NET, is it possible to catch an
exception thrown by an async method in the calling method?</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">Foo</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">DoSomethingAsync</span><span class="p">();</span>

<span class="w">    </span><span class="o">/*</span><span class="w"> </span><span class="n">Handle</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">sometimes</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">thrown</span><span class="o">.</span>
<span class="w">       </span><span class="n">For</span><span class="w"> </span><span class="n">example</span><span class="p">,</span><span class="w"> </span><span class="n">DoSomethingAsync</span><span class="w"> </span><span class="n">gets</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">network</span>
<span class="w">       </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">invalid</span><span class="o">...</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">ProtocolException</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">thrown</span><span class="o">.</span><span class="w"> </span><span class="o">*/</span>
<span class="p">}</span>

<span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">DoFoo</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">try</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Foo</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ProtocolException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">          </span><span class="o">/*</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">caught</span><span class="o">.</span>
<span class="w">             </span><span class="n">Instead</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="n">VS2010</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">warn</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">continue</span><span class="o">.</span>
<span class="w">             </span><span class="n">The</span><span class="w"> </span><span class="n">deployed</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">simply</span><span class="w"> </span><span class="n">crash</span><span class="o">.</span><span class="w"> </span><span class="o">*/</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>So basically I want the exception from the async code to bubble up into my
calling code if that is even possible at all.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>It's somewhat weird to read but yes, the exception will bubble up to the
calling code - but only <strong>if you<code>await</code> or <code>Wait()</code> the call to <code>Foo</code></strong>.</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="n">Foo</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">DoSomethingAsync</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">public</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">DoFoo</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">try</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">await</span><span class="w"> </span><span class="n">Foo</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ProtocolException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">caught</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">you</span><span class="s1">'ve awaited</span>
<span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="n">method</span><span class="o">.</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span><span class="ow">or</span><span class="o">//</span>

<span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">DoFoo</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">try</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Foo</span><span class="p">()</span><span class="o">.</span><span class="n">Wait</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ProtocolException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">          </span><span class="o">/*</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">caught</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">you</span><span class="s1">'ve</span>
<span class="w">             </span><span class="n">waited</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">completion</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">call</span><span class="o">.</span><span class="w"> </span><span class="o">*/</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As Stephen Cleary wrote in Async/Await - Best Practices in Asynchronous
Programming:</p>
<blockquote>
<p>Async void methods have different error-handling semantics. When an
exception is thrown out of an async Task or async Task method, that
exception is captured and placed on the Task object. With async void
methods, there is no Task object, so any exceptions thrown out of an async
void method will be raised directly on the SynchronizationContext that was
active when the async void method started.</p>
</blockquote>
<p>Note that using <code>Wait()</code> may cause your application to block, if .NET decides
to execute your method synchronously.</p>
<p>This explanation http://www.interact-
sw.co.uk/iangblog/2010/11/01/csharp5-async-exceptions is pretty good - it
discusses the steps the compiler takes to achieve this magic.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The reason the exception is not caught is because the Foo() method has a void
return type and so when await is called, it simply returns. As DoFoo() is not
awaiting the completion of Foo, the exception handler cannot be used.</p>
<p>This opens up a simpler solution if you can change the method signatures -
alter <code>Foo()</code> so that it returns type <code>Task</code> and then <code>DoFoo()</code> can <code>await
Foo()</code>, as in this code:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">DoSomethingThatThrows</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">public</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">DoFoo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">await</span><span class="w"> </span><span class="n">Foo</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ProtocolException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="n">exceptions</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">DoSomethingThatThrows</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2797.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2795.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
