<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 401) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-401.html">
<link rel="prev" href="index-402.html" type="text/html">
<link rel="next" href="index-400.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/angular-conditional-class-with-ngclass/" class="u-url">Angular: conditional class with *ngClass</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/angular-conditional-class-with-ngclass/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:56:14+08:00" itemprop="datePublished" title="2023-02-17 05:56">2023-02-17 05:56</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What is wrong with my Angular code? I am getting the following error:</p>
<blockquote>
<p>Cannot read property 'remove' of undefined at BrowserDomAdapter.removeClass</p>
</blockquote>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;ol&gt;</span>
<span class="w">  </span><span class="nt">&lt;li</span><span class="w"> </span><span class="err">*</span><span class="na">ngClass=</span><span class="s">"{active: step==='step1'}"</span><span class="w"> </span><span class="err">(click)="</span><span class="na">step=</span><span class="s">'step1'</span><span class="err">"</span><span class="nt">&gt;</span>Step1<span class="nt">&lt;/li&gt;</span>
<span class="w">  </span><span class="nt">&lt;li</span><span class="w"> </span><span class="err">*</span><span class="na">ngClass=</span><span class="s">"{active: step==='step2'}"</span><span class="w"> </span><span class="err">(click)="</span><span class="na">step=</span><span class="s">'step2'</span><span class="err">"</span><span class="nt">&gt;</span>Step2<span class="nt">&lt;/li&gt;</span>
<span class="w">  </span><span class="nt">&lt;li</span><span class="w"> </span><span class="err">*</span><span class="na">ngClass=</span><span class="s">"{active: step==='step3'}"</span><span class="w"> </span><span class="err">(click)="</span><span class="na">step=</span><span class="s">'step3'</span><span class="err">"</span><span class="nt">&gt;</span>Step3<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ol&gt;</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>Angular version 2+ provides several ways to add classes conditionally:</p>
<p><strong>type one</strong></p>
<div class="code"><pre class="code literal-block">    [class.my_class] = "step === 'step1'"
</pre></div>

<p><strong>type two</strong></p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="o">[</span><span class="n">ngClass</span><span class="o">]=</span><span class="ss">"{'my_class': step === 'step1'}"</span>
</pre></div>

<p>and multiple option:</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="o">[</span><span class="n">ngClass</span><span class="o">]=</span><span class="ss">"{'my_class': step === 'step1', 'my_class2' : step === 'step2' }"</span>
</pre></div>

<p><strong>type three</strong></p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="o">[</span><span class="n">ngClass</span><span class="o">]=</span><span class="ss">"{1 : 'my_class1', 2 : 'my_class2', 3 : 'my_class4'}[step]"</span>
</pre></div>

<p><strong>type four</strong></p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="o">[</span><span class="n">ngClass</span><span class="o">]=</span><span class="ss">"step == 'step1' ? 'my_class1' : 'my_class2'"</span>
</pre></div>

<p>You can find these examples on the documentation page</p>
<p><br></p>
<h3>Suggest</h3>
<p><code>[ngClass]=...</code> instead of <code>*ngClass</code>.</p>
<p><code>*</code> is only for the shorthand syntax for structural directives where you can
for example use</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="err">*</span><span class="na">ngFor=</span><span class="s">"let item of items"</span><span class="nt">&gt;</span><span class="cp">{{</span><span class="nv">item</span><span class="cp">}}</span><span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>instead of the longer equivalent version</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">template</span><span class="w"> </span><span class="n">ngFor</span><span class="w"> </span><span class="n">let</span><span class="o">-</span><span class="n">item</span><span class="w"> </span><span class="o">[</span><span class="n">ngForOf</span><span class="o">]=</span><span class="ss">"items"</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="err">{{</span><span class="n">item</span><span class="err">}}</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">template</span><span class="o">&gt;</span>
</pre></div>

<p>See also https://angular.io/docs/ts/latest/api/common/index/NgClass-
directive.html</p>
<blockquote>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="ow">some</span><span class="o">-</span><span class="k">element</span><span class="w"> </span><span class="o">[</span><span class="n">ngClass</span><span class="o">]=</span><span class="ss">"'first second'"</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="ow">some</span><span class="o">-</span><span class="k">element</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="ow">some</span><span class="o">-</span><span class="k">element</span><span class="w"> </span><span class="o">[</span><span class="n">ngClass</span><span class="o">]=</span><span class="ss">"['first', 'second']"</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="ow">some</span><span class="o">-</span><span class="k">element</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="ow">some</span><span class="o">-</span><span class="k">element</span><span class="w"> </span><span class="o">[</span><span class="n">ngClass</span><span class="o">]=</span><span class="err">"{</span><span class="s1">'first'</span><span class="err">:</span><span class="w"> </span><span class="k">true</span><span class="p">,</span><span class="w"> </span><span class="s1">'second'</span><span class="err">:</span><span class="w"> </span><span class="k">true</span><span class="p">,</span><span class="w"> </span><span class="s1">'third'</span><span class="err">:</span>
</pre></div>

<p>false}"&gt;...
    <some-element>...</some-element><some-element class2 class3 : true>...
</some-element></p>
</blockquote>
<p>See also https://angular.io/docs/ts/latest/guide/template-syntax.html</p>
<blockquote>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span><span class="w"> </span><span class="n">toggle</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="ss">"special"</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="k">on</span><span class="o">/</span><span class="k">off</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="o">[</span><span class="n">class.special</span><span class="o">]=</span><span class="ss">"isSpecial"</span><span class="o">&gt;</span><span class="n">The</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">special</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="err">!</span><span class="o">--</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="err">`</span><span class="k">class</span><span class="p">.</span><span class="n">special</span><span class="err">`</span><span class="w"> </span><span class="n">trumps</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">attribute</span><span class="w"> </span><span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="k">class</span><span class="o">=</span><span class="ss">"special"</span>
<span class="w">     </span><span class="o">[</span><span class="n">class.special</span><span class="o">]=</span><span class="ss">"!isSpecial"</span><span class="o">&gt;</span><span class="n">This</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">special</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>


<span class="o">&lt;</span><span class="err">!</span><span class="o">--</span><span class="w"> </span><span class="n">reset</span><span class="o">/</span><span class="n">override</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="k">names</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">binding</span><span class="w">  </span><span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="n">div</span><span class="w"> </span><span class="k">class</span><span class="o">=</span><span class="ss">"bad curly special"</span>
<span class="w">     </span><span class="o">[</span><span class="n">class</span><span class="o">]=</span><span class="ss">"badCurly"</span><span class="o">&gt;</span><span class="n">Bad</span><span class="w"> </span><span class="n">curly</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>

</blockquote>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/returning-json-from-a-php-script/" class="u-url">Returning JSON from a PHP Script</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/returning-json-from-a-php-script/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:55:47+08:00" itemprop="datePublished" title="2023-02-17 05:55">2023-02-17 05:55</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to return JSON from a PHP script.</p>
<p>Do I just echo the result? Do I have to set the <code>Content-Type</code> header?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>While you're usually fine without it, you can and should set the <code>Content-
Type</code> header:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="sd">/** whatever you're serializing **/</span><span class="p">;</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/json; charset=utf-8'</span><span class="p">);</span>
<span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
</pre></div>

<p>If I'm not using a particular framework, I usually allow some request params
to modify the output behavior. It can be useful, generally for quick
troubleshooting, to not send a header, or sometimes <code>print_r</code> the data payload
to eyeball it (though in most cases, it shouldn't be necessary).</p>
<p><br></p>
<h3>Suggest</h3>
<p>A complete piece of nice and clear PHP code returning JSON is:</p>
<div class="code"><pre class="code literal-block"><span class="err">$</span><span class="s s-Atom">option</span> <span class="o">=</span> <span class="err">$</span><span class="k">_</span><span class="nv">GET</span><span class="p">[</span><span class="s s-Atom">'option'</span><span class="p">];</span>

<span class="nf">if</span> <span class="p">(</span> <span class="err">$</span><span class="s s-Atom">option</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
    <span class="err">$</span><span class="s s-Atom">data</span> <span class="o">=</span> <span class="p">[</span> <span class="s s-Atom">'a'</span><span class="p">,</span> <span class="s s-Atom">'b'</span><span class="p">,</span> <span class="s s-Atom">'c'</span> <span class="p">];</span>
    <span class="o">//</span> <span class="s s-Atom">will</span> <span class="s s-Atom">encode</span> <span class="s s-Atom">to</span> <span class="nv">JSON</span> <span class="s s-Atom">array</span><span class="p">:</span> <span class="p">[</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">,</span><span class="s2">"c"</span><span class="p">]</span>
    <span class="o">//</span> <span class="s s-Atom">accessed</span> <span class="s s-Atom">as</span> <span class="s s-Atom">example</span> <span class="s s-Atom">in</span> <span class="nv">JavaScript</span> <span class="s s-Atom">like</span><span class="p">:</span> <span class="s s-Atom">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">(</span><span class="s s-Atom">returns</span> <span class="s2">"b"</span><span class="p">)</span>
<span class="p">}</span> <span class="s s-Atom">else</span> <span class="p">{</span>
    <span class="err">$</span><span class="s s-Atom">data</span> <span class="o">=</span> <span class="p">[</span> <span class="s s-Atom">'name'</span> <span class="o">=&gt;</span> <span class="s s-Atom">'God'</span><span class="p">,</span> <span class="s s-Atom">'age'</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">];</span>
    <span class="o">//</span> <span class="s s-Atom">will</span> <span class="s s-Atom">encode</span> <span class="s s-Atom">to</span> <span class="nv">JSON</span> <span class="s s-Atom">object</span><span class="p">:</span> <span class="p">{</span><span class="s2">"name"</span><span class="o">:</span><span class="s2">"God"</span><span class="p">,</span><span class="s2">"age"</span><span class="o">:-</span><span class="mi">1</span><span class="p">}</span>  
    <span class="o">//</span> <span class="s s-Atom">accessed</span> <span class="s s-Atom">as</span> <span class="s s-Atom">example</span> <span class="s s-Atom">in</span> <span class="nv">JavaScript</span> <span class="s s-Atom">like</span><span class="p">:</span> <span class="s s-Atom">result</span><span class="p">.</span><span class="s s-Atom">name</span> <span class="s s-Atom">or</span> <span class="s s-Atom">result</span><span class="p">[</span><span class="s s-Atom">'name'</span><span class="p">]</span> <span class="p">(</span><span class="s s-Atom">returns</span> <span class="s2">"God"</span><span class="p">)</span>
<span class="p">}</span>

<span class="nf">header</span><span class="p">(</span><span class="s s-Atom">'Content-type: application/json'</span><span class="p">);</span>
<span class="s s-Atom">echo</span> <span class="nf">json_encode</span><span class="p">(</span> <span class="err">$</span><span class="s s-Atom">data</span> <span class="p">);</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-type-hint-a-method-with-the-type-of-the-enclosing-class/" class="u-url">How do I type hint a method with the type of the enclosing class?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-type-hint-a-method-with-the-type-of-the-enclosing-class/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:55:19+08:00" itemprop="datePublished" title="2023-02-17 05:55">2023-02-17 05:55</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have the following code in Python 3:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Position:</span>

    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, <span class="o">x</span>: <span class="n">int</span>, <span class="n">y:</span> <span class="n">int</span>):
        <span class="nb">self</span>.<span class="nb">x</span> = <span class="nb">x</span>
        <span class="nb">self</span>.<span class="n">y</span> = <span class="n">y</span>

    <span class="n">def</span> <span class="n">__add__</span>(<span class="nb">self</span>, <span class="n">other:</span> <span class="n">Position</span>) -&gt; <span class="n">Position:</span>
        <span class="k">return</span> <span class="n">Position</span>(<span class="nb">self</span>.<span class="nb">x</span> + <span class="n">other</span>.<span class="nb">x</span>, <span class="nb">self</span>.<span class="n">y</span> + <span class="n">other</span>.<span class="n">y</span>)
</pre></div>

<p>But my editor (PyCharm) says that the reference <code>Position</code> can not be resolved
(in the <code>__add__</code> method). How should I specify that I expect the return type
to be of type <code>Position</code>?</p>
<p>Edit: I think this is actually a PyCharm issue. It actually uses the
information in its warnings, and code completion.</p>
<p><img alt="" src="https://i.imgur.com/yjjCWw3.png"></p>
<p>But correct me if I'm wrong, and need to use some other syntax.</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>TL;DR</strong> : As of today (2019), in Python 3.7+ you can turn this feature on
using a "future" statement, <code>from __future__ import annotations</code>.</p>
<p>(The behaviour enabled by <code>from __future__ import annotations</code> <em>might</em> become
the default in future versions of Python, and was going to be made the default
in Python 3.10. However, the change in 3.10 was reverted at the last minute,
and now may not happen at all.)</p>
<p>In Python 3.6 or below, you should use a string.</p>
<hr>
<p>I guess you got this exception:</p>
<div class="code"><pre class="code literal-block"><span class="n">NameError</span><span class="o">:</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="s1">'Position'</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">defined</span>
</pre></div>

<p>This is because <code>Position</code> must be defined before you can use it in an
annotation, unless you are using Python with PEP 563 changes enabled.</p>
<h3>Python 3.7+: <code>from __future__ import annotations</code>
</h3>
<p>Python 3.7 introduces PEP 563: postponed evaluation of annotations. A module
that uses the future statement <code>from __future__ import annotations</code> will store
annotations as strings automatically:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="k">class</span> <span class="nc">Position</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Position</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Position</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>

<p>This had been scheduled to become the default in Python 3.10, but this change
has now been postponed. Since Python still is a dynamically typed language so
no type-checking is done at runtime, typing annotations should have no
performance impact, right? Wrong! Before Python 3.7, the typing module used to
be one of the slowest python modules in core so <strong>for code that involves
importing the<code>typing</code> module, you will see an up to 7 times increase in
performance when you upgrade to 3.7.</strong></p>
<h3>Python &lt;3.7: use a string</h3>
<p>According to PEP 484, you should use a string instead of the class itself:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Position:</span>
    ...
    <span class="n">def</span> <span class="n">__add__</span>(<span class="nb">self</span>, <span class="n">other:</span> <span class="s">'Position'</span>) -&gt; <span class="s">'Position'</span>:
       ...
</pre></div>

<p>If you use the Django framework, this may be familiar, as Django models also
use strings for forward references (foreign key definitions where the foreign
model is <code>self</code> or is not declared yet). This should work with Pycharm and
other tools.</p>
<h3>Sources</h3>
<p>The relevant parts of PEP 484 and PEP 563, to spare you the trip:</p>
<blockquote>
<h2>Forward references</h2>
<p>When a type hint contains names that have not been defined yet, that
definition may be expressed as a string literal, to be resolved later.</p>
<p>A situation where this occurs commonly is the definition of a container
class, where the class being defined occurs in the signature of some of the
methods. For example, the following code (the start of a simple binary tree
implementation) does not work:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Tree:</span>
    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, <span class="n">left:</span> <span class="n">Tree</span>, <span class="n">right:</span> <span class="n">Tree</span>):
        <span class="nb">self</span>.<span class="n">left</span> = <span class="n">left</span>
        <span class="nb">self</span>.<span class="nb">right</span> = <span class="nb">right</span>
</pre></div>

<p>To address this, we write:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Tree:</span>
    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, <span class="n">left:</span> <span class="s">'Tree'</span>, <span class="n">right:</span> <span class="s">'Tree'</span>):
        <span class="nb">self</span>.<span class="n">left</span> = <span class="n">left</span>
        <span class="nb">self</span>.<span class="nb">right</span> = <span class="nb">right</span>
</pre></div>

<p>The string literal should contain a valid Python expression (i.e.,
compile(lit, '', 'eval') should be a valid code object) and it should
evaluate without errors once the module has been fully loaded. The local and
global namespace in which it is evaluated should be the same namespaces in
which default arguments to the same function would be evaluated.</p>
</blockquote>
<p>and PEP 563:</p>
<blockquote>
<h2>Implementation</h2>
<p>In Python 3.10, function and variable annotations will no longer be
evaluated at definition time. Instead, a string form will be preserved in
the respective <code>__annotations__</code> dictionary. Static type checkers will see
no difference in behavior, whereas tools using annotations at runtime will
have to perform postponed evaluation.</p>
<p>...</p>
<h3>Enabling the future behavior in Python 3.7</h3>
<p>The functionality described above can be enabled starting from Python 3.7
using the following special import:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</pre></div>

</blockquote>
<h3>Things that you may be tempted to do instead</h3>
<h4>A. Define a dummy <code>Position</code>
</h4>
<p>Before the class definition, place a dummy definition:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Position</span>(<span class="n">object</span>):
    <span class="nb">pass</span>


<span class="k">class</span> <span class="n">Position</span>(<span class="n">object</span>):
    ...
</pre></div>

<p>This will get rid of the <code>NameError</code> and may even look OK:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">Position</span>.<span class="nv">__add__</span>.<span class="nv">__annotations__</span>
{<span class="s1">'other'</span>:<span class="w"> </span><span class="nv">__main__</span>.<span class="nv">Position</span>,<span class="w"> </span><span class="s1">'return'</span>:<span class="w"> </span><span class="nv">__main__</span>.<span class="nv">Position</span>}
</pre></div>

<p>But is it?</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">k</span>,<span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">Position</span>.<span class="nv">__add__</span>.<span class="nv">__annotations__</span>.<span class="nv">items</span><span class="ss">()</span>:
...<span class="w">     </span><span class="nv">print</span><span class="ss">(</span><span class="nv">k</span>,<span class="w"> </span><span class="s1">'is Position:'</span>,<span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">Position</span><span class="ss">)</span><span class="w">                                                                                                                                                                                                                  </span>
<span class="k">return</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">Position</span>:<span class="w"> </span><span class="nv">False</span>
<span class="nv">other</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">Position</span>:<span class="w"> </span><span class="nv">False</span>
</pre></div>

<h4>B. Monkey-patch in order to add the annotations:</h4>
<p>You may want to try some Python metaprogramming magic and write a decorator to
monkey-patch the class definition in order to add annotations:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Position:</span>
    ...
    <span class="n">def</span> <span class="n">__add__</span>(<span class="nb">self</span>, <span class="n">other</span>):
        <span class="k">return</span> <span class="nb">self</span>.<span class="n">__class__</span>(<span class="nb">self</span>.<span class="nb">x</span> + <span class="n">other</span>.<span class="nb">x</span>, <span class="nb">self</span>.<span class="n">y</span> + <span class="n">other</span>.<span class="n">y</span>)
</pre></div>

<p>The decorator should be responsible for the equivalent of this:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Position</span>.<span class="nv">__add__</span>.<span class="nv">__annotations__</span>[<span class="s1">'return'</span>]<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Position</span>
<span class="nv">Position</span>.<span class="nv">__add__</span>.<span class="nv">__annotations__</span>[<span class="s1">'other'</span>]<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Position</span>
</pre></div>

<p>At least it seems right:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">k</span>,<span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">Position</span>.<span class="nv">__add__</span>.<span class="nv">__annotations__</span>.<span class="nv">items</span><span class="ss">()</span>:
...<span class="w">     </span><span class="nv">print</span><span class="ss">(</span><span class="nv">k</span>,<span class="w"> </span><span class="s1">'is Position:'</span>,<span class="w"> </span><span class="nv">v</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">Position</span><span class="ss">)</span><span class="w">                                                                                                                                                                                                                  </span>
<span class="k">return</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">Position</span>:<span class="w"> </span><span class="nv">True</span>
<span class="nv">other</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">Position</span>:<span class="w"> </span><span class="nv">True</span>
</pre></div>

<p>Probably too much trouble.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Starting in Python 3.11 (to be released in late 2022), you'll be able to use
<code>Self</code> as the return type.</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Self</span>


<span class="k">class</span> <span class="nc">Position</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</pre></div>

<p><code>Self</code> is also included in the <code>typing-extensions</code> package (available on
PyPi), which although not part of the standard library, is sort of a "preview"
version of the <code>typing</code> module. From https://pypi.org/project/typing-
extensions/,</p>
<blockquote>
<p>The typing_extensions module serves two related purposes:</p>
<ul>
<li>Enable use of new type system features on older Python versions. For
example, typing.TypeGuard is new in Python 3.10, but typing_extensions
allows users on Python 3.6 through 3.9 to use it too.</li>
<li>Enable experimentation with new type system PEPs before they are
accepted and added to the typing module.
</li>
</ul>
</blockquote>
<p>Currently, <code>typing-extensions</code> officially supports Python 3.7 and later.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-402.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-400.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
