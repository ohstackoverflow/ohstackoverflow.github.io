<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 378) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-378.html">
<link rel="prev" href="index-379.html" type="text/html">
<link rel="next" href="index-377.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jquery-how-to-find-an-element-based-on-a-data-attribute-value/" class="u-url">jQuery how to find an element based on a data-attribute value?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/jquery-how-to-find-an-element-based-on-a-data-attribute-value/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:18:59+08:00" itemprop="datePublished" title="2023-02-17 05:18">2023-02-17 05:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've got the following scenario:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">el</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'li'</span><span class="p">;</span>
</pre></div>

<p>and there are 5 <code>&lt;li&gt;</code>'s on the page each with a <code>data-slide=number</code> attribute
<em>(number being 1,2,3,4,5 respectively)</em>.</p>
<p>I now need to find the currently active slide number which is mapped to <code>var
current = $('ul').data(current);</code> and is updated on each slide change.</p>
<p>So far my tries have been unsuccessful, trying to construct the selector that
would match the current slide:</p>
<div class="code"><pre class="code literal-block">$('ul').find(el+[data-slide=+current+]);
</pre></div>

<p>does not match/return anything…</p>
<p>The reason I can't hardcode the <code>li</code> part is that this is a user accessible
variable that can be changed to a different element if required, so it may not
always be an <code>li</code>.</p>
<p>Any ideas on what I'm missing?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You have to inject the value of <code>current</code> into an Attribute Equals selector:</p>
<div class="code"><pre class="code literal-block">$("ul").find(`[data-slide='<span class="cp">${</span><span class="n">current</span><span class="cp">}</span>']`)
</pre></div>

<p>For older JavaScript environments ( <strong>ES5</strong> and earlier):</p>
<div class="code"><pre class="code literal-block">$("ul").find("[data-slide='" + current + "']");
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>in case you don't want to type all that, here's a shorter way to query by data
attribute:</p>
<div class="code"><pre class="code literal-block">$("ul[data-slide='" + current +"']");
</pre></div>

<p>FYI: http://james.padolsey.com/javascript/a-better-data-selector-for-jquery/</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-make-links-in-a-textview-clickable/" class="u-url">How to make links in a TextView clickable</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-make-links-in-a-textview-clickable/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:18:28+08:00" itemprop="datePublished" title="2023-02-17 05:18">2023-02-17 05:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have the following TextView defined:</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">TextView</span><span class="w"> </span>
<span class="w">    </span><span class="nl">android</span><span class="p">:</span><span class="n">layout_width</span><span class="o">=</span><span class="ss">"wrap_content"</span>
<span class="w">    </span><span class="nl">android</span><span class="p">:</span><span class="n">layout_height</span><span class="o">=</span><span class="ss">"wrap_content"</span><span class="w"> </span><span class="nl">android</span><span class="p">:</span><span class="nc">text</span><span class="o">=</span><span class="ss">"@string/txtCredits"</span>
<span class="w">    </span><span class="nl">android</span><span class="p">:</span><span class="n">autoLink</span><span class="o">=</span><span class="ss">"web"</span><span class="w"> </span><span class="nl">android</span><span class="p">:</span><span class="n">id</span><span class="o">=</span><span class="ss">"@+id/infoTxtCredits"</span>
<span class="w">    </span><span class="nl">android</span><span class="p">:</span><span class="n">layout_centerInParent</span><span class="o">=</span><span class="ss">"true"</span>
<span class="w">    </span><span class="nl">android</span><span class="p">:</span><span class="n">linksClickable</span><span class="o">=</span><span class="ss">"true"</span><span class="o">/&gt;</span>
</pre></div>

<p>where <code>@string/txtCredits</code> is a string resource that contains <code>&lt;a href="some
site"&gt;Link text&lt;/a&gt;</code>.</p>
<p>Android is highlighting the links in the TextView, but they do not respond to
clicks. What am I doing wrong? Do I have to set an onClickListener for the
TextView in my activity for something as simple as this?</p>
<p>It looks like it has to do with the way I define my string resource.</p>
<p>This does not work:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">"txtCredits"</span><span class="nt">&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"http://www.google.com"</span><span class="nt">&gt;</span>Google<span class="nt">&lt;/a&gt;&lt;/string&gt;</span>
</pre></div>

<p>But this does:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;string</span><span class="w"> </span><span class="na">name=</span><span class="s">"txtCredits"</span><span class="nt">&gt;</span>www.google.com<span class="nt">&lt;/string&gt;</span>
</pre></div>

<p>Which is a bummer because I would much rather show a text link than show the
full URL.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Buried in the API demos, I found the solution to my problem:</p>
<p>File <em>Link.java</em> :</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="c1">// text2 has links specified by putting &lt;a&gt; tags in the string</span>
<span class="w">    </span><span class="c1">// resource.  By default these links will appear but not</span>
<span class="w">    </span><span class="c1">// respond to user input.  To make them active, you need to</span>
<span class="w">    </span><span class="c1">// call setMovementMethod() on the TextView object.</span>

<span class="w">    </span><span class="n">TextView</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">TextView</span><span class="p">)</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">text2</span><span class="p">);</span>
<span class="w">    </span><span class="n">t2</span><span class="p">.</span><span class="n">setMovementMethod</span><span class="p">(</span><span class="n">LinkMovementMethod</span><span class="p">.</span><span class="n">getInstance</span><span class="p">());</span>
</pre></div>

<p>I removed most of the attributes on my TextView to match what was in the demo.</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">TextView</span>
<span class="w">    </span><span class="nl">android</span><span class="p">:</span><span class="n">id</span><span class="o">=</span><span class="ss">"@+id/text2"</span>
<span class="w">    </span><span class="nl">android</span><span class="p">:</span><span class="n">layout_width</span><span class="o">=</span><span class="ss">"wrap_content"</span>
<span class="w">    </span><span class="nl">android</span><span class="p">:</span><span class="n">layout_height</span><span class="o">=</span><span class="ss">"wrap_content"</span>
<span class="w">    </span><span class="nl">android</span><span class="p">:</span><span class="nc">text</span><span class="o">=</span><span class="ss">"@string/txtCredits"</span><span class="o">/&gt;</span>
</pre></div>

<p>That solved it. It is pretty difficult to uncover and fix.</p>
<p><strong>Important</strong> : Don't forget to remove <code>autoLink="web"</code> if you are calling
<code>setMovementMethod()</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I'm using only <code>android:autoLink="web"</code> and it works fine. A click on the link
opens the browser and shows the correct page.</p>
<p>One thing I could guess is that some other view is above the link. Something
that is transparent fills the whole parent but don't displays anything above
the link. In this case the click goes to this view instead of the link.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/collection-was-modified-enumeration-operation-may-not-execute/" class="u-url">Collection was modified; enumeration operation may not execute</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/collection-was-modified-enumeration-operation-may-not-execute/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:17:44+08:00" itemprop="datePublished" title="2023-02-17 05:17">2023-02-17 05:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I can't get to the bottom of this error, because when the debugger is
attached, it does not seem to occur.</p>
<blockquote>
<p>Collection was modified; enumeration operation may not execute</p>
</blockquote>
<p>Below is the code.</p>
<p>This is a WCF server in a Windows service. The method <code>NotifySubscribers()</code> is
called by the service whenever there is a data event (at random intervals, but
not very often - about 800 times per day).</p>
<p>When a Windows Forms client subscribes, the subscriber ID is added to the
subscribers dictionary, and when the client unsubscribes, it is deleted from
the dictionary. The error happens when (or after) a client unsubscribes. It
appears that the next time the <code>NotifySubscribers()</code> method is called, the
<code>foreach()</code> loop fails with the error in the subject line. The method writes
the error into the application log as shown in the code below. When a debugger
is attached and a client unsubscribes, the code executes fine.</p>
<p>Do you see a problem with this code? Do I need to make the dictionary thread-
safe?</p>
<div class="code"><pre class="code literal-block"><span class="k">[ServiceBehavior(InstanceContextMode=InstanceContextMode.Single)]</span>
<span class="na">public class SubscriptionServer</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">ISubscriptionServer</span>
<span class="na">{</span>
<span class="w">    </span><span class="na">private static IDictionary&lt;Guid, Subscriber&gt; subscribers;</span>

<span class="w">    </span><span class="na">public SubscriptionServer()</span>
<span class="w">    </span><span class="na">{            </span>
<span class="w">        </span><span class="na">subscribers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">new Dictionary&lt;Guid, Subscriber&gt;()</span><span class="c1">;</span>
<span class="w">    </span><span class="na">}</span>

<span class="w">    </span><span class="na">public void NotifySubscribers(DataRecord sr)</span>
<span class="w">    </span><span class="na">{</span>
<span class="w">        </span><span class="na">foreach(Subscriber s in subscribers.Values)</span>
<span class="w">        </span><span class="na">{</span>
<span class="w">            </span><span class="na">try</span>
<span class="w">            </span><span class="na">{</span>
<span class="w">                </span><span class="na">s.Callback.SignalData(sr);</span>
<span class="w">            </span><span class="na">}</span>
<span class="w">            </span><span class="na">catch (Exception e)</span>
<span class="w">            </span><span class="na">{</span>
<span class="w">                </span><span class="na">DCS.WriteToApplicationLog(e.Message, </span>
<span class="w">                  </span><span class="na">System.Diagnostics.EventLogEntryType.Error);</span>

<span class="w">                </span><span class="na">UnsubscribeEvent(s.ClientId);</span>
<span class="w">            </span><span class="na">}</span>
<span class="w">        </span><span class="na">}</span>
<span class="w">    </span><span class="na">}</span>

<span class="w">    </span><span class="na">public Guid SubscribeEvent(string clientDescription)</span>
<span class="w">    </span><span class="na">{</span>
<span class="w">        </span><span class="na">Subscriber subscriber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">new Subscriber()</span><span class="c1">;</span>
<span class="w">        </span><span class="na">subscriber.Callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">OperationContext.Current.</span>
<span class="w">                </span><span class="na">GetCallbackChannel&lt;IDCSCallback&gt;();</span>

<span class="w">        </span><span class="na">subscribers.Add(subscriber.ClientId, subscriber);</span>

<span class="w">        </span><span class="na">return subscriber.ClientId;</span>
<span class="w">    </span><span class="na">}</span>

<span class="w">    </span><span class="na">public void UnsubscribeEvent(Guid clientId)</span>
<span class="w">    </span><span class="na">{</span>
<span class="w">        </span><span class="na">try</span>
<span class="w">        </span><span class="na">{</span>
<span class="w">            </span><span class="na">subscribers.Remove(clientId);</span>
<span class="w">        </span><span class="na">}</span>
<span class="w">        </span><span class="na">catch(Exception e)</span>
<span class="w">        </span><span class="na">{</span>
<span class="w">            </span><span class="na">System.Diagnostics.Debug.WriteLine("Unsubscribe Error " + </span>
<span class="w">                    </span><span class="na">e.Message);</span>
<span class="w">        </span><span class="na">}</span>
<span class="w">    </span><span class="na">}</span>
<span class="na">}</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>What's likely happening is that <code>SignalData</code> is indirectly changing the
subscribers dictionary under the hood during the loop and leading to that
message. You can verify this by changing</p>
<div class="code"><pre class="code literal-block">foreach(Subscriber s in subscribers.Values)
</pre></div>

<p>To</p>
<div class="code"><pre class="code literal-block">foreach(Subscriber s in subscribers.Values.ToList())
</pre></div>

<p>If I'm right, the problem will disappear.</p>
<p>Calling <code>subscribers.Values.ToList()</code> copies the values of
<code>subscribers.Values</code> to a separate list at the start of the <code>foreach</code>. Nothing
else has access to this list (it doesn't even have a variable name!), so
nothing can modify it inside the loop.</p>
<p><br></p>
<h3>Suggest</h3>
<p>When a subscriber unsubscribes you are changing contents of the collection of
Subscribers during enumeration.</p>
<p>There are several ways to fix this, one being changing the for loop to use an
explicit <code>.ToList()</code>:</p>
<div class="code"><pre class="code literal-block">public void NotifySubscribers(DataRecord sr)  
{
    foreach(Subscriber s in subscribers.Values.ToList())
    {
                                              ^^^^^^^^^  
        ...
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-379.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-377.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
