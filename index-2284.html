<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2284) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2284.html">
<link rel="prev" href="index-2285.html" type="text/html">
<link rel="next" href="index-2283.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/when-and-why-are-database-joins-expensive/" class="u-url">When and why are database joins expensive?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/when-and-why-are-database-joins-expensive/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T04:45:30+08:00" itemprop="datePublished" title="2023-03-04 04:45">2023-03-04 04:45</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm doing some research into databases and I'm looking at some limitations of
relational DBs.</p>
<p>I'm getting that joins of large tables is very expensive, but I'm not
completely sure why. What does the DBMS need to do to execute a join
operation, where is the bottleneck?<br>
How can denormalization help to overcome this expense? How do other
optimization techniques (indexing, for example) help?</p>
<p>Personal experiences are welcome! If you're going to post links to resources,
please avoid Wikipedia. I know where to find that already.</p>
<p>In relation to this, I'm wondering about the denormalized approaches used by
cloud service databases like BigTable and SimpleDB. See this question.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Denormalising to improve performance? It sounds convincing, but it doesn't
hold water.</p>
<p>Chris Date, who in company with Dr Ted Codd was the original proponent of the
relational data model, ran out of patience with misinformed arguments against
normalisation and systematically demolished them using scientific method: he
got large databases and <em>tested</em> these assertions.</p>
<p>I think he wrote it up in <em>Relational Database Writings 1988-1991</em> but this
book was later rolled into edition six of <em>Introduction to Database Systems</em> ,
which is <em>the</em> definitive text on database theory and design, in its eighth
edition as I write and likely to remain in print for decades to come. Chris
Date was an expert in this field when most of us were still running around
barefoot.</p>
<p>He found that:</p>
<ul>
<li>Some of them hold for special cases</li>
<li>All of them fail to pay off for general use</li>
<li>All of them are significantly worse for other special cases </li>
</ul>
<p>It all comes back to mitigating the size of the working set. Joins involving
properly selected keys with correctly set up indexes are cheap, not expensive,
because they allow significant pruning of the result <em>before</em> the rows are
materialised.</p>
<p>Materialising the result involves bulk disk reads which are the most expensive
aspect of the exercise by an order of magnitude. Performing a join, by
contrast, logically requires retrieval of only the <em>keys</em>. In practice, not
even the key values are fetched: the key hash values are used for join
comparisons, mitigating the cost of multi-column joins and radically reducing
the cost of joins involving string comparisons. Not only will vastly more fit
in cache, there's a lot less disk reading to do.</p>
<p>Moreover, a good optimiser will choose the most restrictive condition and
apply it before it performs a join, very effectively leveraging the high
selectivity of joins on indexes with high cardinality.</p>
<p>Admittedly this type of optimisation can also be applied to denormalised
databases, but the sort of people who <em>want</em> to denormalise a schema typically
don't think about cardinality when (if) they set up indexes.</p>
<p>It is important to understand that table scans (examination of every row in a
table in the course of producing a join) are rare in practice. A query
optimiser will choose a table scan only when one or more of the following
holds.</p>
<ul>
<li>There are fewer than 200 rows in the relation (in this case a scan will be cheaper)</li>
<li>There are no suitable indexes on the join columns (if it's meaningful to join on these columns then why aren't they indexed? fix it)</li>
<li>A type coercion is required before the columns can be compared (WTF?! fix it or go home) <strong>SEE END NOTES FOR ADO.NET ISSUE</strong>
</li>
<li>One of the arguments of the comparison is an expression (no index)</li>
</ul>
<p>Performing an operation is more expensive than not performing it. However,
performing the <em>wrong</em> operation, being forced into pointless disk I/O and
then discarding the dross prior to performing the join you really need, is
<em>much</em> more expensive. Even when the "wrong" operation is precomputed and
indexes have been sensibly applied, there remains significant penalty.
Denormalising to precompute a join - notwithstanding the update anomalies
entailed - is a commitment to a particular join. If you need a <em>different</em>
join, that commitment is going to cost you <em>big</em>.</p>
<p>If anyone wants to remind me that it's a changing world, I think you'll find
that bigger datasets on gruntier hardware just exaggerates the spread of
Date's findings.</p>
<p>For all of you who work on billing systems or junk mail generators (shame on
you) and are indignantly setting hand to keyboard to tell me that you know for
a fact that denormalisation is faster, sorry but you're living in one of the
special cases - specifically, the case where you process <em>all</em> of the data,
in-order. It's not a general case, and you <em>are</em> justified in your strategy.</p>
<p>You are <em>not</em> justified in falsely generalising it. See the end of the notes
section for more information on appropriate use of denormalisation in data
warehousing scenarios.</p>
<p>I'd also like to respond to</p>
<blockquote>
<p>Joins are just cartesian products with some lipgloss</p>
</blockquote>
<p>What a load of bollocks. Restrictions are applied as early as possible, most
restrictive first. You've read the theory, but you haven't understood it.
Joins are <em>treated</em> as "cartesian products to which predicates apply" <em>only</em>
by the query optimiser. This is a symbolic representation (a normalisation, in
fact) to facilitate symbolic decomposition so the optimiser can produce all
the equivalent transformations and rank them by cost and selectivity so that
it can select the best query plan.</p>
<p>The only way you will ever get the optimiser to produce a cartesian product is
to fail to supply a predicate: <code>SELECT * FROM A,B</code></p>
<hr>
<h3>Notes</h3>
<hr>
<p>David Aldridge provides some important additional information.</p>
<p>There is indeed a variety of other strategies besides indexes and table scans,
and a modern optimiser will cost them all before producing an execution plan.</p>
<p>A practical piece of advice: if it can be used as a foreign key then index it,
so that an index strategy is <em>available</em> to the optimiser.</p>
<p>I used to be smarter than the MSSQL optimiser. That changed two versions ago.
Now it generally teaches <em>me</em>. It is, in a very real sense, an expert system,
codifying all the wisdom of many very clever people in a domain sufficiently
closed that a rule-based system is effective.</p>
<hr>
<p>"Bollocks" may have been tactless. I am asked to be less haughty and reminded
that math doesn't lie. This is true, but not all of the implications of
mathematical models should necessarily be taken literally. Square roots of
negative numbers are very handy if you carefully avoid examining their
absurdity (pun there) and make damn sure you cancel them all out before you
try to interpret your equation.</p>
<p>The reason that I responded so savagely was that the statement as worded says
that</p>
<blockquote>
<p>Joins <em>are</em> cartesian products...</p>
</blockquote>
<p>This may not be what was meant but it <em>is</em> what was written, and it's
categorically untrue. A cartesian product is a relation. A join is a function.
More specifically, a join is a relation-valued function. With an empty
predicate it will produce a cartesian product, and checking that it does so is
one correctness check for a database query engine, but nobody writes
unconstrained joins in practice because they have no practical value outside a
classroom.</p>
<p>I called this out because I don't want readers falling into the ancient trap
of confusing the model with the thing modelled. A model is an approximation,
deliberately simplified for convenient manipulation.</p>
<hr>
<p>The cut-off for selection of a table-scan join strategy may vary between
database engines. It is affected by a number of implementation decisions such
as tree-node fill-factor, key-value size and subtleties of algorithm, but
broadly speaking high-performance indexing has an execution time of <em>k</em> log
<em>n</em> + <em>c</em>. The C term is a fixed overhead mostly made of setup time, and the
shape of the curve means you don't get a payoff (compared to a linear search)
until <em>n</em> is in the hundreds.</p>
<hr>
<h3>Sometimes denormalisation is a good idea</h3>
<p>Denormalisation is a commitment to a particular join strategy. As mentioned
earlier, this interferes with <em>other</em> join strategies. But if you have buckets
of disk space, predictable patterns of access, and a tendency to process much
or all of it, then precomputing a join can be very worthwhile.</p>
<p>You can also figure out the access paths your operation typically uses and
precompute all the joins for those access paths. This is the premise behind
data warehouses, or at least it is when they're built by people who know why
they're doing what they're doing, and not just for the sake of buzzword
compliance.</p>
<p>A properly designed data warehouse is produced periodically by a bulk
transformation out of a normalised transaction processing system. This
separation of the operations and reporting databases has the very desirable
effect of eliminating the clash between OLTP and OLAP (online transaction
processing ie data entry, and online analytical processing ie reporting).</p>
<p>An important point here is that apart from the periodic updates, the data
warehouse is <em>read only</em>. This renders moot the question of update anomalies.</p>
<p>Don't make the mistake of denormalising your OLTP database (the database on
which data entry happens). It might be faster for billing runs but if you do
that you will get update anomalies. Ever tried to get Reader's Digest to stop
sending you stuff?</p>
<p>Disk space is cheap these days, so knock yourself out. But denormalising is
only part of the story for data warehouses. Much bigger performance gains are
derived from precomputed rolled-up values: monthly totals, that sort of thing.
It's <em>always</em> about reducing the working set.</p>
<hr>
<h3>ADO.NET problem with type mismatches</h3>
<p>Suppose you have a SQL Server table containing an indexed column of type
varchar, and you use AddWithValue to pass a parameter constraining a query on
this column. C# strings are Unicode, so the inferred parameter type will be
NVARCHAR, which doesn't match VARCHAR.</p>
<p>VARCHAR to NVARCHAR is a widening conversion so it happens implicitly - but
say goodbye to indexing, and good luck working out why.</p>
<hr>
<h3>"Count the disk hits" (Rick James)</h3>
<p>If everything is cached in RAM, <code>JOINs</code> are rather cheap. That is,
normalization does not have much <em>performance penalty</em>.</p>
<p>If a "normalized" schema causes <code>JOINs</code> to hit the disk a lot, but the
equivalent "denormalized" schema would not have to hit the disk, then
denormalization wins a performance competition.</p>
<blockquote>
<p>Comment from original author: Modern database engines are very good at
organising access sequencing to minimise cache misses during join
operations. The above, while true, might be miscontrued as implying that
joins are necessarily problematically expensive on large data. This would
lead to cause poor decision-making on the part of inexperienced developers.</p>
</blockquote>
<p><br></p>
<h3>Suggest</h3>
<p>What most commenters fail to note is the wide range of join methodologies
available in a complex RDBMS, and the denormalisers invariably gloss over the
higher cost of maintaining denormalised data. Not every join is based on
indexes, and databases have a lot of optimised algotithms and methodologies
for joining that are intended to reduce join costs.</p>
<p>In any case, the cost of a join depends on its type and a few other factors.
It needn't be expensive at all - some examples.</p>
<ul>
<li>A hash join, in which bulk data is equijoined, is very cheap indeed, and the cost only become significant if the hash table cannot be cached in memory. No index required. Equi-partitioning between the joined data sets can be a great help.</li>
<li>The cost of a sort-merge join is driven by the cost of the sort rather than the merge -- an index-based access method can virtually eliminate the cost of the sort.</li>
<li>The cost of a nested loop join on an index is driven by the height of the b-tree index and the access of the table block itself. It's fast, but not suitable for bulk joins.</li>
<li>A nested loop join based on a cluster is much cheaper, with fewer logicAL IO'S required per join row -- if the joined tables are both in the same cluster then the join becomes very cheap through the colocation of joined rows.</li>
</ul>
<p>Databases are designed to join, and they're very flexible in how they do it
and generally very performant unless they get the join mechanism wrong.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/reactjs-what-should-the-proptypes-be-for-this-props-children/" class="u-url">ReactJs: What should the PropTypes be for this.props.children?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/reactjs-what-should-the-proptypes-be-for-this-props-children/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T04:44:09+08:00" itemprop="datePublished" title="2023-03-04 04:44">2023-03-04 04:44</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Given a simple component that renders its children:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">ContainerComponent</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">propTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">children</span><span class="p">:</span><span class="w"> </span><span class="n">PropTypes</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">isRequired</span><span class="p">,</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">children</span><span class="p">}</span>
<span class="w">      </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="n">ContainerComponent</span><span class="p">;</span>
</pre></div>

<p><strong>Question: What should the propType of the children prop be?</strong></p>
<p>When I set it as an object, it fails when I use the component with multiple
children:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;ContainerComponent&gt;</span>
<span class="w">  </span><span class="nt">&lt;div&gt;</span>1<span class="nt">&lt;/div&gt;</span>
<span class="w">  </span><span class="nt">&lt;div&gt;</span>2<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/ContainerComponent&gt;</span>
</pre></div>

<blockquote>
<p>Warning: Failed prop type: Invalid prop <code>children</code> of type <code>array</code> supplied
to <code>ContainerComponent</code>, expected <code>object</code>.</p>
</blockquote>
<p>If I set it as an array, it will fail if I give it only one child, i.e.:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;ContainerComponent&gt;</span>
<span class="w">  </span><span class="nt">&lt;div&gt;</span>1<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/ContainerComponent&gt;</span>
</pre></div>

<blockquote>
<p>Warning: Failed prop type: Invalid prop children of type object supplied to
ContainerComponent, expected array.</p>
</blockquote>
<p>Please advise, should I just not bother doing a propTypes check for children
elements?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Try something like this utilizing <code>oneOfType</code> or <code>PropTypes.node</code></p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">PropTypes</span> <span class="kn">from</span> <span class="s1">'prop-types'</span>

<span class="o">...</span>

<span class="n">static</span> <span class="n">propTypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">children</span><span class="p">:</span> <span class="n">PropTypes</span><span class="o">.</span><span class="n">oneOfType</span><span class="p">([</span>
        <span class="n">PropTypes</span><span class="o">.</span><span class="n">arrayOf</span><span class="p">(</span><span class="n">PropTypes</span><span class="o">.</span><span class="n">node</span><span class="p">),</span>
        <span class="n">PropTypes</span><span class="o">.</span><span class="n">node</span>
    <span class="p">])</span><span class="o">.</span><span class="n">isRequired</span>
<span class="p">}</span>
</pre></div>

<p>or</p>
<div class="code"><pre class="code literal-block">static propTypes = {
    children: PropTypes.node.isRequired,
}
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>For me it depends on the component. If you know what you need it to be
populated with then you should try to specify exclusively, or multiple types
using:</p>
<div class="code"><pre class="code literal-block">PropTypes.oneOfType
</pre></div>

<p>If you want to refer to a React component then you will be looking for</p>
<div class="code"><pre class="code literal-block">PropTypes.element
</pre></div>

<p>Although,</p>
<div class="code"><pre class="code literal-block">PropTypes.node
</pre></div>

<p>describes anything that can be rendered - strings, numbers, elements or an
array of these things. If this suits you then this is the way.</p>
<p>With <em>very</em> generic components, who can have many types of children, you can
also use the below. However I wouldn't recommend it. As mentioned in the
comments below, it does somewhat defeat the point of using <code>PropTypes</code> and
there are usually other ways to specify what your component requires. Also
bare in mind that eslint and ts may (probably) not be happy with this lack of
specificity:</p>
<div class="code"><pre class="code literal-block">PropTypes.any
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-detect-a-christmas-tree/" class="u-url">How to detect a Christmas Tree?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-detect-a-christmas-tree/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T04:41:48+08:00" itemprop="datePublished" title="2023-03-04 04:41">2023-03-04 04:41</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Which image processing techniques could be used to implement an application
that detects the Christmas trees displayed in the following images?</p>
<p><img alt="" src="images/nmzwj.png"><img alt="" src="images/aVZhC.png"><img alt="" src="images/2K9Ef.png"></p>
<p><img alt="" src="images/YowlH.png"><img alt="" src="images/2y4o5.png"><img alt="" src="images/FWhSP.png"></p>
<p>I'm searching for solutions that are going to work on all these images.
Therefore, approaches that require training <em>haar cascade classifiers</em> or
<em>template matching</em> are not very interesting.</p>
<p>I'm looking for something that can be written in <em>any</em> programming language,
<em>as long as</em> it uses only <em>Open Source</em> technologies. The solution must be
tested with the images that are shared on this question. There are <em>6 input
images</em> and the answer should display the results of processing each of them.
Finally, for each <em>output image</em> there must be <em>red lines</em> draw to surround
the detected tree.</p>
<p>How would you go about programmatically detecting the trees in these images?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I have an approach which I think is interesting and a bit different from the
rest. The main difference in my approach, compared to some of the others, is
in how the image segmentation step is performed--I used the DBSCAN clustering
algorithm from Python's scikit-learn; it's optimized for finding somewhat
amorphous shapes that may not necessarily have a single clear centroid.</p>
<p>At the top level, my approach is fairly simple and can be broken down into
about 3 steps. First I apply a threshold (or actually, the logical "or" of two
separate and distinct thresholds). As with many of the other answers, I
assumed that the Christmas tree would be one of the brighter objects in the
scene, so the first threshold is just a simple monochrome brightness test; any
pixels with values above 220 on a 0-255 scale (where black is 0 and white is
255) are saved to a binary black-and-white image. The second threshold tries
to look for red and yellow lights, which are particularly prominent in the
trees in the upper left and lower right of the six images, and stand out well
against the blue-green background which is prevalent in most of the photos. I
convert the rgb image to hsv space, and require that the hue is either less
than 0.2 on a 0.0-1.0 scale (corresponding roughly to the border between
yellow and green) or greater than 0.95 (corresponding to the border between
purple and red) and additionally I require bright, saturated colors:
saturation and value must both be above 0.7. The results of the two threshold
procedures are logically "or"-ed together, and the resulting matrix of black-
and-white binary images is shown below:</p>
<p><img alt="Christmas trees, after thresholding on HSV as well as monochrome
brightness" src="images/iIkWV.png"></p>
<p>You can clearly see that each image has one large cluster of pixels roughly
corresponding to the location of each tree, plus a few of the images also have
some other small clusters corresponding either to lights in the windows of
some of the buildings, or to a background scene on the horizon. The next step
is to get the computer to recognize that these are separate clusters, and
label each pixel correctly with a cluster membership ID number.</p>
<p>For this task I chose DBSCAN. There is a pretty good visual comparison of how
DBSCAN typically behaves, relative to other clustering algorithms, available
here. As I said earlier, it does well with amorphous shapes. The output of
DBSCAN, with each cluster plotted in a different color, is shown here:</p>
<p><img alt="DBSCAN clustering output" src="images/rWSqn.png"></p>
<p>There are a few things to be aware of when looking at this result. First is
that DBSCAN requires the user to set a "proximity" parameter in order to
regulate its behavior, which effectively controls how separated a pair of
points must be in order for the algorithm to declare a new separate cluster
rather than agglomerating a test point onto an already pre-existing cluster. I
set this value to be 0.04 times the size along the diagonal of each image.
Since the images vary in size from roughly VGA up to about HD 1080, this type
of scale-relative definition is critical.</p>
<p>Another point worth noting is that the DBSCAN algorithm as it is implemented
in scikit-learn has memory limits which are fairly challenging for some of the
larger images in this sample. Therefore, for a few of the larger images, I
actually had to "decimate" (i.e., retain only every 3rd or 4th pixel and drop
the others) each cluster in order to stay within this limit. As a result of
this culling process, the remaining individual sparse pixels are difficult to
see on some of the larger images. Therefore, for display purposes only, the
color-coded pixels in the above images have been effectively "dilated" just
slightly so that they stand out better. It's purely a cosmetic operation for
the sake of the narrative; although there are comments mentioning this
dilation in my code, rest assured that it has nothing to do with any
calculations that actually matter.</p>
<p>Once the clusters are identified and labeled, the third and final step is
easy: I simply take the largest cluster in each image (in this case, I chose
to measure "size" in terms of the total number of member pixels, although one
could have just as easily instead used some type of metric that gauges
physical extent) and compute the convex hull for that cluster. The convex hull
then becomes the tree border. The six convex hulls computed via this method
are shown below in red:</p>
<p><img alt="Christmas trees with their calculated borders" src="images/sl6Ar.jpg"></p>
<p>The source code is written for Python 2.7.6 and it depends on numpy, scipy,
matplotlib and scikit-learn. I've divided it into two parts. The first part is
responsible for the actual image processing:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="kp">ceil</span><span class="p">,</span> <span class="kp">sqrt</span>

<span class="sd">"""</span>
<span class="sd">Inputs:</span>

<span class="sd">    rgbimg:         [M,N,3] numpy array containing (uint, 0-255) color image</span>

<span class="sd">    hueleftthr:     Scalar constant to select maximum allowed hue in the</span>
<span class="sd">                    yellow-green region</span>

<span class="sd">    huerightthr:    Scalar constant to select minimum allowed hue in the</span>
<span class="sd">                    blue-purple region</span>

<span class="sd">    satthr:         Scalar constant to select minimum allowed saturation</span>

<span class="sd">    valthr:         Scalar constant to select minimum allowed value</span>

<span class="sd">    monothr:        Scalar constant to select minimum allowed monochrome</span>
<span class="sd">                    brightness</span>

<span class="sd">    maxpoints:      Scalar constant maximum number of pixels to forward to</span>
<span class="sd">                    the DBSCAN clustering algorithm</span>

<span class="sd">    proxthresh:     Proximity threshold to use for DBSCAN, as a fraction of</span>
<span class="sd">                    the diagonal size of the image</span>

<span class="sd">Outputs:</span>

<span class="sd">    borderseg:      [K,2,2] Nested list containing K pairs of x- and y- pixel</span>
<span class="sd">                    values for drawing the tree border</span>

<span class="sd">    X:              [P,2] List of pixels that passed the threshold step</span>

<span class="sd">    labels:         [Q,2] List of cluster labels for points in Xslice (see</span>
<span class="sd">                    below)</span>

<span class="sd">    Xslice:         [Q,2] Reduced list of pixels to be passed to DBSCAN</span>

<span class="sd">"""</span>

<span class="k">def</span> <span class="nf">findtree</span><span class="p">(</span><span class="n">rgbimg</span><span class="p">,</span> <span class="n">hueleftthr</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">huerightthr</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">satthr</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> 
             <span class="n">valthr</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">monothr</span><span class="o">=</span><span class="mi">220</span><span class="p">,</span> <span class="n">maxpoints</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">proxthresh</span><span class="o">=</span><span class="mf">0.04</span><span class="p">):</span>

    <span class="c1"># Convert rgb image to monochrome for</span>
    <span class="n">gryimg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">asarray</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">rgbimg</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">'L'</span><span class="p">))</span>
    <span class="c1"># Convert rgb image (uint, 0-255) to hsv (float, 0.0-1.0)</span>
    <span class="n">hsvimg</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">rgb_to_hsv</span><span class="p">(</span><span class="n">rgbimg</span><span class="o">.</span><span class="kp">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>

    <span class="c1"># Initialize binary thresholded image</span>
    <span class="n">binimg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">zeros</span><span class="p">((</span><span class="n">rgbimg</span><span class="o">.</span><span class="kp">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgbimg</span><span class="o">.</span><span class="kp">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1"># Find pixels with hue&lt;0.2 or hue&gt;0.95 (red or yellow) and saturation/value</span>
    <span class="c1"># both greater than 0.7 (saturated and bright)--tends to coincide with</span>
    <span class="c1"># ornamental lights on trees in some of the images</span>
    <span class="n">boolidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">logical_and</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="kp">logical_and</span><span class="p">(</span>
                  <span class="n">np</span><span class="o">.</span><span class="kp">logical_or</span><span class="p">((</span><span class="n">hsvimg</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">hueleftthr</span><span class="p">),</span>
                                <span class="p">(</span><span class="n">hsvimg</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">huerightthr</span><span class="p">)),</span>
                                <span class="p">(</span><span class="n">hsvimg</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">satthr</span><span class="p">)),</span>
                                <span class="p">(</span><span class="n">hsvimg</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">valthr</span><span class="p">))</span>
    <span class="c1"># Find pixels that meet hsv criterion</span>
    <span class="n">binimg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="kp">where</span><span class="p">(</span><span class="n">boolidx</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">255</span>
    <span class="c1"># Add pixels that meet grayscale brightness criterion</span>
    <span class="n">binimg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="kp">where</span><span class="p">(</span><span class="n">gryimg</span> <span class="o">&gt;</span> <span class="n">monothr</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">255</span>

    <span class="c1"># Prepare thresholded points for DBSCAN clustering algorithm</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="kp">where</span><span class="p">(</span><span class="n">binimg</span> <span class="o">==</span> <span class="mi">255</span><span class="p">))</span>
    <span class="n">Xslice</span> <span class="o">=</span> <span class="n">X</span>
    <span class="n">nsample</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Xslice</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nsample</span> <span class="o">&gt;</span> <span class="n">maxpoints</span><span class="p">:</span>
        <span class="c1"># Make sure number of points does not exceed DBSCAN maximum capacity</span>
        <span class="n">Xslice</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nsample</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="kp">ceil</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">nsample</span><span class="p">)</span><span class="o">/</span><span class="n">maxpoints</span><span class="p">)))]</span>

    <span class="c1"># Translate DBSCAN proximity threshold to units of pixels and run DBSCAN</span>
    <span class="n">pixproxthr</span> <span class="o">=</span> <span class="n">proxthresh</span> <span class="o">*</span> <span class="kp">sqrt</span><span class="p">(</span><span class="n">binimg</span><span class="o">.</span><span class="kp">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">binimg</span><span class="o">.</span><span class="kp">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">pixproxthr</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xslice</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">labels_</span><span class="o">.</span><span class="kp">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Find the largest cluster (i.e., with most points) and obtain convex hull   </span>
    <span class="n">unique_labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">maxclustpt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">unique_labels</span><span class="p">:</span>
        <span class="n">class_members</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="kp">argwhere</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">k</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_members</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxclustpt</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">Xslice</span><span class="p">[</span><span class="n">class_members</span><span class="p">]</span>
            <span class="n">hull</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">ConvexHull</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
            <span class="n">maxclustpt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_members</span><span class="p">)</span>
            <span class="n">borderseg</span> <span class="o">=</span> <span class="p">[[</span><span class="n">points</span><span class="p">[</span><span class="n">simplex</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">simplex</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">simplex</span>
                          <span class="ow">in</span> <span class="n">hull</span><span class="o">.</span><span class="n">simplices</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">borderseg</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">Xslice</span>
</pre></div>

<p>and the second part is a user-level script which calls the first file and
generates all of the plots above:</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><span class="ch">#!/usr/bin/env python</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code><span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code><span class="kn">from</span> <span class="nn">findtree</span> <span class="kn">import</span> <span class="n">findtree</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code><span class="c1"># Image files to process</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-10"><code data-line-number="10"></code></a></td>
<td class="code"><code><span class="n">fname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'nmzwj.png'</span><span class="p">,</span> <span class="s1">'aVZhC.png'</span><span class="p">,</span> <span class="s1">'2K9EF.png'</span><span class="p">,</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-11"><code data-line-number="11"></code></a></td>
<td class="code"><code>         <span class="s1">'YowlH.png'</span><span class="p">,</span> <span class="s1">'2y4o5.png'</span><span class="p">,</span> <span class="s1">'FWhSP.png'</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-12"><code data-line-number="12"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-13"><code data-line-number="13"></code></a></td>
<td class="code"><code><span class="c1"># Initialize figures</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-14"><code data-line-number="14"></code></a></td>
<td class="code"><code><span class="n">fgsz</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>        
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-15"><code data-line-number="15"></code></a></td>
<td class="code"><code><span class="n">figthresh</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fgsz</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'w'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-16"><code data-line-number="16"></code></a></td>
<td class="code"><code><span class="n">figclust</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fgsz</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'w'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-17"><code data-line-number="17"></code></a></td>
<td class="code"><code><span class="n">figcltwo</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fgsz</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'w'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-18"><code data-line-number="18"></code></a></td>
<td class="code"><code><span class="n">figborder</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">fgsz</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'w'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-19"><code data-line-number="19"></code></a></td>
<td class="code"><code><span class="n">figthresh</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s1">'Thresholded HSV and Monochrome Brightness'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-20"><code data-line-number="20"></code></a></td>
<td class="code"><code><span class="n">figclust</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s1">'DBSCAN Clusters (Raw Pixel Output)'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-21"><code data-line-number="21"></code></a></td>
<td class="code"><code><span class="n">figcltwo</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s1">'DBSCAN Clusters (Slightly Dilated for Display)'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-22"><code data-line-number="22"></code></a></td>
<td class="code"><code><span class="n">figborder</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="s1">'Trees with Borders'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-23"><code data-line-number="23"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-24"><code data-line-number="24"></code></a></td>
<td class="code"><code><span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fname</span><span class="p">)),</span> <span class="n">fname</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-25"><code data-line-number="25"></code></a></td>
<td class="code"><code>    <span class="c1"># Open the file and convert to rgb image</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-26"><code data-line-number="26"></code></a></td>
<td class="code"><code>    <span class="n">rgbimg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-27"><code data-line-number="27"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-28"><code data-line-number="28"></code></a></td>
<td class="code"><code>    <span class="c1"># Get the tree borders as well as a bunch of other intermediate values</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-29"><code data-line-number="29"></code></a></td>
<td class="code"><code>    <span class="c1"># that will be used to illustrate how the algorithm works</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-30"><code data-line-number="30"></code></a></td>
<td class="code"><code>    <span class="n">borderseg</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">Xslice</span> <span class="o">=</span> <span class="n">findtree</span><span class="p">(</span><span class="n">rgbimg</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-31"><code data-line-number="31"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-32"><code data-line-number="32"></code></a></td>
<td class="code"><code>    <span class="c1"># Display thresholded images</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-33"><code data-line-number="33"></code></a></td>
<td class="code"><code>    <span class="n">axthresh</span> <span class="o">=</span> <span class="n">figthresh</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-34"><code data-line-number="34"></code></a></td>
<td class="code"><code>    <span class="n">axthresh</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-35"><code data-line-number="35"></code></a></td>
<td class="code"><code>    <span class="n">axthresh</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-36"><code data-line-number="36"></code></a></td>
<td class="code"><code>    <span class="n">binimg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rgbimg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rgbimg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-37"><code data-line-number="37"></code></a></td>
<td class="code"><code>    <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-38"><code data-line-number="38"></code></a></td>
<td class="code"><code>        <span class="n">binimg</span><span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-39"><code data-line-number="39"></code></a></td>
<td class="code"><code>    <span class="n">axthresh</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">binimg</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">'nearest'</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'Greys'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-40"><code data-line-number="40"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-41"><code data-line-number="41"></code></a></td>
<td class="code"><code>    <span class="c1"># Display color-coded clusters</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-42"><code data-line-number="42"></code></a></td>
<td class="code"><code>    <span class="n">axclust</span> <span class="o">=</span> <span class="n">figclust</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Raw version</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-43"><code data-line-number="43"></code></a></td>
<td class="code"><code>    <span class="n">axclust</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-44"><code data-line-number="44"></code></a></td>
<td class="code"><code>    <span class="n">axclust</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-45"><code data-line-number="45"></code></a></td>
<td class="code"><code>    <span class="n">axcltwo</span> <span class="o">=</span> <span class="n">figcltwo</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Dilated slightly for display only</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-46"><code data-line-number="46"></code></a></td>
<td class="code"><code>    <span class="n">axcltwo</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-47"><code data-line-number="47"></code></a></td>
<td class="code"><code>    <span class="n">axcltwo</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-48"><code data-line-number="48"></code></a></td>
<td class="code"><code>    <span class="n">axcltwo</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">binimg</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">'nearest'</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'Greys'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-49"><code data-line-number="49"></code></a></td>
<td class="code"><code>    <span class="n">clustimg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rgbimg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>    
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-50"><code data-line-number="50"></code></a></td>
<td class="code"><code>    <span class="n">unique_labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-51"><code data-line-number="51"></code></a></td>
<td class="code"><code>    <span class="c1"># Generate a unique color for each cluster </span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-52"><code data-line-number="52"></code></a></td>
<td class="code"><code>    <span class="n">plcol</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">rainbow_r</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)))</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-53"><code data-line-number="53"></code></a></td>
<td class="code"><code>    <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">pix</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">Xslice</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-54"><code data-line-number="54"></code></a></td>
<td class="code"><code>        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">unqlbl</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">plcol</span><span class="p">,</span> <span class="n">unique_labels</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-55"><code data-line-number="55"></code></a></td>
<td class="code"><code>            <span class="k">if</span> <span class="n">lbl</span> <span class="o">==</span> <span class="n">unqlbl</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-56"><code data-line-number="56"></code></a></td>
<td class="code"><code>                <span class="c1"># Cluster label of -1 indicates no cluster membership;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-57"><code data-line-number="57"></code></a></td>
<td class="code"><code>                <span class="c1"># override default color with black</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-58"><code data-line-number="58"></code></a></td>
<td class="code"><code>                <span class="k">if</span> <span class="n">lbl</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-59"><code data-line-number="59"></code></a></td>
<td class="code"><code>                    <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-60"><code data-line-number="60"></code></a></td>
<td class="code"><code>                <span class="c1"># Raw version</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-61"><code data-line-number="61"></code></a></td>
<td class="code"><code>                <span class="k">for</span> <span class="n">ij</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-62"><code data-line-number="62"></code></a></td>
<td class="code"><code>                    <span class="n">clustimg</span><span class="p">[</span><span class="n">pix</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pix</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ij</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">ij</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-63"><code data-line-number="63"></code></a></td>
<td class="code"><code>                <span class="c1"># Dilated just for display</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-64"><code data-line-number="64"></code></a></td>
<td class="code"><code>                <span class="n">axcltwo</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pix</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pix</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">'o'</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> 
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-65"><code data-line-number="65"></code></a></td>
<td class="code"><code>                    <span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-66"><code data-line-number="66"></code></a></td>
<td class="code"><code>    <span class="n">axclust</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">clustimg</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-67"><code data-line-number="67"></code></a></td>
<td class="code"><code>    <span class="n">axcltwo</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">binimg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-68"><code data-line-number="68"></code></a></td>
<td class="code"><code>    <span class="n">axcltwo</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">binimg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-69"><code data-line-number="69"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-70"><code data-line-number="70"></code></a></td>
<td class="code"><code>    <span class="c1"># Plot original images with read borders around the trees</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-71"><code data-line-number="71"></code></a></td>
<td class="code"><code>    <span class="n">axborder</span> <span class="o">=</span> <span class="n">figborder</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-72"><code data-line-number="72"></code></a></td>
<td class="code"><code>    <span class="n">axborder</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-73"><code data-line-number="73"></code></a></td>
<td class="code"><code>    <span class="n">axborder</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rgbimg</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">'nearest'</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-74"><code data-line-number="74"></code></a></td>
<td class="code"><code>    <span class="k">for</span> <span class="n">vseg</span><span class="p">,</span> <span class="n">hseg</span> <span class="ow">in</span> <span class="n">borderseg</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-75"><code data-line-number="75"></code></a></td>
<td class="code"><code>        <span class="n">axborder</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hseg</span><span class="p">,</span> <span class="n">vseg</span><span class="p">,</span> <span class="s1">'r-'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-76"><code data-line-number="76"></code></a></td>
<td class="code"><code>    <span class="n">axborder</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">binimg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-77"><code data-line-number="77"></code></a></td>
<td class="code"><code>    <span class="n">axborder</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">binimg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-78"><code data-line-number="78"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-to-detect-a-christmas-tree/#-79"><code data-line-number="79"></code></a></td>
<td class="code"><code><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></td>
</tr>
</table></div>
<p><br></p>
<h3>Suggest</h3>
<p><strong>EDIT NOTE:</strong> I edited this post to (i) process each tree image individually,
as requested in the requirements, (ii) to consider both object brightness and
shape in order to improve the quality of the result.</p>
<hr>
<p>Below is presented an approach that takes in consideration the object
brightness and shape. In other words, it seeks for objects with triangle-like
shape and with significant brightness. It was implemented in Java, using
Marvin image processing framework.</p>
<p>The first step is the color thresholding. The objective here is to focus the
analysis on objects with significant brightness.</p>
<p><strong>output images:</strong></p>
<p><img alt="" src="https://i.imgur.com/xHvRzRE.png"><img alt="" src="https://i.imgur.com/EX6dmPS.png"><img alt="" src="https://i.imgur.com/7dY2GCT.png"></p>
<p><img alt="" src="https://i.imgur.com/064pUHZ.png"><img alt="" src="https://i.imgur.com/OZXEc0u.png"><img alt="" src="https://i.imgur.com/pLUfa6l.png"></p>
<p><strong>source code:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ChristmasTree</span><span class="w"> </span><span class="p">{</span>

<span class="n">private</span><span class="w"> </span><span class="n">MarvinImagePlugin</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinPluginLoader</span><span class="o">.</span><span class="n">loadImagePlugin</span><span class="p">(</span><span class="s2">"org.marvinproject.image.fill.boundaryFill"</span><span class="p">);</span>
<span class="n">private</span><span class="w"> </span><span class="n">MarvinImagePlugin</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinPluginLoader</span><span class="o">.</span><span class="n">loadImagePlugin</span><span class="p">(</span><span class="s2">"org.marvinproject.image.color.thresholding"</span><span class="p">);</span>
<span class="n">private</span><span class="w"> </span><span class="n">MarvinImagePlugin</span><span class="w"> </span><span class="n">invert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinPluginLoader</span><span class="o">.</span><span class="n">loadImagePlugin</span><span class="p">(</span><span class="s2">"org.marvinproject.image.color.invert"</span><span class="p">);</span>
<span class="n">private</span><span class="w"> </span><span class="n">MarvinImagePlugin</span><span class="w"> </span><span class="n">dilation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinPluginLoader</span><span class="o">.</span><span class="n">loadImagePlugin</span><span class="p">(</span><span class="s2">"org.marvinproject.image.morphological.dilation"</span><span class="p">);</span>

<span class="n">public</span><span class="w"> </span><span class="n">ChristmasTree</span><span class="p">(){</span>
<span class="w">    </span><span class="n">MarvinImage</span><span class="w"> </span><span class="n">tree</span><span class="p">;</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Iterate</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">image</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinImageIO</span><span class="o">.</span><span class="n">loadImage</span><span class="p">(</span><span class="s2">"./res/trees/tree"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s2">".png"</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">Threshold</span>
<span class="w">        </span><span class="n">threshold</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">"threshold"</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">);</span>
<span class="w">        </span><span class="n">threshold</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">tree</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="nb nb-Type">String</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">new</span><span class="w"> </span><span class="n">ChristmasTree</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In the second step, the brightest points in the image are dilated in order to
form shapes. The result of this process is the probable shape of the objects
with significant brightness. Applying flood fill segmentation, disconnected
shapes are detected.</p>
<p><strong>output images:</strong></p>
<p><img alt="" src="https://i.imgur.com/XY2jOdl.png"><img alt="" src="https://i.imgur.com/cZuF9iA.png"><img alt="" src="https://i.imgur.com/G4fzxv6.png"></p>
<p><img alt="" src="https://i.imgur.com/1Ois6pN.png"><img alt="" src="https://i.imgur.com/yDDpBmQ.png"><img alt="" src="https://i.imgur.com/H9IYmJh.png"></p>
<p><strong>source code:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ChristmasTree</span><span class="w"> </span><span class="p">{</span>

<span class="n">private</span><span class="w"> </span><span class="n">MarvinImagePlugin</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinPluginLoader</span><span class="o">.</span><span class="n">loadImagePlugin</span><span class="p">(</span><span class="s2">"org.marvinproject.image.fill.boundaryFill"</span><span class="p">);</span>
<span class="n">private</span><span class="w"> </span><span class="n">MarvinImagePlugin</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinPluginLoader</span><span class="o">.</span><span class="n">loadImagePlugin</span><span class="p">(</span><span class="s2">"org.marvinproject.image.color.thresholding"</span><span class="p">);</span>
<span class="n">private</span><span class="w"> </span><span class="n">MarvinImagePlugin</span><span class="w"> </span><span class="n">invert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinPluginLoader</span><span class="o">.</span><span class="n">loadImagePlugin</span><span class="p">(</span><span class="s2">"org.marvinproject.image.color.invert"</span><span class="p">);</span>
<span class="n">private</span><span class="w"> </span><span class="n">MarvinImagePlugin</span><span class="w"> </span><span class="n">dilation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinPluginLoader</span><span class="o">.</span><span class="n">loadImagePlugin</span><span class="p">(</span><span class="s2">"org.marvinproject.image.morphological.dilation"</span><span class="p">);</span>

<span class="n">public</span><span class="w"> </span><span class="n">ChristmasTree</span><span class="p">(){</span>
<span class="w">    </span><span class="n">MarvinImage</span><span class="w"> </span><span class="n">tree</span><span class="p">;</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Iterate</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">image</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinImageIO</span><span class="o">.</span><span class="n">loadImage</span><span class="p">(</span><span class="s2">"./res/trees/tree"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s2">".png"</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">Threshold</span>
<span class="w">        </span><span class="n">threshold</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">"threshold"</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">);</span>
<span class="w">        </span><span class="n">threshold</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">tree</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">Dilate</span>
<span class="w">        </span><span class="n">invert</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">tree</span><span class="p">);</span>
<span class="w">        </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinColorModelConverter</span><span class="o">.</span><span class="n">rgbToBinary</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="w"> </span><span class="mi">127</span><span class="p">);</span>
<span class="w">        </span><span class="n">MarvinImageIO</span><span class="o">.</span><span class="n">saveImage</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="w"> </span><span class="s2">"./res/trees/new/tree_"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s2">"threshold.png"</span><span class="p">);</span>
<span class="w">        </span><span class="n">dilation</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">"matrix"</span><span class="p">,</span><span class="w"> </span><span class="n">MarvinMath</span><span class="o">.</span><span class="n">getTrueMatrix</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">));</span>
<span class="w">        </span><span class="n">dilation</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">tree</span><span class="p">);</span>
<span class="w">        </span><span class="n">MarvinImageIO</span><span class="o">.</span><span class="n">saveImage</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="w"> </span><span class="s2">"./res/trees/new/tree_"</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="s2">"_dilation.png"</span><span class="p">);</span>
<span class="w">        </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinColorModelConverter</span><span class="o">.</span><span class="n">binaryToRgb</span><span class="p">(</span><span class="n">tree</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="n">Segment</span><span class="w"> </span><span class="n">shapes</span>
<span class="w">        </span><span class="n">MarvinImage</span><span class="w"> </span><span class="n">trees2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="o">.</span><span class="n">clone</span><span class="p">();</span>
<span class="w">        </span><span class="n">fill</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="w"> </span><span class="n">trees2</span><span class="p">);</span>
<span class="w">        </span><span class="n">MarvinImageIO</span><span class="o">.</span><span class="n">saveImage</span><span class="p">(</span><span class="n">trees2</span><span class="p">,</span><span class="w"> </span><span class="s2">"./res/trees/new/tree_"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s2">"_fill.png"</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">private</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">fill</span><span class="p">(</span><span class="n">MarvinImage</span><span class="w"> </span><span class="n">imageIn</span><span class="p">,</span><span class="w"> </span><span class="n">MarvinImage</span><span class="w"> </span><span class="n">imageOut</span><span class="p">){</span>
<span class="w">    </span><span class="n">boolean</span><span class="w"> </span><span class="n">found</span><span class="p">;</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="w"> </span><span class="mh">0xFFFF0000</span><span class="p">;</span>

<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="bp">true</span><span class="p">){</span>
<span class="w">        </span><span class="n">found</span><span class="o">=</span><span class="bp">false</span><span class="p">;</span>

<span class="w">        </span><span class="n">Outerloop</span><span class="p">:</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">&lt;</span><span class="n">imageIn</span><span class="o">.</span><span class="n">getHeight</span><span class="p">();</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">){</span>
<span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">&lt;</span><span class="n">imageIn</span><span class="o">.</span><span class="n">getWidth</span><span class="p">();</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">){</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">imageOut</span><span class="o">.</span><span class="n">getIntComponent0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
<span class="w">                    </span><span class="n">fill</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">                    </span><span class="n">fill</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">                    </span><span class="n">fill</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">"color"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">);</span>
<span class="w">                    </span><span class="n">fill</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">"threshold"</span><span class="p">,</span><span class="w"> </span><span class="mi">120</span><span class="p">);</span>
<span class="w">                    </span><span class="n">fill</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">imageIn</span><span class="p">,</span><span class="w"> </span><span class="n">imageOut</span><span class="p">);</span>
<span class="w">                    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newColor</span><span class="p">(</span><span class="n">color</span><span class="p">);</span>

<span class="w">                    </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">                    </span><span class="k">break</span><span class="w"> </span><span class="n">Outerloop</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">found</span><span class="p">){</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>

<span class="n">private</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">newColor</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">color</span><span class="p">){</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x00FF0000</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">green</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0000FF00</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">blue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x000000FF</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">red</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">green</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">blue</span><span class="p">){</span>
<span class="w">        </span><span class="n">red</span><span class="o">+=</span><span class="mi">5</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">green</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">green</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">blue</span><span class="p">){</span>
<span class="w">        </span><span class="n">green</span><span class="o">+=</span><span class="mi">5</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span><span class="p">{</span>
<span class="w">        </span><span class="n">blue</span><span class="o">+=</span><span class="mi">5</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mh">0xFF000000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">red</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">green</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">blue</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="nb nb-Type">String</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">new</span><span class="w"> </span><span class="n">ChristmasTree</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>As shown in the output image, multiple shapes was detected. In this problem,
there a just a few bright points in the images. However, this approach was
implemented to deal with more complex scenarios.</p>
<p>In the next step each shape is analyzed. A simple algorithm detects shapes
with a pattern similar to a triangle. The algorithm analyze the object shape
line by line. If the center of the mass of each shape line is almost the same
(given a threshold) and mass increase as y increase, the object has a
triangle-like shape. The mass of the shape line is the number of pixels in
that line that belongs to the shape. Imagine you slice the object horizontally
and analyze each horizontal segment. If they are centralized to each other and
the length increase from the first segment to last one in a linear pattern,
you probably has an object that resembles a triangle.</p>
<p><strong>source code:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">private</span><span class="w"> </span><span class="nc">int</span><span class="err">[]</span><span class="w"> </span><span class="n">detectTrees</span><span class="p">(</span><span class="n">MarvinImage</span><span class="w"> </span><span class="nc">image</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="k">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">analysed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="k">Integer</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="k">boolean</span><span class="w"> </span><span class="k">found</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="k">true</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="k">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">&lt;</span><span class="nc">image</span><span class="p">.</span><span class="n">getHeight</span><span class="p">();</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">&lt;</span><span class="nc">image</span><span class="p">.</span><span class="n">getWidth</span><span class="p">();</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">                </span><span class="nc">int</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">image</span><span class="p">.</span><span class="n">getIntColor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="err">!</span><span class="n">analysed</span><span class="p">.</span><span class="k">contains</span><span class="p">(</span><span class="n">color</span><span class="p">))</span><span class="err">{</span>
<span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="n">isTree</span><span class="p">(</span><span class="nc">image</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">))</span><span class="err">{</span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="n">getObjectRect</span><span class="p">(</span><span class="nc">image</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">);</span>
<span class="w">                    </span><span class="err">}</span>

<span class="w">                    </span><span class="n">analysed</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">color</span><span class="p">);</span>
<span class="w">                    </span><span class="k">found</span><span class="o">=</span><span class="k">true</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="err">!</span><span class="k">found</span><span class="p">)</span><span class="err">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="err">}</span>

<span class="n">private</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">isTree</span><span class="p">(</span><span class="n">MarvinImage</span><span class="w"> </span><span class="nc">image</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="err">{</span>

<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">mass</span><span class="err">[][]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">int</span><span class="o">[</span><span class="n">image.getHeight()</span><span class="o">][</span><span class="n">2</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">yStart</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">xStart</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">&lt;</span><span class="nc">image</span><span class="p">.</span><span class="n">getHeight</span><span class="p">();</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="nc">int</span><span class="w"> </span><span class="n">mc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="nc">int</span><span class="w"> </span><span class="n">xs</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="nc">int</span><span class="w"> </span><span class="n">xe</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">&lt;</span><span class="nc">image</span><span class="p">.</span><span class="n">getWidth</span><span class="p">();</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="nc">image</span><span class="p">.</span><span class="n">getIntColor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="err">{</span>
<span class="w">                </span><span class="n">mc</span><span class="o">++</span><span class="p">;</span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">yStart</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="n">yStart</span><span class="o">=</span><span class="n">y</span><span class="p">;</span>
<span class="w">                    </span><span class="n">xStart</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">xs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">xe</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="n">xe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">        </span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xs</span><span class="p">;</span>
<span class="w">        </span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xe</span><span class="p">;</span>
<span class="w">        </span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">4</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mc</span><span class="p">;</span><span class="w">    </span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">validLines</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">&lt;</span><span class="nc">image</span><span class="p">.</span><span class="n">getHeight</span><span class="p">();</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="k">if</span>
<span class="w">        </span><span class="p">(</span><span class="w"> </span>
<span class="w">            </span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">5</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="n">Math</span><span class="p">.</span><span class="nf">abs</span><span class="p">(((</span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">0</span><span class="o">]+</span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">6</span><span class="o">]</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">xStart</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">7</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="n">mass</span><span class="o">[</span><span class="n">yStart</span><span class="o">][</span><span class="n">8</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">yStart</span><span class="p">)</span><span class="o">*</span><span class="mf">0.3</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">9</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">mass</span><span class="o">[</span><span class="n">yStart</span><span class="o">][</span><span class="n">10</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">yStart</span><span class="p">)</span><span class="o">*</span><span class="mf">1.5</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="err">{</span>
<span class="w">            </span><span class="n">validLines</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">validLines</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="err">}</span>
</pre></div>

<p>Finally, the position of each shape similar to a triangle and with significant
brightness, in this case a Christmas tree, is highlighted in the original
image, as shown below.</p>
<p><strong>final output images:</strong></p>
<p><img alt="" src="https://i.imgur.com/KT8AVEt.jpg"><img alt="" src="https://i.imgur.com/vH2JVri.jpg"><img alt="" src="https://i.imgur.com/Y87W0TJ.jpg"></p>
<p><img alt="" src="https://i.imgur.com/3P2GUT2.jpg"><img alt="" src="https://i.imgur.com/9DQrqar.jpg"><img alt="" src="https://i.imgur.com/i9i8aBs.jpg"></p>
<p><strong>final source code:</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ChristmasTree</span><span class="w"> </span><span class="err">{</span>

<span class="n">private</span><span class="w"> </span><span class="n">MarvinImagePlugin</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinPluginLoader</span><span class="p">.</span><span class="n">loadImagePlugin</span><span class="p">(</span><span class="ss">"org.marvinproject.image.fill.boundaryFill"</span><span class="p">);</span>
<span class="n">private</span><span class="w"> </span><span class="n">MarvinImagePlugin</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinPluginLoader</span><span class="p">.</span><span class="n">loadImagePlugin</span><span class="p">(</span><span class="ss">"org.marvinproject.image.color.thresholding"</span><span class="p">);</span>
<span class="n">private</span><span class="w"> </span><span class="n">MarvinImagePlugin</span><span class="w"> </span><span class="n">invert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinPluginLoader</span><span class="p">.</span><span class="n">loadImagePlugin</span><span class="p">(</span><span class="ss">"org.marvinproject.image.color.invert"</span><span class="p">);</span>
<span class="n">private</span><span class="w"> </span><span class="n">MarvinImagePlugin</span><span class="w"> </span><span class="n">dilation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinPluginLoader</span><span class="p">.</span><span class="n">loadImagePlugin</span><span class="p">(</span><span class="ss">"org.marvinproject.image.morphological.dilation"</span><span class="p">);</span>

<span class="k">public</span><span class="w"> </span><span class="n">ChristmasTree</span><span class="p">()</span><span class="err">{</span>
<span class="w">    </span><span class="n">MarvinImage</span><span class="w"> </span><span class="n">tree</span><span class="p">;</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">Iterate</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="nc">image</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinImageIO</span><span class="p">.</span><span class="n">loadImage</span><span class="p">(</span><span class="ss">"./res/trees/tree"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="ss">".png"</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">Threshold</span>
<span class="w">        </span><span class="n">threshold</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="ss">"threshold"</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">);</span>
<span class="w">        </span><span class="n">threshold</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">tree</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">tree</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">Dilate</span>
<span class="w">        </span><span class="n">invert</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">tree</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">tree</span><span class="p">);</span>
<span class="w">        </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinColorModelConverter</span><span class="p">.</span><span class="n">rgbToBinary</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="w"> </span><span class="mi">127</span><span class="p">);</span>
<span class="w">        </span><span class="n">MarvinImageIO</span><span class="p">.</span><span class="n">saveImage</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="w"> </span><span class="ss">"./res/trees/new/tree_"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="ss">"threshold.png"</span><span class="p">);</span>
<span class="w">        </span><span class="n">dilation</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="ss">"matrix"</span><span class="p">,</span><span class="w"> </span><span class="n">MarvinMath</span><span class="p">.</span><span class="n">getTrueMatrix</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">));</span>
<span class="w">        </span><span class="n">dilation</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">tree</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">tree</span><span class="p">);</span>
<span class="w">        </span><span class="n">MarvinImageIO</span><span class="p">.</span><span class="n">saveImage</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="w"> </span><span class="ss">"./res/trees/new/tree_"</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="ss">"_dilation.png"</span><span class="p">);</span>
<span class="w">        </span><span class="n">tree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinColorModelConverter</span><span class="p">.</span><span class="n">binaryToRgb</span><span class="p">(</span><span class="n">tree</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="n">Segment</span><span class="w"> </span><span class="n">shapes</span>
<span class="w">        </span><span class="n">MarvinImage</span><span class="w"> </span><span class="n">trees2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
<span class="w">        </span><span class="n">fill</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="w"> </span><span class="n">trees2</span><span class="p">);</span>
<span class="w">        </span><span class="n">MarvinImageIO</span><span class="p">.</span><span class="n">saveImage</span><span class="p">(</span><span class="n">trees2</span><span class="p">,</span><span class="w"> </span><span class="ss">"./res/trees/new/tree_"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="ss">"_fill.png"</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">4.</span><span class="w"> </span><span class="n">Detect</span><span class="w"> </span><span class="n">tree</span><span class="o">-</span><span class="ow">like</span><span class="w"> </span><span class="n">shapes</span>
<span class="w">        </span><span class="nc">int</span><span class="err">[]</span><span class="w"> </span><span class="n">rect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">detectTrees</span><span class="p">(</span><span class="n">trees2</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">5.</span><span class="w"> </span><span class="n">Draw</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">result</span>
<span class="w">        </span><span class="n">MarvinImage</span><span class="w"> </span><span class="n">original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MarvinImageIO</span><span class="p">.</span><span class="n">loadImage</span><span class="p">(</span><span class="ss">"./res/trees/tree"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="ss">".png"</span><span class="p">);</span>
<span class="w">        </span><span class="n">drawBoundary</span><span class="p">(</span><span class="n">trees2</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">,</span><span class="w"> </span><span class="n">rect</span><span class="p">);</span>
<span class="w">        </span><span class="n">MarvinImageIO</span><span class="p">.</span><span class="n">saveImage</span><span class="p">(</span><span class="n">original</span><span class="p">,</span><span class="w"> </span><span class="ss">"./res/trees/new/tree_"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="ss">"_out_2.jpg"</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>

<span class="n">private</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">drawBoundary</span><span class="p">(</span><span class="n">MarvinImage</span><span class="w"> </span><span class="n">shape</span><span class="p">,</span><span class="w"> </span><span class="n">MarvinImage</span><span class="w"> </span><span class="n">original</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="err">[]</span><span class="w"> </span><span class="n">rect</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">yLines</span><span class="err">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">int</span><span class="o">[</span><span class="n">6</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="n">yLines</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rect</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="n">yLines</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rect</span><span class="o">[</span><span class="n">1</span><span class="o">]+</span><span class="p">(</span><span class="nc">int</span><span class="p">)((</span><span class="n">rect</span><span class="o">[</span><span class="n">3</span><span class="o">]/</span><span class="mi">5</span><span class="p">));</span>
<span class="w">    </span><span class="n">yLines</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rect</span><span class="o">[</span><span class="n">1</span><span class="o">]+</span><span class="p">((</span><span class="n">rect</span><span class="o">[</span><span class="n">3</span><span class="o">]/</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="n">yLines</span><span class="o">[</span><span class="n">3</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rect</span><span class="o">[</span><span class="n">1</span><span class="o">]+</span><span class="p">((</span><span class="n">rect</span><span class="o">[</span><span class="n">3</span><span class="o">]/</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">);</span>
<span class="w">    </span><span class="n">yLines</span><span class="o">[</span><span class="n">4</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rect</span><span class="o">[</span><span class="n">1</span><span class="o">]+</span><span class="p">(</span><span class="nc">int</span><span class="p">)((</span><span class="n">rect</span><span class="o">[</span><span class="n">3</span><span class="o">]/</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">);</span>
<span class="w">    </span><span class="n">yLines</span><span class="o">[</span><span class="n">5</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rect</span><span class="o">[</span><span class="n">1</span><span class="o">]+</span><span class="n">rect</span><span class="o">[</span><span class="n">3</span><span class="o">]</span><span class="p">;</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">yLines</span><span class="p">.</span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="k">boolean</span><span class="w"> </span><span class="ow">in</span><span class="o">=</span><span class="k">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="n">startPoint</span><span class="o">=</span><span class="k">null</span><span class="p">;</span>
<span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="n">endPoint</span><span class="o">=</span><span class="k">null</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="n">rect</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">&lt;</span><span class="n">rect</span><span class="o">[</span><span class="n">0</span><span class="o">]+</span><span class="n">rect</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">shape</span><span class="p">.</span><span class="n">getIntColor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yLines</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mh">0xFFFFFFFF</span><span class="p">)</span><span class="err">{</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="err">!</span><span class="ow">in</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="n">startPoint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="err">{</span>
<span class="w">                        </span><span class="n">startPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yLines</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
<span class="w">                    </span><span class="err">}</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">                </span><span class="ow">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">            </span><span class="k">else</span><span class="err">{</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="ow">in</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="n">endPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yLines</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">                </span><span class="ow">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">endPoint</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="err">{</span>
<span class="w">            </span><span class="n">endPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Point</span><span class="p">((</span><span class="n">rect</span><span class="o">[</span><span class="n">0</span><span class="o">]+</span><span class="n">rect</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">yLines</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="n">points</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">startPoint</span><span class="p">);</span>
<span class="w">        </span><span class="n">points</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">endPoint</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="n">drawLine</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">);</span>
<span class="w">    </span><span class="n">drawLine</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">);</span>
<span class="w">    </span><span class="n">drawLine</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">);</span>
<span class="w">    </span><span class="n">drawLine</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">7</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">7</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">);</span>
<span class="w">    </span><span class="n">drawLine</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">7</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">7</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">9</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">9</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">);</span>
<span class="w">    </span><span class="n">drawLine</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">9</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">9</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">11</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">11</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">);</span>
<span class="w">    </span><span class="n">drawLine</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">11</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">11</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">);</span>
<span class="w">    </span><span class="n">drawLine</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">8</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">8</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">);</span>
<span class="w">    </span><span class="n">drawLine</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">8</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">8</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">);</span>
<span class="w">    </span><span class="n">drawLine</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">6</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">);</span>
<span class="w">    </span><span class="n">drawLine</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">);</span>
<span class="w">    </span><span class="n">drawLine</span><span class="p">(</span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">points</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">original</span><span class="p">);</span>
<span class="err">}</span>

<span class="n">private</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">drawLine</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">MarvinImage</span><span class="w"> </span><span class="nc">image</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">lx1</span><span class="p">,</span><span class="w"> </span><span class="n">lx2</span><span class="p">,</span><span class="w"> </span><span class="n">ly1</span><span class="p">,</span><span class="w"> </span><span class="n">ly2</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="n">lx1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x1</span><span class="o">+</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nc">image</span><span class="p">.</span><span class="n">getWidth</span><span class="p">()</span><span class="w"> </span><span class="vm">?</span><span class="w"> </span><span class="p">(</span><span class="nc">image</span><span class="p">.</span><span class="n">getWidth</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="nl">i</span><span class="p">:</span><span class="w"> </span><span class="n">x1</span><span class="p">);</span>
<span class="w">        </span><span class="n">lx2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x2</span><span class="o">+</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nc">image</span><span class="p">.</span><span class="n">getWidth</span><span class="p">()</span><span class="w"> </span><span class="vm">?</span><span class="w"> </span><span class="p">(</span><span class="nc">image</span><span class="p">.</span><span class="n">getWidth</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="nl">i</span><span class="p">:</span><span class="w"> </span><span class="n">x2</span><span class="p">);</span>
<span class="w">        </span><span class="n">ly1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">y1</span><span class="o">+</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nc">image</span><span class="p">.</span><span class="n">getHeight</span><span class="p">()</span><span class="w"> </span><span class="vm">?</span><span class="w"> </span><span class="p">(</span><span class="nc">image</span><span class="p">.</span><span class="n">getHeight</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="nl">i</span><span class="p">:</span><span class="w"> </span><span class="n">y1</span><span class="p">);</span>
<span class="w">        </span><span class="n">ly2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">y2</span><span class="o">+</span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nc">image</span><span class="p">.</span><span class="n">getHeight</span><span class="p">()</span><span class="w"> </span><span class="vm">?</span><span class="w"> </span><span class="p">(</span><span class="nc">image</span><span class="p">.</span><span class="n">getHeight</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="nl">i</span><span class="p">:</span><span class="w"> </span><span class="n">y2</span><span class="p">);</span>

<span class="w">        </span><span class="nc">image</span><span class="p">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">lx1</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ly1</span><span class="p">,</span><span class="w"> </span><span class="n">lx2</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ly2</span><span class="p">,</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="p">);</span>
<span class="w">        </span><span class="nc">image</span><span class="p">.</span><span class="n">drawLine</span><span class="p">(</span><span class="n">lx1</span><span class="p">,</span><span class="w"> </span><span class="n">ly1</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">lx2</span><span class="p">,</span><span class="w"> </span><span class="n">ly2</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>

<span class="n">private</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">fillRect</span><span class="p">(</span><span class="n">MarvinImage</span><span class="w"> </span><span class="nc">image</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="err">[]</span><span class="w"> </span><span class="n">rect</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="nc">image</span><span class="p">.</span><span class="n">drawRect</span><span class="p">(</span><span class="n">rect</span><span class="o">[</span><span class="n">0</span><span class="o">]+</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">rect</span><span class="o">[</span><span class="n">1</span><span class="o">]+</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">rect</span><span class="o">[</span><span class="n">2</span><span class="o">]-</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">rect</span><span class="o">[</span><span class="n">3</span><span class="o">]-</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="n">red</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>

<span class="n">private</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">fill</span><span class="p">(</span><span class="n">MarvinImage</span><span class="w"> </span><span class="n">imageIn</span><span class="p">,</span><span class="w"> </span><span class="n">MarvinImage</span><span class="w"> </span><span class="n">imageOut</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="k">boolean</span><span class="w"> </span><span class="k">found</span><span class="p">;</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="w"> </span><span class="mh">0xFFFF0000</span><span class="p">;</span>

<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="k">true</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="k">found</span><span class="o">=</span><span class="k">false</span><span class="p">;</span>

<span class="w">        </span><span class="nl">Outerloop</span><span class="p">:</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">&lt;</span><span class="n">imageIn</span><span class="p">.</span><span class="n">getHeight</span><span class="p">();</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">&lt;</span><span class="n">imageIn</span><span class="p">.</span><span class="n">getWidth</span><span class="p">();</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">imageOut</span><span class="p">.</span><span class="n">getIntComponent0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="n">fill</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="ss">"x"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">                    </span><span class="n">fill</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="ss">"y"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">                    </span><span class="n">fill</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="ss">"color"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">);</span>
<span class="w">                    </span><span class="n">fill</span><span class="p">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="ss">"threshold"</span><span class="p">,</span><span class="w"> </span><span class="mi">120</span><span class="p">);</span>
<span class="w">                    </span><span class="n">fill</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">imageIn</span><span class="p">,</span><span class="w"> </span><span class="n">imageOut</span><span class="p">);</span>
<span class="w">                    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newColor</span><span class="p">(</span><span class="n">color</span><span class="p">);</span>

<span class="w">                    </span><span class="k">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">                    </span><span class="k">break</span><span class="w"> </span><span class="n">Outerloop</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="err">!</span><span class="k">found</span><span class="p">)</span><span class="err">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="err">}</span>

<span class="n">private</span><span class="w"> </span><span class="nc">int</span><span class="err">[]</span><span class="w"> </span><span class="n">detectTrees</span><span class="p">(</span><span class="n">MarvinImage</span><span class="w"> </span><span class="nc">image</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="k">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">analysed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="k">Integer</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="k">boolean</span><span class="w"> </span><span class="k">found</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="k">true</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="k">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">&lt;</span><span class="nc">image</span><span class="p">.</span><span class="n">getHeight</span><span class="p">();</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">&lt;</span><span class="nc">image</span><span class="p">.</span><span class="n">getWidth</span><span class="p">();</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">                </span><span class="nc">int</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">image</span><span class="p">.</span><span class="n">getIntColor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="err">!</span><span class="n">analysed</span><span class="p">.</span><span class="k">contains</span><span class="p">(</span><span class="n">color</span><span class="p">))</span><span class="err">{</span>
<span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="n">isTree</span><span class="p">(</span><span class="nc">image</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">))</span><span class="err">{</span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="n">getObjectRect</span><span class="p">(</span><span class="nc">image</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">);</span>
<span class="w">                    </span><span class="err">}</span>

<span class="w">                    </span><span class="n">analysed</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">color</span><span class="p">);</span>
<span class="w">                    </span><span class="k">found</span><span class="o">=</span><span class="k">true</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="err">!</span><span class="k">found</span><span class="p">)</span><span class="err">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="err">}</span>

<span class="n">private</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">isTree</span><span class="p">(</span><span class="n">MarvinImage</span><span class="w"> </span><span class="nc">image</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="err">{</span>

<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">mass</span><span class="err">[][]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">int</span><span class="o">[</span><span class="n">image.getHeight()</span><span class="o">][</span><span class="n">11</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">yStart</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">xStart</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">&lt;</span><span class="nc">image</span><span class="p">.</span><span class="n">getHeight</span><span class="p">();</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="nc">int</span><span class="w"> </span><span class="n">mc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="nc">int</span><span class="w"> </span><span class="n">xs</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="nc">int</span><span class="w"> </span><span class="n">xe</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">&lt;</span><span class="nc">image</span><span class="p">.</span><span class="n">getWidth</span><span class="p">();</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="nc">image</span><span class="p">.</span><span class="n">getIntColor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="err">{</span>
<span class="w">                </span><span class="n">mc</span><span class="o">++</span><span class="p">;</span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">yStart</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="n">yStart</span><span class="o">=</span><span class="n">y</span><span class="p">;</span>
<span class="w">                    </span><span class="n">xStart</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">xs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">xe</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="n">xe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">        </span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xs</span><span class="p">;</span>
<span class="w">        </span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">12</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xe</span><span class="p">;</span>
<span class="w">        </span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">13</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mc</span><span class="p">;</span><span class="w">   </span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">validLines</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">&lt;</span><span class="nc">image</span><span class="p">.</span><span class="n">getHeight</span><span class="p">();</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="k">if</span>
<span class="w">        </span><span class="p">(</span><span class="w"> </span>
<span class="w">            </span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">14</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="n">Math</span><span class="p">.</span><span class="nf">abs</span><span class="p">(((</span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">0</span><span class="o">]+</span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">15</span><span class="o">]</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">xStart</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">16</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="n">mass</span><span class="o">[</span><span class="n">yStart</span><span class="o">][</span><span class="n">17</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">yStart</span><span class="p">)</span><span class="o">*</span><span class="mf">0.3</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="n">mass</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">18</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">mass</span><span class="o">[</span><span class="n">yStart</span><span class="o">][</span><span class="n">19</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">yStart</span><span class="p">)</span><span class="o">*</span><span class="mf">1.5</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="err">{</span>
<span class="w">            </span><span class="n">validLines</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">validLines</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="err">}</span>

<span class="n">private</span><span class="w"> </span><span class="nc">int</span><span class="err">[]</span><span class="w"> </span><span class="n">getObjectRect</span><span class="p">(</span><span class="n">MarvinImage</span><span class="w"> </span><span class="nc">image</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">x1</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">x2</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">y1</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">y2</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">&lt;</span><span class="nc">image</span><span class="p">.</span><span class="n">getHeight</span><span class="p">();</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">&lt;</span><span class="nc">image</span><span class="p">.</span><span class="n">getWidth</span><span class="p">();</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="nc">image</span><span class="p">.</span><span class="n">getIntColor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="err">{</span>

<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">x1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">x1</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">x2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">x2</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">y1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">y1</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="n">y1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">y2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y2</span><span class="p">)</span><span class="err">{</span>
<span class="w">                    </span><span class="n">y2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">int</span><span class="err">[]{</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="err">}</span><span class="p">;</span>
<span class="err">}</span>

<span class="n">private</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">newColor</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x00FF0000</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">green</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x0000FF00</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">blue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x000000FF</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">red</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">green</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">blue</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="n">red</span><span class="o">+=</span><span class="mi">5</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">green</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">green</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">blue</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="n">green</span><span class="o">+=</span><span class="mi">30</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="k">else</span><span class="err">{</span>
<span class="w">        </span><span class="n">blue</span><span class="o">+=</span><span class="mi">30</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mh">0xFF000000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">red</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">green</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">blue</span><span class="p">;</span>
<span class="err">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="err">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">ChristmasTree</span><span class="p">();</span>
<span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>The advantage of this approach is the fact it will probably work with images
containing other luminous objects since it analyzes the object shape.</p>
<p>Merry Christmas!</p>
<hr>
<p><strong>EDIT NOTE 2</strong></p>
<p>There is a discussion about the similarity of the output images of this
solution and some other ones. In fact, they are very similar. But this
approach does not just segment objects. It also analyzes the object shapes in
some sense. It can handle multiple luminous objects in the same scene. In
fact, the Christmas tree does not need to be the brightest one. I'm just
abording it to enrich the discussion. There is a bias in the samples that just
looking for the brightest object, you will find the trees. But, does we really
want to stop the discussion at this point? At this point, how far the computer
is really recognizing an object that resembles a Christmas tree? Let's try to
close this gap.</p>
<p>Below is presented a result just to elucidate this point:</p>
<p><strong>input image</strong></p>
<p><img alt="enter image description here" src="images/qlJAa.jpg"></p>
<p><strong>output</strong></p>
<p><img alt="enter image description here" src="images/ScklT.jpg"></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2285.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2283.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
