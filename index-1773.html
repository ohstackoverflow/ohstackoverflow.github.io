<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1773) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1773.html">
<link rel="prev" href="index-1774.html" type="text/html">
<link rel="next" href="index-1772.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/pass-in-an-array-of-deferreds-to-when/" class="u-url">Pass in an array of Deferreds to $.when()</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/pass-in-an-array-of-deferreds-to-when/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T09:01:02+08:00" itemprop="datePublished" title="2023-03-03 09:01">2023-03-03 09:01</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Here's an contrived example of what's going on:
http://jsfiddle.net/adamjford/YNGcm/20/</p>
<p>HTML:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Click<span class="w"> </span>me!<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;div&gt;&lt;/div&gt;</span>
</pre></div>

<p>JavaScript:</p>
<div class="code"><pre class="code literal-block">function<span class="w"> </span>getSomeDeferredStuff()<span class="w"> </span>{
<span class="w">    </span>var<span class="w"> </span>deferreds<span class="w"> </span>=<span class="w"> </span>[];

<span class="w">    </span>var<span class="w"> </span>i<span class="w"> </span>=<span class="w"> </span>1;
<span class="w">    </span>for<span class="w"> </span>(i<span class="w"> </span>=<span class="w"> </span>1;<span class="w"> </span>i<span class="w"> </span><span class="err">&lt;</span>=<span class="w"> </span>10;<span class="w"> </span>i++)<span class="w"> </span>{
<span class="w">        </span>var<span class="w"> </span>count<span class="w"> </span>=<span class="w"> </span>i;

<span class="w">        </span>deferreds.push(
<span class="w">        </span>$.post('/echo/html/',<span class="w"> </span>{
<span class="w">            </span>html:<span class="w"> </span>"<span class="nt">&lt;p&gt;</span>Task<span class="w"> </span>#"<span class="w"> </span>+<span class="w"> </span>count<span class="w"> </span>+<span class="w"> </span>"<span class="w"> </span>complete.",
<span class="w">            </span>delay:<span class="w"> </span>count
<span class="w">        </span>}).success(function(data)<span class="w"> </span>{
<span class="w">            </span>$("div").append(data);
<span class="w">        </span>}));
<span class="w">    </span>}

<span class="w">    </span>return<span class="w"> </span>deferreds;
}

$(function()<span class="w"> </span>{
<span class="w">    </span>$("a").click(function()<span class="w"> </span>{
<span class="w">        </span>var<span class="w"> </span>deferreds<span class="w"> </span>=<span class="w"> </span>getSomeDeferredStuff();

<span class="w">        </span>$.when(deferreds).done(function()<span class="w"> </span>{
<span class="w">            </span>$("div").append("<span class="nt">&lt;p&gt;</span>All<span class="w"> </span>done!<span class="nt">&lt;/p&gt;</span>");
<span class="w">        </span>});
<span class="w">    </span>});
});
</pre></div>

<p>I want "All done!" to appear after all of the deferred tasks have completed,
but <code>$.when()</code> doesn't appear to know how to handle an array of Deferred
objects. "All done!" is happening first because the array is not a Deferred
object, so jQuery goes ahead and assumes it's just done.</p>
<p>I know one could pass the objects into the function like <code>$.when(deferred1,
deferred2, ..., deferredX)</code> but it's unknown how many Deferred objects there
will be at execution in the actual problem I'm trying to solve.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>To pass an array of values to <em>any</em> function that normally expects them to be
separate parameters, use <code>Function.prototype.apply</code>, so in this case you need:</p>
<div class="code"><pre class="code literal-block">$.<span class="nv">when</span>.<span class="nv">apply</span><span class="ss">(</span>$,<span class="w"> </span><span class="nv">my_array</span><span class="ss">)</span>.<span class="k">then</span><span class="ss">(</span><span class="w"> </span><span class="nv">___</span><span class="w"> </span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>See http://jsfiddle.net/YNGcm/21/</p>
<p>In ES6, you can use the <code>...</code> spread operator instead:</p>
<div class="code"><pre class="code literal-block">$.<span class="nv">when</span><span class="ss">(</span>...<span class="nv">my_array</span><span class="ss">)</span>.<span class="k">then</span><span class="ss">(</span><span class="w"> </span><span class="nv">___</span><span class="w"> </span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>In either case, since it's unlikely that you'll known in advance how many
formal parameters the <code>.then</code> handler will require, that handler would need to
process the <code>arguments</code> array in order to retrieve the result of each promise.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The workarounds above (thanks!) don't properly address the problem of getting
back the objects provided to the deferred's <code>resolve()</code> method because jQuery
calls the <code>done()</code> and <code>fail()</code> callbacks with individual parameters, not an
array. That means we have to use the <code>arguments</code> pseudo-array to get all the
resolved/rejected objects returned by the array of deferreds, which is ugly:</p>
<div class="code"><pre class="code literal-block"><span class="o">$.</span><span class="n">when</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="o">$</span><span class="p">,</span><span class="n">deferreds</span><span class="p">)</span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="k">var</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arguments</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">resolved</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">pseudo</span><span class="o">-</span><span class="n">array</span>
<span class="w">     </span><span class="o">...</span>
<span class="p">};</span>
</pre></div>

<p>Since we passed in an array of deferreds, it would be nice to get back an
array of results. It would also be nice to get back an actual array instead of
a pseudo-array so we can use methods like <code>Array.sort()</code>.</p>
<p>Here is a solution inspired by <strong>when.js</strong> 's <code>when.all()</code> method that
addresses these problems:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">Put</span><span class="w"> </span><span class="n">somewhere</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">scripting</span><span class="w"> </span><span class="n">environment</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">typeof</span><span class="w"> </span><span class="n">jQuery</span><span class="p">.</span><span class="k">when</span><span class="p">.</span><span class="ow">all</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'undefined'</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">jQuery</span><span class="p">.</span><span class="k">when</span><span class="p">.</span><span class="ow">all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">deferreds</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="err">$</span><span class="p">.</span><span class="k">Deferred</span><span class="p">(</span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">def</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="err">$</span><span class="p">.</span><span class="k">when</span><span class="p">.</span><span class="n">apply</span><span class="p">(</span><span class="n">jQuery</span><span class="p">,</span><span class="w"> </span><span class="n">deferreds</span><span class="p">).</span><span class="k">then</span><span class="p">(</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">calling</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">receive</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="k">of</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="k">deferred</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">when</span><span class="p">.</span><span class="ow">all</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">succeeded</span><span class="p">.</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="k">element</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="n">will</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">itself</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">objects</span><span class="p">,</span><span class="w"> </span><span class="k">corresponding</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">jqXHR</span><span class="p">.</span><span class="nl">done</span><span class="p">:</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="n">textStatus</span><span class="p">,</span><span class="w"> </span><span class="n">jqXHR</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="k">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="nf">var</span><span class="w"> </span><span class="n">arrayThis</span><span class="p">,</span><span class="w"> </span><span class="n">arrayArguments</span><span class="p">;</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">Array</span><span class="p">.</span><span class="n">isArray</span><span class="p">(</span><span class="n">this</span><span class="p">))</span><span class="w"> </span><span class="err">{</span>
<span class="w">                    </span><span class="n">arrayThis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="w">                    </span><span class="n">arrayArguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arguments</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="err">{</span>
<span class="w">                    </span><span class="n">arrayThis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">this</span><span class="o">]</span><span class="p">;</span>
<span class="w">                    </span><span class="n">arrayArguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">arguments</span><span class="o">]</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>

<span class="w">                </span><span class="n">def</span><span class="p">.</span><span class="n">resolveWith</span><span class="p">(</span><span class="n">arrayThis</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">Array.prototype.slice.call(arrayArguments)</span><span class="o">]</span><span class="p">);</span>
<span class="w">            </span><span class="err">}</span><span class="p">,</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">calling</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">receive</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="k">of</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="k">deferred</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">when</span><span class="p">.</span><span class="ow">all</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">failed</span><span class="p">.</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="k">element</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="n">will</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">itself</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">objects</span><span class="p">,</span><span class="w"> </span><span class="k">corresponding</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">arguments</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">jqXHR</span><span class="p">.</span><span class="nl">fail</span><span class="p">:</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">jqXHR</span><span class="p">,</span><span class="w"> </span><span class="n">textStatus</span><span class="p">,</span><span class="w"> </span><span class="n">errorThrown</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="k">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="nf">var</span><span class="w"> </span><span class="n">arrayThis</span><span class="p">,</span><span class="w"> </span><span class="n">arrayArguments</span><span class="p">;</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">Array</span><span class="p">.</span><span class="n">isArray</span><span class="p">(</span><span class="n">this</span><span class="p">))</span><span class="w"> </span><span class="err">{</span>
<span class="w">                    </span><span class="n">arrayThis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="w">                    </span><span class="n">arrayArguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arguments</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="err">{</span>
<span class="w">                    </span><span class="n">arrayThis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">this</span><span class="o">]</span><span class="p">;</span>
<span class="w">                    </span><span class="n">arrayArguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">arguments</span><span class="o">]</span><span class="p">;</span>
<span class="w">                </span><span class="err">}</span>

<span class="w">                </span><span class="n">def</span><span class="p">.</span><span class="n">rejectWith</span><span class="p">(</span><span class="n">arrayThis</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">Array.prototype.slice.call(arrayArguments)</span><span class="o">]</span><span class="p">);</span>
<span class="w">            </span><span class="err">}</span><span class="p">);</span>
<span class="w">        </span><span class="err">}</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>Now you can simply pass in an array of deferreds/promises and get back an
array of resolved/rejected objects in your callback, like so:</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="p">.</span><span class="nc">when</span><span class="p">.</span><span class="nc">all</span><span class="o">(</span><span class="nt">deferreds</span><span class="o">)</span><span class="p">.</span><span class="nc">then</span><span class="o">(</span><span class="nt">function</span><span class="o">(</span><span class="nt">objects</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">console.log("Resolved</span><span class="w"> </span><span class="n">objects</span><span class="p">:</span><span class="err">"</span><span class="p">,</span><span class="w"> </span><span class="kc">objects</span><span class="p">);</span>
<span class="p">}</span><span class="o">);</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-call-controller-view-helper-methods-from-the-console-in-ruby-on-rails/" class="u-url">How can I call controller/view helper methods from the console in Ruby on Rails?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-call-controller-view-helper-methods-from-the-console-in-ruby-on-rails/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T09:00:36+08:00" itemprop="datePublished" title="2023-03-03 09:00">2023-03-03 09:00</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>When I load <code>script/console</code>, sometimes I want to play with the output of a
controller or a view helper method.</p>
<p>Are there ways to:</p>
<ul>
<li>simulate a request?</li>
<li>call methods from a controller instance on said request?</li>
<li>test helper methods, either via said controller instance or another way?</li>
</ul>
<p><br><br></p>
<h2>Answer</h2>
<p>To call helpers, use the <code>helper</code> object:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>./script/console
&gt;&gt;<span class="w"> </span>helper.number_to_currency<span class="o">(</span><span class="s1">'123.45'</span><span class="o">)</span>
<span class="o">=</span>&gt;<span class="w"> </span><span class="s2">"R</span>$<span class="s2"> 123,45"</span>
</pre></div>

<p>If you want to use a helper that's not included by default (say, because you
removed <code>helper :all</code> from <code>ApplicationController</code>), just include the helper.</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;</span><span class="w"> </span><span class="k">include</span><span class="w"> </span><span class="nv">BogusHelper</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="nv">helper</span>.<span class="nv">bogus</span>
<span class="o">=&gt;</span><span class="w"> </span><span class="s2">"bogus output"</span>
</pre></div>

<p>As for dealing with <strong>controllers</strong> , I quote Nick's answer:</p>
<blockquote>
<div class="code"><pre class="code literal-block">&gt; app.get '/posts/1'
&gt; response = app.response
# you now have a rails response object much like the integration tests

&gt; response.body            # get you the HTML
&gt; response.cookies         # hash of the cookies

# etc, etc
</pre></div>

</blockquote>
<p><br></p>
<h3>Suggest</h3>
<p>An easy way to call a controller action from a script/console and
view/manipulate the response object is:</p>
<div class="code"><pre class="code literal-block">&gt; app.get '/posts/1'
&gt; response = app.response
# You now have a Ruby on Rails response object much like the integration tests

&gt; response.body            # Get you the HTML
&gt; response.cookies         # Hash of the cookies

# etc., etc.
</pre></div>

<p>The app object is an instance of ActionController::Integration::Session</p>
<p>This works for me using Ruby on Rails 2.1 and 2.3, and I did not try earlier
versions.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-detect-a-loop-in-a-linked-list/" class="u-url">How to detect a loop in a linked list?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-detect-a-loop-in-a-linked-list/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T09:00:08+08:00" itemprop="datePublished" title="2023-03-03 09:00">2023-03-03 09:00</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Say you have a linked list structure in Java. It's made up of Nodes:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Node</span> {
    <span class="n">Node</span> <span class="nb">next</span>;
    // <span class="n">some</span> <span class="n">user</span> <span class="n">data</span>
}
</pre></div>

<p>and each Node points to the next node, except for the last Node, which has
null for next. Say there is a possibility that the list can contain a loop -
i.e. the final Node, instead of having a null, has a reference to one of the
nodes in the list which came before it.</p>
<p>What's the best way of writing</p>
<div class="code"><pre class="code literal-block">boolean hasLoop(Node first)
</pre></div>

<p>which would return <code>true</code> if the given Node is the first of a list with a
loop, and <code>false</code> otherwise? How could you write so that it takes a constant
amount of space and a reasonable amount of time?</p>
<p>Here's a picture of what a list with a loop looks like:</p>
<p><img alt="alt text" src="images/irw1S.jpg"></p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can make use of <strong>Floyd's cycle-finding algorithm</strong> , also known as
<em>tortoise and hare algorithm</em>.  </p>
<p>The idea is to have two references to the list and move them at <strong>different
speeds</strong>. Move one forward by <code>1</code> node and the other by <code>2</code> nodes.</p>
<ul>
<li>If the linked list has a loop they will <em>definitely</em> meet.</li>
<li>Else either of the two references(or their <code>next</code>) will become <code>null</code>.</li>
</ul>
<p>Java function implementing the algorithm:</p>
<div class="code"><pre class="code literal-block"><span class="nv">boolean</span><span class="w"> </span><span class="nv">hasLoop</span><span class="ss">(</span><span class="nv">Node</span><span class="w"> </span><span class="nv">first</span><span class="ss">)</span><span class="w"> </span>{

<span class="w">    </span><span class="k">if</span><span class="ss">(</span><span class="nv">first</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="nv">does</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">exist</span>..<span class="nv">so</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="nv">either</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">false</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">Node</span><span class="w"> </span><span class="nv">slow</span>,<span class="w"> </span><span class="nv">fast</span><span class="c1">; // create two references.</span>

<span class="w">    </span><span class="nv">slow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">fast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">first</span><span class="c1">; // make both refer to the start of the list</span>

<span class="w">    </span><span class="k">while</span><span class="ss">(</span><span class="nv">true</span><span class="ss">)</span><span class="w"> </span>{

<span class="w">        </span><span class="nv">slow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">slow</span>.<span class="k">next</span><span class="c1">;          // 1 hop</span>

<span class="w">        </span><span class="k">if</span><span class="ss">(</span><span class="nv">fast</span>.<span class="k">next</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span>
<span class="w">            </span><span class="nv">fast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">fast</span>.<span class="k">next</span>.<span class="k">next</span><span class="c1">; // 2 hops</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">false</span><span class="c1">;          // next node null =&gt; no loop</span>

<span class="w">        </span><span class="k">if</span><span class="ss">(</span><span class="nv">slow</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">fast</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">either</span><span class="w"> </span><span class="nv">hits</span><span class="w"> </span><span class="nv">null</span>..<span class="nv">no</span><span class="w"> </span><span class="k">loop</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">false</span><span class="c1">;</span>

<span class="w">        </span><span class="k">if</span><span class="ss">(</span><span class="nv">slow</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">fast</span><span class="ss">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">two</span><span class="w"> </span><span class="nv">ever</span><span class="w"> </span><span class="nv">meet</span>...<span class="nv">we</span><span class="w"> </span><span class="nv">must</span><span class="w"> </span><span class="nv">have</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="k">loop</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">true</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Here's a refinement of the Fast/Slow solution, which correctly handles odd
length lists and improves clarity.</p>
<div class="code"><pre class="code literal-block"><span class="nv">boolean</span><span class="w"> </span><span class="nv">hasLoop</span><span class="ss">(</span><span class="nv">Node</span><span class="w"> </span><span class="nv">first</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">Node</span><span class="w"> </span><span class="nv">slow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">first</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">Node</span><span class="w"> </span><span class="nv">fast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">first</span><span class="c1">;</span>

<span class="w">    </span><span class="k">while</span><span class="ss">(</span><span class="nv">fast</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">fast</span>.<span class="k">next</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">slow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">slow</span>.<span class="k">next</span><span class="c1">;          // 1 hop</span>
<span class="w">        </span><span class="nv">fast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">fast</span>.<span class="k">next</span>.<span class="k">next</span><span class="c1">;     // 2 hops</span>

<span class="w">        </span><span class="k">if</span><span class="ss">(</span><span class="nv">slow</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">fast</span><span class="ss">)</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nv">fast</span><span class="w"> </span><span class="nv">caught</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">slow</span>,<span class="w"> </span><span class="nv">so</span><span class="w"> </span><span class="nv">there</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="k">loop</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">true</span><span class="c1">;</span>
<span class="w">    </span>}
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">false</span><span class="c1">;  // fast reached null, so the list terminates</span>
}
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1774.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1772.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
