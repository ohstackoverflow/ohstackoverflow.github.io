<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1253) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1253.html">
<link rel="prev" href="index-1254.html" type="text/html">
<link rel="next" href="index-1252.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/wei-shi-yao-xuan-ze-jie-gou-er-bu-shi-lei/" class="u-url">为什么选择结构而不是类？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/wei-shi-yao-xuan-ze-jie-gou-er-bu-shi-lei/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T05:10:31+08:00" itemprop="datePublished" title="2023-02-18 05:10">2023-02-18 05:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>玩过 Swift，来自 Java 背景，为什么要选择 Struct 而不是 Class？看起来它们是同一回事，Struct
提供的功能较少。那为什么选择它呢？</p>
<p><br><br></p>
<h2>解答</h2>
<p>根据非常受欢迎的 WWDC 2015 谈话在 Swift 中面向协议的编程（视频、文字记录），Swift 提供了许多使结构在许多情况下优于类的特性。</p>
<p>如果结构相对较小且可复制，那么结构是更可取的，因为复制比对同一个实例的多个引用更安全，就像类一样。当将变量传递给多个类和/或在多线程环境中时，这一点尤为重要。如果您始终可以将变量的副本发送到其他地方，您就永远不必担心其他地方会更改您下面的变量值。</p>
<p>使用
Structs，无需担心内存泄漏或多个线程竞相访问/修改变量的单个实例。（对于更具技术头脑的人来说，例外情况是在闭包内捕获结构时，因为除非您明确将其标记为要复制，否则它实际上是在捕获对该实例的引用）。</p>
<p>类也可能变得臃肿，因为一个类只能从一个超类继承。这鼓励我们创建庞大的超类，其中包含许多仅松散相关的不同能力。使用协议，尤其是协议扩展，您可以在协议扩展中为协议提供实现，这样您就不需要类来实现这种行为。</p>
<p>演讲列出了首选课程的这些场景：</p>
<blockquote>
<ul>
<li>复制或比较实例没有意义（例如，Window）</li>
<li>实例生命周期与外部效果相关（例如，TemporaryFile）</li>
<li>实例只是“接收器”——到外部状态的只写管道（egCGContext）
</li>
</ul>
</blockquote>
<p>这意味着结构应该是默认的，类应该是后备的。</p>
<p>另一方面，The Swift Programming Language文档有些矛盾：</p>
<blockquote>
<p>结构实例总是按值传递，而类实例总是按引用传递。这意味着它们适用于不同类型的任务。当您考虑项目所需的数据结构和功能时，请决定是将每个数据结构定义为一个类还是一个结构。</p>
<p>作为一般准则，请考虑在以下一个或多个条件适用时创建结构：</p>
<ul>
<li>该结构的主要目的是封装一些相对简单的数据值。</li>
<li>当您分配或传递该结构的实例时，期望封装的值将被复制而不是被引用是合理的。</li>
<li>结构存储的任何属性本身都是值类型，它们也应该被复制而不是被引用。</li>
<li>该结构不需要从另一个现有类型继承属性或行为。
</li>
</ul>
<p>结构的良好候选示例包括：</p>
<ul>
<li>几何形状的大小，可能封装宽度属性和高度属性，两者都是 Double 类型。</li>
<li>一种引用系列中范围的方法，可能封装一个 start 属性和一个 length 属性，两者都是 Int 类型。</li>
<li>3D 坐标系中的一个点，可能封装了 x、y 和 z 属性，每个属性都是 Double 类型。
</li>
</ul>
<p>在所有其他情况下，定义一个类，并创建该类的实例以通过引用进行管理和传递。实际上，这意味着大多数自定义数据构造应该是类，而不是结构。</p>
</blockquote>
<p>这里它声称我们应该默认使用类并仅在特定情况下使用结构。最终，您需要了解值类型与引用类型在现实世界中的含义，然后您才能就何时使用结构或类做出明智的决定。此外，请记住，这些概念总是在不断发展，并且
Swift 编程语言文档是在面向协议的编程演讲进行之前编写的。</p>
<p><br></p>
<h3>更多建议</h3>
<p>这个答案最初是关于结构和类之间的性能差异。不幸的是，围绕我用于测量的方法存在太多争议。我把它留在下面了，但请不要读太多。我认为经过这么多年，Swift
社区已经很清楚结构（以及枚举）由于其简单性和安全性而始终是首选。</p>
<p>如果性能对您的应用很重要，请自行衡量。我仍然认为大多数时候 struct 性能更好，但最好的答案就像评论中有人说的那样：这取决于。</p>
<p>=== <strong>旧答案</strong> ===</p>
<p>由于结构实例是在堆栈上分配的，而类实例是在堆上分配的，因此结构有时会快得多。</p>
<p><strong>但是，您应该始终自己衡量并根据您的独特用例做出决定。</strong></p>
<p>考虑以下示例，它演示了<code>Int</code>使用<code>struct</code>和包装数据类型的 2 种策略<code>class</code>。我使用 10
个重复值是为了更好地反映现实世界，那里有多个字段。</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">Int10Class</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">value1</span><span class="p">,</span><span class="w"> </span><span class="n">value2</span><span class="p">,</span><span class="w"> </span><span class="n">value3</span><span class="p">,</span><span class="w"> </span><span class="n">value4</span><span class="p">,</span><span class="w"> </span><span class="n">value5</span><span class="p">,</span><span class="w"> </span><span class="n">value6</span><span class="p">,</span><span class="w"> </span><span class="n">value7</span><span class="p">,</span><span class="w"> </span><span class="n">value8</span><span class="p">,</span><span class="w"> </span><span class="n">value9</span><span class="p">,</span><span class="w"> </span><span class="n">value10</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span>
<span class="w">    </span><span class="n">init</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="n">val</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">struct</span><span class="w"> </span><span class="n">Int10Struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">value1</span><span class="p">,</span><span class="w"> </span><span class="n">value2</span><span class="p">,</span><span class="w"> </span><span class="n">value3</span><span class="p">,</span><span class="w"> </span><span class="n">value4</span><span class="p">,</span><span class="w"> </span><span class="n">value5</span><span class="p">,</span><span class="w"> </span><span class="n">value6</span><span class="p">,</span><span class="w"> </span><span class="n">value7</span><span class="p">,</span><span class="w"> </span><span class="n">value8</span><span class="p">,</span><span class="w"> </span><span class="n">value9</span><span class="p">,</span><span class="w"> </span><span class="n">value10</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span>
<span class="w">    </span><span class="n">init</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="n">val</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">value10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="n">Int10Class</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="n">Int10Class</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Int10Class</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">IntClass</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="n">Int10Struct</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="n">Int10Struct</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Int10Struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">IntStruct</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

<p>性能是使用</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">Measure</span><span class="w"> </span><span class="n">Int10Class</span>
<span class="n">measure</span><span class="p">(</span><span class="s2">"class (10 fields)"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Int10Class</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mf">1.</span><span class="o">..</span><span class="mi">10000000</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Int10Class</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">Measure</span><span class="w"> </span><span class="n">Int10Struct</span>
<span class="n">measure</span><span class="p">(</span><span class="s2">"struct (10 fields)"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Int10Struct</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mf">1.</span><span class="o">..</span><span class="mi">10000000</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Int10Struct</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span><span class="w"> </span><span class="n">measure</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="p">,</span><span class="w"> </span><span class="err">@</span><span class="n">noescape</span><span class="w"> </span><span class="n">block</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CACurrentMediaTime</span><span class="p">()</span>

<span class="w">    </span><span class="n">block</span><span class="p">()</span>

<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CACurrentMediaTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t0</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">"\(name) -&gt; \(dt)"</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

<p>代码可以在https://github.com/knguyen2708/StructVsClassPerformance找到</p>
<p><strong>更新（2018 年 3 月 27 日）</strong> ：</p>
<p>从 Swift 4.0、Xcode 9.2 开始，在 iPhone 6S、iOS 11.2.6 上运行发布版本，Swift 编译器设置为<code>-O
-whole-module-optimization</code>：</p>
<ul>
<li>
<code>class</code>版本耗时 2.06 秒</li>
<li>
<code>struct</code>版本耗时 4.17e-08 秒（快 50,000,000 倍）</li>
</ul>
<p>（我不再平均多次运行，因为方差非常小，低于 5%）</p>
<p><strong>注意</strong> ：如果没有整个模块优化，差异就不那么显着了。如果有人能指出旗帜的实际作用，我会很高兴。</p>
<hr>
<p><strong>更新（2016 年 5 月 7 日）</strong> ：</p>
<p>从 Swift 2.2.1、Xcode 7.3 开始，在 iPhone 6S、iOS 9.3.1 上运行 Release build，平均运行 5
次以上，Swift 编译器设置为<code>-O -whole-module-optimization</code>：</p>
<ul>
<li>
<code>class</code>版本耗时 2.159942142s</li>
<li>
<code>struct</code>版本耗时 5.83E-08s（快 37,000,000 倍）</li>
</ul>
<p><strong>注意</strong> ：正如有人提到的那样，在现实世界的场景中，结构中可能会有超过 1 个字段，我已经为结构/类添加了 10 个字段而不是 1
个字段的测试。令人惊讶的是，结果变化不大。</p>
<hr>
<p><strong>原始结果</strong> （2014 年 6 月 1 日）：</p>
<p>（在具有 1 个字段的结构/类上运行，而不是 10 个）</p>
<p>从 Swift 1.2、Xcode 6.3.2 开始，在 iPhone 5S、iOS 8.3 上运行 Release build，平均运行 5 次以上</p>
<ul>
<li>
<code>class</code>版本耗时 9.788332333s</li>
<li>
<code>struct</code>版本耗时 0.010532942s（快 900 倍）</li>
</ul>
<hr>
<p><strong>旧结果</strong> （未知时间）</p>
<p>（在具有 1 个字段的结构/类上运行，而不是 10 个）</p>
<p>在我的 MacBook Pro 上发布版本：</p>
<ul>
<li>该<code>class</code>版本耗时 1.10082 秒</li>
<li>该<code>struct</code>版本耗时 0.02324 秒（快 50 倍）</li>
</ul>
<p><br><br><a href="posts/why-choose-struct-over-class/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/map-name-zai-ruby-zhong-shi-shi-yao-yi-si/" class="u-url">map(&amp;:name) 在 Ruby 中是什么意思？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/map-name-zai-ruby-zhong-shi-shi-yao-yi-si/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T05:10:03+08:00" itemprop="datePublished" title="2023-02-18 05:10">2023-02-18 05:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我在RailsCast中找到了这段代码：</p>
<div class="code"><pre class="code literal-block"><span class="n">def</span><span class="w"> </span><span class="n">tag_names</span>
<span class="w">  </span><span class="nv">@tag_names</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">tags</span><span class="p">.</span><span class="k">map</span><span class="p">(</span><span class="o">&amp;</span><span class="err">:</span><span class="n">name</span><span class="p">).</span><span class="k">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>是什么<code>(&amp;:name)</code>意思<code>map(&amp;:name)</code>？</p>
<p><br><br></p>
<h2>解答</h2>
<p>这是简写<code>tags.map(&amp;:name.to_proc).join(' ')</code></p>
<p>如果<code>foo</code>是一个带有方法的对象<code>to_proc</code>，那么你可以将它传递给一个方法作为<code>&amp;foo</code>，它将调用<code>foo.to_proc</code>并使用它作为方法的块。</p>
<p>该<code>Symbol#to_proc</code>方法最初由 ActiveSupport 添加，但已集成到 Ruby 1.8.7 中。这是它的实现：</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Symbol</span>
  <span class="n">def</span> <span class="n">to_proc</span>
    <span class="nb">Proc</span>.<span class="nb">new</span> <span class="nb">do</span> |<span class="n">obj</span>, *<span class="nb">args</span>|
      <span class="n">obj</span>.<span class="nb">send</span> <span class="nb">self</span>, *<span class="nb">args</span>
    <span class="nb">end</span>
  <span class="nb">end</span>
<span class="nb">end</span>
</pre></div>

<p><br></p>
<h3>更多建议</h3>
<p>另一个很酷的速记，很多人都不知道，是</p>
<div class="code"><pre class="code literal-block">array.each(&amp;method(:foo))
</pre></div>

<p>这是简写</p>
<div class="code"><pre class="code literal-block">array.each { |element| foo(element) }
</pre></div>

<p>通过调用，<code>method(:foo)</code>我们从中获取了一个代表其方法的<code>Method</code>对象，并使用
来表示它具有将其转换为.<code>self``foo``&amp;``to_proc</code> <code>Proc</code></p>
<p>当您想 <em>以无点</em> 样式做事时，这非常有用。一个例子是检查数组中是否有任何字符串等于 string <code>"foo"</code>。有常规的方法：</p>
<div class="code"><pre class="code literal-block">["bar", "baz", "foo"].any? { |str| str == "foo" }
</pre></div>

<p>还有一种无点方式：</p>
<div class="code"><pre class="code literal-block"><span class="p">[</span><span class="s">"bar"</span><span class="p">,</span><span class="w"> </span><span class="s">"baz"</span><span class="p">,</span><span class="w"> </span><span class="s">"foo"</span><span class="p">]</span><span class="o">.</span><span class="nv">any</span>?<span class="p">(</span>&amp;<span class="s">"foo"</span><span class="o">.</span><span class="nf">method</span><span class="p">(</span><span class="o">:==</span><span class="p">))</span>
</pre></div>

<p>首选方式应该是最具可读性的方式。</p>
<p><br><br><a href="posts/what-does-map-name-mean-in-ruby/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/duo-ge-docker-compose-xiang-mu-zhi-jian-de-tong-xin/" class="u-url">多个 docker-compose 项目之间的通信</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/duo-ge-docker-compose-xiang-mu-zhi-jian-de-tong-xin/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T05:09:36+08:00" itemprop="datePublished" title="2023-02-18 05:09">2023-02-18 05:09</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我<code>docker-compose.yml</code>在两个不同的文件夹中有两个单独的文件：</p>
<ul>
<li><code>~/front/docker-compose.yml</code></li>
<li><code>~/api/docker-compose.yml</code></li>
</ul>
<p>如何确保 in 中的容器<code>front</code>可以向 in 中的容器发送请求<code>api</code>？</p>
<p>我知道<code>--default-gateway</code>可以为单个容器设置该选项<code>docker run</code>，以便可以将特定的 IP
地址分配给该容器，但似乎该选项在使用时不可用<code>docker-compose</code>。</p>
<p>目前我最终做了一个<code>docker inspect my_api_container_id</code>并查看输出中的网关。它有效，但问题是这个 IP
是随机分配的，所以我不能依赖它。</p>
<p>因此，这个问题的另一种形式可能是：</p>
<ul>
<li>我可以使用 docker-compose 将固定 IP 地址分配给特定容器吗？</li>
</ul>
<p>但最后我要照顾的是：</p>
<ul>
<li>两个不同的 docker-compose 项目如何相互通信？</li>
</ul>
<p><br><br></p>
<h2>解答</h2>
<p>你只需要确保你想要互相交谈的容器在同一个网络上。网络是一流的 docker 结构，并不特定于 compose。</p>
<div class="code"><pre class="code literal-block"># front/docker-compose.yml
version: '2'
services:
  front:
    ...
    networks:
      - some-net
networks:
  some-net:
    driver: bridge
</pre></div>

<p>...</p>
<div class="code"><pre class="code literal-block"># api/docker-compose.yml
version: '2'
services:
  api:
    ...
    networks:
      - front_some-net
networks:
  front_some-net:
    external: true
</pre></div>

<blockquote>
<p>注意：您的应用程序网络的名称基于“项目名称”，该名称基于它所在目录的名称，在本例中<code>front_</code>添加了前缀</p>
</blockquote>
<p>然后他们可以使用服务名称相互交谈。从<code>front</code>你可以做到<code>ping api</code>，反之亦然。</p>
<p><br></p>
<h3>更多建议</h3>
<p>更新：从撰写文件版本 3.5 开始：</p>
<p>这现在有效：</p>
<div class="code"><pre class="code literal-block">version: "3.5"
services:
  proxy:
    image: hello-world
    ports:
      - "80:80"
    networks:
      - proxynet

networks:
  proxynet:
    name: custom_network
</pre></div>

<p><code>docker-compose up -d</code>将加入名为“custom_network”的网络。如果它不存在，它将被创建！</p>
<div class="code"><pre class="code literal-block"><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="n">vcpu</span><span class="o">-</span><span class="mi">1</span><span class="n">gb</span><span class="o">-</span><span class="n">tor1</span><span class="o">-</span><span class="mi">01</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="o">-</span><span class="n">d</span>
<span class="n">Creating</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="ss">"custom_network"</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">driver</span>
<span class="n">Creating</span><span class="w"> </span><span class="n">root_proxy_1</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="n">done</span>
</pre></div>

<p>现在，您可以这样做：</p>
<div class="code"><pre class="code literal-block">version: "2"
services:
  web:
    image: hello-world
    networks:
      - my-proxy-net
networks:
  my-proxy-net:
    external:
      name: custom_network
</pre></div>

<p>这将创建一个位于外部网络上的容器。</p>
<p>我在文档中找不到任何参考，但它有效！</p>
<p><br><br><a href="posts/communication-between-multiple-docker-compose-projects/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1254.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1252.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
