<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 258) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-258.html">
<link rel="prev" href="index-259.html" type="text/html">
<link rel="next" href="index-257.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/virtual-member-call-in-a-constructor/" class="u-url">Virtual member call in a constructor</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/virtual-member-call-in-a-constructor/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T02:17:44+08:00" itemprop="datePublished" title="2023-02-17 02:17">2023-02-17 02:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm getting a warning from ReSharper about a call to a virtual member from my
objects constructor.</p>
<p>Why would this be something not to do?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>When an object written in C# is constructed, what happens is that the
initializers run in order from the most derived class to the base class, and
then constructors run in order from the base class to the most derived class
(see Eric Lippert's blog for details as to why this is).</p>
<p>Also in .NET objects do not change type as they are constructed, but start out
as the most derived type, with the method table being for the most derived
type. This means that virtual method calls always run on the most derived
type.</p>
<p>When you combine these two facts you are left with the problem that if you
make a virtual method call in a constructor, and it is not the most derived
type in its inheritance hierarchy, that it will be called on a class whose
constructor has not been run, and therefore may not be in a suitable state to
have that method called.</p>
<p>This problem is, of course, mitigated if you mark your class as sealed to
ensure that it is the most derived type in the inheritance hierarchy - in
which case it is perfectly safe to call the virtual method.</p>
<p><br></p>
<h3>Suggest</h3>
<p>In order to answer your question, consider this question: what will the below
code print out when the <code>Child</code> object is instantiated?</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Parent</span>
{
    <span class="n">public</span> <span class="n">Parent</span>()
    {
        <span class="n">DoSomething</span>();
    }

    <span class="n">protected</span> <span class="n">virtual</span> <span class="n">void</span> <span class="n">DoSomething</span>() 
    {
    }
}

<span class="k">class</span> <span class="n">Child</span> : <span class="n">Parent</span>
{
    <span class="nb">private</span> <span class="n">string</span> <span class="n">foo</span>;

    <span class="n">public</span> <span class="n">Child</span>() 
    { 
        <span class="n">foo</span> = <span class="s">"HELLO"</span>; 
    }

    <span class="n">protected</span> <span class="n">override</span> <span class="n">void</span> <span class="n">DoSomething</span>()
    {
        <span class="n">Console</span>.<span class="n">WriteLine</span>(<span class="n">foo</span>.<span class="n">ToLower</span>()); //<span class="n">NullReferenceException</span>!?!
    }
}
</pre></div>

<p>The answer is that in fact a <code>NullReferenceException</code> will be thrown, because
<code>foo</code> is null. <strong>An object's base constructor is called before its own
constructor</strong>. By having a <code>virtual</code> call in an object's constructor you are
introducing the possibility that inheriting objects will execute code before
they have been fully initialized.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/can-i-concatenate-multiple-mysql-rows-into-one-field/" class="u-url">Can I concatenate multiple MySQL rows into one field?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/can-i-concatenate-multiple-mysql-rows-into-one-field/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T02:17:01+08:00" itemprop="datePublished" title="2023-02-17 02:17">2023-02-17 02:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Using <code>MySQL</code>, I can do something like:</p>
<div class="code"><pre class="code literal-block">SELECT hobbies FROM peoples_hobbies WHERE person_id = 5;
</pre></div>

<p><strong>My Output:</strong></p>
<div class="code"><pre class="code literal-block">shopping
fishing
coding
</pre></div>

<p>but instead I just want 1 row, 1 col:</p>
<p><strong>Expected Output:</strong></p>
<div class="code"><pre class="code literal-block">shopping, fishing, coding
</pre></div>

<p>The reason is that I'm selecting multiple values from multiple tables, and
after all the joins I've got a lot more rows than I'd like.</p>
<p>I've looked for a function on MySQL Doc and it doesn't look like the <code>CONCAT</code>
or <code>CONCAT_WS</code> functions accept result sets.</p>
<p>So does anyone here know how to do this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can use <code>GROUP_CONCAT</code>:</p>
<div class="code"><pre class="code literal-block">SELECT person_id,
   GROUP_CONCAT(hobbies SEPARATOR ', ')
FROM peoples_hobbies
GROUP BY person_id;
</pre></div>

<p>As Ludwig stated in his comment, you can add the <code>DISTINCT</code> operator to avoid
duplicates:</p>
<div class="code"><pre class="code literal-block">SELECT person_id,
   GROUP_CONCAT(DISTINCT hobbies SEPARATOR ', ')
FROM peoples_hobbies
GROUP BY person_id;
</pre></div>

<p>As Jan stated in their comment, you can also sort the values before imploding
it using <code>ORDER BY</code>:</p>
<div class="code"><pre class="code literal-block">SELECT person_id, 
       GROUP_CONCAT(hobbies ORDER BY hobbies ASC SEPARATOR ', ')
FROM peoples_hobbies
GROUP BY person_id;
</pre></div>

<p>As Dag stated in his comment, there is a 1024 byte limit on the result. To
solve this, run this query before your query:</p>
<div class="code"><pre class="code literal-block">SET group_concat_max_len = 2048;
</pre></div>

<p>Of course, you can change <code>2048</code> according to your needs. To calculate and
assign the value:</p>
<div class="code"><pre class="code literal-block">SET group_concat_max_len = CAST(
                     (SELECT SUM(LENGTH(hobbies)) + COUNT(*) * LENGTH(', ')
                           FROM peoples_hobbies
                           GROUP BY person_id) AS UNSIGNED);
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Have a look at <code>GROUP_CONCAT</code> if your MySQL version (4.1) supports it. See the
documentation for more details.</p>
<p>It would look something like:</p>
<div class="code"><pre class="code literal-block">  SELECT GROUP_CONCAT(hobbies SEPARATOR ', ') 
  FROM peoples_hobbies 
  WHERE person_id = 5 
  GROUP BY 'all';
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-find-the-sum-of-an-array-of-numbers/" class="u-url">How to find the sum of an array of numbers</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-find-the-sum-of-an-array-of-numbers/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T02:16:31+08:00" itemprop="datePublished" title="2023-02-17 02:16">2023-02-17 02:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Given an array <code>[1, 2, 3, 4]</code>, how can I find the sum of its elements? (In
this case, the sum would be <code>10</code>.)</p>
<p>I thought <code>$.each</code> might be useful, but I'm not sure how to implement it.</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>Recommended (reduce with default value)</h3>
<p>Array.prototype.reduce can be used to iterate through the array, adding the
current element value to the sum of the previous element values.</p>
<div class="code"><pre class="code literal-block">console.log(
  [1, 2, 3, 4].reduce((a, b) =&gt; a + b, 0)
)
console.log(
  [].reduce((a, b) =&gt; a + b, 0)
)
</pre></div>

<h3>Without default value</h3>
<p>You get a TypeError</p>
<div class="code"><pre class="code literal-block">console.log(
  [].reduce((a, b) =&gt; a + b)
)
</pre></div>

<h3>Prior to ES6's arrow functions</h3>
<div class="code"><pre class="code literal-block"><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span>
<span class="w">  </span>[<span class="mi">1</span>,<span class="mi">2</span>,<span class="mi">3</span>].<span class="nv">reduce</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nv">acc</span>,<span class="w"> </span><span class="nv">val</span><span class="ss">)</span><span class="w"> </span>{<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">val</span><span class="c1">; }, 0)</span>
<span class="ss">)</span>

<span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span>
<span class="w">  </span>[].<span class="nv">reduce</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nv">acc</span>,<span class="w"> </span><span class="nv">val</span><span class="ss">)</span><span class="w"> </span>{<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">val</span><span class="c1">; }, 0)</span>
<span class="ss">)</span>
</pre></div>

<h3>Non-number inputs</h3>
<p>If non-numbers are possible inputs, you may want to handle that?</p>
<div class="code"><pre class="code literal-block">console.log(
  ["hi", 1, 2, "frog"].reduce((a, b) =&gt; a + b)
)

let numOr0 = n =&gt; isNaN(n) ? 0 : n

console.log(
  ["hi", 1, 2, "frog"].reduce((a, b) =&gt; 
    numOr0(a) + numOr0(b))
)
</pre></div>

<h3>Non-recommended <em>dangerous</em> eval use</h3>
<p>We can use eval to execute a string representation of JavaScript code. Using
the Array.prototype.join function to convert the array to a string, we change
[1,2,3] into "1+2+3", which evaluates to 6.</p>
<div class="code"><pre class="code literal-block"><span class="nt">console</span><span class="p">.</span><span class="nc">log</span><span class="o">(</span>
<span class="w">  </span><span class="nt">eval</span><span class="o">(</span><span class="cp">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="cp">]</span><span class="p">.</span><span class="nc">join</span><span class="o">(</span><span class="s1">'+'</span><span class="o">))</span>
<span class="o">)</span>

<span class="o">//</span><span class="nt">This</span><span class="w"> </span><span class="nt">way</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">dangerous</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">array</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">built</span>
<span class="o">//</span><span class="w"> </span><span class="nt">from</span><span class="w"> </span><span class="nt">user</span><span class="w"> </span><span class="nt">input</span><span class="w"> </span><span class="nt">as</span><span class="w"> </span><span class="nt">it</span><span class="w"> </span><span class="nt">may</span><span class="w"> </span><span class="nt">be</span><span class="w"> </span><span class="nt">exploited</span><span class="w"> </span><span class="nt">eg</span><span class="o">:</span>

<span class="nt">eval</span><span class="o">(</span><span class="cp">[</span><span class="mi">1</span><span class="p">,</span><span class="s2">"2;alert('Malicious code!')"</span><span class="cp">]</span><span class="p">.</span><span class="nc">join</span><span class="o">(</span><span class="s1">'+'</span><span class="o">))</span>
</pre></div>

<p>Of course displaying an alert isn't the worst thing that could happen. The
only reason I have included this is as an answer Ortund's question as I do not
think it was clarified.</p>
<p><br></p>
<h3>Suggest</h3>
<h3>Recommended (reduce with default value)</h3>
<p>Array.prototype.reduce can be used to iterate through the array, adding the
current element value to the sum of the previous element values.</p>
<div class="code"><pre class="code literal-block">console.log(
  [1, 2, 3, 4].reduce((a, b) =&gt; a + b, 0)
)
console.log(
  [].reduce((a, b) =&gt; a + b, 0)
)
</pre></div>

<h3>Without default value</h3>
<p>You get a TypeError</p>
<div class="code"><pre class="code literal-block">console.log(
  [].reduce((a, b) =&gt; a + b)
)
</pre></div>

<h3>Prior to ES6's arrow functions</h3>
<div class="code"><pre class="code literal-block"><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span>
<span class="w">  </span>[<span class="mi">1</span>,<span class="mi">2</span>,<span class="mi">3</span>].<span class="nv">reduce</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nv">acc</span>,<span class="w"> </span><span class="nv">val</span><span class="ss">)</span><span class="w"> </span>{<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">val</span><span class="c1">; }, 0)</span>
<span class="ss">)</span>

<span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span>
<span class="w">  </span>[].<span class="nv">reduce</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nv">acc</span>,<span class="w"> </span><span class="nv">val</span><span class="ss">)</span><span class="w"> </span>{<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">acc</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">val</span><span class="c1">; }, 0)</span>
<span class="ss">)</span>
</pre></div>

<h3>Non-number inputs</h3>
<p>If non-numbers are possible inputs, you may want to handle that?</p>
<div class="code"><pre class="code literal-block">console.log(
  ["hi", 1, 2, "frog"].reduce((a, b) =&gt; a + b)
)

let numOr0 = n =&gt; isNaN(n) ? 0 : n

console.log(
  ["hi", 1, 2, "frog"].reduce((a, b) =&gt; 
    numOr0(a) + numOr0(b))
)
</pre></div>

<h3>Non-recommended <em>dangerous</em> eval use</h3>
<p>We can use eval to execute a string representation of JavaScript code. Using
the Array.prototype.join function to convert the array to a string, we change
[1,2,3] into "1+2+3", which evaluates to 6.</p>
<div class="code"><pre class="code literal-block"><span class="nt">console</span><span class="p">.</span><span class="nc">log</span><span class="o">(</span>
<span class="w">  </span><span class="nt">eval</span><span class="o">(</span><span class="cp">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="cp">]</span><span class="p">.</span><span class="nc">join</span><span class="o">(</span><span class="s1">'+'</span><span class="o">))</span>
<span class="o">)</span>

<span class="o">//</span><span class="nt">This</span><span class="w"> </span><span class="nt">way</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">dangerous</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">array</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">built</span>
<span class="o">//</span><span class="w"> </span><span class="nt">from</span><span class="w"> </span><span class="nt">user</span><span class="w"> </span><span class="nt">input</span><span class="w"> </span><span class="nt">as</span><span class="w"> </span><span class="nt">it</span><span class="w"> </span><span class="nt">may</span><span class="w"> </span><span class="nt">be</span><span class="w"> </span><span class="nt">exploited</span><span class="w"> </span><span class="nt">eg</span><span class="o">:</span>

<span class="nt">eval</span><span class="o">(</span><span class="cp">[</span><span class="mi">1</span><span class="p">,</span><span class="s2">"2;alert('Malicious code!')"</span><span class="cp">]</span><span class="p">.</span><span class="nc">join</span><span class="o">(</span><span class="s1">'+'</span><span class="o">))</span>
</pre></div>

<p>Of course displaying an alert isn't the worst thing that could happen. The
only reason I have included this is as an answer Ortund's question as I do not
think it was clarified.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-259.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-257.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
