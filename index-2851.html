<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2851) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2851.html">
<link rel="prev" href="index-2852.html" type="text/html">
<link rel="next" href="index-2850.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/exception-messages-in-english/" class="u-url">Exception messages in English?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/exception-messages-in-english/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T22:42:53+08:00" itemprop="datePublished" title="2023-03-05 22:42">2023-03-05 22:42</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>We are logging any exceptions that happen in our system by writing the
Exception.Message to a file. However, they are written in the culture of the
client. And Turkish errors don't mean a lot to me.</p>
<p>So how can we log any error messages in English without changing the users
culture?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This issue can be partially worked around. The Framework exception code loads
the error messages from its resources, based on the current thread locale. In
the case of some exceptions, this happens at the time the Message property is
accessed.</p>
<p>For those exceptions, you can obtain the full US English version of the
message by briefly switching the thread locale to en-US while logging it
(saving the original user locale beforehand and restoring it immediately
afterwards).</p>
<p>Doing this on a separate thread is even better: this ensures there won't be
any side effects. For example:</p>
<div class="code"><pre class="code literal-block"><span class="n">try</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">StreamReader</span><span class="w"> </span><span class="n">sr</span><span class="o">=</span><span class="n">new</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">StreamReader</span><span class="p">(</span><span class="s">@"c:\does-not-exist"</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">catch</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span><span class="w"> </span><span class="c1">//Will display localized message</span>
<span class="w">  </span><span class="n">ExceptionLogger</span><span class="w"> </span><span class="n">el</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ExceptionLogger</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span>
<span class="w">  </span><span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">el</span><span class="p">.</span><span class="n">DoLog</span><span class="p">);</span>
<span class="w">  </span><span class="n">t</span><span class="p">.</span><span class="n">CurrentUICulture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">CultureInfo</span><span class="p">(</span><span class="s">"en-US"</span><span class="p">);</span>
<span class="w">  </span><span class="n">t</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>Where the ExceptionLogger class looks something like:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">ExceptionLogger</span>
{
  <span class="nb">Exception</span> <span class="n">_ex</span>;

  <span class="n">public</span> <span class="n">ExceptionLogger</span>(<span class="nb">Exception</span> <span class="n">ex</span>)
  {
    <span class="n">_ex</span> = <span class="n">ex</span>;
  }

  <span class="n">public</span> <span class="n">void</span> <span class="n">DoLog</span>()
  {
    <span class="n">Console</span>.<span class="n">WriteLine</span>(<span class="n">_ex</span>.<span class="n">ToString</span>()); //<span class="n">Will</span> <span class="n">display</span> <span class="n">en-US</span> <span class="nb">message</span>
  }
}
</pre></div>

<p>However, as Joe correctly points out in a comment on an earlier revision of
this reply, some messages are already (partially) loaded from the language
resources at the time the exception is thrown.</p>
<p>This applies to the 'parameter cannot be null' part of the message generated
when an ArgumentNullException("foo") exception is thrown, for example. In
those cases, the message will still appear (partially) localized, even when
using the above code.</p>
<p>Other than by using impractical hacks, such as running all your non-UI code on
a thread with en-US locale to begin with, there doesn't seem to be much you
can do about that: the .NET Framework exception code has no facilities for
overriding the error message locale.</p>
<p><br></p>
<h3>Suggest</h3>
<p>A contentious point perhaps, but instead of setting the culture to <code>en-US</code>,
you can set it to <code>Invariant</code>. In the <code>Invariant</code> culture, the error messages
are in English.</p>
<div class="code"><pre class="code literal-block"><span class="n">Thread</span><span class="o">.</span><span class="n">CurrentThread</span><span class="o">.</span><span class="n">CurrentCulture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CultureInfo</span><span class="o">.</span><span class="n">InvariantCulture</span><span class="p">;</span>
<span class="n">Thread</span><span class="o">.</span><span class="n">CurrentThread</span><span class="o">.</span><span class="n">CurrentUICulture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CultureInfo</span><span class="o">.</span><span class="n">InvariantCulture</span><span class="p">;</span>
</pre></div>

<p>It has the advantage of not looking biased, especially for non-American
English speaking locales. (a.k.a. avoids snide remarks from colleagues)</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/can-you-overload-controller-methods-in-asp-net-mvc/" class="u-url">Can you overload controller methods in ASP.NET MVC?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/can-you-overload-controller-methods-in-asp-net-mvc/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T22:41:06+08:00" itemprop="datePublished" title="2023-03-05 22:41">2023-03-05 22:41</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm curious to see if you can overload controller methods in ASP.NET MVC.
Whenever I try, I get the error below. The two methods accept different
arguments. Is this something that cannot be done?</p>
<blockquote>
<p>The current request for action 'MyMethod' on controller type 'MyController'
is ambiguous between the following action methods:</p>
</blockquote>
<p><br><br></p>
<h2>Answer</h2>
<p>You can use the attribute if you want your code to do overloading.</p>
<div class="code"><pre class="code literal-block"><span class="p">[</span><span class="n">ActionName</span><span class="p">(</span><span class="s2">"MyOverloadedName"</span><span class="p">)]</span>
</pre></div>

<p>But, you'll have to use a different action name for the same http method (as
others have said). So it's just semantics at that point. Would you rather have
the name in your code or your attribute?</p>
<p>Phil has an article related to this:
http://haacked.com/archive/2008/08/29/how-a-method-becomes-an-action.aspx</p>
<p><br></p>
<h3>Suggest</h3>
<p>Yes. I've been able to do this by setting the <code>HttpGet</code>/<code>HttpPost</code> (or
equivalent <code>AcceptVerbs</code> attribute) for each controller method to something
distinct, i.e., <code>HttpGet</code> or <code>HttpPost</code>, but not both. That way it can tell
based on the type of request which method to use.</p>
<div class="code"><pre class="code literal-block"><span class="k">[HttpGet]</span>
<span class="na">public ActionResult Show()</span>
<span class="na">{</span>
<span class="w">   </span><span class="na">...</span>
<span class="na">}</span>

<span class="k">[HttpPost]</span>
<span class="na">public ActionResult Show( string userName )</span>
<span class="na">{</span>
<span class="w">   </span><span class="na">...</span>
<span class="na">}</span>
</pre></div>

<p>One suggestion I have is that, for a case like this, would be to have a
private implementation that both of your public Action methods rely on to
avoid duplicating code.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/copy-a-file-in-a-sane-safe-and-efficient-way/" class="u-url">Copy a file in a sane, safe and efficient way</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/copy-a-file-in-a-sane-safe-and-efficient-way/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T22:40:10+08:00" itemprop="datePublished" title="2023-03-05 22:40">2023-03-05 22:40</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I search for a good way to copy a file (binary or text). I've written several
samples, everyone works. But I want hear the opinion of seasoned programmers.</p>
<p>I missing good examples and search a way which works with C++.</p>
<p><strong>ANSI-C-WAY</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">iostream</span><span class="o">&gt;</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">cstdio</span><span class="o">&gt;</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">fopen</span><span class="p">,</span><span class="w"> </span><span class="n">fclose</span><span class="p">,</span><span class="w"> </span><span class="n">fread</span><span class="p">,</span><span class="w"> </span><span class="n">fwrite</span><span class="p">,</span><span class="w"> </span><span class="n">BUFSIZ</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">ctime</span><span class="o">&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="n">std</span><span class="p">;</span>

<span class="nc">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">clock_t</span><span class="w"> </span><span class="k">start</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>
<span class="w">    </span><span class="k">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">BUFSIZE</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="mi">8192</span><span class="w"> </span><span class="n">bytes</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">BUFSIZE</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">chareter</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="nc">time</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">good</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">blocksize</span><span class="p">,</span><span class="w"> </span><span class="ow">like</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">4096</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">higher</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="n">reduce</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">system</span><span class="w"> </span><span class="n">calls</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">size_t</span><span class="w"> </span><span class="n">BUFFER_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4096</span><span class="p">;</span>

<span class="w">    </span><span class="nc">char</span><span class="w"> </span><span class="n">buf</span><span class="o">[</span><span class="n">BUFSIZ</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="n">size_t</span><span class="w"> </span><span class="k">size</span><span class="p">;</span>

<span class="w">    </span><span class="k">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="ss">"from.ogv"</span><span class="p">,</span><span class="w"> </span><span class="ss">"rb"</span><span class="p">);</span>
<span class="w">    </span><span class="k">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fopen</span><span class="p">(</span><span class="ss">"to.ogv"</span><span class="p">,</span><span class="w"> </span><span class="ss">"wb"</span><span class="p">);</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">clean</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">secure</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">feof</span><span class="p">(</span><span class="k">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">stream</span><span class="p">)</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">zero</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="k">indicator</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">set</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="k">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fread</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">BUFSIZ</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="p">))</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">fwrite</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="p">,</span><span class="w"> </span><span class="n">dest</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="n">fclose</span><span class="p">(</span><span class="n">source</span><span class="p">);</span>
<span class="w">    </span><span class="n">fclose</span><span class="p">(</span><span class="n">dest</span><span class="p">);</span>

<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>

<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"CLOCKS_PER_SEC "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">CLOCKS_PER_SEC</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"\n"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"CPU-TIME START "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"\n"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"CPU-TIME END "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"\n"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"CPU-TIME END - START "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"\n"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"TIME(SEC) "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">static_cast</span><span class="o">&lt;</span><span class="k">double</span><span class="o">&gt;</span><span class="p">(</span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">start</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CLOCKS_PER_SEC</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"\n"</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="err">}</span>
</pre></div>

<p><strong>POSIX-WAY</strong> (K&amp;R use this in "The C programming language", more low-level)</p>
<div class="code"><pre class="code literal-block"><span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">iostream</span><span class="o">&gt;</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">fcntl</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="k">open</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">unistd</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="k">read</span><span class="p">,</span><span class="w"> </span><span class="k">write</span><span class="p">,</span><span class="w"> </span><span class="k">close</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">cstdio</span><span class="o">&gt;</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">BUFSIZ</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">ctime</span><span class="o">&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="n">std</span><span class="p">;</span>

<span class="nc">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">clock_t</span><span class="w"> </span><span class="k">start</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>
<span class="w">    </span><span class="k">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">BUFSIZE</span><span class="w"> </span><span class="n">defaults</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">8192</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">BUFSIZE</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">chareter</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="nc">time</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">good</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">blocksize</span><span class="p">,</span><span class="w"> </span><span class="ow">like</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">4096</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">higher</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="n">reduce</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">system</span><span class="w"> </span><span class="n">calls</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">size_t</span><span class="w"> </span><span class="n">BUFFER_SIZE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4096</span><span class="p">;</span>

<span class="w">    </span><span class="nc">char</span><span class="w"> </span><span class="n">buf</span><span class="o">[</span><span class="n">BUFSIZ</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="n">size_t</span><span class="w"> </span><span class="k">size</span><span class="p">;</span>

<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">open</span><span class="p">(</span><span class="ss">"from.ogv"</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDONLY</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">open</span><span class="p">(</span><span class="ss">"to.ogv"</span><span class="p">,</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_CREAT</span><span class="w"> </span><span class="cm">/*| O_TRUNC/**/, 0644);</span>

<span class="cm">    while ((size = read(source, buf, BUFSIZ)) &gt; 0) {</span>
<span class="cm">        write(dest, buf, size);</span>
<span class="cm">    }</span>

<span class="cm">    close(source);</span>
<span class="cm">    close(dest);</span>

<span class="cm">    end = clock();</span>

<span class="cm">    cout &lt;&lt; "CLOCKS_PER_SEC " &lt;&lt; CLOCKS_PER_SEC &lt;&lt; "\n";</span>
<span class="cm">    cout &lt;&lt; "CPU-TIME START " &lt;&lt; start &lt;&lt; "\n";</span>
<span class="cm">    cout &lt;&lt; "CPU-TIME END " &lt;&lt; end &lt;&lt; "\n";</span>
<span class="cm">    cout &lt;&lt; "CPU-TIME END - START " &lt;&lt; end - start &lt;&lt; "\n";</span>
<span class="cm">    cout &lt;&lt; "TIME(SEC) " &lt;&lt; static_cast&lt;double&gt;(end - start) / CLOCKS_PER_SEC &lt;&lt; "\n";</span>

<span class="cm">    return 0;</span>
<span class="cm">}</span>
</pre></div>

<p><strong>KISS-C++-Streambuffer-WAY</strong></p>
<div class="code"><pre class="code literal-block"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ctime&gt;</span>
<span class="n">using</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="kr">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">clock_t</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="nf">end</span><span class="p">;</span>
<span class="w">    </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>

<span class="w">    </span><span class="n">ifstream</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">"from.ogv"</span><span class="p">,</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
<span class="w">    </span><span class="n">ofstream</span><span class="w"> </span><span class="n">dest</span><span class="p">(</span><span class="s">"to.ogv"</span><span class="p">,</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>

<span class="w">    </span><span class="n">dest</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">();</span>

<span class="w">    </span><span class="n">source</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
<span class="w">    </span><span class="n">dest</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>

<span class="w">    </span><span class="nf">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>

<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"CLOCKS_PER_SEC "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">CLOCKS_PER_SEC</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"CPU-TIME START "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"CPU-TIME END "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="nf">end</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"CPU-TIME END - START "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w">  </span><span class="nf">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"TIME(SEC) "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="kr">static_cast</span><span class="o">&lt;</span><span class="kr">double</span><span class="o">&gt;</span><span class="p">(</span><span class="nf">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CLOCKS_PER_SEC</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><strong>COPY-ALGORITHM-C++-WAY</strong></p>
<div class="code"><pre class="code literal-block"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ctime&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iterator&gt;</span>
<span class="n">using</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="kr">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">clock_t</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="nf">end</span><span class="p">;</span>
<span class="w">    </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>

<span class="w">    </span><span class="n">ifstream</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s">"from.ogv"</span><span class="p">,</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
<span class="w">    </span><span class="n">ofstream</span><span class="w"> </span><span class="n">dest</span><span class="p">(</span><span class="s">"to.ogv"</span><span class="p">,</span><span class="w"> </span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>

<span class="w">    </span><span class="n">istreambuf_iterator</span><span class="o">&lt;</span><span class="kr">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">begin_source</span><span class="p">(</span><span class="n">source</span><span class="p">);</span>
<span class="w">    </span><span class="n">istreambuf_iterator</span><span class="o">&lt;</span><span class="kr">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">end_source</span><span class="p">;</span>
<span class="w">    </span><span class="n">ostreambuf_iterator</span><span class="o">&lt;</span><span class="kr">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">begin_dest</span><span class="p">(</span><span class="n">dest</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="n">copy</span><span class="p">(</span><span class="n">begin_source</span><span class="p">,</span><span class="w"> </span><span class="n">end_source</span><span class="p">,</span><span class="w"> </span><span class="n">begin_dest</span><span class="p">);</span>

<span class="w">    </span><span class="n">source</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
<span class="w">    </span><span class="n">dest</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>

<span class="w">    </span><span class="nf">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>

<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"CLOCKS_PER_SEC "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">CLOCKS_PER_SEC</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"CPU-TIME START "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"CPU-TIME END "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="nf">end</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"CPU-TIME END - START "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w">  </span><span class="nf">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"TIME(SEC) "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="kr">static_cast</span><span class="o">&lt;</span><span class="kr">double</span><span class="o">&gt;</span><span class="p">(</span><span class="nf">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CLOCKS_PER_SEC</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><strong>OWN-BUFFER-C++-WAY</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">iostream</span><span class="o">&gt;</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">fstream</span><span class="o">&gt;</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">ctime</span><span class="o">&gt;</span>
<span class="k">using</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="n">std</span><span class="p">;</span>

<span class="nc">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">clock_t</span><span class="w"> </span><span class="k">start</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>
<span class="w">    </span><span class="k">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>

<span class="w">    </span><span class="n">ifstream</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="ss">"from.ogv"</span><span class="p">,</span><span class="w"> </span><span class="nl">ios</span><span class="p">:</span><span class="err">:</span><span class="nc">binary</span><span class="p">);</span>
<span class="w">    </span><span class="n">ofstream</span><span class="w"> </span><span class="n">dest</span><span class="p">(</span><span class="ss">"to.ogv"</span><span class="p">,</span><span class="w"> </span><span class="nl">ios</span><span class="p">:</span><span class="err">:</span><span class="nc">binary</span><span class="p">);</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="k">size</span>
<span class="w">    </span><span class="n">source</span><span class="p">.</span><span class="n">seekg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nl">ios</span><span class="p">:</span><span class="err">:</span><span class="k">end</span><span class="p">);</span>
<span class="w">    </span><span class="nl">ifstream</span><span class="p">:</span><span class="err">:</span><span class="n">pos_type</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="n">tellg</span><span class="p">();</span>
<span class="w">    </span><span class="n">source</span><span class="p">.</span><span class="n">seekg</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">allocate</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">buffer</span>
<span class="w">    </span><span class="nc">char</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">char</span><span class="o">[</span><span class="n">size</span><span class="o">]</span><span class="p">;</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="k">file</span><span class="w">    </span>
<span class="w">    </span><span class="n">source</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="p">);</span>
<span class="w">    </span><span class="n">dest</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="p">);</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">clean</span><span class="w"> </span><span class="n">up</span>
<span class="w">    </span><span class="k">delete</span><span class="err">[]</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<span class="w">    </span><span class="n">source</span><span class="p">.</span><span class="k">close</span><span class="p">();</span>
<span class="w">    </span><span class="n">dest</span><span class="p">.</span><span class="k">close</span><span class="p">();</span>

<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>

<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"CLOCKS_PER_SEC "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">CLOCKS_PER_SEC</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"\n"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"CPU-TIME START "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"\n"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"CPU-TIME END "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"\n"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"CPU-TIME END - START "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w">  </span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"\n"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"TIME(SEC) "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">static_cast</span><span class="o">&lt;</span><span class="k">double</span><span class="o">&gt;</span><span class="p">(</span><span class="k">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">start</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CLOCKS_PER_SEC</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"\n"</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="err">}</span>
</pre></div>

<p><strong>LINUX-WAY</strong> // requires kernel &gt;= 2.6.33</p>
<div class="code"><pre class="code literal-block"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/sendfile.h&gt;</span><span class="c1">  // sendfile</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fcntl.h&gt;</span><span class="c1">         // open</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span><span class="c1">        // close</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/stat.h&gt;</span><span class="c1">      // fstat</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span><span class="c1">     // fstat</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ctime&gt;</span>
<span class="n">using</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>

<span class="kr">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">clock_t</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="nf">end</span><span class="p">;</span>
<span class="w">    </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>

<span class="w">    </span><span class="kr">int</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="s">"from.ogv"</span><span class="p">,</span><span class="w"> </span><span class="n">O_RDONLY</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="kr">int</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="s">"to.ogv"</span><span class="p">,</span><span class="w"> </span><span class="n">O_WRONLY</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">O_CREAT</span><span class="w"> </span><span class="cm">/*| O_TRUNC/**/</span><span class="p">,</span><span class="w"> </span><span class="mo">0644</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// struct required, rationale: function stat() exists also</span>
<span class="w">    </span><span class="kr">struct</span><span class="w"> </span><span class="nc">stat</span><span class="w"> </span><span class="n">stat_source</span><span class="p">;</span>
<span class="w">    </span><span class="n">fstat</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">stat_source</span><span class="p">);</span>

<span class="w">    </span><span class="n">sendfile</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">stat_source</span><span class="p">.</span><span class="n">st_size</span><span class="p">);</span>

<span class="w">    </span><span class="nf">close</span><span class="p">(</span><span class="n">source</span><span class="p">);</span>
<span class="w">    </span><span class="nf">close</span><span class="p">(</span><span class="n">dest</span><span class="p">);</span>

<span class="w">    </span><span class="nf">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>

<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"CLOCKS_PER_SEC "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">CLOCKS_PER_SEC</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"CPU-TIME START "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"CPU-TIME END "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="nf">end</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"CPU-TIME END - START "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w">  </span><span class="nf">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"TIME(SEC) "</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="kr">static_cast</span><span class="o">&lt;</span><span class="kr">double</span><span class="o">&gt;</span><span class="p">(</span><span class="nf">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CLOCKS_PER_SEC</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><strong>Environment</strong></p>
<ul>
<li>GNU/LINUX (Archlinux)</li>
<li>Kernel 3.3</li>
<li>GLIBC-2.15, LIBSTDC++ 4.7 (GCC-LIBS), GCC 4.7, Coreutils 8.16</li>
<li>Using RUNLEVEL 3 (Multiuser, Network, Terminal, no GUI)</li>
<li>INTEL SSD-Postville 80 GB, filled up to 50% </li>
<li>Copy a 270 MB OGG-VIDEO-FILE </li>
</ul>
<p><strong>Steps to reproduce</strong></p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">rm</span><span class="w"> </span><span class="n">from</span><span class="p">.</span><span class="n">ogg</span>
<span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">reboot</span><span class="w">                           </span><span class="p">#</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">filesystem</span><span class="w"> </span><span class="n">buffers</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">regular</span>
<span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="p">(</span><span class="kt">time</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">program</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&gt;&gt;</span><span class="w"> </span><span class="n">report</span><span class="p">.</span><span class="n">txt</span><span class="w">  </span><span class="p">#</span><span class="w"> </span><span class="n">executes</span><span class="w"> </span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="n">redirects</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">append</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">file</span>
<span class="w"> </span><span class="mf">4.</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">sha256sum</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="n">ogv</span><span class="w">                  </span><span class="p">#</span><span class="w"> </span><span class="n">checksum</span>
<span class="w"> </span><span class="mf">5.</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">rm</span><span class="w"> </span><span class="n">to</span><span class="p">.</span><span class="n">ogg</span><span class="w">                        </span><span class="p">#</span><span class="w"> </span><span class="n">remove</span><span class="w"> </span><span class="n">copy</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">sync</span><span class="p">,</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">fileystem</span><span class="w"> </span><span class="n">buffers</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">used</span>
<span class="w"> </span><span class="mf">6.</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="p">(</span><span class="kt">time</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">program</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&gt;&gt;</span><span class="w"> </span><span class="n">report</span><span class="p">.</span><span class="n">txt</span><span class="w">  </span><span class="p">#</span><span class="w"> </span><span class="n">executes</span><span class="w"> </span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="n">redirects</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">append</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">file</span>
</pre></div>

<p><strong>Results (CPU TIME used)</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">Program</span>  <span class="n">Description</span>                 <span class="n">UNBUFFERED</span><span class="p">|</span><span class="n">BUFFERED</span>
<span class="n">ANSI</span> <span class="n">C</span>   <span class="p">(</span><span class="n">fread</span><span class="o">/</span><span class="n">frwite</span><span class="p">)</span>                 <span class="mi">490</span><span class="p">,</span><span class="mi">000</span><span class="p">|</span><span class="mi">260</span><span class="p">,</span><span class="mi">000</span>  
<span class="n">POSIX</span>    <span class="p">(</span><span class="n">K</span><span class="o">&amp;</span><span class="n">R</span><span class="p">,</span> <span class="n">read</span><span class="o">/</span><span class="n">write</span><span class="p">)</span>              <span class="mi">450</span><span class="p">,</span><span class="mi">000</span><span class="p">|</span><span class="mi">230</span><span class="p">,</span><span class="mi">000</span>  
<span class="n">FSTREAM</span>  <span class="p">(</span><span class="n">KISS</span><span class="p">,</span> <span class="n">Streambuffer</span><span class="p">)</span>           <span class="mi">500</span><span class="p">,</span><span class="mi">000</span><span class="p">|</span><span class="mi">270</span><span class="p">,</span><span class="mi">000</span> 
<span class="n">FSTREAM</span>  <span class="p">(</span><span class="n">Algorithm</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span>              <span class="mi">500</span><span class="p">,</span><span class="mi">000</span><span class="p">|</span><span class="mi">270</span><span class="p">,</span><span class="mi">000</span>
<span class="n">FSTREAM</span>  <span class="p">(</span><span class="n">OWN</span><span class="o">-</span><span class="n">BUFFER</span><span class="p">)</span>                   <span class="mi">500</span><span class="p">,</span><span class="mi">000</span><span class="p">|</span><span class="mi">340</span><span class="p">,</span><span class="mi">000</span>  
<span class="n">SENDFILE</span> <span class="p">(</span><span class="n">native</span> <span class="n">LINUX</span><span class="p">,</span> <span class="n">sendfile</span><span class="p">)</span>       <span class="mi">410</span><span class="p">,</span><span class="mi">000</span><span class="p">|</span><span class="mi">200</span><span class="p">,</span><span class="mi">000</span>
</pre></div>

<p>Filesize doesn't change.<br>
sha256sum print the same results.<br>
The video file is still playable.</p>
<p><strong>Questions</strong></p>
<ul>
<li>What method would you prefer?</li>
<li>Do you know better solutions?</li>
<li>Do you see any mistakes in my code?</li>
<li>
<p>Do you know a reason to avoid a solution?</p>
</li>
<li>
<p>FSTREAM (KISS, Streambuffer)<br>
I really like this one, because it is really short and simple. As far is I
know the operator &lt;&lt; is overloaded for rdbuf() and doesn't convert anything.
Correct?</p>
</li>
</ul>
<p>Thanks</p>
<p><strong>Update 1</strong><br>
I changed the source in all samples in that way, that the open and close of
the file descriptors is include in the measurement of <em>clock()</em>. Their are no
other significant changes in the source code. The results doesn't changed! I
also used <em>time</em> to double-check my results.</p>
<p><strong>Update 2</strong><br>
ANSI C sample changed: The condition of the <em>while-loop</em> doesn't call any
longer <em>feof()</em> instead I moved <em>fread()</em> into the condition. It looks like,
the code runs now 10,000 clocks faster.</p>
<p>Measurement changed: The former results were always buffered, because I
repeated the old command line <em>rm to.ogv &amp;&amp; sync &amp;&amp; time ./program</em> for each
program a few times. Now I reboot the system for every program. The unbuffered
results are new and show no surprise. The unbuffered results didn't changed
really.</p>
<p>If i don't delete the old copy, the programs react different. Overwriting a
existing file <em>buffered</em> is faster with POSIX and SENDFILE, all other programs
are slower. Maybe the options <em>truncate</em> or <em>create</em> have a impact on this
behaviour. But overwriting existing files with the same copy is not a real
world use-case.</p>
<p>Performing the copy with <em>cp</em> takes 0.44 seconds unbuffered und 0.30 seconds
buffered. So <em>cp</em> is a little bit slower than the POSIX sample. Looks fine for
me.</p>
<p>Maybe I add also samples and results of <em>mmap()</em> and <em><code>copy_file()</code></em> from
boost::filesystem.</p>
<p><strong>Update 3</strong><br>
I've put this also on a blog page and extended it a little bit. Including
<em>splice()</em> , which is a low-level function from the Linux kernel. Maybe more
samples with Java will follow. http://www.ttyhoney.com/blog/?page_id=69</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Copy a file in a sane way:</p>
<div class="code"><pre class="code literal-block"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>

<span class="kr">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="w">  </span><span class="n">src</span><span class="p">(</span><span class="s">"from.ogv"</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w">  </span><span class="n">dst</span><span class="p">(</span><span class="s">"to.ogv"</span><span class="p">,</span><span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>

<span class="w">    </span><span class="n">dst</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">src</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>This is so simple and intuitive to read it is worth the extra cost. If we were
doing it a lot, better to fall back on OS calls to the file system. I am sure
<code>boost</code> has a copy file method in its filesystem class.</p>
<p>There is a C method for interacting with the file system:</p>
<div class="code"><pre class="code literal-block"><span class="c1">#include &lt;copyfile.h&gt;</span>

<span class="nb nb-Type">int</span>
<span class="n">copyfile</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="o">*</span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="o">*</span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="n">copyfile_state_t</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">copyfile_flags_t</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>With C++17 the standard way to copy a file will be including the
<code>&lt;filesystem&gt;</code> header and using:</p>
<div class="code"><pre class="code literal-block"><span class="nb nb-Type">bool</span><span class="w"> </span><span class="n">copy_file</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">path</span><span class="o">&amp;</span><span class="w"> </span><span class="n">from</span><span class="p">,</span>
<span class="w">                </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">path</span><span class="o">&amp;</span><span class="w"> </span><span class="n">to</span><span class="p">);</span>

<span class="nb nb-Type">bool</span><span class="w"> </span><span class="n">copy_file</span><span class="p">(</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">path</span><span class="o">&amp;</span><span class="w"> </span><span class="n">from</span><span class="p">,</span>
<span class="w">                </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">path</span><span class="o">&amp;</span><span class="w"> </span><span class="n">to</span><span class="p">,</span>
<span class="w">                </span><span class="n">std</span><span class="p">::</span><span class="n">filesystem</span><span class="p">::</span><span class="n">copy_options</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>
</pre></div>

<p>The first form is equivalent to the second one with <code>copy_options::none</code> used
as options (see also <code>copy_file</code>).</p>
<p>The <code>filesystem</code> library was originally developed as <code>boost.filesystem</code> and
finally merged to ISO C++ as of C++17.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2852.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2850.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
