<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1325) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1325.html">
<link rel="prev" href="index-1326.html" type="text/html">
<link rel="next" href="index-1324.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/get-string-in-yyyymmdd-format-from-js-date-object/" class="u-url">Get String in YYYYMMDD format from JS date object?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/get-string-in-yyyymmdd-format-from-js-date-object/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T06:42:01+08:00" itemprop="datePublished" title="2023-02-18 06:42">2023-02-18 06:42</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to use JS to turn a <code>date object</code> into a string in <code>YYYYMMDD</code>
format. Is there an easier way than concatenating <code>Date.getYear()</code>,
<code>Date.getMonth()</code>, and <code>Date.getDay()</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Altered piece of code I often use:</p>
<div class="code"><pre class="code literal-block"><span class="n">Date</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">yyyymmdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">mm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">getMonth</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">getMonth</span><span class="p">()</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">zero</span><span class="o">-</span><span class="n">based</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">getDate</span><span class="p">();</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">this</span><span class="o">.</span><span class="n">getFullYear</span><span class="p">(),</span>
<span class="w">          </span><span class="p">(</span><span class="n">mm</span><span class="o">&gt;</span><span class="mi">9</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="s1">''</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">'0'</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mm</span><span class="p">,</span>
<span class="w">          </span><span class="p">(</span><span class="n">dd</span><span class="o">&gt;</span><span class="mi">9</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="s1">''</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">'0'</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dd</span>
<span class="w">         </span><span class="p">]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">var</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">();</span>
<span class="n">date</span><span class="o">.</span><span class="n">yyyymmdd</span><span class="p">();</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I didn't like adding to the prototype. An alternative would be:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">rightNow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">();</span>
<span class="k">var</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rightNow</span><span class="o">.</span><span class="n">toISOString</span><span class="p">()</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/-/</span><span class="n">g</span><span class="p">,</span><span class="s2">""</span><span class="p">);</span>

<span class="o">&lt;!--</span><span class="w"> </span><span class="n">Next</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">snippet</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="o">--&gt;</span>
<span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">innerHTML</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-difference-between-x-is-null-and-x-null/" class="u-url">What is the difference between "x is null" and "x == null"?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-difference-between-x-is-null-and-x-null/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T06:41:38+08:00" itemprop="datePublished" title="2023-02-18 06:41">2023-02-18 06:41</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In C# 7, we can use</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">x</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="w"> </span><span class="k">return</span><span class="c1">;</span>
</pre></div>

<p>instead of</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="w"> </span><span class="k">return</span><span class="c1">;</span>
</pre></div>

<p>Are there any advantages to using the new way (former example) over the old
way?</p>
<p>Are the semantics any different?</p>
<p>Is it just a matter of taste? If not, when should I use one over the other?</p>
<p>Reference: What’s New in C# 7.0.</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>Update:</strong> The Roslyn compiler has been updated to make the behavior of the
two operators the same <em>when there is no overloaded equality operator</em>. Please
see the code in the current compiler results (<code>M1</code> and <code>M2</code> in the code) that
shows what happens when there is no overloaded equality comparer. They both
now have the better-performing <code>==</code> behavior. If there is an overloaded
equality comparer, the code still differs.</p>
<p>See for older versions of the Roslyn compiler the below analysis.</p>
<hr>
<p>For <code>null</code> there isn't a difference with what we are used to with C# 6.
However, things become interesting when you change <code>null</code> to another constant.</p>
<p>Take this for example:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Test</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span><span class="c1">;</span>

<span class="nv">public</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">Test</span><span class="ss">(</span><span class="nv">object</span><span class="w"> </span><span class="nv">o</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">o</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span><span class="w"> </span><span class="nv">Console</span>.<span class="nv">WriteLine</span><span class="ss">(</span><span class="s2">"a"</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="nv">Console</span>.<span class="nv">WriteLine</span><span class="ss">(</span><span class="s2">"b"</span><span class="ss">)</span><span class="c1">;</span>
}
</pre></div>

<p>The test yields <code>a</code>. If you compare that to <code>o == (object)1</code> what you would
have written normally, it does make a lot of difference. <code>is</code> takes into
consideration the type on the other side of the comparison. That is cool!</p>
<p>I think the <code>== null</code> vs. <code>is null</code> constant pattern is just something that is
very familiar 'by accident', where the syntax of the <code>is</code> operator and the
equals operator yield the same result.</p>
<hr>
<p>As svick commented, <code>is null</code> calls <code>System.Object::Equals(object, object)</code>
where <code>==</code> calls <code>ceq</code>.</p>
<p><em>IL for<code>is</code>:</em></p>
<div class="code"><pre class="code literal-block"><span class="nl">IL_0000</span><span class="p">:</span><span class="w"> </span><span class="n">ldarg</span><span class="mf">.1</span><span class="w">              </span><span class="o">//</span><span class="w"> </span><span class="k">Load</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">onto</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stack</span>
<span class="nl">IL_0001</span><span class="p">:</span><span class="w"> </span><span class="n">ldnull</span><span class="w">               </span><span class="o">//</span><span class="w"> </span><span class="n">Push</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stack</span>
<span class="nl">IL_0002</span><span class="p">:</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">[</span><span class="n">mscorlib</span><span class="o">]</span><span class="k">System</span><span class="p">.</span><span class="k">Object</span><span class="o">::</span><span class="k">Equals</span><span class="p">(</span><span class="k">object</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Call</span><span class="w"> </span><span class="k">method</span><span class="w"> </span><span class="n">indicated</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">arguments</span>
<span class="nl">IL_0007</span><span class="p">:</span><span class="w"> </span><span class="n">ret</span><span class="w">                  </span><span class="o">//</span><span class="w"> </span><span class="k">Return</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">method</span><span class="p">,</span><span class="w"> </span><span class="n">possibly</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">value</span>
</pre></div>

<p><em>IL for<code>==</code>:</em></p>
<div class="code"><pre class="code literal-block"><span class="n">IL_0000</span><span class="o">:</span><span class="w"> </span><span class="n">ldarg</span><span class="o">.</span><span class="mi">1</span><span class="w">              </span><span class="c1">// Load argument 1 onto the stack</span>
<span class="n">IL_0001</span><span class="o">:</span><span class="w"> </span><span class="n">ldnull</span><span class="w">               </span><span class="c1">// Push a null reference on the stack</span>
<span class="n">IL_0002</span><span class="o">:</span><span class="w"> </span><span class="n">ceq</span><span class="w">                  </span><span class="c1">// Push 1 (of type int32) if value1 equals value2, else push 0</span>
<span class="n">IL_0004</span><span class="o">:</span><span class="w"> </span><span class="n">ret</span><span class="w">                  </span><span class="c1">// Return from method, possibly with a value</span>
</pre></div>

<p>Since we are talking about <code>null</code>, there is no difference since this only
makes a difference on instances. This could change when you have overloaded
the equality operator.</p>
<p><br></p>
<h3>Suggest</h3>
<h4>Overloaded equals operator</h4>
<p>There is in fact a difference in semantics between the two comparisons when
you are comparing <code>null</code> with a type that has overloaded the <code>==</code> operator.
<code>foo is null</code> will use direct reference comparison to determine the result,
whereas <code>foo == null</code> will of course run the overloaded <code>==</code> operator if it
exists.</p>
<p>In this example I have introduced a "bug" in the overloaded <code>==</code> operator,
causing it to always throw an exception if the second argument is <code>null</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nv">void</span><span class="w"> </span><span class="nv">Main</span><span class="ss">()</span>
{
<span class="w">    </span><span class="nv">Foo</span><span class="w"> </span><span class="nv">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">null</span><span class="c1">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">foo</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="w"> </span><span class="nv">Console</span>.<span class="nv">WriteLine</span><span class="ss">(</span><span class="s2">"foo is null"</span><span class="ss">)</span><span class="c1">; // This condition is met</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">foo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="w"> </span><span class="nv">Console</span>.<span class="nv">WriteLine</span><span class="ss">(</span><span class="s2">"foo == null"</span><span class="ss">)</span><span class="c1">; // This will throw an exception</span>
}

<span class="nv">public</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">Foo</span>
{
<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">bool</span><span class="w"> </span><span class="nv">operator</span><span class="w"> </span><span class="o">==</span><span class="ss">(</span><span class="nv">Foo</span><span class="w"> </span><span class="nv">foo1</span>,<span class="w"> </span><span class="nv">Foo</span><span class="w"> </span><span class="nv">foo2</span><span class="ss">)</span>
<span class="w">    </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">object</span>.<span class="nv">Equals</span><span class="ss">(</span><span class="nv">foo2</span>,<span class="w"> </span><span class="nv">null</span><span class="ss">))</span><span class="w"> </span><span class="nv">throw</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Exception</span><span class="ss">(</span><span class="s2">"oops"</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">object</span>.<span class="nv">Equals</span><span class="ss">(</span><span class="nv">foo1</span>,<span class="w"> </span><span class="nv">foo2</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="o">//</span><span class="w"> </span>...
}
</pre></div>

<p>The IL code for <code>foo is null</code> uses the <code>ceq</code> instruction to perform a direct
reference comparison:</p>
<div class="code"><pre class="code literal-block"><span class="n">IL_0003</span><span class="o">:</span><span class="w">  </span><span class="n">ldloc</span><span class="o">.</span><span class="mi">0</span><span class="w">     </span><span class="c1">// foo</span>
<span class="n">IL_0004</span><span class="o">:</span><span class="w">  </span><span class="n">ldnull</span><span class="w">      </span>
<span class="n">IL_0005</span><span class="o">:</span><span class="w">  </span><span class="n">ceq</span>
</pre></div>

<p>The IL code for <code>foo == null</code> uses a call to the overloaded operator:</p>
<div class="code"><pre class="code literal-block"><span class="n">IL_0016</span><span class="o">:</span><span class="w">  </span><span class="n">ldloc</span><span class="o">.</span><span class="mi">0</span><span class="w">     </span><span class="c1">// foo</span>
<span class="n">IL_0017</span><span class="o">:</span><span class="w">  </span><span class="n">ldnull</span><span class="w">      </span>
<span class="n">IL_0018</span><span class="o">:</span><span class="w">  </span><span class="n">call</span><span class="w">        </span><span class="n">UserQuery</span><span class="o">+</span><span class="n">Foo</span><span class="o">.</span><span class="na">op_Equality</span>
</pre></div>

<p>So the difference is, that if you use <code>==</code> you risk running user code (which
can potentially have unexpected behavior or performance problems).</p>
<h4>Restriction on generics</h4>
<p>Using the <code>is null</code> construct restricts the type to a reference type. The
compiler ensures this, which means you cannot use <code>is null</code> on a value type.
If you have a generic method, you will not be able to use <code>is null</code> unless the
generic type is constrained to be a reference type.</p>
<div class="code"><pre class="code literal-block"><span class="nt">bool</span><span class="w"> </span><span class="nt">IsNull</span><span class="o">&lt;</span><span class="nt">T</span><span class="o">&gt;(</span><span class="nt">T</span><span class="w"> </span><span class="nt">item</span><span class="o">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nt">item</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">null</span><span class="o">;</span><span class="w">                  </span><span class="o">//</span><span class="w"> </span><span class="nt">Compile</span><span class="w"> </span><span class="nt">error</span><span class="o">:</span><span class="w"> </span><span class="nt">CS0403</span>
<span class="nt">bool</span><span class="w"> </span><span class="nt">IsNull</span><span class="o">&lt;</span><span class="nt">T</span><span class="o">&gt;(</span><span class="nt">T</span><span class="w"> </span><span class="nt">item</span><span class="o">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nt">item</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nt">null</span><span class="o">;</span><span class="w">                  </span><span class="o">//</span><span class="w"> </span><span class="nt">Works</span>
<span class="nt">bool</span><span class="w"> </span><span class="nt">IsNull</span><span class="o">&lt;</span><span class="nt">T</span><span class="o">&gt;(</span><span class="nt">T</span><span class="w"> </span><span class="nt">item</span><span class="o">)</span><span class="w"> </span><span class="nt">where</span><span class="w"> </span><span class="nt">T</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nt">class</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nt">item</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">null</span><span class="o">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nt">Works</span>
</pre></div>

<p>Thanks to David Augusto Villa for pointing this out.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/html5-canvas-vs-svg-vs-div/" class="u-url">HTML5 Canvas vs. SVG vs. div</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/html5-canvas-vs-svg-vs-div/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T06:41:13+08:00" itemprop="datePublished" title="2023-02-18 06:41">2023-02-18 06:41</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What is the best approach for creating elements on the fly and being able to
move them around? For example, let's say I want to create a rectangle, circle
and polygon and then select those objects and move them around.</p>
<p>I understand that HTML5 provides three elements that can make this possible:
svg, canvas and div. For what I want to do, which one of those elements will
provide the best performance?</p>
<p>To compare these approaches, I was thinking of creating three visually
identical web pages that each have a header, footer, widget and text content
in them. The widget in the first page would be created entirely with the
<code>canvas</code> element, the second entirely with the <code>svg</code> element, and the third
with the plain <code>div</code> element, HTML and CSS.</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>The short answer:</h3>
<p>SVG would be <em>easier</em> for you, since selection and moving it around is already
built in. SVG objects are DOM objects, so they have "click" handlers, etc.</p>
<p>DIVs are okay but clunky and have <em>awful</em> performance loading at large
numbers.</p>
<p>Canvas has the best performance hands-down, but you have to implement all
concepts of managed state (object selection, etc) yourself, or use a library.</p>
<hr>
<h3>The long answer:</h3>
<p>HTML5 Canvas is simply a drawing surface for a bit-map. You set up to draw
(Say with a color and line thickness), draw that thing, and then the Canvas
has no knowledge of that thing: It doesn't know where it is or what it is that
you've just drawn, it's just pixels. If you want to draw rectangles and have
them move around or be selectable then you have to code all of that from
scratch, <strong>including</strong> the code to remember that you drew them.</p>
<p>SVG on the other hand must maintain references to each object that it renders.
Every SVG/VML element you create is a real element in the DOM. By default this
allows you to keep much better track of the elements you create and makes
dealing with things like mouse events easier by default, but it slows down
significantly when there are a large number of objects</p>
<p>Those SVG DOM references mean that some of the footwork of dealing with the
things you draw is done for you. And SVG is faster when rendering <em>really
large</em> objects, but slower when rendering <em>many</em> objects.</p>
<p>A game would probably be faster in Canvas. A huge map program would probably
be faster in SVG. If you do want to use Canvas, I have some tutorials on
getting movable objects up and running here.</p>
<p>Canvas would be better for faster things and heavy bitmap manipulation (like
animation), but will take more code if you want lots of interactivity.</p>
<p>I've run a bunch of numbers on HTML DIV-made drawing versus Canvas-made
drawing. I could make a huge post about the benefits of each, but I will give
some of the relevant results of my tests to consider for your specific
application:</p>
<p>I made Canvas and HTML DIV test pages, both had movable "nodes." Canvas nodes
were objects I created and kept track of in Javascript. HTML nodes were
movable Divs.</p>
<p>I added 100,000 nodes to each of my two tests. They performed quite
differently:</p>
<p>The HTML test tab took forever to load (timed at slightly under 5 minutes,
chrome asked to kill the page the first time). Chrome's task manager says that
tab is taking up 168MB. It takes up 12-13% CPU time when I am looking at it,
0% when I am not looking.</p>
<p>The Canvas tab loaded in one second and takes up 30MB. It also takes up 13% of
CPU time all of the time, regardless of whether or not one is looking at it.
<em>(2013 edit: They've mostly fixed that)</em></p>
<p>Dragging on the HTML page is smoother, which is expected by the design, since
the current setup is to redraw EVERYTHING every 30 milliseconds in the Canvas
test. There are plenty of optimizations to be had for Canvas for this. (canvas
invalidation being the easiest, also clipping regions, selective redrawing,
etc.. just depends on how much you feel like implementing)</p>
<p>There is no doubt you could get Canvas to be faster at object manipulation as
the divs in that simple test, and of course far faster in the load time.
Drawing/loading is faster in Canvas and has far more room for optimizations,
too (ie, excluding things that are off-screen is very easy).</p>
<h3>Conclusion:</h3>
<ul>
<li>SVG is probably better for applications and apps with few items (less than 1000? Depends really)</li>
<li>Canvas is better for thousands of objects and careful manipulation, but a lot more code (or a library) is needed to get it off the ground.</li>
<li>HTML Divs are clunky and do not scale, making a circle is only possible with rounded corners, making complex shapes is possible but involves hundreds of tiny tiny pixel-wide divs. Madness ensues.</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>To add to this, I've been doing a diagram application, and initially started
out with canvas. The diagram consists of many nodes, and they can get quite
big. The user can drag elements in the diagram around.</p>
<p>What I found was that on my Mac, for very large images, SVG is superior. I
have a MacBook Pro 2013 13" Retina, and it runs the fiddle below quite well.
The image is 6000x6000 pixels, and has 1000 objects. A similar construction in
canvas was impossible to animate for me when the user was dragging objects
around in the diagram.</p>
<p>On modern displays you also have to account for different resolutions, and
here SVG gives you all of this for free.</p>
<p>Fiddle: http://jsfiddle.net/knutsi/PUcr8/16/</p>
<p>Fullscreen: http://jsfiddle.net/knutsi/PUcr8/16/embedded/result/</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">wiggle_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="n">nodes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="o">//</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">svg</span><span class="p">:</span>
<span class="k">var</span><span class="w"> </span><span class="n">svg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElementNS</span><span class="p">(</span><span class="s2">"http://www.w3.org/2000/svg"</span><span class="p">,</span><span class="w"> </span><span class="s2">"svg"</span><span class="p">);</span>
<span class="n">svg</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s1">'style'</span><span class="p">,</span><span class="w"> </span><span class="s1">'border: 1px solid black'</span><span class="p">);</span>
<span class="n">svg</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s1">'width'</span><span class="p">,</span><span class="w"> </span><span class="s1">'6000'</span><span class="p">);</span>
<span class="n">svg</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s1">'height'</span><span class="p">,</span><span class="w"> </span><span class="s1">'6000'</span><span class="p">);</span>

<span class="n">svg</span><span class="o">.</span><span class="n">setAttributeNS</span><span class="p">(</span><span class="s2">"http://www.w3.org/2000/xmlns/"</span><span class="p">,</span><span class="w"> </span><span class="s2">"xmlns:xlink"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"http://www.w3.org/1999/xlink"</span><span class="p">);</span>

<span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">svg</span><span class="p">);</span>


<span class="n">function</span><span class="w"> </span><span class="n">makeNode</span><span class="p">(</span><span class="n">wiggle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElementNS</span><span class="p">(</span><span class="s2">"http://www.w3.org/2000/svg"</span><span class="p">,</span><span class="w"> </span><span class="s2">"g"</span><span class="p">);</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">node_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">6000</span><span class="p">);</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">node_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">6000</span><span class="p">);</span>
<span class="w">    </span><span class="n">node</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="s2">"translate("</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">node_x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">", "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">node_y</span><span class="w"> </span><span class="o">+</span><span class="s2">")"</span><span class="p">);</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">circle</span><span class="p">:</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">circ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElementNS</span><span class="p">(</span><span class="s2">"http://www.w3.org/2000/svg"</span><span class="p">,</span><span class="w"> </span><span class="s2">"circle"</span><span class="p">);</span>
<span class="w">    </span><span class="n">circ</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="s2">"cir"</span><span class="p">)</span>
<span class="w">    </span><span class="n">circ</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="w"> </span><span class="s2">"cx"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"px"</span><span class="p">)</span>
<span class="w">    </span><span class="n">circ</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="w"> </span><span class="s2">"cy"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"px"</span><span class="p">)</span>
<span class="w">    </span><span class="n">circ</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="w"> </span><span class="s2">"r"</span><span class="p">,</span><span class="s2">"100px"</span><span class="p">);</span>
<span class="w">    </span><span class="n">circ</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s1">'fill'</span><span class="p">,</span><span class="w"> </span><span class="s1">'red'</span><span class="p">);</span>
<span class="w">    </span><span class="n">circ</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s1">'pointer-events'</span><span class="p">,</span><span class="w"> </span><span class="s1">'inherit'</span><span class="p">)</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">text</span><span class="p">:</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElementNS</span><span class="p">(</span><span class="s2">"http://www.w3.org/2000/svg"</span><span class="p">,</span><span class="w"> </span><span class="s2">"text"</span><span class="p">);</span>
<span class="w">    </span><span class="n">text</span><span class="o">.</span><span class="n">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"This is a test! ÅÆØ"</span><span class="p">;</span>

<span class="w">    </span><span class="n">node</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">circ</span><span class="p">);</span>
<span class="w">    </span><span class="n">node</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>

<span class="w">    </span><span class="n">node</span><span class="o">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node_x</span><span class="p">;</span>
<span class="w">    </span><span class="n">node</span><span class="o">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node_y</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">wiggle</span><span class="p">)</span>
<span class="w">        </span><span class="n">nodes</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">populate</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="n">nodes</span><span class="p">:</span>
<span class="k">for</span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">makeNode</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">svg</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">mapped</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mouse</span><span class="p">:</span>
<span class="k">var</span><span class="w"> </span><span class="n">bnode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">makeNode</span><span class="p">(</span><span class="bp">false</span><span class="p">);</span>
<span class="n">svg</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">bnode</span><span class="p">);</span>

<span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">onmousemove</span><span class="o">=</span><span class="n">function</span><span class="p">(</span><span class="n">event</span><span class="p">){</span>
<span class="w">    </span><span class="n">bnode</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="s2">"translate("</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">clientX</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">window</span><span class="o">.</span><span class="n">pageXOffset</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">", "</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">clientY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">window</span><span class="o">.</span><span class="n">pageYOffset</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="s2">")"</span><span class="p">);</span>
<span class="p">};</span>

<span class="n">setInterval</span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">wiggle_factor</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="mi">60</span><span class="p">;</span>
<span class="w">    </span><span class="n">nodes</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">node</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span><span class="w"> </span><span class="s2">"translate("</span><span class="w"> </span>
<span class="w">                          </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wiggle_factor</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">node</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span>
<span class="w">                          </span><span class="o">+</span><span class="w"> </span><span class="s2">", "</span><span class="w"> </span>
<span class="w">                          </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wiggle_factor</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">node</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span>
<span class="w">                          </span><span class="o">+</span><span class="w"> </span><span class="s2">")"</span><span class="p">);</span><span class="w">        </span>
<span class="w">    </span><span class="p">})</span>
<span class="p">},</span><span class="mi">1000</span><span class="o">/</span><span class="mi">60</span><span class="p">);</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1326.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1324.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
