<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2590) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2590.html">
<link rel="prev" href="index-2591.html" type="text/html">
<link rel="next" href="index-2589.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/laravel-eloquent-has-with-wherehas-what-do-they-mean/" class="u-url">Laravel - Eloquent "Has", "With", "WhereHas" - What do they mean?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/laravel-eloquent-has-with-wherehas-what-do-they-mean/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T03:15:30+08:00" itemprop="datePublished" title="2023-03-05 03:15">2023-03-05 03:15</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've found the concept and meaning behind these methods to be a little
confusing, is it possible for somebody to explain to me what the difference
between <code>has</code> and <code>with</code> is, in the context of an example (if possible)?</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>With</h3>
<p><code>with()</code> is for <strong>eager loading</strong>. That basically means, along the main model,
Laravel will preload the relationship(s) you specify. This is especially
helpful if you have a collection of models and you want to load a relation for
all of them. Because with eager loading you run only one additional DB query
instead of one for every model in the collection.</p>
<p>Example:</p>
<p><code>User &gt; hasMany &gt; Post</code></p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="n">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="p">::</span><span class="n">with</span><span class="p">(</span><span class="s1">'posts'</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">();</span>
<span class="n">foreach</span><span class="p">(</span><span class="o">$</span><span class="n">users</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">$</span><span class="n">user</span><span class="p">){</span>
<span class="w">    </span><span class="o">$</span><span class="n">users</span><span class="o">-&gt;</span><span class="n">posts</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">loaded</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">additional</span><span class="w"> </span><span class="n">DB</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">run</span>
<span class="p">}</span>
</pre></div>

<h3>Has</h3>
<p><code>has()</code> is to filter the selecting model based on a relationship. So it acts
very similarly to a normal WHERE condition. If you just use <code>has('relation')</code>
that means you only want to get the models that have at least one related
model in this relation.</p>
<p>Example:</p>
<p><code>User &gt; hasMany &gt; Post</code></p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="nt">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">User</span><span class="p">::</span><span class="nd">has</span><span class="o">(</span><span class="s1">'posts'</span><span class="o">)</span><span class="nt">-</span><span class="o">&gt;</span><span class="nt">get</span><span class="o">();</span>
<span class="o">//</span><span class="w"> </span><span class="nt">only</span><span class="w"> </span><span class="nt">users</span><span class="w"> </span><span class="nt">that</span><span class="w"> </span><span class="nt">have</span><span class="w"> </span><span class="nt">at</span><span class="w"> </span><span class="nt">least</span><span class="w"> </span><span class="nt">one</span><span class="w"> </span><span class="nt">post</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">contained</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">collection</span>
</pre></div>

<h3>WhereHas</h3>
<p><code>whereHas()</code> works basically the same as <code>has()</code> but allows you to specify
additional filters for the related model to check.</p>
<p>Example:</p>
<p><code>User &gt; hasMany &gt; Post</code></p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="nt">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">User</span><span class="p">::</span><span class="nd">whereHas</span><span class="o">(</span><span class="s1">'posts'</span><span class="o">,</span><span class="w"> </span><span class="nt">function</span><span class="o">($</span><span class="nt">q</span><span class="o">)</span><span class="p">{</span>
<span class="w">    </span><span class="err">$q-&gt;where('created_at',</span><span class="w"> </span><span class="err">'&gt;=',</span><span class="w"> </span><span class="err">'2015-01-01</span><span class="w"> </span><span class="err">00:00:00')</span><span class="p">;</span>
<span class="p">}</span><span class="o">)</span><span class="nt">-</span><span class="o">&gt;</span><span class="nt">get</span><span class="o">();</span>
<span class="o">//</span><span class="w"> </span><span class="nt">only</span><span class="w"> </span><span class="nt">users</span><span class="w"> </span><span class="nt">that</span><span class="w"> </span><span class="nt">have</span><span class="w"> </span><span class="nt">posts</span><span class="w"> </span><span class="nt">from</span><span class="w"> </span><span class="nt">2015</span><span class="w"> </span><span class="nt">on</span><span class="w"> </span><span class="nt">forward</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">returned</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>The documentation has already explained the usage, so I will use SQL to
explain the methods.</p>
<h3>Example:</h3>
<p>Assuming there is an <code>Order (orders)</code> has many <code>OrderItem (order_items)</code> and
you already built the relationship between them:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// App\Models\Order:</span>
<span class="n">public</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">orderItems</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">hasMany</span><span class="p">(</span><span class="s">'App\Models\OrderItem'</span><span class="p">,</span><span class="w"> </span><span class="s">'order_id'</span><span class="p">,</span><span class="w"> </span><span class="s">'id'</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>These three methods are <strong>all based on a relationship</strong>.</p>
<h3>with</h3>
<p><strong>Result:</strong> <code>with()</code> return the model object and its related results.</p>
<p><strong>Advantage:</strong> It is <strong>eager-loading</strong> which can <strong>prevent the N+1 problem</strong>.</p>
<p>When you are using the following Eloquent Builder:</p>
<div class="code"><pre class="code literal-block"><span class="nt">Order</span><span class="p">::</span><span class="nd">with</span><span class="o">(</span><span class="s1">'orderItems'</span><span class="o">)</span><span class="nt">-</span><span class="o">&gt;</span><span class="nt">get</span><span class="o">();</span>
</pre></div>

<p>Laravel change this code to <strong>only two SQL</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="c1">// get all orders:</span>
<span class="n">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">orders</span><span class="p">;</span>

<span class="c1">// get the order_items based on the orders' id above</span>
<span class="n">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">order_items</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">order_items</span><span class="p">.</span><span class="n">order_id</span><span class="w"> </span><span class="n">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">4.</span><span class="p">..);</span>
</pre></div>

<p>And then Laravel merges <strong>the results of the second SQL query</strong> with <strong>the
results of the first SQL</strong> by <strong>foreign key</strong> , finally returning the
collection results.</p>
<p>So if you selected columns without the foreign_key in a closure, the
relationship result will be empty:</p>
<div class="code"><pre class="code literal-block"><span class="k">Order</span><span class="o">::</span><span class="k">with</span><span class="p">(</span><span class="err">[</span><span class="s1">'orderItems'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">$query</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"> </span>
<span class="w">           </span><span class="o">//</span><span class="w"> </span><span class="n">$query</span><span class="o">-&gt;</span><span class="nf">sum</span><span class="p">(</span><span class="s1">'quantity'</span><span class="p">);</span>
<span class="w">           </span><span class="n">$query</span><span class="o">-&gt;</span><span class="k">select</span><span class="p">(</span><span class="s1">'quantity'</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="n n-Quoted">`order_id`</span>
<span class="w">       </span><span class="err">}</span>
<span class="err">]</span><span class="p">)</span><span class="o">-&gt;</span><span class="k">get</span><span class="p">();</span>

<span class="c1">#=&gt; result:</span>
<span class="err">[{</span><span class="w">  </span><span class="n">id</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="k">code</span><span class="o">:</span><span class="w"> </span><span class="s1">'00001'</span><span class="p">,</span>
<span class="w">    </span><span class="n">orderItems</span><span class="o">:</span><span class="w"> </span><span class="err">[]</span><span class="p">,</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">&lt;==</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">empty</span>
<span class="w">  </span><span class="err">}</span><span class="p">,</span><span class="err">{</span>
<span class="w">    </span><span class="n">id</span><span class="o">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="k">code</span><span class="o">:</span><span class="w"> </span><span class="s1">'00002'</span><span class="p">,</span>
<span class="w">    </span><span class="n">orderItems</span><span class="o">:</span><span class="w"> </span><span class="err">[]</span><span class="p">,</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">&lt;==</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">empty</span>
<span class="w">  </span><span class="err">}</span><span class="p">...</span>
<span class="err">}]</span>
</pre></div>

<h3>has</h3>
<p><code>Has</code> will return the model's object when <strong>its relationship is not empty</strong>.</p>
<div class="code"><pre class="code literal-block"><span class="nt">Order</span><span class="p">::</span><span class="nd">has</span><span class="o">(</span><span class="s1">'orderItems'</span><span class="o">)</span><span class="nt">-</span><span class="o">&gt;</span><span class="nt">get</span><span class="o">();</span>
</pre></div>

<p>Laravel changes this code to <strong>one SQL query</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n n-Quoted">`orders`</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n n-Quoted">`order_items`</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n n-Quoted">`orders`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n n-Quoted">`order_items`</span><span class="p">.</span><span class="n n-Quoted">`order_id`</span>
<span class="p">)</span>
</pre></div>

<h3>whereHas</h3>
<p>The methods <code>whereHas</code> and <code>orWhereHas</code> put <code>where</code> conditions on your <code>has</code>
queries. These methods allow you to add <strong>customized constraints to a
relationship constraint</strong>.</p>
<div class="code"><pre class="code literal-block"><span class="nt">Order</span><span class="p">::</span><span class="nd">whereHas</span><span class="o">(</span><span class="s1">'orderItems'</span><span class="o">,</span><span class="w"> </span><span class="nt">function</span><span class="o">($</span><span class="nt">query</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="err">$query-&gt;where('status',</span><span class="w"> </span><span class="err">1)</span><span class="p">;</span>
<span class="p">}</span><span class="o">)</span><span class="nt">-</span><span class="o">&gt;</span><span class="nt">get</span><span class="o">();</span>
</pre></div>

<p>Laravel changes this code to <strong>one SQL query</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n n-Quoted">`orders`</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n n-Quoted">`order_items`</span><span class="w"> </span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n n-Quoted">`orders`</span><span class="p">.</span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n n-Quoted">`order_items`</span><span class="p">.</span><span class="n n-Quoted">`order_id`</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n n-Quoted">`status`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/center-a-button-in-a-linear-layout/" class="u-url">Center a button in a Linear layout</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/center-a-button-in-a-linear-layout/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T03:14:11+08:00" itemprop="datePublished" title="2023-03-05 03:14">2023-03-05 03:14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am using a linear layout to display a pretty light initial screen. It has 1
button that is supposed to centre in the screen both horizontally and
vertically. However no matter what I try to do the button will top align
centre. I have included the XML below, can some one point me in the right
direction?</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;LinearLayout</span><span class="w"> </span><span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
<span class="w">    </span><span class="na">android:orientation=</span><span class="s">"vertical"</span>
<span class="w">    </span><span class="na">android:layout_width=</span><span class="s">"fill_parent"</span>
<span class="w">    </span><span class="na">android:layout_height=</span><span class="s">"fill_parent"</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;ImageButton</span><span class="w"> </span><span class="na">android:id=</span><span class="s">"@+id/btnFindMe"</span><span class="w"> </span>
<span class="w">        </span><span class="na">android:layout_width=</span><span class="s">"wrap_content"</span><span class="w"> </span>
<span class="w">        </span><span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
<span class="w">        </span><span class="na">android:layout_gravity=</span><span class="s">"center_vertical|center_horizontal"</span>
<span class="w">        </span><span class="na">android:background=</span><span class="s">"@drawable/findme"</span><span class="nt">&gt;&lt;/ImageButton&gt;</span>

<span class="nt">&lt;/LinearLayout&gt;</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>If you want to center an item in the middle of the screen don't use a
<code>LinearLayout</code> as these are meant for displaying a number of items in a row.</p>
<p>Use a <code>RelativeLayout</code> instead.</p>
<p>So replace:</p>
<div class="code"><pre class="code literal-block"><span class="n">android</span><span class="o">:</span><span class="n">layout_gravity</span><span class="o">=</span><span class="s2">"center_vertical|center_horizontal"</span>
</pre></div>

<p>for the relevant <code>RelativeLayout</code> option:</p>
<div class="code"><pre class="code literal-block"><span class="n">android</span><span class="o">:</span><span class="n">layout_centerInParent</span><span class="o">=</span><span class="s2">"true"</span>
</pre></div>

<p>So your layout file will look like this:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;RelativeLayout</span><span class="w"> </span><span class="na">android:id=</span><span class="s">"@+id/RelativeLayout01"</span><span class="w"> </span>
<span class="w">    </span><span class="na">android:layout_width=</span><span class="s">"fill_parent"</span><span class="w"> </span>
<span class="w">    </span><span class="na">android:layout_height=</span><span class="s">"fill_parent"</span>
<span class="w">    </span><span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;ImageButton</span><span class="w"> </span><span class="na">android:id=</span><span class="s">"@+id/btnFindMe"</span><span class="w"> </span>
<span class="w">        </span><span class="na">android:layout_width=</span><span class="s">"wrap_content"</span><span class="w"> </span>
<span class="w">        </span><span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
<span class="w">        </span><span class="na">android:layout_centerInParent=</span><span class="s">"true"</span>
<span class="w">        </span><span class="na">android:background=</span><span class="s">"@drawable/findme"</span><span class="nt">&gt;&lt;/ImageButton&gt;</span>

<span class="nt">&lt;/RelativeLayout&gt;</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>If you want to center an item in the middle of the screen don't use a
<code>LinearLayout</code> as these are meant for displaying a number of items in a row.</p>
<p>Use a <code>RelativeLayout</code> instead.</p>
<p>So replace:</p>
<div class="code"><pre class="code literal-block"><span class="n">android</span><span class="o">:</span><span class="n">layout_gravity</span><span class="o">=</span><span class="s2">"center_vertical|center_horizontal"</span>
</pre></div>

<p>for the relevant <code>RelativeLayout</code> option:</p>
<div class="code"><pre class="code literal-block"><span class="n">android</span><span class="o">:</span><span class="n">layout_centerInParent</span><span class="o">=</span><span class="s2">"true"</span>
</pre></div>

<p>So your layout file will look like this:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;RelativeLayout</span><span class="w"> </span><span class="na">android:id=</span><span class="s">"@+id/RelativeLayout01"</span><span class="w"> </span>
<span class="w">    </span><span class="na">android:layout_width=</span><span class="s">"fill_parent"</span><span class="w"> </span>
<span class="w">    </span><span class="na">android:layout_height=</span><span class="s">"fill_parent"</span>
<span class="w">    </span><span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;ImageButton</span><span class="w"> </span><span class="na">android:id=</span><span class="s">"@+id/btnFindMe"</span><span class="w"> </span>
<span class="w">        </span><span class="na">android:layout_width=</span><span class="s">"wrap_content"</span><span class="w"> </span>
<span class="w">        </span><span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
<span class="w">        </span><span class="na">android:layout_centerInParent=</span><span class="s">"true"</span>
<span class="w">        </span><span class="na">android:background=</span><span class="s">"@drawable/findme"</span><span class="nt">&gt;&lt;/ImageButton&gt;</span>

<span class="nt">&lt;/RelativeLayout&gt;</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/understanding-events-and-event-handlers-in-c/" class="u-url">Understanding events and event handlers in C#</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/understanding-events-and-event-handlers-in-c/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T03:12:47+08:00" itemprop="datePublished" title="2023-03-05 03:12">2023-03-05 03:12</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I understand the purpose of events, especially within the context of creating
user interfaces. I think this is the prototype for creating an event:</p>
<div class="code"><pre class="code literal-block">public void EventName(object sender, EventArgs e);
</pre></div>

<p>What do event handlers do, why are they needed, and how do I to create one?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>To understand event handlers, you need to understand delegates. In C#, you can
think of a delegate as a pointer (or a reference) to a method. This is useful
because the pointer can be passed around as a value.</p>
<p>The central concept of a delegate is its signature, or shape. That is (1) the
return type and (2) the input arguments. For example, if we create a delegate
<code>void MyDelegate(object sender, EventArgs e)</code>, it can only point to methods
which return <code>void</code>, and take an <code>object</code> and <code>EventArgs</code>. Kind of like a
square hole and a square peg. So we say these methods have the same signature,
or shape, as the delegate.</p>
<p>So knowing how to create a reference to a method, let's think about the
purpose of events: we want to cause some code to be executed when something
happens elsewhere in the system - or "handle the event". To do this, we create
specific methods for the code we want to be executed. The glue between the
event and the methods to be executed are the delegates. The event must
internally store a "list" of pointers to the methods to call when the event is
raised.* Of course, to be able to call a method, we need to know what
arguments to pass to it! We use the delegate as the "contract" between the
event and all the specific methods that will be called.</p>
<p>So the default <code>EventHandler</code> (and many like it) represents a <em>specific shape
of method</em> (again, void/object-EventArgs). When you declare an event, you are
saying <em>which shape of method</em> (EventHandler) that event will invoke, by
specifying a delegate:</p>
<div class="code"><pre class="code literal-block"><span class="c1">//This delegate can be used to point to methods</span>
<span class="c1">//which return void and take a string.</span>
<span class="n">public</span><span class="w"> </span><span class="n">delegate</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">MyEventHandler</span><span class="p">(</span><span class="nb">string</span><span class="w"> </span><span class="n">foo</span><span class="p">);</span>

<span class="c1">//This event can cause any method which conforms</span>
<span class="c1">//to MyEventHandler to be called.</span>
<span class="n">public</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">MyEventHandler</span><span class="w"> </span><span class="n">SomethingHappened</span><span class="p">;</span>

<span class="c1">//Here is some code I want to be executed</span>
<span class="c1">//when SomethingHappened fires.</span>
<span class="n">void</span><span class="w"> </span><span class="n">HandleSomethingHappened</span><span class="p">(</span><span class="nb">string</span><span class="w"> </span><span class="n">foo</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">//Do some stuff</span>
<span class="p">}</span>

<span class="c1">//I am creating a delegate (pointer) to HandleSomethingHappened</span>
<span class="c1">//and adding it to SomethingHappened's list of "Event Handlers".</span>
<span class="n">myObj</span><span class="p">.</span><span class="n">SomethingHappened</span><span class="w"> </span><span class="o">+</span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MyEventHandler</span><span class="p">(</span><span class="n">HandleSomethingHappened</span><span class="p">);</span>

<span class="c1">//To raise the event within a method.</span>
<span class="n">SomethingHappened</span><span class="p">(</span><span class="s">"bar"</span><span class="p">);</span>
</pre></div>

<p>(*This is the key to events in .NET and peels away the "magic" - an event is
really, under the covers, just a list of methods of the same "shape". The list
is stored where the event lives. When the event is "raised", it's really just
"go through this list of methods and call each one, using these values as the
parameters". Assigning an event handler is just a prettier, easier way of
adding your method to this list of methods to be called).</p>
<p><br></p>
<h3>Suggest</h3>
<p>C# knows two terms, <code>delegate</code> and <code>event</code>. Let's start with the first one.</p>
<h3>Delegate</h3>
<p>A <code>delegate</code> is a reference to a method. Just like you can create a reference
to an instance:</p>
<div class="code"><pre class="code literal-block">MyClass instance = myFactory.GetInstance();
</pre></div>

<p>You can use a delegate to create an reference to a method:</p>
<div class="code"><pre class="code literal-block">Action myMethod = myFactory.GetInstance;
</pre></div>

<p>Now that you have this reference to a method, you can call the method via the
reference:</p>
<div class="code"><pre class="code literal-block">MyClass instance = myMethod();
</pre></div>

<p>But why would you? You can also just call <code>myFactory.GetInstance()</code> directly.
In this case you can. However, there are many cases to think about where you
don't want the rest of the application to have knowledge of <code>myFactory</code> or to
call <code>myFactory.GetInstance()</code> directly.</p>
<p>An obvious one is if you want to be able to replace <code>myFactory.GetInstance()</code>
into <code>myOfflineFakeFactory.GetInstance()</code> from one central place (aka
<strong>factory method pattern</strong> ).</p>
<h4>Factory method pattern</h4>
<p>So, if you have a <code>TheOtherClass</code> class and it needs to use the
<code>myFactory.GetInstance()</code>, this is how the code will look like without
delegates (you'll need to let <code>TheOtherClass</code> know about the type of your
<code>myFactory</code>):</p>
<div class="code"><pre class="code literal-block">TheOtherClass toc;
//...
toc.SetFactory(myFactory);


class TheOtherClass
{
   public void SetFactory(MyFactory factory)
   {
      // set here
   }

}
</pre></div>

<p>If you'd use delegates, you don't have to expose the type of my factory:</p>
<div class="code"><pre class="code literal-block">TheOtherClass toc;
//...
Action factoryMethod = myFactory.GetInstance;
toc.SetFactoryMethod(factoryMethod);


class TheOtherClass
{
   public void SetFactoryMethod(Action factoryMethod)
   {
      // set here
   }

}
</pre></div>

<p>Thus, you can give a delegate to some other class to use, without exposing
your type to them. The only thing you're exposing is the signature of your
method (how many parameters you have and such).</p>
<p>"Signature of my method", where did I hear that before? O yes, interfaces!!!
interfaces describe the signature of a whole class. Think of delegates as
describing the signature of only one method!</p>
<p>Another large difference between an interface and a delegate is that when
you're writing your class, you don't have to say to C# "this method implements
that type of delegate". With interfaces, you do need to say "this class
implements that type of an interface".</p>
<p>Further, a delegate reference can (with some restrictions, see below)
reference multiple methods (called <code>MulticastDelegate</code>). This means that when
you call the delegate, multiple explicitly-attached methods will be executed.
An object reference can always only reference to one object.</p>
<p>The restrictions for a <code>MulticastDelegate</code> are that the (method/delegate)
signature should not have any return value (<code>void</code>) and the keywords <code>out</code> and
<code>ref</code> is not used in the signature. Obviously, you can't call two methods that
return a number and expect them to return the same number. Once the signature
complies, the delegate is automatically a <code>MulticastDelegate</code>.</p>
<h3>Event</h3>
<p>Events are just properties (like the get;set; properties to instance fields)
which expose subscription to the delegate from other objects. These
properties, however, don't support get;set;. Instead, they support add;
remove;</p>
<p>So you can have:</p>
<div class="code"><pre class="code literal-block">    Action myField;

    public event Action MyProperty
    {
        add { myField += value; }
        remove { myField -= value; }
    }
</pre></div>

<h3>Usage in UI (WinForms,WPF,UWP So on)</h3>
<p>So, now we know that a delegate is a reference to a method and that we can
have an event to let the world know that they can give us their methods to be
referenced from our delegate, and we are a UI button, then: we can ask anyone
who is interested in whether I was clicked, to register their method with us
(via the event we exposed). We can use all those methods that were given to us
and reference them by our delegate. And then, we'll wait and wait.... until a
user comes and clicks on that button, then we'll have enough reason to invoke
the delegate. And because the delegate references all those methods given to
us, all those methods will be invoked. We don't know what those methods do,
nor we know which class implements those methods. All we do care about is that
someone was interested in us being clicked, and gave us a reference to a
method that complied with our desired signature.</p>
<h3>Java</h3>
<p>Languages like Java don't have delegates. They use interfaces instead. The way
they do that is to ask anyone who is interested in 'us being clicked', to
implement a certain interface (with a certain method we can call), then give
us the whole instance that implements the interface. We keep a list of all
objects implementing this interface and can call their 'certain method we can
call' whenever we get clicked.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2591.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2589.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
