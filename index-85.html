<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 85) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-85.html">
<link rel="prev" href="index-86.html" type="text/html">
<link rel="next" href="index-84.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-shouldn-t-i-use-mysql-functions-in-php/" class="u-url">Why shouldn't I use mysql_* functions in PHP?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-shouldn-t-i-use-mysql-functions-in-php/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T20:48:43+08:00" itemprop="datePublished" title="2023-02-16 20:48">2023-02-16 20:48</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><strong>Want to improve this post?</strong> Provide detailed answers to this question,
including citations and an explanation of why your answer is correct. Answers
without enough detail may be edited or deleted.</p>
<p>What are the technical reasons for why one shouldn't use <code>mysql_*</code> functions?
(e.g. <code>mysql_query()</code>, <code>mysql_connect()</code> or <code>mysql_real_escape_string()</code>)?</p>
<p>Why should I use something else even if they work on my site?</p>
<p>If they don't work on my site, why do I get errors like</p>
<blockquote>
<p>Warning: mysql_connect(): No such file or directory</p>
</blockquote>
<p><br><br></p>
<h2>Answer</h2>
<p>The MySQL extension:</p>
<ul>
<li>Is not under active development</li>
<li>Is <strong>officially deprecated</strong> as of PHP 5.5 (released June 2013).</li>
<li>Has been <strong>removed entirely</strong> as of PHP 7.0 (released December 2015) <ul>
<li>This means that as of 31 Dec 2018 it does not exist in any supported version of PHP. If you are using a version of PHP which supports it, you are using a version which doesn't get security problems fixed.</li>
</ul>
</li>
<li>Lacks an OO interface</li>
<li>Doesn't support: <ul>
<li>Non-blocking, asynchronous queries</li>
<li><strong>Prepared statements or parameterized queries</strong></li>
<li>Stored procedures</li>
<li>Multiple Statements</li>
<li>Transactions</li>
<li>The "new" password authentication method (on by default in MySQL 5.6; required in 5.7)</li>
<li>Any of the new functionality in MySQL 5.1 or later</li>
</ul>
</li>
</ul>
<p>Since it is deprecated, using it makes your code less future proof.</p>
<p>Lack of support for prepared statements is particularly important as they
provide a clearer, less error-prone method of escaping and quoting external
data than manually escaping it with a separate function call.</p>
<p>See <strong>the comparison of SQL extensions</strong>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>PHP offers three different APIs to connect to MySQL. These are the
<code>mysql</code>(removed as of PHP 7), <code>mysqli</code>, and <code>PDO</code> extensions.</p>
<p>The <code>mysql_*</code> functions used to be very popular, but their use is not
encouraged anymore. The documentation team is discussing the database security
situation, and educating users to move away from the commonly used ext/mysql
extension is part of this (check <em>php.internals: deprecating ext/mysql</em> ).</p>
<p>And the later PHP developer team has taken the decision to generate
<strong><code>E_DEPRECATED</code></strong> errors when users connect to MySQL, whether through
<code>mysql_connect()</code>, <code>mysql_pconnect()</code> or the implicit connection functionality
built into <code>ext/mysql</code>.</p>
<p><strong><code>ext/mysql</code></strong> was <strong>officially deprecated as of PHP 5.5</strong> and has been
<strong>removed as of PHP 7</strong>.</p>
<p><strong>See the Red Box?</strong></p>
<p>When you go on any <code>mysql_*</code> function manual page, you see a red box,
explaining it should not be used anymore.</p>
<h3>Why</h3>
<hr>
<p>Moving away from <code>ext/mysql</code> is not only about security, but also about having
access to all the features of the MySQL database.</p>
<p><code>ext/mysql</code> was built for <strong>MySQL 3.23</strong> and only got very few additions since
then while mostly keeping compatibility with this old version which makes the
code a bit harder to maintain. Missing features that is not supported by
<code>ext/mysql</code> include: ( <em>from PHP manual</em> ).</p>
<ul>
<li>Stored procedures (can't handle multiple result sets)</li>
<li>Prepared statements</li>
<li>Encryption (SSL)</li>
<li>Compression</li>
<li>Full Charset support</li>
</ul>
<p><strong>Reason to not use<code>mysql_*</code> function</strong>:</p>
<ul>
<li>Not under active development</li>
<li>Removed as of PHP 7</li>
<li>Lacks an OO interface</li>
<li>Doesn't support non-blocking, asynchronous queries</li>
<li>Doesn't support prepared statements or parameterized queries</li>
<li>Doesn't support stored procedures</li>
<li>Doesn't support multiple statements</li>
<li>Doesn't support transactions</li>
<li>Doesn't support all of the functionality in MySQL 5.1</li>
</ul>
<p>Above point quoted from Quentin's answer</p>
<p>Lack of support for prepared statements is particularly important as they
provide a clearer, less error prone method of escaping and quoting external
data than manually escaping it with a separate function call.</p>
<p>See the comparison of SQL extensions.</p>
<hr>
<p><strong>Suppressing deprecation warnings</strong></p>
<p>While code is being converted to <code>MySQLi</code>/<code>PDO</code>, <code>E_DEPRECATED</code> errors can be
suppressed by setting <code>error_reporting</code> in <strong>php.ini</strong> to exclude
<code>E_DEPRECATED:</code></p>
<div class="code"><pre class="code literal-block">error_reporting = E_ALL ^ E_DEPRECATED
</pre></div>

<p>Note that this will also hide <strong>other deprecation warnings</strong> , which, however,
may be for things other than MySQL. ( <em>from PHP manual</em> )</p>
<p>The article <em>PDO vs. MySQLi: Which Should You Use?</em> by <strong>Dejan Marjanovic</strong>
will help you to choose.</p>
<p>And a better way is <code>PDO</code>, and I am now writing a simple <code>PDO</code> tutorial.</p>
<hr>
<h3>A simple and short PDO tutorial</h3>
<hr>
<h4>Q. First question in my mind was: what is <code>PDO</code>?</h4>
<p>A. “ <strong>PDO – PHP Data Objects</strong> – is a database access layer providing a
uniform method of access to multiple databases.”</p>
<blockquote>
<p><img alt="alt text" src="images/Vd7ve.png"></p>
</blockquote>
<hr>
<h4>Connecting to MySQL</h4>
<p>With <code>mysql_*</code> function or we can say it the old way (deprecated in PHP 5.5
and above)</p>
<div class="code"><pre class="code literal-block">$link = mysql_connect('localhost', 'user', 'pass');
mysql_select_db('testdb', $link);
mysql_set_charset('UTF-8', $link);
</pre></div>

<p>With <code>PDO</code>: All you need to do is create a new <code>PDO</code> object. The constructor
accepts parameters for specifying the database source <code>PDO</code>'s constructor
mostly takes four parameters which are <code>DSN</code> (data source name) and optionally
<code>username</code>, <code>password</code>.</p>
<p>Here I think you are familiar with all except <code>DSN</code>; this is new in <code>PDO</code>. A
<code>DSN</code> is basically a string of options that tell <code>PDO</code> which driver to use,
and connection details. For further reference, check PDO MySQL DSN.</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="nt">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">PDO</span><span class="o">(</span><span class="s1">'mysql:host=localhost;dbname=testdb;charset=utf8'</span><span class="o">,</span><span class="w"> </span><span class="s1">'username'</span><span class="o">,</span><span class="w"> </span><span class="s1">'password'</span><span class="o">);</span>
</pre></div>

<p><strong>Note:</strong> you can also use <code>charset=UTF-8</code>, but sometimes it causes an error,
so it's better to use <code>utf8</code>.</p>
<p>If there is any connection error, it will throw a <code>PDOException</code> object that
can be caught to handle <code>Exception</code> further.</p>
<p><strong>Good read</strong> : Connections and Connection management ¶</p>
<p>You can also pass in several driver options as an array to the fourth
parameter. I recommend passing the parameter which puts <code>PDO</code> into exception
mode. Because some <code>PDO</code> drivers don't support native prepared statements, so
<code>PDO</code> performs emulation of the prepare. It also lets you manually enable this
emulation. To use the native server-side prepared statements, you should
explicitly set it <code>false</code>.</p>
<p>The other is to turn off prepare emulation which is enabled in the <code>MySQL</code>
driver by default, but prepare emulation should be turned off to use <code>PDO</code>
safely.</p>
<p>I will later explain why prepare emulation should be turned off. To find
reason please check this post.</p>
<p>It is only usable if you are using an old version of <code>MySQL</code> which I do not
recommended.</p>
<p>Below is an example of how you can do it:</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="nt">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">PDO</span><span class="o">(</span><span class="s1">'mysql:host=localhost;dbname=testdb;charset=UTF-8'</span><span class="o">,</span><span class="w"> </span>
<span class="w">              </span><span class="s1">'username'</span><span class="o">,</span><span class="w"> </span>
<span class="w">              </span><span class="s1">'password'</span><span class="o">,</span>
<span class="w">              </span><span class="nt">array</span><span class="o">(</span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ATTR_EMULATE_PREPARES</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nt">false</span><span class="o">,</span>
<span class="w">              </span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ATTR_ERRMODE</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ERRMODE_EXCEPTION</span><span class="o">));</span>
</pre></div>

<p><strong>Can we set attributes after PDO construction?</strong></p>
<p><strong>Yes</strong> , we can also set some attributes after PDO construction with the
<code>setAttribute</code> method:</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="nt">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">PDO</span><span class="o">(</span><span class="s1">'mysql:host=localhost;dbname=testdb;charset=UTF-8'</span><span class="o">,</span><span class="w"> </span>
<span class="w">              </span><span class="s1">'username'</span><span class="o">,</span><span class="w"> </span>
<span class="w">              </span><span class="s1">'password'</span><span class="o">);</span>
<span class="o">$</span><span class="nt">db-</span><span class="o">&gt;</span><span class="nt">setAttribute</span><span class="o">(</span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ATTR_ERRMODE</span><span class="o">,</span><span class="w"> </span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ERRMODE_EXCEPTION</span><span class="o">);</span>
<span class="o">$</span><span class="nt">db-</span><span class="o">&gt;</span><span class="nt">setAttribute</span><span class="o">(</span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ATTR_EMULATE_PREPARES</span><span class="o">,</span><span class="w"> </span><span class="nt">false</span><span class="o">);</span>
</pre></div>

<h3>Error Handling</h3>
<hr>
<p>Error handling is much easier in <code>PDO</code> than <code>mysql_*</code>.</p>
<p>A common practice when using <code>mysql_*</code> is:</p>
<div class="code"><pre class="code literal-block"><span class="c1">//Connected to MySQL</span>
<span class="no">$</span><span class="n">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mysql_query</span><span class="p">(</span><span class="s">"SELECT * FROM table"</span><span class="p">,</span><span class="w"> </span><span class="no">$</span><span class="nb">link</span><span class="p">)</span><span class="w"> </span><span class="nb">or</span><span class="w"> </span><span class="n">die</span><span class="p">(</span><span class="n">mysql_error</span><span class="p">(</span><span class="no">$</span><span class="nb">link</span><span class="p">));</span>
</pre></div>

<p><code>OR die()</code> is not a good way to handle the error since we can not handle the
thing in <code>die</code>. It will just end the script abruptly and then echo the error
to the screen which you usually do NOT want to show to your end users, and let
bloody hackers discover your schema. Alternately, the return values of
<code>mysql_*</code> functions can often be used in conjunction with mysql_error() to
handle errors.</p>
<p><code>PDO</code> offers a better solution: exceptions. Anything we do with <code>PDO</code> should
be wrapped in a <code>try</code>-<code>catch</code> block. We can force <code>PDO</code> into one of three
error modes by setting the error mode attribute. Three error handling modes
are below.</p>
<ul>
<li>
<code>PDO::ERRMODE_SILENT</code>. It's just setting error codes and acts pretty much the same as <code>mysql_*</code> where you must check each result and then look at <code>$db-&gt;errorInfo();</code> to get the error details.</li>
<li>
<code>PDO::ERRMODE_WARNING</code> Raise <code>E_WARNING</code>. (Run-time warnings (non-fatal errors). Execution of the script is not halted.)</li>
<li>
<code>PDO::ERRMODE_EXCEPTION</code>: Throw exceptions. It represents an error raised by PDO. You should not throw a <code>PDOException</code> from your own code. See <em>Exceptions</em> for more information about exceptions in PHP. It acts very much like <code>or die(mysql_error());</code>, when it isn't caught. But unlike <code>or die()</code>, the <code>PDOException</code> can be caught and handled gracefully if you choose to do so.</li>
</ul>
<p><strong>Good read</strong> :</p>
<ul>
<li>Errors and error handling ¶</li>
<li>The PDOException class ¶</li>
<li>Exceptions ¶</li>
</ul>
<p>Like:</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="nt">stmt-</span><span class="o">&gt;</span><span class="nt">setAttribute</span><span class="o">(</span><span class="w"> </span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ATTR_ERRMODE</span><span class="o">,</span><span class="w"> </span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ERRMODE_SILENT</span><span class="w"> </span><span class="o">);</span>
<span class="o">$</span><span class="nt">stmt-</span><span class="o">&gt;</span><span class="nt">setAttribute</span><span class="o">(</span><span class="w"> </span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ATTR_ERRMODE</span><span class="o">,</span><span class="w"> </span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ERRMODE_WARNING</span><span class="w"> </span><span class="o">);</span>
<span class="o">$</span><span class="nt">stmt-</span><span class="o">&gt;</span><span class="nt">setAttribute</span><span class="o">(</span><span class="w"> </span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ATTR_ERRMODE</span><span class="o">,</span><span class="w"> </span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ERRMODE_EXCEPTION</span><span class="w"> </span><span class="o">);</span>
</pre></div>

<p>And you can wrap it in <code>try</code>-<code>catch</code>, like below:</p>
<div class="code"><pre class="code literal-block"><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//Connect as appropriate as above</span>
<span class="w">    </span><span class="err">$</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">query</span><span class="p">(</span><span class="s">'hi'</span><span class="p">);</span><span class="w"> </span><span class="c1">//Invalid query!</span>
<span class="p">}</span><span class="w"> </span>
<span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">PDOException</span><span class="w"> </span><span class="err">$</span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">echo</span><span class="w"> </span><span class="s">"An Error occured!"</span><span class="p">;</span><span class="w"> </span><span class="c1">//User friendly message/message you want to show to user</span>
<span class="w">    </span><span class="n">some_logging_function</span><span class="p">(</span><span class="err">$</span><span class="n">ex</span><span class="o">-&gt;</span><span class="n">getMessage</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>

<p>You do not have to handle with <code>try</code>-<code>catch</code> right now. You can catch it at
any time appropriate, but I strongly recommend you to use <code>try</code>-<code>catch</code>. Also
it may make more sense to catch it at outside the function that calls the
<code>PDO</code> stuff:</p>
<div class="code"><pre class="code literal-block"><span class="nt">function</span><span class="w"> </span><span class="nt">data_fun</span><span class="o">($</span><span class="nt">db</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">$stmt</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">$db-&gt;query("SELECT</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">FROM</span><span class="w"> </span><span class="err">table")</span><span class="p">;</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">$stmt-&gt;fetchAll(</span><span class="n">PDO</span><span class="p">:</span><span class="o">:</span><span class="n">FETCH_ASSOC</span><span class="p">);</span>
<span class="p">}</span>

<span class="o">//</span><span class="nt">Then</span><span class="w"> </span><span class="nt">later</span>
<span class="nt">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">data_fun($db)</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">catch</span><span class="o">(</span><span class="nt">PDOException</span><span class="w"> </span><span class="o">$</span><span class="nt">ex</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">//Here</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">can</span><span class="w"> </span><span class="err">handle</span><span class="w"> </span><span class="err">error</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">show</span><span class="w"> </span><span class="err">message/perform</span><span class="w"> </span><span class="err">action</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">want.</span>
<span class="p">}</span>
</pre></div>

<p>Also, you can handle by <code>or die()</code> or we can say like <code>mysql_*</code>, but it will
be really varied. You can hide the dangerous error messages in production by
turning <code>display_errors off</code> and just reading your error log.</p>
<p>Now, after reading all the things above, you are probably thinking: what the
heck is that when I just want to start leaning simple <code>SELECT</code>, <code>INSERT</code>,
<code>UPDATE</code>, or <code>DELETE</code> statements? Don't worry, here we go:</p>
<hr>
<h3>Selecting Data</h3>
<p><img alt="PDO select image" src="images/AhIlC.png"></p>
<p>So what you are doing in <code>mysql_*</code> is:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s1">'SELECT * from table'</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="nb">mysql_error</span><span class="p">());</span>

<span class="nv">$num_rows</span> <span class="o">=</span> <span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>

<span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Now in <code>PDO</code>, you can do this like:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT * FROM table'</span><span class="p">);</span>

<span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>Or</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT * FROM table'</span><span class="p">);</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>

<span class="c1">//Use $results</span>
</pre></div>

<p><strong>Note</strong> : If you are using the method like below (<code>query()</code>), this method
returns a <code>PDOStatement</code> object. So if you want to fetch the result, use it
like above.</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT * FROM table'</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'field1'</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>

<p>In PDO Data, it is obtained via the <code>-&gt;fetch()</code>, a method of your statement
handle. Before calling fetch, the best approach would be telling PDO how you’d
like the data to be fetched. In the below section I am explaining this.</p>
<h3>Fetch Modes</h3>
<p>Note the use of <code>PDO::FETCH_ASSOC</code> in the <code>fetch()</code> and <code>fetchAll()</code> code
above. This tells <code>PDO</code> to return the rows as an associative array with the
field names as keys. There are many other fetch modes too which I will explain
one by one.</p>
<p>First of all, I explain how to select fetch mode:</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="err">$</span><span class="n">stmt</span><span class="o">-&gt;</span><span class="nf">fetch</span><span class="p">(</span><span class="n">PDO</span><span class="o">::</span><span class="n">FETCH_ASSOC</span><span class="p">)</span>
</pre></div>

<p>In the above, I have been using <code>fetch()</code>. You can also use:</p>
<ul>
<li>
<code>PDOStatement::fetchAll()</code> - Returns an array containing all of the result set rows</li>
<li>
<code>PDOStatement::fetchColumn()</code> - Returns a single column from the next row of a result set</li>
<li>
<code>PDOStatement::fetchObject()</code> - Fetches the next row and returns it as an object.</li>
<li>
<code>PDOStatement::setFetchMode()</code> - Set the default fetch mode for this statement</li>
</ul>
<p>Now I come to fetch mode:</p>
<ul>
<li>
<code>PDO::FETCH_ASSOC</code>: returns an array indexed by column name as returned in your result set</li>
<li>
<code>PDO::FETCH_BOTH</code> (default): returns an array indexed by both column name and 0-indexed column number as returned in your result set</li>
</ul>
<p>There are even more choices! Read about them all in <code>PDOStatement</code> Fetch
documentation..</p>
<p><strong>Getting the row count</strong> :</p>
<p>Instead of using <code>mysql_num_rows</code> to get the number of returned rows, you can
get a <code>PDOStatement</code> and do <code>rowCount()</code>, like:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">'SELECT * FROM table'</span><span class="p">);</span>
<span class="nv">$row_count</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">rowCount</span><span class="p">();</span>
<span class="k">echo</span> <span class="nv">$row_count</span><span class="o">.</span><span class="s1">' rows selected'</span><span class="p">;</span>
</pre></div>

<p><strong>Getting the Last Inserted ID</strong></p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s2">"INSERT INTO table(firstname, lastname) VAULES('John', 'Doe')"</span><span class="p">);</span>
<span class="nv">$insertId</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span>
</pre></div>

<hr>
<h3>Insert and Update or Delete statements</h3>
<p><img alt="Insert and update PDO image" src="images/yQhPC.png"></p>
<p>What we are doing in <code>mysql_*</code> function is:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s2">"UPDATE table SET field='value'"</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="nb">mysql_error</span><span class="p">());</span>
<span class="k">echo</span> <span class="nb">mysql_affected_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</pre></div>

<p>And in pdo, this same thing can be done by:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="nv">$affected_rows</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s2">"UPDATE table SET field='value'"</span><span class="p">);</span>
<span class="k">echo</span> <span class="nv">$affected_rows</span><span class="p">;</span>
</pre></div>

<p>In the above query <code>PDO::exec</code> execute an SQL statement and returns the number
of affected rows.</p>
<p><em>Insert and delete will be covered later.</em></p>
<p>The above method is only useful when you are not using variable in query. But
when you need to use a variable in a query, do not ever ever try like the
above and there for <strong>prepared statement or parameterized statement</strong> is.</p>
<hr>
<h3><strong>Prepared Statements</strong></h3>
<p><strong>Q.</strong> What is a prepared statement and why do I need them?<br><strong>A.</strong> A prepared statement is a pre-compiled SQL statement that can be
executed multiple times by sending only the data to the server.  </p>
<p>The typical workflow of using a prepared statement is as follows (quoted from
Wikipedia three 3 point):</p>
<ol>
<li>
<strong>Prepare</strong> : The statement template is created by the application and sent to the database management system (DBMS). Certain values are left unspecified, called parameters, placeholders or bind variables (labelled <code>?</code> below):</li>
</ol>
<p><code>INSERT INTO PRODUCT (name, price) VALUES (?, ?)</code></p>
<ol>
<li>
<p>The DBMS parses, compiles, and performs query optimization on the statement template, and stores the result without executing it.</p>
</li>
<li>
<p><strong>Execute</strong> : At a later time, the application supplies (or binds) values for the parameters, and the DBMS executes the statement (possibly returning a result). The application may execute the statement as many times as it wants with different values. In this example, it might supply 'Bread' for the first parameter and <code>1.00</code> for the second parameter.</p>
</li>
</ol>
<p>You can use a prepared statement by including placeholders in your SQL. There
are basically three ones without placeholders (don't try this with variable
its above one), one with unnamed placeholders, and one with named
placeholders.</p>
<p><strong>Q.</strong> So now, what are named placeholders and how do I use them?<br><strong>A.</strong> Named placeholders. Use descriptive names preceded by a colon, instead
of question marks. We don't care about position/order of value in name place
holder:</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="err">$</span><span class="n">stmt</span><span class="o">-&gt;</span><span class="n">bindParam</span><span class="p">(</span><span class="s">':bla'</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">bla</span><span class="p">);</span>
</pre></div>

<p><code>bindParam(parameter,variable,data_type,length,driver_options)</code></p>
<p>You can also bind using an execute array as well:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">"SELECT * FROM table WHERE id=:id AND name=:name"</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">':name'</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">,</span> <span class="s1">':id'</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">));</span>
<span class="nv">$rows</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
</pre></div>

<p>Another nice feature for <code>OOP</code> friends is that named placeholders have the
ability to insert objects directly into your database, assuming the properties
match the named fields. For example:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="o">$</span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="o">$</span><span class="n">add</span><span class="p">;</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">__construct</span><span class="p">(</span><span class="o">$</span><span class="n">a</span><span class="p">,</span><span class="o">$</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">a</span><span class="p">;</span>
<span class="w">        </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
<span class="o">$</span><span class="n">demo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">person</span><span class="p">(</span><span class="s1">'john'</span><span class="p">,</span><span class="s1">'29 bla district'</span><span class="p">);</span>
<span class="o">$</span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">prepare</span><span class="p">(</span><span class="s2">"INSERT INTO table (name, add) value (:name, :add)"</span><span class="p">);</span>
<span class="o">$</span><span class="n">stmt</span><span class="o">-&gt;</span><span class="n">execute</span><span class="p">((</span><span class="n">array</span><span class="p">)</span><span class="o">$</span><span class="n">demo</span><span class="p">);</span>
</pre></div>

<p><strong>Q.</strong> So now, what are unnamed placeholders and how do I use them?<br><strong>A.</strong> Let's have an example:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">"INSERT INTO folks (name, add) values (?, ?)"</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$name</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_STR</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">bindValue</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$add</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">PARAM_STR</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>

<p>and</p>
<div class="code"><pre class="code literal-block"><span class="err">$</span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">prepare</span><span class="p">(</span><span class="s">"INSERT INTO folks (name, add) values (?, ?)"</span><span class="p">);</span>
<span class="err">$</span><span class="n">stmt</span><span class="o">-&gt;</span><span class="n">execute</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="s">'john'</span><span class="p">,</span><span class="w"> </span><span class="s">'29 bla district'</span><span class="p">));</span>
</pre></div>

<p>In the above, you can see those <code>?</code> instead of a name like in a name place
holder. Now in the first example, we assign variables to the various
placeholders (<code>$stmt-&gt;bindValue(1, $name, PDO::PARAM_STR);</code>). Then, we assign
values to those placeholders and execute the statement. In the second example,
the first array element goes to the first <code>?</code> and the second to the second
<code>?</code>.</p>
<p><strong>NOTE</strong> : In <strong>unnamed placeholders</strong> we must take care of the proper order
of the elements in the array that we are passing to the
<code>PDOStatement::execute()</code> method.</p>
<hr>
<h3>
<code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code> prepared queries</h3>
<ol>
<li>
<p><strong><code>SELECT</code></strong> :</p>
<div class="code"><pre class="code literal-block"><span class="err">$</span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">prepare</span><span class="p">(</span><span class="s">"SELECT * FROM table WHERE id=:id AND name=:name"</span><span class="p">);</span>
</pre></div>

<p>$stmt-&gt;execute(array(':name' =&gt; $name, ':id' =&gt; $id));
$rows = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);</p>
</li>
<li>
<p><strong><code>INSERT</code></strong> :</p>
<div class="code"><pre class="code literal-block"><span class="err">$</span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">prepare</span><span class="p">(</span><span class="s">"INSERT INTO table(field1,field2) VALUES(:field1,:field2)"</span><span class="p">);</span>
</pre></div>

<p>$stmt-&gt;execute(array(':field1' =&gt; $field1, ':field2' =&gt; $field2));
$affected_rows = $stmt-&gt;rowCount();</p>
</li>
<li>
<p><strong><code>DELETE</code></strong> :</p>
<div class="code"><pre class="code literal-block"><span class="err">$</span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">prepare</span><span class="p">(</span><span class="s">"DELETE FROM table WHERE id=:id"</span><span class="p">);</span>
</pre></div>

<p>$stmt-&gt;bindValue(':id', $id, PDO::PARAM_STR);
$stmt-&gt;execute();
$affected_rows = $stmt-&gt;rowCount();</p>
</li>
<li>
<p><strong><code>UPDATE</code></strong> :</p>
<div class="code"><pre class="code literal-block"><span class="err">$</span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">db</span><span class="o">-&gt;</span><span class="n">prepare</span><span class="p">(</span><span class="s">"UPDATE table SET name=? WHERE id=?"</span><span class="p">);</span>
</pre></div>

<p>$stmt-&gt;execute(array($name, $id));
$affected_rows = $stmt-&gt;rowCount();</p>
</li>
</ol>
<hr>
<h3><strong>NOTE:</strong></h3>
<p>However <code>PDO</code> and/or <code>MySQLi</code> are not completely safe. Check the answer <em>Are
PDO prepared statements sufficient to prevent SQL injection?</em> by ircmaxell.
Also, I am quoting some part from his answer:</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="nt">pdo-</span><span class="o">&gt;</span><span class="nt">setAttribute</span><span class="o">(</span><span class="nt">PDO</span><span class="p">::</span><span class="nd">ATTR_EMULATE_PREPARES</span><span class="o">,</span><span class="w"> </span><span class="nt">false</span><span class="o">);</span>
<span class="o">$</span><span class="nt">pdo-</span><span class="o">&gt;</span><span class="nt">query</span><span class="o">(</span><span class="s1">'SET NAMES GBK'</span><span class="o">);</span>
<span class="o">$</span><span class="nt">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="nt">pdo-</span><span class="o">&gt;</span><span class="nt">prepare</span><span class="o">(</span><span class="s2">"SELECT * FROM test WHERE name = ? LIMIT 1"</span><span class="o">);</span>
<span class="o">$</span><span class="nt">stmt-</span><span class="o">&gt;</span><span class="nt">execute</span><span class="o">(</span><span class="nt">array</span><span class="o">(</span><span class="nt">chr</span><span class="o">(</span><span class="nt">0xbf</span><span class="o">)</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="nt">chr</span><span class="o">(</span><span class="nt">0x27</span><span class="o">)</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="s2">" OR 1=1 /*"</span><span class="o">));</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/homebrew-install-specific-version-of-formula/" class="u-url">Homebrew install specific version of formula?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/homebrew-install-specific-version-of-formula/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T20:47:33+08:00" itemprop="datePublished" title="2023-02-16 20:47">2023-02-16 20:47</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I install a specific version of a formula in homebrew? For example,
postgresql-8.4.4 instead of the latest 9.0.</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>TLDR:</strong> <code>brew install postgresql@8.4.4</code> See answer below for more details.</p>
<hr>
<p>*( <em>I’ve re-edited my answer to give a more thorough workflow for installing/using older software versions with homebrew. Feel free to add a note if you found the old version better.</em> )</p>
<p>Let’s start with the simplest case:</p>
<h3>1) Check, whether the version is already installed (but not activated)</h3>
<p>When homebrew installs a new formula, it puts it in a versioned directory like
<code>/usr/local/Cellar/postgresql/9.3.1</code>. Only symbolic links to this folder are
then installed globally. In principle, this makes it pretty easy to switch
between two installed versions. (*)</p>
<p>If you have been using homebrew for longer and never removed older versions
(using, for example <code>brew cleanup</code>), chances are that some older version of
your program may still be around. If you want to simply activate that previous
version, <code>brew switch</code> is the easiest way to do this.</p>
<p>Check with <code>brew info postgresql</code> (or <code>brew switch postgresql &lt;TAB&gt;</code>) whether
the older version is installed:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>brew<span class="w"> </span>info<span class="w"> </span>postgresql
postgresql:<span class="w"> </span>stable<span class="w"> </span><span class="m">9</span>.3.2<span class="w"> </span><span class="o">(</span>bottled<span class="o">)</span>
http://www.postgresql.org/
Conflicts<span class="w"> </span>with:<span class="w"> </span>postgres-xc
/usr/local/Cellar/postgresql/9.1.5<span class="w"> </span><span class="o">(</span><span class="m">2755</span><span class="w"> </span>files,<span class="w"> </span>37M<span class="o">)</span>
<span class="w">  </span>Built<span class="w"> </span>from<span class="w"> </span><span class="nb">source</span>
/usr/local/Cellar/postgresql/9.3.2<span class="w"> </span><span class="o">(</span><span class="m">2924</span><span class="w"> </span>files,<span class="w"> </span>39M<span class="o">)</span><span class="w"> </span>*
<span class="w">  </span>Poured<span class="w"> </span>from<span class="w"> </span>bottle
From:<span class="w"> </span>https://github.com/Homebrew/homebrew/commits/master/Library/Formula/postgresql.rb
<span class="c1"># … and some more</span>
</pre></div>

<p>We see that some older version is already installed. We may activate it using
<code>brew switch</code>:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>brew<span class="w"> </span>switch<span class="w"> </span>postgresql<span class="w"> </span><span class="m">9</span>.1.5
Cleaning<span class="w"> </span>/usr/local/Cellar/postgresql/9.1.5
Cleaning<span class="w"> </span>/usr/local/Cellar/postgresql/9.3.2
<span class="m">384</span><span class="w"> </span>links<span class="w"> </span>created<span class="w"> </span><span class="k">for</span><span class="w"> </span>/usr/local/Cellar/postgresql/9.1.5
</pre></div>

<p>Let’s double-check what is activated:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>brew<span class="w"> </span>info<span class="w"> </span>postgresql
postgresql:<span class="w"> </span>stable<span class="w"> </span><span class="m">9</span>.3.2<span class="w"> </span><span class="o">(</span>bottled<span class="o">)</span>
http://www.postgresql.org/
Conflicts<span class="w"> </span>with:<span class="w"> </span>postgres-xc
/usr/local/Cellar/postgresql/9.1.5<span class="w"> </span><span class="o">(</span><span class="m">2755</span><span class="w"> </span>files,<span class="w"> </span>37M<span class="o">)</span><span class="w"> </span>*
<span class="w">  </span>Built<span class="w"> </span>from<span class="w"> </span><span class="nb">source</span>
/usr/local/Cellar/postgresql/9.3.2<span class="w"> </span><span class="o">(</span><span class="m">2924</span><span class="w"> </span>files,<span class="w"> </span>39M<span class="o">)</span>
<span class="w">  </span>Poured<span class="w"> </span>from<span class="w"> </span>bottle
From:<span class="w"> </span>https://github.com/Homebrew/homebrew/commits/master/Library/Formula/postgresql.rb
<span class="c1"># … and some more</span>
</pre></div>

<p>Note that the star <code>*</code> has moved to the newly activated version</p>
<p>(*) <em>Please note that<code>brew switch</code> only works as long as all dependencies of
the older version are still around. In some cases, a rebuild of the older
version may become necessary. Therefore, using <code>brew switch</code> is mostly useful
when one wants to switch between two versions not too far apart.</em></p>
<h3>2) Check, whether the version is available as a tap</h3>
<p>Especially for larger software projects, it is very probably that there is a
high enough demand for several (potentially API incompatible) major versions
of a certain piece of software. As of March 2012, Homebrew 0.9 provides a
mechanism for this: <code>brew tap</code> &amp; the homebrew versions repository.</p>
<p>That versions repository may include backports of older versions for several
formulae. (Mostly only the large and famous ones, but of course they’ll also
have several formulae for postgresql.)</p>
<p><code>brew search postgresql</code> will show you where to look:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>brew<span class="w"> </span>search<span class="w"> </span>postgresql
postgresql
homebrew/versions/postgresql8<span class="w">    </span>homebrew/versions/postgresql91
homebrew/versions/postgresql9<span class="w">    </span>homebrew/versions/postgresql92
</pre></div>

<p>We can simply install it by typing</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="w"> </span><span class="n">brew</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">homebrew</span><span class="o">/</span><span class="n">versions</span><span class="o">/</span><span class="n">postgresql8</span>
<span class="n">Cloning</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="s1">'/usr/local/Library/Taps/homebrew-versions'</span><span class="o">...</span>
<span class="k">remote</span><span class="p">:</span><span class="w"> </span><span class="n">Counting</span><span class="w"> </span><span class="n">objects</span><span class="p">:</span><span class="w"> </span><span class="mi">1563</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="o">.</span>
<span class="k">remote</span><span class="p">:</span><span class="w"> </span><span class="n">Compressing</span><span class="w"> </span><span class="n">objects</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="mi">943</span><span class="o">/</span><span class="mi">943</span><span class="p">),</span><span class="w"> </span><span class="n">done</span><span class="o">.</span>
<span class="k">remote</span><span class="p">:</span><span class="w"> </span><span class="n">Total</span><span class="w"> </span><span class="mi">1563</span><span class="w"> </span><span class="p">(</span><span class="n">delta</span><span class="w"> </span><span class="mi">864</span><span class="p">),</span><span class="w"> </span><span class="n">reused</span><span class="w"> </span><span class="mi">1272</span><span class="w"> </span><span class="p">(</span><span class="n">delta</span><span class="w"> </span><span class="mi">620</span><span class="p">)</span>
<span class="n">Receiving</span><span class="w"> </span><span class="n">objects</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="mi">1563</span><span class="o">/</span><span class="mi">1563</span><span class="p">),</span><span class="w"> </span><span class="mf">422.83</span><span class="w"> </span><span class="n">KiB</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">339.00</span><span class="w"> </span><span class="n">KiB</span><span class="o">/</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="o">.</span>
<span class="n">Resolving</span><span class="w"> </span><span class="n">deltas</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="mi">864</span><span class="o">/</span><span class="mi">864</span><span class="p">),</span><span class="w"> </span><span class="n">done</span><span class="o">.</span>
<span class="n">Checking</span><span class="w"> </span><span class="n">connectivity</span><span class="o">...</span><span class="w"> </span><span class="n">done</span><span class="o">.</span>
<span class="n">Tapped</span><span class="w"> </span><span class="mi">125</span><span class="w"> </span><span class="n">formula</span>
<span class="o">==&gt;</span><span class="w"> </span><span class="n">Downloading</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ftp</span><span class="o">.</span><span class="n">postgresql</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">pub</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">v8</span><span class="o">.</span><span class="mf">4.19</span><span class="o">/</span><span class="n">postgresql</span><span class="o">-</span><span class="mf">8.4</span><span class="o">.</span><span class="mf">19.</span><span class="n">tar</span><span class="o">.</span><span class="n">bz2</span>
<span class="c1"># …</span>
</pre></div>

<p>Note that this has automatically <em>tapped</em> the <code>homebrew/versions</code> tap. (Check
with <code>brew tap</code>, remove with <code>brew untap homebrew/versions</code>.) The following
would have been equivalent:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>brew<span class="w"> </span>tap<span class="w"> </span>homebrew/versions
$<span class="w"> </span>brew<span class="w"> </span>install<span class="w"> </span>postgresql8
</pre></div>

<p>As long as the backported version formulae stay up-to-date, this approach is
probably the best way to deal with older software.</p>
<h3>3) Try some formula from the past</h3>
<p>The following approaches are listed mostly for completeness. Both try to
resurrect some undead formula from the brew repository. Due to changed
dependencies, API changes in the formula spec or simply a change in the
download URL, things may or may not work.</p>
<p>Since the whole formula directory is a git repository, one can install
specific versions using plain git commands. However, we need to find a way to
get to a commit where the old version was available.</p>
<p><strong>a) historic times</strong></p>
<p>Between <strong>August 2011 and October 2014</strong> , homebrew had a <code>brew versions</code>
command, which spat out all available versions with their respective SHA
hashes. As of October 2014, you have to do a <code>brew tap homebrew/boneyard</code>
before you can use it. As the name of the tap suggests, you should probably
only do this as a last resort.</p>
<p>E.g.</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>brew<span class="w"> </span>versions<span class="w"> </span>postgresql
Warning:<span class="w"> </span>brew-versions<span class="w"> </span>is<span class="w"> </span>unsupported<span class="w"> </span>and<span class="w"> </span>may<span class="w"> </span>be<span class="w"> </span>removed<span class="w"> </span>soon.
Please<span class="w"> </span>use<span class="w"> </span>the<span class="w"> </span>homebrew-versions<span class="w"> </span>tap<span class="w"> </span>instead:
<span class="w">  </span>https://github.com/Homebrew/homebrew-versions
<span class="m">9</span>.3.2<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>3c86d2b<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.3.1<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>a267a3e<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.3.0<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>ae59e09<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.2.4<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>e3ac215<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.2.3<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>c80b37c<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.2.2<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>9076baa<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.2.1<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>5825f62<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.2.0<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>2f6cbc6<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.1.5<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>6b8d25f<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.1.4<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>c40c7bf<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.1.3<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>05c7954<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.1.2<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>dfcc838<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.1.1<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>4ef8fb0<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.0.4<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>2accac4<span class="w"> </span>Library/Formula/postgresql.rb
<span class="m">9</span>.0.3<span class="w">    </span>git<span class="w"> </span>checkout<span class="w"> </span>b782d9d<span class="w"> </span>Library/Formula/postgresql.rb
</pre></div>

<p>As you can see, it advises against using it. Homebrew spits out all versions
it can find with its internal heuristic and shows you a way to retrieve the
old formulae. Let’s try it.</p>
<div class="code"><pre class="code literal-block"><span class="err">#</span><span class="w"> </span><span class="k">First</span><span class="p">,</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">homebrew</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="n">directory</span>
<span class="err">$</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="w"> </span><span class="n">brew</span><span class="w"> </span><span class="o">--</span><span class="k">prefix</span><span class="w"> </span><span class="p">)</span>
<span class="err">#</span><span class="w"> </span><span class="n">Checkout</span><span class="w"> </span><span class="ow">some</span><span class="w"> </span><span class="k">old</span><span class="w"> </span><span class="n">formula</span>
<span class="err">$</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">checkout</span><span class="w"> </span><span class="mi">6</span><span class="n">b8d25f</span><span class="w"> </span><span class="n">Library</span><span class="o">/</span><span class="n">Formula</span><span class="o">/</span><span class="n">postgresql</span><span class="p">.</span><span class="n">rb</span>
<span class="err">$</span><span class="w"> </span><span class="n">brew</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">postgresql</span>
<span class="err">#</span><span class="w"> </span><span class="err">…</span><span class="w"> </span><span class="n">installing</span>
</pre></div>

<p>Now that the older postgresql version is installed, we can re-install the
latest formula in order to keep our repository clean:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>--<span class="w"> </span>Library/Formula/postgresql.rb
</pre></div>

<p><code>brew switch</code> is your friend to change between the old and the new.</p>
<p><strong>b) prehistoric times</strong></p>
<p>For special needs, we may also try our own digging through the homebrew repo.</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>Library/Taps/homebrew/homebrew-core<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>git<span class="w"> </span>log<span class="w"> </span>-S<span class="s1">'8.4.4'</span><span class="w"> </span>--<span class="w"> </span>Formula/postgresql.rb
</pre></div>

<p><code>git log -S</code> looks for all commits in which the string <code>'8.4.4'</code> was either
added or removed in the file <code>Library/Taps/homebrew/homebrew-
core/Formula/postgresql.rb</code>. We get two commits as a result.</p>
<div class="code"><pre class="code literal-block">commit 7dc7ccef9e1ab7d2fc351d7935c96a0e0b031552
Author: Aku Kotkavuo
Date:   Sun Sep 19 18:03:41 2010 +0300

    Update PostgreSQL to 9.0.0.

    Signed-off-by: Adam Vandenberg

commit fa992c6a82eebdc4cc36a0c0d2837f4c02f3f422
Author: David Höppner
Date:   Sun May 16 12:35:18 2010 +0200

    postgresql: update version to 8.4.4
</pre></div>

<p>Obviously, <code>fa992c6a82eebdc4cc36a0c0d2837f4c02f3f422</code> is the commit we’re
interested in. As this commit is pretty old, we’ll try to downgrade the
complete homebrew installation (that way, the formula API is more or less
guaranteed to be valid):</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>postgresql-8.4.4<span class="w"> </span>fa992c6a82eebdc4cc36a0c0d2837f4c02f3f422
$<span class="w"> </span>brew<span class="w"> </span>install<span class="w"> </span>postgresql
$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>master
$<span class="w"> </span>git<span class="w"> </span>branch<span class="w"> </span>-d<span class="w"> </span>postgresql-8.4.4
</pre></div>

<p>You may skip the last command to keep the reference in your git repository.</p>
<p>One note: When checking out the older commit, you temporarily downgrade your
homebrew installation. So, you should be careful as some commands in homebrew
might be different to the most recent version.</p>
<h3>4) Manually write a formula</h3>
<p>It’s not too hard and you may then upload it to your own repository. Used to
be Homebrew-Versions, but that is now discontinued.</p>
<h3>A.) Bonus: Pinning</h3>
<p>If you want to keep a certain version of, say postgresql, around and stop it
from being updated when you do the natural <code>brew update; brew upgrade</code>
procedure, you can <em>pin</em> a formula:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>brew<span class="w"> </span>pin<span class="w"> </span>postgresql
</pre></div>

<p>Pinned formulae are listed in <code>/usr/local/Library/PinnedKegs/</code> and once you
want to bring in the latest changes and updates, you can <em>unpin</em> it again:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>brew<span class="w"> </span>unpin<span class="w"> </span>postgresql
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<h2>Simple Workflow</h2>
<p>Now that Homebrew/versions has been deprecated, Homebrew/core supports a few
versions of formulae with a new naming format.</p>
<p>To install a specific version, e.g. postgresql 9.5 you simply run:</p>
<div class="code"><pre class="code literal-block"><span class="n">$</span><span class="w"> </span><span class="n">brew</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">postgresql</span><span class="mf">@9.5</span>
</pre></div>

<p>To list the available versions run a search with @:</p>
<div class="code"><pre class="code literal-block"><span class="n">$</span><span class="w"> </span><span class="n">brew</span><span class="w"> </span><span class="n">search</span><span class="w"> </span><span class="n">postgresql</span><span class="p">@</span>
<span class="o">==&gt;</span><span class="w"> </span><span class="n">Searching</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">taps</span><span class="p">...</span>
<span class="n">postgresql</span><span class="mf">@10.1</span><span class="w"> </span><span class="err">✔</span><span class="w">     </span><span class="n">postgresql</span><span class="mf">@9.4</span><span class="w">        </span><span class="n">postgresql</span><span class="mf">@9.5</span><span class="w">        </span><span class="n">postgresql</span><span class="mf">@9.6</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-refresh-a-page-using-javascript/" class="u-url">How do I refresh a page using JavaScript?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-refresh-a-page-using-javascript/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T20:46:58+08:00" itemprop="datePublished" title="2023-02-16 20:46">2023-02-16 20:46</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I refresh a page using JavaScript?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Use <code>location.reload()</code>.</p>
<p>For example, to reload whenever an element with <code>id="something"</code> is clicked:</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="p">(</span><span class="s1">'#something'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">location</span><span class="o">.</span><span class="n">reload</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>The <code>reload()</code> function takes an optional parameter that can be set to <code>true</code>
to force a reload from the server rather than the cache. The parameter
defaults to <code>false</code>, so by default the page may reload from the browser's
cache.</p>
<p><br></p>
<h3>Suggest</h3>
<p>There are <del>multiple</del> unlimited ways to refresh a page with JavaScript:</p>
<ol>
<li><code>location.reload()</code></li>
<li><code>history.go(0)</code></li>
<li><code>location.href = location.href</code></li>
<li><code>location.href = location.pathname</code></li>
<li><code>location.replace(location.pathname)</code></li>
<li><code>location.reload(false)</code></li>
</ol>
<blockquote>
<p>If we needed to pull the document from the web-server again (such as where
the document contents change dynamically) we would pass the argument as
<code>true</code>.</p>
</blockquote>
<p>You can continue the list being creative:</p>
<ul>
<li><code>window.location = window.location</code></li>
<li><code>window.self.window.self.window.window.location = window.location</code></li>
<li>
<p>...and other 534 ways</p>
<p>var methods = [
  "location.reload()",
  "history.go(0)",
  "location.href = location.href",
  "location.href = location.pathname",
  "location.replace(location.pathname)",
  "location.reload(false)"
];</p>
<p>var $body = $("body");
for (var i = 0; i &lt; methods.length; ++i) {
  (function(cMethod) {
    $body.append($("<button>", {
      text: cMethod
    }).on("click", function() {
      eval(cMethod); // don't blame me for using eval
    }));
  })(methods[i]);
}</button></p>
<p>button {
  background: #2ecc71;
  border: 0;
  color: white;
  font-weight: bold;
  font-family: "Monaco", monospace;
  padding: 10px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.5s ease;
  margin: 2px;
}
button:hover {
  background: #27ae60;
}</p>
<p><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script></p>
</li>
</ul>
</div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-86.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-84.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
