<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 494) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-494.html">
<link rel="prev" href="index-495.html" type="text/html">
<link rel="next" href="index-493.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-generate-a-stream-from-a-string/" class="u-url">How do I generate a stream from a string?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-generate-a-stream-from-a-string/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T08:16:25+08:00" itemprop="datePublished" title="2023-02-17 08:16">2023-02-17 08:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I need to write a unit test for a method that takes a stream which comes from
a text file. I would like to do do something like this:</p>
<div class="code"><pre class="code literal-block">Stream s = GenerateStreamFromString("a,b \n c,d");
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Stream</span><span class="w"> </span><span class="n">GenerateStreamFromString</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MemoryStream</span><span class="p">();</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">StreamWriter</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
<span class="w">    </span><span class="n">writer</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="w">    </span><span class="n">writer</span><span class="o">.</span><span class="n">Flush</span><span class="p">();</span>
<span class="w">    </span><span class="n">stream</span><span class="o">.</span><span class="n">Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">stream</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Don't forget to use Using:</p>
<div class="code"><pre class="code literal-block"><span class="n">using</span><span class="w"> </span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GenerateStreamFromString</span><span class="p">(</span><span class="s2">"a,b </span><span class="se">\n</span><span class="s2"> c,d"</span><span class="p">))</span>
<span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="n">stuff</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">stream</span>
<span class="p">}</span>
</pre></div>

<hr>
<p>About the <code>StreamWriter</code> not being disposed. <code>StreamWriter</code> is just a wrapper
around the base stream, and doesn't use any resources that need to be
disposed. The <code>Dispose</code> method will close the underlying <code>Stream</code> that
<code>StreamWriter</code> is writing to. In this case that is the <code>MemoryStream</code> we want
to return.</p>
<p>In .NET 4.5 there is now an overload for <code>StreamWriter</code> that keeps the
underlying stream open after the writer is disposed of, but this code does the
same thing and works with other versions of .NET too.</p>
<p>See Is there any way to close a StreamWriter without closing its BaseStream?</p>
<p><br></p>
<h3>Suggest</h3>
<p>Another solution:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">MemoryStream</span><span class="w"> </span><span class="nv">GenerateStreamFromString</span><span class="ss">(</span><span class="nv">string</span><span class="w"> </span><span class="nv">value</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">MemoryStream</span><span class="ss">(</span><span class="nv">Encoding</span>.<span class="nv">UTF8</span>.<span class="nv">GetBytes</span><span class="ss">(</span><span class="nv">value</span><span class="w"> </span>??<span class="w"> </span><span class="s2">""</span><span class="ss">))</span><span class="c1">;</span>
}
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/swift-beta-performance-sorting-arrays/" class="u-url">Swift Beta performance: sorting arrays</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/swift-beta-performance-sorting-arrays/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T08:15:58+08:00" itemprop="datePublished" title="2023-02-17 08:15">2023-02-17 08:15</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I was implementing an algorithm in Swift Beta and noticed that the performance
was very poor. After digging deeper I realized that one of the bottlenecks was
something as simple as sorting arrays. The relevant part is here:</p>
<div class="code"><pre class="code literal-block"><span class="n">let</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000000</span>
<span class="nf">var</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="o">[</span><span class="n">Int</span><span class="o">]</span><span class="p">(</span><span class="nl">repeating</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nf">count</span><span class="err">:</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mf">0.</span><span class="p">.</span><span class="o">&lt;</span><span class="n">n</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">random</span><span class="p">()</span>
<span class="err">}</span>
<span class="o">//</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="n">clock</span><span class="w"> </span><span class="n">here</span>
<span class="n">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="o">//</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">clock</span><span class="w"> </span><span class="n">here</span>
</pre></div>

<p>In C++, a similar operation takes <strong>0.06s</strong> on my computer.</p>
<p>In Python, it takes <strong>0.6s</strong> (no tricks, just y = sorted(x) for a list of
integers).</p>
<p>In Swift it takes <strong>6s</strong> if I compile it with the following command:</p>
<div class="code"><pre class="code literal-block"><span class="nv">xcrun</span><span class="w"> </span><span class="nv">swift</span><span class="w"> </span><span class="o">-</span><span class="nv">O3</span><span class="w"> </span><span class="o">-</span><span class="nv">sdk</span><span class="w"> </span>`<span class="nv">xcrun</span><span class="w"> </span><span class="o">--</span><span class="k">show</span><span class="o">-</span><span class="nv">sdk</span><span class="o">-</span><span class="nv">path</span><span class="w"> </span><span class="o">--</span><span class="nv">sdk</span><span class="w"> </span><span class="nv">macosx</span>`
</pre></div>

<p>And it takes as much as <strong>88s</strong> if I compile it with the following command:</p>
<div class="code"><pre class="code literal-block"><span class="nv">xcrun</span><span class="w"> </span><span class="nv">swift</span><span class="w"> </span><span class="o">-</span><span class="nv">O0</span><span class="w"> </span><span class="o">-</span><span class="nv">sdk</span><span class="w"> </span>`<span class="nv">xcrun</span><span class="w"> </span><span class="o">--</span><span class="k">show</span><span class="o">-</span><span class="nv">sdk</span><span class="o">-</span><span class="nv">path</span><span class="w"> </span><span class="o">--</span><span class="nv">sdk</span><span class="w"> </span><span class="nv">macosx</span>`
</pre></div>

<p>Timings in Xcode with "Release" vs. "Debug" builds are similar.</p>
<p>What is wrong here? I could understand some performance loss in comparison
with C++, but not a 10-fold slowdown in comparison with pure Python.</p>
<hr>
<p><strong>Edit:</strong> weather noticed that changing <code>-O3</code> to <code>-Ofast</code> makes this code run
almost as fast as the C++ version! However, <code>-Ofast</code> changes the semantics of
the language a lot — in my testing, it <strong>disabled the checks for integer
overflows and array indexing overflows</strong>. For example, with <code>-Ofast</code> the
following Swift code runs silently without crashing (and prints out some
garbage):</p>
<div class="code"><pre class="code literal-block"><span class="n">let</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000000</span>
<span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
<span class="n">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="o">[</span><span class="n">Int</span><span class="o">]</span><span class="p">(</span><span class="nl">repeating</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nf">count</span><span class="err">:</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="o">[</span><span class="n">n</span><span class="o">]</span><span class="p">)</span>
</pre></div>

<p>So <code>-Ofast</code> is not what we want; the whole point of Swift is that we have the
safety nets in place. Of course, the safety nets have some impact on the
performance, but they should not make the programs 100 times slower. Remember
that Java already checks for array bounds, and in typical cases, the slowdown
is by a factor much less than 2. And in Clang and GCC we have got <code>-ftrapv</code>
for checking (signed) integer overflows, and it is not that slow, either.</p>
<p>Hence the question: how can we get reasonable performance in Swift without
losing the safety nets?</p>
<hr>
<p><strong>Edit 2:</strong> I did some more benchmarking, with very simple loops along the
lines of</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mf">0.</span><span class="p">.</span><span class="o">&lt;</span><span class="n">n</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="mi">12345678</span>
<span class="err">}</span>
</pre></div>

<p>(Here the xor operation is there just so that I can more easily find the
relevant loop in the assembly code. I tried to pick an operation that is easy
to spot but also "harmless" in the sense that it should not require any checks
related to integer overflows.)</p>
<p>Again, there was a huge difference in the performance between <code>-O3</code> and
<code>-Ofast</code>. So I had a look at the assembly code:</p>
<ul>
<li>
<p>With <code>-Ofast</code> I get pretty much what I would expect. The relevant part is a loop with 5 machine language instructions.</p>
</li>
<li>
<p>With <code>-O3</code> I get something that was beyond my wildest imagination. The inner loop spans 88 lines of assembly code. I did not try to understand all of it, but the most suspicious parts are 13 invocations of "callq _swift_retain" and another 13 invocations of "callq _swift_release". That is, <strong>26 subroutine calls in the inner loop</strong>!</p>
</li>
</ul>
<hr>
<p><strong>Edit 3:</strong> In comments, Ferruccio asked for benchmarks that are fair in the
sense that they do not rely on built-in functions (e.g. sort). I think the
following program is a fairly good example:</p>
<div class="code"><pre class="code literal-block"><span class="n">let</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000</span>
<span class="nf">var</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">Int</span><span class="o">]</span><span class="p">(</span><span class="nl">repeating</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nf">count</span><span class="err">:</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mf">0.</span><span class="p">.</span><span class="o">&lt;</span><span class="n">n</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mf">0.</span><span class="p">.</span><span class="o">&lt;</span><span class="n">n</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">x</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">[</span><span class="n">j</span><span class="o">]</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>There is no arithmetic, so we do not need to worry about integer overflows.
The only thing that we do is just lots of array references. And the results
are here—Swift -O3 loses by a factor almost 500 in comparison with -Ofast:</p>
<ul>
<li>C++ -O3: <strong>0.05 s</strong>
</li>
<li>C++ -O0: 0.4 s</li>
<li>Java: <strong>0.2 s</strong>
</li>
<li>Python with PyPy: 0.5 s</li>
<li>Python: <strong>12 s</strong>
</li>
<li>Swift -Ofast: 0.05 s</li>
<li>Swift -O3: <strong>23 s</strong>
</li>
<li>Swift -O0: 443 s</li>
</ul>
<p>(If you are concerned that the compiler might optimize out the pointless loops
entirely, you can change it to e.g. <code>x[i] ^= x[j]</code>, and add a print statement
that outputs <code>x[0]</code>. This does not change anything; the timings will be very
similar.)</p>
<p>And yes, here the Python implementation was a stupid pure Python
implementation with a list of ints and nested for loops. It should be <strong>much</strong>
slower than unoptimized Swift. Something seems to be seriously broken with
Swift and array indexing.</p>
<hr>
<p><strong>Edit 4:</strong> These issues (as well as some other performance issues) seems to
have been fixed in Xcode 6 beta 5.</p>
<p>For sorting, I now have the following timings:</p>
<ul>
<li>clang++ -O3: 0.06 s</li>
<li>swiftc -Ofast: 0.1 s</li>
<li>swiftc -O: 0.1 s</li>
<li>swiftc: 4 s</li>
</ul>
<p>For nested loops:</p>
<ul>
<li>clang++ -O3: 0.06 s</li>
<li>swiftc -Ofast: 0.3 s</li>
<li>swiftc -O: 0.4 s</li>
<li>swiftc: 540 s</li>
</ul>
<p>It seems that there is no reason anymore to use the unsafe <code>-Ofast</code> (a.k.a.
<code>-Ounchecked</code>); plain <code>-O</code> produces equally good code.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>tl;dr Swift 1.0 is now as fast as C by this benchmark using the default
release optimisation level [-O].</p>
<hr>
<p>Here is an in-place quicksort in Swift Beta:</p>
<div class="code"><pre class="code literal-block"><span class="k">func</span><span class="w"> </span><span class="n">quicksort_swift</span><span class="p">(</span><span class="n">inout</span><span class="w"> </span><span class="n">a</span><span class="p">:</span><span class="n">CInt</span><span class="p">[],</span><span class="w"> </span><span class="n">start</span><span class="p">:</span><span class="n">Int</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="p">:</span><span class="n">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">){</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">){</span>
<span class="w">            </span><span class="n">l</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">continue</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">){</span>
<span class="w">            </span><span class="n">r</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">            </span><span class="k">continue</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
<span class="w">        </span><span class="n">a</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
<span class="w">        </span><span class="n">a</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span>
<span class="w">        </span><span class="n">l</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="n">r</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">quicksort_swift</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">quicksort_swift</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

<p>And the same in C:</p>
<div class="code"><pre class="code literal-block"><span class="nv">void</span><span class="w"> </span><span class="nv">quicksort_c</span><span class="ss">(</span><span class="nv">int</span><span class="w"> </span><span class="o">*</span><span class="nv">a</span>,<span class="w"> </span><span class="nv">int</span><span class="w"> </span><span class="nv">n</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="ss">)</span>
<span class="w">        </span><span class="k">return</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">int</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">a</span>[<span class="nv">n</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>]<span class="c1">;</span>
<span class="w">    </span><span class="nv">int</span><span class="w"> </span><span class="o">*</span><span class="nv">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">a</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">int</span><span class="w"> </span><span class="o">*</span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="c1">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="ss">(</span><span class="nv">l</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nv">r</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="o">*</span><span class="nv">l</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">p</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">l</span><span class="o">++</span><span class="c1">;</span>
<span class="w">            </span><span class="k">continue</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="o">*</span><span class="nv">r</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">p</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">r</span><span class="o">--</span><span class="c1">;</span>
<span class="w">            </span><span class="k">continue</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">        </span><span class="nv">int</span><span class="w"> </span><span class="nv">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="nv">l</span><span class="c1">;</span>
<span class="w">        </span><span class="o">*</span><span class="nv">l</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="nv">r</span><span class="c1">;</span>
<span class="w">        </span><span class="o">*</span><span class="nv">r</span><span class="o">--</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">t</span><span class="c1">;</span>
<span class="w">    </span>}
<span class="w">    </span><span class="nv">quicksort_c</span><span class="ss">(</span><span class="nv">a</span>,<span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">quicksort_c</span><span class="ss">(</span><span class="nv">l</span>,<span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">l</span><span class="ss">)</span><span class="c1">;</span>
}
</pre></div>

<p>Both work:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">a_swift</span><span class="p">:</span><span class="n">CInt</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1234</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="k">var</span><span class="w"> </span><span class="n">a_c</span><span class="p">:</span><span class="n">CInt</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1234</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

<span class="n">quicksort_swift</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a_swift</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">a_swift</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
<span class="n">quicksort_c</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a_c</span><span class="p">,</span><span class="w"> </span><span class="n">CInt</span><span class="p">(</span><span class="n">a_c</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>

<span class="o">//</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">1234</span><span class="p">]</span>
<span class="o">//</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">1234</span><span class="p">]</span>
</pre></div>

<p>Both are called in the same program as written.</p>
<div class="code"><pre class="code literal-block"><span class="nf">var</span><span class="w"> </span><span class="n">x_swift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CInt</span><span class="err">[]</span><span class="p">(</span><span class="nf">count</span><span class="err">:</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="nl">repeatedValue</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="nf">var</span><span class="w"> </span><span class="n">x_c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CInt</span><span class="err">[]</span><span class="p">(</span><span class="nf">count</span><span class="err">:</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="nl">repeatedValue</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="k">for</span><span class="w"> </span><span class="nf">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">x_swift</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CInt</span><span class="p">(</span><span class="n">random</span><span class="p">())</span>
<span class="w">    </span><span class="n">x_c</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CInt</span><span class="p">(</span><span class="n">random</span><span class="p">())</span>
<span class="err">}</span>

<span class="n">let</span><span class="w"> </span><span class="nl">swift_start</span><span class="p">:</span><span class="n">UInt64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mach_absolute_time</span><span class="p">();</span>
<span class="n">quicksort_swift</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x_swift</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">x_swift</span><span class="p">.</span><span class="nf">count</span><span class="p">)</span>
<span class="n">let</span><span class="w"> </span><span class="nl">swift_stop</span><span class="p">:</span><span class="n">UInt64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mach_absolute_time</span><span class="p">();</span>

<span class="n">let</span><span class="w"> </span><span class="nl">c_start</span><span class="p">:</span><span class="n">UInt64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mach_absolute_time</span><span class="p">();</span>
<span class="n">quicksort_c</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x_c</span><span class="p">,</span><span class="w"> </span><span class="n">CInt</span><span class="p">(</span><span class="n">x_c</span><span class="p">.</span><span class="nf">count</span><span class="p">))</span>
<span class="n">let</span><span class="w"> </span><span class="nl">c_stop</span><span class="p">:</span><span class="n">UInt64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mach_absolute_time</span><span class="p">();</span>
</pre></div>

<p>This converts the absolute times to seconds:</p>
<div class="code"><pre class="code literal-block"><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">uint64_t</span><span class="w"> </span><span class="n">NANOS_PER_USEC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="n">ULL</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">uint64_t</span><span class="w"> </span><span class="n">NANOS_PER_MSEC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="n">ULL</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NANOS_PER_USEC</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">uint64_t</span><span class="w"> </span><span class="n">NANOS_PER_SEC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="n">ULL</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NANOS_PER_MSEC</span><span class="p">;</span>

<span class="n">mach_timebase_info_data_t</span><span class="w"> </span><span class="n">timebase_info</span><span class="p">;</span>

<span class="n">uint64_t</span><span class="w"> </span><span class="n">abs_to_nanos</span><span class="p">(</span><span class="n">uint64_t</span><span class="w"> </span><span class="nb">abs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">timebase_info</span><span class="o">.</span><span class="n">denom</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">(</span><span class="nb nb-Type">void</span><span class="p">)</span><span class="n">mach_timebase_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timebase_info</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">abs</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">timebase_info</span><span class="o">.</span><span class="n">numer</span><span class="w">  </span><span class="o">/</span><span class="w"> </span><span class="n">timebase_info</span><span class="o">.</span><span class="n">denom</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">double</span><span class="w"> </span><span class="n">abs_to_seconds</span><span class="p">(</span><span class="n">uint64_t</span><span class="w"> </span><span class="nb">abs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">abs_to_nanos</span><span class="p">(</span><span class="nb">abs</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">double</span><span class="p">)</span><span class="n">NANOS_PER_SEC</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Here is a summary of the compiler's optimazation levels:</p>
<div class="code"><pre class="code literal-block">[<span class="o">-</span><span class="nv">Onone</span>]<span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">optimizations</span>,<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">default</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">debug</span>.
[<span class="o">-</span><span class="nv">O</span>]<span class="w">     </span><span class="nv">perform</span><span class="w"> </span><span class="nv">optimizations</span>,<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">default</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">release</span>.
[<span class="o">-</span><span class="nv">Ofast</span>]<span class="w"> </span><span class="nv">perform</span><span class="w"> </span><span class="nv">optimizations</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">disable</span><span class="w"> </span><span class="nv">runtime</span><span class="w"> </span><span class="nv">overflow</span><span class="w"> </span><span class="nv">checks</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">runtime</span><span class="w"> </span><span class="nv">type</span><span class="w"> </span><span class="nv">checks</span>.
</pre></div>

<p>Time in seconds with <strong>[-Onone]</strong> for <strong>n=10_000</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="n">Swift</span><span class="o">:</span><span class="w">            </span><span class="mf">0.895296452</span>
<span class="n">C</span><span class="o">:</span><span class="w">                </span><span class="mf">0.001223848</span>
</pre></div>

<p>Here is Swift's builtin sort() for <strong>n=10_000</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="n">Swift_builtin</span><span class="o">:</span><span class="w">    </span><span class="mf">0.77865783</span>
</pre></div>

<p>Here is <strong>[-O]</strong> for <strong>n=10_000</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="n">Swift</span><span class="o">:</span><span class="w">            </span><span class="mf">0.045478346</span>
<span class="n">C</span><span class="o">:</span><span class="w">                </span><span class="mf">0.000784666</span>
<span class="n">Swift_builtin</span><span class="o">:</span><span class="w">    </span><span class="mf">0.032513488</span>
</pre></div>

<p>As you can see, Swift's performance improved by a factor of 20.</p>
<p>As per mweathers' answer, setting <strong>[-Ofast]</strong> makes the real difference,
resulting in these times for <strong>n=10_000</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="n">Swift</span><span class="o">:</span><span class="w">            </span><span class="mf">0.000706745</span>
<span class="n">C</span><span class="o">:</span><span class="w">                </span><span class="mf">0.000742374</span>
<span class="n">Swift_builtin</span><span class="o">:</span><span class="w">    </span><span class="mf">0.000603576</span>
</pre></div>

<p>And for <strong>n=1_000_000</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="n">Swift</span><span class="o">:</span><span class="w">            </span><span class="mf">0.107111846</span>
<span class="n">C</span><span class="o">:</span><span class="w">                </span><span class="mf">0.114957179</span>
<span class="n">Swift_sort</span><span class="o">:</span><span class="w">       </span><span class="mf">0.092688548</span>
</pre></div>

<p>For comparison, this is with <strong>[-Onone]</strong> for <strong>n=1_000_000</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="n">Swift</span><span class="o">:</span><span class="w">            </span><span class="mf">142.659763258</span>
<span class="n">C</span><span class="o">:</span><span class="w">                </span><span class="mf">0.162065333</span>
<span class="n">Swift_sort</span><span class="o">:</span><span class="w">       </span><span class="mf">114.095478272</span>
</pre></div>

<p>So Swift with no optimizations was almost 1000x slower than C in this
benchmark, at this stage in its development. On the other hand with both
compilers set to [-Ofast] Swift actually performed at least as well if not
slightly better than C.</p>
<p>It has been pointed out that [-Ofast] changes the semantics of the language,
making it potentially unsafe. This is what Apple states in the Xcode 5.0
release notes:</p>
<blockquote>
<p>A new optimization level -Ofast, available in LLVM, enables aggressive
optimizations. -Ofast relaxes some conservative restrictions, mostly for
floating-point operations, that are safe for most code. It can yield
significant high-performance wins from the compiler.</p>
</blockquote>
<p>They all but advocate it. Whether that's wise or not I couldn't say, but from
what I can tell it seems reasonable enough to use [-Ofast] in a release if
you're not doing high-precision floating point arithmetic and you're confident
no integer or array overflows are possible in your program. If you do need
high performance <em>and</em> overflow checks / precise arithmetic then choose
another language for now.</p>
<p>BETA 3 UPDATE:</p>
<p><strong>n=10_000</strong> with <strong>[-O]</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="n">Swift</span><span class="o">:</span><span class="w">            </span><span class="mf">0.019697268</span>
<span class="n">C</span><span class="o">:</span><span class="w">                </span><span class="mf">0.000718064</span>
<span class="n">Swift_sort</span><span class="o">:</span><span class="w">       </span><span class="mf">0.002094721</span>
</pre></div>

<p>Swift in general is a bit faster and it looks like Swift's built-in sort has
changed quite significantly.</p>
<p><strong>FINAL UPDATE:</strong></p>
<p><strong>[-Onone]</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="n">Swift</span><span class="o">:</span><span class="w">   </span><span class="mf">0.678056695</span>
<span class="n">C</span><span class="o">:</span><span class="w">       </span><span class="mf">0.000973914</span>
</pre></div>

<p><strong>[-O]</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="n">Swift</span><span class="o">:</span><span class="w">   </span><span class="mf">0.001158492</span>
<span class="n">C</span><span class="o">:</span><span class="w">       </span><span class="mf">0.001192406</span>
</pre></div>

<p><strong>[-Ounchecked]</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="n">Swift</span><span class="o">:</span><span class="w">   </span><span class="mf">0.000827764</span>
<span class="n">C</span><span class="o">:</span><span class="w">       </span><span class="mf">0.001078914</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p><strong>TL;DR</strong> : Yes, the only Swift language implementation is slow, <em>right now</em>.
If you need fast, numeric (and other types of code, presumably) code, just go
with another one. In the future, you should re-evaluate your choice. It might
be good enough for most application code that is written at a higher level,
though.</p>
<p>From what I'm seeing in SIL and LLVM IR, it seems like they need a bunch of
optimizations for removing retains and releases, which might be implemented in
Clang (for Objective-C), but they haven't ported them yet. That's the theory
I'm going with (for now… I still need to confirm that Clang does something
about it), since a profiler run on the last test-case of this question yields
this “pretty” result:</p>
<p><img alt="Time profiling on -O3" src="https://i.imgur.com/ujaJ4aA.png"><img alt="Time profiling on
-Ofast" src="https://i.imgur.com/t0s6DsZ.png"></p>
<p>As was said by many others, <code>-Ofast</code> is totally unsafe and changes language
semantics. For me, it's at the “If you're going to use that, just use another
language” stage. I'll re-evaluate that choice later, if it changes.</p>
<p><code>-O3</code> gets us a bunch of <code>swift_retain</code> and <code>swift_release</code> calls that,
honestly, don't look like they should be there for this example. The optimizer
should have elided (most of) them AFAICT, since it knows most of the
information about the array, and knows that it has (at least) a strong
reference to it.</p>
<p>It shouldn't emit more retains when it's not even calling functions which
might release the objects. I don't think an array constructor can return an
array which is smaller than what was asked for, which means that a lot of
checks that were emitted are useless. It also knows that the integer will
never be above 10k, so the overflow checks <em>can</em> be optimized (not because of
<code>-Ofast</code> weirdness, but because of the semantics of the language (nothing else
is changing that var nor can access it, and adding up to 10k is safe for the
type <code>Int</code>).</p>
<p>The compiler might not be able to unbox the array or the array elements,
though, since they're getting passed to <code>sort()</code>, which is an external
function and has to get the arguments it's expecting. This will make us have
to use the <code>Int</code> values indirectly, which would make it go a bit slower. This
could change if the <code>sort()</code> generic function (not in the multi-method way)
was available to the compiler and got inlined.</p>
<p>This is a very new (publicly) language, and it is going through what I assume
are lots of changes, since there are people (heavily) involved with the Swift
language asking for feedback and they all say the language isn't finished and
<em>will</em> change.</p>
<p>Code used:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">Cocoa</span>

<span class="n">let</span> <span class="n">swift_start</span> <span class="o">=</span> <span class="n">NSDate</span><span class="o">.</span><span class="n">timeIntervalSinceReferenceDate</span><span class="p">();</span>
<span class="n">let</span> <span class="n">n</span><span class="p">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Int</span><span class="p">[](</span><span class="n">count</span><span class="p">:</span> <span class="n">n</span><span class="p">,</span> <span class="n">repeatedValue</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="mf">0.</span><span class="o">.</span><span class="n">n</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="mf">0.</span><span class="o">.</span><span class="n">n</span> <span class="p">{</span>
        <span class="n">let</span> <span class="n">tmp</span><span class="p">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">let</span> <span class="n">y</span><span class="p">:</span> <span class="n">Int</span><span class="p">[]</span> <span class="o">=</span> <span class="n">sort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">let</span> <span class="n">swift_stop</span> <span class="o">=</span> <span class="n">NSDate</span><span class="o">.</span><span class="n">timeIntervalSinceReferenceDate</span><span class="p">();</span>

<span class="n">println</span><span class="p">(</span><span class="s2">"\(swift_stop - swift_start)s"</span><span class="p">)</span>
</pre></div>

<p>P.S: I'm not an expert on Objective-C nor all the facilities from Cocoa,
Objective-C, or the Swift runtimes. I might also be assuming some things that
I didn't write.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jslint-is-suddenly-reporting-use-the-function-form-of-use-strict/" class="u-url">JSLint is suddenly reporting: Use the function form of "use strict"</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/jslint-is-suddenly-reporting-use-the-function-form-of-use-strict/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T08:15:33+08:00" itemprop="datePublished" title="2023-02-17 08:15">2023-02-17 08:15</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I include the statement:</p>
<div class="code"><pre class="code literal-block">"use strict";
</pre></div>

<p>at the beginning of most of my Javascript files.</p>
<p>JSLint has never before warned about this. But now it is, saying:</p>
<blockquote>
<p>Use the function form of "use strict".</p>
</blockquote>
<p>Does anyone know what the "function form" would be?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Include <code>'use strict';</code> as the first statement in a wrapping function, so it
only affects that function. This prevents problems when concatenating scripts
that aren't strict.</p>
<p>See Douglas Crockford's latest blog post Strict Mode Is Coming To Town.</p>
<p>Example from that post:</p>
<div class="code"><pre class="code literal-block">(function () {
   'use strict';
   // this function is strict...
}());

(function () {
   // but this function is sloppy...
}());
</pre></div>

<p><strong>Update:</strong> In case you don't want to wrap in immediate function (e.g. it is a
node module), then you can disable the warning.</p>
<p>For <strong>JSLint</strong> (per Zhami):</p>
<div class="code"><pre class="code literal-block"><span class="o">/*</span><span class="n">jslint</span><span class="w"> </span><span class="n">node</span><span class="p">:</span><span class="w"> </span><span class="n">true</span><span class="w"> </span><span class="o">*/</span>
</pre></div>

<p>For <strong>JSHint</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="o">/*</span><span class="n">jshint</span><span class="w"> </span><span class="n">strict</span><span class="p">:</span><span class="n">false</span><span class="w"> </span><span class="o">*/</span>
</pre></div>

<p>or (per Laith Shadeed)</p>
<div class="code"><pre class="code literal-block"><span class="o">/*</span><span class="w"> </span><span class="n">jshint</span><span class="w"> </span><span class="o">-</span><span class="n">W097</span><span class="w"> </span><span class="o">*/</span>
</pre></div>

<p>To disable any arbitrary warning from JSHint, check the map in JSHint source
code (details in docs).</p>
<p><strong>Update 2:</strong> <strong>JSHint</strong> supports <code>node:boolean</code> option. See <code>.jshintrc</code> at
github.</p>
<div class="code"><pre class="code literal-block"><span class="o">/*</span><span class="w"> </span><span class="n">jshint</span><span class="w"> </span><span class="n">node</span><span class="p">:</span><span class="w"> </span><span class="n">true</span><span class="w"> </span><span class="o">*/</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>If you're writing modules for NodeJS, they are already encapsulated. Tell
JSLint that you've got node by including at the top of your file:</p>
<div class="code"><pre class="code literal-block"><span class="o">/*</span><span class="n">jslint</span><span class="w"> </span><span class="n">node</span><span class="p">:</span><span class="w"> </span><span class="n">true</span><span class="w"> </span><span class="o">*/</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-495.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-493.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
