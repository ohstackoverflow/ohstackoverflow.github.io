<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 437) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-437.html">
<link rel="prev" href="index-438.html" type="text/html">
<link rel="next" href="index-436.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-are-c-functors-and-their-uses/" class="u-url">What are C++ functors and their uses?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-are-c-functors-and-their-uses/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T06:50:19+08:00" itemprop="datePublished" title="2023-02-17 06:50">2023-02-17 06:50</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I keep hearing a lot about functors in C++. Can someone give me an overview as
to what they are and in what cases they would be useful?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>A functor is pretty much just a class which defines the operator(). That lets
you create objects which "look like" a function:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">functor</span>
<span class="n">struct</span><span class="w"> </span><span class="n">add_x</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="n">add_x</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="err">{}</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="k">Constructor</span>
<span class="w">  </span><span class="nc">int</span><span class="w"> </span><span class="n">operator</span><span class="p">()(</span><span class="nc">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="err">}</span>

<span class="nl">private</span><span class="p">:</span>
<span class="w">  </span><span class="nc">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="err">}</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">Now</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="ow">like</span><span class="w"> </span><span class="nl">this</span><span class="p">:</span>
<span class="n">add_x</span><span class="w"> </span><span class="n">add42</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">functor</span><span class="w"> </span><span class="k">class</span>
<span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add42</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ss">"call"</span><span class="w"> </span><span class="n">it</span>
<span class="n">assert</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">50</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">argument</span>

<span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="nc">int</span><span class="o">&gt;</span><span class="w"> </span><span class="ow">in</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">assume</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">bunch</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">values</span><span class="p">)</span>
<span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="nc">int</span><span class="o">&gt;</span><span class="w"> </span><span class="k">out</span><span class="p">(</span><span class="ow">in</span><span class="p">.</span><span class="k">size</span><span class="p">());</span>
<span class="o">//</span><span class="w"> </span><span class="n">Pass</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">functor</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">transform</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">functor</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">every</span><span class="w"> </span><span class="k">element</span><span class="w"> </span>
<span class="o">//</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="k">sequence</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">stores</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="k">sequence</span>
<span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">transform</span><span class="p">(</span><span class="ow">in</span><span class="p">.</span><span class="k">begin</span><span class="p">(),</span><span class="w"> </span><span class="ow">in</span><span class="p">.</span><span class="k">end</span><span class="p">(),</span><span class="w"> </span><span class="k">out</span><span class="p">.</span><span class="k">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">add_x</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"> </span>
<span class="n">assert</span><span class="p">(</span><span class="k">out</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ow">in</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">i</span>
</pre></div>

<p>There are a couple of nice things about functors. One is that unlike regular
functions, they can contain state. The above example creates a function which
adds 42 to whatever you give it. But that value 42 is not hardcoded, it was
specified as a constructor argument when we created our functor instance. I
could create another adder, which added 27, just by calling the constructor
with a different value. This makes them nicely customizable.</p>
<p>As the last lines show, you often pass functors as arguments to other
functions such as std::transform or the other standard library algorithms. You
could do the same with a regular function pointer except, as I said above,
functors can be "customized" because they contain state, making them more
flexible (If I wanted to use a function pointer, I'd have to write a function
which added exactly 1 to its argument. The functor is general, and adds
whatever you initialized it with), and they are also potentially more
efficient. In the above example, the compiler knows exactly which function
<code>std::transform</code> should call. It should call <code>add_x::operator()</code>. That means
it can inline that function call. And that makes it just as efficient as if I
had manually called the function on each value of the vector.</p>
<p>If I had passed a function pointer instead, the compiler couldn't immediately
see which function it points to, so unless it performs some fairly complex
global optimizations, it'd have to dereference the pointer at runtime, and
then make the call.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Little addition. You can use <code>boost::function</code>, to create functors from
functions and methods, like this:</p>
<div class="code"><pre class="code literal-block"><span class="nt">class</span><span class="w"> </span><span class="nt">Foo</span>
<span class="p">{</span>
<span class="n">public</span><span class="p">:</span>
<span class="w">    </span><span class="n">void</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="nf">printf</span><span class="p">(</span><span class="s2">"Foo %d"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="err">}</span><span class="o">;</span>
<span class="nt">void</span><span class="w"> </span><span class="nt">Bar</span><span class="o">(</span><span class="nt">int</span><span class="w"> </span><span class="nt">i</span><span class="o">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">printf("Bar</span><span class="w"> </span><span class="err">%d",</span><span class="w"> </span><span class="err">i)</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="nt">Foo</span><span class="w"> </span><span class="nt">foo</span><span class="o">;</span>
<span class="nt">boost</span><span class="p">::</span><span class="nd">function</span><span class="o">&lt;</span><span class="nt">void</span><span class="w"> </span><span class="o">(</span><span class="nt">int</span><span class="o">)&gt;</span><span class="w"> </span><span class="nt">f</span><span class="o">(</span><span class="nt">foo</span><span class="o">);//</span><span class="nt">wrap</span><span class="w"> </span><span class="nt">functor</span>
<span class="nt">f</span><span class="o">(</span><span class="nt">1</span><span class="o">);//</span><span class="nt">prints</span><span class="w"> </span><span class="s2">"Foo 1"</span>
<span class="nt">boost</span><span class="p">::</span><span class="nd">function</span><span class="o">&lt;</span><span class="nt">void</span><span class="w"> </span><span class="o">(</span><span class="nt">int</span><span class="o">)&gt;</span><span class="w"> </span><span class="nt">b</span><span class="o">(&amp;</span><span class="nt">Bar</span><span class="o">);//</span><span class="nt">wrap</span><span class="w"> </span><span class="nt">normal</span><span class="w"> </span><span class="nt">function</span>
<span class="nt">b</span><span class="o">(</span><span class="nt">1</span><span class="o">);//</span><span class="nt">prints</span><span class="w"> </span><span class="s2">"Bar 1"</span>
</pre></div>

<p>and you can use boost::bind to add state to this functor</p>
<div class="code"><pre class="code literal-block"><span class="nt">boost</span><span class="p">::</span><span class="nd">function</span><span class="o">&lt;</span><span class="nt">void</span><span class="w"> </span><span class="o">()&gt;</span><span class="w"> </span><span class="nt">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">boost</span><span class="p">::</span><span class="nd">bind</span><span class="o">(</span><span class="nt">foo</span><span class="o">,</span><span class="w"> </span><span class="nt">2</span><span class="o">);</span>
<span class="nt">f1</span><span class="o">();//</span><span class="nt">no</span><span class="w"> </span><span class="nt">more</span><span class="w"> </span><span class="nt">argument</span><span class="o">,</span><span class="w"> </span><span class="nt">function</span><span class="w"> </span><span class="nt">argument</span><span class="w"> </span><span class="nt">stored</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nt">f1</span>
<span class="o">//</span><span class="nt">and</span><span class="w"> </span><span class="nt">this</span><span class="w"> </span><span class="nt">print</span><span class="w"> </span><span class="s2">"Foo 2"</span><span class="w"> </span><span class="o">(:</span>
<span class="o">//</span><span class="nt">and</span><span class="w"> </span><span class="nt">normal</span><span class="w"> </span><span class="nt">function</span>
<span class="nt">boost</span><span class="p">::</span><span class="nd">function</span><span class="o">&lt;</span><span class="nt">void</span><span class="w"> </span><span class="o">()&gt;</span><span class="w"> </span><span class="nt">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">boost</span><span class="p">::</span><span class="nd">bind</span><span class="o">(&amp;</span><span class="nt">Bar</span><span class="o">,</span><span class="w"> </span><span class="nt">2</span><span class="o">);</span>
<span class="nt">b1</span><span class="o">();//</span><span class="w"> </span><span class="nt">print</span><span class="w"> </span><span class="s2">"Bar 2"</span>
</pre></div>

<p>and most useful, with boost::bind and boost::function you can create functor
from class method, actually this is a delegate:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">SomeClass</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="w"> </span><span class="n">state_</span><span class="p">;</span>
<span class="n">public</span><span class="p">:</span>
<span class="w">    </span><span class="n">SomeClass</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">state_</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">method</span><span class="p">(</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="p">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">state_</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="n">SomeClass</span><span class="w"> </span><span class="o">*</span><span class="n">inst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SomeClass</span><span class="p">(</span><span class="s2">"Hi, i am "</span><span class="p">);</span>
<span class="n">boost</span><span class="p">::</span><span class="n">function</span><span class="o">&lt;</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">callback</span><span class="p">;</span>
<span class="n">callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">boost</span><span class="p">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">SomeClass</span><span class="p">::</span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">inst</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">);</span><span class="o">//</span><span class="n">create</span><span class="w"> </span><span class="n">delegate</span>
<span class="o">//</span><span class="n">_1</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">placeholder</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">holds</span><span class="w"> </span><span class="n">plase</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">parameter</span>
<span class="n">callback</span><span class="p">(</span><span class="s2">"useless"</span><span class="p">);</span><span class="o">//</span><span class="nb">prints</span><span class="w"> </span><span class="s2">"Hi, i am useless"</span>
</pre></div>

<p>You can create list or vector of functors</p>
<div class="code"><pre class="code literal-block"><span class="nt">std</span><span class="p">::</span><span class="nd">list</span><span class="o">&lt;</span><span class="w"> </span><span class="nt">boost</span><span class="p">::</span><span class="nd">function</span><span class="o">&lt;</span><span class="nt">void</span><span class="w"> </span><span class="o">(</span><span class="nt">EventArg</span><span class="w"> </span><span class="nt">e</span><span class="o">)&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nt">events</span><span class="o">;</span>
<span class="o">//</span><span class="nt">add</span><span class="w"> </span><span class="nt">some</span><span class="w"> </span><span class="nt">events</span>
<span class="o">....</span>
<span class="o">//</span><span class="nt">call</span><span class="w"> </span><span class="nt">them</span>
<span class="nt">std</span><span class="p">::</span><span class="nd">for_each</span><span class="o">(</span>
<span class="w">        </span><span class="nt">events</span><span class="p">.</span><span class="nc">begin</span><span class="o">(),</span><span class="w"> </span><span class="nt">events</span><span class="p">.</span><span class="nc">end</span><span class="o">(),</span><span class="w"> </span>
<span class="w">        </span><span class="nt">boost</span><span class="p">::</span><span class="nd">bind</span><span class="o">(</span><span class="w"> </span><span class="nt">boost</span><span class="p">::</span><span class="nd">apply</span><span class="o">&lt;</span><span class="nt">void</span><span class="o">&gt;(),</span><span class="w"> </span><span class="nt">_1</span><span class="o">,</span><span class="w"> </span><span class="nt">e</span><span class="o">));</span>
</pre></div>

<p>There is one problem with all this stuff, compiler error messages is not human
readable :)</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/search-text-in-stored-procedure-in-sql-server/" class="u-url">Search text in stored procedure in SQL Server</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/search-text-in-stored-procedure-in-sql-server/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T06:49:52+08:00" itemprop="datePublished" title="2023-02-17 06:49">2023-02-17 06:49</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to search a text from all my database stored procedures. I use the
below SQL:</p>
<div class="code"><pre class="code literal-block"><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
<span class="w">       </span><span class="n">o</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nf">Object_Name</span><span class="p">,</span>
<span class="w">       </span><span class="n">o</span><span class="p">.</span><span class="n">type_desc</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">sql_modules</span><span class="w"> </span><span class="n">m</span>
<span class="w">       </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span>
<span class="w">       </span><span class="n">sys</span><span class="p">.</span><span class="n">objects</span><span class="w"> </span><span class="n">o</span>
<span class="w">         </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="nf">object_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="nf">object_id</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">definition</span><span class="w"> </span><span class="ow">Like</span><span class="w"> </span><span class="s1">'%[ABD]%'</span><span class="p">;</span>
</pre></div>

<p>I want to search for <code>[ABD]</code> in all stored procedures including square
brackets, but it's not giving the proper result. How can I change my query to
achieve this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Escape the square brackets:</p>
<div class="code"><pre class="code literal-block">...
WHERE m.definition Like '%\[ABD\]%' ESCAPE '\'
</pre></div>

<p>Then the square brackets will be treated as a string literals not as wild
cards.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Try this request:</p>
<p><strong>Query</strong></p>
<div class="code"><pre class="code literal-block">SELECT name
FROM   sys.procedures
WHERE  Object_definition(object_id) LIKE '%strHell%'
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-do-insert-if-not-exists-in-mysql/" class="u-url">How can I do 'insert if not exists' in MySQL?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-do-insert-if-not-exists-in-mysql/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T06:49:26+08:00" itemprop="datePublished" title="2023-02-17 06:49">2023-02-17 06:49</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I started by googling and found the article <em>How to write INSERT if NOT EXISTS
queries in standard SQL</em> which talks about mutex tables.</p>
<p>I have a table with ~14 million records. If I want to add more data in the
same format, is there a way to ensure the record I want to insert does not
already exist without using a pair of queries (i.e., one query to check and
one to insert is the result set is empty)?</p>
<p>Does a <code>unique</code> constraint on a field guarantee the <code>insert</code> will fail if it's
already there?</p>
<p>It seems that with <em>merely</em> a constraint, when I issue the insert via PHP, the
script croaks.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Use <code>INSERT IGNORE INTO table</code>.</p>
<p>There's also <code>INSERT … ON DUPLICATE KEY UPDATE</code> syntax, and you can find
explanations in <em>13.2.6.2 INSERT ... ON DUPLICATE KEY UPDATE Statement</em>.</p>
<hr>
<p><strong>Post from bogdan.org.ua according to Google's webcache:</strong></p>
<blockquote>
<p>18th October 2007</p>
<p>To start: as of the latest MySQL, syntax presented in the title is not
possible. But there are several very easy ways to accomplish what is
expected using existing functionality.</p>
<p>There are 3 possible solutions: using INSERT IGNORE, REPLACE, or INSERT … ON
DUPLICATE KEY UPDATE.</p>
<p>Imagine we have a table:</p>
<div class="code"><pre class="code literal-block"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n n-Quoted">`transcripts`</span><span class="w"> </span><span class="p">(</span>
<span class="n n-Quoted">`ensembl_transcript_id`</span><span class="w"> </span><span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="n n-Quoted">`transcript_chrom_start`</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">unsigned</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="n n-Quoted">`transcript_chrom_end`</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">unsigned</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`ensembl_transcript_id`</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="k">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CHARSET</span><span class="o">=</span><span class="n">latin1</span><span class="p">;</span>
</pre></div>

<p>Now imagine that we have an automatic pipeline importing transcripts meta-
data from Ensembl, and that due to various reasons the pipeline might be
broken at any step of execution. Thus, we need to ensure two things:</p>
<ol>
<li>
<p>repeated executions of the pipeline will not destroy our &gt; database
</p>
</li>
<li>
<p>repeated executions will not die due to ‘duplicate &gt; primary key’
errors.
</p>
</li>
</ol>
<p><strong>Method 1: using REPLACE</strong></p>
<p>It’s very simple:</p>
<div class="code"><pre class="code literal-block"><span class="k">REPLACE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n n-Quoted">`transcripts`</span>
<span class="k">SET</span><span class="w"> </span><span class="n n-Quoted">`ensembl_transcript_id`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ENSORGT00000000001'</span><span class="p">,</span>
<span class="n n-Quoted">`transcript_chrom_start`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span>
<span class="n n-Quoted">`transcript_chrom_end`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12678</span><span class="p">;</span>
</pre></div>

<p>If the record exists, it will be overwritten; if it does not yet exist, it
will be created. However, using this method isn’t efficient for our case: we
do not need to overwrite existing records, it’s fine just to skip them.</p>
<p><strong>Method 2: using INSERT IGNORE Also very simple:</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">INSERT</span><span class="w"> </span><span class="k">IGNORE</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n n-Quoted">`transcripts`</span>
<span class="k">SET</span><span class="w"> </span><span class="n n-Quoted">`ensembl_transcript_id`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ENSORGT00000000001'</span><span class="p">,</span>
<span class="n n-Quoted">`transcript_chrom_start`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span>
<span class="n n-Quoted">`transcript_chrom_end`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12678</span><span class="p">;</span>
</pre></div>

<p>Here, if the ‘ensembl_transcript_id’ is already present in the database, it
will be silently skipped (ignored). (To be more precise, here’s a quote from
MySQL reference manual: “If you use the IGNORE keyword, errors that occur
while executing the INSERT statement are treated as warnings instead. For
example, without IGNORE, a row that duplicates an existing UNIQUE index or
PRIMARY KEY value in the table causes a duplicate-key error and the
statement is aborted.”.) If the record doesn’t yet exist, it will be
created.</p>
<p>This second method has several potential weaknesses, including non-abortion
of the query in case any other problem occurs (see the manual). Thus it
should be used if previously tested without the IGNORE keyword.</p>
<p><strong>Method 3: using INSERT … ON DUPLICATE KEY UPDATE:</strong></p>
<p>Third option is to use <code>INSERT … ON DUPLICATE KEY UPDATE</code> syntax, and in the
UPDATE part just do nothing do some meaningless (empty) operation, like
calculating 0+0 (Geoffray suggests doing the id=id assignment for the MySQL
optimization engine to ignore this operation). Advantage of this method is
that it only ignores duplicate key events, and still aborts on other errors.</p>
<p>As a final notice: this post was inspired by Xaprb. I’d also advise to
consult his other post on writing flexible SQL queries.</p>
</blockquote>
<p><br></p>
<h3>Suggest</h3>
<p><strong>Solution:</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n n-Quoted">`table`</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`value1`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`value2`</span><span class="p">)</span><span class="w"> </span>
<span class="k">SELECT</span><span class="w"> </span><span class="s1">'stuff for value1'</span><span class="p">,</span><span class="w"> </span><span class="s1">'stuff for value2'</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">DUAL</span><span class="w"> </span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n n-Quoted">`table`</span><span class="w"> </span>
<span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="n n-Quoted">`value1`</span><span class="o">=</span><span class="s1">'stuff for value1'</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n n-Quoted">`value2`</span><span class="o">=</span><span class="s1">'stuff for value2'</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</pre></div>

<p><strong>Explanation:</strong></p>
<p>The innermost query</p>
<div class="code"><pre class="code literal-block"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n n-Quoted">`table`</span><span class="w"> </span>
<span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="n n-Quoted">`value1`</span><span class="o">=</span><span class="s1">'stuff for value1'</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n n-Quoted">`value2`</span><span class="o">=</span><span class="s1">'stuff for value2'</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">1</span>
</pre></div>

<p>used as the <code>WHERE NOT EXISTS</code>-condition detects if there already exists a row
with the data to be inserted. After one row of this kind is found, the query
may stop, hence the <code>LIMIT 1</code> (micro-optimization, may be omitted).</p>
<p>The intermediate query</p>
<div class="code"><pre class="code literal-block"><span class="nv">SELECT</span><span class="w"> </span><span class="s1">'stuff for value1'</span>,<span class="w"> </span><span class="s1">'stuff for value2'</span><span class="w"> </span><span class="nv">FROM</span><span class="w"> </span><span class="nv">DUAL</span>
</pre></div>

<p>represents the values to be inserted. <code>DUAL</code> refers to a special one row, one
column table present by default in all Oracle databases (see
https://en.wikipedia.org/wiki/DUAL_table). On a MySQL-Server version 5.7.26 I
got a valid query when omitting <code>FROM DUAL</code>, but older versions (like 5.5.60)
seem to require the <code>FROM</code> information. By using <code>WHERE NOT EXISTS</code> the
intermediate query returns an empty result set if the innermost query found
matching data.</p>
<p>The outer query</p>
<div class="code"><pre class="code literal-block"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n n-Quoted">`table`</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`value1`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`value2`</span><span class="p">)</span>
</pre></div>

<p>inserts the data, if any is returned by the intermediate query.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-438.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-436.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
