<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 390) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-390.html">
<link rel="prev" href="index-391.html" type="text/html">
<link rel="next" href="index-389.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/double-colon-operator-in-java-8/" class="u-url">:: (double colon) operator in Java 8</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/double-colon-operator-in-java-8/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:39:23+08:00" itemprop="datePublished" title="2023-02-17 05:39">2023-02-17 05:39</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I was exploring the <strong>Java 8</strong> source and found this particular part of code
very surprising:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// Defined in IntPipeline.java</span>
<span class="p">@</span><span class="n">Override</span>
<span class="n">public</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">OptionalInt</span><span class="w"> </span><span class="n">reduce</span><span class="p">(</span><span class="n">IntBinaryOperator</span><span class="w"> </span><span class="n">op</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">evaluate</span><span class="p">(</span><span class="n">ReduceOps</span><span class="p">.</span><span class="n">makeInt</span><span class="p">(</span><span class="n">op</span><span class="p">));</span>
<span class="p">}</span>

<span class="p">@</span><span class="n">Override</span>
<span class="n">public</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">OptionalInt</span><span class="w"> </span><span class="nb">max</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">reduce</span><span class="p">(</span><span class="n">Math</span><span class="p">::</span><span class="nb">max</span><span class="p">);</span><span class="w"> </span><span class="c1">// This is the gotcha line</span>
<span class="p">}</span>

<span class="c1">// Defined in Math.java</span>
<span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&gt;</span><span class="p">=</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span>?<span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Is <code>Math::max</code> something like a method pointer? How does a normal <code>static</code>
method get converted to <code>IntBinaryOperator</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Usually, one would call the <code>reduce</code> method using <code>Math.max(int, int)</code> as
follows:</p>
<div class="code"><pre class="code literal-block"><span class="nv">reduce</span><span class="ss">(</span><span class="nv">new</span><span class="w"> </span><span class="nv">IntBinaryOperator</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">int</span><span class="w"> </span><span class="nv">applyAsInt</span><span class="ss">(</span><span class="nv">int</span><span class="w"> </span><span class="nv">left</span>,<span class="w"> </span><span class="nv">int</span><span class="w"> </span><span class="nv">right</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">Math</span>.<span class="nv">max</span><span class="ss">(</span><span class="nv">left</span>,<span class="w"> </span><span class="nv">right</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}
}<span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>That requires a lot of syntax for just calling <code>Math.max</code>. That's where lambda
expressions come into play. Since Java 8 it is allowed to do the same thing in
a much shorter way:</p>
<div class="code"><pre class="code literal-block"><span class="n">reduce</span><span class="p">((</span><span class="n">int</span><span class="w"> </span><span class="kr">left</span><span class="p">,</span><span class="w"> </span><span class="n">int</span><span class="w"> </span><span class="kr">right</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="kr">left</span><span class="p">,</span><span class="w"> </span><span class="kr">right</span><span class="p">));</span>
</pre></div>

<p>How does this work? The java compiler "detects", that you want to implement a
method that accepts two <code>int</code>s and returns one <code>int</code>. This is equivalent to
the formal parameters of the one and only method of interface
<code>IntBinaryOperator</code> (the parameter of method <code>reduce</code> you want to call). So
the compiler does the rest for you - it just assumes you want to implement
<code>IntBinaryOperator</code>.</p>
<p>But as <code>Math.max(int, int)</code> itself fulfills the formal requirements of
<code>IntBinaryOperator</code>, it can be used directly. Because Java 7 does not have any
syntax that allows a method itself to be passed as an argument (you can only
pass method results, but never method references), the <code>::</code> syntax was
introduced in Java 8 to reference methods:</p>
<div class="code"><pre class="code literal-block"><span class="nt">reduce</span><span class="o">(</span><span class="nt">Math</span><span class="p">::</span><span class="nd">max</span><span class="o">);</span>
</pre></div>

<p>Note that this will be interpreted by the compiler, not by the JVM at runtime!
Although it produces different bytecodes for all three code snippets, they are
semantically equal, so the last two can be considered to be short (and
probably more efficient) versions of the <code>IntBinaryOperator</code> implementation
above!</p>
<p>(See also Translation of Lambda Expressions)</p>
<p><br></p>
<h3>Suggest</h3>
<p><code>::</code> is called a <em>method reference</em>. It is basically a reference to a single
method. I.e., it refers to an existing method by name.</p>
<p><strong>Short Explanation</strong> :</p>
<p>Below is an example of a reference to a static method:</p>
<div class="code"><pre class="code literal-block"><span class="nt">class</span><span class="w"> </span><span class="nt">Hey</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="err">public</span><span class="w"> </span><span class="err">static</span><span class="w"> </span><span class="err">double</span><span class="w"> </span><span class="err">square(double</span><span class="w"> </span><span class="err">num){</span>
<span class="w">        </span><span class="err">return</span><span class="w"> </span><span class="err">Math.pow(num,</span><span class="w"> </span><span class="err">2)</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">}</span>

<span class="nt">Function</span><span class="o">&lt;</span><span class="nt">Double</span><span class="o">,</span><span class="w"> </span><span class="nt">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">square</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">Hey</span><span class="p">::</span><span class="nd">square</span><span class="o">;</span>
<span class="nt">double</span><span class="w"> </span><span class="nt">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">square</span><span class="p">.</span><span class="nc">apply</span><span class="o">(</span><span class="nt">23d</span><span class="o">);</span>
</pre></div>

<p><code>square</code> can be passed around just like object references and triggered when
needed. In fact, it can be just as easily used as a reference to "normal"
methods of objects as <code>static</code> ones. For example:</p>
<div class="code"><pre class="code literal-block"><span class="nt">class</span><span class="w"> </span><span class="nt">Hey</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">public</span><span class="w"> </span><span class="err">double</span><span class="w"> </span><span class="err">square(double</span><span class="w"> </span><span class="err">num)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="err">return</span><span class="w"> </span><span class="err">Math.pow(num,</span><span class="w"> </span><span class="err">2)</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">}</span>

<span class="nt">Hey</span><span class="w"> </span><span class="nt">hey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Hey</span><span class="o">();</span>
<span class="nt">Function</span><span class="o">&lt;</span><span class="nt">Double</span><span class="o">,</span><span class="w"> </span><span class="nt">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">square</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">hey</span><span class="p">::</span><span class="nd">square</span><span class="o">;</span>
<span class="nt">double</span><span class="w"> </span><span class="nt">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">square</span><span class="p">.</span><span class="nc">apply</span><span class="o">(</span><span class="nt">23d</span><span class="o">);</span>
</pre></div>

<p><code>Function</code> above is a <strong>functional interface</strong>. To fully understand <code>::</code>, it
is important to understand functional interfaces as well. Plainly, a
functional interface is an interface with just one abstract method.</p>
<p>Examples of functional interfaces include <code>Runnable</code>, <code>Callable</code>, and
<code>ActionListener</code>.</p>
<p><code>Function</code> above is a functional interface with just one method: <code>apply</code>. It
takes one argument and produces a result.</p>
<hr>
<p>The reason why <code>::</code>s are awesome is that:</p>
<blockquote>
<p>Method references are expressions which have the same treatment as lambda
expressions (...), but instead of providing a method body, they refer an
existing method by name.</p>
</blockquote>
<p>E.g., instead of writing the lambda body</p>
<div class="code"><pre class="code literal-block"><span class="kr">Function</span><span class="o">&lt;</span><span class="n">Double</span><span class="p">,</span><span class="w"> </span><span class="n">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">square</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Double</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</pre></div>

<p>You can simply do</p>
<div class="code"><pre class="code literal-block"><span class="nt">Function</span><span class="o">&lt;</span><span class="nt">Double</span><span class="o">,</span><span class="w"> </span><span class="nt">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">square</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">Hey</span><span class="p">::</span><span class="nd">square</span><span class="o">;</span>
</pre></div>

<p>At runtime, these two <code>square</code> methods behave exactly the same as each other.
The bytecode may or may not be the same (though, for the above case, the same
bytecode is generated; compile the above and check with <code>javap -c</code>).</p>
<p>The only major criterion to satisfy is: the method you provide should have a
similar signature to the method of the functional interface you use as object
reference.</p>
<p>The below is illegal:</p>
<div class="code"><pre class="code literal-block"><span class="nt">Supplier</span><span class="o">&lt;</span><span class="nt">Boolean</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">Hey</span><span class="p">::</span><span class="nd">square</span><span class="o">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nt">illegal</span>
</pre></div>

<p><code>square</code> expects an argument and returns a <code>double</code>. The <code>get</code> method in
Supplier returns a value, but it does not take an argument. Thus, this results
in an error.</p>
<p>A method reference refers to the method of a functional interface. (As
mentioned, functional interfaces can have only one method each.)</p>
<p>Some more examples: the <code>accept</code> method in Consumer takes an input, but it
doesn't return anything.</p>
<div class="code"><pre class="code literal-block"><span class="nt">Consumer</span><span class="o">&lt;</span><span class="nt">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">System</span><span class="p">::</span><span class="nd">exit</span><span class="o">;</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="nt">void</span><span class="w"> </span><span class="nt">exit</span><span class="o">(</span><span class="nt">int</span><span class="w"> </span><span class="nt">status</span><span class="o">)</span>
<span class="nt">Consumer</span><span class="o">&lt;</span><span class="nt">String</span><span class="cp">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">Arrays</span><span class="p">::</span><span class="nd">sort</span><span class="o">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nt">void</span><span class="w"> </span><span class="nt">sort</span><span class="o">(</span><span class="nt">Object</span><span class="cp">[]</span><span class="w"> </span><span class="nt">a</span><span class="o">)</span>
<span class="nt">Consumer</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">b3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">MyProgram</span><span class="p">::</span><span class="nd">main</span><span class="o">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nt">void</span><span class="w"> </span><span class="nt">main</span><span class="o">(</span><span class="nt">String</span><span class="o">...</span><span class="w"> </span><span class="nt">args</span><span class="o">)</span>

<span class="nt">class</span><span class="w"> </span><span class="nt">Hey</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">public</span><span class="w"> </span><span class="err">double</span><span class="w"> </span><span class="err">getRandom()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="err">return</span><span class="w"> </span><span class="err">Math.random()</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">}</span>

<span class="nt">Callable</span><span class="o">&lt;</span><span class="nt">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">hey</span><span class="p">::</span><span class="nd">getRandom</span><span class="o">;</span>
<span class="nt">Supplier</span><span class="o">&lt;</span><span class="nt">Double</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">call2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">hey</span><span class="p">::</span><span class="nd">getRandom</span><span class="o">;</span>
<span class="nt">DoubleSupplier</span><span class="w"> </span><span class="nt">sup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">hey</span><span class="p">::</span><span class="nd">getRandom</span><span class="o">;</span>
<span class="o">//</span><span class="w"> </span><span class="nt">Supplier</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">functional</span><span class="w"> </span><span class="nt">interface</span><span class="w"> </span><span class="nt">that</span><span class="w"> </span><span class="nt">takes</span><span class="w"> </span><span class="nt">no</span><span class="w"> </span><span class="nt">argument</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">gives</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="nt">result</span>
</pre></div>

<p>Above, <code>getRandom</code> doesn't take any argument and returns a <code>double</code>. So any
functional interface that satisfies the criteria of: take no argument and
return <code>double</code> can be used.</p>
<p>Another example:</p>
<div class="code"><pre class="code literal-block"><span class="nt">Set</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">HashSet</span><span class="o">&lt;&gt;();</span>
<span class="nt">set</span><span class="p">.</span><span class="nc">addAll</span><span class="o">(</span><span class="nt">Arrays</span><span class="p">.</span><span class="nc">asList</span><span class="o">(</span><span class="s2">"leo"</span><span class="o">,</span><span class="s2">"bale"</span><span class="o">,</span><span class="s2">"hanks"</span><span class="o">));</span>
<span class="nt">Predicate</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">set</span><span class="p">::</span><span class="nd">contains</span><span class="o">;</span>
<span class="nt">boolean</span><span class="w"> </span><span class="nt">exists</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">pred</span><span class="p">.</span><span class="nc">test</span><span class="o">(</span><span class="s2">"leo"</span><span class="o">);</span>
</pre></div>

<p><strong>In case of parameterized types</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">Param</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">elem</span><span class="p">;</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">elem</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">set</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">this</span><span class="o">.</span><span class="n">elem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">elem</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="n">returnSame</span><span class="p">(</span><span class="n">E</span><span class="w"> </span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">elem</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">Supplier</span><span class="o">&lt;</span><span class="n">Param</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Param</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="p">::</span><span class="n">new</span><span class="p">;</span>
<span class="n">Param</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">();</span>
<span class="n">Consumer</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param</span><span class="p">::</span><span class="n">set</span><span class="p">;</span>
<span class="n">Supplier</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param</span><span class="p">::</span><span class="n">get</span><span class="p">;</span>

<span class="n">Function</span><span class="o">&lt;</span><span class="nb nb-Type">String</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="o">&gt;</span><span class="w"> </span><span class="k">func</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Param</span><span class="p">::</span><span class="o">&lt;</span><span class="nb nb-Type">String</span><span class="o">&gt;</span><span class="n">returnSame</span><span class="p">;</span>
</pre></div>

<p>Method references can have different styles, but fundamentally they all mean
the same thing and can simply be visualized as lambdas:</p>
<ol>
<li>A static method (<code>ClassName::methName</code>)</li>
<li>An instance method of a particular object (<code>instanceRef::methName</code>)</li>
<li>A super method of a particular object (<code>super::methName</code>)</li>
<li>An instance method of an arbitrary object of a particular type (<code>ClassName::methName</code>)</li>
<li>A class constructor reference (<code>ClassName::new</code>)</li>
<li>An array constructor reference (<code>TypeName[]::new</code>)</li>
</ol>
<p>For further reference, see <em>State of the Lambda</em>.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-get-the-current-absolute-url-in-ruby-on-rails/" class="u-url">How do I get the current absolute URL in Ruby on Rails?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-get-the-current-absolute-url-in-ruby-on-rails/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:38:56+08:00" itemprop="datePublished" title="2023-02-17 05:38">2023-02-17 05:38</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How can I get the current <strong>absolute</strong> URL in my Ruby on Rails view?</p>
<p>The <code>request.request_uri</code> only returns the <strong>relative</strong> URL.</p>
<p><br><br></p>
<h2>Answer</h2>
<h4>For Rails 3.2 or Rails 4+</h4>
<p>You should use <code>request.original_url</code> to get the current URL. Source code on
current repo found here.</p>
<p>This method is documented at original_url method, but if you're curious, the
implementation is:</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">original_url</span>
<span class="w">  </span><span class="nv">base_url</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">original_fullpath</span>
<span class="k">end</span>
</pre></div>

<hr>
<h4>For Rails 3:</h4>
<p>You can write
<code>"#{request.protocol}#{request.host_with_port}#{request.fullpath}"</code>, since
<code>request.url</code> is now deprecated.</p>
<hr>
<h4>For Rails 2:</h4>
<p>You can write <code>request.url</code> instead of <code>request.request_uri</code>. This combines
the protocol (usually http://) with the host, and request_uri to give you the
full address.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I think that the Ruby on Rails 3.0 method is now <code>request.fullpath</code>.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/error-can-t-set-headers-after-they-are-sent-to-the-client/" class="u-url">Error: Can't set headers after they are sent to the client</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/error-can-t-set-headers-after-they-are-sent-to-the-client/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:37:07+08:00" itemprop="datePublished" title="2023-02-17 05:37">2023-02-17 05:37</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm fairly new to Node.js and I am having some issues.</p>
<p>I am using Node.js 4.10 and Express 2.4.3.</p>
<p>When I try to access http://127.0.0.1:8888/auth/facebook, i'll be redirected
to http://127.0.0.1:8888/auth/facebook_callback.</p>
<p>I then received the following error:</p>
<div class="code"><pre class="code literal-block"><span class="nl">Error</span><span class="p">:</span><span class="w"> </span><span class="n">Can</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">render</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">sent</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">client</span><span class="p">.</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="o">&lt;</span><span class="n">anonymous</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">573</span><span class="o">:</span><span class="mi">11</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="n">_renderHeaders</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">patch</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">64</span><span class="o">:</span><span class="mi">25</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="n">writeHead</span><span class="w"> </span><span class="p">(</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">813</span><span class="o">:</span><span class="mi">20</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">-</span><span class="n">auth</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">auth</span><span class="p">.</span><span class="n">strategies</span><span class="o">/</span><span class="n">facebook</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mi">15</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">-</span><span class="n">auth</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">113</span><span class="o">:</span><span class="mi">13</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">-</span><span class="n">auth</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">strategyExecutor</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">45</span><span class="o">:</span><span class="mi">39</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="p">[</span><span class="n">object</span><span class="w"> </span><span class="n">Object</span><span class="p">].</span><span class="n">pass</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">-</span><span class="n">auth</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">authExecutionScope</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">32</span><span class="o">:</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="p">[</span><span class="n">object</span><span class="w"> </span><span class="n">Object</span><span class="p">].</span><span class="n">halt</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">-</span><span class="n">auth</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">authExecutionScope</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">29</span><span class="o">:</span><span class="mi">8</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="p">[</span><span class="n">object</span><span class="w"> </span><span class="n">Object</span><span class="p">].</span><span class="n">redirect</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">-</span><span class="n">auth</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">authExecutionScope</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">16</span><span class="o">:</span><span class="mi">8</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="p">[</span><span class="n">object</span><span class="w"> </span><span class="n">Object</span><span class="p">].</span><span class="o">&lt;</span><span class="n">anonymous</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">-</span><span class="n">auth</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">auth</span><span class="p">.</span><span class="n">strategies</span><span class="o">/</span><span class="n">facebook</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">77</span><span class="o">:</span><span class="mi">15</span><span class="p">)</span>
<span class="nl">Error</span><span class="p">:</span><span class="w"> </span><span class="n">Can</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">sent</span><span class="p">.</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="o">&lt;</span><span class="n">anonymous</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">527</span><span class="o">:</span><span class="mi">11</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="n">setHeader</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">patch</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">50</span><span class="o">:</span><span class="mi">20</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">162</span><span class="o">:</span><span class="mi">13</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">195</span><span class="o">:</span><span class="mi">11</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">150</span><span class="o">:</span><span class="mi">23</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">router</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">189</span><span class="o">:</span><span class="mi">13</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">pass</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">router</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">191</span><span class="o">:</span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Object</span><span class="p">.</span><span class="n">router</span><span class="w"> </span><span class="p">[</span><span class="n">as</span><span class="w"> </span><span class="n">handle</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">router</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">197</span><span class="o">:</span><span class="mi">6</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">198</span><span class="o">:</span><span class="mi">15</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Object</span><span class="p">.</span><span class="n">auth</span><span class="w"> </span><span class="p">[</span><span class="n">as</span><span class="w"> </span><span class="n">handle</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">-</span><span class="n">auth</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">153</span><span class="o">:</span><span class="mi">7</span><span class="p">)</span>
<span class="nl">Error</span><span class="p">:</span><span class="w"> </span><span class="n">Can</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">sent</span><span class="p">.</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="o">&lt;</span><span class="n">anonymous</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">527</span><span class="o">:</span><span class="mi">11</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="n">setHeader</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">patch</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">50</span><span class="o">:</span><span class="mi">20</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">162</span><span class="o">:</span><span class="mi">13</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">207</span><span class="o">:</span><span class="mi">9</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">150</span><span class="o">:</span><span class="mi">23</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">router</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">189</span><span class="o">:</span><span class="mi">13</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">pass</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">router</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">191</span><span class="o">:</span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Object</span><span class="p">.</span><span class="n">router</span><span class="w"> </span><span class="p">[</span><span class="n">as</span><span class="w"> </span><span class="n">handle</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">router</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">197</span><span class="o">:</span><span class="mi">6</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">198</span><span class="o">:</span><span class="mi">15</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Object</span><span class="p">.</span><span class="n">auth</span><span class="w"> </span><span class="p">[</span><span class="n">as</span><span class="w"> </span><span class="n">handle</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">-</span><span class="n">auth</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">153</span><span class="o">:</span><span class="mi">7</span><span class="p">)</span>
<span class="nl">Error</span><span class="p">:</span><span class="w"> </span><span class="n">Can</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">sent</span><span class="p">.</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="o">&lt;</span><span class="n">anonymous</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">527</span><span class="o">:</span><span class="mi">11</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="n">setHeader</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">patch</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">50</span><span class="o">:</span><span class="mi">20</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">162</span><span class="o">:</span><span class="mi">13</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">150</span><span class="o">:</span><span class="mi">23</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">207</span><span class="o">:</span><span class="mi">9</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Object</span><span class="p">.</span><span class="n">auth</span><span class="w"> </span><span class="p">[</span><span class="n">as</span><span class="w"> </span><span class="n">handle</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">-</span><span class="n">auth</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">153</span><span class="o">:</span><span class="mi">7</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">198</span><span class="o">:</span><span class="mi">15</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">HTTPServer</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">211</span><span class="o">:</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Object</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">105</span><span class="o">:</span><span class="mi">14</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">198</span><span class="o">:</span><span class="mi">15</span><span class="p">)</span>
<span class="nl">Error</span><span class="p">:</span><span class="w"> </span><span class="n">Can</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">sent</span><span class="p">.</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="o">&lt;</span><span class="n">anonymous</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">527</span><span class="o">:</span><span class="mi">11</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="n">setHeader</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">patch</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">50</span><span class="o">:</span><span class="mi">20</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">162</span><span class="o">:</span><span class="mi">13</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">150</span><span class="o">:</span><span class="mi">23</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">207</span><span class="o">:</span><span class="mi">9</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">HTTPServer</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">211</span><span class="o">:</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Object</span><span class="p">.</span><span class="n">handle</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">105</span><span class="o">:</span><span class="mi">14</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">198</span><span class="o">:</span><span class="mi">15</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">session</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">323</span><span class="o">:</span><span class="mi">9</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">session</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">338</span><span class="o">:</span><span class="mi">9</span>

<span class="n">node</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">134</span>
<span class="w">        </span><span class="n">throw</span><span class="w"> </span><span class="n">e</span><span class="p">;</span><span class="w"> </span><span class="c1">// process.nextTick error, or 'error' event on first tick</span>
<span class="w">        </span><span class="o">^</span>
<span class="nl">Error</span><span class="p">:</span><span class="w"> </span><span class="n">Can</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">sent</span><span class="p">.</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="o">&lt;</span><span class="n">anonymous</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">527</span><span class="o">:</span><span class="mi">11</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">ServerResponse</span><span class="p">.</span><span class="n">setHeader</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">patch</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">50</span><span class="o">:</span><span class="mi">20</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">162</span><span class="o">:</span><span class="mi">13</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">http</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">207</span><span class="o">:</span><span class="mi">9</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">session</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">323</span><span class="o">:</span><span class="mi">9</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">session</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">338</span><span class="o">:</span><span class="mi">9</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Array</span><span class="p">.</span><span class="o">&lt;</span><span class="n">anonymous</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">eugene</span><span class="o">/</span><span class="n">public_html</span><span class="o">/</span><span class="n">all_things_node</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">fb2</span><span class="o">/</span><span class="n">node_modules</span><span class="o">/</span><span class="n">connect</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">middleware</span><span class="o">/</span><span class="n">session</span><span class="o">/</span><span class="n">memory</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">57</span><span class="o">:</span><span class="mi">7</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">EventEmitter</span><span class="p">.</span><span class="n">_tickCallback</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">126</span><span class="o">:</span><span class="mi">26</span><span class="p">)</span>
</pre></div>

<p>The following is my code:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">fbId</span><span class="o">=</span><span class="w"> </span><span class="s2">"XXX"</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">fbSecret</span><span class="o">=</span><span class="w"> </span><span class="s2">"XXXXXX"</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">fbCallbackAddress</span><span class="o">=</span><span class="w"> </span><span class="s2">"http://127.0.0.1:8888/auth/facebook_callback"</span>

<span class="k">var</span><span class="w"> </span><span class="n">cookieSecret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"node"</span><span class="p">;</span><span class="w">     </span><span class="o">//</span><span class="w"> </span><span class="n">enter</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="nb">hash</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">security</span>

<span class="k">var</span><span class="w"> </span><span class="n">express</span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">auth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'connect-auth'</span><span class="p">)</span>
<span class="k">var</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">express</span><span class="o">.</span><span class="n">createServer</span><span class="p">();</span>


<span class="n">app</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">function</span><span class="p">(){</span>
<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">express</span><span class="o">.</span><span class="n">bodyParser</span><span class="p">());</span>
<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">express</span><span class="o">.</span><span class="n">methodOverride</span><span class="p">());</span>
<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">express</span><span class="o">.</span><span class="n">cookieParser</span><span class="p">());</span>
<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">express</span><span class="o">.</span><span class="n">session</span><span class="p">({</span><span class="n">secret</span><span class="p">:</span><span class="w"> </span><span class="n">cookieSecret</span><span class="p">}));</span>
<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">auth</span><span class="p">([</span>
<span class="w">        </span><span class="n">auth</span><span class="o">.</span><span class="n">Facebook</span><span class="p">({</span>
<span class="w">            </span><span class="n">appId</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">fbId</span><span class="p">,</span>
<span class="w">            </span><span class="n">appSecret</span><span class="p">:</span><span class="w"> </span><span class="n">fbSecret</span><span class="p">,</span>
<span class="w">            </span><span class="n">callback</span><span class="p">:</span><span class="w"> </span><span class="n">fbCallbackAddress</span><span class="p">,</span>
<span class="w">            </span><span class="n">scope</span><span class="p">:</span><span class="w"> </span><span class="s1">'offline_access,email,user_about_me,user_activities,manage_pages,publish_stream'</span><span class="p">,</span>
<span class="w">            </span><span class="n">failedUri</span><span class="p">:</span><span class="w"> </span><span class="s1">'/noauth'</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="p">]));</span>
<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="p">);</span>
<span class="p">});</span>


<span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/auth/facebook'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">req</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="s2">"facebook"</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">authenticated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">authenticated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">res</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s2">"/great"</span><span class="p">);</span>
<span class="w">      </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"ok cool."</span><span class="p">);</span>
<span class="w">      </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s1">'req'</span><span class="p">][</span><span class="s1">'session'</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">});</span>

<span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/noauth'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'Authentication Failed'</span><span class="p">);</span>
<span class="w">  </span><span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">'Authentication Failed'</span><span class="p">);</span>
<span class="p">});</span>

<span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/great'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">'Supercoolstuff'</span><span class="p">);</span>
<span class="p">});</span>

<span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8888</span><span class="p">);</span>
</pre></div>

<p>May I know what is wrong with my code?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The <code>res</code> object in Express is a subclass of Node.js's <code>http.ServerResponse</code>
(read the http.js source). You are allowed to call <code>res.setHeader(name,
value)</code> as often as you want until you call <code>res.writeHead(statusCode)</code>. After
<code>writeHead</code>, the headers are baked in and you can only call <code>res.write(data)</code>,
and finally <code>res.end(data)</code>.</p>
<p>The error "Error: Can't set headers after they are sent." means that you're
already in the Body or Finished state, but some function tried to set a header
or statusCode. When you see this error, try to look for anything that tries to
send a header after some of the body has already been written. For example,
look for callbacks that are accidentally called twice, or any error that
happens after the body is sent.</p>
<p>In your case, you called <code>res.redirect()</code>, which caused the response to become
Finished. Then your code threw an error (<code>res.req</code> is <code>null</code>). and since the
error happened within your actual <code>function(req, res, next)</code> (not within a
callback), Connect was able to catch it and then tried to send a 500 error
page. But since the headers were already sent, Node.js's <code>setHeader</code> threw the
error that you saw.</p>
<h2>Comprehensive list of Node.js/Express response methods and when they must be</h2>
<p>called:</p>
<p>Response must be in <strong>Head</strong> and remains in <strong>Head</strong> :</p>
<ol>
<li><code>res.writeContinue()</code></li>
<li><code>res.statusCode = 404</code></li>
<li><code>res.setHeader(name, value)</code></li>
<li><code>res.getHeader(name)</code></li>
<li><code>res.removeHeader(name)</code></li>
<li>
<code>res.header(key[, val])</code> (Express only)</li>
<li>
<code>res.charset = 'utf-8'</code> (Express only; only affects Express-specific methods)</li>
<li>
<code>res.contentType(type)</code> (Express only)</li>
</ol>
<p>Response must be in <strong>Head</strong> and becomes <strong>Body</strong> :</p>
<ol>
<li><code>res.writeHead(statusCode, [reasonPhrase], [headers])</code></li>
</ol>
<p>Response can be in either <strong>Head/Body</strong> and remains in <strong>Body</strong> :</p>
<ol>
<li><code>res.write(chunk, encoding='utf8')</code></li>
</ol>
<p>Response can be in either <strong>Head/Body</strong> and becomes <strong>Finished</strong> :</p>
<ol>
<li><code>res.end([data], [encoding])</code></li>
</ol>
<p>Response can be in either <strong>Head/Body</strong> and remains in its current state:</p>
<ol>
<li><code>res.addTrailers(headers)</code></li>
</ol>
<p>Response must be in <strong>Head</strong> and becomes <strong>Finished</strong> :</p>
<ol>
<li>
<code>return next([err])</code> (Connect/Express only)</li>
<li>Any exceptions within middleware <code>function(req, res, next)</code> (Connect/Express only)</li>
<li>
<code>res.send(body|status[, headers|status[, status]])</code> (Express only)</li>
<li>
<code>res.attachment(filename)</code> (Express only)</li>
<li>
<code>res.sendfile(path[, options[, callback]])</code> (Express only)</li>
<li>
<code>res.json(obj[, headers|status[, status]])</code> (Express only)</li>
<li>
<code>res.redirect(url[, status])</code> (Express only)</li>
<li>
<code>res.cookie(name, val[, options])</code> (Express only)</li>
<li>
<code>res.clearCookie(name[, options])</code> (Express only)</li>
<li>
<code>res.render(view[, options[, fn]])</code> (Express only)</li>
<li>
<code>res.partial(view[, options])</code> (Express only)</li>
</ol>
<p><br></p>
<h3>Suggest</h3>
<p><em>Some of the answers in this Q &amp;A are wrong. The accepted answer is also not
very "practical", so I want to post an answer that explains things in simpler
terms. My answer will cover 99% of the errors I see posted over and over
again. For the actual reasons behind the error take a look at the accepted
answer.</em></p>
<hr>
<p>HTTP uses a cycle that requires one response per request. When the client
sends a request (e.g. POST or GET) the server should only send one response
back to it.</p>
<p>This error message:</p>
<blockquote>
<p>Error: Can't set headers after they are sent.</p>
</blockquote>
<p>usually happens when you send several responses for one request. Make sure the
following functions are called only once per request:</p>
<ul>
<li><code>res.json()</code></li>
<li><code>res.send()</code></li>
<li><code>res.redirect()</code></li>
<li><code>res.render()</code></li>
</ul>
<p><em>(and a few more that are rarely used, check the accepted answer)</em></p>
<p>The route callback will not return when these res functions are called. It
will continue running until it hits the end of the function or a return
statement. If you want to return when sending a response you can do it like
so: <code>return res.send()</code>.</p>
<hr>
<p>Take for instance this code:</p>
<div class="code"><pre class="code literal-block"><span class="nt">app</span><span class="p">.</span><span class="nc">post</span><span class="o">(</span><span class="s1">'/api/route1'</span><span class="o">,</span><span class="w"> </span><span class="nt">function</span><span class="o">(</span><span class="nt">req</span><span class="o">,</span><span class="w"> </span><span class="nt">res</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">console.log('this</span><span class="w"> </span><span class="err">ran')</span><span class="p">;</span>
<span class="w">  </span><span class="err">res.status(200).json({</span><span class="w"> </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="s1">'ok'</span><span class="w"> </span><span class="p">}</span><span class="o">);</span>
<span class="w">  </span><span class="nt">console</span><span class="p">.</span><span class="nc">log</span><span class="o">(</span><span class="s1">'this ran too'</span><span class="o">);</span>
<span class="w">  </span><span class="nt">res</span><span class="p">.</span><span class="nc">status</span><span class="o">(</span><span class="nt">200</span><span class="o">)</span><span class="p">.</span><span class="nc">json</span><span class="o">(</span><span class="p">{</span><span class="w"> </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="s1">'ok'</span><span class="w"> </span><span class="p">}</span><span class="o">);</span>
<span class="err">}</span>
</pre></div>

<p>When a POST request is sent to <em>/api/route1</em> it will run every line in the
callback. A <em>Can't set headers after they are sent</em> error message will be
thrown because <code>res.json()</code> is called twice, meaning two responses are sent.</p>
<p><strong>Only one response can be sent per request!</strong></p>
<hr>
<p>The error in the code sample above was obvious. A more typical problem is when
you have several branches:</p>
<div class="code"><pre class="code literal-block"><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/api/company/:companyId'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">companyId</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="o">.</span><span class="n">params</span><span class="p">;</span>
<span class="w">  </span><span class="n">Company</span><span class="o">.</span><span class="n">findById</span><span class="p">(</span><span class="n">companyId</span><span class="p">)</span><span class="o">.</span><span class="n">exec</span><span class="p">((</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">company</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">res</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">company</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">res</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">();</span><span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">runs</span><span class="o">.</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">res</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">company</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">runs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">well</span><span class="o">.</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>This route with attached callback finds a company in a database. When doing a
query for a company that doesn't exist we will get inside the <code>else if</code> branch
and send a 404 response. After that, we will continue on to the next statement
which also sends a response. Now we have sent two responses and the error
message will occur. We can fix this code by making sure we only send one
response:</p>
<div class="code"><pre class="code literal-block"><span class="na">.exec</span><span class="p">((</span><span class="no">err</span><span class="p">,</span><span class="w"> </span><span class="no">company</span><span class="p">)</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="no">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">res.status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="no">json</span><span class="p">(</span><span class="no">err</span><span class="p">)</span><span class="c1">;</span>
<span class="w">  </span><span class="err">}</span><span class="w"> </span><span class="nf">else</span><span class="w"> </span><span class="no">if</span><span class="w"> </span><span class="p">(!</span><span class="no">company</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">res.status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="no">json</span><span class="p">()</span><span class="c1">;         // Only this runs.</span>
<span class="w">  </span><span class="err">}</span><span class="w"> </span><span class="nf">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">res.status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="no">json</span><span class="p">(</span><span class="no">company</span><span class="p">)</span><span class="c1">;</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">})</span><span class="c1">;</span>
</pre></div>

<p>or by returning when the response is sent:</p>
<div class="code"><pre class="code literal-block"><span class="na">.exec</span><span class="p">((</span><span class="no">err</span><span class="p">,</span><span class="w"> </span><span class="no">company</span><span class="p">)</span><span class="w"> </span><span class="err">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="no">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">return</span><span class="w"> </span><span class="no">res.status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="no">json</span><span class="p">(</span><span class="no">err</span><span class="p">)</span><span class="c1">;</span>
<span class="w">  </span><span class="err">}</span><span class="w"> </span><span class="nf">else</span><span class="w"> </span><span class="no">if</span><span class="w"> </span><span class="p">(!</span><span class="no">company</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">return</span><span class="w"> </span><span class="no">res.status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="no">json</span><span class="p">()</span><span class="c1">;  // Only this runs.</span>
<span class="w">  </span><span class="err">}</span>
<span class="w">  </span><span class="nf">return</span><span class="w"> </span><span class="no">res.status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="no">json</span><span class="p">(</span><span class="no">company</span><span class="p">)</span><span class="c1">;</span>
<span class="err">})</span><span class="c1">;</span>
</pre></div>

<hr>
<p>A big sinner is asynchronous functions. Take the function from this question,
for example:</p>
<div class="code"><pre class="code literal-block"><span class="nt">article</span><span class="p">.</span><span class="nc">save</span><span class="o">(</span><span class="nt">function</span><span class="o">(</span><span class="nt">err</span><span class="o">,</span><span class="w"> </span><span class="nt">doc1</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">if</span><span class="w"> </span><span class="err">(err)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="err">res.send(err)</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="nt">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">User.findOneAndUpdate({</span><span class="w"> </span><span class="n">_id</span><span class="p">:</span><span class="w"> </span><span class="n">req</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">_id</span><span class="w"> </span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">$</span><span class="n">push</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">article</span><span class="o">:</span><span class="w"> </span><span class="n">doc</span><span class="o">.</span><span class="n">_id</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="err">}</span><span class="o">)</span>
<span class="w">    </span><span class="p">.</span><span class="nc">exec</span><span class="o">(</span><span class="nt">function</span><span class="o">(</span><span class="nt">err</span><span class="o">,</span><span class="w"> </span><span class="nt">doc2</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">if</span><span class="w"> </span><span class="err">(err)</span><span class="w"> </span><span class="err">res.send(err)</span><span class="p">;</span>
<span class="w">      </span><span class="err">else</span><span class="w">     </span><span class="err">res.json(doc2)</span><span class="p">;</span><span class="w">  </span><span class="err">//</span><span class="w"> </span><span class="err">Will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">called</span><span class="w"> </span><span class="err">second.</span>
<span class="w">    </span><span class="p">}</span><span class="o">)</span>

<span class="w">    </span><span class="nt">res</span><span class="p">.</span><span class="nc">json</span><span class="o">(</span><span class="nt">doc1</span><span class="o">);</span><span class="w">             </span><span class="o">//</span><span class="w"> </span><span class="nt">Will</span><span class="w"> </span><span class="nt">be</span><span class="w"> </span><span class="nt">called</span><span class="w"> </span><span class="nt">first</span><span class="o">.</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span><span class="o">);</span>
</pre></div>

<p>Here we have an asynchronous function (<code>findOneAndUpdate()</code>) in the code
sample. If there are no errors (<code>err</code>) <code>findOneAndUpdate()</code> will be called.
Because this function is asynchronous the <code>res.json(doc1)</code> will be called
immediately. Assume there are no errors in <code>findOneAndUpdate()</code>. The
<code>res.json(doc2)</code> in the <code>else</code> will then be called. Two responses have now
been sent and the <em>Can't set headers</em> error message occurs.</p>
<p>The fix, in this case, would be to remove the <code>res.json(doc1)</code>. To send both
docs back to the client the <code>res.json()</code> in the else could be written as
<code>res.json({ article: doc1, user: doc2 })</code>.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-391.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-389.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
