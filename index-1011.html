<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1011) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1011.html">
<link rel="prev" href="index-1012.html" type="text/html">
<link rel="next" href="index-1010.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/remove-local-git-tags-that-are-no-longer-on-the-remote-repository/" class="u-url">Remove local git tags that are no longer on the remote repository</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/remove-local-git-tags-that-are-no-longer-on-the-remote-repository/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T22:27:16+08:00" itemprop="datePublished" title="2023-02-17 22:27">2023-02-17 22:27</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>We use tags in git as part of our deployment process. From time to time, we
want to clean up these tags by removing them from our remote repository.</p>
<p>This is pretty straightforward. One user deletes the local tag and the remote
tag in one set of commands. We have a little shell script that combines both
steps.</p>
<p>The 2nd (3rd, 4th,...) user now has local tags that are no longer reflected on
the remote.</p>
<p>I am looking for a command similar to <code>git remote prune origin</code> which cleans
up locally tracking branches for which the remote branch has been deleted.</p>
<p>Alternatively, a simple command to list remote tags could be used to compare
to the local tags returned via <code>git tag -l</code>.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Good question. :) I don't have a complete answer...</p>
<p>That said, you can get a list of remote tags via <code>git ls-remote</code>. To list the
tags in the repository referenced by <code>origin</code>, you'd run:</p>
<div class="code"><pre class="code literal-block">git ls-remote --tags origin
</pre></div>

<p>That returns a list of hashes and friendly tag names, like:</p>
<div class="code"><pre class="code literal-block"><span class="mf">94</span><span class="n">bf6de8315d9a7b22385e86e1f5add9183bcb3c</span><span class="w">        </span><span class="n">refs</span><span class="o">/</span><span class="n">tags</span><span class="o">/</span><span class="n">v0</span><span class="mf">.1.3</span>
<span class="n">cc047da6604bdd9a0e5ecbba3375ba6f09eed09d</span><span class="w">        </span><span class="n">refs</span><span class="o">/</span><span class="n">tags</span><span class="o">/</span><span class="n">v0</span><span class="mf">.1.4</span>
<span class="mf">...</span>
<span class="mf">2</span><span class="n">f2e45bedf67dedb8d1dc0d02612345ee5c893f2</span><span class="w">        </span><span class="n">refs</span><span class="o">/</span><span class="n">tags</span><span class="o">/</span><span class="n">v0</span><span class="mf">.5.4</span>
</pre></div>

<p>You could certainly put together a bash script to compare the tags generated
by this list with the tags you have locally. Take a look at <code>git show-ref
--tags</code>, which generates the tag names in the same form as <code>git ls-remote</code>).</p>
<hr>
<p>As an aside, <code>git show-ref</code> has an option that does the opposite of what you'd
like. The following command would list all the tags on the remote branch that
you <em>don't</em> have locally:</p>
<div class="code"><pre class="code literal-block"><span class="nv">git</span><span class="w"> </span><span class="nv">ls</span><span class="o">-</span><span class="nv">remote</span><span class="w"> </span><span class="o">--</span><span class="nv">tags</span><span class="w"> </span><span class="nv">origin</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">git</span><span class="w"> </span><span class="k">show</span><span class="o">-</span><span class="nv">ref</span><span class="w"> </span><span class="o">--</span><span class="nv">tags</span><span class="w"> </span><span class="o">--</span><span class="nv">exclude</span><span class="o">-</span><span class="nv">existing</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>From Git v1.7.8 to v1.8.5.6, you can use this:</p>
<div class="code"><pre class="code literal-block">git fetch &lt;remote&gt; --prune --tags
</pre></div>

<h4>Update</h4>
<p>This doesn't work on newer versions of git (starting with v1.9.0) because of
commit e66ef7ae6f31f2. I don't really want to delete it though since it did
work for some people.</p>
<p>As suggested by "Chad Juliano", with all Git version since v1.7.8, you can use
the following command:</p>
<div class="code"><pre class="code literal-block">git fetch --prune &lt;remote&gt; +refs/tags/*:refs/tags/*
</pre></div>

<p>You may need to enclose the tags part with quotes (on Windows for example) to
avoid wildcard expansion:</p>
<div class="code"><pre class="code literal-block">git fetch --prune &lt;remote&gt; "+refs/tags/*:refs/tags/*"
</pre></div>

<p>NOTE: in all these cases would be likely be "origin" or whichever remote you
might usually reference.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-move-some-files-from-one-git-repo-to-another-not-a-clone-preserving-history/" class="u-url">How to move some files from one git repo to another (not a clone), preserving history</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-move-some-files-from-one-git-repo-to-another-not-a-clone-preserving-history/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T22:26:23+08:00" itemprop="datePublished" title="2023-02-17 22:26">2023-02-17 22:26</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Our Git repositories started out as parts of a single monster SVN repository
where the individual projects each had their own tree like so:</p>
<div class="code"><pre class="code literal-block">project1/branches
        /tags
        /trunk
project2/branches
        /tags
        /trunk
</pre></div>

<p>Obviously, it was pretty easy to move files from one to another with <code>svn mv</code>.
But in Git, each project is in its own repository, and today I was asked to
move a subdirectory from <code>project2</code> to <code>project1</code>. I did something like this:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>project2<span class="w"> </span>
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>project2
$<span class="w"> </span>git<span class="w"> </span>filter-branch<span class="w"> </span>--subdirectory-filter<span class="w"> </span>deeply/buried/java/source/directory/A<span class="w"> </span>--<span class="w"> </span>--all
$<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>rm<span class="w"> </span>origin<span class="w">  </span><span class="c1"># so I don't accidentally overwrite the repo ;-)</span>
$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>deeply/buried/different/java/source/directory/B
$<span class="w"> </span><span class="k">for</span><span class="w"> </span>f<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.java<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
&gt;<span class="w">  </span>git<span class="w"> </span>mv<span class="w"> </span><span class="nv">$f</span><span class="w"> </span>deeply/buried/different/java/source/directory/B
&gt;<span class="w">  </span><span class="k">done</span>
$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">"moved files to new subdirectory"</span>
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>..
$
$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>project1
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>project1
$<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>p2<span class="w"> </span>../project2
$<span class="w"> </span>git<span class="w"> </span>fetch<span class="w"> </span>p2
$<span class="w"> </span>git<span class="w"> </span>branch<span class="w"> </span>p2<span class="w"> </span>remotes/p2/master
$<span class="w"> </span>git<span class="w"> </span>merge<span class="w"> </span>p2<span class="w"> </span><span class="c1"># --allow-unrelated-histories for git 2.9+</span>
$<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>rm<span class="w"> </span>p2
$<span class="w"> </span>git<span class="w"> </span>push
</pre></div>

<p>But that seems pretty convoluted. Is there a better way to do this sort of
thing in general? Or have I adopted the right approach?</p>
<p>Note that this involves merging the history into an existing repository,
rather than simply creating a new standalone repository from part of another
one (as in an earlier question).</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Yep, hitting on the <code>--subdirectory-filter</code> of <code>filter-branch</code> was key. The
fact that you used it essentially proves there's no easier way - you had no
choice but to rewrite history, since you wanted to end up with only a
(renamed) subset of the files, and this by definition changes the hashes.
Since none of the standard commands (e.g. <code>pull</code>) rewrite history, there's no
way you could use them to accomplish this.</p>
<p>You could refine the details, of course - some of your cloning and branching
wasn't strictly necessary - but the overall approach is good! It's a shame
it's complicated, but of course, the point of git isn't to make it easy to
rewrite history.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Having tried various approaches to move a file or folder from one Git
repository to another, the only one which seems to work reliably is outlined
below.</p>
<p>It involves cloning the repository you want to move the file or folder from,
moving that file or folder to the root, rewriting Git history, cloning the
target repository and pulling the file or folder with history directly into
this target repository.</p>
<h3>Stage One</h3>
<ol>
<li>
<p>Make a copy of repository A as the following steps make major changes to this copy which you should not push!</p>
<div class="code"><pre class="code literal-block">git clone --branch &lt;branch&gt; --origin origin --progress \
</pre></div>

<p>-v <git repository a url>
# eg. git clone --branch master --origin origin --progress \</git></p>
<h2>-v https://username@giturl/scm/projects/myprojects.git</h2>
<h2>(assuming myprojects is the repository you want to copy from)</h2>
</li>
<li>
<p>cd into it</p>
<div class="code"><pre class="code literal-block">cd &lt;git repository A directory&gt;
</pre></div>

<h2>eg. cd /c/Working/GIT/myprojects</h2>
</li>
<li>
<p>Delete the link to the original repository to avoid accidentally making any remote changes (eg. by pushing)</p>
<div class="code"><pre class="code literal-block">git remote rm origin
</pre></div>

</li>
<li>
<p>Go through your history and files, removing anything that is not in directory 1. The result is the contents of directory 1 spewed out into to the base of repository A.</p>
<div class="code"><pre class="code literal-block">git filter-branch --subdirectory-filter &lt;directory&gt; -- --all
</pre></div>

<h2>eg. git filter-branch --subdirectory-filter subfolder1/subfolder2/FOLDER_TO_KEEP -- --all</h2>
</li>
<li>
<p>For single file move only: go through what's left and remove everything except the desired file. (You may need to delete files you don't want with the same name and commit.)</p>
<div class="code"><pre class="code literal-block">git filter-branch -f --index-filter \
</pre></div>

<p>'git ls-files -s | grep $'\t'FILE_TO_KEEP$ |
GIT_INDEX_FILE=$GIT_INDEX_FILE.new \
git update-index --index-info &amp;&amp; \
mv $GIT_INDEX_FILE.new $GIT_INDEX_FILE || echo "Nothing to do"' --prune-empty -- --all</p>
<h2>eg. FILE_TO_KEEP = pom.xml to keep only the pom.xml file from FOLDER_TO_KEEP</h2>
</li>
</ol>
<h3>Stage Two</h3>
<ol>
<li>
<p>Cleanup step</p>
<div class="code"><pre class="code literal-block">git reset --hard
</pre></div>

</li>
<li>
<p>Cleanup step</p>
<div class="code"><pre class="code literal-block">git gc --aggressive
</pre></div>

</li>
<li>
<p>Cleanup step</p>
<div class="code"><pre class="code literal-block">git prune
</pre></div>

</li>
</ol>
<p>You may want to import these files into repository B within a directory not
the root:</p>
<ol>
<li>
<p>Make that directory</p>
<div class="code"><pre class="code literal-block">mkdir &lt;base directory&gt;             eg. mkdir FOLDER_TO_KEEP
</pre></div>

</li>
<li>
<p>Move files into that directory</p>
<div class="code"><pre class="code literal-block">git mv * &lt;base directory&gt;          eg. git mv * FOLDER_TO_KEEP
</pre></div>

</li>
<li>
<p>Add files to that directory</p>
<div class="code"><pre class="code literal-block">git add .
</pre></div>

</li>
<li>
<p>Commit your changes and we’re ready to merge these files into the new repository</p>
<div class="code"><pre class="code literal-block">git commit
</pre></div>

</li>
</ol>
<h3>Stage Three</h3>
<ol>
<li>Make a copy of repository B if you don’t have one already<div class="code"><pre class="code literal-block">git clone &lt;git repository B url&gt;
</pre></div>

<h2>eg. git clone https://username@giturl/scm/projects/FOLDER_TO_KEEP.git</h2>
</li>
</ol>
<p>(assuming FOLDER_TO_KEEP is the name of the new repository you are copying to)</p>
<ol>
<li>
<p>cd into it</p>
<div class="code"><pre class="code literal-block">cd &lt;git repository B directory&gt;
</pre></div>

<h2>eg. cd /c/Working/GIT/FOLDER_TO_KEEP</h2>
</li>
<li>
<p>Create a remote connection to repository A as a branch in repository B</p>
<div class="code"><pre class="code literal-block">git remote add repo-A-branch &lt;git repository A directory&gt;
</pre></div>

<h2>(repo-A-branch can be anything - it's just an arbitrary name)</h2>
<h2>eg. git remote add repo-A-branch /c/Working/GIT/myprojects</h2>
</li>
<li>
<p>Pull from this branch (containing only the directory you want to move) into repository B.</p>
<div class="code"><pre class="code literal-block">git pull repo-A-branch master --allow-unrelated-histories
</pre></div>

</li>
</ol>
<p>The pull copies both files and history. Note: You can use a merge instead of a
pull, but pull works better.</p>
<ol>
<li>
<p>Finally, you probably want to clean up a bit by removing the remote connection to repository A</p>
<div class="code"><pre class="code literal-block">git remote rm repo-A-branch
</pre></div>

</li>
<li>
<p>Push and you’re all set.</p>
<div class="code"><pre class="code literal-block">git push
</pre></div>

</li>
</ol>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/system-timers-timer-vs-system-threading-timer/" class="u-url">System.Timers.Timer vs System.Threading.Timer</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/system-timers-timer-vs-system-threading-timer/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T22:25:51+08:00" itemprop="datePublished" title="2023-02-17 22:25">2023-02-17 22:25</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have been checking out some of the possible timers lately, and
<code>System.Threading.Timer</code> and <code>System.Timers.Timer</code> are the ones that look
needful to me (since they support thread pooling).</p>
<p>I am making a game, and I plan on using all types of events, with different
intervals, etc.</p>
<p>Which would be the best?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This article offers a fairly comprehensive explanation:</p>
<p>"Comparing the Timer Classes in the .NET Framework Class Library" - also
available as a .chm file</p>
<p>The specific difference appears to be that <code>System.Timers.Timer</code> is geared
towards multithreaded applications and is therefore thread-safe via its
<code>SynchronizationObject</code> property, whereas <code>System.Threading.Timer</code> is
ironically not thread-safe out-of-the-box.</p>
<p>I don't believe that there is a difference between the two as it pertains to
how small your intervals can be.</p>
<p><br></p>
<h3>Suggest</h3>
<p><code>System.Threading.Timer</code> is a plain timer. It calls you back on a thread pool
thread (from the worker pool).</p>
<p><code>System.Timers.Timer</code> is a <code>System.ComponentModel.Component</code> that wraps a
<code>System.Threading.Timer</code>, and provides some additional features used for
dispatching on a particular thread.</p>
<p><code>System.Windows.Forms.Timer</code> instead wraps a native message-only-HWND and uses
Window Timers to raise events in that HWNDs message loop.</p>
<p>If your app has no UI, and you want the most light-weight and general-purpose
.Net timer possible, (because you are happy figuring out your own
threading/dispatching) then <code>System.Threading.Timer</code> is as good as it gets in
the framework.</p>
<p>I'm not fully clear what the supposed 'not thread safe' issues with
<code>System.Threading.Timer</code> are. Perhaps it is just same as asked in this
question: Thread-safety of System.Timers.Timer vs System.Threading.Timer, or
perhaps everyone just means that:</p>
<ol>
<li>
<p>it's easy to write race conditions when you're using timers. E.g. see this question: Timer (System.Threading) thread safety</p>
</li>
<li>
<p>re-entrancy of timer notifications, where your timer event can trigger and call you back a <em>second</em> time before you finish processing the <em>first</em> event. E.g. see this question: Thread-safe execution using System.Threading.Timer and Monitor</p>
</li>
</ol>
</div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1012.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1010.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
