<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2063) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2063.html">
<link rel="prev" href="index-2064.html" type="text/html">
<link rel="next" href="index-2062.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/does-swift-have-a-trim-method-on-string/" class="u-url">Does swift have a trim method on String?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/does-swift-have-a-trim-method-on-string/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T16:04:17+08:00" itemprop="datePublished" title="2023-03-03 16:04">2023-03-03 16:04</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Does swift have a trim method on String? For example:</p>
<div class="code"><pre class="code literal-block">let result = " abc ".trim()
// result == "abc"
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>Here's how you remove all the whitespace from the beginning and end of a
<code>String</code>.</p>
<p><em>(Example tested with <strong>Swift 2.0</strong>.)</em></p>
<div class="code"><pre class="code literal-block">let myString = "  \t\t  Let's trim all the whitespace  \n \t  \n  "
let trimmedString = myString.stringByTrimmingCharactersInSet(
    NSCharacterSet.whitespaceAndNewlineCharacterSet()
)
// Returns "Let's trim all the whitespace"
</pre></div>

<p><em>(Example tested with <strong>Swift 3+</strong>.)</em></p>
<div class="code"><pre class="code literal-block">let myString = "  \t\t  Let's trim all the whitespace  \n \t  \n  "
let trimmedString = myString.trimmingCharacters(in: .whitespacesAndNewlines)
// Returns "Let's trim all the whitespace"
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Put this code on a file on your project, something likes Utils.swift:</p>
<div class="code"><pre class="code literal-block"><span class="n">extension</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="p">{</span><span class="w">   </span>
<span class="w">    </span><span class="k">func</span><span class="w"> </span><span class="n">trim</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">stringByTrimmingCharactersInSet</span><span class="p">(</span><span class="n">NSCharacterSet</span><span class="o">.</span><span class="n">whitespaceCharacterSet</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>So you will be able to do this:</p>
<div class="code"><pre class="code literal-block">let result = " abc ".trim()
// result == "abc"
</pre></div>

<p><em><strong>Swift 3.0 Solution</strong></em></p>
<div class="code"><pre class="code literal-block"><span class="n">extension</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="p">{</span><span class="w">   </span>
<span class="w">    </span><span class="k">func</span><span class="w"> </span><span class="n">trim</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">trimmingCharacters</span><span class="p">(</span><span class="ow">in</span><span class="p">:</span><span class="w"> </span><span class="n">NSCharacterSet</span><span class="o">.</span><span class="n">whitespaces</span><span class="p">)</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>So you will be able to do this:</p>
<div class="code"><pre class="code literal-block">let result = " Hello World ".trim()
// result = "HelloWorld"
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/urllib-and-ssl-certificate-verify-failed-error/" class="u-url">urllib and "SSL: CERTIFICATE_VERIFY_FAILED" Error</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/urllib-and-ssl-certificate-verify-failed-error/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T16:03:45+08:00" itemprop="datePublished" title="2023-03-03 16:03">2023-03-03 16:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am getting the following error:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Exception</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">thread</span><span class="w"> </span><span class="nv">Thread</span><span class="o">-</span><span class="mi">3</span>:
<span class="nv">Traceback</span><span class="w"> </span><span class="ss">(</span><span class="nv">most</span><span class="w"> </span><span class="nv">recent</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="nl">last</span><span class="ss">)</span>:
<span class="nv">File</span><span class="w"> </span><span class="s2">"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/threading.py"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">810</span>,<span class="w"> </span><span class="nv">in</span><span class="w">        </span><span class="nv">__bootstrap_inner</span>
<span class="nv">self</span>.<span class="nv">run</span><span class="ss">()</span>
<span class="nv">File</span><span class="w"> </span><span class="s2">"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/threading.py"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">763</span>,<span class="w"> </span><span class="nv">in</span><span class="w">  </span><span class="nv">run</span>
<span class="nv">self</span>.<span class="nv">__target</span><span class="ss">(</span><span class="o">*</span><span class="nv">self</span>.<span class="nv">__args</span>,<span class="w"> </span><span class="o">**</span><span class="nv">self</span>.<span class="nv">__kwargs</span><span class="ss">)</span>
<span class="nv">File</span><span class="w"> </span><span class="s2">"/Users/Matthew/Desktop/Skypebot 2.0/bot.py"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">271</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">process</span>
<span class="nv">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">urllib2</span>.<span class="nv">urlopen</span><span class="ss">(</span><span class="nv">req</span><span class="ss">)</span>.<span class="nv">read</span><span class="ss">()</span>
<span class="nv">File</span><span class="w"> </span><span class="s2">"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">154</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">urlopen</span>
<span class="k">return</span><span class="w"> </span><span class="nv">opener</span>.<span class="nv">open</span><span class="ss">(</span><span class="nv">url</span>,<span class="w"> </span><span class="nv">data</span>,<span class="w"> </span><span class="nb">timeout</span><span class="ss">)</span>
<span class="nv">File</span><span class="w"> </span><span class="s2">"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">431</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">open</span>
<span class="nv">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span>.<span class="nv">_open</span><span class="ss">(</span><span class="nv">req</span>,<span class="w"> </span><span class="nv">data</span><span class="ss">)</span>
<span class="nv">File</span><span class="w"> </span><span class="s2">"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">449</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">_open</span>
<span class="s1">'_open'</span>,<span class="w"> </span><span class="nv">req</span><span class="ss">)</span>
<span class="nv">File</span><span class="w"> </span><span class="s2">"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">409</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">_call_chain</span>
<span class="nb">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">func</span><span class="ss">(</span><span class="o">*</span><span class="nv">args</span><span class="ss">)</span>
<span class="nv">File</span><span class="w"> </span><span class="s2">"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1240</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">https_open</span>
<span class="nv">context</span><span class="o">=</span><span class="nv">self</span>.<span class="nv">_context</span><span class="ss">)</span>
<span class="nv">File</span><span class="w"> </span><span class="s2">"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1197</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">do_open</span>
<span class="nv">raise</span><span class="w"> </span><span class="nv">URLError</span><span class="ss">(</span><span class="nv">err</span><span class="ss">)</span>
<span class="nv">URLError</span>:<span class="w"> </span><span class="o">&lt;</span><span class="nv">urlopen</span><span class="w"> </span><span class="nv">error</span><span class="w"> </span>[<span class="nv">SSL</span>:<span class="w"> </span><span class="nv">CERTIFICATE_VERIFY_FAILED</span>]<span class="w"> </span><span class="nv">certificate</span><span class="w"> </span><span class="nv">verify</span><span class="w"> </span><span class="nv">failed</span><span class="w"> </span><span class="ss">(</span><span class="nv">_ssl</span>.<span class="nv">c</span>:<span class="mi">581</span><span class="ss">)</span><span class="o">&gt;</span>
</pre></div>

<p>This is the code that is causing this error:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="nv">input</span>.<span class="nv">startswith</span><span class="ss">(</span><span class="s2">"!web"</span><span class="ss">)</span>:
<span class="w">    </span><span class="nv">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">input</span>.<span class="nv">replace</span><span class="ss">(</span><span class="s2">"!web "</span>,<span class="w"> </span><span class="s2">""</span><span class="ss">)</span><span class="w">      </span>
<span class="w">    </span><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://domainsearch.p.mashape.com/index.php?name="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">input</span>
<span class="w">    </span><span class="nv">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">urllib2</span>.<span class="nv">Request</span><span class="ss">(</span><span class="nv">url</span>,<span class="w"> </span><span class="nv">headers</span><span class="o">=</span>{<span class="w"> </span><span class="s1">'X-Mashape-Key'</span>:<span class="w"> </span><span class="s1">'XXXXXXXXXXXXXXXXXXXX'</span><span class="w"> </span>}<span class="ss">)</span>
<span class="w">    </span><span class="nv">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">urllib2</span>.<span class="nv">urlopen</span><span class="ss">(</span><span class="nv">req</span><span class="ss">)</span>.<span class="nv">read</span><span class="ss">()</span>
<span class="w">    </span><span class="nv">Message</span>.<span class="nv">Chat</span>.<span class="nv">SendMessage</span><span class="w"> </span><span class="ss">(</span><span class="s2">""</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">info</span><span class="ss">)</span>
</pre></div>

<p>The API I'm using requires me to use HTTPS. How can I make it bypass the
verification?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>If you <strong>just</strong> want to bypass verification, you can create a new SSLContext.
By default newly created contexts use CERT_NONE.</p>
<p>Be careful with this as stated in section 17.3.7.2.1</p>
<blockquote>
<p>When calling the SSLContext constructor directly, CERT_NONE is the default.
Since it does not authenticate the other peer, it can be insecure,
especially in client mode where most of time you would like to ensure the
authenticity of the server you’re talking to. Therefore, when in client
mode, it is highly recommended to use CERT_REQUIRED.</p>
</blockquote>
<p>But if you just want it to work now for some other reason you can do the
following, you'll have to <code>import ssl</code> as well:</p>
<div class="code"><pre class="code literal-block"><span class="nv">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">input</span>.<span class="nv">replace</span><span class="ss">(</span><span class="s2">"!web "</span>,<span class="w"> </span><span class="s2">""</span><span class="ss">)</span><span class="w">      </span>
<span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://domainsearch.p.mashape.com/index.php?name="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">input</span>
<span class="nv">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">urllib2</span>.<span class="nv">Request</span><span class="ss">(</span><span class="nv">url</span>,<span class="w"> </span><span class="nv">headers</span><span class="o">=</span>{<span class="w"> </span><span class="s1">'X-Mashape-Key'</span>:<span class="w"> </span><span class="s1">'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'</span><span class="w"> </span>}<span class="ss">)</span>
<span class="nv">gcontext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ssl</span>.<span class="nv">SSLContext</span><span class="ss">()</span><span class="w">  </span>#<span class="w"> </span><span class="nv">Only</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">gangstars</span>
<span class="nv">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">urllib2</span>.<span class="nv">urlopen</span><span class="ss">(</span><span class="nv">req</span>,<span class="w"> </span><span class="nv">context</span><span class="o">=</span><span class="nv">gcontext</span><span class="ss">)</span>.<span class="nv">read</span><span class="ss">()</span>
<span class="nv">Message</span>.<span class="nv">Chat</span>.<span class="nv">SendMessage</span><span class="w"> </span><span class="ss">(</span><span class="s2">""</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">info</span><span class="ss">)</span>
</pre></div>

<p>This should get round your problem but you're not really solving any of the
issues, but you won't see the <code>[SSL: CERTIFICATE_VERIFY_FAILED]</code> because you
now aren't verifying the cert!</p>
<p>To add to the above, if you want to know more about why you are seeing these
issues you will want to have a look at PEP 476.</p>
<blockquote>
<p>This PEP proposes to enable verification of X509 certificate signatures, as
well as hostname verification for Python's HTTP clients by default, subject
to opt-out on a per-call basis. This change would be applied to Python 2.7,
Python 3.4, and Python 3.5.</p>
</blockquote>
<p>There is an advised opt out which isn't dissimilar to my advice above:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">ssl</span>

<span class="c1"># This restores the same behavior as before.</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span><span class="p">()</span>
<span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s2">"https://no-valid-cert"</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>

<p>It also features a <strong>highly discouraged</strong> option via monkeypatching which you
don't often see in python:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">ssl</span>

<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>
</pre></div>

<p>Which overrides the default function for context creation with the function to
create an unverified context.</p>
<p>Please note with this as stated in the PEP:</p>
<blockquote>
<p>This guidance is aimed primarily at system administrators that wish to adopt
newer versions of Python that implement this PEP in legacy environments that
do not yet support certificate verification on HTTPS connections. For
example, an administrator may opt out by adding the monkeypatch above to
sitecustomize.py in their Standard Operating Environment for Python.
<strong>Applications and libraries SHOULD NOT be making this change process wide</strong>
(except perhaps in response to a system administrator controlled
configuration setting).</p>
</blockquote>
<p>If you want to read a paper on why not validating certs is bad in software you
can find it here!</p>
<p><br></p>
<h3>Suggest</h3>
<p>If you <strong>just</strong> want to bypass verification, you can create a new SSLContext.
By default newly created contexts use CERT_NONE.</p>
<p>Be careful with this as stated in section 17.3.7.2.1</p>
<blockquote>
<p>When calling the SSLContext constructor directly, CERT_NONE is the default.
Since it does not authenticate the other peer, it can be insecure,
especially in client mode where most of time you would like to ensure the
authenticity of the server you’re talking to. Therefore, when in client
mode, it is highly recommended to use CERT_REQUIRED.</p>
</blockquote>
<p>But if you just want it to work now for some other reason you can do the
following, you'll have to <code>import ssl</code> as well:</p>
<div class="code"><pre class="code literal-block"><span class="nv">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">input</span>.<span class="nv">replace</span><span class="ss">(</span><span class="s2">"!web "</span>,<span class="w"> </span><span class="s2">""</span><span class="ss">)</span><span class="w">      </span>
<span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://domainsearch.p.mashape.com/index.php?name="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">input</span>
<span class="nv">req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">urllib2</span>.<span class="nv">Request</span><span class="ss">(</span><span class="nv">url</span>,<span class="w"> </span><span class="nv">headers</span><span class="o">=</span>{<span class="w"> </span><span class="s1">'X-Mashape-Key'</span>:<span class="w"> </span><span class="s1">'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'</span><span class="w"> </span>}<span class="ss">)</span>
<span class="nv">gcontext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ssl</span>.<span class="nv">SSLContext</span><span class="ss">()</span><span class="w">  </span>#<span class="w"> </span><span class="nv">Only</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">gangstars</span>
<span class="nv">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">urllib2</span>.<span class="nv">urlopen</span><span class="ss">(</span><span class="nv">req</span>,<span class="w"> </span><span class="nv">context</span><span class="o">=</span><span class="nv">gcontext</span><span class="ss">)</span>.<span class="nv">read</span><span class="ss">()</span>
<span class="nv">Message</span>.<span class="nv">Chat</span>.<span class="nv">SendMessage</span><span class="w"> </span><span class="ss">(</span><span class="s2">""</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">info</span><span class="ss">)</span>
</pre></div>

<p>This should get round your problem but you're not really solving any of the
issues, but you won't see the <code>[SSL: CERTIFICATE_VERIFY_FAILED]</code> because you
now aren't verifying the cert!</p>
<p>To add to the above, if you want to know more about why you are seeing these
issues you will want to have a look at PEP 476.</p>
<blockquote>
<p>This PEP proposes to enable verification of X509 certificate signatures, as
well as hostname verification for Python's HTTP clients by default, subject
to opt-out on a per-call basis. This change would be applied to Python 2.7,
Python 3.4, and Python 3.5.</p>
</blockquote>
<p>There is an advised opt out which isn't dissimilar to my advice above:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">ssl</span>

<span class="c1"># This restores the same behavior as before.</span>
<span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span><span class="p">()</span>
<span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s2">"https://no-valid-cert"</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>

<p>It also features a <strong>highly discouraged</strong> option via monkeypatching which you
don't often see in python:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">ssl</span>

<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>
</pre></div>

<p>Which overrides the default function for context creation with the function to
create an unverified context.</p>
<p>Please note with this as stated in the PEP:</p>
<blockquote>
<p>This guidance is aimed primarily at system administrators that wish to adopt
newer versions of Python that implement this PEP in legacy environments that
do not yet support certificate verification on HTTPS connections. For
example, an administrator may opt out by adding the monkeypatch above to
sitecustomize.py in their Standard Operating Environment for Python.
<strong>Applications and libraries SHOULD NOT be making this change process wide</strong>
(except perhaps in response to a system administrator controlled
configuration setting).</p>
</blockquote>
<p>If you want to read a paper on why not validating certs is bad in software you
can find it here!</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-best-workaround-for-the-wcf-client-using-block-issue/" class="u-url">What is the best workaround for the WCF client `using` block issue?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-best-workaround-for-the-wcf-client-using-block-issue/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T16:03:16+08:00" itemprop="datePublished" title="2023-03-03 16:03">2023-03-03 16:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I like instantiating my WCF service clients within a <code>using</code> block as it's
pretty much the standard way to use resources that implement <code>IDisposable</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">using</span><span class="w"> </span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SomeWCFServiceClient</span><span class="p">())</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="n">Do</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">client</span><span class="w"> </span>
<span class="p">}</span>
</pre></div>

<p>But, as noted in this MSDN article, wrapping a WCF client in a <code>using</code> block
could mask any errors that result in the client being left in a faulted state
(like a timeout or communication problem). Long story short, when <code>Dispose()</code>
is called, the client's <code>Close()</code> method fires, but throws an error because
it's in a faulted state. The original exception is then masked by the second
exception. Not good.</p>
<p>The suggested workaround in the MSDN article is to completely avoid using a
<code>using</code> block, and to instead instantiate your clients and use them something
like this:</p>
<div class="code"><pre class="code literal-block">try
{
    ...
    client.Close();
}
catch (CommunicationException e)
{
    ...
    client.Abort();
}
catch (TimeoutException e)
{
    ...
    client.Abort();
}
catch (Exception e)
{
    ...
    client.Abort();
    throw;
}
</pre></div>

<p>Compared to the <code>using</code> block, I think that's ugly. And a lot of code to write
each time you need a client.</p>
<p>Luckily, I found a few other workarounds, such as this one on the (now
defunct) IServiceOriented blog. You start with:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">delegate</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">UseServiceDelegate</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">(</span><span class="nv">T</span><span class="w"> </span><span class="nv">proxy</span><span class="ss">)</span><span class="c1">;</span>

<span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">Service</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span>
{<span class="w"> </span>
<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">ChannelFactory</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">_channelFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ChannelFactory</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">(</span><span class="s2">""</span><span class="ss">)</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">Use</span><span class="ss">(</span><span class="nv">UseServiceDelegate</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">codeBlock</span><span class="ss">)</span><span class="w"> </span>
<span class="w">    </span>{<span class="w"> </span>
<span class="w">        </span><span class="nv">IClientChannel</span><span class="w"> </span><span class="nv">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">(</span><span class="nv">IClientChannel</span><span class="ss">)</span><span class="nv">_channelFactory</span>.<span class="nv">CreateChannel</span><span class="ss">()</span><span class="c1">; </span>
<span class="w">        </span><span class="nv">bool</span><span class="w"> </span><span class="nv">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">false</span><span class="c1">; </span>
<span class="w">        </span><span class="nv">try</span><span class="w"> </span>
<span class="w">        </span>{<span class="w"> </span>
<span class="w">            </span><span class="nv">codeBlock</span><span class="ss">((</span><span class="nv">T</span><span class="ss">)</span><span class="nv">proxy</span><span class="ss">)</span><span class="c1">; </span>
<span class="w">            </span><span class="nv">proxy</span>.<span class="nv">Close</span><span class="ss">()</span><span class="c1">; </span>
<span class="w">            </span><span class="nv">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">true</span><span class="c1">; </span>
<span class="w">        </span>}<span class="w"> </span>
<span class="w">        </span><span class="nv">finally</span><span class="w"> </span>
<span class="w">        </span>{<span class="w"> </span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="o">!</span><span class="nv">success</span><span class="ss">)</span><span class="w"> </span>
<span class="w">            </span>{<span class="w"> </span>
<span class="w">                </span><span class="nv">proxy</span>.<span class="nv">Abort</span><span class="ss">()</span><span class="c1">; </span>
<span class="w">            </span>}<span class="w"> </span>
<span class="w">        </span>}<span class="w"> </span>
<span class="w">     </span>}<span class="w"> </span>
}
</pre></div>

<p>Which then allows:</p>
<div class="code"><pre class="code literal-block">Service&lt;IOrderService&gt;.Use(orderService =&gt; 
{ 
    orderService.PlaceOrder(request); 
});
</pre></div>

<p>That's not bad, but I don't think it's as expressive and easily understandable
as the <code>using</code> block.</p>
<p>The workaround I'm currently trying to use I first read about on
blog.davidbarret.net. Basically, you override the client's <code>Dispose()</code> method
wherever you use it. Something like:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">partial</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">SomeWCFServiceClient</span><span class="w"> </span>:<span class="w"> </span><span class="nv">IDisposable</span>
{
<span class="w">    </span><span class="nv">void</span><span class="w"> </span><span class="nv">IDisposable</span>.<span class="nv">Dispose</span><span class="ss">()</span><span class="w"> </span>
<span class="w">    </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">this</span>.<span class="nv">State</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">CommunicationState</span>.<span class="nv">Faulted</span><span class="ss">)</span><span class="w"> </span>
<span class="w">        </span>{
<span class="w">            </span><span class="nv">this</span>.<span class="nv">Abort</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">        </span>}<span class="w"> </span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span>
<span class="w">        </span>{
<span class="w">            </span><span class="nv">this</span>.<span class="nv">Close</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">    </span>}
}
</pre></div>

<p>This appears to be able to allow the <code>using</code> block again without the danger of
masking a faulted state exception.</p>
<p>So, are there any other gotchas I have to look out for using these
workarounds? Has anybody come up with anything better?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Actually, although I blogged (see Luke's answer), I think this is better than
my IDisposable wrapper. Typical code:</p>
<div class="code"><pre class="code literal-block">Service&lt;IOrderService&gt;.Use(orderService=&gt;
{
  orderService.PlaceOrder(request);
});
</pre></div>

<hr>
<p>(edit per comments)</p>
<p>Since <code>Use</code> returns void, the easiest way to handle return values is via a
captured variable:</p>
<div class="code"><pre class="code literal-block"><span class="kt">int</span><span class="w"> </span><span class="n">newOrderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// need a value for definite assignment</span>
<span class="n">Service</span><span class="o">&lt;</span><span class="n">IOrderService</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Use</span><span class="p">(</span><span class="n">orderService</span><span class="o">=&gt;</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">newOrderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderService</span><span class="p">.</span><span class="n">PlaceOrder</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">newOrderId</span><span class="p">);</span><span class="w"> </span><span class="c1">// should be updated</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Given a choice between the solution advocated by IServiceOriented.com and the
solution advocated by David Barret's blog, I prefer the simplicity offered by
overriding the client's Dispose() method. This allows me to continue to use
the using() statement as one would expect with a disposable object. However,
as @Brian pointed out, this solution contains a race condition in that the
State might not be faulted when it is checked but could be by the time Close()
is called, in which case the CommunicationException still occurs.</p>
<p>So, to get around this, I've employed a solution that mixes the best of both
worlds.</p>
<div class="code"><pre class="code literal-block"><span class="nv">void</span><span class="w"> </span><span class="nv">IDisposable</span>.<span class="nv">Dispose</span><span class="ss">()</span>
{
<span class="w">    </span><span class="nv">bool</span><span class="w"> </span><span class="nv">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">false</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">try</span><span class="w"> </span>
<span class="w">    </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">State</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">CommunicationState</span>.<span class="nv">Faulted</span><span class="ss">)</span><span class="w"> </span>
<span class="w">        </span>{
<span class="w">            </span><span class="nv">Close</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">            </span><span class="nv">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">true</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">    </span>}<span class="w"> </span>
<span class="w">    </span><span class="nv">finally</span><span class="w"> </span>
<span class="w">    </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="o">!</span><span class="nv">success</span><span class="ss">)</span><span class="w"> </span>
<span class="w">            </span><span class="nv">Abort</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2064.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2062.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
