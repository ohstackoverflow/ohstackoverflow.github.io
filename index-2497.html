<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2497) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2497.html">
<link rel="prev" href="index-2498.html" type="text/html">
<link rel="next" href="index-2496.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/path-issue-with-pytest-importerror-no-module-named-yadayadayada/" class="u-url">PATH issue with pytest 'ImportError: No module named YadaYadaYada'</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/path-issue-with-pytest-importerror-no-module-named-yadayadayada/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T20:34:55+08:00" itemprop="datePublished" title="2023-03-04 20:34">2023-03-04 20:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I used <em>easy_install</em> to install pytest on a Mac and started writing tests for
a project with a file structure likes so:</p>
<div class="code"><pre class="code literal-block">repo/
   |--app.py
   |--settings.py
   |--models.py
   |--tests/
          |--test_app.py
</pre></div>

<p>Run <code>py.test</code> while in the <em>repo</em> directory, and everything behaves as you
would expect.</p>
<p>But when I try that same thing on either Linux or Windows (both have pytest
2.2.3 on them), it barks whenever it hits its first import of something from
my application path. For instance, <code>from app import some_def_in_app</code>.</p>
<p>Do I need to be editing my PATH to run <em>py.test</em> on these systems?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Yes, the source folder is not in Python's path if you <code>cd</code> to the tests
directory.</p>
<p>You have two choices:</p>
<ol>
<li>
<p>Add the path manually to the test files. Something like this:</p>
<div class="code"><pre class="code literal-block"> <span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
</pre></div>

<p>myPath = os.path.dirname(os.path.abspath(<strong>file</strong>))
 sys.path.insert(0, myPath + '/../')</p>
</li>
<li>
<p>Run the tests with the env var <code>PYTHONPATH=../</code>.</p>
</li>
</ol>
<p><br></p>
<h3>Suggest</h3>
<h4>Recommended approach for <code>pytest&gt;=7</code>: use the <code>pythonpath</code> setting</h4>
<p>Recently, <code>pytest</code> has added a new core plugin that supports <code>sys.path</code>
modifications via the <code>pythonpath</code> configuration value. The solution is thus
much simpler now and doesn't require any workarounds anymore:</p>
<p><code>pyproject.toml</code> example:</p>
<div class="code"><pre class="code literal-block"><span class="k">[tool.pytest.ini_options]</span>
<span class="na">pythonpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[</span>
<span class="w">  </span><span class="na">"."</span>
<span class="na">]</span>
</pre></div>

<p><code>pytest.ini</code> example:</p>
<div class="code"><pre class="code literal-block"><span class="k">[pytest]</span>
<span class="na">pythonpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">.</span>
</pre></div>

<p>The path entries are calculated relative to the rootdir, thus <code>.</code> adds <code>repo</code>
directory to <code>sys.path</code> in this case.</p>
<p>Multiple path entries are also allowed: for a layout</p>
<div class="code"><pre class="code literal-block">repo/
├── src/
|   └── lib.py
├── app.py
└── tests
     ├── test_app.py
     └── test_lib.py
</pre></div>

<p>the configuration</p>
<div class="code"><pre class="code literal-block"><span class="k">[tool.pytest.ini_options]</span>
<span class="na">pythonpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[</span>
<span class="w">  </span><span class="na">".", "src",</span>
<span class="na">]</span>
</pre></div>

<p>or</p>
<div class="code"><pre class="code literal-block"><span class="k">[pytest]</span>
<span class="na">pythonpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">. src</span>
</pre></div>

<p>will add both <code>app</code> and <code>lib</code> modules to <code>sys.path</code>, so</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">app</span>
<span class="kn">import</span> <span class="nn">lib</span>
</pre></div>

<p>will both work.</p>
<h4>Original answer (not recommended for recent pytest versions; use for</h4>
<p><code>pytest&lt;7</code> only): <code>conftest</code> solution</p>
<p>The least invasive solution is adding an empty file named <code>conftest.py</code> in the
<code>repo/</code> directory:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>touch<span class="w"> </span>repo/conftest.py
</pre></div>

<p>That's it. No need to write custom code for mangling the <code>sys.path</code> or
remember to drag <code>PYTHONPATH</code> along, or placing <code>__init__.py</code> into dirs where
it doesn't belong (using <code>python -m pytest</code> as suggested in Apteryx's answer
is a good solution though!).</p>
<p>The project directory afterwards:</p>
<div class="code"><pre class="code literal-block">repo
├── conftest.py
├── app.py
├── settings.py
├── models.py
└── tests
     └── test_app.py
</pre></div>

<h4>Explanation</h4>
<p><code>pytest</code> looks for the <code>conftest</code> modules on test collection to gather custom
hooks and fixtures, and in order to import the custom objects from them,
<strong><code>pytest</code> adds the parent directory of the <code>conftest.py</code> to the <code>sys.path</code></strong>
(in this case the <code>repo</code> directory).</p>
<h4>Other project structures</h4>
<p>If you have other project structure, place the <code>conftest.py</code> in the package
root dir (the one that contains packages but is not a package itself, so does
<strong>not</strong> contain an <code>__init__.py</code>), for example:</p>
<div class="code"><pre class="code literal-block">repo
├── conftest.py
├── spam
│   ├── __init__.py
│   ├── bacon.py
│   └── egg.py
├── eggs
│   ├── __init__.py
│   └── sausage.py
└── tests
     ├── test_bacon.py
     └── test_egg.py
</pre></div>

<h4>
<code>src</code> layout</h4>
<p>Although this approach can be used with the <code>src</code> layout (place <code>conftest.py</code>
in the <code>src</code> dir):</p>
<div class="code"><pre class="code literal-block">repo
├── src
│   ├── conftest.py
│   ├── spam
│   │   ├── __init__.py
│   │   ├── bacon.py
│   │   └── egg.py
│   └── eggs 
│       ├── __init__.py
│       └── sausage.py
└── tests
     ├── test_bacon.py
     └── test_egg.py
</pre></div>

<p>beware that adding <code>src</code> to <code>PYTHONPATH</code> mitigates the meaning and benefits of
the <code>src</code> layout! You will end up with testing the code from repository and
not the installed package. If you need to do it, maybe you don't need the
<code>src</code> dir at all.</p>
<h4>Where to go from here</h4>
<p>Of course, <code>conftest</code> modules are not just some files to help the source code
discovery; it's where all the project-specific enhancements of the <code>pytest</code>
framework and the customization of your test suite happen. <code>pytest</code> has a lot
of information on <code>conftest</code> modules scattered throughout their docs; start
with <code>conftest.py</code>: local per-directory plugins</p>
<p>Also, SO has an excellent question on <code>conftest</code> modules: In py.test, what is
the use of conftest.py files?</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-filter-a-recyclerview-with-a-searchview/" class="u-url">How to filter a RecyclerView with a SearchView</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-filter-a-recyclerview-with-a-searchview/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T20:32:54+08:00" itemprop="datePublished" title="2023-03-04 20:32">2023-03-04 20:32</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am trying to implement the <code>SearchView</code> from the support library. I want the
user to be to use the <code>SearchView</code> to filter a <code>List</code> of movies in a
<code>RecyclerView</code>.</p>
<p>I have followed a few tutorials so far and I have added the <code>SearchView</code> to
the <code>ActionBar</code>, but I am not really sure where to go from here. I have seen a
few examples but none of them show results as you start typing.</p>
<p>This is my <code>MainActivity</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">MainActivity</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">ActionBarActivity</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">RecyclerView</span><span class="w"> </span><span class="n">mRecyclerView</span><span class="p">;</span>
<span class="w">    </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">LayoutManager</span><span class="w"> </span><span class="n">mLayoutManager</span><span class="p">;</span>
<span class="w">    </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">Adapter</span><span class="w"> </span><span class="n">mAdapter</span><span class="p">;</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">activity_recycler_view</span><span class="p">);</span>

<span class="w">        </span><span class="n">mRecyclerView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">RecyclerView</span><span class="p">)</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">recycler_view</span><span class="p">);</span>
<span class="w">        </span><span class="n">mRecyclerView</span><span class="o">.</span><span class="n">setHasFixedSize</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span>

<span class="w">        </span><span class="n">mLayoutManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">LinearLayoutManager</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<span class="w">        </span><span class="n">mRecyclerView</span><span class="o">.</span><span class="n">setLayoutManager</span><span class="p">(</span><span class="n">mLayoutManager</span><span class="p">);</span>

<span class="w">        </span><span class="n">mAdapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">CardAdapter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="err">@</span><span class="n">Override</span>
<span class="w">            </span><span class="n">public</span><span class="w"> </span><span class="n">Filter</span><span class="w"> </span><span class="n">getFilter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="n">mRecyclerView</span><span class="o">.</span><span class="n">setAdapter</span><span class="p">(</span><span class="n">mAdapter</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">onCreateOptionsMenu</span><span class="p">(</span><span class="n">Menu</span><span class="w"> </span><span class="n">menu</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Inflate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">menu</span><span class="p">;</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">adds</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">present</span><span class="o">.</span>
<span class="w">        </span><span class="n">getMenuInflater</span><span class="p">()</span><span class="o">.</span><span class="n">inflate</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">menu_main</span><span class="p">,</span><span class="w"> </span><span class="n">menu</span><span class="p">);</span>
<span class="w">        </span><span class="n">SearchManager</span><span class="w"> </span><span class="n">searchManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SearchManager</span><span class="p">)</span><span class="w"> </span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="o">.</span><span class="n">SEARCH_SERVICE</span><span class="p">);</span>
<span class="w">        </span><span class="n">SearchView</span><span class="w"> </span><span class="n">searchView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SearchView</span><span class="p">)</span><span class="w"> </span><span class="n">menu</span><span class="o">.</span><span class="n">findItem</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">menu_search</span><span class="p">)</span><span class="o">.</span><span class="n">getActionView</span><span class="p">();</span>
<span class="w">        </span><span class="n">searchView</span><span class="o">.</span><span class="n">setSearchableInfo</span><span class="p">(</span><span class="n">searchManager</span><span class="o">.</span><span class="n">getSearchableInfo</span><span class="p">(</span><span class="n">getComponentName</span><span class="p">()));</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">onOptionsItemSelected</span><span class="p">(</span><span class="n">MenuItem</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Handle</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="n">clicks</span><span class="w"> </span><span class="n">here</span><span class="o">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">bar</span><span class="w"> </span><span class="n">will</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">automatically</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">clicks</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Home</span><span class="o">/</span><span class="n">Up</span><span class="w"> </span><span class="n">button</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">long</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="n">activity</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">AndroidManifest</span><span class="o">.</span><span class="n">xml</span><span class="o">.</span>
<span class="w">        </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">getItemId</span><span class="p">();</span>

<span class="w">        </span><span class="o">//</span><span class="n">noinspection</span><span class="w"> </span><span class="n">SimplifiableIfStatement</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">action_settings</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">super</span><span class="o">.</span><span class="n">onOptionsItemSelected</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>And this is my <code>Adapter</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">CardAdapter</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">Adapter</span><span class="o">&lt;</span><span class="n">CardAdapter</span><span class="o">.</span><span class="n">ViewHolder</span><span class="o">&gt;</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="n">Filterable</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mItems</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">CardAdapter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">();</span>
<span class="w">        </span><span class="n">mItems</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Movie</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">Movie</span><span class="w"> </span><span class="n">movie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Movie</span><span class="p">();</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">"Spiderman"</span><span class="p">);</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setRating</span><span class="p">(</span><span class="s2">"92"</span><span class="p">);</span>
<span class="w">        </span><span class="n">mItems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">);</span>

<span class="w">        </span><span class="n">movie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Movie</span><span class="p">();</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">"Doom 3"</span><span class="p">);</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setRating</span><span class="p">(</span><span class="s2">"91"</span><span class="p">);</span>
<span class="w">        </span><span class="n">mItems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">);</span>

<span class="w">        </span><span class="n">movie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Movie</span><span class="p">();</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">"Transformers"</span><span class="p">);</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setRating</span><span class="p">(</span><span class="s2">"88"</span><span class="p">);</span>
<span class="w">        </span><span class="n">mItems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">);</span>

<span class="w">        </span><span class="n">movie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Movie</span><span class="p">();</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">"Transformers 2"</span><span class="p">);</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setRating</span><span class="p">(</span><span class="s2">"87"</span><span class="p">);</span>
<span class="w">        </span><span class="n">mItems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">);</span>

<span class="w">        </span><span class="n">movie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Movie</span><span class="p">();</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">"Transformers 3"</span><span class="p">);</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setRating</span><span class="p">(</span><span class="s2">"86"</span><span class="p">);</span>
<span class="w">        </span><span class="n">mItems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">);</span>

<span class="w">        </span><span class="n">movie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Movie</span><span class="p">();</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">"Noah"</span><span class="p">);</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setRating</span><span class="p">(</span><span class="s2">"86"</span><span class="p">);</span>
<span class="w">        </span><span class="n">mItems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">);</span>

<span class="w">        </span><span class="n">movie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Movie</span><span class="p">();</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">"Ironman"</span><span class="p">);</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setRating</span><span class="p">(</span><span class="s2">"86"</span><span class="p">);</span>
<span class="w">        </span><span class="n">mItems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">);</span>

<span class="w">        </span><span class="n">movie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Movie</span><span class="p">();</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">"Ironman 2"</span><span class="p">);</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setRating</span><span class="p">(</span><span class="s2">"86"</span><span class="p">);</span>
<span class="w">        </span><span class="n">mItems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">);</span>

<span class="w">        </span><span class="n">movie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Movie</span><span class="p">();</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="s2">"Ironman 3"</span><span class="p">);</span>
<span class="w">        </span><span class="n">movie</span><span class="o">.</span><span class="n">setRating</span><span class="p">(</span><span class="s2">"86"</span><span class="p">);</span>
<span class="w">        </span><span class="n">mItems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ViewHolder</span><span class="w"> </span><span class="n">onCreateViewHolder</span><span class="p">(</span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">viewGroup</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">View</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutInflater</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="n">viewGroup</span><span class="o">.</span><span class="n">getContext</span><span class="p">())</span><span class="o">.</span><span class="n">inflate</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">recycler_view_card_item</span><span class="p">,</span><span class="w"> </span><span class="n">viewGroup</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ViewHolder</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onBindViewHolder</span><span class="p">(</span><span class="n">ViewHolder</span><span class="w"> </span><span class="n">viewHolder</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Movie</span><span class="w"> </span><span class="n">movie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mItems</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="n">viewHolder</span><span class="o">.</span><span class="n">tvMovie</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">movie</span><span class="o">.</span><span class="n">getName</span><span class="p">());</span>
<span class="w">        </span><span class="n">viewHolder</span><span class="o">.</span><span class="n">tvMovieRating</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">movie</span><span class="o">.</span><span class="n">getRating</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getItemCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mItems</span><span class="o">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="n">ViewHolder</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">ViewHolder</span><span class="p">{</span>

<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">TextView</span><span class="w"> </span><span class="n">tvMovie</span><span class="p">;</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">TextView</span><span class="w"> </span><span class="n">tvMovieRating</span><span class="p">;</span>

<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">ViewHolder</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">itemView</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">super</span><span class="p">(</span><span class="n">itemView</span><span class="p">);</span>
<span class="w">            </span><span class="n">tvMovie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">TextView</span><span class="p">)</span><span class="n">itemView</span><span class="o">.</span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">movieName</span><span class="p">);</span>
<span class="w">            </span><span class="n">tvMovieRating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">TextView</span><span class="p">)</span><span class="n">itemView</span><span class="o">.</span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">movieRating</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<h2>Introduction</h2>
<p>Since it is not really clear from your question what exactly you are having
trouble with, I wrote up this quick walkthrough about how to implement this
feature; if you still have questions feel free to ask.</p>
<p>I have a working example of everything I am talking about here in this
<strong>GitHub Repository</strong>.</p>
<p>In any case the result should looks something like this:</p>
<p><img alt="demo image" src="images/qDtH7.gif"></p>
<p>If you first want to play around with the demo app you can install it from the
Play Store:</p>
<p><img alt="Get it on Google
Play" src="https://developer.android.com/images/brand/en_generic_rgb_wo_60.png"></p>
<p>Anyway lets get started.</p>
<hr>
<h2>Setting up the <code>SearchView</code>
</h2>
<p>In the folder <code>res/menu</code> create a new file called <code>main_menu.xml</code>. In it add
an item and set the <code>actionViewClass</code> to
<code>android.support.v7.widget.SearchView</code>. Since you are using the support
library you have to use the namespace of the support library to set the
<code>actionViewClass</code> attribute. Your xml file should look something like this:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;menu</span><span class="w"> </span><span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
<span class="w">      </span><span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">android:id=</span><span class="s">"@+id/action_search"</span>
<span class="w">          </span><span class="na">android:title=</span><span class="s">"@string/action_search"</span>
<span class="w">          </span><span class="na">app:actionViewClass=</span><span class="s">"android.support.v7.widget.SearchView"</span>
<span class="w">          </span><span class="na">app:showAsAction=</span><span class="s">"always"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/menu&gt;</span>
</pre></div>

<p>In your <code>Fragment</code> or <code>Activity</code> you have to inflate this menu xml like usual,
then you can look for the <code>MenuItem</code> which contains the <code>SearchView</code> and
implement the <code>OnQueryTextListener</code> which we are going to use to listen for
changes to the text entered into the <code>SearchView</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@Override</span>
<span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">onCreateOptionsMenu</span><span class="p">(</span><span class="n">Menu</span><span class="w"> </span><span class="n">menu</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">getMenuInflater</span><span class="p">().</span><span class="n">inflate</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">menu</span><span class="p">.</span><span class="n">menu_main</span><span class="p">,</span><span class="w"> </span><span class="n">menu</span><span class="p">);</span>

<span class="w">    </span><span class="n">final</span><span class="w"> </span><span class="n">MenuItem</span><span class="w"> </span><span class="n">searchItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">menu</span><span class="p">.</span><span class="n">findItem</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">action_search</span><span class="p">);</span>
<span class="w">    </span><span class="n">final</span><span class="w"> </span><span class="n">SearchView</span><span class="w"> </span><span class="n">searchView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SearchView</span><span class="p">)</span><span class="w"> </span><span class="n">searchItem</span><span class="p">.</span><span class="n">getActionView</span><span class="p">();</span>
<span class="w">    </span><span class="n">searchView</span><span class="p">.</span><span class="n">setOnQueryTextListener</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="err">}</span>

<span class="nv">@Override</span>
<span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">onQueryTextChange</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Here</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">going</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">filter</span><span class="w"> </span><span class="n">logic</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="err">}</span>

<span class="nv">@Override</span>
<span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">onQueryTextSubmit</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="err">}</span>
</pre></div>

<p>And now the <code>SearchView</code> is ready to be used. We will implement the filter
logic later on in <code>onQueryTextChange()</code> once we are finished implementing the
<code>Adapter</code>.</p>
<hr>
<h2>Setting up the <code>Adapter</code>
</h2>
<p>First and foremost this is the model class I am going to use for this example:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">ExampleModel</span><span class="w"> </span>{

<span class="w">    </span><span class="nv">private</span><span class="w"> </span><span class="nv">final</span><span class="w"> </span><span class="nv">long</span><span class="w"> </span><span class="nv">mId</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">private</span><span class="w"> </span><span class="nv">final</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">mText</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">ExampleModel</span><span class="ss">(</span><span class="nv">long</span><span class="w"> </span><span class="nv">id</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">text</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">mId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">id</span><span class="c1">;</span>
<span class="w">        </span><span class="nv">mText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">text</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">long</span><span class="w"> </span><span class="nv">getId</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">mId</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">getText</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">mText</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<p>It's just your basic model which will display a text in the <code>RecyclerView</code>.
This is the layout I am going to use to display the text:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;layout</span><span class="w"> </span><span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;data&gt;</span>

<span class="w">        </span><span class="nt">&lt;variable</span>
<span class="w">            </span><span class="na">name=</span><span class="s">"model"</span>
<span class="w">            </span><span class="na">type=</span><span class="s">"com.github.wrdlbrnft.searchablerecyclerviewdemo.ui.models.ExampleModel"</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;/data&gt;</span>

<span class="w">    </span><span class="nt">&lt;FrameLayout</span>
<span class="w">        </span><span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
<span class="w">        </span><span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
<span class="w">        </span><span class="na">android:background=</span><span class="s">"?attr/selectableItemBackground"</span>
<span class="w">        </span><span class="na">android:clickable=</span><span class="s">"true"</span><span class="nt">&gt;</span>

<span class="w">        </span><span class="nt">&lt;TextView</span>
<span class="w">            </span><span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
<span class="w">            </span><span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
<span class="w">            </span><span class="na">android:padding=</span><span class="s">"8dp"</span>
<span class="w">            </span><span class="na">android:text=</span><span class="s">"@{model.text}"</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;/FrameLayout&gt;</span>

<span class="nt">&lt;/layout&gt;</span>
</pre></div>

<p>As you can see I use Data Binding. If you have never worked with data binding
before don't be discouraged! It's very simple and powerful, however I can't
explain how it works in the scope of this answer.</p>
<p>This is the <code>ViewHolder</code> for the <code>ExampleModel</code> class:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ExampleViewHolder</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">ViewHolder</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">ItemExampleBinding</span><span class="w"> </span><span class="n">mBinding</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ExampleViewHolder</span><span class="p">(</span><span class="n">ItemExampleBinding</span><span class="w"> </span><span class="n">binding</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="n">binding</span><span class="o">.</span><span class="n">getRoot</span><span class="p">());</span>
<span class="w">        </span><span class="n">mBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binding</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">bind</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mBinding</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Again nothing special. It just uses data binding to bind the model class to
this layout as we have defined in the layout xml above.</p>
<p>Now we can finally come to the really interesting part: Writing the Adapter. I
am going to skip over the basic implementation of the <code>Adapter</code> and am instead
going to concentrate on the parts which are relevant for this answer.</p>
<p>But first there is one thing we have to talk about: The <strong><code>SortedList</code></strong>
class.</p>
<hr>
<h2>SortedList</h2>
<p>The <code>SortedList</code> is a completely amazing tool which is part of the
<code>RecyclerView</code> library. It takes care of notifying the <code>Adapter</code> about changes
to the data set and does so it a very efficient way. The only thing it
requires you to do is specify an order of the elements. You need to do that by
implementing a <code>compare()</code> method which compares two elements in the
<code>SortedList</code> just like a <code>Comparator</code>. But instead of sorting a <code>List</code> it is
used to sort the items in the <code>RecyclerView</code>!</p>
<p>The <code>SortedList</code> interacts with the <code>Adapter</code> through a <code>Callback</code> class which
you have to implement:</p>
<div class="code"><pre class="code literal-block"><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">SortedList</span><span class="p">.</span><span class="n">Callback</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SortedList</span><span class="p">.</span><span class="n">Callback</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onInserted</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="k">position</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="nf">count</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">         </span><span class="n">mAdapter</span><span class="p">.</span><span class="n">notifyItemRangeInserted</span><span class="p">(</span><span class="k">position</span><span class="p">,</span><span class="w"> </span><span class="nf">count</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onRemoved</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="k">position</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="nf">count</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">mAdapter</span><span class="p">.</span><span class="n">notifyItemRangeRemoved</span><span class="p">(</span><span class="k">position</span><span class="p">,</span><span class="w"> </span><span class="nf">count</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onMoved</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">fromPosition</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">toPosition</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">mAdapter</span><span class="p">.</span><span class="n">notifyItemMoved</span><span class="p">(</span><span class="n">fromPosition</span><span class="p">,</span><span class="w"> </span><span class="n">toPosition</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onChanged</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="k">position</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="nf">count</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">mAdapter</span><span class="p">.</span><span class="n">notifyItemRangeChanged</span><span class="p">(</span><span class="k">position</span><span class="p">,</span><span class="w"> </span><span class="nf">count</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">compare</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mComparator</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">areContentsTheSame</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">oldItem</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">newItem</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">oldItem</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">newItem</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">areItemsTheSame</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">item1</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">item2</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">item1</span><span class="p">.</span><span class="n">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">item2</span><span class="p">.</span><span class="n">getId</span><span class="p">();</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>In the methods at the top of the callback like <code>onMoved</code>, <code>onInserted</code>, etc.
you have to call the equivalent notify method of your <code>Adapter</code>. The three
methods at the bottom <code>compare</code>, <code>areContentsTheSame</code> and <code>areItemsTheSame</code>
you have to implement according to what kind of objects you want to display
and in what order these objects should appear on the screen.</p>
<p>Let's go through these methods one by one:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@Override</span>
<span class="k">public</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">compare</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">mComparator</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="err">}</span>
</pre></div>

<p>This is the <code>compare()</code> method I talked about earlier. In this example I am
just passing the call to a <code>Comparator</code> which compares the two models. If you
want the items to appear in alphabetical order on the screen. This comparator
might look like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ALPHABETICAL_COMPARATOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">compare</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">getText</span><span class="p">().</span><span class="n">compareTo</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">getText</span><span class="p">());</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span><span class="p">;</span>
</pre></div>

<p>Now let's take a look at the next method:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@Override</span>
<span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">areContentsTheSame</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">oldItem</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">newItem</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">oldItem</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">newItem</span><span class="p">);</span>
<span class="err">}</span>
</pre></div>

<p>The purpose of this method is to determine if the content of a model has
changed. The <code>SortedList</code> uses this to determine if a change event needs to be
invoked - in other words if the <code>RecyclerView</code> should crossfade the old and
new version. If you model classes have a correct <code>equals()</code> and <code>hashCode()</code>
implementation you can usually just implement it like above. If we add an
<code>equals()</code> and <code>hashCode()</code> implementation to the <code>ExampleModel</code> class it
should look something like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="n">SortedListAdapter</span><span class="p">.</span><span class="n">ViewModel</span><span class="w"> </span><span class="err">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">long</span><span class="w"> </span><span class="n">mId</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">mText</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">ExampleModel</span><span class="p">(</span><span class="n">long</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nc">text</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">mId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">        </span><span class="n">mText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">text</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">long</span><span class="w"> </span><span class="n">getId</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mId</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">getText</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mText</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="k">equals</span><span class="p">(</span><span class="k">Object</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">o</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">getClass</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">getClass</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>

<span class="w">        </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleModel</span><span class="p">)</span><span class="w"> </span><span class="n">o</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">mId</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mText</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="vm">?</span><span class="w"> </span><span class="n">mText</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">mText</span><span class="p">)</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">mText</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>

<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">hashCode</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="nc">int</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nc">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">mId</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="p">(</span><span class="n">mId</span><span class="w"> </span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="mi">32</span><span class="p">));</span>
<span class="w">        </span><span class="k">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">mText</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="vm">?</span><span class="w"> </span><span class="n">mText</span><span class="p">.</span><span class="n">hashCode</span><span class="p">()</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">result</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>Quick side note: Most IDE's like Android Studio, IntelliJ and Eclipse have
functionality to generate <code>equals()</code> and <code>hashCode()</code> implementations for you
at the press of a button! So you don't have to implement them yourself. Look
up on the internet how it works in your IDE!</p>
<p>Now let's take a look at the last method:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@Override</span>
<span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">areItemsTheSame</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">item1</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">item2</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">item1</span><span class="p">.</span><span class="n">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">item2</span><span class="p">.</span><span class="n">getId</span><span class="p">();</span>
<span class="err">}</span>
</pre></div>

<p>The <code>SortedList</code> uses this method to check if two items refer to the same
thing. In simplest terms (without explaining how the <code>SortedList</code> works) this
is used to determine if an object is already contained in the <code>List</code> and if
either an add, move or change animation needs to be played. If your models
have an id you would usually compare just the id in this method. If they don't
you need to figure out some other way to check this, but however you end up
implementing this depends on your specific app. Usually it is the simplest
option to give all models an id - that could for example be the primary key
field if you are querying the data from a database.</p>
<p>With the <code>SortedList.Callback</code> correctly implemented we can create an instance
of the <code>SortedList</code>:</p>
<div class="code"><pre class="code literal-block">final SortedList&lt;ExampleModel&gt; list = new SortedList&lt;&gt;(ExampleModel.class, mCallback);
</pre></div>

<p>As the first parameter in the constructor of the <code>SortedList</code> you need to pass
the class of your models. The other parameter is just the
<code>SortedList.Callback</code> we defined above.</p>
<p>Now let's get down to business: If we implement the <code>Adapter</code> with a
<code>SortedList</code> it should look something like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ExampleAdapter</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">Adapter</span><span class="o">&lt;</span><span class="n">ExampleViewHolder</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">SortedList</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mSortedList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SortedList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">ExampleModel</span><span class="o">.</span><span class="k">class</span><span class="p">,</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SortedList</span><span class="o">.</span><span class="n">Callback</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">compare</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">mComparator</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onInserted</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">notifyItemRangeInserted</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onRemoved</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">notifyItemRangeRemoved</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onMoved</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">fromPosition</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">toPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">notifyItemMoved</span><span class="p">(</span><span class="n">fromPosition</span><span class="p">,</span><span class="w"> </span><span class="n">toPosition</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onChanged</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">notifyItemRangeChanged</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">areContentsTheSame</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">oldItem</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">newItem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">oldItem</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">newItem</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">areItemsTheSame</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">item1</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">item2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">item1</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">item2</span><span class="o">.</span><span class="n">getId</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">LayoutInflater</span><span class="w"> </span><span class="n">mInflater</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mComparator</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ExampleAdapter</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">comparator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mInflater</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutInflater</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<span class="w">        </span><span class="n">mComparator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comparator</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ExampleViewHolder</span><span class="w"> </span><span class="n">onCreateViewHolder</span><span class="p">(</span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">viewType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">final</span><span class="w"> </span><span class="n">ItemExampleBinding</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ItemExampleBinding</span><span class="o">.</span><span class="n">inflate</span><span class="p">(</span><span class="n">inflater</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ExampleViewHolder</span><span class="p">(</span><span class="n">binding</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onBindViewHolder</span><span class="p">(</span><span class="n">ExampleViewHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">final</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">position</span><span class="p">);</span>
<span class="w">        </span><span class="n">holder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getItemCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <code>Comparator</code> used to sort the item is passed in through the constructor so
we can use the same <code>Adapter</code> even if the items are supposed to be displayed
in a different order.</p>
<p>Now we are almost done! But we first need a way to add or remove items to the
<code>Adapter</code>. For this purpose we can add methods to the <code>Adapter</code> which allow us
to add and remove items to the <code>SortedList</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">add</span><span class="ss">(</span><span class="nv">ExampleModel</span><span class="w"> </span><span class="nv">model</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">mSortedList</span>.<span class="nv">add</span><span class="ss">(</span><span class="nv">model</span><span class="ss">)</span><span class="c1">;</span>
}

<span class="nv">public</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">remove</span><span class="ss">(</span><span class="nv">ExampleModel</span><span class="w"> </span><span class="nv">model</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">mSortedList</span>.<span class="nv">remove</span><span class="ss">(</span><span class="nv">model</span><span class="ss">)</span><span class="c1">;</span>
}

<span class="nv">public</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">add</span><span class="ss">(</span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">models</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">mSortedList</span>.<span class="nv">addAll</span><span class="ss">(</span><span class="nv">models</span><span class="ss">)</span><span class="c1">;</span>
}

<span class="nv">public</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">remove</span><span class="ss">(</span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">models</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">mSortedList</span>.<span class="nv">beginBatchedUpdates</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">ExampleModel</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span>:<span class="w"> </span><span class="nv">models</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">mSortedList</span>.<span class="nv">remove</span><span class="ss">(</span><span class="nv">model</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}
<span class="w">    </span><span class="nv">mSortedList</span>.<span class="nv">endBatchedUpdates</span><span class="ss">()</span><span class="c1">;</span>
}
</pre></div>

<p>We don't need to call any notify methods here because the <code>SortedList</code> already
does this for through the <code>SortedList.Callback</code>! Aside from that the
implementation of these methods is pretty straight forward with one exception:
the remove method which removes a <code>List</code> of models. Since the <code>SortedList</code> has
only one remove method which can remove a single object we need to loop over
the list and remove the models one by one. Calling <code>beginBatchedUpdates()</code> at
the beginning batches all the changes we are going to make to the <code>SortedList</code>
together and improves performance. When we call <code>endBatchedUpdates()</code> the
<code>RecyclerView</code> is notified about all the changes at once.</p>
<p>Additionally what you have to understand is that if you add an object to the
<code>SortedList</code> and it is already in the <code>SortedList</code> it won't be added again.
Instead the <code>SortedList</code> uses the <code>areContentsTheSame()</code> method to figure out
if the object has changed - and if it has the item in the <code>RecyclerView</code> will
be updated.</p>
<p>Anyway, what I usually prefer is one method which allows me to replace all
items in the <code>RecyclerView</code> at once. Remove everything which is not in the
<code>List</code> and add all items which are missing from the <code>SortedList</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">replaceAll</span><span class="ss">(</span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">models</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">mSortedList</span>.<span class="nv">beginBatchedUpdates</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">int</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">mSortedList</span>.<span class="nv">size</span><span class="ss">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="c1">; i &gt;= 0; i--) {</span>
<span class="w">        </span><span class="nv">final</span><span class="w"> </span><span class="nv">ExampleModel</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">mSortedList</span>.<span class="nv">get</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="o">!</span><span class="nv">models</span>.<span class="nv">contains</span><span class="ss">(</span><span class="nv">model</span><span class="ss">))</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">mSortedList</span>.<span class="nv">remove</span><span class="ss">(</span><span class="nv">model</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">    </span>}
<span class="w">    </span><span class="nv">mSortedList</span>.<span class="nv">addAll</span><span class="ss">(</span><span class="nv">models</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">mSortedList</span>.<span class="nv">endBatchedUpdates</span><span class="ss">()</span><span class="c1">;</span>
}
</pre></div>

<p>This method again batches all updates together to increase performance. The
first loop is in reverse since removing an item at the start would mess up the
indexes of all items that come up after it and this can lead in some instances
to problems like data inconsistencies. After that we just add the <code>List</code> to
the <code>SortedList</code> using <code>addAll()</code> to add all items which are not already in
the <code>SortedList</code> and - just like I described above - update all items that are
already in the <code>SortedList</code> but have changed.</p>
<p>And with that the <code>Adapter</code> is complete. The whole thing should look something
like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ExampleAdapter</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="o">.</span><span class="n">Adapter</span><span class="o">&lt;</span><span class="n">ExampleViewHolder</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">SortedList</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mSortedList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SortedList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">ExampleModel</span><span class="o">.</span><span class="k">class</span><span class="p">,</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SortedList</span><span class="o">.</span><span class="n">Callback</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">compare</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">mComparator</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onInserted</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">notifyItemRangeInserted</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onRemoved</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">notifyItemRangeRemoved</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onMoved</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">fromPosition</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">toPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">notifyItemMoved</span><span class="p">(</span><span class="n">fromPosition</span><span class="p">,</span><span class="w"> </span><span class="n">toPosition</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onChanged</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">notifyItemRangeChanged</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">areContentsTheSame</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">oldItem</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">newItem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">oldItem</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">newItem</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">areItemsTheSame</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">item1</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">item2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">item1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">item2</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mComparator</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">LayoutInflater</span><span class="w"> </span><span class="n">mInflater</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ExampleAdapter</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">comparator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mInflater</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutInflater</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<span class="w">        </span><span class="n">mComparator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">comparator</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ExampleViewHolder</span><span class="w"> </span><span class="n">onCreateViewHolder</span><span class="p">(</span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">viewType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">final</span><span class="w"> </span><span class="n">ItemExampleBinding</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ItemExampleBinding</span><span class="o">.</span><span class="n">inflate</span><span class="p">(</span><span class="n">mInflater</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ExampleViewHolder</span><span class="p">(</span><span class="n">binding</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onBindViewHolder</span><span class="p">(</span><span class="n">ExampleViewHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">final</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">position</span><span class="p">);</span>
<span class="w">        </span><span class="n">holder</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">remove</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">models</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">addAll</span><span class="p">(</span><span class="n">models</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">remove</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">models</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">beginBatchedUpdates</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">models</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">endBatchedUpdates</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">replaceAll</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">models</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">beginBatchedUpdates</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">final</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">models</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">model</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">addAll</span><span class="p">(</span><span class="n">models</span><span class="p">);</span>
<span class="w">        </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">endBatchedUpdates</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getItemCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mSortedList</span><span class="o">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The only thing missing now is to implement the filtering!</p>
<hr>
<h2>Implementing the filter logic</h2>
<p>To implement the filter logic we first have to define a <code>List</code> of all possible
models. For this example I create a <code>List</code> of <code>ExampleModel</code> instances from an
array of movies:</p>
<div class="code"><pre class="code literal-block"><span class="n">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">String</span><span class="err">[]</span><span class="w"> </span><span class="n">MOVIES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="err">[]{</span>
<span class="w">        </span><span class="p">...</span>
<span class="err">}</span><span class="p">;</span>

<span class="n">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ALPHABETICAL_COMPARATOR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">compare</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">getText</span><span class="p">().</span><span class="n">compareTo</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">getText</span><span class="p">());</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span><span class="p">;</span>

<span class="n">private</span><span class="w"> </span><span class="n">ExampleAdapter</span><span class="w"> </span><span class="n">mAdapter</span><span class="p">;</span>
<span class="n">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mModels</span><span class="p">;</span>
<span class="n">private</span><span class="w"> </span><span class="n">RecyclerView</span><span class="w"> </span><span class="n">mRecyclerView</span><span class="p">;</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="n">protected</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">super</span><span class="p">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">    </span><span class="n">mBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DataBindingUtil</span><span class="p">.</span><span class="n">setContentView</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">activity_main</span><span class="p">);</span>

<span class="w">    </span><span class="n">mAdapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ExampleAdapter</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">ALPHABETICAL_COMPARATOR</span><span class="p">);</span>

<span class="w">    </span><span class="n">mBinding</span><span class="p">.</span><span class="n">recyclerView</span><span class="p">.</span><span class="n">setLayoutManager</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">LinearLayoutManager</span><span class="p">(</span><span class="n">this</span><span class="p">));</span>
<span class="w">    </span><span class="n">mBinding</span><span class="p">.</span><span class="n">recyclerView</span><span class="p">.</span><span class="n">setAdapter</span><span class="p">(</span><span class="n">mAdapter</span><span class="p">);</span>

<span class="w">    </span><span class="n">mModels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">movie</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">MOVIES</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">mModels</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ExampleModel</span><span class="p">(</span><span class="n">movie</span><span class="p">));</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="n">mAdapter</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">mModels</span><span class="p">);</span>
<span class="err">}</span>
</pre></div>

<p>Nothing special going on here, we just instantiate the <code>Adapter</code> and set it to
the <code>RecyclerView</code>. After that we create a <code>List</code> of models from the movie
names in the <code>MOVIES</code> array. Then we add all the models to the <code>SortedList</code>.</p>
<p>Now we can go back to <code>onQueryTextChange()</code> which we defined earlier and start
implementing the filter logic:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@Override</span>
<span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">onQueryTextChange</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filteredModelList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">filter</span><span class="p">(</span><span class="n">mModels</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">);</span>
<span class="w">    </span><span class="n">mAdapter</span><span class="p">.</span><span class="n">replaceAll</span><span class="p">(</span><span class="n">filteredModelList</span><span class="p">);</span>
<span class="w">    </span><span class="n">mBinding</span><span class="p">.</span><span class="n">recyclerView</span><span class="p">.</span><span class="n">scrollToPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="err">}</span>
</pre></div>

<p>This is again pretty straight forward. We call the method <code>filter()</code> and pass
in the <code>List</code> of <code>ExampleModel</code>s as well as the query string. We then call
<code>replaceAll()</code> on the <code>Adapter</code> and pass in the filtered <code>List</code> returned by
<code>filter()</code>. We also have to call <code>scrollToPosition(0)</code> on the <code>RecyclerView</code>
to ensure that the user can always see all items when searching for something.
Otherwise the <code>RecyclerView</code> might stay in a scrolled down position while
filtering and subsequently hide a few items. Scrolling to the top ensures a
better user experience while searching.</p>
<p>The only thing left to do now is to implement <code>filter()</code> itself:</p>
<div class="code"><pre class="code literal-block"><span class="nv">private</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">filter</span><span class="ss">(</span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">models</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">query</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">final</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">lowerCaseQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">query</span>.<span class="nv">toLowerCase</span><span class="ss">()</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">final</span><span class="w"> </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">filteredModelList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ArrayList</span><span class="o">&lt;&gt;</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">ExampleModel</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span>:<span class="w"> </span><span class="nv">models</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">final</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">model</span>.<span class="nv">getText</span><span class="ss">()</span>.<span class="nv">toLowerCase</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">text</span>.<span class="nv">contains</span><span class="ss">(</span><span class="nv">lowerCaseQuery</span><span class="ss">))</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">filteredModelList</span>.<span class="nv">add</span><span class="ss">(</span><span class="nv">model</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">    </span>}
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">filteredModelList</span><span class="c1">;</span>
}
</pre></div>

<p>The first thing we do here is call <code>toLowerCase()</code> on the query string. We
don't want our search function to be case sensitive and by calling
<code>toLowerCase()</code> on all strings we compare we can ensure that we return the
same results regardless of case. It then just iterates through all the models
in the <code>List</code> we passed into it and checks if the query string is contained in
the text of the model. If it is then the model is added to the filtered
<code>List</code>.</p>
<p>And that's it! The above code will run on API level 7 and above and starting
with API level 11 you get item animations for free!</p>
<p>I realize that this is a very detailed description which probably makes this
whole thing seem more complicated than it really is, but there is a way we can
generalize this whole problem and make implementing an <code>Adapter</code> based on a
<code>SortedList</code> much simpler.</p>
<hr>
<h2>Generalizing the problem and simplifying the Adapter</h2>
<p>In this section I am not going to go into much detail - partly because I am
running up against the character limit for answers on Stack Overflow but also
because most of it already explained above - but to summarize the changes: We
can implemented a base <code>Adapter</code> class which already takes care of dealing
with the <code>SortedList</code> as well as binding models to <code>ViewHolder</code> instances and
provides a convenient way to implement an <code>Adapter</code> based on a <code>SortedList</code>.
For that we have to do two things:</p>
<ul>
<li>We need to create a <code>ViewModel</code> interface which all model classes have to implement</li>
<li>We need to create a <code>ViewHolder</code> subclass which defines a <code>bind()</code> method the <code>Adapter</code> can use to bind models automatically.</li>
</ul>
<p>This allows us to just focus on the content which is supposed to be displayed
in the <code>RecyclerView</code> by just implementing the models and there corresponding
<code>ViewHolder</code> implementations. Using this base class we don't have to worry
about the intricate details of the <code>Adapter</code> and its <code>SortedList</code>.</p>
<h4>SortedListAdapter</h4>
<p>Because of the character limit for answers on StackOverflow I can't go through
each step of implementing this base class or even add the full source code
here, but you can find the full source code of this base class - I called it
<code>SortedListAdapter</code> - in this <strong>GitHub Gist</strong>.</p>
<p>To make your life simple I have published a library on jCenter which contains
the <code>SortedListAdapter</code>! If you want to use it then all you need to do is add
this dependency to your app's build.gradle file:</p>
<div class="code"><pre class="code literal-block">compile 'com.github.wrdlbrnft:sorted-list-adapter:0.2.0.1'
</pre></div>

<p>You can find more information about this library <strong>on the library homepage</strong>.</p>
<h4>Using the SortedListAdapter</h4>
<p>To use the <code>SortedListAdapter</code> we have to make two changes:</p>
<ul>
<li>
<p>Change the <code>ViewHolder</code> so that it extends <code>SortedListAdapter.ViewHolder</code>. The type parameter should be the model which should be bound to this <code>ViewHolder</code> - in this case <code>ExampleModel</code>. You have to bind data to your models in <code>performBind()</code> instead of <code>bind()</code>.</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ExampleViewHolder</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">SortedListAdapter</span><span class="o">.</span><span class="n">ViewHolder</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w"> </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">ItemExampleBinding</span><span class="w"> </span><span class="n">mBinding</span><span class="p">;</span>

<span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">ExampleViewHolder</span><span class="p">(</span><span class="n">ItemExampleBinding</span><span class="w"> </span><span class="n">binding</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">super</span><span class="p">(</span><span class="n">binding</span><span class="o">.</span><span class="n">getRoot</span><span class="p">());</span>
<span class="w">     </span><span class="n">mBinding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binding</span><span class="p">;</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="err">@</span><span class="n">Override</span>
<span class="w"> </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">performBind</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">mBinding</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>

<p>}</p>
</li>
<li>
<p>Make sure that all your models implement the <code>ViewModel</code> interface:</p>
<div class="code"><pre class="code literal-block"> public class ExampleModel implements SortedListAdapter.ViewModel {
 ...
</pre></div>

<p>}</p>
</li>
</ul>
<p>After that we just have to update the <code>ExampleAdapter</code> to extend
<code>SortedListAdapter</code> and remove everything we don't need anymore. The type
parameter should be the type of model you are working with - in this case
<code>ExampleModel</code>. But if you are working with different types of models then set
the type parameter to <code>ViewModel</code>.</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ExampleAdapter</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">SortedListAdapter</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ExampleAdapter</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">Comparator</span><span class="o">&lt;</span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">comparator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="o">.</span><span class="k">class</span><span class="p">,</span><span class="w"> </span><span class="n">comparator</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">ViewHolder</span><span class="o">&lt;</span><span class="err">?</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">ExampleModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">onCreateViewHolder</span><span class="p">(</span><span class="n">LayoutInflater</span><span class="w"> </span><span class="n">inflater</span><span class="p">,</span><span class="w"> </span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">viewType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">final</span><span class="w"> </span><span class="n">ItemExampleBinding</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ItemExampleBinding</span><span class="o">.</span><span class="n">inflate</span><span class="p">(</span><span class="n">inflater</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ExampleViewHolder</span><span class="p">(</span><span class="n">binding</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">areItemsTheSame</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">item1</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">item2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">item1</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">item2</span><span class="o">.</span><span class="n">getId</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">areItemContentsTheSame</span><span class="p">(</span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">oldItem</span><span class="p">,</span><span class="w"> </span><span class="n">ExampleModel</span><span class="w"> </span><span class="n">newItem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">oldItem</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">newItem</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>After that we are done! However one last thing to mention: The
<code>SortedListAdapter</code> does not have the same <code>add()</code>, <code>remove()</code> or
<code>replaceAll()</code> methods our original <code>ExampleAdapter</code> had. It uses a separate
<code>Editor</code> object to modify the items in the list which can be accessed through
the <code>edit()</code> method. So if you want to remove or add items you have to call
<code>edit()</code> then add and remove the items on this <code>Editor</code> instance and once you
are done, call <code>commit()</code> on it to apply the changes to the <code>SortedList</code>:</p>
<div class="code"><pre class="code literal-block">mAdapter.edit()
        .remove(modelToRemove)
        .add(listOfModelsToAdd)
        .commit();
</pre></div>

<p>All changes you make this way are batched together to increase performance.
The <code>replaceAll()</code> method we implemented in the chapters above is also present
on this <code>Editor</code> object:</p>
<div class="code"><pre class="code literal-block">mAdapter.edit()
        .replaceAll(mModels)
        .commit();
</pre></div>

<p>If you forget to call <code>commit()</code> then none of your changes will be applied!</p>
<p><br></p>
<h3>Suggest</h3>
<p>All you need to do is to add <code>filter</code> method in <code>RecyclerView.Adapter</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nt">public</span><span class="w"> </span><span class="nt">void</span><span class="w"> </span><span class="nt">filter</span><span class="o">(</span><span class="nt">String</span><span class="w"> </span><span class="nt">text</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">items.clear()</span><span class="p">;</span>
<span class="w">    </span><span class="err">if(text.isEmpty()){</span>
<span class="w">        </span><span class="err">items.addAll(itemsCopy)</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="nt">else</span><span class="p">{</span>
<span class="w">        </span><span class="err">text</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">text.toLowerCase()</span><span class="p">;</span>
<span class="w">        </span><span class="err">for(PhoneBookItem</span><span class="w"> </span><span class="n">item</span><span class="p">:</span><span class="w"> </span><span class="n">itemsCopy</span><span class="p">)</span><span class="err">{</span>
<span class="w">            </span><span class="nf">if</span><span class="p">(</span><span class="n">item</span><span class="err">.</span><span class="n">name</span><span class="err">.</span><span class="nf">toLowerCase</span><span class="p">()</span><span class="err">.</span><span class="nf">contains</span><span class="p">(</span><span class="kc">text</span><span class="p">)</span><span class="w"> </span><span class="err">||</span><span class="w"> </span><span class="n">item</span><span class="err">.</span><span class="n">phone</span><span class="err">.</span><span class="nf">toLowerCase</span><span class="p">()</span><span class="err">.</span><span class="nf">contains</span><span class="p">(</span><span class="kc">text</span><span class="p">))</span><span class="err">{</span>
<span class="w">                </span><span class="n">items</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="nt">notifyDataSetChanged</span><span class="o">();</span>
<span class="err">}</span>
</pre></div>

<p><code>itemsCopy</code> is initialized in adapter's constructor like
<code>itemsCopy.addAll(items)</code>.</p>
<p>If you do so, just call <code>filter</code> from <code>OnQueryTextListener</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">searchView</span><span class="p">.</span><span class="n">setOnQueryTextListener</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SearchView</span><span class="p">.</span><span class="n">OnQueryTextListener</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">onQueryTextSubmit</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">adapter</span><span class="p">.</span><span class="k">filter</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">onQueryTextChange</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">newText</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">adapter</span><span class="p">.</span><span class="k">filter</span><span class="p">(</span><span class="n">newText</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span><span class="p">);</span>
</pre></div>

<p>It's an example from filtering my phonebook by name and phone number.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-avoid-mysql-deadlock-found-when-trying-to-get-lock-try-restarting-transaction/" class="u-url">How to avoid MySQL 'Deadlock found when trying to get lock; try restarting transaction'</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-avoid-mysql-deadlock-found-when-trying-to-get-lock-try-restarting-transaction/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T20:31:09+08:00" itemprop="datePublished" title="2023-03-04 20:31">2023-03-04 20:31</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a innoDB table which records online users. It gets updated on every
page refresh by a user to keep track of which pages they are on and their last
access date to the site. I then have a cron that runs every 15 minutes to
DELETE old records.</p>
<p>I got a 'Deadlock found when trying to get lock; try restarting transaction'
for about 5 minutes last night and it appears to be when running INSERTs into
this table. Can someone suggest how to avoid this error?</p>
<p>=== EDIT ===</p>
<p>Here are the queries that are running:</p>
<p><strong>First Visit to site:</strong></p>
<div class="code"><pre class="code literal-block">INSERT INTO onlineusers SET
ip = 123.456.789.123,
datetime = now(),
userid = 321,
page = '/thispage',
area = 'thisarea',
type = 3
</pre></div>

<p><strong>On each page refresh:</strong></p>
<div class="code"><pre class="code literal-block">UPDATE onlineusers SET
ips = 123.456.789.123,
datetime = now(),
userid = 321,
page = '/thispage',
area = 'thisarea',
type = 3
WHERE id = 888
</pre></div>

<p><strong>Cron every 15 minutes:</strong></p>
<div class="code"><pre class="code literal-block">DELETE FROM onlineusers WHERE datetime &lt;= now() - INTERVAL 900 SECOND
</pre></div>

<p>It then does some counts to log some stats (ie: members online, visitors
online).</p>
<p><br><br></p>
<h2>Answer</h2>
<p>One easy trick that can help with most deadlocks is sorting the operations in
a specific order.</p>
<p>You get a deadlock when two transactions are trying to lock two locks at
opposite orders, ie:</p>
<ul>
<li>connection 1: locks key(1), locks key(2);</li>
<li>connection 2: locks key(2), locks key(1);</li>
</ul>
<p>If both run at the same time, connection 1 will lock key(1), connection 2 will
lock key(2) and each connection will wait for the other to release the key -&gt;
deadlock.</p>
<p>Now, if you changed your queries such that the connections would lock the keys
at the same order, ie:</p>
<ul>
<li>connection 1: locks key(1), locks key(2);</li>
<li>connection 2: locks key( <strong>1</strong> ), locks key( <strong>2</strong> );</li>
</ul>
<p>it will be impossible to get a deadlock.</p>
<p>So this is what I suggest:</p>
<ol>
<li>
<p>Make sure you have no other queries that lock access more than one key at a time except for the delete statement. if you do (and I suspect you do), order their WHERE in (k1,k2,..kn) in ascending order.</p>
</li>
<li>
<p>Fix your delete statement to work in ascending order:</p>
</li>
</ol>
<p>Change</p>
<div class="code"><pre class="code literal-block">DELETE FROM onlineusers 
WHERE datetime &lt;= now() - INTERVAL 900 SECOND
</pre></div>

<p>To</p>
<div class="code"><pre class="code literal-block">DELETE FROM onlineusers 
WHERE id IN (
    SELECT id FROM onlineusers
    WHERE datetime &lt;= now() - INTERVAL 900 SECOND 
    ORDER BY id
) u;
</pre></div>

<p>Another thing to keep in mind is that MySQL documentation suggest that in case
of a deadlock the client should retry automatically. you can add this logic to
your client code. (Say, 3 retries on this particular error before giving up).</p>
<p><br></p>
<h3>Suggest</h3>
<p>Deadlock happen when two transactions wait on each other to acquire a lock.
Example:</p>
<ul>
<li>Tx 1: lock A, then B</li>
<li>Tx 2: lock B, then A</li>
</ul>
<p>There are numerous questions and answers about deadlocks. Each time you
insert/update/or delete a row, a lock is acquired. To avoid deadlock, you must
then make sure that concurrent transactions don't update row in an order that
could result in a deadlock. Generally speaking, <strong>try to acquire lock always
in the same order</strong> even in different transaction (e.g. always table A first,
then table B).</p>
<p>Another reason for deadlock in database can be <strong>missing indexes</strong>. When a row
is inserted/update/delete, the database needs to check the relational
constraints, that is, make sure the relations are consistent. To do so, the
database needs to check the foreign keys in the related tables. It <em>might</em>
result in other lock being acquired than the row that is modified. Be sure
then to always have index on the foreign keys (and of course primary keys),
otherwise it could result in a <strong>table lock</strong> instead of a <strong>row lock</strong>. If
table lock happen, the lock contention is higher and the likelihood of
deadlock increases.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2498.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2496.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
