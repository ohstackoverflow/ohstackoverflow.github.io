<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 818) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-818.html">
<link rel="prev" href="index-819.html" type="text/html">
<link rel="next" href="index-817.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-do-an-update-join-in-postgresql/" class="u-url">How to do an update + join in PostgreSQL?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-do-an-update-join-in-postgresql/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:46:13+08:00" itemprop="datePublished" title="2023-02-17 16:46">2023-02-17 16:46</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Basically, I want to do this:</p>
<div class="code"><pre class="code literal-block">update vehicles_vehicle v 
    join shipments_shipment s on v.shipment_id=s.id 
set v.price=s.price_per_vehicle;
</pre></div>

<p>I'm pretty sure that would work in MySQL (my background), but it doesn't seem
to work in postgres. The error I get is:</p>
<div class="code"><pre class="code literal-block"><span class="n">ERROR</span><span class="o">:</span><span class="w">  </span><span class="n">syntax</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">near</span><span class="w"> </span><span class="s2">"join"</span>
<span class="n">LINE</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">vehicles_vehicle</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="n">join</span><span class="w"> </span><span class="n">shipments_shipment</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">v</span><span class="o">.</span><span class="na">shi</span><span class="o">...</span>
<span class="w">                                  </span><span class="o">^</span>
</pre></div>

<p>Surely there's an easy way to do this, but I can't find the proper syntax. So,
how would I write this In PostgreSQL?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The UPDATE syntax is:</p>
<div class="code"><pre class="code literal-block"><span class="k">[ WITH [ RECURSIVE ] with_query [, ...] ]</span>
<span class="na">UPDATE [ ONLY ] table [ [ AS ] alias ]</span>
<span class="w">    </span><span class="na">SET { column</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">{ expression | DEFAULT } |</span>
<span class="w">          </span><span class="na">( column [, ...] )</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">( { expression | DEFAULT } [, ...] ) } [, ...]</span>
<span class="w">    </span><span class="k">[ FROM from_list ]</span>
<span class="w">    </span><span class="k">[ WHERE condition | WHERE CURRENT OF cursor_name ]</span>
<span class="w">    </span><span class="k">[ RETURNING * | output_expression [ [ AS ] output_name ] [, ...] ]</span>
</pre></div>

<p>In your case I think you want this:</p>
<div class="code"><pre class="code literal-block">UPDATE vehicles_vehicle AS v 
SET price = s.price_per_vehicle
FROM shipments_shipment AS s
WHERE v.shipment_id = s.id
</pre></div>

<p>Or if you need to join on two or more tables:</p>
<div class="code"><pre class="code literal-block">UPDATE table_1 t1
SET foo = 'new_value'
FROM table_2 t2
    JOIN table_3 t3 ON t3.id = t2.t3_id
WHERE
    t2.id = t1.t2_id
    AND t3.bar = True;
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>The answer of Mark Byers is the optimal in this situation. Though in more
complex situations you can take the select query that returns rowids and
calculated values and attach it to the update query like this:</p>
<div class="code"><pre class="code literal-block">with t as (
  -- Any generic query which returns rowid and corresponding calculated values
  select t1.id as rowid, f(t2, t2) as calculatedvalue
  from table1 as t1
  join table2 as t2 on t2.referenceid = t1.id
)
update table1
set value = t.calculatedvalue
from t
where id = t.rowid
</pre></div>

<p>This approach lets you develop and test your select query and in two steps
convert it to the update query.</p>
<p>So in your case the result query will be:</p>
<div class="code"><pre class="code literal-block">with t as (
    select v.id as rowid, s.price_per_vehicle as calculatedvalue
    from vehicles_vehicle v 
    join shipments_shipment s on v.shipment_id = s.id 
)
update vehicles_vehicle
set price = t.calculatedvalue
from t
where id = t.rowid
</pre></div>

<p>Note that column aliases are mandatory otherwise PostgreSQL will complain
about the ambiguity of the column names.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-urlencode-a-querystring-in-python/" class="u-url">How to urlencode a querystring in Python?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-urlencode-a-querystring-in-python/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:45:10+08:00" itemprop="datePublished" title="2023-02-17 16:45">2023-02-17 16:45</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am trying to urlencode this string before I submit.</p>
<div class="code"><pre class="code literal-block">queryString = 'eventName=' + evt.fields["eventName"] + '&amp;' + 'eventDescription=' + evt.fields["eventDescription"];
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>You need to pass your parameters into <code>urlencode()</code> as either a mapping
(dict), or a sequence of 2-tuples, like:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">urllib</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'eventName'</span> <span class="p">:</span> <span class="s1">'myEvent'</span><span class="p">,</span> <span class="s1">'eventDescription'</span> <span class="p">:</span> <span class="s1">'cool event'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="s1">'eventName=myEvent&amp;eventDescription=cool+event'</span>
</pre></div>

<p><strong>Python 3 or above</strong></p>
<p>Use <code>urllib.parse.urlencode</code>:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; urllib.parse.urlencode(f)
eventName=myEvent&amp;eventDescription=cool+event
</pre></div>

<p>Note that this does <em>not</em> do url encoding in the commonly used sense (look at
the output). For that use <code>urllib.parse.quote_plus</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>You need to pass your parameters into <code>urlencode()</code> as either a mapping
(dict), or a sequence of 2-tuples, like:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">urllib</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'eventName'</span> <span class="p">:</span> <span class="s1">'myEvent'</span><span class="p">,</span> <span class="s1">'eventDescription'</span> <span class="p">:</span> <span class="s1">'cool event'</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="s1">'eventName=myEvent&amp;eventDescription=cool+event'</span>
</pre></div>

<p><strong>Python 3 or above</strong></p>
<p>Use <code>urllib.parse.urlencode</code>:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; urllib.parse.urlencode(f)
eventName=myEvent&amp;eventDescription=cool+event
</pre></div>

<p>Note that this does <em>not</em> do url encoding in the commonly used sense (look at
the output). For that use <code>urllib.parse.quote_plus</code>.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jquery-selectors-on-custom-data-attributes-using-html5/" class="u-url">jQuery selectors on custom data attributes using HTML5</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/jquery-selectors-on-custom-data-attributes-using-html5/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:44:44+08:00" itemprop="datePublished" title="2023-02-17 16:44">2023-02-17 16:44</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I would like to know what selectors are available for these data attributes
that come with HTML5.</p>
<p>Taking this piece of HTML as an example:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;ul</span><span class="w"> </span><span class="na">data-group=</span><span class="s">"Companies"</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;li</span><span class="w"> </span><span class="na">data-company=</span><span class="s">"Microsoft"</span><span class="nt">&gt;&lt;/li&gt;</span>
<span class="w">  </span><span class="nt">&lt;li</span><span class="w"> </span><span class="na">data-company=</span><span class="s">"Google"</span><span class="nt">&gt;&lt;/li&gt;</span>
<span class="w">  </span><span class="nt">&lt;li</span><span class="w"> </span><span class="na">data-company =</span><span class="s">"Facebook"</span><span class="nt">&gt;&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>

<p>Are there selectors to get:</p>
<ul>
<li>All elements with <code>data-company="Microsoft"</code> below <code>"Companies"</code>
</li>
<li>All elements with <code>data-company!="Microsoft"</code> below <code>"Companies"</code>
</li>
<li>In other cases is it possible to use other selectors like "contains, less than, greater than, etc...".</li>
</ul>
<p><br><br></p>
<h2>Answer</h2>
<div class="code"><pre class="code literal-block">$("ul[data-group='Companies'] li[data-company='Microsoft']") //Get all elements with data-company="Microsoft" below "Companies"

$("ul[data-group='Companies'] li:not([data-company='Microsoft'])") //get all elements with data-company!="Microsoft" below "Companies"
</pre></div>

<p>Look in to jQuery Selectors :contains is a selector</p>
<p>here is info on the :contains selector</p>
<p><br></p>
<h3>Suggest</h3>
<p><code>jQuery UI</code> has a <code>:data()</code> selector which can also be used. It has been
around since Version 1.7.0 it seems.</p>
<p>You can use it like this:</p>
<p><strong>Get all elements with a<code>data-company</code> attribute</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">companyElements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="s2">"ul:data(group) li:data(company)"</span><span class="p">);</span>
</pre></div>

<p><strong>Get all elements where<code>data-company</code> equals <code>Microsoft</code></strong></p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">microsoft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="s2">"ul:data(group) li:data(company)"</span><span class="p">)</span>
<span class="w">                    </span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">"company"</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Microsoft"</span><span class="p">;</span>
<span class="w">                    </span><span class="p">});</span>
</pre></div>

<p><strong>Get all elements where<code>data-company</code> does not equal <code>Microsoft</code></strong></p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">notMicrosoft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="s2">"ul:data(group) li:data(company)"</span><span class="p">)</span>
<span class="w">                       </span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                           </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">"company"</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"Microsoft"</span><span class="p">;</span>
<span class="w">                       </span><span class="p">});</span>
</pre></div>

<p><em>etc...</em></p>
<p>One caveat of the new <code>:data()</code> selector is that you must set the <code>data</code> value
<em>by code</em> for it to be selected. This means that for the above to work,
defining the <code>data</code> in HTML is not enough. You must first do this:</p>
<div class="code"><pre class="code literal-block">$("li").first().data("company", "Microsoft");
</pre></div>

<p>This is fine for single page applications where you are likely to use
<code>$(...).data("datakey", "value")</code> in this or similar ways.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-819.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-817.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
