<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2023) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2023.html">
<link rel="prev" href="index-2024.html" type="text/html">
<link rel="next" href="index-2022.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/vim-80-column-layout-concerns/" class="u-url">Vim 80 column layout concerns</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/vim-80-column-layout-concerns/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T15:05:41+08:00" itemprop="datePublished" title="2023-03-03 15:05">2023-03-03 15:05</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>The way I do 80-column indication in Vim seems incorrect:<code>set columns=80</code>. At
times I also <code>set textwidth</code>, but I want to be able to see and anticipate line
overflow with the <code>set columns</code> alternative.</p>
<p>This has some <strong>unfortunate</strong> side effects:</p>
<ol>
<li>I can't <code>set number</code> for fear of splitting between files that have different orders of line numbers; i.e. &lt; 100 line files and &gt;= 100 line files will require two different <code>set columns</code> values because of the extra column used for the additional digit display. </li>
<li>I also start new (g)Vim sessions instead of splitting windows vertically. This is because <code>vsplit</code> forces me to <code>set columns</code> every time I open or close a pane, so starting a new session is less hassle.</li>
</ol>
<p>How do you handle the 80-character indication when you want to <code>set numbers</code>,
vertically split, etc.?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I have this set up in my .vimrc:</p>
<div class="code"><pre class="code literal-block">highlight OverLength ctermbg=red ctermfg=white guibg=#592929
match OverLength /\%81v.\+/
</pre></div>

<p>This highlights the background in a subtle red for text that goes over the 80
column limit (subtle in GUI mode, anyway - in terminal mode it's less so).</p>
<p><br></p>
<h3>Suggest</h3>
<p>I have this set up in my .vimrc:</p>
<div class="code"><pre class="code literal-block">highlight OverLength ctermbg=red ctermfg=white guibg=#592929
match OverLength /\%81v.\+/
</pre></div>

<p>This highlights the background in a subtle red for text that goes over the 80
column limit (subtle in GUI mode, anyway - in terminal mode it's less so).</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-get-a-time-zone-from-a-location-using-latitude-and-longitude-coordinates/" class="u-url">How to get a time zone from a location using latitude and longitude coordinates?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-get-a-time-zone-from-a-location-using-latitude-and-longitude-coordinates/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T15:05:14+08:00" itemprop="datePublished" title="2023-03-03 15:05">2023-03-03 15:05</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Given the latitude and longitude of a location, how does one know what time
zone is in effect in that location?</p>
<p>In most cases, we are looking for an IANA/Olson time zone id, although some
services may return just a UTC offset, or some other time zone identifier.
Please read the timezone tag info for details.</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>Time Zone Location Web Services</strong></p>
<ul>
<li>Google Maps Time Zone API</li>
<li>Bing Maps Time Zone API</li>
<li>Azure Maps Time Zone API</li>
<li>GeoNames Time Zone API</li>
<li>TimeZoneDB API</li>
<li>AskGeo - commercial (but arguably more accurate than GeoNames)</li>
<li>GeoGarage Time Zone API - commercial, focusing on Nautical time zones.</li>
</ul>
<p><strong>Raw Time Zone Boundary Data</strong></p>
<ul>
<li>Timezone Boundary Builder - builds time zone shapefiles from OpenStreetMaps map data. Includes territorial waters near coastlines.</li>
</ul>
<p>The following projects have previously been sources of time zone boundary
data, but are no longer actively maintained.</p>
<ul>
<li>tz_world - the original shapefile data from Eric Muller</li>
<li>whereonearth-timezone - GeoJSON version with WOEDB data merged in</li>
</ul>
<p><strong>Time Zone Geolocation Offline Implementations</strong></p>
<p>Implementations that use the Timezone Boundary Builder data</p>
<ul>
<li>node-geo-tz - JavaScript library (Node.js only)</li>
<li>timespace - JavaScript library</li>
<li>tz-lookup-oss - JavaScript library</li>
<li>GeoTimeZone - .NET library</li>
<li>Geo-Timezone - PHP library</li>
<li>timezonefinder - Python library</li>
<li>ZoneDetect - C library</li>
<li>Timeshape - Java library</li>
<li>TimeZoneMap - Java and Android library</li>
<li>lutz - R library</li>
<li>go-tz - Go library</li>
<li>Timezone lookup - Go library</li>
<li>docker-timezone-lookup - docker container wrapping node-geo-tz</li>
<li>tzf - Go library</li>
<li>tzfpy - Python port of <code>tzf</code> library</li>
<li>tzf-rs - Rust port of <code>tzf</code> library</li>
</ul>
<p>Implementations that use the older tz_world data</p>
<ul>
<li>latlong - Go library (Read this post also.)</li>
<li>TimeZoneMapper - Java library</li>
<li>tzwhere - JavaScript/Node library</li>
<li>pytzwhere - Python library</li>
<li>timezone_finder - Ruby library</li>
<li>LatLongToTimeZone - Java and Swift libraries</li>
<li>What Time is it here? - Blog post describing PHP and MongoDB</li>
<li>rundel/timezone - R library</li>
</ul>
<p><strong>Libraries that call one of the web services</strong></p>
<ul>
<li>timezone - Ruby gem that calls GeoNames</li>
<li>AskGeo has its own libraries for calling from Java or .Net</li>
<li>GeoNames has client libraries for just about everything</li>
</ul>
<p><strong>Self-hosted web services</strong></p>
<ul>
<li>geo2tz - based on Timezone lookup, available via Docker image</li>
</ul>
<p><strong>Other Ideas</strong></p>
<ul>
<li>Find the nearest city with an R-Tree</li>
<li>Find the nearest city with MySQL</li>
</ul>
<p><em>Please update this list if you know of any others</em></p>
<p>Also, note that the nearest-city approach may not yield the "correct" result,
just an approximation.</p>
<p><strong>Conversion To Windows Zones</strong></p>
<p>Most of the methods listed will return an IANA time zone id. If you need to
convert to a Windows time zone for use with the <code>TimeZoneInfo</code> class in .NET,
use the TimeZoneConverter library.</p>
<p><strong>Don't use zone.tab</strong></p>
<p>The tz database includes a file called <code>zone.tab</code>. This file is primarily used
to present a list of time zones for a user to pick from. It includes the
latitude and longitude coordinates for the point of reference for each time
zone. This allows a map to be created highlighting these points. For example,
see the interactive map shown on the moment-timezone home page.</p>
<p>While it may be tempting to use this data to resolve the time zone from a
latitude and longitude coordinates, consider that these are points - not
boundaries. The best one could do would be to determine the <em>closest</em> point,
which in many cases will not be the correct point.</p>
<p>Consider the following example:</p>
<p><img alt="Time Zone Example Art" src="images/tjd5u.png"></p>
<p>The two squares represent different time zones, where the black dot in each
square is the reference location, such as what can be found in zone.tab. The
blue dot represents the location we are attempting to find a time zone for.
Clearly, this location is within the orange zone on the left, but if we just
look at closest distance to the reference point, it will resolve to the
greenish zone on the right.</p>
<p><br></p>
<h3>Suggest</h3>
<p>How about this solution for node.js https://github.com/mattbornski/tzwhere</p>
<p>And its Python counterpart: https://github.com/pegler/pytzwhere</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-use-async-await-at-the-top-level/" class="u-url">How can I use async/await at the top level?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-use-async-await-at-the-top-level/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T15:04:48+08:00" itemprop="datePublished" title="2023-03-03 15:04">2023-03-03 15:04</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have been going over <code>async</code>/<code>await</code> and after going over several articles,
I decided to test things myself. However, I can't seem to wrap my head around
why this does not work:</p>
<div class="code"><pre class="code literal-block"><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="s1">'Hey there'</span><span class="p">);</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'inside: '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">var</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">main</span><span class="p">();</span><span class="w">  </span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'outside: '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">text</span><span class="p">);</span>
</pre></div>

<p>The console outputs the following (node v8.6.0) :</p>
<blockquote>
<blockquote>
<p>outside: [object Promise]</p>
<p>inside: Hey there</p>
</blockquote>
</blockquote>
<p>Why does the log message inside the function execute afterwards? I thought the
reason <code>async</code>/<code>await</code> was created was in order to perform synchronous
execution using asynchronous tasks.</p>
<p>Is there a way could I use the value returned inside the function without
using a <code>.then()</code> after <code>main()</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<blockquote>
<p>I can't seem to wrap my head around why this does not work.</p>
</blockquote>
<p>Because <code>main</code> returns a promise; all <code>async</code> functions do.</p>
<p>At the top level, you must either:</p>
<ol>
<li>Use <strong>top-level<code>await</code></strong> (proposal, MDN; ES2022, broadly supported in modern environments) that allows top-level use of <code>await</code> in a module.</li>
</ol>
<p>or</p>
<ol>
<li>Use a top-level <code>async</code> function that never rejects (unless you want "unhandled rejection" errors).</li>
</ol>
<p>or</p>
<ol>
<li>Use <code>then</code> and <code>catch</code>.</li>
</ol>
<h4>#1 top-level <code>await</code> in a module</h4>
<p>You can use <code>await</code> at the top-level of a module. Your module won't finish
loading until the promise you <code>await</code> settles (meaning any module waiting for
your module to load won't finish loading until the promise settles). If the
promise is rejected, your module will fail to load. Typically, top-level
<code>await</code> is used in situations where your module won't be able to do its work
until the promise is settled and won't be able to do it at all unless the
promise is fulfilled, so that's fine:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">main</span><span class="p">();</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
</pre></div>

<p>If your module can continue to work even if the promise is rejected, you could
wrap the top-level <code>await</code> in a <code>try</code>/<code>catch</code>:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="k">In</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">module</span><span class="p">,</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">top</span><span class="o">-</span><span class="k">level</span><span class="w"> </span><span class="n n-Quoted">`await`</span><span class="w"> </span><span class="n">proposal</span><span class="w"> </span><span class="n">lands</span>
<span class="n">try</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">const</span><span class="w"> </span><span class="kt">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">main</span><span class="p">();</span>
<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="kt">text</span><span class="p">);</span>
<span class="err">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Deal</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fact</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">chain</span><span class="w"> </span><span class="n">failed</span>
<span class="err">}</span>
<span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`text`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">here</span>
</pre></div>

<p>when a module using top-level <code>await</code> is evaluated, it returns a promise to
the module loader (like an <code>async</code> function does), which waits until that
promise is settled before evaluating the bodies of any modules that depend on
it.</p>
<p>You can't use <code>await</code> at the top level of a non-module script, only in
modules.</p>
<h4>#2 - Top-level <code>async</code> function that never rejects</h4>
<div class="code"><pre class="code literal-block"><span class="p">(</span><span class="n">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">const</span><span class="w"> </span><span class="kt">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">main</span><span class="p">();</span>
<span class="w">        </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="kt">text</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Deal</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fact</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">chain</span><span class="w"> </span><span class="n">failed</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`text`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">here</span>
<span class="err">}</span><span class="p">)();</span>
<span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`text`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">here</span><span class="p">,</span><span class="w"> </span><span class="n">either</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">code</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">reached</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">promise</span><span class="w"> </span><span class="k">set</span><span class="n">tles</span>
<span class="o">//</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">code</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n n-Quoted">`await`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">runs</span>
</pre></div>

<p>Notice the <code>catch</code>; you <em>must</em> handle promise rejections / async exceptions,
since nothing else is going to; you have no caller to pass them on to (unlike
with #1 above, where your "caller" is the module loader). If you prefer, you
could do that on the result of calling it via the <code>catch</code> function (rather
than <code>try</code>/<code>catch</code> syntax):</p>
<div class="code"><pre class="code literal-block"><span class="p">(</span><span class="n">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">const</span><span class="w"> </span><span class="kt">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">main</span><span class="p">();</span>
<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="kt">text</span><span class="p">);</span>
<span class="err">}</span><span class="p">)().</span><span class="n">catch</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Deal</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fact</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">chain</span><span class="w"> </span><span class="n">failed</span>
<span class="err">}</span><span class="p">);</span>
<span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`text`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">here</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">code</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">reached</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">promise</span><span class="w"> </span><span class="k">set</span><span class="n">tles</span>
<span class="o">//</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">code</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n n-Quoted">`await`</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">runs</span>
</pre></div>

<p>...which is a bit more concise, though it somewhat mixes models
(<code>async</code>/<code>await</code> and explicit promise callbacks), which I'd normally otherwise
advise not to.</p>
<p>Or, of course, don't handle errors and just allow the "unhandled rejection"
error.</p>
<h4>#3 - <code>then</code> and <code>catch</code>
</h4>
<div class="code"><pre class="code literal-block"><span class="n">main</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="k">then</span><span class="p">(</span><span class="kt">text</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="kt">text</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">catch</span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Deal</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fact</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">chain</span><span class="w"> </span><span class="n">failed</span>
<span class="w">    </span><span class="err">}</span><span class="p">);</span>
<span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`text`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">here</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">code</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">reached</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">promise</span><span class="w"> </span><span class="k">set</span><span class="n">tles</span>
<span class="o">//</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">handlers</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">run</span>
</pre></div>

<p>The <code>catch</code> handler will be called if errors occur in the chain or in your
<code>then</code> handler. (Be sure your <code>catch</code> handler doesn't throw errors, as nothing
is registered to handle them.)</p>
<p>Or both arguments to <code>then</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">main</span><span class="p">().</span><span class="k">then</span><span class="p">(</span>
<span class="w">    </span><span class="kt">text</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="kt">text</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span><span class="p">,</span>
<span class="w">    </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Deal</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fact</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">chain</span><span class="w"> </span><span class="n">failed</span>
<span class="w">    </span><span class="err">}</span>
<span class="p">);</span>
<span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`text`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">here</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">code</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">reached</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">promise</span><span class="w"> </span><span class="k">set</span><span class="n">tles</span>
<span class="o">//</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">handlers</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">run</span>
</pre></div>

<p>Again notice we're registering a rejection handler. But in this form, be sure
that <em>neither</em> of your <code>then</code> callbacks throws any errors, since nothing is
registered to handle them.</p>
<p><br></p>
<h3>Suggest</h3>
<h2>2021 answer: you can now use top level await in the current stable version</h2>
<p>of node</p>
<p>Most of the answers above are a little out of date or very verbose, so here's
a quick example for node 14 onwards.</p>
<p>Make a file called <code>runme.mjs</code>:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">util</span> <span class="kn">from</span> <span class="s2">"util"</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">exec</span> <span class="k">as</span> <span class="n">lameExec</span> <span class="p">}</span> <span class="kn">from</span> <span class="s2">"child_process"</span><span class="p">;</span>
<span class="n">const</span> <span class="n">exec</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">promisify</span><span class="p">(</span><span class="n">lameExec</span><span class="p">);</span>
<span class="n">const</span> <span class="n">log</span> <span class="o">=</span> <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">console</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Top</span> <span class="n">level</span> <span class="k">await</span> <span class="n">works</span> <span class="n">now</span>
<span class="n">const</span> <span class="p">{</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="n">exec</span><span class="p">(</span><span class="s2">"ls -la"</span><span class="p">);</span>
<span class="n">log</span><span class="p">(</span><span class="s2">"Output:</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">stdout</span><span class="p">);</span>
<span class="n">log</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">Errors:</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
</pre></div>

<p>Run <code>node runme.mjs</code></p>
<div class="code"><pre class="code literal-block"><span class="n">Output</span><span class="o">:</span>
<span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="mi">20</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="n">mike</span><span class="w"> </span><span class="n">mike</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="n">Aug</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">12</span><span class="o">:</span><span class="mi">05</span><span class="w"> </span><span class="o">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="n">mike</span><span class="w"> </span><span class="n">mike</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="n">Aug</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">11</span><span class="o">:</span><span class="mi">05</span><span class="w"> </span><span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="n">mike</span><span class="w"> </span><span class="n">mike</span><span class="w">  </span><span class="mi">130</span><span class="w"> </span><span class="n">Aug</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">12</span><span class="o">:</span><span class="mi">01</span><span class="w"> </span><span class="n">file</span><span class="o">.</span><span class="na">json</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="n">mike</span><span class="w"> </span><span class="n">mike</span><span class="w">  </span><span class="mi">770</span><span class="w"> </span><span class="n">Aug</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">12</span><span class="o">:</span><span class="mi">12</span><span class="w"> </span><span class="n">runme</span><span class="o">.</span><span class="na">mjs</span>



<span class="n">Errors</span><span class="o">:</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2024.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2022.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
