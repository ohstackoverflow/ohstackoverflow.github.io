<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1529) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1529.html">
<link rel="prev" href="index-1530.html" type="text/html">
<link rel="next" href="index-1528.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-a-stackoverflowerror/" class="u-url">What is a StackOverflowError?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-a-stackoverflowerror/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T03:11:14+08:00" itemprop="datePublished" title="2023-03-03 03:11">2023-03-03 03:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What is a <code>StackOverflowError</code>, what causes it, and how should I deal with
them?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Parameters and local variables are allocated on the <strong>stack</strong> (with reference
types, the object lives on the <strong>heap</strong> and a variable in the stack references
that object on the heap). The stack typically lives at the <strong>upper</strong> end of
your address space and as it is used up it heads towards the <strong>bottom</strong> of the
address space (i.e. towards zero).</p>
<p>Your process also has a <strong>heap</strong> , which lives at the <strong>bottom</strong> end of your
process. As you allocate memory, this heap can grow towards the upper end of
your address space. As you can see, there is a potential for the heap to
<strong>"collide"</strong> with the stack (a bit like tectonic plates!!!).</p>
<p>The common cause for a stack overflow is a <strong>bad recursive call</strong>. Typically,
this is caused when your recursive functions doesn't have the correct
termination condition, so it ends up calling itself forever. Or when the
termination condition is fine, it can be caused by requiring too many
recursive calls before fulfilling it.</p>
<p>However, with GUI programming, it's possible to generate <strong>indirect
recursion</strong>. For example, your app may be handling paint messages, and, whilst
processing them, it may call a function that causes the system to send another
paint message. Here you've not explicitly called yourself, but the OS/VM has
done it for you.</p>
<p>To deal with them, you'll need to examine your code. If you've got functions
that call themselves then check that you've got a terminating condition. If
you have, then check that when calling the function you have at least modified
one of the arguments, otherwise there'll be no visible change for the
recursively called function and the terminating condition is useless. Also
mind that your stack space can run out of memory before reaching a valid
terminating condition, thus make sure your method can handle input values
requiring more recursive calls.</p>
<p>If you've got no obvious recursive functions then check to see if you're
calling any library functions that <strong>indirectly</strong> will cause your function to
be called (like the implicit case above).</p>
<p><br></p>
<h3>Suggest</h3>
<p>To describe this, first let us understand how <strong>local</strong> variables and objects
are stored.</p>
<p>Local variable are stored on the <strong>stack</strong> :</p>
<p><img alt="Enter image description here" src="images/SHTah.jpg"></p>
<p>If you looked at the image you should be able to understand how things are
working.</p>
<p>When a function call is invoked by a Java application, a stack frame is
allocated on the call stack. The stack frame contains the parameters of the
invoked method, its local parameters, and the return address of the method.
The return address denotes the execution point from which, the program
execution shall continue after the invoked method returns. If there is no
space for a new stack frame then, the <code>StackOverflowError</code> is thrown by the
Java Virtual Machine (JVM).</p>
<p>The most common case that can possibly exhaust a Java application’s stack is
recursion. In recursion, a method invokes itself during its execution.
Recursion is considered as a powerful general-purpose programming technique,
but it must be used with caution, to avoid <code>StackOverflowError</code>.</p>
<p>An example of throwing a <code>StackOverflowError</code> is shown below:</p>
<p><strong>StackOverflowErrorExample.java:</strong></p>
<div class="code"><pre class="code literal-block"><span class="nt">public</span><span class="w"> </span><span class="nt">class</span><span class="w"> </span><span class="nt">StackOverflowErrorExample</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="err">public</span><span class="w"> </span><span class="err">static</span><span class="w"> </span><span class="err">void</span><span class="w"> </span><span class="err">recursivePrint(int</span><span class="w"> </span><span class="err">num)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="err">System.out.println("</span><span class="n">Number</span><span class="p">:</span><span class="w"> </span><span class="err">"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">num</span><span class="p">);</span>
<span class="w">        </span><span class="err">if</span><span class="w"> </span><span class="err">(num</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="err">0)</span>
<span class="w">            </span><span class="err">return</span><span class="p">;</span>
<span class="w">        </span><span class="err">else</span>
<span class="w">            </span><span class="err">recursivePrint(++num)</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="nt">public</span><span class="w"> </span><span class="nt">static</span><span class="w"> </span><span class="nt">void</span><span class="w"> </span><span class="nt">main</span><span class="o">(</span><span class="nt">String</span><span class="cp">[]</span><span class="w"> </span><span class="nt">args</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">StackOverflowErrorExample.recursivePrint(1)</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">}</span>
</pre></div>

<p>In this example, we define a recursive method, called <code>recursivePrint</code> that
prints an integer and then, calls itself, with the next successive integer as
an argument. The recursion ends until we pass in <code>0</code> as a parameter. However,
in our example, we passed in the parameter from 1 and its increasing
followers, consequently, the recursion will never terminate.</p>
<p>A sample execution, using the <code>-Xss1M</code> flag that specifies the size of the
thread stack to equal to 1 MB, is shown below:</p>
<div class="code"><pre class="code literal-block"><span class="n">Number</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="n">Number</span><span class="o">:</span><span class="w"> </span><span class="mi">2</span>
<span class="n">Number</span><span class="o">:</span><span class="w"> </span><span class="mi">3</span>
<span class="o">...</span>
<span class="n">Number</span><span class="o">:</span><span class="w"> </span><span class="mi">6262</span>
<span class="n">Number</span><span class="o">:</span><span class="w"> </span><span class="mi">6263</span>
<span class="n">Number</span><span class="o">:</span><span class="w"> </span><span class="mi">6264</span>
<span class="n">Number</span><span class="o">:</span><span class="w"> </span><span class="mi">6265</span>
<span class="n">Number</span><span class="o">:</span><span class="w"> </span><span class="mi">6266</span>
<span class="n">Exception</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="s2">"main"</span><span class="w"> </span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">StackOverflowError</span>
<span class="w">        </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">PrintStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">PrintStream</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">480</span><span class="o">)</span>
<span class="w">        </span><span class="n">at</span><span class="w"> </span><span class="n">sun</span><span class="o">.</span><span class="na">nio</span><span class="o">.</span><span class="na">cs</span><span class="o">.</span><span class="na">StreamEncoder</span><span class="o">.</span><span class="na">writeBytes</span><span class="o">(</span><span class="n">StreamEncoder</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">221</span><span class="o">)</span>
<span class="w">        </span><span class="n">at</span><span class="w"> </span><span class="n">sun</span><span class="o">.</span><span class="na">nio</span><span class="o">.</span><span class="na">cs</span><span class="o">.</span><span class="na">StreamEncoder</span><span class="o">.</span><span class="na">implFlushBuffer</span><span class="o">(</span><span class="n">StreamEncoder</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">291</span><span class="o">)</span>
<span class="w">        </span><span class="n">at</span><span class="w"> </span><span class="n">sun</span><span class="o">.</span><span class="na">nio</span><span class="o">.</span><span class="na">cs</span><span class="o">.</span><span class="na">StreamEncoder</span><span class="o">.</span><span class="na">flushBuffer</span><span class="o">(</span><span class="n">StreamEncoder</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">104</span><span class="o">)</span>
<span class="w">        </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">OutputStreamWriter</span><span class="o">.</span><span class="na">flushBuffer</span><span class="o">(</span><span class="n">OutputStreamWriter</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">185</span><span class="o">)</span>
<span class="w">        </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">PrintStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">PrintStream</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">527</span><span class="o">)</span>
<span class="w">        </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">PrintStream</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">PrintStream</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">669</span><span class="o">)</span>
<span class="w">        </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">PrintStream</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">PrintStream</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">806</span><span class="o">)</span>
<span class="w">        </span><span class="n">at</span><span class="w"> </span><span class="n">StackOverflowErrorExample</span><span class="o">.</span><span class="na">recursivePrint</span><span class="o">(</span><span class="n">StackOverflowErrorExample</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">4</span><span class="o">)</span>
<span class="w">        </span><span class="n">at</span><span class="w"> </span><span class="n">StackOverflowErrorExample</span><span class="o">.</span><span class="na">recursivePrint</span><span class="o">(</span><span class="n">StackOverflowErrorExample</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">9</span><span class="o">)</span>
<span class="w">        </span><span class="n">at</span><span class="w"> </span><span class="n">StackOverflowErrorExample</span><span class="o">.</span><span class="na">recursivePrint</span><span class="o">(</span><span class="n">StackOverflowErrorExample</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">9</span><span class="o">)</span>
<span class="w">        </span><span class="n">at</span><span class="w"> </span><span class="n">StackOverflowErrorExample</span><span class="o">.</span><span class="na">recursivePrint</span><span class="o">(</span><span class="n">StackOverflowErrorExample</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">9</span><span class="o">)</span>
<span class="w">        </span><span class="o">...</span>
</pre></div>

<p>Depending on the JVM’s initial configuration, the results may differ, but
eventually the <code>StackOverflowError</code> shall be thrown. This example is a very
good example of how recursion can cause problems, if not implemented with
caution.</p>
<p><em><strong>How to deal with the StackOverflowError</strong></em></p>
<ol>
<li>
<p>The simplest solution is to carefully inspect the stack trace and detect the repeating pattern of line numbers. These line numbers indicate the code being recursively called. Once you detect these lines, you must carefully inspect your code and understand why the recursion never terminates.</p>
</li>
<li>
<p>If you have verified that the recursion is implemented correctly, you can increase the stack’s size, in order to allow a larger number of invocations. Depending on the Java Virtual Machine (JVM) installed, the default thread stack size may equal to either <strong>512 KB, or 1 MB</strong>. You can increase the thread stack size using the <code>-Xss</code> flag. This flag can be specified either via the project’s configuration, or via the command line. The format of the <code>-Xss</code> argument is: <code>-Xss&lt;size&gt;[g|G|m|M|k|K]</code></p>
</li>
</ol>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/elegant-ways-to-support-equivalence-equality-in-python-classes/" class="u-url">Elegant ways to support equivalence ("equality") in Python classes</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/elegant-ways-to-support-equivalence-equality-in-python-classes/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T03:10:49+08:00" itemprop="datePublished" title="2023-03-03 03:10">2023-03-03 03:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>When writing custom classes it is often important to allow equivalence by
means of the <code>==</code> and <code>!=</code> operators. In Python, this is made possible by
implementing the <code>__eq__</code> and <code>__ne__</code> special methods, respectively. The
easiest way I've found to do this is the following method:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Foo:</span>
    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, <span class="nb">item</span>):
        <span class="nb">self</span>.<span class="nb">item</span> = <span class="nb">item</span>

    <span class="n">def</span> <span class="n">__eq__</span>(<span class="nb">self</span>, <span class="n">other</span>):
        <span class="k">if</span> <span class="n">isinstance</span>(<span class="n">other</span>, <span class="nb">self</span>.<span class="n">__class__</span>):
            <span class="k">return</span> <span class="nb">self</span>.<span class="n">__dict__</span> == <span class="n">other</span>.<span class="n">__dict__</span>
        <span class="n">else:</span>
            <span class="k">return</span> <span class="nb">False</span>

    <span class="n">def</span> <span class="n">__ne__</span>(<span class="nb">self</span>, <span class="n">other</span>):
        <span class="k">return</span> <span class="nb">not</span> <span class="nb">self</span>.<span class="n">__eq__</span>(<span class="n">other</span>)
</pre></div>

<p>Do you know of more elegant means of doing this? Do you know of any particular
disadvantages to using the above method of comparing <code>__dict__</code>s?</p>
<p><strong>Note</strong> : A bit of clarification--when <code>__eq__</code> and <code>__ne__</code> are undefined,
you'll find this behavior:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; a = Foo(1)
&gt;&gt;&gt; b = Foo(1)
&gt;&gt;&gt; a is b
False
&gt;&gt;&gt; a == b
False
</pre></div>

<p>That is, <code>a == b</code> evaluates to <code>False</code> because it really runs <code>a is b</code>, a test
of identity (i.e., "Is <code>a</code> the same object as <code>b</code>?").</p>
<p>When <code>__eq__</code> and <code>__ne__</code> are defined, you'll find this behavior (which is
the one we're after):</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; a = Foo(1)
&gt;&gt;&gt; b = Foo(1)
&gt;&gt;&gt; a is b
False
&gt;&gt;&gt; a == b
True
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>Consider this simple problem:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Number:</span>

    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, <span class="n">number</span>):
        <span class="nb">self</span>.<span class="n">number</span> = <span class="n">number</span>


<span class="n">n1</span> = <span class="n">Number</span>(<span class="mi">1</span>)
<span class="n">n2</span> = <span class="n">Number</span>(<span class="mi">1</span>)

<span class="n">n1</span> == <span class="n">n2</span> <span class="c1"># False -- oops</span>
</pre></div>

<p>So, Python by default uses the object identifiers for comparison operations:</p>
<div class="code"><pre class="code literal-block">id(n1) # 140400634555856
id(n2) # 140400634555920
</pre></div>

<p>Overriding the <code>__eq__</code> function seems to solve the problem:</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">__eq__</span><span class="ss">(</span><span class="nv">self</span>,<span class="w"> </span><span class="nv">other</span><span class="ss">)</span>:
<span class="w">    </span><span class="s2">"""Overrides the default implementation"""</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">isinstance</span><span class="ss">(</span><span class="nv">other</span>,<span class="w"> </span><span class="nv">Number</span><span class="ss">)</span>:
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">self</span>.<span class="nv">number</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">other</span>.<span class="nv">number</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">False</span>


<span class="nv">n1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">n2</span><span class="w"> </span>#<span class="w"> </span><span class="nv">True</span>
<span class="nv">n1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">n2</span><span class="w"> </span>#<span class="w"> </span><span class="nv">True</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">Python</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="nv">oops</span>,<span class="w"> </span><span class="nv">False</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">Python</span><span class="w"> </span><span class="mi">3</span>
</pre></div>

<p>In <em>Python 2</em> , always remember to override the <code>__ne__</code> function as well, as
the documentation states:</p>
<blockquote>
<p>There are no implied relationships among the comparison operators. The truth
of <code>x==y</code> does not imply that <code>x!=y</code> is false. Accordingly, when defining
<code>__eq__()</code>, one should also define <code>__ne__()</code> so that the operators will
behave as expected.</p>
</blockquote>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">__ne__</span><span class="ss">(</span><span class="nv">self</span>,<span class="w"> </span><span class="nv">other</span><span class="ss">)</span>:
<span class="w">    </span><span class="s2">"""Overrides the default implementation (unnecessary in Python 3)"""</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">self</span>.<span class="nv">__eq__</span><span class="ss">(</span><span class="nv">other</span><span class="ss">)</span>


<span class="nv">n1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">n2</span><span class="w"> </span>#<span class="w"> </span><span class="nv">True</span>
<span class="nv">n1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">n2</span><span class="w"> </span>#<span class="w"> </span><span class="nv">False</span>
</pre></div>

<p>In <em>Python 3</em> , this is no longer necessary, as the documentation states:</p>
<blockquote>
<p>By default, <code>__ne__()</code> delegates to <code>__eq__()</code> and inverts the result unless
it is <code>NotImplemented</code>. There are no other implied relationships among the
comparison operators, for example, the truth of <code>(x&lt;y or x==y)</code> does not
imply <code>x&lt;=y</code>.</p>
</blockquote>
<p>But that does not solve all our problems. Let’s add a subclass:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">SubNumber</span>(<span class="n">Number</span>):
    <span class="nb">pass</span>


<span class="n">n3</span> = <span class="n">SubNumber</span>(<span class="mi">1</span>)

<span class="n">n1</span> == <span class="n">n3</span> <span class="c1"># False for classic-style classes -- oops, True for new-style classes</span>
<span class="n">n3</span> == <span class="n">n1</span> <span class="c1"># True</span>
<span class="n">n1</span> != <span class="n">n3</span> <span class="c1"># True for classic-style classes -- oops, False for new-style classes</span>
<span class="n">n3</span> != <span class="n">n1</span> <span class="c1"># False</span>
</pre></div>

<p><strong>Note:</strong> Python 2 has two kinds of classes:</p>
<ul>
<li>
<p><em>classic-style</em> (or <em>old-style</em> ) classes, that do <em>not</em> inherit from <code>object</code> and that are declared as <code>class A:</code>, <code>class A():</code> or <code>class A(B):</code> where <code>B</code> is a classic-style class;</p>
</li>
<li>
<p><em>new-style</em> classes, that do inherit from <code>object</code> and that are declared as <code>class A(object)</code> or <code>class A(B):</code> where <code>B</code> is a new-style class. Python 3 has only new-style classes that are declared as <code>class A:</code>, <code>class A(object):</code> or <code>class A(B):</code>. </p>
</li>
</ul>
<p>For classic-style classes, a comparison operation always calls the method of
the first operand, while for new-style classes, it always calls the method of
the subclass operand, regardless of the order of the operands.</p>
<p>So here, if <code>Number</code> is a classic-style class:</p>
<ul>
<li>
<code>n1 == n3</code> calls <code>n1.__eq__</code>;</li>
<li>
<code>n3 == n1</code> calls <code>n3.__eq__</code>;</li>
<li>
<code>n1 != n3</code> calls <code>n1.__ne__</code>;</li>
<li>
<code>n3 != n1</code> calls <code>n3.__ne__</code>.</li>
</ul>
<p>And if <code>Number</code> is a new-style class:</p>
<ul>
<li>both <code>n1 == n3</code> and <code>n3 == n1</code> call <code>n3.__eq__</code>;</li>
<li>both <code>n1 != n3</code> and <code>n3 != n1</code> call <code>n3.__ne__</code>.</li>
</ul>
<p>To fix the non-commutativity issue of the <code>==</code> and <code>!=</code> operators for Python 2
classic-style classes, the <code>__eq__</code> and <code>__ne__</code> methods should return the
<code>NotImplemented</code> value when an operand type is not supported. The
documentation defines the <code>NotImplemented</code> value as:</p>
<blockquote>
<p>Numeric methods and rich comparison methods may return this value if they do
not implement the operation for the operands provided. (The interpreter will
then try the reflected operation, or some other fallback, depending on the
operator.) Its truth value is true.</p>
</blockquote>
<p>In this case the operator delegates the comparison operation to the <em>reflected
method</em> of the <em>other</em> operand. The documentation defines reflected methods
as:</p>
<blockquote>
<p>There are no swapped-argument versions of these methods (to be used when the
left argument does not support the operation but the right argument does);
rather, <code>__lt__()</code> and <code>__gt__()</code> are each other’s reflection, <code>__le__()</code>
and <code>__ge__()</code> are each other’s reflection, and <code>__eq__()</code> and <code>__ne__()</code>
are their own reflection.</p>
</blockquote>
<p>The result looks like this:</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">__eq__</span><span class="ss">(</span><span class="nv">self</span>,<span class="w"> </span><span class="nv">other</span><span class="ss">)</span>:
<span class="w">    </span><span class="s2">"""Overrides the default implementation"""</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">isinstance</span><span class="ss">(</span><span class="nv">other</span>,<span class="w"> </span><span class="nv">Number</span><span class="ss">)</span>:
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">self</span>.<span class="nv">number</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">other</span>.<span class="nv">number</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">NotImplemented</span>

<span class="nv">def</span><span class="w"> </span><span class="nv">__ne__</span><span class="ss">(</span><span class="nv">self</span>,<span class="w"> </span><span class="nv">other</span><span class="ss">)</span>:
<span class="w">    </span><span class="s2">"""Overrides the default implementation (unnecessary in Python 3)"""</span>
<span class="w">    </span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span>.<span class="nv">__eq__</span><span class="ss">(</span><span class="nv">other</span><span class="ss">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">NotImplemented</span>:
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">NotImplemented</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">x</span>
</pre></div>

<p>Returning the <code>NotImplemented</code> value instead of <code>False</code> is the right thing to
do even for new-style classes if <em>commutativity</em> of the <code>==</code> and <code>!=</code>
operators is desired when the operands are of unrelated types (no
inheritance).</p>
<p>Are we there yet? Not quite. How many unique numbers do we have?</p>
<div class="code"><pre class="code literal-block">len(set([n1, n2, n3])) # 3 -- oops
</pre></div>

<p>Sets use the hashes of objects, and by default Python returns the hash of the
identifier of the object. Let’s try to override it:</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">__hash__</span><span class="ss">(</span><span class="nv">self</span><span class="ss">)</span>:
<span class="w">    </span><span class="s2">"""Overrides the default implementation"""</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">hash</span><span class="ss">(</span><span class="nv">tuple</span><span class="ss">(</span><span class="nv">sorted</span><span class="ss">(</span><span class="nv">self</span>.<span class="nv">__dict__</span>.<span class="nv">items</span><span class="ss">())))</span>

<span class="nv">len</span><span class="ss">(</span><span class="nv">set</span><span class="ss">(</span>[<span class="nv">n1</span>,<span class="w"> </span><span class="nv">n2</span>,<span class="w"> </span><span class="nv">n3</span>]<span class="ss">))</span><span class="w"> </span>#<span class="w"> </span><span class="mi">1</span>
</pre></div>

<p>The end result looks like this (I added some assertions at the end for
validation):</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Number:</span>

    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, <span class="n">number</span>):
        <span class="nb">self</span>.<span class="n">number</span> = <span class="n">number</span>

    <span class="n">def</span> <span class="n">__eq__</span>(<span class="nb">self</span>, <span class="n">other</span>):
        <span class="s">"""Overrides the default implementation"""</span>
        <span class="k">if</span> <span class="n">isinstance</span>(<span class="n">other</span>, <span class="n">Number</span>):
            <span class="k">return</span> <span class="nb">self</span>.<span class="n">number</span> == <span class="n">other</span>.<span class="n">number</span>
        <span class="k">return</span> <span class="n">NotImplemented</span>

    <span class="n">def</span> <span class="n">__ne__</span>(<span class="nb">self</span>, <span class="n">other</span>):
        <span class="s">"""Overrides the default implementation (unnecessary in Python 3)"""</span>
        <span class="nb">x</span> = <span class="nb">self</span>.<span class="n">__eq__</span>(<span class="n">other</span>)
        <span class="k">if</span> <span class="nb">x</span> <span class="k">is</span> <span class="nb">not</span> <span class="n">NotImplemented:</span>
            <span class="k">return</span> <span class="nb">not</span> <span class="nb">x</span>
        <span class="k">return</span> <span class="n">NotImplemented</span>

    <span class="n">def</span> <span class="n">__hash__</span>(<span class="nb">self</span>):
        <span class="s">"""Overrides the default implementation"""</span>
        <span class="k">return</span> <span class="n">hash</span>(<span class="n">tuple</span>(<span class="n">sorted</span>(<span class="nb">self</span>.<span class="n">__dict__</span>.<span class="n">items</span>())))


<span class="k">class</span> <span class="n">SubNumber</span>(<span class="n">Number</span>):
    <span class="nb">pass</span>


<span class="n">n1</span> = <span class="n">Number</span>(<span class="mi">1</span>)
<span class="n">n2</span> = <span class="n">Number</span>(<span class="mi">1</span>)
<span class="n">n3</span> = <span class="n">SubNumber</span>(<span class="mi">1</span>)
<span class="n">n4</span> = <span class="n">SubNumber</span>(<span class="mi">4</span>)

<span class="n">assert</span> <span class="n">n1</span> == <span class="n">n2</span>
<span class="n">assert</span> <span class="n">n2</span> == <span class="n">n1</span>
<span class="n">assert</span> <span class="nb">not</span> <span class="n">n1</span> != <span class="n">n2</span>
<span class="n">assert</span> <span class="nb">not</span> <span class="n">n2</span> != <span class="n">n1</span>

<span class="n">assert</span> <span class="n">n1</span> == <span class="n">n3</span>
<span class="n">assert</span> <span class="n">n3</span> == <span class="n">n1</span>
<span class="n">assert</span> <span class="nb">not</span> <span class="n">n1</span> != <span class="n">n3</span>
<span class="n">assert</span> <span class="nb">not</span> <span class="n">n3</span> != <span class="n">n1</span>

<span class="n">assert</span> <span class="nb">not</span> <span class="n">n1</span> == <span class="n">n4</span>
<span class="n">assert</span> <span class="nb">not</span> <span class="n">n4</span> == <span class="n">n1</span>
<span class="n">assert</span> <span class="n">n1</span> != <span class="n">n4</span>
<span class="n">assert</span> <span class="n">n4</span> != <span class="n">n1</span>

<span class="n">assert</span> <span class="n">len</span>(<span class="n">set</span>([<span class="n">n1</span>, <span class="n">n2</span>, <span class="n">n3</span>, ])) == <span class="mi">1</span>
<span class="n">assert</span> <span class="n">len</span>(<span class="n">set</span>([<span class="n">n1</span>, <span class="n">n2</span>, <span class="n">n3</span>, <span class="n">n4</span>])) == <span class="mi">2</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You need to be careful with inheritance:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">Foo</span>:
<span class="w">    </span><span class="nv">def</span><span class="w"> </span><span class="nv">__eq__</span><span class="ss">(</span><span class="nv">self</span>,<span class="w"> </span><span class="nv">other</span><span class="ss">)</span>:
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nv">isinstance</span><span class="ss">(</span><span class="nv">other</span>,<span class="w"> </span><span class="nv">self</span>.<span class="nv">__class__</span><span class="ss">)</span>:
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">self</span>.<span class="nv">__dict__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">other</span>.<span class="nv">__dict__</span>
<span class="w">        </span><span class="k">else</span>:
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">False</span>

<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">Bar</span><span class="ss">(</span><span class="nv">Foo</span><span class="ss">)</span>:<span class="nv">pass</span>

<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Bar</span><span class="ss">()</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Foo</span><span class="ss">()</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">b</span>
<span class="nv">True</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">f</span>
<span class="nv">False</span>
</pre></div>

<p>Check types more strictly, like this:</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">__eq__</span><span class="ss">(</span><span class="nv">self</span>,<span class="w"> </span><span class="nv">other</span><span class="ss">)</span>:
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">type</span><span class="ss">(</span><span class="nv">other</span><span class="ss">)</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">type</span><span class="ss">(</span><span class="nv">self</span><span class="ss">)</span>:
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">self</span>.<span class="nv">__dict__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">other</span>.<span class="nv">__dict__</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">False</span>
</pre></div>

<p>Besides that, your approach will work fine, that's what special methods are
there for.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/in-vim-is-there-a-way-to-delete-without-putting-text-in-the-register/" class="u-url">In Vim is there a way to delete without putting text in the register?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/in-vim-is-there-a-way-to-delete-without-putting-text-in-the-register/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T03:10:23+08:00" itemprop="datePublished" title="2023-03-03 03:10">2023-03-03 03:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Using Vim I often want to replace a block of code with a block that I just
yanked.</p>
<p>But when I delete the block of code that is to be replaced, that block itself
goes into the register which erases the block I just yanked. So I've got in
the habit of yanking, then inserting, then deleting what I didn't want, but
with large blocks of code this gets messy trying to keep the inserted block
and the block to delete separate.</p>
<p>So what is the slickest and quickest way to replace text in Vim?</p>
<ul>
<li>is there a way to delete text without putting it into the register?</li>
<li>is there a way to say e.g. "replace next word" or "replace up to next paragraph"</li>
<li>or is the best way to somehow use the multi-register feature?</li>
</ul>
<p><br><br></p>
<h2>Answer</h2>
<p>To delete something without saving it in a register, you can use the "black
hole register":</p>
<div class="code"><pre class="code literal-block">"_d
</pre></div>

<p>Of course you could also use any of the other registers that don't hold
anything you are interested in.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Yep. It's slightly more convoluted than deleting the "old" text first, but:</p>
<p>I start off with..</p>
<div class="code"><pre class="code literal-block">line1
line2
line3
line4

old1
old2
old3
old4
</pre></div>

<p>I <code>shift</code>+<code>v</code> select the line1, line 2, 3 and 4, and delete them with the <code>d</code>
command</p>
<p>Then I delete the old 1-4 lines the same way.</p>
<p>Then, do</p>
<div class="code"><pre class="code literal-block">"2p
</pre></div>

<p>That'll paste the second-last yanked lines (line 1-4). <code>"3p</code> will do the
third-from-last, and so on..</p>
<p>So I end up with</p>
<div class="code"><pre class="code literal-block">line1
line2
line3
line4
</pre></div>

<p><strong>Reference:</strong> Vim documentation on numbered register</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1530.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1528.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
