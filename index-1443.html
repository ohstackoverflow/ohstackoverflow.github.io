<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1443) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1443.html">
<link rel="prev" href="index-1444.html" type="text/html">
<link rel="next" href="index-1442.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-fix-premature-convergence-in-simple-ga-python/" class="u-url">How to fix premature convergence in simple GA (Python)?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-fix-premature-convergence-in-simple-ga-python/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T03:57:56+08:00" itemprop="datePublished" title="2023-02-28 03:57">2023-02-28 03:57</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><em>Yesterday i started exploring the genetic algorithms, and when i ended up
with some basic theory, i tried to write simple GA on Python, that solves
Diophantine equation. I'm new to Python and GAs, so please, don't judge my
code strictly.</em></p>
<h3>Problem</h3>
<p>I cant get any result due to premature convergence (there is some no-return
point (n-population), population[n] == population[n+i], where i is any
integer. even the random mutatuion element cant change this, the generation is
degradating very quickly)</p>
<p><strong>GA is using crossover to breed, and weighted choice of parents.</strong></p>
<ul>
<li>
<strong>Q1:</strong> Is there any design mistakes in my code (below)?</li>
<li>
<strong>Q1.2:</strong> Do i need to add elitism?</li>
<li>
<strong>Q1.3:</strong> Do i need to change breed logic?</li>
<li>
<strong>Q2:</strong> Is there realy needed deep copy?</li>
</ul>
<p>Code:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">floor</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">class</span> <span class="nc">Organism</span><span class="p">:</span>
    <span class="c1">#initiate</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alleles</span><span class="p">,</span> <span class="n">fitness</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alleles</span> <span class="o">=</span> <span class="n">alleles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitness</span> <span class="o">=</span> <span class="n">fitness</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">likelihood</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'</span><span class="si">%s</span><span class="s1"> [</span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1">]'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alleles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitness</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="p">)</span>

<span class="k">class</span>  <span class="nc">CDiophantine</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coefficients</span><span class="p">,</span>  <span class="n">result</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span> <span class="o">=</span> <span class="n">coefficients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>

    <span class="n">maxPopulation</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="n">organisms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">GetGene</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">OrganismFitness</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gene</span><span class="p">):</span>
        <span class="n">gene</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">)):</span>
            <span class="n">gene</span><span class="o">.</span><span class="n">result</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">gene</span><span class="o">.</span><span class="n">alleles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">gene</span><span class="o">.</span><span class="n">fitness</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">gene</span><span class="o">.</span><span class="n">result</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gene</span><span class="o">.</span><span class="n">fitness</span>

    <span class="k">def</span> <span class="nf">Fitness</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">organism</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="p">:</span>
            <span class="n">organism</span><span class="o">.</span><span class="n">fitness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OrganismFitness</span><span class="p">(</span><span class="n">organism</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">organism</span><span class="o">.</span><span class="n">fitness</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>  <span class="n">organism</span>
        <span class="k">return</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="nf">MultiplyFitness</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coefficientSum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">organism</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="p">:</span>
            <span class="n">coefficientSum</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">organism</span><span class="o">.</span><span class="n">fitness</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coefficientSum</span>

    <span class="k">def</span> <span class="nf">GenerateLikelihoods</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">multiplyFitness</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MultiplyFitness</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">organism</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="p">:</span>
            <span class="n">last</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">organism</span><span class="o">.</span><span class="n">fitness</span><span class="p">)</span><span class="o">/</span><span class="n">multiplyFitness</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
            <span class="c1">#print '1/%s/%s*100 - %s' % (organism.fitness, multiplyFitness, last)</span>
            <span class="n">organism</span><span class="o">.</span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">last</span>

    <span class="k">def</span> <span class="nf">Breed</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parentOne</span><span class="p">,</span> <span class="n">parentTwo</span><span class="p">):</span>
        <span class="n">crossover</span> <span class="o">=</span> <span class="n">randint</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">child</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">parentOne</span><span class="p">)</span>
        <span class="n">initial</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">final</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parentOne</span><span class="o">.</span><span class="n">alleles</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">randint</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="n">father</span> <span class="o">=</span> <span class="n">parentOne</span>
            <span class="n">mother</span> <span class="o">=</span> <span class="n">parentTwo</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">father</span> <span class="o">=</span> <span class="n">parentTwo</span>
            <span class="n">mother</span> <span class="o">=</span> <span class="n">parentOne</span>
        <span class="n">child</span><span class="o">.</span><span class="n">alleles</span> <span class="o">=</span> <span class="n">mother</span><span class="o">.</span><span class="n">alleles</span><span class="p">[:</span><span class="n">crossover</span><span class="p">]</span> <span class="o">+</span> <span class="n">father</span><span class="o">.</span><span class="n">alleles</span><span class="p">[</span><span class="n">crossover</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">randint</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">initial</span><span class="p">,</span><span class="n">final</span><span class="p">):</span>    
                <span class="n">child</span><span class="o">.</span><span class="n">alleles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">randint</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">child</span>

    <span class="k">def</span> <span class="nf">CreateNewOrganisms</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#generating new population</span>
        <span class="n">tempPopulation</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="p">:</span>
            <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">father</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">mother</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">while</span> <span class="n">father</span><span class="o">.</span><span class="n">alleles</span> <span class="o">==</span> <span class="n">mother</span><span class="o">.</span><span class="n">alleles</span><span class="p">:</span>
                <span class="n">father</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">WeightedChoice</span><span class="p">()</span>
                <span class="n">mother</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">WeightedChoice</span><span class="p">()</span>
                <span class="n">iterations</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">iterations</span> <span class="o">&gt;</span> <span class="mi">35</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="n">kid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Breed</span><span class="p">(</span><span class="n">father</span><span class="p">,</span><span class="n">mother</span><span class="p">)</span>
            <span class="n">tempPopulation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">organisms</span> <span class="o">=</span> <span class="n">tempPopulation</span>

    <span class="k">def</span> <span class="nf">WeightedChoice</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">organism</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="p">:</span>
            <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">organism</span><span class="o">.</span><span class="n">likelihood</span><span class="p">,</span><span class="n">organism</span><span class="p">))</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">AverageFitness</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">organism</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="p">:</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="n">organism</span><span class="o">.</span><span class="n">fitness</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">AverageLikelihoods</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">organism</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="p">:</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="n">organism</span><span class="o">.</span><span class="n">likelihood</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Solve</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">maxPopulation</span><span class="p">):</span>
            <span class="n">alleles</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1">#</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">)):</span>
                <span class="n">alleles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">organisms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Organism</span><span class="p">(</span><span class="n">alleles</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fitness</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">solution</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">solution</span><span class="o">.</span><span class="n">alleles</span>
        <span class="n">iterations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">solution</span> <span class="ow">and</span>  <span class="n">iterations</span> <span class="o">&lt;</span><span class="mi">3000</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GenerateLikelihoods</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CreateNewOrganisms</span><span class="p">()</span>
            <span class="n">solution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fitness</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">solution</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s1">'SOLUTION FOUND IN </span><span class="si">%s</span><span class="s1"> ITERATIONS'</span> <span class="o">%</span> <span class="n">iterations</span>
                <span class="k">return</span> <span class="n">solution</span><span class="o">.</span><span class="n">alleles</span>
            <span class="n">iterations</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span>  <span class="o">-</span><span class="mi">1</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">diophantine</span> <span class="o">=</span> <span class="n">CDiophantine</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="mi">30</span><span class="p">)</span>
    <span class="c1">#cProfile.run('diophantine.Solve()')</span>
    <span class="nb">print</span> <span class="n">diophantine</span><span class="o">.</span><span class="n">Solve</span><span class="p">()</span>
</pre></div>

<p>I <strong>tried</strong> to change breed and weighted random choice logic but with no
results. This GA supposed to be work, i dont know, what's wrong. I know that
there are some GA libraries on Python, i'm trying to understand them at the
moment - it seems that they are quite complex to me. Sorry for mistakes,
english is not my native language. Thank you for your understanding.</p>
<p><strong>NECROUPDATE:</strong> Store chromosomes in Gray Code, not in integer.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Slight logic error: parentTwo is slightly more likely to be the father than
the mother. Even odds would be randint (1,100) &lt;= 50, not randint (1,100) &lt;
50. Won't be what's causing the issue here.</p>
<ol>
<li>Your population size is fairly small. 40 is very few for most problems. That will cause it to converge quickly. </li>
<li>Elitism will cause your population to converge faster, not slower.</li>
<li>Your WeightedChoice function appears to be rather inefficient, if I'm reading it correctly. I haven't used Python recently enough to really understand what's going on there, but looking at it it certainly feels like something inefficient. If you can improve on that, it should speed up the processing so you can increase the population size (and, seeing as I'm figuring your algorithm there is probably at least O(n^2), that'll be <em>really</em> important).</li>
</ol>
<p>With such a small population size, 200-300 generations is not surprising to
solve the problem. If you increase the population, it should reduce the
generations required.</p>
<p>Note: I found some old code that I wrote a few years ago for solving a similar
problem. It's in C, and uses tournament selection, but perhaps it can give you
a few ideas:</p>
<div class="code"><pre class="code literal-block"><span class="cm">/*Diophantine equation solving genetic algorithm</span>
<span class="cm">Copyright (C) 2009- by Joel Rein</span>
<span class="cm">Licensed under the terms of the MIT License*/</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">stdio</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">stdlib</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="nc">time</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="n">#define</span><span class="w"> </span><span class="n">POP</span><span class="w"> </span><span class="mi">100</span>
<span class="o">//</span><span class="n">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">solve</span><span class="w"> </span><span class="k">for</span>
<span class="n">#define</span><span class="w"> </span><span class="nf">VAR</span><span class="w"> </span><span class="mi">4</span>
<span class="o">//</span><span class="n">maximum</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="n">variables</span>
<span class="n">#define</span><span class="w"> </span><span class="nf">MAX</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span>
<span class="n">#define</span><span class="w"> </span><span class="n">MAX_GENS</span><span class="w"> </span><span class="mi">500</span>
<span class="o">//</span><span class="n">probability</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">crossover</span><span class="w"> </span><span class="p">(</span><span class="n">otherwise</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="p">)</span>
<span class="n">#define</span><span class="w"> </span><span class="n">CROSSOVER</span><span class="w"> </span><span class="mf">0.7</span>
<span class="o">//</span><span class="n">probability</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">mutation</span><span class="w"> </span><span class="p">(</span><span class="n">per</span><span class="w"> </span><span class="n">gene</span><span class="p">)</span>
<span class="n">#define</span><span class="w"> </span><span class="n">MUTATION</span><span class="w"> </span><span class="mf">0.4</span>
<span class="o">//</span><span class="k">print</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">generation</span><span class="w"> </span><span class="p">(</span><span class="nl">recommended</span><span class="p">:</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">used</span><span class="p">,</span><span class="w"> </span><span class="n">keep</span><span class="w"> </span><span class="n">RUNS</span><span class="w"> </span><span class="n">low</span><span class="p">)</span>
<span class="n">#define</span><span class="w"> </span><span class="n">DEBUG</span>
<span class="o">//</span><span class="k">print</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">individually</span>
<span class="n">#define</span><span class="w"> </span><span class="n">PRINT_RESULT</span>
<span class="o">//</span><span class="n">how</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">GA</span>
<span class="n">#define</span><span class="w"> </span><span class="n">RUNS</span><span class="w"> </span><span class="mi">1</span>

<span class="nc">int</span><span class="w"> </span><span class="n">pop</span><span class="o">[</span><span class="n">POP</span><span class="o">][</span><span class="n">VAR</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">scores</span><span class="o">[</span><span class="n">POP</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="o">[</span><span class="n">POP</span><span class="o">][</span><span class="n">VAR</span><span class="o">]</span><span class="p">;</span>
<span class="nc">int</span><span class="w"> </span><span class="n">coefficients</span><span class="o">[</span><span class="n">VAR</span><span class="o">]</span><span class="p">;</span>
<span class="nc">int</span><span class="w"> </span><span class="k">result</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="nc">int</span><span class="w"> </span><span class="n">score</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="k">index</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="nf">sum</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="nf">VAR</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="nf">sum</span><span class="o">+=</span><span class="n">coefficients</span><span class="o">[</span><span class="n">i</span><span class="o">]*</span><span class="n">pop</span><span class="o">[</span><span class="n">index</span><span class="o">][</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="nf">sum</span><span class="o">-</span><span class="k">result</span><span class="p">);</span>
<span class="err">}</span>

<span class="nc">int</span><span class="w"> </span><span class="n">tournament</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="k">size</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">best</span><span class="o">=</span><span class="nf">rand</span><span class="p">()</span><span class="o">%</span><span class="n">POP</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="k">size</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="nc">int</span><span class="w"> </span><span class="n">comp</span><span class="o">=</span><span class="nf">rand</span><span class="p">()</span><span class="o">%</span><span class="n">POP</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">scores</span><span class="o">[</span><span class="n">comp</span><span class="o">]&lt;</span><span class="n">scores</span><span class="o">[</span><span class="n">best</span><span class="o">]</span><span class="p">)</span>
<span class="w">            </span><span class="n">best</span><span class="o">=</span><span class="n">comp</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">best</span><span class="p">;</span>
<span class="err">}</span>

<span class="n">void</span><span class="w"> </span><span class="n">breed</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="n">tournament</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="n">tournament</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="w">    </span><span class="o">//</span><span class="n">copy</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="nf">VAR</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="k">new</span><span class="o">[</span><span class="n">target</span><span class="o">][</span><span class="n">i</span><span class="o">]=</span><span class="n">pop</span><span class="o">[</span><span class="n">a</span><span class="o">][</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="o">//</span><span class="n">crossover</span>
<span class="w">    </span><span class="k">if</span><span class="p">((</span><span class="nc">float</span><span class="p">)</span><span class="nf">rand</span><span class="p">()</span><span class="o">/</span><span class="n">RAND_MAX</span><span class="o">&lt;</span><span class="n">CROSSOVER</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="nc">int</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="nf">rand</span><span class="p">()</span><span class="o">%</span><span class="nf">VAR</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">x</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="nf">VAR</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="k">new</span><span class="o">[</span><span class="n">target</span><span class="o">][</span><span class="n">i</span><span class="o">]=</span><span class="n">pop</span><span class="o">[</span><span class="n">b</span><span class="o">][</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="o">//</span><span class="n">mutation</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="nf">VAR</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="p">((</span><span class="nc">float</span><span class="p">)</span><span class="nf">rand</span><span class="p">()</span><span class="o">/</span><span class="n">RAND_MAX</span><span class="o">&lt;</span><span class="n">MUTATION</span><span class="p">)</span>
<span class="w">            </span><span class="k">new</span><span class="o">[</span><span class="n">target</span><span class="o">][</span><span class="n">i</span><span class="o">]=</span><span class="nf">rand</span><span class="p">()</span><span class="o">%</span><span class="p">(</span><span class="k">result</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="k">result</span><span class="p">;</span>
<span class="err">}</span>

<span class="n">void</span><span class="w"> </span><span class="n">debug</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">gen</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">best</span><span class="p">)</span><span class="err">{</span>
<span class="n">#ifdef</span><span class="w"> </span><span class="n">DEBUG</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="ss">"Gen: %3i Score: %3i --- "</span><span class="p">,</span><span class="w"> </span><span class="n">gen</span><span class="p">,</span><span class="w"> </span><span class="n">scores</span><span class="o">[</span><span class="n">best</span><span class="o">]</span><span class="p">);</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="nf">sum</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="nf">VAR</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="nf">sum</span><span class="o">+=</span><span class="n">coefficients</span><span class="o">[</span><span class="n">i</span><span class="o">]*</span><span class="n">pop</span><span class="o">[</span><span class="n">best</span><span class="o">][</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="ss">"%3i*%3i+"</span><span class="p">,</span><span class="w"> </span><span class="n">coefficients</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">pop</span><span class="o">[</span><span class="n">best</span><span class="o">][</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="ss">"0= %3i (target: %i)\n"</span><span class="p">,</span><span class="w"> </span><span class="nf">sum</span><span class="p">,</span><span class="w"> </span><span class="k">result</span><span class="p">);</span>
<span class="n">#endif</span>
<span class="err">}</span>

<span class="nc">int</span><span class="w"> </span><span class="n">ga</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">run</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="n">srand</span><span class="p">(</span><span class="nc">time</span><span class="p">(</span><span class="k">NULL</span><span class="p">)</span><span class="o">+</span><span class="n">run</span><span class="p">);</span>
<span class="w">    </span><span class="o">//</span><span class="n">calculate</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">equation</span><span class="p">.</span><span class="w"> </span>
<span class="w">    </span><span class="o">//</span><span class="n">this</span><span class="w"> </span><span class="n">mustn</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">division</span><span class="o">-</span><span class="k">by</span><span class="o">-</span><span class="n">zero</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">initialising</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">mutating</span><span class="p">.</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="err">!</span><span class="k">result</span><span class="p">)</span>
<span class="w">        </span><span class="k">result</span><span class="o">=</span><span class="nf">rand</span><span class="p">()</span><span class="o">%</span><span class="nf">MAX</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="nf">VAR</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">coefficients</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="nf">rand</span><span class="p">()</span><span class="o">%</span><span class="k">result</span><span class="p">;</span>
<span class="w">    </span><span class="o">//</span><span class="n">initialise</span><span class="w"> </span><span class="n">population</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">POP</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="nf">VAR</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="n">pop</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]=</span><span class="nf">rand</span><span class="p">()</span><span class="o">%</span><span class="p">(</span><span class="k">result</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="k">result</span><span class="p">;</span>
<span class="w">    </span><span class="o">//</span><span class="n">main</span><span class="w"> </span><span class="n">loop</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">gen</span><span class="p">,</span><span class="w"> </span><span class="n">best</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">gen</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">gen</span><span class="o">&lt;</span><span class="n">MAX_GENS</span><span class="p">;</span><span class="n">gen</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="n">best</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="o">//</span><span class="n">evaluate</span><span class="w"> </span><span class="n">population</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">POP</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="err">{</span>
<span class="w">            </span><span class="n">scores</span><span class="o">[</span><span class="n">i</span><span class="o">]=</span><span class="n">score</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">scores</span><span class="o">[</span><span class="n">i</span><span class="o">]&lt;</span><span class="n">scores</span><span class="o">[</span><span class="n">best</span><span class="o">]</span><span class="p">)</span>
<span class="w">                </span><span class="n">best</span><span class="o">=</span><span class="n">i</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">        </span><span class="n">debug</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span><span class="w"> </span><span class="n">best</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">scores</span><span class="o">[</span><span class="n">best</span><span class="o">]==</span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="o">//</span><span class="n">breed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">replace</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">POP</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="n">breed</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">POP</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="nf">VAR</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">                </span><span class="n">pop</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]=</span><span class="k">new</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">j</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="n">#ifdef</span><span class="w"> </span><span class="n">PRINT_RESULT</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="ss">"Terminated after %4i generations with a score of %3i\n"</span><span class="p">,</span><span class="w"> </span><span class="n">gen</span><span class="p">,</span><span class="w"> </span><span class="n">scores</span><span class="o">[</span><span class="n">best</span><span class="o">]</span><span class="p">);</span><span class="w"> </span>
<span class="n">#else</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="ss">"."</span><span class="p">);</span>
<span class="n">#endif</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">gen</span><span class="p">;</span>
<span class="err">}</span>

<span class="nc">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="err">{</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">total</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">RUNS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">total</span><span class="o">+=</span><span class="n">ga</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="ss">"\nAverage runtime: %i generations\n"</span><span class="p">,</span><span class="w"> </span><span class="n">total</span><span class="o">/</span><span class="n">RUNS</span><span class="p">);</span>
<span class="err">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/boosting-my-ga-with-neural-networks-and-or-reinforcement-learning/" class="u-url">Boosting my GA with Neural Networks and/or Reinforcement Learning</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/boosting-my-ga-with-neural-networks-and-or-reinforcement-learning/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T03:57:35+08:00" itemprop="datePublished" title="2023-02-28 03:57">2023-02-28 03:57</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>As I have mentioned in previous questions I am writing a maze solving
application to help me learn about more theoretical CS subjects, after some
trouble I've got a Genetic Algorithm working that can evolve a set of rules
(handled by boolean values) in order to find a good solution through a maze.</p>
<p>That being said, the GA alone is okay, but I'd like to beef it up with a
Neural Network, even though I have no real working knowledge of Neural
Networks (no formal theoretical CS education). After doing a bit of reading on
the subject I found that a Neural Network could be used to train a genome in
order to improve results. Let's say I have a genome (group of genes), such as</p>
<div class="code"><pre class="code literal-block"><span class="mf">1</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="mf">0...</span>
</pre></div>

<p>How could I use a Neural Network (I'm assuming MLP?) to train and improve my
genome?</p>
<p>In addition to this as I know nothing about Neural Networks I've been looking
into implementing some form of Reinforcement Learning, using my maze matrix (2
dimensional array), although I'm a bit stuck on what the following algorithm
wants from me:</p>
<p>(from
http://people.revoledu.com/kardi/tutorial/ReinforcementLearning/Q-Learning-
Algorithm.htm)</p>
<div class="code"><pre class="code literal-block"><span class="mf">1.</span><span class="w">  </span><span class="n">Set</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">reward</span><span class="w"> </span><span class="n">matrix</span><span class="w"> </span><span class="n">R</span>
<span class="w">   </span><span class="mf">2.</span><span class="w"> </span><span class="n">Initialize</span><span class="w"> </span><span class="n">matrix</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="n">matrix</span>
<span class="w">   </span><span class="mf">3.</span><span class="w"> </span><span class="kr">For</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">episode</span><span class="p">:</span>
<span class="w">          </span><span class="o">*</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">state</span>
<span class="w">          </span><span class="o">*</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="n">while</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">reach</span><span class="w"> </span><span class="kr">go</span><span class="n">al</span><span class="w"> </span><span class="n">state</span>
<span class="w">                </span><span class="n">o</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="kr">on</span><span class="n">e</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="nb">pos</span><span class="n">sible</span><span class="w"> </span><span class="n">actions</span><span class="w"> </span><span class="kr">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">state</span>
<span class="w">                </span><span class="n">o</span><span class="w"> </span><span class="n">Using</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="nb">pos</span><span class="n">sible</span><span class="w"> </span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">consider</span><span class="w"> </span><span class="kr">to</span><span class="w"> </span><span class="kr">go</span><span class="w"> </span><span class="kr">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">next</span><span class="w"> </span><span class="n">state</span>
<span class="w">                </span><span class="n">o</span><span class="w"> </span><span class="kr">Get</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">Q</span><span class="w"> </span><span class="nb">val</span><span class="n">ue</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="kr">next</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="kr">on</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="nb">pos</span><span class="n">sible</span><span class="w"> </span><span class="n">actions</span>
<span class="w">                </span><span class="n">o</span><span class="w"> </span><span class="n">Compute</span>
<span class="w">                </span><span class="n">o</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">next</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">state</span>

<span class="w">  </span><span class="kr">End</span><span class="w"> </span><span class="n">Do</span>

<span class="w">  </span><span class="kr">End</span><span class="w"> </span><span class="kr">For</span>
</pre></div>

<p>The big problem for me is implementing a reward matrix R and what a Q matrix
exactly is, and getting the Q value. I use a multi-dimensional array for my
maze and enum states for every move. How would this be used in a Q-Learning
algorithm?</p>
<p>If someone could help out by explaining what I would need to do to implement
the following, preferably in Java although C# would be nice too, possibly with
some source code examples it'd be appreciated.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>As noted in some comments, your question indeed involves a large set of
background knowledge and topics that hardly can be eloquently covered on
stackoverflow. However, what we can try here is suggest approaches to get
around your problem.</p>
<p>First of all: what does your GA do? I see a set of binary values; what are
they? I see them as either:</p>
<ul>
<li>
<strong>bad</strong> : a sequence of 'turn right' and 'turn left' instructions. Why is this bad? Because you're basically doing a random, brute-force attempt at solving your problem. You're not evolving a genotype: you're refining random guesses.</li>
<li>
<strong>better</strong> : every gene (location in the genome) represents a feature that will be expressed in the phenotype. There should not be a 1-to-1 mapping between genome and phenotype! </li>
</ul>
<p>Let me give you an example: in our brain there are 10^13ish neurons. But we
have only around 10^9 genes (yes, it's not an exact value, bear with me for a
second). What does this tell us? That our genotype does not encode <em>every</em>
neuron. Our genome encodes the proteins that will then go and make the
components of our body.</p>
<p>Hence, evolution works on the genotype directly by selecting <strong>features</strong> of
the phenotype. If I were to have 6 fingers on each hand and if that would made
me a better programmer, making me have more kids because I'm more successful
in life, well, my genotype would then be selected by evolution because it
contains the <strong>capability</strong> to give me a more fit body (yes, there is a pun
there, given the average geekiness-to-reproducibily ratio of most people
around here).</p>
<p>Now, think about your GA: what is that you are trying to accomplish? Are you
sure that evolving rules would help? In other words -- how would <strong>you</strong>
perform in a maze? What is the most successful thing that can help you: having
a different body, or having a memory of the right path to get out? Perhaps you
might want to reconsider your genotype and have it encode <em>memorization
abilities</em>. Maybe encode in the genotype how much data can be stored, and how
fast can your agents access it -- then measure fitness in terms of how fast
they get out of the maze. Another (weaker) approach could be to encode the
rules that your agent uses to decide where to go. The take-home message is,
encode features that, once expressed, can be selected by fitness.</p>
<hr>
<p>Now, to the neural network issue. One thing to remember is that NNs are
<strong>filters</strong>. They receive an input. perform operations on it, and return an
output. What is this output? Maybe you just need to discriminate a true/false
condition; for example, once you feed a maze map to a NN, it can tell you if
you can get out from the maze or not. How would you do such a thing? You will
need to <em>encode</em> the data properly.</p>
<p>This is the key point about NNs: your input data must be encoded properly.
Usually people normalize it, maybe scale it, perhaps you can apply a sigma
function to it to avoid values that are too large or too small; those are
details that deal with error measures and performance. What you need to
understand now is what a NN is, and what you cannot use it for.</p>
<p>To your problem now. You mentioned you want to use NNs as well: what about,</p>
<ul>
<li>using a neural network to guide the agent, and</li>
<li>using a genetic algorithm to evolve the neural network parameters?</li>
</ul>
<p>Rephrased like so:</p>
<ul>
<li>let's suppose you have a robot: your NN is controlling the left and right wheel, and as input it receives the distance of the next wall and how much it has traveled so far (it's just an example)</li>
<li>you start by generating a random genotype</li>
<li>make the genotype into a phenotype: the first gene is the network sensitivity; the second gene encodes the learning ratio; the third gene.. so on and so forth</li>
<li>now that you have a neural network, run the simulation</li>
<li>see how it performs</li>
<li>generate a second random genotype, evolve second NN</li>
<li>see how this second individual performs</li>
<li>get the best individual, then either mutate its genotype or recombinate it with the loser</li>
<li>repeat</li>
</ul>
<p>there is an <strong>excellent</strong> reading on the matter here: Inman Harvey Microbial
GA.</p>
<p>I hope I did you some insight on such issues. NNs and GA are no silver bullet
to solve all problems. In some they can do very much, in others they are just
the wrong tool. It's (still!) up to us to get the best one, and to do so we
must understand them well.</p>
<p>Have fun in it! It's great to know such things, makes everyday life a bit more
entertaining :)</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/implementing-a-pathfinding-in-a-2d-array/" class="u-url">Implementing A* pathfinding in a 2D array</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/implementing-a-pathfinding-in-a-2d-array/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T03:57:18+08:00" itemprop="datePublished" title="2023-02-28 03:57">2023-02-28 03:57</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm in the process of making a 2D tile map and i'm now trying to implement A<em>
pathfinding. I'm following the Wikipedia pseudocode for A</em>.</p>
<p>Things are going quite well except for some weird behaviour in the decisions
taken by the algorithm.</p>
<p>My code so far:</p>
<div class="code"><pre class="code literal-block"><span class="nv">void</span><span class="w"> </span><span class="nv">Pathfinding</span><span class="ss">(</span><span class="nv">Point</span><span class="w"> </span><span class="nv">from</span>,<span class="w"> </span><span class="nv">Point</span><span class="w"> </span><span class="nv">destination</span><span class="ss">)</span><span class="w"> </span>{

<span class="w">    </span><span class="nv">goalNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Node</span><span class="ss">(</span><span class="nv">destination</span>,<span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">startNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Node</span><span class="ss">(</span><span class="nv">from</span>,<span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="nv">ManhattanDistance</span><span class="ss">(</span><span class="nv">from</span>,<span class="w"> </span><span class="nv">destination</span><span class="ss">))</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">Node</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;            //list of nodes</span>
<span class="w">    </span><span class="nv">closed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">Node</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">open</span>.<span class="nv">Add</span><span class="ss">(</span><span class="nv">startNode</span><span class="ss">)</span><span class="c1">;                //Add starting point</span>

<span class="w">    </span><span class="k">while</span><span class="ss">(</span><span class="nv">open</span>.<span class="nv">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="w"> </span>{

<span class="w">        </span><span class="nv">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">getBestNode</span><span class="ss">()</span><span class="c1">;                   //Get node with lowest F value</span>
<span class="w">        </span><span class="k">if</span><span class="ss">(</span><span class="nv">node</span>.<span class="nv">position</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">goalNode</span>.<span class="nv">position</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">Debug</span>.<span class="nv">Log</span><span class="ss">(</span><span class="s2">"Goal reached"</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">            </span><span class="nv">getPath</span><span class="ss">(</span><span class="nv">node</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">            </span><span class="k">break</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">        </span><span class="nv">removeNode</span><span class="ss">(</span><span class="nv">node</span>,<span class="w"> </span><span class="nv">open</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span><span class="nv">closed</span>.<span class="nv">Add</span><span class="ss">(</span><span class="nv">node</span><span class="ss">)</span><span class="c1">;</span>

<span class="w">        </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">Node</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">neighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">getNeighbors</span><span class="ss">(</span><span class="nv">node</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span><span class="nv">foreach</span><span class="ss">(</span><span class="nv">Node</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">neighbors</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">float</span><span class="w"> </span><span class="nv">g_score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">node</span>.<span class="nv">G</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="c1">;</span>
<span class="w">            </span><span class="nv">float</span><span class="w"> </span><span class="nv">h_score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ManhattanDistance</span><span class="ss">(</span><span class="nv">n</span>.<span class="nv">position</span>,<span class="w"> </span><span class="nv">goalNode</span>.<span class="nv">position</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">            </span><span class="nv">float</span><span class="w"> </span><span class="nv">f_score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">g_score</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">h_score</span><span class="c1">;</span>

<span class="w">            </span><span class="k">if</span><span class="ss">(</span><span class="nv">isValueInList</span><span class="ss">(</span><span class="nv">n</span>,<span class="w"> </span><span class="nv">closed</span><span class="ss">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">f_score</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">n</span>.<span class="nv">F</span><span class="ss">)</span><span class="w"> </span>
<span class="w">                </span><span class="k">continue</span><span class="c1">;</span>

<span class="w">            </span><span class="k">if</span><span class="ss">(</span><span class="o">!</span><span class="nv">isValueInList</span><span class="ss">(</span><span class="nv">n</span>,<span class="w"> </span><span class="nv">open</span><span class="ss">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">f_score</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">n</span>.<span class="nv">F</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">                </span><span class="nv">n</span>.<span class="nv">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">node</span><span class="c1">;</span>
<span class="w">                </span><span class="nv">n</span>.<span class="nv">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">g_score</span><span class="c1">;</span>
<span class="w">                </span><span class="nv">n</span>.<span class="nv">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">h_score</span><span class="c1">;</span>
<span class="w">                </span><span class="k">if</span><span class="ss">(</span><span class="o">!</span><span class="nv">isValueInList</span><span class="ss">(</span><span class="nv">n</span>,<span class="w"> </span><span class="nv">open</span><span class="ss">))</span><span class="w"> </span>{
<span class="w">                    </span><span class="nv">map_data</span>[<span class="nv">n</span>.<span class="nv">position</span>.<span class="nv">x</span>,<span class="w"> </span><span class="nv">n</span>.<span class="nv">position</span>.<span class="nv">y</span>]<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="c1">;</span>
<span class="w">                    </span><span class="nv">open</span>.<span class="nv">Add</span><span class="ss">(</span><span class="nv">n</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">                </span>}
<span class="w">            </span>}
<span class="w">        </span>}
<span class="w">    </span>}
}
</pre></div>

<p>The result of running this code:</p>
<p><img alt="" src="images/Ymz98.png"></p>
<p>Blue is the nodes from the open list and green is the path chosen to the goal
node.</p>
<p><strong>SOLUTION:</strong></p>
<div class="code"><pre class="code literal-block"><span class="nv">void</span><span class="w"> </span><span class="nv">Pathfinding</span><span class="ss">(</span><span class="nv">Point</span><span class="w"> </span><span class="nv">from</span>,<span class="w"> </span><span class="nv">Point</span><span class="w"> </span><span class="nv">destination</span><span class="ss">)</span><span class="w"> </span>{

<span class="w">    </span><span class="nv">goalNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Node</span><span class="ss">(</span><span class="nv">destination</span>,<span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">startNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Node</span><span class="ss">(</span><span class="nv">from</span>,<span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="nv">ManhattanDistance</span><span class="ss">(</span><span class="nv">from</span>,<span class="w"> </span><span class="nv">destination</span><span class="ss">))</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">open</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">Node</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;            //list of nodes</span>
<span class="w">    </span><span class="nv">closed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">Node</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">open</span>.<span class="nv">Add</span><span class="ss">(</span><span class="nv">startNode</span><span class="ss">)</span><span class="c1">;                //Add starting point</span>

<span class="w">    </span><span class="k">while</span><span class="ss">(</span><span class="nv">open</span>.<span class="nv">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="w"> </span>{

<span class="w">        </span><span class="nv">node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">getBestNode</span><span class="ss">()</span><span class="c1">;                   //Get node with lowest F value</span>
<span class="w">        </span><span class="k">if</span><span class="ss">(</span><span class="nv">node</span>.<span class="nv">position</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">goalNode</span>.<span class="nv">position</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">Debug</span>.<span class="nv">Log</span><span class="ss">(</span><span class="s2">"Goal reached"</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">            </span><span class="nv">getPath</span><span class="ss">(</span><span class="nv">node</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">            </span><span class="k">break</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">        </span><span class="nv">removeNode</span><span class="ss">(</span><span class="nv">node</span>,<span class="w"> </span><span class="nv">open</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span><span class="nv">closed</span>.<span class="nv">Add</span><span class="ss">(</span><span class="nv">node</span><span class="ss">)</span><span class="c1">;</span>

<span class="w">        </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">Node</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">neighbors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">getNeighbors</span><span class="ss">(</span><span class="nv">node</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span><span class="nv">foreach</span><span class="ss">(</span><span class="nv">Node</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">neighbors</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">float</span><span class="w"> </span><span class="nv">g_score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">node</span>.<span class="nv">G</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="c1">;</span>
<span class="w">            </span><span class="nv">float</span><span class="w"> </span><span class="nv">h_score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ManhattanDistance</span><span class="ss">(</span><span class="nv">n</span>.<span class="nv">position</span>,<span class="w"> </span><span class="nv">goalNode</span>.<span class="nv">position</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">            </span><span class="nv">float</span><span class="w"> </span><span class="nv">f_score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">g_score</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">h_score</span><span class="c1">;</span>

<span class="w">            </span><span class="k">if</span><span class="ss">(</span><span class="nv">isValueInList</span><span class="ss">(</span><span class="nv">n</span>,<span class="w"> </span><span class="nv">closed</span><span class="ss">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">f_score</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">n</span>.<span class="nv">F</span><span class="ss">)</span><span class="w"> </span>
<span class="w">                </span><span class="k">continue</span><span class="c1">;</span>

<span class="w">            </span><span class="k">if</span><span class="ss">(</span><span class="o">!</span><span class="nv">isValueInList</span><span class="ss">(</span><span class="nv">n</span>,<span class="w"> </span><span class="nv">open</span><span class="ss">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">f_score</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">n</span>.<span class="nv">F</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">                </span><span class="nv">n</span>.<span class="nv">parent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">node</span><span class="c1">;</span>
<span class="w">                </span><span class="nv">n</span>.<span class="nv">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">g_score</span><span class="c1">;</span>
<span class="w">                </span><span class="nv">n</span>.<span class="nv">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">h_score</span><span class="c1">;</span>
<span class="w">                </span><span class="k">if</span><span class="ss">(</span><span class="o">!</span><span class="nv">isValueInList</span><span class="ss">(</span><span class="nv">n</span>,<span class="w"> </span><span class="nv">open</span><span class="ss">))</span><span class="w"> </span>{
<span class="w">                    </span><span class="nv">map_data</span>[<span class="nv">n</span>.<span class="nv">position</span>.<span class="nv">x</span>,<span class="w"> </span><span class="nv">n</span>.<span class="nv">position</span>.<span class="nv">y</span>]<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="c1">;</span>
<span class="w">                    </span><span class="nv">open</span>.<span class="nv">Add</span><span class="ss">(</span><span class="nv">n</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">                </span>}
<span class="w">            </span>}
<span class="w">        </span>}
<span class="w">    </span>}
}
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>First, your open Nodes should be <strong>sorted</strong> in descending order, while in your
code - there is no ordering. You compute the distance (g) and the heuristics
(h) but never actually use it. You should consider using <strong>ordered container</strong>
instead of lists (as sorting lists in each iteration won't be efficient)</p>
<p>Second, you do not store the heuristic value in the node as</p>
<div class="code"><pre class="code literal-block">n.G = h_score;
</pre></div>

<p>should be</p>
<div class="code"><pre class="code literal-block">n.H = h_score;
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1444.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1442.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
