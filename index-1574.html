<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1574) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1574.html">
<link rel="prev" href="index-1575.html" type="text/html">
<link rel="next" href="index-1573.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-purpose-of-a-self-executing-function-in-javascript/" class="u-url">What is the purpose of a self executing function in javascript?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-purpose-of-a-self-executing-function-in-javascript/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T04:16:05+08:00" itemprop="datePublished" title="2023-03-03 04:16">2023-03-03 04:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In javascript, when would you want to use this:</p>
<div class="code"><pre class="code literal-block">(function(){
    //Bunch of code...
})();
</pre></div>

<p>over this:</p>
<div class="code"><pre class="code literal-block"><span class="c1">//Bunch of code...</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>It's all about variable scoping. Variables declared in the self executing
function are, by default, only available to code within the self executing
function. This allows code to be written without concern of how variables are
named in other blocks of JavaScript code.</p>
<p>For example, as mentioned in a comment by Alexander:</p>
<div class="code"><pre class="code literal-block"><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span>
<span class="p">})();</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span>
</pre></div>

<p>This will first log <code>3</code> and then throw an error on the next <code>console.log</code>
because <code>foo</code> is not defined.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Simplistic. So very normal looking, its almost comforting:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">userName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Sean"</span><span class="p">;</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">name</span><span class="p">());</span>

<span class="n">function</span><span class="w"> </span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">userName</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>However, what if I include a really handy javascript library to my page that
translates advanced characters into their base level representations?</p>
<p>Wait... what?</p>
<p>I mean, if someone types in a character with some kind of accent on it, but I
only want 'English' characters A-Z in my program? Well... the Spanish 'ñ' and
French 'é' characters can be translated into base characters of 'n' and 'e'.</p>
<p>So someone nice person has written a comprehensive character converter out
there that I can include in my site... I include it.</p>
<p>One problem: it has a function in it called 'name' same as my function.</p>
<p>This is what's called a collision. We've got two functions declared in the
same <em>scope</em> with the same name. We want to avoid this.</p>
<p>So we need to scope our code somehow.</p>
<p>The only way to scope code in javascript is to wrap it in a function:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">own</span><span class="w"> </span><span class="n">sound</span><span class="o">-</span><span class="n">proofed</span><span class="w"> </span><span class="n">room</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">character</span><span class="o">-</span><span class="n">converter</span><span class="w"> </span><span class="n">library</span><span class="s1">'s name() function can exist at the </span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ours</span><span class="o">.</span>

<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">userName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Sean"</span><span class="p">;</span>

<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">name</span><span class="p">());</span>

<span class="w">  </span><span class="n">function</span><span class="w"> </span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">userName</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>That might solve our problem. Everything is now enclosed and can only be
accessed from within our opening and closing braces.</p>
<p>We have a function in a function... which is weird to look at, but totally
legal.</p>
<p>Only one problem. Our code doesn't work. Our <code>userName</code> variable is never
echoed into the console!</p>
<p>We can solve this issue by adding a call to our function after our existing
code block...</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">own</span><span class="w"> </span><span class="n">sound</span><span class="o">-</span><span class="n">proofed</span><span class="w"> </span><span class="n">room</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">character</span><span class="o">-</span><span class="n">converter</span><span class="w"> </span><span class="n">libarary</span><span class="s1">'s name() function can exist at the </span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ours</span><span class="o">.</span>

<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">userName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Sean"</span><span class="p">;</span>

<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">name</span><span class="p">());</span>

<span class="w">  </span><span class="n">function</span><span class="w"> </span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">userName</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">main</span><span class="p">();</span>
</pre></div>

<p>Or before!</p>
<div class="code"><pre class="code literal-block"><span class="n">main</span><span class="p">();</span>

<span class="n">function</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">own</span><span class="w"> </span><span class="n">sound</span><span class="o">-</span><span class="n">proofed</span><span class="w"> </span><span class="n">room</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">character</span><span class="o">-</span><span class="n">converter</span><span class="w"> </span><span class="n">libarary</span><span class="s1">'s name() function can exist at the </span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ours</span><span class="o">.</span>

<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">userName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Sean"</span><span class="p">;</span>

<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">name</span><span class="p">());</span>

<span class="w">  </span><span class="n">function</span><span class="w"> </span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">userName</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>A secondary concern: What are the chances that the name 'main' hasn't been
used yet? ...so very, very slim.</p>
<p>We need MORE scoping. And some way to automatically execute our main()
function.</p>
<p>Now we come to auto-execution functions (or self-executing, self-running,
whatever).</p>
<div class="code"><pre class="code literal-block">((){})();
</pre></div>

<p>The syntax is awkward as sin. However, it works.</p>
<p>When you wrap a function definition in parentheses, and include a parameter
list (another set or parentheses!) it acts as a function <em>call</em>.</p>
<p>So lets look at our code again, with some self-executing syntax:</p>
<div class="code"><pre class="code literal-block"><span class="p">(</span><span class="n">function</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">userName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Sean"</span><span class="p">;</span>

<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">name</span><span class="p">());</span>

<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">userName</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">)();</span>
</pre></div>

<p>So, in most tutorials you read, you will now be bombarded with the term
'anonymous self-executing' or something similar.</p>
<p>After many years of professional development, I <em>strongly</em> urge you to name
<em>every function you write</em> for debugging purposes.</p>
<p>When something goes wrong (and it will), you will be checking the backtrace in
your browser. It is <em>always</em> easier to narrow your code issues when the
entries in the stack trace have names!</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-create-implicitly-unwrapped-optionals-since-that-implies-you-know-there-s-a-value/" class="u-url">Why create "Implicitly Unwrapped Optionals", since that implies you know there's a value?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-create-implicitly-unwrapped-optionals-since-that-implies-you-know-there-s-a-value/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T04:15:39+08:00" itemprop="datePublished" title="2023-03-03 04:15">2023-03-03 04:15</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Why would you create a "Implicitly Unwrapped Optional" vs creating just a
regular variable or constant? If you know that it can be successfully
unwrapped then why create an optional in the first place? For example, why is
this:</p>
<div class="code"><pre class="code literal-block">let someString: String! = "this is the string"
</pre></div>

<p>going to be more useful than:</p>
<div class="code"><pre class="code literal-block">let someString: String = "this is the string"
</pre></div>

<p>If ”optionals indicate that a constant or variable is allowed to have 'no
value'”, but “sometimes it is clear from a program’s structure that an
optional will always have a value after that value is first set”, what is the
point of making it an optional in the first place? If you know an optional is
always going to have a value, doesn't that make it not optional?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Consider the case of an object that may have nil properties while it's being
constructed and configured, but is immutable and non-nil afterwards (NSImage
is often treated this way, though in its case it's still useful to mutate
sometimes). Implicitly unwrapped optionals would clean up its code a good
deal, with relatively low loss of safety (as long as the one guarantee held,
it would be safe).</p>
<p>(Edit) To be clear though: regular optionals are nearly always preferable.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Consider the case of an object that may have nil properties while it's being
constructed and configured, but is immutable and non-nil afterwards (NSImage
is often treated this way, though in its case it's still useful to mutate
sometimes). Implicitly unwrapped optionals would clean up its code a good
deal, with relatively low loss of safety (as long as the one guarantee held,
it would be safe).</p>
<p>(Edit) To be clear though: regular optionals are nearly always preferable.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/nullpointerexception-in-collectors-tomap-with-null-entry-values/" class="u-url">NullPointerException in Collectors.toMap with null entry values</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/nullpointerexception-in-collectors-tomap-with-null-entry-values/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T04:15:15+08:00" itemprop="datePublished" title="2023-03-03 04:15">2023-03-03 04:15</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><code>Collectors.toMap</code> throws a <code>NullPointerException</code> if one of the values is
<code>null</code>. I don't understand this behaviour, maps can contain null pointers as
value without any problems. Is there a good reason why values cannot be null
for <code>Collectors.toMap</code>?</p>
<p>Also, is there a nice Java 8 way of fixing this, or should I revert to plain
old for loop?</p>
<p>An example of my problem:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="p">;</span>


<span class="k">class</span> <span class="nc">Answer</span> <span class="p">{</span>
    <span class="n">private</span> <span class="nb">int</span> <span class="nb">id</span><span class="p">;</span>

    <span class="n">private</span> <span class="n">Boolean</span> <span class="n">answer</span><span class="p">;</span>

    <span class="n">Answer</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="n">Answer</span><span class="p">(</span><span class="nb">int</span> <span class="nb">id</span><span class="p">,</span> <span class="n">Boolean</span> <span class="n">answer</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
        <span class="n">this</span><span class="o">.</span><span class="n">answer</span> <span class="o">=</span> <span class="n">answer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="nb">int</span> <span class="n">getId</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">setId</span><span class="p">(</span><span class="nb">int</span> <span class="nb">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">Boolean</span> <span class="n">getAnswer</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">answer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">setAnswer</span><span class="p">(</span><span class="n">Boolean</span> <span class="n">answer</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">answer</span> <span class="o">=</span> <span class="n">answer</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">Main</span> <span class="p">{</span>
    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Answer</span><span class="o">&gt;</span> <span class="n">answerList</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

        <span class="n">answerList</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new</span> <span class="n">Answer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">true</span><span class="p">));</span>
        <span class="n">answerList</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new</span> <span class="n">Answer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">true</span><span class="p">));</span>
        <span class="n">answerList</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new</span> <span class="n">Answer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">null</span><span class="p">));</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span> <span class="n">Boolean</span><span class="o">&gt;</span> <span class="n">answerMap</span> <span class="o">=</span>
        <span class="n">answerList</span>
                <span class="o">.</span><span class="n">stream</span><span class="p">()</span>
                <span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="o">.</span><span class="n">toMap</span><span class="p">(</span><span class="n">Answer</span><span class="p">::</span><span class="n">getId</span><span class="p">,</span> <span class="n">Answer</span><span class="p">::</span><span class="n">getAnswer</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Stacktrace:</p>
<div class="code"><pre class="code literal-block">Exception in thread "main" java.lang.NullPointerException
    at java.util.HashMap.merge(HashMap.java:1216)
    at java.util.stream.Collectors.lambda$toMap$168(Collectors.java:1320)
    at java.util.stream.Collectors$$Lambda$5/1528902577.accept(Unknown Source)
    at java.util.stream.ReduceOps$3ReducingSink.accept(ReduceOps.java:169)
    at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1359)
    at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:512)
    at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:502)
    at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
    at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
    at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)
    at Main.main(Main.java:48)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:483)
    at com.intellij.rt.execution.application.AppMain.main(AppMain.java:134)
</pre></div>

<p>This problem still exists in Java 11.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can work around this known bug in OpenJDK with this:</p>
<div class="code"><pre class="code literal-block"><span class="nt">Map</span><span class="o">&lt;</span><span class="nt">Integer</span><span class="o">,</span><span class="w"> </span><span class="nt">Boolean</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">collect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">list</span><span class="p">.</span><span class="nc">stream</span><span class="o">()</span>
<span class="w">        </span><span class="p">.</span><span class="nc">collect</span><span class="o">(</span><span class="nt">HashMap</span><span class="p">::</span><span class="nd">new</span><span class="o">,</span><span class="w"> </span><span class="o">(</span><span class="nt">m</span><span class="o">,</span><span class="nt">v</span><span class="o">)</span><span class="nt">-</span><span class="o">&gt;</span><span class="nt">m</span><span class="p">.</span><span class="nc">put</span><span class="o">(</span><span class="nt">v</span><span class="p">.</span><span class="nc">getId</span><span class="o">(),</span><span class="w"> </span><span class="nt">v</span><span class="p">.</span><span class="nc">getAnswer</span><span class="o">()),</span><span class="w"> </span><span class="nt">HashMap</span><span class="p">::</span><span class="nd">putAll</span><span class="o">);</span>
</pre></div>

<p>It is not that much pretty, but it works. Result:</p>
<div class="code"><pre class="code literal-block"><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="mi">3</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span>
</pre></div>

<p>(this tutorial helped me the most.)</p>
<p><strong>EDIT:</strong></p>
<p>Unlike <code>Collectors.toMap</code>, this will silently replace values if you have the
same key multiple times, as @mmdemirbas pointed out in the comments. If you
don't want this, look at the link in the comment.</p>
<p><br></p>
<h3>Suggest</h3>
<p>It is not possible with the static methods of <code>Collectors</code>. The javadoc of
<code>toMap</code> explains that <code>toMap</code> is based on <code>Map.merge</code>:</p>
<blockquote>
<p>@param mergeFunction a merge function, used to resolve collisions between
values associated with the same key, as supplied to <code>Map#merge(Object,
Object, BiFunction)}</code></p>
</blockquote>
<p>and the javadoc of <code>Map.merge</code> says:</p>
<blockquote>
<p>@throws NullPointerException if the specified key is null and this map does
not support null keys or <strong>the value</strong> or remappingFunction <strong>is</strong> <strong>null</strong></p>
</blockquote>
<p>You can avoid the for loop by using the <code>forEach</code> method of your list.</p>
<div class="code"><pre class="code literal-block"><span class="nf">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span><span class="w">  </span><span class="n">Boolean</span><span class="o">&gt;</span><span class="w"> </span><span class="n">answerMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="n">answerList</span><span class="p">.</span><span class="n">forEach</span><span class="p">((</span><span class="n">answer</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">answerMap</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">answer</span><span class="p">.</span><span class="n">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">answer</span><span class="p">.</span><span class="n">getAnswer</span><span class="p">()));</span>
</pre></div>

<p>but it is not really simple than the old way:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Map</span><span class="o">&lt;</span><span class="nv">Integer</span>,<span class="w"> </span><span class="nv">Boolean</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">answerMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">HashMap</span><span class="o">&lt;&gt;</span><span class="ss">()</span><span class="c1">;</span>
<span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">Answer</span><span class="w"> </span><span class="nv">answer</span><span class="w"> </span>:<span class="w"> </span><span class="nv">answerList</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">answerMap</span>.<span class="nv">put</span><span class="ss">(</span><span class="nv">answer</span>.<span class="nv">getId</span><span class="ss">()</span>,<span class="w"> </span><span class="nv">answer</span>.<span class="nv">getAnswer</span><span class="ss">())</span><span class="c1">;</span>
}
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1575.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1573.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
