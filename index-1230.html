<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1230) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1230.html">
<link rel="prev" href="index-1231.html" type="text/html">
<link rel="next" href="index-1229.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-size-a-uitextview-to-its-content/" class="u-url">How do I size a UITextView to its content?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-size-a-uitextview-to-its-content/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:23:26+08:00" itemprop="datePublished" title="2023-02-18 04:23">2023-02-18 04:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Is there a good way to adjust the size of a <code>UITextView</code> to conform to its
content? Say for instance I have a <code>UITextView</code> that contains one line of
text:</p>
<div class="code"><pre class="code literal-block">"Hello world"
</pre></div>

<p>I then add another line of text:</p>
<div class="code"><pre class="code literal-block">"Goodbye world"
</pre></div>

<p>Is there a good way in Cocoa Touch to get the <code>rect</code> that will hold all of the
lines in the text view so that I can adjust the parent view accordingly?</p>
<p>As another example, look at the notes' field for events in the Calendar
application - note how the cell (and the <code>UITextView</code> it contains) expands to
hold all lines of text in the notes' string.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This works for both iOS 6.1 and iOS 7:</p>
<div class="code"><pre class="code literal-block"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">textViewDidChange:</span><span class="p">(</span><span class="bp">UITextView</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">textView</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">CGFloat</span><span class="w"> </span><span class="n">fixedWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
<span class="w">    </span><span class="n">CGSize</span><span class="w"> </span><span class="n">newSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">textView</span><span class="w"> </span><span class="n">sizeThatFits</span><span class="o">:</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="n">fixedWidth</span><span class="p">,</span><span class="w"> </span><span class="n">MAXFLOAT</span><span class="p">)];</span>
<span class="w">    </span><span class="n">CGRect</span><span class="w"> </span><span class="n">newFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textView</span><span class="p">.</span><span class="n">frame</span><span class="p">;</span>
<span class="w">    </span><span class="n">newFrame</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGSizeMake</span><span class="p">(</span><span class="n">fmaxf</span><span class="p">(</span><span class="n">newSize</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">fixedWidth</span><span class="p">),</span><span class="w"> </span><span class="n">newSize</span><span class="p">.</span><span class="n">height</span><span class="p">);</span>
<span class="w">    </span><span class="n">textView</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newFrame</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Or in Swift (Works with Swift 4.1 in iOS 11)</p>
<div class="code"><pre class="code literal-block">let fixedWidth = textView.frame.size.width
let newSize = textView.sizeThatFits(CGSize(width: fixedWidth, height: CGFloat.greatestFiniteMagnitude))
textView.frame.size = CGSize(width: max(newSize.width, fixedWidth), height: newSize.height)
</pre></div>

<p>If you want support for iOS 6.1 then you should also:</p>
<div class="code"><pre class="code literal-block">textview.scrollEnabled = NO;
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<h3>This no longer works on iOS 7 or above</h3>
<p>There is actually a very easy way to do resizing of the <code>UITextView</code> to its
correct height of the content. It can be done using the <code>UITextView</code>
<code>contentSize</code>.</p>
<div class="code"><pre class="code literal-block">CGRect frame = _textView.frame;
frame.size.height = _textView.contentSize.height;
_textView.frame = frame;
</pre></div>

<p>One thing to note is that the correct <code>contentSize</code> is only available
<strong>after</strong> the <code>UITextView</code> has been added to the view with <code>addSubview</code>. Prior
to that it is equal to <code>frame.size</code></p>
<p>This will not work if auto layout is ON. With auto layout, the general
approach is to use the <code>sizeThatFits</code> method and update the <code>constant</code> value
on a height constraint.</p>
<div class="code"><pre class="code literal-block"><span class="n">CGSize</span><span class="w"> </span><span class="n">sizeThatShouldFitTheContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">_textView</span><span class="w"> </span><span class="n">sizeThatFits</span><span class="o">:</span><span class="n">_textView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">];</span>
<span class="n">heightConstraint</span><span class="p">.</span><span class="n">constant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sizeThatShouldFitTheContent</span><span class="p">.</span><span class="n">height</span><span class="p">;</span>
</pre></div>

<p><code>heightConstraint</code> is a layout constraint that you typically setup via a
IBOutlet by linking the property to the height constraint created in a
storyboard.</p>
<hr>
<p>Just to add to this amazing answer, 2014, if you:</p>
<div class="code"><pre class="code literal-block">[self.textView sizeToFit];
</pre></div>

<p>there is a difference in behaviour with the <strong>iPhone6+</strong> only:</p>
<p><img alt="enter image description here" src="images/GCC09.png"></p>
<p>With the 6+ only (not the 5s or 6) it does add "one more blank line" to the
UITextView. The "RL solution" fixes this perfectly:</p>
<div class="code"><pre class="code literal-block">CGRect _f = self.mainPostText.frame;
_f.size.height = self.mainPostText.contentSize.height;
self.mainPostText.frame = _f;
</pre></div>

<p>It fixes the "extra line" problem on 6+.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jsondecodeerror-expecting-value-line-1-column-1-char-0/" class="u-url">JSONDecodeError: Expecting value: line 1 column 1 (char 0)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/jsondecodeerror-expecting-value-line-1-column-1-char-0/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:22:53+08:00" itemprop="datePublished" title="2023-02-18 04:22">2023-02-18 04:22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am getting error <code>Expecting value: line 1 column 1 (char 0)</code> when trying to
decode JSON.</p>
<p>The URL I use for the API call works fine in the browser, but gives this error
when done through a curl request. The following is the code I use for the curl
request.</p>
<p>The error happens at <code>return simplejson.loads(response_json)</code></p>
<div class="code"><pre class="code literal-block"><span class="n">response_json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">web_fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">response_json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response_json</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
<span class="k">return</span><span class="w"> </span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response_json</span><span class="p">)</span>


<span class="n">def</span><span class="w"> </span><span class="n">web_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringIO</span><span class="p">()</span>
<span class="w">    </span><span class="n">curl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
<span class="w">    </span><span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">curl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">)</span>
<span class="w">    </span><span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">curl</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
<span class="w">    </span><span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">curl</span><span class="o">.</span><span class="n">WRITEFUNCTION</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
<span class="w">    </span><span class="n">curl</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
<span class="w">    </span><span class="n">curl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="w">    </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">response</span>
</pre></div>

<p>Traceback:</p>
<div class="code"><pre class="code literal-block"><span class="n">File</span><span class="w"> </span><span class="s2">"/Users/nab/Desktop/myenv2/lib/python2.7/site-packages/django/core/handlers/base.py"</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">get_response</span>
<span class="w">  </span><span class="mf">111.</span><span class="w">                         </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">callback</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">callback_args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">callback_kwargs</span><span class="p">)</span>
<span class="n">File</span><span class="w"> </span><span class="s2">"/Users/nab/Desktop/pricestore/pricemodels/views.py"</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">view_category</span>
<span class="w">  </span><span class="mf">620.</span><span class="w">     </span><span class="n">apicall</span><span class="o">=</span><span class="n">api</span><span class="o">.</span><span class="n">API</span><span class="p">()</span><span class="o">.</span><span class="n">search_parts</span><span class="p">(</span><span class="n">category_id</span><span class="o">=</span><span class="w"> </span><span class="nb">str</span><span class="p">(</span><span class="n">categoryofpart</span><span class="o">.</span><span class="n">api_id</span><span class="p">),</span><span class="w"> </span><span class="n">manufacturer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">manufacturer</span><span class="p">,</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filters</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="n">catpage</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="n">sort_by</span><span class="o">=</span><span class="s1">'[["mpn","asc"]]'</span><span class="p">)</span>
<span class="n">File</span><span class="w"> </span><span class="s2">"/Users/nab/Desktop/pricestore/pricemodels/api.py"</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">search_parts</span>
<span class="w">  </span><span class="mf">176.</span><span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="n">simplejson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response_json</span><span class="p">)</span>
<span class="n">File</span><span class="w"> </span><span class="s2">"/Users/nab/Desktop/myenv2/lib/python2.7/site-packages/simplejson/__init__.py"</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">loads</span>
<span class="w">  </span><span class="mf">455.</span><span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="n">_default_decoder</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">File</span><span class="w"> </span><span class="s2">"/Users/nab/Desktop/myenv2/lib/python2.7/site-packages/simplejson/decoder.py"</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">decode</span>
<span class="w">  </span><span class="mf">374.</span><span class="w">         </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">raw_decode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">File</span><span class="w"> </span><span class="s2">"/Users/nab/Desktop/myenv2/lib/python2.7/site-packages/simplejson/decoder.py"</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">raw_decode</span>
<span class="w">  </span><span class="mf">393.</span><span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">scan_once</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">idx</span><span class="o">=</span><span class="n">_w</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">end</span><span class="p">())</span>

<span class="n">Exception</span><span class="w"> </span><span class="n">Type</span><span class="p">:</span><span class="w"> </span><span class="n">JSONDecodeError</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">pricemodels</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">dir</span><span class="o">/</span>
<span class="n">Exception</span><span class="w"> </span><span class="n">Value</span><span class="p">:</span><span class="w"> </span><span class="n">Expecting</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">column</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nb">char</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>Your code produced an empty response body, you'd want to check for that or
catch the exception raised. It is possible the server responded with a 204 No
Content response, or a non-200-range status code was returned (404 Not Found,
etc.). Check for this.</p>
<p>Note:</p>
<ul>
<li>
<p>There is no need to use <code>simplejson</code> library, the same library is included with Python as the <code>json</code> module.</p>
</li>
<li>
<p>There is no need to decode a response from UTF8 to unicode, the <code>simplejson</code> / <code>json</code> <code>.loads()</code> method can handle UTF8 encoded data natively.</p>
</li>
<li>
<p><code>pycurl</code> has a very archaic API. Unless you have a specific requirement for using it, there are better choices.</p>
</li>
</ul>
<p>Either the <code>requests</code> or <code>httpx</code> offers much friendlier APIs, including JSON
support. If you can, replace your call with:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># raises exception when not a 2xx response</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">204</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>

<p>Of course, this won't protect you from a URL that doesn't comply with HTTP
standards; when using arbirary URLs where this is a possibility, check if the
server intended to give you JSON by checking the Content-Type header, and for
good measure catch the exception:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="ss">(</span>
<span class="w">    </span><span class="nv">response</span>.<span class="nv">status_code</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">204</span><span class="w"> </span><span class="nv">and</span>
<span class="w">    </span><span class="nv">response</span>.<span class="nv">headers</span>[<span class="s2">"content-type"</span>].<span class="nv">strip</span><span class="ss">()</span>.<span class="nv">startswith</span><span class="ss">(</span><span class="s2">"application/json"</span><span class="ss">)</span>
<span class="ss">)</span>:
<span class="w">    </span><span class="nv">try</span>:
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">response</span>.<span class="nv">json</span><span class="ss">()</span>
<span class="w">    </span><span class="nv">except</span><span class="w"> </span><span class="nv">ValueError</span>:
<span class="w">        </span>#<span class="w"> </span><span class="nv">decide</span><span class="w"> </span><span class="nv">how</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">handle</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">server</span><span class="w"> </span><span class="nv">that</span><span class="err">'s misbehaving to this extent</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Be sure to remember to invoke <code>json.loads()</code> on the <em>contents</em> of the file, as
opposed to the <em>file path</em> of that JSON:</p>
<div class="code"><pre class="code literal-block"><span class="n">json_file_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/path/to/example.json"</span>

<span class="n">with</span><span class="w"> </span><span class="n">open</span><span class="p">(</span><span class="n">json_file_path</span><span class="p">,</span><span class="w"> </span><span class="s1">'r'</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">j</span><span class="p">:</span>
<span class="w">     </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>

<p>I think a lot of people are guilty of doing this every once in a while (myself
included):</p>
<div class="code"><pre class="code literal-block"><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file_path</span><span class="p">)</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-does-java-s-hashcode-in-string-use-31-as-a-multiplier/" class="u-url">Why does Java's hashCode() in String use 31 as a multiplier?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-does-java-s-hashcode-in-string-use-31-as-a-multiplier/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:22:29+08:00" itemprop="datePublished" title="2023-02-18 04:22">2023-02-18 04:22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Per the Java documentation, the hash code for a <code>String</code> object is computed
as:</p>
<blockquote>
<div class="code"><pre class="code literal-block">s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]
</pre></div>

<p>using <code>int</code> arithmetic, where <code>s[i]</code> is the <em>i</em> th character of the string,
<code>n</code> is the length of the string, and <code>^</code> indicates exponentiation.</p>
</blockquote>
<p>Why is 31 used as a multiplier?</p>
<p>I understand that the multiplier should be a relatively large prime number. So
why not 29, or 37, or even 97?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>According to Joshua Bloch's Effective Java (a book that can't be recommended
enough, and which I bought thanks to continual mentions on stackoverflow):</p>
<blockquote>
<p>The value 31 was chosen because it is an odd prime. If it were even and the
multiplication overflowed, information would be lost, as multiplication by 2
is equivalent to shifting. The advantage of using a prime is less clear, but
it is traditional. A nice property of 31 is that the multiplication can be
replaced by a shift and a subtraction for better performance: <code>31 * i == (i
&lt;&lt; 5) - i</code>. Modern VMs do this sort of optimization automatically.</p>
</blockquote>
<p><em>(from Chapter 3, Item 9: Always override hashcode when you override equals,
page 48)</em></p>
<p><br></p>
<h3>Suggest</h3>
<p>Goodrich and Tamassia computed from over 50,000 English words (formed as the
union of the word lists provided in two variants of Unix) that using the
constants 31, 33, 37, 39, and 41 will produce fewer than 7 collisions in each
case. This may be the reason that so many Java implementations choose such
constants.</p>
<p>See section 9.2 Hash Tables (page 522) of Data Structures and Algorithms in
Java.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1231.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1229.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
