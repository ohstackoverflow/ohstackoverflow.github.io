<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2468) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2468.html">
<link rel="prev" href="index-2469.html" type="text/html">
<link rel="next" href="index-2467.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/fb-opengraph-og-image-not-pulling-images-possibly-https/" class="u-url">FB OpenGraph og:image not pulling images (possibly https?)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/fb-opengraph-og-image-not-pulling-images-possibly-https/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T18:19:02+08:00" itemprop="datePublished" title="2023-03-04 18:19">2023-03-04 18:19</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Facebook cannot grasp my <code>og:image</code> files and I have tried every usual
solution. I'm beginning to think it might have something to do with
<code>https://...</code></p>
<ul>
<li>I have checked http://developers.facebook.com/tools/debug and have zero warnings or errors.</li>
<li>It is finding the images we linked to in the "<code>og:image</code>", but they're showing up blank. When we click the image(s), however, they DO exist and it takes is straight to them.</li>
<li>It DOES show one image -- an image hosted on a non-https server.</li>
<li>We've tried square images, jpegs, pngs, larger sizes and smaller sizes. We've put the images right in public_html. Zero are showing up.</li>
<li>It's not a caching error, because when we add another <code>og:image</code> to the meta, FB's linter does find and read that. It DOES show a preview. The preview is blank. The <strong>only</strong> exception we're getting is for images that are not on this website.</li>
<li>We thought maybe there was some anti-leach on <code>cpanel</code> or the <code>.htaccess</code> that was preventing the images from showing up, so we checked. There was not. We even did a quick <code>&lt; img src="[remote file]" &gt;</code> on an entirely different server and the image shows up fine.</li>
<li>We thought maybe it was the <code>og:type</code> or another oddity with another meta tag. We removed all of them, one at a time and checked it. No change. Just warnings.</li>
<li>The same code on a different website shows up without any issue.</li>
<li>We thought <em>maybe</em> it was not pulling images because we're using the same product page(s) for multiple products (changing it based on the get value, ie, "details.php?id=xxx") but it's still pulling in one image (from a different url).</li>
<li>Leaving any <code>og:image</code> or image_src off, FB does not find any images.</li>
</ul>
<p>I am at the end of my rope. If I said how much time myself and others have
spent on this, you'd be shocked. The issue is that this is an online store. We
absolutely, positively cannot NOT have images. We have to. We have ten or so
other sites... This is the only one with <code>og:image</code> problems. It's also the
only one on <code>https</code>, so we thought maybe that was the problem. But we can't
find any precedent anywhere on the web for that.</p>
<p>These are the meta-tags:</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="ss">"og:title"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"[The product name]"</span><span class="w"> </span><span class="o">/&gt;</span><span class="w"> </span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="ss">"og:description"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"[the product description]"</span><span class="w"> </span><span class="o">/&gt;</span><span class="w"> </span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="ss">"og:image"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"https://www.[ourwebsite].com/images/shirts/overdriven-blues-music-tshirt-details-black.png"</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="ss">"og:image"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"https://www.[ourwebsite].com/images/shirts/overdriven-blues-music-tshirt-art-black.png"</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="ss">"og:image"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"http://www.[ADIFFERENTwebsite].com/wp-content/uploads/2011/06/ARS-Header-Shine2.png"</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="ss">"og:image"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"https://www.[ourwebsite].com/images/ARShopHeader.png"</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="ss">"og:image"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"http://www.[ourwebsite].com/overdriven-blues-music-tshirt-art-black.JPG"</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="ss">"og:type"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"product"</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="ss">"og:url"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"https://www.[ourwebsite].com/apparel-details.php?i=10047"</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="ss">"og:site_name"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"[our site name]"</span><span class="w"> </span><span class="o">/&gt;</span><span class="w">      </span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">property</span><span class="o">=</span><span class="ss">"fb:admins"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"[FB-USER-ID-NUMBER]"</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="ss">"title"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"[The product name]"</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="ss">"description"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"[The product description]"</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">link</span><span class="w"> </span><span class="n">rel</span><span class="o">=</span><span class="ss">"image_src"</span><span class="w"> </span><span class="n">href</span><span class="o">=</span><span class="ss">"https://www.[ourwebsite].com/images/shirts/overdriven-blues-music-tshirt-details-black.png"</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="ss">"keywords"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"[four typical keywords]"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">meta</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="ss">"robots"</span><span class="w"> </span><span class="n">content</span><span class="o">=</span><span class="ss">"noarchive"</span><span class="o">&gt;</span>
</pre></div>

<p>In case you want it, here's a link to one of our product pages that we've been
working on. [Link shortened to try to curb this getting into search results
for our site]: http://rockn.ro/114</p>
<p>EDIT ----</p>
<p>Using the "see what facebook sees" scraper tool, we were able to see the
following:</p>
<div class="code"><pre class="code literal-block"><span class="ss">"image"</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">          </span>
<span class="n">      {</span>
<span class="n">         "url": "https://www.[httpSwebsite</span><span class="o">]</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">shirts</span><span class="o">/</span><span class="n">soul</span><span class="o">-</span><span class="n">man</span><span class="o">-</span><span class="n">soul</span><span class="o">-</span><span class="n">music</span><span class="o">-</span><span class="n">tshirt</span><span class="o">-</span><span class="n">details</span><span class="o">-</span><span class="n">safari</span><span class="p">.</span><span class="n">png</span><span class="ss">"</span>
<span class="ss">      },</span>
<span class="ss">      {</span>
<span class="ss">         "</span><span class="n">url</span><span class="ss">": "</span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="o">[</span><span class="n">httpSwebsite</span><span class="o">]</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">shirts</span><span class="o">/</span><span class="n">soul</span><span class="o">-</span><span class="n">man</span><span class="o">-</span><span class="n">soul</span><span class="o">-</span><span class="n">music</span><span class="o">-</span><span class="n">tshirt</span><span class="o">-</span><span class="n">art</span><span class="o">-</span><span class="n">safari</span><span class="p">.</span><span class="n">png</span><span class="ss">"</span>
<span class="ss">      },</span>
<span class="ss">      {</span>
<span class="ss">         "</span><span class="n">url</span><span class="ss">": "</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="o">[</span><span class="n">theotherNONSECUREwebsite</span><span class="o">]</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">wp</span><span class="o">-</span><span class="n">content</span><span class="o">/</span><span class="n">uploads</span><span class="o">/</span><span class="mi">2011</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="n">ARS</span><span class="o">-</span><span class="n">Header</span><span class="o">-</span><span class="n">Shine2</span><span class="p">.</span><span class="n">png</span><span class="err">"</span>
<span class="w">      </span><span class="err">}</span>
<span class="w">   </span><span class="err">]</span><span class="p">,</span>
</pre></div>

<p>We tested all links it found for a single page. All were perfectly valid
images.</p>
<p>EDIT 2 ----</p>
<p>We tried a test and added a <em>subdomain</em> to the NONSECURE website (from which
images are actually visible through facebook). Subdomain was
http://img.[nonsecuresite].com. We then put all images into the main subdomain
folder and referenced those. It would not pull those images into FB. However,
it would still pull any images that were referenced on the nonsecure main
domain.</p>
<p>POSTED WORKAROUND ----</p>
<p>Thanks to Keegan, we now know that this is a bug in Facebook. To workaround,
we placed a subdomain in a different NON-HTTPS website and dumped all images
in it. We referenced the coordinating <code>http://img.otherdomain.com/[like-
image.jpg]</code> image in <code>og:image</code> on each product page. We then had to go
through FB Linter and run EVERY link to refresh the OG data. This worked, but
the solution is a band-aid workaround, and if the <code>https</code> issue is fixed and
we go back to using the natural https domain, FB will have cached the images
from a different website, complicating matters. Hopefully this information
helps to save someone else from losing 32 coding hours of <em>their</em> life.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I ran into the same problem and reported it as a bug on the Facebook developer
site. It seems pretty clear that <code>og:image</code> URIs using HTTP work just fine and
URIs using HTTPS do not. They have now acknowledged that they are "looking
into this."</p>
<p>Update: As of 2020, the bug is no longer visible in Facebook's ticket system.
They never responded and I don't believe this behavior has changed. However,
specifying HTTPS URI in <code>og:image:secure</code> does seem to be working fine.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I ran into the same problem and reported it as a bug on the Facebook developer
site. It seems pretty clear that <code>og:image</code> URIs using HTTP work just fine and
URIs using HTTPS do not. They have now acknowledged that they are "looking
into this."</p>
<p>Update: As of 2020, the bug is no longer visible in Facebook's ticket system.
They never responded and I don't believe this behavior has changed. However,
specifying HTTPS URI in <code>og:image:secure</code> does seem to be working fine.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/git-commit-messages-50-72-formatting/" class="u-url">Git Commit Messages: 50/72 Formatting</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/git-commit-messages-50-72-formatting/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T18:17:39+08:00" itemprop="datePublished" title="2023-03-04 18:17">2023-03-04 18:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Tim Pope argues for a particular Git commit message style in his blog post:
http://www.tpope.net/node/106.</p>
<p>Here is a quick summary of what he recommends:</p>
<ul>
<li>First line is 50 characters or less.</li>
<li>Then a blank line.</li>
<li>Remaining text should be wrapped at 72 characters.</li>
</ul>
<p>His blog post gives the rationale for these recommendations (which I will call
“50/72 formatting” for brevity):</p>
<ul>
<li>In practice, some tools treat the first line as a subject line and the second paragraph as a body (similar to email).</li>
<li>
<code>git log</code> does not handle wrapping, so it is hard to read if lines are too long.</li>
<li>
<code>git format-patch --stdout</code> converts commits to email — so to play nice it helps if your commits are already wrapped nicely.</li>
</ul>
<p>A point I would like to add that I think Tim would agree with:</p>
<ul>
<li>The act of summarizing your commit is a good practice inherently in any version control system. It helps others (or a later you) find relevant commits more quickly.</li>
</ul>
<p>So, I have a couple of angles to my question:</p>
<ul>
<li>What chunk (roughly) of the “thought leaders” or “experienced users” of Git embrace the 50/72 formatting style? I ask this because sometime newer users don’t know or don’t care about community practices.</li>
<li>For those that don’t use this formatting, is there a principled reason for using a different formatting style? (Please note that I’m looking for an argument on the merits, not “I’ve never heard of it” or “I don’t care.”)</li>
<li>Empirically speaking, what percentage of Git repositories embrace this style? (In case someone wants to do an analysis on GitHub repositories… hint, hint.)</li>
</ul>
<p>My point here is not to recommend the 50/72 style or shoot down other styles.
(To be open about it, I do prefer it, but I am open to other ideas.) I just
want to get the rationale for why people like or oppose various Git commit
message styles. (Feel free to bring up points that haven’t been mentioned,
too.)</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Regarding the “summary” line (the 50 in your formula), the Linux kernel
documentation has this to say:</p>
<div class="code"><pre class="code literal-block"><span class="k">For</span><span class="w"> </span><span class="nv">these</span><span class="w"> </span><span class="nv">reasons</span>,<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="s2">"summary"</span><span class="w"> </span><span class="nv">must</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">more</span><span class="w"> </span><span class="nv">than</span><span class="w"> </span><span class="mi">70</span><span class="o">-</span><span class="mi">75</span>
<span class="nv">characters</span>,<span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">must</span><span class="w"> </span><span class="nv">describe</span><span class="w"> </span><span class="nv">both</span><span class="w"> </span><span class="nv">what</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">patch</span><span class="w"> </span><span class="nv">changes</span>,<span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">well</span>
<span class="nv">as</span><span class="w"> </span><span class="nv">why</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">patch</span><span class="w"> </span><span class="nv">might</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">necessary</span>.<span class="w">  </span><span class="nv">It</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">challenging</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">both</span>
<span class="nv">succinct</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">descriptive</span>,<span class="w"> </span><span class="nv">but</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">what</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">well</span><span class="o">-</span><span class="nv">written</span><span class="w"> </span><span class="nv">summary</span>
<span class="nv">should</span><span class="w"> </span><span class="k">do</span>.
</pre></div>

<p>That said, it seems like kernel maintainers do indeed try to keep things
around 50. Here’s a histogram of the lengths of the summary lines in the git
log for the kernel:</p>
<p><img alt="Lengths of Git summary lines" src="images/uzUqh.png"> (view full-sized)</p>
<p>There is a smattering of commits that have summary lines that are longer (some
much longer) than this plot can hold without making the interesting part look
like one single line. (There’s probably some fancy statistical technique for
incorporating that data here but oh well… :-)</p>
<p>If you want to see the raw lengths:</p>
<div class="code"><pre class="code literal-block">cd /path/to/repo
git shortlog  | grep -e '^      ' | sed 's/[[:space:]]\+\(.*\)$/\1/' | awk '{print length($0)}'
</pre></div>

<p>or a text-based histogram:</p>
<div class="code"><pre class="code literal-block"><span class="n">cd</span><span class="w"> </span><span class="o">/</span><span class="k">path</span><span class="o">/</span><span class="k">to</span><span class="o">/</span><span class="n">repo</span>
<span class="n">git</span><span class="w"> </span><span class="n">shortlog</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="s1">'^      '</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sed</span><span class="w"> </span><span class="s1">'s/[[:space:]]\+\(.*\)$/\1/'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">awk</span><span class="w"> </span><span class="s1">'{lens[length($0)]++;} END {for (len in lens) print len, lens[len] }'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">-</span><span class="n">n</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Regarding “thought leaders”: Linus emphatically advocates line wrapping for
the full commit message:</p>
<blockquote>
<p>[…] we use 72-character columns for word-wrapping, except for quoted
material that has a specific line format.</p>
</blockquote>
<p>The exceptions refers mainly to “non-prose” text, that is, text that was not
typed by a human for the commit — for example, compiler error messages.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/get-image-data-url-in-javascript/" class="u-url">Get image data URL in JavaScript?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/get-image-data-url-in-javascript/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T18:16:18+08:00" itemprop="datePublished" title="2023-03-04 18:16">2023-03-04 18:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a regular HTML page with some images (just regular <code>&lt;img /&gt;</code> HTML
tags). I'd like to get their content, base64 encoded preferably, without the
need to redownload the image (ie. it's already loaded by the browser, so now I
want the content).</p>
<p>I'd love to achieve that with Greasemonkey and Firefox.</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>Note:</strong> This only works if the image is from the same domain as the page, or
has the <code>crossOrigin="anonymous"</code> attribute and the server supports CORS. It's
also not going to give you the original file, but a re-encoded version. If you
need the result to be identical to the original, see Kaiido's answer.</p>
<hr>
<p>You will need to create a canvas element with the correct dimensions and copy
the image data with the <code>drawImage</code> function. Then you can use the <code>toDataURL</code>
function to get a data: url that has the base-64 encoded image. Note that the
image must be fully loaded, or you'll just get back an empty (black,
transparent) image.</p>
<p>It would be something like this. I've never written a Greasemonkey script, so
you might need to adjust the code to run in that environment.</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">getBase64Image</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">canvas</span><span class="w"> </span><span class="n">element</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s2">"canvas"</span><span class="p">);</span>
<span class="w">    </span><span class="n">canvas</span><span class="o">.</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img</span><span class="o">.</span><span class="n">width</span><span class="p">;</span>
<span class="w">    </span><span class="n">canvas</span><span class="o">.</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img</span><span class="o">.</span><span class="n">height</span><span class="p">;</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Copy</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">canvas</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">canvas</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="s2">"2d"</span><span class="p">);</span>
<span class="w">    </span><span class="n">ctx</span><span class="o">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">data</span><span class="o">-</span><span class="n">URL</span><span class="w"> </span><span class="n">formatted</span><span class="w"> </span><span class="n">image</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Firefox</span><span class="w"> </span><span class="n">supports</span><span class="w"> </span><span class="n">PNG</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">JPEG</span><span class="o">.</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">img</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="n">to</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">guess</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">original</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">aware</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="s2">"image/jpg"</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">encode</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="o">.</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">dataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">canvas</span><span class="o">.</span><span class="n">toDataURL</span><span class="p">(</span><span class="s2">"image/png"</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">dataURL</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/^</span><span class="n">data</span><span class="p">:</span><span class="n">image</span>\<span class="o">/</span><span class="p">(</span><span class="n">png</span><span class="o">|</span><span class="n">jpg</span><span class="p">);</span><span class="n">base64</span><span class="p">,</span><span class="o">/</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Getting a JPEG-formatted image doesn't work on older versions (around 3.5) of
Firefox, so if you want to support that, you'll need to check the
compatibility. If the encoding is not supported, it will default to
"image/png".</p>
<p><br></p>
<h3>Suggest</h3>
<p>This Function takes the URL then returns the image BASE64</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">getBase64FromImageUrl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Image</span><span class="p">();</span>

<span class="w">    </span><span class="n">img</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s1">'crossOrigin'</span><span class="p">,</span><span class="w"> </span><span class="s1">'anonymous'</span><span class="p">);</span>

<span class="w">    </span><span class="n">img</span><span class="o">.</span><span class="n">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s2">"canvas"</span><span class="p">);</span>
<span class="w">        </span><span class="n">canvas</span><span class="o">.</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="n">this</span><span class="o">.</span><span class="n">width</span><span class="p">;</span>
<span class="w">        </span><span class="n">canvas</span><span class="o">.</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="n">this</span><span class="o">.</span><span class="n">height</span><span class="p">;</span>

<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">canvas</span><span class="o">.</span><span class="n">getContext</span><span class="p">(</span><span class="s2">"2d"</span><span class="p">);</span>
<span class="w">        </span><span class="n">ctx</span><span class="o">.</span><span class="n">drawImage</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">dataURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">canvas</span><span class="o">.</span><span class="n">toDataURL</span><span class="p">(</span><span class="s2">"image/png"</span><span class="p">);</span>

<span class="w">        </span><span class="n">alert</span><span class="p">(</span><span class="n">dataURL</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/^</span><span class="n">data</span><span class="p">:</span><span class="n">image</span>\<span class="o">/</span><span class="p">(</span><span class="n">png</span><span class="o">|</span><span class="n">jpg</span><span class="p">);</span><span class="n">base64</span><span class="p">,</span><span class="o">/</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">));</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="n">img</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Call it like this : <code>getBase64FromImageUrl("images/slbltxt.png")</code></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2469.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2467.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
