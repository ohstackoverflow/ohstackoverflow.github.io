<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 891) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-891.html">
<link rel="prev" href="index-892.html" type="text/html">
<link rel="next" href="index-890.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/mysql-8-0-client-does-not-support-authentication-protocol-requested-by-server-consider-upgrading-mysql-client/" class="u-url">MySQL 8.0 - Client does not support authentication protocol requested by server; consider upgrading MySQL client</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/mysql-8-0-client-does-not-support-authentication-protocol-requested-by-server-consider-upgrading-mysql-client/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T18:44:58+08:00" itemprop="datePublished" title="2023-02-17 18:44">2023-02-17 18:44</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I can't make a simple connection to the server for some reason. I install the
newest MySQL Community 8.0 database along with Node.JS with default settings.</p>
<p><strong>This is my node.js code</strong></p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">mysql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'mysql'</span><span class="p">);</span>

<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mysql</span><span class="o">.</span><span class="n">createConnection</span><span class="p">({</span>
<span class="w">      </span><span class="n">host</span><span class="p">:</span><span class="w"> </span><span class="s2">"localhost"</span><span class="p">,</span>
<span class="w">      </span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="s2">"root"</span><span class="p">,</span>
<span class="w">      </span><span class="n">password</span><span class="p">:</span><span class="w"> </span><span class="s2">"password"</span><span class="p">,</span>
<span class="w">      </span><span class="n">insecureAuth</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="bp">true</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="n">con</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<span class="w">      </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"Connected!"</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>

<p><strong>Below is the error found in Command Prompt:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">mysql</span><span class="o">-</span><span class="n">test</span><span class="o">&gt;</span><span class="n">node</span><span class="w"> </span><span class="n">app</span><span class="o">.</span><span class="n">js</span>
<span class="w">    </span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">mysql</span><span class="o">-</span><span class="n">test</span>\<span class="n">node_modules</span>\<span class="n">mysql</span>\<span class="n">lib</span>\<span class="n">protocol</span>\<span class="n">Parse</span>
<span class="w">    </span><span class="n">r</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">80</span>
<span class="w">            </span><span class="n">throw</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Rethrow</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">MySQL</span><span class="w"> </span><span class="n">errors</span>
<span class="w">            </span><span class="o">^</span>

<span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="n">ER_NOT_SUPPORTED_AUTH_MODE</span><span class="p">:</span><span class="w"> </span><span class="n">Client</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="n">authentication</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="n">requested</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">server</span><span class="p">;</span><span class="w"> </span><span class="n">consider</span><span class="w"> </span><span class="n">upgrading</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="n">client</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Handshake</span><span class="o">.</span><span class="n">Sequence</span><span class="o">.</span><span class="n">_packetToError</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">mysql</span><span class="o">-</span>
<span class="n">test</span>\<span class="n">node_modules</span>\<span class="n">mysql</span>\<span class="n">lib</span>\<span class="n">protocol</span>\<span class="n">sequences</span>\<span class="n">Sequence</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">14</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Handshake</span><span class="o">.</span><span class="n">ErrorPacket</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">mysql</span><span class="o">-</span><span class="n">test</span>\<span class="n">node_mo</span>
<span class="n">dules</span>\<span class="n">mysql</span>\<span class="n">lib</span>\<span class="n">protocol</span>\<span class="n">sequences</span>\<span class="n">Handshake</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">130</span><span class="p">:</span><span class="mi">18</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Protocol</span><span class="o">.</span><span class="n">_parsePacket</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">mysql</span><span class="o">-</span><span class="n">test</span>\<span class="n">node_mo</span>
<span class="n">dules</span>\<span class="n">mysql</span>\<span class="n">lib</span>\<span class="n">protocol</span>\<span class="n">Protocol</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">279</span><span class="p">:</span><span class="mi">23</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Parser</span><span class="o">.</span><span class="n">write</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">mysql</span><span class="o">-</span><span class="n">test</span>\<span class="n">node_modules</span>\<span class="n">mys</span>
<span class="n">ql</span>\<span class="n">lib</span>\<span class="n">protocol</span>\<span class="n">Parser</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Protocol</span><span class="o">.</span><span class="n">write</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">mysql</span><span class="o">-</span><span class="n">test</span>\<span class="n">node_modules</span>\<span class="n">m</span>
<span class="n">ysql</span>\<span class="n">lib</span>\<span class="n">protocol</span>\<span class="n">Protocol</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">16</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Socket</span><span class="o">.&lt;</span><span class="n">anonymous</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">mysql</span><span class="o">-</span><span class="n">test</span>\<span class="n">node_modul</span>
<span class="n">es</span>\<span class="n">mysql</span>\<span class="n">lib</span>\<span class="n">Connection</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">103</span><span class="p">:</span><span class="mi">28</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Socket</span><span class="o">.</span><span class="n">emit</span><span class="w"> </span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">159</span><span class="p">:</span><span class="mi">13</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">addChunk</span><span class="w"> </span><span class="p">(</span><span class="n">_stream_readable</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">265</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">readableAddChunk</span><span class="w"> </span><span class="p">(</span><span class="n">_stream_readable</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">252</span><span class="p">:</span><span class="mi">11</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Socket</span><span class="o">.</span><span class="n">Readable</span><span class="o">.</span><span class="n">push</span><span class="w"> </span><span class="p">(</span><span class="n">_stream_readable</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">209</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="o">--------------------</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Protocol</span><span class="o">.</span><span class="n">_enqueue</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">mysql</span><span class="o">-</span><span class="n">test</span>\<span class="n">node_module</span>
<span class="n">s</span>\<span class="n">mysql</span>\<span class="n">lib</span>\<span class="n">protocol</span>\<span class="n">Protocol</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">145</span><span class="p">:</span><span class="mi">48</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Protocol</span><span class="o">.</span><span class="n">handshake</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">mysql</span><span class="o">-</span><span class="n">test</span>\<span class="n">node_modul</span>
<span class="n">es</span>\<span class="n">mysql</span>\<span class="n">lib</span>\<span class="n">protocol</span>\<span class="n">Protocol</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">23</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">Connection</span><span class="o">.</span><span class="n">connect</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">mysql</span><span class="o">-</span><span class="n">test</span>\<span class="n">node_modul</span>
<span class="n">es</span>\<span class="n">mysql</span>\<span class="n">lib</span>\<span class="n">Connection</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">130</span><span class="p">:</span><span class="mi">18</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">.&lt;</span><span class="n">anonymous</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">mysql</span><span class="o">-</span><span class="n">test</span>\<span class="n">server</span><span class="o">.</span><span class="n">js</span><span class="p">:</span>
<span class="mi">11</span><span class="p">:</span><span class="mi">5</span><span class="p">)</span>
<span class="n">at</span><span class="w"> </span><span class="n">Module</span><span class="o">.</span><span class="n">_compile</span><span class="w"> </span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">660</span><span class="p">:</span><span class="mi">30</span><span class="p">)</span>
<span class="n">at</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">_extensions</span><span class="o">..</span><span class="n">js</span><span class="w"> </span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">671</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span>
<span class="n">at</span><span class="w"> </span><span class="n">Module</span><span class="o">.</span><span class="n">load</span><span class="w"> </span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">573</span><span class="p">:</span><span class="mi">32</span><span class="p">)</span>
<span class="n">at</span><span class="w"> </span><span class="n">tryModuleLoad</span><span class="w"> </span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">513</span><span class="p">:</span><span class="mi">12</span><span class="p">)</span>
<span class="n">at</span><span class="w"> </span><span class="n">Function</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">_load</span><span class="w"> </span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">505</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<span class="n">at</span><span class="w"> </span><span class="n">Function</span><span class="o">.</span><span class="n">Module</span><span class="o">.</span><span class="n">runMain</span><span class="w"> </span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">701</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

<p>I've read up on some things such as:
https://dev.mysql.com/doc/refman/5.5/en/old-client.html
https://github.com/mysqljs/mysql/issues/1507</p>
<p>But I am still not sure how to fix my problem. Any help would be appreciated
:D</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Execute the following query in MYSQL Workbench</p>
<p><code>ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY
'password';</code></p>
<p>Where <code>root</code> as your user <code>localhost</code> as your URL and <code>password</code> as your
password</p>
<p>Then run this query to refresh privileges:</p>
<p><code>flush privileges;</code></p>
<p>Try connecting using node after you do so.</p>
<p>If that doesn't work, try it without <code>@'localhost'</code> part.</p>
<p><br></p>
<h3>Suggest</h3>
<h3>Summary</h3>
<ol>
<li>If you just want to get rid of the error, <strong>at the cost of risking the security of the project</strong> (e.g. it's just a personal project or dev environment), go with @Pras's answer -- <code>ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password'</code> and then <code>flush privileges</code>
</li>
<li>If you want to have a fix for it, without knowing why, just install and use <code>mysql2</code> (instead of <code>mysql</code>) and use it -- <code>npm i mysql2</code>, and <code>mysql = require('mysql2');</code>.</li>
<li>If you are a curious developer who is always eager to learn, keep reading ... :)</li>
</ol>
<hr>
<h3>What's going on?</h3>
<p>Let's first make it clear what's going on.</p>
<p>MySQL 8 has supports pluggable authentication methods. By default, one of them
named <code>caching_sha2_password</code> is used rather than our good old
<code>mysql_native_password</code> (source). It should be obvious that using a crypto
algorithm with several handshakes is more secure than plain password passing
that has been there for 24 years!</p>
<p>Now, the problem is <code>mysqljs</code> in Node (the package you install with <code>npm i
mysql</code> and use it in your Node code) doesn't support this new default
authentication method of MySQL 8, yet. The issue is in here:
https://github.com/mysqljs/mysql/issues/1507 and is still open, after 3 years,
as of July 2019.</p>
<p><strong>UPDATE June 2019:</strong> There is a new PR in mysqljs now to fix this!</p>
<p><strong>UPDATE Feb 2020:</strong> Apparently it's scheduled to come in version 3 of
mysqljs.</p>
<p><strong>UPDATE July 2020:</strong> Apparently it's still not in yet (as of April 2020 at
least), but it's claimed that node-mysql2 is supporting Authentication switch
request. Please comment below if <code>node-mysql2</code> is working fine for this issue
-- I will test it later myself.</p>
<p><strong>UPDATE April 2021:</strong> It seems like the issue is still there and just 3 days
ago, someone created a fork and made it there -- yet not official in the
mysql.js package. Also, as per the comments below, it seems like mysql2
package is working fine and supporting Authentication-switch properly.</p>
<hr>
<h2>Your Current Options</h2>
<h4>Option 1) [NOT RECOMMENDED] Downgrade "MySQL" to authenticate using good</h4>
<p>old "mysql_native_password"</p>
<p>That's what everybody suggests here (e.g. top answer above). You just get into
<code>mysql</code> and run a query saying <code>root</code> is fine using old
<code>mysql_native_password</code> method for authentication:</p>
<div class="code"><pre class="code literal-block">ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password ...
</pre></div>

<p>The good thing is, life is going to be simple and you can still use good old
tools like Sequel Pro without any issue. But the problem is, you are not
taking advantage of a more secure (and cool, read below) stuffs available to
you.</p>
<h4>Option 2) [Meh...] Replace "Node" package with MySQL Connecter X DevAPI</h4>
<p>MySQL X DevAPI for Node is a replacement to Node's Mysqljs package, provided
by http://dev.mysql.com official guys.</p>
<p>It works like a charm supporting <code>caching_sha2_password</code> authentication. (Just
make sure you use port <code>33060</code> for X Protocol communications.)</p>
<p>The bad thing is, you have left our old <code>mysql</code> package that everyone is so
used to and relies on.</p>
<p>The good thing is, your app is more secure now and you can take advantage of a
ton of new things that our good old friends didn't provide! Just check out the
tutorial of X DevAPI and you'll see it has a ton of new sexy features that can
come in handy. You just need to pay the price of a learning curve, which
expectedly comes with any technology upgrade. :)</p>
<p>PS. Unfortunately, this XDevAPI Package doesn't have types definition
(understandable by TypeScript) yet, so if you are on <strong>typescript</strong> , you will
have problems. I tried to generate .d.ts using <code>dts-gen</code> and <code>dtsmake</code>, but no
success. So keep that in mind.</p>
<h4>Option 3) [RECOMMENDED] Replace "mysql.js" with "mysql2.js" package</h4>
<p>As mentioned above, mysql package (NPM package link) is still having this
issue (as of April 2021). But mysql2 package (NPM package link) is not. So
probably the following should be the one-liner answer!</p>
<div class="code"><pre class="code literal-block">npm un mysql &amp;&amp; npm i mysql2
</pre></div>

<p>Please note that <code>mysql2</code> is a forked work off of the popular <code>mysql</code>, but its
popularity (620K downloads per week for <code>mysql2</code> in April 2020) has got close
to the original package (720K download per week for <code>mysql</code> in April 2021)
that making the switch seems reasonable!</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/gpg-failed-to-sign-the-data-fatal-failed-to-write-commit-object-git-2-10-0/" class="u-url">gpg failed to sign the data fatal: failed to write commit object [Git 2.10.0]</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/gpg-failed-to-sign-the-data-fatal-failed-to-write-commit-object-git-2-10-0/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T18:44:25+08:00" itemprop="datePublished" title="2023-02-17 18:44">2023-02-17 18:44</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I followed few articles over the pretty attributes on Git 2.10 release note.
Going through which upgraded the git to 2.10.0 and made changes to global
<code>.gitconfig</code> resulting as follows -</p>
<div class="code"><pre class="code literal-block"><span class="k">[filter "lfs"]</span>
<span class="w">    </span><span class="na">clean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">git-lfs clean %f</span>
<span class="w">    </span><span class="na">smudge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">git-lfs smudge %f</span>
<span class="w">    </span><span class="na">required</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="k">[user]</span>
<span class="w">    </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">xyz</span>
<span class="w">    </span><span class="na">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">abc.def@gmail.com</span>
<span class="w">    </span><span class="na">signingkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">AAAAAAA</span>
<span class="k">[core]</span>
<span class="w">    </span><span class="na">excludesfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/Users/xyz/.gitignore_global</span>
<span class="w">    </span><span class="na">editor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">'subl' --wait</span>
<span class="k">[difftool "sourcetree"]</span>
<span class="w">    </span><span class="na">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">opendiff \"$LOCAL\" \"$REMOTE\"</span>
<span class="w">    </span><span class="na">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="k">[mergetool "sourcetree"]</span>
<span class="w">    </span><span class="na">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/Applications/SourceTree.app/Contents/Resources/opendiff-w.sh \"$LOCAL\" \"$REMOTE\" -ancestor \"$BASE\" -merge \"$MERGED\"</span>
<span class="w">    </span><span class="na">trustExitCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="k">[alias]</span>
<span class="w">    </span><span class="na">lg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit --date=relative</span>
<span class="k">[color "diff"]</span>
<span class="w">    </span><span class="na">old</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">red strike</span>
<span class="w">    </span><span class="na">new</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">green italic</span>
</pre></div>

<p>But now that I try to sign my commits using</p>
<div class="code"><pre class="code literal-block">git commit -a -S -m "message"
</pre></div>

<p>I get to see the following error -</p>
<blockquote>
<p>You need a passphrase to unlock the secret key for</p>
<p>user: "XYZ (Digitally Signed) "</p>
<p>2048-bit RSA key, ID AAAAAAAA, created 2016-07-01</p>
<p>error: gpg failed to sign the data fatal: failed to write commit object</p>
</blockquote>
<p><strong><em>Note</em></strong> - I can still commit changes using <code>git commit -a -m "message"</code></p>
<p><strong><em>Is there a way to overcome the same? Or any change required in<code>gpg</code> configs
to get along with the upgradation of git?</em></strong></p>
<hr>
<p><strong><em>Update 1</em></strong></p>
<p>Also seeking further usefulness, following Is there a way to "autosign"
commits in Git with a GPG key?. I've already configured the key using</p>
<div class="code"><pre class="code literal-block">git config --global user.signingkey ED5CDE14(with my key) 
git config --global commit.gpgsign true
</pre></div>

<p>and quite obviously getting the same error anyway.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I ran into this issue with OSX.</p>
<h4>Original answer:</h4>
<p>It seems like a gpg update (of brew) changed to location of <code>gpg</code> to <code>gpg1</code>,
you can change the binary where git looks up the gpg:</p>
<div class="code"><pre class="code literal-block">git config --global gpg.program gpg1
</pre></div>

<p>If you don't have gpg1: <code>brew install gpg1</code>.</p>
<h4>Updated answer:</h4>
<p>It looks like gpg1 is being deprecated/"gently nudged out of usage", so you
probably should actually update to gpg2, unfortunately this involves quite a
few more steps/a bit of time:</p>
<div class="code"><pre class="code literal-block"><span class="nv">brew</span><span class="w"> </span><span class="nv">upgrade</span><span class="w"> </span><span class="nv">gnupg</span><span class="w">  </span>#<span class="w"> </span><span class="nv">This</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">make</span><span class="w"> </span><span class="nv">step</span><span class="w"> </span><span class="nv">which</span><span class="w"> </span><span class="nv">takes</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="k">while</span>
<span class="nv">brew</span><span class="w"> </span><span class="nv">link</span><span class="w"> </span><span class="o">--</span><span class="nv">overwrite</span><span class="w"> </span><span class="nv">gnupg</span>
<span class="nv">brew</span><span class="w"> </span><span class="nv">install</span><span class="w"> </span><span class="nv">pinentry</span><span class="o">-</span><span class="nv">mac</span>
</pre></div>

<p>on old homebrew:</p>
<div class="code"><pre class="code literal-block">echo "pinentry-program /usr/local/bin/pinentry-mac" &gt;&gt; ~/.gnupg/gpg-agent.conf
killall gpg-agent
</pre></div>

<p>On more recent systems like M1 macs:</p>
<div class="code"><pre class="code literal-block">echo "pinentry-program /opt/homebrew/bin/pinentry-mac" &gt;&gt; ~/.gnupg/gpg-agent.conf 
killall gpg-agent
</pre></div>

<p>The first part installs gpg2, and latter is a hack required to use it. For
troubleshooting, see this answer (though that is about linux not brew), it
suggests a good test:</p>
<div class="code"><pre class="code literal-block">echo "test" | gpg --clearsign  # on linux it's gpg2 but brew stays as gpg
</pre></div>

<p>If this test is successful (no error/output includes PGP signature), you have
successfully updated to the latest gpg version.</p>
<p>You should now be able to use git signing again!<br>
It's worth noting you'll need to have:</p>
<div class="code"><pre class="code literal-block"><span class="nv">git</span><span class="w"> </span><span class="nv">config</span><span class="w"> </span><span class="o">--</span><span class="nv">global</span><span class="w"> </span><span class="nv">gpg</span>.<span class="nv">program</span><span class="w"> </span><span class="nv">gpg</span><span class="w">  </span>#<span class="w"> </span><span class="nv">perhaps</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">had</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">already</span>?<span class="w"> </span><span class="nv">On</span><span class="w"> </span><span class="nv">linux</span><span class="w"> </span><span class="nv">maybe</span><span class="w"> </span><span class="nv">gpg2</span>
<span class="nv">git</span><span class="w"> </span><span class="nv">config</span><span class="w"> </span><span class="o">--</span><span class="nv">global</span><span class="w"> </span><span class="nv">commit</span>.<span class="nv">gpgsign</span><span class="w"> </span><span class="nv">true</span><span class="w">  </span>#<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">want</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">sign</span><span class="w"> </span><span class="nv">every</span><span class="w"> </span><span class="nv">commit</span>
</pre></div>

<p>Note: After you've run a signed commit, you can verify it signed with:</p>
<div class="code"><pre class="code literal-block"><span class="nv">git</span><span class="w"> </span><span class="nv">log</span><span class="w"> </span><span class="o">--</span><span class="k">show</span><span class="o">-</span><span class="nv">signature</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
</pre></div>

<p>which will include gpg info for the last commit.</p>
<p><br></p>
<h3>Suggest</h3>
<p>If gnupg2 and gpg-agent 2.x are used, be sure to set the environment variable
<code>GPG_TTY</code>.</p>
<div class="code"><pre class="code literal-block"><span class="k">export</span><span class="w"> </span><span class="n">GPG_TTY</span><span class="o">=$</span><span class="p">(</span><span class="n">tty</span><span class="p">)</span>
</pre></div>

<p>See GPG’s documentation about common problems.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/when-should-i-really-use-noexcept/" class="u-url">When should I really use noexcept?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/when-should-i-really-use-noexcept/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T18:43:58+08:00" itemprop="datePublished" title="2023-02-17 18:43">2023-02-17 18:43</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>The <code>noexcept</code> keyword can be appropriately applied to many function
signatures, but I am unsure as to when I should consider using it in practice.
Based on what I have read so far, the last-minute addition of <code>noexcept</code> seems
to address some important issues that arise when move constructors throw.
However, I am still unable to provide satisfactory answers to some practical
questions that led me to read more about <code>noexcept</code> in the first place.</p>
<ol>
<li>There are many examples of functions that I know will never throw, but for which the compiler cannot determine so on its own. Should I append <code>noexcept</code> to the function declaration in <strong>all such cases?</strong>
</li>
</ol>
<p>Having to think about whether or not I need to append <code>noexcept</code> after
<strong>every</strong> function declaration would greatly reduce programmer productivity
(and frankly, would be a pain in the neck). For which situations should I be
more careful about the use of <code>noexcept</code>, and for which situations can I get
away with the implied <code>noexcept(false)</code>?</p>
<ol>
<li>When can I realistically expect to observe a performance improvement after using <code>noexcept</code>? In particular, give an example of code for which a C++ compiler is able to generate better machine code after the addition of <code>noexcept</code>.</li>
</ol>
<p>Personally, I care about <code>noexcept</code> because of the increased freedom provided
to the compiler to safely apply certain kinds of optimizations. Do modern
compilers take advantage of <code>noexcept</code> in this way? If not, can I expect some
of them to do so in the near future?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I think it is too early to give a "best practices" answer for this as there
hasn't been enough time to use it in practice. If this was asked about throw
specifiers right after they came out then the answers would be very different
to now.</p>
<blockquote>
<p>Having to think about whether or not I need to append <code>noexcept</code> after every
function declaration would greatly reduce programmer productivity (and
frankly, would be a pain).</p>
</blockquote>
<p>Well, then use it when it's obvious that the function will never throw.</p>
<blockquote>
<p>When can I realistically expect to observe a performance improvement after
using <code>noexcept</code>? [...] Personally, I care about <code>noexcept</code> because of the
increased freedom provided to the compiler to safely apply certain kinds of
optimizations.</p>
</blockquote>
<p>It seems like the biggest optimization gains are from user optimizations, not
compiler ones due to the possibility of checking <code>noexcept</code> and overloading on
it. Most compilers follow a no-penalty-if-you-don't-throw exception handling
method, so I doubt it would change much (or anything) on the machine code
level of your code, although perhaps reduce the binary size by removing the
handling code.</p>
<p>Using <code>noexcept</code> in the big four (constructors, assignment, not destructors as
they're already <code>noexcept</code>) will likely cause the best improvements as
<code>noexcept</code> checks are 'common' in template code such as in <code>std</code> containers.
For instance, <code>std::vector</code> won't use your class's move unless it's marked
<code>noexcept</code> (or the compiler can deduce it otherwise).</p>
<p><br></p>
<h3>Suggest</h3>
<p>As I keep repeating these days: <strong>semantics first</strong>.</p>
<p>Adding <code>noexcept</code>, <code>noexcept(true)</code> and <code>noexcept(false)</code> is first and
foremost about semantics. It only incidentally condition a number of possible
optimizations.</p>
<p>As a programmer reading code, the presence of <code>noexcept</code> is akin to that of
<code>const</code>: it helps me better grok what may or may not happen. Therefore, it is
worthwhile spending some time thinking about whether or not you know if the
function will throw. For a reminder, any kind of dynamic memory allocation may
throw.</p>
<hr>
<p>Okay, now on to the possible optimizations.</p>
<p>The most obvious optimizations are actually performed in the libraries. C++11
provides a number of traits that allows knowing whether a function is
<code>noexcept</code> or not, and the Standard Library implementation themselves will use
those traits to favor <code>noexcept</code> operations on the user-defined objects they
manipulate, if possible. Such as <em>move semantics</em>.</p>
<p>The compiler may only shave a bit of fat (perhaps) from the exception handling
data, because it <em>has</em> to take into account the fact that you may have lied.
If a function marked <code>noexcept</code> does throw, then <code>std::terminate</code> is called.</p>
<p>These semantics were chosen for two reasons:</p>
<ul>
<li>immediately benefiting from <code>noexcept</code> even when dependencies do not use it already (backward compatibility)</li>
<li>allowing the specification of <code>noexcept</code> when calling functions that may theoretically throw, but are not expected to for the given arguments</li>
</ul>
</div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-892.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-890.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
