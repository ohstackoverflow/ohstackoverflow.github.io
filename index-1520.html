<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1520) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1520.html">
<link rel="prev" href="index-1521.html" type="text/html">
<link rel="next" href="index-1519.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/share-an-object-blockchain-on-a-network/" class="u-url">Share an object (blockchain) on a network</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/share-an-object-blockchain-on-a-network/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T05:41:08+08:00" itemprop="datePublished" title="2023-02-28 05:41">2023-02-28 05:41</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I created a simple "blockchain" on Java.</p>
<p>Blockchain class is an ArrayList&lt;&gt; of Blocks. The blocks are made by:
hashcode, previous hashcode and nonse counter. When a block is created, it is
added to the blockchain but, until the algorithm (SHA256) is resolved, it is
not possible to allocate others. If the hashcode is unique, it is added
successfully or the block is removed.</p>
<p>What I would like to do now is to share the blockchain on a network, so the
SHA256 algorithm will not be resolved by the local machine, but by a user on
the network (for exaple, bitcoin mining).</p>
<p>So my question is: how can I share the same object on different machines in a
network?</p>
<p>You can download the code from Git:</p>
<p>Blockchain code</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Its a bit of a complex question. There are different ways but usually a Node
will keep a list of nodes it is connected too and will notify them for
changes. Also once they start communicating you should start worrying about
differences in the chain (for example if chain on one node is different from
chain on another node but both are valid). For bitcoin it takes the longer one
as valid.</p>
<p>It is a very broad question with a very broad answer. You can see a simple
javascript implementation of a blockchain using websockets here:</p>
<p>https://github.com/lhartikk/naivechain</p>
<p>Or a simple python implementation:
https://github.com/sMustafov/Blockchain/blob/master/blockchain.py</p>
<p>Or here is one written by me in Java :) which is not complete though but it
was just to do some training and ideas</p>
<p>https://github.com/veso1001/blockchain/tree/master/src/main/java/imbachain</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/completeablefuture-in-a-loop-contruct-in-a-private-ethereum-blockchain/" class="u-url">CompleteableFuture in a loop contruct in a private Ethereum Blockchain</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/completeablefuture-in-a-loop-contruct-in-a-private-ethereum-blockchain/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T05:40:48+08:00" itemprop="datePublished" title="2023-02-28 05:40">2023-02-28 05:40</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a private Ethereum blockchain set up with 5 machines mining on it. The
size of the block chain [number of blocks] are as of now, 300. The processing
is done on back-end Java.</p>
<p>I need to run the following loop construct in a asynchronous manner. The
bottleneck of the loop is during the execution of the following command:</p>
<blockquote>
<p><code>EthBlock eb = web3.ethGetBlockByNumber(new
DefaultBlockParameterNumber(BigInteger.valueOf(i)), true).send();</code></p>
</blockquote>
<p>The command can also return a <code>Completablefuture&lt;EthBlock&gt;</code> object by ending
it with <code>supplyAsync()</code> given here https://github.com/web3j/web3j#start-
sending-requests Just calling <code>supplyAync().get()</code> removes the parallelism
aspect and makes it behave synchronously.</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">businessLogic</span><span class="ss">()</span><span class="w"> </span><span class="nv">throws</span><span class="w"> </span><span class="nv">Exception</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">recentBlocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ArrayList</span><span class="o">&lt;</span><span class="nv">EthBlock</span>.<span class="nv">Block</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">long</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="c1">; i &lt;= 300000; i++) {</span>
<span class="w">            </span><span class="nv">EthBlock</span><span class="w"> </span><span class="nv">eb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">web3</span>.<span class="nv">ethGetBlockByNumber</span><span class="ss">(</span><span class="nv">new</span><span class="w"> </span><span class="nv">DefaultBlockParameterNumber</span><span class="ss">(</span><span class="nv">BigInteger</span>.<span class="nv">valueOf</span><span class="ss">(</span><span class="nv">i</span><span class="ss">))</span>,<span class="w"> </span><span class="nv">true</span><span class="ss">)</span>.<span class="k">send</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">eb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">eb</span>.<span class="nv">getBlock</span><span class="ss">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">                </span><span class="k">continue</span><span class="c1">;</span>
<span class="w">            </span>}
<span class="w">            </span><span class="nv">EthBlock</span>.<span class="nv">Block</span><span class="w"> </span><span class="nv">block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">eb</span>.<span class="nv">getBlock</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">            </span><span class="nv">recentBlocks</span>.<span class="nv">add</span><span class="ss">(</span><span class="nv">block</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">    </span>}
</pre></div>

<p>I not able to grasp the institution of translating the code into a way
CompleteableFuture can operate on. Goal is to 'group' up multiple calls to
<code>web.ethGetBlockNumber(...).supplyAync()</code> into a collection and call them all
at once to update an array which will get filled by <code>EthBlock</code> objects i.e
<code>recentBlocks</code>.</p>
<p>This is what I came up with:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">businessLogic</span><span class="p">()</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">recentBlocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">EthBlock</span><span class="p">.</span><span class="n">Block</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">CompleteableFuture</span><span class="o">&gt;</span><span class="w"> </span><span class="n">compFutures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="n">for</span><span class="w"> </span><span class="p">(</span><span class="n">long</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">300000</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">        </span><span class="n">CompleteableFuture</span><span class="o">&lt;</span><span class="n">EthBlock</span><span class="o">&gt;</span><span class="w"> </span><span class="n">compFuture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eb3</span><span class="p">.</span><span class="n">ethGetBlockByNumber</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">DefaultBlockParameterNumber</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">.</span><span class="n">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="w"> </span><span class="kr">true</span><span class="p">).</span><span class="n">sendAsync</span><span class="p">();</span>
<span class="w">        </span><span class="n">compFuture</span><span class="p">.</span><span class="n">thenAcceptAsync</span><span class="p">(</span><span class="n">eb</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="c1">// Doesn't look right</span>
<span class="w">        </span><span class="n">EthBlock</span><span class="p">.</span><span class="n">Block</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eb</span><span class="p">.</span><span class="n">getBlock</span><span class="p">();</span>
<span class="w">        </span><span class="n">recentBlock</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">block</span><span class="p">);)</span>
<span class="w">        </span><span class="n">compFutures</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">compFuture</span><span class="p">);</span><span class="w">        </span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">CompleteableFuture</span><span class="p">.</span><span class="n">allOf</span><span class="p">(</span><span class="n">compFutures</span><span class="p">).</span><span class="n">get</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<hr>
<p><strong>Implementing IntStream</strong></p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="nt">long</span><span class="w"> </span><span class="nt">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">System</span><span class="p">.</span><span class="nc">nanoTime</span><span class="o">();</span>
<span class="w">    </span><span class="nt">recentBlocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">IntStream</span><span class="p">.</span><span class="nc">rangeClosed</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span><span class="w"> </span><span class="nt">300_000</span><span class="o">)</span>
<span class="w">             </span><span class="p">.</span><span class="nc">parallel</span><span class="o">()</span>
<span class="w">             </span><span class="p">.</span><span class="nc">mapToObj</span><span class="o">(</span><span class="nt">i</span><span class="w"> </span><span class="nt">-</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">try</span><span class="w"> </span><span class="err">{</span>
<span class="w">                    </span><span class="err">System.out.println("Current</span><span class="w"> </span><span class="err">Thread</span><span class="w"> </span><span class="err">-&gt;</span><span class="w"> </span><span class="err">"</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">Thread.currentThread())</span><span class="p">;</span>
<span class="w">                    </span><span class="err">return</span><span class="w"> </span><span class="err">web3.ethGetBlockByNumber(new</span><span class="w"> </span><span class="err">DefaultBlockParameterNumber(BigInteger.valueOf(i)),</span><span class="w"> </span><span class="err">true).send()</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="nt">catch</span><span class="w"> </span><span class="o">(</span><span class="nt">IOException</span><span class="w"> </span><span class="nt">e</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="err">//</span><span class="w"> </span><span class="err">TODO</span><span class="w"> </span><span class="err">Auto-generated</span><span class="w"> </span><span class="err">catch</span><span class="w"> </span><span class="err">block</span>
<span class="w">                    </span><span class="err">e.printStackTrace()</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="nt">return</span><span class="w"> </span><span class="nt">null</span><span class="o">;</span>
<span class="w">            </span><span class="err">}</span><span class="o">)</span>
<span class="w">             </span><span class="p">.</span><span class="nc">filter</span><span class="o">(</span><span class="nt">Objects</span><span class="p">::</span><span class="nd">nonNull</span><span class="o">)</span>
<span class="w">             </span><span class="p">.</span><span class="nc">map</span><span class="o">(</span><span class="nt">EthBlock</span><span class="p">::</span><span class="nd">getBlock</span><span class="o">)</span>
<span class="w">             </span><span class="p">.</span><span class="nc">filter</span><span class="o">(</span><span class="nt">Objects</span><span class="p">::</span><span class="nd">nonNull</span><span class="o">)</span>
<span class="w">             </span><span class="p">.</span><span class="nc">collect</span><span class="o">(</span><span class="nt">Collectors</span><span class="p">.</span><span class="nc">toList</span><span class="o">());</span>
<span class="w">    </span><span class="nt">long</span><span class="w"> </span><span class="nt">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">System</span><span class="p">.</span><span class="nc">nanoTime</span><span class="o">();</span>
<span class="w">    </span><span class="nt">System</span><span class="p">.</span><span class="nc">out</span><span class="p">.</span><span class="nc">println</span><span class="o">(</span><span class="s2">"Time Elapsed: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">TimeUnit</span><span class="p">.</span><span class="nc">MICROSECONDS</span><span class="p">.</span><span class="nc">convert</span><span class="o">(</span><span class="nt">stop-start</span><span class="o">,</span><span class="w"> </span><span class="nt">TimeUnit</span><span class="p">.</span><span class="nc">NANOSECONDS</span><span class="o">));</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>You might be able to benefit from a parallel stream instead of relying on
<code>CompletableFuture</code>, assuming the order of the resulting <code>List</code> isn't
important:</p>
<div class="code"><pre class="code literal-block"><span class="nt">IntStream</span><span class="p">.</span><span class="nc">rangeClosed</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span><span class="w"> </span><span class="nt">300_000</span><span class="o">)</span>
<span class="w">         </span><span class="p">.</span><span class="nc">parallel</span><span class="o">()</span>
<span class="w">         </span><span class="p">.</span><span class="nc">mapToObj</span><span class="o">(</span><span class="nt">i</span><span class="w"> </span><span class="nt">-</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">web3</span><span class="p">.</span><span class="nc">ethGetBlockByNumber</span><span class="o">(</span><span class="nt">new</span><span class="w"> </span><span class="nt">DefaultBlockParameterNumber</span><span class="o">(</span><span class="nt">BigInteger</span><span class="p">.</span><span class="nc">valueOf</span><span class="o">(</span><span class="nt">i</span><span class="o">)),</span><span class="w"> </span><span class="nt">true</span><span class="o">)</span><span class="p">.</span><span class="nc">send</span><span class="o">())</span>
<span class="w">         </span><span class="p">.</span><span class="nc">filter</span><span class="o">(</span><span class="nt">Objects</span><span class="p">::</span><span class="nd">nonNull</span><span class="o">)</span>
<span class="w">         </span><span class="p">.</span><span class="nc">map</span><span class="o">(</span><span class="nt">EthBlock</span><span class="p">::</span><span class="nd">getBlock</span><span class="o">)</span>
<span class="w">         </span><span class="p">.</span><span class="nc">filter</span><span class="o">(</span><span class="nt">Objects</span><span class="p">::</span><span class="nd">nonNull</span><span class="o">)</span>
<span class="w">         </span><span class="p">.</span><span class="nc">collect</span><span class="o">(</span><span class="nt">Collectors</span><span class="p">.</span><span class="nc">toList</span><span class="o">());</span>
</pre></div>

<p>Because you stated that didn't help, let's try an <code>ExecutorService</code> that
utilizes a cached thread pool instead:</p>
<div class="code"><pre class="code literal-block"><span class="n">List</span><span class="o">&lt;</span><span class="n">EthBlock</span><span class="p">.</span><span class="n">Block</span><span class="o">&gt;</span><span class="w"> </span><span class="n">blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="n">synchronizedList</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="mi">300</span><span class="n">_000</span><span class="p">));</span>

<span class="n">ExecutorService</span><span class="w"> </span><span class="kr">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="n">newCachedThreadPool</span><span class="p">();</span>

<span class="n">for</span><span class="w"> </span><span class="p">(</span><span class="n">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">300</span><span class="n">_000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">BigInteger</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BigInteger</span><span class="p">.</span><span class="n">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

<span class="w">    </span><span class="kr">service</span><span class="p">.</span><span class="n">execute</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">EthBlock</span><span class="w"> </span><span class="n">eb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">web3</span><span class="p">.</span><span class="n">ethGetBlockByNumber</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">DefaultBlockParameterNumber</span><span class="p">(</span><span class="n">number</span><span class="p">),</span><span class="w"> </span><span class="kr">true</span><span class="p">).</span><span class="n">send</span><span class="p">();</span>

<span class="w">        </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">eb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kr">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">EthBlock</span><span class="p">.</span><span class="n">Block</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eb</span><span class="p">.</span><span class="n">getBlock</span><span class="p">();</span>

<span class="w">        </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">block</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">blocks</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">block</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ethereum-geth-cannot-connect-to-bootnode-to-access-private-ethereum-network/" class="u-url">Ethereum geth cannot connect to bootnode to access private ethereum network</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ethereum-geth-cannot-connect-to-bootnode-to-access-private-ethereum-network/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T05:40:27+08:00" itemprop="datePublished" title="2023-02-28 05:40">2023-02-28 05:40</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>The following <code>docker-compose.yml</code> is used to start an Ethereum <code>geth</code> node,
which needs to connect to a bootnode in order to access a private Ethereum
network.</p>
<div class="code"><pre class="code literal-block"><span class="nl">version</span><span class="p">:</span><span class="w"> </span><span class="sc">'2'</span>

<span class="w">    </span><span class="nl">geth</span><span class="p">:</span>
<span class="w">    </span><span class="nl">image</span><span class="p">:</span><span class="w"> </span><span class="n">ethereum</span><span class="o">/</span><span class="n">client</span><span class="o">-</span><span class="n">go</span><span class="o">:</span><span class="n">latest</span>
<span class="w">    </span><span class="nl">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">node</span><span class="o">:/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">ethereum</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">files</span><span class="o">/</span><span class="n">genesis</span><span class="p">.</span><span class="n">json</span><span class="o">:/</span><span class="n">root</span><span class="o">/</span><span class="n">genesis</span><span class="p">.</span><span class="n">json</span><span class="o">:</span><span class="n">ro</span>
<span class="w">    </span><span class="nl">ports</span><span class="p">:</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="s">"30303:30303"</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="s">"30303:30303/udp"</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="mi">8543</span><span class="o">:</span><span class="mi">8545</span>
<span class="w">    </span><span class="nl">command</span><span class="p">:</span><span class="w"> </span><span class="o">--</span><span class="n">rpc</span><span class="w"> </span><span class="o">--</span><span class="n">rpcaddr</span><span class="w"> </span><span class="mf">0.0.0.0</span><span class="w"> </span><span class="o">--</span><span class="n">networkid</span><span class="w"> </span><span class="mi">13377331</span><span class="w"> </span><span class="o">--</span><span class="n">bootnodes</span><span class="o">=</span><span class="s">"enode://692b8eda368ffc427fc1a047850557536a0ef0bfa3b66f998e03e8b83c3fd8f786e3c2b710a20e2e821a9eff34fc7b34ffa326a8a5fbcf3634b55b44596ada43@159.999.999.999:30303"</span><span class="w"> </span><span class="o">--</span><span class="n">nodiscover</span>
</pre></div>

<p>However after running <code>docker-compose up</code>, we see that the chain configuration
echoed is the default one, and not the config that the bootnode is using</p>
<blockquote>
<p>Initialised chain configuration config="{ChainID: 1 Homestead: 1150000 DAO:
1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000
Byzantium: 4370000 Constantinople: Engine: ethash}"</p>
</blockquote>
<p><strong>Question:</strong> Why is <code>geth</code> not connecting to the bootnode and not using the
config that the bootnode has in its <code>genesis.json</code>?</p>
<p><strong>docker-compose output:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">WARN</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.310</span><span class="o">]</span><span class="w"> </span><span class="n">Sanitizing</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">Go</span><span class="err">'</span><span class="n">s</span><span class="w"> </span><span class="n">GC</span><span class="w"> </span><span class="n">limits</span><span class="w">       </span><span class="n">provided</span><span class="o">=</span><span class="mi">1024</span><span class="w"> </span><span class="n">updated</span><span class="o">=</span><span class="mi">666</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.310</span><span class="o">]</span><span class="w"> </span><span class="n">Maximum</span><span class="w"> </span><span class="n">peer</span><span class="w"> </span><span class="nf">count</span><span class="w">                       </span><span class="n">ETH</span><span class="o">=</span><span class="mi">25</span><span class="w"> </span><span class="n">LES</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">total</span><span class="o">=</span><span class="mi">25</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.317</span><span class="o">]</span><span class="w"> </span><span class="n">Starting</span><span class="w"> </span><span class="n">peer</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="n">peer</span><span class="w"> </span><span class="n">node</span><span class="w">               </span><span class="n">instance</span><span class="o">=</span><span class="n">Geth</span><span class="o">/</span><span class="n">v1</span><span class="mf">.8.13</span><span class="o">-</span><span class="n">unstable</span><span class="o">-</span><span class="mf">2e0391</span><span class="n">ea</span><span class="o">/</span><span class="n">linux</span><span class="o">-</span><span class="n">amd64</span><span class="o">/</span><span class="n">go1</span><span class="mf">.10.3</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.317</span><span class="o">]</span><span class="w"> </span><span class="n">Allocated</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">handles</span><span class="w">         </span><span class="k">database</span><span class="o">=/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">ethereum</span><span class="o">/</span><span class="n">geth</span><span class="o">/</span><span class="n">chaindata</span><span class="w"> </span><span class="n">cache</span><span class="o">=</span><span class="mi">499</span><span class="w"> </span><span class="n">handles</span><span class="o">=</span><span class="mi">1024</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.331</span><span class="o">]</span><span class="w"> </span><span class="n">Writing</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">main</span><span class="o">-</span><span class="n">net</span><span class="w"> </span><span class="n">genesis</span><span class="w"> </span><span class="n">block</span><span class="w"> </span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.632</span><span class="o">]</span><span class="w"> </span><span class="n">Persisted</span><span class="w"> </span><span class="n">trie</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="k">database</span><span class="w">      </span><span class="n">nodes</span><span class="o">=</span><span class="mi">12356</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="mf">1.88</span><span class="n">mB</span><span class="w"> </span><span class="nc">time</span><span class="o">=</span><span class="mf">84.3549</span><span class="n">ms</span><span class="w"> </span><span class="n">gcnodes</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">gcsize</span><span class="o">=</span><span class="mf">0.00</span><span class="n">B</span><span class="w"> </span><span class="n">gctime</span><span class="o">=</span><span class="mi">0</span><span class="n">s</span><span class="w"> </span><span class="n">livenodes</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">livesize</span><span class="o">=</span><span class="mf">0.00</span><span class="n">B</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.636</span><span class="o">]</span><span class="w"> </span><span class="n">Initialised</span><span class="w"> </span><span class="n">chain</span><span class="w"> </span><span class="n">configuration</span><span class="w">          </span><span class="n">config</span><span class="o">=</span><span class="ss">"{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: &lt;nil&gt; Engine: ethash}"</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.636</span><span class="o">]</span><span class="w"> </span><span class="k">Disk</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ethash</span><span class="w"> </span><span class="n">caches</span><span class="w">   </span><span class="n">dir</span><span class="o">=/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">ethereum</span><span class="o">/</span><span class="n">geth</span><span class="o">/</span><span class="n">ethash</span><span class="w"> </span><span class="nf">count</span><span class="o">=</span><span class="mi">3</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.636</span><span class="o">]</span><span class="w"> </span><span class="k">Disk</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ethash</span><span class="w"> </span><span class="n">DAGs</span><span class="w">     </span><span class="n">dir</span><span class="o">=/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">ethash</span><span class="w">               </span><span class="nf">count</span><span class="o">=</span><span class="mi">2</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.636</span><span class="o">]</span><span class="w"> </span><span class="n">Initialising</span><span class="w"> </span><span class="n">Ethereum</span><span class="w"> </span><span class="n">protocol</span><span class="w">           </span><span class="n">versions</span><span class="o">=</span><span class="ss">"[63 62]"</span><span class="w"> </span><span class="n">network</span><span class="o">=</span><span class="mi">1</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.637</span><span class="o">]</span><span class="w"> </span><span class="n">Loaded</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="k">local</span><span class="w"> </span><span class="n">header</span><span class="w">          </span><span class="n">number</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">hash</span><span class="o">=</span><span class="n">d4e567</span><span class="err">…</span><span class="n">cb8fa3</span><span class="w"> </span><span class="n">td</span><span class="o">=</span><span class="mi">17179869184</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.637</span><span class="o">]</span><span class="w"> </span><span class="n">Loaded</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="k">local</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="n">block</span><span class="w">      </span><span class="n">number</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">hash</span><span class="o">=</span><span class="n">d4e567</span><span class="err">…</span><span class="n">cb8fa3</span><span class="w"> </span><span class="n">td</span><span class="o">=</span><span class="mi">17179869184</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.637</span><span class="o">]</span><span class="w"> </span><span class="n">Loaded</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="k">local</span><span class="w"> </span><span class="n">fast</span><span class="w"> </span><span class="n">block</span><span class="w">      </span><span class="n">number</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">hash</span><span class="o">=</span><span class="n">d4e567</span><span class="err">…</span><span class="n">cb8fa3</span><span class="w"> </span><span class="n">td</span><span class="o">=</span><span class="mi">17179869184</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.640</span><span class="o">]</span><span class="w"> </span><span class="n">Regenerated</span><span class="w"> </span><span class="k">local</span><span class="w"> </span><span class="k">transaction</span><span class="w"> </span><span class="n">journal</span><span class="w">    </span><span class="n">transactions</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">accounts</span><span class="o">=</span><span class="mi">0</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.640</span><span class="o">]</span><span class="w"> </span><span class="n">Starting</span><span class="w"> </span><span class="n">P2P</span><span class="w"> </span><span class="n">networking</span><span class="w"> </span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.641</span><span class="o">]</span><span class="w"> </span><span class="n">RLPx</span><span class="w"> </span><span class="n">listener</span><span class="w"> </span><span class="n">up</span><span class="w">                         </span><span class="n">self</span><span class="o">=</span><span class="ss">"enode://27175216e04387fb93e87a4069021b640fc6f87f985c86940e3297103a2b5e348bdecec4eea98af6ee2f106890fd28b49e1d983b6c5b8ce9ae1571c032bf2d5c@[::]:30303?discport=0"</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.644</span><span class="o">]</span><span class="w"> </span><span class="n">IPC</span><span class="w"> </span><span class="n">endpoint</span><span class="w"> </span><span class="n">opened</span><span class="w">                      </span><span class="n">url</span><span class="o">=/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">ethereum</span><span class="o">/</span><span class="n">geth</span><span class="p">.</span><span class="n">ipc</span>
<span class="n">geth_1</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">INFO</span><span class="w"> </span><span class="o">[</span><span class="n">07-15|00:48:33.645</span><span class="o">]</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="n">endpoint</span><span class="w"> </span><span class="n">opened</span><span class="w">                     </span><span class="n">url</span><span class="o">=</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="mf">0.0.0.0</span><span class="err">:</span><span class="mi">8545</span><span class="w">      </span><span class="n">cors</span><span class="o">=</span><span class="w"> </span><span class="n">vhosts</span><span class="o">=</span><span class="n">localhost</span>
</pre></div>

<p><strong>genesis.json</strong></p>
<div class="code"><pre class="code literal-block">{
    "config": {
    "chainId": 13377331,
    "homesteadBlock": 1,
    "eip150Block": 2,
    "eip150Hash": "0x0000000000000000000000000000000000000000000000000000000000000000",
    "eip155Block": 3,
    "eip158Block": 3,
    "byzantiumBlock": 4,
    "clique": {
        "period": 15,
        "epoch": 30000
    }
    },
....
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>It seems that you were using default datadir instead of your private datadir
initialized with genesis.json. As the result, geth started as a main network
node by using default datadir (see <code>database=/root/.ethereum/geth/chaindata</code>
and <code>versions="[63 62]" network=1</code> in the output).</p>
<p>To boot up your private node, try the following steps:</p>
<ol>
<li>Initialize your geth datadir with genesis.json. For example:</li>
</ol>
<p><code>geth --datadir path/to/custom/data/folder init genesis.json</code></p>
<ol>
<li>Start your geth by using the datadir and networkid. For example:</li>
</ol>
<p><code>geth --datadir path/to/custom/data/folder --networkid 13377331</code></p>
<p>Note that these steps use <code>--datadir</code> option.</p>
<p>For more information, see the geth wiki.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1521.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1519.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
