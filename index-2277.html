<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2277) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2277.html">
<link rel="prev" href="index-2278.html" type="text/html">
<link rel="next" href="index-2276.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-does-the-position-sticky-property-work/" class="u-url">How does the "position: sticky;" property work?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-does-the-position-sticky-property-work/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T04:13:02+08:00" itemprop="datePublished" title="2023-03-04 04:13">2023-03-04 04:13</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to make the navigation bar stick to the top of the viewport once a user
scrolls the page, but it's not working and I have no clue why. If you can
please help, here is my HTML and CSS code:</p>
<div class="code"><pre class="code literal-block">.container<span class="w"> </span>{
<span class="w">  </span>min-height:<span class="w"> </span>300vh;
}
.nav-selections<span class="w"> </span>{
<span class="w">  </span>text-transform:<span class="w"> </span>uppercase;
<span class="w">  </span>letter-spacing:<span class="w"> </span>5px;
<span class="w">  </span>font:<span class="w"> </span>18px<span class="w"> </span>"lato",sans-serif;
<span class="w">  </span>display:<span class="w"> </span>inline-block;
<span class="w">  </span>text-decoration:<span class="w"> </span>none;
<span class="w">  </span>color:<span class="w"> </span>white;
<span class="w">  </span>padding:<span class="w"> </span>18px;
<span class="w">  </span>float:<span class="w"> </span>right;
<span class="w">  </span>margin-left:<span class="w"> </span>50px;
<span class="w">  </span>transition:<span class="w"> </span>1.5s;
}

.nav-selections:hover{
<span class="w">  </span>transition:<span class="w"> </span>1.5s;
<span class="w">  </span>color:<span class="w"> </span>black;
}

ul<span class="w"> </span>{
<span class="w">  </span>background-color:<span class="w"> </span>#B79b58;
<span class="w">  </span>overflow:<span class="w"> </span>auto;
}

li<span class="w"> </span>{
<span class="w">  </span>list-style-type:<span class="w"> </span>none;
}


<span class="nt">&lt;main</span><span class="w"> </span><span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;nav</span><span class="w"> </span><span class="na">style=</span><span class="s">"position: sticky; position: -webkit-sticky;"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;ul</span><span class="w"> </span><span class="na">align=</span><span class="s">"left"</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#/contact"</span><span class="w"> </span><span class="na">class=</span><span class="s">"nav-selections"</span><span class="w"> </span><span class="na">style=</span><span class="s">"margin-right:35px;"</span><span class="nt">&gt;</span>Contact<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">      </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#/about"</span><span class="w"> </span><span class="na">class=</span><span class="s">"nav-selections"</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">      </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#/products"</span><span class="w"> </span><span class="na">class=</span><span class="s">"nav-selections"</span><span class="nt">&gt;</span>Products<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">      </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#"</span><span class="w"> </span><span class="na">class=</span><span class="s">"nav-selections"</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ul&gt;</span>
<span class="w">  </span><span class="nt">&lt;/nav&gt;</span>
<span class="nt">&lt;/main&gt;</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<blockquote>
<p>Sticky positioning is a hybrid of relative and fixed positioning. The
element is treated as relative positioned until it crosses a specified
threshold, at which point it is treated as fixed positioned.<br>
 ...<br><strong>You must specify a threshold with at least one of</strong> <code>top</code>, <code>right</code>,
<code>bottom</code>, or <code>left</code> <strong>for sticky positioning to behave as expected.</strong>
Otherwise, it will be indistinguishable from relative positioning. [source:
MDN]</p>
</blockquote>
<p>So in your example, you have to define the position where it should stick in
the end by using the <code>top</code> property.</p>
<div class="code"><pre class="code literal-block">html,<span class="w"> </span>body<span class="w"> </span>{
<span class="w">  </span>height:<span class="w"> </span>200%;
}

nav<span class="w"> </span>{
<span class="w">  </span>position:<span class="w"> </span>sticky;
<span class="w">  </span>position:<span class="w"> </span>-webkit-sticky;
<span class="w">  </span>top:<span class="w"> </span>0;<span class="w"> </span>/*<span class="w"> </span>required<span class="w"> </span>*/
}

.nav-selections<span class="w"> </span>{
<span class="w">  </span>text-transform:<span class="w"> </span>uppercase;
<span class="w">  </span>letter-spacing:<span class="w"> </span>5px;
<span class="w">  </span>font:<span class="w"> </span>18px<span class="w"> </span>"lato",<span class="w"> </span>sans-serif;
<span class="w">  </span>display:<span class="w"> </span>inline-block;
<span class="w">  </span>text-decoration:<span class="w"> </span>none;
<span class="w">  </span>color:<span class="w"> </span>white;
<span class="w">  </span>padding:<span class="w"> </span>18px;
<span class="w">  </span>float:<span class="w"> </span>right;
<span class="w">  </span>margin-left:<span class="w"> </span>50px;
<span class="w">  </span>transition:<span class="w"> </span>1.5s;
}

.nav-selections:hover<span class="w"> </span>{
<span class="w">  </span>transition:<span class="w"> </span>1.5s;
<span class="w">  </span>color:<span class="w"> </span>black;
}

ul<span class="w"> </span>{
<span class="w">  </span>background-color:<span class="w"> </span>#B79b58;
<span class="w">  </span>overflow:<span class="w"> </span>auto;
}

li<span class="w"> </span>{
<span class="w">  </span>list-style-type:<span class="w"> </span>none;
}


<span class="nt">&lt;nav&gt;</span>
<span class="w">  </span><span class="nt">&lt;ul</span><span class="w"> </span><span class="na">align=</span><span class="s">"left"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#/contact"</span><span class="w"> </span><span class="na">class=</span><span class="s">"nav-selections"</span><span class="w"> </span><span class="na">style=</span><span class="s">"margin-right:35px;"</span><span class="nt">&gt;</span>Contact<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">    </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#/about"</span><span class="w"> </span><span class="na">class=</span><span class="s">"nav-selections"</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">    </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#/products"</span><span class="w"> </span><span class="na">class=</span><span class="s">"nav-selections"</span><span class="nt">&gt;</span>Products<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">    </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#"</span><span class="w"> </span><span class="na">class=</span><span class="s">"nav-selections"</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<blockquote>
<p>Sticky positioning is a hybrid of relative and fixed positioning. The
element is treated as relative positioned until it crosses a specified
threshold, at which point it is treated as fixed positioned.<br>
 ...<br><strong>You must specify a threshold with at least one of</strong> <code>top</code>, <code>right</code>,
<code>bottom</code>, or <code>left</code> <strong>for sticky positioning to behave as expected.</strong>
Otherwise, it will be indistinguishable from relative positioning. [source:
MDN]</p>
</blockquote>
<p>So in your example, you have to define the position where it should stick in
the end by using the <code>top</code> property.</p>
<div class="code"><pre class="code literal-block">html,<span class="w"> </span>body<span class="w"> </span>{
<span class="w">  </span>height:<span class="w"> </span>200%;
}

nav<span class="w"> </span>{
<span class="w">  </span>position:<span class="w"> </span>sticky;
<span class="w">  </span>position:<span class="w"> </span>-webkit-sticky;
<span class="w">  </span>top:<span class="w"> </span>0;<span class="w"> </span>/*<span class="w"> </span>required<span class="w"> </span>*/
}

.nav-selections<span class="w"> </span>{
<span class="w">  </span>text-transform:<span class="w"> </span>uppercase;
<span class="w">  </span>letter-spacing:<span class="w"> </span>5px;
<span class="w">  </span>font:<span class="w"> </span>18px<span class="w"> </span>"lato",<span class="w"> </span>sans-serif;
<span class="w">  </span>display:<span class="w"> </span>inline-block;
<span class="w">  </span>text-decoration:<span class="w"> </span>none;
<span class="w">  </span>color:<span class="w"> </span>white;
<span class="w">  </span>padding:<span class="w"> </span>18px;
<span class="w">  </span>float:<span class="w"> </span>right;
<span class="w">  </span>margin-left:<span class="w"> </span>50px;
<span class="w">  </span>transition:<span class="w"> </span>1.5s;
}

.nav-selections:hover<span class="w"> </span>{
<span class="w">  </span>transition:<span class="w"> </span>1.5s;
<span class="w">  </span>color:<span class="w"> </span>black;
}

ul<span class="w"> </span>{
<span class="w">  </span>background-color:<span class="w"> </span>#B79b58;
<span class="w">  </span>overflow:<span class="w"> </span>auto;
}

li<span class="w"> </span>{
<span class="w">  </span>list-style-type:<span class="w"> </span>none;
}


<span class="nt">&lt;nav&gt;</span>
<span class="w">  </span><span class="nt">&lt;ul</span><span class="w"> </span><span class="na">align=</span><span class="s">"left"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#/contact"</span><span class="w"> </span><span class="na">class=</span><span class="s">"nav-selections"</span><span class="w"> </span><span class="na">style=</span><span class="s">"margin-right:35px;"</span><span class="nt">&gt;</span>Contact<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">    </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#/about"</span><span class="w"> </span><span class="na">class=</span><span class="s">"nav-selections"</span><span class="nt">&gt;</span>About<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">    </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#/products"</span><span class="w"> </span><span class="na">class=</span><span class="s">"nav-selections"</span><span class="nt">&gt;</span>Products<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">    </span><span class="nt">&lt;li&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#"</span><span class="w"> </span><span class="na">class=</span><span class="s">"nav-selections"</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="w">  </span><span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/nav&gt;</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-does-the-rust-compiler-not-optimize-code-assuming-that-two-mutable-references-cannot-alias/" class="u-url">Why does the Rust compiler not optimize code assuming that two mutable references cannot alias?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-does-the-rust-compiler-not-optimize-code-assuming-that-two-mutable-references-cannot-alias/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T04:11:49+08:00" itemprop="datePublished" title="2023-03-04 04:11">2023-03-04 04:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>As far as I know, reference/pointer aliasing can hinder the compiler's ability
to generate optimized code, since they must ensure the generated binary
behaves correctly in the case where the two references/pointers indeed alias.
For instance, in the following C code,</p>
<div class="code"><pre class="code literal-block">void adds(int *a, int *b) {
    *a += *b;
    *a += *b;
}
</pre></div>

<p>when compiled by <code>clang version 6.0.0-1ubuntu2 (tags/RELEASE_600/final)</code> with
the <code>-O3</code> flag, it emits</p>
<div class="code"><pre class="code literal-block"><span class="mi">0000000000000000</span><span class="w"> </span><span class="o">&lt;</span><span class="n">adds</span><span class="o">&gt;</span><span class="p">:</span>
<span class="w">   </span><span class="mi">0</span><span class="p">:</span><span class="w">    </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">07</span><span class="w">                    </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">rdi</span><span class="p">),</span><span class="o">%</span><span class="n">eax</span><span class="w">  </span><span class="c1"># load a into EAX</span>
<span class="w">   </span><span class="mi">2</span><span class="p">:</span><span class="w">    </span><span class="mi">03</span><span class="w"> </span><span class="mi">06</span><span class="w">                    </span><span class="n">add</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">eax</span><span class="w">  </span><span class="c1"># load-and-add b</span>
<span class="w">   </span><span class="mi">4</span><span class="p">:</span><span class="w">    </span><span class="mi">89</span><span class="w"> </span><span class="mi">07</span><span class="w">                    </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">eax</span><span class="p">,(</span><span class="o">%</span><span class="n">rdi</span><span class="p">)</span><span class="w">  </span><span class="c1"># store into a</span>
<span class="w">   </span><span class="mi">6</span><span class="p">:</span><span class="w">    </span><span class="mi">03</span><span class="w"> </span><span class="mi">06</span><span class="w">                    </span><span class="n">add</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">eax</span><span class="w">  </span><span class="c1"># load-and-add b again</span>
<span class="w">   </span><span class="mi">8</span><span class="p">:</span><span class="w">    </span><span class="mi">89</span><span class="w"> </span><span class="mi">07</span><span class="w">                    </span><span class="n">mov</span><span class="w">    </span><span class="o">%</span><span class="n">eax</span><span class="p">,(</span><span class="o">%</span><span class="n">rdi</span><span class="p">)</span><span class="w">  </span><span class="c1"># store into a again</span>
<span class="w">   </span><span class="n">a</span><span class="p">:</span><span class="w">    </span><span class="n">c3</span><span class="w">                       </span><span class="n">retq</span>
</pre></div>

<p>Here the code stores back to <code>(%rdi)</code> twice in case <code>int *a</code> and <code>int *b</code>
alias.</p>
<p>When we explicitly tell the compiler that these two pointers cannot alias with
the <code>restrict</code> keyword:</p>
<div class="code"><pre class="code literal-block">void adds(int *restrict a, int *restrict b) {
    *a += *b;
    *a += *b;
}
</pre></div>

<p>Then Clang will emit a more optimized version that effectively does <code>*a += 2 *
(*b)</code>, which is equivalent if (as promised by <code>restrict</code>) <code>*b</code> isn't modified
by assigning to <code>*a</code>:</p>
<div class="code"><pre class="code literal-block"><span class="mi">0000000000000000</span><span class="w"> </span><span class="o">&lt;</span><span class="n">adds</span><span class="o">&gt;</span><span class="p">:</span>
<span class="w">   </span><span class="mi">0</span><span class="p">:</span><span class="w">    </span><span class="mi">8</span><span class="n">b</span><span class="w"> </span><span class="mi">06</span><span class="w">                    </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="o">%</span><span class="n">rsi</span><span class="p">),</span><span class="o">%</span><span class="n">eax</span><span class="w">   </span><span class="c1"># load b once</span>
<span class="w">   </span><span class="mi">2</span><span class="p">:</span><span class="w">    </span><span class="mi">01</span><span class="w"> </span><span class="n">c0</span><span class="w">                    </span><span class="n">add</span><span class="w">    </span><span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="o">%</span><span class="n">eax</span><span class="w">     </span><span class="c1"># double it</span>
<span class="w">   </span><span class="mi">4</span><span class="p">:</span><span class="w">    </span><span class="mi">01</span><span class="w"> </span><span class="mi">07</span><span class="w">                    </span><span class="n">add</span><span class="w">    </span><span class="o">%</span><span class="n">eax</span><span class="p">,(</span><span class="o">%</span><span class="n">rdi</span><span class="p">)</span><span class="w">   </span><span class="c1"># *a += 2 * (*b)</span>
<span class="w">   </span><span class="mi">6</span><span class="p">:</span><span class="w">    </span><span class="n">c3</span><span class="w">                       </span><span class="n">retq</span>
</pre></div>

<p>Since Rust makes sure (except in unsafe code) that two mutable references
cannot alias, I would think that the compiler should be able to emit the more
optimized version of the code.</p>
<p>When I test with the code below and compile it with <code>rustc 1.35.0</code> with <code>-C
opt-level=3 --emit obj</code>,</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="posts/why-does-the-rust-compiler-not-optimize-code-assuming-that-two-mutable-references-cannot-alias/#-1"><code data-line-number="1"></code></a></td>
<td class="code"><code><span class="err">#</span><span class="o">[</span><span class="n">no_mangle</span><span class="o">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-does-the-rust-compiler-not-optimize-code-assuming-that-two-mutable-references-cannot-alias/#-2"><code data-line-number="2"></code></a></td>
<td class="code"><code><span class="n">fn</span><span class="w"> </span><span class="n">adds</span><span class="p">(</span><span class="nl">a</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mut</span><span class="w"> </span><span class="n">i32</span><span class="p">,</span><span class="w"> </span><span class="nl">b</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mut</span><span class="w"> </span><span class="n">i32</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-does-the-rust-compiler-not-optimize-code-assuming-that-two-mutable-references-cannot-alias/#-3"><code data-line-number="3"></code></a></td>
<td class="code"><code><span class="w">    </span><span class="o">*</span><span class="n">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-does-the-rust-compiler-not-optimize-code-assuming-that-two-mutable-references-cannot-alias/#-4"><code data-line-number="4"></code></a></td>
<td class="code"><code><span class="w">    </span><span class="o">*</span><span class="n">a</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-does-the-rust-compiler-not-optimize-code-assuming-that-two-mutable-references-cannot-alias/#-5"><code data-line-number="5"></code></a></td>
<td class="code"><code><span class="err">}</span>
</code></td>
</tr>
</table></div>
<p>it generates:</p>
<div class="code"><pre class="code literal-block"><span class="mf">0000000000000000</span><span class="w"> </span><span class="o">&lt;</span><span class="n">adds</span><span class="o">&gt;</span><span class="p">:</span>
<span class="w">   </span><span class="mf">0</span><span class="p">:</span><span class="w">    </span><span class="mf">8</span><span class="n">b</span><span class="w"> </span><span class="mf">07</span><span class="w">                    </span><span class="n">mov</span><span class="w">    </span><span class="p">(</span><span class="err">%</span><span class="n">rdi</span><span class="p">),</span><span class="err">%</span><span class="n">eax</span>
<span class="w">   </span><span class="mf">2</span><span class="p">:</span><span class="w">    </span><span class="mf">03</span><span class="w"> </span><span class="mf">06</span><span class="w">                    </span><span class="n">add</span><span class="w">    </span><span class="p">(</span><span class="err">%</span><span class="n">rsi</span><span class="p">),</span><span class="err">%</span><span class="n">eax</span>
<span class="w">   </span><span class="mf">4</span><span class="p">:</span><span class="w">    </span><span class="mf">89</span><span class="w"> </span><span class="mf">07</span><span class="w">                    </span><span class="n">mov</span><span class="w">    </span><span class="err">%</span><span class="n">eax</span><span class="p">,(</span><span class="err">%</span><span class="n">rdi</span><span class="p">)</span>
<span class="w">   </span><span class="mf">6</span><span class="p">:</span><span class="w">    </span><span class="mf">03</span><span class="w"> </span><span class="mf">06</span><span class="w">                    </span><span class="n">add</span><span class="w">    </span><span class="p">(</span><span class="err">%</span><span class="n">rsi</span><span class="p">),</span><span class="err">%</span><span class="n">eax</span>
<span class="w">   </span><span class="mf">8</span><span class="p">:</span><span class="w">    </span><span class="mf">89</span><span class="w"> </span><span class="mf">07</span><span class="w">                    </span><span class="n">mov</span><span class="w">    </span><span class="err">%</span><span class="n">eax</span><span class="p">,(</span><span class="err">%</span><span class="n">rdi</span><span class="p">)</span>
<span class="w">   </span><span class="n">a</span><span class="p">:</span><span class="w">    </span><span class="n">c3</span><span class="w">                       </span><span class="n">retq</span>
</pre></div>

<p>This does not take advantage of the guarantee that <code>a</code> and <code>b</code> cannot alias.</p>
<p>Is this because the current Rust compiler is still in development and has not
yet incorporated alias analysis to do the optimization?</p>
<p>Is this because there is still a chance that <code>a</code> and <code>b</code> could alias, even in
safe Rust?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Rust originally <em>did</em> enable LLVM's <code>noalias</code> attribute, but this caused
miscompiled code. When all supported LLVM versions no longer miscompile the
code, it will be re-enabled.</p>
<p>If you add <code>-Zmutable-noalias=yes</code> to the compiler options, you get the
expected assembly:</p>
<div class="code"><pre class="code literal-block"><span class="nl">adds</span><span class="p">:</span>
<span class="w">        </span><span class="n">mov</span><span class="w">     </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">[</span><span class="n">rsi</span><span class="o">]</span>
<span class="w">        </span><span class="k">add</span><span class="w">     </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="n">eax</span>
<span class="w">        </span><span class="k">add</span><span class="w">     </span><span class="n">dword</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">[</span><span class="n">rdi</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">eax</span>
<span class="w">        </span><span class="n">ret</span>
</pre></div>

<p>Simply put, Rust put the equivalent of C's <code>restrict</code> keyword <strong>everywhere</strong> ,
far more prevalent than any usual C program. This exercised corner cases of
LLVM more than it was able to handle correctly. It turns out that C and C++
programmers simply don't use <code>restrict</code> as frequently as <code>&amp;mut</code> is used in
Rust.</p>
<p>This has happened <strong>multiple times</strong>.</p>
<ul>
<li>Rust 1.0 through 1.7 — <code>noalias</code> enabled</li>
<li>Rust 1.8 through 1.27 — <code>noalias</code> disabled</li>
<li>Rust 1.28 through 1.29 — <code>noalias</code> enabled</li>
<li>Rust 1.30 through 1.54 — <code>noalias</code> disabled</li>
<li>Rust 1.54 through ??? — <code>noalias</code> conditionally enabled depending on the version of LLVM the compiler uses</li>
</ul>
<h4>Related Rust issues</h4>
<ul>
<li>
<p>Current case</p>
<ul>
<li>Incorrect code generation for nalgebra's Matrix::swap_rows() #54462</li>
<li>Re-enable noalias annotations by default once LLVM no longer miscompiles them #54878</li>
<li>Enable mutable noalias for LLVM &gt;= 12 #82834</li>
<li>Regression: Miscompilation due to bug in "mutable noalias" logic #84958</li>
<li>
<p>Previous case</p>
</li>
<li>
<p>Workaround LLVM optimizer bug by not marking &amp;mut pointers as noalias #31545</p>
</li>
<li>Mark &amp;mut pointers as noalias once LLVM no longer miscompiles them #31681</li>
<li>
<p>Other</p>
</li>
<li>
<p>make use of LLVM's scoped noalias metadata #16515</p>
</li>
<li>Missed optimization: references from pointers aren't treated as noalias #38941</li>
<li>noalias is not enough #53105</li>
<li>mutable noalias: re-enable permanently, only for panic=abort, or stabilize flag? #45029</li>
</ul>
</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-s-the-difference-between-charfield-and-textfield-in-django/" class="u-url">What's the difference between CharField and TextField in Django?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-s-the-difference-between-charfield-and-textfield-in-django/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T04:10:47+08:00" itemprop="datePublished" title="2023-03-04 04:10">2023-03-04 04:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>The documentation says that <code>CharField()</code> should be used for smaller strings
and <code>TextField()</code> should be used for larger strings.</p>
<p>Okay, but where is the line drawn between "small" and "large"? What's going on
under the hood here that makes this the case?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>It's a difference between RDBMS's <code>varchar</code> (or similar) — those are usually
specified with a maximum length, and might be more efficient in terms of
performance or storage — and <code>text</code> (or similar) types — those are usually
limited only by hardcoded implementation limits (not a DB schema).</p>
<p>PostgreSQL 9, specifically, states that "There is no performance difference
among these three types", but AFAIK there are some differences in e.g. MySQL,
so this is something to keep in mind.</p>
<p>A good rule of thumb is that you use <code>CharField</code> when you need to limit the
maximum length, <code>TextField</code> otherwise.</p>
<p>This is not really Django-specific, also.</p>
<p><br></p>
<h3>Suggest</h3>
<p>In some cases it is tied to how the field is used. In some DB engines the
field differences determine how (and if) you search for text in the field.
CharFields are typically used for things that are searchable, like if you want
to search for "one" in the string "one plus two". Since the strings are
shorter they are less time consuming for the engine to search through.
TextFields are typically not meant to be searched through (like maybe the body
of a blog) but are meant to hold large chunks of text. Now most of this
depends on the DB Engine and like in Postgres it does not matter.</p>
<p>Even if it does not matter, if you use ModelForms you get a different type of
editing field in the form. The ModelForm will generate an HTML form the size
of one line of text for a CharField and multiline for a TextField.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2278.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2276.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
