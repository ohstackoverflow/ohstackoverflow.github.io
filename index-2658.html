<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2658) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2658.html">
<link rel="prev" href="index-2659.html" type="text/html">
<link rel="next" href="index-2657.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/searching-for-uuids-in-text-with-regex/" class="u-url">Searching for UUIDs in text with regex</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/searching-for-uuids-in-text-with-regex/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T08:16:30+08:00" itemprop="datePublished" title="2023-03-05 08:16">2023-03-05 08:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm searching for UUIDs in blocks of text using a regex. Currently I'm relying
on the assumption that all UUIDs will follow a patttern of 8-4-4-4-12
hexadecimal digits.</p>
<p>Can anyone think of a use case where this assumption would be invalid and
would cause me to miss some UUIDs?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I agree that by definition your regex does not miss any UUID. However it may
be useful to note that if you are searching especially for Microsoft's
Globally Unique Identifiers (GUIDs), there are five equivalent string
representations for a GUID:</p>
<div class="code"><pre class="code literal-block">"ca761232ed4211cebacd00aa0057b223"

"CA761232-ED42-11CE-BACD-00AA0057B223"

"{CA761232-ED42-11CE-BACD-00AA0057B223}"

"(CA761232-ED42-11CE-BACD-00AA0057B223)"

"{0xCA761232, 0xED42, 0x11CE, {0xBA, 0xCD, 0x00, 0xAA, 0x00, 0x57, 0xB2, 0x23}}"
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>@ivelin: UUID can have capitals. So you'll either need to toLowerCase() the
string or use:</p>
<p><code>[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}</code></p>
<p>Would have just commented this but not enough rep :)</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/when-saving-how-can-you-check-if-a-field-has-changed/" class="u-url">When saving, how can you check if a field has changed?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/when-saving-how-can-you-check-if-a-field-has-changed/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T08:15:33+08:00" itemprop="datePublished" title="2023-03-05 08:15">2023-03-05 08:15</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In my model I have :</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">Alias</span><span class="p">(</span><span class="n">MyBaseModel</span><span class="p">):</span>
<span class="n">remote_image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span>
<span class="w">    </span><span class="n">max_length</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="o">=</span><span class="n">True</span><span class="p">,</span>
<span class="w">    </span><span class="n">help_text</span><span class="o">=</span><span class="s1">'''</span>
<span class="s1">        A URL that is downloaded and cached for the image.</span>
<span class="s1">        Only used when the alias is made</span>
<span class="s1">    '''</span>
<span class="p">)</span>
<span class="w">    </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span>
<span class="w">        </span><span class="n">upload_to</span><span class="o">=</span><span class="s1">'alias'</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="o">=</span><span class="s1">'alias-default.png'</span><span class="p">,</span>
<span class="w">        </span><span class="n">help_text</span><span class="o">=</span><span class="s2">"An image representing the alias"</span>
<span class="w">    </span><span class="p">)</span>


<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">not</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'alias-default.png'</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">remote_image</span><span class="w"> </span><span class="p">:</span>
<span class="w">            </span><span class="n">try</span><span class="w"> </span><span class="p">:</span>
<span class="w">                </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utils</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remote_image</span><span class="p">)</span>
<span class="w">                </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="w">                </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="w">                </span><span class="n">buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<span class="w">                </span><span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="o">=</span><span class="s1">'PNG'</span><span class="p">)</span>
<span class="w">                </span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
<span class="w">                    </span><span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">string_id</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".png"</span><span class="p">,</span><span class="w"> </span><span class="n">ContentFile</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="n">except</span><span class="w"> </span><span class="n">IOError</span><span class="w"> </span><span class="p">:</span>
<span class="w">                </span><span class="k">pass</span>
</pre></div>

<p>Which works great for the first time the <code>remote_image</code> changes.</p>
<p>How can I fetch a new image when someone has modified the <code>remote_image</code> on
the alias? And secondly, is there a better way to cache a remote image?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Essentially, you want to override the <code>__init__</code> method of <code>models.Model</code> so
that you keep a copy of the original value. This makes it so that you don't
have to do another DB lookup (which is always a good thing).</p>
<div class="code"><pre class="code literal-block">    <span class="k">class</span> <span class="n">Person</span>(<span class="n">models</span>.<span class="n">Model</span>):
        <span class="nb">name</span> = <span class="n">models</span>.<span class="n">CharField</span>()

        <span class="n">__original_name</span> = <span class="n">None</span>

        <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, *<span class="nb">args</span>, **<span class="n">kwargs</span>):
            <span class="n">super</span>().<span class="n">__init__</span>(*<span class="nb">args</span>, **<span class="n">kwargs</span>)
            <span class="nb">self</span>.<span class="n">__original_name</span> = <span class="nb">self</span>.<span class="nb">name</span>

        <span class="n">def</span> <span class="n">save</span>(<span class="nb">self</span>, <span class="n">force_insert</span>=<span class="nb">False</span>, <span class="n">force_update</span>=<span class="nb">False</span>, *<span class="nb">args</span>, **<span class="n">kwargs</span>):
            <span class="k">if</span> <span class="nb">self</span>.<span class="nb">name</span> != <span class="nb">self</span>.<span class="n">__original_name:</span>
                <span class="c1"># name changed - do something here</span>

            <span class="n">super</span>().<span class="n">save</span>(<span class="n">force_insert</span>, <span class="n">force_update</span>, *<span class="nb">args</span>, **<span class="n">kwargs</span>)
            <span class="nb">self</span>.<span class="n">__original_name</span> = <span class="nb">self</span>.<span class="nb">name</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I use following mixin:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">django.forms.models</span> <span class="kn">import</span> <span class="n">model_to_dict</span>


<span class="k">class</span> <span class="nc">ModelDiffMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    A model mixin that tracks model fields' values and provide some useful api</span>
<span class="sd">    to know what fields have been changed.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ModelDiffMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__initial</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span>
        <span class="n">diffs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">changed_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_field_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Returns a diff for field if it's changed and None otherwise.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Saves model and set initial state.</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ModelDiffMixin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">model_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">])</span>
</pre></div>

<p>Usage:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; p = Place()
&gt;&gt;&gt; p.has_changed
False
&gt;&gt;&gt; p.changed_fields
[]
&gt;&gt;&gt; p.rank = 42
&gt;&gt;&gt; p.has_changed
True
&gt;&gt;&gt; p.changed_fields
['rank']
&gt;&gt;&gt; p.diff
{'rank': (0, 42)}
&gt;&gt;&gt; p.categories = [1, 3, 5]
&gt;&gt;&gt; p.diff
{'categories': (None, [1, 3, 5]), 'rank': (0, 42)}
&gt;&gt;&gt; p.get_field_diff('categories')
(None, [1, 3, 5])
&gt;&gt;&gt; p.get_field_diff('rank')
(0, 42)
&gt;&gt;&gt;
</pre></div>

<hr>
<h3>Note</h3>
<p>Please note that this solution works well in context of current request only.
Thus it's suitable primarily for simple cases. In concurrent environment where
multiple requests can manipulate the same model instance at the same time, you
definitely need a different approach.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-implement-an-stl-style-iterator-and-avoid-common-pitfalls/" class="u-url">How to implement an STL-style iterator and avoid common pitfalls?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-implement-an-stl-style-iterator-and-avoid-common-pitfalls/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T08:14:47+08:00" itemprop="datePublished" title="2023-03-05 08:14">2023-03-05 08:14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I made a collection for which I want to provide an STL-style, random-access
iterator. I was searching around for an example implementation of an iterator
but I didn't find any. I know about the need for const overloads of <code>[]</code> and
<code>*</code> operators. What are the requirements for an iterator to be "STL-style" and
what are some other pitfalls to avoid (if any)?</p>
<p>Additional context: This is for a library and I don't want to introduce any
dependency on it unless I really need to. I write my own collection to be able
to provide binary compatibility between C++03 and C++11 with the same compiler
(so no STL which would probably break).</p>
<p><br><br></p>
<h2>Answer</h2>
<p>https://cplusplus.com/reference/iterator/ has a handy chart that details the
specs of § 24.2.2 of the C++11 standard. Basically, the iterators have tags
that describe the valid operations, and the tags have a hierarchy. Below is
purely symbolic, these classes don't actually exist as such.</p>
<div class="code"><pre class="code literal-block"><span class="n">iterator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">iterator</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">);</span>
<span class="w">    </span><span class="o">~</span><span class="n">iterator</span><span class="p">();</span>
<span class="w">    </span><span class="n">iterator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">);</span>
<span class="w">    </span><span class="n">iterator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">++</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="n">prefix</span><span class="w"> </span><span class="n">increment</span>
<span class="w">    </span><span class="n">reference</span><span class="w"> </span><span class="n">operator</span><span class="o">*</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="n">friend</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">swap</span><span class="p">(</span><span class="n">iterator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">lhs</span><span class="p">,</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rhs</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">C</span><span class="o">++</span><span class="mi">11</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">think</span>
<span class="p">};</span>

<span class="n">input_iterator</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">virtual</span><span class="w"> </span><span class="n">iterator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">iterator</span><span class="w"> </span><span class="n">operator</span><span class="o">++</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">postfix</span><span class="w"> </span><span class="n">increment</span>
<span class="w">    </span><span class="n">value_type</span><span class="w"> </span><span class="n">operator</span><span class="o">*</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="n">pointer</span><span class="w"> </span><span class="n">operator</span><span class="o">-&gt;</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="n">friend</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="n">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">);</span>
<span class="w">    </span><span class="n">friend</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="n">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">);</span><span class="w"> </span>
<span class="p">};</span>
<span class="o">//</span><span class="n">once</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">iterator</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">dereferenced</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span>
<span class="o">//</span><span class="n">undefined</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">dereference</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">that</span><span class="o">.</span>

<span class="n">output_iterator</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">virtual</span><span class="w"> </span><span class="n">iterator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">reference</span><span class="w"> </span><span class="n">operator</span><span class="o">*</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">    </span><span class="n">iterator</span><span class="w"> </span><span class="n">operator</span><span class="o">++</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">postfix</span><span class="w"> </span><span class="n">increment</span>
<span class="p">};</span>
<span class="o">//</span><span class="n">dereferences</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">left</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">assignment</span>
<span class="o">//</span><span class="n">once</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">iterator</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">dereferenced</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span>
<span class="o">//</span><span class="n">undefined</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">dereference</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">that</span><span class="o">.</span>

<span class="n">forward_iterator</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">input_iterator</span><span class="p">,</span><span class="w"> </span><span class="n">output_iterator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">forward_iterator</span><span class="p">();</span>
<span class="p">};</span>
<span class="o">//</span><span class="n">multiple</span><span class="w"> </span><span class="n">passes</span><span class="w"> </span><span class="n">allowed</span>

<span class="n">bidirectional_iterator</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">forward_iterator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">iterator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">--</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="n">prefix</span><span class="w"> </span><span class="n">decrement</span>
<span class="w">    </span><span class="n">iterator</span><span class="w"> </span><span class="n">operator</span><span class="o">--</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">postfix</span><span class="w"> </span><span class="n">decrement</span>
<span class="p">};</span>

<span class="n">random_access_iterator</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">bidirectional_iterator</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">friend</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="n">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">);</span>
<span class="w">    </span><span class="n">friend</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="n">operator</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">);</span>
<span class="w">    </span><span class="n">friend</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="n">operator</span><span class="o">&lt;=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">);</span>
<span class="w">    </span><span class="n">friend</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="n">operator</span><span class="o">&gt;=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">);</span>

<span class="w">    </span><span class="n">iterator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">+=</span><span class="p">(</span><span class="n">size_type</span><span class="p">);</span>
<span class="w">    </span><span class="n">friend</span><span class="w"> </span><span class="n">iterator</span><span class="w"> </span><span class="n">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">size_type</span><span class="p">);</span>
<span class="w">    </span><span class="n">friend</span><span class="w"> </span><span class="n">iterator</span><span class="w"> </span><span class="n">operator</span><span class="o">+</span><span class="p">(</span><span class="n">size_type</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">);</span>
<span class="w">    </span><span class="n">iterator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">-=</span><span class="p">(</span><span class="n">size_type</span><span class="p">);</span><span class="w">  </span>
<span class="w">    </span><span class="n">friend</span><span class="w"> </span><span class="n">iterator</span><span class="w"> </span><span class="n">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">iterator</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">size_type</span><span class="p">);</span>
<span class="w">    </span><span class="n">friend</span><span class="w"> </span><span class="n">difference_type</span><span class="w"> </span><span class="n">operator</span><span class="o">-</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span><span class="w"> </span><span class="n">iterator</span><span class="p">);</span>

<span class="w">    </span><span class="n">reference</span><span class="w"> </span><span class="n">operator</span><span class="p">[](</span><span class="n">size_type</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">contiguous_iterator</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">random_access_iterator</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="n">C</span><span class="o">++</span><span class="mi">17</span>
<span class="p">};</span><span class="w"> </span><span class="o">//</span><span class="n">elements</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">contiguously</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">memory</span><span class="o">.</span>
</pre></div>

<p>You can either specialize <code>std::iterator_traits&lt;youriterator&gt;</code>, or put the
same typedefs in the iterator itself, or inherit from <code>std::iterator</code> (which
has these typedefs). I prefer the second option, to avoid changing things in
the <code>std</code> namespace, and for readability, but most people inherit from
<code>std::iterator</code>.</p>
<div class="code"><pre class="code literal-block"><span class="n">struct</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">iterator_traits</span><span class="o">&lt;</span><span class="n">youriterator</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">        </span>
<span class="w">    </span><span class="n">typedef</span><span class="w"> </span><span class="err">????</span><span class="w"> </span><span class="n">difference_type</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="n">almost</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">ptrdiff_t</span>
<span class="w">    </span><span class="n">typedef</span><span class="w"> </span><span class="err">????</span><span class="w"> </span><span class="n">value_type</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="n">almost</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">T</span>
<span class="w">    </span><span class="n">typedef</span><span class="w"> </span><span class="err">????</span><span class="w"> </span><span class="n">reference</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="n">almost</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span>
<span class="w">    </span><span class="n">typedef</span><span class="w"> </span><span class="err">????</span><span class="w"> </span><span class="n">pointer</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="n">almost</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">*</span>
<span class="w">    </span><span class="n">typedef</span><span class="w"> </span><span class="err">????</span><span class="w"> </span><span class="n">iterator_category</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="n">usually</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">forward_iterator_tag</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">similar</span>
<span class="p">};</span>
</pre></div>

<p>Note the iterator_category should be one of <code>std::input_iterator_tag</code>,
<code>std::output_iterator_tag</code>, <code>std::forward_iterator_tag</code>,
<code>std::bidirectional_iterator_tag</code>, or <code>std::random_access_iterator_tag</code>,
depending on which requirements your iterator satisfies. Depending on your
iterator, you may choose to specialize <code>std::next</code>, <code>std::prev</code>,
<code>std::advance</code>, and <code>std::distance</code> as well, but this is rarely needed. In
<em>extremely rare</em> cases you may wish to specialize <code>std::begin</code> and <code>std::end</code>.</p>
<p>Your container should probably also have a <code>const_iterator</code>, which is a
(possibly mutable) iterator to constant data that is similar to your
<code>iterator</code> except it should be implicitly constructable from a <code>iterator</code> and
users should be unable to modify the data. It is common for its internal
pointer to be a pointer to non-constant data, and have <code>iterator</code> inherit from
<code>const_iterator</code> so as to minimize code duplication.</p>
<p>My post at Writing your own STL Container has a more complete
container/iterator prototype.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The iterator_facade documentation from Boost.Iterator provides what looks like
a nice tutorial on implementing iterators for a linked list. Could you use
that as a starting point for building a random-access iterator over your
container?</p>
<p>If nothing else, you can take a look at the member functions and typedefs
provided by <code>iterator_facade</code> and use it as a starting point for building your
own.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2659.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2657.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
