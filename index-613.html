<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 613) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-613.html">
<link rel="prev" href="index-614.html" type="text/html">
<link rel="next" href="index-612.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/could-not-find-a-declaration-file-for-module-module-name-path-to-module-name-js-implicitly-has-an-any-type/" class="u-url">Could not find a declaration file for module 'module-name'. '/path/to/module-name.js' implicitly has an 'any' type</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/could-not-find-a-declaration-file-for-module-module-name-path-to-module-name-js-implicitly-has-an-any-type/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T11:21:59+08:00" itemprop="datePublished" title="2023-02-17 11:21">2023-02-17 11:21</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I read how TypeScript module resolution works.</p>
<p>I have the following repository: @ts-stack/di. After compiling the directory
structure is as follows:</p>
<div class="code"><pre class="code literal-block">├── dist
│   ├── annotations.d.ts
│   ├── annotations.js
│   ├── index.d.ts
│   ├── index.js
│   ├── injector.d.ts
│   ├── injector.js
│   ├── profiler.d.ts
│   ├── profiler.js
│   ├── providers.d.ts
│   ├── providers.js
│   ├── util.d.ts
│   └── util.js
├── LICENSE
├── package.json
├── README.md
├── src
│   ├── annotations.ts
│   ├── index.ts
│   ├── injector.ts
│   ├── profiler.ts
│   ├── providers.ts
│   └── util.ts
└── tsconfig.json
</pre></div>

<p>In my package.json I wrote <code>"main": "dist/index.js"</code>.</p>
<p>In Node.js everything works fine, but TypeScript:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="p">{</span><span class="n">Injector</span><span class="p">}</span> <span class="kn">from</span> <span class="s1">'@ts-stack/di'</span><span class="p">;</span>
</pre></div>

<blockquote>
<p>Could not find a declaration file for module '@ts-stack/di'.
'/path/to/node_modules/@ts-stack/di/dist/index.js' implicitly has an 'any'
type.</p>
</blockquote>
<p>And yet, if I import as follows, then everything works:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="p">{</span><span class="n">Injector</span><span class="p">}</span> <span class="kn">from</span> <span class="s1">'/path/to/node_modules/@ts-stack/di/dist/index.js'</span><span class="p">;</span>
</pre></div>

<p>What am I doing wrong?</p>
<p><br><br></p>
<h2>Answer</h2>
<h4>For the situation where you are installing your own npm package</h4>
<p>If you're using a third party package, see my answer below.</p>
<p>Remove <code>.js</code> from <code>"main": "dist/index.js"</code> in <code>package.json</code>.</p>
<div class="code"><pre class="code literal-block">"main": "dist/index",
</pre></div>

<p>Also add <code>typings</code> in <code>package.json</code> per the TypeScript docs:</p>
<div class="code"><pre class="code literal-block">"main": "dist/index",
"typings": "dist/index",
</pre></div>

<p>The folder <code>dist</code> is where the TS compiler stores your module's files.</p>
<p><br></p>
<h3>Suggest</h3>
<p>If you're importing a third-party module <code>'foo'</code> that doesn't provide any
typings, either in the library itself, or in the <code>@types/foo</code> package
(generated from the DefinitelyTyped repository), then you can make this error
go away by declaring the module in a file with a <code>.d.ts</code> extension. TypeScript
looks for <code>.d.ts</code> files in the same places that it will look for normal <code>.ts</code>
files: as specified under "files", "include", and "exclude" in the
<code>tsconfig.json</code>.</p>
<div class="code"><pre class="code literal-block"><span class="c1">// foo.d.ts</span>
<span class="n">declare</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="s">'foo'</span><span class="p">;</span>
</pre></div>

<p>Then when you import <code>foo</code> it'll just be typed as <code>any</code>.</p>
<hr>
<p>Alternatively, if you want to roll your own typings you can do that too:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">foo</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">ts</span>
<span class="n">declare</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="s1">'foo'</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">export</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">getRandomNumber</span><span class="p">():</span><span class="w"> </span><span class="n">number</span>
<span class="p">}</span>
</pre></div>

<p>Then this will compile correctly:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="p">{</span> <span class="n">getRandomNumber</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'foo'</span><span class="p">;</span>
<span class="n">const</span> <span class="n">x</span> <span class="o">=</span> <span class="n">getRandomNumber</span><span class="p">();</span> <span class="o">//</span> <span class="n">x</span> <span class="ow">is</span> <span class="n">inferred</span> <span class="k">as</span> <span class="n">number</span>
</pre></div>

<p>You don't have to provide full typings for the module, just enough for the
bits that you're actually using (and want proper typings for), so it's
particularly easy to do if you're using a fairly small amount of API.</p>
<hr>
<p>On the other hand, if you don't care about the typings of external libraries
and want all libraries without typings to be imported as <code>any</code>, you can add
this to a file with a <code>.d.ts</code> extension:</p>
<div class="code"><pre class="code literal-block">declare module '*';
</pre></div>

<p>The benefit (and downside) of this is that you can import absolutely anything
and TS will compile.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-simplest-and-most-robust-way-to-get-the-user-s-current-location-on-android/" class="u-url">What is the simplest and most robust way to get the user's current location on Android?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-simplest-and-most-robust-way-to-get-the-user-s-current-location-on-android/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T11:21:24+08:00" itemprop="datePublished" title="2023-02-17 11:21">2023-02-17 11:21</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>The <code>LocationManager</code> API on Android seems like it's a bit of a pain to use
for an application that only needs an occasional and rough approximation of
the user's location.</p>
<p>The app I'm working on isn't really a location app per se, but it does need to
get the user's location in order to display a list of nearby businesses. It
doesn't need to worry about if the user is moving around or anything like
that.</p>
<p>Here's what I'd like to do:</p>
<ol>
<li>Show the user a list of nearby locations.</li>
<li>Preload the user's location so that by the time I need it in <code>Activity</code> X, it will be available.</li>
<li>I don't particularly care about accuracy or frequency of update. Just grabbing one location is sufficient as long as it's not way off. Maybe if I want to be fancy I'll update the location once every few mins or so, but it's not a huge priority.</li>
<li>Work for any device as long as it has either a GPS or a Network Location provider.</li>
</ol>
<p>It seems like it shouldn't be that hard, but it appears to me that I have to
spin up two different location providers (GPS and NETWORK) and manage each's
lifecycle. Not only that, but I have to duplicate the same code in multiple
activities to satisfy #2. I've tried using <code>getBestProvider()</code> in the past to
cut the solution down to just using one location provider, but that seems to
only give you the best "theoretical" provider rather than the provider that's
actually going to give you the best results.</p>
<p>Is there a simpler way to accomplish this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Here's what I do:</p>
<ol>
<li>First of all I check what providers are enabled. Some may be disabled on the device, some may be disabled in application manifest.</li>
<li>If any provider is available I start location listeners and timeout timer. It's 20 seconds in my example, may not be enough for GPS so you can enlarge it.</li>
<li>If I get update from location listener I use the provided value. I stop listeners and timer.</li>
<li>If I don't get any updates and timer elapses I have to use last known values.</li>
<li>I grab last known values from available providers and choose the most recent of them.</li>
</ol>
<p>Here's how I use my class:</p>
<div class="code"><pre class="code literal-block"><span class="n">LocationResult</span><span class="w"> </span><span class="n">locationResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LocationResult</span><span class="p">()</span><span class="err">{</span>
<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">gotLocation</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="n">location</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="n">Got</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">location</span><span class="err">!</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span><span class="p">;</span>
<span class="n">MyLocation</span><span class="w"> </span><span class="n">myLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyLocation</span><span class="p">();</span>
<span class="n">myLocation</span><span class="p">.</span><span class="n">getLocation</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">locationResult</span><span class="p">);</span>
</pre></div>

<p>And here's MyLocation class:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">java.util.Timer</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.TimerTask</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.location.Location</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.location.LocationListener</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.location.LocationManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">MyLocation</span> <span class="p">{</span>
    <span class="n">Timer</span> <span class="n">timer1</span><span class="p">;</span>
    <span class="n">LocationManager</span> <span class="n">lm</span><span class="p">;</span>
    <span class="n">LocationResult</span> <span class="n">locationResult</span><span class="p">;</span>
    <span class="n">boolean</span> <span class="n">gps_enabled</span><span class="o">=</span><span class="n">false</span><span class="p">;</span>
    <span class="n">boolean</span> <span class="n">network_enabled</span><span class="o">=</span><span class="n">false</span><span class="p">;</span>

    <span class="n">public</span> <span class="n">boolean</span> <span class="n">getLocation</span><span class="p">(</span><span class="n">Context</span> <span class="n">context</span><span class="p">,</span> <span class="n">LocationResult</span> <span class="n">result</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="o">//</span><span class="n">I</span> <span class="n">use</span> <span class="n">LocationResult</span> <span class="n">callback</span> <span class="k">class</span> <span class="nc">to</span> <span class="k">pass</span> <span class="n">location</span> <span class="n">value</span> <span class="kn">from</span> <span class="nn">MyLocation</span> <span class="n">to</span> <span class="n">user</span> <span class="n">code</span><span class="o">.</span>
        <span class="n">locationResult</span><span class="o">=</span><span class="n">result</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">lm</span><span class="o">==</span><span class="n">null</span><span class="p">)</span>
            <span class="n">lm</span> <span class="o">=</span> <span class="p">(</span><span class="n">LocationManager</span><span class="p">)</span> <span class="n">context</span><span class="o">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="o">.</span><span class="n">LOCATION_SERVICE</span><span class="p">);</span>

        <span class="o">//</span><span class="n">exceptions</span> <span class="n">will</span> <span class="n">be</span> <span class="n">thrown</span> <span class="k">if</span> <span class="n">provider</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">permitted</span><span class="o">.</span>
        <span class="k">try</span><span class="p">{</span><span class="n">gps_enabled</span><span class="o">=</span><span class="n">lm</span><span class="o">.</span><span class="n">isProviderEnabled</span><span class="p">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="n">GPS_PROVIDER</span><span class="p">);}</span><span class="n">catch</span><span class="p">(</span><span class="ne">Exception</span> <span class="n">ex</span><span class="p">){}</span>
        <span class="k">try</span><span class="p">{</span><span class="n">network_enabled</span><span class="o">=</span><span class="n">lm</span><span class="o">.</span><span class="n">isProviderEnabled</span><span class="p">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="n">NETWORK_PROVIDER</span><span class="p">);}</span><span class="n">catch</span><span class="p">(</span><span class="ne">Exception</span> <span class="n">ex</span><span class="p">){}</span>

        <span class="o">//</span><span class="n">don</span><span class="s1">'t start listeners if no provider is enabled</span>
        <span class="k">if</span><span class="p">(</span><span class="err">!</span><span class="n">gps_enabled</span> <span class="o">&amp;&amp;</span> <span class="err">!</span><span class="n">network_enabled</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">false</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="n">gps_enabled</span><span class="p">)</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">requestLocationUpdates</span><span class="p">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="n">GPS_PROVIDER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">locationListenerGps</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">network_enabled</span><span class="p">)</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">requestLocationUpdates</span><span class="p">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="n">NETWORK_PROVIDER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">locationListenerNetwork</span><span class="p">);</span>
        <span class="n">timer1</span><span class="o">=</span><span class="n">new</span> <span class="n">Timer</span><span class="p">();</span>
        <span class="n">timer1</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">new</span> <span class="n">GetLastLocation</span><span class="p">(),</span> <span class="mi">20000</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">LocationListener</span> <span class="n">locationListenerGps</span> <span class="o">=</span> <span class="n">new</span> <span class="n">LocationListener</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onLocationChanged</span><span class="p">(</span><span class="n">Location</span> <span class="n">location</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">timer1</span><span class="o">.</span><span class="n">cancel</span><span class="p">();</span>
            <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">location</span><span class="p">);</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">locationListenerNetwork</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onProviderDisabled</span><span class="p">(</span><span class="n">String</span> <span class="n">provider</span><span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onProviderEnabled</span><span class="p">(</span><span class="n">String</span> <span class="n">provider</span><span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onStatusChanged</span><span class="p">(</span><span class="n">String</span> <span class="n">provider</span><span class="p">,</span> <span class="nb">int</span> <span class="n">status</span><span class="p">,</span> <span class="n">Bundle</span> <span class="n">extras</span><span class="p">)</span> <span class="p">{}</span>
    <span class="p">};</span>

    <span class="n">LocationListener</span> <span class="n">locationListenerNetwork</span> <span class="o">=</span> <span class="n">new</span> <span class="n">LocationListener</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onLocationChanged</span><span class="p">(</span><span class="n">Location</span> <span class="n">location</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">timer1</span><span class="o">.</span><span class="n">cancel</span><span class="p">();</span>
            <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">location</span><span class="p">);</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">locationListenerGps</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onProviderDisabled</span><span class="p">(</span><span class="n">String</span> <span class="n">provider</span><span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onProviderEnabled</span><span class="p">(</span><span class="n">String</span> <span class="n">provider</span><span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onStatusChanged</span><span class="p">(</span><span class="n">String</span> <span class="n">provider</span><span class="p">,</span> <span class="nb">int</span> <span class="n">status</span><span class="p">,</span> <span class="n">Bundle</span> <span class="n">extras</span><span class="p">)</span> <span class="p">{}</span>
    <span class="p">};</span>

    <span class="k">class</span> <span class="nc">GetLastLocation</span> <span class="n">extends</span> <span class="n">TimerTask</span> <span class="p">{</span>
        <span class="nd">@Override</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
             <span class="n">lm</span><span class="o">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">locationListenerGps</span><span class="p">);</span>
             <span class="n">lm</span><span class="o">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">locationListenerNetwork</span><span class="p">);</span>

             <span class="n">Location</span> <span class="n">net_loc</span><span class="o">=</span><span class="n">null</span><span class="p">,</span> <span class="n">gps_loc</span><span class="o">=</span><span class="n">null</span><span class="p">;</span>
             <span class="k">if</span><span class="p">(</span><span class="n">gps_enabled</span><span class="p">)</span>
                 <span class="n">gps_loc</span><span class="o">=</span><span class="n">lm</span><span class="o">.</span><span class="n">getLastKnownLocation</span><span class="p">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="n">GPS_PROVIDER</span><span class="p">);</span>
             <span class="k">if</span><span class="p">(</span><span class="n">network_enabled</span><span class="p">)</span>
                 <span class="n">net_loc</span><span class="o">=</span><span class="n">lm</span><span class="o">.</span><span class="n">getLastKnownLocation</span><span class="p">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="n">NETWORK_PROVIDER</span><span class="p">);</span>

             <span class="o">//</span><span class="k">if</span> <span class="n">there</span> <span class="n">are</span> <span class="n">both</span> <span class="n">values</span> <span class="n">use</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">one</span>
             <span class="k">if</span><span class="p">(</span><span class="n">gps_loc</span><span class="o">!=</span><span class="n">null</span> <span class="o">&amp;&amp;</span> <span class="n">net_loc</span><span class="o">!=</span><span class="n">null</span><span class="p">){</span>
                 <span class="k">if</span><span class="p">(</span><span class="n">gps_loc</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span><span class="o">&gt;</span><span class="n">net_loc</span><span class="o">.</span><span class="n">getTime</span><span class="p">())</span>
                     <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">gps_loc</span><span class="p">);</span>
                 <span class="k">else</span>
                     <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">net_loc</span><span class="p">);</span>
                 <span class="k">return</span><span class="p">;</span>
             <span class="p">}</span>

             <span class="k">if</span><span class="p">(</span><span class="n">gps_loc</span><span class="o">!=</span><span class="n">null</span><span class="p">){</span>
                 <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">gps_loc</span><span class="p">);</span>
                 <span class="k">return</span><span class="p">;</span>
             <span class="p">}</span>
             <span class="k">if</span><span class="p">(</span><span class="n">net_loc</span><span class="o">!=</span><span class="n">null</span><span class="p">){</span>
                 <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">net_loc</span><span class="p">);</span>
                 <span class="k">return</span><span class="p">;</span>
             <span class="p">}</span>
             <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">null</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">abstract</span> <span class="k">class</span> <span class="nc">LocationResult</span><span class="p">{</span>
        <span class="n">public</span> <span class="n">abstract</span> <span class="n">void</span> <span class="n">gotLocation</span><span class="p">(</span><span class="n">Location</span> <span class="n">location</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Somebody may also want to modify my logic. For example if you get update from
Network provider don't stop listeners but continue waiting. GPS gives more
accurate data so it's worth waiting for it. If timer elapses and you've got
update from Network but not from GPS then you can use value provided from
Network.</p>
<p>One more approach is to use LocationClient
http://developer.android.com/training/location/retrieve-current.html. But it
requires Google Play Services apk to be installed on user device.</p>
<p><br></p>
<h3>Suggest</h3>
<p>After searching for best implementation how to get best precise user location
I managed to combine all the best methods and come up with following class:</p>
<div class="code"><pre class="code literal-block"><span class="o">/**</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Retrieve</span><span class="w"> </span><span class="n">accurate</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">GPS</span><span class="w"> </span><span class="nb">or</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">services</span><span class="p">.</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Class</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="n">example</span><span class="p">:</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="o">*</span><span class="w">      </span><span class="p">...</span>
<span class="w"> </span><span class="o">*</span><span class="w">      </span><span class="n">my_location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MyLocation</span><span class="p">();</span>
<span class="w"> </span><span class="o">*</span><span class="w">      </span><span class="n">my_location</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">main</span><span class="p">.</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">locationResult</span><span class="p">);</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">LocationResult</span><span class="w"> </span><span class="n">locationResult</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">LocationResult</span><span class="p">(){</span>
<span class="w"> </span><span class="o">*</span><span class="w">      </span><span class="p">@</span><span class="n">Override</span>
<span class="w"> </span><span class="o">*</span><span class="w">      </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">gotLocation</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="n">location</span><span class="p">){</span>
<span class="w"> </span><span class="o">*</span><span class="w">          </span><span class="c1">// do something</span>
<span class="w"> </span><span class="o">*</span><span class="w">          </span><span class="n">location</span><span class="p">.</span><span class="n">getLongitude</span><span class="p">();</span>
<span class="w"> </span><span class="o">*</span><span class="w">          </span><span class="n">location</span><span class="p">.</span><span class="n">getLatitude</span><span class="p">();</span>
<span class="w"> </span><span class="o">*</span><span class="w">      </span><span class="p">}</span>
<span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="p">};</span>
<span class="w"> </span><span class="o">*/</span>
<span class="n">class</span><span class="w"> </span><span class="n">MyLocation</span><span class="p">{</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">GPS</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="p">.</span><span class="w"> </span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">connected</span><span class="w"> </span><span class="n">satellites</span><span class="w"> </span><span class="n">count</span><span class="p">.</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">min_gps_sat_count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Iteration</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">time</span><span class="p">.</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">iteration_timeout_step</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span>

<span class="w">    </span><span class="n">LocationResult</span><span class="w"> </span><span class="n">locationResult</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="n">bestLocation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">null</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Handler</span><span class="p">();</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">LocationManager</span><span class="w"> </span><span class="n">myLocationManager</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">gps_enabled</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">false</span><span class="p">;</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">counts</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">sat_count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="n">showTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">boolean</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">false</span><span class="p">;</span>
<span class="w">            </span><span class="n">counts</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"counts="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">counts</span><span class="p">);</span>

<span class="w">            </span><span class="c1">//if timeout (1 min) exceeded, stop tying</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">counts</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">120</span><span class="p">){</span>
<span class="w">                </span><span class="n">stop</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">true</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">//update last best location</span>
<span class="w">            </span><span class="n">bestLocation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">getLocation</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>

<span class="w">            </span><span class="c1">//if location is not ready or don`t exists, try again</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">bestLocation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">gps_enabled</span><span class="p">){</span>
<span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"BestLocation not ready, continue to wait"</span><span class="p">);</span>
<span class="w">                </span><span class="n">handler</span><span class="p">.</span><span class="n">postDelayed</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">iteration_timeout_step</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">                </span><span class="c1">//if best location is known, calculate if we need to continue to look for better location</span>
<span class="w">                </span><span class="c1">//if gps is enabled and min satellites count has not been connected or min check count is smaller then 4 (2 sec)  </span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">stop</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">false</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!<span class="n">needToStop</span><span class="p">()){</span>
<span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connected "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sat_count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" sattelites. continue waiting.."</span><span class="p">);</span>
<span class="w">                    </span><span class="n">handler</span><span class="p">.</span><span class="n">postDelayed</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">iteration_timeout_step</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"#########################################"</span><span class="p">);</span>
<span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"BestLocation found return result to main. sat_count="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sat_count</span><span class="p">);</span>
<span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"#########################################"</span><span class="p">);</span>

<span class="w">                    </span><span class="c1">// removing all updates and listeners</span>
<span class="w">                    </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">gpsLocationListener</span><span class="p">);</span>
<span class="w">                    </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">networkLocationListener</span><span class="p">);</span><span class="w">    </span>
<span class="w">                    </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">removeGpsStatusListener</span><span class="p">(</span><span class="n">gpsStatusListener</span><span class="p">);</span>
<span class="w">                    </span><span class="n">sat_count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">                    </span><span class="c1">// send best location to locationResult</span>
<span class="w">                    </span><span class="n">locationResult</span><span class="p">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">bestLocation</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Determine</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nb">find</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="n">location</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">needToStop</span><span class="p">(){</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span>!<span class="n">gps_enabled</span><span class="p">){</span>
<span class="w">                          </span><span class="k">return</span><span class="w"> </span><span class="n">true</span><span class="p">;</span>
<span class="w">                     </span><span class="p">}</span>
<span class="w">          </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">counts</span><span class="w"> </span><span class="o">&lt;</span><span class="p">=</span><span class="w"> </span><span class="mi">4</span><span class="p">){</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">sat_count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">min_gps_sat_count</span><span class="p">){</span>
<span class="w">                </span><span class="c1">//if 20-25 sec and 3 satellites found then stop</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">counts</span><span class="w"> </span><span class="o">&gt;</span><span class="p">=</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">sat_count</span><span class="w"> </span><span class="o">&gt;</span><span class="p">=</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">true</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Best</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">class</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">LocationResult</span><span class="p">{</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">gotLocation</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="n">location</span><span class="p">);</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Initialize</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="nb">and</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">listeners</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">@</span><span class="n">param</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="n">ctx</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">@</span><span class="n">param</span><span class="w"> </span><span class="n">LocationResult</span><span class="w"> </span><span class="n">result</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">init</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">LocationResult</span><span class="w"> </span><span class="n">result</span><span class="p">){</span>
<span class="w">        </span><span class="n">context</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">;</span>
<span class="w">        </span><span class="n">locationResult</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>

<span class="w">        </span><span class="n">myLocationManager</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">LocationManager</span><span class="p">)</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="n">LOCATION_SERVICE</span><span class="p">);</span>

<span class="w">        </span><span class="n">gps_enabled</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">Boolean</span><span class="p">)</span><span class="w"> </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">isProviderEnabled</span><span class="p">(</span><span class="n">LocationManager</span><span class="p">.</span><span class="n">GPS_PROVIDER</span><span class="p">);</span>

<span class="w">        </span><span class="n">bestLocation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">null</span><span class="p">;</span>
<span class="w">        </span><span class="n">counts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// turning on location updates</span>
<span class="w">        </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">requestLocationUpdates</span><span class="p">(</span><span class="s">"network"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">networkLocationListener</span><span class="p">);</span>
<span class="w">        </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">requestLocationUpdates</span><span class="p">(</span><span class="s">"gps"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">gpsLocationListener</span><span class="p">);</span>
<span class="w">        </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">addGpsStatusListener</span><span class="p">(</span><span class="n">gpsStatusListener</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// starting best location finder loop</span>
<span class="w">        </span><span class="n">handler</span><span class="p">.</span><span class="n">postDelayed</span><span class="p">(</span><span class="n">showTime</span><span class="p">,</span><span class="w"> </span><span class="n">iteration_timeout_step</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">GpsStatus</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span><span class="w"> </span><span class="n">OnChainged</span><span class="w"> </span><span class="n">counts</span><span class="w"> </span><span class="n">connected</span><span class="w"> </span><span class="n">satellites</span><span class="w"> </span><span class="n">count</span><span class="p">.</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">GpsStatus</span><span class="p">.</span><span class="n">Listener</span><span class="w"> </span><span class="n">gpsStatusListener</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">GpsStatus</span><span class="p">.</span><span class="n">Listener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onGpsStatusChanged</span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">             </span><span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GpsStatus</span><span class="p">.</span><span class="n">GPS_EVENT_SATELLITE_STATUS</span><span class="p">){</span>
<span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// Check number of satellites in list to determine fix state</span>
<span class="w">                     </span><span class="n">GpsStatus</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">getGpsStatus</span><span class="p">(</span><span class="nb">null</span><span class="p">);</span>
<span class="w">                     </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">GpsSatellite</span><span class="o">&gt;</span><span class="n">satellites</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">status</span><span class="p">.</span><span class="n">getSatellites</span><span class="p">();</span>

<span class="w">                     </span><span class="n">sat_count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">                     </span><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">GpsSatellite</span><span class="o">&gt;</span><span class="n">satI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">satellites</span><span class="p">.</span><span class="n">iterator</span><span class="p">();</span>
<span class="w">                     </span><span class="k">while</span><span class="p">(</span><span class="n">satI</span><span class="p">.</span><span class="n">hasNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                         </span><span class="n">GpsSatellite</span><span class="w"> </span><span class="n">satellite</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">satI</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="w">                         </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Satellite: snr="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">satellite</span><span class="p">.</span><span class="n">getSnr</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">", elevation="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">satellite</span><span class="p">.</span><span class="n">getElevation</span><span class="p">());</span><span class="w">                         </span>
<span class="w">                         </span><span class="n">sat_count</span><span class="o">++</span><span class="p">;</span>
<span class="w">                     </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
<span class="w">                    </span><span class="n">sat_count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">min_gps_sat_count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                 </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"#### sat_count = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sat_count</span><span class="p">);</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Gps</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">LocationListener</span><span class="w"> </span><span class="n">gpsLocationListener</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">LocationListener</span><span class="p">(){</span>
<span class="w">        </span><span class="p">@</span><span class="n">Override</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onLocationChanged</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="n">location</span><span class="p">){</span>

<span class="w">        </span><span class="p">}</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onProviderDisabled</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">provider</span><span class="p">){}</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onProviderEnabled</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">provider</span><span class="p">){}</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onStatusChanged</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">provider</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">extras</span><span class="p">){}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Network</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">LocationListener</span><span class="w"> </span><span class="n">networkLocationListener</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">LocationListener</span><span class="p">(){</span>
<span class="w">        </span><span class="p">@</span><span class="n">Override</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onLocationChanged</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="n">location</span><span class="p">){</span>

<span class="w">        </span><span class="p">}</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onProviderDisabled</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">provider</span><span class="p">){}</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onProviderEnabled</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">provider</span><span class="p">){}</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onStatusChanged</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">provider</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">extras</span><span class="p">){}</span>
<span class="w">    </span><span class="p">};</span>


<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Returns</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">LocationManager</span><span class="p">.</span><span class="n">getBestProvider</span><span class="p">()</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">@</span><span class="n">param</span><span class="w"> </span><span class="n">context</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">@</span><span class="k">return</span><span class="w"> </span><span class="n">Location</span><span class="o">|</span><span class="nb">null</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="n">getLocation</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">){</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"getLocation()"</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// fetch last known location and update it</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">LocationManager</span><span class="w"> </span><span class="n">lm</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">LocationManager</span><span class="p">)</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="n">LOCATION_SERVICE</span><span class="p">);</span>

<span class="w">            </span><span class="n">Criteria</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Criteria</span><span class="p">();</span>
<span class="w">            </span><span class="n">criteria</span><span class="p">.</span><span class="n">setAccuracy</span><span class="p">(</span><span class="n">Criteria</span><span class="p">.</span><span class="n">ACCURACY_FINE</span><span class="p">);</span>
<span class="w">             </span><span class="n">criteria</span><span class="p">.</span><span class="n">setAltitudeRequired</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
<span class="w">             </span><span class="n">criteria</span><span class="p">.</span><span class="n">setBearingRequired</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
<span class="w">             </span><span class="n">criteria</span><span class="p">.</span><span class="n">setCostAllowed</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>
<span class="w">             </span><span class="n">String</span><span class="w"> </span><span class="n">strLocationProvider</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">lm</span><span class="p">.</span><span class="n">getBestProvider</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span><span class="w"> </span><span class="n">true</span><span class="p">);</span>

<span class="w">             </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"strLocationProvider="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">strLocationProvider</span><span class="p">);</span>
<span class="w">             </span><span class="n">Location</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">lm</span><span class="p">.</span><span class="n">getLastKnownLocation</span><span class="p">(</span><span class="n">strLocationProvider</span><span class="p">);</span>
<span class="w">             </span><span class="k">if</span><span class="p">(</span><span class="n">location</span><span class="w"> </span>!<span class="p">=</span><span class="w"> </span><span class="nb">null</span><span class="p">){</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">location</span><span class="p">;</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">             </span><span class="k">return</span><span class="w"> </span><span class="nb">null</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">null</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>This class tries to connect to <code>min_gps_sat_count</code> satellites if GPS is
enabled. Else returns <code>LocationManager.getBestProvider()</code> location. Check the
code!</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/pandas-merging-101/" class="u-url">Pandas Merging 101</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/pandas-merging-101/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T11:20:53+08:00" itemprop="datePublished" title="2023-02-17 11:20">2023-02-17 11:20</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <ul>
<li>How can I perform a (<code>INNER</code>| (<code>LEFT</code>|<code>RIGHT</code>|<code>FULL</code>) <code>OUTER</code>) <code>JOIN</code> with pandas?</li>
<li>How do I add NaNs for missing rows after a merge?</li>
<li>How do I get rid of NaNs after merging?</li>
<li>Can I merge on the index?</li>
<li>How do I merge multiple DataFrames?</li>
<li>Cross join with pandas</li>
<li>
<code>merge</code>? <code>join</code>? <code>concat</code>? <code>update</code>? Who? What? Why?!</li>
</ul>
<p>... and more. I've seen these recurring questions asking about various facets
of the pandas merge functionality. Most of the information regarding merge and
its various use cases today is fragmented across dozens of badly worded,
unsearchable posts. The aim here is to collate some of the more important
points for posterity.</p>
<p>This Q&amp;A is meant to be the next installment in a series of helpful user
guides on common pandas idioms (see this post on pivoting, and this post on
concatenation, which I will be touching on, later).</p>
<p>Please note that this post is <em>not</em> meant to be a replacement for the
documentation, so please read that as well! Some of the examples are taken
from there.</p>
<hr>
<h4>Table of Contents</h4>
<p>For ease of access.</p>
<ul>
<li>
<p>Merging basics - basic types of joins (read this first)</p>
</li>
<li>
<p>Index-based joins</p>
</li>
<li>
<p>Generalizing to multiple DataFrames</p>
</li>
<li>
<p>Cross join</p>
</li>
</ul>
<p><br><br></p>
<h2>Answer</h2>
<p>This post aims to give readers a primer on SQL-flavored merging with Pandas,
how to use it, and when not to use it.</p>
<p>In particular, here's what this post will go through:</p>
<ul>
<li>
<p>The basics - types of joins (LEFT, RIGHT, OUTER, INNER)</p>
<ul>
<li>merging with different column names</li>
<li>merging with multiple columns</li>
<li>avoiding duplicate merge key column in output</li>
</ul>
</li>
</ul>
<p>What this post (and other posts by me on this thread) will not go through:</p>
<ul>
<li>Performance-related discussions and timings (for now). Mostly notable mentions of better alternatives, wherever appropriate.</li>
<li>Handling suffixes, removing extra columns, renaming outputs, and other specific use cases. There are other (read: better) posts that deal with that, so figure it out!</li>
</ul>
<blockquote>
<p><strong>Note</strong> Most examples default to INNER JOIN operations while demonstrating
various features, unless otherwise specified.</p>
<p>Furthermore, all the DataFrames here can be copied and replicated so you can
play with them. Also, see this post on how to read DataFrames from your
clipboard.</p>
<p>Lastly, all visual representation of JOIN operations have been hand-drawn
using Google Drawings. Inspiration from here.</p>
</blockquote>
<hr>
<hr>
<h2>Enough talk - just show me how to use <code>merge</code>!</h2>
<h4>Setup &amp; Basics</h4>
<div class="code"><pre class="code literal-block"><span class="nv">np</span>.<span class="k">random</span>.<span class="nv">seed</span><span class="ss">(</span><span class="mi">0</span><span class="ss">)</span>
<span class="nv">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pd</span>.<span class="nv">DataFrame</span><span class="ss">(</span>{<span class="s1">'key'</span>:<span class="w"> </span>[<span class="s1">'A'</span>,<span class="w"> </span><span class="s1">'B'</span>,<span class="w"> </span><span class="s1">'C'</span>,<span class="w"> </span><span class="s1">'D'</span>],<span class="w"> </span><span class="s1">'value'</span>:<span class="w"> </span><span class="nv">np</span>.<span class="k">random</span>.<span class="nv">randn</span><span class="ss">(</span><span class="mi">4</span><span class="ss">)</span>}<span class="ss">)</span>
<span class="nv">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pd</span>.<span class="nv">DataFrame</span><span class="ss">(</span>{<span class="s1">'key'</span>:<span class="w"> </span>[<span class="s1">'B'</span>,<span class="w"> </span><span class="s1">'D'</span>,<span class="w"> </span><span class="s1">'E'</span>,<span class="w"> </span><span class="s1">'F'</span>],<span class="w"> </span><span class="s1">'value'</span>:<span class="w"> </span><span class="nv">np</span>.<span class="k">random</span>.<span class="nv">randn</span><span class="ss">(</span><span class="mi">4</span><span class="ss">)</span>}<span class="ss">)</span>

<span class="nv">left</span>

<span class="w">  </span><span class="nv">key</span><span class="w">     </span><span class="nv">value</span>
<span class="mi">0</span><span class="w">   </span><span class="nv">A</span><span class="w">  </span><span class="mi">1</span>.<span class="mi">764052</span>
<span class="mi">1</span><span class="w">   </span><span class="nv">B</span><span class="w">  </span><span class="mi">0</span>.<span class="mi">400157</span>
<span class="mi">2</span><span class="w">   </span><span class="nv">C</span><span class="w">  </span><span class="mi">0</span>.<span class="mi">978738</span>
<span class="mi">3</span><span class="w">   </span><span class="nv">D</span><span class="w">  </span><span class="mi">2</span>.<span class="mi">240893</span>

<span class="nv">right</span>

<span class="w">  </span><span class="nv">key</span><span class="w">     </span><span class="nv">value</span>
<span class="mi">0</span><span class="w">   </span><span class="nv">B</span><span class="w">  </span><span class="mi">1</span>.<span class="mi">867558</span>
<span class="mi">1</span><span class="w">   </span><span class="nv">D</span><span class="w"> </span><span class="o">-</span><span class="mi">0</span>.<span class="mi">977278</span>
<span class="mi">2</span><span class="w">   </span><span class="nv">E</span><span class="w">  </span><span class="mi">0</span>.<span class="mi">950088</span>
<span class="mi">3</span><span class="w">   </span><span class="nv">F</span><span class="w"> </span><span class="o">-</span><span class="mi">0</span>.<span class="mi">151357</span>
</pre></div>

<p>For the sake of simplicity, the key column has the same name (for now).</p>
<p>An <strong>INNER JOIN</strong> is represented by</p>
<p><img alt="" src="images/YvuOa.png"></p>
<blockquote>
<p><strong>Note</strong> This, along with the forthcoming figures all follow this
convention:</p>
<ul>
<li>
<strong>blue</strong> indicates rows that are present in the merge result</li>
<li>
<strong>red</strong> indicates rows that are excluded from the result (i.e., removed)</li>
<li>
<strong>green</strong> indicates missing values that are replaced with <code>NaN</code>s in the
result
</li>
</ul>
</blockquote>
<p>To perform an INNER JOIN, call <code>merge</code> on the left DataFrame, specifying the
right DataFrame and the join key (at the very least) as arguments.</p>
<div class="code"><pre class="code literal-block"><span class="nv">left</span>.<span class="nv">merge</span><span class="ss">(</span><span class="nv">right</span>,<span class="w"> </span><span class="nv">on</span><span class="o">=</span><span class="s1">'key'</span><span class="ss">)</span>
#<span class="w"> </span><span class="nv">Or</span>,<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">want</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">explicit</span>
#<span class="w"> </span><span class="nv">left</span>.<span class="nv">merge</span><span class="ss">(</span><span class="nv">right</span>,<span class="w"> </span><span class="nv">on</span><span class="o">=</span><span class="s1">'key'</span>,<span class="w"> </span><span class="nv">how</span><span class="o">=</span><span class="s1">'inner'</span><span class="ss">)</span>

<span class="w">  </span><span class="nv">key</span><span class="w">   </span><span class="nv">value_x</span><span class="w">   </span><span class="nv">value_y</span>
<span class="mi">0</span><span class="w">   </span><span class="nv">B</span><span class="w">  </span><span class="mi">0</span>.<span class="mi">400157</span><span class="w">  </span><span class="mi">1</span>.<span class="mi">867558</span>
<span class="mi">1</span><span class="w">   </span><span class="nv">D</span><span class="w">  </span><span class="mi">2</span>.<span class="mi">240893</span><span class="w"> </span><span class="o">-</span><span class="mi">0</span>.<span class="mi">977278</span>
</pre></div>

<p>This returns only rows from <code>left</code> and <code>right</code> which share a common key (in
this example, "B" and "D).</p>
<p>A <strong>LEFT OUTER JOIN</strong> , or LEFT JOIN is represented by</p>
<p><img alt="" src="images/BECid.png"></p>
<p>This can be performed by specifying <code>how='left'</code>.</p>
<div class="code"><pre class="code literal-block">left.merge(right, on='key', how='left')

  key   value_x   value_y
0   A  1.764052       NaN
1   B  0.400157  1.867558
2   C  0.978738       NaN
3   D  2.240893 -0.977278
</pre></div>

<p>Carefully note the placement of NaNs here. If you specify <code>how='left'</code>, then
only keys from <code>left</code> are used, and missing data from <code>right</code> is replaced by
NaN.</p>
<p>And similarly, for a <strong>RIGHT OUTER JOIN</strong> , or RIGHT JOIN which is...</p>
<p><img alt="" src="images/8w1US.png"></p>
<p>...specify <code>how='right'</code>:</p>
<div class="code"><pre class="code literal-block">left.merge(right, on='key', how='right')

  key   value_x   value_y
0   B  0.400157  1.867558
1   D  2.240893 -0.977278
2   E       NaN  0.950088
3   F       NaN -0.151357
</pre></div>

<p>Here, keys from <code>right</code> are used, and missing data from <code>left</code> is replaced by
NaN.</p>
<p>Finally, for the <strong>FULL OUTER JOIN</strong> , given by</p>
<p><img alt="" src="images/euLoe.png"></p>
<p>specify <code>how='outer'</code>.</p>
<div class="code"><pre class="code literal-block">left.merge(right, on='key', how='outer')

  key   value_x   value_y
0   A  1.764052       NaN
1   B  0.400157  1.867558
2   C  0.978738       NaN
3   D  2.240893 -0.977278
4   E       NaN  0.950088
5   F       NaN -0.151357
</pre></div>

<p>This uses the keys from both frames, and NaNs are inserted for missing rows in
both.</p>
<p>The documentation summarizes these various merges nicely:</p>
<p><img alt="Enter image description here" src="images/5qDIy.png"></p>
<hr>
<h4>**Other JOINs - LEFT-Excluding, RIGHT-Excluding, and FULL-Excluding/ANTI</h4>
<p>JOINs**</p>
<p>If you need <strong>LEFT-Excluding JOINs</strong> and <strong>RIGHT-Excluding JOINs</strong> in two
steps.</p>
<p>For LEFT-Excluding JOIN, represented as</p>
<p><img alt="" src="images/bXWIV.png"></p>
<p>Start by performing a LEFT OUTER JOIN and then filtering to rows coming from
<code>left</code> only (excluding everything from the right),</p>
<div class="code"><pre class="code literal-block">(left.merge(right, on='key', how='left', indicator=True)
     .query('_merge == "left_only"')
     .drop('_merge', 1))

  key   value_x  value_y
0   A  1.764052      NaN
2   C  0.978738      NaN
</pre></div>

<p>Where,</p>
<div class="code"><pre class="code literal-block">left.merge(right, on='key', how='left', indicator=True)

  key   value_x   value_y     _merge
0   A  1.764052       NaN  left_only
1   B  0.400157  1.867558       both
2   C  0.978738       NaN  left_only
3   D  2.240893 -0.977278       both
</pre></div>

<p>And similarly, for a RIGHT-Excluding JOIN,</p>
<p><img alt="" src="images/Z0br2.png"></p>
<div class="code"><pre class="code literal-block">(left.merge(right, on='key', how='right', indicator=True)
     .query('_merge == "right_only"')
     .drop('_merge', 1))

  key  value_x   value_y
2   E      NaN  0.950088
3   F      NaN -0.151357
</pre></div>

<p>Lastly, if you are required to do a merge that only retains keys from the left
or right, but not both (IOW, performing an <strong>ANTI-JOIN</strong> ),</p>
<p><img alt="" src="images/PWMYd.png"></p>
<p>You can do this in similar fashion—</p>
<div class="code"><pre class="code literal-block">(left.merge(right, on='key', how='outer', indicator=True)
     .query('_merge != "both"')
     .drop('_merge', 1))

  key   value_x   value_y
0   A  1.764052       NaN
2   C  0.978738       NaN
4   E       NaN  0.950088
5   F       NaN -0.151357
</pre></div>

<hr>
<h4><strong>Different names for key columns</strong></h4>
<p>If the key columns are named differently—for example, <code>left</code> has <code>keyLeft</code>,
and <code>right</code> has <code>keyRight</code> instead of <code>key</code>—then you will have to specify
<code>left_on</code> and <code>right_on</code> as arguments instead of <code>on</code>:</p>
<div class="code"><pre class="code literal-block">left2 = left.rename({'key':'keyLeft'}, axis=1)
right2 = right.rename({'key':'keyRight'}, axis=1)

left2

  keyLeft     value
0       A  1.764052
1       B  0.400157
2       C  0.978738
3       D  2.240893

right2

  keyRight     value
0        B  1.867558
1        D -0.977278
2        E  0.950088
3        F -0.151357



left2.merge(right2, left_on='keyLeft', right_on='keyRight', how='inner')

  keyLeft   value_x keyRight   value_y
0       B  0.400157        B  1.867558
1       D  2.240893        D -0.977278
</pre></div>

<hr>
<h4><strong>Avoiding duplicate key column in output</strong></h4>
<p>When merging on <code>keyLeft</code> from <code>left</code> and <code>keyRight</code> from <code>right</code>, if you only
want either of the <code>keyLeft</code> or <code>keyRight</code> (but not both) in the output, you
can start by setting the index as a preliminary step.</p>
<div class="code"><pre class="code literal-block">left3 = left2.set_index('keyLeft')
left3.merge(right2, left_index=True, right_on='keyRight')

    value_x keyRight   value_y
0  0.400157        B  1.867558
1  2.240893        D -0.977278
</pre></div>

<p>Contrast this with the output of the command just before (that is, the output
of <code>left2.merge(right2, left_on='keyLeft', right_on='keyRight',
how='inner')</code>), you'll notice <code>keyLeft</code> is missing. You can figure out what
column to keep based on which frame's index is set as the key. This may matter
when, say, performing some OUTER JOIN operation.</p>
<hr>
<h4><strong>Merging only a single column from one of the<code>DataFrames</code></strong></h4>
<p>For example, consider</p>
<div class="code"><pre class="code literal-block"><span class="n">right3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">right</span><span class="p">.</span><span class="k">assign</span><span class="p">(</span><span class="n">newcol</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">right</span><span class="p">)))</span>
<span class="n">right3</span>
<span class="w">  </span><span class="n">key</span><span class="w">     </span><span class="n">value</span><span class="w">  </span><span class="n">newcol</span>
<span class="mh">0</span><span class="w">   </span><span class="n">B</span><span class="w">  </span><span class="mf">1.867558</span><span class="w">       </span><span class="mh">0</span>
<span class="mh">1</span><span class="w">   </span><span class="n">D</span><span class="w"> </span><span class="o">-</span><span class="mf">0.977278</span><span class="w">       </span><span class="mh">1</span>
<span class="mh">2</span><span class="w">   </span><span class="n">E</span><span class="w">  </span><span class="mf">0.950088</span><span class="w">       </span><span class="mh">2</span>
<span class="mh">3</span><span class="w">   </span><span class="n">F</span><span class="w"> </span><span class="o">-</span><span class="mf">0.151357</span><span class="w">       </span><span class="mh">3</span>
</pre></div>

<p>If you are required to merge only "newcol" (without any of the other columns),
you can usually just subset columns before merging:</p>
<div class="code"><pre class="code literal-block">left.merge(right3[['key', 'newcol']], on='key')

  key     value  newcol
0   B  0.400157       0
1   D  2.240893       1
</pre></div>

<p>If you're doing a LEFT OUTER JOIN, a more performant solution would involve
<code>map</code>:</p>
<div class="code"><pre class="code literal-block"><span class="p">#</span><span class="w"> </span><span class="n">left</span><span class="p">['</span><span class="n">newcol</span><span class="p">']</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">left</span><span class="p">['</span><span class="n">key</span><span class="p">'].</span><span class="n">map</span><span class="p">(</span><span class="n">right3</span><span class="p">.</span><span class="n">set_index</span><span class="p">('</span><span class="n">key</span><span class="p">')['</span><span class="n">newcol</span><span class="p">']))</span>
<span class="n">left</span><span class="p">.</span><span class="k">assign</span><span class="p">(</span><span class="n">newcol</span><span class="o">=</span><span class="n">left</span><span class="p">['</span><span class="n">key</span><span class="p">'].</span><span class="n">map</span><span class="p">(</span><span class="n">right3</span><span class="p">.</span><span class="n">set_index</span><span class="p">('</span><span class="n">key</span><span class="p">')['</span><span class="n">newcol</span><span class="p">']))</span>

<span class="w">  </span><span class="n">key</span><span class="w">     </span><span class="n">value</span><span class="w">  </span><span class="n">newcol</span>
<span class="mh">0</span><span class="w">   </span><span class="n">A</span><span class="w">  </span><span class="mf">1.764052</span><span class="w">     </span><span class="n">NaN</span>
<span class="mh">1</span><span class="w">   </span><span class="n">B</span><span class="w">  </span><span class="mf">0.400157</span><span class="w">     </span><span class="mf">0.0</span>
<span class="mh">2</span><span class="w">   </span><span class="n">C</span><span class="w">  </span><span class="mf">0.978738</span><span class="w">     </span><span class="n">NaN</span>
<span class="mh">3</span><span class="w">   </span><span class="n">D</span><span class="w">  </span><span class="mf">2.240893</span><span class="w">     </span><span class="mf">1.0</span>
</pre></div>

<p>As mentioned, this is similar to, but faster than</p>
<div class="code"><pre class="code literal-block">left.merge(right3[['key', 'newcol']], on='key', how='left')

  key     value  newcol
0   A  1.764052     NaN
1   B  0.400157     0.0
2   C  0.978738     NaN
3   D  2.240893     1.0
</pre></div>

<hr>
<h4><strong>Merging on multiple columns</strong></h4>
<p>To join on more than one column, specify a list for <code>on</code> (or <code>left_on</code> and
<code>right_on</code>, as appropriate).</p>
<div class="code"><pre class="code literal-block">left.merge(right, on=['key1', 'key2'] ...)
</pre></div>

<p>Or, in the event the names are different,</p>
<div class="code"><pre class="code literal-block">left.merge(right, left_on=['lkey1', 'lkey2'], right_on=['rkey1', 'rkey2'])
</pre></div>

<hr>
<h4><strong>Other useful<code>merge*</code> operations and functions</strong></h4>
<ul>
<li>
<p>Merging a DataFrame with Series on index: See this answer.</p>
</li>
<li>
<p>Besides <code>merge</code>, <code>DataFrame.update</code> and <code>DataFrame.combine_first</code> are also used in certain cases to update one DataFrame with another.</p>
</li>
<li>
<p><code>pd.merge_ordered</code> is a useful function for ordered JOINs.</p>
</li>
<li>
<p><code>pd.merge_asof</code> (read: merge_asOf) is useful for <em>approximate</em> joins.</p>
</li>
</ul>
<p><strong>This section only covers the very basics, and is designed to only whet your
appetite. For more examples and cases, see the documentation on<code>merge</code>,
<code>join</code>, and <code>concat</code> as well as the links to the function specifications.</strong></p>
<hr>
<hr>
<h2>Continue Reading</h2>
<p>Jump to other topics in Pandas Merging 101 to continue learning:</p>
<ul>
<li>
<p>Merging basics - basic types of joins *</p>
</li>
<li>
<p>Index-based joins</p>
</li>
<li>
<p>Generalizing to multiple DataFrames</p>
</li>
<li>
<p>Cross join</p>
</li>
</ul>
<p>*You are here.</p>
<p><br></p>
<h3>Suggest</h3>
<p>A supplemental visual view of <code>pd.concat([df0, df1], kwargs)</code>. Notice that,
kwarg <code>axis=0</code> or <code>axis=1</code> 's meaning is not as intuitive as <code>df.mean()</code> or
<code>df.apply(func)</code></p>
<hr>
<p><img alt="on pd.concat([df0, df1])" src="images/1rb1R.jpg"></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-614.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-612.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
