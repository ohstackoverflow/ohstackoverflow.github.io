<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 103) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-103.html">
<link rel="prev" href="index-104.html" type="text/html">
<link rel="next" href="index-102.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/class-static-variables-and-methods/" class="u-url">Class (static) variables and methods</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/class-static-variables-and-methods/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T21:23:32+08:00" itemprop="datePublished" title="2023-02-16 21:23">2023-02-16 21:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I create class (i.e. static) variables or methods in Python?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Variables declared inside the class definition, but not inside a method are
class or static variables:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; class MyClass:
...     i = 3
...
&gt;&gt;&gt; MyClass.i
3
</pre></div>

<p>As @millerdev points out, this creates a class-level <code>i</code> variable, but this is
distinct from any instance-level <code>i</code> variable, so you could have</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; m = MyClass()
&gt;&gt;&gt; m.i = 4
&gt;&gt;&gt; MyClass.i, m.i
&gt;&gt;&gt; (3, 4)
</pre></div>

<p>This is different from C++ and Java, but not so different from C#, where a
static member can't be accessed using a reference to an instance.</p>
<p>See what the Python tutorial has to say on the subject of classes and class
objects.</p>
<p>@Steve Johnson has already answered regarding static methods, also documented
under "Built-in Functions" in the Python Library Reference.</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="nl">C</span><span class="p">:</span>
<span class="w">    </span><span class="nv">@staticmethod</span>
<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="err">:</span><span class="w"> </span><span class="p">...</span>
</pre></div>

<p>@beidy recommends classmethods over staticmethod, as the method then receives
the class type as the first argument.</p>
<p><br></p>
<h3>Suggest</h3>
<p>@Blair Conrad said static variables declared inside the class definition, but
not inside a method are class or "static" variables:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; class Test(object):
...     i = 3
...
&gt;&gt;&gt; Test.i
3
</pre></div>

<p>There are a few gotcha's here. Carrying on from the example above:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Test</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">i</span><span class="w">     </span><span class="c1"># "static" variable accessed via instance</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="c1"># but if we assign to the instance ...</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">Test</span><span class="o">.</span><span class="n">i</span><span class="w">  </span><span class="c1"># we have not changed the "static" variable</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">i</span><span class="w">     </span><span class="c1"># we have overwritten Test.i on t by creating a new attribute t.i</span>
<span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">Test</span><span class="o">.</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="c1"># to change the "static" variable we do it by assigning to the class</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">i</span>
<span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">Test</span><span class="o">.</span><span class="n">i</span>
<span class="mi">6</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Test</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">u</span><span class="o">.</span><span class="n">i</span>
<span class="mi">6</span><span class="w">           </span><span class="c1"># changes to t do not affect new instances of Test</span>

<span class="c1"># Namespaces are one honking great idea -- let's do more of those!</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">Test</span><span class="o">.</span><span class="n">__dict__</span>
<span class="p">{</span><span class="s1">'i'</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="o">...</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">__dict__</span>
<span class="p">{</span><span class="s1">'i'</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">u</span><span class="o">.</span><span class="n">__dict__</span>
<span class="p">{}</span>
</pre></div>

<p>Notice how the instance variable <code>t.i</code> got out of sync with the "static" class
variable when the attribute <code>i</code> was set directly on <code>t</code>. This is because <code>i</code>
was re-bound within the <code>t</code> namespace, which is distinct from the <code>Test</code>
namespace. If you want to change the value of a "static" variable, you must
change it within the scope (or object) where it was originally defined. I put
"static" in quotes because Python does not really have static variables in the
sense that C++ and Java do.</p>
<p>Although it doesn't say anything specific about static variables or methods,
the Python tutorial has some relevant information on classes and class
objects.</p>
<p>@Steve Johnson also answered regarding static methods, also documented under
"Built-in Functions" in the Python Library Reference.</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">Test</span><span class="p">(</span><span class="k">object</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="nv">@staticmethod</span>
<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="err">:</span>
<span class="w">        </span><span class="p">...</span>
</pre></div>

<p>@beid also mentioned classmethod, which is similar to staticmethod. A
classmethod's first argument is the class object. Example:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">Test</span><span class="p">(</span><span class="n">object</span><span class="p">):</span>
<span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="c1"># class (or static) variable</span>
<span class="w">    </span><span class="err">@</span><span class="n">classmethod</span>
<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">g</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">):</span>
<span class="w">        </span><span class="c1"># here we can use 'cls' instead of the class name (Test)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">cls</span><span class="o">.</span><span class="n">i</span><span class="p">:</span>
<span class="w">            </span><span class="n">cls</span><span class="o">.</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="c1"># would be the same as Test.i = arg1</span>
</pre></div>

<p><img alt="Pictorial Representation Of Above Example" src="images/xqnxe.jpg"></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-rule-of-three/" class="u-url">What is The Rule of Three?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-rule-of-three/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T21:23:00+08:00" itemprop="datePublished" title="2023-02-16 21:23">2023-02-16 21:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <ul>
<li>What does <em>copying an object</em> mean?</li>
<li>What are the <em>copy constructor</em> and the <em>copy assignment operator</em>?</li>
<li>When do I need to declare them myself?</li>
<li>How can I prevent my objects from being copied?</li>
</ul>
<p><br><br></p>
<h2>Answer</h2>
<h2>Introduction</h2>
<p>C++ treats variables of user-defined types with <em>value semantics</em>. This means
that objects are implicitly copied in various contexts, and we should
understand what "copying an object" actually means.</p>
<p>Let us consider a simple example:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">person</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>

<span class="n">public</span><span class="p">:</span>

<span class="w">    </span><span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="nb nb-Type">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">person</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="s2">"Bjarne Stroustrup"</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">);</span>
<span class="w">    </span><span class="n">person</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">What</span><span class="w"> </span><span class="n">happens</span><span class="w"> </span><span class="n">here</span><span class="err">?</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">         </span><span class="o">//</span><span class="w"> </span><span class="n">And</span><span class="w"> </span><span class="n">here</span><span class="err">?</span>
<span class="p">}</span>
</pre></div>

<p>(If you are puzzled by the <code>name(name), age(age)</code> part, this is called a
member initializer list.)</p>
<h2>Special member functions</h2>
<p>What does it mean to copy a <code>person</code> object? The <code>main</code> function shows two
distinct copying scenarios. The initialization <code>person b(a);</code> is performed by
the <em>copy constructor</em>. Its job is to construct a fresh object based on the
state of an existing object. The assignment <code>b = a</code> is performed by the <em>copy
assignment operator</em>. Its job is generally a little more complicated because
the target object is already in some valid state that needs to be dealt with.</p>
<p>Since we declared neither the copy constructor nor the assignment operator
(nor the destructor) ourselves, these are implicitly defined for us. Quote
from the standard:</p>
<blockquote>
<p>The [...] copy constructor and copy assignment operator, [...] and
destructor are special member functions. [ <em>Note</em> : <strong>The implementation
will implicitly declare these member functions for some class types when the
program does not explicitly declare them.</strong> The implementation will
implicitly define them if they are used. [...] <em>end note</em> ] [n3126.pdf
section 12 §1]</p>
</blockquote>
<p>By default, copying an object means copying its members:</p>
<blockquote>
<p>The implicitly-defined copy constructor for a non-union class X performs a
memberwise copy of its subobjects. [n3126.pdf section 12.8 §16]</p>
<p>The implicitly-defined copy assignment operator for a non-union class X
performs memberwise copy assignment of its subobjects. [n3126.pdf section
12.8 §30]</p>
</blockquote>
<h3>Implicit definitions</h3>
<p>The implicitly-defined special member functions for <code>person</code> look like this:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">constructor</span>
<span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="n">operator</span>
<span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">age</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="n">destructor</span>
<span class="o">~</span><span class="n">person</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>

<p>Memberwise copying is exactly what we want in this case: <code>name</code> and <code>age</code> are
copied, so we get a self-contained, independent <code>person</code> object. The
implicitly-defined destructor is always empty. This is also fine in this case
since we did not acquire any resources in the constructor. The members'
destructors are implicitly called after the <code>person</code> destructor is finished:</p>
<blockquote>
<p>After executing the body of the destructor and destroying any automatic
objects allocated within the body, a destructor for class X calls the
destructors for X's direct [...] members [n3126.pdf 12.4 §6]</p>
</blockquote>
<h2>Managing resources</h2>
<p>So when should we declare those special member functions explicitly? When our
class <em>manages a resource</em> , that is, when an object of the class is
<em>responsible</em> for that resource. That usually means the resource is <em>acquired</em>
in the constructor (or passed into the constructor) and <em>released</em> in the
destructor.</p>
<p>Let us go back in time to pre-standard C++. There was no such thing as
<code>std::string</code>, and programmers were in love with pointers. The <code>person</code> class
might have looked like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">person</span>
<span class="p">{</span>
<span class="w">    </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>

<span class="n">public</span><span class="p">:</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="n">acquires</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">resource</span><span class="p">:</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">case</span><span class="p">,</span><span class="w"> </span><span class="n">dynamic</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">obtained</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">new</span><span class="p">[]</span>
<span class="w">    </span><span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">the_name</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">the_age</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb">char</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">the_name</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="n">strcpy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">the_name</span><span class="p">);</span>
<span class="w">        </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">the_age</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">destructor</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">delete</span><span class="p">[]</span>
<span class="w">    </span><span class="o">~</span><span class="n">person</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>

<p>Even today, people still write classes in this style and get into trouble: "
<em>I pushed a person into a vector and now I get crazy memory errors!</em> "
Remember that by default, copying an object means copying its members, but
copying the <code>name</code> member merely copies a pointer, <em>not</em> the character array
it points to! This has several unpleasant effects:</p>
<ol>
<li>Changes via <code>a</code> can be observed via <code>b</code>.</li>
<li>Once <code>b</code> is destroyed, <code>a.name</code> is a dangling pointer.</li>
<li>If <code>a</code> is destroyed, deleting the dangling pointer yields undefined behavior.</li>
<li>Since the assignment does not take into account what <code>name</code> pointed to before the assignment, sooner or later you will get memory leaks all over the place.</li>
</ol>
<h3>Explicit definitions</h3>
<p>Since memberwise copying does not have the desired effect, we must define the
copy constructor and the copy assignment operator explicitly to make deep
copies of the character array:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">constructor</span>
<span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb">char</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">age</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="n">operator</span>
<span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">that</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">dangerous</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">flow</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">execution</span><span class="o">!</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">temporarily</span><span class="w"> </span><span class="n">invalidated</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">invariants</span><span class="p">,</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="n">statement</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">exception</span><span class="p">,</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">leaving</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="p">:(</span>
<span class="w">        </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb">char</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="n">strcpy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">);</span>
<span class="w">        </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">age</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Note the difference between initialization and assignment: we must tear down
the old state before assigning it to <code>name</code> to prevent memory leaks. Also, we
have to protect against the self-assignment of the form <code>x = x</code>. Without that
check, <code>delete[] name</code> would delete the array containing the <em>source</em> string,
because when you write <code>x = x</code>, both <code>this-&gt;name</code> and <code>that.name</code> contain the
same pointer.</p>
<h3>Exception safety</h3>
<p>Unfortunately, this solution will fail if <code>new char[...]</code> throws an exception
due to memory exhaustion. One possible solution is to introduce a local
variable and reorder the statements:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="n">operator</span>
<span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">local_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb">char</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">statement</span><span class="w"> </span><span class="n">throws</span><span class="p">,</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">still</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">before</span><span class="o">.</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">statements</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="p">:)</span>
<span class="w">    </span><span class="n">strcpy</span><span class="p">(</span><span class="n">local_name</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="n">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">local_name</span><span class="p">;</span>
<span class="w">    </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">that</span><span class="o">.</span><span class="n">age</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">this</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>This also takes care of self-assignment without an explicit check. An even
more robust solution to this problem is the copy-and-swap idiom, but I will
not go into the details of exception safety here. I only mentioned exceptions
to make the following point: <strong>Writing classes that manage resources is
hard.</strong></p>
<h3>Noncopyable resources</h3>
<p>Some resources cannot or should not be copied, such as file handles or
mutexes. In that case, simply declare the copy constructor and copy assignment
operator as <code>private</code> without giving a definition:</p>
<div class="code"><pre class="code literal-block"><span class="kd">private</span><span class="o">:</span>

<span class="w">    </span><span class="n">person</span><span class="o">(</span><span class="kd">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="o">);</span>
<span class="w">    </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=(</span><span class="kd">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="o">);</span>
</pre></div>

<p>Alternatively, you can inherit from <code>boost::noncopyable</code> or declare them as
deleted (in C++11 and above):</p>
<div class="code"><pre class="code literal-block"><span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delete</span><span class="p">;</span>
<span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">that</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delete</span><span class="p">;</span>
</pre></div>

<h3>The rule of three</h3>
<p>Sometimes you need to implement a class that manages a resource. (Never manage
multiple resources in a single class, this will only lead to pain.) In that
case, remember the <strong>rule of three</strong> :</p>
<blockquote>
<p>If you need to explicitly declare either the destructor, copy constructor or
copy assignment operator yourself, you probably need to explicitly declare
all three of them.</p>
</blockquote>
<p>(Unfortunately, this "rule" is not enforced by the C++ standard or any
compiler I am aware of.)</p>
<h3>The rule of five</h3>
<p>From C++11 on, an object has 2 extra special member functions: the move
constructor and move assignment. The rule of five states to implement these
functions as well.</p>
<p>An example with the signatures:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">person</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>

<span class="n">public</span><span class="p">:</span>
<span class="w">    </span><span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">age</span><span class="p">);</span><span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Ctor</span>
<span class="w">    </span><span class="n">person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default</span><span class="p">;</span><span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">Copy</span><span class="w"> </span><span class="n">Ctor</span>
<span class="w">    </span><span class="n">person</span><span class="p">(</span><span class="n">person</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="p">)</span><span class="w"> </span><span class="n">noexcept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default</span><span class="p">;</span><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="mi">4</span><span class="o">/</span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">Move</span><span class="w"> </span><span class="n">Ctor</span>
<span class="w">    </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default</span><span class="p">;</span><span class="w">     </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span><span class="o">/</span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">Copy</span><span class="w"> </span><span class="n">Assignment</span>
<span class="w">    </span><span class="n">person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="o">=</span><span class="p">(</span><span class="n">person</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="p">)</span><span class="w"> </span><span class="n">noexcept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">5</span><span class="o">/</span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">Move</span><span class="w"> </span><span class="n">Assignment</span>
<span class="w">    </span><span class="o">~</span><span class="n">person</span><span class="p">()</span><span class="w"> </span><span class="n">noexcept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">default</span><span class="p">;</span><span class="w">                    </span><span class="o">//</span><span class="w"> </span><span class="mi">3</span><span class="o">/</span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">Dtor</span>
<span class="p">};</span>
</pre></div>

<h3>The rule of zero</h3>
<p>The rule of 3/5 is also referred to as the rule of 0/3/5. The zero part of the
rule states that you are allowed to not write any of the special member
functions when creating your class.</p>
<h2>Advice</h2>
<p>Most of the time, you do not need to manage a resource yourself, because an
existing class such as <code>std::string</code> already does it for you. Just compare the
simple code using a <code>std::string</code> member to the convoluted and error-prone
alternative using a <code>char*</code> and you should be convinced. As long as you stay
away from raw pointer members, the rule of three is unlikely to concern your
own code.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The Rule of Three is a rule of thumb for C++, basically saying</p>
<blockquote>
<p>If your class needs any of</p>
<ul>
<li>a <strong>copy constructor</strong> ,</li>
<li>an <strong>assignment operator</strong> ,</li>
<li>or a <strong>destructor</strong> ,
</li>
</ul>
<p>defined explictly, then it is likely to need <strong>all three of them</strong>.</p>
</blockquote>
<p>The reasons for this is that all three of them are usually used to manage a
resource, and if your class manages a resource, it usually needs to manage
copying as well as freeing.</p>
<p>If there is no good semantic for copying the resource your class manages, then
consider to forbid copying by declaring (not <em>defining</em> ) the copy constructor
and assignment operator as <code>private</code>.</p>
<p>(Note that the forthcoming new version of the C++ standard (which is C++11)
adds move semantics to C++, which will likely change the Rule of Three.
However, I know too little about this to write a C++11 section about the Rule
of Three.)</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-make-a-great-r-reproducible-example/" class="u-url">How to make a great R reproducible example</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-make-a-great-r-reproducible-example/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T21:22:26+08:00" itemprop="datePublished" title="2023-02-16 21:22">2023-02-16 21:22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><strong>This question's answers are a community effort</strong>. Edit existing answers to
improve this post. It is not currently accepting new answers or interactions.</p>
<p>When discussing performance with colleagues, teaching, sending a bug report or
searching for guidance on mailing lists and here on Stack Overflow, a
reproducible example is often asked and always helpful.</p>
<p>What are your tips for creating an excellent example? How do you paste data
structures from r in a text format? What other information should you include?</p>
<p>Are there other tricks in addition to using <code>dput()</code>, <code>dump()</code> or
<code>structure()</code>? When should you include <code>library()</code> or <code>require()</code> statements?
Which reserved words should one avoid, in addition to <code>c</code>, <code>df</code>, <code>data</code>, etc.?</p>
<p>How does one make a great r reproducible example?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Basically, a <strong>minimal reproducible example (MRE)</strong> should enable others to
<em>exactly</em> reproduce your issue on their machines.</p>
<p><strong>Please do not post images of your data, code, or console output!</strong></p>
<h2>tl;dr</h2>
<p>A MRE consists of the following items:</p>
<ul>
<li>a <strong>minimal dataset</strong> , necessary to demonstrate the problem</li>
<li>the <strong>minimal <em>runnable</em> code</strong> necessary to reproduce the issue, which can be run on the given dataset</li>
<li>all <strong>necessary information</strong> on the used <code>library</code>s, the R version, and the OS it is run on, perhaps a <code>sessionInfo()</code>
</li>
<li>in the case of random processes, a <strong>seed</strong> (set by <code>set.seed()</code>) to enable others to replicate exactly the same results as you do</li>
</ul>
<p>For examples of good MREs, see section "Examples" at the bottom of help pages
on the function you are using. Simply type e.g. <code>help(mean)</code>, or short <code>?mean</code>
into your R console.</p>
<h2>Providing a minimal dataset</h2>
<p>Usually, sharing huge data sets is not necessary and may rather discourage
others from reading your question. Therefore, it is better to use built-in
datasets or create a small "toy" example that resembles your original data,
which is actually what is meant by <em>minimal</em>. If for some reason you really
need to share your original data, you should use a method, such as <code>dput()</code>,
that allows others to get an exact copy of your data.</p>
<h4>Built-in datasets</h4>
<p>You can use one of the built-in datasets. A comprehensive list of built-in
datasets can be seen with <code>data()</code>. There is a short description of every data
set, and more information can be obtained, e.g. with <code>?iris</code>, for the 'iris'
data set that comes with R. Installed packages might contain additional
datasets.</p>
<h4>Creating example data sets</h4>
<p><em>Preliminary note:</em> Sometimes you may need special formats (i.e. classes),
such as factors, dates, or time series. For these, make use of functions like:
<code>as.factor</code>, <code>as.Date</code>, <code>as.xts</code>, ... <em>Example:</em></p>
<div class="code"><pre class="code literal-block"><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="s">"2020-12-30"</span><span class="p">)</span>
</pre></div>

<p>where</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span>(<span class="nb">d</span>)
<span class="c1"># [1] "Date"</span>
</pre></div>

<p><strong>Vectors</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1">## random vector normal distributed</span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1">## random vector uniformly distributed    </span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1">## 10 random draws out of 1, 2, ..., 100    </span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1">## 10 random draws out of built-in latin alphabet</span>
</pre></div>

<p><strong>Matrices</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">dimnames</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="w"> </span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]))</span>
<span class="n">m</span>
<span class="c1">#   A B C  D</span>
<span class="c1"># A 1 4 7 10</span>
<span class="c1"># B 2 5 8 11</span>
<span class="c1"># C 3 6 9 12</span>
</pre></div>

<p><strong>Data frames</strong></p>
<div class="code"><pre class="code literal-block"><span class="nf">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span><span class="w">  </span><span class="c1">## for sake of reproducibility</span>
<span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">6</span>
<span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="w"> </span>
<span class="w">                  </span><span class="n">date</span><span class="o">=</span><span class="nf">seq.Date</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="s">"2020-12-26"</span><span class="p">),</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="s">"2020-12-31"</span><span class="p">),</span><span class="w"> </span><span class="s">"day"</span><span class="p">),</span>
<span class="w">                  </span><span class="n">group</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">n</span><span class="o">/</span><span class="m">2</span><span class="p">),</span>
<span class="w">                  </span><span class="n">age</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="m">18</span><span class="o">:</span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span>
<span class="w">                  </span><span class="n">type</span><span class="o">=</span><span class="nf">factor</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">"type"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">)),</span>
<span class="w">                  </span><span class="n">x</span><span class="o">=</span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">dat</span>
<span class="c1">#   id       date group age   type         x</span>
<span class="c1"># 1  1 2020-12-26     A  27 type 1 0.0356312</span>
<span class="c1"># 2  2 2020-12-27     B  19 type 2 1.3149588</span>
<span class="c1"># 3  3 2020-12-28     A  20 type 3 0.9781675</span>
<span class="c1"># 4  4 2020-12-29     B  26 type 4 0.8817912</span>
<span class="c1"># 5  5 2020-12-30     A  26 type 5 0.4822047</span>
<span class="c1"># 6  6 2020-12-31     B  28 type 6 0.9657529</span>
</pre></div>

<p><strong>Note:</strong> Although it is widely used, better do not name your data frame <code>df</code>,
because <code>df()</code> is an R function for the density (i.e. height of the curve at
point <code>x</code>) of the F distribution and you might get a clash with it.</p>
<h4>Copying original data</h4>
<p>If you have a specific reason, or data that would be too difficult to
construct an example from, you could provide a small subset of your original
data, best by using <code>dput</code>.</p>
<p><strong>Why use<code>dput()</code>?</strong></p>
<p><code>dput</code> throws all information needed to exactly reproduce your data on your
console. You may simply copy the output and paste it into your question.</p>
<p>Calling <code>dat</code> (from above) produces output that still lacks information about
variable classes and other features if you share it in your question.
Furthermore, the spaces in the <code>type</code> column make it difficult to do anything
with it. Even when we set out to use the data, we won't manage to get
important features of your data right.</p>
<div class="code"><pre class="code literal-block">  id       date group age   type         x
1  1 2020-12-26     A  27 type 1 0.0356312
2  2 2020-12-27     B  19 type 2 1.3149588
3  3 2020-12-28     A  20 type 3 0.9781675
</pre></div>

<p><strong>Subset your data</strong></p>
<p>To share a subset, use <code>head()</code>, <code>subset()</code> or the indices <code>iris[1:4, ]</code>. Then
wrap it into <code>dput()</code> to give others something that can be put in R
immediately. <em>Example</em></p>
<div class="code"><pre class="code literal-block">dput(iris[1:4, ]) # first four rows of the iris data set
</pre></div>

<p><em>Console output to share in your question:</em></p>
<div class="code"><pre class="code literal-block">structure(list(Sepal.Length = c(5.1, 4.9, 4.7, 4.6), Sepal.Width = c(3.5, 
3, 3.2, 3.1), Petal.Length = c(1.4, 1.4, 1.3, 1.5), Petal.Width = c(0.2, 
0.2, 0.2, 0.2), Species = structure(c(1L, 1L, 1L, 1L), .Label = c("setosa", 
"versicolor", "virginica"), class = "factor")), row.names = c(NA, 
4L), class = "data.frame")
</pre></div>

<p>When using <code>dput</code>, you may also want to include only relevant columns, e.g.
dput(mtcars[1:3, c(2, 5, 6)])</p>
<p><strong>Note:</strong> If your data frame has a factor with many levels, the <code>dput</code> output
can be unwieldy because it will still list all the possible factor levels even
if they aren't present in the subset of your data. To solve this issue, you
can use the <code>droplevels()</code> function. Notice below how species is a factor with
only one level, e.g. <code>dput(droplevels(iris[1:4, ]))</code>. One other caveat for
<code>dput</code> is that it will not work for keyed <code>data.table</code> objects or for grouped
<code>tbl_df</code> (class <code>grouped_df</code>) from the <code>tidyverse</code>. In these cases you can
convert back to a regular data frame before sharing,
<code>dput(as.data.frame(my_data))</code>.</p>
<h2>Producing minimal code</h2>
<p>Combined with the minimal data (see above), your code should exactly reproduce
the problem on another machine by simply copying and pasting it.</p>
<p>This should be the easy part but often isn't. What you should not do:</p>
<ul>
<li>showing all kinds of data conversions; make sure the provided data is already in the correct format (unless that is the problem, of course)</li>
<li>copy-paste a whole script that gives an error somewhere. Try to locate which lines exactly result in the error. More often than not, you'll find out what the problem is yourself.</li>
</ul>
<p>What you should do:</p>
<ul>
<li>add which packages you use if you use any (using <code>library()</code>)</li>
<li>test run your code in a fresh R session to ensure the code is runnable. People should be able to copy-paste your data and your code in the console and get the same as you have.</li>
<li>if you open connections or create files, add some code to close them or delete the files (using <code>unlink()</code>)</li>
<li>if you change options, make sure the code contains a statement to revert them back to the original ones. (eg <code>op &lt;- par(mfrow=c(1,2)) ...some code... par(op)</code> )</li>
</ul>
<h2>Providing necessary information</h2>
<p>In most cases, just the R version and the operating system will suffice. When
conflicts arise with packages, giving the output of <code>sessionInfo()</code> can really
help. When talking about connections to other applications (be it through ODBC
or anything else), one should also provide version numbers for those, and if
possible, also the necessary information on the setup.</p>
<p>If you are running R in <em>R Studio</em> , using <code>rstudioapi::versionInfo()</code> can
help report your RStudio version.</p>
<p>If you have a problem with a specific package, you may want to provide the
package version by giving the output of <code>packageVersion("name of the
package")</code>.</p>
<h2>Seed</h2>
<p>Using <code>set.seed()</code> you may specify a seed1, i.e. the specific state, R's
random number generator is fixed. This makes it possible for random functions,
such as <code>sample()</code>, <code>rnorm()</code>, <code>runif()</code> and lots of others, to always return
the same result, <em>Example:</em></p>
<div class="code"><pre class="code literal-block">set.seed(42)
rnorm(3)
# [1]  1.3709584 -0.5646982  0.3631284

set.seed(42)
rnorm(3)
# [1]  1.3709584 -0.5646982  0.3631284
</pre></div>

<p>1 <strong>Note:</strong> The output of <code>set.seed()</code> differs between R &gt;3.6.0 and previous
versions. Specify which R version you used for the random process, and don't
be surprised if you get slightly different results when following old
questions. To get the same result in such cases, you can use the
<code>RNGversion()</code>-function before <code>set.seed()</code> (e.g.: <code>RNGversion("3.5.2")</code>).</p>
<p><br></p>
<h3>Suggest</h3>
<p>(Here's my advice from How to write a reproducible example. I've tried to make
it short but sweet).</p>
<h2>How to write a reproducible example</h2>
<p>You are most likely to get good help with your R problem if you provide a
reproducible example. A reproducible example allows someone else to recreate
your problem by just copying and pasting R code.</p>
<p>You need to include four things to make your example reproducible: required
packages, data, code, and a description of your R environment.</p>
<ul>
<li>
<p><strong>Packages</strong> should be loaded at the top of the script, so it's easy to see which ones the example needs.</p>
</li>
<li>
<p>The easiest way to include <strong>data</strong> in an email or Stack Overflow question is to use <code>dput()</code> to generate the R code to recreate it. For example, to recreate the <code>mtcars</code> dataset in R, I'd perform the following steps:</p>
<ol>
<li>Run <code>dput(mtcars)</code> in R</li>
<li>Copy the output</li>
<li>In my reproducible script, type <code>mtcars &lt;-</code> then paste.</li>
<li>
<p>Spend a little bit of time ensuring that your <strong>code</strong> is easy for others to read:</p>
</li>
<li>
<p>Make sure you've used spaces and your variable names are concise, but informative</p>
</li>
<li>
<p>Use comments to indicate where your problem lies</p>
</li>
<li>
<p>Do your best to remove everything that is not related to the problem.<br>
The shorter your code is, the easier it is to understand.</p>
</li>
</ol>
</li>
<li>
<p>Include the output of <code>sessionInfo()</code> in a comment in your code. This summarises your <strong>R environment</strong> and makes it easy to check if you're using an out-of-date package.</p>
</li>
</ul>
<p>You can check you have actually made a reproducible example by starting up a
fresh R session and pasting your script in.</p>
<p>Before putting all of your code in an email, consider putting it on Gist
github. It will give your code nice syntax highlighting, and you don't have to
worry about anything getting mangled by the email system.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-104.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-102.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
