<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2391) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2391.html">
<link rel="prev" href="index-2392.html" type="text/html">
<link rel="next" href="index-2390.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/" class="u-url">Peak signal detection in realtime timeseries data</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/peak-signal-detection-in-realtime-timeseries-data/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T12:39:42+08:00" itemprop="datePublished" title="2023-03-04 12:39">2023-03-04 12:39</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <hr>
<p><strong>Update:</strong> The best performing algorithm <em>so far</em> <strong>is this one</strong>.</p>
<hr>
<p><em>This question explores robust algorithms for detecting sudden peaks in real-
time timeseries data.</em></p>
<p>Consider the following example data:</p>
<p><img alt="Plot of data" src="images/yUeKr.jpg"></p>
<p>Example of this data is in Matlab format (but this question is not about the
language but about the algorithm):</p>
<div class="code"><pre class="code literal-block">p = [1 1 1.1 1 0.9 1 1 1.1 1 0.9 1 1.1 1 1 0.9 1 1 1.1 1 1 1 1 1.1 0.9 1 1.1 1 1 0.9, ...
     1 1.1 1 1 1.1 1 0.8 0.9 1 1.2 0.9 1 1 1.1 1.2 1 1.5 1 3 2 5 3 2 1 1 1 0.9 1 1, ... 
     3 2.6 4 3 3.2 2 1 1 0.8 4 4 2 2.5 1 1 1];
</pre></div>

<p>You can clearly see that there are three large peaks and some small peaks.
This dataset is a specific example of the class of timeseries datasets that
the question is about. This class of datasets has two general features:</p>
<ol>
<li>There is basic noise with a general mean</li>
<li>There are large ' <em>peaks</em> ' or ' <em>higher data points</em> ' that significantly deviate from the noise.</li>
</ol>
<p>Let's also assume the following:</p>
<ul>
<li>The width of the peaks cannot be determined beforehand</li>
<li>The height of the peaks significantly deviates from the other values</li>
<li>The algorithm updates in realtime (so updates with each new datapoint)</li>
</ul>
<p>For such a situation, a boundary value needs to be constructed which triggers
signals. However, the boundary value cannot be static and must be determined
realtime based on an algorithm.</p>
<hr>
<p><strong>My Question: what is a good algorithm to calculate such thresholds in
realtime?</strong> Are there specific algorithms for such situations? What are the
most well-known algorithms?</p>
<hr>
<p>Robust algorithms or useful insights are all highly appreciated. (can answer
in any language: it's about the algorithm)</p>
<p><br><br></p>
<h2>Answer</h2>
<h2>Robust peak detection algorithm (using z-scores)</h2>
<p>I came up with an algorithm that works very well for these types of datasets.
It is based on the principle of dispersion: if a new datapoint is a given x
number of standard deviations away from some moving mean, the algorithm
signals (also called z-score). The algorithm is very robust because it
constructs a <em>separate</em> moving mean and deviation, such that signals do not
corrupt the threshold. Future signals are therefore identified with
approximately the same accuracy, regardless of the amount of previous signals.
The algorithm takes 3 inputs: <code>lag = the lag of the moving window</code>, <code>threshold
= the z-score at which the algorithm signals</code> and <code>influence = the influence
(between 0 and 1) of new signals on the mean and standard deviation</code>. For
example, a <code>lag</code> of 5 will use the last 5 observations to smooth the data. A
<code>threshold</code> of 3.5 will signal if a datapoint is 3.5 standard deviations away
from the moving mean. And an <code>influence</code> of 0.5 gives signals <em>half</em> of the
influence that normal datapoints have. Likewise, an <code>influence</code> of 0 ignores
signals completely for recalculating the new threshold. An influence of 0 is
therefore the most robust option (but assumes stationarity); putting the
influence option at 1 is least robust. For non-stationary data, the influence
option should therefore be put somewhere between 0 and 1.</p>
<p>It works as follows:</p>
<p><em><strong>Pseudocode</strong></em></p>
<div class="code"><pre class="code literal-block"><span class="c1"># Let y be a vector of timeseries data of at least length lag+2</span>
<span class="c1"># Let mean() be a function that calculates the mean</span>
<span class="c1"># Let std() be a function that calculates the standard deviaton</span>
<span class="c1"># Let absolute() be the absolute value function</span>

<span class="c1"># Settings (these are examples: choose what is best for your data!)</span>
<span class="n">set</span><span class="w"> </span><span class="n">lag</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">          </span><span class="c1"># average and std. are based on past 5 observations</span>
<span class="n">set</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">3.5</span><span class="p">;</span><span class="w">  </span><span class="c1"># signal when data point is 3.5 std. away from average</span>
<span class="n">set</span><span class="w"> </span><span class="n">influence</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span><span class="w">  </span><span class="c1"># between 0 (no influence) and 1 (full influence)</span>

<span class="c1"># Initialize variables</span>
<span class="n">set</span><span class="w"> </span><span class="n">signals</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">vector</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w">   </span><span class="c1"># Initialize signal results</span>
<span class="n">set</span><span class="w"> </span><span class="n">filteredY</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">...</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span><span class="w">                </span><span class="c1"># Initialize filtered series</span>
<span class="n">set</span><span class="w"> </span><span class="n">avgFilter</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span><span class="w">                          </span><span class="c1"># Initialize average filter</span>
<span class="n">set</span><span class="w"> </span><span class="n">stdFilter</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span><span class="w">                          </span><span class="c1"># Initialize std. filter</span>
<span class="n">set</span><span class="w"> </span><span class="n">avgFilter</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">...</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">lag</span><span class="p">));</span><span class="w">    </span><span class="c1"># Initialize first value average</span>
<span class="n">set</span><span class="w"> </span><span class="n">stdFilter</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="o">...</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">lag</span><span class="p">));</span><span class="w">     </span><span class="c1"># Initialize first value std.</span>

<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">lag</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">t</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">absolute</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">avgFilter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">threshold</span><span class="o">*</span><span class="n">stdFilter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">then</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">avgFilter</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">then</span>
<span class="w">      </span><span class="n">set</span><span class="w"> </span><span class="n">signals</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w">                     </span><span class="c1"># Positive signal</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">      </span><span class="n">set</span><span class="w"> </span><span class="n">signals</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w">                     </span><span class="c1"># Negative signal</span>
<span class="w">    </span><span class="n">end</span>
<span class="w">    </span><span class="n">set</span><span class="w"> </span><span class="n">filteredY</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">influence</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">influence</span><span class="p">)</span><span class="o">*</span><span class="n">filteredY</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="n">set</span><span class="w"> </span><span class="n">signals</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">                        </span><span class="c1"># No signal</span>
<span class="w">    </span><span class="n">set</span><span class="w"> </span><span class="n">filteredY</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">  </span><span class="n">end</span>
<span class="w">  </span><span class="n">set</span><span class="w"> </span><span class="n">avgFilter</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">filteredY</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">lag</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="o">...</span><span class="p">,</span><span class="n">filteredY</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="w">  </span><span class="n">set</span><span class="w"> </span><span class="n">stdFilter</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">std</span><span class="p">(</span><span class="n">filteredY</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="n">lag</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="o">...</span><span class="p">,</span><span class="n">filteredY</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="n">end</span>
</pre></div>

<p>Rules of thumb for selecting good parameters for your data can be found below.</p>
<hr>
<h3>Demo</h3>
<p><img alt="Demonstration of robust thresholding
algorithm" src="https://i.imgur.com/LFvEM2Y.gif"></p>
<p>The Matlab code for this demo can be found <strong>here</strong>. To use the demo, simply
run it and create a time series yourself by clicking on the upper chart. The
algorithm starts working after drawing <code>lag</code> number of observations.</p>
<hr>
<h3>Result</h3>
<p>For the original question, this algorithm will give the following output when
using the following settings: <code>lag = 30, threshold = 5, influence = 0</code>:</p>
<p><img alt="Thresholding algorithm example" src="images/KdpF7.jpg"></p>
<hr>
<h3>Implementations in different programming languages:</h3>
<ul>
<li>
<h3>Matlab (me)</h3>
</li>
<li>
<h3>R (me)</h3>
</li>
<li>
<h3>Golang (Xeoncross)</h3>
</li>
<li>
<h3>Golang [efficient version] (Micah Parks)</h3>
</li>
<li>
<h3>Python (R Kiselev)</h3>
</li>
<li>
<h3>Python [efficient version] (delica)</h3>
</li>
<li>
<h3>Swift (me)</h3>
</li>
<li>
<h3>Groovy (JoshuaCWebDeveloper)</h3>
</li>
<li>
<h3>C++ [interactive parameters] (Jason C)</h3>
</li>
<li>
<h3>C++ (Animesh Pandey)</h3>
</li>
<li>
<h3>Rust (swizard)</h3>
</li>
<li>
<h3>Scala (Mike Roberts)</h3>
</li>
<li>
<h3>Kotlin (leoderprofi)</h3>
</li>
<li>
<h3>Ruby (Kimmo Lehto)</h3>
</li>
<li>
<h3>Fortran [for resonance detection] (THo)</h3>
</li>
<li>
<h3>Julia (Matt Camp)</h3>
</li>
<li>
<h3>C# (Ocean Airdrop)</h3>
</li>
<li>
<h3>C (DavidC)</h3>
</li>
<li>
<h3>Java (takanuva15)</h3>
</li>
<li>
<h3>JavaScript (Dirk Lüsebrink)</h3>
</li>
<li>
<h3>TypeScript (Jerry Gamble)</h3>
</li>
<li>
<h3>Perl (Alen)</h3>
</li>
<li>
<h3>PHP (radhoo)</h3>
</li>
<li>
<h3>PHP (gtjamesa)</h3>
</li>
<li>
<h3>Dart (Sga)</h3>
</li>
</ul>
<hr>
<h3>Rules of thumb for configuring the algorithm</h3>
<p><em><strong><code>lag</code></strong></em> : the lag parameter determines how much your data will be smoothed
and how adaptive the algorithm is to changes in the long-term average of the
data. The more stationary your data is, the more lags you should include (this
should improve the robustness of the algorithm). If your data contains time-
varying trends, you should consider how quickly you want the algorithm to
adapt to these trends. I.e., if you put <code>lag</code> at 10, it takes 10 'periods'
before the algorithm's treshold is adjusted to any systematic changes in the
long-term average. So choose the <code>lag</code> parameter based on the trending
behavior of your data and how adaptive you want the algorithm to be.</p>
<p><em><strong><code>influence</code></strong></em> : this parameter determines the influence of signals on the
algorithm's detection threshold. If put at 0, signals have no influence on the
threshold, such that future signals are detected based on a threshold that is
calculated with a mean and standard deviation that is not influenced by past
signals. If put at 0.5, signals have <em>half</em> the influence of normal data
points. Another way to think about this is that if you put the influence at 0,
you implicitly assume stationarity (i.e. no matter how many signals there are,
you always expect the time series to return to the same average over the long
term). If this is not the case, you should put the influence parameter
somewhere between 0 and 1, depending on the extent to which signals can
systematically influence the time-varying trend of the data. E.g., if signals
lead to a structural break of the long-term average of the time series, the
influence parameter should be put high (close to 1) so the threshold can react
to structural breaks quickly.</p>
<p><em><strong><code>threshold</code></strong></em> : the threshold parameter is the number of standard
deviations from the moving mean above which the algorithm will classify a new
datapoint as being a signal. For example, if a new datapoint is 4.0 standard
deviations above the moving mean and the threshold parameter is set as 3.5,
the algorithm will identify the datapoint as a signal. This parameter should
be set based on how many signals you expect. For example, if your data is
normally distributed, a threshold (or: z-score) of 3.5 corresponds to a
signaling probability of 0.00047 (from this table), which implies that you
expect a signal once every 2128 datapoints (1/0.00047). The threshold
therefore directly influences how sensitive the algorithm is and thereby also
determines how often the algorithm signals. Examine your own data and choose a
sensible threshold that makes the algorithm signal when you want it to (some
trial-and-error might be needed here to get to a good threshold for your
purpose).</p>
<hr>
<p><strong>WARNING: The code above always loops over all datapoints everytime it
runs.</strong> When implementing this code, make sure to split the calculation of the
signal into a separate function (without the loop). Then when a new datapoint
arrives, update <code>filteredY</code>, <code>avgFilter</code> and <code>stdFilter</code> once. Do not
recalculate the signals for all data everytime there is a new datapoint (like
in the example above), that would be extremely inefficient and slow in real-
time applications.</p>
<p>Other ways to modify the algorithm (for potential improvements) are:</p>
<ol>
<li>Use median instead of mean</li>
<li>Use a robust measure of scale, such as the median absolute deviation (MAD), instead of the standard deviation</li>
<li>Use a signalling margin, so the signal doesn't switch too often</li>
<li>Change the way the influence parameter works</li>
<li>Treat <em>up</em> and <em>down</em> signals differently (asymmetric treatment)</li>
<li>Create a separate <code>influence</code> parameter for the mean and std (as in this Swift translation)</li>
</ol>
<hr>
<h3>(Known) academic citations to this StackOverflow answer:</h3>
<ul>
<li>
<p>Catalbas, M. C., &amp; Dobrisek, S. (2023). <strong>Dynamic speaker localization based on a novel lightweight R–CNN model</strong>. <em>Neural Computing and Applications</em> , 1-15.</p>
</li>
<li>
<p>Cai, Y., Wang, X., Joos, G., &amp; Kamwa, I. (2022). <strong>An Online Data-Driven Method to Locate Forced Oscillation Sources from Power Plants Based on Sparse Identification of Nonlinear Dynamics (SINDy)</strong>. IEEE Transactions on Power Systems.</p>
</li>
<li>
<p>Yang, S., Yim, J., Kim, J., &amp; Shin, H. V. (2022). <strong>CatchLive: Real-time Summarization of Live Streams with Stream Content and Interaction Data</strong>. <em>CHI Conference on Human Factors in Computing Systems</em> , 1-20.</p>
</li>
<li>
<p>Feng, D., Tan, Z., Engwirda, D., Liao, C., Xu, D., Bisht, G., ... &amp; Leung, R. (2022). <strong>Investigating coastal backwater effects and flooding in the coastal zone using a global river transport model on an unstructured mesh</strong>. <em>Hydrology and Earth System Sciences Discussions</em> , 1-31 [preprint].</p>
</li>
<li>
<p>Link, J., Perst, T., Stoeve, M., &amp; Eskofier, B. M. (2022). <strong>Wearable sensors for activity recognition in ultimate frisbee using convolutional neural networks and transfer learning</strong>. <em>Sensors</em> , 22(7), 2560.</p>
</li>
<li>
<p>Romeiro, J. M. N., Torres, F. T. P., &amp; Pirotti, F. (2021). <strong>Evaluation of Effect of Prescribed Fires Using Spectral Indices and SAR Data</strong>. <em>Bollettino della società italiana di fotogrammetria e topografia</em> , (2), 36-56.</p>
</li>
<li>
<p>Moore, J., Goffin, P., Wiese, J., &amp; Meyer, M. (2021). <strong>An Interview Method for Engaging Personal Data</strong>. <em>Proceedings of the ACM on Interactive, Mobile, Wearable and Ubiquitous Technologies</em> , 5(4), 1-28.</p>
</li>
<li>
<p>Rykov, Y., Thach, T. Q., Bojic, I., Christopoulos, G., &amp; Car, J. (2021). <strong>Digital Biomarkers for Depression Screening With Wearable Devices: Cross-sectional Study With Machine Learning Modeling</strong>. <em>JMIR mHealth and uHealth</em> , 9(10), e24872.</p>
</li>
<li>
<p>Hong, Y., Xin, Y., Martin, H., Bucher, D., &amp; Raubal, M. (2021). <strong>A Clustering-Based Framework for Individual Travel Behaviour Change Detection</strong>. In 11th International Conference on Geographic Information Science (GIScience 2021)-Part II.</p>
</li>
<li>
<p>Grammenos, A., Kalyvianaki, E., &amp; Pietzuch, P. (2021). <strong>Pronto: Federated Task Scheduling</strong>. arXiv preprint arXiv:2104.13429.</p>
</li>
<li>
<p>Courtial, N. (2020). <strong>Fusion d’images multimodales pour l’assistance de procédures d’électrophysiologie cardiaque</strong>. <em>Doctoral dissertation</em> , Université Rennes.</p>
</li>
<li>
<p>Beckman, W. F., Jiménez, M. Á. L., Moerland, P. D., Westerhoff, H. V., &amp; Verschure, P. J. (2020). <strong>4sUDRB-sequencing for genome-wide transcription bursting quantification in breast cancer cells</strong>. bioRxiv.</p>
</li>
<li>
<p>Olkhovskiy, M., Müllerová, E., &amp; Martínek, P. (2020). <strong>Impulse signals classification using one dimensional convolutional neural network</strong>. Journal of Electrical Engineering, 71(6), 397-405.</p>
</li>
<li>
<p>Gao, S., &amp; Calderon, D. P. (2020). <strong>Robust alternative to the righting reflex to assess arousal in rodents</strong>. Scientific reports, 10(1), 1-11.</p>
</li>
<li>
<p>Chen, G. &amp; Dong, W. (2020). <strong>Reactive Jamming and Attack Mitigation over Cross-Technology Communication Links</strong>. ACM Transactions on Sensor Networks, 17(1).</p>
</li>
<li>
<p>Takahashi, R., Fukumoto, M., Han, C., Sasatani, T., Narusue, Y., &amp; Kawahara, Y. (2020). <strong>TelemetRing: A Batteryless and Wireless Ring-shaped Keyboard using Passive Inductive Telemetry</strong>. In Proceedings of the 33rd Annual ACM Symposium on User Interface Software and Technology (pp. 1161-1168).</p>
</li>
<li>
<p>Negus, M. J., Moore, M. R., Oliver, J. M., Cimpeanu, R. (2020). <strong>Droplet impact onto a spring-supported plate: analysis and simulations</strong>. Journal of Engineering Mathematics, 128(3).</p>
</li>
<li>
<p>Yin, C. (2020). <strong>Dinucleotide repeats in coronavirus SARS-CoV-2 genome: evolutionary implications</strong>. ArXiv e-print, accessible from: https://arxiv.org/pdf/2006.00280.pdf</p>
</li>
<li>
<p>Esnaola-Gonzalez, I., Gómez-Omella, M., Ferreiro, S., Fernandez, I., Lázaro, I., &amp; García, E. (2020). <strong>An IoT Platform Towards the Enhancement of Poultry Production Chains</strong>. Sensors, 20(6), 1549.</p>
</li>
<li>
<p>Gao, S., &amp; Calderon, D. P. (2020). <strong>Continuous regimens of cortico-motor integration calibrate levels of arousal during emergence from anesthesia</strong>. bioRxiv.</p>
</li>
<li>
<p>Cloud, B., Tarien, B., Liu, A., Shedd, T., Lin, X., Hubbard, M., ... &amp; Moore, J. K. (2019). <strong>Adaptive smartphone-based sensor fusion for estimating competitive rowing kinematic metrics</strong>. PloS one, 14(12).</p>
</li>
<li>
<p>Ceyssens, F., Carmona, M. B., Kil, D., Deprez, M., Tooten, E., Nuttin, B., ... &amp; Puers, R. (2019). <strong>Chronic neural recording with probes of subcellular cross-section using 0.06 mm² dissolving microneedles as insertion device</strong>. <em>Sensors and Actuators B: Chemical</em> , 284, pp. 369-376.</p>
</li>
<li>
<p>Dons, E., Laeremans, M., Orjuela, J. P., Avila-Palencia, I., de Nazelle, A., Nieuwenhuijsen, M., ... &amp; Nawrot, T. (2019). <strong>Transport Most Likely to Cause Air Pollution Peak Exposures in Everyday Life: Evidence from over 2000 Days of Personal Monitoring</strong>. <em>Atmospheric Environment</em> , 213, 424-432.</p>
</li>
<li>
<p>Schaible B.J., Snook K.R., Yin J., et al. (2019). <strong>Twitter conversations and English news media reports on poliomyelitis in five different countries, January 2014 to April 2015</strong>. <em>The Permanente Journal</em> , 23, 18-181.</p>
</li>
<li>
<p>Lima, B. (2019). <strong>Object Surface Exploration Using a Tactile-Enabled Robotic Fingertip</strong> (Doctoral dissertation, Université d'Ottawa/University of Ottawa).</p>
</li>
<li>
<p>Lima, B. M. R., Ramos, L. C. S., de Oliveira, T. E. A., da Fonseca, V. P., &amp; Petriu, E. M. (2019). <strong>Heart Rate Detection Using a Multimodal Tactile Sensor and a Z-score Based Peak Detection Algorithm</strong>. <em>CMBES Proceedings</em> , 42.</p>
</li>
<li>
<p>Lima, B. M. R., de Oliveira, T. E. A., da Fonseca, V. P., Zhu, Q., Goubran, M., Groza, V. Z., &amp; Petriu, E. M. (2019, June). <strong>Heart Rate Detection Using a Miniaturized Multimodal Tactile Sensor</strong>. <em>In 2019 IEEE International Symposium on Medical Measurements and Applications (MeMeA)</em> (pp. 1-6). IEEE.</p>
</li>
<li>
<p>Ting, C., Field, R., Quach, T., Bauer, T. (2019). <strong>Generalized Boundary Detection Using Compression-based Analytics</strong>. <em>ICASSP 2019 - 2019 IEEE International Conference on Acoustics, Speech and Signal Processing (ICASSP)</em> , Brighton, United Kingdom, pp. 3522-3526.</p>
</li>
<li>
<p>Carrier, E. E. (2019). <strong>Exploiting compression in solving discretized linear systems</strong>. <em>Doctoral dissertation</em> , University of Illinois at Urbana-Champaign.</p>
</li>
<li>
<p>Khandakar, A., Chowdhury, M. E., Ahmed, R., Dhib, A., Mohammed, M., Al-Emadi, N. A., &amp; Michelson, D. (2019). <strong>Portable system for monitoring and controlling driver behavior and the use of a mobile phone while driving</strong>. <em>Sensors</em> , 19(7), 1563.</p>
</li>
<li>
<p>Baskozos, G., Dawes, J. M., Austin, J. S., Antunes-Martins, A., McDermott, L., Clark, A. J., ... &amp; Orengo, C. (2019). <strong>Comprehensive analysis of long noncoding RNA expression in dorsal root ganglion reveals cell-type specificity and dysregulation after nerve injury</strong>. <em>Pain</em> , 160(2), 463.</p>
</li>
<li>
<p>Cloud, B., Tarien, B., Crawford, R., &amp; Moore, J. (2018). <strong>Adaptive smartphone-based sensor fusion for estimating competitive rowing kinematic metrics</strong>. <em>engrXiv Preprints</em>.</p>
</li>
<li>
<p>Zajdel, T. J. (2018). <strong>Electronic Interfaces for Bacteria-Based Biosensing</strong>. <em>Doctoral dissertation</em> , UC Berkeley.</p>
</li>
<li>
<p>Perkins, P., Heber, S. (2018). <strong>Identification of Ribosome Pause Sites Using a Z-Score Based Peak Detection Algorithm</strong>. <em>IEEE 8th International Conference on Computational Advances in Bio and Medical Sciences (ICCABS)</em> , ISBN: 978-1-5386-8520-4.</p>
</li>
<li>
<p>Moore, J., Goffin, P., Meyer, M., Lundrigan, P., Patwari, N., Sward, K., &amp; Wiese, J. (2018). <strong>Managing In-home Environments through Sensing, Annotating, and Visualizing Air Quality Data</strong>. <em>Proceedings of the ACM on Interactive, Mobile, Wearable and Ubiquitous Technologies</em> , 2(3), 128.</p>
</li>
<li>
<p>Lo, O., Buchanan, W. J., Griffiths, P., and Macfarlane, R. (2018), <strong>Distance Measurement Methods for Improved Insider Threat Detection</strong> , <em>Security and Communication Networks</em> , Vol. 2018, Article ID 5906368.</p>
</li>
<li>
<p>Apurupa, N. V., Singh, P., Chakravarthy, S., &amp; Buduru, A. B. (2018). <strong>A critical study of power consumption patterns in Indian Apartments</strong>. <em>Doctoral dissertation</em> , IIIT-Delhi.</p>
</li>
<li>
<p>Scirea, M. (2017). <strong>Affective Music Generation and its effect on player experience</strong>. <em>Doctoral dissertation</em> , IT University of Copenhagen, Digital Design.</p>
</li>
<li>
<p>Scirea, M., Eklund, P., Togelius, J., &amp; Risi, S. (2017). <strong>Primal-improv: Towards co-evolutionary musical improvisation</strong>. <em>Computer Science and Electronic Engineering (CEEC)</em> , 2017 (pp. 172-177). IEEE.</p>
</li>
<li>
<p>Catalbas, M. C., Cegovnik, T., Sodnik, J. and Gulten, A. (2017). <strong>Driver fatigue detection based on saccadic eye movements</strong> , <em>10th International Conference on Electrical and Electronics Engineering (ELECO), pp. 913-917.</em></p>
</li>
</ul>
<p><strong>Other works using the algorithm from this answer</strong></p>
<ul>
<li>
<p>Bergamini, E. and E. Mourlon-Druol (2021). <strong>Talking about Europe: exploring 70 years of news archives</strong>. Working Paper 04/2021, Bruegel.</p>
</li>
<li>
<p>Cox, G. (2020). <strong>Peak Detection in a Measured Signal</strong>. <em>Online article on https://www.baeldung.com/cs/signal-peak-detection</em>.</p>
</li>
<li>
<p>Raimundo, D. W. (2020). <strong>SwitP: Mobile Application for Real-Time Swimming Analysis.</strong>. <em>Semester Thesis</em> , ETH Zürich.</p>
</li>
<li>
<p>Bernardi, D. (2019). <strong>A feasibility study on pairing a smartwatch and a mobile device through multi-modal gestures</strong>. <em>Master thesis</em> , Aalto University.</p>
</li>
<li>
<p>Lemmens, E. (2018). <strong>Outlier detection in event logs by using statistical methods</strong> , <em>Master thesis</em> , University of Eindhoven.</p>
</li>
<li>
<p>Willems, P. (2017). <strong>Mood controlled affective ambiences for the elderly</strong> , <em>Master thesis</em> , University of Twente.</p>
</li>
<li>
<p>Ciocirdel, G. D. and Varga, M. (2016). <strong>Election Prediction Based on Wikipedia Pageviews</strong>. <em>Project paper</em> , Vrije Universiteit Amsterdam.</p>
</li>
</ul>
<p><strong>Other applications of the algorithm from this answer</strong></p>
<ul>
<li>
<p><strong>Avo Audit dbt package</strong>. Avo Company (next-generation analytics governance).</p>
</li>
<li>
<p><strong>Synthesized speech with OpenBCI system</strong> , SarahK01.</p>
</li>
<li>
<p><strong>Python package: Machine Learning Financial Laboratory</strong> , based on the work of De Prado, M. L. (2018). <strong>Advances in financial machine learning</strong>. John Wiley &amp; Sons.</p>
</li>
<li>
<p><strong>Adafruit CircuitPlayground Library</strong> , Adafruit board (Adafruit Industries)</p>
</li>
<li>
<p><strong>Step tracker algorithm</strong> , Android App (jeeshnair)</p>
</li>
<li>
<p><strong>R package: animaltracker</strong> (Joe Champion, Thea Sukianto)</p>
</li>
</ul>
<p><strong>Links to other peak detection algorithms</strong></p>
<ul>
<li><strong>Real-time peak detection in noisy sinusoidal time-series</strong></li>
</ul>
<hr>
<h3>How to reference this algorithm:</h3>
<blockquote>
<p>Brakel, J.P.G. van (2014). "Robust peak detection algorithm using z-scores".
Stack Overflow. Available at:
https://stackoverflow.com/questions/22583391/peak-signal-detection-in-
realtime-timeseries-data/22640362#22640362 (version: 2020-11-08).</p>
<p><strong>Bibtex</strong> @misc{brakel2014, author = {Brakel, J.P.G van}, title = {Robust
peak detection algorithm using z-scores}, url =
{https://stackoverflow.com/questions/22583391/peak-signal-detection-in-
realtime-timeseries-data/22640362#22640362}, language = {en}, year = {2014},
urldate = {2022-04-12}, journal = {Stack Overflow}, howpublished =
{https://stackoverflow.com/questions/22583391/peak-signal-detection-in-
realtime-timeseries-data/22640362#22640362}}</p>
</blockquote>
<hr>
<p><em>If you use this function somewhere, please credit me by using above
reference. If you have any questions about the algorithm, post them in the
comments below or contact me on LinkedIn.</em></p>
<hr>
<p><br></p>
<h3>Suggest</h3>
<p>Here is the <code>Python</code> / <code>numpy</code> implementation of the smoothed z-score
algorithm (see answer above). You can find the gist here.</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><span class="ch">#!/usr/bin/env python</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code><span class="c1"># Implementation of algorithm from https://stackoverflow.com/a/22640362/6029703</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code><span class="kn">import</span> <span class="nn">pylab</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code><span class="k">def</span> <span class="nf">thresholding_algo</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lag</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">influence</span><span class="p">):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code>    <span class="n">signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code>    <span class="n">filteredY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code>    <span class="n">avgFilter</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-10"><code data-line-number="10"></code></a></td>
<td class="code"><code>    <span class="n">stdFilter</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-11"><code data-line-number="11"></code></a></td>
<td class="code"><code>    <span class="n">avgFilter</span><span class="p">[</span><span class="n">lag</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">lag</span><span class="p">])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-12"><code data-line-number="12"></code></a></td>
<td class="code"><code>    <span class="n">stdFilter</span><span class="p">[</span><span class="n">lag</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">lag</span><span class="p">])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-13"><code data-line-number="13"></code></a></td>
<td class="code"><code>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lag</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-14"><code data-line-number="14"></code></a></td>
<td class="code"><code>        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">avgFilter</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">stdFilter</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-15"><code data-line-number="15"></code></a></td>
<td class="code"><code>            <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">avgFilter</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-16"><code data-line-number="16"></code></a></td>
<td class="code"><code>                <span class="n">signals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-17"><code data-line-number="17"></code></a></td>
<td class="code"><code>            <span class="k">else</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-18"><code data-line-number="18"></code></a></td>
<td class="code"><code>                <span class="n">signals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-19"><code data-line-number="19"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-20"><code data-line-number="20"></code></a></td>
<td class="code"><code>            <span class="n">filteredY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">influence</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">influence</span><span class="p">)</span> <span class="o">*</span> <span class="n">filteredY</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-21"><code data-line-number="21"></code></a></td>
<td class="code"><code>            <span class="n">avgFilter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">filteredY</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="n">lag</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-22"><code data-line-number="22"></code></a></td>
<td class="code"><code>            <span class="n">stdFilter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">filteredY</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="n">lag</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-23"><code data-line-number="23"></code></a></td>
<td class="code"><code>        <span class="k">else</span><span class="p">:</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-24"><code data-line-number="24"></code></a></td>
<td class="code"><code>            <span class="n">signals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-25"><code data-line-number="25"></code></a></td>
<td class="code"><code>            <span class="n">filteredY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-26"><code data-line-number="26"></code></a></td>
<td class="code"><code>            <span class="n">avgFilter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">filteredY</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="n">lag</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-27"><code data-line-number="27"></code></a></td>
<td class="code"><code>            <span class="n">stdFilter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">filteredY</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="n">lag</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-28"><code data-line-number="28"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-29"><code data-line-number="29"></code></a></td>
<td class="code"><code>    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">signals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">signals</span><span class="p">),</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-30"><code data-line-number="30"></code></a></td>
<td class="code"><code>                <span class="n">avgFilter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">avgFilter</span><span class="p">),</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/peak-signal-detection-in-realtime-timeseries-data/#-31"><code data-line-number="31"></code></a></td>
<td class="code"><code>                <span class="n">stdFilter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">stdFilter</span><span class="p">))</span>
</code></td>
</tr>
</table></div>
<p>Below is the test on the same dataset that yields the same plot as in the
original answer for <code>R</code>/<code>Matlab</code></p>
<div class="code"><pre class="code literal-block"><span class="c1"># Data</span>
<span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span>
<span class="w">       </span><span class="mi">1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span>
<span class="w">       </span><span class="mf">2.6</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">3.2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Settings: lag = 30, threshold = 5, influence = 0</span>
<span class="n">lag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span>
<span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="n">influence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="c1"># Run algo with settings from above</span>
<span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thresholding_algo</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">lag</span><span class="o">=</span><span class="n">lag</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span><span class="w"> </span><span class="n">influence</span><span class="o">=</span><span class="n">influence</span><span class="p">)</span>

<span class="c1"># Plot result</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>

<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
<span class="w">           </span><span class="n">result</span><span class="p">[</span><span class="s2">"avgFilter"</span><span class="p">],</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"cyan"</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
<span class="w">           </span><span class="n">result</span><span class="p">[</span><span class="s2">"avgFilter"</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">result</span><span class="p">[</span><span class="s2">"stdFilter"</span><span class="p">],</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
<span class="w">           </span><span class="n">result</span><span class="p">[</span><span class="s2">"avgFilter"</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">threshold</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">result</span><span class="p">[</span><span class="s2">"stdFilter"</span><span class="p">],</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">result</span><span class="p">[</span><span class="s2">"signals"</span><span class="p">],</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/replace-transparency-in-png-image-with-white-background/" class="u-url">Replace transparency in PNG image with white background</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/replace-transparency-in-png-image-with-white-background/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T12:38:06+08:00" itemprop="datePublished" title="2023-03-04 12:38">2023-03-04 12:38</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a PNG image with an alpha channel (i.e. transparency), and I need to
create versions with the image layer composed onto a white background. I want
to use a scriptable command using a CLI tool such as Image Magick to directly
convert PNG to PNG losslessly.</p>
<p>An example of a non-working Image Magick command which results in an error is:</p>
<div class="code"><pre class="code literal-block">convert input.png -background white -flatten output.png
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>This works for me:</p>
<div class="code"><pre class="code literal-block">convert -flatten img1.png img1-white.png
</pre></div>

<h4>Documentation references:</h4>
<ul>
<li>
<code>-flatten</code> command-line option</li>
<li>
<code>-layers</code> command-line option (<code>-flatten</code> is equivalent to <code>-layers flatten</code>)</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>This works for me:</p>
<div class="code"><pre class="code literal-block">convert -flatten img1.png img1-white.png
</pre></div>

<h4>Documentation references:</h4>
<ul>
<li>
<code>-flatten</code> command-line option</li>
<li>
<code>-layers</code> command-line option (<code>-flatten</code> is equivalent to <code>-layers flatten</code>)</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-does-do-in-javascript/" class="u-url">What does "!--" do in JavaScript?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-does-do-in-javascript/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T12:36:44+08:00" itemprop="datePublished" title="2023-03-04 12:36">2023-03-04 12:36</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have this piece of code (taken from this question):</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">walk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>

<span class="w">    </span><span class="n">fs</span><span class="o">.</span><span class="n">readdir</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">done</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>

<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">pending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="o">.</span><span class="n">length</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pending</span><span class="p">)</span><span class="w"> </span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">done</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">);</span>

<span class="w">        </span><span class="n">list</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="p">);</span>
<span class="w">            </span><span class="n">fs</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">stat</span><span class="o">.</span><span class="n">isDirectory</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">walk</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>

<span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!--</span><span class="n">pending</span><span class="p">)</span>
<span class="w">                            </span><span class="n">done</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">);</span>
<span class="w">                    </span><span class="p">});</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">results</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!--</span><span class="n">pending</span><span class="p">)</span><span class="w"> </span>
<span class="w">                        </span><span class="n">done</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">};</span>
</pre></div>

<p>I'm trying to follow it, and I think I understand everything except for near
the end where it says <code>!--pending</code>. In this context, what does that command
do?</p>
<p>Edit: I appreciate all the further comments, but the question has been
answered many times. Thanks anyway!</p>
<p><br><br></p>
<h2>Answer</h2>
<p><code>!</code> inverts a value, and gives you the opposite boolean:</p>
<div class="code"><pre class="code literal-block"><span class="sx">!true == false</span>
<span class="sx">!false == true</span>
<span class="sx">!1 == false</span>
<span class="sx">!0 == true</span>
</pre></div>

<p><code>--[value]</code> subtracts one (1) from a number, and then returns that number to
be worked with:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="o">--</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="o">--</span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span>
</pre></div>

<p>So, <code>!--pending</code> subtracts one from pending, and then returns the opposite of
its truthy/falsy value (whether or not it's <code>0</code>).</p>
<div class="code"><pre class="code literal-block">pending = 2; !--pending == false 
pending = 1; !--pending == true
pending = 0; !--pending == false
</pre></div>

<p>And yes, follow the ProTip. This may be a common idiom in other programming
languages, but for most declarative JavaScript programming this looks quite
alien.</p>
<p><br></p>
<h3>Suggest</h3>
<p>That's not a special operator, it's 2 standard operators one after the other:</p>
<ol>
<li>A prefix decrement (<code>--</code>)</li>
<li>A logical not (<code>!</code>)</li>
</ol>
<p>This causes <code>pending</code> to be decremented and then tested to see if it's zero.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2392.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2390.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
