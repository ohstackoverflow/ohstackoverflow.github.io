<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1245) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1245.html">
<link rel="prev" href="index-1246.html" type="text/html">
<link rel="next" href="index-1244.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-handle-notification-when-app-in-background-in-firebase/" class="u-url">How to handle notification when app in background in Firebase</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-handle-notification-when-app-in-background-in-firebase/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:44:34+08:00" itemprop="datePublished" title="2023-02-18 04:44">2023-02-18 04:44</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Here is my manifest:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;service</span><span class="w"> </span><span class="na">android:name=</span><span class="s">".fcm.PshycoFirebaseMessagingServices"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;intent-filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"com.google.firebase.MESSAGING_EVENT"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/service&gt;</span>

<span class="nt">&lt;service</span><span class="w"> </span><span class="na">android:name=</span><span class="s">".fcm.PshycoFirebaseInstanceIDService"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;intent-filter&gt;</span>
<span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"com.google.firebase.INSTANCE_ID_EVENT"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</pre></div>

<p>When the app is in the background and a notification arrives, then the default
notification comes and doesn't run my code of <code>onMessageReceived</code>.</p>
<p>Here is my <code>onMessageReceived</code> code. This is invoked if my app is running on
the foreground, not when it is running in the background. How can I run this
code when the app is in background too?</p>
<div class="code"><pre class="code literal-block"><span class="c1">// [START receive_message]</span>
<span class="p">@</span><span class="n">Override</span>
<span class="n">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">onMessageReceived</span><span class="p">(</span><span class="n">RemoteMessage</span><span class="w"> </span><span class="n">remoteMessage</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// TODO(developer): Handle FCM messages here.</span>
<span class="w">    </span><span class="c1">// If the application is in the foreground handle both data and notification messages here.</span>
<span class="w">    </span><span class="c1">// Also if you intend on generating your own notifications as a result of a received FCM</span>
<span class="w">    </span><span class="c1">// message, here is where that should be initiated. See sendNotification method below.</span>
<span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">remoteMessage</span><span class="p">.</span><span class="n">getData</span><span class="p">();</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">remoteMessage</span><span class="p">.</span><span class="n">getNotification</span><span class="p">().</span><span class="n">getTitle</span><span class="p">();</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">remoteMessage</span><span class="p">.</span><span class="n">getNotification</span><span class="p">().</span><span class="n">getBody</span><span class="p">();</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">imageUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"image"</span><span class="p">);</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"action"</span><span class="p">);</span>
<span class="w">    </span><span class="n">Log</span><span class="p">.</span><span class="n">i</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">"onMessageReceived: title : "</span><span class="o">+</span><span class="n">title</span><span class="p">);</span>
<span class="w">    </span><span class="n">Log</span><span class="p">.</span><span class="n">i</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">"onMessageReceived: message : "</span><span class="o">+</span><span class="n">message</span><span class="p">);</span>
<span class="w">    </span><span class="n">Log</span><span class="p">.</span><span class="n">i</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">"onMessageReceived: imageUrl : "</span><span class="o">+</span><span class="n">imageUrl</span><span class="p">);</span>
<span class="w">    </span><span class="n">Log</span><span class="p">.</span><span class="n">i</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">"onMessageReceived: action : "</span><span class="o">+</span><span class="n">action</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imageUrl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">sendNotification</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="p">,</span><span class="n">action</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">new</span><span class="w"> </span><span class="nf">BigPictureNotification</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="p">,</span><span class="n">imageUrl</span><span class="p">,</span><span class="n">action</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1">// [END receive_message]</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<h3>1. Why is this happening?</h3>
<p>There are two types of messages in FCM (Firebase Cloud Messaging):</p>
<ol>
<li>
<strong>Display Messages</strong> : These messages trigger the <code>onMessageReceived()</code> callback only when your app is in <strong>foreground</strong>
</li>
<li>
<strong>Data Messages</strong> : Theses messages trigger the <code>onMessageReceived()</code> callback <strong>even</strong> if your app is in <strong>foreground/background/killed</strong>
</li>
</ol>
<blockquote>
<p><strong>NOTE:</strong> Firebase team have not developed a UI to send <code>data-messages</code> to
your devices, yet. You should use your server for sending this type!</p>
</blockquote>
<h3>2. How to?</h3>
<p>To achieve this, you have to perform a <code>POST</code> request to the following URL:</p>
<blockquote>
<p><code>POST</code> https://fcm.googleapis.com/fcm/send</p>
</blockquote>
<h4>Headers</h4>
<ul>
<li>
<strong>Key:</strong> <code>Content-Type</code>, <strong>Value:</strong> <code>application/json</code>
</li>
<li>
<strong>Key:</strong> <code>Authorization</code>, <strong>Value:</strong> <code>key=&lt;your-server-key&gt;</code>
</li>
</ul>
<h4>Body using topics</h4>
<div class="code"><pre class="code literal-block">{
    "to": "/topics/my_topic",
    "data": {
        "my_custom_key": "my_custom_value",
        "my_custom_key2": true
     }
}
</pre></div>

<h4>Or if you want to send it to specific devices</h4>
<div class="code"><pre class="code literal-block"><span class="p">{</span>
<span class="w">    </span><span class="s">"data"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s">"my_custom_key"</span><span class="o">:</span><span class="w"> </span><span class="s">"my_custom_value"</span><span class="p">,</span>
<span class="w">        </span><span class="s">"my_custom_key2"</span><span class="o">:</span><span class="w"> </span><span class="n">true</span>
<span class="w">     </span><span class="p">},</span>
<span class="w">    </span><span class="s">"registration_ids"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">"{device-token}"</span><span class="p">,</span><span class="s">"{device2-token}"</span><span class="p">,</span><span class="s">"{device3-token}"</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p><strong>NOTE:</strong> Be sure you're <strong>not adding</strong> JSON key <code>notification</code><br><strong>NOTE:</strong> To get your server key, you can find it in the firebase console:
<code>Your project -&gt; settings -&gt; Project settings -&gt; Cloud messaging -&gt; Server
Key</code></p>
</blockquote>
<h3>3. How to handle the push notification message?</h3>
<p>This is how you handle the received message:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@Override</span>
<span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onMessageReceived</span><span class="p">(</span><span class="n">RemoteMessage</span><span class="w"> </span><span class="n">remoteMessage</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"> </span>
<span class="w">     </span><span class="k">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">remoteMessage</span><span class="p">.</span><span class="n">getData</span><span class="p">();</span>
<span class="w">     </span><span class="n">String</span><span class="w"> </span><span class="n">myCustomKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">data</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="ss">"my_custom_key"</span><span class="p">);</span>

<span class="w">     </span><span class="o">//</span><span class="w"> </span><span class="n">Manage</span><span class="w"> </span><span class="k">data</span>
<span class="err">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-stdafx-h-used-for-in-visual-studio/" class="u-url">What is "stdafx.h" used for in Visual Studio?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-stdafx-h-used-for-in-visual-studio/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:43:53+08:00" itemprop="datePublished" title="2023-02-18 04:43">2023-02-18 04:43</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>A file named <code>stdafx.h</code> is automatically generated when I start a project in
Visual Studio 2010. I need to make a cross-platform C++ library, so I
don't/can't use this header file.</p>
<p>What is <code>stdafx.h</code> used for? Is it OK that I just remove this header file?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>All C++ compilers have one serious performance problem to deal with. Compiling
C++ code is a long, slow process.</p>
<p>Compiling headers included on top of C++ files is a <em>very</em> long, slow process.
Compiling the huge header structures that form part of Windows API and other
large API libraries is a <em>very</em> , <strong>very</strong> long, slow process. To have to do
it over, and over, and over for every single Cpp source file is a death knell.</p>
<p>This is not unique to Windows but an old problem faced by all compilers that
have to compile against a large API like Windows.</p>
<p>The Microsoft compiler can ameliorate this problem with a simple trick called
<em>precompiled headers</em>. The trick is pretty slick: although every CPP file can
potentially and legally give a sligthly different meaning to the chain of
header files included on top of each Cpp file (by things like having different
macros #define'd in advance of the includes, or by including the headers in
different order), that is most often not the case. Most of the time, we have
dozens or hundreds of included files, but they all are intended to have the
same meaning for all the Cpp files being compiled in your application.</p>
<p>The compiler can make huge time savings if it doesn't have to start to compile
every Cpp file plus its dozens of includes literally from scratch every time.</p>
<p>The trick consists of designating a special header file as the starting point
of all compilation chains, the so called 'precompiled header' file, which is
commonly a file named <em>stdafx.h</em> simply for historical reasons.</p>
<p>Simply list all your big huge headers for your APIs in your stdafx.h file, in
the appropriate order, and then start each of your CPP files at the very top
with an <code>#include "stdafx.h"</code>, before any meaningful content (just about the
only thing allowed before is comments).</p>
<p>Under those conditions, instead of starting <em>from scratch</em> , the compiler
starts compiling from the already saved results of compiling everything in
<code>stdafx.h</code>.</p>
<p>I don't believe that this trick is unique to Microsoft compilers, nor do I
think it was an original development.</p>
<p>For Microsoft compilers, the setting that controls the use of precompiled
headers is controlled by a command line argument to the compiler: <code>/Yu
"stdafx.h"</code>. As you can imagine, the use of the <code>stdafx.h</code> file name is simply
a convention; you can change the name if you so wish.</p>
<p>In Visual Studio 2010, this setting is controlled from the GUI via Right-
clicking on a CPP Project, selecting 'Properties' and navigating to
"Configuration Properties\C/C++\Precompiled Headers". For other versions of
Visual Studio, the location in the GUI will be different.</p>
<p>Note that if you disable precompiled headers (or run your project through a
tool that doesn't support them), it doesn't make your program illegal; it
simply means that your tool will compile everything from scratch every time.</p>
<p>If you are creating a library with no Windows dependencies, you can easily
comment out or remove <code>#include</code>s from the <code>stdafx.h</code> file. There is no need
to remove the file per se, but clearly you may do so as well, by disabling the
precompile header setting above.</p>
<p><br></p>
<h3>Suggest</h3>
<p>It's a "precompiled header file" -- any headers you include in stdafx.h are
pre-processed to save time during subsequent compilations. You can read more
about it here on MSDN.</p>
<p>If you're building a cross-platform application, check "Empty project" when
creating your project and Visual Studio won't put any files at all in your
project.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-read-the-value-of-a-private-field-from-a-different-class-in-java/" class="u-url">How to read the value of a private field from a different class in Java?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-read-the-value-of-a-private-field-from-a-different-class-in-java/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:43:28+08:00" itemprop="datePublished" title="2023-02-18 04:43">2023-02-18 04:43</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a poorly designed class in a 3rd-party <code>JAR</code> and I need to access one
of its <strong>private</strong> fields. For example, why should I need to choose private
field is it necessary?</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">IWasDesignedPoorly</span> {
    <span class="nb">private</span> <span class="n">Hashtable</span> <span class="n">stuffIWant</span>;
}

<span class="n">IWasDesignedPoorly</span> <span class="n">obj</span> = ...;
</pre></div>

<p>How can I use reflection to get the value of <code>stuffIWant</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>In order to access private fields, you need to get them from the class's
<em>declared</em> fields and then make them accessible:</p>
<div class="code"><pre class="code literal-block">Field f = obj.getClass().getDeclaredField("stuffIWant"); //NoSuchFieldException
f.setAccessible(true);
Hashtable iWantThis = (Hashtable) f.get(obj); //IllegalAccessException
</pre></div>

<p><strong>EDIT</strong> : as has been commented by <em>aperkins</em> , both accessing the field,
setting it as accessible and retrieving the value can throw <code>Exception</code>s,
although the only <em>checked</em> exceptions you need to be mindful of are commented
above.</p>
<p>The <code>NoSuchFieldException</code> would be thrown if you asked for a field by a name
which did not correspond to a declared field.</p>
<div class="code"><pre class="code literal-block">obj.getClass().getDeclaredField("misspelled"); //will throw NoSuchFieldException
</pre></div>

<p>The <code>IllegalAccessException</code> would be thrown if the field was not accessible
(for example, if it is private and has not been made accessible via missing
out the <code>f.setAccessible(true)</code> line.</p>
<p>The <code>RuntimeException</code>s which may be thrown are either <code>SecurityException</code>s
(if the JVM's <code>SecurityManager</code> will not allow you to change a field's
accessibility), or <code>IllegalArgumentException</code>s, if you try and access the
field on an object not of the field's class's type:</p>
<div class="code"><pre class="code literal-block">f.get("BOB"); //will throw IllegalArgumentException, as String is of the wrong type
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Try <code>FieldUtils</code> from Apache commons-lang3:</p>
<div class="code"><pre class="code literal-block">FieldUtils.readField(object, fieldName, true);
</pre></div>

<p>P.S. In my opinion, reflection is evil.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1246.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1244.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
