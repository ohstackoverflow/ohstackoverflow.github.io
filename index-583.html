<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 583) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-583.html">
<link rel="prev" href="index-584.html" type="text/html">
<link rel="next" href="index-582.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-do-we-need-middleware-for-async-flow-in-redux/" class="u-url">Why do we need middleware for async flow in Redux?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-do-we-need-middleware-for-async-flow-in-redux/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T10:35:16+08:00" itemprop="datePublished" title="2023-02-17 10:35">2023-02-17 10:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>According to the docs, "Without middleware, Redux store only supports
synchronous data flow". I don't understand why this is the case. Why can't the
container component call the async API, and then <code>dispatch</code> the actions?</p>
<p>For example, imagine a simple UI: a field and a button. When user pushes the
button, the field gets populated with data from a remote server.</p>
<p><img alt="A field and a button" src="images/GBI59.png"></p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">React</span> <span class="kn">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">Redux</span> <span class="kn">from</span> <span class="s1">'redux'</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">Provider</span><span class="p">,</span> <span class="n">connect</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'react-redux'</span><span class="p">;</span>

<span class="n">const</span> <span class="n">ActionTypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">STARTED_UPDATING</span><span class="p">:</span> <span class="s1">'STARTED_UPDATING'</span><span class="p">,</span>
    <span class="n">UPDATED</span><span class="p">:</span> <span class="s1">'UPDATED'</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">AsyncApi</span> <span class="p">{</span>
    <span class="n">static</span> <span class="n">getFieldValue</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">const</span> <span class="n">promise</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Promise</span><span class="p">((</span><span class="n">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="n">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="n">resolve</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">));</span>
            <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="n">promise</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">App</span> <span class="n">extends</span> <span class="n">React</span><span class="o">.</span><span class="n">Component</span> <span class="p">{</span>
    <span class="n">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nb">input</span> <span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">field</span><span class="p">}</span><span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">button</span> <span class="n">disabled</span><span class="o">=</span><span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">isWaiting</span><span class="p">}</span> <span class="n">onClick</span><span class="o">=</span><span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">update</span><span class="p">}</span><span class="o">&gt;</span><span class="n">Fetch</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
                <span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">isWaiting</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span><span class="n">Waiting</span><span class="o">...&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">}</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">App</span><span class="o">.</span><span class="n">propTypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">dispatch</span><span class="p">:</span> <span class="n">React</span><span class="o">.</span><span class="n">PropTypes</span><span class="o">.</span><span class="n">func</span><span class="p">,</span>
    <span class="n">field</span><span class="p">:</span> <span class="n">React</span><span class="o">.</span><span class="n">PropTypes</span><span class="o">.</span><span class="n">any</span><span class="p">,</span>
    <span class="n">isWaiting</span><span class="p">:</span> <span class="n">React</span><span class="o">.</span><span class="n">PropTypes</span><span class="o">.</span><span class="n">bool</span>
<span class="p">};</span>

<span class="n">const</span> <span class="n">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span> <span class="o">=</span> <span class="p">{</span> <span class="n">field</span><span class="p">:</span> <span class="s1">'No data'</span><span class="p">,</span> <span class="n">isWaiting</span><span class="p">:</span> <span class="n">false</span> <span class="p">},</span> <span class="n">action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="n">switch</span> <span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">ActionTypes</span><span class="o">.</span><span class="n">STARTED_UPDATING</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span> <span class="o">...</span><span class="n">state</span><span class="p">,</span> <span class="n">isWaiting</span><span class="p">:</span> <span class="n">true</span> <span class="p">};</span>
        <span class="k">case</span> <span class="n">ActionTypes</span><span class="o">.</span><span class="n">UPDATED</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span> <span class="o">...</span><span class="n">state</span><span class="p">,</span> <span class="n">isWaiting</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">action</span><span class="o">.</span><span class="n">payload</span> <span class="p">};</span>
        <span class="n">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">state</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="n">const</span> <span class="n">store</span> <span class="o">=</span> <span class="n">Redux</span><span class="o">.</span><span class="n">createStore</span><span class="p">(</span><span class="n">reducer</span><span class="p">);</span>
<span class="n">const</span> <span class="n">ConnectedApp</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span>
    <span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span> <span class="o">...</span><span class="n">state</span> <span class="p">};</span>
    <span class="p">},</span>
    <span class="p">(</span><span class="n">dispatch</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">update</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="n">dispatch</span><span class="p">({</span>
                    <span class="nb">type</span><span class="p">:</span> <span class="n">ActionTypes</span><span class="o">.</span><span class="n">STARTED_UPDATING</span>
                <span class="p">});</span>
                <span class="n">AsyncApi</span><span class="o">.</span><span class="n">getFieldValue</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">result</span> <span class="o">=&gt;</span> <span class="n">dispatch</span><span class="p">({</span>
                        <span class="nb">type</span><span class="p">:</span> <span class="n">ActionTypes</span><span class="o">.</span><span class="n">UPDATED</span><span class="p">,</span>
                        <span class="n">payload</span><span class="p">:</span> <span class="n">result</span>
                    <span class="p">}));</span>
            <span class="p">}</span>
        <span class="p">};</span>
    <span class="p">})(</span><span class="n">App</span><span class="p">);</span>
<span class="n">export</span> <span class="n">default</span> <span class="k">class</span> <span class="nc">extends</span> <span class="n">React</span><span class="o">.</span><span class="n">Component</span> <span class="p">{</span>
    <span class="n">render</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="n">Provider</span> <span class="n">store</span><span class="o">=</span><span class="p">{</span><span class="n">store</span><span class="p">}</span><span class="o">&gt;&lt;</span><span class="n">ConnectedApp</span><span class="o">/&gt;&lt;/</span><span class="n">Provider</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When the exported component is rendered, I can click the button and the input
is updated correctly.</p>
<p>Note the <code>update</code> function in the <code>connect</code> call. It dispatches an action that
tells the App that it is updating, and then performs an async call. After the
call finishes, the provided value is dispatched as a payload of another
action.</p>
<p>What is wrong with this approach? Why would I want to use Redux Thunk or Redux
Promise, as the documentation suggests?</p>
<p><strong>EDIT:</strong> I searched the Redux repo for clues, and found that Action Creators
were required to be pure functions in the past. For example, here's a user
trying to provide a better explanation for async data flow:</p>
<blockquote>
<p>The action creator itself is still a pure function, but the thunk function
it returns doesn't need to be, and it can do our async calls</p>
</blockquote>
<p>Action creators are no longer required to be pure. So, thunk/promise
middleware was definitely required in the past, but it seems that this is no
longer the case?</p>
<p><br><br></p>
<h2>Answer</h2>
<blockquote>
<p>What is wrong with this approach? Why would I want to use Redux Thunk or
Redux Promise, as the documentation suggests?</p>
</blockquote>
<p>There is nothing wrong with this approach. It’s just inconvenient in a large
application because you’ll have different components performing the same
actions, you might want to debounce some actions, or keep some local state
like auto-incrementing IDs close to action creators, etc. So it is just easier
from the maintenance point of view to extract action creators into separate
functions.</p>
<p><strong>You can read my answer to “How to dispatch a Redux action with a timeout”
for a more detailed walkthrough.</strong></p>
<p>Middleware like Redux Thunk or Redux Promise just gives you “syntax sugar” for
dispatching thunks or promises, but you don’t <em>have to</em> use it.</p>
<p>So, without any middleware, your action creator might look like</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">creator</span>
<span class="n">function</span><span class="w"> </span><span class="n">loadData</span><span class="p">(</span><span class="n">dispatch</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">needs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">dispatch</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">argument</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">fetch</span><span class="p">(</span><span class="err">`</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">data</span><span class="o">.</span><span class="n">com</span><span class="o">/$</span><span class="p">{</span><span class="n">userId</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span>
<span class="w">      </span><span class="n">data</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_DATA_SUCCESS'</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">}),</span>
<span class="w">      </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_DATA_FAILURE'</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">component</span>
<span class="n">componentWillMount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">loadData</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">dispatch</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">userId</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">don</span><span class="s1">'t forget to pass dispatch</span>
<span class="p">}</span>
</pre></div>

<p>But with Thunk Middleware you can write it like this:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">creator</span>
<span class="n">function</span><span class="w"> </span><span class="n">loadData</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">dispatch</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">fetch</span><span class="p">(</span><span class="err">`</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">data</span><span class="o">.</span><span class="n">com</span><span class="o">/$</span><span class="p">{</span><span class="n">userId</span><span class="p">}</span><span class="err">`</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Redux</span><span class="w"> </span><span class="n">Thunk</span><span class="w"> </span><span class="n">handles</span><span class="w"> </span><span class="n">these</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span>
<span class="w">      </span><span class="n">data</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_DATA_SUCCESS'</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">}),</span>
<span class="w">      </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_DATA_FAILURE'</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">component</span>
<span class="n">componentWillMount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">loadData</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">userId</span><span class="p">));</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">dispatch</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">usually</span><span class="w"> </span><span class="n">do</span>
<span class="p">}</span>
</pre></div>

<p>So there is no huge difference. One thing I like about the latter approach is
that the component doesn’t care that the action creator is async. It just
calls <code>dispatch</code> normally, it can also use <code>mapDispatchToProps</code> to bind such
action creator with a short syntax, etc. The components don’t know how action
creators are implemented, and you can switch between different async
approaches (Redux Thunk, Redux Promise, Redux Saga) without changing the
components. On the other hand, with the former, explicit approach, your
components know <em>exactly</em> that a specific call is async, and needs <code>dispatch</code>
to be passed by some convention (for example, as a sync parameter).</p>
<p>Also think about how this code will change. Say we want to have a second data
loading function, and to combine them in a single action creator.</p>
<p>With the first approach we need to be mindful of what kind of action creator
we are calling:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">creators</span>
<span class="n">function</span><span class="w"> </span><span class="n">loadSomeData</span><span class="p">(</span><span class="n">dispatch</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">fetch</span><span class="p">(</span><span class="err">`</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">data</span><span class="o">.</span><span class="n">com</span><span class="o">/$</span><span class="p">{</span><span class="n">userId</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span>
<span class="w">      </span><span class="n">data</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_SOME_DATA_SUCCESS'</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">}),</span>
<span class="w">      </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_SOME_DATA_FAILURE'</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
<span class="n">function</span><span class="w"> </span><span class="n">loadOtherData</span><span class="p">(</span><span class="n">dispatch</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">fetch</span><span class="p">(</span><span class="err">`</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">data</span><span class="o">.</span><span class="n">com</span><span class="o">/$</span><span class="p">{</span><span class="n">userId</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span>
<span class="w">      </span><span class="n">data</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_OTHER_DATA_SUCCESS'</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">}),</span>
<span class="w">      </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_OTHER_DATA_FAILURE'</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
<span class="n">function</span><span class="w"> </span><span class="n">loadAllData</span><span class="p">(</span><span class="n">dispatch</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
<span class="w">    </span><span class="n">loadSomeData</span><span class="p">(</span><span class="n">dispatch</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">),</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">pass</span><span class="w"> </span><span class="n">dispatch</span><span class="w"> </span><span class="n">first</span><span class="p">:</span><span class="w"> </span><span class="n">it</span><span class="s1">'s async</span>
<span class="w">    </span><span class="n">loadOtherData</span><span class="p">(</span><span class="n">dispatch</span><span class="p">,</span><span class="w"> </span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">pass</span><span class="w"> </span><span class="n">dispatch</span><span class="w"> </span><span class="n">first</span><span class="p">:</span><span class="w"> </span><span class="n">it</span><span class="s1">'s async</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>


<span class="o">//</span><span class="w"> </span><span class="n">component</span>
<span class="n">componentWillMount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">loadAllData</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">dispatch</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">userId</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">pass</span><span class="w"> </span><span class="n">dispatch</span><span class="w"> </span><span class="n">first</span>
<span class="p">}</span>
</pre></div>

<p>With Redux Thunk action creators can <code>dispatch</code> the result of other action
creators and not even think whether those are synchronous or asynchronous:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">creators</span>
<span class="n">function</span><span class="w"> </span><span class="n">loadSomeData</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">dispatch</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">fetch</span><span class="p">(</span><span class="err">`</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">data</span><span class="o">.</span><span class="n">com</span><span class="o">/$</span><span class="p">{</span><span class="n">userId</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span>
<span class="w">      </span><span class="n">data</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_SOME_DATA_SUCCESS'</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">}),</span>
<span class="w">      </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_SOME_DATA_FAILURE'</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
<span class="n">function</span><span class="w"> </span><span class="n">loadOtherData</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">dispatch</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">fetch</span><span class="p">(</span><span class="err">`</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">data</span><span class="o">.</span><span class="n">com</span><span class="o">/$</span><span class="p">{</span><span class="n">userId</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span>
<span class="w">      </span><span class="n">data</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_OTHER_DATA_SUCCESS'</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">}),</span>
<span class="w">      </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_OTHER_DATA_FAILURE'</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">})</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
<span class="n">function</span><span class="w"> </span><span class="n">loadAllData</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">dispatch</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
<span class="w">    </span><span class="n">dispatch</span><span class="p">(</span><span class="n">loadSomeData</span><span class="p">(</span><span class="n">userId</span><span class="p">)),</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">dispatch</span><span class="w"> </span><span class="n">normally</span><span class="o">!</span>
<span class="w">    </span><span class="n">dispatch</span><span class="p">(</span><span class="n">loadOtherData</span><span class="p">(</span><span class="n">userId</span><span class="p">))</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">dispatch</span><span class="w"> </span><span class="n">normally</span><span class="o">!</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>


<span class="o">//</span><span class="w"> </span><span class="n">component</span>
<span class="n">componentWillMount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">loadAllData</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">userId</span><span class="p">));</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">dispatch</span><span class="w"> </span><span class="n">normally</span><span class="o">!</span>
<span class="p">}</span>
</pre></div>

<p>With this approach, if you later want your action creators to look into
current Redux state, you can just use the second <code>getState</code> argument passed to
the thunks without modifying the calling code at all:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">loadSomeData</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">Thanks</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">Redux</span><span class="w"> </span><span class="n">Thunk</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">getState</span><span class="p">()</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="n">changing</span><span class="w"> </span><span class="n">callers</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">dispatch</span><span class="p">,</span><span class="w"> </span><span class="n">getState</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">getState</span><span class="p">().</span><span class="k">data</span><span class="o">[</span><span class="n">userId</span><span class="o">]</span><span class="p">.</span><span class="n">isLoaded</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">Promise</span><span class="p">.</span><span class="n">resolve</span><span class="p">();</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="k">fetch</span><span class="p">(</span><span class="err">`</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="k">data</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="err">${</span><span class="n">userId</span><span class="err">}`</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="k">then</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">json</span><span class="p">())</span>
<span class="w">      </span><span class="p">.</span><span class="k">then</span><span class="p">(</span>
<span class="w">        </span><span class="k">data</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">(</span><span class="err">{</span><span class="w"> </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_SOME_DATA_SUCCESS'</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="err">}</span><span class="p">),</span>
<span class="w">        </span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">dispatch</span><span class="p">(</span><span class="err">{</span><span class="w"> </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_SOME_DATA_FAILURE'</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="err">}</span><span class="p">)</span>
<span class="w">      </span><span class="p">);</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>If you need to change it to be synchronous, you can also do this without
changing any calling code:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">regular</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">creator</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">touching</span><span class="w"> </span><span class="n">callers</span>
<span class="n">function</span><span class="w"> </span><span class="n">loadSomeData</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'LOAD_SOME_DATA_SUCCESS'</span><span class="p">,</span>
<span class="w">    </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="n">localStorage</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s1">'my-data'</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>So the benefit of using middleware like Redux Thunk or Redux Promise is that
components aren’t aware of how action creators are implemented, and whether
they care about Redux state, whether they are synchronous or asynchronous, and
whether or not they call other action creators. The downside is a little bit
of indirection, but we believe it’s worth it in real applications.</p>
<p>Finally, Redux Thunk and friends is just one possible approach to asynchronous
requests in Redux apps. Another interesting approach is Redux Saga which lets
you define long-running daemons (“sagas”) that take actions as they come, and
transform or perform requests before outputting actions. This moves the logic
from action creators into sagas. You might want to check it out, and later
pick what suits you the most.</p>
<blockquote>
<p>I searched the Redux repo for clues, and found that Action Creators were
required to be pure functions in the past.</p>
</blockquote>
<p>This is incorrect. The docs said this, but the docs were wrong.<br>
Action creators were never required to be pure functions.<br>
We fixed the docs to reflect that.</p>
<p><br></p>
<h3>Suggest</h3>
<h2>You don't.</h2>
<h2>But... you should use redux-saga :)</h2>
<p>Dan Abramov's answer is right about <code>redux-thunk</code> but I will talk a bit more
about redux-saga that is quite similar but more powerful.</p>
<h2>Imperative VS declarative</h2>
<ul>
<li>
<strong>DOM</strong> : jQuery is imperative / React is declarative</li>
<li>
<strong>Monads</strong> : IO is imperative / Free is declarative</li>
<li>
<strong>Redux effects</strong> : <code>redux-thunk</code> is imperative / <code>redux-saga</code> is declarative</li>
</ul>
<p>When you have a thunk in your hands, like an IO monad or a promise, you can't
easily know what it will do once you execute. The only way to test a thunk is
to execute it, and mock the dispatcher (or the whole outside world if it
interacts with more stuff...).</p>
<p>If you are using mocks, then you are not doing functional programming.</p>
<blockquote>
<p>Seen through the lens of side-effects, mocks are a flag that your code is
impure, and in the functional programmer's eye, proof that something is
wrong. Instead of downloading a library to help us check the iceberg is
intact, we should be sailing around it. A hardcore TDD/Java guy once asked
me how you do mocking in Clojure. The answer is, we usually don't. We
usually see it as a sign we need to refactor our code.</p>
</blockquote>
<p>Source</p>
<p>The sagas (as they got implemented in <code>redux-saga</code>) are declarative and like
the Free monad or React components, they are much easier to test without any
mock.</p>
<p>See also this article:</p>
<blockquote>
<p>in modern FP, we shouldn’t write programs — we should write descriptions of
programs, which we can then introspect, transform, and interpret at will.</p>
</blockquote>
<p>(Actually, Redux-saga is like a hybrid: the flow is imperative but the effects
are declarative)</p>
<h2>Confusion: actions/events/commands...</h2>
<p>There is a lot of confusion in the frontend world on how some backend concepts
like CQRS / EventSourcing and Flux / Redux may be related, mostly because in
Flux we use the term "action" which can sometimes represent both imperative
code (<code>LOAD_USER</code>) and events (<code>USER_LOADED</code>). I believe that like event-
sourcing, you should only dispatch events.</p>
<h2>Using sagas in practice</h2>
<p>Imagine an app with a link to a user profile. The idiomatic way to handle this
with each middleware would be:</p>
<h3><code>redux-thunk</code></h3>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span> <span class="na">onClick=</span><span class="s">{e</span> <span class="err">=</span><span class="nt">&gt;</span><span class="w"> </span>dispatch(actions.loadUserProfile(123)}&gt;Robert<span class="nt">&lt;/div&gt;</span>

function<span class="w"> </span>loadUserProfile(userId)<span class="w"> </span>{
<span class="w">  </span>return<span class="w"> </span>dispatch<span class="w"> </span>=&gt;<span class="w"> </span>fetch(`http://data.com/<span class="cp">${</span><span class="n">userId</span><span class="cp">}</span>`)
<span class="w">    </span>.then(res<span class="w"> </span>=&gt;<span class="w"> </span>res.json())
<span class="w">    </span>.then(
<span class="w">      </span>data<span class="w"> </span>=&gt;<span class="w"> </span>dispatch({<span class="w"> </span>type:<span class="w"> </span>'USER_PROFILE_LOADED',<span class="w"> </span>data<span class="w"> </span>}),
<span class="w">      </span>err<span class="w"> </span>=&gt;<span class="w"> </span>dispatch({<span class="w"> </span>type:<span class="w"> </span>'USER_PROFILE_LOAD_FAILED',<span class="w"> </span>err<span class="w"> </span>})
<span class="w">    </span>);
}
</pre></div>

<h3><code>redux-saga</code></h3>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span> <span class="na">onClick=</span><span class="s">{e</span> <span class="err">=</span><span class="nt">&gt;</span><span class="w"> </span>dispatch({<span class="w"> </span>type:<span class="w"> </span>'USER_NAME_CLICKED',<span class="w"> </span>payload:<span class="w"> </span>123<span class="w"> </span>})}&gt;Robert<span class="nt">&lt;/div&gt;</span>


function*<span class="w"> </span>loadUserProfileOnNameClick()<span class="w"> </span>{
<span class="w">  </span>yield*<span class="w"> </span>takeLatest("USER_NAME_CLICKED",<span class="w"> </span>fetchUser);
}

function*<span class="w"> </span>fetchUser(action)<span class="w"> </span>{
<span class="w">  </span>try<span class="w"> </span>{
<span class="w">    </span>const<span class="w"> </span>userProfile<span class="w"> </span>=<span class="w"> </span>yield<span class="w"> </span>fetch(`http://data.com/<span class="cp">${</span><span class="n">action</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">userId</span> <span class="cp">}</span>`)
<span class="w">    </span>yield<span class="w"> </span>put({<span class="w"> </span>type:<span class="w"> </span>'USER_PROFILE_LOADED',<span class="w"> </span>userProfile<span class="w"> </span>})
<span class="w">  </span>}<span class="w"> </span>
<span class="w">  </span>catch(err)<span class="w"> </span>{
<span class="w">    </span>yield<span class="w"> </span>put({<span class="w"> </span>type:<span class="w"> </span>'USER_PROFILE_LOAD_FAILED',<span class="w"> </span>err<span class="w"> </span>})
<span class="w">  </span>}
}
</pre></div>

<p>This saga translates to:</p>
<blockquote>
<p>every time a username gets clicked, fetch the user profile and then dispatch
an event with the loaded profile.</p>
</blockquote>
<p>As you can see, there are some advantages of <code>redux-saga</code>.</p>
<p>The usage of <code>takeLatest</code> permits to express that you are only interested to
get the data of the last username clicked (handle concurrency problems in case
the user click very fast on a lot of usernames). This kind of stuff is hard
with thunks. You could have used <code>takeEvery</code> if you don't want this behavior.</p>
<p>You keep action creators pure. Note it's still useful to keep actionCreators
(in sagas <code>put</code> and components <code>dispatch</code>), as it might help you to add action
validation (assertions/flow/typescript) in the future.</p>
<p>Your code becomes much more testable as the effects are declarative</p>
<p>You don't need anymore to trigger rpc-like calls like <code>actions.loadUser()</code>.
Your UI just needs to dispatch what HAS HAPPENED. We only fire <strong>events</strong>
(always in the past tense!) and not actions anymore. This means that you can
create decoupled "ducks" or Bounded Contexts and that the saga can act as the
coupling point between these modular components.</p>
<p>This means that your views are more easy to manage because they don't need
anymore to contain that translation layer between what has happened and what
should happen as an effect</p>
<p>For example imagine an infinite scroll view. <code>CONTAINER_SCROLLED</code> can lead to
<code>NEXT_PAGE_LOADED</code>, but is it really the responsibility of the scrollable
container to decide whether or not we should load another page? Then he has to
be aware of more complicated stuff like whether or not the last page was
loaded successfully or if there is already a page that tries to load, or if
there is no more items left to load? I don't think so: for maximum reusability
the scrollable container should just describe that it has been scrolled. The
loading of a page is a "business effect" of that scroll</p>
<p>Some might argue that generators can inherently hide state outside of redux
store with local variables, but if you start to orchestrate complex things
inside thunks by starting timers etc you would have the same problem anyway.
And there's a <code>select</code> effect that now permits to get some state from your
Redux store.</p>
<p>Sagas can be time-traveled and also enables complex flow logging and dev-tools
that are currently being worked on. Here is some simple async flow logging
that is already implemented:</p>
<p><img alt="saga flow logging" src="images/F9Jsh.png"></p>
<h2>Decoupling</h2>
<p>Sagas are not only replacing redux thunks. They come from backend /
distributed systems / event-sourcing.</p>
<p>It is a very common misconception that sagas are just here to replace your
redux thunks with better testability. Actually this is just an implementation
detail of redux-saga. Using declarative effects is better than thunks for
testability, but the saga pattern can be implemented on top of imperative or
declarative code.</p>
<p>In the first place, the saga is a piece of software that permits to coordinate
long running transactions (eventual consistency), and transactions across
different bounded contexts (domain driven design jargon).</p>
<p>To simplify this for frontend world, imagine there is widget1 and widget2.
When some button on widget1 is clicked, then it should have an effect on
widget2. Instead of coupling the 2 widgets together (ie widget1 dispatch an
action that targets widget2), widget1 only dispatch that its button was
clicked. Then the saga listen for this button click and then update widget2 by
dispaching a new event that widget2 is aware of.</p>
<p>This adds a level of indirection that is unnecessary for simple apps, but make
it more easy to scale complex applications. You can now publish widget1 and
widget2 to different npm repositories so that they never have to know about
each others, without having them to share a global registry of actions. The 2
widgets are now bounded contexts that can live separately. They do not need
each others to be consistent and can be reused in other apps as well. The saga
is the coupling point between the two widgets that coordinate them in a
meaningful way for your business.</p>
<p>Some nice articles on how to structure your Redux app, on which you can use
Redux-saga for decoupling reasons:</p>
<ul>
<li>http://jaysoo.ca/2016/02/28/organizing-redux-application/</li>
<li>http://marmelab.com/blog/2015/12/17/react-directory-structure.html</li>
<li>https://github.com/slorber/scalable-frontend-with-elm-or-redux</li>
</ul>
<h2>A concrete usecase: notification system</h2>
<p>I want my components to be able to trigger the display of in-app
notifications. But I don't want my components to be highly coupled to the
notification system that has its own business rules (max 3 notifications
displayed at the same time, notification queueing, 4 seconds display-time
etc...).</p>
<p>I don't want my JSX components to decide when a notification will show/hide. I
just give it the ability to request a notification, and leave the complex
rules inside the saga. This kind of stuff is quite hard to implement with
thunks or promises.</p>
<p><img alt="notifications" src="images/XQ8lx.png"></p>
<p>I've described here how this can be done with saga</p>
<h2>Why is it called a Saga?</h2>
<p>The term saga comes from the backend world. I initially introduced Yassine
(the author of Redux-saga) to that term in a long discussion.</p>
<p>Initially, that term was introduced with a paper, the saga pattern was
supposed to be used to handle eventual consistency in distributed
transactions, but its usage has been extended to a broader definition by
backend developers so that it now also covers the "process manager" pattern
(somehow the original saga pattern is a specialized form of process manager).</p>
<p>Today, the term "saga" is confusing as it can describe 2 different things. As
it is used in redux-saga, it does not describe a way to handle distributed
transactions but rather a way to coordinate actions in your app. <code>redux-saga</code>
could also have been called <code>redux-process-manager</code>.</p>
<p>See also:</p>
<ul>
<li>Interview of Yassine about Redux-saga history</li>
<li>Kella Byte: Claryfing the Saga pattern</li>
<li>Microsoft CQRS Journey: A Saga on Sagas</li>
<li>Medium response of Yassine</li>
</ul>
<h2>Alternatives</h2>
<p>If you don't like the idea of using generators but you are interested by the
saga pattern and its decoupling properties, you can also achieve the same with
redux-observable which uses the name <code>epic</code> to describe the exact same
pattern, but with RxJS. If you're already familiar with Rx, you'll feel right
at home.</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">loadUserProfileOnNameClickEpic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">action</span><span class="o">$</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">  </span><span class="n">action</span><span class="o">$.</span><span class="n">ofType</span><span class="p">(</span><span class="s1">'USER_NAME_CLICKED'</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">switchMap</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">      </span><span class="n">Observable</span><span class="o">.</span><span class="n">ajax</span><span class="p">(</span><span class="err">`</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">data</span><span class="o">.</span><span class="n">com</span><span class="o">/$</span><span class="p">{</span><span class="n">action</span><span class="o">.</span><span class="n">payload</span><span class="o">.</span><span class="n">userId</span><span class="p">}</span><span class="err">`</span><span class="p">)</span>
<span class="w">        </span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">userProfile</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">          </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'USER_PROFILE_LOADED'</span><span class="p">,</span>
<span class="w">          </span><span class="n">userProfile</span>
<span class="w">        </span><span class="p">}))</span>
<span class="w">        </span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Observable</span><span class="o">.</span><span class="n">of</span><span class="p">({</span>
<span class="w">          </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'USER_PROFILE_LOAD_FAILED'</span><span class="p">,</span>
<span class="w">          </span><span class="n">err</span>
<span class="w">        </span><span class="p">}))</span>
<span class="w">    </span><span class="p">);</span>
</pre></div>

<h2>Some redux-saga useful resources</h2>
<ul>
<li>Redux-saga vs Redux-thunk with async/await</li>
<li>Managing processes in Redux Saga</li>
<li>From actionsCreators to Sagas</li>
<li>Snake game implemented with Redux-saga</li>
</ul>
<h2>2017 advises</h2>
<ul>
<li>Don't overuse Redux-saga just for the sake of using it. Testable API calls only are not worth it.</li>
<li>Don't remove thunks from your project for most simple cases.</li>
<li>Don't hesitate to dispatch thunks in <code>yield put(someActionThunk)</code> if it makes sense.</li>
</ul>
<p>If you are frightened of using Redux-saga (or Redux-observable) but just need
the decoupling pattern, check redux-dispatch-subscribe: it permits to listen
to dispatches and trigger new dispatches in listener.</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">unsubscribe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">store</span><span class="o">.</span><span class="n">addDispatchListener</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'ping'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">store</span><span class="o">.</span><span class="n">dispatch</span><span class="p">({</span><span class="w"> </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'pong'</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-tell-maven-to-use-the-latest-version-of-a-dependency/" class="u-url">How do I tell Maven to use the latest version of a dependency?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-tell-maven-to-use-the-latest-version-of-a-dependency/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T10:34:49+08:00" itemprop="datePublished" title="2023-02-17 10:34">2023-02-17 10:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In Maven, dependencies are usually set up like this:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;dependency&gt;</span>
<span class="w">  </span><span class="nt">&lt;groupId&gt;</span>wonderful-inc<span class="nt">&lt;/groupId&gt;</span>
<span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>dream-library<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>

<p>Now, if you are working with libraries that have frequent releases, constantly
updating the <version> tag can be somewhat annoying. Is there any way to tell
Maven to always use the latest available version (from the repository)?</version></p>
<p><br><br></p>
<h2>Answer</h2>
<p><em><strong>NOTE:</strong></em></p>
<p><em>The mentioned<code>LATEST</code> and <code>RELEASE</code> metaversions have been dropped <strong>for
plugin dependencies</strong> in Maven 3 "for the sake of reproducible builds", over 6
years ago. (They still work perfectly fine for regular dependencies.) For
plugin dependencies please refer to this <strong>Maven 3 compliant solution</strong></em>.</p>
<hr>
<p>If you always want to use the newest version, Maven has two keywords you can
use as an alternative to version ranges. You should use these options with
care as you are no longer in control of the plugins/dependencies you are
using.</p>
<blockquote>
<p>When you depend on a plugin or a dependency, you can use the a version value
of LATEST or RELEASE. LATEST refers to the latest released or snapshot
version of a particular artifact, the most recently deployed artifact in a
particular repository. RELEASE refers to the last non-snapshot release in
the repository. In general, it is not a best practice to design software
which depends on a non-specific version of an artifact. If you are
developing software, you might want to use RELEASE or LATEST as a
convenience so that you don't have to update version numbers when a new
release of a third-party library is released. When you release software, you
should always make sure that your project depends on specific versions to
reduce the chances of your build or your project being affected by a
software release not under your control. Use LATEST and RELEASE with
caution, if at all.</p>
</blockquote>
<p>See the POM Syntax section of the Maven book for more details. Or see this doc
on Dependency Version Ranges, where:</p>
<ul>
<li>A square bracket ( <code>[</code> &amp; <code>]</code> ) means "closed" (inclusive).</li>
<li>A parenthesis ( <code>(</code> &amp; <code>)</code> ) means "open" (exclusive).</li>
</ul>
<p>Here's an example illustrating the various options. In the Maven repository,
com.foo:my-foo has the following metadata:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="nt">&lt;metadata&gt;</span>
<span class="w">  </span><span class="nt">&lt;groupId&gt;</span>com.foo<span class="nt">&lt;/groupId&gt;</span>
<span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>my-foo<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>2.0.0<span class="nt">&lt;/version&gt;</span>
<span class="w">  </span><span class="nt">&lt;versioning&gt;</span>
<span class="w">    </span><span class="nt">&lt;release&gt;</span>1.1.1<span class="nt">&lt;/release&gt;</span>
<span class="w">    </span><span class="nt">&lt;versions&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>1.0.1<span class="nt">&lt;/version&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>1.1<span class="nt">&lt;/version&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>1.1.1<span class="nt">&lt;/version&gt;</span>
<span class="w">      </span><span class="nt">&lt;version&gt;</span>2.0.0<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;/versions&gt;</span>
<span class="w">    </span><span class="nt">&lt;lastUpdated&gt;</span>20090722140000<span class="nt">&lt;/lastUpdated&gt;</span>
<span class="w">  </span><span class="nt">&lt;/versioning&gt;</span>
<span class="nt">&lt;/metadata&gt;</span>
</pre></div>

<p>If a dependency on that artifact is required, you have the following options
(other version ranges can be specified of course, just showing the relevant
ones here):</p>
<p>Declare an exact version (will always resolve to 1.0.1):</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;version&gt;</span>[1.0.1]<span class="nt">&lt;/version&gt;</span>
</pre></div>

<p>Declare an explicit version (will always resolve to 1.0.1 unless a collision
occurs, when Maven will select a matching version):</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;version&gt;</span>1.0.1<span class="nt">&lt;/version&gt;</span>
</pre></div>

<p>Declare a version range for all 1.x (will currently resolve to 1.1.1):</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;version&gt;</span>[1.0.0,2.0.0)<span class="nt">&lt;/version&gt;</span>
</pre></div>

<p>Declare an open-ended version range (will resolve to 2.0.0):</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;version&gt;</span>[1.0.0,)<span class="nt">&lt;/version&gt;</span>
</pre></div>

<p>Declare the version as LATEST (will resolve to 2.0.0) (removed from maven 3.x)</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;version&gt;</span>LATEST<span class="nt">&lt;/version&gt;</span>
</pre></div>

<p>Declare the version as RELEASE (will resolve to 1.1.1) (removed from maven
3.x):</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;version&gt;</span>RELEASE<span class="nt">&lt;/version&gt;</span>
</pre></div>

<p>Note that by default your own deployments will update the "latest" entry in
the Maven metadata, but to update the "release" entry, you need to activate
the "release-profile" from the Maven super POM. You can do this with either
"-Prelease-profile" or "-DperformRelease=true"</p>
<hr>
<p>It's worth emphasising that any approach that allows Maven to pick the
dependency versions (LATEST, RELEASE, and version ranges) can leave you open
to build time issues, as later versions can have different behaviour (for
example the dependency plugin has previously switched a default value from
true to false, with confusing results).</p>
<p>It is therefore generally a good idea to define exact versions in releases. As
Tim's answer points out, the maven-versions-plugin is a handy tool for
updating dependency versions, particularly the versions:use-latest-versions
and versions:use-latest-releases goals.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Now I know this topic is old, but reading the question and the OP supplied
answer it seems the Maven Versions Plugin might have actually been a better
answer to his question:</p>
<p>In particular the following goals could be of use:</p>
<ul>
<li>
<strong>versions:use-latest-versions</strong> searches the pom for all versions which have been a newer version and replaces them with the latest version.</li>
<li>
<strong>versions:use-latest-releases</strong> searches the pom for all non-SNAPSHOT versions which have been a newer release and replaces them with the latest release version.</li>
<li>
<strong>versions:update-properties</strong> updates properties defined in a project so that they correspond to the latest available version of specific dependencies. This can be useful if a suite of dependencies must all be locked to one version.</li>
</ul>
<p>The following other goals are also provided:</p>
<ul>
<li>
<strong>versions:display-dependency-updates</strong> scans a project's dependencies and produces a report of those dependencies which have newer versions available.</li>
<li>
<strong>versions:display-plugin-updates</strong> scans a project's plugins and produces a report of those plugins which have newer versions available.</li>
<li>
<strong>versions:update-parent</strong> updates the parent section of a project so that it references the newest available version. For example, if you use a corporate root POM, this goal can be helpful if you need to ensure you are using the latest version of the corporate root POM.</li>
<li>
<strong>versions:update-child-modules</strong> updates the parent section of the child modules of a project so the version matches the version of the current project. For example, if you have an aggregator pom that is also the parent for the projects that it aggregates and the children and parent versions get out of sync, this mojo can help fix the versions of the child modules. (Note you may need to invoke Maven with the -N option in order to run this goal if your project is broken so badly that it cannot build because of the version mis-match).</li>
<li>
<strong>versions:lock-snapshots</strong> searches the pom for all -SNAPSHOT versions and replaces them with the current timestamp version of that -SNAPSHOT, e.g. -20090327.172306-4</li>
<li>
<strong>versions:unlock-snapshots</strong> searches the pom for all timestamp locked snapshot versions and replaces them with -SNAPSHOT.</li>
<li>
<strong>versions:resolve-ranges</strong> finds dependencies using version ranges and resolves the range to the specific version being used.</li>
<li>
<strong>versions:use-releases</strong> searches the pom for all -SNAPSHOT versions which have been released and replaces them with the corresponding release version.</li>
<li>
<strong>versions:use-next-releases</strong> searches the pom for all non-SNAPSHOT versions which have been a newer release and replaces them with the next release version.</li>
<li>
<strong>versions:use-next-versions</strong> searches the pom for all versions which have been a newer version and replaces them with the next version.</li>
<li>
<strong>versions:commit</strong> removes the pom.xml.versionsBackup files. Forms one half of the built-in "Poor Man's SCM".</li>
<li>
<strong>versions:revert</strong> restores the pom.xml files from the pom.xml.versionsBackup files. Forms one half of the built-in "Poor Man's SCM".</li>
</ul>
<p>Just thought I'd include it for any future reference.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/cleaning-up-old-remote-git-branches/" class="u-url">Cleaning up old remote git branches</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/cleaning-up-old-remote-git-branches/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T10:34:22+08:00" itemprop="datePublished" title="2023-02-17 10:34">2023-02-17 10:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I work from two different computers (A and B) and store a common git remote in
the dropbox directory.</p>
<p>Let's say I have two branches, master and devel. Both are tracking their
remote counterparts origin/master and origin/devel.</p>
<p>Now while on computer A, I delete branch devel, on local and remote.</p>
<div class="code"><pre class="code literal-block">git push origin :heads/devel
git branch -d devel
</pre></div>

<p>Running <code>git branch -a</code> on computer A, I get the following list of branches.</p>
<ul>
<li>master</li>
<li>origin/HEAD</li>
<li>origin/master</li>
</ul>
<p>Running <code>git fetch</code> on computer B, I can remove the local devel branch with
<code>git branch -d devel</code>, but I can't remove the remote devel branch.</p>
<p><code>git push origin :heads/devel</code> returns the following error messages.</p>
<blockquote>
<p>error: unable to push to unqualified destination: heads/proxy3d<br>
 The destination refspec neither matches an existing ref on the remote nor
begins with refs/, and we are unable to guess a prefix based on the source
ref.<br>
 fatal: The remote end hung up unexpectedly</p>
</blockquote>
<p><code>git branch -a</code> still lists origin/devel in the remote branches.</p>
<p>How can I clean up the remote branches from computer B?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>First, what is the result of <code>git branch -a</code> on machine B?</p>
<p>Second, you have already deleted <code>heads/devel</code> on <code>origin</code>, so that's why you
can't delete it from machine B.</p>
<p>Try</p>
<div class="code"><pre class="code literal-block">git branch -r -d origin/devel
</pre></div>

<p>or</p>
<div class="code"><pre class="code literal-block">git remote prune origin
</pre></div>

<p>or</p>
<div class="code"><pre class="code literal-block">git fetch origin --prune
</pre></div>

<p>and feel free to add <code>--dry-run</code> to the end of your <code>git</code> statement to see the
result of running it without actually running it.</p>
<p>Docs for <code>git remote prune</code> and <code>git branch</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Consider to run :</p>
<div class="code"><pre class="code literal-block">git fetch --prune
</pre></div>

<p>On a regular basis in each repo to remove local branches that have been
tracking a remote branch that is deleted (no longer exists in remote GIT
repo).</p>
<p>This can be further simplified by</p>
<div class="code"><pre class="code literal-block">git config remote.origin.prune true
</pre></div>

<p>this is a <code>per-repo</code> setting that will make any future <code>git fetch or git pull</code>
to automatically <em>prune</em>.</p>
<p>To set this up for your user, you may also edit the global .gitconfig and add</p>
<div class="code"><pre class="code literal-block"><span class="k">[fetch]</span>
<span class="w">    </span><span class="na">prune</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
</pre></div>

<p>However, it's recommended that this is done using the following command:</p>
<div class="code"><pre class="code literal-block">git config --global fetch.prune true
</pre></div>

<p>or to apply it system wide (not just for the user)</p>
<div class="code"><pre class="code literal-block">git config --system fetch.prune true
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-584.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-582.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
