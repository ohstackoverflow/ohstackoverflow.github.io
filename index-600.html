<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 600) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-600.html">
<link rel="prev" href="index-601.html" type="text/html">
<link rel="next" href="index-599.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/file-upload-asp-net-mvc-3-0/" class="u-url">File Upload ASP.NET MVC 3.0</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/file-upload-asp-net-mvc-3-0/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T11:01:36+08:00" itemprop="datePublished" title="2023-02-17 11:01">2023-02-17 11:01</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>(Preface: this question is about ASP.NET MVC 3.0 which was released in 2011,
it is not about <strong>ASP.NET Core 3.0</strong> which was released in 2019)</p>
<p>I want to upload file in asp.net mvc. How can I upload the file using html
<code>input file</code> control?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You don't use a file input control. Server side controls are not used in
ASP.NET MVC. Checkout the following blog post which illustrates how to achieve
this in ASP.NET MVC.</p>
<p>So you would start by creating an HTML form which would contain a file input:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@using</span><span class="w"> </span><span class="p">(</span><span class="n">Html</span><span class="p">.</span><span class="n">BeginForm</span><span class="p">(</span><span class="ss">"Index"</span><span class="p">,</span><span class="w"> </span><span class="ss">"Home"</span><span class="p">,</span><span class="w"> </span><span class="n">FormMethod</span><span class="p">.</span><span class="n">Post</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">enctype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">"multipart/form-data"</span><span class="w"> </span><span class="err">}</span><span class="p">))</span>
<span class="err">{</span>
<span class="w">    </span><span class="o">&lt;</span><span class="k">input</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="ss">"file"</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="ss">"file"</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="k">input</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="ss">"submit"</span><span class="w"> </span><span class="k">value</span><span class="o">=</span><span class="ss">"OK"</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="err">}</span>
</pre></div>

<p>and then you would have a controller to handle the upload:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">HomeController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Controller</span>
<span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">renders</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">form</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ActionResult</span><span class="w"> </span><span class="n">Index</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">View</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">handles</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">upload</span>
<span class="w">    </span><span class="p">[</span><span class="n">HttpPost</span><span class="p">]</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ActionResult</span><span class="w"> </span><span class="n">Index</span><span class="p">(</span><span class="n">HttpPostedFileBase</span><span class="w"> </span><span class="n">file</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">selected</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">file</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">file</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">file</span><span class="o">.</span><span class="n">ContentLength</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">extract</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">filename</span>
<span class="w">            </span><span class="k">var</span><span class="w"> </span><span class="n">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="o">.</span><span class="n">GetFileName</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">FileName</span><span class="p">);</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="o">~/</span><span class="n">App_Data</span><span class="o">/</span><span class="n">uploads</span><span class="w"> </span><span class="n">folder</span>
<span class="w">            </span><span class="k">var</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="o">.</span><span class="n">Combine</span><span class="p">(</span><span class="n">Server</span><span class="o">.</span><span class="n">MapPath</span><span class="p">(</span><span class="s2">"~/App_Data/uploads"</span><span class="p">),</span><span class="w"> </span><span class="n">fileName</span><span class="p">);</span>
<span class="w">            </span><span class="n">file</span><span class="o">.</span><span class="n">SaveAs</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">redirect</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">again</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RedirectToAction</span><span class="p">(</span><span class="s2">"Index"</span><span class="p">);</span><span class="w">        </span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>to transfer to <code>byte[]</code> (e.g. for saving to DB):</p>
<div class="code"><pre class="code literal-block">using (MemoryStream ms = new MemoryStream()) {
    file.InputStream.CopyTo(ms);
    byte[] array = ms.GetBuffer();
}
</pre></div>

<p>To transfer the input stream directly into the database, without storing it in
the memory you can use this class taken from here and a bit changed:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">VarbinaryStream</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Stream</span><span class="w"> </span><span class="p">{</span>
<span class="n">private</span><span class="w"> </span><span class="n">SqlConnection</span><span class="w"> </span><span class="n">_Connection</span><span class="p">;</span>

<span class="n">private</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">_TableName</span><span class="p">;</span>
<span class="n">private</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">_BinaryColumn</span><span class="p">;</span>
<span class="n">private</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">_KeyColumn</span><span class="p">;</span>
<span class="n">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_KeyValue</span><span class="p">;</span>

<span class="n">private</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">_Offset</span><span class="p">;</span>

<span class="n">private</span><span class="w"> </span><span class="n">SqlDataReader</span><span class="w"> </span><span class="n">_SQLReader</span><span class="p">;</span>
<span class="n">private</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">_SQLReadPosition</span><span class="p">;</span>

<span class="n">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">_AllowedToRead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>

<span class="n">public</span><span class="w"> </span><span class="nf">VarbinaryStream</span><span class="p">(</span>
<span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">ConnectionString</span><span class="p">,</span>
<span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">TableName</span><span class="p">,</span>
<span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">BinaryColumn</span><span class="p">,</span>
<span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">KeyColumn</span><span class="p">,</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">KeyValue</span><span class="p">,</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">AllowRead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// create own connection with the connection string.</span>
<span class="w">  </span><span class="n">_Connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SqlConnection</span><span class="p">(</span><span class="n">ConnectionString</span><span class="p">);</span>

<span class="w">  </span><span class="n">_TableName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TableName</span><span class="p">;</span>
<span class="w">  </span><span class="n">_BinaryColumn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BinaryColumn</span><span class="p">;</span>
<span class="w">  </span><span class="n">_KeyColumn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyColumn</span><span class="p">;</span>
<span class="w">  </span><span class="n">_KeyValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KeyValue</span><span class="p">;</span>


<span class="w">  </span><span class="c1">// only query the database for a result if we are going to be reading, otherwise skip.</span>
<span class="w">  </span><span class="n">_AllowedToRead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AllowRead</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_AllowedToRead</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">try</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_Connection</span><span class="p">.</span><span class="n">State</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ConnectionState</span><span class="p">.</span><span class="n">Open</span><span class="p">)</span>
<span class="w">        </span><span class="n">_Connection</span><span class="p">.</span><span class="n">Open</span><span class="p">();</span>

<span class="w">      </span><span class="n">SqlCommand</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SqlCommand</span><span class="p">(</span>
<span class="w">                      </span><span class="s">@"SELECT TOP 1 ["</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_BinaryColumn</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">@"]</span>
<span class="w">                            </span><span class="n">FROM</span><span class="w"> </span><span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="s">" + _TableName + @"</span><span class="p">]</span>
<span class="w">                            </span><span class="n">WHERE</span><span class="w"> </span><span class="p">[</span><span class="s">" + _KeyColumn + "</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@</span><span class="kt">id</span><span class="s">",</span>
<span class="w">                  </span><span class="n">_Connection</span><span class="p">);</span>

<span class="w">      </span><span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">SqlParameter</span><span class="p">(</span><span class="s">"@id"</span><span class="p">,</span><span class="w"> </span><span class="n">_KeyValue</span><span class="p">));</span>

<span class="w">      </span><span class="n">_SQLReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="n">ExecuteReader</span><span class="p">(</span>
<span class="w">          </span><span class="n">CommandBehavior</span><span class="p">.</span><span class="n">SequentialAccess</span><span class="w"> </span><span class="o">|</span>
<span class="w">          </span><span class="n">CommandBehavior</span><span class="p">.</span><span class="n">SingleResult</span><span class="w"> </span><span class="o">|</span>
<span class="w">          </span><span class="n">CommandBehavior</span><span class="p">.</span><span class="n">SingleRow</span><span class="w"> </span><span class="o">|</span>
<span class="w">          </span><span class="n">CommandBehavior</span><span class="p">.</span><span class="n">CloseConnection</span><span class="p">);</span>

<span class="w">      </span><span class="n">_SQLReader</span><span class="p">.</span><span class="n">Read</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// log errors here</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// this method will be called as part of the Stream ímplementation when we try to write to our VarbinaryStream class.</span>
<span class="n">public</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Write</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">try</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_Connection</span><span class="p">.</span><span class="n">State</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ConnectionState</span><span class="p">.</span><span class="n">Open</span><span class="p">)</span>
<span class="w">      </span><span class="n">_Connection</span><span class="p">.</span><span class="n">Open</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_Offset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// for the first write we just send the bytes to the Column</span>
<span class="w">      </span><span class="n">SqlCommand</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SqlCommand</span><span class="p">(</span>
<span class="w">                                  </span><span class="s">@"UPDATE [dbo].["</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_TableName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">@"]</span>
<span class="w">                                            </span><span class="n">SET</span><span class="w"> </span><span class="p">[</span><span class="s">" + _BinaryColumn + @"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@</span><span class="n">firstchunk</span><span class="w"> </span>
<span class="w">                                        </span><span class="n">WHERE</span><span class="w"> </span><span class="p">[</span><span class="s">" + _KeyColumn + "</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@</span><span class="kt">id</span><span class="s">",</span>
<span class="w">                              </span><span class="n">_Connection</span><span class="p">);</span>

<span class="w">      </span><span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">SqlParameter</span><span class="p">(</span><span class="s">"@firstchunk"</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">));</span>
<span class="w">      </span><span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">SqlParameter</span><span class="p">(</span><span class="s">"@id"</span><span class="p">,</span><span class="w"> </span><span class="n">_KeyValue</span><span class="p">));</span>

<span class="w">      </span><span class="n">cmd</span><span class="p">.</span><span class="n">ExecuteNonQuery</span><span class="p">();</span>

<span class="w">      </span><span class="n">_Offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// for all updates after the first one we use the TSQL command .WRITE() to append the data in the database</span>
<span class="w">      </span><span class="n">SqlCommand</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SqlCommand</span><span class="p">(</span>
<span class="w">                              </span><span class="s">@"UPDATE [dbo].["</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">_TableName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">@"]</span>
<span class="w">                                        </span><span class="n">SET</span><span class="w"> </span><span class="p">[</span><span class="s">" + _BinaryColumn + @"</span><span class="p">].</span><span class="n">WRITE</span><span class="p">(@</span><span class="n">chunk</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="p">@</span><span class="n">length</span><span class="p">)</span>
<span class="w">                                    </span><span class="n">WHERE</span><span class="w"> </span><span class="p">[</span><span class="s">" + _KeyColumn + "</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@</span><span class="kt">id</span><span class="s">",</span>
<span class="w">                           </span><span class="n">_Connection</span><span class="p">);</span>

<span class="w">      </span><span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">SqlParameter</span><span class="p">(</span><span class="s">"@chunk"</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">));</span>
<span class="w">      </span><span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">SqlParameter</span><span class="p">(</span><span class="s">"@length"</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">));</span>
<span class="w">      </span><span class="n">cmd</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">SqlParameter</span><span class="p">(</span><span class="s">"@id"</span><span class="p">,</span><span class="w"> </span><span class="n">_KeyValue</span><span class="p">));</span>

<span class="w">      </span><span class="n">cmd</span><span class="p">.</span><span class="n">ExecuteNonQuery</span><span class="p">();</span>

<span class="w">      </span><span class="n">_Offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// log errors here</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// this method will be called as part of the Stream ímplementation when we try to read from our VarbinaryStream class.</span>
<span class="n">public</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Read</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">try</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">bytesRead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_SQLReader</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">_SQLReadPosition</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">    </span><span class="n">_SQLReadPosition</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">bytesRead</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">bytesRead</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// log errors here</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">public</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">CanRead</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">_AllowedToRead</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">protected</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Dispose</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">disposing</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_Connection</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">null</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_Connection</span><span class="p">.</span><span class="n">State</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ConnectionState</span><span class="p">.</span><span class="n">Closed</span><span class="p">)</span>
<span class="w">      </span><span class="n">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_Connection</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span><span class="w">           </span><span class="p">}</span>
<span class="w">      </span><span class="n">catch</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">_Connection</span><span class="p">.</span><span class="n">Dispose</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">base</span><span class="p">.</span><span class="n">Dispose</span><span class="p">(</span><span class="n">disposing</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#region unimplemented methods</span>
<span class="n">public</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">CanSeek</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">public</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">CanWrite</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">public</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Flush</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">NotImplementedException</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">public</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">Length</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">NotImplementedException</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">public</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">Position</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">get</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">NotImplementedException</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">set</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">NotImplementedException</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">public</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">Seek</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">SeekOrigin</span><span class="w"> </span><span class="n">origin</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">NotImplementedException</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">public</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">SetLength</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">NotImplementedException</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">#endregion unimplemented methods  }</span>
</pre></div>

<p>and the usage:</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="n">using</span><span class="w"> </span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">filestream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">VarbinaryStream</span><span class="p">(</span>
<span class="w">                            </span><span class="s2">"Connection_String"</span><span class="p">,</span>
<span class="w">                            </span><span class="s2">"Table_Name"</span><span class="p">,</span>
<span class="w">                            </span><span class="s2">"Varbinary_Column_name"</span><span class="p">,</span>
<span class="w">                            </span><span class="s2">"Key_Column_Name"</span><span class="p">,</span>
<span class="w">                            </span><span class="n">keyValueId</span><span class="p">,</span>
<span class="w">                            </span><span class="bp">true</span><span class="p">))</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">postedFile</span><span class="o">.</span><span class="n">InputStream</span><span class="o">.</span><span class="n">CopyTo</span><span class="p">(</span><span class="n">filestream</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-convert-a-comma-separated-string-to-an-array/" class="u-url">How can I convert a comma-separated string to an array?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-convert-a-comma-separated-string-to-an-array/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T11:01:08+08:00" itemprop="datePublished" title="2023-02-17 11:01">2023-02-17 11:01</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a comma-separated string that I want to convert into an array, so I can
loop through it.</p>
<p>Is there anything built-in to do this?</p>
<p>For example, I have this string</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="nb">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"January,February,March,April,May,June,July,August,September,October,November,December"</span><span class="p">;</span>
</pre></div>

<p>Now I want to split this by the comma, and then store it in an array.</p>
<p><br><br></p>
<h2>Answer</h2>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">','</span><span class="p">);</span>
</pre></div>

<p>MDN reference, mostly helpful for the possibly unexpected behavior of the
<code>limit</code> parameter. (Hint: <code>"a,b,c".split(",", 2)</code> comes out to <code>["a", "b"]</code>,
not <code>["a", "b,c"]</code>.)</p>
<p><br></p>
<h3>Suggest</h3>
<p>Watch out if you are aiming at integers, like 1,2,3,4,5. If you intend to use
the elements of your array as integers and not as strings after splitting the
string, consider converting them into such.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="nb">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"1,2,3,4,5,6"</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Array</span><span class="p">();</span>
<span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">strings</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="o">.</span>
<span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">);</span>
</pre></div>

<p>Adding a loop like this,</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">temp</span><span class="o">[</span><span class="n">a</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parseInt</span><span class="p">(</span><span class="n">temp</span><span class="o">[</span><span class="n">a</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Explicitly</span><span class="w"> </span><span class="k">include</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">Álvaro</span><span class="err">'</span><span class="n">s</span><span class="w"> </span><span class="n">comment</span>
<span class="err">}</span>
</pre></div>

<p>will return an array containing integers, and not strings.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/using-python-3-in-virtualenv/" class="u-url">Using Python 3 in virtualenv</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/using-python-3-in-virtualenv/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T11:00:39+08:00" itemprop="datePublished" title="2023-02-17 11:00">2023-02-17 11:00</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Using virtualenv, I run my projects with the default version of Python (2.7).
On one project, I need to use Python 3.4.</p>
<p>I used <code>brew install python3</code> to install it on my Mac. Now, how do I create a
virtualenv that uses the new version?</p>
<p>e.g. sudo virtualenv envPython3</p>
<p>If I try:</p>
<div class="code"><pre class="code literal-block">virtualenv -p python3 test
</pre></div>

<p>I get:</p>
<div class="code"><pre class="code literal-block"><span class="n">Running</span> <span class="n">virtualenv</span> <span class="k">with</span> <span class="n">interpreter</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python3</span>
<span class="n">Using</span> <span class="n">base</span> <span class="n">prefix</span> <span class="s1">'/usr/local/Cellar/python3/3.4.0_1/Frameworks/Python.framework/Versions/3.4'</span>
<span class="n">New</span> <span class="n">python</span> <span class="n">executable</span> <span class="ow">in</span> <span class="n">test</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python3</span><span class="mf">.4</span>
<span class="n">Also</span> <span class="n">creating</span> <span class="n">executable</span> <span class="ow">in</span> <span class="n">test</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span>
<span class="n">Failed</span> <span class="n">to</span> <span class="kn">import</span> <span class="nn">the</span> <span class="n">site</span> <span class="n">module</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">"/Users/user/Documents/workspace/test/test/bin/../lib/python3.4/site.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">67</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="kn">import</span> <span class="nn">os</span>
  <span class="n">File</span> <span class="s2">"/Users/user/Documents/workspace/test/test/bin/../lib/python3.4/os.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">634</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="kn">from</span> <span class="nn">_collections_abc</span> <span class="kn">import</span> <span class="n">MutableMapping</span>
<span class="ne">ImportError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">'_collections_abc'</span>
<span class="n">ERROR</span><span class="p">:</span> <span class="n">The</span> <span class="n">executable</span> <span class="n">test</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python3</span><span class="mf">.4</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">functioning</span>
<span class="n">ERROR</span><span class="p">:</span> <span class="n">It</span> <span class="n">thinks</span> <span class="n">sys</span><span class="o">.</span><span class="n">prefix</span> <span class="ow">is</span> <span class="s1">'/Users/user/Documents/workspace/test'</span> <span class="p">(</span><span class="n">should</span> <span class="n">be</span> <span class="s1">'/Users/user/Documents/workspace/test/test'</span><span class="p">)</span>
<span class="n">ERROR</span><span class="p">:</span> <span class="n">virtualenv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">compatible</span> <span class="k">with</span> <span class="n">this</span> <span class="n">system</span> <span class="ow">or</span> <span class="n">executable</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>simply run</p>
<div class="code"><pre class="code literal-block">virtualenv -p python3 envname
</pre></div>

<p>Update after OP's edit:</p>
<p>There was a bug in the OP's version of virtualenv, as described here. The
problem was fixed by running:</p>
<div class="code"><pre class="code literal-block">pip install --upgrade virtualenv
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Python 3 has a built-in support for virtual environments - venv. It might be
better to use that instead. Referring to the docs:</p>
<blockquote>
<p>Creation of virtual environments is done by executing the pyvenv script:</p>
<p><code>pyvenv /path/to/new/virtual/environment</code></p>
</blockquote>
<p><strong>Update for Python 3.6 and newer:</strong></p>
<p>As pawciobiel correctly comments, <code>pyvenv</code> is deprecated as of Python 3.6 and
the new way is:</p>
<div class="code"><pre class="code literal-block">python3 -m venv /path/to/new/virtual/environment
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-601.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-599.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
