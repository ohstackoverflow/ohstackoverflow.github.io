<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2642) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2642.html">
<link rel="prev" href="index-2643.html" type="text/html">
<link rel="next" href="index-2641.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/global-variables-in-angularjs/" class="u-url">Global variables in AngularJS</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/global-variables-in-angularjs/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T07:05:10+08:00" itemprop="datePublished" title="2023-03-05 07:05">2023-03-05 07:05</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a problem where i'm initialising a variable on the scope in a
controller. Then it gets changed in another controller when a user logs in.
This variable is used to control things such as the navigation bar and
restricts access to parts of the site depending on the type of user, so its
important that it holds its value. The problem with it is that the controller
that initialises it, gets called again by angular some how and then resets the
variable back to its initial value.</p>
<p>I assume this is not the correct way of declaring and initialising global
variables, well its not really global, so my question is what is the correct
way and is there any good examples around that work with the current version
of angular?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You've got basically 2 options for "global" variables:</p>
<ul>
<li>use a <code>$rootScope</code> http://docs.angularjs.org/api/ng.$rootScope</li>
<li>use a service http://docs.angularjs.org/guide/services</li>
</ul>
<p><code>$rootScope</code> is a parent of all scopes so values exposed there will be visible
in all templates and controllers. Using the <code>$rootScope</code> is very easy as you
can simply inject it into any controller and change values in this scope. It
might be convenient but has all the problems of global variables.</p>
<p>Services are singletons that you can inject to any controller and expose their
values in a controller's scope. Services, being singletons are still 'global'
but you've got far better control over where those are used and exposed.</p>
<p>Using services is a bit more complex, but not that much, here is an example:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">myApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">angular</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,[]);</span>
<span class="n">myApp</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s1">'UserService'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">name</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s1">'anonymous'</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">});</span>
</pre></div>

<p>and then in a controller:</p>
<div class="code"><pre class="code literal-block">function MyCtrl($scope, UserService) {
    $scope.name = UserService.name;
}
</pre></div>

<p>Here is the working jsFiddle:
http://jsfiddle.net/pkozlowski_opensource/BRWPM/2/</p>
<p><br></p>
<h3>Suggest</h3>
<p>If you just want to store a value, according to the Angular documentation on
Providers, you should use the Value recipe:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">myApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">angular</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span><span class="w"> </span><span class="p">[]);</span>
<span class="n">myApp</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">'clientId'</span><span class="p">,</span><span class="w"> </span><span class="s1">'a12345654321x'</span><span class="p">);</span>
</pre></div>

<p>Then use it in a controller like this:</p>
<div class="code"><pre class="code literal-block">myApp.controller('DemoController', ['clientId', function DemoController(clientId) {
    this.clientId = clientId;
}]);
</pre></div>

<p>The same thing can be achieved using a Provider, Factory, or Service since
they are "just syntactic sugar on top of a provider recipe" but using Value
will achieve what you want with minimal syntax.</p>
<p>The other option is to use <code>$rootScope</code>, but it's not really an option because
you shouldn't use it for the same reasons you shouldn't use global variables
in other languages. It's advised to be used sparingly.</p>
<p>Since all scopes inherit from <code>$rootScope</code>, if you have a variable
<code>$rootScope.data</code> and someone forgets that <code>data</code> is already defined and
creates <code>$scope.data</code> in a local scope you will run into problems.</p>
<hr>
<p>If you want to modify this value and have it persist across all your
controllers, use an object and modify the properties keeping in mind
Javascript is pass by "copy of a reference":</p>
<div class="code"><pre class="code literal-block"><span class="nt">myApp</span><span class="p">.</span><span class="nc">value</span><span class="o">(</span><span class="s1">'clientId'</span><span class="o">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="s1">'a12345654321x'</span><span class="w"> </span><span class="p">}</span><span class="o">);</span>
<span class="nt">myApp</span><span class="p">.</span><span class="nc">controller</span><span class="o">(</span><span class="s1">'DemoController'</span><span class="o">,</span><span class="w"> </span><span class="cp">[</span><span class="s1">'clientId'</span><span class="p">,</span><span class="w"> </span><span class="nx">function</span><span class="w"> </span><span class="nx">DemoController</span><span class="p">(</span><span class="nx">clientId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">this.clientId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">clientId</span><span class="p">;</span>
<span class="w">    </span><span class="nx">this.change</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">clientId.value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'something else'</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="cp">]</span><span class="o">;</span>
</pre></div>

<p>JSFiddle example</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-pass-an-array-into-a-sql-server-stored-procedure/" class="u-url">How to pass an array into a SQL Server stored procedure</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-pass-an-array-into-a-sql-server-stored-procedure/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T07:03:37+08:00" itemprop="datePublished" title="2023-03-05 07:03">2023-03-05 07:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How to pass an array into a SQL Server stored procedure?</p>
<p>For example, I have a list of employees. I want to use this list as a table
and join it with another table. But the list of employees should be passed as
parameter from C#.</p>
<p><br><br></p>
<h2>Answer</h2>
<h4>SQL Server 2016 (or newer)</h4>
<p>You can pass in a delimited list or <code>JSON</code> and use <code>STRING_SPLIT()</code> or
<code>OPENJSON()</code>.</p>
<p><code>STRING_SPLIT()</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">CREATE</span><span class="w"> </span><span class="n">PROCEDURE</span><span class="w"> </span><span class="n">dbo</span><span class="o">.</span><span class="n">DoSomethingWithEmployees</span>
<span class="w">  </span><span class="err">@</span><span class="n">List</span><span class="w"> </span><span class="n">varchar</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>
<span class="n">AS</span>
<span class="n">BEGIN</span>
<span class="w">  </span><span class="n">SET</span><span class="w"> </span><span class="n">NOCOUNT</span><span class="w"> </span><span class="n">ON</span><span class="p">;</span>

<span class="w">  </span><span class="n">SELECT</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">STRING_SPLIT</span><span class="p">(</span><span class="err">@</span><span class="n">List</span><span class="p">,</span><span class="w"> </span><span class="s1">','</span><span class="p">);</span>
<span class="n">END</span>
<span class="n">GO</span>
<span class="n">EXEC</span><span class="w"> </span><span class="n">dbo</span><span class="o">.</span><span class="n">DoSomethingWithEmployees</span><span class="w"> </span><span class="err">@</span><span class="n">List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'1,2,3'</span><span class="p">;</span>
</pre></div>

<p><code>OPENJSON()</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">CREATE</span><span class="w"> </span><span class="n">PROCEDURE</span><span class="w"> </span><span class="n">dbo</span><span class="o">.</span><span class="n">DoSomethingWithEmployees</span>
<span class="w">  </span><span class="err">@</span><span class="n">List</span><span class="w"> </span><span class="n">varchar</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>
<span class="n">AS</span>
<span class="n">BEGIN</span>
<span class="w">  </span><span class="n">SET</span><span class="w"> </span><span class="n">NOCOUNT</span><span class="w"> </span><span class="n">ON</span><span class="p">;</span>

<span class="w">  </span><span class="n">SELECT</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">OPENJSON</span><span class="p">(</span><span class="n">CONCAT</span><span class="p">(</span><span class="s1">'["'</span><span class="p">,</span>
<span class="w">    </span><span class="n">REPLACE</span><span class="p">(</span><span class="n">STRING_ESCAPE</span><span class="p">(</span><span class="err">@</span><span class="n">List</span><span class="p">,</span><span class="w"> </span><span class="s1">'JSON'</span><span class="p">),</span><span class="w"> </span>
<span class="w">    </span><span class="s1">','</span><span class="p">,</span><span class="w"> </span><span class="s1">'","'</span><span class="p">),</span><span class="w"> </span><span class="s1">'"]'</span><span class="p">))</span><span class="w"> </span><span class="n">AS</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<span class="n">END</span>
<span class="n">GO</span>
<span class="n">EXEC</span><span class="w"> </span><span class="n">dbo</span><span class="o">.</span><span class="n">DoSomethingWithEmployees</span><span class="w"> </span><span class="err">@</span><span class="n">List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'1,2,3'</span><span class="p">;</span>
</pre></div>

<p>I wrote more about this here:</p>
<ul>
<li>Handling an unknown number of parameters in SQL Server</li>
<li>Ordered String Splitting in SQL Server with OPENJSON</li>
</ul>
<h4>SQL Server 2008 (or newer)</h4>
<p>First, in your database, create the following two objects:</p>
<div class="code"><pre class="code literal-block"><span class="k">CREATE</span><span class="w"> </span><span class="n">TYPE</span><span class="w"> </span><span class="n">dbo</span><span class="p">.</span><span class="n">IDList</span>
<span class="k">AS</span><span class="w"> </span><span class="nc">TABLE</span>
<span class="p">(</span>
<span class="w">  </span><span class="n">ID</span><span class="w"> </span><span class="nc">INT</span>
<span class="p">);</span>
<span class="k">GO</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">dbo</span><span class="p">.</span><span class="n">DoSomethingWithEmployees</span>
<span class="w">  </span><span class="nv">@List</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dbo</span><span class="p">.</span><span class="n">IDList</span><span class="w"> </span><span class="n">READONLY</span>
<span class="k">AS</span>
<span class="k">BEGIN</span>
<span class="w">  </span><span class="k">SET</span><span class="w"> </span><span class="n">NOCOUNT</span><span class="w"> </span><span class="k">ON</span><span class="p">;</span>

<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@List</span><span class="p">;</span><span class="w"> </span>
<span class="k">END</span>
<span class="k">GO</span>
</pre></div>

<p>Now in your C# code:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">Obtain</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">ids</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">send</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">helper</span><span class="w"> </span><span class="n">utility</span><span class="w"> </span><span class="n">function</span>
<span class="nb nb-Type">int</span><span class="p">[]</span><span class="w"> </span><span class="n">employeeIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetEmployeeIds</span><span class="p">();</span>

<span class="n">DataTable</span><span class="w"> </span><span class="n">tvp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DataTable</span><span class="p">();</span>
<span class="n">tvp</span><span class="o">.</span><span class="n">Columns</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">DataColumn</span><span class="p">(</span><span class="s2">"ID"</span><span class="p">,</span><span class="w"> </span><span class="nb">typeof</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="p">)));</span>

<span class="o">//</span><span class="w"> </span><span class="n">populate</span><span class="w"> </span><span class="n">DataTable</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="n">here</span>
<span class="n">foreach</span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">employeeIds</span><span class="p">)</span>
<span class="w">    </span><span class="n">tvp</span><span class="o">.</span><span class="n">Rows</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

<span class="n">using</span><span class="w"> </span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">SqlCommand</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SqlCommand</span><span class="p">(</span><span class="s2">"dbo.DoSomethingWithEmployees"</span><span class="p">,</span><span class="w"> </span><span class="n">conn</span><span class="p">);</span>
<span class="w">    </span><span class="n">cmd</span><span class="o">.</span><span class="n">CommandType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CommandType</span><span class="o">.</span><span class="n">StoredProcedure</span><span class="p">;</span>
<span class="w">    </span><span class="n">SqlParameter</span><span class="w"> </span><span class="n">tvparam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cmd</span><span class="o">.</span><span class="n">Parameters</span><span class="o">.</span><span class="n">AddWithValue</span><span class="p">(</span><span class="s2">"@List"</span><span class="p">,</span><span class="w"> </span><span class="n">tvp</span><span class="p">);</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">important</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">C</span><span class="c1"># DataTable object to the correct SQL User Defined Type</span>
<span class="w">    </span><span class="n">tvparam</span><span class="o">.</span><span class="n">SqlDbType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SqlDbType</span><span class="o">.</span><span class="n">Structured</span><span class="p">;</span>
<span class="w">    </span><span class="n">tvparam</span><span class="o">.</span><span class="n">TypeName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dbo.IDList"</span><span class="p">;</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="n">consume</span><span class="w"> </span><span class="n">results</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="o">.</span><span class="w"> </span><span class="n">here</span>
<span class="p">}</span>
</pre></div>

<h4>SQL Server 2005</h4>
<p>If you are using SQL Server 2005, I would still recommend a split function
over XML. First, create a function:</p>
<div class="code"><pre class="code literal-block"><span class="k">CREATE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">dbo</span><span class="p">.</span><span class="n">SplitInts</span>
<span class="p">(</span>
<span class="w">   </span><span class="nv">@List</span><span class="w">      </span><span class="nc">VARCHAR</span><span class="p">(</span><span class="nf">MAX</span><span class="p">),</span>
<span class="w">   </span><span class="nv">@Delimiter</span><span class="w"> </span><span class="nc">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nc">TABLE</span>
<span class="k">AS</span>
<span class="w">  </span><span class="k">RETURN</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CONVERT</span><span class="p">(</span><span class="nc">INT</span><span class="p">,</span><span class="w"> </span><span class="n">Item</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span>
<span class="w">      </span><span class="p">(</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">i</span><span class="p">.</span><span class="k">value</span><span class="p">(</span><span class="s1">'(./text())[1]'</span><span class="p">,</span><span class="w"> </span><span class="s1">'varchar(max)'</span><span class="p">)</span>
<span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">XML</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CONVERT</span><span class="p">(</span><span class="nc">XML</span><span class="p">,</span><span class="w"> </span><span class="s1">'&lt;i&gt;'</span>
<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="nf">REPLACE</span><span class="p">(</span><span class="nv">@List</span><span class="p">,</span><span class="w"> </span><span class="nv">@Delimiter</span><span class="p">,</span><span class="w"> </span><span class="s1">'&lt;/i&gt;&lt;i&gt;'</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'&lt;/i&gt;'</span><span class="p">).</span><span class="n">query</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
<span class="w">          </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">CROSS</span><span class="w"> </span><span class="n">APPLY</span><span class="w"> </span><span class="o">[</span><span class="n">XML</span><span class="o">]</span><span class="p">.</span><span class="n">nodes</span><span class="p">(</span><span class="s1">'i'</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">y</span>
<span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="w">  </span><span class="p">);</span>
<span class="k">GO</span>
</pre></div>

<p>Now your stored procedure can just be:</p>
<div class="code"><pre class="code literal-block"><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">dbo</span><span class="p">.</span><span class="n">DoSomethingWithEmployees</span>
<span class="w">  </span><span class="nv">@List</span><span class="w"> </span><span class="nc">VARCHAR</span><span class="p">(</span><span class="nf">MAX</span><span class="p">)</span>
<span class="k">AS</span>
<span class="k">BEGIN</span>
<span class="w">  </span><span class="k">SET</span><span class="w"> </span><span class="n">NOCOUNT</span><span class="w"> </span><span class="k">ON</span><span class="p">;</span>

<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">EmployeeID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">dbo</span><span class="p">.</span><span class="n">SplitInts</span><span class="p">(</span><span class="nv">@List</span><span class="p">,</span><span class="w"> </span><span class="s1">','</span><span class="p">);</span><span class="w"> </span>
<span class="k">END</span>
<span class="k">GO</span>
</pre></div>

<p>And in your C# code you just have to pass the list as <code>'1,2,3,12'</code>...</p>
<hr>
<p>I find the method of passing through table valued parameters simplifies the
maintainability of a solution that uses it and often has increased performance
compared to other implementations including XML and string splitting.</p>
<p>The inputs are clearly defined (no one has to guess if the delimiter is a
comma or a semi-colon) and we do not have dependencies on other processing
functions that are not obvious without inspecting the code for the stored
procedure.</p>
<p>Compared to solutions involving user defined XML schema instead of UDTs, this
involves a similar number of steps but in my experience is far simpler code to
manage, maintain and read.</p>
<blockquote>
<p>In many solutions you may only need one or a few of these UDTs (User defined
Types) that you re-use for many stored procedures. As with this example, the
common requirement is to pass through a list of ID pointers, the function
name describes what context those Ids should represent, the type name should
be generic.</p>
</blockquote>
<p><br></p>
<h3>Suggest</h3>
<p>Based on my experience, by creating a delimited expression from the
employeeIDs, there is a tricky and nice solution for this problem. You should
only create an string expression like <code>';123;434;365;'</code> in-which <code>123</code>, <code>434</code>
and <code>365</code> are some employeeIDs. By calling the below procedure and passing
this expression to it, you can fetch your desired records. Easily you can join
the "another table" into this query. This solution is suitable in all versions
of SQL server. Also, in comparison with using table variable or temp table, it
is very faster and optimized solution.</p>
<div class="code"><pre class="code literal-block"><span class="n">CREATE</span><span class="w"> </span><span class="n">PROCEDURE</span><span class="w"> </span><span class="n">dbo</span><span class="o">.</span><span class="n">DoSomethingOnSomeEmployees</span><span class="w">  </span><span class="err">@</span><span class="n">List</span><span class="w"> </span><span class="n">AS</span><span class="w"> </span><span class="n">varchar</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span>
<span class="n">AS</span>
<span class="n">BEGIN</span>
<span class="w">  </span><span class="n">SELECT</span><span class="w"> </span><span class="n">EmployeeID</span><span class="w"> </span>
<span class="w">  </span><span class="n">FROM</span><span class="w"> </span><span class="n">EmployeesTable</span>
<span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="n">inner</span><span class="w"> </span><span class="n">join</span><span class="w"> </span><span class="n">AnotherTable</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">...</span>
<span class="w">  </span><span class="n">where</span><span class="w"> </span><span class="err">@</span><span class="n">List</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="s1">'%;'</span><span class="o">+</span><span class="n">cast</span><span class="p">(</span><span class="n">employeeID</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span><span class="o">+</span><span class="s1">';%'</span>
<span class="n">END</span>
<span class="n">GO</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/detect-http-or-https-then-force-https-in-javascript/" class="u-url">Detect HTTP or HTTPS then force HTTPS in JavaScript</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/detect-http-or-https-then-force-https-in-javascript/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T07:02:02+08:00" itemprop="datePublished" title="2023-03-05 07:02">2023-03-05 07:02</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Is there any way to detect HTTP or HTTPS and then force usage of HTTPS with
JavaScript?</p>
<p>I have some codes for detecting the HTTP or HTTPS but I can't force it to use
<code>https:</code> .</p>
<p>I'm using the <em>window.location.protocol</em> property to set whatever the site is
to <code>https:</code> then refresh the page to hopefully reload a new https'ed URL
loaded into the browser.</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">protocol</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"https:"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">window</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https:"</span><span class="p">;</span>
<span class="w">   </span><span class="n">window</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">reload</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>Try this</p>
<div class="code"><pre class="code literal-block">if<span class="w"> </span>(location.protocol<span class="w"> </span>!==<span class="w"> </span>'https:')<span class="w"> </span>{
<span class="w">    </span>location.replace(`https:<span class="cp">${</span><span class="n">location</span><span class="o">.</span><span class="n">href</span><span class="o">.</span><span class="n">substring</span><span class="p">(</span><span class="n">location</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">length</span><span class="p">)</span><span class="cp">}</span>`);
}
</pre></div>

<p><code>location.href = blah</code> adds this redirect to the browser history. If the user
hits the back button, they will be redirected back to the the same page. It is
better to use <code>location.replace</code> as it doesn't add this redirect to the
browser history.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Setting location.protocol navigates to a new URL. No need to parse/slice
anything.</p>
<div class="code"><pre class="code literal-block"><span class="nt">if</span><span class="w"> </span><span class="o">(</span><span class="nt">location</span><span class="p">.</span><span class="nc">protocol</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s2">"https:"</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">location.protocol</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">"</span><span class="n">https</span><span class="p">:</span><span class="err">"</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Firefox 49 has a bug where <code>https</code> works but <code>https:</code> does not. Said to be
fixed in Firefox 54.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2643.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2641.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
