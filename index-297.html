<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 297) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-297.html">
<link rel="prev" href="index-298.html" type="text/html">
<link rel="next" href="index-296.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/running-shell-command-and-capturing-the-output/" class="u-url">Running shell command and capturing the output</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/running-shell-command-and-capturing-the-output/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T03:17:53+08:00" itemprop="datePublished" title="2023-02-17 03:17">2023-02-17 03:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to write a function that will execute a shell command and return its
output <strong>as a string</strong> , no matter, is it an error or success message. I just
want to get the same result that I would have gotten with the command line.</p>
<p>What would be a code example that would do such a thing?</p>
<p>For example:</p>
<div class="code"><pre class="code literal-block"><span class="nt">def</span><span class="w"> </span><span class="nt">run_command</span><span class="o">(</span><span class="nt">cmd</span><span class="o">):</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="o">??????</span>

<span class="nt">print</span><span class="w"> </span><span class="nt">run_command</span><span class="o">(</span><span class="s1">'mysqladmin create test -uroot -pmysqladmin12'</span><span class="o">)</span>
<span class="err">#</span><span class="w"> </span><span class="nt">Should</span><span class="w"> </span><span class="nt">output</span><span class="w"> </span><span class="nt">something</span><span class="w"> </span><span class="nt">like</span><span class="o">:</span>
<span class="err">#</span><span class="w"> </span><span class="nt">mysqladmin</span><span class="o">:</span><span class="w"> </span><span class="nt">CREATE</span><span class="w"> </span><span class="nt">DATABASE</span><span class="w"> </span><span class="nt">failed</span><span class="o">;</span><span class="w"> </span><span class="nt">error</span><span class="o">:</span><span class="w"> </span><span class="s1">'Can'</span><span class="nt">t</span><span class="w"> </span><span class="nt">create</span><span class="w"> </span><span class="nt">database</span><span class="w"> </span><span class="s1">'test'</span><span class="o">;</span><span class="w"> </span><span class="nt">database</span><span class="w"> </span><span class="nt">exists</span><span class="err">'</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>In all officially maintained versions of Python, the simplest approach is to
use the <code>subprocess.check_output</code> function:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; subprocess.check_output(['ls', '-l'])
b'total 0\n-rw-r--r--  1 memyself  staff  0 Mar 14 11:04 files\n'
</pre></div>

<p><code>check_output</code> runs a single program that takes only arguments as input.1 It
returns the result exactly as printed to <code>stdout</code>. If you need to write input
to <code>stdin</code>, skip ahead to the <code>run</code> or <code>Popen</code> sections. If you want to
execute complex shell commands, see the note on <code>shell=True</code> at the end of
this answer.</p>
<p>The <code>check_output</code> function works in all officially maintained versions of
Python. But for more recent versions, a more flexible approach is available.</p>
<h4>Modern versions of Python (3.5 or higher): <code>run</code>
</h4>
<p>If you're using <strong>Python 3.5+</strong> , and <strong>do not need backwards compatibility</strong>
, the new <code>run</code> function is recommended by the official documentation for most
tasks. It provides a very general, high-level API for the <code>subprocess</code> module.
To capture the output of a program, pass the <code>subprocess.PIPE</code> flag to the
<code>stdout</code> keyword argument. Then access the <code>stdout</code> attribute of the returned
<code>CompletedProcess</code> object:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">subprocess</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">'ls'</span><span class="p">,</span> <span class="s1">'-l'</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
<span class="sa">b</span><span class="s1">'total 0</span><span class="se">\n</span><span class="s1">-rw-r--r--  1 memyself  staff  0 Mar 14 11:04 files</span><span class="se">\n</span><span class="s1">'</span>
</pre></div>

<p>The return value is a <code>bytes</code> object, so if you want a proper string, you'll
need to <code>decode</code> it. Assuming the called process returns a UTF-8-encoded
string:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; result.stdout.decode('utf-8')
'total 0\n-rw-r--r--  1 memyself  staff  0 Mar 14 11:04 files\n'
</pre></div>

<p>This can all be compressed to a one-liner if desired:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; subprocess.run(['ls', '-l'], stdout=subprocess.PIPE).stdout.decode('utf-8')
'total 0\n-rw-r--r--  1 memyself  staff  0 Mar 14 11:04 files\n'
</pre></div>

<p>If you want to pass input to the process's <code>stdin</code>, you can pass a <code>bytes</code>
object to the <code>input</code> keyword argument:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; cmd = ['awk', 'length($0) &gt; 5']
&gt;&gt;&gt; ip = 'foo\nfoofoo\n'.encode('utf-8')
&gt;&gt;&gt; result = subprocess.run(cmd, stdout=subprocess.PIPE, input=ip)
&gt;&gt;&gt; result.stdout.decode('utf-8')
'foofoo\n'
</pre></div>

<p>You can capture errors by passing <code>stderr=subprocess.PIPE</code> (capture to
<code>result.stderr</code>) or <code>stderr=subprocess.STDOUT</code> (capture to <code>result.stdout</code>
along with regular output). If you want <code>run</code> to throw an exception when the
process returns a nonzero exit code, you can pass <code>check=True</code>. (Or you can
check the <code>returncode</code> attribute of <code>result</code> above.) When security is not a
concern, you can also run more complex shell commands by passing <code>shell=True</code>
as described at the end of this answer.</p>
<p>Later versions of Python streamline the above further. In Python 3.7+, the
above one-liner can be spelled like this:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; subprocess.run(['ls', '-l'], capture_output=True, text=True).stdout
'total 0\n-rw-r--r--  1 memyself  staff  0 Mar 14 11:04 files\n'
</pre></div>

<p>Using <code>run</code> this way adds just a bit of complexity, compared to the old way of
doing things. But now you can do almost anything you need to do with the <code>run</code>
function alone.</p>
<h4>Older versions of Python (3-3.4): more about <code>check_output</code>
</h4>
<p>If you are using an older version of Python, or need modest backwards
compatibility, you can use the <code>check_output</code> function as briefly described
above. It has been available since Python 2.7.</p>
<div class="code"><pre class="code literal-block">subprocess.check_output(*popenargs, **kwargs)
</pre></div>

<p>It takes takes the same arguments as <code>Popen</code> (see below), and returns a string
containing the program's output. The beginning of this answer has a more
detailed usage example. In Python 3.5+, <code>check_output</code> is equivalent to
executing <code>run</code> with <code>check=True</code> and <code>stdout=PIPE</code>, and returning just the
<code>stdout</code> attribute.</p>
<p>You can pass <code>stderr=subprocess.STDOUT</code> to ensure that error messages are
included in the returned output. When security is not a concern, you can also
run more complex shell commands by passing <code>shell=True</code> as described at the
end of this answer.</p>
<p>If you need to pipe from <code>stderr</code> or pass input to the process, <code>check_output</code>
won't be up to the task. See the <code>Popen</code> examples below in that case.</p>
<h4>Complex applications and legacy versions of Python (2.6 and below):</h4>
<p><code>Popen</code></p>
<p>If you need deep backwards compatibility, or if you need more sophisticated
functionality than <code>check_output</code> or <code>run</code> provide, you'll have to work
directly with <code>Popen</code> objects, which encapsulate the low-level API for
subprocesses.</p>
<p>The <code>Popen</code> constructor accepts either <strong>a single command</strong> without arguments,
or <strong>a list</strong> containing a command as its first item, followed by any number
of arguments, each as a separate item in the list. <code>shlex.split</code> can help
parse strings into appropriately formatted lists. <code>Popen</code> objects also accept
a host of different arguments for process IO management and low-level
configuration.</p>
<p>To send input and capture output, <code>communicate</code> is almost always the preferred
method. As in:</p>
<div class="code"><pre class="code literal-block">output = subprocess.Popen(["mycmd", "myarg"], 
                          stdout=subprocess.PIPE).communicate()[0]
</pre></div>

<p>Or</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">subprocess</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'ls'</span><span class="p">,</span> <span class="s1">'-a'</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> 
<span class="o">...</span>                                    <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span> <span class="n">out</span>
<span class="o">.</span>
<span class="o">..</span>
<span class="n">foo</span>
</pre></div>

<p>If you set <code>stdin=PIPE</code>, <code>communicate</code> also allows you to pass data to the
process via <code>stdin</code>:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; cmd = ['awk', 'length($0) &gt; 5']
&gt;&gt;&gt; p = subprocess.Popen(cmd, stdout=subprocess.PIPE,
...                           stderr=subprocess.PIPE,
...                           stdin=subprocess.PIPE)
&gt;&gt;&gt; out, err = p.communicate('foo\nfoofoo\n')
&gt;&gt;&gt; print out
foofoo
</pre></div>

<p>Note Aaron Hall's answer, which indicates that on some systems, you may need
to set <code>stdout</code>, <code>stderr</code>, and <code>stdin</code> all to <code>PIPE</code> (or <code>DEVNULL</code>) to get
<code>communicate</code> to work at all.</p>
<p>In some rare cases, you may need complex, real-time output capturing. Vartec's
answer suggests a way forward, but methods other than <code>communicate</code> are prone
to deadlocks if not used carefully.</p>
<p>As with all the above functions, when security is not a concern, you can run
more complex shell commands by passing <code>shell=True</code>.</p>
<h4>Notes</h4>
<p><strong>1. Running shell commands: the<code>shell=True</code> argument</strong></p>
<p>Normally, each call to <code>run</code>, <code>check_output</code>, or the <code>Popen</code> constructor
executes a <em>single program</em>. That means no fancy bash-style pipes. If you want
to run complex shell commands, you can pass <code>shell=True</code>, which all three
functions support. For example:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; subprocess.check_output('cat books/* | wc', shell=True, text=True)
' 1299377 17005208 101299376\n'
</pre></div>

<p>However, doing this raises security concerns. If you're doing anything more
than light scripting, you might be better off calling each process separately,
and passing the output from each as an input to the next, via</p>
<div class="code"><pre class="code literal-block">run(cmd, [stdout=etc...], input=other_output)
</pre></div>

<p>Or</p>
<div class="code"><pre class="code literal-block">Popen(cmd, [stdout=etc...]).communicate(other_output)
</pre></div>

<p>The temptation to directly connect pipes is strong; resist it. Otherwise,
you'll likely see deadlocks or have to do hacky things like this.</p>
<p><br></p>
<h3>Suggest</h3>
<p>This is way easier, but only works on Unix (including Cygwin) and Python2.7.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">commands</span>
<span class="nb">print</span> <span class="n">commands</span><span class="o">.</span><span class="n">getstatusoutput</span><span class="p">(</span><span class="s1">'wc -l file'</span><span class="p">)</span>
</pre></div>

<p>It returns a tuple with the (return_value, output).</p>
<p>For a solution that works in both Python2 and Python3, use the <code>subprocess</code>
module instead:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s2">"date"</span><span class="p">],</span><span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<span class="nb">print</span> <span class="n">response</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-find-the-location-of-my-python-site-packages-directory/" class="u-url">How do I find the location of my Python site-packages directory?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-find-the-location-of-my-python-site-packages-directory/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T03:17:24+08:00" itemprop="datePublished" title="2023-02-17 03:17">2023-02-17 03:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I find the location of my <code>site-packages</code> directory?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>There are two types of site-packages directories, <em>global</em> and <em>per user</em>.</p>
<ol>
<li>
<strong>Global</strong> site-packages ("dist-packages") directories are listed in <code>sys.path</code> when you run:<div class="code"><pre class="code literal-block"> python -m site
</pre></div>

</li>
</ol>
<p>For a more concise list run <code>getsitepackages</code> from the site module in Python
code:</p>
<div class="code"><pre class="code literal-block">     <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s1">'import site; print(site.getsitepackages())'</span>
</pre></div>

<p><em>Caution:</em> In virtual environments getsitepackages is not available with older
versions of <code>virtualenv</code>, <code>sys.path</code> from above will list the virtualenv's
site-packages directory correctly, though. In Python 3, you may use the
sysconfig module instead:</p>
<div class="code"><pre class="code literal-block">     <span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s1">'import sysconfig; print(sysconfig.get_paths()["purelib"])'</span>
</pre></div>

<ol>
<li>The <strong>per user</strong> site-packages directory (PEP 370) is where Python installs your local packages:<div class="code"><pre class="code literal-block"> python -m site --user-site
</pre></div>

</li>
</ol>
<p>If this points to a non-existing directory check the exit status of Python and
see <code>python -m site --help</code> for explanations.</p>
<p><em>Hint:</em> Running <code>pip list --user</code> or <code>pip freeze --user</code> gives you a list of
all installed <em>per user</em> site-packages.</p>
<hr>
<h3>Practical Tips</h3>
<ul>
<li>
<p><code>&lt;package&gt;.__path__</code> lets you identify the location(s) of a specific package: (details)</p>
<div class="code"><pre class="code literal-block">  <span class="err">$</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">"import setuptools as _; print(_.__path__)"</span>
</pre></div>

<p>['/usr/lib/python2.7/dist-packages/setuptools']</p>
</li>
<li>
<p><code>&lt;module&gt;.__file__</code> lets you identify the location of a specific module: (difference)</p>
<div class="code"><pre class="code literal-block">  <span class="err">$</span> <span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s2">"import os as _; print(_.__file__)"</span>
</pre></div>

<p>/usr/lib/python3.6/os.py</p>
</li>
<li>
<p>Run <code>pip show &lt;package&gt;</code> to show Debian-style package information:</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span>$<span class="w"> </span><span class="nv">pip</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="nv">pytest</span>
</pre></div>

<p>Name: pytest
  Version: 3.8.2
  Summary: pytest: simple powerful testing with Python
  Home-page: https://docs.pytest.org/en/latest/
  Author: Holger Krekel, Bruno Oliveira, Ronny Pfannschmidt, Floris Bruynooghe, Brianna Laugher, Florian Bruhin and others
  Author-email: None
  License: MIT license
  Location: /home/peter/.local/lib/python3.4/site-packages
  Requires: more-itertools, atomicwrites, setuptools, attrs, pathlib2, six, py, pluggy</p>
</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">site</span><span class="p">;</span> <span class="n">site</span><span class="o">.</span><span class="n">getsitepackages</span><span class="p">()</span>
<span class="p">[</span><span class="s1">'/usr/local/lib/python2.7/dist-packages'</span><span class="p">,</span> <span class="s1">'/usr/lib/python2.7/dist-packages'</span><span class="p">]</span>
</pre></div>

<p>(or just first item with <code>site.getsitepackages()[0]</code>)</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/utf-8-all-the-way-through/" class="u-url">UTF-8 all the way through</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/utf-8-all-the-way-through/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T03:16:58+08:00" itemprop="datePublished" title="2023-02-17 03:16">2023-02-17 03:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm setting up a new server and want to support UTF-8 fully in my web
application. I have tried this in the past on existing servers and always seem
to end up having to fall back to ISO-8859-1.</p>
<p>Where exactly do I need to set the encoding/charsets? I'm aware that I need to
configure Apache, MySQL, and PHP to do this — is there some standard checklist
I can follow, or perhaps troubleshoot where the mismatches occur?</p>
<p>This is for a new Linux server, running MySQL 5, PHP, 5 and Apache 2.</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>Data Storage</strong> :</p>
<ul>
<li>
<p>Specify the <code>utf8mb4</code> character set on all tables and text columns in your database. This makes MySQL physically store and retrieve values encoded natively in UTF-8. Note that MySQL will implicitly use <code>utf8mb4</code> encoding if a <code>utf8mb4_*</code> collation is specified (without any explicit character set).</p>
</li>
<li>
<p>In older versions of MySQL (&lt; 5.5.3), you'll unfortunately be forced to use simply <code>utf8</code>, which only supports a subset of Unicode characters. I wish I were kidding.</p>
</li>
</ul>
<p><strong>Data Access</strong> :</p>
<ul>
<li>
<p>In your application code (e.g. PHP), in whatever DB access method you use, you'll need to set the connection charset to <code>utf8mb4</code>. This way, MySQL does no conversion from its native UTF-8 when it hands data off to your application and vice versa.</p>
</li>
<li>
<p>Some drivers provide their own mechanism for configuring the connection character set, which both updates its own internal state and informs MySQL of the encoding to be used on the connection—this is usually the preferred approach. In PHP:</p>
<ul>
<li>
<p>If you're using the PDO abstraction layer with PHP ≥ 5.3.6, you can specify <code>charset</code> in the DSN:</p>
<div class="code"><pre class="code literal-block"><span class="w">     </span><span class="o">$</span><span class="nt">dbh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">PDO</span><span class="o">(</span><span class="s1">'mysql:charset=utf8mb4'</span><span class="o">);</span>
</pre></div>

</li>
<li>
<p>If you're using mysqli, you can call <code>set_charset()</code>:</p>
<div class="code"><pre class="code literal-block"><span class="w">      </span><span class="err">$</span><span class="n">mysqli</span><span class="o">-&gt;</span><span class="n">set_charset</span><span class="p">(</span><span class="s">'utf8mb4'</span><span class="p">);</span><span class="w">       </span><span class="c1">// object oriented style</span>
</pre></div>

<p>mysqli_set_charset($link, 'utf8mb4');  // procedural style</p>
</li>
<li>
<p>If you're stuck with plain mysql but happen to be running PHP ≥ 5.2.3, you can call <code>mysql_set_charset</code>.</p>
</li>
</ul>
</li>
<li>
<p>If the driver does not provide its own mechanism for setting the connection character set, you may have to issue a query to tell MySQL how your application expects data on the connection to be encoded: <code>SET NAMES 'utf8mb4'</code>.</p>
</li>
<li>
<p>The same consideration regarding <code>utf8mb4</code>/<code>utf8</code> applies as above.</p>
</li>
</ul>
<p><strong>Output</strong> :</p>
<ul>
<li>UTF-8 should be set in the HTTP header, such as <code>Content-Type: text/html; charset=utf-8</code>. You can achieve that either by setting <code>default_charset</code> in php.ini (preferred), or manually using <code>header()</code> function.</li>
<li>If your application transmits text to other systems, they will also need to be informed of the character encoding. With web applications, the browser must be informed of the encoding in which data is sent (through HTTP response headers or HTML metadata).</li>
<li>When encoding the output using <code>json_encode()</code>, add <code>JSON_UNESCAPED_UNICODE</code> as a second parameter.</li>
</ul>
<p><strong>Input</strong> :</p>
<ul>
<li>Browsers will submit data in the character set specified for the document, hence nothing particular has to be done on the input.</li>
<li>In case you have doubts about request encoding (in case it could be tampered with), you may verify every received string as being valid UTF-8 before you try to store it or use it anywhere. PHP's <code>mb_check_encoding()</code> does the trick, but you have to use it religiously. There's really no way around this, as malicious clients can submit data in whatever encoding they want, and I haven't found a trick to get PHP to do this for you reliably.</li>
</ul>
<p><strong>Other Code Considerations</strong> :</p>
<ul>
<li>
<p>Obviously enough, all files you'll be serving (PHP, HTML, JavaScript, etc.) should be encoded in valid UTF-8.</p>
</li>
<li>
<p>You need to make sure that every time you process a UTF-8 string, you do so safely. This is, unfortunately, the hard part. You'll probably want to make extensive use of PHP's <code>mbstring</code> extension.</p>
</li>
<li>
<p><strong>PHP's built-in string operations are <em>not</em> by default UTF-8 safe.</strong> There are some things you can safely do with normal PHP string operations (like concatenation), but for most things you should use the equivalent <code>mbstring</code> function.</p>
</li>
<li>
<p>To know what you're doing (read: not mess it up), you really need to know UTF-8 and how it works on the lowest possible level. Check out any of the links from utf8.com for some good resources to learn everything you need to know.</p>
</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>I'd like to add one thing to chazomaticus' excellent answer:</p>
<p>Don't forget the META tag either (like this, or the HTML4 or XHTML version of
it):</p>
<div class="code"><pre class="code literal-block">&lt;meta charset="utf-8"&gt;
</pre></div>

<p>That seems trivial, but IE7 has given me problems with that before.</p>
<p>I was doing everything right; the database, database connection and Content-
Type HTTP header were all set to UTF-8, and it worked fine in all other
browsers, but Internet Explorer still insisted on using the "Western European"
encoding.</p>
<p>It turned out the page was missing the META tag. Adding that solved the
problem.</p>
<p><strong>Edit:</strong></p>
<p>The W3C actually has a rather large section dedicated to I18N. They have a
number of articles related to this issue – describing the HTTP, (X)HTML and
CSS side of things:</p>
<ul>
<li>FAQ: Changing (X)HTML page encoding to UTF-8</li>
<li>Declaring character encodings in HTML</li>
<li>Tutorial: Character sets &amp; encodings in XHTML, HTML and CSS</li>
<li>Setting the HTTP charset parameter</li>
</ul>
<p>They recommend using both the HTTP header and HTML meta tag (or XML
declaration in case of XHTML served as XML).</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-298.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-296.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
