<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2372) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2372.html">
<link rel="prev" href="index-2373.html" type="text/html">
<link rel="next" href="index-2371.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-upsert-merge-insert-on-duplicate-update-in-postgresql/" class="u-url">How to UPSERT (MERGE, INSERT ... ON DUPLICATE UPDATE) in PostgreSQL?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-upsert-merge-insert-on-duplicate-update-in-postgresql/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T11:15:30+08:00" itemprop="datePublished" title="2023-03-04 11:15">2023-03-04 11:15</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>A very frequently asked question here is how to do an upsert, which is what
MySQL calls <code>INSERT ... ON DUPLICATE UPDATE</code> and the standard supports as part
of the <code>MERGE</code> operation.</p>
<p>Given that PostgreSQL doesn't support it directly (before pg 9.5), how do you
do this? Consider the following:</p>
<div class="code"><pre class="code literal-block">CREATE TABLE testtable (
    id integer PRIMARY KEY,
    somedata text NOT NULL
);

INSERT INTO testtable (id, somedata) VALUES
(1, 'fred'),
(2, 'bob');
</pre></div>

<p>Now imagine that you want to "upsert" the tuples <code>(2, 'Joe')</code>, <code>(3, 'Alan')</code>,
so the new table contents would be:</p>
<div class="code"><pre class="code literal-block">(1, 'fred'),
(2, 'Joe'),    -- Changed value of existing tuple
(3, 'Alan')    -- Added new tuple
</pre></div>

<p>That's what people are talking about when discussing an <code>upsert</code>. Crucially,
any approach must be <em>safe in the presence of multiple transactions working on
the same table</em> - either by using explicit locking, or otherwise defending
against the resulting race conditions.</p>
<p>This topic is discussed extensively at Insert, on duplicate update in
PostgreSQL?, but that's about alternatives to the MySQL syntax, and it's grown
a fair bit of unrelated detail over time. I'm working on definitive answers.</p>
<p>These techniques are also useful for "insert if not exists, otherwise do
nothing", i.e. "insert ... on duplicate key ignore".</p>
<p><br><br></p>
<h2>Answer</h2>
<h2>9.5 and newer:</h2>
<p>PostgreSQL 9.5 and newer support <code>INSERT ... ON CONFLICT (key) DO UPDATE</code> (and
<code>ON CONFLICT (key) DO NOTHING</code>), i.e. upsert.</p>
<p>Comparison with <code>ON DUPLICATE KEY UPDATE</code>.</p>
<p>Quick explanation.</p>
<p>For usage see the manual - specifically the <em>conflict_action</em> clause in the
syntax diagram, and the explanatory text.</p>
<p>Unlike the solutions for 9.4 and older that are given below, this feature
works with multiple conflicting rows and it doesn't require exclusive locking
or a retry loop.</p>
<p>The commit adding the feature is here and the discussion around its
development is here.</p>
<hr>
<p><em>If you're on 9.5 and don't need to be backward-compatible you can stop
reading now</em>.</p>
<hr>
<h2>9.4 and older:</h2>
<p>PostgreSQL doesn't have any built-in <code>UPSERT</code> (or <code>MERGE</code>) facility, and doing
it efficiently in the face of concurrent use is very difficult.</p>
<p>This article discusses the problem in useful detail.</p>
<p>In general you must choose between two options:</p>
<ul>
<li>Individual insert/update operations in a retry loop; or</li>
<li>Locking the table and doing batch merge</li>
</ul>
<h3>Individual row retry loop</h3>
<p>Using individual row upserts in a retry loop is the reasonable option if you
want many connections concurrently trying to perform inserts.</p>
<p>The PostgreSQL documentation contains a useful procedure that'll let you do
this in a loop inside the database. It guards against lost updates and insert
races, unlike most naive solutions. It will only work in <code>READ COMMITTED</code> mode
and is only safe if it's the only thing you do in the transaction, though. The
function won't work correctly if triggers or secondary unique keys cause
unique violations.</p>
<p>This strategy is very inefficient. Whenever practical you should queue up work
and do a bulk upsert as described below instead.</p>
<p>Many attempted solutions to this problem fail to consider rollbacks, so they
result in incomplete updates. Two transactions race with each other; one of
them successfully <code>INSERT</code>s; the other gets a duplicate key error and does an
<code>UPDATE</code> instead. The <code>UPDATE</code> blocks waiting for the <code>INSERT</code> to rollback or
commit. When it rolls back, the <code>UPDATE</code> condition re-check matches zero rows,
so even though the <code>UPDATE</code> commits it hasn't actually done the upsert you
expected. You have to check the result row counts and re-try where necessary.</p>
<p>Some attempted solutions also fail to consider SELECT races. If you try the
obvious and simple:</p>
<div class="code"><pre class="code literal-block"><span class="o">--</span> <span class="n">THIS</span> <span class="kr">IS</span> <span class="n">WRONG</span><span class="p">.</span> <span class="kr">DO</span> <span class="n">NOT</span> <span class="n">COPY</span> <span class="n">IT</span><span class="p">.</span> <span class="n">It</span><span class="err">'</span><span class="n">s</span> <span class="n">an</span> <span class="n">EXAMPLE</span><span class="p">.</span>

<span class="kr">BEGIN</span><span class="p">;</span>

<span class="n">UPDATE</span> <span class="n">testtable</span>
<span class="kt">SET</span> <span class="n">somedata</span> <span class="o">=</span> <span class="s">'blah'</span>
<span class="n">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="o">--</span> <span class="n">Remember</span><span class="p">,</span> <span class="n">this</span> <span class="n">is</span> <span class="n">WRONG</span><span class="p">.</span> <span class="n">Do</span> <span class="n">NOT</span> <span class="n">COPY</span> <span class="n">IT</span><span class="p">.</span>

<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">testtable</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">somedata</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'blah'</span>
<span class="n">WHERE</span> <span class="n">NOT</span> <span class="n">EXISTS</span> <span class="p">(</span><span class="n">SELECT</span> <span class="mi">1</span> <span class="n">FROM</span> <span class="n">testtable</span> <span class="n">WHERE</span> <span class="n">testtable</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">);</span>

<span class="n">COMMIT</span><span class="p">;</span>
</pre></div>

<p>then when two run at once there are several failure modes. One is the already
discussed issue with an update re-check. Another is where both <code>UPDATE</code> at the
same time, matching zero rows and continuing. Then they both do the <code>EXISTS</code>
test, which happens <em>before</em> the <code>INSERT</code>. Both get zero rows, so both do the
<code>INSERT</code>. One fails with a duplicate key error.</p>
<p>This is why you need a re-try loop. You might think that you can prevent
duplicate key errors or lost updates with clever SQL, but you can't. You need
to check row counts or handle duplicate key errors (depending on the chosen
approach) and re-try.</p>
<p>Please don't roll your own solution for this. Like with message queuing, it's
probably wrong.</p>
<h3>Bulk upsert with lock</h3>
<p>Sometimes you want to do a bulk upsert, where you have a new data set that you
want to merge into an older existing data set. This is <em>vastly</em> more efficient
than individual row upserts and should be preferred whenever practical.</p>
<p>In this case, you typically follow the following process:</p>
<ul>
<li>
<p><code>CREATE</code> a <code>TEMPORARY</code> table</p>
</li>
<li>
<p><code>COPY</code> or bulk-insert the new data into the temp table</p>
</li>
<li>
<p><code>LOCK</code> the target table <code>IN EXCLUSIVE MODE</code>. This permits other transactions to <code>SELECT</code>, but not make any changes to the table.</p>
</li>
<li>
<p>Do an <code>UPDATE ... FROM</code> of existing records using the values in the temp table;</p>
</li>
<li>
<p>Do an <code>INSERT</code> of rows that don't already exist in the target table;</p>
</li>
<li>
<p><code>COMMIT</code>, releasing the lock.</p>
</li>
</ul>
<p>For example, for the example given in the question, using multi-valued
<code>INSERT</code> to populate the temp table:</p>
<div class="code"><pre class="code literal-block"><span class="kr">BEGIN</span><span class="p">;</span>

<span class="n">CREATE</span> <span class="n">TEMPORARY</span> <span class="n">TABLE</span> <span class="n">newvals</span><span class="p">(</span><span class="n">id</span> <span class="n">integer</span><span class="p">,</span> <span class="n">somedata</span> <span class="n">text</span><span class="p">);</span>

<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">newvals</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">somedata</span><span class="p">)</span> <span class="n">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">'Joe'</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s">'Alan'</span><span class="p">);</span>

<span class="n">LOCK</span> <span class="n">TABLE</span> <span class="n">testtable</span> <span class="kr">IN</span> <span class="n">EXCLUSIVE</span> <span class="n">MODE</span><span class="p">;</span>

<span class="n">UPDATE</span> <span class="n">testtable</span>
<span class="kt">SET</span> <span class="n">somedata</span> <span class="o">=</span> <span class="n">newvals</span><span class="p">.</span><span class="n">somedata</span>
<span class="n">FROM</span> <span class="n">newvals</span>
<span class="n">WHERE</span> <span class="n">newvals</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">testtable</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>

<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">testtable</span>
<span class="n">SELECT</span> <span class="n">newvals</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">newvals</span><span class="p">.</span><span class="n">somedata</span>
<span class="n">FROM</span> <span class="n">newvals</span>
<span class="n">LEFT</span> <span class="n">OUTER</span> <span class="n">JOIN</span> <span class="n">testtable</span> <span class="n">ON</span> <span class="p">(</span><span class="n">testtable</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">newvals</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">WHERE</span> <span class="n">testtable</span><span class="p">.</span><span class="n">id</span> <span class="kr">IS</span> <span class="n">NULL</span><span class="p">;</span>

<span class="n">COMMIT</span><span class="p">;</span>
</pre></div>

<h2>Related reading</h2>
<ul>
<li>UPSERT wiki page</li>
<li>UPSERTisms in Postgres</li>
<li>Insert, on duplicate update in PostgreSQL?</li>
<li>http://petereisentraut.blogspot.com/2010/05/merge-syntax.html</li>
<li>Upsert with a transaction</li>
<li>Is SELECT or INSERT in a function prone to race conditions?</li>
<li>SQL <code>MERGE</code> on the PostgreSQL wiki</li>
<li>Most idiomatic way to implement UPSERT in Postgresql nowadays</li>
</ul>
<h2>What about <code>MERGE</code>?</h2>
<p>SQL-standard <code>MERGE</code> actually has poorly defined concurrency semantics and is
not suitable for upserting without locking a table first.</p>
<p>It's a really useful OLAP statement for data merging, but it's not actually a
useful solution for concurrency-safe upsert. There's lots of advice to people
using other DBMSes to use <code>MERGE</code> for upserts, but it's actually wrong.</p>
<h2>Other DBs:</h2>
<ul>
<li>
<code>INSERT ... ON DUPLICATE KEY UPDATE</code> in MySQL</li>
<li>
<code>MERGE</code> from MS SQL Server (but see above about <code>MERGE</code> problems)</li>
<li>
<code>MERGE</code> from Oracle (but see above about <code>MERGE</code> problems)</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>Here are some examples for <code>insert ... on conflict ...</code> ( <em>pg 9.5+</em> ) :</p>
<ul>
<li>
<p>Insert, on conflict - <strong>do nothing</strong>. </p>
<div class="code"><pre class="code literal-block">insert into dummy(id, name, size) values(1, 'new_name', 3)
</pre></div>

<p>on conflict do nothing;`  </p>
</li>
<li>
<p>Insert, on conflict - <strong>do update</strong> , specify conflict target via <strong>column</strong>. </p>
<div class="code"><pre class="code literal-block">insert into dummy(id, name, size) values(1, 'new_name', 3)
</pre></div>

<p>on conflict(id)
do update set name = 'new_name', size = 3;  </p>
</li>
<li>
<p>Insert, on conflict - <strong>do update</strong> , specify conflict target via <strong>constraint name</strong>. </p>
<div class="code"><pre class="code literal-block">insert into dummy(id, name, size) values(1, 'new_name', 3)
</pre></div>

<p>on conflict on constraint dummy_pkey
do update set name = 'new_name', size = 4;</p>
</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-border-radius-property-and-border-collapse-collapse-don-t-mix-how-can-i-use-border-radius-to-create-a-collapsed-table-with-rounded-corners/" class="u-url">The border-radius property and border-collapse:collapse don't mix. How can I use border-radius to create a collapsed table with rounded corners?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/the-border-radius-property-and-border-collapse-collapse-don-t-mix-how-can-i-use-border-radius-to-create-a-collapsed-table-with-rounded-corners/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T11:14:18+08:00" itemprop="datePublished" title="2023-03-04 11:14">2023-03-04 11:14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am trying to make a table with rounded corners using the CSS <code>border-radius</code>
property. The table styles I'm using look something like this:</p>
<div class="code"><pre class="code literal-block"><span class="nt">table</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kp">-moz-</span><span class="k">border-radius</span><span class="p">:</span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">    </span><span class="kp">-webkit-</span><span class="k">border-radius</span><span class="p">:</span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
<span class="w">    </span><span class="k">border-radius</span><span class="p">:</span><span class="mi">10</span><span class="kt">px</span>
<span class="p">}</span>
</pre></div>

<p>Here's the problem. I also want to set the <code>border-collapse:collapse</code>
property, and when that is set <code>border-radius</code> no longer works. Is there a
CSS-based way I can get the same effect as <code>border-collapse:collapse</code> without
actually using it?</p>
<p>It seems that a large part of the problem is that setting the table to have
rounded corners does not affect the corners of the corner <code>td</code> elements. If
the table was all one color, this wouldn't be a problem since I could just
make the top and bottom <code>td</code> corners rounded for the first and last row
respectively. However, I am using different background colors for the table to
differentiate the headings and for striping, so the inner <code>td</code> elements would
show their rounded corners as well.</p>
<p>Surrounding the table with another element with round corners doesn't work
because the table's square corners "bleed through."</p>
<p>Specifying border width to 0 doesn't collapse the table.</p>
<p>Bottom <code>td</code> corners still square after setting cellspacing to zero.</p>
<p>The tables are generated in PHP, so I could just apply a different class to
each of the outer th/tds and style each corner separately. I'd rather not do
this, since it's not very elegant and a bit of a pain to apply to multiple
tables, so please keep suggestions coming.</p>
<p>I'd like to do this without JavaScript.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I figured it out. You just have to use some special selectors.</p>
<p>The problem with rounding the corners of the table was that the <code>td</code> elements
didn't also become rounded. You can solve that by doing something like this:</p>
<div class="code"><pre class="code literal-block">table<span class="w"> </span>tr:last-child<span class="w"> </span>td:first-child<span class="w"> </span>{
<span class="w">    </span>border:<span class="w"> </span>2px<span class="w"> </span>solid<span class="w"> </span>orange;
<span class="w">    </span>border-bottom-left-radius:<span class="w"> </span>10px;
}

table<span class="w"> </span>tr:last-child<span class="w"> </span>td:last-child<span class="w"> </span>{
<span class="w">    </span>border:<span class="w"> </span>2px<span class="w"> </span>solid<span class="w"> </span>green;
<span class="w">    </span>border-bottom-right-radius:<span class="w"> </span>10px;
}


<span class="nt">&lt;table&gt;</span>
<span class="w">  </span><span class="nt">&lt;tbody&gt;</span>
<span class="w">    </span><span class="nt">&lt;tr&gt;</span>
<span class="w">      </span><span class="nt">&lt;td&gt;</span>1<span class="nt">&lt;/td&gt;</span>
<span class="w">      </span><span class="nt">&lt;td&gt;</span>2<span class="nt">&lt;/td&gt;</span>
<span class="w">    </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">    </span><span class="nt">&lt;tr&gt;</span>
<span class="w">      </span><span class="nt">&lt;td&gt;</span>3<span class="nt">&lt;/td&gt;</span>
<span class="w">      </span><span class="nt">&lt;td&gt;</span>4<span class="nt">&lt;/td&gt;</span>
<span class="w">    </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">  </span><span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></div>

<p>Now everything rounds properly, except that there's still the issue of
<code>border-collapse: collapse</code> breaking everything.</p>
<p>A workaround is to add <code>border-spacing: 0</code> and leave the default <code>border-
collapse: separate</code> on the table.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The following method works (tested in Chrome) by using a <code>box-shadow</code> with a
spread of <code>1px</code> instead of a "real" border.</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span>table<span class="w"> </span>{
<span class="w">        </span>border-collapse:<span class="w"> </span>collapse;
<span class="w">        </span>border-radius:<span class="w"> </span>30px;
<span class="w">        </span>border-style:<span class="w"> </span>hidden;<span class="w"> </span>/*<span class="w"> </span>hide<span class="w"> </span>standard<span class="w"> </span>table<span class="w"> </span>(collapsed)<span class="w"> </span>border<span class="w"> </span>*/
<span class="w">        </span>box-shadow:<span class="w"> </span>0<span class="w"> </span>0<span class="w"> </span>0<span class="w"> </span>1px<span class="w"> </span>#666;<span class="w"> </span>/*<span class="w"> </span>this<span class="w"> </span>draws<span class="w"> </span>the<span class="w"> </span>table<span class="w"> </span>border<span class="w">  </span>*/<span class="w"> </span>
<span class="w">    </span>}

<span class="w">    </span>td<span class="w"> </span>{
<span class="w">        </span>border:<span class="w"> </span>1px<span class="w"> </span>solid<span class="w"> </span>#ccc;
<span class="w">    </span>}


<span class="nt">&lt;table&gt;</span>
<span class="w">  </span><span class="nt">&lt;thead&gt;</span>
<span class="w">    </span><span class="nt">&lt;tr&gt;</span>
<span class="w">      </span><span class="nt">&lt;th&gt;</span>Foo<span class="nt">&lt;/th&gt;</span>
<span class="w">      </span><span class="nt">&lt;th&gt;</span>Bar<span class="nt">&lt;/th&gt;</span>
<span class="w">    </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">  </span><span class="nt">&lt;/thead&gt;</span>
<span class="w">  </span><span class="nt">&lt;tbody&gt;</span>
<span class="w">    </span><span class="nt">&lt;tr&gt;</span>
<span class="w">      </span><span class="nt">&lt;td&gt;</span>Baz<span class="nt">&lt;/td&gt;</span>
<span class="w">      </span><span class="nt">&lt;td&gt;</span>Qux<span class="nt">&lt;/td&gt;</span>
<span class="w">    </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">    </span><span class="nt">&lt;tr&gt;</span>
<span class="w">      </span><span class="nt">&lt;td&gt;</span>Life<span class="w"> </span>is<span class="w"> </span>short<span class="nt">&lt;/td&gt;</span>
<span class="w">      </span><span class="nt">&lt;td</span><span class="w"> </span><span class="na">rowspan=</span><span class="s">"3"</span><span class="nt">&gt;</span>and<span class="nt">&lt;/td&gt;</span>
<span class="w">    </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">    </span><span class="nt">&lt;tr&gt;</span>
<span class="w">      </span><span class="nt">&lt;td&gt;</span>Love<span class="nt">&lt;/td&gt;</span>
<span class="w">    </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">    </span><span class="nt">&lt;tr&gt;</span>
<span class="w">      </span><span class="nt">&lt;td&gt;</span>is<span class="w"> </span>always<span class="w"> </span>over<span class="nt">&lt;/td&gt;</span>
<span class="w">    </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">    </span><span class="nt">&lt;tr&gt;</span>
<span class="w">      </span><span class="nt">&lt;td&gt;</span>In<span class="w"> </span>the<span class="nt">&lt;/td&gt;</span>
<span class="w">      </span><span class="nt">&lt;td&gt;</span>Morning<span class="nt">&lt;/td&gt;</span>
<span class="w">    </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">  </span><span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-are-maven-goals-and-phases-and-what-is-their-difference/" class="u-url">What are Maven goals and phases and what is their difference?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-are-maven-goals-and-phases-and-what-is-their-difference/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T11:12:50+08:00" itemprop="datePublished" title="2023-03-04 11:12">2023-03-04 11:12</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What is the difference/relation between Maven goals and phases? How they are
related to each other?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Goals are executed in phases which help determine the order goals get executed
in. The best understanding of this is to look at the default Maven lifecycle
bindings which shows which goals get run in which phases by default. The
<code>compile</code> phase goals will always be executed before the <code>test</code> phase goals,
which will always be executed before the <code>package</code> phase goals and so on.</p>
<p>Part of the confusion is exacerbated by the fact that when you execute Maven
you can specify a goal or a phase. If you specify a phase then Maven will run
all phases up to the phase you specified in order (e.g. if you specify package
it will first run through the compile phase and then the test phase and
finally the package phase) and for each phase it will run all goals attached
to that phase.</p>
<p>When you create a plugin execution in your Maven build file and you only
specify the goal then it will bind that goal to a given default phase. For
example, the <code>jaxb:xjc</code> goal binds by default to the <code>generate-resources</code>
phase. However, when you specify the execution you can also explicitly specify
the phase for that goal as well.</p>
<p>If you specify a goal when you execute Maven then it will run that goal and
only that goal. In other words, if you specify the <code>jar:jar</code> goal it will only
run the <code>jar:jar</code> goal to package your code into a jar. If you have not
previously run the compile goal or prepared your compiled code in some other
way this may very likely fail.</p>
<p><br></p>
<h3>Suggest</h3>
<blockquote>
<p>Life cycle is a sequence of named <strong>phases</strong>.<br>
 Phases executes sequentially. Executing a phase means executes all previous
phases.</p>
<p>Plugin is a collection of <strong>goals</strong> (i.e. tasks) which also called MOJO (
<strong>M</strong> aven <strong>O</strong> ld <strong>J</strong> ava <strong>O</strong> bject).</p>
</blockquote>
<p>Maven is based around the central concept of a <strong>Build Life Cycles</strong>. Inside
each <em>Build Life Cycles</em> there are <strong>Build Phases</strong> , and inside each <em>Build
Phases</em> there are <strong>Build Goals</strong>.</p>
<p>We can execute either a build phase or build goal. When executing a build
phase we execute all build goals within that build phase. Build goals are
assigned to one or more build phases. We can also execute a build goal
directly.</p>
<p>There are three major built-in <strong>Build Life Cycles</strong> :</p>
<ol>
<li>default</li>
<li>clean</li>
<li>site</li>
</ol>
<p><strong>Each Build Lifecycle is Made Up of Phases</strong></p>
<p>For example the <code>default</code> lifecycle comprises of the following <strong>Build
Phases</strong> :</p>
<div class="code"><pre class="code literal-block">◾<span class="nv">validate</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">validate</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">project</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">correct</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">necessary</span><span class="w"> </span><span class="nv">information</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">available</span>
◾<span class="nv">compile</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">compile</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">project</span>
◾<span class="nv">test</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">test</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">compiled</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="nv">using</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">suitable</span><span class="w"> </span><span class="nv">unit</span><span class="w"> </span><span class="nv">testing</span><span class="w"> </span><span class="nv">framework</span>.<span class="w"> </span><span class="nv">These</span><span class="w"> </span><span class="nv">tests</span><span class="w"> </span><span class="nv">should</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">require</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">packaged</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">deployed</span>
◾<span class="nv">package</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">take</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">compiled</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">package</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">its</span><span class="w"> </span><span class="nv">distributable</span><span class="w"> </span><span class="nv">format</span>,<span class="w"> </span><span class="nv">such</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">JAR</span>.
◾<span class="nv">integration</span><span class="o">-</span><span class="nv">test</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">process</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">deploy</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">package</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">necessary</span><span class="w"> </span><span class="nv">into</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">environment</span><span class="w"> </span><span class="nv">where</span><span class="w"> </span><span class="nv">integration</span><span class="w"> </span><span class="nv">tests</span><span class="w"> </span><span class="nv">can</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">run</span>
◾<span class="nv">verify</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">any</span><span class="w"> </span><span class="nv">checks</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">verify</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">package</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">valid</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">meets</span><span class="w"> </span><span class="nv">quality</span><span class="w"> </span><span class="nv">criteria</span>
◾<span class="nv">install</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">install</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">package</span><span class="w"> </span><span class="nv">into</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">local</span><span class="w"> </span><span class="nv">repository</span>,<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">dependency</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">other</span><span class="w"> </span><span class="nv">projects</span><span class="w"> </span><span class="nv">locally</span>
◾<span class="nv">deploy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">done</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">integration</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">release</span><span class="w"> </span><span class="nv">environment</span>,<span class="w"> </span><span class="nv">copies</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">final</span><span class="w"> </span><span class="nv">package</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">remote</span><span class="w"> </span><span class="nv">repository</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">sharing</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">other</span><span class="w"> </span><span class="nv">developers</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">projects</span>.
</pre></div>

<p>So to go through the above phases, we just have to call one command:</p>
<div class="code"><pre class="code literal-block">mvn &lt;phase&gt; { Ex: mvn install }
</pre></div>

<p>For the above command, starting from the first phase, all the phases are
executed sequentially till the ‘install’ phase. <code>mvn</code> can either execute a
goal or a phase (or even multiple goals or multiple phases) as follows:</p>
<div class="code"><pre class="code literal-block">mvn clean install plugin:goal
</pre></div>

<p>However, if you want to customize the prefix used to reference your plugin,
you can specify the prefix directly through a configuration parameter on the
<code>maven-plugin-plugin</code> in your plugin's POM.</p>
<p><strong>A Build Phase is Made Up of Plugin Goals</strong></p>
<p>Most of Maven's functionality is in plugins. A plugin provides a set of
<strong>goals</strong> that can be executed using the following syntax:</p>
<div class="code"><pre class="code literal-block"> mvn [plugin-name]:[goal-name]
</pre></div>

<p>For example, a Java project can be compiled with the compiler-plugin's
compile-goal by running <code>mvn compiler:compile</code>.</p>
<p>Build lifecycle is a list of named phases that can be used to give order to
goal execution.</p>
<p><strong>Goals provided by plugins can be associated with different phases of the
lifecycle.</strong> For example, by default, the <em>goal</em> <code>compiler:compile</code> is
associated with the <code>compile</code> <em>phase</em> , while the <em>goal</em> <code>surefire:test</code> is
associated with the <code>test</code> <em>phase</em>. Consider the following command:</p>
<div class="code"><pre class="code literal-block">mvn test
</pre></div>

<p>When the preceding command is executed, Maven runs all goals associated with
each of the phases up to and including the <code>test</code> phase. In such a case, Maven
runs the <code>resources:resources</code> goal associated with the <code>process-resources</code>
phase, then <code>compiler:compile</code>, and so on until it finally runs the
<code>surefire:test</code> goal.</p>
<p>However, even though a build phase is responsible for a specific step in the
build lifecycle, the manner in which it carries out those responsibilities may
vary. And this is done by declaring the plugin goals bound to those build
phases.</p>
<p>A plugin goal represents a specific task (finer than a build phase) which
contributes to the building and managing of a project. It may be bound to zero
or more build phases. A goal not bound to any build phase could be executed
outside of the build lifecycle by direct invocation. The order of execution
depends on the order in which the goal(s) and the build phase(s) are invoked.
For example, consider the command below. The <code>clean</code> and <code>package</code> arguments
are build phases, while the <code>dependency:copy-dependencies</code> is a goal (of a
plugin).</p>
<div class="code"><pre class="code literal-block">mvn clean dependency:copy-dependencies package
</pre></div>

<p>If this were to be executed, the <code>clean</code> phase will be executed first (meaning
it will run all preceding phases of the clean lifecycle, plus the <code>clean</code>
phase itself), and then the <code>dependency:copy-dependencies</code> goal, before
finally executing the <code>package</code> phase (and all its preceding build phases of
the default lifecycle).</p>
<p>Moreover, if a goal is bound to one or more build phases, that goal will be
called in all those phases.</p>
<p>Furthermore, a build phase can also have zero or more goals bound to it. If a
build phase has no goals bound to it, that build phase will not execute. But
if it has one or more goals bound to it, it will execute all those goals.</p>
<p><strong>Built-in Lifecycle Bindings</strong><br>
Some phases have goals bound to them by default. And for the default
lifecycle, these bindings depend on the packaging value.</p>
<p>Maven Architecture:</p>
<p><img alt="enter image description here" src="images/wZpms.png"></p>
<p>Reference 1<br>
Reference 2</p>
<p>Eclipse sample for Maven Lifecycle Mapping</p>
<p><img alt="Eclipse sample for Maven Lifecycle Mapping" src="images/F9QMr.png"></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2373.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2371.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
