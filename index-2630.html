<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2630) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2630.html">
<link rel="prev" href="index-2631.html" type="text/html">
<link rel="next" href="index-2629.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-send-email-attachments/" class="u-url">How to send email attachments?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-send-email-attachments/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T06:11:30+08:00" itemprop="datePublished" title="2023-03-05 06:11">2023-03-05 06:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am having problems understanding how to email an attachment using Python. I
have successfully emailed simple messages with the <code>smtplib</code>. Could someone
please explain how to send an attachment in an email. I know there are other
posts online but as a Python beginner I find them hard to understand.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Here's another:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">smtplib</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">basename</span>
<span class="kn">from</span> <span class="nn">email.mime.application</span> <span class="kn">import</span> <span class="n">MIMEApplication</span>
<span class="kn">from</span> <span class="nn">email.mime.multipart</span> <span class="kn">import</span> <span class="n">MIMEMultipart</span>
<span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
<span class="kn">from</span> <span class="nn">email.utils</span> <span class="kn">import</span> <span class="n">COMMASPACE</span><span class="p">,</span> <span class="n">formatdate</span>


<span class="k">def</span> <span class="nf">send_mail</span><span class="p">(</span><span class="n">send_from</span><span class="p">,</span> <span class="n">send_to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">server</span><span class="o">=</span><span class="s2">"127.0.0.1"</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">send_to</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">'From'</span><span class="p">]</span> <span class="o">=</span> <span class="n">send_from</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">'To'</span><span class="p">]</span> <span class="o">=</span> <span class="n">COMMASPACE</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">send_to</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatdate</span><span class="p">(</span><span class="n">localtime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">'Subject'</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>

    <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="ow">or</span> <span class="p">[]:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fil</span><span class="p">:</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEApplication</span><span class="p">(</span>
                <span class="n">fil</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
                <span class="n">Name</span><span class="o">=</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="c1"># After the file is closed</span>
        <span class="n">part</span><span class="p">[</span><span class="s1">'Content-Disposition'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'attachment; filename="</span><span class="si">%s</span><span class="s1">"'</span> <span class="o">%</span> <span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>


    <span class="n">smtp</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
    <span class="n">smtp</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">send_from</span><span class="p">,</span> <span class="n">send_to</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
    <span class="n">smtp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

<p>It's much the same as the first example... But it should be easier to drop in.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Here is the modified version from <code>Oli</code> for python 3</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">smtplib</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">email.mime.multipart</span> <span class="kn">import</span> <span class="n">MIMEMultipart</span>
<span class="kn">from</span> <span class="nn">email.mime.base</span> <span class="kn">import</span> <span class="n">MIMEBase</span>
<span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
<span class="kn">from</span> <span class="nn">email.utils</span> <span class="kn">import</span> <span class="n">COMMASPACE</span><span class="p">,</span> <span class="n">formatdate</span>
<span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">encoders</span>


<span class="k">def</span> <span class="nf">send_mail</span><span class="p">(</span><span class="n">send_from</span><span class="p">,</span> <span class="n">send_to</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="p">[],</span>
              <span class="n">server</span><span class="o">=</span><span class="s2">"localhost"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">587</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span>
              <span class="n">use_tls</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Compose and send email with provided info and attachments.</span>

<span class="sd">    Args:</span>
<span class="sd">        send_from (str): from name</span>
<span class="sd">        send_to (list[str]): to name(s)</span>
<span class="sd">        subject (str): message title</span>
<span class="sd">        message (str): message body</span>
<span class="sd">        files (list[str]): list of file paths to be attached to email</span>
<span class="sd">        server (str): mail server host name</span>
<span class="sd">        port (int): port number</span>
<span class="sd">        username (str): server auth username</span>
<span class="sd">        password (str): server auth password</span>
<span class="sd">        use_tls (bool): use TLS mode</span>
<span class="sd">    """</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">'From'</span><span class="p">]</span> <span class="o">=</span> <span class="n">send_from</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">'To'</span><span class="p">]</span> <span class="o">=</span> <span class="n">COMMASPACE</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">send_to</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">'Date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatdate</span><span class="p">(</span><span class="n">localtime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">'Subject'</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>

    <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="s1">'application'</span><span class="p">,</span> <span class="s2">"octet-stream"</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">part</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">encoders</span><span class="o">.</span><span class="n">encode_base64</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
        <span class="n">part</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s1">'Content-Disposition'</span><span class="p">,</span>
                        <span class="s1">'attachment; filename=</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>

    <span class="n">smtp</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_tls</span><span class="p">:</span>
        <span class="n">smtp</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
    <span class="n">smtp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="n">smtp</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">send_from</span><span class="p">,</span> <span class="n">send_to</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
    <span class="n">smtp</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-rethrow-innerexception-without-losing-stack-trace-in-c/" class="u-url">How to rethrow InnerException without losing stack trace in C#?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-rethrow-innerexception-without-losing-stack-trace-in-c/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T06:10:31+08:00" itemprop="datePublished" title="2023-03-05 06:10">2023-03-05 06:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am calling, through reflection, a method which may cause an exception. How
can I pass the exception to my caller without the wrapper reflection puts
around it?<br>
I am rethrowing the InnerException, but this destroys the stack trace.<br>
Example code:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">test1</span><span class="ss">()</span>
{
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">Throw</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">exception</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">testing</span><span class="w"> </span><span class="nv">purposes</span>
<span class="w">    </span><span class="nv">throw</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ArgumentException</span><span class="ss">(</span><span class="s2">"test1"</span><span class="ss">)</span><span class="c1">;</span>
}

<span class="nv">void</span><span class="w"> </span><span class="nv">test2</span><span class="ss">()</span>
{
<span class="w">    </span><span class="nv">try</span>
<span class="w">    </span>{
<span class="w">        </span><span class="nv">MethodInfo</span><span class="w"> </span><span class="nv">mi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">typeof</span><span class="ss">(</span><span class="nv">Program</span><span class="ss">)</span>.<span class="nv">GetMethod</span><span class="ss">(</span><span class="s2">"test1"</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span><span class="nv">mi</span>.<span class="nv">Invoke</span><span class="ss">(</span><span class="nv">this</span>,<span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}
<span class="w">    </span><span class="nv">catch</span><span class="w"> </span><span class="ss">(</span><span class="nv">TargetInvocationException</span><span class="w"> </span><span class="nv">tiex</span><span class="ss">)</span>
<span class="w">    </span>{
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="nv">Throw</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">exception</span>
<span class="w">        </span><span class="nv">throw</span><span class="w"> </span><span class="nv">tiex</span>.<span class="nv">InnerException</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>In <strong>.NET 4.5</strong> there is now the <code>ExceptionDispatchInfo</code> class.</p>
<p>This lets you capture an exception and re-throw it without changing the stack-
trace:</p>
<div class="code"><pre class="code literal-block"><span class="n">using</span><span class="w"> </span><span class="n">ExceptionDispatchInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">ExceptionServices</span><span class="p">.</span><span class="n">ExceptionDispatchInfo</span><span class="p">;</span>

<span class="n">try</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">task</span><span class="p">.</span><span class="n">Wait</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">catch</span><span class="p">(</span><span class="n">AggregateException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">ExceptionDispatchInfo</span><span class="p">.</span><span class="n">Capture</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">InnerException</span><span class="p">).</span><span class="n">Throw</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>This works on any exception, not just <code>AggregateException</code>.</p>
<p>It was introduced due to the <code>await</code> C# language feature, which unwraps the
inner exceptions from <code>AggregateException</code> instances in order to make the
asynchronous language features more like the synchronous language features.</p>
<p><br></p>
<h3>Suggest</h3>
<p>It <strong>is</strong> possible to preserve the stack trace before rethrowing without
reflection:</p>
<div class="code"><pre class="code literal-block"><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">PreserveStackTrace</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">StreamingContext</span><span class="w">  </span><span class="p">(</span><span class="n">StreamingContextStates</span><span class="o">.</span><span class="n">CrossAppDomain</span><span class="p">)</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">mgr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ObjectManager</span><span class="w">     </span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">;</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">si</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SerializationInfo</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">GetType</span><span class="w"> </span><span class="p">(),</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">FormatterConverter</span><span class="w"> </span><span class="p">())</span><span class="w"> </span><span class="p">;</span>

<span class="w">    </span><span class="n">e</span><span class="o">.</span><span class="n">GetObjectData</span><span class="w">    </span><span class="p">(</span><span class="n">si</span><span class="p">,</span><span class="w"> </span><span class="n">ctx</span><span class="p">)</span><span class="w">  </span><span class="p">;</span>
<span class="w">    </span><span class="n">mgr</span><span class="o">.</span><span class="n">RegisterObject</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">si</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">prepare</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SetObjectData</span>
<span class="w">    </span><span class="n">mgr</span><span class="o">.</span><span class="n">DoFixups</span><span class="w">       </span><span class="p">()</span><span class="w">         </span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">ObjectManager</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">SetObjectData</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">voila</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">unmodified</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">_remoteStackTraceString</span>
<span class="p">}</span>
</pre></div>

<p>This wastes a lot of cycles compared to calling <code>InternalPreserveStackTrace</code>
via cached delegate, but has the advantage of relying only on public
functionality. Here are a couple of common usage patterns for stack-trace
preserving functions:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// usage (A): cross-thread invoke, messaging, custom task schedulers etc.</span>
<span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PreserveStackTrace</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">;</span>

<span class="w">    </span><span class="c1">// store exception to be re-thrown later,</span>
<span class="w">    </span><span class="c1">// possibly in a different thread</span>
<span class="w">    </span><span class="n">operationResult</span><span class="p">.</span><span class="n">Exception</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// usage (B): after calling MethodInfo.Invoke() and the like</span>
<span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">TargetInvocationException</span><span class="w"> </span><span class="n">tiex</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">PreserveStackTrace</span><span class="w"> </span><span class="p">(</span><span class="n">tiex</span><span class="p">.</span><span class="n">InnerException</span><span class="p">)</span><span class="w"> </span><span class="p">;</span>

<span class="w">    </span><span class="c1">// unwrap TargetInvocationException, so that typed catch clauses </span>
<span class="w">    </span><span class="c1">// in library/3rd-party code can work correctly;</span>
<span class="w">    </span><span class="c1">// new stack trace is appended to existing one</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="n">tiex</span><span class="p">.</span><span class="n">InnerException</span><span class="w"> </span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/reset-entity-framework-migrations/" class="u-url">Reset Entity-Framework Migrations</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/reset-entity-framework-migrations/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T06:09:43+08:00" itemprop="datePublished" title="2023-03-05 06:09">2023-03-05 06:09</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've mucked up my migrations, I used <code>IgnoreChanges</code> on the initial migration,
but now I want to delete all my migrations and start with an initial migration
with all of the logic.</p>
<p>When I delete the migrations in the folder and try and <code>Add-Migration</code> it
doesn't generate a full file (it's empty - because I haven't made any changes
since my last, but now deleted, migration).</p>
<p>Is there any <em>Disable-Migrations</em> command, so I can rerun <code>Enable-Migrations</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You need to :</p>
<ol>
<li>Delete the state: Delete the migrations folder in your project; And</li>
<li>Delete the <code>__MigrationHistory</code> table in your database (may be under system tables); Then</li>
<li>Run the following command in the Package Manager Console:<div class="code"><pre class="code literal-block">Enable-Migrations -EnableAutomaticMigrations -Force
</pre></div>

</li>
</ol>
<p>Use with or without <code>-EnableAutomaticMigrations</code></p>
<ol>
<li>And finally, you can run:<div class="code"><pre class="code literal-block">Add-Migration Initial
</pre></div>

</li>
</ol>
<p><br></p>
<h3>Suggest</h3>
<p>The Issue: You have mucked up your migrations and you would like to reset it
without deleting your existing tables.</p>
<p>The Problem: You can't reset migrations with existing tables in the database
as EF wants to create the tables from scratch.</p>
<p>What to do:</p>
<ol>
<li>
<p>Delete existing migrations from Migrations_History table.</p>
</li>
<li>
<p>Delete existing migrations from the Migrations Folder.</p>
</li>
<li>
<p>Run add-migration Reset. This will create a migration in your Migration folder that includes creating the tables (but it will not run it so it will not error out.) </p>
</li>
<li>
<p>You now need to create the initial row in the MigrationHistory table so EF has a snapshot of the current state. EF will do this if you apply a migration. However, you can't apply the migration that you just made as the tables already exist in your database. So go into the Migration and comment out all the code inside the "Up" method.</p>
</li>
<li>
<p>Now run update-database. It will apply the Migration (while not actually changing the database) and create a snapshot row in MigrationHistory.</p>
</li>
</ol>
<p>You have now reset your migrations and may continue with normal migrations.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2631.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2629.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
