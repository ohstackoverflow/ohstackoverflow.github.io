<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1165) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1165.html">
<link rel="prev" href="index-1166.html" type="text/html">
<link rel="next" href="index-1164.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/expressjs-how-to-structure-an-application/" class="u-url">ExpressJS How to structure an application?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/expressjs-how-to-structure-an-application/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T02:48:02+08:00" itemprop="datePublished" title="2023-02-18 02:48">2023-02-18 02:48</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm using the ExpressJS web framework for NodeJS.</p>
<p>People using ExpressJS put their environments (development, production,
test...), their routes etc on the <code>app.js</code>. I think that it's not a beautiful
way because when you have a big application, app.js is too big!</p>
<p>I would like to have this directory structure:</p>
<div class="code"><pre class="code literal-block">| my-application
| -- app.js
| -- config/
     | -- environment.js
     | -- routes.js
</pre></div>

<p>Here's my code:</p>
<p><strong>app.js</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="o">.</span><span class="n">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">express</span><span class="o">.</span><span class="n">createServer</span><span class="p">();</span>

<span class="n">require</span><span class="p">(</span><span class="s1">'./config/environment.js'</span><span class="p">)(</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="n">express</span><span class="p">);</span>
<span class="n">require</span><span class="p">(</span><span class="s1">'./config/routes.js'</span><span class="p">)(</span><span class="n">app</span><span class="p">);</span>

<span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</pre></div>

<p><strong>config/environment.js</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">module</span><span class="o">.</span><span class="n">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="n">express</span><span class="p">){</span>
<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">express</span><span class="o">.</span><span class="n">logger</span><span class="p">());</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">'development'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">express</span><span class="o">.</span><span class="n">errorHandler</span><span class="p">({</span>
<span class="w">        </span><span class="n">dumpExceptions</span><span class="p">:</span><span class="w"> </span><span class="bp">true</span><span class="p">,</span>
<span class="w">        </span><span class="n">showStack</span><span class="p">:</span><span class="w"> </span><span class="bp">true</span>
<span class="w">    </span><span class="p">}));</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s1">'production'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">express</span><span class="o">.</span><span class="n">errorHandler</span><span class="p">());</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">};</span>
</pre></div>

<p><strong>config/routes.js</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">module</span><span class="o">.</span><span class="n">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">app</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">'Hello world !'</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">};</span>
</pre></div>

<p>My code works well and I think that the structure of the directories is
beautiful. However, the code had to be adapted and I'm not sure that it's
good/beautiful.</p>
<p>Is it better to use my structure of directories and adapt the code or simply
use one file (app.js)?</p>
<p>Thanks for your advices!</p>
<p><br><br></p>
<h2>Answer</h2>
<p>OK, it's been a while and this is a popular question, so I've gone ahead and
created a scaffolding github repository with JavaScript code and a long README
about how I like to structure a medium-sized express.js application.</p>
<p>focusaurus/express_code_structure is the repo with the latest code for this.
Pull requests welcome.</p>
<p>Here's a snapshot of the README since stackoverflow doesn't like just-a-link
answers. I'll make some updates as this is a new project that I'll continue
updating, but ultimately the github repo will be the up-to-date place for this
information.</p>
<hr>
<h2>Express Code Structure</h2>
<p>This project is an example of how to organize a medium-sized express.js web
application.</p>
<p><strong>Current to at least express v4.14 December 2016</strong></p>
<p><img alt="Build
Status" src="https://semaphoreci.com/api/v1/projects/0de47c2f-0e4f-4a47-8822-5913023312e1/681770/badge.svg"></p>
<p><img alt="js-standard-style" src="https://cdn.rawgit.com/feross/standard/master/badge.svg"></p>
<h3>How big is your application?</h3>
<p>Web applications are not all the same, and there's not, in my opinion, a
single code structure that should be applied to all express.js applications.</p>
<p>If your application is small, you don't need such a deep directory structure
as exemplified here. Just keep it simple and stick a handful of <code>.js</code> files in
the root of your repository and you're done. Voilà.</p>
<p>If your application is huge, at some point you need to break it up into
distinct npm packages. In general the node.js approach seems to favor many
small packages, at least for libraries, and you should build your application
up by using several npm packages as that starts to make sense and justify the
overhead. So as your application grows and some portion of the code becomes
clearly reusable outside of your application or is a clear subsystem, move it
to its own git repository and make it into a standalone npm package.</p>
<p><strong>So</strong> the focus of this project is to illustrate a workable structure for a
medium-sized application.</p>
<h3>What is your overall architecture</h3>
<p>There are many approaches to building a web application, such as</p>
<ul>
<li>Server Side MVC a la Ruby on Rails</li>
<li>Single Page Application style a la MongoDB/Express/Angular/Node (MEAN)</li>
<li>Basic web site with some forms</li>
<li>Models/Operations/Views/Events style a la MVC is dead, it's time to MOVE on</li>
<li>and many others both current and historical</li>
</ul>
<p>Each of these fits nicely into a different directory structure. For the
purposes of this example, it's just scaffolding and not a fully working app,
but I'm assuming the following key architecture points:</p>
<ul>
<li>The site has some traditional static pages/templates</li>
<li>The "application" portion of the site is developed as a Single Page Application style</li>
<li>The application exposes a REST/JSON style API to the browser</li>
<li>The app models a simple business domain, in this case, it's a car dealership application</li>
</ul>
<h3>And what about Ruby on Rails?</h3>
<p>It will be a theme throughout this project that many of the ideas embodied in
Ruby on Rails and the "Convention over Configuration" decisions they have
adopted, though widely accepted and used, are not actually very helpful and
sometimes are the opposite of what this repository recommends.</p>
<p>My main point here is that there are underlying principles to organizing code,
and based on those principles, the Ruby on Rails conventions make sense
(mostly) for the Ruby on Rails community. However, just thoughtlessly aping
those conventions misses the point. Once you grok the basic principles, ALL of
your projects will be well-organized and clear: shell scripts, games, mobile
apps, enterprise projects, even your home directory.</p>
<p>For the Rails community, they want to be able to have a single Rails developer
switch from app to app to app and be familiar and comfortable with it each
time. This makes great sense if you are 37 signals or Pivotal Labs, and has
benefits. In the server-side JavaScript world, the overall ethos is just way
more wild west anything goes and we don't really have a problem with that.
That's how we roll. We're used to it. Even within express.js, it's a close kin
of Sinatra, not Rails, and taking conventions from Rails is usually not
helping anything. I'd even say <strong>Principles over Convention over
Configuration</strong>.</p>
<h3>Underlying Principles and Motivations</h3>
<ul>
<li>Be mentally manageable <ul>
<li>The brain can only deal with and think about a small number of related things at once. That's why we use directories. It helps us deal with complexity by focusing on small portions.</li>
</ul>
</li>
<li>Be size-appropriate <ul>
<li>Don't create "Mansion Directories" where there's just 1 file all alone 3 directories down. You can see this happening in the Ansible Best Practices that shames small projects into creating 10+ directories to hold 10+ files when 1 directory with 3 files would be much more appropriate. You don't drive a bus to work (unless you're a bus driver, but even then your driving a bus AT work not TO work), so don't create filesystem structures that aren't justified by the actual files inside them.</li>
</ul>
</li>
<li>Be modular but pragmatic <ul>
<li>The node community overall favors small modules. Anything that can cleanly be separated out from your app entirely should be extracted into a module either for internal use or publicly published on npm. However, for the medium-sized applications that are the scope here, the overhead of this can add tedium to your workflow without commensurate value. So for the time when you have some code that is factored out but not enough to justify a completely separate npm module, just consider it a " <strong>proto-module</strong> " with the expectation that when it crosses some size threshold, it would be extracted out.</li>
<li>Some folks such as @hij1nx even include an <code>app/node_modules</code> directory and have <code>package.json</code> files in the <strong>proto-module</strong> directories to facilitate that transition and act as a reminder.</li>
</ul>
</li>
<li>Be easy to locate code <ul>
<li>Given a feature to build or a bug to fix, our goal is that a developer has no struggle locating the source files involved. </li>
<li>Names are meaningful and accurate</li>
<li>crufty code is fully removed, not left around in an orphan file or just commented out</li>
</ul>
</li>
<li>Be search-friendly <ul>
<li>all first-party source code is in the <code>app</code> directory so you can <code>cd</code> there are run find/grep/xargs/ag/ack/etc and not be distracted by third party matches</li>
</ul>
</li>
<li>Use simple and obvious naming <ul>
<li>npm now seems to require all-lowercase package names. I find this mostly terrible but I must follow the herd, thus filenames should use <code>kebab-case</code> even though the variable name for that in JavaScript must be <code>camelCase</code> because <code>-</code> is a minus sign in JavaScript.</li>
<li>variable name matches the basename of the module path, but with <code>kebab-case</code> transformed to <code>camelCase</code>
</li>
</ul>
</li>
<li>Group by Coupling, Not by Function <ul>
<li>This is a major departure from the Ruby on Rails convention of <code>app/views</code>, <code>app/controllers</code>, <code>app/models</code>, etc</li>
<li>Features get added to a full stack, so I want to focus on a full stack of files that are relevant to my feature. When I'm adding a telephone number field to the user model, I don't care about any controller other than the user controller, and I don't care about any model other than the user model.</li>
<li>So instead of editing 6 files that are each in their own directory and ignoring tons of other files in those directories, this repository is organized such that all the files I need to build a feature are colocated</li>
<li>By the nature of MVC, the user view is coupled to the user controller which is coupled to the user model. So when I change the user model, those 3 files will often change together, but the deals controller or customer controller are decoupled and thus not involved. Same applies to non-MVC designs usually as well.</li>
<li>MVC or MOVE style decoupling in terms of which code goes in which module is still encouraged, but spreading the MVC files out into sibling directories is just annoying.</li>
<li>Thus each of my routes files has the portion of the routes it owns. A rails-style <code>routes.rb</code> file is handy if you want an overview of all routes in the app, but when actually building features and fixing bugs, you only care about the routes relevant to the piece you are changing.</li>
</ul>
</li>
<li>Store tests next to the code <ul>
<li>This is just an instance of "group by coupling", but I wanted to call it out specifically. I've written many projects where the tests live under a parallel filesystem called "tests" and now that I've started putting my tests in the same directory as their corresponding code, I'm never going back. This is more modular and much easier to work with in text editors and alleviates a lot of the "../../.." path nonsense. If you are in doubt, try it on a few projects and decide for yourself. I'm not going to do anything beyond this to convince you that it's better.</li>
</ul>
</li>
<li>Reduce cross-cutting coupling with Events <ul>
<li>It's easy to think "OK, whenever a new Deal is created, I want to send an email to all the Salespeople", and then just put the code to send those emails in the route that creates deals.</li>
<li>However, this coupling will eventually turn your app into a giant ball of mud.</li>
<li>Instead, the DealModel should just fire a "create" event and be entirely unaware of what else the system might do in response to that.</li>
<li>When you code this way, it becomes much more possible to put all the user related code into <code>app/users</code> because there's not a rat's nest of coupled business logic all over the place polluting the purity of the user code base.</li>
</ul>
</li>
<li>Code flow is followable <ul>
<li>Don't do magic things. Don't autoload files from magic directories in the filesystem. Don't be Rails. The app starts at <code>app/server.js:1</code> and you can see everything it loads and executes by following the code.</li>
<li>Don't make DSLs for your routes. Don't do silly metaprogramming when it is not called for.</li>
<li>If your app is so big that doing <code>magicRESTRouter.route(somecontroller, {except: 'POST'})</code> is a big win for you over 3 basic <code>app.get</code>, <code>app.put</code>, <code>app.del</code>, calls, you're probably building a monolithic app that is too big to effectively work on. Get fancy for BIG wins, not for converting 3 simple lines to 1 complex line.</li>
</ul>
</li>
<li>Use lower-kebab-case filenames <ul>
<li>This format avoids filesystem case sensitivity issues across platforms</li>
<li>npm forbids uppercase in new package names, and this works well with that</li>
</ul>
</li>
</ul>
<h3>express.js specifics</h3>
<ul>
<li>Don't use <code>app.configure</code>. It's almost entirely useless and you just don't need it. It is in lots of boilerplate due to mindless copypasta.</li>
<li>THE ORDER OF MIDDLEWARE AND ROUTES IN EXPRESS MATTERS!!! <ul>
<li>Almost every routing problem I see on stackoverflow is out-of-order express middleware</li>
<li>In general, you want your routes decoupled and not relying on order that much</li>
<li>Don't use <code>app.use</code> for your entire application if you really only need that middleware for 2 routes (I'm looking at you, <code>body-parser</code>)</li>
<li>Make sure when all is said and done you have EXACTLY this order: </li>
<li>Any super-important application-wide middleware</li>
<li>All your routes and assorted route middlewares</li>
<li>THEN error handlers</li>
</ul>
</li>
<li>Sadly, being sinatra-inspired, express.js mostly assumes all your routes will be in <code>server.js</code> and it will be clear how they are ordered. For a medium-sized application, breaking things out into separate routes modules is nice, but it does introduce peril of out-of-order middleware</li>
</ul>
<h3>The app symlink trick</h3>
<p>There are many approaches outlined and discussed at length by the community in
the great gist Better local require() paths for Node.js. I may soon decide to
prefer either "just deal with lots of ../../../.." or use the requireFrom
modlue. However, at the moment, I've been using the symlink trick detailed
below.</p>
<p>So one way to avoid intra-project requires with annoying relative paths like
<code>require("../../../config")</code> is to use the following trick:</p>
<ul>
<li>create a symlink under node_modules for your app <ul>
<li>cd node_modules &amp;&amp; ln -nsf ../app</li>
</ul>
</li>
<li>add <strong>just the node_modules/app symlink itself</strong> , not the entire node_modules folder, to git <ul>
<li>git add -f node_modules/app</li>
<li>Yes, you should still have "node_modules" in your <code>.gitignore</code> file</li>
<li>No, you should not put "node_modules" into your git repository. Some people will recommend you do this. They are incorrect.</li>
</ul>
</li>
<li>Now you can require intra-project modules using this prefix <ul>
<li><code>var config = require("app/config");</code></li>
<li>
<code>var DealModel = require("app/deals/deal-model")</code>;</li>
</ul>
</li>
<li>Basically, this makes intra-project requires work very similarly to requires for external npm modules.</li>
<li>Sorry, Windows users, you need to stick with parent directory relative paths.</li>
</ul>
<h3>Configuration</h3>
<p>Generally code modules and classes to expect only a basic JavaScript <code>options</code>
object passed in. Only <code>app/server.js</code> should load the <code>app/config.js</code> module.
From there it can synthesize small <code>options</code> objects to configure subsystems
as needed, but coupling every subsystem to a big global config module full of
extra information is bad coupling.</p>
<p>Try to centralize creation of DB connections and pass those into subsystems as
opposed to passing connection parameters and having subsystems make outgoing
connections themselves.</p>
<h4>NODE_ENV</h4>
<p>This is another enticing but terrible idea carried over from Rails. There
should be exactly 1 place in your app, <code>app/config.js</code> that looks at the
<code>NODE_ENV</code> environment variable. Everything else should take an explicit
option as a class constructor argument or module configuration parameter.</p>
<p>If the email module has an option as to how to deliver emails (SMTP, log to
stdout, put in queue etc), it should take an option like <code>{deliver: 'stdout'}</code>
but it should absolutely not check <code>NODE_ENV</code>.</p>
<h3>Tests</h3>
<p>I now keep my test files in the same directory as their corresponding code and
use filename extension naming conventions to distinguish tests from production
code.</p>
<ul>
<li>
<code>foo.js</code> has the module "foo"'s code</li>
<li>
<code>foo.tape.js</code> has the node-based tests for foo and lives in the same dir</li>
<li>
<code>foo.btape.js</code> can be used for tests that need to execute in a browser environment</li>
</ul>
<p>I use filesystem globs and the <code>find . -name '*.tape.js'</code> command to get
access to all my tests as necessary.</p>
<h3>How to organize code within each <code>.js</code> module file</h3>
<p>This project's scope is mostly about where files and directories go, and I
don't want to add much other scope, but I'll just mention that I organize my
code into 3 distinct sections.</p>
<ol>
<li>Opening block of CommonJS require calls to state dependencies</li>
<li>Main code block of pure-JavaScript. No CommonJS pollution in here. Don't reference exports, module, or require.</li>
<li>Closing block of CommonJS to set up exports</li>
</ol>
<p><br></p>
<h3>Suggest</h3>
<p><strong>UPDATE (2013-10-29)</strong> : Please see my other answer as well which has
JavaScript instead of CoffeeScript by popular demand as well as a boilerplate
github repo and an extensive README detailing my latest recommendations on
this topic.</p>
<p><strong>Config</strong></p>
<p>What you are doing is fine. I like to have my own config namespace set up in a
top-level <code>config.coffee</code> file with a nested namespace like this.</p>
<div class="code"><pre class="code literal-block"><span class="n">#Set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="k">object</span>
<span class="n">currentEnv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">process</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="n">NODE_ENV</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">'development'</span>
<span class="n">exports</span><span class="p">.</span><span class="n">appName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">"MyApp"</span>
<span class="n">exports</span><span class="p">.</span><span class="n">env</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="nl">production</span><span class="p">:</span><span class="w"> </span><span class="k">false</span>
<span class="w">  </span><span class="nl">staging</span><span class="p">:</span><span class="w"> </span><span class="k">false</span>
<span class="w">  </span><span class="nl">test</span><span class="p">:</span><span class="w"> </span><span class="k">false</span>
<span class="w">  </span><span class="nl">development</span><span class="p">:</span><span class="w"> </span><span class="k">false</span>
<span class="n">exports</span><span class="p">.</span><span class="n">env</span><span class="o">[</span><span class="n">currentEnv</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span>
<span class="n">exports</span><span class="p">.</span><span class="nf">log</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="k">path</span><span class="err">:</span><span class="w"> </span><span class="n">__dirname</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="ss">"/var/log/app_#{currentEnv}.log"</span>
<span class="n">exports</span><span class="p">.</span><span class="n">server</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="nl">port</span><span class="p">:</span><span class="w"> </span><span class="mi">9600</span>
<span class="w">  </span><span class="n">#In</span><span class="w"> </span><span class="n">staging</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">production</span><span class="p">,</span><span class="w"> </span><span class="n">listen</span><span class="w"> </span><span class="n">loopback</span><span class="p">.</span><span class="w"> </span><span class="n">nginx</span><span class="w"> </span><span class="n">listens</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">network</span><span class="p">.</span>
<span class="w">  </span><span class="nl">ip</span><span class="p">:</span><span class="w"> </span><span class="s1">'127.0.0.1'</span>
<span class="k">if</span><span class="w"> </span><span class="n">currentEnv</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">[</span><span class="n">'production', 'staging'</span><span class="o">]</span>
<span class="w">  </span><span class="n">exports</span><span class="p">.</span><span class="n">enableTests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span>
<span class="w">  </span><span class="n">#Listen</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">IPs</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">dev</span><span class="o">/</span><span class="n">test</span><span class="w"> </span><span class="p">(</span><span class="k">for</span><span class="w"> </span><span class="n">testing</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">machines</span><span class="p">)</span>
<span class="w">  </span><span class="n">exports</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'0.0.0.0'</span>
<span class="n">exports</span><span class="p">.</span><span class="n">db</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="nl">URL</span><span class="p">:</span><span class="w"> </span><span class="ss">"mongodb://localhost:27017/#{exports.appName.toLowerCase()}_#{currentEnv}"</span>
</pre></div>

<p>This is friendly for sysadmin editing. Then when I need something, like the DB
connection info, it`s</p>
<div class="code"><pre class="code literal-block">require('./config').db.URL
</pre></div>

<p><strong>Routes/Controllers</strong></p>
<p>I like to leave my routes with my controllers and organize them in an
<code>app/controllers</code> subdirectory. Then I can load them up and let them add
whatever routes they need.</p>
<p>In my <code>app/server.coffee</code> coffeescript file I do:</p>
<div class="code"><pre class="code literal-block"><span class="p">[</span>
<span class="w">  </span><span class="s">'api'</span>
<span class="w">  </span><span class="s">'authorization'</span>
<span class="w">  </span><span class="s">'authentication'</span>
<span class="w">  </span><span class="s">'domains'</span>
<span class="w">  </span><span class="s">'users'</span>
<span class="w">  </span><span class="s">'stylesheets'</span>
<span class="w">  </span><span class="s">'javascripts'</span>
<span class="w">  </span><span class="s">'tests'</span>
<span class="w">  </span><span class="s">'sales'</span>
<span class="p">].</span><span class="nf">map</span><span class="w"> </span><span class="p">(</span><span class="n">controllerName</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">  </span><span class="n">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="w"> </span><span class="s">'./controllers/'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">controllerName</span>
<span class="w">  </span><span class="n">controller</span><span class="p">.</span><span class="n">setup</span><span class="w"> </span><span class="n">app</span>
</pre></div>

<p>So I have files like:</p>
<div class="code"><pre class="code literal-block">app/controllers/api.coffee
app/controllers/authorization.coffee
app/controllers/authentication.coffee
app/controllers/domains.coffee
</pre></div>

<p>And for example in my domains controller, I have a <code>setup</code> function like this.</p>
<div class="code"><pre class="code literal-block"><span class="n">exports</span><span class="o">.</span><span class="n">setup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">  </span><span class="n">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">exports</span><span class="o">.</span><span class="n">DomainController</span>
<span class="w">  </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'/domains'</span>
<span class="w">  </span><span class="n">app</span><span class="o">.</span><span class="n">post</span><span class="w"> </span><span class="n">route</span><span class="p">,</span><span class="w"> </span><span class="n">controller</span><span class="o">.</span><span class="n">create</span>
<span class="w">  </span><span class="n">app</span><span class="o">.</span><span class="n">put</span><span class="w"> </span><span class="n">route</span><span class="p">,</span><span class="w"> </span><span class="n">api</span><span class="o">.</span><span class="n">needId</span>
<span class="w">  </span><span class="n">app</span><span class="o">.</span><span class="n">delete</span><span class="w"> </span><span class="n">route</span><span class="p">,</span><span class="w"> </span><span class="n">api</span><span class="o">.</span><span class="n">needId</span>
<span class="w">  </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'/domains/:id'</span>
<span class="w">  </span><span class="n">app</span><span class="o">.</span><span class="n">put</span><span class="w"> </span><span class="n">route</span><span class="p">,</span><span class="w"> </span><span class="n">controller</span><span class="o">.</span><span class="n">loadDomain</span><span class="p">,</span><span class="w"> </span><span class="n">controller</span><span class="o">.</span><span class="n">update</span>
<span class="w">  </span><span class="n">app</span><span class="o">.</span><span class="n">del</span><span class="w"> </span><span class="n">route</span><span class="p">,</span><span class="w"> </span><span class="n">controller</span><span class="o">.</span><span class="n">loadDomain</span><span class="p">,</span><span class="w"> </span><span class="n">exports</span><span class="o">.</span><span class="n">delete</span>
<span class="w">  </span><span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="w"> </span><span class="n">route</span><span class="p">,</span><span class="w"> </span><span class="n">controller</span><span class="o">.</span><span class="n">loadDomain</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">res</span><span class="o">.</span><span class="n">sendJSON</span><span class="w"> </span><span class="n">req</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="o">.</span><span class="n">OK</span>
</pre></div>

<p><strong>Views</strong></p>
<p>Putting views in <code>app/views</code> is becoming the customary place. I lay it out
like this.</p>
<div class="code"><pre class="code literal-block">app/views/layout.jade
app/views/about.jade
app/views/user/EditUser.jade
app/views/domain/EditDomain.jade
</pre></div>

<p><strong>Static Files</strong></p>
<p>Go in a <code>public</code> subdirectory.</p>
<p><strong>Github/Semver/NPM</strong></p>
<p>Put a README.md markdown file at your git repo root for github.</p>
<p>Put a package.json file with a semantic version number in your git repo root
for NPM.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-does-autowiring-work-in-spring/" class="u-url">How does autowiring work in Spring?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-does-autowiring-work-in-spring/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T02:47:35+08:00" itemprop="datePublished" title="2023-02-18 02:47">2023-02-18 02:47</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm a little confused as to how the inversion of control (<code>IoC</code>) works in
<code>Spring</code>.</p>
<p><strong>Say I have a service class called<code>UserServiceImpl</code> that implements
<code>UserService</code> interface.</strong></p>
<p>How would this be <code>@Autowired</code>?</p>
<p>And in my <code>Controllers</code>, how would I <code>instantiate</code> an <code>instance</code> of this
service?</p>
<p>Would I just do the following?</p>
<div class="code"><pre class="code literal-block">UserService userService = new UserServiceImpl();
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>First, and most important - all Spring beans are managed - they "live" inside
a container, called "application context".</p>
<p>Second, each application has an entry point to that context. Web applications
have a Servlet, JSF uses a el-resolver, etc. Also, there is a place where the
application context is bootstrapped and all beans - autowired. In web
applications this can be a startup listener.</p>
<p>Autowiring happens by placing an instance of one bean into the desired field
in an instance of another bean. Both classes should be beans, i.e. they should
be defined to live in the application context.</p>
<p>What is "living" in the application context? This means that the <em>context</em>
instantiates the objects, not you. I.e. - you never make <code>new
UserServiceImpl()</code> - the container finds each injection point and sets an
instance there.</p>
<p>In your controllers, you just have the following:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@Controller</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Defines</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">spring</span><span class="w"> </span><span class="n">bean</span>
<span class="nv">@RequestMapping</span><span class="p">(</span><span class="ss">"/users"</span><span class="p">)</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">SomeController</span><span class="w"> </span><span class="err">{</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Tells</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">inject</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="n">here</span>
<span class="w">    </span><span class="nv">@Autowired</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="n">userService</span><span class="p">;</span>

<span class="w">    </span><span class="nv">@RequestMapping</span><span class="p">(</span><span class="ss">"/login"</span><span class="p">)</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">login</span><span class="p">(</span><span class="nv">@RequestParam</span><span class="p">(</span><span class="ss">"username"</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">,</span>
<span class="w">           </span><span class="nv">@RequestParam</span><span class="p">(</span><span class="ss">"password"</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">UserServiceImpl</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">injected</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">it</span>
<span class="w">        </span><span class="n">userService</span><span class="p">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">);</span>

<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>A few notes:</p>
<ul>
<li>In your <code>applicationContext.xml</code> you should enable the <code>&lt;context:component-scan&gt;</code> so that classes are scanned for the <code>@Controller</code>, <code>@Service</code>, etc. annotations.</li>
<li>The entry point for a Spring-MVC application is the DispatcherServlet, but it is hidden from you, and hence the direct interaction and bootstrapping of the application context happens behind the scene.</li>
<li>
<code>UserServiceImpl</code> should also be defined as bean - either using <code>&lt;bean id=".." class=".."&gt;</code> or using the <code>@Service</code> annotation. Since it will be the only implementor of <code>UserService</code>, it will be injected.</li>
<li>Apart from the <code>@Autowired</code> annotation, Spring can use XML-configurable autowiring. In that case all fields that have a name or type that matches with an existing bean automatically get a bean injected. In fact, that was the initial idea of autowiring - to have fields injected with dependencies without any configuration. Other annotations like <code>@Inject</code>, <code>@Resource</code> can also be used.</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>Depends on whether you want the annotations route or the bean XML definition
route.</p>
<p>Say you had the beans defined in your <code>applicationContext.xml</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;beans</span><span class="w"> </span><span class="err">...</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">"userService"</span><span class="w"> </span><span class="na">class=</span><span class="s">"com.foo.UserServiceImpl"</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">"fooController"</span><span class="w"> </span><span class="na">class=</span><span class="s">"com.foo.FooController"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>

<p>The autowiring happens when the application starts up. So, in <code>fooController</code>,
which for arguments sake wants to use the <code>UserServiceImpl</code> class, you'd
annotate it as follows:</p>
<div class="code"><pre class="code literal-block"><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">FooController</span><span class="w"> </span><span class="err">{</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">annotate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">setUserService</span><span class="w"> </span><span class="k">method</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">this</span>
<span class="w">    </span><span class="nv">@Autowired</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="n">userService</span><span class="p">;</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">rest</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">goes</span><span class="w"> </span><span class="n">here</span>
<span class="err">}</span>
</pre></div>

<p>When it sees <code>@Autowired</code>, Spring will look for a class that matches the
property in the <code>applicationContext</code>, and inject it automatically. If you have
more than one <code>UserService</code> bean, then you'll have to qualify which one it
should use.</p>
<p>If you do the following:</p>
<div class="code"><pre class="code literal-block">UserService service = new UserServiceImpl();
</pre></div>

<p>It will not pick up the <code>@Autowired</code> unless you set it yourself.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/partly-cherry-picking-a-commit-with-git/" class="u-url">Partly cherry-picking a commit with Git</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/partly-cherry-picking-a-commit-with-git/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T02:47:12+08:00" itemprop="datePublished" title="2023-02-18 02:47">2023-02-18 02:47</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm working on 2 different branches: <strong>release</strong> and <strong>development</strong>.</p>
<p>I noticed I still need to integrate some changes that were committed to the
<strong>release</strong> branch back into the <strong>development</strong> branch.</p>
<p>The problem is I don't need all of the commit, only some hunks in certain
files, so a simple</p>
<div class="code"><pre class="code literal-block">git cherry-pick bc66559
</pre></div>

<p>does not do the trick.</p>
<p>When I do a</p>
<div class="code"><pre class="code literal-block"><span class="nv">git</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="nv">bc66559</span>
</pre></div>

<p>I can see the diff but don't really know a good way of applying that partially
to my current working tree.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The core thing you're going to want here is <code>git add -p</code> (<code>-p</code> is a synonym
for <code>--patch</code>). This provides an interactive way to add in content, letting
you decide whether each hunk should go in or not, and even letting you
manually edit the patch if necessary.</p>
<p>To use it in combination with cherry-pick:</p>
<div class="code"><pre class="code literal-block"><span class="n">git</span> <span class="n">cherry-pick</span> -<span class="n">n</span> <span class="s">&lt;commit&gt;</span> <span class="c1"># get your patch, but don't commit (-n = --no-commit)</span>
<span class="n">git</span> <span class="n">reset</span>                   <span class="c1"># unstage the changes from the cherry-picked commit</span>
<span class="n">git</span> <span class="nb">add</span> -<span class="n">p</span>                  <span class="c1"># make all your choices (add the changes you do want)</span>
<span class="n">git</span> <span class="n">commit</span>                  <span class="c1"># make the commit!</span>
</pre></div>

<p>(Thanks to Tim Henigan for reminding me that <code>git-cherry-pick</code> has a <code>--no-
commit</code> option, and thanks to Felix Rabe for pointing out that you need to
<code>git reset</code>. If you only want to leave a few things out of the commit, you
could use <code>git reset &lt;path&gt;...</code> to unstage just those files.)</p>
<p>You can provide specific paths to <code>add -p</code> if necessary. If you're starting
with a patch you could replace the <code>cherry-pick</code> with <code>apply</code>.</p>
<hr>
<p>If you really want to <code>git cherry-pick -p &lt;commit&gt;</code> (that option does not
exist), you can use</p>
<div class="code"><pre class="code literal-block">git checkout -p &lt;commit&gt;
</pre></div>

<p>That will diff the current commit against the commit you specify, and allow
you to apply hunks from that diff individually. This option may be more useful
if the commit you're pulling in has merge conflicts in part of the commit
you're not interested in. (Note, however, that <code>checkout</code> differs from
<code>cherry-pick</code>: <code>checkout</code> tries to apply <code>&lt;commit&gt;</code>'s contents entirely, while
<code>cherry-pick</code> applies the diff of the specified commit from it's parent. This
means that <code>checkout</code> can apply more than just that commit, which might be
more than you want.)</p>
<p><br></p>
<h3>Suggest</h3>
<p>I know I'm answering an old question, but it looks like there's a new way to
do this with interactively checking out:</p>
<div class="code"><pre class="code literal-block">git checkout -p bc66559
</pre></div>

<p>Credit to Can I interactively pick hunks from another git commit?</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1166.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1164.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
