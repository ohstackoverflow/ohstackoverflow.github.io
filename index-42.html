<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 42) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-42.html">
<link rel="prev" href="index-43.html" type="text/html">
<link rel="next" href="index-41.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/catch-multiple-exceptions-in-one-line-except-block/" class="u-url">Catch multiple exceptions in one line (except block)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/catch-multiple-exceptions-in-one-line-except-block/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T19:25:40+08:00" itemprop="datePublished" title="2023-02-16 19:25">2023-02-16 19:25</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I know that I can do:</p>
<div class="code"><pre class="code literal-block"><span class="nv">try</span>:
<span class="w">    </span>#<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">something</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">may</span><span class="w"> </span><span class="nv">fail</span>
<span class="nv">except</span>:
<span class="w">    </span>#<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">ANYTHING</span><span class="w"> </span><span class="nv">goes</span><span class="w"> </span><span class="nv">wrong</span>
</pre></div>

<p>I can also do this:</p>
<div class="code"><pre class="code literal-block"><span class="nv">try</span>:
<span class="w">    </span>#<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">something</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">may</span><span class="w"> </span><span class="nv">fail</span>
<span class="nv">except</span><span class="w"> </span><span class="nv">IDontLikeYouException</span>:
<span class="w">    </span>#<span class="w"> </span><span class="nv">say</span><span class="w"> </span><span class="nv">please</span>
<span class="nv">except</span><span class="w"> </span><span class="nv">YouAreTooShortException</span>:
<span class="w">    </span>#<span class="w"> </span><span class="nv">stand</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">ladder</span>
</pre></div>

<p>But if I want to do the same thing inside two different exceptions, the best I
can think of right now is to do this:</p>
<div class="code"><pre class="code literal-block"><span class="nv">try</span>:
<span class="w">    </span>#<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">something</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">may</span><span class="w"> </span><span class="nv">fail</span>
<span class="nv">except</span><span class="w"> </span><span class="nv">IDontLikeYouException</span>:
<span class="w">    </span>#<span class="w"> </span><span class="nv">say</span><span class="w"> </span><span class="nv">please</span>
<span class="nv">except</span><span class="w"> </span><span class="nv">YouAreBeingMeanException</span>:
<span class="w">    </span>#<span class="w"> </span><span class="nv">say</span><span class="w"> </span><span class="nv">please</span>
</pre></div>

<p>Is there any way that I can do something like this (since the action to take
in both exceptions is to <code>say please</code>):</p>
<div class="code"><pre class="code literal-block"><span class="nv">try</span>:
<span class="w">    </span>#<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">something</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">may</span><span class="w"> </span><span class="nv">fail</span>
<span class="nv">except</span><span class="w"> </span><span class="nv">IDontLikeYouException</span>,<span class="w"> </span><span class="nv">YouAreBeingMeanException</span>:
<span class="w">    </span>#<span class="w"> </span><span class="nv">say</span><span class="w"> </span><span class="nv">please</span>
</pre></div>

<p>Now this really won't work, as it matches the syntax for:</p>
<div class="code"><pre class="code literal-block"><span class="nv">try</span>:
<span class="w">    </span>#<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">something</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">may</span><span class="w"> </span><span class="nv">fail</span>
<span class="nv">except</span><span class="w"> </span><span class="nv">Exception</span>,<span class="w"> </span><span class="nv">e</span>:
<span class="w">    </span>#<span class="w"> </span><span class="nv">say</span><span class="w"> </span><span class="nv">please</span>
</pre></div>

<p>So, my effort to catch the two distinct exceptions doesn't exactly come
through.</p>
<p>Is there a way to do this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>From Python Documentation:</p>
<blockquote>
<p>An except clause may name multiple exceptions as a parenthesized tuple, for
example</p>
</blockquote>
<div class="code"><pre class="code literal-block">except (IDontLikeYouException, YouAreBeingMeanException) as e:
    pass
</pre></div>

<p>Or, for Python 2 only:</p>
<div class="code"><pre class="code literal-block">except (IDontLikeYouException, YouAreBeingMeanException), e:
    pass
</pre></div>

<p>Separating the exception from the variable with a comma will still work in
Python 2.6 and 2.7, but is now deprecated and does not work in Python 3; now
you should be using <code>as</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<blockquote>
<h3>How do I catch multiple exceptions in one line (except block)</h3>
</blockquote>
<p>Do this:</p>
<div class="code"><pre class="code literal-block"><span class="k">try</span><span class="o">:</span>
<span class="w">    </span><span class="n">may_raise_specific_errors</span><span class="o">():</span>
<span class="n">except</span><span class="w"> </span><span class="o">(</span><span class="n">SpecificErrorOne</span><span class="o">,</span><span class="w"> </span><span class="n">SpecificErrorTwo</span><span class="o">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">error</span><span class="o">:</span>
<span class="w">    </span><span class="n">handle</span><span class="o">(</span><span class="n">error</span><span class="o">)</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">behavior</span><span class="o">...</span>
</pre></div>

<p>The parentheses are required due to older syntax that used the commas to
assign the error object to a name. The <code>as</code> keyword is used for the
assignment. You can use any name for the error object, I prefer <code>error</code>
personally.</p>
<h3>Best Practice</h3>
<p>To do this in a manner currently and forward compatible with Python, you need
to separate the Exceptions with commas and wrap them with parentheses to
differentiate from earlier syntax that assigned the exception instance to a
variable name by following the Exception type to be caught with a comma.</p>
<p>Here's an example of simple usage:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">mainstuff</span><span class="p">()</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">):</span> <span class="c1"># the parens are necessary</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

<p>I'm specifying only these exceptions to avoid hiding bugs, which if I
encounter I expect the full stack trace from.</p>
<p>This is documented here: https://docs.python.org/tutorial/errors.html</p>
<p>You can assign the exception to a variable, (<code>e</code> is common, but you might
prefer a more verbose variable if you have long exception handling or your IDE
only highlights selections larger than that, as mine does.) The instance has
an args attribute. Here is an example:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">mainstuff</span><span class="p">()</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span> 
    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

<p>Note that in Python 3, the <code>err</code> object falls out of scope when the <code>except</code>
block is concluded.</p>
<h3>Deprecated</h3>
<p>You may see code that assigns the error with a comma. This usage, the only
form available in Python 2.5 and earlier, is deprecated, and if you wish your
code to be forward compatible in Python 3, you should update the syntax to use
the new form:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">mainstuff</span><span class="p">()</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">KeyboardInterrupt</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">),</span> <span class="n">err</span><span class="p">:</span> <span class="c1"># don't do this in Python 2.6+</span>
    <span class="nb">print</span> <span class="n">err</span>
    <span class="nb">print</span> <span class="n">err</span><span class="o">.</span><span class="n">args</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

<p>If you see the comma name assignment in your codebase, and you're using Python
2.5 or higher, switch to the new way of doing it so your code remains
compatible when you upgrade.</p>
<h3>The <code>suppress</code> context manager</h3>
<p>The accepted answer is really 4 lines of code, minimum:</p>
<div class="code"><pre class="code literal-block"><span class="k">try</span><span class="o">:</span>
<span class="w">    </span><span class="n">do_something</span><span class="o">()</span>
<span class="n">except</span><span class="w"> </span><span class="o">(</span><span class="n">IDontLikeYouException</span><span class="o">,</span><span class="w"> </span><span class="n">YouAreBeingMeanException</span><span class="o">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">e</span><span class="o">:</span>
<span class="w">    </span><span class="n">pass</span>
</pre></div>

<p>The <code>try</code>, <code>except</code>, <code>pass</code> lines can be handled in a single line with the
suppress context manager, available in Python 3.4:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">suppress</span>

<span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="n">IDontLikeYouException</span><span class="p">,</span> <span class="n">YouAreBeingMeanException</span><span class="p">):</span>
     <span class="n">do_something</span><span class="p">()</span>
</pre></div>

<p>So when you want to <code>pass</code> on certain exceptions, use <code>suppress</code>.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-create-a-memory-leak-in-java/" class="u-url">How can I create a memory leak in Java?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-create-a-memory-leak-in-java/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T19:25:09+08:00" itemprop="datePublished" title="2023-02-16 19:25">2023-02-16 19:25</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I just had an interview where I was asked to create a <em><strong>memory leak</strong></em> with
Java.</p>
<p>Needless to say, I felt pretty dumb, having no idea how to start creating one.</p>
<p>What would an example be?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Here's a good way to create a true memory leak (objects inaccessible by
running code but still stored in memory) in pure Java:</p>
<ol>
<li>The application creates a long-running thread (or use a thread pool to leak even faster).</li>
<li>The thread loads a class via an (optionally custom) <code>ClassLoader</code>.</li>
<li>The class allocates a large chunk of memory (e.g. <code>new byte[1000000]</code>), stores a strong reference to it in a static field, and then stores a reference to itself in a <code>ThreadLocal</code>. Allocating the extra memory is optional (leaking the class instance is enough), but it will make the leak work that much faster.</li>
<li>The application clears all references to the custom class or the <code>ClassLoader</code> it was loaded from.</li>
<li>Repeat.</li>
</ol>
<p>Due to the way <code>ThreadLocal</code> is implemented in Oracle's JDK, this creates a
memory leak:</p>
<ul>
<li>Each <code>Thread</code> has a private field <code>threadLocals</code>, which actually stores the thread-local values.</li>
<li>Each <em>key</em> in this map is a weak reference to a <code>ThreadLocal</code> object, so after that <code>ThreadLocal</code> object is garbage-collected, its entry is removed from the map.</li>
<li>But each <em>value</em> is a strong reference, so when a value (directly or indirectly) points to the <code>ThreadLocal</code> object that is its <em>key</em> , that object will neither be garbage-collected nor removed from the map as long as the thread lives.</li>
</ul>
<p>In this example, the chain of strong references looks like this:</p>
<p><code>Thread</code> object → <code>threadLocals</code> map → instance of example class → example
class → static <code>ThreadLocal</code> field → <code>ThreadLocal</code> object.</p>
<p>(The <code>ClassLoader</code> doesn't really play a role in creating the leak, it just
makes the leak worse because of this additional reference chain: example class
→ <code>ClassLoader</code> → all the classes it has loaded. It was even worse in many JVM
implementations, especially prior to Java 7, because classes and
<code>ClassLoader</code>s were allocated straight into permgen and were never garbage-
collected at all.)</p>
<p>A variation on this pattern is why application containers (like Tomcat) can
leak memory like a sieve if you frequently redeploy applications which happen
to use <code>ThreadLocal</code>s that in some way point back to themselves. This can
happen for a number of subtle reasons and is often hard to debug and/or fix.</p>
<p><strong>Update</strong> : Since lots of people keep asking for it, here's some example code
that shows this behavior in action.</p>
<p><br></p>
<h3>Suggest</h3>
<p><strong>Static field holding an object reference [especially a</strong> <em>final</em> <strong>field]</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">MemorableClass</span> {
    <span class="n">static</span> <span class="n">final</span> <span class="n">ArrayList</span> <span class="n">list</span> = <span class="nb">new</span> <span class="n">ArrayList</span>(<span class="mi">100</span>);
}
</pre></div>

<p><strong>(Unclosed) open streams (file , network, etc.)</strong></p>
<div class="code"><pre class="code literal-block">try {
    BufferedReader br = new BufferedReader(new FileReader(inputFile));
    ...
    ...
} catch (Exception e) {
    e.printStackTrace();
}
</pre></div>

<p><strong>Unclosed connections</strong></p>
<div class="code"><pre class="code literal-block">try {
    Connection conn = ConnectionFactory.getConnection();
    ...
    ...
} catch (Exception e) {
    e.printStackTrace();
}
</pre></div>

<p><strong>Areas that are unreachable from JVM's garbage collector</strong> , such as memory
allocated through native methods.</p>
<p>In web applications, some objects are stored in application scope until the
application is explicitly stopped or removed.</p>
<div class="code"><pre class="code literal-block">getServletContext().setAttribute("SOME_MAP", map);
</pre></div>

<p><strong>Incorrect or inappropriate JVM options</strong> , such as the <code>noclassgc</code> option on
IBM JDK that prevents unused class garbage collection</p>
<p>See IBM JDK settings.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/remove-a-file-from-a-git-repository-without-deleting-it-from-the-local-filesystem/" class="u-url">Remove a file from a Git repository without deleting it from the local filesystem</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/remove-a-file-from-a-git-repository-without-deleting-it-from-the-local-filesystem/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T19:24:22+08:00" itemprop="datePublished" title="2023-02-16 19:24">2023-02-16 19:24</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to remove a file from my repository.</p>
<div class="code"><pre class="code literal-block">git rm file_to_remove.txt
</pre></div>

<p>will remove the file from the repository, but it will also remove the file
from the local file system. How do I remove this file from the repo
<strong>without</strong> deleting my local copy of the file?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The <code>git rm</code> documentation states:</p>
<blockquote>
<p>When <code>--cached</code> is given, the staged content has to match either the tip of
the branch or the file on disk, allowing the file to be removed from just
the index.</p>
</blockquote>
<p>So, for a single file:</p>
<div class="code"><pre class="code literal-block">git rm --cached file_to_remove.txt
</pre></div>

<p>and for a single directory:</p>
<div class="code"><pre class="code literal-block">git rm --cached -r directory_to_remove
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>To remove an entire folder from the repo (like Resharper files), do this:</p>
<div class="code"><pre class="code literal-block">git rm -r --cached folderName
</pre></div>

<p>I had committed some resharper files, and did not want those to persist for
other project users.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-43.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-41.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
