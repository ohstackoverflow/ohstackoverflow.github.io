<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 575) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-575.html">
<link rel="prev" href="index-576.html" type="text/html">
<link rel="next" href="index-574.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-split-a-string-into-an-array-in-bash/" class="u-url">How to split a string into an array in Bash?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-split-a-string-into-an-array-in-bash/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T10:23:09+08:00" itemprop="datePublished" title="2023-02-17 10:23">2023-02-17 10:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In a Bash script, I would like to split a line into pieces and store them in
an array.</p>
<p>For example, given the line:</p>
<div class="code"><pre class="code literal-block">Paris, France, Europe
</pre></div>

<p>I would like to have the resulting array to look like so:</p>
<div class="code"><pre class="code literal-block">array[0] = Paris
array[1] = France
array[2] = Europe
</pre></div>

<p>A simple implementation is preferable; speed does not matter. How can I do it?</p>
<p><br><br></p>
<h2>Answer</h2>
<div class="code"><pre class="code literal-block">IFS=', ' read -r -a array &lt;&lt;&lt; "$string"
</pre></div>

<p>Note that the characters in <code>$IFS</code> are treated individually as separators so
that in this case fields may be separated by <em>either</em> a comma or a space
rather than the sequence of the two characters. Interestingly though, empty
fields aren't created when comma-space appears in the input because the space
is treated specially.</p>
<p>To access an individual element:</p>
<div class="code"><pre class="code literal-block">echo<span class="w"> </span>"<span class="cp">${</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="cp">}</span>"
</pre></div>

<p>To iterate over the elements:</p>
<div class="code"><pre class="code literal-block">for<span class="w"> </span>element<span class="w"> </span>in<span class="w"> </span>"<span class="cp">${</span><span class="n">array</span><span class="p">[</span><span class="o">@</span><span class="p">]</span><span class="cp">}</span>"
do
<span class="w">    </span>echo<span class="w"> </span>"<span class="nv">$element</span>"
done
</pre></div>

<p>To get both the index and the value:</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="ss">"${!array[@]}"</span>
<span class="n">do</span>
<span class="w">    </span><span class="n">echo</span><span class="w"> </span><span class="ss">"$index ${array[index]}"</span>
<span class="n">done</span>
</pre></div>

<p>The last example is useful because Bash arrays are sparse. In other words, you
can delete an element or add an element and then the indices are not
contiguous.</p>
<div class="code"><pre class="code literal-block">unset "array[1]"
array[42]=Earth
</pre></div>

<p>To get the number of elements in an array:</p>
<div class="code"><pre class="code literal-block">echo<span class="w"> </span>"<span class="cp">${</span><span class="c1">#array[@]</span><span class="cp">}</span>"
</pre></div>

<p>As mentioned above, arrays can be sparse so you shouldn't use the length to
get the last element. Here's how you can in Bash 4.2 and later:</p>
<div class="code"><pre class="code literal-block">echo<span class="w"> </span>"<span class="cp">${</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="cp">}</span>"
</pre></div>

<p>in any version of Bash (from somewhere after 2.05b):</p>
<div class="code"><pre class="code literal-block">echo<span class="w"> </span>"<span class="cp">${</span><span class="n">array</span><span class="p">[</span><span class="o">@</span><span class="p">]:</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="cp">}</span>"
</pre></div>

<p>Larger negative offsets select farther from the end of the array. Note the
space before the minus sign in the older form. It is required.</p>
<p><br></p>
<h3>Suggest</h3>
<p>All of the answers to this question are wrong in one way or another.</p>
<hr>
<p><strong><em>Wrong answer #1</em></strong></p>
<div class="code"><pre class="code literal-block">IFS=', ' read -r -a array &lt;&lt;&lt; "$string"
</pre></div>

<p><strong>1:</strong> This is a misuse of <code>$IFS</code>. The value of the <code>$IFS</code> variable is <strong>not</strong>
taken as a <em>single variable-length</em> string separator, rather it is taken as a
<em>set</em> of <em>single-character</em> string separators, where each field that <code>read</code>
splits off from the input line can be terminated by <em>any</em> character in the set
(comma <strong>or</strong> space, in this example).</p>
<p>Actually, for the real sticklers out there, the full meaning of <code>$IFS</code> is
slightly more involved. From the bash manual:</p>
<blockquote>
<p>The shell treats each character of <strong>IFS</strong> as a delimiter, and splits the
results of the other expansions into words using these characters as field
terminators. If <strong>IFS</strong> is unset, or its value is exactly <strong>&lt;
space&gt;<tab><newline></newline></tab></strong>, the default, then sequences of <strong>&lt; space&gt;</strong>, <strong>&lt;
tab&gt;</strong>, and <strong>&lt; newline&gt;</strong> at the beginning and end of the results of the
previous expansions are ignored, and any sequence of <strong>IFS</strong> characters not
at the beginning or end serves to delimit words. If <strong>IFS</strong> has a value
other than the default, then sequences of the whitespace characters <strong>&lt;
space&gt;</strong>, <strong>&lt; tab&gt;</strong>, and <strong>&lt; newline&gt;</strong> are ignored at the beginning and
end of the word, as long as the whitespace character is in the value of
<strong>IFS</strong> (an <strong>IFS</strong> whitespace character). Any character in <strong>IFS</strong> that is
not <strong>IFS</strong> whitespace, along with any adjacent <strong>IFS</strong> whitespace
characters, delimits a field. A sequence of <strong>IFS</strong> whitespace characters is
also treated as a delimiter. If the value of <strong>IFS</strong> is null, no word
splitting occurs.</p>
</blockquote>
<p>Basically, for non-default non-null values of <code>$IFS</code>, fields can be separated
with either (1) a sequence of one or more characters that are all from the set
of "IFS whitespace characters" (that is, whichever of <strong>&lt; space&gt;</strong>, <strong>&lt;
tab&gt;</strong>, and <strong>&lt; newline&gt;</strong> ("newline" meaning line feed (LF)) are present
anywhere in <code>$IFS</code>), or (2) any non-"IFS whitespace character" that's present
in <code>$IFS</code> along with whatever "IFS whitespace characters" surround it in the
input line.</p>
<p>For the OP, it's possible that the second separation mode I described in the
previous paragraph is exactly what he wants for his input string, but we can
be pretty confident that the first separation mode I described is not correct
at all. For example, what if his input string was <code>'Los Angeles, United
States, North America'</code>?</p>
<div class="code"><pre class="code literal-block">IFS=', ' read -ra a &lt;&lt;&lt;'Los Angeles, United States, North America'; declare -p a;
## declare -a a=([0]="Los" [1]="Angeles" [2]="United" [3]="States" [4]="North" [5]="America")
</pre></div>

<p><strong>2:</strong> Even if you were to use this solution with a single-character separator
(such as a comma by itself, that is, with no following space or other
baggage), if the value of the <code>$string</code> variable happens to contain any LFs,
then <code>read</code> will stop processing once it encounters the first LF. The <code>read</code>
builtin only processes one line per invocation. This is true even if you are
piping or redirecting input <em>only</em> to the <code>read</code> statement, as we are doing in
this example with the here-string mechanism, and thus unprocessed input is
guaranteed to be lost. The code that powers the <code>read</code> builtin has no
knowledge of the data flow within its containing command structure.</p>
<p>You could argue that this is unlikely to cause a problem, but still, it's a
subtle hazard that should be avoided if possible. It is caused by the fact
that the <code>read</code> builtin actually does two levels of input splitting: first
into lines, then into fields. Since the OP only wants one level of splitting,
this usage of the <code>read</code> builtin is not appropriate, and we should avoid it.</p>
<p><strong>3:</strong> A non-obvious potential issue with this solution is that <code>read</code> always
drops the trailing field if it is empty, although it preserves empty fields
otherwise. Here's a demo:</p>
<div class="code"><pre class="code literal-block">string=', , a, , b, c, , , '; IFS=', ' read -ra a &lt;&lt;&lt;"$string"; declare -p a;
## declare -a a=([0]="" [1]="" [2]="a" [3]="" [4]="b" [5]="c" [6]="" [7]="")
</pre></div>

<p>Maybe the OP wouldn't care about this, but it's still a limitation worth
knowing about. It reduces the robustness and generality of the solution.</p>
<p>This problem can be solved by appending a dummy trailing delimiter to the
input string just prior to feeding it to <code>read</code>, as I will demonstrate later.</p>
<hr>
<p><strong><em>Wrong answer #2</em></strong></p>
<div class="code"><pre class="code literal-block">string="1:2:3:4:5"
set<span class="w"> </span>-f<span class="w">                     </span>#<span class="w"> </span>avoid<span class="w"> </span>globbing<span class="w"> </span>(expansion<span class="w"> </span>of<span class="w"> </span>*).
array=(<span class="cp">${</span><span class="n">string</span><span class="o">//</span><span class="p">:</span><span class="o">/</span> <span class="cp">}</span>)
</pre></div>

<p>Similar idea:</p>
<div class="code"><pre class="code literal-block">t="one,two,three"
a=($(echo $t | tr ',' "\n"))
</pre></div>

<p>(Note: I added the missing parentheses around the command substitution which
the answerer seems to have omitted.)</p>
<p>Similar idea:</p>
<div class="code"><pre class="code literal-block">string="1,2,3,4"
array=(`echo $string | sed 's/,/\n/g'`)
</pre></div>

<p>These solutions leverage word splitting in an array assignment to split the
string into fields. Funnily enough, just like <code>read</code>, general word splitting
also uses the <code>$IFS</code> special variable, although in this case it is implied
that it is set to its default value of <strong>&lt; space&gt;<tab><newline></newline></tab></strong>, and
therefore any sequence of one or more IFS characters (which are all whitespace
characters now) is considered to be a field delimiter.</p>
<p>This solves the problem of two levels of splitting committed by <code>read</code>, since
word splitting by itself constitutes only one level of splitting. But just as
before, the problem here is that the individual fields in the input string can
already contain <code>$IFS</code> characters, and thus they would be improperly split
during the word splitting operation. This happens to not be the case for any
of the sample input strings provided by these answerers (how convenient...),
but of course that doesn't change the fact that any code base that used this
idiom would then run the risk of blowing up if this assumption were ever
violated at some point down the line. Once again, consider my counterexample
of <code>'Los Angeles, United States, North America'</code> (or <code>'Los Angeles:United
States:North America'</code>).</p>
<p>Also, word splitting is normally followed by filename expansion ( <em>aka</em>
pathname expansion <em>aka</em> globbing), which, if done, would potentially corrupt
words containing the characters <code>*</code>, <code>?</code>, or <code>[</code> followed by <code>]</code> (and, if
<code>extglob</code> is set, parenthesized fragments preceded by <code>?</code>, <code>*</code>, <code>+</code>, <code>@</code>, or
<code>!</code>) by matching them against file system objects and expanding the words
("globs") accordingly. The first of these three answerers has cleverly
undercut this problem by running <code>set -f</code> beforehand to disable globbing.
Technically this works (although you should probably add <code>set +f</code> afterward to
reenable globbing for subsequent code which may depend on it), but it's
undesirable to have to mess with global shell settings in order to hack a
basic string-to-array parsing operation in local code.</p>
<p>Another issue with this answer is that all empty fields will be lost. This may
or may not be a problem, depending on the application.</p>
<p>Note: If you're going to use this solution, it's better to use the
<code>${string//:/ }</code> "pattern substitution" form of parameter expansion, rather
than going to the trouble of invoking a command substitution (which forks the
shell), starting up a pipeline, and running an external executable (<code>tr</code> or
<code>sed</code>), since parameter expansion is purely a shell-internal operation. (Also,
for the <code>tr</code> and <code>sed</code> solutions, the input variable should be double-quoted
inside the command substitution; otherwise word splitting would take effect in
the <code>echo</code> command and potentially mess with the field values. Also, the
<code>$(...)</code> form of command substitution is preferable to the old <code>...</code> form
since it simplifies nesting of command substitutions and allows for better
syntax highlighting by text editors.)</p>
<hr>
<p><strong><em>Wrong answer #3</em></strong></p>
<div class="code"><pre class="code literal-block">str="a,<span class="w"> </span>b,<span class="w"> </span>c,<span class="w"> </span>d"<span class="w">  </span>#<span class="w"> </span>assuming<span class="w"> </span>there<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>space<span class="w"> </span>after<span class="w"> </span>','<span class="w"> </span>as<span class="w"> </span>in<span class="w"> </span>Q
arr=(<span class="cp">${</span><span class="nb">str</span><span class="o">//</span><span class="p">,</span><span class="o">/</span><span class="cp">}</span>)<span class="w">  </span>#<span class="w"> </span>delete<span class="w"> </span>all<span class="w"> </span>occurrences<span class="w"> </span>of<span class="w"> </span>','
</pre></div>

<p>This answer is almost the same as <strong>#2</strong>. The difference is that the answerer
has made the assumption that the fields are delimited by two characters, one
of which being represented in the default <code>$IFS</code>, and the other not. He has
solved this rather specific case by removing the non-IFS-represented character
using a pattern substitution expansion and then using word splitting to split
the fields on the surviving IFS-represented delimiter character.</p>
<p>This is not a very generic solution. Furthermore, it can be argued that the
comma is really the "primary" delimiter character here, and that stripping it
and then depending on the space character for field splitting is simply wrong.
Once again, consider my counterexample: <code>'Los Angeles, United States, North
America'</code>.</p>
<p>Also, again, filename expansion could corrupt the expanded words, but this can
be prevented by temporarily disabling globbing for the assignment with <code>set
-f</code> and then <code>set +f</code>.</p>
<p>Also, again, all empty fields will be lost, which may or may not be a problem
depending on the application.</p>
<hr>
<p><strong><em>Wrong answer #4</em></strong></p>
<div class="code"><pre class="code literal-block">string='first<span class="w"> </span>line
second<span class="w"> </span>line
third<span class="w"> </span>line'

oldIFS="<span class="nv">$IFS</span>"
IFS='
'
IFS=<span class="cp">${</span><span class="n">IFS</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="cp">}</span><span class="w"> </span>#<span class="w"> </span>this<span class="w"> </span>is<span class="w"> </span>useful<span class="w"> </span>to<span class="w"> </span>format<span class="w"> </span>your<span class="w"> </span>code<span class="w"> </span>with<span class="w"> </span>tabs
lines=(<span class="w"> </span><span class="nv">$string</span><span class="w"> </span>)
IFS="<span class="nv">$oldIFS</span>"
</pre></div>

<p>This is similar to <strong>#2</strong> and <strong>#3</strong> in that it uses word splitting to get the
job done, only now the code explicitly sets <code>$IFS</code> to contain only the single-
character field delimiter present in the input string. It should be repeated
that this cannot work for multicharacter field delimiters such as the OP's
comma-space delimiter. But for a single-character delimiter like the LF used
in this example, it actually comes close to being perfect. The fields cannot
be unintentionally split in the middle as we saw with previous wrong answers,
and there is only one level of splitting, as required.</p>
<p>One problem is that filename expansion will corrupt affected words as
described earlier, although once again this can be solved by wrapping the
critical statement in <code>set -f</code> and <code>set +f</code>.</p>
<p>Another potential problem is that, since LF qualifies as an "IFS whitespace
character" as defined earlier, all empty fields will be lost, just as in
<strong>#2</strong> and <strong>#3</strong>. This would of course not be a problem if the delimiter
happens to be a non-"IFS whitespace character", and depending on the
application it may not matter anyway, but it does vitiate the generality of
the solution.</p>
<p>So, to sum up, assuming you have a one-character delimiter, and it is either a
non-"IFS whitespace character" or you don't care about empty fields, and you
wrap the critical statement in <code>set -f</code> and <code>set +f</code>, then this solution
works, but otherwise not.</p>
<p>(Also, for information's sake, assigning a LF to a variable in bash can be
done more easily with the <code>$'...'</code> syntax, e.g. <code>IFS=$'\n';</code>.)</p>
<hr>
<p><strong><em>Wrong answer #5</em></strong></p>
<div class="code"><pre class="code literal-block">countries='Paris, France, Europe'
OIFS="$IFS"
IFS=', ' array=($countries)
IFS="$OIFS"
</pre></div>

<p>Similar idea:</p>
<div class="code"><pre class="code literal-block">IFS=', ' eval 'array=($string)'
</pre></div>

<p>This solution is effectively a cross between <strong>#1</strong> (in that it sets <code>$IFS</code> to
comma-space) and <strong>#2-4</strong> (in that it uses word splitting to split the string
into fields). Because of this, it suffers from most of the problems that
afflict all of the above wrong answers, sort of like the worst of all worlds.</p>
<p>Also, regarding the second variant, it may seem like the <code>eval</code> call is
completely unnecessary, since its argument is a single-quoted string literal,
and therefore is statically known. But there's actually a very non-obvious
benefit to using <code>eval</code> in this way. Normally, when you run a simple command
which consists of a variable assignment <em>only</em> , meaning without an actual
command word following it, the assignment takes effect in the shell
environment:</p>
<div class="code"><pre class="code literal-block">IFS=', '; ## changes $IFS in the shell environment
</pre></div>

<p>This is true even if the simple command involves <em>multiple</em> variable
assignments; again, as long as there's no command word, all variable
assignments affect the shell environment:</p>
<div class="code"><pre class="code literal-block">IFS=', ' array=($countries); ## changes both $IFS and $array in the shell environment
</pre></div>

<p>But, if the variable assignment is attached to a command name (I like to call
this a "prefix assignment") then it does <em>not</em> affect the shell environment,
and instead only affects the environment of the executed command, regardless
whether it is a builtin or external:</p>
<div class="code"><pre class="code literal-block"><span class="n">IFS</span><span class="o">=</span><span class="p">',</span><span class="w"> </span><span class="p">'</span><span class="w"> </span><span class="o">:</span><span class="p">;</span><span class="w"> </span><span class="p">##</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">builtin</span><span class="w"> </span><span class="n">command</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">$IFS</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">outlive</span><span class="w"> </span><span class="n">it</span>
<span class="n">IFS</span><span class="o">=</span><span class="p">',</span><span class="w"> </span><span class="p">'</span><span class="w"> </span><span class="n">env</span><span class="p">;</span><span class="w"> </span><span class="p">##</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">command</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">$IFS</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">outlive</span><span class="w"> </span><span class="n">it</span>
</pre></div>

<p>Relevant quote from the bash manual:</p>
<blockquote>
<p>If no command name results, the variable assignments affect the current
shell environment. Otherwise, the variables are added to the environment of
the executed command and do not affect the current shell environment.</p>
</blockquote>
<p>It is possible to exploit this feature of variable assignment to change <code>$IFS</code>
only temporarily, which allows us to avoid the whole save-and-restore gambit
like that which is being done with the <code>$OIFS</code> variable in the first variant.
But the challenge we face here is that the command we need to run is itself a
mere variable assignment, and hence it would not involve a command word to
make the <code>$IFS</code> assignment temporary. You might think to yourself, well why
not just add a no-op command word to the statement like the <code>: builtin</code> to
make the <code>$IFS</code> assignment temporary? This does not work because it would then
make the <code>$array</code> assignment temporary as well:</p>
<div class="code"><pre class="code literal-block">IFS=', ' array=($countries) :; ## fails; new $array value never escapes the : command
</pre></div>

<p>So, we're effectively at an impasse, a bit of a catch-22. But, when <code>eval</code>
runs its code, it runs it in the shell environment, as if it was normal,
static source code, and therefore we can run the <code>$array</code> assignment inside
the <code>eval</code> argument to have it take effect in the shell environment, while the
<code>$IFS</code> prefix assignment that is prefixed to the <code>eval</code> command will not
outlive the <code>eval</code> command. This is exactly the trick that is being used in
the second variant of this solution:</p>
<div class="code"><pre class="code literal-block">IFS=', ' eval 'array=($string)'; ## $IFS does not outlive the eval command, but $array does
</pre></div>

<p>So, as you can see, it's actually quite a clever trick, and accomplishes
exactly what is required (at least with respect to assignment effectation) in
a rather non-obvious way. I'm actually not against this trick in general,
despite the involvement of <code>eval</code>; just be careful to single-quote the
argument string to guard against security threats.</p>
<p>But again, because of the "worst of all worlds" agglomeration of problems,
this is still a wrong answer to the OP's requirement.</p>
<hr>
<p><strong><em>Wrong answer #6</em></strong></p>
<div class="code"><pre class="code literal-block">IFS=', '; array=(Paris, France, Europe)

IFS=' ';declare -a array=(Paris France Europe)
</pre></div>

<p>Um... what? The OP has a string variable that needs to be parsed into an
array. This "answer" starts with the verbatim contents of the input string
pasted into an array literal. I guess that's one way to do it.</p>
<p>It looks like the answerer may have assumed that the <code>$IFS</code> variable affects
all bash parsing in all contexts, which is not true. From the bash manual:</p>
<blockquote>
<p><strong>IFS</strong> The Internal Field Separator that is used for word splitting after
expansion and to split lines into words with the <strong>read</strong> builtin command.
The default value is <strong>&lt; space&gt;<tab><newline></newline></tab></strong>.</p>
</blockquote>
<p>So the <code>$IFS</code> special variable is actually only used in two contexts: (1) word
splitting that is performed <em>after expansion</em> (meaning <em>not</em> when parsing bash
source code) and (2) for splitting input lines into words by the <code>read</code>
builtin.</p>
<p>Let me try to make this clearer. I think it might be good to draw a
distinction between <em>parsing</em> and <em>execution</em>. Bash must first <em>parse</em> the
source code, which obviously is a <em>parsing</em> event, and then later it
<em>executes</em> the code, which is when expansion comes into the picture. Expansion
is really an <em>execution</em> event. Furthermore, I take issue with the description
of the <code>$IFS</code> variable that I just quoted above; rather than saying that word
splitting is performed <em>after expansion</em> , I would say that word splitting is
performed <em>during</em> expansion, or, perhaps even more precisely, word splitting
is <em>part of</em> the expansion process. The phrase "word splitting" refers only to
this step of expansion; it should never be used to refer to the parsing of
bash source code, although unfortunately the docs do seem to throw around the
words "split" and "words" a lot. Here's a relevant excerpt from the
linux.die.net version of the bash manual:</p>
<blockquote>
<p>Expansion is performed on the command line after it has been split into
words. There are seven kinds of expansion performed: <em>brace expansion</em> ,
<em>tilde expansion</em> , <em>parameter and variable expansion</em> , <em>command
substitution</em> , <em>arithmetic expansion</em> , <em>word splitting</em> , and <em>pathname
expansion</em>.</p>
<p>The order of expansions is: brace expansion; tilde expansion, parameter and
variable expansion, arithmetic expansion, and command substitution (done in
a left-to-right fashion); word splitting; and pathname expansion.</p>
</blockquote>
<p>You could argue the GNU version of the manual does slightly better, since it
opts for the word "tokens" instead of "words" in the first sentence of the
Expansion section:</p>
<blockquote>
<p>Expansion is performed on the command line after it has been split into
tokens.</p>
</blockquote>
<p>The important point is, <code>$IFS</code> does not change the way bash parses source
code. Parsing of bash source code is actually a very complex process that
involves recognition of the various elements of shell grammar, such as command
sequences, command lists, pipelines, parameter expansions, arithmetic
substitutions, and command substitutions. For the most part, the bash parsing
process cannot be altered by user-level actions like variable assignments
(actually, there are some minor exceptions to this rule; for example, see the
various <code>compatxx</code> shell settings, which can change certain aspects of parsing
behavior on-the-fly). The upstream "words"/"tokens" that result from this
complex parsing process are then expanded according to the general process of
"expansion" as broken down in the above documentation excerpts, where word
splitting of the expanded (expanding?) text into downstream words is simply
one step of that process. Word splitting only touches text that has been spit
out of a preceding expansion step; it does not affect literal text that was
parsed right off the source bytestream.</p>
<hr>
<p><strong><em>Wrong answer #7</em></strong></p>
<div class="code"><pre class="code literal-block"><span class="nv">string</span><span class="o">=</span><span class="err">'first line</span>
<span class="err">        second line</span>
<span class="w">        </span><span class="nv">third</span><span class="w"> </span><span class="nv">line</span><span class="err">'</span>

<span class="err">while read -r line; do lines+=("$line"); done &lt;&lt;&lt;"$string"</span>
</pre></div>

<p>This is one of the best solutions. Notice that we're back to using <code>read</code>.
Didn't I say earlier that <code>read</code> is inappropriate because it performs two
levels of splitting, when we only need one? The trick here is that you can
call <code>read</code> in such a way that it effectively only does one level of
splitting, specifically by splitting off only one field per invocation, which
necessitates the cost of having to call it repeatedly in a loop. It's a bit of
a sleight of hand, but it works.</p>
<p>But there are problems. First: When you provide at least one <em>NAME</em> argument
to <code>read</code>, it automatically ignores leading and trailing whitespace in each
field that is split off from the input string. This occurs whether <code>$IFS</code> is
set to its default value or not, as described earlier in this post. Now, the
OP may not care about this for his specific use-case, and in fact, it may be a
desirable feature of the parsing behavior. But not everyone who wants to parse
a string into fields will want this. There is a solution, however: A somewhat
non-obvious usage of <code>read</code> is to pass zero <em>NAME</em> arguments. In this case,
<code>read</code> will store the entire input line that it gets from the input stream in
a variable named <code>$REPLY</code>, and, as a bonus, it does <em>not</em> strip leading and
trailing whitespace from the value. This is a very robust usage of <code>read</code>
which I've exploited frequently in my shell programming career. Here's a
demonstration of the difference in behavior:</p>
<div class="code"><pre class="code literal-block"><span class="nv">string</span><span class="o">=</span>$<span class="s1">'  a  b  \n  c  d  \n  e  f  '</span><span class="c1">; ## input string</span>

<span class="nv">a</span><span class="o">=</span><span class="ss">()</span><span class="c1">; while read -r line; do a+=("$line"); done &lt;&lt;&lt;"$string"; declare -p a;</span>
##<span class="w"> </span><span class="nv">declare</span><span class="w"> </span><span class="o">-</span><span class="nv">a</span><span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="ss">(</span>[<span class="mi">0</span>]<span class="o">=</span><span class="s2">"a  b"</span><span class="w"> </span>[<span class="mi">1</span>]<span class="o">=</span><span class="s2">"c  d"</span><span class="w"> </span>[<span class="mi">2</span>]<span class="o">=</span><span class="s2">"e  f"</span><span class="ss">)</span><span class="w"> </span>##<span class="w"> </span><span class="nv">read</span><span class="w"> </span><span class="nv">trimmed</span><span class="w"> </span><span class="nv">surrounding</span><span class="w"> </span><span class="nv">whitespace</span>

<span class="nv">a</span><span class="o">=</span><span class="ss">()</span><span class="c1">; while read -r; do a+=("$REPLY"); done &lt;&lt;&lt;"$string"; declare -p a;</span>
##<span class="w"> </span><span class="nv">declare</span><span class="w"> </span><span class="o">-</span><span class="nv">a</span><span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="ss">(</span>[<span class="mi">0</span>]<span class="o">=</span><span class="s2">"  a  b  "</span><span class="w"> </span>[<span class="mi">1</span>]<span class="o">=</span><span class="s2">"  c  d  "</span><span class="w"> </span>[<span class="mi">2</span>]<span class="o">=</span><span class="s2">"  e  f  "</span><span class="ss">)</span><span class="w"> </span>##<span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">trimming</span>
</pre></div>

<p>The second issue with this solution is that it does not actually address the
case of a custom field separator, such as the OP's comma-space. As before,
multicharacter separators are not supported, which is an unfortunate
limitation of this solution. We could try to at least split on comma by
specifying the separator to the <code>-d</code> option, but look what happens:</p>
<div class="code"><pre class="code literal-block"><span class="nv">string</span><span class="o">=</span><span class="s1">'Paris, France, Europe'</span><span class="c1">;</span>
<span class="nv">a</span><span class="o">=</span><span class="ss">()</span><span class="c1">; while read -rd,; do a+=("$REPLY"); done &lt;&lt;&lt;"$string"; declare -p a;</span>
##<span class="w"> </span><span class="nv">declare</span><span class="w"> </span><span class="o">-</span><span class="nv">a</span><span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="ss">(</span>[<span class="mi">0</span>]<span class="o">=</span><span class="s2">"Paris"</span><span class="w"> </span>[<span class="mi">1</span>]<span class="o">=</span><span class="s2">" France"</span><span class="ss">)</span>
</pre></div>

<p>Predictably, the unaccounted surrounding whitespace got pulled into the field
values, and hence this would have to be corrected subsequently through
trimming operations (this could also be done directly in the while-loop). But
there's another obvious error: Europe is missing! What happened to it? The
answer is that <code>read</code> returns a failing return code if it hits end-of-file (in
this case we can call it end-of-string) without encountering a final field
terminator on the final field. This causes the while-loop to break prematurely
and we lose the final field.</p>
<p>Technically this same error afflicted the previous examples as well; the
difference there is that the field separator was taken to be LF, which is the
default when you don't specify the <code>-d</code> option, and the <code>&lt;&lt;&lt;</code> ("here-string")
mechanism automatically appends a LF to the string just before it feeds it as
input to the command. Hence, in those cases, we sort of <em>accidentally</em> solved
the problem of a dropped final field by unwittingly appending an additional
dummy terminator to the input. Let's call this solution the "dummy-terminator"
solution. We can apply the dummy-terminator solution manually for any custom
delimiter by concatenating it against the input string ourselves when
instantiating it in the here-string:</p>
<div class="code"><pre class="code literal-block"><span class="nv">a</span><span class="o">=</span><span class="ss">()</span><span class="c1">; while read -rd,; do a+=("$REPLY"); done &lt;&lt;&lt;"$string,"; declare -p a;</span>
<span class="nv">declare</span><span class="w"> </span><span class="o">-</span><span class="nv">a</span><span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="ss">(</span>[<span class="mi">0</span>]<span class="o">=</span><span class="s2">"Paris"</span><span class="w"> </span>[<span class="mi">1</span>]<span class="o">=</span><span class="s2">" France"</span><span class="w"> </span>[<span class="mi">2</span>]<span class="o">=</span><span class="s2">" Europe"</span><span class="ss">)</span>
</pre></div>

<p>There, problem solved. Another solution is to only break the while-loop if
both (1) <code>read</code> returned failure and (2) <code>$REPLY</code> is empty, meaning <code>read</code> was
not able to read any characters prior to hitting end-of-file. Demo:</p>
<div class="code"><pre class="code literal-block"><span class="nv">a</span><span class="o">=</span><span class="ss">()</span><span class="c1">; while read -rd,|| [[ -n "$REPLY" ]]; do a+=("$REPLY"); done &lt;&lt;&lt;"$string"; declare -p a;</span>
##<span class="w"> </span><span class="nv">declare</span><span class="w"> </span><span class="o">-</span><span class="nv">a</span><span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="ss">(</span>[<span class="mi">0</span>]<span class="o">=</span><span class="s2">"Paris"</span><span class="w"> </span>[<span class="mi">1</span>]<span class="o">=</span><span class="s2">" France"</span><span class="w"> </span>[<span class="mi">2</span>]<span class="o">=</span>$<span class="s1">' Europe\n'</span><span class="ss">)</span>
</pre></div>

<p>This approach also reveals the secretive LF that automatically gets appended
to the here-string by the <code>&lt;&lt;&lt;</code> redirection operator. It could of course be
stripped off separately through an explicit trimming operation as described a
moment ago, but obviously the manual dummy-terminator approach solves it
directly, so we could just go with that. The manual dummy-terminator solution
is actually quite convenient in that it solves both of these two problems (the
dropped-final-field problem and the appended-LF problem) in one go.</p>
<p>So, overall, this is quite a powerful solution. It's only remaining weakness
is a lack of support for multicharacter delimiters, which I will address
later.</p>
<hr>
<p><strong><em>Wrong answer #8</em></strong></p>
<div class="code"><pre class="code literal-block">string='first line
        second line
        third line'

readarray -t lines &lt;&lt;&lt;"$string"
</pre></div>

<p>(This is actually from the same post as <strong>#7</strong> ; the answerer provided two
solutions in the same post.)</p>
<p>The <code>readarray</code> builtin, which is a synonym for <code>mapfile</code>, is ideal. It's a
builtin command which parses a bytestream into an array variable in one shot;
no messing with loops, conditionals, substitutions, or anything else. And it
doesn't surreptitiously strip any whitespace from the input string. And (if
<code>-O</code> is not given) it conveniently clears the target array before assigning to
it. But it's still not perfect, hence my criticism of it as a "wrong answer".</p>
<p>First, just to get this out of the way, note that, just like the behavior of
<code>read</code> when doing field-parsing, <code>readarray</code> drops the trailing field if it is
empty. Again, this is probably not a concern for the OP, but it could be for
some use-cases. I'll come back to this in a moment.</p>
<p>Second, as before, it does not support multicharacter delimiters. I'll give a
fix for this in a moment as well.</p>
<p>Third, the solution as written does not parse the OP's input string, and in
fact, it cannot be used as-is to parse it. I'll expand on this momentarily as
well.</p>
<p>For the above reasons, I still consider this to be a "wrong answer" to the
OP's question. Below I'll give what I consider to be the right answer.</p>
<hr>
<p><strong>Right answer</strong></p>
<p>Here's a naïve attempt to make <strong>#8</strong> work by just specifying the <code>-d</code> option:</p>
<div class="code"><pre class="code literal-block">string='Paris, France, Europe';
readarray -td, a &lt;&lt;&lt;"$string"; declare -p a;
## declare -a a=([0]="Paris" [1]=" France" [2]=$' Europe\n')
</pre></div>

<p>We see the result is identical to the result we got from the double-
conditional approach of the looping <code>read</code> solution discussed in <strong>#7</strong>. We
can <em>almost</em> solve this with the manual dummy-terminator trick:</p>
<div class="code"><pre class="code literal-block">readarray -td, a &lt;&lt;&lt;"$string,"; declare -p a;
## declare -a a=([0]="Paris" [1]=" France" [2]=" Europe" [3]=$'\n')
</pre></div>

<p>The problem here is that <code>readarray</code> preserved the trailing field, since the
<code>&lt;&lt;&lt;</code> redirection operator appended the LF to the input string, and therefore
the trailing field was <em>not</em> empty (otherwise it would've been dropped). We
can take care of this by explicitly unsetting the final array element after-
the-fact:</p>
<div class="code"><pre class="code literal-block">readarray -td, a &lt;&lt;&lt;"$string,"; unset 'a[-1]'; declare -p a;
## declare -a a=([0]="Paris" [1]=" France" [2]=" Europe")
</pre></div>

<p>The only two problems that remain, which are actually related, are (1) the
extraneous whitespace that needs to be trimmed, and (2) the lack of support
for multicharacter delimiters.</p>
<p>The whitespace could of course be trimmed afterward (for example, see How to
trim whitespace from a Bash variable?). But if we can hack a multicharacter
delimiter, then that would solve both problems in one shot.</p>
<p>Unfortunately, there's no <em>direct</em> way to get a multicharacter delimiter to
work. The best solution I've thought of is to preprocess the input string to
replace the multicharacter delimiter with a single-character delimiter that
will be guaranteed not to collide with the contents of the input string. The
only character that has this guarantee is the NUL byte. This is because, in
bash (though not in zsh, incidentally), variables cannot contain the NUL byte.
This preprocessing step can be done inline in a process substitution. Here's
how to do it using awk:</p>
<div class="code"><pre class="code literal-block">readarray -td '' a &lt; &lt;(awk '{ gsub(/, /,"\0"); print; }' &lt;&lt;&lt;"$string, "); unset 'a[-1]';
declare -p a;
## declare -a a=([0]="Paris" [1]="France" [2]="Europe")
</pre></div>

<p>There, finally! This solution will not erroneously split fields in the middle,
will not cut out prematurely, will not drop empty fields, will not corrupt
itself on filename expansions, will not automatically strip leading and
trailing whitespace, will not leave a stowaway LF on the end, does not require
loops, and does not settle for a single-character delimiter.</p>
<hr>
<p><strong>Trimming solution</strong></p>
<p>Lastly, I wanted to demonstrate my own fairly intricate trimming solution
using the obscure <code>-C callback</code> option of <code>readarray</code>. Unfortunately, I've run
out of room against Stack Overflow's draconian 30,000 character post limit, so
I won't be able to explain it. I'll leave that as an exercise for the reader.</p>
<div class="code"><pre class="code literal-block">function<span class="w"> </span>mfcb<span class="w"> </span>{<span class="w"> </span>local<span class="w"> </span>val="$4";<span class="w"> </span>"$1";<span class="w"> </span>eval<span class="w"> </span>"$2[$3]=\<span class="nv">$val</span>;";<span class="w"> </span>};
function<span class="w"> </span>val_ltrim<span class="w"> </span>{<span class="w"> </span>if<span class="w"> </span>[[<span class="w"> </span>"<span class="nv">$val</span>"<span class="w"> </span>=~<span class="w"> </span>^[[:space:]]+<span class="w"> </span>]];<span class="w"> </span>then<span class="w"> </span>val="<span class="cp">${</span><span class="n">val</span><span class="p">:</span><span class="err">$</span><span class="p">{</span><span class="c1">#BASH_REMATCH[0]</span><span class="cp">}</span>}";<span class="w"> </span>fi;<span class="w"> </span>};
function<span class="w"> </span>val_rtrim<span class="w"> </span>{<span class="w"> </span>if<span class="w"> </span>[[<span class="w"> </span>"<span class="nv">$val</span>"<span class="w"> </span>=~<span class="w"> </span>[[:space:]]+$<span class="w"> </span>]];<span class="w"> </span>then<span class="w"> </span>val="<span class="cp">${</span><span class="n">val</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="err">$</span><span class="p">{</span><span class="c1">#val</span><span class="cp">}</span>-<span class="cp">${</span><span class="c1">#BASH_REMATCH[0]</span><span class="cp">}</span>}";<span class="w"> </span>fi;<span class="w"> </span>};
function<span class="w"> </span>val_trim<span class="w"> </span>{<span class="w"> </span>val_ltrim;<span class="w"> </span>val_rtrim;<span class="w"> </span>};
readarray<span class="w"> </span>-c1<span class="w"> </span>-C<span class="w"> </span>'mfcb<span class="w"> </span>val_trim<span class="w"> </span>a'<span class="w"> </span>-td,<span class="w"> </span><span class="err">&lt;&lt;&lt;</span>"<span class="nv">$string</span>,";<span class="w"> </span>unset<span class="w"> </span>'a[-1]';<span class="w"> </span>declare<span class="w"> </span>-p<span class="w"> </span>a;
##<span class="w"> </span>declare<span class="w"> </span>-a<span class="w"> </span>a=([0]="Paris"<span class="w"> </span>[1]="France"<span class="w"> </span>[2]="Europe")
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-is-my-variable-unaltered-after-i-modify-it-inside-of-a-function-asynchronous-code-reference/" class="u-url">Why is my variable unaltered after I modify it inside of a function? - Asynchronous code reference</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-is-my-variable-unaltered-after-i-modify-it-inside-of-a-function-asynchronous-code-reference/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T10:22:40+08:00" itemprop="datePublished" title="2023-02-17 10:22">2023-02-17 10:22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Given the following examples, why is <code>outerScopeVar</code> undefined in all cases?</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">outerScopeVar</span><span class="p">;</span>

<span class="k">var</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s1">'img'</span><span class="p">);</span>
<span class="n">img</span><span class="o">.</span><span class="n">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">outerScopeVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">width</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">img</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'lolcat.png'</span><span class="p">;</span>
<span class="n">alert</span><span class="p">(</span><span class="n">outerScopeVar</span><span class="p">);</span>



<span class="k">var</span><span class="w"> </span><span class="n">outerScopeVar</span><span class="p">;</span>
<span class="n">setTimeout</span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">outerScopeVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Hello Asynchronous World!'</span><span class="p">;</span>
<span class="p">},</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="n">alert</span><span class="p">(</span><span class="n">outerScopeVar</span><span class="p">);</span>



<span class="o">//</span><span class="w"> </span><span class="n">Example</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">jQuery</span>
<span class="k">var</span><span class="w"> </span><span class="n">outerScopeVar</span><span class="p">;</span>
<span class="o">$.</span><span class="n">post</span><span class="p">(</span><span class="s1">'loldog'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">outerScopeVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">;</span>
<span class="p">});</span>
<span class="n">alert</span><span class="p">(</span><span class="n">outerScopeVar</span><span class="p">);</span>



<span class="o">//</span><span class="w"> </span><span class="n">Node</span><span class="o">.</span><span class="n">js</span><span class="w"> </span><span class="n">example</span>
<span class="k">var</span><span class="w"> </span><span class="n">outerScopeVar</span><span class="p">;</span>
<span class="n">fs</span><span class="o">.</span><span class="n">readFile</span><span class="p">(</span><span class="s1">'./catdog.html'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">outerScopeVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="p">});</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">outerScopeVar</span><span class="p">);</span>



<span class="o">//</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">promises</span>
<span class="k">var</span><span class="w"> </span><span class="n">outerScopeVar</span><span class="p">;</span>
<span class="n">myPromise</span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">outerScopeVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">;</span>
<span class="p">});</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">outerScopeVar</span><span class="p">);</span>



<span class="o">//</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">observables</span>
<span class="k">var</span><span class="w"> </span><span class="n">outerScopeVar</span><span class="p">;</span>
<span class="n">myObservable</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">outerScopeVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">});</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">outerScopeVar</span><span class="p">);</span>



<span class="o">//</span><span class="w"> </span><span class="n">geolocation</span><span class="w"> </span><span class="n">API</span>
<span class="k">var</span><span class="w"> </span><span class="n">outerScopeVar</span><span class="p">;</span>
<span class="n">navigator</span><span class="o">.</span><span class="n">geolocation</span><span class="o">.</span><span class="n">getCurrentPosition</span><span class="p">(</span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">outerScopeVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pos</span><span class="p">;</span>
<span class="p">});</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">outerScopeVar</span><span class="p">);</span>
</pre></div>

<p>Why does it output <code>undefined</code> in all of these examples? I don't want
workarounds, I want to know <strong>why</strong> this is happening.</p>
<hr>
<blockquote>
<p><strong>Note:</strong> This is a canonical question for <em>JavaScript asynchronicity</em>. Feel
free to improve this question and add more simplified examples which the
community can identify with.</p>
</blockquote>
<p><br><br></p>
<h2>Answer</h2>
<p>One word answer: <strong>asynchronicity</strong>.</p>
<h3>Forewords</h3>
<p>This topic has been iterated at least a couple of thousands of times here in
Stack Overflow. Hence, first off I'd like to point out some extremely useful
resources:</p>
<ul>
<li>
<p>@Felix Kling's answer to "How do I return the response from an asynchronous call?". See his excellent answer explaining synchronous and asynchronous flows, as well as the "Restructure code" section.<br>
@Benjamin Gruenbaum has also put a lot of effort into explaining
asynchronicity in the same thread.</p>
</li>
<li>
<p>@Matt Esch's answer to "Get data from fs.readFile" also explains asynchronicity extremely well in a simple manner.</p>
</li>
</ul>
<hr>
<h3>The answer to the question at hand</h3>
<p>Let's trace the common behavior first. In all examples, the <code>outerScopeVar</code> is
modified inside of a <em>function</em>. That function is clearly not executed
immediately; it is being assigned or passed as an argument. That is what we
call a <em><strong>callback</strong></em>.</p>
<p>Now the question is, when is that callback called?</p>
<p>It depends on the case. Let's try to trace some common behavior again:</p>
<ul>
<li>
<code>img.onload</code> may be called <em>sometime in the future</em> when (and if) the image has successfully loaded.</li>
<li>
<code>setTimeout</code> may be called <em>sometime in the future</em> after the delay has expired and the timeout hasn't been canceled by <code>clearTimeout</code>. Note: even when using <code>0</code> as delay, all browsers have a minimum timeout delay cap (specified to be 4ms in the HTML5 spec).</li>
<li>jQuery <code>$.post</code>'s callback may be called <em>sometime in the future</em> when (and if) the Ajax request has been completed successfully.</li>
<li>Node.js's <code>fs.readFile</code> may be called <em>sometime in the future</em> when the file has been read successfully or thrown an error.</li>
</ul>
<p>In all cases, we have a callback that may run <em>sometime in the future</em>. This
"sometime in the future" is what we refer to as <strong>asynchronous flow</strong>.</p>
<p>Asynchronous execution is pushed out of the synchronous flow. That is, the
asynchronous code will <strong>never</strong> execute while the synchronous code stack is
executing. This is the meaning of JavaScript being single-threaded.</p>
<p>More specifically, when the JS engine is idle -- not executing a stack of
(a)synchronous code -- it will poll for events that may have triggered
asynchronous callbacks (e.g. expired timeout, received network response) and
execute them one after another. This is regarded as Event Loop.</p>
<p>That is, the asynchronous code highlighted in the hand-drawn red shapes may
execute only after all the remaining synchronous code in their respective code
blocks have executed:</p>
<p><img alt="async code highlighted" src="images/40IwM.png"></p>
<p>In short, the callback functions are created synchronously but executed
asynchronously. You can't rely on the execution of an asynchronous function
until you know it has been executed, and how to do that?</p>
<p>It is simple, really. The logic that depends on the asynchronous function
execution should be started/called from inside this asynchronous function. For
example, moving the <code>alert</code>s and <code>console.log</code>s inside the callback function
would output the expected result because the result is available at that
point.</p>
<h4>Implementing your own callback logic</h4>
<p>Often you need to do more things with the result from an asynchronous function
or do different things with the result depending on where the asynchronous
function has been called. Let's tackle a bit more complex example:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">outerScopeVar</span><span class="p">;</span>
<span class="n">helloCatAsync</span><span class="p">();</span>
<span class="n">alert</span><span class="p">(</span><span class="n">outerScopeVar</span><span class="p">);</span>

<span class="n">function</span><span class="w"> </span><span class="n">helloCatAsync</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">setTimeout</span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">outerScopeVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Nya'</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="n">Math</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><strong>Note:</strong> I'm using <code>setTimeout</code> with a random delay as a generic asynchronous
function; the same example applies to Ajax, <code>readFile</code>, <code>onload</code>, and any
other asynchronous flow.</p>
<p>This example clearly suffers from the same issue as the other examples; it is
not waiting until the asynchronous function executes.</p>
<p>Let's tackle it by implementing a callback system of our own. First off, we
get rid of that ugly <code>outerScopeVar</code> which is completely useless in this case.
Then we add a parameter that accepts a function argument, our callback. When
the asynchronous operation finishes, we call this callback, passing the
result. The implementation (please read the comments in order):</p>
<div class="code"><pre class="code literal-block"><span class="c1">// 1. Call helloCatAsync passing a callback function,</span>
<span class="c1">//    which will be called receiving the result from the async operation</span>
<span class="n">helloCatAsync</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 5. Received the result from the async function,</span>
<span class="w">    </span><span class="c1">//    now do whatever you want with it:</span>
<span class="w">    </span><span class="n">alert</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// 2. The "callback" parameter is a reference to the function which</span>
<span class="c1">//    was passed as an argument from the helloCatAsync call</span>
<span class="k">function</span><span class="w"> </span><span class="nf">helloCatAsync</span><span class="p">(</span>callback<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 3. Start async operation:</span>
<span class="w">    </span><span class="n">setTimeout</span><span class="p">(</span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 4. Finished async operation,</span>
<span class="w">        </span><span class="c1">//    call the callback, passing the result as an argument</span>
<span class="w">        </span><span class="n">callback</span><span class="p">(</span><span class="s">'Nya'</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Code snippet of the above example:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// 1. Call helloCatAsync passing a callback function,</span>
<span class="c1">//    which will be called receiving the result from the async operation</span>
<span class="n">console</span><span class="p">.</span><span class="nb">log</span><span class="p">(</span><span class="s">"1. function called..."</span><span class="p">)</span>
<span class="n">helloCatAsync</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 5. Received the result from the async function,</span>
<span class="w">    </span><span class="c1">//    now do whatever you want with it:</span>
<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="nb">log</span><span class="p">(</span><span class="s">"5. result is: "</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// 2. The "callback" parameter is a reference to the function which</span>
<span class="c1">//    was passed as an argument from the helloCatAsync call</span>
<span class="k">function</span><span class="w"> </span><span class="nf">helloCatAsync</span><span class="p">(</span>callback<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="nb">log</span><span class="p">(</span><span class="s">"2. callback here is the function passed as argument above..."</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// 3. Start async operation:</span>
<span class="w">    </span><span class="n">setTimeout</span><span class="p">(</span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="nb">log</span><span class="p">(</span><span class="s">"3. start async operation..."</span><span class="p">)</span>
<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="nb">log</span><span class="p">(</span><span class="s">"4. finished async operation, calling the callback, passing the result..."</span><span class="p">)</span>
<span class="w">        </span><span class="c1">// 4. Finished async operation,</span>
<span class="w">        </span><span class="c1">//    call the callback passing the result as argument</span>
<span class="w">        </span><span class="n">callback</span><span class="p">(</span><span class="s">'Nya'</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="n">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Most often in real use cases, the DOM API and most libraries already provide
the callback functionality (the <code>helloCatAsync</code> implementation in this
demonstrative example). You only need to pass the callback function and
understand that it will execute out of the synchronous flow and restructure
your code to accommodate for that.</p>
<p>You will also notice that due to the asynchronous nature, it is impossible to
<code>return</code> a value from an asynchronous flow back to the synchronous flow where
the callback was defined, as the asynchronous callbacks are executed long
after the synchronous code has already finished executing.</p>
<p>Instead of <code>return</code>ing a value from an asynchronous callback, you will have to
make use of the callback pattern, or... Promises.</p>
<h4>Promises</h4>
<p>Although there are ways to keep the callback hell at bay with vanilla JS,
promises are growing in popularity and are currently being standardized in ES6
(see Promise - MDN).</p>
<p>Promises (a.k.a. Futures) provide a more linear, and thus pleasant, reading of
the asynchronous code, but explaining their entire functionality is out of the
scope of this question. Instead, I'll leave these excellent resources for the
interested:</p>
<ul>
<li>JavaScript Promises - HTML5 Rocks</li>
<li>You're Missing the Point of Promises - domenic.me</li>
</ul>
<hr>
<h4>More reading material about JavaScript asynchronicity</h4>
<ul>
<li>The Art of Node - Callbacks explains asynchronous code and callbacks very well with vanilla JS examples and Node.js code as well.</li>
</ul>
<hr>
<blockquote>
<p><strong>Note:</strong> I've marked this answer as Community Wiki. Hence anyone with at
least 100 reputations can edit and improve it! Please feel free to improve
this answer or submit a completely new answer if you'd like as well.</p>
<p>I want to turn this question into a canonical topic to answer asynchronicity
issues that are unrelated to Ajax (there is How to return the response from
an AJAX call? for that), hence this topic needs your help to be as good and
helpful as possible!</p>
</blockquote>
<p><br></p>
<h3>Suggest</h3>
<p><em>Fabrício's answer is spot on; but I wanted to complement his answer with
something less technical, which focusses on an analogy to help explain the
concept of asynchronicity</em>.</p>
<hr>
<h4>An Analogy...</h4>
<p>Yesterday, the work I was doing required some information from a colleague. I
rang him up; here's how the conversation went:</p>
<blockquote>
<p><strong>Me</strong> : Hi Bob, I need to know how we <em>foo</em> 'd the <em>bar</em> 'd last week. Jim
wants a report on it, and you're the only one who knows the details about
it.</p>
<p><strong>Bob</strong> : Sure thing, but it'll take me around 30 minutes?</p>
<p><strong>Me</strong> : That's great Bob. Give me a ring back when you've got the
information!</p>
</blockquote>
<p>At this point, I hung up the phone. Since I needed information from Bob to
complete my report, I left the report and went for a coffee instead, then I
caught up on some email. 40 minutes later (Bob is slow), Bob called back and
gave me the information I needed. At this point, I resumed my work with my
report, as I had all the information I needed.</p>
<hr>
<p>Imagine if the conversation had gone like this instead;</p>
<blockquote>
<p><strong>Me</strong> : Hi Bob, I need to know how we <em>foo</em> 'd the <em>bar</em> 'd last week. Jim
want's a report on it, and you're the only one who knows the details about
it.</p>
<p><strong>Bob</strong> : Sure thing, but it'll take me around 30 minutes?</p>
<p><strong>Me</strong> : That's great Bob. I'll wait.</p>
</blockquote>
<p>And I sat there and waited. And waited. And waited. For 40 minutes. Doing
nothing but waiting. Eventually, Bob gave me the information, we hung up, and
I completed my report. But I'd lost 40 minutes of productivity.</p>
<hr>
<h4>This is asynchronous vs. synchronous behavior</h4>
<p>This is exactly what is happening in all the examples in our question. Loading
an image, loading a file off disk, and requesting a page via AJAX are all slow
operations (in the context of modern computing).</p>
<p>Rather than <em>waiting</em> for these slow operations to complete, JavaScript lets
you register a callback function which will be executed when the slow
operation has completed. In the meantime, however, JavaScript will continue to
execute other code. The fact that JavaScript executes <em>other code</em> whilst
waiting for the slow operation to complete makes the behavior
<strong>asynchronous</strong>. Had JavaScript waited around for the operation to complete
before executing any other code, this would have been <strong>synchronous</strong>
behavior.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">outerScopeVar</span><span class="p">;</span><span class="w">    </span>
<span class="k">var</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s1">'img'</span><span class="p">);</span>

<span class="o">//</span><span class="w"> </span><span class="n">Here</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">register</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">callback</span><span class="w"> </span><span class="n">function</span><span class="o">.</span>
<span class="n">img</span><span class="o">.</span><span class="n">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">loaded</span><span class="o">.</span>
<span class="w">    </span><span class="n">outerScopeVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">width</span><span class="p">;</span>
<span class="p">};</span>

<span class="o">//</span><span class="w"> </span><span class="n">But</span><span class="p">,</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">loading</span><span class="p">,</span><span class="w"> </span><span class="n">JavaScript</span><span class="w"> </span><span class="n">continues</span><span class="w"> </span><span class="n">executing</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span>
<span class="o">//</span><span class="w"> </span><span class="n">processes</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">lines</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">JavaScript</span><span class="o">.</span>
<span class="n">img</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'lolcat.png'</span><span class="p">;</span>
<span class="n">alert</span><span class="p">(</span><span class="n">outerScopeVar</span><span class="p">);</span>
</pre></div>

<p>In the code above, we're asking JavaScript to load <code>lolcat.png</code>, which is a
<em>sloooow</em> operation. The callback function will be executed once this slow
operation has done, but in the meantime, JavaScript will keep processing the
next lines of code; i.e. <code>alert(outerScopeVar)</code>.</p>
<p>This is why we see the alert showing <code>undefined</code>; since the <code>alert()</code> is
processed immediately, rather than after the image has been loaded.</p>
<p>In order to fix our code, all we have to do is move the <code>alert(outerScopeVar)</code>
code <em>into</em> the callback function. As a consequence of this, we no longer need
the <code>outerScopeVar</code> variable declared as a global variable.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s1">'img'</span><span class="p">);</span>

<span class="n">img</span><span class="o">.</span><span class="n">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">localScopeVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">width</span><span class="p">;</span>
<span class="w">    </span><span class="n">alert</span><span class="p">(</span><span class="n">localScopeVar</span><span class="p">);</span>
<span class="p">};</span>

<span class="n">img</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'lolcat.png'</span><span class="p">;</span>
</pre></div>

<p>You'll <strong><em>always</em></strong> see a callback is specified as a function, because that's
the only* way in JavaScript to define some code, but not execute it until
later.</p>
<p>Therefore, in all of our examples, the <code>function() { /* Do something */ }</code> is
the callback; to fix <strong>all</strong> the examples, all we have to do is move the code
which needs the response of the operation into there!</p>
<ul>
<li>Technically you can use <code>eval()</code> as well, but <code>eval()</code> is evil for this purpose</li>
</ul>
<hr>
<h4>How do I keep my caller waiting?</h4>
<p>You might currently have some code similar to this;</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">getWidthOfImage</span><span class="p">(</span><span class="n">src</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">outerScopeVar</span><span class="p">;</span>

<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s1">'img'</span><span class="p">);</span>
<span class="w">    </span><span class="n">img</span><span class="o">.</span><span class="n">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">outerScopeVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">width</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">img</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">outerScopeVar</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">var</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getWidthOfImage</span><span class="p">(</span><span class="s1">'lolcat.png'</span><span class="p">);</span>
<span class="n">alert</span><span class="p">(</span><span class="n">width</span><span class="p">);</span>
</pre></div>

<p>However, we now know that the <code>return outerScopeVar</code> happens immediately;
before the <code>onload</code> callback function has updated the variable. This leads to
<code>getWidthOfImage()</code> returning <code>undefined</code>, and <code>undefined</code> being alerted.</p>
<p>To fix this, we need to allow the function calling <code>getWidthOfImage()</code> to
register a callback, then move the alert'ing of the width to be within that
callback;</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">getWidthOfImage</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">cb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">     </span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s1">'img'</span><span class="p">);</span>
<span class="w">    </span><span class="n">img</span><span class="o">.</span><span class="n">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cb</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">width</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">img</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">getWidthOfImage</span><span class="p">(</span><span class="s1">'lolcat.png'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">width</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">alert</span><span class="p">(</span><span class="n">width</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>... as before, note that we've been able to remove the global variables (in
this case <code>width</code>).</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-create-a-new-object-instance-from-a-type/" class="u-url">How to create a new object instance from a Type</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-create-a-new-object-instance-from-a-type/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T10:21:00+08:00" itemprop="datePublished" title="2023-02-17 10:21">2023-02-17 10:21</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>One may not always know the <code>Type</code> of an object at compile-time, but may need
to create an instance of the <code>Type</code>.</p>
<p>How do you get a new object instance from a <code>Type</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The <code>Activator</code> class within the root <code>System</code> namespace is pretty powerful.</p>
<p>There are a lot of overloads for passing parameters to the constructor and
such. Check out the documentation at:</p>
<blockquote>
<p>http://msdn.microsoft.com/en-us/library/system.activator.createinstance.aspx</p>
</blockquote>
<p>or (new path)</p>
<blockquote>
<p>https://learn.microsoft.com/en-us/dotnet/api/system.activator.createinstance</p>
</blockquote>
<p>Here are some simple examples:</p>
<div class="code"><pre class="code literal-block">ObjectType instance = (ObjectType)Activator.CreateInstance(objectType);

ObjectType instance = (ObjectType)Activator.CreateInstance("MyAssembly","MyNamespace.ObjectType");
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>The answer was already given:</p>
<blockquote>
<div class="code"><pre class="code literal-block">ObjectType instance = (ObjectType)Activator.CreateInstance(objectType);
</pre></div>

</blockquote>
<p>However, the <code>Activator</code> class has a generic variant for the parameterless
constructor that makes this slightly more readable by making the cast
unnecessary and not needing to pass the runtime type of the object:</p>
<div class="code"><pre class="code literal-block">ObjectType instance = Activator.CreateInstance&lt;ObjectType&gt;();
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-576.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-574.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
