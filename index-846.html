<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 846) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-846.html">
<link rel="prev" href="index-847.html" type="text/html">
<link rel="next" href="index-845.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-this-javascript-require/" class="u-url">What is this JavaScript "require"?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-this-javascript-require/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T17:33:36+08:00" itemprop="datePublished" title="2023-02-17 17:33">2023-02-17 17:33</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to get JavaScript to read/write to a PostgreSQL database. I found
this project on GitHub. I was able to get the following sample code to run in
Node.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">pg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'pg'</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">native</span><span class="w"> </span><span class="n">libpq</span><span class="w"> </span><span class="n">bindings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">`</span><span class="k">var</span><span class="w"> </span><span class="n">pg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'pg'</span><span class="p">)</span><span class="o">.</span><span class="n">native</span><span class="err">`</span>
<span class="k">var</span><span class="w"> </span><span class="n">conString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tcp://postgres:1234@localhost/postgres"</span><span class="p">;</span>

<span class="k">var</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">pg</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">conString</span><span class="p">);</span>
<span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">();</span>

<span class="o">//</span><span class="n">queries</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">queued</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">becomes</span><span class="w"> </span><span class="n">available</span>
<span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"CREATE TEMP TABLE beatles(name varchar(10), height integer, birthday timestamptz)"</span><span class="p">);</span>
<span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"INSERT INTO beatles(name, height, birthday) values($1, $2, $3)"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">'Ringo'</span><span class="p">,</span><span class="w"> </span><span class="mi">67</span><span class="p">,</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="mi">1945</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)]);</span>
<span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"INSERT INTO beatles(name, height, birthday) values($1, $2, $3)"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">'John'</span><span class="p">,</span><span class="w"> </span><span class="mi">68</span><span class="p">,</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="mi">1944</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">)]);</span>

<span class="o">//</span><span class="n">queries</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="n">either</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">text</span><span class="o">/</span><span class="n">parameter</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">individual</span><span class="w"> </span><span class="n">arguments</span>
<span class="o">//</span><span class="ow">or</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">passing</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">containing</span><span class="w"> </span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">optional</span><span class="p">)</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="p">(</span><span class="n">optional</span><span class="p">)</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">name</span>
<span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">({</span>
<span class="w">  </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s1">'insert beatle'</span><span class="p">,</span>
<span class="w">  </span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="s2">"INSERT INTO beatles(name, height, birthday) values($1, $2, $3)"</span><span class="p">,</span>
<span class="w">  </span><span class="n">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s1">'George'</span><span class="p">,</span><span class="w"> </span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="mi">1946</span><span class="p">,</span><span class="w"> </span><span class="mi">02</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">)]</span>
<span class="p">});</span>

<span class="o">//</span><span class="n">subsequent</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">parsing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">plan</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">postgres</span>
<span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">({</span>
<span class="w">  </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="s1">'insert beatle'</span><span class="p">,</span>
<span class="w">  </span><span class="n">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s1">'Paul'</span><span class="p">,</span><span class="w"> </span><span class="mi">63</span><span class="p">,</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="mi">1945</span><span class="p">,</span><span class="w"> </span><span class="mi">04</span><span class="p">,</span><span class="w"> </span><span class="mi">03</span><span class="p">)]</span>
<span class="p">});</span>
<span class="k">var</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">"SELECT * FROM beatles WHERE name = $1"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">'John'</span><span class="p">]);</span>

<span class="o">//</span><span class="n">can</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">time</span>
<span class="n">query</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">'row'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"Beatle name: </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">Beatle</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">John</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"Beatle birth year: </span><span class="si">%d</span><span class="s2">"</span><span class="p">,</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="n">birthday</span><span class="o">.</span><span class="n">getYear</span><span class="p">());</span><span class="w"> </span><span class="o">//</span><span class="n">dates</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">javascript</span><span class="w"> </span><span class="n">dates</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"Beatle height: </span><span class="si">%d</span><span class="s2">' </span><span class="si">%d</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span><span class="w"> </span><span class="n">Math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">height</span><span class="o">/</span><span class="mi">12</span><span class="p">),</span><span class="w"> </span><span class="n">row</span><span class="o">.</span><span class="n">height</span><span class="o">%</span><span class="mi">12</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">integers</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">javascript</span><span class="w"> </span><span class="n">ints</span>
<span class="p">});</span>

<span class="o">//</span><span class="n">fired</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">emitted</span>
<span class="n">query</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">'end'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="n">client</span><span class="o">.</span><span class="n">end</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>

<p>Next I tried to make it run on a webpage, but nothing seemed to happen. I
checked on the JavaScript console and it just says "require not defined".</p>
<p>So what is this "require"? Why does it work in Node but not in a webpage?</p>
<p>Also, before I got it to work in Node, I had to do <code>npm install pg</code>. What's
that about? I looked in the directory and didn't find a file pg. Where did it
put it, and how does JavaScript find it?</p>
<p><br><br></p>
<h2>Answer</h2>
<blockquote>
<p>So what is this "require?"</p>
</blockquote>
<p><code>require()</code> is not part of the standard JavaScript API. But in Node.js, it's a
built-in function with a special purpose: to load modules.</p>
<p>Modules are a way to split an application into separate files instead of
having all of your application in one file. This concept is also present in
other languages with minor differences in syntax and behavior, like C's
<code>include</code>, Python's <code>import</code>, and so on.</p>
<p>One big difference between Node.js modules and browser JavaScript is how one
script's code is accessed from another script's code.</p>
<ul>
<li>
<p>In browser JavaScript, scripts are added via the <code>&lt;script&gt;</code> element. When they execute, they all have direct access to the global scope, a "shared space" among all scripts. Any script can freely define/modify/remove/call anything on the global scope.</p>
</li>
<li>
<p>In Node.js, each module has its own scope. A module cannot directly access things defined in another module unless it chooses to expose them. To expose things from a module, they must be assigned to <code>exports</code> or <code>module.exports</code>. For a module to access another module's <code>exports</code> or <code>module.exports</code>, <em>it must use<code>require()</code></em>.</p>
</li>
</ul>
<p>In your code, <code>var pg = require('pg');</code> loads the <code>pg</code> module, a PostgreSQL
client for Node.js. This allows your code to access functionality of the
PostgreSQL client's APIs via the <code>pg</code> variable.</p>
<blockquote>
<p>Why does it work in node but not in a webpage?</p>
</blockquote>
<p><code>require()</code>, <code>module.exports</code> and <code>exports</code> are APIs of a module system that
is specific to Node.js. Browsers do not implement this module system.</p>
<blockquote>
<p>Also, before I got it to work in node, I had to do <code>npm install pg</code>. What's
that about?</p>
</blockquote>
<p>NPM is a package repository service that hosts published JavaScript modules.
<code>npm install</code> is a command that lets you download packages from their
repository.</p>
<blockquote>
<p>Where did it put it, and how does Javascript find it?</p>
</blockquote>
<p>The npm cli puts all the downloaded modules in a <code>node_modules</code> directory
where you ran <code>npm install</code>. Node.js has very detailed documentation on how
modules find other modules which includes finding a <code>node_modules</code> directory.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Alright, so let's first start with making the distinction between Javascript
<em>in a web browser</em> , and Javascript <em>on a server</em> (CommonJS and Node).</p>
<p>Javascript is a language traditionally confined to a web browser with a
limited global context defined mostly by what came to be known as the Document
Object Model (DOM) level 0 (the Netscape Navigator Javascript API).</p>
<p>Server-side Javascript eliminates that restriction and allows Javascript to
call into various pieces of native code (like the Postgres library) and open
sockets.</p>
<p>Now <code>require()</code> is a special function call defined as part of the CommonJS
spec. In node, it resolves libraries and modules in the Node search path, now
usually defined as <code>node_modules</code> in the same directory (or the directory of
the invoked javascript file) or the system-wide search path.</p>
<p>To try to answer the rest of your question, we need to use a proxy between the
code running in the the browser and the database server.</p>
<p>Since we are discussing Node and you are already familiar with how to run a
query from there, it would make sense to use Node as that proxy.</p>
<p>As a simple example, we're going to make a URL that returns a few facts about
a Beatle, given a name, as JSON.</p>
<div class="code"><pre class="code literal-block"><span class="o">/*</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="o">*/</span>

<span class="k">var</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">express</span><span class="o">.</span><span class="n">createServer</span><span class="p">();</span>
<span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/beatles/:name'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">''</span><span class="p">;</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/</span><span class="p">[</span><span class="o">^</span><span class="n">a</span><span class="o">-</span><span class="n">zA_Z</span><span class="p">]</span><span class="o">/</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">name</span><span class="o">.</span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">({});</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">'SELECT * FROM BEATLES WHERE name =</span><span class="se">\'</span><span class="s1">'</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s1">'</span><span class="se">\'</span><span class="s1"> LIMIT 1'</span><span class="p">);</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">query</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">'row'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span><span class="p">;</span>
<span class="w">            </span><span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">});</span>
<span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="s1">'127.0.0.1'</span><span class="p">);</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-does-python-use-else-after-for-and-while-loops/" class="u-url">Why does python use 'else' after for and while loops?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-does-python-use-else-after-for-and-while-loops/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T17:33:07+08:00" itemprop="datePublished" title="2023-02-17 17:33">2023-02-17 17:33</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I understand how this construct works:</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="mi">10</span><span class="ss">)</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">9</span>:
<span class="w">        </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Too big - I'm giving up!"</span><span class="ss">)</span>
<span class="w">        </span><span class="k">break</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Completed successfully"</span><span class="ss">)</span>
</pre></div>

<p>But I don't understand why <code>else</code> is used as the keyword here, since it
suggests the code in question only runs if the <code>for</code> block does not complete,
which is the opposite of what it does! No matter how I think about it, my
brain can't progress seamlessly from the <code>for</code> statement to the <code>else</code> block.
To me, <code>continue</code> or <code>continuewith</code> would make more sense (and I'm trying to
train myself to read it as such).</p>
<p>I'm wondering how Python coders read this construct in their head (or aloud,
if you like). Perhaps I'm missing something that would make such code blocks
more easily decipherable?</p>
<hr>
<p>This question is about the <em>underlying design decision</em> , i.e. <em>why it is
useful</em> to be able to write this code. See also Else clause on Python while
statement for the specific question about <em>what the syntax means</em>.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>It's a strange construct even to seasoned Python coders. When used in
conjunction with for-loops it basically means "find some item in the iterable,
else if none was found do ...". As in:</p>
<div class="code"><pre class="code literal-block"><span class="nv">found_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span>
<span class="k">for</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">objects</span>:
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">obj</span>.<span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">search_key</span>:
<span class="w">        </span><span class="nv">found_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">obj</span>
<span class="w">        </span><span class="k">break</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s1">'No object found.'</span><span class="ss">)</span>
</pre></div>

<p>But anytime you see this construct, a better alternative is to either
encapsulate the search in a function:</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">find_obj</span><span class="ss">(</span><span class="nv">search_key</span><span class="ss">)</span>:
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">objects</span>:
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nv">obj</span>.<span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">search_key</span>:
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">obj</span>
</pre></div>

<p>Or use a list comprehension:</p>
<div class="code"><pre class="code literal-block"><span class="nv">matching_objs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>[<span class="nv">o</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">o</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">objects</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">o</span>.<span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">search_key</span>]
<span class="k">if</span><span class="w"> </span><span class="nv">matching_objs</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s1">'Found {}'</span>.<span class="nv">format</span><span class="ss">(</span><span class="nv">matching_objs</span>[<span class="mi">0</span>]<span class="ss">))</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s1">'No object found.'</span><span class="ss">)</span>
</pre></div>

<p>It is not semantically equivalent to the other two versions, but works good
enough in non-performance critical code where it doesn't matter whether you
iterate the whole list or not. Others may disagree, but I personally would
avoid ever using the for-else or while-else blocks in production code.</p>
<p>See also [Python-ideas] Summary of for...else threads</p>
<p><br></p>
<h3>Suggest</h3>
<p>It's a strange construct even to seasoned Python coders. When used in
conjunction with for-loops it basically means "find some item in the iterable,
else if none was found do ...". As in:</p>
<div class="code"><pre class="code literal-block"><span class="nv">found_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span>
<span class="k">for</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">objects</span>:
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">obj</span>.<span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">search_key</span>:
<span class="w">        </span><span class="nv">found_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">obj</span>
<span class="w">        </span><span class="k">break</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s1">'No object found.'</span><span class="ss">)</span>
</pre></div>

<p>But anytime you see this construct, a better alternative is to either
encapsulate the search in a function:</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">find_obj</span><span class="ss">(</span><span class="nv">search_key</span><span class="ss">)</span>:
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">objects</span>:
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nv">obj</span>.<span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">search_key</span>:
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">obj</span>
</pre></div>

<p>Or use a list comprehension:</p>
<div class="code"><pre class="code literal-block"><span class="nv">matching_objs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>[<span class="nv">o</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">o</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">objects</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">o</span>.<span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">search_key</span>]
<span class="k">if</span><span class="w"> </span><span class="nv">matching_objs</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s1">'Found {}'</span>.<span class="nv">format</span><span class="ss">(</span><span class="nv">matching_objs</span>[<span class="mi">0</span>]<span class="ss">))</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s1">'No object found.'</span><span class="ss">)</span>
</pre></div>

<p>It is not semantically equivalent to the other two versions, but works good
enough in non-performance critical code where it doesn't matter whether you
iterate the whole list or not. Others may disagree, but I personally would
avoid ever using the for-else or while-else blocks in production code.</p>
<p>See also [Python-ideas] Summary of for...else threads</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-use-executables-from-a-package-installed-locally-in-node-modules/" class="u-url">How to use executables from a package installed locally in node_modules?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-use-executables-from-a-package-installed-locally-in-node-modules/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T17:32:37+08:00" itemprop="datePublished" title="2023-02-17 17:32">2023-02-17 17:32</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I use a local version of a module in <code>node.js</code>. For example, in my app,
I installed coffee-script:</p>
<div class="code"><pre class="code literal-block">npm install coffee-script
</pre></div>

<p>This installs it in <code>./node_modules</code> and the coffee command is in
<code>./node_modules/.bin/coffee</code>. Is there a way to run this command when I'm in
my project's main folder? I guess I'm looking for something similar to <code>bundle
exec</code> in bundler. Basically, I'd like to specify a version of coffee-script
that everyone involved with the project should use.</p>
<p>I know I can add the <code>-g</code> flag to install it globally so coffee works fine
anywhere, but what if I wanted to have different versions of coffee per
project?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>UPDATE</strong> : As Seyeong Jeong points out in their answer below, since npm
5.2.0 you can use <code>npx [command]</code>, which is more convenient.</p>
<p><strong>OLD ANSWER for versions before 5.2.0</strong> :</p>
<p>The problem with putting</p>
<div class="code"><pre class="code literal-block">./node_modules/.bin
</pre></div>

<p>into your PATH is that it only works when your current working directory is
the root of your project directory structure (i.e. the location of
<code>node_modules</code>)</p>
<p>Independent of what your working directory is, you can get the path of locally
installed binaries with</p>
<div class="code"><pre class="code literal-block">npm bin
</pre></div>

<p>To execute a locally installed <code>coffee</code> binary independent of where you are in
the project directory hierarchy you can use this bash construct</p>
<div class="code"><pre class="code literal-block">PATH=$(npm bin):$PATH coffee
</pre></div>

<p>I aliased this to npm-exec</p>
<div class="code"><pre class="code literal-block"><span class="nv">alias</span><span class="w"> </span><span class="nv">npm</span><span class="o">-</span><span class="k">exec</span><span class="o">=</span><span class="s1">'PATH=$(npm bin):$PATH'</span>
</pre></div>

<p>So, now I can</p>
<div class="code"><pre class="code literal-block"><span class="nv">npm</span><span class="o">-</span><span class="k">exec</span><span class="w"> </span><span class="nv">coffee</span>
</pre></div>

<p>to run the correct copy of coffee no matter of where I am</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span><span class="nb">pwd</span>
/Users/regular/project1

$<span class="w"> </span>npm-exec<span class="w"> </span>which<span class="w"> </span>coffee
/Users/regular/project1/node_modules/.bin/coffee

$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>lib/
$<span class="w"> </span>npm-exec<span class="w"> </span>which<span class="w"> </span>coffee
/Users/regular/project1/node_modules/.bin/coffee

$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/project2
$<span class="w"> </span>npm-exec<span class="w"> </span>which<span class="w"> </span>coffee
/Users/regular/project2/node_modules/.bin/coffee
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p><img alt="Nice example" src="images/zyFua.gif"></p>
<p>You don't have to manipulate <code>$PATH</code> anymore!</p>
<p>From npm@5.2.0, <strong>npm</strong> ships with <code>npx</code> package which lets you run commands
from a local <code>node_modules/.bin</code> or from a central cache.</p>
<p>Simply run:</p>
<div class="code"><pre class="code literal-block"><span class="err">$</span><span class="w"> </span><span class="n">npx</span><span class="w"> </span><span class="o">[</span><span class="n">options</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;[</span><span class="n">@version</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">command-arg</span><span class="o">]</span><span class="p">...</span>
</pre></div>

<p>By default, <code>npx</code> will check whether <code>&lt;command&gt;</code> exists in <code>$PATH</code>, or in the
local project binaries, and execute that.</p>
<p>Calling <code>npx &lt;command&gt;</code> when <code>&lt;command&gt;</code> isn't already in your <code>$PATH</code> will
automatically install a package with that name from the NPM registry for you,
and invoke it. When it's done, the installed package won’t be anywhere in your
globals, so you won’t have to worry about pollution in the long-term. You can
prevent this behaviour by providing <code>--no-install</code> option.</p>
<p>For <code>npm &lt; 5.2.0</code>, you can install <code>npx</code> package manually by running the
following command:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>npx
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-847.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-845.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
