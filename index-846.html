<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 846) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-846.html">
<link rel="prev" href="index-847.html" type="text/html">
<link rel="next" href="index-845.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-does-python-use-else-after-for-and-while-loops/" class="u-url">Why does python use 'else' after for and while loops?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-does-python-use-else-after-for-and-while-loops/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T17:33:07+08:00" itemprop="datePublished" title="2023-02-17 17:33">2023-02-17 17:33</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I understand how this construct works:</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="mi">10</span><span class="ss">)</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">9</span>:
<span class="w">        </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Too big - I'm giving up!"</span><span class="ss">)</span>
<span class="w">        </span><span class="k">break</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Completed successfully"</span><span class="ss">)</span>
</pre></div>

<p>But I don't understand why <code>else</code> is used as the keyword here, since it
suggests the code in question only runs if the <code>for</code> block does not complete,
which is the opposite of what it does! No matter how I think about it, my
brain can't progress seamlessly from the <code>for</code> statement to the <code>else</code> block.
To me, <code>continue</code> or <code>continuewith</code> would make more sense (and I'm trying to
train myself to read it as such).</p>
<p>I'm wondering how Python coders read this construct in their head (or aloud,
if you like). Perhaps I'm missing something that would make such code blocks
more easily decipherable?</p>
<hr>
<p>This question is about the <em>underlying design decision</em> , i.e. <em>why it is
useful</em> to be able to write this code. See also Else clause on Python while
statement for the specific question about <em>what the syntax means</em>.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>It's a strange construct even to seasoned Python coders. When used in
conjunction with for-loops it basically means "find some item in the iterable,
else if none was found do ...". As in:</p>
<div class="code"><pre class="code literal-block"><span class="nv">found_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span>
<span class="k">for</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">objects</span>:
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">obj</span>.<span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">search_key</span>:
<span class="w">        </span><span class="nv">found_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">obj</span>
<span class="w">        </span><span class="k">break</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s1">'No object found.'</span><span class="ss">)</span>
</pre></div>

<p>But anytime you see this construct, a better alternative is to either
encapsulate the search in a function:</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">find_obj</span><span class="ss">(</span><span class="nv">search_key</span><span class="ss">)</span>:
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">objects</span>:
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nv">obj</span>.<span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">search_key</span>:
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">obj</span>
</pre></div>

<p>Or use a list comprehension:</p>
<div class="code"><pre class="code literal-block"><span class="nv">matching_objs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>[<span class="nv">o</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">o</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">objects</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">o</span>.<span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">search_key</span>]
<span class="k">if</span><span class="w"> </span><span class="nv">matching_objs</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s1">'Found {}'</span>.<span class="nv">format</span><span class="ss">(</span><span class="nv">matching_objs</span>[<span class="mi">0</span>]<span class="ss">))</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s1">'No object found.'</span><span class="ss">)</span>
</pre></div>

<p>It is not semantically equivalent to the other two versions, but works good
enough in non-performance critical code where it doesn't matter whether you
iterate the whole list or not. Others may disagree, but I personally would
avoid ever using the for-else or while-else blocks in production code.</p>
<p>See also [Python-ideas] Summary of for...else threads</p>
<p><br></p>
<h3>Suggest</h3>
<p>It's a strange construct even to seasoned Python coders. When used in
conjunction with for-loops it basically means "find some item in the iterable,
else if none was found do ...". As in:</p>
<div class="code"><pre class="code literal-block"><span class="nv">found_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span>
<span class="k">for</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">objects</span>:
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">obj</span>.<span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">search_key</span>:
<span class="w">        </span><span class="nv">found_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">obj</span>
<span class="w">        </span><span class="k">break</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s1">'No object found.'</span><span class="ss">)</span>
</pre></div>

<p>But anytime you see this construct, a better alternative is to either
encapsulate the search in a function:</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">find_obj</span><span class="ss">(</span><span class="nv">search_key</span><span class="ss">)</span>:
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nv">obj</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">objects</span>:
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nv">obj</span>.<span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">search_key</span>:
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">obj</span>
</pre></div>

<p>Or use a list comprehension:</p>
<div class="code"><pre class="code literal-block"><span class="nv">matching_objs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>[<span class="nv">o</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">o</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">objects</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">o</span>.<span class="nv">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">search_key</span>]
<span class="k">if</span><span class="w"> </span><span class="nv">matching_objs</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s1">'Found {}'</span>.<span class="nv">format</span><span class="ss">(</span><span class="nv">matching_objs</span>[<span class="mi">0</span>]<span class="ss">))</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s1">'No object found.'</span><span class="ss">)</span>
</pre></div>

<p>It is not semantically equivalent to the other two versions, but works good
enough in non-performance critical code where it doesn't matter whether you
iterate the whole list or not. Others may disagree, but I personally would
avoid ever using the for-else or while-else blocks in production code.</p>
<p>See also [Python-ideas] Summary of for...else threads</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-use-executables-from-a-package-installed-locally-in-node-modules/" class="u-url">How to use executables from a package installed locally in node_modules?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-use-executables-from-a-package-installed-locally-in-node-modules/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T17:32:37+08:00" itemprop="datePublished" title="2023-02-17 17:32">2023-02-17 17:32</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I use a local version of a module in <code>node.js</code>. For example, in my app,
I installed coffee-script:</p>
<div class="code"><pre class="code literal-block">npm install coffee-script
</pre></div>

<p>This installs it in <code>./node_modules</code> and the coffee command is in
<code>./node_modules/.bin/coffee</code>. Is there a way to run this command when I'm in
my project's main folder? I guess I'm looking for something similar to <code>bundle
exec</code> in bundler. Basically, I'd like to specify a version of coffee-script
that everyone involved with the project should use.</p>
<p>I know I can add the <code>-g</code> flag to install it globally so coffee works fine
anywhere, but what if I wanted to have different versions of coffee per
project?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>UPDATE</strong> : As Seyeong Jeong points out in their answer below, since npm
5.2.0 you can use <code>npx [command]</code>, which is more convenient.</p>
<p><strong>OLD ANSWER for versions before 5.2.0</strong> :</p>
<p>The problem with putting</p>
<div class="code"><pre class="code literal-block">./node_modules/.bin
</pre></div>

<p>into your PATH is that it only works when your current working directory is
the root of your project directory structure (i.e. the location of
<code>node_modules</code>)</p>
<p>Independent of what your working directory is, you can get the path of locally
installed binaries with</p>
<div class="code"><pre class="code literal-block">npm bin
</pre></div>

<p>To execute a locally installed <code>coffee</code> binary independent of where you are in
the project directory hierarchy you can use this bash construct</p>
<div class="code"><pre class="code literal-block">PATH=$(npm bin):$PATH coffee
</pre></div>

<p>I aliased this to npm-exec</p>
<div class="code"><pre class="code literal-block"><span class="nv">alias</span><span class="w"> </span><span class="nv">npm</span><span class="o">-</span><span class="k">exec</span><span class="o">=</span><span class="s1">'PATH=$(npm bin):$PATH'</span>
</pre></div>

<p>So, now I can</p>
<div class="code"><pre class="code literal-block"><span class="nv">npm</span><span class="o">-</span><span class="k">exec</span><span class="w"> </span><span class="nv">coffee</span>
</pre></div>

<p>to run the correct copy of coffee no matter of where I am</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span><span class="nb">pwd</span>
/Users/regular/project1

$<span class="w"> </span>npm-exec<span class="w"> </span>which<span class="w"> </span>coffee
/Users/regular/project1/node_modules/.bin/coffee

$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>lib/
$<span class="w"> </span>npm-exec<span class="w"> </span>which<span class="w"> </span>coffee
/Users/regular/project1/node_modules/.bin/coffee

$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/project2
$<span class="w"> </span>npm-exec<span class="w"> </span>which<span class="w"> </span>coffee
/Users/regular/project2/node_modules/.bin/coffee
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p><img alt="Nice example" src="images/zyFua.gif"></p>
<p>You don't have to manipulate <code>$PATH</code> anymore!</p>
<p>From npm@5.2.0, <strong>npm</strong> ships with <code>npx</code> package which lets you run commands
from a local <code>node_modules/.bin</code> or from a central cache.</p>
<p>Simply run:</p>
<div class="code"><pre class="code literal-block"><span class="err">$</span><span class="w"> </span><span class="n">npx</span><span class="w"> </span><span class="o">[</span><span class="n">options</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="n">command</span><span class="o">&gt;[</span><span class="n">@version</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">command-arg</span><span class="o">]</span><span class="p">...</span>
</pre></div>

<p>By default, <code>npx</code> will check whether <code>&lt;command&gt;</code> exists in <code>$PATH</code>, or in the
local project binaries, and execute that.</p>
<p>Calling <code>npx &lt;command&gt;</code> when <code>&lt;command&gt;</code> isn't already in your <code>$PATH</code> will
automatically install a package with that name from the NPM registry for you,
and invoke it. When it's done, the installed package won’t be anywhere in your
globals, so you won’t have to worry about pollution in the long-term. You can
prevent this behaviour by providing <code>--no-install</code> option.</p>
<p>For <code>npm &lt; 5.2.0</code>, you can install <code>npx</code> package manually by running the
following command:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>npx
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-check-if-a-number-is-a-power-of-2/" class="u-url">How to check if a number is a power of 2</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-check-if-a-number-is-a-power-of-2/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T17:32:03+08:00" itemprop="datePublished" title="2023-02-17 17:32">2023-02-17 17:32</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Today I needed a simple algorithm for checking if a number is a power of 2.</p>
<p>The algorithm needs to be:</p>
<ol>
<li>Simple</li>
<li>Correct for any <code>ulong</code> value.</li>
</ol>
<p>I came up with this simple algorithm:</p>
<div class="code"><pre class="code literal-block"><span class="nv">private</span><span class="w"> </span><span class="nv">bool</span><span class="w"> </span><span class="nv">IsPowerOfTwo</span><span class="ss">(</span><span class="nv">ulong</span><span class="w"> </span><span class="nv">number</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">number</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">false</span><span class="c1">;</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">ulong</span><span class="w"> </span><span class="nv">power</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="c1">; power &gt; 0; power = power &lt;&lt; 1)</span>
<span class="w">    </span>{
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="nv">This</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="nv">used</span><span class="w"> </span><span class="nv">shifting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">powers</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">2</span>,<span class="w"> </span><span class="nv">meaning</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">become</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">after</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">last</span><span class="w"> </span><span class="nv">shift</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="ss">(</span><span class="nv">from</span><span class="w"> </span><span class="nv">binary</span><span class="w"> </span><span class="mi">1000</span>...<span class="mi">0000</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">0000</span>...<span class="mi">0000</span><span class="ss">)</span><span class="w"> </span><span class="k">then</span>,<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="s1">'for'</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="nv">out</span>.

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">power</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">number</span><span class="ss">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">true</span><span class="c1">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">power</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nv">number</span><span class="ss">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">false</span><span class="c1">;</span>
<span class="w">    </span>}
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">false</span><span class="c1">;</span>
}
</pre></div>

<p>But then I thought: How about checking if log2 x is an exactly a round number?
When I checked for 2^63+1, <code>Math.Log()</code> returned exactly 63 because of
rounding. So I checked if 2 to the power 63 is equal to the original number
and it is, because the calculation is done in <code>double</code>s and not in exact
numbers.</p>
<div class="code"><pre class="code literal-block"><span class="nv">private</span><span class="w"> </span><span class="nv">bool</span><span class="w"> </span><span class="nv">IsPowerOfTwo_2</span><span class="ss">(</span><span class="nv">ulong</span><span class="w"> </span><span class="nv">number</span><span class="ss">)</span>
{
<span class="w">    </span><span class="nv">double</span><span class="w"> </span><span class="nv">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Math</span>.<span class="nv">Log</span><span class="ss">(</span><span class="nv">number</span>,<span class="w"> </span><span class="mi">2</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">double</span><span class="w"> </span><span class="nv">pow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Math</span>.<span class="nv">Pow</span><span class="ss">(</span><span class="mi">2</span>,<span class="w"> </span><span class="nv">Math</span>.<span class="nv">Round</span><span class="ss">(</span><span class="nv">log</span><span class="ss">))</span><span class="c1">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">pow</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">number</span><span class="c1">;</span>
}
</pre></div>

<p>This returned <code>true</code> for the given wrong value: <code>9223372036854775809</code>.</p>
<p>Is there a better algorithm?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>There's a simple trick for this problem:</p>
<div class="code"><pre class="code literal-block"><span class="nv">bool</span><span class="w"> </span><span class="nv">IsPowerOfTwo</span><span class="ss">(</span><span class="nv">ulong</span><span class="w"> </span><span class="nv">x</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ss">(</span><span class="nv">x</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="ss">(</span><span class="nv">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="ss">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="c1">;</span>
}
</pre></div>

<p>Note, this function will report <code>true</code> for <code>0</code>, which is not a power of <code>2</code>.
If you want to exclude that, here's how:</p>
<div class="code"><pre class="code literal-block"><span class="nv">bool</span><span class="w"> </span><span class="nv">IsPowerOfTwo</span><span class="ss">(</span><span class="nv">ulong</span><span class="w"> </span><span class="nv">x</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ss">(</span><span class="nv">x</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="ss">((</span><span class="nv">x</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="ss">(</span><span class="nv">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="ss">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="c1">;</span>
}
</pre></div>

<h4>Explanation</h4>
<p>First and foremost the bitwise binary &amp; operator from MSDN definition:</p>
<blockquote>
<p>Binary &amp; operators are predefined for the integral types and bool. For
integral types, &amp; computes the logical bitwise AND of its operands. For bool
operands, &amp; computes the logical AND of its operands; that is, the result is
true if and only if both its operands are true.</p>
</blockquote>
<p>Now let's take a look at how this all plays out:</p>
<p>The function returns boolean (true / false) and accepts one incoming parameter
of type unsigned long (x, in this case). Let us for the sake of simplicity
assume that someone has passed the value 4 and called the function like so:</p>
<div class="code"><pre class="code literal-block">bool b = IsPowerOfTwo(4)
</pre></div>

<p>Now we replace each occurrence of x with 4:</p>
<div class="code"><pre class="code literal-block"><span class="k">return</span><span class="w"> </span><span class="ss">(</span><span class="mi">4</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="ss">((</span><span class="mi">4</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="ss">(</span><span class="mi">4</span><span class="o">-</span><span class="mi">1</span><span class="ss">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>Well we already know that 4 != 0 evals to true, so far so good. But what
about:</p>
<div class="code"><pre class="code literal-block">((4 &amp; (4-1)) == 0)
</pre></div>

<p>This translates to this of course:</p>
<div class="code"><pre class="code literal-block">((4 &amp; 3) == 0)
</pre></div>

<p>But what exactly is <code>4&amp;3</code>?</p>
<p>The binary representation of 4 is 100 and the binary representation of 3 is
011 (remember the &amp; takes the binary representation of these numbers). So we
have:</p>
<div class="code"><pre class="code literal-block"><span class="mf">100</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4</span>
<span class="mf">011</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span>
</pre></div>

<p>Imagine these values being stacked up much like elementary addition. The <code>&amp;</code>
operator says that if both values are equal to 1 then the result is 1,
otherwise it is 0. So <code>1 &amp; 1 = 1</code>, <code>1 &amp; 0 = 0</code>, <code>0 &amp; 0 = 0</code>, and <code>0 &amp; 1 = 0</code>.
So we do the math:</p>
<div class="code"><pre class="code literal-block"><span class="mf">100</span>
<span class="mf">011</span>
<span class="o">----</span>
<span class="mf">000</span>
</pre></div>

<p>The result is simply 0. So we go back and look at what our return statement
now translates to:</p>
<div class="code"><pre class="code literal-block"><span class="k">return</span><span class="w"> </span><span class="ss">(</span><span class="mi">4</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="ss">((</span><span class="mi">4</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">3</span><span class="ss">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>Which translates now to:</p>
<div class="code"><pre class="code literal-block"><span class="k">return</span><span class="w"> </span><span class="nv">true</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="ss">(</span><span class="mi">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="c1">;</span>



<span class="k">return</span><span class="w"> </span><span class="nv">true</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">true</span><span class="c1">;</span>
</pre></div>

<p>We all know that <code>true &amp;&amp; true</code> is simply <code>true</code>, and this shows that for our
example, 4 is a power of 2.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Some sites that document and explain this and other bit twiddling hacks are:</p>
<ul>
<li>
<p>http://graphics.stanford.edu/~seander/bithacks.html<br>
(http://graphics.stanford.edu/~seander/bithacks.html#DetermineIfPowerOf2)</p>
</li>
<li>
<p>http://bits.stephan-brumme.com/<br>
(http://bits.stephan-brumme.com/isPowerOfTwo.html)</p>
</li>
</ul>
<p>And the grandaddy of them, the book "Hacker's Delight" by Henry Warren, Jr.:</p>
<ul>
<li>http://www.hackersdelight.org/</li>
</ul>
<p>As Sean Anderson's page explains, the expression <code>((x &amp; (x - 1)) == 0)</code>
incorrectly indicates that 0 is a power of 2. He suggests to use:</p>
<div class="code"><pre class="code literal-block">(!(x &amp; (x - 1)) &amp;&amp; x)
</pre></div>

<p>to correct that problem.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-847.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-845.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
