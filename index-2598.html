<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2598) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2598.html">
<link rel="prev" href="index-2599.html" type="text/html">
<link rel="next" href="index-2597.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-save-a-trained-model-in-pytorch/" class="u-url">How do I save a trained model in PyTorch?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-save-a-trained-model-in-pytorch/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T03:49:39+08:00" itemprop="datePublished" title="2023-03-05 03:49">2023-03-05 03:49</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I save a trained model in PyTorch? I have read that:</p>
<ol>
<li>
<code>torch.save()</code>/<code>torch.load()</code> is for saving/loading a serializable object.</li>
<li>
<code>model.state_dict()</code>/<code>model.load_state_dict()</code> is for saving/loading model state.</li>
</ol>
<p><br><br></p>
<h2>Answer</h2>
<p>Found this page on their github repo:</p>
<blockquote>
<h5>Recommended approach for saving a model</h5>
<p>There are two main approaches for serializing and restoring a model.</p>
<p>The first (recommended) saves and loads only the model parameters:</p>
<div class="code"><pre class="code literal-block">torch.save(the_model.state_dict(), PATH)
</pre></div>

<p>Then later:</p>
<div class="code"><pre class="code literal-block"><span class="n">the_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TheModelClass</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">the_model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">PATH</span><span class="p">))</span>
</pre></div>

<p>The second saves and loads the entire model:</p>
<div class="code"><pre class="code literal-block">torch.save(the_model, PATH)
</pre></div>

<p>Then later:</p>
<div class="code"><pre class="code literal-block"><span class="n">the_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">PATH</span><span class="p">)</span>
</pre></div>

<p>However in this case, the serialized data is bound to the specific classes
and the exact directory structure used, so it can break in various ways when
used in other projects, or after some serious refactors.</p>
</blockquote>
<hr>
<p>See also: Save and Load the Model section from the official PyTorch tutorials.</p>
<p><br></p>
<h3>Suggest</h3>
<p>It depends on what you want to do.</p>
<p><strong>Case # 1: Save the model to use it yourself for inference</strong> : You save the
model, you restore it, and then you change the model to evaluation mode. This
is done because you usually have <code>BatchNorm</code> and <code>Dropout</code> layers that by
default are in train mode on construction:</p>
<div class="code"><pre class="code literal-block"><span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span><span class="w"> </span><span class="n">filepath</span><span class="p">)</span>

<span class="c1">#Later to restore:</span>
<span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</pre></div>

<p><strong>Case # 2: Save model to resume training later</strong> : If you need to keep
training the model that you are about to save, you need to save more than just
the model. You also need to save the state of the optimizer, epochs, score,
etc. You would do it like this:</p>
<div class="code"><pre class="code literal-block">state = {
    'epoch': epoch,
    'state_dict': model.state_dict(),
    'optimizer': optimizer.state_dict(),
    ...
}
torch.save(state, filepath)
</pre></div>

<p>To resume training you would do things like: <code>state = torch.load(filepath)</code>,
and then, to restore the state of each individual object, something like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">'state_dict'</span><span class="p">])</span>
<span class="n">optimizer</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s1">'optimizer'</span><span class="p">])</span>
</pre></div>

<p>Since you are resuming training, <strong>DO NOT</strong> call <code>model.eval()</code> once you
restore the states when loading.</p>
<p><strong>Case # 3: Model to be used by someone else with no access to your code</strong> :
In Tensorflow you can create a <code>.pb</code> file that defines both the architecture
and the weights of the model. This is very handy, specially when using
<code>Tensorflow serve</code>. The equivalent way to do this in Pytorch would be:</p>
<div class="code"><pre class="code literal-block"><span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">filepath</span><span class="p">)</span>

<span class="c1"># Then later:</span>
<span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</pre></div>

<p>This way is still not bullet proof and since pytorch is still undergoing a lot
of changes, I wouldn't recommend it.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-meaning-of-git-reset-hard-origin-master/" class="u-url">What is the meaning of git reset --hard origin/master?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-meaning-of-git-reset-hard-origin-master/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T03:48:24+08:00" itemprop="datePublished" title="2023-03-05 03:48">2023-03-05 03:48</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I did a <code>git pull</code> and got an error:</p>
<blockquote>
<p>The following working tree files would be overwritten by merge... Please
move or remove them before you can merge.</p>
</blockquote>
<p>To resolve this I did the following:</p>
<div class="code"><pre class="code literal-block">git fetch
git reset --hard origin/master
</pre></div>

<p>Now when I do <code>git pull</code>, it says everything up to date. I want to know what
exactly happens when I run these commands. I know <code>git fetch</code> fetches the
changes from the remote repo without merging them into my local repo.</p>
<p>What is the meaning of <code>git reset --hard origin/master</code>? How does it work?</p>
<p><br><br></p>
<h2>Answer</h2>
<div class="code"><pre class="code literal-block">git reset --hard origin/master
</pre></div>

<p>says: throw away all my staged and unstaged changes, forget everything on my
current local branch and make it exactly the same as <code>origin/master</code>.</p>
<p>You probably wanted to ask this before you ran the command. The destructive
nature is hinted at by using the same words as in "hard reset".</p>
<p><br></p>
<h3>Suggest</h3>
<p>In newer version of git (2.23+) you can use:</p>
<div class="code"><pre class="code literal-block">git switch --force-create master origin/master
</pre></div>

<p>Related Reference Docs</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/disabling-and-enabling-a-html-input-button/" class="u-url">Disabling and enabling a html input button</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/disabling-and-enabling-a-html-input-button/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T03:47:01+08:00" itemprop="datePublished" title="2023-03-05 03:47">2023-03-05 03:47</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>So I have a button like this:</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="nt">input</span><span class="w"> </span><span class="nt">id</span><span class="o">=</span><span class="s2">"Button"</span><span class="w"> </span><span class="nt">type</span><span class="o">=</span><span class="s2">"button"</span><span class="w"> </span><span class="nt">value</span><span class="o">=</span><span class="s2">"+"</span><span class="w"> </span><span class="nt">style</span><span class="o">=</span><span class="s2">"background-color:grey"</span><span class="w"> </span><span class="nt">onclick</span><span class="o">=</span><span class="s2">"Me();"</span><span class="o">/&gt;</span>
</pre></div>

<p>How can I disable and enable it when I want? I have tried <code>disabled="disable"</code>
but enabling it back is a problem. I tried setting it back to false but that
didn't enable it.</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>Using Javascript</h3>
<ul>
<li>
<p>Disabling a html button</p>
<div class="code"><pre class="code literal-block">document.getElementById("Button").disabled = true;
</pre></div>

</li>
<li>
<p>Enabling a html button</p>
<div class="code"><pre class="code literal-block">document.getElementById("Button").disabled = false;
</pre></div>

</li>
<li>
<p><strong>Demo Here</strong></p>
</li>
</ul>
<hr>
<h3>Using jQuery</h3>
<p><strong>All versions of jQuery prior to 1.6</strong></p>
<ul>
<li>
<p>Disabling a html button</p>
<div class="code"><pre class="code literal-block">$('#Button').attr('disabled','disabled');
</pre></div>

</li>
<li>
<p>Enabling a html button</p>
<div class="code"><pre class="code literal-block">$('#Button').removeAttr('disabled');
</pre></div>

</li>
<li>
<p><strong>Demo Here</strong></p>
</li>
</ul>
<p><strong>All versions of jQuery after 1.6</strong></p>
<ul>
<li>
<p>Disabling a html button</p>
<div class="code"><pre class="code literal-block">$('#Button').prop('disabled', true);
</pre></div>

</li>
<li>
<p>Enabling a html button</p>
<div class="code"><pre class="code literal-block">$('#Button').prop('disabled', false);
</pre></div>

</li>
<li>
<p><strong>Demo Here</strong></p>
</li>
</ul>
<p><strong>P.S. Updated the code based on jquery 1.6.1 changes. As a suggestion, always
use the latest jquery files and the<code>prop()</code> method.</strong></p>
<p><br></p>
<h3>Suggest</h3>
<p>Since you are disabling it in the first place, the way to enable it is to set
its <code>disabled</code> property as <code>false</code>.</p>
<p>To change its <code>disabled</code> property in Javascript, you use this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">btn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s2">"Button"</span><span class="p">);</span>
<span class="n">btn</span><span class="o">.</span><span class="n">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
</pre></div>

<p>And obviously to disable it again, you'd use <code>true</code> instead.</p>
<p>Since you also tagged the question with jQuery, you could use the <code>.prop</code>
method. Something like:</p>
<div class="code"><pre class="code literal-block"><span class="n">var</span><span class="w"> </span><span class="n">btn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="s2">"#Button"</span><span class="p">);</span>
<span class="n">btn</span><span class="p">.</span><span class="n">prop</span><span class="p">(</span><span class="s2">"disabled"</span><span class="p">,</span><span class="w"> </span><span class="no">true</span><span class="p">);</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="k">Or</span><span class="w"> </span><span class="n n-Quoted">`false`</span>
</pre></div>

<p>This is in the newer versions of jQuery. The older way to do this is to add or
remove an attribute like so:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">btn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="s2">"#Button"</span><span class="p">);</span>
<span class="n">btn</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s2">"disabled"</span><span class="p">,</span><span class="w"> </span><span class="s2">"disabled"</span><span class="p">);</span>
<span class="o">//</span><span class="w"> </span><span class="ow">or</span>
<span class="n">btn</span><span class="o">.</span><span class="n">removeAttr</span><span class="p">(</span><span class="s2">"disabled"</span><span class="p">);</span>
</pre></div>

<p>The mere presence of the <code>disabled</code> property disables the element, so you
cannot set its value as "false". Even the following should disable the element</p>
<div class="code"><pre class="code literal-block">&lt;input type="button" value="Submit" disabled="" /&gt;
</pre></div>

<p>You need to either remove the attribute completely <strong>or</strong> set its property.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2599.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2597.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
