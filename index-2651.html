<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2651) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2651.html">
<link rel="prev" href="index-2652.html" type="text/html">
<link rel="next" href="index-2650.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/using-fonts-with-rails-asset-pipeline/" class="u-url">Using fonts with Rails asset pipeline</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/using-fonts-with-rails-asset-pipeline/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T07:45:47+08:00" itemprop="datePublished" title="2023-03-05 07:45">2023-03-05 07:45</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have some fonts being configured in my Scss file like so:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@font</span><span class="o">-</span><span class="n">face</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="n">font</span><span class="o">-</span><span class="nl">family</span><span class="p">:</span><span class="w"> </span><span class="s1">'Icomoon'</span><span class="p">;</span>
<span class="w">  </span><span class="nl">src</span><span class="p">:</span><span class="w"> </span><span class="n">asset</span><span class="o">-</span><span class="n">url</span><span class="p">(</span><span class="s1">'icoMoon.eot?#iefix'</span><span class="p">,</span><span class="w"> </span><span class="n">font</span><span class="p">)</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="s1">'embedded-opentype'</span><span class="p">),</span>
<span class="w">       </span><span class="n">asset</span><span class="o">-</span><span class="n">url</span><span class="p">(</span><span class="s1">'icoMoon.woff'</span><span class="p">,</span><span class="w"> </span><span class="n">font</span><span class="p">)</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="s1">'woff'</span><span class="p">),</span>
<span class="w">       </span><span class="n">asset</span><span class="o">-</span><span class="n">url</span><span class="p">(</span><span class="s1">'icoMoon.ttf'</span><span class="p">,</span><span class="w"> </span><span class="n">font</span><span class="p">)</span><span class="w">  </span><span class="nf">format</span><span class="p">(</span><span class="s1">'truetype'</span><span class="p">),</span>
<span class="w">       </span><span class="n">asset</span><span class="o">-</span><span class="n">url</span><span class="p">(</span><span class="s1">'icoMoon.svg#Icomoon'</span><span class="p">,</span><span class="w"> </span><span class="n">font</span><span class="p">)</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="s1">'svg'</span><span class="p">);</span>
<span class="err">}</span>
</pre></div>

<p>The actual font file are stored in /app/assets/fonts/</p>
<p>I have added <code>config.assets.paths &lt;&lt; Rails.root.join("app", "assets",
"fonts")</code> to my application.rb file</p>
<p>and the compile CSS source is as follows:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@font</span><span class="o">-</span><span class="n">face</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="n">font</span><span class="o">-</span><span class="nl">family</span><span class="p">:</span><span class="w"> </span><span class="s1">'Icomoon'</span><span class="p">;</span>
<span class="w">  </span><span class="nl">src</span><span class="p">:</span><span class="w"> </span><span class="n">url</span><span class="p">(</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">icoMoon</span><span class="p">.</span><span class="n">eot</span><span class="vm">?</span><span class="n">#iefix</span><span class="p">)</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="ss">"embedded-opentype"</span><span class="p">),</span><span class="w"> </span><span class="n">url</span><span class="p">(</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">icoMoon</span><span class="p">.</span><span class="n">woff</span><span class="p">)</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="ss">"woff"</span><span class="p">),</span><span class="w"> </span><span class="n">url</span><span class="p">(</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">icoMoon</span><span class="p">.</span><span class="n">ttf</span><span class="p">)</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="ss">"truetype"</span><span class="p">),</span><span class="w"> </span><span class="n">url</span><span class="p">(</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">icoMoon</span><span class="p">.</span><span class="n">svg#Icomoon</span><span class="p">)</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="ss">"svg"</span><span class="p">);</span>
<span class="err">}</span>
</pre></div>

<p>But when I run the app the font files are not being found. The logs:</p>
<blockquote>
<p>Started GET "/assets/icoMoon.ttf" for 127.0.0.1 at 2012-06-05 23:21:17 +0100
Served asset /icoMoon.ttf - 404 Not Found (13ms)</p>
</blockquote>
<p>Why isn't the asset pipeline flattening the font files down into just /assets?</p>
<p>Any ideas people?</p>
<p>Kind regards, Neil</p>
<p><strong>Extra info:</strong></p>
<p>When checking the rails console for assets paths and assetprecompile I get the
following:</p>
<div class="code"><pre class="code literal-block"><span class="mf">1.9.2</span><span class="n">p320</span><span class="w"> </span><span class="p">:</span><span class="mf">001</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">Rails</span><span class="mf">.</span><span class="n">application</span><span class="mf">.</span><span class="n">config</span><span class="mf">.</span><span class="n">assets</span><span class="mf">.</span><span class="n">precompile</span>
<span class="o">---</span>
<span class="o">-</span><span class="w"> </span><span class="err">!</span><span class="n">ruby</span><span class="o">/</span><span class="n">object</span><span class="p">:</span><span class="n">Proc</span><span class="w"> </span><span class="err">{}</span>
<span class="o">-</span><span class="w"> </span><span class="err">!</span><span class="n">ruby</span><span class="o">/</span><span class="n">regexp</span><span class="w"> </span><span class="o">/</span><span class="p">(</span><span class="err">?</span><span class="p">:</span><span class="err">\</span><span class="o">/</span><span class="err">|\\|\</span><span class="n">A</span><span class="p">)</span><span class="n">application</span><span class="err">\</span><span class="mf">.</span><span class="p">(</span><span class="n">css</span><span class="err">|</span><span class="n">js</span><span class="p">)</span><span class="err">$</span><span class="o">/</span>
<span class="o">-</span><span class="w"> </span><span class="mf">.</span><span class="n">svg</span>
<span class="o">-</span><span class="w"> </span><span class="mf">.</span><span class="n">eot</span>
<span class="o">-</span><span class="w"> </span><span class="mf">.</span><span class="n">woff</span>
<span class="o">-</span><span class="w"> </span><span class="mf">.</span><span class="n">ttf</span>
<span class="o">=&gt;</span><span class="w"> </span><span class="n">nil</span>



<span class="mf">1.9.2</span><span class="n">p320</span><span class="w"> </span><span class="p">:</span><span class="mf">002</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">Rails</span><span class="mf">.</span><span class="n">application</span><span class="mf">.</span><span class="n">config</span><span class="mf">.</span><span class="n">assets</span><span class="mf">.</span><span class="n">paths</span>
<span class="o">---</span>
<span class="o">-</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">fonts</span>
<span class="o">-</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">images</span>
<span class="o">-</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">javascripts</span>
<span class="o">-</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">stylesheets</span>
<span class="o">-</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">vendor</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">images</span>
<span class="o">-</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">vendor</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">javascripts</span>
<span class="o">-</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">vendor</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">stylesheets</span>
<span class="o">-</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="mf">.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mf">1.9.2</span><span class="o">-</span><span class="n">p320</span><span class="err">@</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">jquery</span><span class="o">-</span><span class="n">rails</span><span class="o">-</span><span class="mf">2.0.0</span><span class="o">/</span><span class="n">vendor</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">javascripts</span>
<span class="o">-</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="mf">.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mf">1.9.2</span><span class="o">-</span><span class="n">p320</span><span class="err">@</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">coffee</span><span class="o">-</span><span class="n">rails</span><span class="o">-</span><span class="mf">3.2.1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">javascripts</span>
<span class="o">-</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="mf">.</span><span class="n">rvm</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="mf">1.9.2</span><span class="o">-</span><span class="n">p320</span><span class="err">@</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">bourbon</span><span class="o">-</span><span class="mf">1.3.0</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">stylesheets</span>
<span class="o">-</span><span class="w"> </span><span class="err">!</span><span class="n">ruby</span><span class="o">/</span><span class="n">object</span><span class="p">:</span><span class="n">Pathname</span>
<span class="w">  </span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">neiltonge</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">fonts</span>
<span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">nil</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<ol>
<li>
<p>If your Rails version is between <code>&gt; 3.1.0</code> and <code>&lt; 4</code>, place your fonts in any of the these folders:</p>
<ul>
<li><code>app/assets/fonts</code></li>
<li><code>lib/assets/fonts</code></li>
<li><code>vendor/assets/fonts</code></li>
</ul>
</li>
</ol>
<p>For Rails versions <code>&gt; 4</code>, you <strong>must</strong> place your fonts in the
<code>app/assets/fonts</code> folder.</p>
<p><strong>Note:</strong> To place fonts outside of these designated folders, use the
following configuration:</p>
<p><code>config.assets.precompile &lt;&lt; /\.(?:svg|eot|woff|ttf)\z/</code></p>
<p>For Rails versions <code>&gt; 4.2</code>, it is <strong>recommended</strong> to add this configuration to
<code>config/initializers/assets.rb</code>.</p>
<p>However, you can also add it to either <code>config/application.rb</code> , or to
<code>config/production.rb</code></p>
<ol>
<li>Declare your font in your CSS file:<div class="code"><pre class="code literal-block"><span class="nv">@font</span><span class="o">-</span><span class="n">face</span><span class="w"> </span><span class="err">{</span>
</pre></div>

<p>font-family: 'Icomoon';
  src:url('icomoon.eot');
  src:url('icomoon.eot?#iefix') format('embedded-opentype'),
    url('icomoon.svg#icomoon') format('svg'),
    url('icomoon.woff') format('woff'),
    url('icomoon.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
}</p>
</li>
</ol>
<p>Make sure your font is named exactly the same as in the URL portion of the
declaration. Capital letters and punctuation marks matter. In this case, the
font should have the name <code>icomoon</code>.</p>
<ol>
<li>If you are using Sass or Less with Rails <code>&gt; 3.1.0</code> (your CSS file has <code>.scss</code> or <code>.less</code> extension), then change the <code>url(...)</code> in the font declaration to <code>font-url(...)</code>.</li>
</ol>
<p>Otherwise, your CSS file should have the extension <code>.css.erb</code>, and the font
declaration should be <code>url('&lt;%= asset_path(...) %&gt;')</code>.</p>
<p>If you are using Rails <code>&gt; 3.2.1</code>, you can use <code>font_path(...)</code> instead of
<code>asset_path(...)</code>. This helper does exactly the same thing but it's more
clear.</p>
<ol>
<li>Finally, use your font in your CSS like you declared it in the <code>font-family</code> part. If it was declared capitalized, you can use it like this:<div class="code"><pre class="code literal-block"><span class="nt">font-family</span><span class="o">:</span><span class="w"> </span><span class="s1">'Icomoon'</span><span class="o">;</span>
</pre></div>

</li>
</ol>
<p><br></p>
<h3>Suggest</h3>
<p>Now here's a twist:</p>
<blockquote>
<p>You should place all fonts in <code>app/assets/fonts/</code> as they <strong>WILL</strong> get
precompiled in staging and production by default—they will get precompiled
when pushed to <em>heroku</em>.</p>
<p>Font files placed in <code>vendor/assets</code> will <strong>NOT</strong> be precompiled on staging
or production by default — they will fail on <em>heroku</em>. Source!</p>
</blockquote>
<p>— @plapier, thoughtbot/bourbon</p>
<blockquote>
<p>I strongly believe that putting vendor fonts into <code>vendor/assets/fonts</code>
makes a lot more sense than putting them into <code>app/assets/fonts</code>. With these
2 lines of extra configuration this has worked well for me (on Rails 4):</p>
</blockquote>
<div class="code"><pre class="code literal-block">app.config.assets.paths &lt;&lt; Rails.root.join('vendor', 'assets', 'fonts')  
app.config.assets.precompile &lt;&lt; /\.(?:svg|eot|woff|ttf)$/
</pre></div>

<p>— @jhilden, thoughtbot/bourbon</p>
<p>I've also tested it on <code>rails 4.0.0</code>. Actually the last one line is enough to
safely precompile fonts from <code>vendor</code> folder. Took a couple of hours to figure
it out. Hope it helped someone.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/serialize-an-object-to-string/" class="u-url">Serialize an object to string</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/serialize-an-object-to-string/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T07:43:46+08:00" itemprop="datePublished" title="2023-03-05 07:43">2023-03-05 07:43</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have the following method to save an Object to a file:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// Save an object out to the disk</span>
<span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">SerializeObject</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">this</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">toSerialize</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">XmlSerializer</span><span class="w"> </span><span class="n">xmlSerializer</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">XmlSerializer</span><span class="p">(</span><span class="n">toSerialize</span><span class="p">.</span><span class="n">GetType</span><span class="p">());</span>
<span class="w">    </span><span class="n">TextWriter</span><span class="w"> </span><span class="n">textWriter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">StreamWriter</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>

<span class="w">    </span><span class="n">xmlSerializer</span><span class="p">.</span><span class="n">Serialize</span><span class="p">(</span><span class="n">textWriter</span><span class="p">,</span><span class="w"> </span><span class="n">toSerialize</span><span class="p">);</span>
<span class="w">    </span><span class="n">textWriter</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>I confess I did not write it (I only converted it to a extension method that
took a type parameter).</p>
<p>Now I need it to give the xml back to me as a string (rather than save it to a
file). I am looking into it, but I have not figured it out yet.</p>
<p>I thought this might be really easy for someone familiar with these objects.
If not I will figure it out eventually.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Use a <code>StringWriter</code> instead of a <code>StreamWriter</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="nv">SerializeObject</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">(</span><span class="nv">this</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">toSerialize</span><span class="ss">)</span>
{
<span class="w">    </span><span class="nv">XmlSerializer</span><span class="w"> </span><span class="nv">xmlSerializer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">XmlSerializer</span><span class="ss">(</span><span class="nv">toSerialize</span>.<span class="nv">GetType</span><span class="ss">())</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">using</span><span class="ss">(</span><span class="nv">StringWriter</span><span class="w"> </span><span class="nv">textWriter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">StringWriter</span><span class="ss">())</span>
<span class="w">    </span>{
<span class="w">        </span><span class="nv">xmlSerializer</span>.<span class="nv">Serialize</span><span class="ss">(</span><span class="nv">textWriter</span>,<span class="w"> </span><span class="nv">toSerialize</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">textWriter</span>.<span class="nv">ToString</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<p>Note, it is important to use <code>toSerialize.GetType()</code> instead of <code>typeof(T)</code> in
XmlSerializer constructor: if you use the first one the code covers all
possible subclasses of <code>T</code> (which are valid for the method), while using the
latter one will fail when passing a type derived from <code>T</code>. Here is a link with
some example code that motivate this statement, with <code>XmlSerializer</code> throwing
an <code>Exception</code> when <code>typeof(T)</code> is used, because you pass an instance of a
derived type to a method that calls SerializeObject that is defined in the
derived type's base class: http://ideone.com/1Z5J1.</p>
<p>Also, Ideone uses Mono to execute code; the actual <code>Exception</code> you would get
using the Microsoft .NET runtime has a different <code>Message</code> than the one shown
on Ideone, but it fails just the same.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Serialize and Deserialize XML/JSON (<code>SerializationHelper.cs</code>):</p>
<div class="code"><pre class="code literal-block"><span class="n">using Newtonsoft.Json;</span>
<span class="n">using System.IO;</span>
<span class="n">using System.Xml.Serialization;</span>

<span class="n">namespace MyProject.Helpers</span>
<span class="n">{</span>
<span class="n">    public static class SerializationHelper</span>
<span class="n">    {</span>
<span class="n">        public static T DeserializeXml&lt;T&gt;(this string toDeserialize)</span>
<span class="n">        {</span>
<span class="n">            XmlSerializer xmlSerializer = new XmlSerializer(typeof(T));</span>
<span class="n">            using (StringReader textReader = new StringReader(toDeserialize))</span>
<span class="n">            {</span>
<span class="n">                return (T)xmlSerializer.Deserialize(textReader);</span>
<span class="n">            }</span>
<span class="n">        }</span>

<span class="n">        public static string SerializeXml&lt;T&gt;(this T toSerialize)</span>
<span class="n">        {</span>
<span class="n">            XmlSerializer xmlSerializer = new XmlSerializer(typeof(T));</span>
<span class="n">            using (StringWriter textWriter = new StringWriter())</span>
<span class="n">            {</span>
<span class="n">                xmlSerializer.Serialize(textWriter, toSerialize);</span>
<span class="n">                return textWriter.ToString();</span>
<span class="n">            }</span>
<span class="n">        }</span>

<span class="n">        public static T DeserializeJson&lt;T&gt;(this string toDeserialize)</span>
<span class="n">        {</span>
<span class="n">            return JsonConvert.DeserializeObject&lt;T&gt;(toDeserialize);</span>
<span class="n">        }</span>

<span class="n">        public static string SerializeJson&lt;T&gt;(this T toSerialize)</span>
<span class="n">        {</span>
<span class="n">            return JsonConvert.SerializeObject(toSerialize);</span>
<span class="n">        }</span>
<span class="n">    }</span>
<span class="n">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-make-a-batch-file-terminate-upon-encountering-an-error/" class="u-url">How do I make a batch file terminate upon encountering an error?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-make-a-batch-file-terminate-upon-encountering-an-error/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T07:42:19+08:00" itemprop="datePublished" title="2023-03-05 07:42">2023-03-05 07:42</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a batch file that's calling the same executable over and over with
different parameters. How do I make it terminate immediately if one of the
calls returns an error code of any level?</p>
<p>Basically, I want the equivalent of MSBuild's <code>ContinueOnError=false</code>.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Check the <code>errorlevel</code> in an <code>if</code> statement, and then <code>exit /b</code> (exit the
<strong>b</strong> atch file only, not the entire cmd.exe process) for values other than 0.</p>
<div class="code"><pre class="code literal-block"><span class="nv">same</span><span class="o">-</span><span class="nv">executable</span><span class="o">-</span><span class="nv">over</span><span class="o">-</span><span class="nv">and</span><span class="o">-</span><span class="nv">over</span>.<span class="nv">exe</span><span class="w"> </span><span class="o">/</span><span class="nv">with</span><span class="w"> </span><span class="nv">different</span><span class="w"> </span><span class="s2">"parameters"</span>
<span class="k">if</span><span class="w"> </span><span class="o">%</span><span class="nv">errorlevel</span><span class="o">%</span><span class="w"> </span><span class="nv">neq</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">exit</span><span class="w"> </span><span class="o">/</span><span class="nv">b</span><span class="w"> </span><span class="o">%</span><span class="nv">errorlevel</span><span class="o">%</span>
</pre></div>

<p>If you want the value of the errorlevel to propagate outside of your batch
file</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="o">%</span><span class="nv">errorlevel</span><span class="o">%</span><span class="w"> </span><span class="nv">neq</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">exit</span><span class="w"> </span><span class="o">/</span><span class="nv">b</span><span class="w"> </span><span class="o">%</span><span class="nv">errorlevel</span><span class="o">%</span>
</pre></div>

<p>but if this is inside a <code>for</code> it gets a bit tricky. You'll need something more
like:</p>
<div class="code"><pre class="code literal-block">setlocal enabledelayedexpansion
for %%f in (C:\Windows\*) do (
    same-executable-over-and-over.exe /with different "parameters"
    if !errorlevel! neq 0 exit /b !errorlevel!
)
</pre></div>

<p><strong>Edit:</strong> You have to check the error after each command. There's no global
"on error goto" type of construct in cmd.exe/command.com batch. I've also
updated my code per CodeMonkey, although I've never encountered a negative
errorlevel in any of my batch-hacking on XP or Vista.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Add <code>|| goto :label</code> to each line, and then define a <code>:label</code>.</p>
<p>For example, create this .cmd file:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@echo</span><span class="w"> </span><span class="k">off</span>

<span class="n">echo</span><span class="w"> </span><span class="n">Starting</span><span class="w"> </span><span class="n">very</span><span class="w"> </span><span class="n">complicated</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="k">file</span><span class="p">...</span>
<span class="n">ping</span><span class="w"> </span><span class="o">-</span><span class="n">invalid</span><span class="o">-</span><span class="n">arg</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="err">:</span><span class="n">error</span>
<span class="n">echo</span><span class="w"> </span><span class="n">OH</span><span class="w"> </span><span class="n">noes</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">shouldn</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">succeeded</span><span class="p">.</span>
<span class="k">goto</span><span class="w"> </span><span class="err">:</span><span class="n">EOF</span>

<span class="err">:</span><span class="n">error</span>
<span class="n">echo</span><span class="w"> </span><span class="n">Failed</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="err">#</span><span class="o">%</span><span class="n">errorlevel</span><span class="o">%</span><span class="p">.</span>
<span class="k">exit</span><span class="w"> </span><span class="o">/</span><span class="n">b</span><span class="w"> </span><span class="o">%</span><span class="n">errorlevel</span><span class="o">%</span>
</pre></div>

<p>See also question about exiting batch file subroutine.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2652.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2650.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
