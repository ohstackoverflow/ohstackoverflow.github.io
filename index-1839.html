<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1839) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1839.html">
<link rel="prev" href="index-1840.html" type="text/html">
<link rel="next" href="index-1838.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-get-a-cron-like-scheduler-in-python/" class="u-url">How do I get a Cron like scheduler in Python?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-get-a-cron-like-scheduler-in-python/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T10:34:34+08:00" itemprop="datePublished" title="2023-03-03 10:34">2023-03-03 10:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm looking for a library in Python which will provide <code>at</code> and <code>cron</code> like
functionality.</p>
<p>I'd quite like have a pure Python solution, rather than relying on tools
installed on the box; this way I run on machines with no cron.</p>
<p>For those unfamiliar with <code>cron</code>: you can schedule tasks based upon an
expression like:</p>
<div class="code"><pre class="code literal-block"> 0 2 * * 7 /usr/bin/run-backup # run the backups at 0200 on Every Sunday
 0 9-17/2 * * 1-5 /usr/bin/purge-temps # run the purge temps command, every 2 hours between 9am and 5pm on Mondays to Fridays.
</pre></div>

<p>The cron time expression syntax is less important, but I would like to have
something with this sort of flexibility.</p>
<p>If there isn't something that does this for me out-the-box, any suggestions
for the building blocks to make something like this would be gratefully
received.</p>
<p><strong>Edit</strong> I'm not interested in launching processes, just "jobs" also written
in Python - python functions. By necessity I think this would be a different
thread, but not in a different process.</p>
<p>To this end, I'm looking for the expressivity of the cron time expression, but
in Python.</p>
<p>Cron <em>has</em> been around for years, but I'm trying to be as portable as
possible. I cannot rely on its presence.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>If you're looking for something lightweight checkout schedule:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">schedule</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">job</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"I'm working..."</span><span class="p">)</span>

<span class="n">schedule</span><span class="o">.</span><span class="n">every</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">minutes</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
<span class="n">schedule</span><span class="o">.</span><span class="n">every</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
<span class="n">schedule</span><span class="o">.</span><span class="n">every</span><span class="p">()</span><span class="o">.</span><span class="n">day</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="s2">"10:30"</span><span class="p">)</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>

<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">run_pending</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

<p><em>Disclosure</em> : I'm the author of that library.</p>
<p><br></p>
<h3>Suggest</h3>
<p>You could just use normal Python argument passing syntax to specify your
crontab. For example, suppose we define an Event class as below:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Some utility classes / functions first</span>
<span class="k">class</span> <span class="nc">AllMatch</span><span class="p">(</span><span class="nb">set</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Universal set - match everything"""</span>
    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span> <span class="k">return</span> <span class="kc">True</span>

<span class="n">allMatch</span> <span class="o">=</span> <span class="n">AllMatch</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">conv_to_set</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>  <span class="c1"># Allow single integer to be provided</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">long</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="n">obj</span><span class="p">])</span>  <span class="c1"># Single item</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span>

<span class="c1"># The actual Event class</span>
<span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">allMatch</span><span class="p">,</span> <span class="n">hour</span><span class="o">=</span><span class="n">allMatch</span><span class="p">,</span> 
                       <span class="n">day</span><span class="o">=</span><span class="n">allMatch</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="n">allMatch</span><span class="p">,</span> <span class="n">dow</span><span class="o">=</span><span class="n">allMatch</span><span class="p">,</span> 
                       <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mins</span> <span class="o">=</span> <span class="n">conv_to_set</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hours</span><span class="o">=</span> <span class="n">conv_to_set</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">days</span> <span class="o">=</span> <span class="n">conv_to_set</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">months</span> <span class="o">=</span> <span class="n">conv_to_set</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dow</span> <span class="o">=</span> <span class="n">conv_to_set</span><span class="p">(</span><span class="n">dow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="k">def</span> <span class="nf">matchtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Return True if this event should trigger at the specified datetime"""</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">t</span><span class="o">.</span><span class="n">minute</span>     <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mins</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">hour</span>       <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hours</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">day</span>        <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">days</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">month</span>      <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">months</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>  <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dow</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchtime</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

<p>(Note: Not thoroughly tested)</p>
<p>Then your CronTab can be specified in normal python syntax as:</p>
<div class="code"><pre class="code literal-block">c = CronTab(
  Event(perform_backup, 0, 2, dow=6 ),
  Event(purge_temps, 0, range(9,18,2), dow=range(0,5))
)
</pre></div>

<p>This way you get the full power of Python's argument mechanics (mixing
positional and keyword args, and can use symbolic names for names of weeks and
months)</p>
<p>The CronTab class would be defined as simply sleeping in minute increments,
and calling check() on each event. (There are probably some subtleties with
daylight savings time / timezones to be wary of though). Here's a quick
implementation:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">CronTab</span>(<span class="n">object</span>):
    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, *<span class="n">events</span>):
        <span class="nb">self</span>.<span class="n">events</span> = <span class="n">events</span>

    <span class="n">def</span> <span class="nb">run</span>(<span class="nb">self</span>):
        <span class="nb">t</span>=<span class="n">datetime</span>(*<span class="n">datetime</span>.<span class="nb">now</span>().<span class="n">timetuple</span>()[:<span class="mi">5</span>])
        <span class="k">while</span> <span class="mi">1</span>:
            <span class="k">for</span> <span class="nb">e</span> <span class="nb">in</span> <span class="nb">self</span>.<span class="n">events:</span>
                <span class="nb">e</span>.<span class="n">check</span>(<span class="nb">t</span>)

            <span class="nb">t</span> += <span class="n">timedelta</span>(<span class="n">minutes</span>=<span class="mi">1</span>)
            <span class="k">while</span> <span class="n">datetime</span>.<span class="nb">now</span>() &lt; <span class="n">t:</span>
                <span class="n">time</span>.<span class="nb">sleep</span>((<span class="nb">t</span> - <span class="n">datetime</span>.<span class="nb">now</span>()).<span class="n">seconds</span>)
</pre></div>

<p>A few things to note: Python's weekdays / months are zero indexed (unlike
cron), and that range excludes the last element, hence syntax like "1-5"
becomes range(0,5) - ie [0,1,2,3,4]. If you prefer cron syntax, parsing it
shouldn't be too difficult however.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-install-the-yaml-package-for-python/" class="u-url">How do I install the yaml package for Python?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-install-the-yaml-package-for-python/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T10:34:09+08:00" itemprop="datePublished" title="2023-03-03 10:34">2023-03-03 10:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a Python program that uses YAML. I attempted to install it on a new
server using <code>pip install yaml</code> and it returns the following:</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">yaml</span>
<span class="n">Downloading</span><span class="o">/</span><span class="n">unpacking</span><span class="w"> </span><span class="n">yaml</span>
<span class="w">  </span><span class="n">Could</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">downloads</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">satisfy</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">requirement</span><span class="w"> </span><span class="n">yaml</span>
<span class="n">No</span><span class="w"> </span><span class="n">distributions</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">yaml</span>
<span class="n">Storing</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="nb">log</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">pa</span><span class="o">/.</span><span class="n">pip</span><span class="o">/</span><span class="n">pip</span><span class="o">.</span><span class="n">log</span>
</pre></div>

<p>How do I install the yaml package for Python? I'm running Python 2.7. (OS:
Debian Wheezy)</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You could try the search feature in pip,</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>pip<span class="w"> </span>search<span class="w"> </span>yaml
</pre></div>

<p>which looks for packages in PyPI with yaml in the short description. That
reveals various packages, including PyYaml, yamltools, and PySyck, among
others (Note that PySyck docs recommend using PyYaml, since syck is out of
date). Now you know a specific package name, you can install it:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pyyaml
</pre></div>

<p>If you want to install python yaml system-wide in linux, you can also use a
package manager, like <code>aptitude</code> or <code>yum</code>:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>python-yaml
$<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>python-yaml
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p><code>pip install pyyaml</code></p>
<p>If you don't have pip, run <code>easy_install pip</code> to install pip, which is the go-
to package installer - Why use pip over easy_install?. If you prefer to stick
with easy_install, then <code>easy_install pyyaml</code></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-revert-a-git-rm-r/" class="u-url">How to revert a "git rm -r ."?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-revert-a-git-rm-r/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T10:33:40+08:00" itemprop="datePublished" title="2023-03-03 10:33">2023-03-03 10:33</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I accidentely said <code>git rm -r .</code>. How do I recover from this?</p>
<p>I did not commit.</p>
<p>I think all files were marked for deletion and were also physically removed
from my local checkout.</p>
<p><em>EDIT:</em> I could (if I knew the command) revert to the last commit. But it
would be a lot better if I could just undo the <code>git rm -r .</code>. Because I am not
really sure what I did after the last commit and before the <code>git rm -r .</code>.</p>
<p><br><br></p>
<h2>Answer</h2>
<div class="code"><pre class="code literal-block">git reset HEAD
</pre></div>

<p>Should do it. If you don't have any uncommitted changes that you care about,
then</p>
<div class="code"><pre class="code literal-block">git reset --hard HEAD
</pre></div>

<p>should forcibly reset everything to your last commit. If you do have
uncommitted changes, but the first command doesn't work, then save your
uncommitted changes with <code>git stash</code>:</p>
<div class="code"><pre class="code literal-block">git stash
git reset --hard HEAD
git stash pop
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I git-rm'd a few files and went on making changes before my next commit when I
realized I needed some of those files back. Rather than stash and reset, you
can simply checkout the individual files you missed/removed if you want:</p>
<div class="code"><pre class="code literal-block">git checkout HEAD path/to/file path/to/another_file
</pre></div>

<p>This leaves your other uncommitted changes intact with no workarounds.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1840.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1838.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
