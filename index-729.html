<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 729) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-729.html">
<link rel="prev" href="index-730.html" type="text/html">
<link rel="next" href="index-728.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ru-he-zai-visual-studio-code-zhong-da-kai-he-guan-bi-zi-dong-huan-xing/" class="u-url">如何在 Visual Studio Code 中打开和关闭自动换行？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ru-he-zai-visual-studio-code-zhong-da-kai-he-guan-bi-zi-dong-huan-xing/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T14:35:24+08:00" itemprop="datePublished" title="2023-02-17 14:35">2023-02-17 14:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>使用代码文件时，通常不需要较长的行来环绕。但是，对于<code>.md</code>文件，这实际上非常有用。但是， <strong>我似乎找不到启用自动换行的选项</strong> ，因此将换行更长的行。</p>
<p>要重现，请打开已调整为足够小的窗口的 Visual Studio Code，并在新文档中输入以下文本：</p>
<div class="code"><pre class="code literal-block">This is my test lorem ipsum. This is my test lorem ipsum. This is my test lorem ipsum. This is my test lorem ipsum. This is my test lorem ipsum. This is my test lorem ipsum. This is my test lorem ipsum. This is my test lorem ipsum. This is my test lorem ipsum.
A linebreak before this.
</pre></div>

<p>效果是这样的：</p>
<p><img alt="缺少自动换行的示例" src="images/mgitS.png"></p>
<p>我试图让水平滚动条远离，让第 1 行环绕在窗口的右侧。</p>
<p>我做了一些事情来回答我自己的问题：</p>
<ul>
<li>搜索堆栈溢出：在撰写本文时为零结果；</li>
<li>仔细查看 Visual Studio Code 的菜单：没找到；</li>
<li>使用带有“wrap”的命令面板：没有给出匹配的命令。</li>
</ul>
<p>也许这是不可能的，我需要提交功能请求？或者我错过了什么？</p>
<p>请注意，我希望能够快速打开和关闭它。其一，@PanagiotisKanavos
在评论中提到了这个改变设置中包装行为的解决方案，但我正在寻找一个快速命令或菜单选项来执行此操作（很像 Notepad++ 和 Sublime Text 2
具有的功能）。</p>
<p><br><br></p>
<h2>解答</h2>
<p>从 v1.0 开始，您可以切换自动换行：</p>
<ul>
<li>使用新命令 <em>editor.action.toggleWordWrap</em> ，或</li>
<li>从 <em>视图</em> 菜单（<em>视图</em>* → <em>切换自动换行</em> ），或</li>
<li>使用<code>ALT</code>+<code>Z</code>键盘快捷键（对于 Mac：<code>⌥</code>+ <code>Z</code>）。</li>
</ul>
<p>它也可以通过以下设置进行控制：</p>
<ul>
<li><em>编辑器.wordWrap</em></li>
<li><em>editor.wordWrapColumn</em></li>
<li><em>editor.wrappingIndent</em></li>
</ul>
<hr>
<p>已知的问题：</p>
<ol>
<li>renderLineHighlight 应该突出显示整个逻辑行</li>
</ol>
<p>如果您希望修复这些错误，请为它们投票。</p>
<p><br></p>
<h3>更多建议</h3>
<p>转到菜单 <em>文件</em> → <em>首选项</em> → <em>用户设置</em> 。</p>
<p>它将自动打开默认设置<code>settings.json</code>。只需在文件中添加以下内容<code>settings.json</code>并保存即可。这将覆盖默认设置。</p>
<div class="code"><pre class="code literal-block"><span class="c1">// Place your settings in this file to overwrite the default settings</span>
<span class="p">{</span><span class="w"> </span><span class="s">"editor.wrappingColumn"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span>
</pre></div>

<p><img alt="正在编辑的设置的屏幕截图。" src="images/ouXmw.png"></p>
<p><br><br><a href="posts/how-can-i-switch-word-wrap-on-and-off-in-visual-studio-code/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/zheng-ze-biao-da-shi-zai-di-yi-ci-pi-pei-shi-ting-zhi/" class="u-url">正则表达式在第一次匹配时停止</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/zheng-ze-biao-da-shi-zai-di-yi-ci-pi-pei-shi-ting-zhi/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T14:34:28+08:00" itemprop="datePublished" title="2023-02-17 14:34">2023-02-17 14:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我的正则表达式模式看起来像</p>
<div class="code"><pre class="code literal-block">&lt;xxxx location="file path/level1/level2" xxxx some="xxx"&gt;
</pre></div>

<p>我只对分配给位置的报价部分感兴趣。如果没有贪婪开关，它不应该像下面这样简单吗？</p>
<div class="code"><pre class="code literal-block">/.*location="(.*)".*/
</pre></div>

<p>似乎不起作用。</p>
<p><br><br></p>
<h2>解答</h2>
<p>您需要使您的正则表达式惰性/非贪婪，因为默认情况下，<code>"(.*)"</code>将匹配所有<code>"file path/level1/level2" xxx
some="xxx"</code>.</p>
<p>相反，你可以让你的 dot-star 非贪婪，这将使其匹配尽可能少的字符：</p>
<div class="code"><pre class="code literal-block">/location="(.*?)"/
</pre></div>

<p><code>?</code>在量词 ( <code>?</code>, <code>*</code>or ) 上添加 a<code>+</code>使其成为非贪婪的。</p>
<p>注意：这仅在实现 Perl 5 扩展（Java、Ruby、Python 等）的正则表达式引擎中可用，但在“传统”正则表达式引擎（包括 Awk、,
<code>sed</code>without<code>grep</code>等<code>-P</code>）中不可用。</p>
<p><br></p>
<h3>更多建议</h3>
<p><code>location="(.*)"</code>除非您使其不贪婪，否则将从<code>"</code>之后一直匹配到之后<code>location=</code>。<code>"``some="xxx</code></p>
<p>所以你要么需要<code>.*?</code>（即通过添加 使其非贪婪<code>?</code>）或更好地替换<code>.*</code>为<code>[^"]*</code>。</p>
<ul>
<li>
<code>[^"]</code>匹配除 " <quotation-mark> 之外的任何字符</quotation-mark>
</li>
<li>更通用：<code>[^abc]</code>- 匹配除 a、b 或 c 之外的任何字符</li>
</ul>
<p><br><br><a href="posts/regular-expression-to-stop-at-first-match/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ru-he-shi-yong-pythonzhao-chu-cpude-shu-liang/" class="u-url">如何使用python找出CPU的数量</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ru-he-shi-yong-pythonzhao-chu-cpude-shu-liang/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T14:33:58+08:00" itemprop="datePublished" title="2023-02-17 14:33">2023-02-17 14:33</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我想知道使用 Python 的本地机器上的 CPU 数量。当使用优化缩放的仅限用户空间的程序调用时，结果应该是<code>user/real</code>输出。<code>time(1)</code></p>
<p><br><br></p>
<h2>解答</h2>
<p><em>如果您对当前进程可用的</em> 处理器数量感兴趣，则必须先检查cpuset 。否则（或者如果 cpuset
未被使用），<code>multiprocessing.cpu_count()</code>是 Python 2.6 及更新版本的方法。以下方法回退到旧版本 Python
中的几个替代方法：</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">subprocess</span>


<span class="k">def</span> <span class="nf">available_cpu_count</span><span class="p">():</span>
<span class="w">    </span><span class="sd">""" Number of available virtual or physical CPUs on this system, i.e.</span>
<span class="sd">    user/real as output by time(1) when called with an optimally scaling</span>
<span class="sd">    userspace-only program"""</span>

    <span class="c1"># cpuset</span>
    <span class="c1"># cpuset may restrict the number of *available* processors</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">'(?m)^Cpus_allowed:\s*(.*)$'</span><span class="p">,</span>
                      <span class="nb">open</span><span class="p">(</span><span class="s1">'/proc/self/status'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span> <span class="mi">16</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'1'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Python 2.6+</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">multiprocessing</span>
        <span class="k">return</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># https://github.com/giampaolo/psutil</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">psutil</span>
        <span class="k">return</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>   <span class="c1"># psutil.NUM_CPUS on old versions</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># POSIX</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sysconf</span><span class="p">(</span><span class="s1">'SC_NPROCESSORS_ONLN'</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># Windows</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'NUMBER_OF_PROCESSORS'</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># jython</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">java.lang</span> <span class="kn">import</span> <span class="n">Runtime</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">.</span><span class="n">getRuntime</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">.</span><span class="n">availableProcessors</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># BSD</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sysctl</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'sysctl'</span><span class="p">,</span> <span class="s1">'-n'</span><span class="p">,</span> <span class="s1">'hw.ncpu'</span><span class="p">],</span>
                                  <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">scStdout</span> <span class="o">=</span> <span class="n">sysctl</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scStdout</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># Linux</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'/proc/cpuinfo'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'processor</span><span class="se">\t</span><span class="s1">:'</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Solaris</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pseudoDevices</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">'/devices/pseudo/'</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">pd</span> <span class="ow">in</span> <span class="n">pseudoDevices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'^cpuid@[0-9]+$'</span><span class="p">,</span> <span class="n">pd</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Other UNIXes (heuristic)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dmesg</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'/var/run/dmesg.boot'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">dmesgProcess</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'dmesg'</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
            <span class="n">dmesg</span> <span class="o">=</span> <span class="n">dmesgProcess</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">cpu'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">+</span> <span class="s1">':'</span> <span class="ow">in</span> <span class="n">dmesg</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Can not determine number of CPUs on this system'</span><span class="p">)</span>
</pre></div>

<p><br></p>
<h3>更多建议</h3>
<p><em>如果您对当前进程可用的</em> 处理器数量感兴趣，则必须先检查cpuset 。否则（或者如果 cpuset
未被使用），<code>multiprocessing.cpu_count()</code>是 Python 2.6 及更新版本的方法。以下方法回退到旧版本 Python
中的几个替代方法：</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">subprocess</span>


<span class="k">def</span> <span class="nf">available_cpu_count</span><span class="p">():</span>
<span class="w">    </span><span class="sd">""" Number of available virtual or physical CPUs on this system, i.e.</span>
<span class="sd">    user/real as output by time(1) when called with an optimally scaling</span>
<span class="sd">    userspace-only program"""</span>

    <span class="c1"># cpuset</span>
    <span class="c1"># cpuset may restrict the number of *available* processors</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">'(?m)^Cpus_allowed:\s*(.*)$'</span><span class="p">,</span>
                      <span class="nb">open</span><span class="p">(</span><span class="s1">'/proc/self/status'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span> <span class="s1">''</span><span class="p">),</span> <span class="mi">16</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'1'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Python 2.6+</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">multiprocessing</span>
        <span class="k">return</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># https://github.com/giampaolo/psutil</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">psutil</span>
        <span class="k">return</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>   <span class="c1"># psutil.NUM_CPUS on old versions</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># POSIX</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sysconf</span><span class="p">(</span><span class="s1">'SC_NPROCESSORS_ONLN'</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># Windows</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'NUMBER_OF_PROCESSORS'</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># jython</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">java.lang</span> <span class="kn">import</span> <span class="n">Runtime</span>
        <span class="n">runtime</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">.</span><span class="n">getRuntime</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">.</span><span class="n">availableProcessors</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># BSD</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sysctl</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'sysctl'</span><span class="p">,</span> <span class="s1">'-n'</span><span class="p">,</span> <span class="s1">'hw.ncpu'</span><span class="p">],</span>
                                  <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">scStdout</span> <span class="o">=</span> <span class="n">sysctl</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scStdout</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># Linux</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'/proc/cpuinfo'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">'processor</span><span class="se">\t</span><span class="s1">:'</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Solaris</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pseudoDevices</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">'/devices/pseudo/'</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">pd</span> <span class="ow">in</span> <span class="n">pseudoDevices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">'^cpuid@[0-9]+$'</span><span class="p">,</span> <span class="n">pd</span><span class="p">):</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Other UNIXes (heuristic)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dmesg</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'/var/run/dmesg.boot'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">dmesgProcess</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'dmesg'</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
            <span class="n">dmesg</span> <span class="o">=</span> <span class="n">dmesgProcess</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">cpu'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">+</span> <span class="s1">':'</span> <span class="ow">in</span> <span class="n">dmesg</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">res</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">res</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">'Can not determine number of CPUs on this system'</span><span class="p">)</span>
</pre></div>

<p><br><br><a href="posts/how-to-find-out-the-number-of-cpus-using-python/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-730.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-728.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
