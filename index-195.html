<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 195) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-195.html">
<link rel="prev" href="index-196.html" type="text/html">
<link rel="next" href="index-194.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-a-lambda-expression-in-c-11/" class="u-url">What is a lambda expression in C++11?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-a-lambda-expression-in-c-11/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T00:30:08+08:00" itemprop="datePublished" title="2023-02-17 00:30">2023-02-17 00:30</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What is a lambda expression in C++11? When would I use one? What class of
problem do they solve that wasn't possible prior to their introduction?</p>
<p>A few examples, and use cases would be useful.</p>
<p><br><br></p>
<h2>Answer</h2>
<h2>The problem</h2>
<p>C++ includes useful generic functions like <code>std::for_each</code> and
<code>std::transform</code>, which can be very handy. Unfortunately they can also be
quite cumbersome to use, particularly if the functor you would like to apply
is unique to the particular function.</p>
<div class="code"><pre class="code literal-block"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>

<span class="n">namespace</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kr">struct</span><span class="w"> </span><span class="nc">f</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">void</span><span class="w"> </span><span class="kr">operator</span><span class="p">()(</span><span class="kr">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// do something</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">}</span>

<span class="kr">void</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kr">int</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">f</span><span class="w"> </span><span class="n">f</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="nf">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="nf">end</span><span class="p">(),</span><span class="w"> </span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you only use <code>f</code> once and in that specific place it seems overkill to be
writing a whole class just to do something trivial and one off.</p>
<p>In C++03 you might be tempted to write something like the following, to keep
the functor local:</p>
<div class="code"><pre class="code literal-block"><span class="nt">void</span><span class="w"> </span><span class="nt">func2</span><span class="o">(</span><span class="nt">std</span><span class="p">::</span><span class="nd">vector</span><span class="o">&lt;</span><span class="nt">int</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="nt">v</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">struct</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="err">void</span><span class="w"> </span><span class="err">operator()(int)</span><span class="w"> </span><span class="err">{</span>
<span class="w">       </span><span class="err">//</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">something</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="err">}</span><span class="w"> </span><span class="nt">f</span><span class="o">;</span>
<span class="w">  </span><span class="nt">std</span><span class="p">::</span><span class="nd">for_each</span><span class="o">(</span><span class="nt">v</span><span class="p">.</span><span class="nc">begin</span><span class="o">(),</span><span class="w"> </span><span class="nt">v</span><span class="p">.</span><span class="nc">end</span><span class="o">(),</span><span class="w"> </span><span class="nt">f</span><span class="o">);</span>
<span class="err">}</span>
</pre></div>

<p>however this is not allowed, <code>f</code> cannot be passed to a template function in
C++03.</p>
<h2>The new solution</h2>
<p>C++11 introduces lambdas allow you to write an inline, anonymous functor to
replace the <code>struct f</code>. For small simple examples this can be cleaner to read
(it keeps everything in one place) and potentially simpler to maintain, for
example in the simplest form:</p>
<div class="code"><pre class="code literal-block"><span class="nt">void</span><span class="w"> </span><span class="nt">func3</span><span class="o">(</span><span class="nt">std</span><span class="p">::</span><span class="nd">vector</span><span class="o">&lt;</span><span class="nt">int</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="nt">v</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="p">:</span><span class="o">:</span><span class="nf">for_each</span><span class="p">(</span><span class="n">v</span><span class="err">.</span><span class="nf">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">v</span><span class="err">.</span><span class="kc">end</span><span class="err">(</span><span class="p">),</span><span class="w"> </span><span class="cp">[]</span><span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="c">/* do something here*/</span><span class="w"> </span><span class="p">}</span><span class="o">);</span>
<span class="err">}</span>
</pre></div>

<p>Lambda functions are just syntactic sugar for anonymous functors.</p>
<h3>Return types</h3>
<p>In simple cases the return type of the lambda is deduced for you, e.g.:</p>
<div class="code"><pre class="code literal-block"><span class="nt">void</span><span class="w"> </span><span class="nt">func4</span><span class="o">(</span><span class="nt">std</span><span class="p">::</span><span class="nd">vector</span><span class="o">&lt;</span><span class="nt">double</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="nt">v</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="p">:</span><span class="o">:</span><span class="nf">transform</span><span class="p">(</span><span class="n">v</span><span class="err">.</span><span class="nf">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">v</span><span class="err">.</span><span class="kc">end</span><span class="err">(</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="o">.</span><span class="nf">begin</span><span class="p">(),</span>
<span class="w">                 </span><span class="cp">[]</span><span class="p">(</span><span class="kc">double</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.00001</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">d</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">                 </span><span class="o">);</span>
<span class="err">}</span>
</pre></div>

<p>however when you start to write more complex lambdas you will quickly
encounter cases where the return type cannot be deduced by the compiler, e.g.:</p>
<div class="code"><pre class="code literal-block"><span class="nt">void</span><span class="w"> </span><span class="nt">func4</span><span class="o">(</span><span class="nt">std</span><span class="p">::</span><span class="nd">vector</span><span class="o">&lt;</span><span class="nt">double</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="nt">v</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="p">:</span><span class="o">:</span><span class="nf">transform</span><span class="p">(</span><span class="n">v</span><span class="err">.</span><span class="nf">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">v</span><span class="err">.</span><span class="kc">end</span><span class="err">(</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="o">.</span><span class="nf">begin</span><span class="p">(),</span>
<span class="w">        </span><span class="cp">[]</span><span class="p">(</span><span class="kc">double</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0001</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="n">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="nt">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">return</span><span class="w"> </span><span class="err">d</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="err">}</span><span class="o">);</span>
<span class="err">}</span>
</pre></div>

<p>To resolve this you are allowed to explicitly specify a return type for a
lambda function, using <code>-&gt; T</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nt">void</span><span class="w"> </span><span class="nt">func4</span><span class="o">(</span><span class="nt">std</span><span class="p">::</span><span class="nd">vector</span><span class="o">&lt;</span><span class="nt">double</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="nt">v</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="p">:</span><span class="o">:</span><span class="nf">transform</span><span class="p">(</span><span class="n">v</span><span class="err">.</span><span class="nf">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">v</span><span class="err">.</span><span class="kc">end</span><span class="err">(</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="o">.</span><span class="nf">begin</span><span class="p">(),</span>
<span class="w">        </span><span class="cp">[]</span><span class="p">(</span><span class="kc">double</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">double</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0001</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="n">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="nt">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">return</span><span class="w"> </span><span class="err">d</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="err">}</span><span class="o">);</span>
<span class="err">}</span>
</pre></div>

<h3>"Capturing" variables</h3>
<p>So far we've not used anything other than what was passed to the lambda within
it, but we can also use other variables, within the lambda. If you want to
access other variables you can use the capture clause (the <code>[]</code> of the
expression), which has so far been unused in these examples, e.g.:</p>
<div class="code"><pre class="code literal-block"><span class="n">void</span><span class="w"> </span><span class="n">func5</span><span class="p">(</span><span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">double</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="k">double</span><span class="o">&amp;</span><span class="w"> </span><span class="n">epsilon</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">transform</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="k">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="k">end</span><span class="p">(),</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="k">begin</span><span class="p">(),</span>
<span class="w">        </span><span class="o">[</span><span class="n">epsilon</span><span class="o">]</span><span class="p">(</span><span class="k">double</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">double</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">epsilon</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="err">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">        </span><span class="err">}</span><span class="p">);</span>
<span class="err">}</span>
</pre></div>

<p>You can capture by both reference and value, which you can specify using <code>&amp;</code>
and <code>=</code> respectively:</p>
<ul>
<li>
<code>[&amp;epsilon, zeta]</code> captures epsilon by reference and zeta by value</li>
<li>
<code>[&amp;]</code> captures all variables used in the lambda by reference</li>
<li>
<code>[=]</code> captures all variables used in the lambda by value</li>
<li>
<code>[&amp;, epsilon]</code> captures all variables used in the lambda by reference but captures epsilon by value</li>
<li>
<code>[=, &amp;epsilon]</code> captures all variables used in the lambda by value but captures epsilon by reference</li>
</ul>
<p>The generated <code>operator()</code> is <code>const</code> by default, with the implication that
captures will be <code>const</code> when you access them by default. This has the effect
that each call with the same input would produce the same result, however you
can mark the lambda as <code>mutable</code> to request that the <code>operator()</code> that is
produced is not <code>const</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<h2>What is a lambda function?</h2>
<p>The C++ concept of a lambda function originates in the lambda calculus and
functional programming. A lambda is an unnamed function that is useful (in
actual programming, not theory) for short snippets of code that are impossible
to reuse and are not worth naming.</p>
<p>In C++ a lambda function is defined like this</p>
<div class="code"><pre class="code literal-block">[]() { } // barebone lambda
</pre></div>

<p>or in all its glory</p>
<div class="code"><pre class="code literal-block"><span class="p">[]()</span><span class="w"> </span><span class="n">mutable</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// T is the return type, still lacking throw()</span>
</pre></div>

<p><code>[]</code> is the capture list, <code>()</code> the argument list and <code>{}</code> the function body.</p>
<h3>The capture list</h3>
<p>The capture list defines what from the outside of the lambda should be
available inside the function body and how. It can be either:</p>
<ol>
<li>a value: [x]</li>
<li>a reference [&amp;x]</li>
<li>any variable currently in scope by reference [&amp;]</li>
<li>same as 3, but by value [=]</li>
</ol>
<p>You can mix any of the above in a comma separated list <code>[x, &amp;y]</code>.</p>
<h3>The argument list</h3>
<p>The argument list is the same as in any other C++ function.</p>
<h3>The function body</h3>
<p>The code that will be executed when the lambda is actually called.</p>
<h3>Return type deduction</h3>
<p>If a lambda has only one return statement, the return type can be omitted and
has the implicit type of <code>decltype(return_statement)</code>.</p>
<h3>Mutable</h3>
<p>If a lambda is marked mutable (e.g. <code>[]() mutable { }</code>) it is allowed to
mutate the values that have been captured by value.</p>
<h2>Use cases</h2>
<p>The library defined by the ISO standard benefits heavily from lambdas and
raises the usability several bars as now users don't have to clutter their
code with small functors in some accessible scope.</p>
<h2>C++14</h2>
<p>In C++14 lambdas have been extended by various proposals.</p>
<h3>Initialized Lambda Captures</h3>
<p>An element of the capture list can now be initialized with <code>=</code>. This allows
renaming of variables and to capture by moving. An example taken from the
standard:</p>
<div class="code"><pre class="code literal-block"><span class="n">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="n">auto</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">]()</span><span class="o">-&gt;</span><span class="n">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">r</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
<span class="w">         </span><span class="p">}();</span><span class="w">  </span><span class="c1">// Updates ::x to 6, and initializes y to 7.</span>
</pre></div>

<p>and one taken from Wikipedia showing how to capture with <code>std::move</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nt">auto</span><span class="w"> </span><span class="nt">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">std</span><span class="p">::</span><span class="nd">make_unique</span><span class="o">&lt;</span><span class="nt">int</span><span class="o">&gt;(</span><span class="nt">10</span><span class="o">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nt">See</span><span class="w"> </span><span class="nt">below</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nt">std</span><span class="p">::</span><span class="nd">make_unique</span>
<span class="nt">auto</span><span class="w"> </span><span class="nt">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cp">[</span><span class="nx">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">std</span><span class="p">::</span><span class="nl">move</span><span class="p">(</span><span class="nx">ptr</span><span class="p">)</span><span class="cp">]</span><span class="w"> </span><span class="p">{</span><span class="err">return</span><span class="w"> </span><span class="err">*ptr</span><span class="p">;}</span><span class="o">;</span>
</pre></div>

<h3>Generic Lambdas</h3>
<p>Lambdas can now be generic (<code>auto</code> would be equivalent to <code>T</code> here if <code>T</code> were
a type template argument somewhere in the surrounding scope):</p>
<div class="code"><pre class="code literal-block"><span class="nv">auto</span><span class="w"> </span><span class="nv">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>[]<span class="ss">(</span><span class="nv">auto</span><span class="w"> </span><span class="nv">x</span>,<span class="w"> </span><span class="nv">auto</span><span class="w"> </span><span class="nv">y</span><span class="ss">)</span><span class="w"> </span>{<span class="k">return</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">y</span><span class="c1">;};</span>
</pre></div>

<h3>Improved Return Type Deduction</h3>
<p>C++14 allows deduced return types for every function and does not restrict it
to functions of the form <code>return expression;</code>. This is also extended to
lambdas.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-create-a-java-string-from-the-contents-of-a-file/" class="u-url">How do I create a Java string from the contents of a file?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-create-a-java-string-from-the-contents-of-a-file/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T00:29:31+08:00" itemprop="datePublished" title="2023-02-17 00:29">2023-02-17 00:29</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've been using the idiom below for some time now. And it seems to be the most
wide-spread, at least on the sites I've visited.</p>
<p>Is there a better/different way to read a file into a string in Java?</p>
<div class="code"><pre class="code literal-block"><span class="nv">private</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">readFile</span><span class="ss">(</span><span class="nv">String</span><span class="w"> </span><span class="nv">file</span><span class="ss">)</span><span class="w"> </span><span class="nv">throws</span><span class="w"> </span><span class="nv">IOException</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">BufferedReader</span><span class="w"> </span><span class="nv">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">BufferedReader</span><span class="ss">(</span><span class="nv">new</span><span class="w"> </span><span class="nv">FileReader</span><span class="w"> </span><span class="ss">(</span><span class="nv">file</span><span class="ss">))</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">String</span><span class="w">         </span><span class="nv">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">null</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">StringBuilder</span><span class="w">  </span><span class="nv">stringBuilder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">StringBuilder</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">String</span><span class="w">         </span><span class="nv">ls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">getProperty</span><span class="ss">(</span><span class="s2">"line.separator"</span><span class="ss">)</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">try</span><span class="w"> </span>{
<span class="w">        </span><span class="k">while</span><span class="ss">((</span><span class="nv">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">reader</span>.<span class="nv">readLine</span><span class="ss">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">stringBuilder</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">line</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">            </span><span class="nv">stringBuilder</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">ls</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span>}

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">stringBuilder</span>.<span class="nv">toString</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span>}<span class="w"> </span><span class="nv">finally</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">reader</span>.<span class="nv">close</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<h3>Read all text from a file</h3>
<p>Java 11 added the readString() method to read small files as a <code>String</code>,
preserving line terminators:</p>
<div class="code"><pre class="code literal-block">String content = Files.readString(path, encoding);
</pre></div>

<p>For versions between Java 7 and 11, here's a compact, robust idiom, wrapped up
in a utility method:</p>
<div class="code"><pre class="code literal-block"><span class="nv">static</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">readFile</span><span class="ss">(</span><span class="nv">String</span><span class="w"> </span><span class="nv">path</span>,<span class="w"> </span><span class="nv">Charset</span><span class="w"> </span><span class="nv">encoding</span><span class="ss">)</span>
<span class="w">  </span><span class="nv">throws</span><span class="w"> </span><span class="nv">IOException</span>
{
<span class="w">  </span><span class="nv">byte</span>[]<span class="w"> </span><span class="nv">encoded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Files</span>.<span class="nv">readAllBytes</span><span class="ss">(</span><span class="nv">Paths</span>.<span class="nv">get</span><span class="ss">(</span><span class="nv">path</span><span class="ss">))</span><span class="c1">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">String</span><span class="ss">(</span><span class="nv">encoded</span>,<span class="w"> </span><span class="nv">encoding</span><span class="ss">)</span><span class="c1">;</span>
}
</pre></div>

<h3>Read lines of text from a file</h3>
<p>Java 7 added a convenience method to read a file as lines of text, represented
as a <code>List&lt;String&gt;</code>. This approach is "lossy" because the line separators are
stripped from the end of each line.</p>
<div class="code"><pre class="code literal-block">List&lt;String&gt; lines = Files.readAllLines(Paths.get(path), encoding);
</pre></div>

<p>Java 8 added the <code>Files.lines()</code> method to produce a <code>Stream&lt;String&gt;</code>. Again,
this method is lossy because line separators are stripped. If an <code>IOException</code>
is encountered while reading the file, it is wrapped in an
<code>UncheckedIOException</code>, since <code>Stream</code> doesn't accept lambdas that throw
checked exceptions.</p>
<div class="code"><pre class="code literal-block"><span class="nt">try</span><span class="w"> </span><span class="o">(</span><span class="nt">Stream</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">Files</span><span class="p">.</span><span class="nc">lines</span><span class="o">(</span><span class="nt">path</span><span class="o">,</span><span class="w"> </span><span class="nt">encoding</span><span class="o">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">lines.forEach(System.</span><span class="n">out</span><span class="p">:</span><span class="o">:</span><span class="n">println</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>This <code>Stream</code> does need a <code>close()</code> call; this is poorly documented on the
API, and I suspect many people don't even notice <code>Stream</code> has a <code>close()</code>
method. Be sure to use an ARM-block as shown.</p>
<p>If you are working with a source other than a file, you can use the <code>lines()</code>
method in <code>BufferedReader</code> instead.</p>
<h3>Memory utilization</h3>
<p>If your file is small enough relative to your available memory, reading the
entire file at once might work fine. However, if your file is too large,
reading one line at a time, processing it, and then discarding it before
moving on to the next could be a better approach. Stream processing in this
way can eliminate the total file size as a factor in your memory requirement.</p>
<h3>Character encoding</h3>
<p>One thing that is missing from the sample in the original post is the
character encoding. This encoding generally can't be determined from the file
itself, and requires meta-data such as an HTTP header to convey this important
information.</p>
<p>The <code>StandardCharsets</code> class defines some constants for the encodings required
of all Java runtimes:</p>
<div class="code"><pre class="code literal-block">String content = readFile("test.txt", StandardCharsets.UTF_8);
</pre></div>

<p>The platform default is available from the <code>Charset</code> class itself:</p>
<div class="code"><pre class="code literal-block">String content = readFile("test.txt", Charset.defaultCharset());
</pre></div>

<p>There are some special cases where the platform default is what you want, but
they are rare. You should be able justify your choice, because the platform
default is not portable. One example where it might be correct is when reading
standard input or writing standard output.</p>
<hr>
<p>Note: This answer largely replaces my Java 6 version. The utility of Java 7
safely simplifies the code, and the old answer, which used a mapped byte
buffer, prevented the file that was read from being deleted until the mapped
buffer was garbage collected. You can view the old version via the "edited"
link on this answer.</p>
<p><br></p>
<h3>Suggest</h3>
<p>If you're willing to use an external library, check out Apache Commons IO
(200KB JAR). It contains an
<code>org.apache.commons.io.FileUtils.readFileToString()</code> method that allows you to
read an entire <code>File</code> into a <code>String</code> with one line of code.</p>
<p>Example:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">java.io.</span><span class="o">*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.</span><span class="o">*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.io.</span><span class="o">*</span><span class="p">;</span>

<span class="n">public</span> <span class="n">String</span> <span class="n">readFile</span><span class="p">()</span> <span class="n">throws</span> <span class="n">IOException</span> <span class="p">{</span>
    <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="n">new</span> <span class="n">File</span><span class="p">(</span><span class="s2">"data.txt"</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">FileUtils</span><span class="o">.</span><span class="n">readFileToString</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">StandardCharsets</span><span class="o">.</span><span class="n">UTF_8</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-meaning-of-single-and-double-underscore-before-an-object-name/" class="u-url">What is the meaning of single and double underscore before an object name?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-meaning-of-single-and-double-underscore-before-an-object-name/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T00:29:02+08:00" itemprop="datePublished" title="2023-02-17 00:29">2023-02-17 00:29</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What do single and double leading underscores before an object's name
represent in Python?</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>Single Underscore</h3>
<p>In a class, names with a leading underscore indicate to other programmers that
the attribute or method is intended to be be used inside that class. However,
privacy is not <em>enforced</em> in any way. Using leading underscores for functions
in a module indicates it should not be imported from somewhere else.</p>
<p>From the PEP-8 style guide:</p>
<blockquote>
<p><code>_single_leading_underscore</code>: weak "internal use" indicator. E.g. <code>from M
import *</code> does not import objects whose name starts with an underscore.</p>
</blockquote>
<h3>Double Underscore (Name Mangling)</h3>
<p>From the Python docs:</p>
<blockquote>
<p>Any identifier of the form <code>__spam</code> (at least two leading underscores, at
most one trailing underscore) is textually replaced with <code>_classname__spam</code>,
where <code>classname</code> is the current class name with leading underscore(s)
stripped. This mangling is done without regard to the syntactic position of
the identifier, so it can be used to define class-private instance and class
variables, methods, variables stored in globals, and even variables stored
in instances. private to this class on instances of other classes.</p>
</blockquote>
<p>And a warning from the same page:</p>
<blockquote>
<p>Name mangling is intended to give classes an easy way to define “private”
instance variables and methods, without having to worry about instance
variables defined by derived classes, or mucking with instance variables by
code outside the class. Note that the mangling rules are designed mostly to
avoid accidents; <em>it still is possible for a determined soul to access or
modify a variable that is considered private.</em></p>
</blockquote>
<h3>Example</h3>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; class MyClass():
...     def __init__(self):
...             self.__superprivate = "Hello"
...             self._semiprivate = ", world!"
...
&gt;&gt;&gt; mc = MyClass()
&gt;&gt;&gt; print mc.__superprivate
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
AttributeError: myClass instance has no attribute '__superprivate'
&gt;&gt;&gt; print mc._semiprivate
, world!
&gt;&gt;&gt; print mc.__dict__
{'_MyClass__superprivate': 'Hello', '_semiprivate': ', world!'}
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<ul>
<li>
<p><code>_foo</code>: Only a convention. A way for the programmer to indicate that the variable is private (whatever that means in Python).</p>
</li>
<li>
<p><code>__foo</code>: This has real meaning. The interpreter replaces this name with <code>_classname__foo</code> as a way to ensure that the name will not overlap with a similar name in another class.</p>
</li>
<li>
<p><code>__foo__</code>: Only a convention. A way for the Python system to use names that won't conflict with user names.</p>
</li>
</ul>
<p>No other form of underscores have meaning in the Python world. Also, there's
no difference between class, variable, global, etc in these conventions.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-196.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-194.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
