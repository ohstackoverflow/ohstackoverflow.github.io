<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2167) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2167.html">
<link rel="prev" href="index-2168.html" type="text/html">
<link rel="next" href="index-2166.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/explaining-apache-zookeeper/" class="u-url">Explaining Apache ZooKeeper</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/explaining-apache-zookeeper/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T19:57:04+08:00" itemprop="datePublished" title="2023-03-03 19:57">2023-03-03 19:57</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am trying to understand ZooKeeper, how it works and what it does. Is there
any application which is comparable to ZooKeeper?</p>
<p>If you know, then how would you describe ZooKeeper to a layman?</p>
<p>I have tried apache wiki, zookeeper sourceforge...but I am still not able to
relate to it.</p>
<p>I just read thru http://zookeeper.sourceforge.net/index.sf.shtml, so aren't
there more services like this? Is it as simple as just replicating a server
service?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>In a nutshell, ZooKeeper helps you build distributed applications.</p>
<h3>How it works</h3>
<p>You may describe ZooKeeper as a replicated synchronization service with
eventual consistency. It is robust, since the persisted data is distributed
between multiple nodes (this set of nodes is called an "ensemble") and one
client connects to any of them (i.e., a specific "server"), migrating if one
node fails; as long as a strict majority of nodes are working, the ensemble of
ZooKeeper nodes is alive. In particular, a master node is dynamically chosen
by consensus within the ensemble; if the master node fails, the role of master
migrates to another node.</p>
<h4>How writes are handled</h4>
<p>The master is the authority for writes: in this way writes can be guaranteed
to be persisted in-order, i.e., writes are <strong>linear</strong>. Each time a client
writes to the ensemble, a majority of nodes persist the information: these
nodes include the server for the client, and obviously the master. This means
that each write makes the server up-to-date with the master. It also means,
however, that you cannot have concurrent writes.</p>
<p>The guarantee of linear writes is the reason for the fact that ZooKeeper does
not perform well for write-dominant workloads. In particular, it should not be
used for interchange of large data, such as media. As long as your
communication involves shared data, ZooKeeper helps you. When data could be
written concurrently, ZooKeeper actually gets in the way, because it imposes a
strict ordering of operations even if not strictly necessary from the
perspective of the writers. Its ideal use is for coordination, where messages
are exchanged between the clients.</p>
<h4>How reads are handled</h4>
<p>This is where ZooKeeper excels: reads are concurrent since they are served by
the specific server that the client connects to. However, this is also the
reason for the eventual consistency: the "view" of a client may be outdated,
since the master updates the corresponding server with a bounded but undefined
delay.</p>
<h3>In detail</h3>
<p>The replicated database of ZooKeeper comprises a tree of <em>znodes</em> , which are
entities roughly representing file system nodes (think of them as
directories). Each znode may be enriched by a byte array, which stores data.
Also, each znode may have other znodes under it, practically forming an
internal directory system.</p>
<h4>Sequential znodes</h4>
<p>Interestingly, the name of a znode can be <em>sequential</em> , meaning that the name
the client provides when creating the znode is only a prefix: the full name is
also given by a sequential number chosen by the ensemble. This is useful, for
example, for synchronization purposes: if multiple clients want to get a lock
on a resource, they can each concurrently create a sequential znode on a
location: whoever gets the lowest number is entitled to the lock.</p>
<h4>Ephemeral znodes</h4>
<p>Also, a znode may be <em>ephemeral</em> : this means that it is destroyed as soon as
the client that created it disconnects. This is mainly useful in order to know
when a client fails, which may be relevant when the client itself has
responsibilities that should be taken by a new client. Taking the example of
the lock, as soon as the client having the lock disconnects, the other clients
can check whether they are entitled to the lock.</p>
<h4>Watches</h4>
<p>The example related to client disconnection may be problematic if we needed to
periodically poll the state of znodes. Fortunately, ZooKeeper offers an event
system where a <em>watch</em> can be set on a znode. These watches may be set to
trigger an event if the znode is specifically changed or removed or new
children are created under it. This is clearly useful in combination with the
sequential and ephemeral options for znodes.</p>
<h3>Where and how to use it</h3>
<p>A canonical example of Zookeeper usage is distributed-memory computation,
where some data is shared between client nodes and must be accessed/updated in
a very careful way to account for synchronization.</p>
<p>ZooKeeper offers the library to construct your synchronization primitives,
while the ability to run a distributed server avoids the single-point-of-
failure issue you have when using a centralized (broker-like) message
repository.</p>
<p>ZooKeeper is feature-light, meaning that mechanisms such as leader election,
locks, barriers, etc. are not already present, but can be written above the
ZooKeeper primitives. If the C/Java API is too unwieldy for your purposes, you
should rely on libraries built on ZooKeeper such as cages and especially
curator.</p>
<h3>Where to read more</h3>
<p>Official documentation apart, which is pretty good, I suggest to read Chapter
14 of Hadoop: The Definitive Guide which has ~35 pages explaining essentially
what ZooKeeper does, followed by an example of a configuration service.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Zookeeper is one of the best open source server and service that helps to
reliably coordinates distributed processes. Zookeeper is a CP system (Refer
CAP Theorem) that provides Consistency and Partition tolerance. Replication of
Zookeeper state across all the nodes makes it an eventually consistent
distributed service.</p>
<p>Moreover, any newly elected leader will update its followers with missing
proposals or with a snapshot of the state, if the followers have many
proposals missing.</p>
<p>Zookeeper also provides an API that is very easy to use. This blog post,
Zookeeper Java API examples, has some examples if you are looking for
examples.</p>
<p>So where do we use this? If your distributed service needs a centralized,
reliable and consistent configuration management, locks, queues etc, you will
find Zookeeper a reliable choice.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-delete-items-from-a-dictionary-while-iterating-over-it/" class="u-url">How do I delete items from a dictionary while iterating over it?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-delete-items-from-a-dictionary-while-iterating-over-it/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T19:54:04+08:00" itemprop="datePublished" title="2023-03-03 19:54">2023-03-03 19:54</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Can I delete items from a dictionary in Python while iterating over it?</p>
<p>I want to remove elements that don't meet a certain condition from the
dictionary, instead of creating an entirely new dictionary. Is the following a
good solution, or are there better ways?</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">mydict</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="err">:</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nl">val</span><span class="p">:</span>
<span class="w">        </span><span class="n">del</span><span class="w"> </span><span class="n">mydict</span><span class="o">[</span><span class="n">k</span><span class="o">]</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>For <strong>Python 3+</strong> :</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">mydict</span>
<span class="err">{</span><span class="s1">'four'</span><span class="err">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">'three'</span><span class="err">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">'one'</span><span class="err">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span>

<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">mydict</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span><span class="err">:</span>
<span class="p">...</span><span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="n">mydict</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="err">:</span>
<span class="p">...</span><span class="w">         </span><span class="n">del</span><span class="w"> </span><span class="n">mydict</span><span class="o">[</span><span class="n">k</span><span class="o">]</span>

<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">mydict</span>
<span class="err">{</span><span class="s1">'four'</span><span class="err">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">'one'</span><span class="err">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span>
</pre></div>

<p>The other answers work fine with <strong>Python 2</strong> but raise a <code>RuntimeError</code> for
<strong>Python 3</strong> :</p>
<blockquote>
<p>RuntimeError: dictionary changed size during iteration.</p>
</blockquote>
<p>This happens because <code>mydict.keys()</code> returns an iterator not a list. As
pointed out in comments simply convert <code>mydict.keys()</code> to a list by
<code>list(mydict.keys())</code> and it should work.</p>
<hr>
<p>For <strong>Python 2</strong> :</p>
<p>A simple test in the console shows you cannot modify a dictionary while
iterating over it:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">mydict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="s1">'one'</span><span class="err">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'two'</span><span class="err">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">'three'</span><span class="err">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">'four'</span><span class="err">:</span><span class="w"> </span><span class="mi">4</span><span class="err">}</span>

<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">mydict</span><span class="p">.</span><span class="n">iteritems</span><span class="p">()</span><span class="err">:</span>
<span class="p">...</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'two'</span><span class="err">:</span>
<span class="p">...</span><span class="w">        </span><span class="n">del</span><span class="w"> </span><span class="n">mydict</span><span class="o">[</span><span class="n">k</span><span class="o">]</span>

<span class="o">------------------------------------------------------------</span>
<span class="n">Traceback</span><span class="w"> </span><span class="p">(</span><span class="n">most</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="k">last</span><span class="p">)</span><span class="err">:</span>
<span class="w">  </span><span class="k">File</span><span class="w"> </span><span class="ss">"&lt;ipython console&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">&lt;</span><span class="k">module</span><span class="o">&gt;</span>
<span class="nl">RuntimeError</span><span class="p">:</span><span class="w"> </span><span class="k">dictionary</span><span class="w"> </span><span class="n">changed</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">iteration</span>
</pre></div>

<p>As stated in delnan's answer, deleting entries causes problems when the
iterator tries to move onto the next entry. Instead, use the <code>keys()</code> method
to get a list of the keys and work with that:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">mydict</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span><span class="err">:</span>
<span class="p">...</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'two'</span><span class="err">:</span>
<span class="p">...</span><span class="w">        </span><span class="n">del</span><span class="w"> </span><span class="n">mydict</span><span class="o">[</span><span class="n">k</span><span class="o">]</span>

<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">mydict</span>
<span class="err">{</span><span class="s1">'four'</span><span class="err">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">'three'</span><span class="err">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">'one'</span><span class="err">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span>
</pre></div>

<p>If you need to delete based on the items value, use the <code>items()</code> method
instead:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">mydict</span><span class="p">.</span><span class="n">items</span><span class="p">()</span><span class="err">:</span>
<span class="p">...</span><span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="err">:</span>
<span class="p">...</span><span class="w">         </span><span class="n">del</span><span class="w"> </span><span class="n">mydict</span><span class="o">[</span><span class="n">k</span><span class="o">]</span>

<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">mydict</span>
<span class="err">{</span><span class="s1">'four'</span><span class="err">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">'one'</span><span class="err">:</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You could also do it in two steps:</p>
<div class="code"><pre class="code literal-block"><span class="n">remove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">k for k in mydict if k == val</span><span class="o">]</span>
<span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">remove</span><span class="p">:</span><span class="w"> </span><span class="n">del</span><span class="w"> </span><span class="n">mydict</span><span class="o">[</span><span class="n">k</span><span class="o">]</span>
</pre></div>

<p>My favorite approach is usually to just make a new dict:</p>
<div class="code"><pre class="code literal-block">#<span class="w"> </span><span class="nv">Python</span><span class="w"> </span><span class="mi">2</span>.<span class="mi">7</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="mi">3</span>.<span class="nv">x</span>
<span class="nv">mydict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>{<span class="w"> </span><span class="nv">k</span>:<span class="nv">v</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">k</span>,<span class="nv">v</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">mydict</span>.<span class="nv">items</span><span class="ss">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">k</span><span class="o">!=</span><span class="nv">val</span><span class="w"> </span>}
#<span class="w"> </span><span class="nv">before</span><span class="w"> </span><span class="nv">Python</span><span class="w"> </span><span class="mi">2</span>.<span class="mi">7</span>
<span class="nv">mydict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dict</span><span class="ss">((</span><span class="nv">k</span>,<span class="nv">v</span><span class="ss">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">k</span>,<span class="nv">v</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">mydict</span>.<span class="nv">iteritems</span><span class="ss">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">k</span><span class="o">!=</span><span class="nv">val</span><span class="ss">)</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-and-or-why-is-merging-in-git-better-than-in-svn/" class="u-url">How and/or why is merging in Git better than in SVN?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-and-or-why-is-merging-in-git-better-than-in-svn/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T19:52:47+08:00" itemprop="datePublished" title="2023-03-03 19:52">2023-03-03 19:52</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've heard in a few places that one of the main reasons why distributed
version control systems shine, is much better merging than in traditional
tools like SVN. Is this actually due to inherent differences in how the two
systems work, or do <em>specific</em> DVCS implementations like Git/Mercurial just
have cleverer merging algorithms than SVN?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The claim of why merging is better in a DVCS than in Subversion was largely
based on how branching and merge worked in Subversion a while ago. Subversion
prior to 1.5.0 didn't store any information about when branches were merged,
thus when you wanted to merge you had to specify which range of revisions that
had to be merged.</p>
<h3>So why did Subversion merges <em>suck</em>?</h3>
<p>Ponder this example:</p>
<div class="code"><pre class="code literal-block"><span class="w">      </span><span class="mi">1</span><span class="w">   </span><span class="mi">2</span><span class="w">   </span><span class="mi">4</span><span class="w">     </span><span class="mi">6</span><span class="w">     </span><span class="mi">8</span>
<span class="n">trunk</span><span class="w"> </span><span class="n">o</span><span class="o">--&gt;</span><span class="n">o</span><span class="o">--&gt;</span><span class="n">o</span><span class="o">----&gt;</span><span class="n">o</span><span class="o">----&gt;</span><span class="n">o</span>
<span class="w">       </span><span class="err">\</span>
<span class="w">        </span><span class="err">\</span><span class="w">   </span><span class="mi">3</span><span class="w">     </span><span class="mi">5</span><span class="w">     </span><span class="mi">7</span>
<span class="n">b1</span><span class="w">       </span><span class="o">+-&gt;</span><span class="n">o</span><span class="o">----&gt;</span><span class="n">o</span><span class="o">----&gt;</span><span class="n">o</span>
</pre></div>

<p>When we want to merge b1's changes into the trunk we'd issue the following
command, while standing on a folder that has trunk checked out:</p>
<div class="code"><pre class="code literal-block">svn merge -r 2:7 {link to branch b1}
</pre></div>

<p>… which will attempt to merge the changes from <code>b1</code> into your local working
directory. And then you commit the changes after you resolve any conflicts and
tested the result. When you commit the revision tree would look like this:</p>
<div class="code"><pre class="code literal-block"><span class="w">      </span><span class="mi">1</span><span class="w">   </span><span class="mi">2</span><span class="w">   </span><span class="mi">4</span><span class="w">     </span><span class="mi">6</span><span class="w">     </span><span class="mi">8</span><span class="w">   </span><span class="mi">9</span>
<span class="n">trunk</span><span class="w"> </span><span class="n">o</span><span class="o">--&gt;</span><span class="n">o</span><span class="o">--&gt;</span><span class="n">o</span><span class="o">----&gt;</span><span class="n">o</span><span class="o">----&gt;</span><span class="n">o</span><span class="o">--&gt;</span><span class="n">o</span><span class="w">      </span><span class="s">"the merge commit is at r9"</span>
<span class="w">       </span><span class="err">\</span>
<span class="w">        </span><span class="err">\</span><span class="w">   </span><span class="mi">3</span><span class="w">     </span><span class="mi">5</span><span class="w">     </span><span class="mi">7</span>
<span class="n">b1</span><span class="w">       </span><span class="o">+-&gt;</span><span class="n">o</span><span class="o">----&gt;</span><span class="n">o</span><span class="o">----&gt;</span><span class="n">o</span>
</pre></div>

<p>However this way of specifying ranges of revisions gets quickly out of hand
when the version tree grows as subversion didn't have any meta data on when
and what revisions got merged together. Ponder on what happens later:</p>
<div class="code"><pre class="code literal-block"><span class="w">           </span><span class="mi">12</span><span class="w">        </span><span class="mi">14</span>
<span class="n">trunk</span><span class="w">  </span><span class="err">…</span><span class="o">--&gt;</span><span class="n">o</span><span class="o">--------&gt;</span><span class="n">o</span>
<span class="w">                                     </span><span class="s">"Okay, so when did we merge last time?"</span>
<span class="w">              </span><span class="mi">13</span><span class="w">        </span><span class="mi">15</span>
<span class="n">b1</span><span class="w">     </span><span class="err">…</span><span class="o">-----&gt;</span><span class="n">o</span><span class="o">--------&gt;</span><span class="n">o</span>
</pre></div>

<p>This is largely an issue by the repository design that Subversion has, in
order to create a branch you need to create a new <em>virtual directory</em> in the
repository which will house a copy of the trunk but it doesn't store any
information regarding when and what things got merged back in. That will lead
to nasty merge conflicts at times. What was even worse is that Subversion used
two-way merging by default, which has some crippling limitations in automatic
merging when two branch heads are not compared with their common ancestor.</p>
<p>To mitigate this Subversion now stores meta data for branch and merge. That
would solve all problems right?</p>
<h3>And oh, by the way, Subversion still sucks…</h3>
<p>On a centralized system, like subversion, <em>virtual directories</em> suck. Why?
Because everyone has access to view them… even the garbage experimental ones.
Branching is good if you want to experiment <strong>but you don't want to see
everyones' and their aunts experimentation</strong>. This is serious cognitive noise.
The more branches you add, the more crap you'll get to see.</p>
<p>The more public branches you have in a repository the harder it will be to
keep track of all the different branches. So the question you'll have is if
the branch is still in development or if it is really dead which is hard to
tell in any centralized version control system.</p>
<p>Most of the time, from what I've seen, an organization will default to use one
big branch anyway. Which is a shame because that in turn will be difficult to
keep track of testing and release versions, and whatever else good comes from
branching.</p>
<h3>So why are DVCS, such as Git, Mercurial and Bazaar, better than Subversion</h3>
<p>at branching and merging?</p>
<p>There is a very simple reason why: <strong>branching is a first-class concept</strong>.
There are <em>no virtual directories</em> by design and branches are hard objects in
DVCS which it needs to be such in order to work simply with synchronization of
repositories (i.e. <em>push</em> and <em>pull</em> ).</p>
<p>The first thing you do when you work with a DVCS is to clone repositories
(git's <code>clone</code>, hg's <code>clone</code> and bzr's <code>branch</code>). Cloning is conceptually the
same thing as creating a branch in version control. Some call this <em>forking</em>
or <em>branching</em> (although the latter is often also used to refer to co-located
branches), but it's just the same thing. Every user runs their own repository
which means you have a <em>per-user branching</em> going on.</p>
<p>The version structure is <strong>not a tree</strong> , but rather a <strong>graph</strong> instead. More
specifically a directed acyclic graph (DAG, meaning a graph that doesn't have
any cycles). You really don't need to dwell into the specifics of a DAG other
than each commit has one or more parent references (which what the commit was
based on). So the following graphs will show the arrows between revisions in
reverse because of this.</p>
<p>A very simple example of merging would be this; imagine a central repository
called <code>origin</code> and a user, Alice, cloning the repository to her machine.</p>
<div class="code"><pre class="code literal-block">         a…   b…   c…
origin   o&lt;---o&lt;---o
                   ^master
         |
         | clone
         v

         a…   b…   c…
alice    o&lt;---o&lt;---o
                   ^master
                   ^origin/master
</pre></div>

<p>What happens during a clone is that every revision is copied to Alice exactly
as they were (which is validated by the uniquely identifiable hash-id's), and
marks where the origin's branches are at.</p>
<p>Alice then works on her repo, committing in her own repository and decides to
push her changes:</p>
<div class="code"><pre class="code literal-block">         a…   b…   c…
origin   o&lt;---o&lt;---o
                   ^ master

              "what'll happen after a push?"


         a…   b…   c…   d…   e…
alice    o&lt;---o&lt;---o&lt;---o&lt;---o
                             ^master
                   ^origin/master
</pre></div>

<p>The solution is rather simple, the only thing that the <code>origin</code> repository
needs to do is to take in all the new revisions and move it's branch to the
newest revision (which git calls "fast-forward"):</p>
<div class="code"><pre class="code literal-block">         a…   b…   c…   d…   e…
origin   o&lt;---o&lt;---o&lt;---o&lt;---o
                             ^ master

         a…   b…   c…   d…   e…
alice    o&lt;---o&lt;---o&lt;---o&lt;---o
                             ^master
                             ^origin/master
</pre></div>

<p>The use case, which I illustrated above, <strong>doesn't even need to merge
anything</strong>. So the issue really isn't with merging algorithms since three-way
merge algorithm is pretty much the same between all version control systems.
<strong>The issue is more about structure than anything</strong>.</p>
<h3>So how about you show me an example that has a <em>real</em> merge?</h3>
<p>Admittedly the above example is a very simple use case, so lets do a much more
twisted one albeit a more common one. Remember that <code>origin</code> started out with
three revisions? Well, the guy who did them, lets call him <em>Bob</em> , has been
working on his own and made a commit on his own repository:</p>
<div class="code"><pre class="code literal-block">         a…   b…   c…   f…
bob      o&lt;---o&lt;---o&lt;---o
                        ^ master
                   ^ origin/master

                   "can Bob push his changes?"

         a…   b…   c…   d…   e…
origin   o&lt;---o&lt;---o&lt;---o&lt;---o
                             ^ master
</pre></div>

<p>Now Bob can't push his changes directly to the <code>origin</code> repository. How the
system detects this is by checking if Bob's revisions directly descents from
<code>origin</code>'s, which in this case doesn't. Any attempt to push will result into
the system saying something akin to "Uh... I'm afraid can't let you do that
Bob."</p>
<p>So Bob has to pull-in and then merge the changes (with git's <code>pull</code>; or hg's
<code>pull</code> and <code>merge</code>; or bzr's <code>merge</code>). This is a two-step process. First Bob
has to fetch the new revisions, which will copy them as they are from the
<code>origin</code> repository. We can now see that the graph diverges:</p>
<div class="code"><pre class="code literal-block">                        v master
         a…   b…   c…   f…
bob      o&lt;---o&lt;---o&lt;---o
                   ^
                   |    d…   e…
                   +----o&lt;---o
                             ^ origin/master

         a…   b…   c…   d…   e…
origin   o&lt;---o&lt;---o&lt;---o&lt;---o
                             ^ master
</pre></div>

<p>The second step of the pull process is to merge the diverging tips and make a
commit of the result:</p>
<div class="code"><pre class="code literal-block">                                 v master
         a…   b…   c…   f…       1…
bob      o&lt;---o&lt;---o&lt;---o&lt;-------o
                   ^             |
                   |    d…   e…  |
                   +----o&lt;---o&lt;--+
                             ^ origin/master
</pre></div>

<p>Hopefully the merge won't run into conflicts (if you anticipate them you can
do the two steps manually in git with <code>fetch</code> and <code>merge</code>). What later needs
to be done is to push in those changes again to <code>origin</code>, which will result
into a fast-forward merge since the merge commit is a direct descendant of the
latest in the <code>origin</code> repository:</p>
<div class="code"><pre class="code literal-block">                                 v origin/master
                                 v master
         a…   b…   c…   f…       1…
bob      o&lt;---o&lt;---o&lt;---o&lt;-------o
                   ^             |
                   |    d…   e…  |
                   +----o&lt;---o&lt;--+

                                 v master
         a…   b…   c…   f…       1…
origin   o&lt;---o&lt;---o&lt;---o&lt;-------o
                   ^             |
                   |    d…   e…  |
                   +----o&lt;---o&lt;--+
</pre></div>

<p>There is another option to merge in git and hg, called <em>rebase</em> , which'll
move Bob's changes to after the newest changes. Since I don't want this answer
to be any more verbose I'll let you read the git, mercurial or bazaar docs
about that instead.</p>
<p>As an exercise for the reader, try drawing out how it'll work out with another
user involved. It is similarly done as the example above with Bob. Merging
between repositories is easier than what you'd think because all the
revisions/commits are uniquely identifiable.</p>
<p>There is also the issue of sending patches between each developer, that was a
huge problem in Subversion which is mitigated in git, hg and bzr by uniquely
identifiable revisions. Once someone has merged his changes (i.e. made a merge
commit) and sends it for everyone else in the team to consume by either
pushing to a central repository or sending patches then they don't have to
worry about the merge, because it already happened. Martin Fowler calls this
way of working promiscuous integration.</p>
<p>Because the structure is different from Subversion, by instead employing a
DAG, it enables branching and merging to be done in an easier manner not only
for the system but for the user as well.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Historically, Subversion has only been able to perform a straight two-way
merge because it's didn't store any merge information. This involves taking a
set of changes and applying them to a tree. Even with merge information, this
is still the most commonly-used merge strategy.</p>
<p>Git uses a 3-way merge algorithm by default, which involves finding a common
ancestor to the heads being merged and making use of the knowledge that exists
on both sides of the merge. This allows Git to be more intelligent in avoiding
conflicts.</p>
<p>Git also has some sophisticated rename finding code, which also helps. It
<em>doesn't</em> store changesets or store any tracking information -- it just stores
the state of the files at each commit and uses heuristics to locate renames
and code movements as required (the on-disk storage is more complicated than
this, but the interface it presents to the logic layer exposes no tracking).</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2168.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2166.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
