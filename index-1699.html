<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1699) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1699.html">
<link rel="prev" href="index-1700.html" type="text/html">
<link rel="next" href="index-1698.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/remove-blank-attributes-from-an-object-in-javascript/" class="u-url">Remove blank attributes from an Object in Javascript</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/remove-blank-attributes-from-an-object-in-javascript/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:16:13+08:00" itemprop="datePublished" title="2023-03-03 07:16">2023-03-03 07:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I remove all attributes which are <code>undefined</code> or <code>null</code> in a JavaScript
object?</p>
<p>(Question is similar to this one for Arrays)</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can loop through the object:</p>
<div class="code"><pre class="code literal-block"><span class="nf">var</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="nl">test1</span><span class="p">:</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="nl">test2</span><span class="p">:</span><span class="w"> </span><span class="s1">'somestring'</span><span class="p">,</span>
<span class="w">  </span><span class="nl">test3</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="err">}</span>

<span class="k">function</span><span class="w"> </span><span class="n">clean</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nf">var</span><span class="w"> </span><span class="n">propName</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="o">[</span><span class="n">propName</span><span class="o">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">obj</span><span class="o">[</span><span class="n">propName</span><span class="o">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">undefined</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="k">delete</span><span class="w"> </span><span class="n">obj</span><span class="o">[</span><span class="n">propName</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">  </span><span class="err">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">obj</span>
<span class="err">}</span>

<span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">test</span><span class="p">);</span>
<span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">clean</span><span class="p">(</span><span class="n">test</span><span class="p">));</span>
</pre></div>

<p>If you're concerned about this property removal not running up object's
proptype chain, you can also:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">clean</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="nf">var</span><span class="w"> </span><span class="n">propNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Object</span><span class="p">.</span><span class="n">getOwnPropertyNames</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nf">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">propNames</span><span class="p">.</span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nf">var</span><span class="w"> </span><span class="n">propName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">propNames</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="o">[</span><span class="n">propName</span><span class="o">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">obj</span><span class="o">[</span><span class="n">propName</span><span class="o">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">undefined</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="k">delete</span><span class="w"> </span><span class="n">obj</span><span class="o">[</span><span class="n">propName</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>A few notes on null vs undefined:</p>
<div class="code"><pre class="code literal-block">test.test1 === null; // true
test.test1 == null; // true

test.notaprop === null; // false
test.notaprop == null; // true

test.notaprop === undefined; // true
test.notaprop == undefined; // true
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You can loop through the object:</p>
<div class="code"><pre class="code literal-block"><span class="nf">var</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="nl">test1</span><span class="p">:</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">  </span><span class="nl">test2</span><span class="p">:</span><span class="w"> </span><span class="s1">'somestring'</span><span class="p">,</span>
<span class="w">  </span><span class="nl">test3</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="err">}</span>

<span class="k">function</span><span class="w"> </span><span class="n">clean</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nf">var</span><span class="w"> </span><span class="n">propName</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="o">[</span><span class="n">propName</span><span class="o">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">obj</span><span class="o">[</span><span class="n">propName</span><span class="o">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">undefined</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="k">delete</span><span class="w"> </span><span class="n">obj</span><span class="o">[</span><span class="n">propName</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">  </span><span class="err">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">obj</span>
<span class="err">}</span>

<span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">test</span><span class="p">);</span>
<span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">clean</span><span class="p">(</span><span class="n">test</span><span class="p">));</span>
</pre></div>

<p>If you're concerned about this property removal not running up object's
proptype chain, you can also:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">clean</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="nf">var</span><span class="w"> </span><span class="n">propNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Object</span><span class="p">.</span><span class="n">getOwnPropertyNames</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nf">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">propNames</span><span class="p">.</span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nf">var</span><span class="w"> </span><span class="n">propName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">propNames</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="o">[</span><span class="n">propName</span><span class="o">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">obj</span><span class="o">[</span><span class="n">propName</span><span class="o">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="n">undefined</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="k">delete</span><span class="w"> </span><span class="n">obj</span><span class="o">[</span><span class="n">propName</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>A few notes on null vs undefined:</p>
<div class="code"><pre class="code literal-block">test.test1 === null; // true
test.test1 == null; // true

test.notaprop === null; // false
test.notaprop == null; // true

test.notaprop === undefined; // true
test.notaprop == undefined; // true
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-difference-between-types-string-and-string/" class="u-url">What is the difference between types String and string?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-difference-between-types-string-and-string/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:15:48+08:00" itemprop="datePublished" title="2023-03-03 07:15">2023-03-03 07:15</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Does anyone know the difference between <code>String</code> and <code>string</code> in TypeScript?
Am I correct in assuming that they ought to be the same?</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"test"</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"another test"</span><span class="p">;</span>
<span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">gives</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">compiler</span><span class="w"> </span><span class="n">error</span><span class="o">!</span>
</pre></div>

<p>Current version of the compiler says:</p>
<div class="code"><pre class="code literal-block"><span class="n">Type</span><span class="w"> </span><span class="p">'</span><span class="n">String</span><span class="p">'</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">assignable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">'</span><span class="k">string</span><span class="p">'.</span>
<span class="w">  </span><span class="p">'</span><span class="k">string</span><span class="p">'</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">primitive</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="p">'</span><span class="n">String</span><span class="p">'</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="n">object</span><span class="p">.</span>
<span class="w">     </span><span class="n">Prefer</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="p">'</span><span class="k">string</span><span class="p">'</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">possible</span><span class="p">.</span>
</pre></div>

<p>Is that a bug?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Here is an example that shows the differences, which will help with the
explanation.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="p">(</span><span class="s2">"Avoid newing things where possible"</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"A string, in TypeScript of type 'string'"</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">s3</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">;</span>
</pre></div>

<p><code>String</code> is the JavaScript String type, which you <em>could</em> use to create new
strings. Nobody does this as in JavaScript the literals are considered better,
so <code>s2</code> in the example above creates a new string without the use of the <code>new</code>
keyword and without explicitly using the <code>String</code> object.</p>
<p><code>string</code> is the TypeScript string type, which you can use to type variables,
parameters and return values.</p>
<p>Additional notes...</p>
<p>Currently (Feb 2013) Both <code>s1</code> and <code>s2</code> are valid JavaScript. <code>s3</code> is valid
TypeScript.</p>
<p>Use of <code>String</code>. You probably never need to use it, string literals are
universally accepted as being the correct way to initialise a string. In
JavaScript, it is also considered better to use object literals and array
literals too:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">var</span><span class="w"> </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Array</span><span class="p">();</span>
<span class="k">var</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">var</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="p">();</span>
</pre></div>

<p>If you really had a penchant for the string, you could use it in TypeScript in
one of two ways...</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="nb">str</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="p">(</span><span class="s2">"Hello world"</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Uses</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">JavaScript</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">object</span>
<span class="k">var</span><span class="w"> </span><span class="nb">str</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="p">(</span><span class="s2">"Hello World"</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Uses</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">TypeScript</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">type</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>The two types are distinct in JavaScript as well as TypeScript - TypeScript
just gives us syntax to annotate and check types as we go along.</p>
<p><code>String</code> refers to an object instance that has <code>String.prototype</code> in its
prototype chain. You can get such an instance in various ways e.g. <code>new
String('foo')</code> and <code>Object('foo')</code>. You can test for an instance of the
<code>String</code> type with the <code>instanceof</code> operator, e.g. <code>myString instanceof
String</code>.</p>
<p><code>string</code> is one of JavaScript's primitive types, and <code>string</code> values are
primarily created with literals e.g. <code>'foo'</code> and <code>"bar"</code>, and as the result
type of various functions and operators. You can test for <code>string</code> type using
<code>typeof myString === 'string'</code>.</p>
<p>The vast majority of the time, <code>string</code> is the type you should be using -
almost all API interfaces that take or return strings will use it. All JS
primitive types will be wrapped (boxed) with their corresponding object types
when using them as objects, e.g. accessing properties or calling methods.
Since <code>String</code> is currently declared as an interface rather than a class in
TypeScript's core library, structural typing means that <code>string</code> is considered
a subtype of <code>String</code> which is why your first line passes compilation type
checks.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/std-unique-lock-std-mutex-or-std-lock-guard-std-mutex/" class="u-url">std::unique_lock&lt;std::mutex&gt; or std::lock_guard&lt;std::mutex&gt;?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/std-unique-lock-std-mutex-or-std-lock-guard-std-mutex/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:15:19+08:00" itemprop="datePublished" title="2023-03-03 07:15">2023-03-03 07:15</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have two use cases.</p>
<p>A. I want to synchronise access to a queue for two threads.</p>
<p>B. I want to synchronise access to a queue for two threads and use a condition
variable because one of the threads will wait on content to be stored into the
queue by the other thread.</p>
<p>For use case A I see code example using <code>std::lock_guard&lt;&gt;</code>. For use case B I
see code example using <code>std::unique_lock&lt;&gt;</code>.</p>
<p>What is the difference between the two and which one should I use in which use
case?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The difference is that you can lock and unlock a <code>std::unique_lock</code>.
<code>std::lock_guard</code> will be locked only once on construction and unlocked on
destruction.</p>
<p>So for use case B you definitely need a <code>std::unique_lock</code> for the condition
variable. In case A it depends whether you need to relock the guard.</p>
<p><code>std::unique_lock</code> has other features that allow it to e.g.: be constructed
without locking the mutex immediately but to build the RAII wrapper (see
here).</p>
<p><code>std::lock_guard</code> also provides a convenient RAII wrapper, but cannot lock
multiple mutexes safely. It can be used when you need a wrapper for a limited
scope, e.g.: a member function:</p>
<div class="code"><pre class="code literal-block"><span class="nt">class</span><span class="w"> </span><span class="nt">MyClass</span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="p">:</span><span class="o">:</span><span class="n">mutex</span><span class="w"> </span><span class="n">my_mutex</span><span class="p">;</span>
<span class="w">    </span><span class="err">void</span><span class="w"> </span><span class="err">member_foo()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">std</span><span class="p">:</span><span class="o">:</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">mutex_type</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">lock</span><span class="p">(</span><span class="n">this</span><span class="o">-</span><span class="err">&gt;</span><span class="n">my_mutex</span><span class="p">);</span><span class="w">            </span>
<span class="w">        </span><span class="c">/*</span>
<span class="c">         block of code which needs mutual exclusion (e.g. open the same </span>
<span class="c">         file in multiple threads).</span>
<span class="c">        */</span>

<span class="w">        </span><span class="err">//mutex</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">automatically</span><span class="w"> </span><span class="err">released</span><span class="w"> </span><span class="err">when</span><span class="w"> </span><span class="err">lock</span><span class="w"> </span><span class="err">goes</span><span class="w"> </span><span class="err">out</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">scope</span>
<span class="w">    </span><span class="p">}</span><span class="w">           </span>
<span class="err">}</span><span class="o">;</span>
</pre></div>

<p>To clarify a question by chmike, by default <code>std::lock_guard</code> and
<code>std::unique_lock</code> are the same. So in the above case, you could replace
<code>std::lock_guard</code> with <code>std::unique_lock</code>. However, <code>std::unique_lock</code> might
have a tad more overhead.</p>
<p>Note that these days (since, C++17) one should use <code>std::scoped_lock</code> instead
of <code>std::lock_guard</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p><code>lock_guard</code> and <code>unique_lock</code> are pretty much the same thing; <code>lock_guard</code> is
a restricted version with a limited interface.</p>
<p>A <code>lock_guard</code> always holds a lock from its construction to its destruction. A
<code>unique_lock</code> can be created without immediately locking, can unlock at any
point in its existence, and can transfer ownership of the lock from one
instance to another.</p>
<p>So you always use <code>lock_guard</code>, unless you need the capabilities of
<code>unique_lock</code>. A <code>condition_variable</code> needs a <code>unique_lock</code>.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1700.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1698.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
