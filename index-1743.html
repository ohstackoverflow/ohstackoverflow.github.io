<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1743) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1743.html">
<link rel="prev" href="index-1744.html" type="text/html">
<link rel="next" href="index-1742.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/pandas-conditional-creation-of-a-series-dataframe-column/" class="u-url">Pandas conditional creation of a series/dataframe column</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/pandas-conditional-creation-of-a-series-dataframe-column/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T08:18:59+08:00" itemprop="datePublished" title="2023-03-03 08:18">2023-03-03 08:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I add a <code>color</code> column to the following dataframe so that
<code>color='green'</code> if <code>Set == 'Z'</code>, and <code>color='red'</code> otherwise?</p>
<div class="code"><pre class="code literal-block">    Type       Set
1    A          Z
2    B          Z           
3    B          X
4    C          Y
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p><strong>If you only have two choices to select from:</strong></p>
<div class="code"><pre class="code literal-block">df['color'] = np.where(df['Set']=='Z', 'green', 'red')
</pre></div>

<p>For example,</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Type'</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="s1">'ABBC'</span><span class="p">),</span> <span class="s1">'Set'</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="s1">'ZZXY'</span><span class="p">)})</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'color'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'Set'</span><span class="p">]</span><span class="o">==</span><span class="s1">'Z'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

<p>yields</p>
<div class="code"><pre class="code literal-block">  Set Type  color
0   Z    A  green
1   Z    B  green
2   X    B    red
3   Y    C    red
</pre></div>

<hr>
<p><strong>If you have more than two conditions then use<code>np.select</code></strong>. For example, if
you want <code>color</code> to be</p>
<ul>
<li>
<code>yellow</code> when <code>(df['Set'] == 'Z') &amp; (df['Type'] == 'A')</code>
</li>
<li>otherwise <code>blue</code> when <code>(df['Set'] == 'Z') &amp; (df['Type'] == 'B')</code>
</li>
<li>otherwise <code>purple</code> when <code>(df['Type'] == 'B')</code>
</li>
<li>otherwise <code>black</code>,</li>
</ul>
<p>then use</p>
<div class="code"><pre class="code literal-block">df = pd.DataFrame({'Type':list('ABBC'), 'Set':list('ZZXY')})
conditions = [
    (df['Set'] == 'Z') &amp; (df['Type'] == 'A'),
    (df['Set'] == 'Z') &amp; (df['Type'] == 'B'),
    (df['Type'] == 'B')]
choices = ['yellow', 'blue', 'purple']
df['color'] = np.select(conditions, choices, default='black')
print(df)
</pre></div>

<p>which yields</p>
<div class="code"><pre class="code literal-block">  Set Type   color
0   Z    A  yellow
1   Z    B    blue
2   X    B  purple
3   Y    C   black
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>List comprehension is another way to create another column conditionally. If
you are working with object dtypes in columns, like in your example, list
comprehensions typically outperform most other methods.</p>
<p>Example list comprehension:</p>
<div class="code"><pre class="code literal-block"><span class="nv">df</span>[<span class="s1">'color'</span>]<span class="w"> </span><span class="o">=</span><span class="w"> </span>[<span class="s1">'red'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'Z'</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">'green'</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">df</span>[<span class="s1">'Set'</span>]]
</pre></div>

<p><strong>%timeit tests:</strong></p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Type'</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="s1">'ABBC'</span><span class="p">),</span> <span class="s1">'Set'</span><span class="p">:</span><span class="nb">list</span><span class="p">(</span><span class="s1">'ZZXY'</span><span class="p">)})</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">df</span><span class="p">[</span><span class="s1">'color'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'red'</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">'Z'</span> <span class="k">else</span> <span class="s1">'green'</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Set'</span><span class="p">]]</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">df</span><span class="p">[</span><span class="s1">'color'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'Set'</span><span class="p">]</span><span class="o">==</span><span class="s1">'Z'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">)</span>
<span class="o">%</span><span class="n">timeit</span> <span class="n">df</span><span class="p">[</span><span class="s1">'color'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Set</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">'red'</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">'Z'</span> <span class="k">else</span> <span class="s1">'green'</span><span class="p">)</span>

<span class="mi">1000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">239</span> <span class="n">µs</span> <span class="n">per</span> <span class="n">loop</span>
<span class="mi">1000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">523</span> <span class="n">µs</span> <span class="n">per</span> <span class="n">loop</span>
<span class="mi">1000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">263</span> <span class="n">µs</span> <span class="n">per</span> <span class="n">loop</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-see-the-commit-differences-between-branches-in-git/" class="u-url">How do I see the commit differences between branches in git?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-see-the-commit-differences-between-branches-in-git/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T08:18:33+08:00" itemprop="datePublished" title="2023-03-03 08:18">2023-03-03 08:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm on branch-X and have added a couple more commits on top of it. I want to
see all the differences between MASTER and the branch that I am on in terms of
commits. I could just do a</p>
<div class="code"><pre class="code literal-block">git checkout master
git log
</pre></div>

<p>and then a</p>
<div class="code"><pre class="code literal-block">git checkout branch-X
git log
</pre></div>

<p>and visually diff these, but I'm hoping for an easier, less error-prone
method.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can get a really nice, visual output of how your branches differ with this</p>
<div class="code"><pre class="code literal-block">git log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr)%Creset' --abbrev-commit --date=relative master..branch-X
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You can get a really nice, visual output of how your branches differ with this</p>
<div class="code"><pre class="code literal-block">git log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr)%Creset' --abbrev-commit --date=relative master..branch-X
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/understanding-passport-serialize-deserialize/" class="u-url">Understanding passport serialize deserialize</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/understanding-passport-serialize-deserialize/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T08:18:09+08:00" itemprop="datePublished" title="2023-03-03 08:18">2023-03-03 08:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How would you explain the workflow of Passport's serialize and deserialize
methods to a layman.</p>
<ol>
<li>
<p>Where does <code>user.id</code> go after <code>passport.serializeUser</code> has been called?  </p>
</li>
<li>
<p>We are calling <code>passport.deserializeUser</code> right after it where does it fit in the workflow?</p>
<div class="code"><pre class="code literal-block"><span class="c1">// used to serialize the user for the session</span>
</pre></div>

<p>passport.serializeUser(function(user, done) {
    done(null, user.id); 
   // where is this user.id going? Are we supposed to access this anywhere?
});</p>
<p>// used to deserialize the user
passport.deserializeUser(function(id, done) {
    User.findById(id, function(err, user) {
        done(err, user);
    });
});</p>
</li>
</ol>
<p>I'm still trying to wrap my head around it. I have a complete working app and
am not running into errors of any kind.</p>
<p>I just wanted to understand what exactly is happening here?</p>
<p>Any help is appreciated.</p>
<p><br><br></p>
<h2>Answer</h2>
<blockquote>
<ol>
<li>Where does <code>user.id</code> go after <code>passport.serializeUser</code> has been called?
</li>
</ol>
</blockquote>
<p>The user id (you provide as the second argument of the <code>done</code> function) is
saved in the session and is later used to retrieve the whole object via the
<code>deserializeUser</code> function.</p>
<p><code>serializeUser</code> determines which data of the user object should be stored in
the session. The result of the serializeUser method is attached to the session
as <code>req.session.passport.user = {}</code>. Here for instance, it would be (as we
provide the user id as the key) <code>req.session.passport.user = {id: 'xyz'}</code></p>
<blockquote>
<ol>
<li>We are calling <code>passport.deserializeUser</code> right after it where does it
fit in the workflow?
</li>
</ol>
</blockquote>
<p>The first argument of <code>deserializeUser</code> corresponds to the key of the user
object that was given to the <code>done</code> function (see 1.). So your whole object is
retrieved with help of that key. That key here is the user id (key can be any
key of the user object i.e. name,email etc). In <code>deserializeUser</code> that key is
matched with the in memory array / database or any data resource.</p>
<p>The fetched object is attached to the request object as <code>req.user</code></p>
<p><strong>Visual Flow</strong></p>
<div class="code"><pre class="code literal-block"><span class="nt">passport</span><span class="p">.</span><span class="nc">serializeUser</span><span class="o">(</span><span class="nt">function</span><span class="o">(</span><span class="nt">user</span><span class="o">,</span><span class="w"> </span><span class="nt">done</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">done(null,</span><span class="w"> </span><span class="err">user.id)</span><span class="p">;</span>
<span class="p">}</span><span class="o">);</span><span class="w">              </span><span class="err">│</span>
<span class="w">                 </span><span class="err">│</span><span class="w"> </span>
<span class="w">                 </span><span class="err">│</span>
<span class="w">                 </span><span class="err">└─────────────────┬──→</span><span class="w"> </span><span class="nt">saved</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">session</span>
<span class="w">                                   </span><span class="err">│</span><span class="w">    </span><span class="nt">req</span><span class="p">.</span><span class="nc">session</span><span class="p">.</span><span class="nc">passport</span><span class="p">.</span><span class="nc">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="s1">'..'</span><span class="p">}</span>
<span class="w">                                   </span><span class="err">│</span>
<span class="w">                                   </span><span class="err">↓</span><span class="w">           </span>
<span class="nt">passport</span><span class="p">.</span><span class="nc">deserializeUser</span><span class="o">(</span><span class="nt">function</span><span class="o">(</span><span class="nt">id</span><span class="o">,</span><span class="w"> </span><span class="nt">done</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                   </span><span class="err">┌───────────────┘</span>
<span class="w">                   </span><span class="err">│</span>
<span class="w">                   </span><span class="err">↓</span><span class="w"> </span>
<span class="w">    </span><span class="err">User.findById(id,</span><span class="w"> </span><span class="err">function(err,</span><span class="w"> </span><span class="err">user)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="err">done(err,</span><span class="w"> </span><span class="err">user)</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="o">);</span><span class="w">            </span><span class="err">└──────────────→</span><span class="w"> </span><span class="nt">user</span><span class="w"> </span><span class="nt">object</span><span class="w"> </span><span class="nt">attaches</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">request</span><span class="w"> </span><span class="nt">as</span><span class="w"> </span><span class="nt">req</span><span class="p">.</span><span class="nc">user</span><span class="w">   </span>
<span class="err">}</span><span class="o">);</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>For anyone using Koa and koa-passport:</p>
<p>Know that the key for the user set in the serializeUser method (often a unique
id for that user) will be stored in:</p>
<p><code>this.session.passport.user</code></p>
<p>When you set in <code>done(null, user)</code> in deserializeUser where 'user' is some
user object from your database:</p>
<p><code>this.req.user</code> OR <code>this.passport.user</code></p>
<p>for some reason <code>this.user</code> Koa context never gets set when you call
done(null, user) in your deserializeUser method.</p>
<p>So you can write your own middleware after the call to
app.use(passport.session()) to put it in this.user like so:</p>
<div class="code"><pre class="code literal-block"><span class="nv">app</span>.<span class="nv">use</span><span class="ss">(</span><span class="nv">function</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">setUserInContext</span><span class="w"> </span><span class="ss">(</span><span class="k">next</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">  </span><span class="nv">this</span>.<span class="nv">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">this</span>.<span class="nv">req</span>.<span class="nv">user</span>
<span class="w">  </span><span class="nv">yield</span><span class="w"> </span><span class="k">next</span>
}<span class="ss">)</span>
</pre></div>

<p>If you're unclear on how serializeUser and deserializeUser work, just hit me
up on twitter. @yvanscher</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1744.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1742.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
