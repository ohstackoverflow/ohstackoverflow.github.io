<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2795) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2795.html">
<link rel="prev" href="index-2796.html" type="text/html">
<link rel="next" href="index-2794.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-you-get-the-footer-to-stay-at-the-bottom-of-a-web-page/" class="u-url">How do you get the footer to stay at the bottom of a Web page?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-you-get-the-footer-to-stay-at-the-bottom-of-a-web-page/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T18:29:56+08:00" itemprop="datePublished" title="2023-03-05 18:29">2023-03-05 18:29</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a simple 2-column layout with a footer that clears both the right and
left div in my markup. My problem is that I can't get the footer to stay at
the bottom of the page in all browsers. It works if the content pushes the
footer down, but that's not always the case.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>To get a sticky footer:</p>
<ol>
<li>
<p>Have a <code>&lt;div&gt;</code> with <code>class="wrapper"</code> for your content.</p>
</li>
<li>
<p>Right <strong>before</strong> the closing <code>&lt;/div&gt;</code> of the <code>wrapper</code> place the <code>&lt;div class="push"&gt;&lt;/div&gt;</code>.</p>
</li>
<li>
<p>Right <strong>after</strong> the closing <code>&lt;/div&gt;</code> of the <code>wrapper</code> place the <code>&lt;div class="footer"&gt;&lt;/div&gt;</code>.</p>
<ul>
<li>{
    margin: 0;
}
html, body {
    height: 100%;
}
.wrapper {
    min-height: 100%;
    height: auto !important;
    height: 100%;
    margin: 0 auto -142px; /<em> the bottom margin is the negative value of the footer's height </em>/
}
.footer, .push {
    height: 142px; /<em> .push must be the same height as .footer </em>/
}</li>
</ul>
</li>
</ol>
<p><br></p>
<h3>Suggest</h3>
<h3>Use CSS vh units!</h3>
<p>Probably the most obvious and non-hacky way to go about a sticky footer would
be to make use of the new css viewport units.</p>
<p>Take for example the following simple markup:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;header&gt;</span>header<span class="w"> </span>goes<span class="w"> </span>here<span class="nt">&lt;/header&gt;</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"content"</span><span class="nt">&gt;</span>This<span class="w"> </span>page<span class="w"> </span>has<span class="w"> </span>little<span class="w"> </span>content<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;footer&gt;</span>This<span class="w"> </span>is<span class="w"> </span>my<span class="w"> </span>footer<span class="nt">&lt;/footer&gt;</span>
</pre></div>

<p>If the header is say 80px high and the footer is 40px high, then we can make
our sticky footer <em>with one single rule</em> on the content div:</p>
<div class="code"><pre class="code literal-block"><span class="na">.content</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">min-height:</span><span class="w"> </span><span class="nf">calc</span><span class="p">(</span><span class="mi">100</span><span class="no">vh</span><span class="w"> </span><span class="p">-</span><span class="w"> </span><span class="mi">120</span><span class="no">px</span><span class="p">)</span><span class="c1">;</span>
<span class="w">    </span><span class="cm">/* 80px header + 40px footer = 120px  */</span>
<span class="err">}</span>
</pre></div>

<p>Which means: let the height of the content div be <strong>at least</strong> 100% of the
viewport height minus the combined heights of the header and footer.</p>
<p>That's it.</p>
<p>Show code snippet</p>
<div class="code"><pre class="code literal-block">*<span class="w"> </span>{
<span class="w">    </span>margin:0;
<span class="w">    </span>padding:0;
}
header<span class="w"> </span>{
<span class="w">    </span>background:<span class="w"> </span>yellow;
<span class="w">    </span>height:<span class="w"> </span>80px;
}
.content<span class="w"> </span>{
<span class="w">    </span>min-height:<span class="w"> </span>calc(100vh<span class="w"> </span>-<span class="w"> </span>120px);
<span class="w">    </span>/*<span class="w"> </span>80px<span class="w"> </span>header<span class="w"> </span>+<span class="w"> </span>40px<span class="w"> </span>footer<span class="w"> </span>=<span class="w"> </span>120px<span class="w">  </span>*/
<span class="w">    </span>background:<span class="w"> </span>pink;
}
footer<span class="w"> </span>{
<span class="w">    </span>height:<span class="w"> </span>40px;
<span class="w">    </span>background:<span class="w"> </span>aqua;
}


<span class="nt">&lt;header&gt;</span>header<span class="w"> </span>goes<span class="w"> </span>here<span class="nt">&lt;/header&gt;</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"content"</span><span class="nt">&gt;</span>This<span class="w"> </span>page<span class="w"> </span>has<span class="w"> </span>little<span class="w"> </span>content<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;footer&gt;</span>This<span class="w"> </span>is<span class="w"> </span>my<span class="w"> </span>footer<span class="nt">&lt;/footer&gt;</span>
</pre></div>

<p>... and here's how the same code works with lots of content in the content
div:</p>
<p>Show code snippet</p>
<div class="code"><pre class="code literal-block">*<span class="w"> </span>{
<span class="w">    </span>margin:0;
<span class="w">    </span>padding:0;
}
header<span class="w"> </span>{
<span class="w">    </span>background:<span class="w"> </span>yellow;
<span class="w">    </span>height:<span class="w"> </span>80px;
}
.content<span class="w"> </span>{
<span class="w">    </span>min-height:<span class="w"> </span>calc(100vh<span class="w"> </span>-<span class="w"> </span>120px);
<span class="w">    </span>/*<span class="w"> </span>80px<span class="w"> </span>header<span class="w"> </span>+<span class="w"> </span>40px<span class="w"> </span>footer<span class="w"> </span>=<span class="w"> </span>120px<span class="w">  </span>*/
<span class="w">    </span>background:<span class="w"> </span>pink;
}
footer<span class="w"> </span>{
<span class="w">    </span>height:<span class="w"> </span>40px;
<span class="w">    </span>background:<span class="w"> </span>aqua;
}


<span class="nt">&lt;header&gt;</span>header<span class="w"> </span>goes<span class="w"> </span>here<span class="nt">&lt;/header&gt;</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"content"</span><span class="nt">&gt;</span>Lorem<span class="w"> </span>ipsum<span class="w"> </span>dolor<span class="w"> </span>sit<span class="w"> </span>amet,<span class="w"> </span>consectetuer<span class="w"> </span>adipiscing<span class="w"> </span>elit,<span class="w"> </span>sed<span class="w"> </span>diam<span class="w"> </span>nonummy<span class="w"> </span>nibh<span class="w"> </span>euismod<span class="w"> </span>tincidunt<span class="w"> </span>ut<span class="w"> </span>laoreet<span class="w"> </span>dolore<span class="w"> </span>magna<span class="w"> </span>aliquam<span class="w"> </span>erat<span class="w"> </span>volutpat.<span class="w"> </span>Ut<span class="w"> </span>wisi<span class="w"> </span>enim<span class="w"> </span>ad<span class="w"> </span>minim<span class="w"> </span>veniam,<span class="w"> </span>quis<span class="w"> </span>nostrud<span class="w"> </span>exerci<span class="w"> </span>tation<span class="w"> </span>ullamcorper<span class="w"> </span>suscipit<span class="w"> </span>lobortis<span class="w"> </span>nisl<span class="w"> </span>ut<span class="w"> </span>aliquip<span class="w"> </span>ex<span class="w"> </span>ea<span class="w"> </span>commodo<span class="w"> </span>consequat.<span class="w"> </span>Duis<span class="w"> </span>autem<span class="w"> </span>vel<span class="w"> </span>eum<span class="w"> </span>iriure<span class="w"> </span>dolor<span class="w"> </span>in<span class="w"> </span>hendrerit<span class="w"> </span>in<span class="w"> </span>vulputate<span class="w"> </span>velit<span class="w"> </span>esse<span class="w"> </span>molestie<span class="w"> </span>consequat,<span class="w"> </span>vel<span class="w"> </span>illum<span class="w"> </span>dolore<span class="w"> </span>eu<span class="w"> </span>feugiat<span class="w"> </span>nulla<span class="w"> </span>facilisis<span class="w"> </span>at<span class="w"> </span>vero<span class="w"> </span>eros<span class="w"> </span>et<span class="w"> </span>accumsan<span class="w"> </span>et<span class="w"> </span>iusto<span class="w"> </span>odio<span class="w"> </span>dignissim<span class="w"> </span>qui<span class="w"> </span>blandit<span class="w"> </span>praesent<span class="w"> </span>luptatum<span class="w"> </span>zzril<span class="w"> </span>delenit<span class="w"> </span>augue<span class="w"> </span>duis<span class="w"> </span>dolore<span class="w"> </span>te<span class="w"> </span>feugait<span class="w"> </span>nulla<span class="w"> </span>facilisi.<span class="w"> </span>Nam<span class="w"> </span>liber<span class="w"> </span>tempor<span class="w"> </span>cum<span class="w"> </span>soluta<span class="w"> </span>nobis<span class="w"> </span>eleifend<span class="w"> </span>option<span class="w"> </span>congue<span class="w"> </span>nihil<span class="w"> </span>imperdiet<span class="w"> </span>doming<span class="w"> </span>id<span class="w"> </span>quod<span class="w"> </span>mazim<span class="w"> </span>placerat<span class="w"> </span>facer<span class="w"> </span>possim<span class="w"> </span>assum.<span class="w"> </span>Typi<span class="w"> </span>non<span class="w"> </span>habent<span class="w"> </span>claritatem<span class="w"> </span>insitam;<span class="w"> </span>est<span class="w"> </span>usus<span class="w"> </span>legentis<span class="w"> </span>in<span class="w"> </span>iis<span class="w"> </span>qui<span class="w"> </span>facit<span class="w"> </span>eorum<span class="w"> </span>claritatem.<span class="w"> </span>Investigationes<span class="w"> </span>demonstraverunt<span class="w"> </span>lectores<span class="w"> </span>legere<span class="w"> </span>me<span class="w"> </span>lius<span class="w"> </span>quod<span class="w"> </span>ii<span class="w"> </span>legunt<span class="w"> </span>saepius.<span class="w"> </span>Claritas<span class="w"> </span>est<span class="w"> </span>etiam<span class="w"> </span>processus<span class="w"> </span>dynamicus,<span class="w"> </span>qui<span class="w"> </span>sequitur<span class="w"> </span>mutationem<span class="w"> </span>consuetudium<span class="w"> </span>lectorum.<span class="w"> </span>Mirum<span class="w"> </span>est<span class="w"> </span>notare<span class="w"> </span>quam<span class="w"> </span>littera<span class="w"> </span>gothica,<span class="w"> </span>quam<span class="w"> </span>nunc<span class="w"> </span>putamus<span class="w"> </span>parum<span class="w"> </span>claram,<span class="w"> </span>anteposuerit<span class="w"> </span>litterarum<span class="w"> </span>formas<span class="w"> </span>humanitatis<span class="w"> </span>per<span class="w"> </span>seacula<span class="w"> </span>quarta<span class="w"> </span>decima<span class="w"> </span>et<span class="w"> </span>quinta<span class="w"> </span>decima.<span class="w"> </span>Eodem<span class="w"> </span>modo<span class="w"> </span>typi,<span class="w"> </span>qui<span class="w"> </span>nunc<span class="w"> </span>nobis<span class="w"> </span>videntur<span class="w"> </span>parum<span class="w"> </span>clari,<span class="w"> </span>fiant<span class="w"> </span>sollemnes<span class="w"> </span>in<span class="w"> </span>futurum.Lorem<span class="w"> </span>ipsum<span class="w"> </span>dolor<span class="w"> </span>sit<span class="w"> </span>amet,<span class="w"> </span>consectetuer<span class="w"> </span>adipiscing<span class="w"> </span>elit,<span class="w"> </span>sed<span class="w"> </span>diam<span class="w"> </span>nonummy<span class="w"> </span>nibh<span class="w"> </span>euismod<span class="w"> </span>tincidunt<span class="w"> </span>ut<span class="w"> </span>laoreet<span class="w"> </span>dolore<span class="w"> </span>magna<span class="w"> </span>aliquam<span class="w"> </span>erat<span class="w"> </span>volutpat.<span class="w"> </span>Ut<span class="w"> </span>wisi<span class="w"> </span>enim<span class="w"> </span>ad<span class="w"> </span>minim<span class="w"> </span>veniam,<span class="w"> </span>quis<span class="w"> </span>nostrud<span class="w"> </span>exerci<span class="w"> </span>tation<span class="w"> </span>ullamcorper<span class="w"> </span>suscipit<span class="w"> </span>lobortis<span class="w"> </span>nisl<span class="w"> </span>ut<span class="w"> </span>aliquip<span class="w"> </span>ex<span class="w"> </span>ea<span class="w"> </span>commodo<span class="w"> </span>consequat.<span class="w"> </span>Duis<span class="w"> </span>autem<span class="w"> </span>vel<span class="w"> </span>eum<span class="w"> </span>iriure<span class="w"> </span>dolor<span class="w"> </span>in<span class="w"> </span>hendrerit<span class="w"> </span>in<span class="w"> </span>vulputate<span class="w"> </span>velit<span class="w"> </span>esse<span class="w"> </span>molestie<span class="w"> </span>consequat,<span class="w"> </span>vel<span class="w"> </span>illum<span class="w"> </span>dolore<span class="w"> </span>eu<span class="w"> </span>feugiat<span class="w"> </span>nulla<span class="w"> </span>facilisis<span class="w"> </span>at<span class="w"> </span>vero<span class="w"> </span>eros<span class="w"> </span>et<span class="w"> </span>accumsan<span class="w"> </span>et<span class="w"> </span>iusto<span class="w"> </span>odio<span class="w"> </span>dignissim<span class="w"> </span>qui<span class="w"> </span>blandit<span class="w"> </span>praesent<span class="w"> </span>luptatum<span class="w"> </span>zzril<span class="w"> </span>delenit<span class="w"> </span>augue<span class="w"> </span>duis<span class="w"> </span>dolore<span class="w"> </span>te<span class="w"> </span>feugait<span class="w"> </span>nulla<span class="w"> </span>facilisi.<span class="w"> </span>Nam<span class="w"> </span>liber<span class="w"> </span>tempor<span class="w"> </span>cum<span class="w"> </span>soluta<span class="w"> </span>nobis<span class="w"> </span>eleifend<span class="w"> </span>option<span class="w"> </span>congue<span class="w"> </span>nihil<span class="w"> </span>imperdiet<span class="w"> </span>doming<span class="w"> </span>id<span class="w"> </span>quod<span class="w"> </span>mazim<span class="w"> </span>placerat<span class="w"> </span>facer<span class="w"> </span>possim<span class="w"> </span>assum.<span class="w"> </span>Typi<span class="w"> </span>non<span class="w"> </span>habent<span class="w"> </span>claritatem<span class="w"> </span>insitam;<span class="w"> </span>est<span class="w"> </span>usus<span class="w"> </span>legentis<span class="w"> </span>in<span class="w"> </span>iis<span class="w"> </span>qui<span class="w"> </span>facit<span class="w"> </span>eorum<span class="w"> </span>claritatem.<span class="w"> </span>Investigationes<span class="w"> </span>demonstraverunt<span class="w"> </span>lectores<span class="w"> </span>legere<span class="w"> </span>me<span class="w"> </span>lius<span class="w"> </span>quod<span class="w"> </span>ii<span class="w"> </span>legunt<span class="w"> </span>saepius.<span class="w"> </span>Claritas<span class="w"> </span>est<span class="w"> </span>etiam<span class="w"> </span>processus<span class="w"> </span>dynamicus,<span class="w"> </span>qui<span class="w"> </span>sequitur<span class="w"> </span>mutationem<span class="w"> </span>consuetudium<span class="w"> </span>lectorum.<span class="w"> </span>Mirum<span class="w"> </span>est<span class="w"> </span>notare<span class="w"> </span>quam<span class="w"> </span>littera<span class="w"> </span>gothica,<span class="w"> </span>quam<span class="w"> </span>nunc<span class="w"> </span>putamus<span class="w"> </span>parum<span class="w"> </span>claram,<span class="w"> </span>anteposuerit<span class="w"> </span>litterarum<span class="w"> </span>formas<span class="w"> </span>humanitatis<span class="w"> </span>per<span class="w"> </span>seacula<span class="w"> </span>quarta<span class="w"> </span>decima<span class="w"> </span>et<span class="w"> </span>quinta<span class="w"> </span>decima.<span class="w"> </span>Eodem<span class="w"> </span>modo<span class="w"> </span>typi,<span class="w"> </span>qui<span class="w"> </span>nunc<span class="w"> </span>nobis<span class="w"> </span>videntur<span class="w"> </span>parum<span class="w"> </span>clari,<span class="w"> </span>fiant<span class="w"> </span>sollemnes<span class="w"> </span>in<span class="w"> </span>futurum.
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;footer&gt;</span>
<span class="w">    </span>This<span class="w"> </span>is<span class="w"> </span>my<span class="w"> </span>footer
<span class="nt">&lt;/footer&gt;</span>
</pre></div>

<p><strong>NB:</strong></p>
<p>1) The height of the header and footer must be known</p>
<p>2) Old versions of IE (IE8-) and Android (4.4-) don't support viewport units.
(caniuse)</p>
<p>3) Once upon a time webkit had a problem with viewport units within a calc
rule. This has indeed been fixed (see here) so there's no problem there.
However if you're looking to avoid using calc for some reason you can get
around that using negative margins and padding with box-sizing -</p>
<p>Like so:</p>
<p>Show code snippet</p>
<div class="code"><pre class="code literal-block">*<span class="w"> </span>{
<span class="w">    </span>margin:0;padding:0;
}
header<span class="w"> </span>{
<span class="w">    </span>background:<span class="w"> </span>yellow;
<span class="w">    </span>height:<span class="w"> </span>80px;
<span class="w">    </span>position:relative;
}
.content<span class="w"> </span>{
<span class="w">    </span>min-height:<span class="w"> </span>100vh;
<span class="w">    </span>background:<span class="w"> </span>pink;
<span class="w">    </span>margin:<span class="w"> </span>-80px<span class="w"> </span>0<span class="w"> </span>-40px;
<span class="w">    </span>padding:<span class="w"> </span>80px<span class="w"> </span>0<span class="w"> </span>40px;
<span class="w">    </span>box-sizing:border-box;
}
footer<span class="w"> </span>{
<span class="w">    </span>height:<span class="w"> </span>40px;
<span class="w">    </span>background:<span class="w"> </span>aqua;
}


<span class="nt">&lt;header&gt;</span>header<span class="w"> </span>goes<span class="w"> </span>here<span class="nt">&lt;/header&gt;</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"content"</span><span class="nt">&gt;</span>Lorem<span class="w"> </span>ipsum<span class="w"> </span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;footer&gt;</span>
<span class="w">    </span>This<span class="w"> </span>is<span class="w"> </span>my<span class="w"> </span>footer
<span class="nt">&lt;/footer&gt;</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-detect-browser-back-button-event-cross-browser/" class="u-url">How to Detect Browser Back Button event - Cross Browser</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-detect-browser-back-button-event-cross-browser/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T18:28:16+08:00" itemprop="datePublished" title="2023-03-05 18:28">2023-03-05 18:28</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do you definitively detect whether or not the user has pressed the back
button in the browser?</p>
<p>How do you enforce the use of an in-page back button inside a single page web
application using a <code>#URL</code> system?</p>
<p>Why on earth don't browser back buttons fire their own events!?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>(Note: As per Sharky's feedback, I've included code to detect backspaces)</p>
<p>So, I've seen these questions frequently on SO, and have recently run into the
issue of controlling back button functionality myself. After a few days of
searching for the best solution for my application (Single-Page with Hash
Navigation), I've come up with a simple, cross-browser, library-less system
for detecting the back button.</p>
<p>Most people recommend using:</p>
<div class="code"><pre class="code literal-block">window.onhashchange = function() {
 //blah blah blah
}
</pre></div>

<p>However, this function will also be called when a user uses on in-page element
that changes the location hash. Not the best user experience when your user
clicks and the page goes backwards or forwards.</p>
<p>To give you a general outline of my system, I'm filling up an array with
previous hashes as my user moves through the interface. It looks something
like this:</p>
<div class="code"><pre class="code literal-block">function updateHistory(curr) {
    window.location.lasthash.push(window.location.hash);
    window.location.hash = curr;
}
</pre></div>

<p>Pretty straight forward. I do this to ensure cross-browser support, as well as
support for older browsers. Simply pass the new hash to the function, and
it'll store it for you and then change the hash (which is then put into the
browser's history).</p>
<p>I also utilise an in-page back button that moves the user between pages using
the <code>lasthash</code> array. It looks like this:</p>
<div class="code"><pre class="code literal-block">function goBack() {
    window.location.hash = window.location.lasthash[window.location.lasthash.length-1];
    //blah blah blah
    window.location.lasthash.pop();
}
</pre></div>

<p>So this will move the user back to the last hash, and remove that last hash
from the array (I have no forward button right now).</p>
<p>So. How do I detect whether or not a user has used my in-page back button, or
the browser button?</p>
<p>At first I looked at <code>window.onbeforeunload</code>, but to no avail - that is only
called if the user is going to change pages. This does not happen in a single-
page-application using hash navigation.</p>
<p>So, after some more digging, I saw recommendations for trying to set a flag
variable. The issue with this in my case, is that I would try to set it, but
as everything is asynchronous, it wouldn't always be set in time for the if
statement in the hash change. <code>.onMouseDown</code> wasn't always called in click,
and adding it to an onclick wouldn't ever trigger it fast enough.</p>
<p>This is when I started to look at the difference between <code>document</code>, and
<code>window</code>. My final solution was to set the flag using <code>document.onmouseover</code>,
and disable it using <code>document.onmouseleave</code>.</p>
<p>What happens is that while the user's mouse is inside the document area (read:
the rendered page, but excluding the browser frame), my boolean is set to
<code>true</code>. As soon as the mouse leaves the document area, the boolean flips to
<code>false</code>.</p>
<p>This way, I can change my <code>window.onhashchange</code> to:</p>
<div class="code"><pre class="code literal-block"><span class="n">window</span><span class="o">.</span><span class="n">onhashchange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">innerDocClick</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">window</span><span class="o">.</span><span class="n">innerDocClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">hash</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'#undefined'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">goBack</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">history</span><span class="o">.</span><span class="n">pushState</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">window</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">pathname</span><span class="p">);</span>
<span class="w">            </span><span class="n">location</span><span class="o">.</span><span class="n">reload</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You'll note the check for <code>#undefined</code>. This is because if there is no history
available in my array, it returns <code>undefined</code>. I use this to ask the user if
they want to leave using a <code>window.onbeforeunload</code> event.</p>
<p>So, in short, and for people that aren't necessarily using an in-page back
button or an array to store the history:</p>
<div class="code"><pre class="code literal-block"><span class="nv">document</span>.<span class="nv">onmouseover</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">function</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="o">//</span><span class="nv">User</span><span class="err">'s mouse is inside the page.</span>
<span class="err">    window.innerDocClick = true;</span>
<span class="err">}</span>

<span class="err">document.onmouseleave = function() {</span>
<span class="w">    </span><span class="o">//</span><span class="nv">User</span><span class="err">'s mouse has left the page.</span>
<span class="err">    window.innerDocClick = false;</span>
<span class="err">}</span>

<span class="err">window.onhashchange = function() {</span>
<span class="err">    if (window.innerDocClick) {</span>
<span class="err">        //Your own in-page mechanism triggered the hash change</span>
<span class="err">    } else {</span>
<span class="err">        //Browser back button was clicked</span>
<span class="err">    }</span>
<span class="err">}</span>
</pre></div>

<p>And there you have it. a simple, three-part way to detect back button usage vs
in-page elements with regards to hash navigation.</p>
<p>EDIT:</p>
<p>To ensure that the user doesn't use backspace to trigger the back event, you
can also include the following (Thanks to @thetoolman on this Question):</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="p">(</span><span class="n">function</span><span class="p">(){</span>
<span class="w">    </span><span class="o">/*</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">swallows</span><span class="w"> </span><span class="n">backspace</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="n">input</span><span class="w"> </span><span class="n">element</span><span class="o">.</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">stops</span><span class="w"> </span><span class="n">backspace</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">back</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">rx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">/</span><span class="n">INPUT</span><span class="o">|</span><span class="n">SELECT</span><span class="o">|</span><span class="n">TEXTAREA</span><span class="o">/</span><span class="n">i</span><span class="p">;</span>

<span class="w">    </span><span class="o">$</span><span class="p">(</span><span class="n">document</span><span class="p">)</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"keydown keypress"</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">e</span><span class="p">){</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">which</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">){</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">backspace</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rx</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">tagName</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">disabled</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">readOnly</span><span class="w"> </span><span class="p">){</span>
<span class="w">                </span><span class="n">e</span><span class="o">.</span><span class="n">preventDefault</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You can try <code>popstate</code> event handler, e.g:</p>
<div class="code"><pre class="code literal-block"><span class="n">window</span><span class="o">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="s1">'popstate'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">popstate</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">fired</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">history</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="n">changes</span><span class="o">.</span>

<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">confirm</span><span class="p">(</span><span class="s2">"You pressed a Back button! Are you sure?!"</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="bp">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Call</span><span class="w"> </span><span class="n">Back</span><span class="w"> </span><span class="n">button</span><span class="w"> </span><span class="n">programmatically</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">confirmation</span><span class="o">.</span>
<span class="w">        </span><span class="n">history</span><span class="o">.</span><span class="n">back</span><span class="p">();</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Uncomment</span><span class="w"> </span><span class="n">below</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">redirect</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">instead</span><span class="o">.</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">window</span><span class="o">.</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">referrer</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Note</span><span class="p">:</span><span class="w"> </span><span class="n">IE11</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">supporting</span><span class="w"> </span><span class="n">this</span><span class="o">.</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Stay</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">page</span><span class="o">.</span>
<span class="w">        </span><span class="n">history</span><span class="o">.</span><span class="n">pushState</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="n">window</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">pathname</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">history</span><span class="o">.</span><span class="n">pushState</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="n">window</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">pathname</span><span class="p">);</span>

<span class="p">},</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
</pre></div>

<p>Note: For the best results, you should load this code only on specific pages
where you want to implement the logic to avoid any other unexpected issues.</p>
<p>The popstate event is fired each time when the current history entry changes
(user navigates to a new state). That happens when user clicks on browser's
Back/Forward buttons or when <code>history.back()</code>, <code>history.forward()</code>,
<code>history.go()</code> methods are programatically called.</p>
<p>The <code>event.state</code> is property of the event is equal to the history state
object.</p>
<p>For jQuery syntax, wrap it around (to add even listener after document is
ready):</p>
<div class="code"><pre class="code literal-block">(function($) {
  // Above code here.
})(jQuery);
</pre></div>

<p>See also: window.onpopstate on page load</p>
<hr>
<p>See also the examples on Single-Page Apps and HTML5 pushState page:</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
<span class="o">//</span><span class="w"> </span><span class="n">jQuery</span>
<span class="o">$</span><span class="p">(</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">'popstate'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">originalEvent</span><span class="o">.</span><span class="n">state</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="nb">load</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">ajax</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="o">//</span><span class="w"> </span><span class="n">Vanilla</span><span class="w"> </span><span class="n">javascript</span>
<span class="n">window</span><span class="o">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="s1">'popstate'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">state</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="nb">load</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">ajax</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>

<p>This should be compatible with Chrome 5+, Firefox 4+, IE 10+, Safari 6+, Opera
11.5+ and similar.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/do-you-need-to-dispose-of-objects-and-set-them-to-null/" class="u-url">Do you need to dispose of objects and set them to null?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/do-you-need-to-dispose-of-objects-and-set-them-to-null/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T18:26:46+08:00" itemprop="datePublished" title="2023-03-05 18:26">2023-03-05 18:26</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Do you need to dispose of objects and set them to null, or will the garbage
collector clean them up when they go out of scope?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Objects will be cleaned up when they are no longer being used and when the
garbage collector sees fit. Sometimes, you may need to set an object to <code>null</code>
in order to make it go out of scope (such as a static field whose value you no
longer need), but overall there is usually no need to set to <code>null</code>.</p>
<p>Regarding disposing objects, I agree with @Andre. If the object is
<code>IDisposable</code> it is <strong>a good idea to dispose it</strong> when you no longer need it,
especially if the object uses unmanaged resources. Not disposing unmanaged
resources will <strong>lead to memory leaks</strong>.</p>
<p>You can use the <code>using</code> statement to automatically dispose an object once your
program leaves the scope of the <code>using</code> statement.</p>
<div class="code"><pre class="code literal-block">using (MyIDisposableObject obj = new MyIDisposableObject())
{
    // use the object here
} // the object is disposed here
</pre></div>

<p>Which is functionally equivalent to:</p>
<div class="code"><pre class="code literal-block"><span class="nv">MyIDisposableObject</span><span class="w"> </span><span class="nv">obj</span><span class="c1">;</span>
<span class="nv">try</span>
{
<span class="w">    </span><span class="nv">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">MyIDisposableObject</span><span class="ss">()</span><span class="c1">;</span>
}
<span class="nv">finally</span>
{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">obj</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span>
<span class="w">    </span>{
<span class="w">        </span><span class="ss">((</span><span class="nv">IDisposable</span><span class="ss">)</span><span class="nv">obj</span><span class="ss">)</span>.<span class="nv">Dispose</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Objects never go out of scope in C# as they do in C++. They are dealt with by
the Garbage Collector automatically when they are not used anymore. This is a
more complicated approach than C++ where the scope of a variable is entirely
deterministic. CLR garbage collector actively goes through all objects that
have been created and works out if they are being used.</p>
<p>An object can go "out of scope" in one function but if its value is returned,
then GC would look at whether or not the calling function holds onto the
return value.</p>
<p>Setting object references to <code>null</code> is unnecessary as garbage collection works
by working out which objects are being referenced by other objects.</p>
<p>In practice, you don't have to worry about destruction, it just works and it's
great :)</p>
<p><code>Dispose</code> must be called on all objects that implement <code>IDisposable</code> when you
are finished working with them. Normally you would use a <code>using</code> block with
those objects like so:</p>
<div class="code"><pre class="code literal-block"><span class="n">using</span><span class="w"> </span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MemoryStream</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//...</span>
<span class="p">}</span>
</pre></div>

<p><strong>EDIT</strong> On variable scope. Craig has asked whether the variable scope has any
effect on the object lifetime. To properly explain that aspect of CLR, I'll
need to explain a few concepts from C++ and C#.</p>
<h4>Actual variable scope</h4>
<p>In both languages the variable can only be used in the same scope as it was
defined - class, function or a statement block enclosed by braces. The subtle
difference, however, is that in C#, variables cannot be redefined in a nested
block.</p>
<p>In C++, this is perfectly legal:</p>
<div class="code"><pre class="code literal-block"><span class="nv">int</span><span class="w"> </span><span class="nv">iVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="c1">;</span>
<span class="o">//</span><span class="nv">iVal</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span>
<span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">iVal</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="ss">)</span>{
<span class="w">    </span><span class="nv">int</span><span class="w"> </span><span class="nv">iVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="c1">;</span>
<span class="w">    </span><span class="o">//</span><span class="nv">iVal</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span>
}
<span class="o">//</span><span class="nv">iVal</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span>
</pre></div>

<p>In C#, however you get a a compiler error:</p>
<div class="code"><pre class="code literal-block"><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">iVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="n">iVal</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">iVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="n">error</span><span class="w"> </span><span class="n">CS0136</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="s1">'iVal'</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">declared</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">would</span><span class="w"> </span><span class="n">give</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">meaning</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s1">'iVal'</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="s1">'parent or current'</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">denote</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="k">else</span>
<span class="p">}</span>
</pre></div>

<p>This makes sense if you look at generated MSIL - all the variables used by the
function are defined at the start of the function. Take a look at this
function:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">Scope</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">int</span><span class="w"> </span><span class="nv">iVal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="c1">;</span>
<span class="w">    </span><span class="k">if</span><span class="ss">(</span><span class="nv">iVal</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">8</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">int</span><span class="w"> </span><span class="nv">iVal2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<p>Below is the generated IL. Note that iVal2, which is defined inside the if
block is actually defined at function level. Effectively this means that C#
only has class and function level scope as far as variable lifetime is
concerned.</p>
<div class="code"><pre class="code literal-block"><span class="na">.method</span><span class="w"> </span><span class="no">public</span><span class="w"> </span><span class="no">hidebysig</span><span class="w"> </span><span class="no">static</span><span class="w"> </span><span class="no">void</span><span class="w">  </span><span class="no">Scope</span><span class="p">()</span><span class="w"> </span><span class="no">cil</span><span class="w"> </span><span class="no">managed</span>
<span class="err">{</span>
<span class="w">  </span><span class="c1">// Code size       19 (0x13)</span>
<span class="w">  </span><span class="na">.maxstack</span><span class="w">  </span><span class="mi">2</span>
<span class="w">  </span><span class="na">.locals</span><span class="w"> </span><span class="no">init</span><span class="w"> </span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="no">int32</span><span class="w"> </span><span class="no">iVal</span><span class="p">,</span>
<span class="w">           </span><span class="err">[1]</span><span class="w"> </span><span class="nf">int32</span><span class="w"> </span><span class="no">iVal2</span><span class="p">,</span>
<span class="w">           </span><span class="err">[2]</span><span class="w"> </span><span class="nf">bool</span><span class="w"> </span><span class="no">CS$4$0000</span><span class="p">)</span>

<span class="c1">//Function IL - omitted</span>
<span class="err">}</span><span class="w"> </span><span class="c1">// end of method Test2::Scope</span>
</pre></div>

<h4>C++ scope and object lifetime</h4>
<p>Whenever a C++ variable, allocated on the stack, goes out of scope it gets
destructed. Remember that in C++ you can create objects on the stack or on the
heap. When you create them on the stack, once execution leaves the scope, they
get popped off the stack and gets destroyed.</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">true</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">  </span><span class="nv">MyClass</span><span class="w"> </span><span class="nv">stackObj</span><span class="c1">; //created on the stack</span>
<span class="w">  </span><span class="nv">MyClass</span><span class="w"> </span><span class="nv">heapObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">MyClass</span><span class="ss">()</span><span class="c1">; //created on the heap</span>
<span class="w">  </span><span class="nv">obj</span>.<span class="nv">doSomething</span><span class="ss">()</span><span class="c1">;</span>
}<span class="w"> </span><span class="o">//&lt;--</span><span class="w"> </span><span class="nv">stackObj</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">destroyed</span>
<span class="o">//</span><span class="nv">heapObj</span><span class="w"> </span><span class="nv">still</span><span class="w"> </span><span class="nv">lives</span>
</pre></div>

<p>When C++ objects are created on the heap, they must be explicitly destroyed,
otherwise it is a memory leak. No such problem with stack variables though.</p>
<h4>C# Object Lifetime</h4>
<p>In CLR, objects (i.e. reference types) are <strong>always</strong> created on the managed
heap. This is further reinforced by object creation syntax. Consider this code
snippet.</p>
<div class="code"><pre class="code literal-block">MyClass stackObj;
</pre></div>

<p>In C++ this would create an instance on <code>MyClass</code> on the stack and call its
default constructor. In C# it would create a reference to class <code>MyClass</code> that
doesn't point to anything. The only way to create an instance of a class is by
using <code>new</code> operator:</p>
<div class="code"><pre class="code literal-block">MyClass stackObj = new MyClass();
</pre></div>

<p>In a way, C# objects are a lot like objects that are created using <code>new</code>
syntax in C++ - they are created on the heap but unlike C++ objects, they are
managed by the runtime, so you don't have to worry about destructing them.</p>
<p>Since the objects are <strong>always</strong> on the heap the fact that object references
(i.e. pointers) go out of scope becomes moot. There are more factors involved
in determining if an object is to be collected than simply presence of
references to the object.</p>
<h4>C# Object references</h4>
<p>Jon Skeet compared object references in Java to pieces of string that are
attached to the balloon, which is the object. Same analogy applies to C#
object references. They simply point to a location of the heap that contains
the object. Thus, setting it to null has no immediate effect on the object
lifetime, the balloon continues to exist, until the GC "pops" it.</p>
<p>Continuing down the balloon analogy, it would seem logical that once the
balloon has no strings attached to it, it can be destroyed. In fact this is
exactly how reference counted objects work in non-managed languages. Except
this approach doesn't work for circular references very well. Imagine two
balloons that are attached together by a string but neither balloon has a
string to anything else. Under simple ref counting rules, they both continue
to exist, even though the whole balloon group is "orphaned".</p>
<p>.NET objects are a lot like helium balloons under a roof. When the roof opens
(GC runs) - the unused balloons float away, even though there might be groups
of balloons that are tethered together.</p>
<p>.NET GC uses a combination of generational GC and mark and sweep. Generational
approach involves the runtime favouring to inspect objects that have been
allocated most recently, as they are more likely to be unused and mark and
sweep involves runtime going through the whole object graph and working out if
there are object groups that are unused. This adequately deals with circular
dependency problem.</p>
<p>Also, .NET GC runs on another thread(so called finalizer thread) as it has
quite a bit to do and doing that on the main thread would interrupt your
program.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2796.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2794.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
