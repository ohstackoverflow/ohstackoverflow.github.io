<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 389) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-389.html">
<link rel="prev" href="index-390.html" type="text/html">
<link rel="next" href="index-388.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-make-bootstrap-columns-all-the-same-height/" class="u-url">How can I make Bootstrap columns all the same height?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-make-bootstrap-columns-all-the-same-height/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:36:11+08:00" itemprop="datePublished" title="2023-02-17 05:36">2023-02-17 05:36</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm using Bootstrap. How can I make three columns all the same height?</p>
<p>Here is a screenshot of the problem. I would like the blue and red columns to
be the same height as the yellow column.</p>
<p><img alt="Three bootstrap columns with the center column longer than the other two
columns" src="images/PLP7h.png"></p>
<p>Here is the code:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;link</span><span class="w"> </span><span class="na">href=</span><span class="s">"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"</span><span class="w"> </span><span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"container-fluid"</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"col-xs-4 panel"</span><span class="w"> </span><span class="na">style=</span><span class="s">"background-color: red"</span><span class="nt">&gt;</span>
<span class="w">        </span>some<span class="w"> </span>content
<span class="w">    </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"col-xs-4 panel"</span><span class="w"> </span><span class="na">style=</span><span class="s">"background-color: yellow"</span><span class="nt">&gt;</span>
<span class="w">        </span>catz
<span class="w">        </span><span class="nt">&lt;img</span><span class="w"> </span><span class="na">width=</span><span class="s">"100"</span><span class="w"> </span><span class="na">height=</span><span class="s">"100"</span><span class="w"> </span><span class="na">src=</span><span class="s">"https://lorempixel.com/100/100/cats/"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"col-xs-4 panel"</span><span class="w"> </span><span class="na">style=</span><span class="s">"background-color: blue"</span><span class="nt">&gt;</span>
<span class="w">        </span>some<span class="w"> </span>more<span class="w"> </span>content
<span class="w">    </span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<h2><strong>LATEST SOLUTION (2022)</strong></h2>
<p><strong>Solution 4 using Bootstrap 4 or 5</strong></p>
<p>Bootstrap 4 and 5 use Flexbox by default, so there is no need for extra CSS.</p>
<p>Demo</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"row "</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"col-md-4"</span><span class="w"> </span><span class="na">style=</span><span class="s">"background-color: red"</span><span class="nt">&gt;</span>
<span class="w">          </span>some<span class="w"> </span>content
<span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"col-md-4"</span><span class="w"> </span><span class="na">style=</span><span class="s">"background-color: yellow"</span><span class="nt">&gt;</span>
<span class="w">          </span>catz
<span class="w">          </span><span class="nt">&lt;img</span><span class="w"> </span><span class="na">width=</span><span class="s">"100"</span><span class="w"> </span><span class="na">height=</span><span class="s">"100"</span><span class="w"> </span><span class="na">src=</span><span class="s">"https://placekitten.com/100/100/"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"col-md-4"</span><span class="w"> </span><span class="na">style=</span><span class="s">"background-color: green"</span><span class="nt">&gt;</span>
<span class="w">          </span>some<span class="w"> </span>more<span class="w"> </span>content
<span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p><strong>Solution 1 using negative margins (doesn't break responsiveness)</strong></p>
<p>Demo</p>
<div class="code"><pre class="code literal-block"><span class="na">.row</span><span class="p">{</span>
<span class="w">    </span><span class="nl">overflow:</span><span class="w"> </span><span class="nf">hidden</span><span class="c1">; </span>
<span class="err">}</span>

<span class="err">[</span><span class="nf">class</span><span class="p">*</span><span class="err">="</span><span class="no">col-</span><span class="err">"</span><span class="p">]{</span>
<span class="w">    </span><span class="nl">margin-bottom:</span><span class="w"> </span><span class="err">-99999</span><span class="nf">px</span><span class="c1">;</span>
<span class="w">    </span><span class="nl">padding-bottom:</span><span class="w"> </span><span class="err">99999</span><span class="nf">px</span><span class="c1">;</span>
<span class="err">}</span>
</pre></div>

<p><strong>Solution 2 using table</strong></p>
<p>Demo</p>
<div class="code"><pre class="code literal-block"><span class="na">.row</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">display:</span><span class="w"> </span><span class="nf">table</span><span class="c1">;</span>
<span class="err">}</span>

<span class="err">[</span><span class="nf">class</span><span class="p">*</span><span class="err">="</span><span class="no">col-</span><span class="err">"</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">float:</span><span class="w"> </span><span class="nf">none</span><span class="c1">;</span>
<span class="w">    </span><span class="nl">display:</span><span class="w"> </span><span class="nf">table-cell</span><span class="c1">;</span>
<span class="w">    </span><span class="nl">vertical-align:</span><span class="w"> </span><span class="nf">top</span><span class="c1">;</span>
<span class="err">}</span>
</pre></div>

<p><strong>Solution 3 using flex</strong> added August 2015. Comments posted before this don't
apply to this solution.</p>
<p>Demo</p>
<div class="code"><pre class="code literal-block"><span class="na">.row</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">display:</span><span class="w"> </span><span class="err">-</span><span class="nf">webkit-box</span><span class="c1">;</span>
<span class="w">  </span><span class="nl">display:</span><span class="w"> </span><span class="err">-</span><span class="nf">webkit-flex</span><span class="c1">;</span>
<span class="w">  </span><span class="nl">display:</span><span class="w"> </span><span class="err">-</span><span class="nf">ms-flexbox</span><span class="c1">;</span>
<span class="w">  </span><span class="nl">display:</span><span class="w">         </span><span class="nf">flex</span><span class="c1">;</span>
<span class="w">  </span><span class="nl">flex-wrap:</span><span class="w"> </span><span class="nf">wrap</span><span class="c1">;</span>
<span class="err">}</span>
<span class="na">.row</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="p">[</span><span class="no">class</span><span class="p">*</span><span class="err">='</span><span class="no">col-</span><span class="err">'</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">display:</span><span class="w"> </span><span class="nf">flex</span><span class="c1">;</span>
<span class="w">  </span><span class="nl">flex-direction:</span><span class="w"> </span><span class="nf">column</span><span class="c1">;</span>
<span class="err">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<h2>Update 2021</h2>
<h3><strong>Bootstrap 4 + 5</strong></h3>
<p>Flexbox is now used by default in Bootstrap 4 (and Bootstrap 5) so there is no
need for the extra CSS to make equal height columns:
https://www.codeply.com/go/IJYRI4LPwU</p>
<p>Example:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"col-md-6"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"col-md-6"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<h3><strong>Bootstrap 3</strong></h3>
<p><strong>Best approach for Bootstap 3.x</strong> — using CSS <strong>flexbox</strong> (and requires
minimal CSS)…</p>
<div class="code"><pre class="code literal-block"><span class="na">.equal</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nl">display:</span><span class="w"> </span><span class="nf">flex</span><span class="c1">;</span>
<span class="w">  </span><span class="nl">display:</span><span class="w"> </span><span class="err">-</span><span class="nf">webkit-flex</span><span class="c1">;</span>
<span class="w">  </span><span class="nl">flex-wrap:</span><span class="w"> </span><span class="nf">wrap</span><span class="c1">;</span>
<span class="err">}</span>
</pre></div>

<p>Bootstrap same height flexbox example</p>
<p>To only apply the same height flexbox at specific breakpoints (responsive),
use a media query. For example, here is <code>sm</code> (768px) and up:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@media</span><span class="w"> </span><span class="p">(</span><span class="nf">min</span><span class="o">-</span><span class="nl">width</span><span class="p">:</span><span class="w"> </span><span class="mi">768</span><span class="n">px</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="p">.</span><span class="k">row</span><span class="p">.</span><span class="n">equal</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nl">display</span><span class="p">:</span><span class="w"> </span><span class="n">flex</span><span class="p">;</span>
<span class="w">    </span><span class="n">flex</span><span class="o">-</span><span class="nl">wrap</span><span class="p">:</span><span class="w"> </span><span class="n">wrap</span><span class="p">;</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>This solution also works well for multiple rows (column wrapping):
https://www.codeply.com/go/bp/gCEXzPMehZ</p>
<p><strong>Other workarounds</strong></p>
<p>These options will be recommended by others, but <strong>are not a good idea</strong> for
responsive design. These only work for simple single row layouts w/o column
wrapping.</p>
<ol>
<li>
<p>Using <strong>huge negative margins &amp; padding</strong></p>
</li>
<li>
<p>Using <strong><code>display:table-cell</code></strong> (this solution also affects the responsive grid, so a <code>@media</code> query can be used to only apply <code>table</code> display on wider screens before the columns stack vertically)</p>
</li>
</ol>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-difference-between-i-and-i/" class="u-url">What is the difference between ++i and i++?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-difference-between-i-and-i/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:35:36+08:00" itemprop="datePublished" title="2023-02-17 05:35">2023-02-17 05:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In C, what is the difference between using <code>++i</code> and <code>i++</code>, and which should
be used in the incrementation block of a <code>for</code> loop?</p>
<p><br><br></p>
<h2>Answer</h2>
<ul>
<li>
<p><code>++i</code> will increment the value of <code>i</code>, and then return the incremented value.</p>
<div class="code"><pre class="code literal-block"> i = 1;
</pre></div>

<p>j = ++i;
 (i is 2, j is 2)</p>
</li>
<li>
<p><code>i++</code> will increment the value of <code>i</code>, but return the original value that <code>i</code> held before being incremented.</p>
<div class="code"><pre class="code literal-block"> i = 1;
</pre></div>

<p>j = i++;
 (i is 2, j is 1)</p>
</li>
</ul>
<p>For a <code>for</code> loop, either works. <code>++i</code> seems more common, perhaps because that
is what is used in K&amp;R.</p>
<p>In any case, follow the guideline "prefer <code>++i</code> over <code>i++</code>" and you won't go
wrong.</p>
<p>There's a couple of comments regarding the efficiency of <code>++i</code> and <code>i++</code>. In
any non-student-project compiler, there will be no performance difference. You
can verify this by looking at the generated code, which will be identical.</p>
<p>The efficiency question is interesting... here's my attempt at an answer: Is
there a performance difference between i++ and ++i in C?</p>
<p>As @OnFreund notes, it's different for a C++ object, since <code>operator++()</code> is a
function and the compiler can't know to optimize away the creation of a
temporary object to hold the intermediate value.</p>
<p><br></p>
<h3>Suggest</h3>
<p><strong>i++</strong> is known as <em>post increment</em> whereas <em>++i</em> is called <em>pre increment.</em></p>
<p><strong><code>i++</code></strong></p>
<p><code>i++</code> is post increment because it increments <code>i</code>'s value by 1 after the
operation is over.</p>
<p>Let’s see the following example:</p>
<div class="code"><pre class="code literal-block">int i = 1, j;
j = i++;
</pre></div>

<p>Here value of <code>j = 1</code>, but <code>i = 2</code>. Here the value of <code>i</code> will be assigned to
<code>j</code> first, and then <code>i</code> will be incremented.</p>
<p><strong><code>++i</code></strong></p>
<p><code>++i</code> is pre increment because it increments <code>i</code>'s value by 1 before the
operation. It means <code>j = i;</code> will execute after <code>i++</code>.</p>
<p>Let’s see the following example:</p>
<div class="code"><pre class="code literal-block">int i = 1, j;
j = ++i;
</pre></div>

<p>Here the value of <code>j = 2</code> but <code>i = 2</code>. Here the value of <code>i</code> will be assigned
to <code>j</code> after the <code>i</code> incremention of <code>i</code>. Similarly, <code>++i</code> will be executed
before <code>j=i;</code>.</p>
<p>For your question <strong>which should be used in the incrementation block of a for
loop?</strong> the answer is, you can use any one... It doesn't matter. It will
execute your <em>for</em> loop same number of times.</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="ss">(</span><span class="nv">i</span><span class="o">=</span><span class="mi">0</span><span class="c1">; i&lt;5; i++)</span>
<span class="w">   </span><span class="nv">printf</span><span class="ss">(</span><span class="s2">"%d "</span>,<span class="w"> </span><span class="nv">i</span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>And</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="ss">(</span><span class="nv">i</span><span class="o">=</span><span class="mi">0</span><span class="c1">; i&lt;5; ++i)</span>
<span class="w">   </span><span class="nv">printf</span><span class="ss">(</span><span class="s2">"%d "</span>,<span class="w"> </span><span class="nv">i</span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>Both the loops will produce the same output. I.e., <code>0 1 2 3 4</code>.</p>
<p>It only matters where you are using it.</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="ss">(</span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="c1">; i&lt;5;)</span>
<span class="w">    </span><span class="nv">printf</span><span class="ss">(</span><span class="s2">"%d "</span>,<span class="w"> </span><span class="o">++</span><span class="nv">i</span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>In this case output will be <code>1 2 3 4 5</code>.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/download-a-file-with-android-and-showing-the-progress-in-a-progressdialog/" class="u-url">Download a file with Android, and showing the progress in a ProgressDialog</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/download-a-file-with-android-and-showing-the-progress-in-a-progressdialog/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:35:08+08:00" itemprop="datePublished" title="2023-02-17 05:35">2023-02-17 05:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am trying to write a simple application that gets updated. For this I need a
simple function that can download a file and <em>show the current progress</em> in a
<code>ProgressDialog</code>. I know how to do the <code>ProgressDialog</code>, but I'm not sure how
to display the current progress and how to download the file in the first
place.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>There are many ways to download files. Following I will post most common ways;
it is up to you to decide which method is better for your app.</p>
<ol>
<li>Use <code>AsyncTask</code> and show the download progress in a dialog =============================================================</li>
</ol>
<p>This method will allow you to execute some background processes and update the
UI at the same time (in this case, we'll update a progress bar).</p>
<p>Imports:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">android.os.PowerManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.net.HttpURLConnection</span><span class="p">;</span>
</pre></div>

<p>This is an example code:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">declare</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dialog</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">member</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">activity</span>
<span class="n">ProgressDialog</span><span class="w"> </span><span class="n">mProgressDialog</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">onCreate</span><span class="w"> </span><span class="n">method</span>
<span class="n">mProgressDialog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ProgressDialog</span><span class="p">(</span><span class="n">YourActivity</span><span class="o">.</span><span class="n">this</span><span class="p">);</span>
<span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s2">"A message"</span><span class="p">);</span>
<span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setIndeterminate</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span>
<span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setProgressStyle</span><span class="p">(</span><span class="n">ProgressDialog</span><span class="o">.</span><span class="n">STYLE_HORIZONTAL</span><span class="p">);</span>
<span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setCancelable</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span>

<span class="o">//</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">downloader</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">fired</span>
<span class="n">final</span><span class="w"> </span><span class="n">DownloadTask</span><span class="w"> </span><span class="n">downloadTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DownloadTask</span><span class="p">(</span><span class="n">YourActivity</span><span class="o">.</span><span class="n">this</span><span class="p">);</span>
<span class="n">downloadTask</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"the url to the file you want to download"</span><span class="p">);</span>

<span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setOnCancelListener</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">DialogInterface</span><span class="o">.</span><span class="n">OnCancelListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCancel</span><span class="p">(</span><span class="n">DialogInterface</span><span class="w"> </span><span class="n">dialog</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">downloadTask</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">cancel</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">task</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>The <code>AsyncTask</code> will look like this:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">usually</span><span class="p">,</span><span class="w"> </span><span class="n">subclasses</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">AsyncTask</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">declared</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">activity</span><span class="w"> </span><span class="k">class</span><span class="o">.</span>
<span class="o">//</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">way</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">easily</span><span class="w"> </span><span class="n">modify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">here</span>
<span class="n">private</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">DownloadTask</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">AsyncTask</span><span class="o">&lt;</span><span class="nb nb-Type">String</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">PowerManager</span><span class="o">.</span><span class="n">WakeLock</span><span class="w"> </span><span class="n">mWakeLock</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">DownloadTask</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">this</span><span class="o">.</span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">doInBackground</span><span class="p">(</span><span class="nb nb-Type">String</span><span class="o">...</span><span class="w"> </span><span class="n">sUrl</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">InputStream</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">        </span><span class="n">OutputStream</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">        </span><span class="n">HttpURLConnection</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">        </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">URL</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">sUrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">            </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">HttpURLConnection</span><span class="p">)</span><span class="w"> </span><span class="n">url</span><span class="o">.</span><span class="n">openConnection</span><span class="p">();</span>
<span class="w">            </span><span class="n">connection</span><span class="o">.</span><span class="n">connect</span><span class="p">();</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">expect</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">don</span><span class="s1">'t mistakenly save error report</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">getResponseCode</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">HttpURLConnection</span><span class="o">.</span><span class="n">HTTP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="s2">"Server returned HTTP "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">connection</span><span class="o">.</span><span class="n">getResponseCode</span><span class="p">()</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="s2">" "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">connection</span><span class="o">.</span><span class="n">getResponseMessage</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">percentage</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">did</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">length</span>
<span class="w">            </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">fileLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="o">.</span><span class="n">getContentLength</span><span class="p">();</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span>
<span class="w">            </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">();</span>
<span class="w">            </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s2">"/sdcard/file_name.extension"</span><span class="p">);</span>

<span class="w">            </span><span class="n">byte</span><span class="w"> </span><span class="n">data</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">byte</span><span class="p">[</span><span class="mi">4096</span><span class="p">];</span>
<span class="w">            </span><span class="n">long</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="n">canceling</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">button</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isCancelled</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">input</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">publishing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">progress</span><span class="o">....</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fileLength</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">known</span>
<span class="w">                    </span><span class="n">publishProgress</span><span class="p">((</span><span class="nb nb-Type">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">fileLength</span><span class="p">));</span>
<span class="w">                </span><span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">toString</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">output</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span>
<span class="w">                    </span><span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span>
<span class="w">                    </span><span class="n">input</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">ignored</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connection</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span>
<span class="w">                </span><span class="n">connection</span><span class="o">.</span><span class="n">disconnect</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>

<p>The method above (<code>doInBackground</code>) runs always on a background thread. You
shouldn't do any UI tasks there. On the other hand, the <code>onProgressUpdate</code> and
<code>onPreExecute</code> run on the UI thread, so there you can change the progress bar:</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onPreExecute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onPreExecute</span><span class="p">();</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">take</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">going</span><span class="w"> </span><span class="n">off</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">presses</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">button</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">download</span>
<span class="w">        </span><span class="n">PowerManager</span><span class="w"> </span><span class="n">pm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PowerManager</span><span class="p">)</span><span class="w"> </span><span class="n">context</span><span class="o">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="o">.</span><span class="n">POWER_SERVICE</span><span class="p">);</span>
<span class="w">        </span><span class="n">mWakeLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm</span><span class="o">.</span><span class="n">newWakeLock</span><span class="p">(</span><span class="n">PowerManager</span><span class="o">.</span><span class="n">PARTIAL_WAKE_LOCK</span><span class="p">,</span>
<span class="w">             </span><span class="n">getClass</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">());</span>
<span class="w">        </span><span class="n">mWakeLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">();</span>
<span class="w">        </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onProgressUpdate</span><span class="p">(</span><span class="n">Integer</span><span class="o">...</span><span class="w"> </span><span class="n">progress</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onProgressUpdate</span><span class="p">(</span><span class="n">progress</span><span class="p">);</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">here</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">known</span><span class="p">,</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">indeterminate</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="bp">false</span>
<span class="w">        </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setIndeterminate</span><span class="p">(</span><span class="bp">false</span><span class="p">);</span>
<span class="w">        </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setMax</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="n">progress</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onPostExecute</span><span class="p">(</span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mWakeLock</span><span class="o">.</span><span class="n">release</span><span class="p">();</span>
<span class="w">        </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">dismiss</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span>
<span class="w">            </span><span class="n">Toast</span><span class="o">.</span><span class="n">makeText</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="s2">"Download error: "</span><span class="o">+</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">Toast</span><span class="o">.</span><span class="n">LENGTH_LONG</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">Toast</span><span class="o">.</span><span class="n">makeText</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="s2">"File downloaded"</span><span class="p">,</span><span class="w"> </span><span class="n">Toast</span><span class="o">.</span><span class="n">LENGTH_SHORT</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>For this to run, you need the WAKE_LOCK permission.</p>
<div class="code"><pre class="code literal-block">&lt;uses-permission android:name="android.permission.WAKE_LOCK" /&gt;
</pre></div>

<ol>
<li>Download from Service ========================</li>
</ol>
<p>The big question here is: <em>how do I update my activity from a service?</em>. In
the next example we are going to use two classes you may not be aware of:
<code>ResultReceiver</code> and <code>IntentService</code>. <code>ResultReceiver</code> is the one that will
allow us to update our thread from a service; <code>IntentService</code> is a subclass of
<code>Service</code> which spawns a thread to do background work from there (you should
know that a <code>Service</code> runs actually in the same thread of your app; when you
extends <code>Service</code>, you must manually spawn new threads to run CPU blocking
operations).</p>
<p>Download service can look like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">DownloadService</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">IntentService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">UPDATE_PROGRESS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8344</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">DownloadService</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="s2">"DownloadService"</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onHandleIntent</span><span class="p">(</span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">urlToDownload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">intent</span><span class="o">.</span><span class="n">getStringExtra</span><span class="p">(</span><span class="s2">"url"</span><span class="p">);</span>
<span class="w">        </span><span class="n">ResultReceiver</span><span class="w"> </span><span class="n">receiver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ResultReceiver</span><span class="p">)</span><span class="w"> </span><span class="n">intent</span><span class="o">.</span><span class="n">getParcelableExtra</span><span class="p">(</span><span class="s2">"receiver"</span><span class="p">);</span>
<span class="w">        </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="o">//</span><span class="n">create</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">connect</span>
<span class="w">            </span><span class="n">URL</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">urlToDownload</span><span class="p">);</span>
<span class="w">            </span><span class="n">URLConnection</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="o">.</span><span class="n">openConnection</span><span class="p">();</span>
<span class="w">            </span><span class="n">connection</span><span class="o">.</span><span class="n">connect</span><span class="p">();</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">typical</span><span class="w"> </span><span class="mi">0</span><span class="o">-</span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="n">progress</span><span class="w"> </span><span class="n">bar</span>
<span class="w">            </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">fileLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="o">.</span><span class="n">getContentLength</span><span class="p">();</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span>
<span class="w">            </span><span class="n">InputStream</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">BufferedInputStream</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">());</span>

<span class="w">            </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/sdcard/BarcodeScanner-debug.apk"</span><span class="w"> </span><span class="p">;</span>
<span class="w">            </span><span class="n">OutputStream</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>

<span class="w">            </span><span class="n">byte</span><span class="w"> </span><span class="n">data</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">byte</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
<span class="w">            </span><span class="n">long</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>

<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">publishing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">progress</span><span class="o">....</span>
<span class="w">                </span><span class="n">Bundle</span><span class="w"> </span><span class="n">resultData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Bundle</span><span class="p">();</span>
<span class="w">                </span><span class="n">resultData</span><span class="o">.</span><span class="n">putInt</span><span class="p">(</span><span class="s2">"progress"</span><span class="w"> </span><span class="p">,(</span><span class="nb nb-Type">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">fileLength</span><span class="p">));</span>
<span class="w">                </span><span class="n">receiver</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">UPDATE_PROGRESS</span><span class="p">,</span><span class="w"> </span><span class="n">resultData</span><span class="p">);</span>
<span class="w">                </span><span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">close</span><span class="w"> </span><span class="n">streams</span><span class="w"> </span>
<span class="w">            </span><span class="n">output</span><span class="o">.</span><span class="n">flush</span><span class="p">();</span>
<span class="w">            </span><span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">            </span><span class="n">input</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="o">.</span><span class="n">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">Bundle</span><span class="w"> </span><span class="n">resultData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Bundle</span><span class="p">();</span>
<span class="w">        </span><span class="n">resultData</span><span class="o">.</span><span class="n">putInt</span><span class="p">(</span><span class="s2">"progress"</span><span class="w"> </span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>

<span class="w">        </span><span class="n">receiver</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">UPDATE_PROGRESS</span><span class="p">,</span><span class="w"> </span><span class="n">resultData</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Add the service to your manifest:</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">service</span><span class="w"> </span><span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="o">=</span><span class="s2">".DownloadService"</span><span class="o">/&gt;</span>
</pre></div>

<p>And the activity will look like this:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">initialize</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">progress</span><span class="w"> </span><span class="n">dialog</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">example</span>

<span class="o">//</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">fire</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">downloader</span>
<span class="n">mProgressDialog</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">DownloadService</span><span class="o">.</span><span class="k">class</span><span class="p">);</span>
<span class="n">intent</span><span class="o">.</span><span class="n">putExtra</span><span class="p">(</span><span class="s2">"url"</span><span class="p">,</span><span class="w"> </span><span class="s2">"url of the file to download"</span><span class="p">);</span>
<span class="n">intent</span><span class="o">.</span><span class="n">putExtra</span><span class="p">(</span><span class="s2">"receiver"</span><span class="p">,</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DownloadReceiver</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Handler</span><span class="p">()));</span>
<span class="n">startService</span><span class="p">(</span><span class="n">intent</span><span class="p">);</span>
</pre></div>

<p>Here is were <code>ResultReceiver</code> comes to play:</p>
<div class="code"><pre class="code literal-block"><span class="n">private</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">DownloadReceiver</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">ResultReceiver</span><span class="p">{</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">DownloadReceiver</span><span class="p">(</span><span class="n">Handler</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="n">handler</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onReceiveResult</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">resultData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onReceiveResult</span><span class="p">(</span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="n">resultData</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resultCode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DownloadService</span><span class="o">.</span><span class="n">UPDATE_PROGRESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">progress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resultData</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="s2">"progress"</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">progress</span>
<span class="w">            </span><span class="n">dialog</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="n">progress</span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">progress</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">dialog</span><span class="o">.</span><span class="n">dismiss</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3>2.1 Use Groundy library</h3>
<p><strong>Groundy</strong> is a library that basically helps you run pieces of code in a
background service, and it is based on the <code>ResultReceiver</code> concept shown
above. This library is <strong>deprecated</strong> at the moment. This is how the <strong>whole</strong>
code would look like:</p>
<p>The activity where you are showing the dialog...</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">MainActivity</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">ProgressDialog</span><span class="w"> </span><span class="n">mProgressDialog</span><span class="p">;</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">main</span><span class="p">);</span>

<span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">btn_download</span><span class="p">)</span><span class="o">.</span><span class="n">setOnClickListener</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">View</span><span class="o">.</span><span class="n">OnClickListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">view</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">EditText</span><span class="p">)</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">edit_url</span><span class="p">))</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span><span class="o">.</span><span class="n">trim</span><span class="p">();</span>
<span class="w">                </span><span class="n">Bundle</span><span class="w"> </span><span class="n">extras</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Bundler</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DownloadTask</span><span class="o">.</span><span class="n">PARAM_URL</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">();</span>
<span class="w">                </span><span class="n">Groundy</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">DownloadExample</span><span class="o">.</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">DownloadTask</span><span class="o">.</span><span class="k">class</span><span class="p">)</span>
<span class="w">                        </span><span class="o">.</span><span class="n">receiver</span><span class="p">(</span><span class="n">mReceiver</span><span class="p">)</span>
<span class="w">                        </span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="n">extras</span><span class="p">)</span>
<span class="w">                        </span><span class="o">.</span><span class="n">queue</span><span class="p">();</span>

<span class="w">                </span><span class="n">mProgressDialog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ProgressDialog</span><span class="p">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="n">this</span><span class="p">);</span>
<span class="w">                </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setProgressStyle</span><span class="p">(</span><span class="n">ProgressDialog</span><span class="o">.</span><span class="n">STYLE_HORIZONTAL</span><span class="p">);</span>
<span class="w">                </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setCancelable</span><span class="p">(</span><span class="bp">false</span><span class="p">);</span>
<span class="w">                </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">ResultReceiver</span><span class="w"> </span><span class="n">mReceiver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ResultReceiver</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Handler</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onReceiveResult</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">resultData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">super</span><span class="o">.</span><span class="n">onReceiveResult</span><span class="p">(</span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="n">resultData</span><span class="p">);</span>
<span class="w">            </span><span class="n">switch</span><span class="w"> </span><span class="p">(</span><span class="n">resultCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">case</span><span class="w"> </span><span class="n">Groundy</span><span class="o">.</span><span class="n">STATUS_PROGRESS</span><span class="p">:</span>
<span class="w">                    </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="n">resultData</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="n">Groundy</span><span class="o">.</span><span class="n">KEY_PROGRESS</span><span class="p">));</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="n">case</span><span class="w"> </span><span class="n">Groundy</span><span class="o">.</span><span class="n">STATUS_FINISHED</span><span class="p">:</span>
<span class="w">                    </span><span class="n">Toast</span><span class="o">.</span><span class="n">makeText</span><span class="p">(</span><span class="n">DownloadExample</span><span class="o">.</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">file_downloaded</span><span class="p">,</span><span class="w"> </span><span class="n">Toast</span><span class="o">.</span><span class="n">LENGTH_LONG</span><span class="p">);</span>
<span class="w">                    </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">dismiss</span><span class="p">();</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="n">case</span><span class="w"> </span><span class="n">Groundy</span><span class="o">.</span><span class="n">STATUS_ERROR</span><span class="p">:</span>
<span class="w">                    </span><span class="n">Toast</span><span class="o">.</span><span class="n">makeText</span><span class="p">(</span><span class="n">DownloadExample</span><span class="o">.</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">resultData</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">Groundy</span><span class="o">.</span><span class="n">KEY_ERROR</span><span class="p">),</span><span class="w"> </span><span class="n">Toast</span><span class="o">.</span><span class="n">LENGTH_LONG</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="w">                    </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">dismiss</span><span class="p">();</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>
</pre></div>

<p>A <code>GroundyTask</code> implementation used by <strong>Groundy</strong> to download the file and
show the progress:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">DownloadTask</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">GroundyTask</span><span class="w"> </span><span class="p">{</span><span class="w">    </span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">PARAM_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"com.groundy.sample.param.url"</span><span class="p">;</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">doInBackground</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getParameters</span><span class="p">()</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">PARAM_URL</span><span class="p">);</span>
<span class="w">            </span><span class="n">File</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">getContext</span><span class="p">()</span><span class="o">.</span><span class="n">getFilesDir</span><span class="p">(),</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">getName</span><span class="p">());</span>
<span class="w">            </span><span class="n">DownloadUtils</span><span class="o">.</span><span class="n">downloadFile</span><span class="p">(</span><span class="n">getContext</span><span class="p">(),</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="n">DownloadUtils</span><span class="o">.</span><span class="n">getDownloadListenerForTask</span><span class="p">(</span><span class="n">this</span><span class="p">));</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">pokemon</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>And just add this to the manifest:</p>
<div class="code"><pre class="code literal-block">&lt;service android:name="com.codeslap.groundy.GroundyService"/&gt;
</pre></div>

<p>It couldn't be easier I think. Just grab the latest jar from Github and you
are ready to go. Keep in mind that <strong>Groundy</strong> 's main purpose is to make
calls to external REST apis in a background service and post results to the UI
with easily. If you are doing something like that in your app, it could be
really useful.</p>
<h3>2.2 Use https://github.com/koush/ion</h3>
<ol>
<li>Use <code>DownloadManager</code> class (<code>GingerBread</code> and newer only) =============================================================</li>
</ol>
<p>GingerBread brought a new feature, <code>DownloadManager</code>, which allows you to
download files easily and delegate the hard work of handling threads, streams,
etc. to the system.</p>
<p>First, let's see a utility method:</p>
<div class="code"><pre class="code literal-block"><span class="o">/**</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="n">param</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">DownloadManager</span><span class="w"> </span><span class="n">information</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="k">return</span><span class="w"> </span><span class="bp">true</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">available</span>
<span class="w"> </span><span class="o">*/</span>
<span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">isDownloadManagerAvailable</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Build</span><span class="o">.</span><span class="n">VERSION</span><span class="o">.</span><span class="n">SDK_INT</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">Build</span><span class="o">.</span><span class="n">VERSION_CODES</span><span class="o">.</span><span class="n">GINGERBREAD</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Method's name explains it all. Once you are sure <code>DownloadManager</code> is
available, you can do something like this:</p>
<div class="code"><pre class="code literal-block"><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"url you want to download"</span><span class="p">;</span>
<span class="n">DownloadManager</span><span class="o">.</span><span class="n">Request</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DownloadManager</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">Uri</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">url</span><span class="p">));</span>
<span class="n">request</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s2">"Some descrition"</span><span class="p">);</span>
<span class="n">request</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">"Some title"</span><span class="p">);</span>
<span class="o">//</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">android</span><span class="w"> </span><span class="mf">3.2</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">app</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Build</span><span class="o">.</span><span class="n">VERSION</span><span class="o">.</span><span class="n">SDK_INT</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">Build</span><span class="o">.</span><span class="n">VERSION_CODES</span><span class="o">.</span><span class="n">HONEYCOMB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">request</span><span class="o">.</span><span class="n">allowScanningByMediaScanner</span><span class="p">();</span>
<span class="w">    </span><span class="n">request</span><span class="o">.</span><span class="n">setNotificationVisibility</span><span class="p">(</span><span class="n">DownloadManager</span><span class="o">.</span><span class="n">Request</span><span class="o">.</span><span class="n">VISIBILITY_VISIBLE_NOTIFY_COMPLETED</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">request</span><span class="o">.</span><span class="n">setDestinationInExternalPublicDir</span><span class="p">(</span><span class="n">Environment</span><span class="o">.</span><span class="n">DIRECTORY_DOWNLOADS</span><span class="p">,</span><span class="w"> </span><span class="s2">"name-of-the-file.ext"</span><span class="p">);</span>

<span class="o">//</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">enqueue</span><span class="w"> </span><span class="n">file</span>
<span class="n">DownloadManager</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DownloadManager</span><span class="p">)</span><span class="w"> </span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="o">.</span><span class="n">DOWNLOAD_SERVICE</span><span class="p">);</span>
<span class="n">manager</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
</pre></div>

<p>Download progress will be showing in the notification bar.</p>
<h2>Final thoughts</h2>
<p>First and second methods are just the tip of the iceberg. There are lots of
things you have to keep in mind if you want your app to be robust. Here is a
brief list:</p>
<ul>
<li>You must check whether user has an internet connection available</li>
<li>Make sure you have the right permissions (<code>INTERNET</code> and <code>WRITE_EXTERNAL_STORAGE</code>); also <code>ACCESS_NETWORK_STATE</code> if you want to check internet availability.</li>
<li>Make sure the directory were you are going to download files exist and has write permissions.</li>
<li>If download is too big you may want to implement a way to resume the download if previous attempts failed.</li>
<li>Users will be grateful if you allow them to interrupt the download.</li>
</ul>
<p>Unless you need detailed control of the download process, then consider using
<code>DownloadManager</code> (3) because it already handles most of the items listed
above.</p>
<p>But also consider that your needs may change. For example, <code>DownloadManager</code>
does no response caching. It will blindly download the same big file multiple
times. There's no easy way to fix it after the fact. Where if you start with a
basic <code>HttpURLConnection</code> (1, 2), then all you need is to add an
<code>HttpResponseCache</code>. So the initial effort of learning the basic, standard
tools can be a good investment.</p>
<blockquote>
<p>This class was deprecated in API level 26. ProgressDialog is a modal dialog,
which prevents the user from interacting with the app. Instead of using this
class, you should use a progress indicator like ProgressBar, which can be
embedded in your app's UI. Alternatively, you can use a notification to
inform the user of the task's progress. For more details Link</p>
</blockquote>
<p><br></p>
<h3>Suggest</h3>
<p>Don't forget to add permissions to your manifest file if you're gonna be
downloading stuff from the internet!</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;manifest</span><span class="w"> </span><span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
<span class="w">    </span><span class="na">package=</span><span class="s">"com.example.helloandroid"</span>
<span class="w">    </span><span class="na">android:versionCode=</span><span class="s">"1"</span>
<span class="w">    </span><span class="na">android:versionName=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>

<span class="w">        </span><span class="nt">&lt;uses-sdk</span><span class="w"> </span><span class="na">android:minSdkVersion=</span><span class="s">"10"</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">        </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.permission.WRITE_EXTERNAL_STORAGE"</span><span class="nt">&gt;&lt;/uses-permission&gt;</span>
<span class="w">        </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.permission.INTERNET"</span><span class="nt">&gt;&lt;/uses-permission&gt;</span>
<span class="w">        </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.permission.ACCESS_NETWORK_STATE"</span><span class="nt">&gt;&lt;/uses-permission&gt;</span>
<span class="w">        </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.permission.READ_PHONE_STATE"</span><span class="nt">&gt;&lt;/uses-permission&gt;</span>

<span class="w">        </span><span class="nt">&lt;application</span><span class="w"> </span>
<span class="w">            </span><span class="na">android:icon=</span><span class="s">"@drawable/icon"</span><span class="w"> </span>
<span class="w">            </span><span class="na">android:label=</span><span class="s">"@string/app_name"</span><span class="w"> </span>
<span class="w">            </span><span class="na">android:debuggable=</span><span class="s">"true"</span><span class="nt">&gt;</span>

<span class="w">        </span><span class="nt">&lt;/application&gt;</span>

<span class="nt">&lt;/manifest&gt;</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-390.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-388.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
