<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 360) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-360.html">
<link rel="prev" href="index-361.html" type="text/html">
<link rel="next" href="index-359.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/android-zhi-you-chuang-jian-shi-tu-ceng-ci-jie-gou-de-yuan-shi-xian-cheng-cai-neng-hong-ji-ta-de-shi-tu/" class="u-url">Android“只有创建视图层次结构的原始线程才能触及它的视图。”</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/android-zhi-you-chuang-jian-shi-tu-ceng-ci-jie-gou-de-yuan-shi-xian-cheng-cai-neng-hong-ji-ta-de-shi-tu/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T04:57:51+08:00" itemprop="datePublished" title="2023-02-17 04:57">2023-02-17 04:57</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我在 Android 中构建了一个简单的音乐播放器。每首歌曲的视图都包含一个 SeekBar，实现方式如下：</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">Song</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="n">OnClickListener</span><span class="p">,</span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">SeekBar</span><span class="w"> </span><span class="n">progress</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">MediaPlayer</span><span class="w"> </span><span class="n">mp</span><span class="p">;</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">ServiceConnection</span><span class="w"> </span><span class="n">onService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ServiceConnection</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onServiceConnected</span><span class="p">(</span><span class="n">ComponentName</span><span class="w"> </span><span class="n">className</span><span class="p">,</span>
<span class="w">            </span><span class="n">IBinder</span><span class="w"> </span><span class="n">rawBinder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">appService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">MPService</span><span class="o">.</span><span class="n">LocalBinder</span><span class="p">)</span><span class="n">rawBinder</span><span class="p">)</span><span class="o">.</span><span class="n">getService</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">handles</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">MediaPlayer</span>
<span class="w">              </span><span class="n">progress</span><span class="o">.</span><span class="n">setVisibility</span><span class="p">(</span><span class="n">SeekBar</span><span class="o">.</span><span class="n">VISIBLE</span><span class="p">);</span>
<span class="w">              </span><span class="n">progress</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">              </span><span class="n">mp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appService</span><span class="o">.</span><span class="n">getMP</span><span class="p">();</span>
<span class="w">              </span><span class="n">appService</span><span class="o">.</span><span class="n">playSong</span><span class="p">(</span><span class="n">title</span><span class="p">);</span>
<span class="w">              </span><span class="n">progress</span><span class="o">.</span><span class="n">setMax</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">getDuration</span><span class="p">());</span>
<span class="w">              </span><span class="n">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">Song</span><span class="o">.</span><span class="n">this</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">();</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">          </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onServiceDisconnected</span><span class="p">(</span><span class="n">ComponentName</span><span class="w"> </span><span class="n">classname</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">appService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">song</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>

<span class="w">        </span><span class="n">progress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SeekBar</span><span class="p">)</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">progress</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mp</span><span class="o">.</span><span class="n">getDuration</span><span class="p">();</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">mp</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pos</span><span class="o">&lt;</span><span class="n">total</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="w">            </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appService</span><span class="o">.</span><span class="n">getSongPosition</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">progress</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>这很好用。现在我想要一个计时器来计算歌曲进度的秒/分钟。所以我把 a
放在<code>TextView</code>布局中，用<code>findViewById()</code>in获取它<code>onCreate()</code>，然后把它放在<code>run()</code>after
中<code>progress.setProgress(pos)</code>：</p>
<div class="code"><pre class="code literal-block"><span class="nt">String</span><span class="w"> </span><span class="nt">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">String</span><span class="p">.</span><span class="nc">format</span><span class="o">(</span><span class="s2">"%d:%d"</span><span class="o">,</span>
<span class="w">            </span><span class="nt">TimeUnit</span><span class="p">.</span><span class="nc">MILLISECONDS</span><span class="p">.</span><span class="nc">toMinutes</span><span class="o">(</span><span class="nt">pos</span><span class="o">),</span>
<span class="w">            </span><span class="nt">TimeUnit</span><span class="p">.</span><span class="nc">MILLISECONDS</span><span class="p">.</span><span class="nc">toSeconds</span><span class="o">(</span><span class="nt">pos</span><span class="o">),</span>
<span class="w">            </span><span class="nt">TimeUnit</span><span class="p">.</span><span class="nc">MINUTES</span><span class="p">.</span><span class="nc">toSeconds</span><span class="o">(</span><span class="nt">TimeUnit</span><span class="p">.</span><span class="nc">MILLISECONDS</span><span class="p">.</span><span class="nc">toMinutes</span><span class="o">(</span>
<span class="w">                    </span><span class="nt">pos</span><span class="o">))</span>
<span class="w">            </span><span class="o">);</span>
<span class="nt">currentTime</span><span class="p">.</span><span class="nc">setText</span><span class="o">(</span><span class="nt">time</span><span class="o">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nt">currentTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="nt">TextView</span><span class="o">)</span><span class="w"> </span><span class="nt">findViewById</span><span class="o">(</span><span class="nt">R</span><span class="p">.</span><span class="nc">id</span><span class="p">.</span><span class="nc">current_time</span><span class="o">);</span>
</pre></div>

<p>但最后一行给了我例外：</p>
<blockquote>
<p>android.view.ViewRoot$CalledFromWrongThreadException：只有创建视图层次结构的原始线程才能接触其视图。</p>
</blockquote>
<p>然而，我在这里做的事情与我在做的事情基本相同<code>SeekBar</code>——在
中创建视图<code>onCreate</code>，然后在其中触摸它<code>run()</code>——它并没有给我这个抱怨。</p>
<p><br><br></p>
<h2>解答</h2>
<p>您必须将更新 UI 的后台任务部分移动到主线程上。为此有一段简单的代码：</p>
<div class="code"><pre class="code literal-block"><span class="n">runOnUiThread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">run</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="nf">Stuff</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">updates</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">UI</span>

<span class="w">    </span><span class="err">}</span>
<span class="err">}</span><span class="p">);</span>
</pre></div>

<p>的文档<code>Activity.runOnUiThread</code>。</p>
<p>只需将其嵌套在后台运行的方法中，然后复制粘贴在块中间实现任何更新的代码。只包含尽可能少的代码，否则你就开始破坏后台线程的目的。</p>
<p><br></p>
<h3>更多建议</h3>
<p>我通过放入解决了这个<code>runOnUiThread( new Runnable(){ ..</code>问题<code>run()</code>：</p>
<div class="code"><pre class="code literal-block"><span class="n">thread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(){</span>
<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">wait</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>

<span class="w">                    </span><span class="n">runOnUiThread</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">                        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                            </span><span class="n">dbloadingInfo</span><span class="o">.</span><span class="n">setVisibility</span><span class="p">(</span><span class="n">View</span><span class="o">.</span><span class="n">VISIBLE</span><span class="p">);</span>
<span class="w">                            </span><span class="n">bar</span><span class="o">.</span><span class="n">setVisibility</span><span class="p">(</span><span class="n">View</span><span class="o">.</span><span class="n">INVISIBLE</span><span class="p">);</span>
<span class="w">                            </span><span class="n">loadingText</span><span class="o">.</span><span class="n">setVisibility</span><span class="p">(</span><span class="n">View</span><span class="o">.</span><span class="n">INVISIBLE</span><span class="p">);</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">});</span>

<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">e</span><span class="o">.</span><span class="n">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">Intent</span><span class="w"> </span><span class="n">mainActivity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">getApplicationContext</span><span class="p">(),</span><span class="n">MainActivity</span><span class="o">.</span><span class="k">class</span><span class="p">);</span>
<span class="w">            </span><span class="n">startActivity</span><span class="p">(</span><span class="n">mainActivity</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">};</span><span class="w">  </span>
<span class="w">    </span><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">();</span>
</pre></div>

<p><br><br><a href="posts/android-only-the-original-thread-that-created-a-view-hierarchy-can-touch-its-views/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/objective-c-zhong-yong-yu-lian-jie-nsstring-de-kuai-jie-fang-shi/" class="u-url">Objective-C 中用于连接 NSString 的快捷方式</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/objective-c-zhong-yong-yu-lian-jie-nsstring-de-kuai-jie-fang-shi/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T04:57:02+08:00" itemprop="datePublished" title="2023-02-17 04:57">2023-02-17 04:57</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>在 Objective-C 中是否有任何 ( )
字符串连接的快捷方式，或者一般<code>stringByAppendingString:</code>使用的快捷方式？<code>NSString</code></p>
<p>例如，我想做：</p>
<div class="code"><pre class="code literal-block"><span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">myString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@"This"</span><span class="p">;</span>
<span class="bp">NSString</span><span class="w"> </span><span class="o">*</span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">myString</span><span class="w"> </span><span class="n">stringByAppendingString</span><span class="o">:</span><span class="s">@" is just a test"</span><span class="p">];</span>
</pre></div>

<p>更像是：</p>
<div class="code"><pre class="code literal-block">string myString = "This";
string test = myString + " is just a test";
</pre></div>

<p><br><br></p>
<h2>解答</h2>
<p>我能想到的两个答案……都没有一个连接运算符那么令人愉快。</p>
<p>首先，使用一个<code>NSMutableString</code>，它有一个<code>appendString</code>方法，消除了对额外临时字符串的一些需求。</p>
<p>其次，使用 an<code>NSArray</code>通过方法连接<code>componentsJoinedByString</code>。</p>
<p><br></p>
<h3>更多建议</h3>
<p>我能想到的两个答案……都没有一个连接运算符那么令人愉快。</p>
<p>首先，使用一个<code>NSMutableString</code>，它有一个<code>appendString</code>方法，消除了对额外临时字符串的一些需求。</p>
<p>其次，使用 an<code>NSArray</code>通过方法连接<code>componentsJoinedByString</code>。</p>
<p><br><br><a href="posts/shortcuts-in-objective-c-to-concatenate-nsstrings/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/shou-dong-shua-xin-huo-xie-ru-shi-react-router-url-bu-qi-zuo-yong/" class="u-url">手动刷新或写入时，React-router URL 不起作用</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/shou-dong-shua-xin-huo-xie-ru-shi-react-router-url-bu-qi-zuo-yong/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T04:56:34+08:00" itemprop="datePublished" title="2023-02-17 04:56">2023-02-17 04:56</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我正在使用 React-router，当我点击链接按钮时它工作正常，但是当我刷新我的网页时它没有加载我想要的东西。</p>
<p>例如，我在里面<code>localhost/joblist</code>，一切都很好，因为我是按链接到达这里的。但是 <em>，如果</em> 我刷新网页，我会得到：</p>
<div class="code"><pre class="code literal-block">Cannot GET /joblist
</pre></div>

<p>默认情况下，它不是这样工作的。最初我有我的 URL 并且<code>localhost/#/</code>它们<code>localhost/#/joblist</code>工作得很好。但我不喜欢这种
URL，所以试图删除它<code>#</code>，我写道：</p>
<div class="code"><pre class="code literal-block">Router.run(routes, Router.HistoryLocation, function (Handler) {
 React.render(&lt;Handler/&gt;, document.body);
});
</pre></div>

<p>这个问题不会发生<code>localhost/</code>，这个总是返回我想要的。</p>
<p>这个应用程序是单页的，所以<code>/joblist</code>不需要向任何服务器请求任何东西。</p>
<p>我的整个路由器。</p>
<div class="code"><pre class="code literal-block">var<span class="w"> </span>routes<span class="w"> </span>=<span class="w"> </span>(
<span class="w">    </span><span class="nt">&lt;Route</span><span class="w"> </span><span class="na">name=</span><span class="s">"app"</span><span class="w"> </span><span class="na">path=</span><span class="s">"/"</span><span class="w"> </span><span class="na">handler=</span><span class="s">{App}</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;Route</span><span class="w"> </span><span class="na">name=</span><span class="s">"joblist"</span><span class="w"> </span><span class="na">path=</span><span class="s">"/joblist"</span><span class="w"> </span><span class="na">handler=</span><span class="s">{JobList}/</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;DefaultRoute</span><span class="w"> </span><span class="na">handler=</span><span class="s">{Dashboard}/</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;NotFoundRoute</span><span class="w"> </span><span class="na">handler=</span><span class="s">{NotFound}/</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;/Route&gt;</span>
);

Router.run(routes,<span class="w"> </span>Router.HistoryLocation,<span class="w"> </span>function<span class="w"> </span>(Handler)<span class="w"> </span>{
<span class="w">  </span>React.render(<span class="nt">&lt;Handler/&gt;</span>,<span class="w"> </span>document.body);
});
</pre></div>

<p><br><br></p>
<h2>解答</h2>
<h4>服务器端与客户端</h4>
<p>关于这一点，首先要了解的是，现在有 2 个地方可以解释
URL，而在“过去”只有一个地方。过去，生活很简单，一些用户向<code>http://example.com/about</code>服务器发送请求，服务器检查 URL
的路径部分，确定用户请求的是关于页面，然后发回该页面。</p>
<p>使用 React Router 提供的客户端路由，事情就不那么简单了。起初，客户端还没有加载任何 JavaScript
代码。所以第一个请求总是发给服务器。然后将返回一个页面，其中包含加载 React 和 React Router 等所需的脚本标签。只有当这些脚本加载后，阶段
2 才会开始。例如，在阶段 2 中，当用户单击“关于我们”导航链接时，URL <em>仅在本地</em> 更改为（通过History
API<code>http://example.com/about</code>实现），但 <strong>不会向服务器发出请求</strong> 。相反，React Router
在客户端做它的事情，决定渲染哪个 React 视图，然后渲染它。假设您的关于页面不需要做任何REST ****调用，它已经完成了。 您已从 <em>“主页”</em>
过渡到 <em>“关于我们”，</em> 但没有触发任何服务器请求。</p>
<p>所以基本上当你点击一个链接时，一些 JavaScript 会运行来操作地址栏中的 URL，而 <em>不会导致页面刷新</em> ，这反过来会导致 React
Router <strong>在客户端</strong> 执行页面转换。</p>
<p>但是现在考虑一下，如果您将 URL 复制粘贴到地址栏中并将其通过电子邮件发送给朋友，会发生什么情况。您的朋友尚未加载您的网站。也就是说，她还处于
<em>第一阶段</em> 。她的机器上还没有运行 React Router。所以她的浏览器会向
<strong>服务器发出请求</strong><code>http://example.com/about</code>。</p>
<p>这就是你的麻烦开始的地方。到目前为止，您只需在服务器的 webroot 中放置一个静态 HTML 即可。 <em>但是当从服务器请求时，</em> 这会给所有其他
URL带来 <em>404</em> 错误。这些相同的 URL <em>在客户端</em> 工作得很好，因为 React Router 正在为你做路由，但它们 <em>在服务器端</em>
失败，除非你让你的服务器理解它们。 <strong> </strong> __</p>
<h4>结合服务器端和客户端路由</h4>
<p>如果您希望<code>http://example.com/about</code>URL 在服务器端和客户端都有效，则需要在服务器端和客户端为其设置路由。这是有道理的，对吧？</p>
<p>这就是您开始选择的地方。解决方案的范围从通过返回引导 HTML 的包罗万象的路由完全绕过这个问题，到服务器和客户端运行相同的 JavaScript
代码的完全同构方法。</p>
<h3>完全绕过问题：哈希历史</h3>
<p>使用Hash History而不是Browser History，关于页面的 URL 将如下所示：<code>http://example.com/#/about</code></p>
<p>井号 ( ) 符号后的部分<code>#</code>不会发送到服务器。所以服务器只能<code>http://example.com/</code>按预期查看和发送索引页面。React Router
将拾取该<code>#/about</code>部分并显示正确的页面。</p>
<p><strong>缺点</strong> ：</p>
<ul>
<li>“丑陋”的网址</li>
<li>使用这种方法无法进行服务器端渲染。就搜索引擎优化(SEO) 而言，您的网站由一个页面组成，上面几乎没有任何内容。</li>
</ul>
<h3>包罗万象</h3>
<p><code>/*</code>通过这种方法，您确实可以使用浏览器历史记录，但只需在发送到
的服务器上设置一个包罗万象的内容<code>index.html</code>，就可以有效地为您提供与哈希历史记录大致相同的情况。然而，您确实拥有干净的
URL，您可以稍后改进此方案，而不必使所有用户的收藏夹无效。</p>
<p><strong>缺点</strong> ：</p>
<ul>
<li>设置更复杂</li>
<li>仍然没有好的SEO</li>
</ul>
<h3>杂交种</h3>
<p>在混合方法中，您通过为特定路由添加特定脚本来扩展包罗万象的场景。您可以制作一些简单的 PHP 脚本来返回您网站中最重要的页面以及包含的内容，这样
Googlebot 至少可以看到您页面上的内容。</p>
<p><strong>缺点</strong> ：</p>
<ul>
<li>设置起来更复杂</li>
<li>只有那些你给予特殊待遇的路线才有好的搜索引擎优化</li>
<li>复制用于在服务器和客户端上呈现内容的代码</li>
</ul>
<h3>同构</h3>
<p>如果我们使用Node.js作为我们的服务器，那么我们可以在两端运行 <em>相同的JavaScript 代码会怎么样？</em> 现在，我们在单个 react-
router
配置中定义了所有路由，我们不需要复制渲染代码。这可以说是“圣杯”。服务器发送的标记与我们在客户端发生页面转换时最终得到的标记完全相同。该解决方案在 SEO
方面是最佳的。</p>
<p><strong>缺点</strong> ：</p>
<ul>
<li>服务器 <em>必须</em> （能够）运行 JavaScript。我已经尝试将 Java 与Nashorn结合使用，但它对我不起作用。实际上，这主要意味着您必须使用基于 Node.js 的服务器。</li>
<li>许多棘手的环境问题（<code>window</code>在服务器端使用等）</li>
<li>陡峭的学习曲线</li>
</ul>
<h4>我应该使用哪个？</h4>
<p>选择一个你可以逃脱的。就个人而言，我认为万能的设置很简单，所以这是我的最低要求。此设置允许您随着时间的推移改进事情。如果您已经在使用 Node.js
作为您的服务器平台，我肯定会研究做一个同构应用程序。是的，一开始很难，但一旦你掌握了它，它实际上是一个非常优雅的问题解决方案。</p>
<p>所以基本上，对我来说，这将是决定性因素。如果我的服务器运行在 Node.js 上，我会去同构；否则，我会选择 Catch-all
解决方案，并随着时间的推移和 SEO 要求对其进行扩展（混合解决方案）。</p>
<p>如果你想了解更多关于 React 的同构（也称为“通用”）渲染，有一些关于这个主题的很好的教程：</p>
<ul>
<li>使用同构应用程序应对未来</li>
<li>在 ReactJS 中创建同构应用程序的痛苦和喜悦</li>
<li>如何实现 Node + React 同构 JavaScript 及其重要性</li>
</ul>
<p>此外，为了让您入门，我建议您查看一些入门工具包。选择一个与您对技术堆栈的选择相匹配的（请记住，React 只是MVC中的 V
，您需要更多的东西来构建完整的应用程序）。先看看 Facebook 自己发布的那篇：</p>
<ul>
<li>创建 React 应用程序</li>
</ul>
<p>或者从社区中选择一个。现在有一个不错的网站试图为所有这些网站编制索引：</p>
<ul>
<li>选择你完美的 React 入门项目</li>
</ul>
<p>我从这些开始：</p>
<ul>
<li>React 同构入门套件</li>
<li>React Redux 通用热示例</li>
</ul>
<p>目前，我正在使用受上述两个入门套件启发的自制版本的通用渲染，但它们现在已经过时了。</p>
<p>祝你好运！</p>
<p><br></p>
<h3>更多建议</h3>
<p>如果您使用 Apache 作为您的 Web 服务器，您可以将其插入到您的<code>.htaccess</code>文件中：</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">IfModule</span><span class="w"> </span><span class="n">mod_rewrite</span><span class="p">.</span><span class="n">c</span><span class="o">&gt;</span>
<span class="w">  </span><span class="n">RewriteEngine</span><span class="w"> </span><span class="k">On</span>
<span class="w">  </span><span class="n">RewriteBase</span><span class="w"> </span><span class="o">/</span>
<span class="w">  </span><span class="n">RewriteRule</span><span class="w"> </span><span class="o">^</span><span class="k">index</span><span class="err">\</span><span class="p">.</span><span class="n">html</span><span class="err">$</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">[</span><span class="n">L</span><span class="o">]</span>
<span class="w">  </span><span class="n">RewriteCond</span><span class="w"> </span><span class="o">%</span><span class="err">{</span><span class="n">REQUEST_FILENAME</span><span class="err">}</span><span class="w"> </span><span class="err">!</span><span class="o">-</span><span class="n">f</span>
<span class="w">  </span><span class="n">RewriteCond</span><span class="w"> </span><span class="o">%</span><span class="err">{</span><span class="n">REQUEST_FILENAME</span><span class="err">}</span><span class="w"> </span><span class="err">!</span><span class="o">-</span><span class="n">d</span>
<span class="w">  </span><span class="n">RewriteCond</span><span class="w"> </span><span class="o">%</span><span class="err">{</span><span class="n">REQUEST_FILENAME</span><span class="err">}</span><span class="w"> </span><span class="err">!</span><span class="o">-</span><span class="n">l</span>
<span class="w">  </span><span class="n">RewriteRule</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="o">/</span><span class="k">index</span><span class="p">.</span><span class="n">html</span><span class="w"> </span><span class="o">[</span><span class="n">L</span><span class="o">]</span>
<span class="o">&lt;/</span><span class="n">IfModule</span><span class="o">&gt;</span>
</pre></div>

<p>我正在使用<code>react: "^16.12.0"</code>并且<code>react-router: "^5.1.2"</code>此方法是万能的，可能是让您入门的最简单方法。</p>
<p><br><br><a href="posts/react-router-urls-don-t-work-when-refreshing-or-writing-manually/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-361.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-359.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
