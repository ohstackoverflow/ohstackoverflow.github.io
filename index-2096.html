<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2096) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2096.html">
<link rel="prev" href="index-2097.html" type="text/html">
<link rel="next" href="index-2095.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-use-a-priorityqueue/" class="u-url">How do I use a PriorityQueue?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-use-a-priorityqueue/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T16:49:42+08:00" itemprop="datePublished" title="2023-03-03 16:49">2023-03-03 16:49</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I get a <code>PriorityQueue</code> to sort on what I want it to sort on?</p>
<p>Also, is there a difference between the <code>offer</code> and <code>add</code> methods?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Use the constructor overload which takes a <code>Comparator&lt;? super E&gt; comparator</code>
and pass in a comparator which compares in the appropriate way for your sort
order. If you give an example of how you want to sort, we can provide some
sample code to implement the comparator if you're not sure. (It's pretty
straightforward though.)</p>
<p>As has been said elsewhere: <code>offer</code> and <code>add</code> are just different interface
method implementations. In the JDK source I've got, <code>add</code> calls <code>offer</code>.
Although <code>add</code> and <code>offer</code> have <em>potentially</em> different behaviour in general
due to the ability for <code>offer</code> to indicate that the value can't be added due
to size limitations, this difference is irrelevant in <code>PriorityQueue</code> which is
unbounded.</p>
<p>Here's an example of a priority queue sorting by string length:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span> <span class="n">Test</span><span class="o">.</span><span class="n">java</span>
<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.PriorityQueue</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">Test</span> <span class="p">{</span>
    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">comparator</span> <span class="o">=</span> <span class="n">new</span> <span class="n">StringLengthComparator</span><span class="p">();</span>
        <span class="n">PriorityQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PriorityQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">comparator</span><span class="p">);</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">"short"</span><span class="p">);</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">"very long indeed"</span><span class="p">);</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">"medium"</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">remove</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">StringLengthComparator</span><span class="o">.</span><span class="n">java</span>
<span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">StringLengthComparator</span> <span class="n">implements</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="nb">int</span> <span class="n">compare</span><span class="p">(</span><span class="n">String</span> <span class="n">x</span><span class="p">,</span> <span class="n">String</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Assume</span> <span class="n">neither</span> <span class="n">string</span> <span class="ow">is</span> <span class="n">null</span><span class="o">.</span> <span class="n">Real</span> <span class="n">code</span> <span class="n">should</span>
        <span class="o">//</span> <span class="n">probably</span> <span class="n">be</span> <span class="n">more</span> <span class="n">robust</span>
        <span class="o">//</span> <span class="n">You</span> <span class="n">could</span> <span class="n">also</span> <span class="n">just</span> <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">length</span><span class="p">(),</span>
        <span class="o">//</span> <span class="n">which</span> <span class="n">would</span> <span class="n">be</span> <span class="n">more</span> <span class="n">efficient</span><span class="o">.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">y</span><span class="o">.</span><span class="n">length</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">y</span><span class="o">.</span><span class="n">length</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Here is the output:</p>
<blockquote>
<p>short</p>
<p>medium</p>
<p>very long indeed</p>
</blockquote>
<p><br></p>
<h3>Suggest</h3>
<h3>Java 8 solution</h3>
<p>We can use <code>lambda expression</code> or <code>method reference</code> introduced in Java 8. In
case we have some String values stored in the Priority Queue (having capacity
5) we can provide inline comparator (based on length of String) :</p>
<p><strong>Using lambda expression</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">PriorityQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pq</span><span class="o">=</span>
<span class="w">                    </span><span class="n">new</span><span class="w"> </span><span class="n">PriorityQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span><span class="p">,(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="nf">length</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="nf">length</span><span class="p">());</span>
</pre></div>

<p><strong>Using Method reference</strong></p>
<div class="code"><pre class="code literal-block"><span class="nt">PriorityQueue</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">pq</span><span class="o">=</span>
<span class="w">                </span><span class="nt">new</span><span class="w"> </span><span class="nt">PriorityQueue</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">&gt;(</span><span class="nt">5</span><span class="o">,</span><span class="w"> </span><span class="nt">Comparator</span><span class="p">.</span><span class="nc">comparing</span><span class="o">(</span><span class="nt">String</span><span class="p">::</span><span class="nd">length</span><span class="o">));</span>
</pre></div>

<p>Then we can use any of them as:</p>
<div class="code"><pre class="code literal-block"><span class="nt">public</span><span class="w"> </span><span class="nt">static</span><span class="w"> </span><span class="nt">void</span><span class="w"> </span><span class="nt">main</span><span class="o">(</span><span class="nt">String</span><span class="cp">[]</span><span class="w"> </span><span class="nt">args</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">PriorityQueue&lt;String&gt;</span><span class="w"> </span><span class="err">pq=</span>
<span class="w">                </span><span class="err">new</span><span class="w"> </span><span class="err">PriorityQueue&lt;String&gt;(5,</span><span class="w"> </span><span class="err">(a,b)</span><span class="w"> </span><span class="err">-&gt;</span><span class="w"> </span><span class="err">a.length()</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">b.length())</span><span class="p">;</span>
<span class="w">       </span><span class="err">//</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">pq</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">PriorityQueue&lt;String&gt;(5,</span><span class="w"> </span><span class="err">Comparator.comparing(</span><span class="n">String</span><span class="p">:</span><span class="o">:</span><span class="n">length</span><span class="p">));</span>
<span class="w">        </span><span class="err">pq.add("Apple")</span><span class="p">;</span>
<span class="w">        </span><span class="err">pq.add("PineApple")</span><span class="p">;</span>
<span class="w">        </span><span class="err">pq.add("Custard</span><span class="w"> </span><span class="err">Apple")</span><span class="p">;</span>
<span class="w">        </span><span class="err">while</span><span class="w"> </span><span class="err">(pq.size()</span><span class="w"> </span><span class="err">!=</span><span class="w"> </span><span class="err">0)</span>
<span class="w">        </span><span class="err">{</span>
<span class="w">            </span><span class="err">System.out.println(pq.remove())</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="err">}</span>
</pre></div>

<p>This will print:</p>
<div class="code"><pre class="code literal-block">Apple
PineApple
Custard Apple
</pre></div>

<p>To reverse the order (to change it to max-priority queue) simply change the
order in inline comparator or use <code>reversed</code> as:</p>
<div class="code"><pre class="code literal-block"><span class="nt">PriorityQueue</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">pq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">PriorityQueue</span><span class="o">&lt;</span><span class="nt">String</span><span class="o">&gt;(</span><span class="nt">5</span><span class="o">,</span><span class="w"> </span>
<span class="w">                             </span><span class="nt">Comparator</span><span class="p">.</span><span class="nc">comparing</span><span class="o">(</span><span class="nt">String</span><span class="p">::</span><span class="nd">length</span><span class="o">)</span><span class="p">.</span><span class="nc">reversed</span><span class="o">());</span>
</pre></div>

<p>We can also use <code>Collections.reverseOrder</code>:</p>
<div class="code"><pre class="code literal-block">PriorityQueue&lt;Integer&gt; pqInt = new PriorityQueue&lt;&gt;(10, Collections.reverseOrder());
PriorityQueue&lt;String&gt; pq = new PriorityQueue&lt;String&gt;(5, 
                Collections.reverseOrder(Comparator.comparing(String::length))
</pre></div>

<p>So we can see that <code>Collections.reverseOrder</code> is overloaded to take comparator
which can be useful for custom objects. The <code>reversed</code> actually uses
<code>Collections.reverseOrder</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nv">default</span><span class="w"> </span><span class="nv">Comparator</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">reversed</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">Collections</span>.<span class="nv">reverseOrder</span><span class="ss">(</span><span class="nv">this</span><span class="ss">)</span><span class="c1">;</span>
}
</pre></div>

<h3>offer() vs add()</h3>
<p>As per the doc</p>
<blockquote>
<p>The offer method inserts an element if possible, otherwise returning false.
This differs from the Collection.add method, which can fail to add an
element only by throwing an unchecked exception. The offer method is
designed for use when failure is a normal, rather than exceptional
occurrence, for example, in fixed-capacity (or "bounded") queues.</p>
</blockquote>
<p>When using a capacity-restricted queue, offer() is generally preferable to
add(), which can fail to insert an element only by throwing an exception. And
PriorityQueue is an unbounded priority queue based on a priority heap.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/urlencode-vs-rawurlencode/" class="u-url">urlencode vs rawurlencode?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/urlencode-vs-rawurlencode/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T16:49:17+08:00" itemprop="datePublished" title="2023-03-03 16:49">2023-03-03 16:49</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>If I want to create a URL using a variable I have two choices to encode the
string. <code>urlencode()</code> and <code>rawurlencode()</code>.</p>
<p>What exactly are the differences and which is preferred?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>It will depend on your purpose. If interoperability with other systems is
important then it seems rawurlencode is the way to go. The one exception is
legacy systems which expect the query string to follow form-encoding style of
spaces encoded as + instead of %20 (in which case you need urlencode).</p>
<p><strong>rawurlencode</strong> follows RFC 1738 prior to PHP 5.3.0 and RFC 3986 afterwards
(see http://us2.php.net/manual/en/function.rawurlencode.php)</p>
<blockquote>
<p>Returns a string in which all non-alphanumeric characters except -_.~ have
been replaced with a percent (%) sign followed by two hex digits. This is
the encoding described in » RFC 3986 for protecting literal characters from
being interpreted as special URL delimiters, and for protecting URLs from
being mangled by transmission media with character conversions (like some
email systems).</p>
</blockquote>
<p>Note on RFC 3986 vs 1738. rawurlencode prior to php 5.3 encoded the tilde
character (<code>~</code>) according to RFC 1738. As of PHP 5.3, however, rawurlencode
follows RFC 3986 which does not require encoding tilde characters.</p>
<p><strong>urlencode</strong> encodes spaces as plus signs (not as <code>%20</code> as done in
rawurlencode)(see http://us2.php.net/manual/en/function.urlencode.php)</p>
<blockquote>
<p>Returns a string in which all non-alphanumeric characters except -_. have
been replaced with a percent (%) sign followed by two hex digits and spaces
encoded as plus (+) signs. It is encoded the same way that the posted data
from a WWW form is encoded, that is the same way as in application/x-www-
form-urlencoded media type. This differs from the » RFC 3986 encoding (see
rawurlencode()) in that for historical reasons, spaces are encoded as plus
(+) signs.</p>
</blockquote>
<p>This corresponds to the definition for application/x-www-form-urlencoded in
RFC 1866.</p>
<p><strong>Additional Reading:</strong></p>
<p>You may also want to see the discussion at
http://bytes.com/groups/php/5624-urlencode-vs-rawurlencode.</p>
<p>Also, RFC 2396 is worth a look. RFC 2396 defines valid URI syntax. The main
part we're interested in is from 3.4 Query Component:</p>
<blockquote>
<p>Within a query component, the characters <code>";", "/", "?", ":", "@",  
 "&amp;", "=", "+", ",", and "$"</code> are reserved.</p>
</blockquote>
<p>As you can see, the <code>+</code> is a reserved character in the query string and thus
would need to be encoded as per RFC 3986 (as in rawurlencode).</p>
<p><br></p>
<h3>Suggest</h3>
<p>Proof is in the source code of PHP.</p>
<p>I'll take you through a quick process of how to find out this sort of thing on
your own in the future any time you want. Bear with me, there'll be a lot of C
source code you can skim over (I explain it). If you want to brush up on some
C, a good place to start is our SO wiki.</p>
<p>Download the source (or use https://heap.space/ to browse it online), grep all
the files for the function name, you'll find something such as this:</p>
<p>PHP 5.3.6 (most recent at time of writing) describes the two functions in
their native C code in the file <em>url.c</em>.</p>
<p><strong>RawUrlEncode()</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">PHP_FUNCTION</span><span class="p">(</span><span class="n">rawurlencode</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">char</span> <span class="o">*</span><span class="n">in_str</span><span class="p">,</span> <span class="o">*</span><span class="n">out_str</span><span class="p">;</span>
    <span class="n">int</span> <span class="n">in_str_len</span><span class="p">,</span> <span class="n">out_str_len</span><span class="p">;</span>

    <span class="n">if</span> <span class="p">(</span><span class="n">zend_parse_parameters</span><span class="p">(</span><span class="n">ZEND_NUM_ARGS</span><span class="p">()</span> <span class="n">TSRMLS_CC</span><span class="p">,</span> <span class="s">"s"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">in_str</span><span class="p">,</span>
                              <span class="o">&amp;</span><span class="n">in_str_len</span><span class="p">)</span> <span class="o">==</span> <span class="n">FAILURE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">out_str</span> <span class="o">=</span> <span class="n">php_raw_url_encode</span><span class="p">(</span><span class="n">in_str</span><span class="p">,</span> <span class="n">in_str_len</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">out_str_len</span><span class="p">);</span>
    <span class="n">RETURN_STRINGL</span><span class="p">(</span><span class="n">out_str</span><span class="p">,</span> <span class="n">out_str_len</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><strong>UrlEncode()</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">PHP_FUNCTION</span><span class="p">(</span><span class="n">urlencode</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">char</span> <span class="o">*</span><span class="n">in_str</span><span class="p">,</span> <span class="o">*</span><span class="n">out_str</span><span class="p">;</span>
    <span class="n">int</span> <span class="n">in_str_len</span><span class="p">,</span> <span class="n">out_str_len</span><span class="p">;</span>

    <span class="n">if</span> <span class="p">(</span><span class="n">zend_parse_parameters</span><span class="p">(</span><span class="n">ZEND_NUM_ARGS</span><span class="p">()</span> <span class="n">TSRMLS_CC</span><span class="p">,</span> <span class="s">"s"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">in_str</span><span class="p">,</span>
                              <span class="o">&amp;</span><span class="n">in_str_len</span><span class="p">)</span> <span class="o">==</span> <span class="n">FAILURE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">out_str</span> <span class="o">=</span> <span class="n">php_url_encode</span><span class="p">(</span><span class="n">in_str</span><span class="p">,</span> <span class="n">in_str_len</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">out_str_len</span><span class="p">);</span>
    <span class="n">RETURN_STRINGL</span><span class="p">(</span><span class="n">out_str</span><span class="p">,</span> <span class="n">out_str_len</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Okay, so what's different here?</p>
<p>They both are in essence calling two different internal functions
respectively: <strong>php_raw_url_encode</strong> and <strong>php_url_encode</strong></p>
<p>So go look for those functions!</p>
<h3>Lets look at php_raw_url_encode</h3>
<div class="code"><pre class="code literal-block"><span class="n">PHPAPI</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="n">php_raw_url_encode</span><span class="p">(</span><span class="nc">char</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="nf">len</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">*</span><span class="n">new_length</span><span class="p">)</span>
<span class="err">{</span>
<span class="w">    </span><span class="n">register</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="n">unsigned</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="nf">str</span><span class="p">;</span>

<span class="w">    </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">safe_emalloc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nf">len</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nf">len</span><span class="o">--</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="nc">char</span><span class="p">)</span><span class="w"> </span><span class="n">s</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="p">;</span>
<span class="n">#ifndef</span><span class="w"> </span><span class="n">CHARSET_EBCDIC</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">'0'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'-'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'.'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">            </span><span class="p">(</span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">'A'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">'9'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">            </span><span class="p">(</span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">'Z'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">'a'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'_'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">            </span><span class="p">(</span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">'z'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'~'</span><span class="p">))</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="nf">str</span><span class="o">[</span><span class="n">y++</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'%'</span><span class="p">;</span>
<span class="w">            </span><span class="nf">str</span><span class="o">[</span><span class="n">y++</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hexchars</span><span class="o">[</span><span class="n">(unsigned char) s[x</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">4</span><span class="err">]</span><span class="p">;</span>
<span class="w">            </span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hexchars</span><span class="o">[</span><span class="n">(unsigned char) s[x</span><span class="o">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">15</span><span class="err">]</span><span class="p">;</span>
<span class="n">#else</span><span class="w"> </span><span class="cm">/*CHARSET_EBCDIC*/</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="err">!</span><span class="n">isalnum</span><span class="p">(</span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">strchr</span><span class="p">(</span><span class="ss">"_-.~"</span><span class="p">,</span><span class="w"> </span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">NULL</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="nf">str</span><span class="o">[</span><span class="n">y++</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'%'</span><span class="p">;</span>
<span class="w">            </span><span class="nf">str</span><span class="o">[</span><span class="n">y++</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hexchars</span><span class="o">[</span><span class="n">os_toascii[(unsigned char) s[x</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">4</span><span class="err">]</span><span class="p">;</span>
<span class="w">            </span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hexchars</span><span class="o">[</span><span class="n">os_toascii[(unsigned char) s[x</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">15</span><span class="err">]</span><span class="p">;</span>
<span class="n">#endif</span><span class="w"> </span><span class="cm">/*CHARSET_EBCDIC*/</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="nf">str</span><span class="o">[</span><span class="n">y</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'\0'</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">new_length</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">new_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="nf">str</span><span class="p">);</span>
<span class="err">}</span>
</pre></div>

<h3>And of course, php_url_encode:</h3>
<div class="code"><pre class="code literal-block"><span class="n">PHPAPI</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="n">php_url_encode</span><span class="p">(</span><span class="nc">char</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="nf">len</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">*</span><span class="n">new_length</span><span class="p">)</span>
<span class="err">{</span>
<span class="w">    </span><span class="n">register</span><span class="w"> </span><span class="n">unsigned</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">    </span><span class="n">unsigned</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="k">to</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="k">start</span><span class="p">;</span>
<span class="w">    </span><span class="n">unsigned</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="o">*</span><span class="k">from</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="k">end</span><span class="p">;</span>

<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="p">;</span>
<span class="w">    </span><span class="k">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">len</span><span class="p">;</span>
<span class="w">    </span><span class="k">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">unsigned</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">safe_emalloc</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nf">len</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="k">from</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">end</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="k">from</span><span class="o">++</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">' '</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="o">*</span><span class="k">to</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'+'</span><span class="p">;</span>
<span class="n">#ifndef</span><span class="w"> </span><span class="n">CHARSET_EBCDIC</span>
<span class="w">        </span><span class="err">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">c</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">'0'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'-'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'.'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">                   </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">'A'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">'9'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">                   </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">'Z'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">'a'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'_'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">                   </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">'z'</span><span class="p">))</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="k">to</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'%'</span><span class="p">;</span>
<span class="w">            </span><span class="k">to</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hexchars</span><span class="o">[</span><span class="n">c &gt;&gt; 4</span><span class="o">]</span><span class="p">;</span>
<span class="w">            </span><span class="k">to</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hexchars</span><span class="o">[</span><span class="n">c &amp; 15</span><span class="o">]</span><span class="p">;</span>
<span class="w">            </span><span class="k">to</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="n">#else</span><span class="w"> </span><span class="cm">/*CHARSET_EBCDIC*/</span>
<span class="w">        </span><span class="err">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="err">!</span><span class="n">isalnum</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">strchr</span><span class="p">(</span><span class="ss">"_-."</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">NULL</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="cm">/* Allow only alphanumeric chars and '_', '-', '.'; escape the rest */</span>
<span class="w">            </span><span class="k">to</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'%'</span><span class="p">;</span>
<span class="w">            </span><span class="k">to</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hexchars</span><span class="o">[</span><span class="n">os_toascii[c</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">4</span><span class="err">]</span><span class="p">;</span>
<span class="w">            </span><span class="k">to</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hexchars</span><span class="o">[</span><span class="n">os_toascii[c</span><span class="o">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">15</span><span class="err">]</span><span class="p">;</span>
<span class="w">            </span><span class="k">to</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="n">#endif</span><span class="w"> </span><span class="cm">/*CHARSET_EBCDIC*/</span>
<span class="w">        </span><span class="err">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="o">*</span><span class="k">to</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="o">*</span><span class="k">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">new_length</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="o">*</span><span class="n">new_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">start</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">start</span><span class="p">;</span>
<span class="err">}</span>
</pre></div>

<p>One quick bit of knowledge before I move forward, EBCDIC is another character
set, similar to ASCII, but a total competitor. PHP attempts to deal with both.
But basically, this means byte EBCDIC 0x4c byte isn't the <code>L</code> in ASCII, it's
actually a <code>&lt;</code>. I'm sure you see the confusion here.</p>
<p>Both of these functions manage EBCDIC if the web server has defined it.</p>
<p>Also, they both use an array of chars (think string type) <code>hexchars</code> look-up
to get some values, the array is described as such:</p>
<div class="code"><pre class="code literal-block"><span class="cm">/* rfc1738:</span>

<span class="cm">   ...The characters ";",</span>
<span class="cm">   "/", "?", ":", "@", "=" and "&amp;" are the characters which may be</span>
<span class="cm">   reserved for special meaning within a scheme...</span>

<span class="cm">   ...Thus, only alphanumerics, the special characters "$-_.+!*'(),", and</span>
<span class="cm">   reserved characters used for their reserved purposes may be used</span>
<span class="cm">   unencoded within a URL...</span>

<span class="cm">   For added safety, we only leave -_. unencoded.</span>
<span class="cm"> */</span>

<span class="k">static</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">hexchars</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"0123456789ABCDEF"</span><span class="p">;</span>
</pre></div>

<p>Beyond that, the functions are really different, and I'm going to explain them
in ASCII and EBCDIC.</p>
<h3>Differences in ASCII:</h3>
<p><strong>URLENCODE:</strong></p>
<ul>
<li>Calculates a start/end length of the input string, allocates memory</li>
<li>Walks through a while-loop, increments until we reach the end of the string</li>
<li>Grabs the present character</li>
<li>If the character is equal to ASCII Char 0x20 (ie, a "space"), add a <code>+</code> sign to the output string.</li>
<li>If it's not a space, and it's also not alphanumeric (<code>isalnum(c)</code>), and also isn't and <code>_</code>, <code>-</code>, or <code>.</code> character, then we , output a <code>%</code> sign to array position 0, do an array look up to the <code>hexchars</code> array for a lookup for <code>os_toascii</code> array (an array from Apache that translates char to hex code) for the key of <code>c</code> (the present character), we then bitwise shift right by 4, assign that value to the character 1, and to position 2 we assign the same lookup, except we preform a logical and to see if the value is 15 (0xF), and return a 1 in that case, or a 0 otherwise. At the end, you'll end up with something encoded.</li>
<li>If it ends up it's not a space, it's alphanumeric or one of the <code>_-.</code> chars, it outputs exactly what it is.</li>
</ul>
<p><strong>RAWURLENCODE:</strong></p>
<ul>
<li>Allocates memory for the string</li>
<li>Iterates over it based on length provided in function call (not calculated in function as with URLENCODE).</li>
</ul>
<p><strong>Note:</strong> Many programmers have probably never seen a for loop iterate this
way, it's somewhat hackish and not the standard convention used with most for-
loops, pay attention, it assigns <code>x</code> and <code>y</code>, checks for exit on <code>len</code>
reaching 0, and increments both <code>x</code> and <code>y</code>. I know, it's not what you'd
expect, but it's valid code.</p>
<ul>
<li>Assigns the present character to a matching character position in <code>str</code>.</li>
<li>It checks if the present character is alphanumeric, or one of the <code>_-.</code> chars, and if it isn't, we do almost the same assignment as with URLENCODE where it preforms lookups, however, we increment differently, using <code>y++</code> rather than <code>to[1]</code>, this is because the strings are being built in different ways, but reach the same goal at the end anyway.</li>
<li>When the loop's done and the length's gone, It actually terminates the string, assigning the <code>\0</code> byte.</li>
<li>It returns the encoded string.</li>
</ul>
<p><strong>Differences:</strong></p>
<ul>
<li>UrlEncode checks for space, assigns a + sign, RawURLEncode does not.</li>
<li>UrlEncode does not assign a <code>\0</code> byte to the string, RawUrlEncode does (this may be a moot point)</li>
<li>They iterate differntly, one may be prone to overflow with malformed strings, I'm <strong>merely suggesting</strong> this and I <strong>haven't</strong> actually investigated.</li>
</ul>
<p>They basically iterate differently, one assigns a + sign in the event of ASCII
20.</p>
<h3>Differences in EBCDIC:</h3>
<p><strong>URLENCODE:</strong></p>
<ul>
<li>Same iteration setup as with ASCII</li>
<li>Still translating the "space" character to a + <em>sign. Note-- I think this needs to be compiled in EBCDIC or you'll end up with a bug? Can someone edit and confirm this?</em>
</li>
<li>It checks if the present char is a char before <code>0</code>, with the exception of being a <code>.</code> or <code>-</code>, <strong>OR</strong> less than <code>A</code> but greater than char <code>9</code>, <strong>OR</strong> greater than <code>Z</code> and less than <code>a</code> but not a <code>_</code>. <strong>OR</strong> greater than <code>z</code> (yeah, EBCDIC is kinda messed up to work with). If it matches any of those, do a similar lookup as found in the ASCII version (it just doesn't require a lookup in os_toascii).</li>
</ul>
<p><strong>RAWURLENCODE:</strong></p>
<ul>
<li>Same iteration setup as with ASCII</li>
<li>Same check as described in the EBCDIC version of URL Encode, with the exception that if it's greater than <code>z</code>, it excludes <code>~</code> from the URL encode.</li>
<li>Same assignment as the ASCII RawUrlEncode</li>
<li>Still appending the <code>\0</code> byte to the string before return.</li>
</ul>
<h3>Grand Summary</h3>
<ul>
<li>Both use the same hexchars lookup table</li>
<li>URIEncode doesn't terminate a string with \0, raw does.</li>
<li>If you're working in EBCDIC I'd suggest using RawUrlEncode, as it manages the <code>~</code> that UrlEncode does not (this is a reported issue). It's worth noting that ASCII and EBCDIC 0x20 are both spaces.</li>
<li>They iterate differently, one may be faster, one may be prone to memory or string based exploits.</li>
<li>URIEncode makes a space into <code>+</code>, RawUrlEncode makes a space into <code>%20</code> via array lookups.</li>
</ul>
<p><strong>Disclaimer:</strong> I haven't touched C in years, and I haven't looked at EBCDIC
in a really really long time. If I'm wrong somewhere, let me know.</p>
<h3>Suggested implementations</h3>
<p>Based on all of this, rawurlencode is the way to go most of the time. As you
see in Jonathan Fingland's answer, stick with it in most cases. It deals with
the modern scheme for URI components, where as urlencode does things the old
school way, where + meant "space."</p>
<p>If you're trying to convert between the old format and new formats, be sure
that your code doesn't goof up and turn something that's a decoded + sign into
a space by accidentally double-encoding, or similar "oops" scenarios around
this space/20%/+ issue.</p>
<p>If you're working on an older system with older software that doesn't prefer
the new format, stick with urlencode, however, I believe %20 will actually be
backwards compatible, as under the old standard %20 worked, just wasn't
preferred. Give it a shot if you're up for playing around, let us know how it
worked out for you.</p>
<p>Basically, you should stick with raw, unless your EBCDIC system really hates
you. Most programmers will never run into EBCDIC on any system made after the
year 2000, maybe even 1990 (that's pushing, but still likely in my opinion).</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-are-data-classes-and-how-are-they-different-from-common-classes/" class="u-url">What are data classes and how are they different from common classes?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-are-data-classes-and-how-are-they-different-from-common-classes/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T16:48:52+08:00" itemprop="datePublished" title="2023-03-03 16:48">2023-03-03 16:48</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>With PEP 557 data classes are introduced into python standard library.</p>
<p>They make use of the <code>@dataclass</code> decorator and they are supposed to be
"mutable namedtuples with default" but I'm not really sure I understand what
this actually means and how they are different from common classes.</p>
<p>What exactly are python data classes and when is it best to use them?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Data classes are just regular classes that are geared towards storing state,
rather than containing a lot of logic. Every time you create a class that
mostly consists of attributes, you make a data class.</p>
<p>What the <code>dataclasses</code> module does is to make it <strong>easier</strong> to create data
classes. It takes care of a lot of boilerplate for you.</p>
<p>This is especially useful when your data class must be hashable; because this
requires a <code>__hash__</code> method as well as an <code>__eq__</code> method. If you add a
custom <code>__repr__</code> method for ease of debugging, that can become quite verbose:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">InventoryItem:</span>
    <span class="s">'''Class for keeping track of an item in inventory.'''</span>
    <span class="n">name:</span> <span class="n">str</span>
    <span class="n">unit_price:</span> <span class="n">float</span>
    <span class="n">quantity_on_hand:</span> <span class="n">int</span> = <span class="mi">0</span>

    <span class="n">def</span> <span class="n">__init__</span>(
            <span class="nb">self</span>, 
            <span class="n">name:</span> <span class="n">str</span>, 
            <span class="n">unit_price:</span> <span class="n">float</span>,
            <span class="n">quantity_on_hand:</span> <span class="n">int</span> = <span class="mi">0</span>
        ) -&gt; <span class="n">None:</span>
        <span class="nb">self</span>.<span class="nb">name</span> = <span class="nb">name</span>
        <span class="nb">self</span>.<span class="n">unit_price</span> = <span class="n">unit_price</span>
        <span class="nb">self</span>.<span class="n">quantity_on_hand</span> = <span class="n">quantity_on_hand</span>

    <span class="n">def</span> <span class="n">total_cost</span>(<span class="nb">self</span>) -&gt; <span class="n">float:</span>
        <span class="k">return</span> <span class="nb">self</span>.<span class="n">unit_price</span> * <span class="nb">self</span>.<span class="n">quantity_on_hand</span>

    <span class="n">def</span> <span class="n">__repr__</span>(<span class="nb">self</span>) -&gt; <span class="n">str:</span>
        <span class="k">return</span> (
            <span class="s">'InventoryItem('</span>
            <span class="n">f'name</span>={<span class="nb">self</span>.<span class="nb">name</span><span class="o">!</span><span class="nb">r</span>}, <span class="n">unit_price</span>={<span class="nb">self</span>.<span class="n">unit_price</span><span class="o">!</span><span class="nb">r</span>}, <span class="s">'</span>
<span class="s">            f'</span><span class="n">quantity_on_hand</span>={<span class="nb">self</span>.<span class="n">quantity_on_hand</span><span class="o">!</span><span class="nb">r</span>})'

    <span class="n">def</span> <span class="n">__hash__</span>(<span class="nb">self</span>) -&gt; <span class="n">int:</span>
        <span class="k">return</span> <span class="n">hash</span>((<span class="nb">self</span>.<span class="nb">name</span>, <span class="nb">self</span>.<span class="n">unit_price</span>, <span class="nb">self</span>.<span class="n">quantity_on_hand</span>))

    <span class="n">def</span> <span class="n">__eq__</span>(<span class="nb">self</span>, <span class="n">other</span>) -&gt; <span class="n">bool:</span>
        <span class="k">if</span> <span class="nb">not</span> <span class="n">isinstance</span>(<span class="n">other</span>, <span class="n">InventoryItem</span>):
            <span class="k">return</span> <span class="n">NotImplemented</span>
        <span class="k">return</span> (
            (<span class="nb">self</span>.<span class="nb">name</span>, <span class="nb">self</span>.<span class="n">unit_price</span>, <span class="nb">self</span>.<span class="n">quantity_on_hand</span>) == 
            (<span class="n">other</span>.<span class="nb">name</span>, <span class="n">other</span>.<span class="n">unit_price</span>, <span class="n">other</span>.<span class="n">quantity_on_hand</span>))
</pre></div>

<p>With <code>dataclasses</code> you can reduce it to:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">unsafe_hash</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">InventoryItem</span><span class="p">:</span>
<span class="w">    </span><span class="sd">'''Class for keeping track of an item in inventory.'''</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">unit_price</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">quantity_on_hand</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">total_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_price</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity_on_hand</span>
</pre></div>

<p>(Example based on the PEP example).</p>
<p>The same class decorator can also generate comparison methods (<code>__lt__</code>,
<code>__gt__</code>, etc.) and handle immutability.</p>
<p><code>namedtuple</code> classes are also data classes, but are immutable by default (as
well as being sequences). <code>dataclasses</code> are much more flexible in this regard,
and can easily be structured such that they can fill the same role as a
<code>namedtuple</code> class.</p>
<p>The PEP was inspired by the <code>attrs</code> project, which can do even more (including
slots, validators, converters, metadata, etc.).</p>
<p>If you want to see some examples, I recently used <code>dataclasses</code> for several of
my Advent of Code solutions, see the solutions for day 7, day 8, day 11 and
day 20.</p>
<p>If you want to use <code>dataclasses</code> module in Python versions &lt; 3.7, then you
could install the backported module (requires 3.6) or use the <code>attrs</code> project
mentioned above.</p>
<p><br></p>
<h3>Suggest</h3>
<h2>Overview</h2>
<p>The question has been addressed. However, this answer adds some practical
examples to aid in the basic understanding of dataclasses.</p>
<blockquote>
<p>What exactly are python data classes and when is it best to use them?</p>
</blockquote>
<ol>
<li>
<em>code generators</em> : generate boilerplate code; you can choose to implement special methods in a regular class or have a dataclass implement them automatically.</li>
<li>
<em>data containers</em> : structures that hold data (e.g. tuples and dicts), often with dotted, attribute access such as classes, <code>namedtuple</code> and others.</li>
</ol>
<blockquote>
<p>"mutable namedtuples with default[s]"</p>
</blockquote>
<p>Here is what the latter phrase means:</p>
<ul>
<li>
<em>mutable</em> : by default, dataclass attributes can be reassigned. You can optionally make them immutable (see Examples below).</li>
<li>
<em>namedtuple</em> : you have dotted, attribute access like a <code>namedtuple</code> or a regular class.</li>
<li>
<em>default</em> : you can assign default values to attributes.</li>
</ul>
<p>Compared to common classes, you primarily save on typing boilerplate code.</p>
<hr>
<h2>Features</h2>
<p>This is an overview of dataclass features (TL;DR? See the Summary Table in the
next section).</p>
<h3>What you get</h3>
<p>Here are features you get by default from dataclasses.</p>
<p><em>Attributes + Representation + Comparison</em></p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">dataclasses</span>


<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="c1">#@dataclasses.dataclass()                                       # alternative</span>
<span class="k">class</span> <span class="nc">Color</span><span class="p">:</span>
    <span class="n">r</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">g</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">b</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>

<p>These defaults are provided by automatically setting the following keywords to
<code>True</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@dataclasses</span><span class="p">.</span><span class="n">dataclass</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="n">repr</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="n">eq</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
</pre></div>

<h3>What you can turn on</h3>
<p>Additional features are available if the appropriate keywords are set to
<code>True</code>.</p>
<p><em>Order</em></p>
<div class="code"><pre class="code literal-block"><span class="nv">@dataclasses</span><span class="p">.</span><span class="n">dataclass</span><span class="p">(</span><span class="k">order</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nl">Color</span><span class="p">:</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</pre></div>

<p>The ordering methods are now implemented (overloading operators: <code>&lt; &gt; &lt;= &gt;=</code>),
similarly to <code>functools.total_ordering</code> with stronger equality tests.</p>
<p><em>Hashable, Mutable</em></p>
<div class="code"><pre class="code literal-block"><span class="nv">@dataclasses.dataclass</span><span class="p">(</span><span class="n">unsafe_hash</span><span class="o">=</span><span class="no">True</span><span class="p">)</span><span class="w">                        </span><span class="c1"># override base `__hash__`</span>
<span class="n">class</span><span class="w"> </span><span class="n">Color</span><span class="o">:</span>
<span class="w">    </span><span class="p">...</span>
</pre></div>

<p>Although the object is potentially mutable (possibly undesired), a hash is
implemented.</p>
<p><em>Hashable, Immutable</em></p>
<div class="code"><pre class="code literal-block"><span class="nv">@dataclasses</span><span class="p">.</span><span class="n">dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="w">                             </span><span class="err">#</span><span class="w"> </span><span class="err">`</span><span class="n">eq</span><span class="o">=</span><span class="k">True</span><span class="err">`</span><span class="w"> </span><span class="p">(</span><span class="k">default</span><span class="p">)</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">immutable</span><span class="w"> </span>
<span class="k">class</span><span class="w"> </span><span class="nl">Color</span><span class="p">:</span>
<span class="w">    </span><span class="p">...</span>
</pre></div>

<p>A hash is now implemented and changing the object or assigning to attributes
is disallowed.</p>
<p>Overall, the object is hashable if either <code>unsafe_hash=True</code> or <code>frozen=True</code>.</p>
<p>See also the original hashing logic table with more details.</p>
<h3>What you don't get</h3>
<p>To get the following features, special methods must be manually implemented:</p>
<p><em>Unpacking</em></p>
<div class="code"><pre class="code literal-block"><span class="nv">@dataclasses</span><span class="p">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nl">Color</span><span class="p">:</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__iter__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span>
<span class="w">        </span><span class="n">yield</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">dataclasses</span><span class="p">.</span><span class="n">astuple</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
</pre></div>

<p><em>Optimization</em></p>
<div class="code"><pre class="code literal-block"><span class="nv">@dataclasses</span><span class="p">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nl">SlottedColor</span><span class="p">:</span>
<span class="w">    </span><span class="n">__slots__</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">"r", "b", "g"</span><span class="o">]</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span>
</pre></div>

<p>The object size is now reduced:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; imp sys
&gt;&gt;&gt; sys.getsizeof(Color)
1056
&gt;&gt;&gt; sys.getsizeof(SlottedColor)
888
</pre></div>

<p>In some circumstances, <code>__slots__</code> also improves the speed of creating
instances and accessing attributes. Also, slots do not allow default
assignments; otherwise, a <code>ValueError</code> is raised.</p>
<p>See more on slots in this blog post.</p>
<hr>
<h2>Summary Table</h2>
<div class="code"><pre class="code literal-block"><span class="o">+----------------------+----------------------+----------------------------------------------------+-----------------------------------------+</span>
<span class="o">|</span><span class="w">       </span><span class="n">Feature</span><span class="w">        </span><span class="o">|</span><span class="w">       </span><span class="n">Keyword</span><span class="w">        </span><span class="o">|</span><span class="w">                      </span><span class="n">Example</span><span class="w">                       </span><span class="o">|</span><span class="w">           </span><span class="n">Implement</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Class</span><span class="w">          </span><span class="o">|</span>
<span class="o">+----------------------+----------------------+----------------------------------------------------+-----------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="n">Attributes</span><span class="w">           </span><span class="o">|</span><span class="w">  </span><span class="n">init</span><span class="w">                </span><span class="o">|</span><span class="w">  </span><span class="n">Color</span><span class="p">().</span><span class="n">r</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w">                                    </span><span class="o">|</span><span class="w">  </span><span class="n">__init__</span><span class="w">                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Representation</span><span class="w">       </span><span class="o">|</span><span class="w">  </span><span class="n">repr</span><span class="w">                </span><span class="o">|</span><span class="w">  </span><span class="n">Color</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="w">                   </span><span class="o">|</span><span class="w">  </span><span class="n">__repr__</span><span class="w">                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Comparision</span><span class="o">*</span><span class="w">         </span><span class="o">|</span><span class="w">  </span><span class="n">eq</span><span class="w">                  </span><span class="o">|</span><span class="w">  </span><span class="n">Color</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">True</span><span class="w">                 </span><span class="o">|</span><span class="w">  </span><span class="n">__eq__</span><span class="w">                                 </span><span class="o">|</span>
<span class="o">|</span><span class="w">                      </span><span class="o">|</span><span class="w">                      </span><span class="o">|</span><span class="w">                                                    </span><span class="o">|</span><span class="w">                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Order</span><span class="w">                </span><span class="o">|</span><span class="w">  </span><span class="n">order</span><span class="w">               </span><span class="o">|</span><span class="w">  </span><span class="nf">sorted</span><span class="p">([</span><span class="n">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Color</span><span class="p">()])</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">...</span><span class="w">         </span><span class="o">|</span><span class="w">  </span><span class="n">__lt__</span><span class="p">,</span><span class="w"> </span><span class="n">__le__</span><span class="p">,</span><span class="w"> </span><span class="n">__gt__</span><span class="p">,</span><span class="w"> </span><span class="n">__ge__</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Hashable</span><span class="w">             </span><span class="o">|</span><span class="w">  </span><span class="n">unsafe_hash</span><span class="o">/</span><span class="n">frozen</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="p">{</span><span class="n">Color</span><span class="p">(),</span><span class="w"> </span><span class="p">{</span><span class="n">Color</span><span class="p">()}}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">Color</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">)}</span><span class="w">    </span><span class="o">|</span><span class="w">  </span><span class="n">__hash__</span><span class="w">                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Immutable</span><span class="w">            </span><span class="o">|</span><span class="w">  </span><span class="n">frozen</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">eq</span><span class="w">         </span><span class="o">|</span><span class="w">  </span><span class="n">Color</span><span class="p">().</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">TypeError</span><span class="w">                       </span><span class="o">|</span><span class="w">  </span><span class="n">__setattr__</span><span class="p">,</span><span class="w"> </span><span class="n">__delattr__</span><span class="w">               </span><span class="o">|</span>
<span class="o">|</span><span class="w">                      </span><span class="o">|</span><span class="w">                      </span><span class="o">|</span><span class="w">                                                    </span><span class="o">|</span><span class="w">                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Unpacking</span><span class="o">+</span><span class="w">           </span><span class="o">|</span><span class="w">  </span><span class="o">-</span><span class="w">                   </span><span class="o">|</span><span class="w">  </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Color</span><span class="p">()</span><span class="w">                                 </span><span class="o">|</span><span class="w">   </span><span class="n">__iter__</span><span class="w">                              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">Optimization</span><span class="o">+</span><span class="w">        </span><span class="o">|</span><span class="w">  </span><span class="o">-</span><span class="w">                   </span><span class="o">|</span><span class="w">  </span><span class="n">sys</span><span class="p">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">SlottedColor</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">888</span><span class="w">                </span><span class="o">|</span><span class="w">  </span><span class="n">__slots__</span><span class="w">                              </span><span class="o">|</span>
<span class="o">+----------------------+----------------------+----------------------------------------------------+-----------------------------------------+</span>
</pre></div>

<p>+These methods are not automatically generated and require manual
implementation in a dataclass.</p>
<ul>
<li>
<code>__ne__</code> is not needed and thus not implemented.</li>
</ul>
<hr>
<h2>Additional features</h2>
<p><em>Post-initialization</em></p>
<div class="code"><pre class="code literal-block"><span class="nv">@dataclasses</span><span class="p">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nl">RGBA</span><span class="p">:</span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__post_init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span>
<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nc">int</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">255</span><span class="p">)</span>


<span class="n">RGBA</span><span class="p">(</span><span class="mi">127</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span>
<span class="err">#</span><span class="w"> </span><span class="n">RGBA</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">127</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">=</span><span class="mi">127</span><span class="p">)</span>
</pre></div>

<p><em>Inheritance</em></p>
<div class="code"><pre class="code literal-block"><span class="nv">@dataclasses</span><span class="p">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="n">RGBA</span><span class="p">(</span><span class="n">Color</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</pre></div>

<p><em>Conversions</em></p>
<p>Convert a dataclass to a tuple or a dict, recursively:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; dataclasses.astuple(Color(128, 0, 255))
(128, 0, 255)
&gt;&gt;&gt; dataclasses.asdict(Color(128, 0, 255))
{'r': 128, 'g': 0, 'b': 255}
</pre></div>

<p>Limitations</p>
<ul>
<li>Lacks mechanisms to handle starred arguments</li>
<li>Working with nested dataclasses can be complicated</li>
</ul>
<hr>
<h2>References</h2>
<ul>
<li>R. Hettinger's talk on <em>Dataclasses: The code generator to end all code generators</em>
</li>
<li>T. Hunner's talk on <em>Easier Classes: Python Classes Without All the Cruft</em>
</li>
<li>Python's documentation on hashing details</li>
<li>Real Python's guide on <em>The Ultimate Guide to Data Classes in Python 3.7</em>
</li>
<li>A. Shaw's blog post on <em>A brief tour of Python 3.7 data classes</em>
</li>
<li>E. Smith's github repository on <em>dataclasses</em>
</li>
</ul>
</div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2097.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2095.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
