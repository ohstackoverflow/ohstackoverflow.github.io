<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 783) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-783.html">
<link rel="prev" href="index-784.html" type="text/html">
<link rel="next" href="index-782.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/is-it-safe-to-expose-firebase-apikey-to-the-public/" class="u-url">Is it safe to expose Firebase apiKey to the public?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/is-it-safe-to-expose-firebase-apikey-to-the-public/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T15:53:15+08:00" itemprop="datePublished" title="2023-02-17 15:53">2023-02-17 15:53</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>The Firebase Web-App guide states I should put the given <code>apiKey</code> in my Html
to initialize Firebase:</p>
<div class="code"><pre class="code literal-block">//<span class="w"> </span>TODO:<span class="w"> </span>Replace<span class="w"> </span>with<span class="w"> </span>your<span class="w"> </span>project's<span class="w"> </span>customized<span class="w"> </span>code<span class="w"> </span>snippet
<span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"https://www.gstatic.com/firebasejs/3.0.2/firebase.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="w">  </span>//<span class="w"> </span>Initialize<span class="w"> </span>Firebase
<span class="w">  </span>var<span class="w"> </span>config<span class="w"> </span>=<span class="w"> </span>{
<span class="w">    </span>apiKey:<span class="w"> </span>'<span class="nt">&lt;your-api-key&gt;</span>',
<span class="w">    </span>authDomain:<span class="w"> </span>'<span class="nt">&lt;your-auth-domain&gt;</span>',
<span class="w">    </span>databaseURL:<span class="w"> </span>'<span class="nt">&lt;your-database-url&gt;</span>',
<span class="w">    </span>storageBucket:<span class="w"> </span>'<span class="nt">&lt;your-storage-bucket&gt;</span>'
<span class="w">  </span>};
<span class="w">  </span>firebase.initializeApp(config);
<span class="nt">&lt;/script&gt;</span>
</pre></div>

<p>By doing so, the <code>apiKey</code> is exposed to every visitor.</p>
<p>What is the <strong>purpose of that key</strong> and is it really <strong>meant to be public</strong>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The <code>apiKey</code> in this configuration snippet just identifies your Firebase
project on the Google servers. It is not a security risk for someone to know
it. In fact, it is necessary for them to know it, in order for them to
interact with your Firebase project. This same configuration data is also
included in every iOS and Android app that uses Firebase as its backend.</p>
<p>In that sense it is very similar to the database URL that identifies the back-
end database associated with your project in the same snippet: <code>https://&lt;app-
id&gt;.firebaseio.com</code>. See this question on why this is not a security risk: How
to restrict Firebase data modification?, including the use of Firebase's
server side security rules to ensure only authorized users can access the
backend services.</p>
<p>If you want to learn how to secure all data access to your Firebase backend
services is authorized, read up on the documentation on Firebase security
rules. These rules control access to file storage and database access, and are
enforced on the Firebase servers. So no matter if it's <em>your</em> code, or
somebody else's code that uses you configuration data, it can only do what the
security rules allow it to do.</p>
<p>For another explanation of what Firebase uses these values for, and for which
of them you <em>can</em> set quotas, see the Firebase documentation on using and
managing API keys.</p>
<hr>
<p>If you'd like to reduce the risk of committing this configuration data to
version control, consider using the SDK auto-configuration of Firebase
Hosting. While the keys will still end up in the browser in the same format,
they won't be hard-coded into your code anymore with that.</p>
<hr>
<p><strong>Update</strong> (May 2021): Thanks to the new feature called Firebase App Check, it
is now actually possible to limit access to the backend services in your
Firebase project to only those coming from iOS, Android and Web apps that are
registered in that specific project.</p>
<p>You'll typically want to combine this with the user authentication based
security described above, so that you have another shield against abusive
users that <em>do</em> use your app.</p>
<p>By combining App Check with security rules you have both broad protection
against abuse, and fine gained control over what data each user can access,
while still allowing direct access to the database from your client-side
application code.</p>
<p><br></p>
<h3>Suggest</h3>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/list-of-remotes-for-a-git-repository/" class="u-url">List of remotes for a Git repository?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/list-of-remotes-for-a-git-repository/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T15:52:53+08:00" itemprop="datePublished" title="2023-02-17 15:52">2023-02-17 15:52</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a Git repository. This repository has multiple remote repositories (I
think). How can I get a list of the remote repositories that belong to said
repository?</p>
<p>Like <code>git list --remotes</code> or something like that?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can get a list of any configured remote URLs with the command <code>git remote
-v</code>.</p>
<p>This will give you something like the following:</p>
<div class="code"><pre class="code literal-block"><span class="n">base</span><span class="w">    </span><span class="o">/</span><span class="n">home</span><span class="cm">/***/</span><span class="n">htdocs</span><span class="o">/</span><span class="n">base</span><span class="w"> </span><span class="p">(</span><span class="k">fetch</span><span class="p">)</span>
<span class="n">base</span><span class="w">    </span><span class="o">/</span><span class="n">home</span><span class="cm">/***/</span><span class="n">htdocs</span><span class="o">/</span><span class="n">base</span><span class="w"> </span><span class="p">(</span><span class="n">push</span><span class="p">)</span>
<span class="n">origin</span><span class="w">  </span><span class="n">git</span><span class="nv">@bitbucket</span><span class="p">.</span><span class="nl">org</span><span class="p">:</span><span class="o">***</span><span class="w"> </span><span class="p">(</span><span class="k">fetch</span><span class="p">)</span>
<span class="n">origin</span><span class="w">  </span><span class="n">git</span><span class="nv">@bitbucket</span><span class="p">.</span><span class="nl">org</span><span class="p">:</span><span class="o">***</span><span class="w"> </span><span class="p">(</span><span class="n">push</span><span class="p">)</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>If you only need the names of the remote repositories (and not any of the
other data), a simple <code>git remote</code> is enough.</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>git<span class="w"> </span>remote
iqandreas
octopress
origin
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-would-i-run-an-async-task-t-method-synchronously/" class="u-url">How would I run an async Task&lt;T&gt; method synchronously?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-would-i-run-an-async-task-t-method-synchronously/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T15:52:24+08:00" itemprop="datePublished" title="2023-02-17 15:52">2023-02-17 15:52</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am learning about async/await, and ran into a situation where I need to call
an async method synchronously. How can I do that?</p>
<p>Async method:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">async</span><span class="w"> </span><span class="nv">Task</span><span class="o">&lt;</span><span class="nv">Customers</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">GetCustomers</span><span class="ss">()</span>
{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">await</span><span class="w"> </span><span class="nv">Service</span>.<span class="nv">GetCustomersAsync</span><span class="ss">()</span><span class="c1">;</span>
}
</pre></div>

<p>Normal usage:</p>
<div class="code"><pre class="code literal-block">public async void GetCustomers()
{
    customerList = await GetCustomers();
}
</pre></div>

<p>I've tried using the following:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Task</span><span class="o">&lt;</span><span class="nv">Customer</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">GetCustomers</span><span class="ss">()</span><span class="c1">;</span>
<span class="nv">task</span>.<span class="k">Wait</span><span class="ss">()</span>

<span class="nv">Task</span><span class="o">&lt;</span><span class="nv">Customer</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">GetCustomers</span><span class="ss">()</span><span class="c1">;</span>
<span class="nv">task</span>.<span class="nv">RunSynchronously</span><span class="ss">()</span><span class="c1">;</span>

<span class="nv">Task</span><span class="o">&lt;</span><span class="nv">Customer</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">GetCustomers</span><span class="ss">()</span><span class="c1">;</span>
<span class="k">while</span><span class="ss">(</span><span class="nv">task</span>.<span class="nv">Status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">TaskStatus</span>.<span class="nv">RanToCompletion</span><span class="ss">)</span>
</pre></div>

<p>I also tried a suggestion from here, however it doesn't work when the
dispatcher is in a suspended state.</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">WaitWithPumping</span><span class="p">(</span><span class="n">this</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="n">task</span><span class="p">)</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">task</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ArgumentNullException</span><span class="p">(</span><span class="err">“</span><span class="n">task</span><span class="err">”</span><span class="p">);</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">nestedFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DispatcherFrame</span><span class="p">();</span>
<span class="w">        </span><span class="n">task</span><span class="o">.</span><span class="n">ContinueWith</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">nestedFrame</span><span class="o">.</span><span class="n">Continue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
<span class="w">        </span><span class="n">Dispatcher</span><span class="o">.</span><span class="n">PushFrame</span><span class="p">(</span><span class="n">nestedFrame</span><span class="p">);</span>
<span class="w">        </span><span class="n">task</span><span class="o">.</span><span class="n">Wait</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>Here is the exception and stack trace from calling <code>RunSynchronously</code>:</p>
<blockquote>
<p>System.InvalidOperationException</p>
<p><strong>Message</strong> : RunSynchronously may not be called on a task unbound to a
delegate.</p>
<p><strong>InnerException</strong> : null</p>
<p><strong>Source</strong> : mscorlib</p>
<p><strong>StackTrace</strong> :</p>
</blockquote>
<div class="code"><pre class="code literal-block">          at System.Threading.Tasks.Task.InternalRunSynchronously(TaskScheduler scheduler)
   at System.Threading.Tasks.Task.RunSynchronously()
   at MyApplication.CustomControls.Controls.MyCustomControl.CreateAvailablePanelList() in C:\Documents and Settings\...\MyApplication.CustomControls\Controls\MyCustomControl.xaml.cs:line 638
   at MyApplication.CustomControls.Controls.MyCustomControl.get_AvailablePanels() in C:\Documents and Settings\...\MyApplication.CustomControls\Controls\MyCustomControl.xaml.cs:line 233
   at MyApplication.CustomControls.Controls.MyCustomControl.&lt;CreateOpenPanelList&gt;b__36(DesktopPanel panel) in C:\Documents and Settings\...\MyApplication.CustomControls\Controls\MyCustomControl.xaml.cs:line 597
   at System.Collections.Generic.List`1.ForEach(Action`1 action)
   at MyApplication.CustomControls.Controls.MyCustomControl.&lt;CreateOpenPanelList&gt;d__3b.MoveNext() in C:\Documents and Settings\...\MyApplication.CustomControls\Controls\MyCustomControl.xaml.cs:line 625
   at System.Runtime.CompilerServices.TaskAwaiter.&lt;&gt;c__DisplayClass7.&lt;TrySetContinuationForAwait&gt;b__1(Object state)
   at System.Windows.Threading.ExceptionWrapper.InternalRealCall(Delegate callback, Object args, Int32 numArgs)
   at MS.Internal.Threading.ExceptionFilterHelper.TryCatchWhen(Object source, Delegate method, Object args, Int32 numArgs, Delegate catchHandler)
   at System.Windows.Threading.DispatcherOperation.InvokeImpl()
   at System.Windows.Threading.DispatcherOperation.InvokeInSecurityContext(Object state)
   at System.Threading.ExecutionContext.runTryCode(Object userData)
   at System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode code, CleanupCode backoutCode, Object userData)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean ignoreSyncCtx)
   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Windows.Threading.DispatcherOperation.Invoke()
   at System.Windows.Threading.Dispatcher.ProcessQueue()
   at System.Windows.Threading.Dispatcher.WndProcHook(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean&amp; handled)
   at MS.Win32.HwndWrapper.WndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean&amp; handled)
   at MS.Win32.HwndSubclass.DispatcherCallbackOperation(Object o)
   at System.Windows.Threading.ExceptionWrapper.InternalRealCall(Delegate callback, Object args, Int32 numArgs)
   at MS.Internal.Threading.ExceptionFilterHelper.TryCatchWhen(Object source, Delegate method, Object args, Int32 numArgs, Delegate catchHandler)
   at System.Windows.Threading.Dispatcher.InvokeImpl(DispatcherPriority priority, TimeSpan timeout, Delegate method, Object args, Int32 numArgs)
   at MS.Win32.HwndSubclass.SubclassWndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam)
   at MS.Win32.UnsafeNativeMethods.DispatchMessage(MSG&amp; msg)
   at System.Windows.Threading.Dispatcher.PushFrameImpl(DispatcherFrame frame)
   at System.Windows.Threading.Dispatcher.PushFrame(DispatcherFrame frame)
   at System.Windows.Threading.Dispatcher.Run()
   at System.Windows.Application.RunDispatcher(Object ignore)
   at System.Windows.Application.RunInternal(Window window)
   at System.Windows.Application.Run(Window window)
   at System.Windows.Application.Run()
   at MyApplication.App.Main() in C:\Documents and Settings\...\MyApplication\obj\Debug\App.g.cs:line 50
   at System.AppDomain._nExecuteAssembly(RuntimeAssembly assembly, String[] args)
   at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)
   at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()
   at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean ignoreSyncCtx)
   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.ThreadHelper.ThreadStart()
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>Here's a workaround I found that works for all cases (including suspended
dispatchers). It's not my code and I'm still working to fully understand it,
but it does work.</p>
<p>It can be called using:</p>
<p><code>customerList = AsyncHelpers.RunSync&lt;List&lt;Customer&gt;&gt;(() =&gt; GetCustomers());</code></p>
<p>Code is from here</p>
<div class="code"><pre class="code literal-block">public<span class="w"> </span>static<span class="w"> </span>class<span class="w"> </span>AsyncHelpers
{
<span class="w">    </span>///<span class="w"> </span><span class="nt">&lt;summary&gt;</span>
<span class="w">    </span>///<span class="w"> </span>Execute's<span class="w"> </span>an<span class="w"> </span>async<span class="w"> </span>Task<span class="nt">&lt;T&gt;</span><span class="w"> </span>method<span class="w"> </span>which<span class="w"> </span>has<span class="w"> </span>a<span class="w"> </span>void<span class="w"> </span>return<span class="w"> </span>value<span class="w"> </span>synchronously
<span class="w">    </span>///<span class="w"> </span><span class="nt">&lt;/summary&gt;</span>
<span class="w">    </span>///<span class="w"> </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">"task"</span><span class="nt">&gt;</span>Task<span class="nt">&lt;T&gt;</span><span class="w"> </span>method<span class="w"> </span>to<span class="w"> </span>execute<span class="nt">&lt;/param&gt;</span>
<span class="w">    </span>public<span class="w"> </span>static<span class="w"> </span>void<span class="w"> </span>RunSync(Func<span class="nt">&lt;Task&gt;</span><span class="w"> </span>task)
<span class="w">    </span>{
<span class="w">        </span>var<span class="w"> </span>oldContext<span class="w"> </span>=<span class="w"> </span>SynchronizationContext.Current;
<span class="w">        </span>var<span class="w"> </span>synch<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>ExclusiveSynchronizationContext();
<span class="w">        </span>SynchronizationContext.SetSynchronizationContext(synch);
<span class="w">        </span>synch.Post(async<span class="w"> </span>_<span class="w"> </span>=&gt;
<span class="w">        </span>{
<span class="w">            </span>try
<span class="w">            </span>{
<span class="w">                </span>await<span class="w"> </span>task();
<span class="w">            </span>}
<span class="w">            </span>catch<span class="w"> </span>(Exception<span class="w"> </span>e)
<span class="w">            </span>{
<span class="w">                </span>synch.InnerException<span class="w"> </span>=<span class="w"> </span>e;
<span class="w">                </span>throw;
<span class="w">            </span>}
<span class="w">            </span>finally
<span class="w">            </span>{
<span class="w">                </span>synch.EndMessageLoop();
<span class="w">            </span>}
<span class="w">        </span>},<span class="w"> </span>null);
<span class="w">        </span>synch.BeginMessageLoop();

<span class="w">        </span>SynchronizationContext.SetSynchronizationContext(oldContext);
<span class="w">    </span>}

<span class="w">    </span>///<span class="w"> </span><span class="nt">&lt;summary&gt;</span>
<span class="w">    </span>///<span class="w"> </span>Execute's<span class="w"> </span>an<span class="w"> </span>async<span class="w"> </span>Task<span class="nt">&lt;T&gt;</span><span class="w"> </span>method<span class="w"> </span>which<span class="w"> </span>has<span class="w"> </span>a<span class="w"> </span>T<span class="w"> </span>return<span class="w"> </span>type<span class="w"> </span>synchronously
<span class="w">    </span>///<span class="w"> </span><span class="nt">&lt;/summary&gt;</span>
<span class="w">    </span>///<span class="w"> </span><span class="nt">&lt;typeparam</span><span class="w"> </span><span class="na">name=</span><span class="s">"T"</span><span class="nt">&gt;</span>Return<span class="w"> </span>Type<span class="nt">&lt;/typeparam&gt;</span>
<span class="w">    </span>///<span class="w"> </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">"task"</span><span class="nt">&gt;</span>Task<span class="nt">&lt;T&gt;</span><span class="w"> </span>method<span class="w"> </span>to<span class="w"> </span>execute<span class="nt">&lt;/param&gt;</span>
<span class="w">    </span>///<span class="w"> </span><span class="nt">&lt;returns&gt;&lt;/returns&gt;</span>
<span class="w">    </span>public<span class="w"> </span>static<span class="w"> </span>T<span class="w"> </span>RunSync<span class="nt">&lt;T&gt;</span>(Func<span class="nt">&lt;Task</span><span class="err">&lt;T</span><span class="nt">&gt;</span>&gt;<span class="w"> </span>task)
<span class="w">    </span>{
<span class="w">        </span>var<span class="w"> </span>oldContext<span class="w"> </span>=<span class="w"> </span>SynchronizationContext.Current;
<span class="w">        </span>var<span class="w"> </span>synch<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>ExclusiveSynchronizationContext();
<span class="w">        </span>SynchronizationContext.SetSynchronizationContext(synch);
<span class="w">        </span>T<span class="w"> </span>ret<span class="w"> </span>=<span class="w"> </span>default(T);
<span class="w">        </span>synch.Post(async<span class="w"> </span>_<span class="w"> </span>=&gt;
<span class="w">        </span>{
<span class="w">            </span>try
<span class="w">            </span>{
<span class="w">                </span>ret<span class="w"> </span>=<span class="w"> </span>await<span class="w"> </span>task();
<span class="w">            </span>}
<span class="w">            </span>catch<span class="w"> </span>(Exception<span class="w"> </span>e)
<span class="w">            </span>{
<span class="w">                </span>synch.InnerException<span class="w"> </span>=<span class="w"> </span>e;
<span class="w">                </span>throw;
<span class="w">            </span>}
<span class="w">            </span>finally
<span class="w">            </span>{
<span class="w">                </span>synch.EndMessageLoop();
<span class="w">            </span>}
<span class="w">        </span>},<span class="w"> </span>null);
<span class="w">        </span>synch.BeginMessageLoop();
<span class="w">        </span>SynchronizationContext.SetSynchronizationContext(oldContext);
<span class="w">        </span>return<span class="w"> </span>ret;
<span class="w">    </span>}

<span class="w">    </span>private<span class="w"> </span>class<span class="w"> </span>ExclusiveSynchronizationContext<span class="w"> </span>:<span class="w"> </span>SynchronizationContext
<span class="w">    </span>{
<span class="w">        </span>private<span class="w"> </span>bool<span class="w"> </span>done;
<span class="w">        </span>public<span class="w"> </span>Exception<span class="w"> </span>InnerException<span class="w"> </span>{<span class="w"> </span>get;<span class="w"> </span>set;<span class="w"> </span>}
<span class="w">        </span>readonly<span class="w"> </span>AutoResetEvent<span class="w"> </span>workItemsWaiting<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>AutoResetEvent(false);
<span class="w">        </span>readonly<span class="w"> </span>Queue<span class="nt">&lt;Tuple</span><span class="err">&lt;SendOrPostCallback,</span><span class="w"> </span><span class="err">object</span><span class="nt">&gt;</span>&gt;<span class="w"> </span>items<span class="w"> </span>=
<span class="w">            </span>new<span class="w"> </span>Queue<span class="nt">&lt;Tuple</span><span class="err">&lt;SendOrPostCallback,</span><span class="w"> </span><span class="err">object</span><span class="nt">&gt;</span>&gt;();

<span class="w">        </span>public<span class="w"> </span>override<span class="w"> </span>void<span class="w"> </span>Send(SendOrPostCallback<span class="w"> </span>d,<span class="w"> </span>object<span class="w"> </span>state)
<span class="w">        </span>{
<span class="w">            </span>throw<span class="w"> </span>new<span class="w"> </span>NotSupportedException("We<span class="w"> </span>cannot<span class="w"> </span>send<span class="w"> </span>to<span class="w"> </span>our<span class="w"> </span>same<span class="w"> </span>thread");
<span class="w">        </span>}

<span class="w">        </span>public<span class="w"> </span>override<span class="w"> </span>void<span class="w"> </span>Post(SendOrPostCallback<span class="w"> </span>d,<span class="w"> </span>object<span class="w"> </span>state)
<span class="w">        </span>{
<span class="w">            </span>lock<span class="w"> </span>(items)
<span class="w">            </span>{
<span class="w">                </span>items.Enqueue(Tuple.Create(d,<span class="w"> </span>state));
<span class="w">            </span>}
<span class="w">            </span>workItemsWaiting.Set();
<span class="w">        </span>}

<span class="w">        </span>public<span class="w"> </span>void<span class="w"> </span>EndMessageLoop()
<span class="w">        </span>{
<span class="w">            </span>Post(_<span class="w"> </span>=&gt;<span class="w"> </span>done<span class="w"> </span>=<span class="w"> </span>true,<span class="w"> </span>null);
<span class="w">        </span>}

<span class="w">        </span>public<span class="w"> </span>void<span class="w"> </span>BeginMessageLoop()
<span class="w">        </span>{
<span class="w">            </span>while<span class="w"> </span>(!done)
<span class="w">            </span>{
<span class="w">                </span>Tuple<span class="nt">&lt;SendOrPostCallback</span><span class="err">,</span><span class="w"> </span><span class="err">object</span><span class="nt">&gt;</span><span class="w"> </span>task<span class="w"> </span>=<span class="w"> </span>null;
<span class="w">                </span>lock<span class="w"> </span>(items)
<span class="w">                </span>{
<span class="w">                    </span>if<span class="w"> </span>(items.Count<span class="w"> </span>&gt;<span class="w"> </span>0)
<span class="w">                    </span>{
<span class="w">                        </span>task<span class="w"> </span>=<span class="w"> </span>items.Dequeue();
<span class="w">                    </span>}
<span class="w">                </span>}
<span class="w">                </span>if<span class="w"> </span>(task<span class="w"> </span>!=<span class="w"> </span>null)
<span class="w">                </span>{
<span class="w">                    </span>task.Item1(task.Item2);
<span class="w">                    </span>if<span class="w"> </span>(InnerException<span class="w"> </span>!=<span class="w"> </span>null)<span class="w"> </span>//<span class="w"> </span>the<span class="w"> </span>method<span class="w"> </span>threw<span class="w"> </span>an<span class="w"> </span>exeption
<span class="w">                    </span>{
<span class="w">                        </span>throw<span class="w"> </span>new<span class="w"> </span>AggregateException("AsyncHelpers.Run<span class="w"> </span>method<span class="w"> </span>threw<span class="w"> </span>an<span class="w"> </span>exception.",<span class="w"> </span>InnerException);
<span class="w">                    </span>}
<span class="w">                </span>}
<span class="w">                </span>else
<span class="w">                </span>{
<span class="w">                    </span>workItemsWaiting.WaitOne();
<span class="w">                </span>}
<span class="w">            </span>}
<span class="w">        </span>}

<span class="w">        </span>public<span class="w"> </span>override<span class="w"> </span>SynchronizationContext<span class="w"> </span>CreateCopy()
<span class="w">        </span>{
<span class="w">            </span>return<span class="w"> </span>this;
<span class="w">        </span>}
<span class="w">    </span>}
}
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p><strong>Be advised</strong> this answer is three years old. I wrote it based mostly on a
experience with .Net 4.0, and very little with 4.5 especially with <code>async-
await</code>. Generally speaking it's a nice simple solution, but it sometimes
breaks things. Please read the discussion in the comments.</p>
<h4>.Net 4.5</h4>
<p>Just use this:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">:</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">completed</span><span class="o">...</span>
<span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="o">.</span><span class="n">Result</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="p">(</span><span class="ow">not</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">completed</span><span class="o">...</span>
<span class="n">task2</span><span class="o">.</span><span class="n">RunSynchronously</span><span class="p">();</span>
</pre></div>

<p>See: TaskAwaiter, Task.Result, Task.RunSynchronously</p>
<hr>
<h4>.Net 4.0</h4>
<p>Use this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">IAsyncResult</span><span class="p">)</span><span class="n">task</span><span class="p">;</span>
<span class="n">task</span><span class="o">.</span><span class="n">Start</span><span class="p">();</span>

<span class="n">x</span><span class="o">.</span><span class="n">AsyncWaitHandle</span><span class="o">.</span><span class="n">WaitOne</span><span class="p">();</span>
</pre></div>

<p>...or this:</p>
<div class="code"><pre class="code literal-block"><span class="nv">task</span>.<span class="nv">Start</span><span class="ss">()</span><span class="c1">;</span>
<span class="nv">task</span>.<span class="k">Wait</span><span class="ss">()</span><span class="c1">;</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-784.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-782.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
