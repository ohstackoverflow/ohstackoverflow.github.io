<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 682) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-682.html">
<link rel="prev" href="index-683.html" type="text/html">
<link rel="next" href="index-681.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/git-keeps-prompting-me-for-a-password/" class="u-url">Git keeps prompting me for a password</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/git-keeps-prompting-me-for-a-password/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T13:12:22+08:00" itemprop="datePublished" title="2023-02-17 13:12">2023-02-17 13:12</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've been using Git for a while now, but the constant requests for a password
are starting to drive me up the wall.</p>
<p>I'm using Mac OS X and GitHub, and I set up Git and my SSH keys as instructed
by GitHub's Set Up Git page.</p>
<p>I've also added the github SSH key to my Mac OS X keychain, as mentioned on
GitHub's SSH key passphrases page. My public key is registered with Git.</p>
<p>Nevertheless, every time I try to Git pull, I have to enter my username and
password. Is there something other than an SSH key that I need to set up for
this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I think you may have the wrong Git repository URL.</p>
<p>Open <code>.git/config</code> and find the [remote "origin"] section. Make sure you're
using the SSH one:</p>
<div class="code"><pre class="code literal-block"><span class="nl">ssh</span><span class="p">:</span><span class="o">//</span><span class="n">git</span><span class="nv">@github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">repo</span><span class="p">.</span><span class="n">git</span>
</pre></div>

<p>You can see the SSH URL in the main page of your repository if you click
<em>Clone or download</em> and choose <em>ssh</em>.</p>
<p>And NOT the <code>https</code> or <code>git</code> one:</p>
<div class="code"><pre class="code literal-block">https://github.com/username/repo.git
git://github.com/username/repo.git
</pre></div>

<p>You can now validate with <em>just</em> the SSH key instead of the username and
password.</p>
<p>If Git complains that <code>'origin' has already been added</code>, open the <code>.config</code>
file and edit the <code>url = "..."</code> part after <code>[remote origin]</code> as <code>url =
ssh://github/username/repo.git</code></p>
<hr>
<p>The same goes for other services. Make sure the address looks like:
<code>protocol://something@url</code></p>
<p>E.g. <code>.git/config</code> for <strong>Azure DevOps:</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">[remote "origin"]</span>
<span class="w">    </span><span class="na">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://mystore@dev.azure.com/mystore/myproject/</span>
<span class="w">    </span><span class="na">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">+refs/heads/*:refs/remotes/origin/*</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<h3>Configuring credential.helper</h3>
<p>On OS X (now macOS), run this in <em>Terminal</em> :</p>
<div class="code"><pre class="code literal-block">git config --global credential.helper osxkeychain
</pre></div>

<p>It enables Git to use file Keychain.app to store username and password and to
retrieve the passphrase to your private SSH key from the keychain.</p>
<p>For Windows use:</p>
<div class="code"><pre class="code literal-block">git config --global credential.helper wincred
</pre></div>

<p>For Linux use:</p>
<div class="code"><pre class="code literal-block"><span class="nv">git</span><span class="w"> </span><span class="nv">config</span><span class="w"> </span><span class="o">--</span><span class="nv">global</span><span class="w"> </span><span class="nv">credential</span>.<span class="nv">helper</span><span class="w"> </span><span class="nv">cache</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">want</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">cache</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">credentials</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">some</span><span class="w"> </span><span class="nv">time</span><span class="w"> </span><span class="ss">(</span><span class="nv">default</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="nv">minutes</span><span class="ss">)</span>
</pre></div>

<p>OR</p>
<div class="code"><pre class="code literal-block"><span class="nv">git</span><span class="w"> </span><span class="nv">config</span><span class="w"> </span><span class="o">--</span><span class="nv">global</span><span class="w"> </span><span class="nv">credential</span>.<span class="nv">helper</span><span class="w"> </span><span class="nv">store</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">want</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">store</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">credentials</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">ever</span><span class="w"> </span><span class="ss">(</span><span class="nv">considered</span><span class="w"> </span><span class="nv">unsafe</span><span class="ss">)</span>
</pre></div>

<p>Note: The first method will cache the credentials in memory, whereas the
second will store them in <code>~/.git-credentials</code> in plain text format.</p>
<p>Check here for more info about Linux method.<br>
Check here for more info about all three.</p>
<h3>Troubleshooting</h3>
<p>If the Git credential helper is configured correctly macOS saves the
passphrase in the keychain. Sometimes the connection between SSH and the
passphrases stored in the keychain can break. Run <code>ssh-add -K</code> or <code>ssh-add
~/.ssh/id_rsa</code> to add the key to keychain again.</p>
<h3>macOS v10.12 (Sierra) changes to ssh</h3>
<p>For macOS v10.12 (Sierra), <code>ssh-add -K</code> needs to be run after every reboot. To
avoid this, create <code>~/.ssh/config</code> with this content.</p>
<div class="code"><pre class="code literal-block">Host *
    AddKeysToAgent yes
    UseKeychain yes
    IdentityFile ~/.ssh/id_rsa
</pre></div>

<p>From the <code>ssh_config</code> <code>man</code> page on 10.12.2:</p>
<blockquote>
<p><strong>UseKeychain</strong></p>
<p>On macOS, specifies whether the system should search for passphrases in the
user's keychain when attempting to use a particular key. When the passphrase
is provided by the user, this option also specifies whether the passphrase
should be stored into the keychain once it has been verified to be correct.
The argument must be 'yes' or 'no'. The default is 'no'.</p>
</blockquote>
<p>Apple has added Technote 2449 which explains what happened.</p>
<blockquote>
<p>Prior to macOS Sierra, <code>ssh</code> would present a dialog asking for your
passphrase and would offer the option to store it into the keychain. This UI
was deprecated some time ago and has been removed.</p>
</blockquote>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-disable-python-warnings/" class="u-url">How to disable Python warnings?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-disable-python-warnings/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T13:11:53+08:00" itemprop="datePublished" title="2023-02-17 13:11">2023-02-17 13:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am working with code that throws a lot of (for me at the moment) useless
warnings using the <code>warnings</code> library. Reading (/scanning) the documentation I
only found a way to disable warnings for single functions. But I don't want to
change so much of the code.</p>
<p>Is there a flag like <code>python -no-warning foo.py</code>?</p>
<p>What would you recommend?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>There's the <code>-W</code> option.</p>
<div class="code"><pre class="code literal-block">python -W ignore foo.py
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>There's the <code>-W</code> option.</p>
<div class="code"><pre class="code literal-block">python -W ignore foo.py
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-implement-basic-long-polling/" class="u-url">How do I implement basic "Long Polling"?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-implement-basic-long-polling/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T13:11:25+08:00" itemprop="datePublished" title="2023-02-17 13:11">2023-02-17 13:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I can find lots of information on how Long Polling works (For example, this,
and this), but no <em>simple</em> examples of how to implement this in code.</p>
<p>All I can find is cometd, which relies on the Dojo JS framework, and a fairly
complex server system..</p>
<p>Basically, how would I use Apache to serve the requests, and how would I write
a simple script (say, in PHP) which would "long-poll" the server for new
messages?</p>
<p>The example doesn't have to be scaleable, secure or complete, it just needs to
work!</p>
<p><br><br></p>
<h2>Answer</h2>
<p>It's simpler than I initially thought.. Basically you have a page that does
nothing, until the data you want to send is available (say, a new message
arrives).</p>
<p>Here is a really basic example, which sends a simple string after 2-10
seconds. 1 in 3 chance of returning an error 404 (to show error handling in
the coming Javascript example)</p>
<p><code>msgsrv.php</code></p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="k">if</span><span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
    <span class="cm">/* Fake an error */</span>
    <span class="nb">header</span><span class="p">(</span><span class="s2">"HTTP/1.0 404 Not Found"</span><span class="p">);</span>
    <span class="k">die</span><span class="p">();</span>
<span class="p">}</span>

<span class="cm">/* Send a string after a random number of seconds (2-10) */</span>
<span class="nb">sleep</span><span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">));</span>
<span class="k">echo</span><span class="p">(</span><span class="s2">"Hi! Have a random number: "</span> <span class="o">.</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">));</span>
<span class="cp">?&gt;</span>
</pre></div>

<p>Note: With a real site, running this on a regular web-server like Apache will
quickly tie up all the "worker threads" and leave it unable to respond to
other requests.. There are ways around this, but it is recommended to write a
"long-poll server" in something like Python's twisted, which does not rely on
one thread per request. cometD is an popular one (which is available in
several languages), and Tornado is a new framework made specifically for such
tasks (it was built for FriendFeed's long-polling code)... but as a simple
example, Apache is more than adequate! This script could easily be written in
any language (I chose Apache/PHP as they are very common, and I happened to be
running them locally)</p>
<p>Then, in Javascript, you request the above file (<code>msg_srv.php</code>), and wait for
a response. When you get one, you act upon the data. Then you request the file
and wait again, act upon the data (and repeat)</p>
<p>What follows is an example of such a page.. When the page is loaded, it sends
the initial request for the <code>msgsrv.php</code> file.. If it succeeds, we append the
message to the <code>#messages</code> div, then after 1 second we call the waitForMsg
function again, which triggers the wait.</p>
<p>The 1 second <code>setTimeout()</code> is a really basic rate-limiter, it works fine
without this, but if <code>msgsrv.php</code> <em>always</em> returns instantly (with a syntax
error, for example) - you flood the browser and it can quickly freeze up. This
would better be done checking if the file contains a valid JSON response,
and/or keeping a running total of requests-per-minute/second, and pausing
appropriately.</p>
<p>If the page errors, it appends the error to the <code>#messages</code> div, waits 15
seconds and then tries again (identical to how we wait 1 second after each
message)</p>
<p>The nice thing about this approach is it is very resilient. If the clients
internet connection dies, it will timeout, then try and reconnect - this is
inherent in how long polling works, no complicated error-handling is required</p>
<p>Anyway, the <code>long_poller.htm</code> code, using the jQuery framework:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="w">    </span><span class="nt">&lt;title&gt;</span>BargePoller<span class="nt">&lt;/title&gt;</span>
<span class="w">    </span><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"</span><span class="w"> </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="w"> </span><span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="w">    </span><span class="nt">&lt;style</span><span class="w"> </span><span class="na">type=</span><span class="s">"text/css"</span><span class="w"> </span><span class="na">media=</span><span class="s">"screen"</span><span class="nt">&gt;</span>
<span class="w">      </span>body{<span class="w"> </span>background:#000;color:#fff;font-size:.9em;<span class="w"> </span>}
<span class="w">      </span>.msg{<span class="w"> </span>background:#aaa;padding:.2em;<span class="w"> </span>border-bottom:1px<span class="w"> </span>#000<span class="w"> </span>solid}
<span class="w">      </span>.old{<span class="w"> </span>background-color:#246499;}
<span class="w">      </span>.new{<span class="w"> </span>background-color:#3B9957;}
<span class="w">    </span>.error{<span class="w"> </span>background-color:#992E36;}
<span class="w">    </span><span class="nt">&lt;/style&gt;</span>

<span class="w">    </span><span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="w"> </span><span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
<span class="w">    </span>function<span class="w"> </span>addmsg(type,<span class="w"> </span>msg){
<span class="w">        </span>/*<span class="w"> </span>Simple<span class="w"> </span>helper<span class="w"> </span>to<span class="w"> </span>add<span class="w"> </span>a<span class="w"> </span>div.
<span class="w">        </span>type<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>name<span class="w"> </span>of<span class="w"> </span>a<span class="w"> </span>CSS<span class="w"> </span>class<span class="w"> </span>(old/new/error).
<span class="w">        </span>msg<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>contents<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>div<span class="w"> </span>*/
<span class="w">        </span>$("#messages").append(
<span class="w">            </span>"<span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">'msg "+ type +"'</span><span class="nt">&gt;</span>"+<span class="w"> </span>msg<span class="w"> </span>+"<span class="nt">&lt;/div&gt;</span>"
<span class="w">        </span>);
<span class="w">    </span>}

<span class="w">    </span>function<span class="w"> </span>waitForMsg(){
<span class="w">        </span>/*<span class="w"> </span>This<span class="w"> </span>requests<span class="w"> </span>the<span class="w"> </span>url<span class="w"> </span>"msgsrv.php"
<span class="w">        </span>When<span class="w"> </span>it<span class="w"> </span>complete<span class="w"> </span>(or<span class="w"> </span>errors)*/
<span class="w">        </span>$.ajax({
<span class="w">            </span>type:<span class="w"> </span>"GET",
<span class="w">            </span>url:<span class="w"> </span>"msgsrv.php",

<span class="w">            </span>async:<span class="w"> </span>true,<span class="w"> </span>/*<span class="w"> </span>If<span class="w"> </span>set<span class="w"> </span>to<span class="w"> </span>non-async,<span class="w"> </span>browser<span class="w"> </span>shows<span class="w"> </span>page<span class="w"> </span>as<span class="w"> </span>"Loading.."*/
<span class="w">            </span>cache:<span class="w"> </span>false,
<span class="w">            </span>timeout:50000,<span class="w"> </span>/*<span class="w"> </span>Timeout<span class="w"> </span>in<span class="w"> </span>ms<span class="w"> </span>*/

<span class="w">            </span>success:<span class="w"> </span>function(data){<span class="w"> </span>/*<span class="w"> </span>called<span class="w"> </span>when<span class="w"> </span>request<span class="w"> </span>to<span class="w"> </span>barge.php<span class="w"> </span>completes<span class="w"> </span>*/
<span class="w">                </span>addmsg("new",<span class="w"> </span>data);<span class="w"> </span>/*<span class="w"> </span>Add<span class="w"> </span>response<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>.msg<span class="w"> </span>div<span class="w"> </span>(with<span class="w"> </span>the<span class="w"> </span>"new"<span class="w"> </span>class)*/
<span class="w">                </span>setTimeout(
<span class="w">                    </span>waitForMsg,<span class="w"> </span>/*<span class="w"> </span>Request<span class="w"> </span>next<span class="w"> </span>message<span class="w"> </span>*/
<span class="w">                    </span>1000<span class="w"> </span>/*<span class="w"> </span>..after<span class="w"> </span>1<span class="w"> </span>seconds<span class="w"> </span>*/
<span class="w">                </span>);
<span class="w">            </span>},
<span class="w">            </span>error:<span class="w"> </span>function(XMLHttpRequest,<span class="w"> </span>textStatus,<span class="w"> </span>errorThrown){
<span class="w">                </span>addmsg("error",<span class="w"> </span>textStatus<span class="w"> </span>+<span class="w"> </span>"<span class="w"> </span>("<span class="w"> </span>+<span class="w"> </span>errorThrown<span class="w"> </span>+<span class="w"> </span>")");
<span class="w">                </span>setTimeout(
<span class="w">                    </span>waitForMsg,<span class="w"> </span>/*<span class="w"> </span>Try<span class="w"> </span>again<span class="w"> </span>after..<span class="w"> </span>*/
<span class="w">                    </span>15000);<span class="w"> </span>/*<span class="w"> </span>milliseconds<span class="w"> </span>(15seconds)<span class="w"> </span>*/
<span class="w">            </span>}
<span class="w">        </span>});
<span class="w">    </span>};

<span class="w">    </span>$(document).ready(function(){
<span class="w">        </span>waitForMsg();<span class="w"> </span>/*<span class="w"> </span>Start<span class="w"> </span>the<span class="w"> </span>inital<span class="w"> </span>request<span class="w"> </span>*/
<span class="w">    </span>});
<span class="w">    </span><span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">"messages"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"msg old"</span><span class="nt">&gt;</span>
<span class="w">            </span>BargePoll<span class="w"> </span>message<span class="w"> </span>requester!
<span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I've got a really simple chat example as part of slosh.</p>
<p><strong>Edit</strong> : (since everyone's pasting their code in here)</p>
<p>This is the complete JSON-based multi-user chat using long-polling and slosh.
This is a <strong>demo</strong> of how to do the calls, so please ignore the XSS problems.
Nobody should deploy this without sanitizing it first.</p>
<p>Notice that the client <em>always</em> has a connection to the server, and as soon as
anyone sends a message, everyone should see it roughly instantly.</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"</span>
<span class="cp">  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;</span>
<span class="cm">&lt;!-- Copyright (c) 2008 Dustin Sallings &lt;dustin+html@spy.net&gt; --&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">"en"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>slosh chat<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span>
      <span class="na">src</span><span class="o">=</span><span class="s">"http://code.jquery.com/jquery-latest.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">title</span><span class="o">=</span><span class="s">"Default"</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">media</span><span class="o">=</span><span class="s">"screen"</span> <span class="na">href</span><span class="o">=</span><span class="s">"style.css"</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome to Slosh Chat<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"messages"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"from"</span><span class="p">&gt;</span>First!:<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"msg"</span><span class="p">&gt;</span>Welcome to chat. Please don't hurt each other.<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span> <span class="na">action</span><span class="o">=</span><span class="s">"#"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Nick: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">'from'</span> <span class="na">type</span><span class="o">=</span><span class="s">"text"</span> <span class="na">name</span><span class="o">=</span><span class="s">"from"</span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Message:<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">'msg'</span> <span class="na">name</span><span class="o">=</span><span class="s">"msg"</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Say it"</span> <span class="na">id</span><span class="o">=</span><span class="s">"submit"</span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span><span class="p">&gt;</span>
<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">gotData</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span><span class="w"> </span><span class="nx">st</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">msgs</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="s1">'#messages'</span><span class="p">);</span>
<span class="w">        </span><span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="kd">var</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="kr">from</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span>
<span class="w">          </span><span class="kd">var</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">msg</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span>
<span class="w">          </span><span class="nx">msgs</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"&lt;div&gt;&lt;span class='from'&gt;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">":&lt;/span&gt;"</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="s2">" &lt;span class='msg'&gt;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"&lt;/span&gt;&lt;/div&gt;"</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// The jQuery wrapped msgs above does not work here.</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">msgs</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"messages"</span><span class="p">);</span>
<span class="w">        </span><span class="nx">msgs</span><span class="p">.</span><span class="nx">scrollTop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msgs</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">getNewComments</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">'/topics/chat.json'</span><span class="p">,</span><span class="w"> </span><span class="nx">gotData</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ajaxStop</span><span class="p">(</span><span class="nx">getNewComments</span><span class="p">);</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s2">"form"</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/topics/chat'</span><span class="p">,</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">'form'</span><span class="p">).</span><span class="nx">serialize</span><span class="p">());</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="nx">getNewComments</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-683.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-681.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
