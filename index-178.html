<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 178) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-178.html">
<link rel="prev" href="index-179.html" type="text/html">
<link rel="next" href="index-177.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/where-should-i-put-script-tags-in-html-markup/" class="u-url">Where should I put &lt;script&gt; tags in HTML markup?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/where-should-i-put-script-tags-in-html-markup/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T00:00:46+08:00" itemprop="datePublished" title="2023-02-17 00:00">2023-02-17 00:00</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>When embedding JavaScript in an HTML document, where is the proper place to
put the <code>&lt;script&gt;</code> tags and included JavaScript? I seem to recall that you are
not supposed to place these in the <code>&lt;head&gt;</code> section, but placing at the
beginning of the <code>&lt;body&gt;</code> section is bad, too, since the JavaScript will have
to be parsed before the page is rendered completely (or something like that).
This seems to leave the <em>end</em> of the <code>&lt;body&gt;</code> section as a logical place for
<code>&lt;script&gt;</code> tags.</p>
<p>So, where <em>is</em> the right place to put the <code>&lt;script&gt;</code> tags?</p>
<p>(This question references this question, in which it was suggested that
JavaScript function calls should be moved from <code>&lt;a&gt;</code> tags to <code>&lt;script&gt;</code> tags.
I'm specifically using jQuery, but more general answers are also appropriate.)</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Here's what happens when a browser loads a website with a <code>&lt;script&gt;</code> tag on
it:</p>
<ol>
<li>Fetch the HTML page (e.g. <em>index.html</em> )</li>
<li>Begin parsing the HTML</li>
<li>The parser encounters a <code>&lt;script&gt;</code> tag referencing an external script file.</li>
<li>The browser requests the script file. Meanwhile, the parser blocks and stops parsing the other HTML on your page.</li>
<li>After some time the script is downloaded and subsequently executed.</li>
<li>The parser continues parsing the rest of the HTML document.</li>
</ol>
<p>Step #4 causes a bad user experience. Your website basically stops loading
until you've downloaded all scripts. If there's one thing that users hate it's
waiting for a website to load.</p>
<h3>Why does this even happen?</h3>
<p>Any script can insert its own HTML via <code>document.write()</code> or other DOM
manipulations. This implies that the parser has to wait until the script has
been downloaded and executed before it can safely parse the rest of the
document. After all, the script <em>could</em> have inserted its own HTML in the
document.</p>
<p>However, most JavaScript developers no longer manipulate the DOM <em>while</em> the
document is loading. Instead, they wait until the document has been loaded
before modifying it. For example:</p>
<div class="code"><pre class="code literal-block"><span class="cm">&lt;!-- index.html --&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="w">    </span><span class="nt">&lt;head&gt;</span>
<span class="w">        </span><span class="nt">&lt;title&gt;</span>My<span class="w"> </span>Page<span class="nt">&lt;/title&gt;</span>
<span class="w">        </span><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"my-script.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="w">    </span><span class="nt">&lt;/head&gt;</span>
<span class="w">    </span><span class="nt">&lt;body&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">"user-greeting"</span><span class="nt">&gt;</span>Welcome<span class="w"> </span>back,<span class="w"> </span>user<span class="nt">&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<p>JavaScript:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// my-script.js</span>
<span class="n">document</span><span class="p">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="s">"DOMContentLoaded"</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// this function runs when the DOM is ready, i.e. when the document has been parsed</span>
<span class="w">    </span><span class="n">document</span><span class="p">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s">"user-greeting"</span><span class="p">).</span><span class="n">textContent</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">"Welcome back, Bart"</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>Because your browser does not know <em>my-script.js</em> isn't going to modify the
document until it has been downloaded and executed, the parser stops parsing.</p>
<h3>Antiquated recommendation</h3>
<p>The old approach to solving this problem was to put <code>&lt;script&gt;</code> tags at the
bottom of your <code>&lt;body&gt;</code>, because this ensures the parser isn't blocked until
the very end.</p>
<p>This approach has its own problem: the browser cannot start downloading the
scripts until the entire document is parsed. For larger websites with large
scripts and stylesheets, being able to download the script as soon as possible
is very important for performance. If your website doesn't load within 2
seconds, people will go to another website.</p>
<p>In an optimal solution, the browser would start downloading your scripts as
soon as possible, while at the same time parsing the rest of your document.</p>
<h3>The modern approach</h3>
<p>Today, browsers support the <code>async</code> and <code>defer</code> attributes on scripts. These
attributes tell the browser it's safe to continue parsing while the scripts
are being downloaded.</p>
<h4>async</h4>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"path/to/script1.js"</span><span class="w"> </span><span class="err">async</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"path/to/script2.js"</span><span class="w"> </span><span class="err">async</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>

<p>Scripts with the async attribute are executed asynchronously. This means the
script is executed as soon as it's downloaded, without blocking the browser in
the meantime. This implies that it's possible that script 2 is downloaded and
executed before script 1.</p>
<p>According to http://caniuse.com/#feat=script-async, 97.78% of all browsers
support this.</p>
<h4>defer</h4>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"path/to/script1.js"</span><span class="w"> </span><span class="err">defer</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"path/to/script2.js"</span><span class="w"> </span><span class="err">defer</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></div>

<p>Scripts with the defer attribute are executed in order (i.e. first script 1,
then script 2). This also does not block the browser.</p>
<p>Unlike async scripts, defer scripts are only executed after the entire
document has been loaded.</p>
<p><em>(To learn more and see some really helpful visual representations of the
differences between async, defer and normal scripts check the first two links
at the references section of this answer)</em></p>
<h2>Conclusion</h2>
<p>The current state-of-the-art is to put scripts in the <code>&lt;head&gt;</code> tag and use the
<code>async</code> or <code>defer</code> attributes. This allows your scripts to be downloaded ASAP
without blocking your browser.</p>
<p>The good thing is that your website should still load correctly on the 2% of
browsers that do not support these attributes while speeding up the other 98%.</p>
<h3>References</h3>
<ul>
<li>async vs defer attributes</li>
<li>Efficiently load JavaScript with defer and async</li>
<li>Remove Render-Blocking JavaScript</li>
<li>Async, Defer, Modules: A Visual Cheatsheet</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>Just before the closing body tag, as stated on <em>Put Scripts at the Bottom</em> :</p>
<blockquote>
<p>Put Scripts at the Bottom</p>
<p>The problem caused by scripts is that they block parallel downloads. The
HTTP/1.1 specification suggests that browsers download no more than two
components in parallel per hostname. If you serve your images from multiple
hostnames, you can get more than two downloads to occur in parallel. While a
script is downloading, however, the browser won't start any other downloads,
even on different hostnames.</p>
</blockquote>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/installing-specific-package-version-with-pip/" class="u-url">Installing specific package version with pip</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/installing-specific-package-version-with-pip/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T00:00:15+08:00" itemprop="datePublished" title="2023-02-17 00:00">2023-02-17 00:00</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am trying to install version 1.2.2 of <code>MySQL_python</code>, using a fresh
virtualenv created with the <code>--no-site-packages</code> option. The current version
shown in PyPi is 1.2.3. Is there a way to install the older version? I have
tried:</p>
<div class="code"><pre class="code literal-block">pip install MySQL_python==1.2.2
</pre></div>

<p>However, when installed, it still shows <code>MySQL_python-1.2.3-py2.6.egg-info</code> in
the site packages. Is this a problem specific to this package, or am I doing
something wrong?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>TL;DR</strong> :</p>
<p><strong>Update as of 2022-12-28</strong> :</p>
<p><code>pip install --force-reinstall -v</code></p>
<p>For example: <code>pip install --force-reinstall -v "MySQL_python==1.2.2"</code></p>
<p>What these options mean:</p>
<ul>
<li>
<code>--force-reinstall</code> is an option to reinstall all packages even if they are already up-to-date.</li>
<li>
<code>-v</code> is for verbose. You can combine for even more verbosity (i.e. <code>-vv</code>) up to 3 times (e.g. <code>--force-reinstall -vvv</code>).</li>
</ul>
<p>Thanks to @Peter for highlighting this (and it seems that the context of the
question has broadened given the time when the question was first asked!), the
documentation for Python discusses a caveat with using <code>-I</code>, in that it can
break your installation if it was installed with a different package manager
or if if your package is/was a different version.</p>
<hr>
<p>Original answer:</p>
<ul>
<li>
<code>pip install -Iv</code> (i.e. <code>pip install -Iv MySQL_python==1.2.2</code>)</li>
</ul>
<hr>
<p>What these options mean:</p>
<ul>
<li>
<code>-I</code> stands for <code>--ignore-installed</code> which will ignore the installed packages, overwriting them.</li>
<li>
<code>-v</code> is for verbose. You can combine for even more verbosity (i.e. <code>-vv</code>) up to 3 times (e.g. <code>-Ivvv</code>).</li>
</ul>
<p>For more information, see <code>pip install --help</code></p>
<p>First, I see two issues with what you're trying to do. Since you already have
an installed version, you should either uninstall the current existing driver
or use <code>pip install -I MySQL_python==1.2.2</code></p>
<p>However, you'll soon find out that this doesn't work. If you look at pip's
installation log, or if you do a <code>pip install -Iv MySQL_python==1.2.2</code> you'll
find that the PyPI URL link does not work for MySQL_python v1.2.2. You can
verify this here: http://pypi.python.org/pypi/MySQL-python/1.2.2</p>
<p>The download link 404s and the fallback URL links are re-directing infinitely
due to sourceforge.net's recent upgrade and PyPI's stale URL.</p>
<p>So to properly install the driver, you can follow these steps:</p>
<div class="code"><pre class="code literal-block"><span class="n">pip</span><span class="w"> </span><span class="n">uninstall</span><span class="w"> </span><span class="n">MySQL_python</span>
<span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">Iv</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sourceforge</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">mysql</span><span class="o">-</span><span class="n">python</span><span class="o">/</span><span class="n">files</span><span class="o">/</span><span class="n">mysql</span><span class="o">-</span><span class="n">python</span><span class="o">/</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">2</span><span class="o">/</span><span class="n">MySQL</span><span class="o">-</span><span class="n">python</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mf">2.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span><span class="o">/</span><span class="n">download</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You can even use a version range with <code>pip install</code> command. Something like
this:</p>
<div class="code"><pre class="code literal-block">pip install 'stevedore&gt;=1.3.0,&lt;1.4.0'
</pre></div>

<p>And if the package is already installed and you want to downgrade it add
<code>--force-reinstall</code> like this:</p>
<div class="code"><pre class="code literal-block">pip install 'stevedore&gt;=1.3.0,&lt;1.4.0' --force-reinstall
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-access-the-correct-this-inside-a-callback/" class="u-url">How to access the correct `this` inside a callback</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-access-the-correct-this-inside-a-callback/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T23:59:45+08:00" itemprop="datePublished" title="2023-02-16 23:59">2023-02-16 23:59</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a constructor function which registers an event handler:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">MyConstructor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">transport</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">    </span><span class="n">transport</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">alert</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">Mock</span><span class="w"> </span><span class="n">transport</span><span class="w"> </span><span class="n">object</span>
<span class="k">var</span><span class="w"> </span><span class="n">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">on</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">setTimeout</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="o">//</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="k">as</span>
<span class="k">var</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MyConstructor</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="n">transport</span><span class="p">);</span>
</pre></div>

<p>However, I'm not able to access the <code>data</code> property of the created object
inside the callback. It looks like <code>this</code> does not refer to the object that
was created, but to another one.</p>
<p>I also tried to use an object method instead of an anonymous function:</p>
<div class="code"><pre class="code literal-block">function MyConstructor(data, transport) {
    this.data = data;
    transport.on('data', this.alert);
}

MyConstructor.prototype.alert = function() {
    alert(this.name);
};
</pre></div>

<p>but it exhibits the same problems.</p>
<p>How can I access the correct object?</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>What you should know about <code>this</code>
</h3>
<p><code>this</code> (aka "the context") is a special keyword inside each function and its
value only depends on <em>how</em> the function was called, not how/when/where it was
defined. It is not affected by lexical scopes like other variables (except for
arrow functions, see below). Here are some examples:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<span class="err">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">call</span>
<span class="n">foo</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`this`</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">refer</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n n-Quoted">`window`</span>

<span class="o">//</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">method</span>
<span class="n">var</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="n">bar</span><span class="o">:</span><span class="w"> </span><span class="n">foo</span><span class="err">}</span><span class="p">;</span>
<span class="n">obj</span><span class="p">.</span><span class="n">bar</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`this`</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">refer</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n n-Quoted">`obj`</span>

<span class="o">//</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="k">function</span>
<span class="k">new</span><span class="w"> </span><span class="n">foo</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`this`</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">refer</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">inherits</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n n-Quoted">`foo.prototype`</span>
</pre></div>

<p>To learn more about <code>this</code>, have a look at the MDN documentation.</p>
<hr>
<h3>How to refer to the correct <code>this</code>
</h3>
<h4>Use arrow functions</h4>
<p>ECMAScript 6 introduced <em>arrow functions</em> , which can be thought of as lambda
functions. They don't have their own <code>this</code> binding. Instead, <code>this</code> is looked
up in scope just like a normal variable. That means you don't have to call
<code>.bind</code>. That's not the only special behavior they have, please refer to the
MDN documentation for more information.</p>
<div class="code"><pre class="code literal-block">function MyConstructor(data, transport) {
    this.data = data;
    transport.on('data', () =&gt; alert(this.data));
}
</pre></div>

<h4>Don't use <code>this</code>
</h4>
<p>You actually don't want to access <code>this</code> in particular, but <em>the object it
refers to</em>. That's why an easy solution is to simply create a new variable
that also refers to that object. The variable can have any name, but common
ones are <code>self</code> and <code>that</code>.</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">MyConstructor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">transport</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="bp">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="w">    </span><span class="n">transport</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">alert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>Since <code>self</code> is a normal variable, it obeys lexical scope rules and is
accessible inside the callback. This also has the advantage that you can
access the <code>this</code> value of the callback itself.</p>
<h4>Explicitly set <code>this</code> of the callback - part 1</h4>
<p>It might look like you have no control over the value of <code>this</code> because its
value is set automatically, but that is actually not the case.</p>
<p>Every function has the method <code>.bind</code> <em>[docs]</em> , which returns a new function
with <code>this</code> bound to a value. The function has exactly the same behavior as
the one you called <code>.bind</code> on, only that <code>this</code> was set by you. No matter how
or when that function is called, <code>this</code> will always refer to the passed value.</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">MyConstructor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">transport</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">boundFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">parenthesis</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">necessary</span>
<span class="w">        </span><span class="n">alert</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">data</span><span class="p">);</span><span class="w">             </span><span class="o">//</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">improve</span><span class="w"> </span><span class="n">readability</span>
<span class="w">    </span><span class="p">})</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">this</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">calling</span><span class="w"> </span><span class="err">`</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span><span class="err">`</span><span class="w"> </span>
<span class="w">    </span><span class="n">transport</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span><span class="w"> </span><span class="n">boundFunction</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>In this case, we are binding the callback's <code>this</code> to the value of
<code>MyConstructor</code>'s <code>this</code>.</p>
<p><strong>Note:</strong> When a binding context for jQuery, use <code>jQuery.proxy</code> <em>[docs]</em>
instead. The reason to do this is so that you don't need to store the
reference to the function when unbinding an event callback. jQuery handles
that internally.</p>
<h4>Set <code>this</code> of the callback - part 2</h4>
<p>Some functions/methods which accept callbacks also accept a value to which the
callback's <code>this</code> should refer to. This is basically the same as binding it
yourself, but the function/method does it for you. <code>Array#map</code> <em>[docs]</em> is
such a method. Its signature is:</p>
<div class="code"><pre class="code literal-block">array.map(callback[, thisArg])
</pre></div>

<p>The first argument is the callback and the second argument is the value <code>this</code>
should refer to. Here is a contrived example:</p>
<div class="code"><pre class="code literal-block"><span class="n">var</span><span class="w"> </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="err">]</span><span class="p">;</span>
<span class="n">var</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="n">multiplier</span><span class="o">:</span><span class="w"> </span><span class="mi">42</span><span class="err">}</span><span class="p">;</span>

<span class="n">var</span><span class="w"> </span><span class="n">new_arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">multiplier</span><span class="p">;</span>
<span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">passing</span><span class="w"> </span><span class="n n-Quoted">`obj`</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">second</span><span class="w"> </span><span class="n">argument</span>
</pre></div>

<p><strong>Note:</strong> Whether or not you can pass a value for <code>this</code> is usually mentioned
in the documentation of that function/method. For example, jQuery's <code>$.ajax</code>
method <em>[docs]</em> describes an option called <code>context</code>:</p>
<blockquote>
<p>This object will be made the context of all Ajax-related callbacks.</p>
</blockquote>
<hr>
<h3>Common problem: Using object methods as callbacks/event handlers</h3>
<p>Another common manifestation of this problem is when an object method is used
as callback/event handler. Functions are first-class citizens in JavaScript
and the term "method" is just a colloquial term for a function that is a value
of an object property. But that function doesn't have a specific link to its
"containing" object.</p>
<p>Consider the following example:</p>
<div class="code"><pre class="code literal-block">function Foo() {
    this.data = 42,
    document.body.onclick = this.method;
}

Foo.prototype.method = function() {
    console.log(this.data);
};
</pre></div>

<p>The function <code>this.method</code> is assigned as click event handler, but if the
<code>document.body</code> is clicked, the value logged will be <code>undefined</code>, because
inside the event handler, <code>this</code> refers to the <code>document.body</code>, not the
instance of <code>Foo</code>.<br>
As already mentioned at the beginning, what <code>this</code> refers to depends on how
the function is <strong>called</strong> , not how it is <strong>defined</strong>.<br>
If the code was like the following, it might be more obvious that the function
doesn't have an implicit reference to the object:</p>
<div class="code"><pre class="code literal-block">function method() {
    console.log(this.data);
}


function Foo() {
    this.data = 42,
    document.body.onclick = this.method;
}

Foo.prototype.method = method;
</pre></div>

<p><strong>The solution</strong> is the same as mentioned above: If available, use <code>.bind</code> to
explicitly bind <code>this</code> to a specific value</p>
<div class="code"><pre class="code literal-block">document.body.onclick = this.method.bind(this);
</pre></div>

<p>or explicitly call the function as a "method" of the object, by using an
anonymous function as callback / event handler and assign the object (<code>this</code>)
to another variable:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="bp">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>

<p>or use an arrow function:</p>
<div class="code"><pre class="code literal-block">document.body.onclick = () =&gt; this.method();
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<h3>Here are several ways to access the parent context inside a child context -</h3>
<ol>
<li>You can use the <code>bind()</code> function.</li>
<li>Store a reference to context/this inside another variable (see the below example).</li>
<li>Use ES6 Arrow functions.</li>
<li>Alter the code, function design, and architecture - for this you should have command over design patterns in JavaScript.</li>
</ol>
<h2>1. Use the <code>bind()</code> function</h2>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">MyConstructor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">transport</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">    </span><span class="n">transport</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">alert</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">})</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
<span class="o">//</span><span class="w"> </span><span class="n">Mock</span><span class="w"> </span><span class="n">transport</span><span class="w"> </span><span class="n">object</span>
<span class="k">var</span><span class="w"> </span><span class="n">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">on</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">setTimeout</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="o">//</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="k">as</span>
<span class="k">var</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MyConstructor</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="n">transport</span><span class="p">);</span>
</pre></div>

<p>If you are using Underscore.js - http://underscorejs.org/#bind</p>
<div class="code"><pre class="code literal-block">transport.on('data', _.bind(function () {
    alert(this.data);
}, this));
</pre></div>

<h2>2. Store a reference to context/this inside another variable</h2>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">MyConstructor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">transport</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="bp">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="w">  </span><span class="n">this</span><span class="o">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">  </span><span class="n">transport</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">alert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>
</pre></div>

<h2>3. Arrow function</h2>
<div class="code"><pre class="code literal-block">function MyConstructor(data, transport) {
  this.data = data;
  transport.on('data', () =&gt; {
    alert(this.data);
  });
}
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-179.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-177.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
