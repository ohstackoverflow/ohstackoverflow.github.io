<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 385) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-385.html">
<link rel="prev" href="index-386.html" type="text/html">
<link rel="next" href="index-384.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/shi-yong-android-xia-zai-wen-jian-bing-zai-progressdialog-zhong-xian-shi-jin-du/" class="u-url">使用 Android 下载文件，并在 ProgressDialog 中显示进度</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/shi-yong-android-xia-zai-wen-jian-bing-zai-progressdialog-zhong-xian-shi-jin-du/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:35:30+08:00" itemprop="datePublished" title="2023-02-17 05:35">2023-02-17 05:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我正在尝试编写一个可以更新的简单应用程序。为此，我需要一个简单的功能，可以下载文件 <em>并</em> 在<code>ProgressDialog</code>.
我知道该怎么做<code>ProgressDialog</code>，但我不确定如何显示当前进度以及如何首先下载文件。</p>
<p><br><br></p>
<h2>解答</h2>
<p>下载文件的方法有很多种。下面我将发布最常见的方式；由您决定哪种方法更适合您的应用程序。</p>
<ol>
<li>使用<code>AsyncTask</code>并在对话框中显示下载进度 ========================================= ====================</li>
</ol>
<p>此方法将允许您执行一些后台进程并同时更新 UI（在本例中，我们将更新进度条）。</p>
<p>进口：</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">android.os.PowerManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.net.HttpURLConnection</span><span class="p">;</span>
</pre></div>

<p>这是一个示例代码：</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">declare</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dialog</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">member</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">activity</span>
<span class="n">ProgressDialog</span><span class="w"> </span><span class="n">mProgressDialog</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">onCreate</span><span class="w"> </span><span class="n">method</span>
<span class="n">mProgressDialog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ProgressDialog</span><span class="p">(</span><span class="n">YourActivity</span><span class="o">.</span><span class="n">this</span><span class="p">);</span>
<span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setMessage</span><span class="p">(</span><span class="s2">"A message"</span><span class="p">);</span>
<span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setIndeterminate</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span>
<span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setProgressStyle</span><span class="p">(</span><span class="n">ProgressDialog</span><span class="o">.</span><span class="n">STYLE_HORIZONTAL</span><span class="p">);</span>
<span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setCancelable</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span>

<span class="o">//</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">downloader</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">fired</span>
<span class="n">final</span><span class="w"> </span><span class="n">DownloadTask</span><span class="w"> </span><span class="n">downloadTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DownloadTask</span><span class="p">(</span><span class="n">YourActivity</span><span class="o">.</span><span class="n">this</span><span class="p">);</span>
<span class="n">downloadTask</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"the url to the file you want to download"</span><span class="p">);</span>

<span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setOnCancelListener</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">DialogInterface</span><span class="o">.</span><span class="n">OnCancelListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCancel</span><span class="p">(</span><span class="n">DialogInterface</span><span class="w"> </span><span class="n">dialog</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">downloadTask</span><span class="o">.</span><span class="n">cancel</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">cancel</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">task</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>

<p>将<code>AsyncTask</code>看起来像这样：</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">usually</span><span class="p">,</span><span class="w"> </span><span class="n">subclasses</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">AsyncTask</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">declared</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">activity</span><span class="w"> </span><span class="k">class</span><span class="o">.</span>
<span class="o">//</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">way</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">easily</span><span class="w"> </span><span class="n">modify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">here</span>
<span class="n">private</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">DownloadTask</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">AsyncTask</span><span class="o">&lt;</span><span class="nb nb-Type">String</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">PowerManager</span><span class="o">.</span><span class="n">WakeLock</span><span class="w"> </span><span class="n">mWakeLock</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">DownloadTask</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">this</span><span class="o">.</span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">doInBackground</span><span class="p">(</span><span class="nb nb-Type">String</span><span class="o">...</span><span class="w"> </span><span class="n">sUrl</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">InputStream</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">        </span><span class="n">OutputStream</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">        </span><span class="n">HttpURLConnection</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">        </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">URL</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">sUrl</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">            </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">HttpURLConnection</span><span class="p">)</span><span class="w"> </span><span class="n">url</span><span class="o">.</span><span class="n">openConnection</span><span class="p">();</span>
<span class="w">            </span><span class="n">connection</span><span class="o">.</span><span class="n">connect</span><span class="p">();</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">expect</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="n">OK</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">don</span><span class="s1">'t mistakenly save error report</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">getResponseCode</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">HttpURLConnection</span><span class="o">.</span><span class="n">HTTP_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="s2">"Server returned HTTP "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">connection</span><span class="o">.</span><span class="n">getResponseCode</span><span class="p">()</span>
<span class="w">                        </span><span class="o">+</span><span class="w"> </span><span class="s2">" "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">connection</span><span class="o">.</span><span class="n">getResponseMessage</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">percentage</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">did</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">length</span>
<span class="w">            </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">fileLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="o">.</span><span class="n">getContentLength</span><span class="p">();</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span>
<span class="w">            </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">();</span>
<span class="w">            </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="s2">"/sdcard/file_name.extension"</span><span class="p">);</span>

<span class="w">            </span><span class="n">byte</span><span class="w"> </span><span class="n">data</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">byte</span><span class="p">[</span><span class="mi">4096</span><span class="p">];</span>
<span class="w">            </span><span class="n">long</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="n">canceling</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">button</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isCancelled</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">input</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">publishing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">progress</span><span class="o">....</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fileLength</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">known</span>
<span class="w">                    </span><span class="n">publishProgress</span><span class="p">((</span><span class="nb nb-Type">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">fileLength</span><span class="p">));</span>
<span class="w">                </span><span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">toString</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">output</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span>
<span class="w">                    </span><span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span>
<span class="w">                    </span><span class="n">input</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">ignored</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">connection</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span>
<span class="w">                </span><span class="n">connection</span><span class="o">.</span><span class="n">disconnect</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>

<p>上面的方法 ( <code>doInBackground</code>) 总是在后台线程上运行。您不应该在那里执行任何 UI
任务。另一方面，<code>onProgressUpdate</code>和<code>onPreExecute</code>在 UI 线程上运行，因此您可以更改进度条：</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onPreExecute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onPreExecute</span><span class="p">();</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">take</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">going</span><span class="w"> </span><span class="n">off</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">presses</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">button</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">download</span>
<span class="w">        </span><span class="n">PowerManager</span><span class="w"> </span><span class="n">pm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">PowerManager</span><span class="p">)</span><span class="w"> </span><span class="n">context</span><span class="o">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="o">.</span><span class="n">POWER_SERVICE</span><span class="p">);</span>
<span class="w">        </span><span class="n">mWakeLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pm</span><span class="o">.</span><span class="n">newWakeLock</span><span class="p">(</span><span class="n">PowerManager</span><span class="o">.</span><span class="n">PARTIAL_WAKE_LOCK</span><span class="p">,</span>
<span class="w">             </span><span class="n">getClass</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">());</span>
<span class="w">        </span><span class="n">mWakeLock</span><span class="o">.</span><span class="n">acquire</span><span class="p">();</span>
<span class="w">        </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onProgressUpdate</span><span class="p">(</span><span class="n">Integer</span><span class="o">...</span><span class="w"> </span><span class="n">progress</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onProgressUpdate</span><span class="p">(</span><span class="n">progress</span><span class="p">);</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">here</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">known</span><span class="p">,</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">indeterminate</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="bp">false</span>
<span class="w">        </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setIndeterminate</span><span class="p">(</span><span class="bp">false</span><span class="p">);</span>
<span class="w">        </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setMax</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="n">progress</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onPostExecute</span><span class="p">(</span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mWakeLock</span><span class="o">.</span><span class="n">release</span><span class="p">();</span>
<span class="w">        </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">dismiss</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span>
<span class="w">            </span><span class="n">Toast</span><span class="o">.</span><span class="n">makeText</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="s2">"Download error: "</span><span class="o">+</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">Toast</span><span class="o">.</span><span class="n">LENGTH_LONG</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">Toast</span><span class="o">.</span><span class="n">makeText</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="s2">"File downloaded"</span><span class="p">,</span><span class="w"> </span><span class="n">Toast</span><span class="o">.</span><span class="n">LENGTH_SHORT</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>要运行它，您需要 WAKE_LOCK 权限。</p>
<div class="code"><pre class="code literal-block">&lt;uses-permission android:name="android.permission.WAKE_LOCK" /&gt;
</pre></div>

<ol>
<li>从服务下载 ========================</li>
</ol>
<p>这里的大问题是： <em>如何从服务更新我的活动？</em>.
在下一个示例中，我们将使用两个您可能不知道的类：<code>ResultReceiver</code>和<code>IntentService</code>。<code>ResultReceiver</code>是允许我们从服务更新我们的线程的那个；<code>IntentService</code>是一个子类，<code>Service</code>它生成一个线程以从那里执行后台工作（您应该知道
a<code>Service</code>实际上在应用程序的同一线程中运行；当您扩展时<code>Service</code>，您必须手动生成新线程以运行 CPU 阻塞操作）。</p>
<p>下载服务可能如下所示：</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">DownloadService</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">IntentService</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">UPDATE_PROGRESS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8344</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">DownloadService</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="s2">"DownloadService"</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onHandleIntent</span><span class="p">(</span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">urlToDownload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">intent</span><span class="o">.</span><span class="n">getStringExtra</span><span class="p">(</span><span class="s2">"url"</span><span class="p">);</span>
<span class="w">        </span><span class="n">ResultReceiver</span><span class="w"> </span><span class="n">receiver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ResultReceiver</span><span class="p">)</span><span class="w"> </span><span class="n">intent</span><span class="o">.</span><span class="n">getParcelableExtra</span><span class="p">(</span><span class="s2">"receiver"</span><span class="p">);</span>
<span class="w">        </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="o">//</span><span class="n">create</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">connect</span>
<span class="w">            </span><span class="n">URL</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">URL</span><span class="p">(</span><span class="n">urlToDownload</span><span class="p">);</span>
<span class="w">            </span><span class="n">URLConnection</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url</span><span class="o">.</span><span class="n">openConnection</span><span class="p">();</span>
<span class="w">            </span><span class="n">connection</span><span class="o">.</span><span class="n">connect</span><span class="p">();</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">useful</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">typical</span><span class="w"> </span><span class="mi">0</span><span class="o">-</span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="n">progress</span><span class="w"> </span><span class="n">bar</span>
<span class="w">            </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">fileLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="o">.</span><span class="n">getContentLength</span><span class="p">();</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span>
<span class="w">            </span><span class="n">InputStream</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">BufferedInputStream</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">());</span>

<span class="w">            </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/sdcard/BarcodeScanner-debug.apk"</span><span class="w"> </span><span class="p">;</span>
<span class="w">            </span><span class="n">OutputStream</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">FileOutputStream</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>

<span class="w">            </span><span class="n">byte</span><span class="w"> </span><span class="n">data</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">byte</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
<span class="w">            </span><span class="n">long</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">            </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>

<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">publishing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">progress</span><span class="o">....</span>
<span class="w">                </span><span class="n">Bundle</span><span class="w"> </span><span class="n">resultData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Bundle</span><span class="p">();</span>
<span class="w">                </span><span class="n">resultData</span><span class="o">.</span><span class="n">putInt</span><span class="p">(</span><span class="s2">"progress"</span><span class="w"> </span><span class="p">,(</span><span class="nb nb-Type">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">fileLength</span><span class="p">));</span>
<span class="w">                </span><span class="n">receiver</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">UPDATE_PROGRESS</span><span class="p">,</span><span class="w"> </span><span class="n">resultData</span><span class="p">);</span>
<span class="w">                </span><span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">close</span><span class="w"> </span><span class="n">streams</span><span class="w"> </span>
<span class="w">            </span><span class="n">output</span><span class="o">.</span><span class="n">flush</span><span class="p">();</span>
<span class="w">            </span><span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">            </span><span class="n">input</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="o">.</span><span class="n">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">Bundle</span><span class="w"> </span><span class="n">resultData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Bundle</span><span class="p">();</span>
<span class="w">        </span><span class="n">resultData</span><span class="o">.</span><span class="n">putInt</span><span class="p">(</span><span class="s2">"progress"</span><span class="w"> </span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>

<span class="w">        </span><span class="n">receiver</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">UPDATE_PROGRESS</span><span class="p">,</span><span class="w"> </span><span class="n">resultData</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>将服务添加到您的清单中：</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">service</span><span class="w"> </span><span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="o">=</span><span class="s2">".DownloadService"</span><span class="o">/&gt;</span>
</pre></div>

<p>活动将如下所示：</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">initialize</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">progress</span><span class="w"> </span><span class="n">dialog</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">example</span>

<span class="o">//</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">fire</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">downloader</span>
<span class="n">mProgressDialog</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">DownloadService</span><span class="o">.</span><span class="k">class</span><span class="p">);</span>
<span class="n">intent</span><span class="o">.</span><span class="n">putExtra</span><span class="p">(</span><span class="s2">"url"</span><span class="p">,</span><span class="w"> </span><span class="s2">"url of the file to download"</span><span class="p">);</span>
<span class="n">intent</span><span class="o">.</span><span class="n">putExtra</span><span class="p">(</span><span class="s2">"receiver"</span><span class="p">,</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DownloadReceiver</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Handler</span><span class="p">()));</span>
<span class="n">startService</span><span class="p">(</span><span class="n">intent</span><span class="p">);</span>
</pre></div>

<p>这是<code>ResultReceiver</code>来玩的：</p>
<div class="code"><pre class="code literal-block"><span class="n">private</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">DownloadReceiver</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">ResultReceiver</span><span class="p">{</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">DownloadReceiver</span><span class="p">(</span><span class="n">Handler</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="n">handler</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onReceiveResult</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">resultData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onReceiveResult</span><span class="p">(</span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="n">resultData</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resultCode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">DownloadService</span><span class="o">.</span><span class="n">UPDATE_PROGRESS</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">progress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resultData</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="s2">"progress"</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">progress</span>
<span class="w">            </span><span class="n">dialog</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="n">progress</span><span class="p">);</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">progress</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">dialog</span><span class="o">.</span><span class="n">dismiss</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3>2.1 使用Groundy库</h3>
<p><strong>Groundy</strong> is a library that basically helps you run pieces of code in a
background service, and it is based on the <code>ResultReceiver</code> concept shown
above. This library is <strong>deprecated</strong> at the moment. This is how the <strong>whole</strong>
code would look like:</p>
<p>The activity where you are showing the dialog...</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">MainActivity</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">ProgressDialog</span><span class="w"> </span><span class="n">mProgressDialog</span><span class="p">;</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">        </span><span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">main</span><span class="p">);</span>

<span class="w">        </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">btn_download</span><span class="p">)</span><span class="o">.</span><span class="n">setOnClickListener</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">View</span><span class="o">.</span><span class="n">OnClickListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onClick</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">view</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">EditText</span><span class="p">)</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">edit_url</span><span class="p">))</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span><span class="o">.</span><span class="n">trim</span><span class="p">();</span>
<span class="w">                </span><span class="n">Bundle</span><span class="w"> </span><span class="n">extras</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Bundler</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DownloadTask</span><span class="o">.</span><span class="n">PARAM_URL</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">();</span>
<span class="w">                </span><span class="n">Groundy</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">DownloadExample</span><span class="o">.</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">DownloadTask</span><span class="o">.</span><span class="k">class</span><span class="p">)</span>
<span class="w">                        </span><span class="o">.</span><span class="n">receiver</span><span class="p">(</span><span class="n">mReceiver</span><span class="p">)</span>
<span class="w">                        </span><span class="o">.</span><span class="n">params</span><span class="p">(</span><span class="n">extras</span><span class="p">)</span>
<span class="w">                        </span><span class="o">.</span><span class="n">queue</span><span class="p">();</span>

<span class="w">                </span><span class="n">mProgressDialog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ProgressDialog</span><span class="p">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="n">this</span><span class="p">);</span>
<span class="w">                </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setProgressStyle</span><span class="p">(</span><span class="n">ProgressDialog</span><span class="o">.</span><span class="n">STYLE_HORIZONTAL</span><span class="p">);</span>
<span class="w">                </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setCancelable</span><span class="p">(</span><span class="bp">false</span><span class="p">);</span>
<span class="w">                </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">ResultReceiver</span><span class="w"> </span><span class="n">mReceiver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ResultReceiver</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Handler</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">@</span><span class="n">Override</span>
<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onReceiveResult</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">resultData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">super</span><span class="o">.</span><span class="n">onReceiveResult</span><span class="p">(</span><span class="n">resultCode</span><span class="p">,</span><span class="w"> </span><span class="n">resultData</span><span class="p">);</span>
<span class="w">            </span><span class="n">switch</span><span class="w"> </span><span class="p">(</span><span class="n">resultCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">case</span><span class="w"> </span><span class="n">Groundy</span><span class="o">.</span><span class="n">STATUS_PROGRESS</span><span class="p">:</span>
<span class="w">                    </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="n">resultData</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="n">Groundy</span><span class="o">.</span><span class="n">KEY_PROGRESS</span><span class="p">));</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="n">case</span><span class="w"> </span><span class="n">Groundy</span><span class="o">.</span><span class="n">STATUS_FINISHED</span><span class="p">:</span>
<span class="w">                    </span><span class="n">Toast</span><span class="o">.</span><span class="n">makeText</span><span class="p">(</span><span class="n">DownloadExample</span><span class="o">.</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">file_downloaded</span><span class="p">,</span><span class="w"> </span><span class="n">Toast</span><span class="o">.</span><span class="n">LENGTH_LONG</span><span class="p">);</span>
<span class="w">                    </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">dismiss</span><span class="p">();</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">                </span><span class="n">case</span><span class="w"> </span><span class="n">Groundy</span><span class="o">.</span><span class="n">STATUS_ERROR</span><span class="p">:</span>
<span class="w">                    </span><span class="n">Toast</span><span class="o">.</span><span class="n">makeText</span><span class="p">(</span><span class="n">DownloadExample</span><span class="o">.</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">resultData</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">Groundy</span><span class="o">.</span><span class="n">KEY_ERROR</span><span class="p">),</span><span class="w"> </span><span class="n">Toast</span><span class="o">.</span><span class="n">LENGTH_LONG</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
<span class="w">                    </span><span class="n">mProgressDialog</span><span class="o">.</span><span class="n">dismiss</span><span class="p">();</span>
<span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>
</pre></div>

<p>A <code>GroundyTask</code> implementation used by <strong>Groundy</strong> to download the file and
show the progress:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">DownloadTask</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">GroundyTask</span><span class="w"> </span><span class="p">{</span><span class="w">    </span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">PARAM_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"com.groundy.sample.param.url"</span><span class="p">;</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">doInBackground</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getParameters</span><span class="p">()</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">PARAM_URL</span><span class="p">);</span>
<span class="w">            </span><span class="n">File</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">getContext</span><span class="p">()</span><span class="o">.</span><span class="n">getFilesDir</span><span class="p">(),</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">File</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">getName</span><span class="p">());</span>
<span class="w">            </span><span class="n">DownloadUtils</span><span class="o">.</span><span class="n">downloadFile</span><span class="p">(</span><span class="n">getContext</span><span class="p">(),</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="n">DownloadUtils</span><span class="o">.</span><span class="n">getDownloadListenerForTask</span><span class="p">(</span><span class="n">this</span><span class="p">));</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">pokemon</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>And just add this to the manifest:</p>
<div class="code"><pre class="code literal-block">&lt;service android:name="com.codeslap.groundy.GroundyService"/&gt;
</pre></div>

<p>It couldn't be easier I think. Just grab the latest jar from Github and you
are ready to go. Keep in mind that <strong>Groundy</strong> 's main purpose is to make
calls to external REST apis in a background service and post results to the UI
with easily. If you are doing something like that in your app, it could be
really useful.</p>
<h3>2.2 Use https://github.com/koush/ion</h3>
<ol>
<li>Use <code>DownloadManager</code> class (<code>GingerBread</code> and newer only) =============================================================</li>
</ol>
<p>GingerBread brought a new feature, <code>DownloadManager</code>, which allows you to
download files easily and delegate the hard work of handling threads, streams,
etc. to the system.</p>
<p>First, let's see a utility method:</p>
<div class="code"><pre class="code literal-block"><span class="o">/**</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="n">param</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">DownloadManager</span><span class="w"> </span><span class="n">information</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="k">return</span><span class="w"> </span><span class="bp">true</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">available</span>
<span class="w"> </span><span class="o">*/</span>
<span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">isDownloadManagerAvailable</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Build</span><span class="o">.</span><span class="n">VERSION</span><span class="o">.</span><span class="n">SDK_INT</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">Build</span><span class="o">.</span><span class="n">VERSION_CODES</span><span class="o">.</span><span class="n">GINGERBREAD</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Method's name explains it all. Once you are sure <code>DownloadManager</code> is
available, you can do something like this:</p>
<div class="code"><pre class="code literal-block"><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"url you want to download"</span><span class="p">;</span>
<span class="n">DownloadManager</span><span class="o">.</span><span class="n">Request</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DownloadManager</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">Uri</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">url</span><span class="p">));</span>
<span class="n">request</span><span class="o">.</span><span class="n">setDescription</span><span class="p">(</span><span class="s2">"Some descrition"</span><span class="p">);</span>
<span class="n">request</span><span class="o">.</span><span class="n">setTitle</span><span class="p">(</span><span class="s2">"Some title"</span><span class="p">);</span>
<span class="o">//</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">android</span><span class="w"> </span><span class="mf">3.2</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">app</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Build</span><span class="o">.</span><span class="n">VERSION</span><span class="o">.</span><span class="n">SDK_INT</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">Build</span><span class="o">.</span><span class="n">VERSION_CODES</span><span class="o">.</span><span class="n">HONEYCOMB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">request</span><span class="o">.</span><span class="n">allowScanningByMediaScanner</span><span class="p">();</span>
<span class="w">    </span><span class="n">request</span><span class="o">.</span><span class="n">setNotificationVisibility</span><span class="p">(</span><span class="n">DownloadManager</span><span class="o">.</span><span class="n">Request</span><span class="o">.</span><span class="n">VISIBILITY_VISIBLE_NOTIFY_COMPLETED</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">request</span><span class="o">.</span><span class="n">setDestinationInExternalPublicDir</span><span class="p">(</span><span class="n">Environment</span><span class="o">.</span><span class="n">DIRECTORY_DOWNLOADS</span><span class="p">,</span><span class="w"> </span><span class="s2">"name-of-the-file.ext"</span><span class="p">);</span>

<span class="o">//</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">enqueue</span><span class="w"> </span><span class="n">file</span>
<span class="n">DownloadManager</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DownloadManager</span><span class="p">)</span><span class="w"> </span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="o">.</span><span class="n">DOWNLOAD_SERVICE</span><span class="p">);</span>
<span class="n">manager</span><span class="o">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
</pre></div>

<p>Download progress will be showing in the notification bar.</p>
<h2>Final thoughts</h2>
<p>First and second methods are just the tip of the iceberg. There are lots of
things you have to keep in mind if you want your app to be robust. Here is a
brief list:</p>
<ul>
<li>You must check whether user has an internet connection available</li>
<li>Make sure you have the right permissions (<code>INTERNET</code> and <code>WRITE_EXTERNAL_STORAGE</code>); also <code>ACCESS_NETWORK_STATE</code> if you want to check internet availability.</li>
<li>Make sure the directory were you are going to download files exist and has write permissions.</li>
<li>If download is too big you may want to implement a way to resume the download if previous attempts failed.</li>
<li>Users will be grateful if you allow them to interrupt the download.</li>
</ul>
<p>Unless you need detailed control of the download process, then consider using
<code>DownloadManager</code> (3) because it already handles most of the items listed
above.</p>
<p>But also consider that your needs may change. For example, <code>DownloadManager</code>
does no response caching. It will blindly download the same big file multiple
times. There's no easy way to fix it after the fact. Where if you start with a
basic <code>HttpURLConnection</code> (1, 2), then all you need is to add an
<code>HttpResponseCache</code>. So the initial effort of learning the basic, standard
tools can be a good investment.</p>
<blockquote>
<p>This class was deprecated in API level 26. ProgressDialog is a modal dialog,
which prevents the user from interacting with the app. Instead of using this
class, you should use a progress indicator like ProgressBar, which can be
embedded in your app's UI. Alternatively, you can use a notification to
inform the user of the task's progress. For more details Link</p>
</blockquote>
<p><br></p>
<h3>更多建议</h3>
<p>如果您要从互联网上下载东西，请不要忘记为您的清单文件添加权限！</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;manifest</span><span class="w"> </span><span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
<span class="w">    </span><span class="na">package=</span><span class="s">"com.example.helloandroid"</span>
<span class="w">    </span><span class="na">android:versionCode=</span><span class="s">"1"</span>
<span class="w">    </span><span class="na">android:versionName=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>

<span class="w">        </span><span class="nt">&lt;uses-sdk</span><span class="w"> </span><span class="na">android:minSdkVersion=</span><span class="s">"10"</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">        </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.permission.WRITE_EXTERNAL_STORAGE"</span><span class="nt">&gt;&lt;/uses-permission&gt;</span>
<span class="w">        </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.permission.INTERNET"</span><span class="nt">&gt;&lt;/uses-permission&gt;</span>
<span class="w">        </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.permission.ACCESS_NETWORK_STATE"</span><span class="nt">&gt;&lt;/uses-permission&gt;</span>
<span class="w">        </span><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">"android.permission.READ_PHONE_STATE"</span><span class="nt">&gt;&lt;/uses-permission&gt;</span>

<span class="w">        </span><span class="nt">&lt;application</span><span class="w"> </span>
<span class="w">            </span><span class="na">android:icon=</span><span class="s">"@drawable/icon"</span><span class="w"> </span>
<span class="w">            </span><span class="na">android:label=</span><span class="s">"@string/app_name"</span><span class="w"> </span>
<span class="w">            </span><span class="na">android:debuggable=</span><span class="s">"true"</span><span class="nt">&gt;</span>

<span class="w">        </span><span class="nt">&lt;/application&gt;</span>

<span class="nt">&lt;/manifest&gt;</span>
</pre></div>

<p><br><br><a href="posts/download-a-file-with-android-and-showing-the-progress-in-a-progressdialog/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/gong-gong-si-you-he-shou-bao-hu-zhi-jian-you-shi-yao-qu-bie/" class="u-url">公共、私有和受保护之间有什么区别？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/gong-gong-si-you-he-shou-bao-hu-zhi-jian-you-shi-yao-qu-bie/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:35:03+08:00" itemprop="datePublished" title="2023-02-17 05:35">2023-02-17 05:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>什么时候以及为什么我应该在类中使用<code>public</code>, <code>private</code>, 和函数和变量？<code>protected</code>它们之间有什么区别？</p>
<p>例子：</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">Public</span>
<span class="n">public</span><span class="w"> </span><span class="o">$</span><span class="n">variable</span><span class="p">;</span>
<span class="n">public</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">doSomething</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">Private</span>
<span class="n">private</span><span class="w"> </span><span class="o">$</span><span class="n">variable</span><span class="p">;</span>
<span class="n">private</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">doSomething</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">Protected</span>
<span class="n">protected</span><span class="w"> </span><span class="o">$</span><span class="n">variable</span><span class="p">;</span>
<span class="n">protected</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">doSomething</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>
<span class="p">}</span>
</pre></div>

<p><br><br></p>
<h2>解答</h2>
<p>你用：</p>
<ul>
<li>
<p><code>public</code>范围使该属性/方法可从对象的任何地方、其他类和实例使用。</p>
</li>
<li>
<p><code>private</code>当您希望您的属性/方法仅在其自己的类中可见时。</p>
</li>
<li>
<p><code>protected</code>当您想让您的属性/方法在所有扩展当前类（包括父类）的类中可见时。</p>
</li>
</ul>
<p>如果您不使用任何可见性修饰符，则该属性/方法将是公开的。</p>
<p><strong>更多：（</strong> 获取全面信息）</p>
<ul>
<li>PHP 手册 - 可见性</li>
</ul>
<p><br></p>
<h3>更多建议</h3>
<p><img alt="dd" src="images/SFysv.jpg"></p>
<h3>民众：</h3>
<p>当您将方法（函数）或属性（变量）声明为 时<code>public</code>，可以通过以下方式访问这些方法和属性：</p>
<ul>
<li>声明它的同一个类。</li>
<li>继承上述声明类的类。</li>
<li>此类之外的任何外部元素也可以访问这些东西。</li>
</ul>
<p><strong>例子：</strong></p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="err">?</span><span class="n">php</span>

<span class="k">class</span><span class="w"> </span><span class="n">GrandPa</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="o">$</span><span class="n">name</span><span class="o">=</span><span class="s1">'Mark Henry'</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">variable</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="n">Daddy</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">GrandPa</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Inherited</span><span class="w"> </span><span class="k">class</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">displayGrandPaName</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">inherited</span><span class="w"> </span><span class="k">class</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">Inherited</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">Daddy</span><span class="w"> </span><span class="n">wants</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">Grandpas</span><span class="w"> </span><span class="n">Name</span>
<span class="o">$</span><span class="n">daddy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Daddy</span><span class="p">;</span>
<span class="n">echo</span><span class="w"> </span><span class="o">$</span><span class="n">daddy</span><span class="o">-&gt;</span><span class="n">displayGrandPaName</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Prints</span><span class="w"> </span><span class="s1">'Mark Henry'</span>

<span class="o">//</span><span class="w"> </span><span class="n">Public</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">accessed</span><span class="w"> </span><span class="n">outside</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">class</span><span class="o">!</span>
<span class="o">$</span><span class="n">outsiderWantstoKnowGrandpasName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">GrandPa</span><span class="p">;</span>
<span class="n">echo</span><span class="w"> </span><span class="o">$</span><span class="n">outsiderWantstoKnowGrandpasName</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Prints</span><span class="w"> </span><span class="s1">'Mark Henry'</span>
</pre></div>

<hr>
<h3>受保护：</h3>
<p>当您将方法（函数）或属性（变量）声明为 时<code>protected</code>，可以通过以下方式访问这些方法和属性</p>
<ul>
<li>声明它的同一个类。</li>
<li>继承上述声明类的类。</li>
</ul>
<p>外部成员无法访问这些变量。“局外人”是指它们不是 <strong>声明的类本身的对象实例。</strong></p>
<p><strong>例子：</strong></p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="err">?</span><span class="n">php</span>

<span class="k">class</span><span class="w"> </span><span class="n">GrandPa</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="o">$</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Mark Henry'</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="n">Daddy</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">GrandPa</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">displayGrandPaName</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>

<span class="o">$</span><span class="n">daddy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Daddy</span><span class="p">;</span>
<span class="n">echo</span><span class="w"> </span><span class="o">$</span><span class="n">daddy</span><span class="o">-&gt;</span><span class="n">displayGrandPaName</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Prints</span><span class="w"> </span><span class="s1">'Mark Henry'</span>

<span class="o">$</span><span class="n">outsiderWantstoKnowGrandpasName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">GrandPa</span><span class="p">;</span>
<span class="n">echo</span><span class="w"> </span><span class="o">$</span><span class="n">outsiderWantstoKnowGrandpasName</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Results</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Fatal</span><span class="w"> </span><span class="n">Error</span>
</pre></div>

<p>确切的错误是这样的：</p>
<blockquote>
<p>PHP 致命错误：无法访问受保护的属性 GrandPa::$name</p>
</blockquote>
<hr>
<h3>私人的：</h3>
<p>当您将方法（函数）或属性（变量）声明为 时<code>private</code>，可以通过以下方式访问这些方法和属性：</p>
<ul>
<li>声明它的同一个类。</li>
</ul>
<p>外部成员无法访问这些变量。局外人是指它们不是 <strong>已声明类本身的对象实例，甚至</strong> <strong>不是继承已声明类的</strong> 类。 ****</p>
<p><strong>例子：</strong></p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="err">?</span><span class="n">php</span>

<span class="k">class</span><span class="w"> </span><span class="n">GrandPa</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="o">$</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Mark Henry'</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="n">Daddy</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">GrandPa</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">displayGrandPaName</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>

<span class="o">$</span><span class="n">daddy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Daddy</span><span class="p">;</span>
<span class="n">echo</span><span class="w"> </span><span class="o">$</span><span class="n">daddy</span><span class="o">-&gt;</span><span class="n">displayGrandPaName</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Results</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Notice</span>

<span class="o">$</span><span class="n">outsiderWantstoKnowGrandpasName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">GrandPa</span><span class="p">;</span>
<span class="n">echo</span><span class="w"> </span><span class="o">$</span><span class="n">outsiderWantstoKnowGrandpasName</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Results</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Fatal</span><span class="w"> </span><span class="n">Error</span>
</pre></div>

<p>确切的错误消息将是：</p>
<blockquote>
<p>注意：未定义属性：Daddy::$name<br>
致命错误：无法访问私有属性 GrandPa::$name</p>
</blockquote>
<hr>
<h2>
<strong>使用反射</strong> 剖析爷爷类 ****</h2>
<p>这个主题并没有超出范围，我在这里添加它只是为了证明反射真的很强大。正如我在上面三个例子中所说的，<code>protected</code>成员<code>private</code>（属性和方法）不能在类之外访问。</p>
<p>However, with reflection you can do the <em>extra-ordinary</em> by even accessing
<strong><code>protected</code></strong> and <strong><code>private</code></strong> members outside of the class!</p>
<h3>Well, what is reflection?</h3>
<blockquote>
<p>Reflection adds the ability to reverse-engineer classes, interfaces,
functions, methods and extensions. Additionally, they offers ways to
retrieve doc comments for functions, classes and methods.</p>
</blockquote>
<h3>Preamble</h3>
<p>We have a class named <code>Grandpas</code> and say we have three properties. For easy
understanding, consider there are three grandpas with names:</p>
<ul>
<li>Mark Henry</li>
<li>John Clash</li>
<li>Will Jones</li>
</ul>
<p>Let us make them (assign modifiers) <code>public</code>, <code>protected</code> and <code>private</code>
respectively. You know very well that <code>protected</code> and <code>private</code> members cannot
be accessed outside the class. Now let's contradict the statement using
reflection.</p>
<h3>The code</h3>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">GrandPas</span>   <span class="c1">// The Grandfather's class</span>
<span class="p">{</span>
    <span class="k">public</span>     <span class="nv">$name1</span> <span class="o">=</span> <span class="s1">'Mark Henry'</span><span class="p">;</span>  <span class="c1">// This grandpa is mapped to a public modifier</span>
    <span class="k">protected</span>  <span class="nv">$name2</span> <span class="o">=</span> <span class="s1">'John Clash'</span><span class="p">;</span>  <span class="c1">// This grandpa is mapped to a protected  modifier</span>
    <span class="k">private</span>    <span class="nv">$name3</span> <span class="o">=</span> <span class="s1">'Will Jones'</span><span class="p">;</span>  <span class="c1">// This grandpa is mapped to a private modifier</span>
<span class="p">}</span>


<span class="c1"># Scenario 1: without reflection</span>
<span class="nv">$granpaWithoutReflection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GrandPas</span><span class="p">;</span>

<span class="c1"># Normal looping to print all the members of this class</span>
<span class="k">echo</span> <span class="s2">"#Scenario 1: Without reflection&lt;br&gt;"</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"Printing members the usual way.. (without reflection)&lt;br&gt;"</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$granpaWithoutReflection</span> <span class="k">as</span> <span class="nv">$k</span><span class="o">=&gt;</span><span class="nv">$v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"The name of grandpa is </span><span class="si">$v</span><span class="s2"> and he resides in the variable </span><span class="si">$k</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="s2">"&lt;br&gt;"</span><span class="p">;</span>

<span class="c1">#Scenario 2: Using reflection</span>

<span class="nv">$granpa</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ReflectionClass</span><span class="p">(</span><span class="s1">'GrandPas'</span><span class="p">);</span> <span class="c1">// Pass the Grandpas class as the input for the Reflection class</span>
<span class="nv">$granpaNames</span><span class="o">=</span><span class="nv">$granpa</span><span class="o">-&gt;</span><span class="na">getDefaultProperties</span><span class="p">();</span> <span class="c1">// Gets all the properties of the Grandpas class (Even though it is a protected or private)</span>


<span class="k">echo</span> <span class="s2">"#Scenario 2: With reflection&lt;br&gt;"</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"Printing members the 'reflect' way..&lt;br&gt;"</span><span class="p">;</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$granpaNames</span> <span class="k">as</span> <span class="nv">$k</span><span class="o">=&gt;</span><span class="nv">$v</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"The name of grandpa is </span><span class="si">$v</span><span class="s2"> and he resides in the variable </span><span class="si">$k</span><span class="s2">&lt;br&gt;"</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><strong>Output:</strong></p>
<div class="code"><pre class="code literal-block"><span class="c1">#Scenario 1: Without reflection</span>
<span class="n">Printing</span><span class="w"> </span><span class="n">members</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">usual</span><span class="w"> </span><span class="n">way</span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="n">Without</span><span class="w"> </span><span class="n">reflection</span><span class="p">)</span>
<span class="n">The</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">grandpa</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Mark</span><span class="w"> </span><span class="n">Henry</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">he</span><span class="w"> </span><span class="n">resides</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">name1</span>

<span class="c1">#Scenario 2: With reflection</span>
<span class="n">Printing</span><span class="w"> </span><span class="n">members</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s1">'reflect'</span><span class="w"> </span><span class="n">way</span><span class="o">..</span>
<span class="n">The</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">grandpa</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Mark</span><span class="w"> </span><span class="n">Henry</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">he</span><span class="w"> </span><span class="n">resides</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">name1</span>
<span class="n">The</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">grandpa</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">John</span><span class="w"> </span><span class="n">Clash</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">he</span><span class="w"> </span><span class="n">resides</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">name2</span>
<span class="n">The</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">grandpa</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Will</span><span class="w"> </span><span class="n">Jones</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">he</span><span class="w"> </span><span class="n">resides</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">name3</span>
</pre></div>

<hr>
<h2>Common Misconceptions:</h2>
<p>Please do not confuse with the below example. As you can still see, the
<code>private</code> and <code>protected</code> members cannot be accessed <strong>outside</strong> of the class
without using reflection</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">GrandPas</span>   <span class="c1">// The Grandfather's class</span>
<span class="p">{</span>
    <span class="k">public</span>     <span class="nv">$name1</span> <span class="o">=</span> <span class="s1">'Mark Henry'</span><span class="p">;</span>  <span class="c1">// This grandpa is mapped to a public modifier</span>
    <span class="k">protected</span>  <span class="nv">$name2</span> <span class="o">=</span> <span class="s1">'John Clash'</span><span class="p">;</span>  <span class="c1">// This grandpa is mapped to a protected modifier</span>
    <span class="k">private</span>    <span class="nv">$name3</span> <span class="o">=</span> <span class="s1">'Will Jones'</span><span class="p">;</span>  <span class="c1">// This grandpa is mapped to a private modifier</span>
<span class="p">}</span>

<span class="nv">$granpaWithoutReflections</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GrandPas</span><span class="p">;</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$granpaWithoutReflections</span><span class="p">);</span>
</pre></div>

<p><strong>Output:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">GrandPas</span><span class="w"> </span><span class="k">Object</span>
<span class="p">(</span>
<span class="w">    </span><span class="o">[</span><span class="n">name1</span><span class="o">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Mark</span><span class="w"> </span><span class="n">Henry</span>
<span class="w">    </span><span class="o">[</span><span class="n">name2:protected</span><span class="o">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">John</span><span class="w"> </span><span class="n">Clash</span>
<span class="w">    </span><span class="o">[</span><span class="n">name3:GrandPas:private</span><span class="o">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Will</span><span class="w"> </span><span class="n">Jones</span>
<span class="p">)</span>
</pre></div>

<h3>Debugging functions</h3>
<p><code>print_r</code>, <code>var_export</code> and <code>var_dump</code> are debugger functions. They present
information about a variable in a human-readable form. These three functions
will reveal the <code>protected</code> and <code>private</code> properties of objects with PHP 5.
Static class members will <em>not</em> be shown.</p>
<hr>
<h3>More resources:</h3>
<ul>
<li>The PHP Manual - OOP Properties</li>
<li>The PHP Manual - OOP Visibility</li>
<li>Techflirt.com - Visibility in PHP Classes</li>
<li>Jordizle.com - Public, Private, Protected in PHP 5</li>
</ul>
<hr>
<p><br><br><a href="posts/what-is-the-difference-between-public-private-and-protected/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/java-zhong-de-jing-tai-lei/" class="u-url">Java 中的静态类</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/java-zhong-de-jing-tai-lei/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:34:32+08:00" itemprop="datePublished" title="2023-02-17 05:34">2023-02-17 05:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><code>static class</code>在java中有什么类似的东西吗？</p>
<p>这样的类有什么意义。静态类的所有方法也需要吗<code>static</code>？</p>
<p>是否需要反过来，如果一个类包含所有静态方法，那么该类也应该是静态的吗？</p>
<p>静态类有什么用？</p>
<p><br><br></p>
<h2>解答</h2>
<p>Java 有静态 <em>嵌套</em> 类，但听起来您正在寻找顶级静态类。Java 无法使顶级类静态化，但您可以像这样模拟静态类：</p>
<ul>
<li>声明你的类<code>final</code>——防止类的扩展，因为扩展静态类是没有意义的</li>
<li>Make the constructor <code>private</code>- 防止客户端代码实例化，因为实例化静态类毫无意义</li>
<li>制作类的 <strong>所有</strong> 成员和函数<code>static</code>- 由于类无法实例化，因此无法调用实例方法或访问实例字段</li>
<li>请注意，编译器不会阻止您声明实例（非静态）成员。只有在您尝试调用实例成员时才会出现该问题</li>
</ul>
<p>根据上述建议的简单示例：</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">TestMyStaticClass</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="nb nb-Type">String</span><span class="w"> </span><span class="p">[]</span><span class="n">args</span><span class="p">){</span>
<span class="w">        </span><span class="n">MyStaticClass</span><span class="o">.</span><span class="n">setMyStaticMember</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="w">        </span><span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">"Static value: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MyStaticClass</span><span class="o">.</span><span class="n">getMyStaticMember</span><span class="p">());</span>
<span class="w">        </span><span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">"Value squared: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MyStaticClass</span><span class="o">.</span><span class="n">squareMyStaticMember</span><span class="p">());</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">MyStaticClass</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MyStaticClass</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">error</span>
<span class="w">     </span><span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">top</span><span class="o">-</span><span class="n">level</span><span class="w"> </span><span class="n">Java</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">mimicking</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">behavior</span>
<span class="n">public</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">MyStaticClass</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">MyStaticClass</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">private</span><span class="w"> </span><span class="n">constructor</span>
<span class="w">        </span><span class="n">myStaticMember</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">myStaticMember</span><span class="p">;</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">setMyStaticMember</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">myStaticMember</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getMyStaticMember</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">myStaticMember</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">squareMyStaticMember</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">myStaticMember</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">myStaticMember</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><strong>静态类有什么好处？</strong> 静态类的一个很好的用途是在实例化没有意义的情况下定义一次性的、实用程序和/或库类。一个很好的例子是 Math
类，它包含一些数学常量，例如 PI 和
E，并且只提供数学计算。在这种情况下要求实例化将是不必要的和混乱的。请参阅<code>Math</code>类和源代码。请注意它是<code>final</code>并且它的所有成员都是<code>static</code>。如果
Java 允许声明顶级类，<code>static</code>那么 Math 类确实是静态的。</p>
<p><br></p>
<h3>更多建议</h3>
<p>好吧，Java 有“静态嵌套类”，但它们与 C# 的静态类完全不同，如果那是您的来源的话。静态嵌套类只是一个不隐式引用外部类实例的类。</p>
<p>静态嵌套类可以有实例方法和静态方法。</p>
<p>Java 中没有顶级静态类这样的东西。</p>
<p><br><br><a href="posts/static-classes-in-java/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-386.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-384.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
