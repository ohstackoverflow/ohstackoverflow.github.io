<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1234) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1234.html">
<link rel="prev" href="index-1235.html" type="text/html">
<link rel="next" href="index-1233.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/gcc-fpic-option/" class="u-url">GCC -fPIC option</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/gcc-fpic-option/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:28:28+08:00" itemprop="datePublished" title="2023-02-18 04:28">2023-02-18 04:28</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have read about GCC's Options for Code Generation Conventions, but could not
understand what "Generate position-independent code (PIC)" does. Please give
an example to explain me what does it mean.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Position Independent Code means that the generated machine code is not
dependent on being located at a specific address in order to work.</p>
<p>E.g. jumps would be generated as relative rather than absolute.</p>
<p>Pseudo-assembly:</p>
<p>PIC: This would work whether the code was at address 100 or 1000</p>
<div class="code"><pre class="code literal-block"><span class="mi">100</span><span class="o">:</span><span class="w"> </span><span class="n">COMPARE</span><span class="w"> </span><span class="n">REG1</span><span class="o">,</span><span class="w"> </span><span class="n">REG2</span>
<span class="mi">101</span><span class="o">:</span><span class="w"> </span><span class="n">JUMP_IF_EQUAL</span><span class="w"> </span><span class="n">CURRENT</span><span class="o">+</span><span class="mi">10</span>
<span class="o">...</span>
<span class="mi">111</span><span class="o">:</span><span class="w"> </span><span class="n">NOP</span>
</pre></div>

<p>Non-PIC: This will only work if the code is at address 100</p>
<div class="code"><pre class="code literal-block"><span class="mi">100</span><span class="o">:</span><span class="w"> </span><span class="n">COMPARE</span><span class="w"> </span><span class="n">REG1</span><span class="o">,</span><span class="w"> </span><span class="n">REG2</span>
<span class="mi">101</span><span class="o">:</span><span class="w"> </span><span class="n">JUMP_IF_EQUAL</span><span class="w"> </span><span class="mi">111</span>
<span class="o">...</span>
<span class="mi">111</span><span class="o">:</span><span class="w"> </span><span class="n">NOP</span>
</pre></div>

<p>EDIT: In response to comment.</p>
<p>If your code is compiled with -fPIC, it's suitable for inclusion in a library
- the library must be able to be relocated from its preferred location in
memory to another address, there could be another already loaded library at
the address your library prefers.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I'll try to explain what has already been said in a simpler way.</p>
<p>Whenever a shared lib is loaded, the loader (the code on the OS which load any
program you run) changes some addresses in the code depending on where the
object was loaded to.</p>
<p>In the above example, the "111" in the non-PIC code is written by the loader
the first time it was loaded.</p>
<p>For not shared objects, you may want it to be like that because the compiler
can make some optimizations on that code.</p>
<p>For shared object, if another process will want to "link" to that code it must
read it to the same virtual addresses or the "111" will make no sense. But
that virtual-space may already be in use in the second process.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-s-the-difference-between-eval-exec-and-compile/" class="u-url">What's the difference between eval, exec, and compile?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-s-the-difference-between-eval-exec-and-compile/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:28:03+08:00" itemprop="datePublished" title="2023-02-18 04:28">2023-02-18 04:28</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've been looking at dynamic evaluation of Python code, and come across the
<code>eval()</code> and <code>compile()</code> functions, and the <code>exec</code> statement.</p>
<p>Can someone please explain the difference between <code>eval</code> and <code>exec</code>, and how
the different modes of <code>compile()</code> fit in?</p>
<p><br><br></p>
<h2>Answer</h2>
<h2>The short answer, or TL;DR</h2>
<p>Basically, <code>eval</code> is used to <strong>eval</strong> uate a single dynamically generated
Python expression, and <code>exec</code> is used to <strong>exec</strong> ute dynamically generated
Python code only for its side effects.</p>
<p><code>eval</code> and <code>exec</code> have these two differences:</p>
<ol>
<li>
<code>eval</code> accepts only a <strong>single expression</strong> , <code>exec</code> can take a code block that has Python statements: loops, <code>try: except:</code>, <code>class</code> and function/method <code>def</code>initions and so on. </li>
</ol>
<p>An expression in Python is whatever you can have as the value in a variable
assignment:</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="n">a_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">anything</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">put</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">parentheses</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">expression</span><span class="p">)</span>
</pre></div>

<ol>
<li>
<code>eval</code> <strong>returns the value</strong> of the given expression, whereas <code>exec</code> ignores the return value from its code, and always returns <code>None</code> (in Python 2 it is a statement and cannot be used as an expression, so it really does not return anything).</li>
</ol>
<p>In versions 1.0 - 2.7, <code>exec</code> was a statement, because CPython needed to
produce a different kind of code object for functions that used <code>exec</code> for its
side effects inside the function.</p>
<p>In Python 3, <code>exec</code> is a function; its use has no effect on the compiled
bytecode of the function where it is used.</p>
<hr>
<p>Thus basically:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">eval</span><span class="p">(</span><span class="s1">'37 + a'</span><span class="p">)</span><span class="w">   </span><span class="c1"># it is an expression</span>
<span class="mi">42</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">exec</span><span class="p">(</span><span class="s1">'37 + a'</span><span class="p">)</span><span class="w">   </span><span class="c1"># it is an expression statement; value is ignored (None is returned)</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">exec</span><span class="p">(</span><span class="s1">'a = 47'</span><span class="p">)</span><span class="w">   </span><span class="c1"># modify a global variable as a side effect</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">a</span>
<span class="mi">47</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">eval</span><span class="p">(</span><span class="s1">'a = 47'</span><span class="p">)</span><span class="w">  </span><span class="c1"># you cannot evaluate a statement</span>
<span class="n">Traceback</span><span class="w"> </span><span class="p">(</span><span class="n">most</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">last</span><span class="p">):</span>
<span class="w">  </span><span class="n">File</span><span class="w"> </span><span class="s2">"&lt;stdin&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="w">  </span><span class="n">File</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">47</span>
<span class="w">      </span><span class="o">^</span>
<span class="n">SyntaxError</span><span class="p">:</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">syntax</span>
</pre></div>

<hr>
<p>The <code>compile</code> in <code>'exec'</code> mode compiles any number of statements into a
bytecode that implicitly always returns <code>None</code>, whereas in <code>'eval'</code> mode it
compiles a <em>single</em> expression into bytecode that <em>returns</em> the value of that
expression.</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">eval</span><span class="ss">(</span><span class="nv">compile</span><span class="ss">(</span><span class="s1">'42'</span>,<span class="w"> </span><span class="s1">'&lt;string&gt;'</span>,<span class="w"> </span><span class="s1">'exec'</span><span class="ss">))</span><span class="w">  </span>#<span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="nv">returns</span><span class="w"> </span><span class="nv">None</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">eval</span><span class="ss">(</span><span class="nv">compile</span><span class="ss">(</span><span class="s1">'42'</span>,<span class="w"> </span><span class="s1">'&lt;string&gt;'</span>,<span class="w"> </span><span class="s1">'eval'</span><span class="ss">))</span><span class="w">  </span>#<span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="nv">returns</span><span class="w"> </span><span class="mi">42</span>
<span class="mi">42</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">exec</span><span class="ss">(</span><span class="nv">compile</span><span class="ss">(</span><span class="s1">'42'</span>,<span class="w"> </span><span class="s1">'&lt;string&gt;'</span>,<span class="w"> </span><span class="s1">'eval'</span><span class="ss">))</span><span class="w">  </span>#<span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="nv">returns</span><span class="w"> </span><span class="mi">42</span>,
<span class="o">&gt;&gt;&gt;</span><span class="w">                                          </span>#<span class="w"> </span><span class="nv">but</span><span class="w"> </span><span class="nv">ignored</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="k">exec</span>
</pre></div>

<p>In the <code>'eval'</code> mode (and thus with the <code>eval</code> function if a string is passed
in), the <code>compile</code> raises an exception if the source code contains statements
or anything else beyond a single expression:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">compile</span><span class="ss">(</span><span class="s1">'for i in range(3): print(i)'</span>,<span class="w"> </span><span class="s1">'&lt;string&gt;'</span>,<span class="w"> </span><span class="s1">'eval'</span><span class="ss">)</span>
<span class="nv">Traceback</span><span class="w"> </span><span class="ss">(</span><span class="nv">most</span><span class="w"> </span><span class="nv">recent</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="nl">last</span><span class="ss">)</span>:
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;stdin&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">module</span><span class="o">&gt;</span>
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="mi">3</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">print</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span>
<span class="w">      </span><span class="o">^</span>
<span class="nv">SyntaxError</span>:<span class="w"> </span><span class="nv">invalid</span><span class="w"> </span><span class="nv">syntax</span>
</pre></div>

<hr>
<p>Actually the statement <em>"eval accepts only a single expression"</em> applies only
when a string (which contains Python <em>source code</em> ) is passed to <code>eval</code>. Then
it is internally compiled to bytecode using <code>compile(source, '&lt;string&gt;',
'eval')</code> This is where the difference really comes from.</p>
<p>If a <code>code</code> object (which contains Python <em>bytecode</em> ) is passed to <code>exec</code> or
<code>eval</code>, <em>they behave identically</em> , excepting for the fact that <code>exec</code> ignores
the return value, still returning <code>None</code> always. So it is possible use <code>eval</code>
to execute something that has statements, if you just <code>compile</code>d it into
bytecode before instead of passing it as a string:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">eval</span><span class="ss">(</span><span class="nv">compile</span><span class="ss">(</span><span class="s1">'if 1: print("Hello")'</span>,<span class="w"> </span><span class="s1">'&lt;string&gt;'</span>,<span class="w"> </span><span class="s1">'exec'</span><span class="ss">))</span>
<span class="nv">Hello</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>

<p>works without problems, even though the compiled code contains statements. It
still returns <code>None</code>, because that is the return value of the code object
returned from <code>compile</code>.</p>
<p>In the <code>'eval'</code> mode (and thus with the <code>eval</code> function if a string is passed
in), the <code>compile</code> raises an exception if the source code contains statements
or anything else beyond a single expression:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">compile</span><span class="ss">(</span><span class="s1">'for i in range(3): print(i)'</span>,<span class="w"> </span><span class="s1">'&lt;string&gt;'</span>.<span class="w"> </span><span class="s1">'eval'</span><span class="ss">)</span>
<span class="nv">Traceback</span><span class="w"> </span><span class="ss">(</span><span class="nv">most</span><span class="w"> </span><span class="nv">recent</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="nl">last</span><span class="ss">)</span>:
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;stdin&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">module</span><span class="o">&gt;</span>
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="mi">3</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">print</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span>
<span class="w">      </span><span class="o">^</span>
<span class="nv">SyntaxError</span>:<span class="w"> </span><span class="nv">invalid</span><span class="w"> </span><span class="nv">syntax</span>
</pre></div>

<h2>The longer answer, a.k.a the gory details</h2>
<h3>
<code>exec</code> and <code>eval</code>
</h3>
<p>The <code>exec</code> function (which was a statement in Python 2) is used for executing
a dynamically created statement or program:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">program</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="err">'</span>
<span class="err">for i in range(3):</span>
<span class="err">    print("Python is cool")</span>
<span class="s1">''</span><span class="err">'</span>
<span class="err">&gt;&gt;&gt; exec(program)</span>
<span class="err">Python is cool</span>
<span class="err">Python is cool</span>
<span class="err">Python is cool</span>
<span class="err">&gt;&gt;&gt;</span>
</pre></div>

<p>The <code>eval</code> function does the same for a single expression, <em>and</em> returns the
value of the expression:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; a = 2
&gt;&gt;&gt; my_calculation = '42 * a'
&gt;&gt;&gt; result = eval(my_calculation)
&gt;&gt;&gt; result
84
</pre></div>

<p><code>exec</code> and <code>eval</code> both accept the program/expression to be run either as a
<code>str</code>, <code>unicode</code> or <code>bytes</code> object containing source code, or as a <em><code>code</code>
object</em> which contains Python bytecode.</p>
<p>If a <code>str</code>/<code>unicode</code>/<code>bytes</code> containing source code was passed to <code>exec</code>, it
behaves equivalently to:</p>
<div class="code"><pre class="code literal-block"><span class="k">exec</span><span class="ss">(</span><span class="nv">compile</span><span class="ss">(</span><span class="nv">source</span>,<span class="w"> </span><span class="s1">'&lt;string&gt;'</span>,<span class="w"> </span><span class="s1">'exec'</span><span class="ss">))</span>
</pre></div>

<p>and <code>eval</code> similarly behaves equivalent to:</p>
<div class="code"><pre class="code literal-block">eval(compile(source, '&lt;string&gt;', 'eval'))
</pre></div>

<hr>
<p>Since all expressions can be used as statements in Python (these are called
the <code>Expr</code> nodes in the Python abstract grammar; the opposite is not true),
you can always use <code>exec</code> if you do not need the return value. That is to say,
you can use either <code>eval('my_func(42)')</code> or <code>exec('my_func(42)')</code>, the
difference being that <code>eval</code> returns the value returned by <code>my_func</code>, and
<code>exec</code> discards it:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">def</span><span class="w"> </span><span class="nv">my_func</span><span class="ss">(</span><span class="nv">arg</span><span class="ss">)</span>:
...<span class="w">     </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Called with %d"</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nv">arg</span><span class="ss">)</span>
...<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="nv">arg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
...<span class="w"> </span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">exec</span><span class="ss">(</span><span class="s1">'my_func(42)'</span><span class="ss">)</span>
<span class="nv">Called</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="mi">42</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">eval</span><span class="ss">(</span><span class="s1">'my_func(42)'</span><span class="ss">)</span>
<span class="nv">Called</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="mi">42</span>
<span class="mi">84</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>

<p>Of the 2, only <code>exec</code> accepts source code that contains statements, like
<code>def</code>, <code>for</code>, <code>while</code>, <code>import</code>, or <code>class</code>, the assignment statement (a.k.a
<code>a = 42</code>), or entire programs:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">exec</span><span class="ss">(</span><span class="s1">'for i in range(3): print(i)'</span><span class="ss">)</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">eval</span><span class="ss">(</span><span class="s1">'for i in range(3): print(i)'</span><span class="ss">)</span>
<span class="nv">Traceback</span><span class="w"> </span><span class="ss">(</span><span class="nv">most</span><span class="w"> </span><span class="nv">recent</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="nl">last</span><span class="ss">)</span>:
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;stdin&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">module</span><span class="o">&gt;</span>
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="mi">3</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">print</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span>
<span class="w">      </span><span class="o">^</span>
<span class="nv">SyntaxError</span>:<span class="w"> </span><span class="nv">invalid</span><span class="w"> </span><span class="nv">syntax</span>
</pre></div>

<hr>
<p>Both <code>exec</code> and <code>eval</code> accept 2 additional positional arguments - <code>globals</code>
and <code>locals</code> - which are the global and local variable scopes that the code
sees. These default to the <code>globals()</code> and <code>locals()</code> within the scope that
called <code>exec</code> or <code>eval</code>, but any dictionary can be used for <code>globals</code> and any
<code>mapping</code> for <code>locals</code> (including <code>dict</code> of course). These can be used not
only to restrict/modify the variables that the code sees, but are often also
used for capturing the variables that the <code>exec</code>uted code creates:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dict</span><span class="ss">()</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">dict</span><span class="ss">()</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">exec</span><span class="ss">(</span><span class="s1">'global a; a, b = 123, 42'</span>,<span class="w"> </span><span class="nv">g</span>,<span class="w"> </span><span class="nv">l</span><span class="ss">)</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">g</span>[<span class="s1">'a'</span>]
<span class="mi">123</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">l</span>
{<span class="s1">'b'</span>:<span class="w"> </span><span class="mi">42</span>}
</pre></div>

<p>(If you display the value of the entire <code>g</code>, it would be much longer, because
<code>exec</code> and <code>eval</code> add the built-ins module as <code>__builtins__</code> to the globals
automatically if it is missing).</p>
<p>In Python 2, the official syntax for the <code>exec</code> statement is actually <code>exec
code in globals, locals</code>, as in</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">exec</span><span class="w"> </span><span class="s1">'global a; a, b = 123, 42'</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">g</span>,<span class="w"> </span><span class="nv">l</span>
</pre></div>

<p>However the alternate syntax <code>exec(code, globals, locals)</code> has always been
accepted too (see below).</p>
<h3><code>compile</code></h3>
<p>The <code>compile(source, filename, mode, flags=0, dont_inherit=False,
optimize=-1)</code> built-in can be used to speed up repeated invocations of the
same code with <code>exec</code> or <code>eval</code> by compiling the source into a <code>code</code> object
beforehand. The <code>mode</code> parameter controls the kind of code fragment the
<code>compile</code> function accepts and the kind of bytecode it produces. The choices
are <code>'eval'</code>, <code>'exec'</code> and <code>'single'</code>:</p>
<ul>
<li>
<p><code>'eval'</code> mode expects a single expression, and will produce bytecode that when run will return the value of <strong>that expression</strong> :</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; dis.dis(compile('a + b', '&lt;string&gt;', 'eval'))
</pre></div>

<p>1           0 LOAD_NAME                0 (a)
              3 LOAD_NAME                1 (b)
              6 BINARY_ADD
              7 RETURN_VALUE</p>
</li>
<li>
<p><code>'exec'</code> accepts any kinds of python constructs from single expressions to whole modules of code, and executes them as if they were module top-level statements. The code object returns <code>None</code>:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">dis</span>.<span class="nv">dis</span><span class="ss">(</span><span class="nv">compile</span><span class="ss">(</span><span class="s1">'a + b'</span>,<span class="w"> </span><span class="s1">'&lt;string&gt;'</span>,<span class="w"> </span><span class="s1">'exec'</span><span class="ss">))</span>
</pre></div>

<p>1           0 LOAD_NAME                0 (a)
              3 LOAD_NAME                1 (b)
              6 BINARY_ADD
              7 POP_TOP                             &lt;- discard result
              8 LOAD_CONST               0 (None)   &lt;- load None on stack
             11 RETURN_VALUE                        &lt;- return top of stack</p>
</li>
<li>
<p><code>'single'</code> is a limited form of <code>'exec'</code> which accepts a source code containing a <strong>single</strong> statement (or multiple statements separated by <code>;</code>) if the last statement is an expression statement, the resulting bytecode also <em>prints the<code>repr</code> of the value of that expression to the standard output(!)</em>.</p>
</li>
</ul>
<p>An <code>if</code>-<code>elif</code>-<code>else</code> chain, a loop with <code>else</code>, and <code>try</code> with its <code>except</code>,
<code>else</code> and <code>finally</code> blocks is considered a single statement.</p>
<p>A source fragment containing 2 top-level statements is an error for the
<code>'single'</code>, except in Python 2 there is <em>a bug</em> that sometimes allows multiple
toplevel statements in the code; only the first is compiled; the rest are
ignored:</p>
<p>In Python 2.7.8:</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">exec</span><span class="ss">(</span><span class="nv">compile</span><span class="ss">(</span><span class="s1">'a = 5\na = 6'</span>,<span class="w"> </span><span class="s1">'&lt;string&gt;'</span>,<span class="w"> </span><span class="s1">'single'</span><span class="ss">))</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">a</span>
<span class="mi">5</span>
</pre></div>

<p>And in Python 3.4.2:</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">exec</span><span class="ss">(</span><span class="nv">compile</span><span class="ss">(</span><span class="s1">'a = 5\na = 6'</span>,<span class="w"> </span><span class="s1">'&lt;string&gt;'</span>,<span class="w"> </span><span class="s1">'single'</span><span class="ss">))</span>
<span class="nv">Traceback</span><span class="w"> </span><span class="ss">(</span><span class="nv">most</span><span class="w"> </span><span class="nv">recent</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="nl">last</span><span class="ss">)</span>:
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;stdin&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">module</span><span class="o">&gt;</span>
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">        </span><span class="o">^</span>
<span class="nv">SyntaxError</span>:<span class="w"> </span><span class="nv">multiple</span><span class="w"> </span><span class="nv">statements</span><span class="w"> </span><span class="nv">found</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nv">compiling</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">single</span><span class="w"> </span><span class="nv">statement</span>
</pre></div>

<p>This is very useful for making interactive Python shells. However, the value
of the expression is <em>not returned</em> , even if you <code>eval</code> the resulting code.</p>
<p>Thus greatest distinction of <code>exec</code> and <code>eval</code> actually comes from the
<code>compile</code> function and its modes.</p>
<hr>
<p>In addition to compiling source code to bytecode, <code>compile</code> supports compiling
<em>abstract syntax trees</em> (parse trees of Python code) into <code>code</code> objects; and
source code into abstract syntax trees (the <code>ast.parse</code> is written in Python
and just calls <code>compile(source, filename, mode, PyCF_ONLY_AST)</code>); these are
used for example for modifying source code on the fly, and also for dynamic
code creation, as it is often easier to handle the code as a tree of nodes
instead of lines of text in complex cases.</p>
<hr>
<p>While <code>eval</code> only allows you to evaluate a string that contains a single
expression, you can <code>eval</code> a whole statement, or even a whole module that has
been <code>compile</code>d into bytecode; that is, with Python 2, <code>print</code> is a statement,
and cannot be <code>eval</code>led directly:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">eval</span><span class="ss">(</span><span class="s1">'for i in range(3): print("Python is cool")'</span><span class="ss">)</span>
<span class="nv">Traceback</span><span class="w"> </span><span class="ss">(</span><span class="nv">most</span><span class="w"> </span><span class="nv">recent</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="nl">last</span><span class="ss">)</span>:
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;stdin&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">module</span><span class="o">&gt;</span>
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;string&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="mi">3</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Python is cool"</span><span class="ss">)</span>
<span class="w">      </span><span class="o">^</span>
<span class="nv">SyntaxError</span>:<span class="w"> </span><span class="nv">invalid</span><span class="w"> </span><span class="nv">syntax</span>
</pre></div>

<p><code>compile</code> it with <code>'exec'</code> mode into a <code>code</code> object and you can <strong><code>eval</code>
it</strong>; the <code>eval</code> function will return <code>None</code>.</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">compile</span><span class="ss">(</span><span class="s1">'for i in range(3): print("Python is cool")'</span>,
<span class="w">                   </span><span class="s1">'foo.py'</span>,<span class="w"> </span><span class="s1">'exec'</span><span class="ss">)</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">eval</span><span class="ss">(</span><span class="nv">code</span><span class="ss">)</span>
<span class="nv">Python</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">cool</span>
<span class="nv">Python</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">cool</span>
<span class="nv">Python</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">cool</span>
</pre></div>

<p>If one looks into <code>eval</code> and <code>exec</code> source code in CPython 3, this is very
evident; they both call <code>PyEval_EvalCode</code> with same arguments, the only
difference being that <code>exec</code> explicitly returns <code>None</code>.</p>
<h3>Syntax differences of <code>exec</code> between Python 2 and Python 3</h3>
<p>One of the major differences in Python <strong>2</strong> is that <code>exec</code> is a statement and
<code>eval</code> is a built-in function (both are built-in functions in Python 3). It is
a well-known fact that the official syntax of <code>exec</code> in Python 2 is <code>exec code
[in globals[, locals]]</code>.</p>
<p>Unlike majority of the Python 2-to-3 porting guides seem to suggest, the
<code>exec</code> statement in CPython 2 can be also used with syntax that <em>looks</em>
<strong>exactly</strong> like the <code>exec</code> function invocation in Python 3. The reason is
that Python 0.9.9 had the <code>exec(code, globals, locals)</code> built-in function! And
that built-in function was replaced with <code>exec</code> statement somewhere before
Python 1.0 release.</p>
<p>Since it was desirable to not break backwards compatibility with Python 0.9.9,
Guido van Rossum added a compatibility hack in 1993: if the <code>code</code> was a tuple
of length 2 or 3, and <code>globals</code> and <code>locals</code> were not passed into the <code>exec</code>
statement otherwise, the <code>code</code> would be interpreted as if the 2nd and 3rd
element of the tuple were the <code>globals</code> and <code>locals</code> respectively. The
compatibility hack was not mentioned even in Python 1.4 documentation (the
earliest available version online); and thus was not known to many writers of
the porting guides and tools, until it was documented again in November 2012:</p>
<blockquote>
<p>The first expression may also be a tuple of length 2 or 3. In this case, the
optional parts must be omitted. The form <code>exec(expr, globals)</code> is equivalent
to <code>exec expr in globals</code>, while the form <code>exec(expr, globals, locals)</code> is
equivalent to <code>exec expr in globals, locals</code>. The tuple form of <code>exec</code>
provides compatibility with Python 3, where <code>exec</code> is a function rather than
a statement.</p>
</blockquote>
<p>Yes, in CPython 2.7 that it is handily referred to as being a forward-
compatibility option (why confuse people over that there is a backward
compatibility option at all), when it actually had been there for <em>backward-
compatibility for two decades</em>.</p>
<p>Thus while <code>exec</code> is a statement in Python 1 and Python 2, and a built-in
function in Python 3 and Python 0.9.9,</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">exec</span><span class="ss">(</span><span class="s2">"print(a)"</span>,<span class="w"> </span><span class="nv">globals</span><span class="ss">()</span>,<span class="w"> </span>{<span class="s1">'a'</span>:<span class="w"> </span><span class="mi">42</span>}<span class="ss">)</span>
<span class="mi">42</span>
</pre></div>

<p>has had identical behaviour in possibly every widely released Python version
ever; and works in Jython 2.5.2, PyPy 2.3.1 (Python 2.7.6) and IronPython
2.6.1 too (kudos to them following the undocumented behaviour of CPython
closely).</p>
<p>What you cannot do in Pythons 1.0 - 2.7 with its compatibility hack, is to
store the return value of <code>exec</code> into a variable:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Python</span><span class="w"> </span><span class="mi">2</span>.<span class="mi">7</span>.<span class="mi">11</span><span class="o">+</span><span class="w"> </span><span class="ss">(</span><span class="nv">default</span>,<span class="w"> </span><span class="nv">Apr</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="mi">2016</span>,<span class="w"> </span><span class="mi">14</span>:<span class="mi">00</span>:<span class="mi">29</span><span class="ss">)</span><span class="w"> </span>
[<span class="nv">GCC</span><span class="w"> </span><span class="mi">5</span>.<span class="mi">3</span>.<span class="mi">1</span><span class="w"> </span><span class="mi">20160413</span>]<span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">linux2</span>
<span class="nv">Type</span><span class="w"> </span><span class="s2">"help"</span>,<span class="w"> </span><span class="s2">"copyright"</span>,<span class="w"> </span><span class="s2">"credits"</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="s2">"license"</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">more</span><span class="w"> </span><span class="nv">information</span>.
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">exec</span><span class="ss">(</span><span class="s1">'print(42)'</span><span class="ss">)</span>
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;stdin&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">exec</span><span class="ss">(</span><span class="s1">'print(42)'</span><span class="ss">)</span>
<span class="w">           </span><span class="o">^</span>
<span class="nv">SyntaxError</span>:<span class="w"> </span><span class="nv">invalid</span><span class="w"> </span><span class="nv">syntax</span>
</pre></div>

<p>(which wouldn't be useful in Python 3 either, as <code>exec</code> always returns
<code>None</code>), or pass a reference to <code>exec</code>:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">call_later</span><span class="ss">(</span><span class="k">exec</span>,<span class="w"> </span><span class="s1">'print(42)'</span>,<span class="w"> </span><span class="nv">delay</span><span class="o">=</span><span class="mi">1000</span><span class="ss">)</span>
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;stdin&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nv">call_later</span><span class="ss">(</span><span class="k">exec</span>,<span class="w"> </span><span class="s1">'print(42)'</span>,<span class="w"> </span><span class="nv">delay</span><span class="o">=</span><span class="mi">1000</span><span class="ss">)</span>
<span class="w">                  </span><span class="o">^</span>
<span class="nv">SyntaxError</span>:<span class="w"> </span><span class="nv">invalid</span><span class="w"> </span><span class="nv">syntax</span>
</pre></div>

<p>Which a pattern that someone might actually have used, though unlikely;</p>
<p>Or use it in a list comprehension:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span>[<span class="k">exec</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span>[<span class="s1">'print(42)'</span>,<span class="w"> </span><span class="s1">'print(foo)'</span>]
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"&lt;stdin&gt;"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span>[<span class="k">exec</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span>[<span class="s1">'print(42)'</span>,<span class="w"> </span><span class="s1">'print(foo)'</span>]
<span class="w">        </span><span class="o">^</span>
<span class="nv">SyntaxError</span>:<span class="w"> </span><span class="nv">invalid</span><span class="w"> </span><span class="nv">syntax</span>
</pre></div>

<p>which is abuse of list comprehensions (use a <code>for</code> loop instead!).</p>
<p><br></p>
<h3>Suggest</h3>
<ol>
<li>
<p><code>exec</code> is not an expression: a statement in Python 2.x, and a function in Python 3.x. It compiles and immediately evaluates a statement or set of statement contained in a string. Example:</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="k">exec</span><span class="ss">(</span><span class="s1">'print(5)'</span><span class="ss">)</span><span class="w">           </span>#<span class="w"> </span><span class="nv">prints</span><span class="w"> </span><span class="mi">5</span>.
</pre></div>

<p># exec 'print 5'     if you use Python 2.x, nor the exec neither the print is a function there
 exec('print(5)\nprint(6)')  # prints 5{newline}6.
 exec('if True: print(6)')  # prints 6.
 exec('5')                 # does nothing and returns nothing.</p>
</li>
<li>
<p><code>eval</code> is a built-in function ( <strong>not</strong> a statement), which evaluates an expression and returns the value that expression produces. Example:</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">eval</span><span class="p">(</span><span class="s">'5'</span><span class="p">)</span><span class="w">              </span><span class="c1"># x &lt;- 5</span>
</pre></div>

<p>x = eval('%d + 6' % x)     # x &lt;- 11
 x = eval('abs(%d)' % -100) # x &lt;- 100
 x = eval('x = 5')          # INVALID; assignment is not an expression.
 x = eval('if 1: x = 4')    # INVALID; if is a statement, not an expression.</p>
</li>
<li>
<p><code>compile</code> is a lower level version of <code>exec</code> and <code>eval</code>. It does not execute or evaluate your statements or expressions, but returns a code object that can do it. The modes are as follows:</p>
</li>
<li>
<p><code>compile(string, '', 'eval')</code> returns the code object that would have been executed had you done <code>eval(string)</code>. Note that you <em>cannot</em> use statements in this mode; only a (single) expression is valid.</p>
</li>
<li>
<p><code>compile(string, '', 'exec')</code> returns the code object that would have been executed had you done <code>exec(string)</code>. You can use any number of statements here.</p>
</li>
<li>
<p><code>compile(string, '', 'single')</code> is like the <code>exec</code> mode but expects exactly one expression/statement, eg <code>compile('a=1 if 1 else 3', 'myf', mode='single')</code></p>
</li>
</ol>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-use-the-ternary-operator-inside-an-interpolated-string/" class="u-url">How to use the ternary operator inside an interpolated string?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-use-the-ternary-operator-inside-an-interpolated-string/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:27:45+08:00" itemprop="datePublished" title="2023-02-18 04:27">2023-02-18 04:27</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm confused as to why this code won't compile:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="s2">"{fieldName}{isDescending ? "</span><span class="w"> </span><span class="n">desc</span><span class="s2">" : string.Empty}"</span><span class="p">;</span>
</pre></div>

<p>If I split it up, it works fine:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">desc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isDescending</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="s2">" desc"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="o">.</span><span class="n">Empty</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="s2">"{fieldName}{desc}"</span><span class="p">;</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>According to the documentation:</p>
<blockquote>
<p>The structure of an interpolated string is as follows:</p>
<p><code>{ &lt;interpolationExpression&gt;[,&lt;alignment&gt;][:&lt;formatString&gt;] }</code></p>
</blockquote>
<p>The problem is that the colon is used to denote formatting, like:</p>
<div class="code"><pre class="code literal-block">Console.WriteLine($"The current hour is {hours:hh}")
</pre></div>

<p>The solution is to <strong>wrap</strong> the conditional in parenthesis:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="s2">"Descending {(isDescending ? "</span><span class="n">yes</span><span class="s2">" : "</span><span class="n">no</span><span class="s2">")}"</span><span class="p">;</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1235.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1233.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
