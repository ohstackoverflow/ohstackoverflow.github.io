<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2789) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2789.html">
<link rel="prev" href="index-2790.html" type="text/html">
<link rel="next" href="index-2788.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-stop-visual-studio-from-opening-a-file-on-single-click/" class="u-url">How to stop Visual Studio from opening a file on single click?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-stop-visual-studio-from-opening-a-file-on-single-click/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T18:04:23+08:00" itemprop="datePublished" title="2023-03-05 18:04">2023-03-05 18:04</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In my Visual Studio 2012 Solution Explorer, when I single click a filename it
opens it. This was different from Visual Studio 2010 (required a double
click). Is there a way to make double-click the 'view file' command?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This is called the Preview Tab feature. To change that behavior, go to:</p>
<p>Tools -&gt; Options -&gt; Environment -&gt; Tabs and Windows</p>
<p>Then look for the "Preview Tab" section, and uncheck the options therein:</p>
<p><img alt="Options Window &gt; Environment option &gt; Tabs and Windows sub-option &gt; Preview
Tab section" src="images/iboRQ.jpg"></p>
<p><br></p>
<h3>Suggest</h3>
<h2>Option 1: Using icon in Solution Explorer</h2>
<p>You can enable or disable the feature in Solution Explorer using the "Preview
Selected Items" button.</p>
<p><img alt="Enter image description here" src="images/9jISz.png"></p>
<p>The icon is a <code>Tab</code> aligned to the right.</p>
<h2>Option 2: Using the Options window</h2>
<p>You can enable or disable the feature by going into <code>Tools &gt; Options</code> and then
<code>Environment &gt; Tabs and Windows</code>.</p>
<p><img alt="enter image description here" src="images/V3Y3v.png"></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/jwt-authentication-for-asp-net-web-api/" class="u-url">JWT authentication for ASP.NET Web API</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/jwt-authentication-for-asp-net-web-api/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T18:03:03+08:00" itemprop="datePublished" title="2023-03-05 18:03">2023-03-05 18:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to support JWT bearer token (JSON Web Token) in my web API
application and I'm getting lost.</p>
<p>I see support for .NET Core and for OWIN applications.<br>
I'm currently hosting my application in IIS.</p>
<p>How can I achieve this authentication module in my application? Is there any
way I can use the <code>&lt;authentication&gt;</code> configuration similar to the way I use
forms/Windows authentication?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I answered this question: How to secure an ASP.NET Web API 4 years ago using
HMAC.</p>
<p>Now, lots of things changed in security, especially that JWT is getting
popular. In this answer, I will try to explain how to use JWT in the simplest
and basic way that I can, so we won't get lost from jungle of OWIN, Oauth2,
ASP.NET Identity, etc..</p>
<p>If you don't know about JWT tokens, you need to take a look at:</p>
<p>https://www.rfc-editor.org/rfc/rfc7519</p>
<p>Basically, a JWT token looks like this:</p>
<div class="code"><pre class="code literal-block">&lt;base64-encoded header&gt;.&lt;base64-encoded claims&gt;.&lt;base64-encoded signature&gt;
</pre></div>

<p>Example:</p>
<blockquote>
<p>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6ImN1b25nIiwibmJmIjoxNDc3NTY1NzI0LCJleHAiOjE0Nzc1NjY5MjQsImlhdCI6MTQ3NzU2NTcyNH0.6MzD1VwA5AcOcajkFyKhLYybr3h13iZjDyHm9zysDFQ</p>
</blockquote>
<p>A JWT token has three sections:</p>
<ol>
<li>Header: JSON format which is encoded in Base64</li>
<li>Claims: JSON format which is encoded in Base64.</li>
<li>Signature: Created and signed based on Header and Claims which is encoded in Base64.</li>
</ol>
<p>If you use the website jwt.io with the token above, you can decode the token
and see it like below:</p>
<p><img alt="A screenshot of jwt.io with the raw jwt source and the decoded JSON it
represents" src="images/WGVbv.png"></p>
<p>Technically, JWT uses a signature which is signed from headers and claims with
security algorithm specified in the headers (example: HMACSHA256). Therefore,
JWT must be transferred over HTTPs if you store any sensitive information in
its claims.</p>
<p>Now, in order to use JWT authentication, you don't really need an OWIN
middleware if you have a legacy Web Api system. The simple concept is how to
provide JWT token and how to validate the token when the request comes. That's
it.</p>
<p>In the demo I've created (github), to keep the JWT token lightweight, I only
store <code>username</code> and <code>expiration time</code>. But this way, you have to re-build new
local identity (principal) to add more information like roles, if you want to
do role authorization, etc. But, if you want to add more information into JWT,
it's up to you: it's very flexible.</p>
<p>Instead of using OWIN middleware, you can simply provide a JWT token endpoint
by using a controller action:</p>
<div class="code"><pre class="code literal-block"><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">TokenController</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">ApiController</span>
<span class="err">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">naive</span><span class="w"> </span><span class="n">endpoint</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">demo</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">Basic</span><span class="w"> </span><span class="n">authentication</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">provide</span><span class="w"> </span><span class="n">token</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="n">request</span>
<span class="w">    </span><span class="o">[</span><span class="n">AllowAnonymous</span><span class="o">]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">Get</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">password</span><span class="p">)</span>
<span class="w">    </span><span class="err">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CheckUser</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">))</span>
<span class="w">        </span><span class="err">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">JwtManager</span><span class="p">.</span><span class="n">GenerateToken</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HttpResponseException</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">Unauthorized</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="n">CheckUser</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">password</span><span class="p">)</span>
<span class="w">    </span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">database</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>This is a naive action; in production you should use a POST request or a Basic
Authentication endpoint to provide the JWT token.</p>
<h4>How to generate the token based on <code>username</code>?</h4>
<p>You can use the NuGet package called <code>System.IdentityModel.Tokens.Jwt</code> from
Microsoft to generate the token, or even another package if you like. In the
demo, I use <code>HMACSHA256</code> with <code>SymmetricKey</code>:</p>
<div class="code"><pre class="code literal-block">///<span class="w"> </span><span class="nt">&lt;summary&gt;</span>
///<span class="w"> </span>Use<span class="w"> </span>the<span class="w"> </span>below<span class="w"> </span>code<span class="w"> </span>to<span class="w"> </span>generate<span class="w"> </span>symmetric<span class="w"> </span>Secret<span class="w"> </span>Key
///<span class="w">     </span>var<span class="w"> </span>hmac<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>HMACSHA256();
///<span class="w">     </span>var<span class="w"> </span>key<span class="w"> </span>=<span class="w"> </span>Convert.ToBase64String(hmac.Key);
///<span class="w"> </span><span class="nt">&lt;/summary&gt;</span>
private<span class="w"> </span>const<span class="w"> </span>string<span class="w"> </span>Secret<span class="w"> </span>=<span class="w"> </span>"db3OIsj+BXE9NZDy0t8W3TcNekrF+2d/1sFnWG4HnV8TZY30iTOdtVWJG8abWvB1GlOgJuQZdcF2Luqm/hccMw==";

public<span class="w"> </span>static<span class="w"> </span>string<span class="w"> </span>GenerateToken(string<span class="w"> </span>username,<span class="w"> </span>int<span class="w"> </span>expireMinutes<span class="w"> </span>=<span class="w"> </span>20)
{
<span class="w">    </span>var<span class="w"> </span>symmetricKey<span class="w"> </span>=<span class="w"> </span>Convert.FromBase64String(Secret);
<span class="w">    </span>var<span class="w"> </span>tokenHandler<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>JwtSecurityTokenHandler();

<span class="w">    </span>var<span class="w"> </span>now<span class="w"> </span>=<span class="w"> </span>DateTime.UtcNow;
<span class="w">    </span>var<span class="w"> </span>tokenDescriptor<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>SecurityTokenDescriptor
<span class="w">    </span>{
<span class="w">        </span>Subject<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>ClaimsIdentity(new[]
<span class="w">        </span>{
<span class="w">            </span>new<span class="w"> </span>Claim(ClaimTypes.Name,<span class="w"> </span>username)
<span class="w">        </span>}),

<span class="w">        </span>Expires<span class="w"> </span>=<span class="w"> </span>now.AddMinutes(Convert.ToInt32(expireMinutes)),

<span class="w">        </span>SigningCredentials<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>SigningCredentials(
<span class="w">            </span>new<span class="w"> </span>SymmetricSecurityKey(symmetricKey),<span class="w"> </span>
<span class="w">            </span>SecurityAlgorithms.HmacSha256Signature)
<span class="w">    </span>};

<span class="w">    </span>var<span class="w"> </span>stoken<span class="w"> </span>=<span class="w"> </span>tokenHandler.CreateToken(tokenDescriptor);
<span class="w">    </span>var<span class="w"> </span>token<span class="w"> </span>=<span class="w"> </span>tokenHandler.WriteToken(stoken);

<span class="w">    </span>return<span class="w"> </span>token;
}
</pre></div>

<p>The endpoint to provide the JWT token is done.</p>
<h4>How to validate the JWT when the request comes?</h4>
<p>In the demo, I have built <code>JwtAuthenticationAttribute</code> which inherits from
<code>IAuthenticationFilter</code> (more detail about authentication filter in here).</p>
<p>With this attribute, you can authenticate any action: you just have to put
this attribute on that action.</p>
<div class="code"><pre class="code literal-block"><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ValueController</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">ApiController</span>
<span class="err">{</span>
<span class="w">    </span><span class="o">[</span><span class="n">JwtAuthentication</span><span class="o">]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">Get</span><span class="p">()</span>
<span class="w">    </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="ss">"value"</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>You can also use OWIN middleware or DelegateHander if you want to validate all
incoming requests for your WebAPI (not specific to Controller or action)</p>
<p>Below is the core method from authentication filter:</p>
<div class="code"><pre class="code literal-block"><span class="n">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="n">ValidateToken</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">username</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>

<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">simplePrinciple</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JwtManager</span><span class="o">.</span><span class="n">GetPrincipal</span><span class="p">(</span><span class="n">token</span><span class="p">);</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">simplePrinciple</span><span class="o">.</span><span class="n">Identity</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">ClaimsIdentity</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">identity</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">identity</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>

<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">usernameClaim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">identity</span><span class="o">.</span><span class="n">FindFirst</span><span class="p">(</span><span class="n">ClaimTypes</span><span class="o">.</span><span class="n">Name</span><span class="p">);</span>
<span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usernameClaim</span><span class="err">?</span><span class="o">.</span><span class="n">Value</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
<span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">More</span><span class="w"> </span><span class="n">validate</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">whether</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="n">exists</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">system</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">protected</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">IPrincipal</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AuthenticateJwtToken</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">token</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">username</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ValidateToken</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">username</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">database</span><span class="w"> </span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">identity</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">claims</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Claim</span><span class="o">&gt;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">new</span><span class="w"> </span><span class="n">Claim</span><span class="p">(</span><span class="n">ClaimTypes</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">)</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">claims</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">needed</span><span class="p">:</span><span class="w"> </span><span class="n">Roles</span><span class="p">,</span><span class="w"> </span><span class="o">...</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ClaimsIdentity</span><span class="p">(</span><span class="n">claims</span><span class="p">,</span><span class="w"> </span><span class="s2">"Jwt"</span><span class="p">);</span>
<span class="w">        </span><span class="n">IPrincipal</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ClaimsPrincipal</span><span class="p">(</span><span class="n">identity</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Task</span><span class="o">.</span><span class="n">FromResult</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Task</span><span class="o">.</span><span class="n">FromResult</span><span class="o">&lt;</span><span class="n">IPrincipal</span><span class="o">&gt;</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>The workflow is to use the JWT library (NuGet package above) to validate the
JWT token and then return back <code>ClaimsPrincipal</code>. You can perform more
validation, like check whether user exists on your system, and add other
custom validations if you want.</p>
<p>The code to validate JWT token and get principal back:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">ClaimsPrincipal</span><span class="w"> </span><span class="n">GetPrincipal</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">token</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">try</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">tokenHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">JwtSecurityTokenHandler</span><span class="p">();</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">jwtToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tokenHandler</span><span class="o">.</span><span class="n">ReadToken</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">JwtSecurityToken</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jwtToken</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>

<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">symmetricKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Convert</span><span class="o">.</span><span class="n">FromBase64String</span><span class="p">(</span><span class="n">Secret</span><span class="p">);</span>

<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">validationParameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">TokenValidationParameters</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">RequireExpirationTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span><span class="p">,</span>
<span class="w">            </span><span class="n">ValidateIssuer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">ValidateAudience</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">,</span>
<span class="w">            </span><span class="n">IssuerSigningKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SymmetricSecurityKey</span><span class="p">(</span><span class="n">symmetricKey</span><span class="p">)</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="n">SecurityToken</span><span class="w"> </span><span class="n">securityToken</span><span class="p">;</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tokenHandler</span><span class="o">.</span><span class="n">ValidateToken</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="n">validationParameters</span><span class="p">,</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">securityToken</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">principal</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="n">should</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="nb">log</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If the JWT token is validated and the principal is returned, you should build
a new local identity and put more information into it to check role
authorization.</p>
<p>Remember to add <code>config.Filters.Add(new AuthorizeAttribute());</code> (default
authorization) at global scope in order to prevent any anonymous request to
your resources.</p>
<p>You can use Postman to test the demo:</p>
<p>Request token (naive as I mentioned above, just for demo):</p>
<div class="code"><pre class="code literal-block">GET http://localhost:{port}/api/token?username=cuong&amp;password=1
</pre></div>

<p>Put JWT token in the header for authorized request, example:</p>
<div class="code"><pre class="code literal-block">GET http://localhost:{port}/api/value

Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6ImN1b25nIiwibmJmIjoxNDc3NTY1MjU4LCJleHAiOjE0Nzc1NjY0NTgsImlhdCI6MTQ3NzU2NTI1OH0.dSwwufd4-gztkLpttZsZ1255oEzpWCJkayR_4yvNL1s
</pre></div>

<p>The demo can be found here: https://github.com/cuongle/WebApi.Jwt</p>
<p><br></p>
<h3>Suggest</h3>
<p>I've managed to achieve it with minimal effort (just as simple as with ASP.NET
Core).</p>
<p>For that I use OWIN <code>Startup.cs</code> file and <code>Microsoft.Owin.Security.Jwt</code>
library.</p>
<p>In order for the app to hit <code>Startup.cs</code> we need to amend <code>Web.config</code>:</p>
<div class="code"><pre class="code literal-block">&lt;configuration&gt;
  &lt;appSettings&gt;
    &lt;add key="owin:AutomaticAppStartup" value="true" /&gt;
    ...
</pre></div>

<p>Here's how <code>Startup.cs</code> should look:</p>
<div class="code"><pre class="code literal-block"><span class="nt">using</span><span class="w"> </span><span class="nt">MyApp</span><span class="p">.</span><span class="nc">Helpers</span><span class="o">;</span>
<span class="nt">using</span><span class="w"> </span><span class="nt">Microsoft</span><span class="p">.</span><span class="nc">IdentityModel</span><span class="p">.</span><span class="nc">Tokens</span><span class="o">;</span>
<span class="nt">using</span><span class="w"> </span><span class="nt">Microsoft</span><span class="p">.</span><span class="nc">Owin</span><span class="o">;</span>
<span class="nt">using</span><span class="w"> </span><span class="nt">Microsoft</span><span class="p">.</span><span class="nc">Owin</span><span class="p">.</span><span class="nc">Security</span><span class="o">;</span>
<span class="nt">using</span><span class="w"> </span><span class="nt">Microsoft</span><span class="p">.</span><span class="nc">Owin</span><span class="p">.</span><span class="nc">Security</span><span class="p">.</span><span class="nc">Jwt</span><span class="o">;</span>
<span class="nt">using</span><span class="w"> </span><span class="nt">Owin</span><span class="o">;</span>

<span class="cp">[</span><span class="nx">assembly</span><span class="p">:</span><span class="w"> </span><span class="nx">OwinStartup</span><span class="p">(</span><span class="nx">typeof</span><span class="p">(</span><span class="nx">MyApp.App_Start.Startup</span><span class="p">))</span><span class="cp">]</span>

<span class="nt">namespace</span><span class="w"> </span><span class="nt">MyApp</span><span class="p">.</span><span class="nc">App_Start</span>
<span class="p">{</span>
<span class="w">    </span><span class="err">public</span><span class="w"> </span><span class="err">class</span><span class="w"> </span><span class="err">Startup</span>
<span class="w">    </span><span class="err">{</span>
<span class="w">        </span><span class="err">public</span><span class="w"> </span><span class="err">void</span><span class="w"> </span><span class="err">Configuration(IAppBuilder</span><span class="w"> </span><span class="err">app)</span>
<span class="w">        </span><span class="err">{</span>
<span class="w">            </span><span class="err">app.UseJwtBearerAuthentication(</span>
<span class="w">                </span><span class="err">new</span><span class="w"> </span><span class="err">JwtBearerAuthenticationOptions</span>
<span class="w">                </span><span class="err">{</span>
<span class="w">                    </span><span class="err">AuthenticationMode</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">AuthenticationMode.Active,</span>
<span class="w">                    </span><span class="err">TokenValidationParameters</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">TokenValidationParameters()</span>
<span class="w">                    </span><span class="err">{</span>
<span class="w">                        </span><span class="err">ValidAudience</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">ConfigHelper.GetAudience(),</span>
<span class="w">                        </span><span class="err">ValidIssuer</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">ConfigHelper.GetIssuer(),</span>
<span class="w">                        </span><span class="err">IssuerSigningKey</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">ConfigHelper.GetSymmetricSecurityKey(),</span>
<span class="w">                        </span><span class="err">ValidateLifetime</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">true,</span>
<span class="w">                        </span><span class="err">ValidateIssuerSigningKey</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">true</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="err">}</span><span class="o">);</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>Many of you guys use ASP.NET Core nowadays, so as you can see it doesn't
differ a lot from what we have there.</p>
<p>It really got me perplexed first, I was trying to implement custom providers,
etc. But I didn't expect it to be so simple. <code>OWIN</code> just rocks!</p>
<p>Just one thing to mention - after I enabled OWIN Startup <code>NSWag</code> library
stopped working for me (e.g. some of you might want to auto-generate
typescript HTTP proxies for Angular app).</p>
<p>The solution was also very simple - I replaced <code>NSWag</code> with <code>Swashbuckle</code> and
didn't have any further issues.</p>
<hr>
<p>Ok, now sharing <code>ConfigHelper</code> code:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ConfigHelper</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">GetIssuer</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">string</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Configuration</span><span class="o">.</span><span class="n">ConfigurationManager</span><span class="o">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s2">"Issuer"</span><span class="p">];</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">GetAudience</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">string</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Configuration</span><span class="o">.</span><span class="n">ConfigurationManager</span><span class="o">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s2">"Audience"</span><span class="p">];</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">SigningCredentials</span><span class="w"> </span><span class="n">GetSigningCredentials</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SigningCredentials</span><span class="p">(</span><span class="n">GetSymmetricSecurityKey</span><span class="p">(),</span><span class="w"> </span><span class="n">SecurityAlgorithms</span><span class="o">.</span><span class="n">HmacSha256</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">GetSecurityKey</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">string</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Configuration</span><span class="o">.</span><span class="n">ConfigurationManager</span><span class="o">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s2">"SecurityKey"</span><span class="p">];</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">GetSymmetricSecurityKeyAsBytes</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">issuerSigningKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSecurityKey</span><span class="p">();</span>
<span class="w">        </span><span class="n">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Encoding</span><span class="o">.</span><span class="n">UTF8</span><span class="o">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">issuerSigningKey</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">SymmetricSecurityKey</span><span class="w"> </span><span class="n">GetSymmetricSecurityKey</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetSymmetricSecurityKeyAsBytes</span><span class="p">();</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SymmetricSecurityKey</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">GetCorsOrigins</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">string</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Configuration</span><span class="o">.</span><span class="n">ConfigurationManager</span><span class="o">.</span><span class="n">AppSettings</span><span class="p">[</span><span class="s2">"CorsOrigins"</span><span class="p">];</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Another important aspect - I sent JWT Token via <strong>Authorization</strong> header, so
typescript code looks for me as follows:</p>
<p>(the code below is generated by NSWag)</p>
<div class="code"><pre class="code literal-block"><span class="err">@</span><span class="n">Injectable</span><span class="p">()</span>
<span class="k">export</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">TeamsServiceProxy</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">baseUrl</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">;</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">jsonParseReviver</span><span class="p">:</span><span class="w"> </span><span class="p">((</span><span class="n">key</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="n">any</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">any</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">undefined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">;</span>

<span class="w">    </span><span class="n">constructor</span><span class="p">(</span><span class="err">@</span><span class="n">Inject</span><span class="p">(</span><span class="n">HttpClient</span><span class="p">)</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">,</span><span class="w"> </span><span class="err">@</span><span class="n">Optional</span><span class="p">()</span><span class="w"> </span><span class="err">@</span><span class="n">Inject</span><span class="p">(</span><span class="n">API_BASE_URL</span><span class="p">)</span><span class="w"> </span><span class="n">baseUrl</span><span class="err">?</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">this</span><span class="o">.</span><span class="n">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">http</span><span class="p">;</span>
<span class="w">        </span><span class="n">this</span><span class="o">.</span><span class="n">baseUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseUrl</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="n">baseUrl</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:44384"</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="n">TeamDto</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">):</span><span class="w"> </span><span class="n">Observable</span><span class="o">&lt;</span><span class="n">boolean</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">let</span><span class="w"> </span><span class="n">url_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">baseUrl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"/api/Teams/Add"</span><span class="p">;</span>
<span class="w">        </span><span class="n">url_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">url_</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/</span><span class="p">[</span><span class="err">?</span><span class="o">&amp;</span><span class="p">]</span><span class="o">$/</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">);</span>

<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">content_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>

<span class="w">        </span><span class="n">let</span><span class="w"> </span><span class="n">options_</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">body</span><span class="p">:</span><span class="w"> </span><span class="n">content_</span><span class="p">,</span>
<span class="w">            </span><span class="n">observe</span><span class="p">:</span><span class="w"> </span><span class="s2">"response"</span><span class="p">,</span>
<span class="w">            </span><span class="n">responseType</span><span class="p">:</span><span class="w"> </span><span class="s2">"blob"</span><span class="p">,</span>
<span class="w">            </span><span class="n">headers</span><span class="p">:</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">HttpHeaders</span><span class="p">({</span>
<span class="w">                </span><span class="s2">"Content-Type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="s2">"Accept"</span><span class="p">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
<span class="w">                </span><span class="s2">"Authorization"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">localStorage</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="s1">'token'</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">};</span>
</pre></div>

<p>See headers part - <code>"Authorization": "Bearer " +
localStorage.getItem('token')</code></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/command-to-delete-all-pods-in-all-kubernetes-namespaces/" class="u-url">Command to delete all pods in all kubernetes namespaces</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/command-to-delete-all-pods-in-all-kubernetes-namespaces/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T18:01:36+08:00" itemprop="datePublished" title="2023-03-05 18:01">2023-03-05 18:01</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Upon looking at the docs, there is an API call to delete a single pod, but is
there a way to delete <em>all</em> pods in all namespaces?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>There is no command to do exactly what you asked.</p>
<p>Here are some close matches.</p>
<p><strong>Be careful before running any of these commands. Make sure you are connected
to the right cluster, if you use multiple clusters. Consider running.<code>kubectl
config view</code> first.</strong></p>
<p>You can delete all the pods in a single namespace with this command:</p>
<div class="code"><pre class="code literal-block">kubectl delete --all pods --namespace=foo
</pre></div>

<p>You can also delete all deployments in namespace which will delete all pods
attached with the deployments corresponding to the namespace</p>
<div class="code"><pre class="code literal-block">kubectl delete --all deployments --namespace=foo
</pre></div>

<p>You can delete all namespaces and every object in every namespace (but not un-
namespaced objects, like nodes and some events) with this command:</p>
<div class="code"><pre class="code literal-block">kubectl delete --all namespaces
</pre></div>

<p>However, the latter command is probably not something you want to do, since it
will delete things in the kube-system namespace, which will make your cluster
not usable.</p>
<p>This command will delete all the namespaces except kube-system, which might be
useful:</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span>$<span class="ss">(</span><span class="nv">kubectl</span><span class="w"> </span><span class="nv">get</span><span class="w"> </span><span class="nv">ns</span><span class="w"> </span><span class="o">-</span><span class="nv">o</span><span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.items[*].metadata.name}"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nv">grep</span><span class="w"> </span><span class="o">-</span><span class="nv">v</span><span class="w"> </span><span class="nv">kube</span><span class="o">-</span><span class="nv">system</span><span class="ss">)</span><span class="c1">;</span>
<span class="k">do</span>
<span class="w">  </span><span class="nv">kubectl</span><span class="w"> </span><span class="nv">delete</span><span class="w"> </span><span class="nv">ns</span><span class="w"> </span><span class="mh">$eac</span><span class="nv">h</span>
<span class="nv">done</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<div class="code"><pre class="code literal-block">kubectl delete daemonsets,replicasets,services,deployments,pods,rc,ingress --all --all-namespaces
</pre></div>

<p>to get rid of them pesky replication controllers too.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2790.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2788.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
