<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1712) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1712.html">
<link rel="prev" href="index-1713.html" type="text/html">
<link rel="next" href="index-1711.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-add-users-to-docker-container/" class="u-url">How to add users to Docker container?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-add-users-to-docker-container/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:35:18+08:00" itemprop="datePublished" title="2023-03-03 07:35">2023-03-03 07:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a docker container with some processes (uwsgi and celery) running
inside. I want to create a celery user and a uwsgi user for these processes as
well as a worker group that they will both belong to, in order to assign
permissions.</p>
<p>I tried adding <code>RUN adduser uwsgi</code> and <code>RUN adduser celery</code> to my Dockerfile,
but this is causing problems, since these commands prompt for input (I've
posted the responses from the build below).</p>
<p>What is the best way to add users to a Docker container so as to set
permissions for workers running in the container?</p>
<p>My Docker image is built from the official Ubuntu14.04 base.</p>
<p>Here is the output from the Dockerfile when the adduser commands are run:</p>
<div class="code"><pre class="code literal-block"><span class="n">Adding</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="err">`</span><span class="n">uwsgi</span><span class="s">' ...</span>
<span class="s">Adding new group `uwsgi'</span><span class="w"> </span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span>
<span class="n">Adding</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="err">`</span><span class="n">uwsgi</span><span class="s">' (1000) with group `uwsgi'</span><span class="w"> </span><span class="p">...</span><span class="w"> </span>
<span class="n">Creating</span><span class="w"> </span><span class="n">home</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">uwsgi</span><span class="s">' ...</span>
<span class="s">Copying files from `/etc/skel'</span><span class="w"> </span><span class="p">...</span><span class="w"> </span>
<span class="p">[</span><span class="mi">91</span><span class="n">mEnter</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">UNIX</span><span class="w"> </span><span class="n">password</span><span class="o">:</span><span class="w"> </span><span class="n">Retype</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">UNIX</span><span class="w"> </span><span class="n">password</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="w"> </span>
<span class="p">[</span><span class="mi">91</span><span class="n">mpasswd</span><span class="o">:</span><span class="w"> </span><span class="n">Authentication</span><span class="w"> </span><span class="kt">token</span><span class="w"> </span><span class="n">manipulation</span><span class="w"> </span><span class="nf">error</span>
<span class="n">passwd</span><span class="o">:</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">unchanged</span>
<span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="w"> </span>
<span class="p">[</span><span class="mi">91</span><span class="n">mUse</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">uninitialized</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">$</span><span class="n">answer</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">chop</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">adduser</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mf">563.</span>
<span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="w"> </span>
<span class="p">[</span><span class="mi">91</span><span class="n">mUse</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">uninitialized</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">$</span><span class="n">answer</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="kt">pattern</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="c1">//) at /usr/sbin/adduser line 564.</span>
<span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="w"> </span>
<span class="n">Try</span><span class="w"> </span><span class="n">again</span><span class="o">?</span><span class="w"> </span><span class="p">[</span><span class="n">y</span><span class="o">/</span><span class="n">N</span><span class="p">]</span><span class="w"> </span>
<span class="n">Changing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">uwsgi</span>
<span class="n">Enter</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kr">or</span><span class="w"> </span><span class="n">press</span><span class="w"> </span><span class="n">ENTER</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">default</span>
<span class="w">    </span><span class="kr">Full</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">[]</span><span class="o">:</span><span class="w"> </span>
<span class="n">Room</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="p">[]</span><span class="o">:</span><span class="w">     </span><span class="n">Work</span><span class="w"> </span><span class="n">Phone</span><span class="w"> </span><span class="p">[]</span><span class="o">:</span><span class="w">  </span><span class="n">Home</span><span class="w"> </span><span class="n">Phone</span><span class="w"> </span><span class="p">[]</span><span class="o">:</span><span class="w">  </span><span class="n">Other</span><span class="w"> </span><span class="p">[]</span><span class="o">:</span><span class="w"> </span>
<span class="p">[</span><span class="mi">91</span><span class="n">mUse</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">uninitialized</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">$</span><span class="n">answer</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">chop</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">adduser</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mf">589.</span>
<span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="w"> </span>
<span class="p">[</span><span class="mi">91</span><span class="n">mUse</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">uninitialized</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">$</span><span class="n">answer</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="kt">pattern</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="c1">//) at /usr/sbin/adduser line 590.</span>
<span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="w"> </span>
<span class="n">Is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">correct</span><span class="o">?</span><span class="w"> </span><span class="p">[</span><span class="n">Y</span><span class="o">/</span><span class="n">n</span><span class="p">]</span><span class="w"> </span>
<span class="o">---&gt;</span><span class="w"> </span><span class="mf">258f2f2f</span><span class="mi">13</span><span class="n">df</span><span class="w"> </span>
<span class="n">Removing</span><span class="w"> </span><span class="n">intermediate</span><span class="w"> </span><span class="n">container</span><span class="w"> </span><span class="mi">59948863162</span><span class="n">a</span><span class="w"> </span>
<span class="n">Step</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">RUN</span><span class="w"> </span><span class="n">adduser</span><span class="w"> </span><span class="n">celery</span><span class="w"> </span>
<span class="o">---&gt;</span><span class="w"> </span><span class="n">Running</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">be06f1e20f64</span><span class="w"> </span>
<span class="n">Adding</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="err">`</span><span class="n">celery</span><span class="s">' ...</span>
<span class="s">Adding new group `celery'</span><span class="w"> </span><span class="p">(</span><span class="mi">1001</span><span class="p">)</span><span class="w"> </span><span class="p">...</span><span class="w"> </span>
<span class="n">Adding</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="err">`</span><span class="n">celery</span><span class="s">' (1001) with group `celery'</span><span class="w"> </span><span class="p">...</span><span class="w"> </span>
<span class="n">Creating</span><span class="w"> </span><span class="n">home</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="err">`</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">celery</span><span class="s">' ...</span>
<span class="s">Copying files from `/etc/skel'</span><span class="w"> </span><span class="p">...</span><span class="w"> </span>
<span class="p">[</span><span class="mi">91</span><span class="n">mEnter</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">UNIX</span><span class="w"> </span><span class="n">password</span><span class="o">:</span><span class="w"> </span><span class="n">Retype</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">UNIX</span><span class="w"> </span><span class="n">password</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="w"> </span>
<span class="p">[</span><span class="mi">91</span><span class="n">mpasswd</span><span class="o">:</span><span class="w"> </span><span class="n">Authentication</span><span class="w"> </span><span class="kt">token</span><span class="w"> </span><span class="n">manipulation</span><span class="w"> </span><span class="nf">error</span>
<span class="n">passwd</span><span class="o">:</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">unchanged</span>
<span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="w"> </span>
<span class="p">[</span><span class="mi">91</span><span class="n">mUse</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">uninitialized</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">$</span><span class="n">answer</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">chop</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">adduser</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mf">563.</span>
<span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="w"> </span>
<span class="p">[</span><span class="mi">91</span><span class="n">mUse</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">uninitialized</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">$</span><span class="n">answer</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="kt">pattern</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="c1">//) at /usr/sbin/adduser line 564.</span>
<span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="w"> </span>
<span class="n">Try</span><span class="w"> </span><span class="n">again</span><span class="o">?</span><span class="w"> </span><span class="p">[</span><span class="n">y</span><span class="o">/</span><span class="n">N</span><span class="p">]</span><span class="w"> </span>
<span class="n">Changing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">celery</span>
<span class="n">Enter</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kr">or</span><span class="w"> </span><span class="n">press</span><span class="w"> </span><span class="n">ENTER</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">default</span>
<span class="w">    </span><span class="kr">Full</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">[]</span><span class="o">:</span><span class="w">   </span><span class="n">Room</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="p">[]</span><span class="o">:</span><span class="w">     </span><span class="n">Work</span><span class="w"> </span><span class="n">Phone</span><span class="w"> </span><span class="p">[]</span><span class="o">:</span><span class="w"> </span>
<span class="n">Home</span><span class="w"> </span><span class="n">Phone</span><span class="w"> </span><span class="p">[]</span><span class="o">:</span><span class="w">  </span><span class="n">Other</span><span class="w"> </span><span class="p">[]</span><span class="o">:</span><span class="w"> </span>
<span class="p">[</span><span class="mi">91</span><span class="n">mUse</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">uninitialized</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">$</span><span class="n">answer</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">chop</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">adduser</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mf">589.</span>
<span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="w"> </span>
<span class="p">[</span><span class="mi">91</span><span class="n">mUse</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">uninitialized</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="err">$</span><span class="n">answer</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="kt">pattern</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="c1">//) at /usr/sbin/adduser line 590.</span>
<span class="p">[</span><span class="mi">0</span><span class="n">m</span><span class="w"> </span>
<span class="n">Is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">correct</span><span class="o">?</span><span class="w"> </span><span class="p">[</span><span class="n">Y</span><span class="o">/</span><span class="n">n</span><span class="p">]</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>The trick is to use <code>useradd</code> instead of its interactive wrapper <code>adduser</code>. I
usually create users with:</p>
<div class="code"><pre class="code literal-block">RUN useradd -ms /bin/bash newuser
</pre></div>

<p>which creates a home directory for the user and ensures that bash is the
default shell.</p>
<p>You can then add:</p>
<div class="code"><pre class="code literal-block">USER newuser
WORKDIR /home/newuser
</pre></div>

<p>to your dockerfile. Every command afterwards as well as interactive sessions
will be executed as user <code>newuser</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="n">image</span>
<span class="n">newuser</span><span class="mi">@131</span><span class="n">b7ad86360</span><span class="o">:~</span><span class="n">$</span>
</pre></div>

<p>You might have to give <code>newuser</code> the permissions to execute the programs you
intend to run before invoking the user command.</p>
<p>Using non-privileged users inside containers is a good idea for security
reasons. It also has a few drawbacks. Most importantly, people deriving images
from your image will have to switch back to root before they can execute
commands with superuser privileges.</p>
<p><br></p>
<h3>Suggest</h3>
<h4>Ubuntu</h4>
<p>Try the following lines in <code>Dockerfile</code>:</p>
<div class="code"><pre class="code literal-block">RUN useradd -rm -d /home/ubuntu -s /bin/bash -g root -G sudo -u 1001 ubuntu
USER ubuntu
WORKDIR /home/ubuntu
</pre></div>

<p><code>useradd</code> options (see: <code>man useradd</code>):</p>
<ul>
<li>
<code>-r</code>, <code>--system</code> Create a system account. see: Implications creating <em>system accounts</em>
</li>
<li>
<code>-m</code>, <code>--create-home</code> Create the user's home directory.</li>
<li>
<code>-d</code>, <code>--home-dir HOME_DIR</code> Home directory of the new account.</li>
<li>
<code>-s</code>, <code>--shell SHELL</code> Login shell of the new account.</li>
<li>
<code>-g</code>, <code>--gid GROUP</code> Name or ID of the primary group.</li>
<li>
<code>-G</code>, <code>--groups GROUPS</code> List of supplementary groups.</li>
<li>
<code>-u</code>, <code>--uid UID</code> Specify user ID. see: Understanding how uid and gid work in Docker containers</li>
<li>
<code>-p</code>, <code>--password PASSWORD</code> Encrypted password of the new account (e.g. <code>ubuntu</code>).</li>
</ul>
<h4>Setting default user's password</h4>
<p>To set the user password, add <code>-p "$(openssl passwd -1 ubuntu)"</code> to <code>useradd</code>
command.</p>
<p>Alternatively add the following lines to your <code>Dockerfile</code>:</p>
<div class="code"><pre class="code literal-block">SHELL ["/bin/bash", "-o", "pipefail", "-c"]
RUN echo 'ubuntu:ubuntu' | chpasswd
</pre></div>

<p>The first shell instruction is to make sure that <code>-o pipefail</code> option is
enabled before <code>RUN</code> with a pipe in it. Read more: Hadolint: Linting your
Dockerfile.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/rerender-view-on-browser-resize-with-react/" class="u-url">Rerender view on browser resize with React</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/rerender-view-on-browser-resize-with-react/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:34:45+08:00" itemprop="datePublished" title="2023-03-03 07:34">2023-03-03 07:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How can I get React to re-render the view when the browser window is resized?</p>
<h4>Background</h4>
<p>I have some blocks that I want to layout individually on the page, however I
also want them to update when the browser window changes. The very end result
will be something like Ben Holland's Pinterest layout, but written using React
not just jQuery. I’m still a way off.</p>
<h4>Code</h4>
<p>Here’s my app:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">MyApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">React</span><span class="o">.</span><span class="n">createClass</span><span class="p">({</span>
<span class="w">  </span><span class="o">//</span><span class="n">does</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">http</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span>
<span class="w">  </span><span class="n">loadBlocksFromServer</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">$.</span><span class="n">ajax</span><span class="p">({</span>
<span class="w">      </span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
<span class="w">      </span><span class="n">dataType</span><span class="p">:</span><span class="w"> </span><span class="s1">'json'</span><span class="p">,</span>
<span class="w">      </span><span class="n">mimeType</span><span class="p">:</span><span class="w"> </span><span class="s1">'textPlain'</span><span class="p">,</span>
<span class="w">      </span><span class="n">success</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">this</span><span class="o">.</span><span class="n">setState</span><span class="p">({</span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">events</span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">this</span><span class="p">)</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="n">getInitialState</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="p">[]};</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="n">componentWillMount</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">loadBlocksFromServer</span><span class="p">();</span>

<span class="w">  </span><span class="p">},</span><span class="w">    </span>
<span class="w">  </span><span class="n">render</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">&lt;</span><span class="n">Blocks</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">data</span><span class="p">}</span><span class="o">/&gt;</span>
<span class="w">      </span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">});</span>

<span class="n">React</span><span class="o">.</span><span class="n">renderComponent</span><span class="p">(</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">MyApp</span><span class="w"> </span><span class="n">url</span><span class="o">=</span><span class="s2">"url_here"</span><span class="o">/&gt;</span><span class="p">,</span>
<span class="w">  </span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s1">'view'</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

<p>Then I have the <code>Block</code> component (equivalent to a <code>Pin</code> in the above
Pinterest example):</p>
<div class="code"><pre class="code literal-block">var<span class="w"> </span>Block<span class="w"> </span>=<span class="w"> </span>React.createClass({
<span class="w">  </span>render:<span class="w"> </span>function()<span class="w"> </span>{
<span class="w">    </span>return<span class="w"> </span>(
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"dp-block"</span><span class="w"> </span><span class="na">style=</span><span class="cp">{{</span><span class="nv">left</span><span class="o">:</span> <span class="nv">this.props.top</span><span class="o">,</span> <span class="nv">top</span><span class="o">:</span> <span class="nv">this.props.left</span><span class="cp">}}</span><span class="err">&gt;</span>
<span class="w">        </span><span class="s">&lt;h2</span><span class="nt">&gt;</span>{this.props.title}<span class="nt">&lt;/h2&gt;</span>
<span class="w">        </span><span class="nt">&lt;p&gt;</span>{this.props.children}<span class="nt">&lt;/p&gt;</span>
<span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span>);
<span class="w">  </span>}
});
</pre></div>

<p>and the list/collection of <code>Blocks</code>:</p>
<div class="code"><pre class="code literal-block">var<span class="w"> </span>Blocks<span class="w"> </span>=<span class="w"> </span>React.createClass({

<span class="w">  </span>render:<span class="w"> </span>function()<span class="w"> </span>{

<span class="w">    </span>//I've<span class="w"> </span>temporarily<span class="w"> </span>got<span class="w"> </span>code<span class="w"> </span>that<span class="w"> </span>assigns<span class="w"> </span>a<span class="w"> </span>random<span class="w"> </span>position
<span class="w">    </span>//See<span class="w"> </span>inside<span class="w"> </span>the<span class="w"> </span>function<span class="w"> </span>below...

<span class="w">    </span>var<span class="w"> </span>blockNodes<span class="w"> </span>=<span class="w"> </span>this.props.data.map(function<span class="w"> </span>(block)<span class="w"> </span>{<span class="w">   </span>
<span class="w">      </span>//temporary<span class="w"> </span>random<span class="w"> </span>position
<span class="w">      </span>var<span class="w"> </span>topOffset<span class="w"> </span>=<span class="w"> </span>Math.random()<span class="w"> </span>*<span class="w"> </span>$(window).width()<span class="w"> </span>+<span class="w"> </span>'px';<span class="w"> </span>
<span class="w">      </span>var<span class="w"> </span>leftOffset<span class="w"> </span>=<span class="w"> </span>Math.random()<span class="w"> </span>*<span class="w"> </span>$(window).height()<span class="w"> </span>+<span class="w"> </span>'px';<span class="w"> </span>
<span class="w">      </span>return<span class="w"> </span><span class="nt">&lt;Block</span><span class="w"> </span><span class="na">order=</span><span class="s">{block.id}</span><span class="w"> </span><span class="na">title=</span><span class="s">{block.summary}</span><span class="w"> </span><span class="na">left=</span><span class="s">{leftOffset}</span><span class="w"> </span><span class="na">top=</span><span class="s">{topOffset}</span><span class="nt">&gt;</span>{block.description}<span class="nt">&lt;/Block&gt;</span>;
<span class="w">    </span>});

<span class="w">    </span>return<span class="w"> </span>(
<span class="w">        </span><span class="nt">&lt;div&gt;</span>{blockNodes}<span class="nt">&lt;/div&gt;</span>
<span class="w">    </span>);
<span class="w">  </span>}
});
</pre></div>

<h4>Question</h4>
<p>Should I add jQuery’s window resize? If so, where?</p>
<div class="code"><pre class="code literal-block">$( window ).resize(function() {
  // re-render the component
});
</pre></div>

<p>Is there a more “React” way of doing this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>Using React Hooks:</strong></p>
<p>You can define a custom Hook that listens to the window <code>resize</code> event,
something like this:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">React</span><span class="o">,</span> <span class="p">{</span> <span class="n">useLayoutEffect</span><span class="p">,</span> <span class="n">useState</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'react'</span><span class="p">;</span>

<span class="n">function</span> <span class="n">useWindowSize</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">const</span> <span class="p">[</span><span class="n">size</span><span class="p">,</span> <span class="n">setSize</span><span class="p">]</span> <span class="o">=</span> <span class="n">useState</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]);</span>
  <span class="n">useLayoutEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="n">function</span> <span class="n">updateSize</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">setSize</span><span class="p">([</span><span class="n">window</span><span class="o">.</span><span class="n">innerWidth</span><span class="p">,</span> <span class="n">window</span><span class="o">.</span><span class="n">innerHeight</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">window</span><span class="o">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="s1">'resize'</span><span class="p">,</span> <span class="n">updateSize</span><span class="p">);</span>
    <span class="n">updateSize</span><span class="p">();</span>
    <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="n">window</span><span class="o">.</span><span class="n">removeEventListener</span><span class="p">(</span><span class="s1">'resize'</span><span class="p">,</span> <span class="n">updateSize</span><span class="p">);</span>
  <span class="p">},</span> <span class="p">[]);</span>
  <span class="k">return</span> <span class="n">size</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">function</span> <span class="n">ShowWindowDimensions</span><span class="p">(</span><span class="n">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">const</span> <span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span> <span class="o">=</span> <span class="n">useWindowSize</span><span class="p">();</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="n">span</span><span class="o">&gt;</span><span class="n">Window</span> <span class="n">size</span><span class="p">:</span> <span class="p">{</span><span class="n">width</span><span class="p">}</span> <span class="n">x</span> <span class="p">{</span><span class="n">height</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>The advantage here is the logic is encapsulated, and you can use this Hook
anywhere you want to use the window size.</p>
<p><strong>Using React classes:</strong></p>
<p>You can listen in componentDidMount, something like this component which just
displays the window dimensions (like <code>&lt;span&gt;Window size: 1024 x 768&lt;/span&gt;</code>):</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">React</span> <span class="kn">from</span> <span class="s1">'react'</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ShowWindowDimensions</span> <span class="n">extends</span> <span class="n">React</span><span class="o">.</span><span class="n">Component</span> <span class="p">{</span>
  <span class="n">state</span> <span class="o">=</span> <span class="p">{</span> <span class="n">width</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">0</span> <span class="p">};</span>
  <span class="n">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="n">span</span><span class="o">&gt;</span><span class="n">Window</span> <span class="n">size</span><span class="p">:</span> <span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">width</span><span class="p">}</span> <span class="n">x</span> <span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">height</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">updateDimensions</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="n">this</span><span class="o">.</span><span class="n">setState</span><span class="p">({</span> <span class="n">width</span><span class="p">:</span> <span class="n">window</span><span class="o">.</span><span class="n">innerWidth</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="n">window</span><span class="o">.</span><span class="n">innerHeight</span> <span class="p">});</span>
  <span class="p">};</span>
  <span class="n">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">window</span><span class="o">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="s1">'resize'</span><span class="p">,</span> <span class="n">this</span><span class="o">.</span><span class="n">updateDimensions</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">componentWillUnmount</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">window</span><span class="o">.</span><span class="n">removeEventListener</span><span class="p">(</span><span class="s1">'resize'</span><span class="p">,</span> <span class="n">this</span><span class="o">.</span><span class="n">updateDimensions</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>@SophieAlpert is right, +1, I just want to provide a modified version of her
solution, <strong>without jQuery</strong> , based on this answer.</p>
<div class="code"><pre class="code literal-block">var<span class="w"> </span>WindowDimensions<span class="w"> </span>=<span class="w"> </span>React.createClass({
<span class="w">    </span>render:<span class="w"> </span>function()<span class="w"> </span>{
<span class="w">        </span>return<span class="w"> </span><span class="nt">&lt;span&gt;</span>{this.state.width}<span class="w"> </span>x<span class="w"> </span>{this.state.height}<span class="nt">&lt;/span&gt;</span>;
<span class="w">    </span>},
<span class="w">    </span>updateDimensions:<span class="w"> </span>function()<span class="w"> </span>{

<span class="w">    </span>var<span class="w"> </span>w<span class="w"> </span>=<span class="w"> </span>window,
<span class="w">        </span>d<span class="w"> </span>=<span class="w"> </span>document,
<span class="w">        </span>documentElement<span class="w"> </span>=<span class="w"> </span>d.documentElement,
<span class="w">        </span>body<span class="w"> </span>=<span class="w"> </span>d.getElementsByTagName('body')[0],
<span class="w">        </span>width<span class="w"> </span>=<span class="w"> </span>w.innerWidth<span class="w"> </span>||<span class="w"> </span>documentElement.clientWidth<span class="w"> </span>||<span class="w"> </span>body.clientWidth,
<span class="w">        </span>height<span class="w"> </span>=<span class="w"> </span>w.innerHeight||<span class="w"> </span>documentElement.clientHeight||<span class="w"> </span>body.clientHeight;

<span class="w">        </span>this.setState({width:<span class="w"> </span>width,<span class="w"> </span>height:<span class="w"> </span>height});
<span class="w">        </span>//<span class="w"> </span>if<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>using<span class="w"> </span>ES2015<span class="w"> </span>I'm<span class="w"> </span>pretty<span class="w"> </span>sure<span class="w"> </span>you<span class="w"> </span>can<span class="w"> </span>do<span class="w"> </span>this:<span class="w"> </span>this.setState({width,<span class="w"> </span>height});
<span class="w">    </span>},
<span class="w">    </span>componentWillMount:<span class="w"> </span>function()<span class="w"> </span>{
<span class="w">        </span>this.updateDimensions();
<span class="w">    </span>},
<span class="w">    </span>componentDidMount:<span class="w"> </span>function()<span class="w"> </span>{
<span class="w">        </span>window.addEventListener("resize",<span class="w"> </span>this.updateDimensions);
<span class="w">    </span>},
<span class="w">    </span>componentWillUnmount:<span class="w"> </span>function()<span class="w"> </span>{
<span class="w">        </span>window.removeEventListener("resize",<span class="w"> </span>this.updateDimensions);
<span class="w">    </span>}
});
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-append-text-to-a-div-element/" class="u-url">How to append text to a div element?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-append-text-to-a-div-element/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:34:15+08:00" itemprop="datePublished" title="2023-03-03 07:34">2023-03-03 07:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I’m using AJAX to append data to a <code>&lt;div&gt;</code> element, where I fill the <code>&lt;div&gt;</code>
from JavaScript. How can I append new data to the <code>&lt;div&gt;</code> without losing the
previous data found in it?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Try this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">div</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s1">'divID'</span><span class="p">);</span>

<span class="n">div</span><span class="o">.</span><span class="n">innerHTML</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s1">'Extra stuff'</span><span class="p">;</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Using appendChild:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">theDiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s2">"&lt;ID_OF_THE_DIV&gt;"</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">createTextNode</span><span class="p">(</span><span class="s2">"&lt;YOUR_CONTENT&gt;"</span><span class="p">);</span>
<span class="n">theDiv</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">content</span><span class="p">);</span>
</pre></div>

<p>Using innerHTML:<br>
This approach will remove all the listeners to the existing elements as
mentioned by @BiAiB. So use caution if you are planning to use this version.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">theDiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s2">"&lt;ID_OF_THE_DIV&gt;"</span><span class="p">);</span>
<span class="n">theDiv</span><span class="o">.</span><span class="n">innerHTML</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">"&lt;YOUR_CONTENT&gt;"</span><span class="p">;</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1713.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1711.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
