<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 763) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-763.html">
<link rel="prev" href="index-764.html" type="text/html">
<link rel="next" href="index-762.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/wait-until-all-jquery-ajax-requests-are-done/" class="u-url">Wait until all jQuery Ajax requests are done?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/wait-until-all-jquery-ajax-requests-are-done/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T15:21:12+08:00" itemprop="datePublished" title="2023-02-17 15:21">2023-02-17 15:21</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I make a function wait until all jQuery Ajax requests are done inside
another function?</p>
<p>In short, I need to wait for all Ajax requests to be done before I execute the
next. But how?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>jQuery now defines a when function for this purpose.</p>
<p>It accepts any number of Deferred objects as arguments, and executes a
function when all of them resolve.</p>
<p>That means, if you want to initiate (for example) four ajax requests, then
perform an action when they are done, you could do something like this:</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="p">.</span><span class="nc">when</span><span class="o">(</span><span class="nt">ajax1</span><span class="o">(),</span><span class="w"> </span><span class="nt">ajax2</span><span class="o">(),</span><span class="w"> </span><span class="nt">ajax3</span><span class="o">(),</span><span class="w"> </span><span class="nt">ajax4</span><span class="o">())</span><span class="p">.</span><span class="nc">done</span><span class="o">(</span><span class="nt">function</span><span class="o">(</span><span class="nt">a1</span><span class="o">,</span><span class="w"> </span><span class="nt">a2</span><span class="o">,</span><span class="w"> </span><span class="nt">a3</span><span class="o">,</span><span class="w"> </span><span class="nt">a4</span><span class="o">)</span><span class="p">{</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">here</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">executed</span><span class="w"> </span><span class="err">when</span><span class="w"> </span><span class="err">all</span><span class="w"> </span><span class="err">four</span><span class="w"> </span><span class="err">ajax</span><span class="w"> </span><span class="err">requests</span><span class="w"> </span><span class="err">resolve.</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">a1,</span><span class="w"> </span><span class="err">a2,</span><span class="w"> </span><span class="err">a3</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">a4</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">lists</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">length</span><span class="w"> </span><span class="err">3</span><span class="w"> </span><span class="err">containing</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">response</span><span class="w"> </span><span class="err">text,</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">status,</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">jqXHR</span><span class="w"> </span><span class="err">object</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">each</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">four</span><span class="w"> </span><span class="err">ajax</span><span class="w"> </span><span class="err">calls</span><span class="w"> </span><span class="err">respectively.</span>
<span class="p">}</span><span class="o">);</span>

<span class="nt">function</span><span class="w"> </span><span class="nt">ajax1</span><span class="o">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="n">NOTE</span><span class="p">:</span><span class="w">  </span><span class="n">This</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w"> </span>
<span class="w">    </span><span class="o">//</span><span class="w">        </span><span class="n">from</span><span class="w"> </span><span class="n">calling</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">$</span><span class="o">.</span><span class="nf">ajax</span><span class="p">()</span><span class="w"> </span><span class="n">method</span><span class="o">.</span>
<span class="w">    </span><span class="n">return</span><span class="w"> </span><span class="err">$</span><span class="o">.</span><span class="nf">ajax</span><span class="p">(</span><span class="err">{</span>
<span class="w">        </span><span class="n">url</span><span class="err">:</span><span class="w"> </span><span class="s2">"someUrl"</span><span class="p">,</span>
<span class="w">        </span><span class="n">dataType</span><span class="err">:</span><span class="w"> </span><span class="s2">"json"</span><span class="p">,</span>
<span class="w">        </span><span class="n">data</span><span class="err">:</span><span class="w">  </span><span class="n">yourJsonData</span><span class="p">,</span><span class="w">            </span>
<span class="w">        </span><span class="err">...</span>
<span class="w">    </span><span class="err">}</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>In my opinion, it makes for a clean and clear syntax, and avoids involving any
global variables such as ajaxStart and ajaxStop, which could have unwanted
side effects as your page develops.</p>
<p>If you don't know in advance how many ajax arguments you need to wait for
(i.e. you want to use a variable number of arguments), it can still be done
but is just a little bit trickier. See Pass in an array of Deferreds to
$.when() (and maybe jQuery .when troubleshooting with variable number of
arguments).</p>
<p>If you need deeper control over the failure modes of the ajax scripts etc.,
you can save the object returned by <code>.when()</code> - it's a jQuery Promise object
encompassing all of the original ajax queries. You can call <code>.then()</code> or
<code>.fail()</code> on it to add detailed success/failure handlers.</p>
<p><br></p>
<h3>Suggest</h3>
<p>If you want to know <strong>when all</strong> <code>ajax</code> requests are finished in your
document, no matter how many of them exists, just use <code>$.ajaxStop</code> event this
way:</p>
<div class="code"><pre class="code literal-block">$(document).ajaxStop(function () {
  // 0 === $.active
});
</pre></div>

<blockquote>
<p>In this case, neither you need to guess how many requests are happening in
the application, that might finish in the future, nor dig into functions
complex logic or find which functions are doing <code>HTTP(S)</code> requests.</p>
<p><code>$.ajaxStop</code> here can also be bound to any <code>HTML</code> node that you think might
be modified by requst.</p>
</blockquote>
<hr>
<p><strong>Update:</strong><br>
If you want to stick with <code>ES</code> syntax, then you can use <code>Promise.all</code> for
known <code>ajax</code> methods:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Promise</span>.<span class="nv">all</span><span class="ss">(</span>[<span class="nv">ajax1</span><span class="ss">()</span>,<span class="w"> </span><span class="nv">ajax2</span><span class="ss">()</span>]<span class="ss">)</span>.<span class="k">then</span><span class="ss">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>{
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">requests</span><span class="w"> </span><span class="nv">finished</span><span class="w"> </span><span class="nv">successfully</span>
}<span class="ss">)</span>.<span class="nv">catch</span><span class="ss">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>{
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">requests</span><span class="w"> </span><span class="nv">finished</span><span class="w"> </span><span class="nv">but</span><span class="w"> </span><span class="nv">one</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">more</span><span class="w"> </span><span class="nv">failed</span>
}<span class="ss">)</span>
</pre></div>

<p>An interesting point here is that it works both with <code>Promises</code> and <code>$.ajax</code>
requests.</p>
<p>Here is the jsFiddle demonstration.</p>
<hr>
<p><strong>Update 2:</strong><br>
Yet more recent version using async/await syntax:</p>
<div class="code"><pre class="code literal-block"><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">ajax1</span><span class="p">(),</span><span class="w"> </span><span class="n">ajax2</span><span class="p">()])</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">actions</span>
<span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-do-a-case-insensitive-string-comparison/" class="u-url">How do I do a case-insensitive string comparison?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-do-a-case-insensitive-string-comparison/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T15:20:43+08:00" itemprop="datePublished" title="2023-02-17 15:20">2023-02-17 15:20</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How can I compare strings in a case insensitive way in Python?</p>
<p>I would like to encapsulate comparison of a regular strings to a repository
string, using simple and Pythonic code. I also would like to have ability to
look up values in a dict hashed by strings using regular python strings.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Assuming ASCII strings:</p>
<div class="code"><pre class="code literal-block"><span class="nv">string1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Hello'</span>
<span class="nv">string2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'hello'</span>

<span class="k">if</span><span class="w"> </span><span class="nv">string1</span>.<span class="nv">lower</span><span class="ss">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">string2</span>.<span class="nv">lower</span><span class="ss">()</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"The strings are the same (case insensitive)"</span><span class="ss">)</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"The strings are NOT the same (case insensitive)"</span><span class="ss">)</span>
</pre></div>

<p>As of Python 3.3, casefold() is a better alternative:</p>
<div class="code"><pre class="code literal-block"><span class="nv">string1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Hello'</span>
<span class="nv">string2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'hello'</span>

<span class="k">if</span><span class="w"> </span><span class="nv">string1</span>.<span class="nv">casefold</span><span class="ss">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">string2</span>.<span class="nv">casefold</span><span class="ss">()</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"The strings are the same (case insensitive)"</span><span class="ss">)</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"The strings are NOT the same (case insensitive)"</span><span class="ss">)</span>
</pre></div>

<p>If you want a more comprehensive solution that handles more complex unicode
comparisons, see other answers.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Comparing strings in a case insensitive way seems trivial, but it's not. I
will be using Python 3, since Python 2 is underdeveloped here.</p>
<p>The first thing to note is that case-removing conversions in Unicode aren't
trivial. There is text for which <code>text.lower() != text.upper().lower()</code>, such
as <code>"ß"</code>:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; "ß".lower()
'ß'
&gt;&gt;&gt; "ß".upper().lower()
'ss'
</pre></div>

<p>But let's say you wanted to caselessly compare <code>"BUSSE"</code> and <code>"Buße"</code>. Heck,
you probably also want to compare <code>"BUSSE"</code> and <code>"BUẞE"</code> equal - that's the
newer capital form. The recommended way is to use <code>casefold</code>:</p>
<blockquote>
<p>str. <strong>casefold</strong> ()</p>
<p>Return a casefolded copy of the string. Casefolded strings may be used for
caseless matching.</p>
<p>Casefolding is similar to lowercasing but more aggressive because it is
intended to remove all case distinctions in a string. [...]</p>
</blockquote>
<p>Do not just use <code>lower</code>. If <code>casefold</code> is not available, doing
<code>.upper().lower()</code> helps (but only somewhat).</p>
<p>Then you should consider accents. If your font renderer is good, you probably
think <code>"ê" == "ê"</code> - but it doesn't:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; "ê" == "ê"
False
</pre></div>

<p>This is because the accent on the latter is a combining character.</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">unicodedata</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">unicodedata</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="s2">"ê"</span><span class="p">]</span>
<span class="p">[</span><span class="s1">'LATIN SMALL LETTER E WITH CIRCUMFLEX'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">unicodedata</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="s2">"ê"</span><span class="p">]</span>
<span class="p">[</span><span class="s1">'LATIN SMALL LETTER E'</span><span class="p">,</span> <span class="s1">'COMBINING CIRCUMFLEX ACCENT'</span><span class="p">]</span>
</pre></div>

<p>The simplest way to deal with this is <code>unicodedata.normalize</code>. You probably
want to use <strong>NFKD</strong> normalization, but feel free to check the documentation.
Then one does</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; unicodedata.normalize("NFKD", "ê") == unicodedata.normalize("NFKD", "ê")
True
</pre></div>

<p>To finish up, here this is expressed in functions:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">unicodedata</span>

<span class="k">def</span> <span class="nf">normalize_caseless</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="s2">"NFKD"</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">casefold</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">caseless_equal</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">normalize_caseless</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">==</span> <span class="n">normalize_caseless</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-set-the-current-working-directory-to-the-directory-of-the-script-in-bash/" class="u-url">How can I set the current working directory to the directory of the script in Bash?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-set-the-current-working-directory-to-the-directory-of-the-script-in-bash/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T15:20:15+08:00" itemprop="datePublished" title="2023-02-17 15:20">2023-02-17 15:20</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm writing a Bash script. I need the current working directory to always be
the directory that the script is located in.</p>
<p>The default behavior is that the current working directory in the script is
that of the shell from which I run it, but I do not want this behavior.</p>
<p><br><br></p>
<h2>Answer</h2>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="posts/how-can-i-set-the-current-working-directory-to-the-directory-of-the-script-in-bash/#-1"><code data-line-number="1"></code></a></td>
<td class="code"><code><span class="ch">#!/bin/bash</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/how-can-i-set-the-current-working-directory-to-the-directory-of-the-script-in-bash/#-2"><code data-line-number="2"></code></a></td>
<td class="code"><code><span class="nb">cd</span><span class="w"> </span><span class="s2">"</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="k">)</span><span class="s2">"</span>
</code></td>
</tr>
</table></div>
<p><br></p>
<h3>Suggest</h3>
<p>The following also works:</p>
<div class="code"><pre class="code literal-block">cd<span class="w"> </span>"<span class="cp">${</span><span class="mi">0</span><span class="o">%/*</span><span class="cp">}</span>"
</pre></div>

<p>The syntax is thoroughly described in this StackOverflow answer.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-764.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-762.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
