<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 432) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-432.html">
<link rel="prev" href="index-433.html" type="text/html">
<link rel="next" href="index-431.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-convert-a-std-string-to-const-char-or-char/" class="u-url">How to convert a std::string to const char* or char*</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-convert-a-std-string-to-const-char-or-char/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T06:43:07+08:00" itemprop="datePublished" title="2023-02-17 06:43">2023-02-17 06:43</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How can I convert an <code>std::string</code> to a <code>char*</code> or a <code>const char*</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>If you just want to pass a <code>std::string</code> to a function that needs <code>const char
*</code>, you can use <code>.c_str()</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="w"> </span><span class="nb">str</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">str</span><span class="o">.</span><span class="n">c_str</span><span class="p">();</span>
</pre></div>

<p>And if you need a non-const <code>char *</code>, call <code>.data()</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nt">std</span><span class="p">::</span><span class="nd">string</span><span class="w"> </span><span class="nt">str</span><span class="o">;</span>
<span class="nt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nt">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">str</span><span class="p">.</span><span class="nc">data</span><span class="o">();</span>
</pre></div>

<p><code>.data()</code> was added in C++17. Before that, you can use <code>&amp;str[0]</code>.</p>
<p>Note that if the <code>std::string</code> is <code>const</code>, <code>.data()</code> will return <code>const char
*</code> instead, like <code>.c_str()</code>.</p>
<p>The pointer becomes invalid if the string is destroyed or reallocates memory.</p>
<p>The pointer points to a null-terminated string, and the terminator doesn't
count against <code>str.size()</code>. You're not allowed to assign a non-null character
to the terminator.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Given say...</p>
<div class="code"><pre class="code literal-block"><span class="nt">std</span><span class="p">::</span><span class="nd">string</span><span class="w"> </span><span class="nt">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hello"</span><span class="o">;</span>
</pre></div>

<h3>Getting a <code>char *</code> or <code>const char*</code> from a <code>string</code>
</h3>
<p><strong>How to get a character pointer that's valid while<code>x</code> remains in scope and
isn't modified further</strong></p>
<p><strong>C++11</strong> simplifies things; the following all give access to the same
internal string buffer:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">p_c_str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">.</span><span class="n">c_str</span><span class="p">();</span>
<span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">p_data</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="p">();</span>
<span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">p_writable_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">C</span><span class="o">++</span><span class="mi">17</span><span class="w"> </span>
<span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">p_x0</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

<span class="w">      </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">p_x0_rw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">compiles</span><span class="w"> </span><span class="n">iff</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">const</span><span class="o">...</span>
</pre></div>

<p>All the above pointers will hold the <em>same value</em> - the address of the first
character in the buffer. Even an empty string has a "first character in the
buffer", because C++11 guarantees to always keep an extra NUL/0 terminator
character after the explicitly assigned string content (e.g.
<code>std::string("this\0that", 9)</code> will have a buffer holding <code>"this\0that\0"</code>).</p>
<p>Given any of the above pointers:</p>
<div class="code"><pre class="code literal-block"><span class="nc">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="o">[</span><span class="n">n</span><span class="o">]</span><span class="p">;</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="k">size</span><span class="p">()</span>
<span class="w">                 </span><span class="o">//</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">e</span><span class="p">.</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">safely</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">NUL</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">p</span><span class="o">[</span><span class="n">x.size()</span><span class="o">]</span>
</pre></div>

<p>Only for the non-<code>const</code> pointer <code>p_writable_data</code> and from <code>&amp;x[0]</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">p_writable_data</span><span class="o">[</span><span class="n">n</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="n">p_x0_rw</span><span class="o">[</span><span class="n">n</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="k">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="o">//</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">e</span><span class="p">.</span><span class="w"> </span><span class="n">don</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">overwrite</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">maintained</span><span class="w"> </span><span class="n">NUL</span>
</pre></div>

<p>Writing a NUL elsewhere in the string does <em>not</em> change the <code>string</code>'s
<code>size()</code>; <code>string</code>'s are allowed to contain any number of NULs - they are
given no special treatment by <code>std::string</code> (same in C++03).</p>
<p>In <strong>C++03</strong> , things were considerably more complicated (key differences
<strong><em>highlighted</em></strong> ):</p>
<ul>
<li>
<p><code>x.data()</code></p>
<ul>
<li>returns <code>const char*</code> to the string's internal buffer <strong><em>which wasn't required by the Standard to conclude with a NUL</em></strong> (i.e. might be <code>['h', 'e', 'l', 'l', 'o']</code> followed by uninitialised or garbage values, with accidental accesses thereto having <em>undefined behaviour</em> ). </li>
<li>
<code>x.size()</code> characters are safe to read, i.e. <code>x[0]</code> through <code>x[x.size() - 1]</code>
</li>
<li>for empty strings, you're guaranteed some non-NULL pointer to which 0 can be safely added (hurray!), but you shouldn't dereference that pointer.</li>
<li>
<p><code>&amp;x[0]</code></p>
</li>
<li>
<p><strong><em>for empty strings this has undefined behaviour</em></strong> (21.3.4) </p>
</li>
<li>e.g. given <code>f(const char* p, size_t n) { if (n == 0) return; ...whatever... }</code> you mustn't call <code>f(&amp;x[0], x.size());</code> when <code>x.empty()</code> - just use <code>f(x.data(), ...)</code>.</li>
<li>otherwise, as per <code>x.data()</code> but: </li>
<li>for non-<code>const</code> <code>x</code> this yields a non-<code>const</code> <code>char*</code> pointer; you can overwrite string content</li>
<li>
<p><code>x.c_str()</code></p>
</li>
<li>
<p>returns <code>const char*</code> to an ASCIIZ (NUL-terminated) representation of the value (i.e. ['h', 'e', 'l', 'l', 'o', '\0']).</p>
</li>
<li>although few if any implementations chose to do so, the C++03 Standard was worded to allow the string implementation the freedom to create a <strong><em>distinct NUL-terminated buffer</em></strong> <em>on the fly</em> , from the potentially non-NUL terminated buffer "exposed" by <code>x.data()</code> and <code>&amp;x[0]</code>
</li>
<li>
<code>x.size()</code> + 1 characters are safe to read.</li>
<li>guaranteed safe even for empty strings (['\0']).</li>
</ul>
</li>
</ul>
<h3>Consequences of accessing outside legal indices</h3>
<p>Whichever way you get a pointer, you must not access memory further along from
the pointer than the characters guaranteed present in the descriptions above.
Attempts to do so have <em>undefined behaviour</em> , with a very real chance of
application crashes and garbage results even for reads, and additionally
wholesale data, stack corruption and/or security vulnerabilities for writes.</p>
<h3>When do those pointers get invalidated?</h3>
<p>If you call some <code>string</code> member function that modifies the <code>string</code> or
reserves further capacity, any pointer values returned beforehand by any of
the above methods are <em>invalidated</em>. You can use those methods again to get
another pointer. (The rules are the same as for iterators into <code>string</code>s).</p>
<p>See also <em>How to get a character pointer valid even after<code>x</code> leaves scope or
is modified further</em> below....</p>
<h3>So, which is <em>better</em> to use?</h3>
<p>From C++11, use <code>.c_str()</code> for ASCIIZ data, and <code>.data()</code> for "binary" data
(explained further below).</p>
<p>In C++03, use <code>.c_str()</code> unless certain that <code>.data()</code> is adequate, and prefer
<code>.data()</code> over <code>&amp;x[0]</code> as it's safe for empty strings....</p>
<p><em>...try to understand the program enough to use<code>data()</code> when appropriate, or
you'll probably make other mistakes...</em></p>
<p>The ASCII NUL '\0' character guaranteed by <code>.c_str()</code> is used by many
functions as a sentinel value denoting the end of relevant and safe-to-access
data. This applies to both C++-only functions like say <code>fstream::fstream(const
char* filename, ...)</code> and shared-with-C functions like <code>strchr()</code>, and
<code>printf()</code>.</p>
<p>Given C++03's <code>.c_str()</code>'s guarantees about the returned buffer are a super-
set of <code>.data()</code>'s, you can always safely use <code>.c_str()</code>, but people sometimes
don't because:</p>
<ul>
<li>using <code>.data()</code> communicates to other programmers reading the source code that the data is not ASCIIZ (rather, you're using the string to store a block of data (which sometimes isn't even really textual)), or that you're passing it to another function that treats it as a block of "binary" data. This can be a crucial insight in ensuring that other programmers' code changes continue to handle the data properly.</li>
<li>C++03 only: there's a slight chance that your <code>string</code> implementation will need to do some extra memory allocation and/or data copying in order to prepare the NUL terminated buffer</li>
</ul>
<p>As a further hint, if a function's parameters require the (<code>const</code>) <code>char*</code>
but don't insist on getting <code>x.size()</code>, the function <em>probably</em> needs an
ASCIIZ input, so <code>.c_str()</code> is a good choice (the function needs to know where
the text terminates somehow, so if it's not a separate parameter it can only
be a convention like a length-prefix or sentinel or some fixed expected
length).</p>
<h3>How to get a character pointer valid even after <code>x</code> leaves scope or is</h3>
<p>modified further</p>
<p>You'll need to <strong><em>copy</em></strong> the contents of the <code>string</code> <code>x</code> to a new memory
area outside <code>x</code>. This external buffer could be in many places such as another
<code>string</code> or character array variable, it may or may not have a different
lifetime than <code>x</code> due to being in a different scope (e.g. namespace, global,
static, heap, shared memory, memory mapped file).</p>
<p>To copy the text from <code>std::string x</code> into an independent character array:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">ANOTHER</span><span class="w"> </span><span class="n">STRING</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AUTO</span><span class="w"> </span><span class="n">MEMORY</span><span class="w"> </span><span class="n">MANAGEMENT</span><span class="p">,</span><span class="w"> </span><span class="k">EXCEPTION</span><span class="w"> </span><span class="n">SAFE</span>
<span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">string</span><span class="w"> </span><span class="n">old_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="o">//</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">old_x</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">affected</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">subsequent</span><span class="w"> </span><span class="n">modifications</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">x</span><span class="p">...</span>
<span class="o">//</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="err">`</span><span class="o">&amp;</span><span class="n">old_x</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="err">`</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">writable</span><span class="w"> </span><span class="nc">char</span><span class="o">*</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">old_x</span><span class="s1">'s textual content</span>
<span class="s1">// - you can use resize() to reduce/expand the string</span>
<span class="s1">//   - resizing isn'</span><span class="n">t</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">within</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">char</span><span class="o">*</span><span class="w"> </span><span class="n">address</span>

<span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">string</span><span class="w"> </span><span class="n">old_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">old_x</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">terminate</span><span class="w"> </span><span class="n">early</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">embeds</span><span class="w"> </span><span class="n">NUL</span>
<span class="o">//</span><span class="w"> </span><span class="n">Copies</span><span class="w"> </span><span class="n">ASCIIZ</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">less</span><span class="w"> </span><span class="n">efficient</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">needs</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">scan</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="k">to</span>
<span class="o">//</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">NUL</span><span class="w"> </span><span class="n">terminator</span><span class="w"> </span><span class="n">indicating</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="n">allocating</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">amount</span>
<span class="o">//</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="k">into</span><span class="p">,</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">efficient</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">ends</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">allocating</span><span class="o">/</span><span class="n">copying</span><span class="w"> </span><span class="n">a</span>
<span class="o">//</span><span class="w"> </span><span class="n">lot</span><span class="w"> </span><span class="k">less</span><span class="w"> </span><span class="n">content</span><span class="p">.</span>
<span class="o">//</span><span class="w"> </span><span class="n">Example</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">"ab\0cd"</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">old_x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">"ab"</span><span class="p">.</span>

<span class="o">//</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">VECTOR</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="nc">CHAR</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">AUTO</span><span class="p">,</span><span class="w"> </span><span class="k">EXCEPTION</span><span class="w"> </span><span class="n">SAFE</span><span class="p">,</span><span class="w"> </span><span class="n">HINTS</span><span class="w"> </span><span class="k">AT</span><span class="w"> </span><span class="nc">BINARY</span><span class="w"> </span><span class="n">CONTENT</span><span class="p">,</span><span class="w"> </span><span class="n">GUARANTEED</span><span class="w"> </span><span class="n">CONTIGUOUS</span><span class="w"> </span><span class="n">EVEN</span><span class="w"> </span><span class="ow">IN</span><span class="w"> </span><span class="n">C</span><span class="o">++</span><span class="mi">03</span>
<span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="nc">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">old_x</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="k">data</span><span class="p">(),</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="k">data</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="k">size</span><span class="p">());</span><span class="w">       </span><span class="o">//</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">NUL</span>
<span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="nc">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">old_x</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">c_str</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="k">size</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">NUL</span>

<span class="o">//</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">STACK</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">MAXIMUM</span><span class="w"> </span><span class="k">SIZE</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="n">KNOWN</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">BE</span><span class="w"> </span><span class="n">COMPILE</span><span class="o">-</span><span class="nc">TIME</span><span class="w"> </span><span class="n">CONSTANT</span><span class="w"> </span><span class="ss">"N"</span>
<span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="nc">bit</span><span class="w"> </span><span class="n">dangerous</span><span class="p">,</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="ss">"known"</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">sometimes</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">often</span><span class="w"> </span><span class="n">become</span><span class="w"> </span><span class="n">wrong</span><span class="p">)</span>
<span class="nc">char</span><span class="w"> </span><span class="n">y</span><span class="o">[</span><span class="n">N + 1</span><span class="o">]</span><span class="p">;</span>
<span class="n">strcpy</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

<span class="o">//</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">STACK</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">UNEXPECTEDLY</span><span class="w"> </span><span class="n">LONG</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="n">TRUNCATED</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span><span class="w"> </span><span class="n">Hello</span><span class="err">\</span><span class="mi">0</span><span class="o">-&gt;</span><span class="n">Hel</span><span class="err">\</span><span class="mi">0</span><span class="p">)</span>
<span class="nc">char</span><span class="w"> </span><span class="n">y</span><span class="o">[</span><span class="n">N + 1</span><span class="o">]</span><span class="p">;</span>
<span class="n">strncpy</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="o">-</span><span class="n">padding</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">shorter</span>
<span class="n">y</span><span class="o">[</span><span class="n">N</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'\0'</span><span class="p">;</span><span class="w">               </span><span class="o">//</span><span class="w"> </span><span class="n">ensure</span><span class="w"> </span><span class="n">NUL</span><span class="w"> </span><span class="n">terminated</span>

<span class="o">//</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">STACK</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">HANDLE</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="k">UNKNOWN</span><span class="w"> </span><span class="p">(</span><span class="n">BUT</span><span class="w"> </span><span class="n">SANE</span><span class="p">)</span><span class="w"> </span><span class="n">LENGTH</span>
<span class="nc">char</span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alloca</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="k">size</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="n">strcpy</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

<span class="o">//</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">THE</span><span class="w"> </span><span class="n">STACK</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">HANDLE</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="k">UNKNOWN</span><span class="w"> </span><span class="n">LENGTH</span><span class="w"> </span><span class="p">(</span><span class="n">NON</span><span class="o">-</span><span class="n">STANDARD</span><span class="w"> </span><span class="n">GCC</span><span class="w"> </span><span class="n">EXTENSION</span><span class="p">)</span>
<span class="nc">char</span><span class="w"> </span><span class="n">y</span><span class="o">[</span><span class="n">x.size() + 1</span><span class="o">]</span><span class="p">;</span>
<span class="n">strcpy</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

<span class="o">//</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="k">new</span><span class="o">/</span><span class="k">delete</span><span class="w"> </span><span class="n">HEAP</span><span class="w"> </span><span class="n">MEMORY</span><span class="p">,</span><span class="w"> </span><span class="n">MANUAL</span><span class="w"> </span><span class="n">DEALLOC</span><span class="p">,</span><span class="w"> </span><span class="k">NO</span><span class="w"> </span><span class="n">INHERENT</span><span class="w"> </span><span class="k">EXCEPTION</span><span class="w"> </span><span class="n">SAFETY</span>
<span class="nc">char</span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">char</span><span class="o">[</span><span class="n">x.size() + 1</span><span class="o">]</span><span class="p">;</span>
<span class="n">strcpy</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="o">//</span><span class="w">     </span><span class="ow">or</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">one</span><span class="o">-</span><span class="nl">liner</span><span class="p">:</span><span class="w"> </span><span class="nc">char</span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strcpy</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="nc">char</span><span class="o">[</span><span class="n">x.size() + 1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="o">//</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">y</span><span class="p">...</span>
<span class="k">delete</span><span class="err">[]</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="k">break</span><span class="p">,</span><span class="w"> </span><span class="k">return</span><span class="p">,</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">branching</span><span class="w"> </span><span class="n">bypasses</span><span class="w"> </span><span class="n">this</span>

<span class="o">//</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="k">new</span><span class="o">/</span><span class="k">delete</span><span class="w"> </span><span class="n">HEAP</span><span class="w"> </span><span class="n">MEMORY</span><span class="p">,</span><span class="w"> </span><span class="n">SMART</span><span class="w"> </span><span class="n">POINTER</span><span class="w"> </span><span class="n">DEALLOCATION</span><span class="p">,</span><span class="w"> </span><span class="k">EXCEPTION</span><span class="w"> </span><span class="n">SAFE</span>
<span class="o">//</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">boost</span><span class="w"> </span><span class="n">shared_array</span><span class="w"> </span><span class="k">usage</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Johannes</span><span class="w"> </span><span class="n">Schaub</span><span class="err">'</span><span class="n">s</span><span class="w"> </span><span class="n">answer</span>

<span class="o">//</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">malloc</span><span class="o">/</span><span class="k">free</span><span class="w"> </span><span class="n">HEAP</span><span class="w"> </span><span class="n">MEMORY</span><span class="p">,</span><span class="w"> </span><span class="n">MANUAL</span><span class="w"> </span><span class="n">DEALLOC</span><span class="p">,</span><span class="w"> </span><span class="k">NO</span><span class="w"> </span><span class="n">INHERENT</span><span class="w"> </span><span class="k">EXCEPTION</span><span class="w"> </span><span class="n">SAFETY</span>
<span class="nc">char</span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strdup</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="o">//</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">y</span><span class="p">...</span>
<span class="k">free</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
</pre></div>

<h3>Other reasons to want a <code>char*</code> or <code>const char*</code> generated from a <code>string</code>
</h3>
<p>So, above you've seen how to get a (<code>const</code>) <code>char*</code>, and how to make a copy
of the text independent of the original <code>string</code>, but what can you <em>do</em> with
it? A random smattering of examples...</p>
<ul>
<li>give "C" code access to the C++ <code>string</code>'s text, as in <code>printf("x is '%s'", x.c_str());</code>
</li>
<li>copy <code>x</code>'s text to a buffer specified by your function's caller (e.g. <code>strncpy(callers_buffer, callers_buffer_size, x.c_str())</code>), or volatile memory used for device I/O (e.g. <code>for (const char* p = x.c_str(); *p; ++p) *p_device = *p;</code>)</li>
<li>append <code>x</code>'s text to an character array already containing some ASCIIZ text (e.g. <code>strcat(other_buffer, x.c_str())</code>) - be careful not to overrun the buffer (in many situations you may need to use <code>strncat</code>)</li>
<li>return a <code>const char*</code> or <code>char*</code> from a function (perhaps for historical reasons - client's using your existing API - or for C compatibility you don't want to return a <code>std::string</code>, but do want to copy your <code>string</code>'s data somewhere for the caller) <ul>
<li>be careful not to return a pointer that may be dereferenced by the caller after a local <code>string</code> variable to which that pointer pointed has left scope</li>
<li>some projects with shared objects compiled/linked for different <code>std::string</code> implementations (e.g. STLport and compiler-native) may pass data as ASCIIZ to avoid conflicts</li>
</ul>
</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/force-git-push-to-overwrite-remote-files/" class="u-url">Force "git push" to overwrite remote files</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/force-git-push-to-overwrite-remote-files/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T06:42:42+08:00" itemprop="datePublished" title="2023-02-17 06:42">2023-02-17 06:42</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to push my local files, and have them on a remote repo, without having
to deal with merge conflicts. I just want my local version to have priority
over the remote one.</p>
<p>How can I do this with Git?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You should be able to force your local revision to the remote repo by using</p>
<div class="code"><pre class="code literal-block">git push -f &lt;remote&gt; &lt;branch&gt;
</pre></div>

<p>(e.g. <code>git push -f origin master</code>). Leaving off <code>&lt;remote&gt;</code> and <code>&lt;branch&gt;</code> will
force push all local branches that have set <code>--set-upstream</code>.</p>
<p>Just be warned, if other people are sharing this repository their revision
history will conflict with the new one. And if they have any local commits
after the point of change they will become invalid.</p>
<p><strong>Update</strong> : Thought I would add a side-note. If you are creating changes that
others will review, then it's not uncommon to create a branch with those
changes and rebase periodically to keep them up-to-date with the main
development branch. Just let other developers know this will happen
periodically so they'll know what to expect.</p>
<p><strong>Update 2</strong> : Because of the increasing number of viewers I'd like to add
some additional information on what to do when your <code>upstream</code> does experience
a force push.</p>
<p>Say I've cloned your repo and have added a few commits like so:</p>
<div class="code"><pre class="code literal-block">            D----E  topic
           /
A----B----C         development
</pre></div>

<p>But later the <code>development</code> branch is hit with a <code>rebase</code>, which will cause me
to receive an error like so when I run <code>git pull</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nt">Unpacking</span><span class="w"> </span><span class="nt">objects</span><span class="o">:</span><span class="w"> </span><span class="nt">100</span><span class="o">%</span><span class="w"> </span><span class="o">(</span><span class="nt">3</span><span class="o">/</span><span class="nt">3</span><span class="o">),</span><span class="w"> </span><span class="nt">done</span><span class="o">.</span>
<span class="nt">From</span><span class="w"> </span><span class="o">&lt;</span><span class="nt">repo-location</span><span class="o">&gt;</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nt">branch</span><span class="w">            </span><span class="nt">development</span><span class="w">     </span><span class="nt">-</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">FETCH_HEAD</span>
<span class="nt">Auto-merging</span><span class="w"> </span><span class="o">&lt;</span><span class="nt">files</span><span class="o">&gt;</span>
<span class="nt">CONFLICT</span><span class="w"> </span><span class="o">(</span><span class="nt">content</span><span class="o">):</span><span class="w"> </span><span class="nt">Merge</span><span class="w"> </span><span class="nt">conflict</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="o">&lt;</span><span class="nt">locations</span><span class="o">&gt;</span>
<span class="nt">Automatic</span><span class="w"> </span><span class="nt">merge</span><span class="w"> </span><span class="nt">failed</span><span class="o">;</span><span class="w"> </span><span class="nt">fix</span><span class="w"> </span><span class="nt">conflicts</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">then</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">result</span><span class="o">.</span>
</pre></div>

<p>Here I could fix the conflicts and <code>commit</code>, but that would leave me with a
really ugly commit history:</p>
<div class="code"><pre class="code literal-block">       C----D----E----F    topic
      /              /
A----B--------------C'  development
</pre></div>

<p>It might look enticing to use <code>git pull --force</code> but be careful because
that'll leave you with stranded commits:</p>
<div class="code"><pre class="code literal-block">            D----E   topic

A----B----C'         development
</pre></div>

<p>So probably the best option is to do a <code>git pull --rebase</code>. This will require
me to resolve any conflicts like before, but for each step instead of
committing I'll use <code>git rebase --continue</code>. In the end the commit history
will look much better:</p>
<div class="code"><pre class="code literal-block">            D'---E'  topic
           /
A----B----C'         development
</pre></div>

<p><strong>Update 3:</strong> You can also use the <code>--force-with-lease</code> option as a "safer"
force push, as mentioned by Cupcake in his answer:</p>
<blockquote>
<p>Force pushing with a "lease" allows the force push to fail if there are new
commits on the remote that you didn't expect (technically, if you haven't
fetched them into your remote-tracking branch yet), which is useful if you
don't want to accidentally overwrite someone else's commits that you didn't
even know about yet, and you just want to overwrite your own:</p>
<div class="code"><pre class="code literal-block">git push &lt;remote&gt; &lt;branch&gt; --force-with-lease
</pre></div>

<p>You can learn more details about how to use <code>--force-with-lease</code> by reading
any of the following:</p>
<ul>
<li>
<code>git push</code> documentation</li>
<li>Git: How to ignore fast forward and revert origin [branch] to earlier
commit?
</li>
</ul>
</blockquote>
<p><br></p>
<h3>Suggest</h3>
<h3>You want to force push</h3>
<p>What you basically want to do is to force push your local branch, in order to
overwrite the remote one.</p>
<p>If you want a more detailed explanation of each of the following commands,
then see my details section below. You basically have 4 different options for
force pushing with Git:</p>
<div class="code"><pre class="code literal-block">git push &lt;remote&gt; &lt;branch&gt; -f
git push origin master -f # Example

git push &lt;remote&gt; -f
git push origin -f # Example

git push -f

git push &lt;remote&gt; &lt;branch&gt; --force-with-lease
</pre></div>

<p>If you want a more detailed explanation of each command, then see my long
answers section below.</p>
<p><strong>Warning:</strong> force pushing will overwrite the remote branch with the state of
the branch that you're pushing. Make sure that this is what you really want to
do before you use it, otherwise you may overwrite commits that you actually
want to keep.</p>
<h2>Force pushing details</h2>
<h4>Specifying the remote and branch</h4>
<p>You can completely specify specific branches and a remote. The <code>-f</code> flag is
the short version of <code>--force</code></p>
<div class="code"><pre class="code literal-block">git push &lt;remote&gt; &lt;branch&gt; --force
git push &lt;remote&gt; &lt;branch&gt; -f
</pre></div>

<h4>Omitting the branch</h4>
<p>When the branch to push branch is omitted, Git will figure it out based on
your config settings. In Git versions after 2.0, a new repo will have default
settings to push the currently checked-out branch:</p>
<div class="code"><pre class="code literal-block">git push &lt;remote&gt; --force
</pre></div>

<p>while prior to 2.0, new repos will have default settings to push multiple
local branches. The settings in question are the <code>remote.&lt;remote&gt;.push</code> and
<code>push.default</code> settings (see below).</p>
<h4>Omitting the remote and the branch</h4>
<p>When both the remote and the branch are omitted, the behavior of just <code>git
push --force</code> is determined by your <code>push.default</code> Git config settings:</p>
<div class="code"><pre class="code literal-block">git push --force
</pre></div>

<ul>
<li>
<p>As of Git 2.0, the default setting, <code>simple</code>, will basically just push your current branch to its upstream remote counter-part. The remote is determined by the branch's <code>branch.&lt;remote&gt;.remote</code> setting, and defaults to the origin repo otherwise.</p>
</li>
<li>
<p>Before Git version 2.0, the default setting, <code>matching</code>, basically just pushes all of your local branches to branches with the same name on the remote (which defaults to origin).</p>
</li>
</ul>
<p>You can read more <code>push.default</code> settings by reading <code>git help config</code> or an
online version of the git-config(1) Manual Page.</p>
<h4>Force pushing more safely with <code>--force-with-lease</code>
</h4>
<p>Force pushing with a "lease" allows the force push to fail if there are new
commits on the remote that you didn't expect (technically, if you haven't
fetched them into your remote-tracking branch yet), which is useful if you
don't want to accidentally overwrite someone else's commits that you didn't
even know about yet, and you just want to overwrite your own:</p>
<div class="code"><pre class="code literal-block">git push &lt;remote&gt; &lt;branch&gt; --force-with-lease
</pre></div>

<p>You can learn more details about how to use <code>--force-with-lease</code> by reading
any of the following:</p>
<ul>
<li>
<code>git push</code> documentation</li>
<li>Git: How to ignore fast forward and revert origin [branch] to earlier commit?</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-are-the-nuances-of-scope-prototypal-prototypical-inheritance-in-angularjs/" class="u-url">What are the nuances of scope prototypal / prototypical inheritance in AngularJS?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-are-the-nuances-of-scope-prototypal-prototypical-inheritance-in-angularjs/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T06:42:12+08:00" itemprop="datePublished" title="2023-02-17 06:42">2023-02-17 06:42</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>The API Reference Scope page says:</p>
<blockquote>
<p>A scope <em>can</em> inherit from a parent scope.</p>
</blockquote>
<p>The Developer Guide Scope page says:</p>
<blockquote>
<p>A scope (prototypically) inherits properties from its parent scope.</p>
</blockquote>
<ul>
<li>So, does a child scope always prototypically inherit from its parent scope? </li>
<li>Are there exceptions? </li>
<li>When it does inherit, is it always normal JavaScript prototypal inheritance?</li>
</ul>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>Quick answer</strong> :<br>
A child scope normally prototypically inherits from its parent scope, but not
always. One exception to this rule is a directive with <code>scope: { ... }</code> --
this creates an "isolate" scope that does not prototypically inherit. This
construct is often used when creating a "reusable component" directive.</p>
<p>As for the nuances, scope inheritance is normally straightfoward... until you
need <strong>2-way data binding</strong> (i.e., form elements, ng-model) in the child
scope. Ng-repeat, ng-switch, and ng-include can trip you up if you try to bind
to a <strong>primitive</strong> (e.g., number, string, boolean) in the parent scope from
inside the child scope. It doesn't work the way most people expect it should
work. The child scope gets its own property that hides/shadows the parent
property of the same name. Your workarounds are</p>
<ol>
<li>define objects in the parent for your model, then reference a property of that object in the child: parentObj.someProp</li>
<li>use $parent.parentScopeProperty (not always possible, but easier than 1. where possible)</li>
<li>define a function on the parent scope, and call it from the child (not always possible)</li>
</ol>
<p>New AngularJS developers often do not realize that <code>ng-repeat</code>, <code>ng-switch</code>,
<code>ng-view</code>, <code>ng-include</code> and <code>ng-if</code> all create new child scopes, so the
problem often shows up when these directives are involved. (See this example
for a quick illustration of the problem.)</p>
<p>This issue with primitives can be easily avoided by following the "best
practice" of always have a '.' in your ng-models – watch 3 minutes worth.
Misko demonstrates the primitive binding issue with <code>ng-switch</code>.</p>
<p>Having a '.' in your models will ensure that prototypal inheritance is in
play. So, use</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">input</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s">"text"</span><span class="w"> </span><span class="n">ng</span><span class="o">-</span><span class="n">model</span><span class="o">=</span><span class="s">"someObj.prop1"</span><span class="o">&gt;</span>

<span class="o">&lt;!--</span><span class="n">rather</span><span class="w"> </span><span class="n">than</span>
<span class="o">&lt;</span><span class="n">input</span><span class="w"> </span><span class="kr">type</span><span class="o">=</span><span class="s">"text"</span><span class="w"> </span><span class="n">ng</span><span class="o">-</span><span class="n">model</span><span class="o">=</span><span class="s">"prop1"</span><span class="o">&gt;</span><span class="err">`</span>
<span class="o">--&gt;</span>
</pre></div>

<hr>
<p><strong>L-o-n-g answer</strong> :</p>
<h3>JavaScript Prototypal Inheritance</h3>
<p><strong>Also placed on the AngularJS wiki:</strong>
https://github.com/angular/angular.js/wiki/Understanding-Scopes</p>
<p>It is important to first have a solid understanding of prototypal inheritance,
especially if you are coming from a server-side background and you are more
familiar with class-ical inheritance. So let's review that first.</p>
<p>Suppose parentScope has properties aString, aNumber, anArray, anObject, and
aFunction. If childScope prototypically inherits from parentScope, we have:</p>
<p><img alt="prototypal inheritance" src="images/aTAGg.png"></p>
<p>(Note that to save space, I show the <code>anArray</code> object as a single blue object
with its three values, rather than an single blue object with three separate
gray literals.)</p>
<p>If we try to access a property defined on the parentScope from the child
scope, JavaScript will first look in the child scope, not find the property,
then look in the inherited scope, and find the property. (If it didn't find
the property in the parentScope, it would continue up the prototype chain...
all the way up to the root scope). So, these are all true:</p>
<div class="code"><pre class="code literal-block">childScope.aString === 'parent string'
childScope.anArray[1] === 20
childScope.anObject.property1 === 'parent prop1'
childScope.aFunction() === 'parent output'
</pre></div>

<p>Suppose we then do this:</p>
<div class="code"><pre class="code literal-block">childScope.aString = 'child string'
</pre></div>

<p>The prototype chain is not consulted, and a new aString property is added to
the childScope. <strong>This new property hides/shadows the parentScope property
with the same name.</strong> This will become very important when we discuss ng-
repeat and ng-include below.</p>
<p><img alt="property hiding" src="images/OyVPW.png"></p>
<p>Suppose we then do this:</p>
<div class="code"><pre class="code literal-block">childScope.anArray[1] = '22'
childScope.anObject.property1 = 'child prop1'
</pre></div>

<p>The prototype chain is consulted because the objects (anArray and anObject)
are not found in the childScope. The objects are found in the parentScope, and
the property values are updated on the original objects. No new properties are
added to the childScope; no new objects are created. (Note that in JavaScript
arrays and functions are also objects.)</p>
<p><img alt="follow the prototype chain" src="images/2QceU.png"></p>
<p>Suppose we then do this:</p>
<div class="code"><pre class="code literal-block">childScope.anArray = [100, 555]
childScope.anObject = { name: 'Mark', country: 'USA' }
</pre></div>

<p>The prototype chain is not consulted, and child scope gets two new object
properties that hide/shadow the parentScope object properties with the same
names.</p>
<p><img alt="more property hiding" src="images/hKetH.png"></p>
<p>Takeaways:</p>
<ul>
<li>If we read childScope.propertyX, and childScope has propertyX, then the prototype chain is not consulted.</li>
<li>If we set childScope.propertyX, the prototype chain is not consulted.</li>
</ul>
<p>One last scenario:</p>
<div class="code"><pre class="code literal-block">delete childScope.anArray
childScope.anArray[1] === 22  // true
</pre></div>

<p>We deleted the childScope property first, then when we try to access the
property again, the prototype chain is consulted.</p>
<p><img alt="after removing a child property" src="images/56uoe.png"></p>
<hr>
<h3>Angular Scope Inheritance</h3>
<p>The contenders:</p>
<ul>
<li>The following create new scopes, and inherit prototypically: ng-repeat, ng-include, ng-switch, ng-controller, directive with <code>scope: true</code>, directive with <code>transclude: true</code>.</li>
<li>The following creates a new scope which does not inherit prototypically: directive with <code>scope: { ... }</code>. This creates an "isolate" scope instead.</li>
</ul>
<p>Note, by default, directives do not create new scope -- i.e., the default is
<code>scope: false</code>.</p>
<h4>ng-include</h4>
<p>Suppose we have in our controller:</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="nt">scope</span><span class="p">.</span><span class="nc">myPrimitive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">50</span><span class="o">;</span>
<span class="o">$</span><span class="nt">scope</span><span class="p">.</span><span class="nc">myObject</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">aNumber</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="p">}</span><span class="o">;</span>
</pre></div>

<p>And in our HTML:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">"text/ng-template"</span><span class="w"> </span><span class="na">id=</span><span class="s">"/tpl1.html"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"myPrimitive"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="err">ng-include</span><span class="w"> </span><span class="na">src=</span><span class="s">"'/tpl1.html'"</span><span class="nt">&gt;&lt;/div&gt;</span>

<span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">"text/ng-template"</span><span class="w"> </span><span class="na">id=</span><span class="s">"/tpl2.html"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"myObject.aNumber"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="err">ng-include</span><span class="w"> </span><span class="na">src=</span><span class="s">"'/tpl2.html'"</span><span class="nt">&gt;&lt;/div&gt;</span>
</pre></div>

<p>Each ng-include generates a new child scope, which prototypically inherits
from the parent scope.</p>
<p><img alt="ng-include child scopes" src="images/ziDfx.png"></p>
<p>Typing (say, "77") into the first input textbox causes the child scope to get
a new <code>myPrimitive</code> scope property that hides/shadows the parent scope
property of the same name. This is probably not what you want/expect.</p>
<p><img alt="ng-include with a primitive" src="images/7l8dg.png"></p>
<p>Typing (say, "99") into the second input textbox does not result in a new
child property. Because tpl2.html binds the model to an object property,
prototypal inheritance kicks in when the ngModel looks for object myObject --
it finds it in the parent scope.</p>
<p><img alt="ng-include with an object" src="https://i.imgur.com/ZqqloMS.png"></p>
<p>We can rewrite the first template to use $parent, if we don't want to change
our model from a primitive to an object:</p>
<div class="code"><pre class="code literal-block">&lt;input ng-model="$parent.myPrimitive"&gt;
</pre></div>

<p>Typing (say, "22") into this input textbox does not result in a new child
property. The model is now bound to a property of the parent scope (because
$parent is a child scope property that references the parent scope).</p>
<p><img alt="ng-include with $parent" src="images/kd8pj.png"></p>
<p>For all scopes (prototypal or not), Angular always tracks a parent-child
relationship (i.e., a hierarchy), via scope properties $parent, $$childHead
and $$childTail. I normally don't show these scope properties in the diagrams.</p>
<p>For scenarios where form elements are not involved, another solution is to
define a function on the parent scope to modify the primitive. Then ensure the
child always calls this function, which will be available to the child scope
due to prototypal inheritance. E.g.,</p>
<div class="code"><pre class="code literal-block"><span class="c1">// in the parent scope</span>
<span class="no">$</span><span class="n">scope</span><span class="p">.</span><span class="n">setMyPrimitive</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="no">$</span><span class="n">scope</span><span class="p">.</span><span class="n">myPrimitive</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Here is a sample fiddle that uses this "parent function" approach. (The fiddle
was written as part of this answer:
https://stackoverflow.com/a/14104318/215945.)</p>
<p>See also https://stackoverflow.com/a/13782671/215945 and
https://github.com/angular/angular.js/issues/1267.</p>
<h4>ng-switch</h4>
<p>ng-switch scope inheritance works just like ng-include. So if you need 2-way
data binding to a primitive in the parent scope, use $parent, or change the
model to be an object and then bind to a property of that object. This will
avoid child scope hiding/shadowing of parent scope properties.</p>
<p>See also AngularJS, bind scope of a switch-case?</p>
<h4>ng-repeat</h4>
<p>Ng-repeat works a little differently. Suppose we have in our controller:</p>
<div class="code"><pre class="code literal-block">$scope.myArrayOfPrimitives = [ 11, 22 ];
$scope.myArrayOfObjects    = [{num: 101}, {num: 202}]
</pre></div>

<p>And in our HTML:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;ul&gt;&lt;li</span><span class="w"> </span><span class="na">ng-repeat=</span><span class="s">"num in myArrayOfPrimitives"</span><span class="nt">&gt;</span>
<span class="w">       </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"num"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;ul&gt;</span>
<span class="nt">&lt;ul&gt;&lt;li</span><span class="w"> </span><span class="na">ng-repeat=</span><span class="s">"obj in myArrayOfObjects"</span><span class="nt">&gt;</span>
<span class="w">       </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"obj.num"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;ul&gt;</span>
</pre></div>

<p>For each item/iteration, ng-repeat creates a new scope, which prototypically
inherits from the parent scope, <strong>but it also assigns the item's value to a
new property on the new child scope</strong>. (The name of the new property is the
loop variable's name.) Here's what the Angular source code for ng-repeat
actually is:</p>
<div class="code"><pre class="code literal-block"><span class="n">childScope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">scope</span><span class="p">.</span><span class="err">$</span><span class="k">new</span><span class="p">();</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">scope</span><span class="w"> </span><span class="n">prototypically</span><span class="w"> </span><span class="n">inherits</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="k">scope</span>
<span class="p">...</span>
<span class="n">childScope</span><span class="o">[</span><span class="n">valueIdent</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">creates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">childScope</span><span class="w"> </span><span class="n">property</span>
</pre></div>

<p>If item is a primitive (as in myArrayOfPrimitives), essentially a copy of the
value is assigned to the new child scope property. Changing the child scope
property's value (i.e., using ng-model, hence child scope <code>num</code>) does <strong>not</strong>
change the array the parent scope references. So in the first ng-repeat above,
each child scope gets a <code>num</code> property that is independent of the
myArrayOfPrimitives array:</p>
<p><img alt="ng-repeat with primitives" src="images/nLoiW.png"></p>
<p>This ng-repeat will not work (like you want/expect it to). Typing into the
textboxes changes the values in the gray boxes, which are only visible in the
child scopes. What we want is for the inputs to affect the myArrayOfPrimitives
array, not a child scope primitive property. To accomplish this, we need to
change the model to be an array of objects.</p>
<p>So, if item is an object, a reference to the original object (not a copy) is
assigned to the new child scope property. Changing the child scope property's
value (i.e., using ng-model, hence <code>obj.num</code>) <strong>does</strong> change the object the
parent scope references. So in the second ng-repeat above, we have:</p>
<p><img alt="ng-repeat with objects" src="images/QSjTJ.png"></p>
<p>(I colored one line gray just so that it is clear where it is going.)</p>
<p>This works as expected. Typing into the textboxes changes the values in the
gray boxes, which are visible to both the child and parent scopes.</p>
<p>See also Difficulty with ng-model, ng-repeat, and inputs and
https://stackoverflow.com/a/13782671/215945</p>
<h4>ng-controller</h4>
<p>Nesting controllers using ng-controller results in normal prototypal
inheritance, just like ng-include and ng-switch, so the same techniques apply.
However, "it is considered bad form for two controllers to share information
via $scope inheritance" -- http://onehungrymind.com/angularjs-sticky-notes-
pt-1-architecture/ A service should be used to share data between controllers
instead.</p>
<p>(If you really want to share data via controllers scope inheritance, there is
nothing you need to do. The child scope will have access to all of the parent
scope properties. See also Controller load order differs when loading or
navigating)</p>
<h4>directives</h4>
<ol>
<li>default (<code>scope: false</code>) - the directive does not create a new scope, so there is no inheritance here. This is easy, but also dangerous because, e.g., a directive might think it is creating a new property on the scope, when in fact it is clobbering an existing property. This is not a good choice for writing directives that are intended as reusable components.</li>
<li>
<code>scope: true</code> - the directive creates a new child scope that prototypically inherits from the parent scope. If more than one directive (on the same DOM element) requests a new scope, only one new child scope is created. Since we have "normal" prototypal inheritance, this is like ng-include and ng-switch, so be wary of 2-way data binding to parent scope primitives, and child scope hiding/shadowing of parent scope properties.</li>
<li>
<p><code>scope: { ... }</code> - the directive creates a new isolate/isolated scope. It does not prototypically inherit. This is usually your best choice when creating reusable components, since the directive cannot accidentally read or modify the parent scope. However, such directives often need access to a few parent scope properties. The object hash is used to set up two-way binding (using '=') or one-way binding (using '@') between the parent scope and the isolate scope. There is also '&amp;' to bind to parent scope expressions. So, these all create local scope properties that are derived from the parent scope. Note that attributes are used to help set up the binding -- you can't just reference parent scope property names in the object hash, you have to use an attribute. E.g., this won't work if you want to bind to parent property <code>parentProp</code> in the isolated scope: <code>&lt;div my-directive&gt;</code> and <code>scope: { localProp: '@parentProp' }</code>. An attribute must be used to specify each parent property that the directive wants to bind to: <code>&lt;div my-directive the-Parent-Prop=parentProp&gt;</code> and <code>scope: { localProp: '@theParentProp' }</code>. <br>
Isolate scope's <code>__proto__</code> references Object. Isolate scope's $parent
references the parent scope, so although it is isolated and doesn't inherit
prototypically from the parent scope, it is still a child scope.<br>
For the picture below we have<br><code>&lt;my-directive interpolated="{{parentProp1}}" twowayBinding="parentProp2"&gt;</code>
and<br><code>scope: { interpolatedProp: '@interpolated', twowayBindingProp:
'=twowayBinding' }</code><br>
Also, assume the directive does this in its linking function:
<code>scope.someIsolateProp = "I'm isolated"</code><br><img alt="isolated scope" src="images/MUxS4.png"><br>
For more information on isolate scopes see http://onehungrymind.com/angularjs-
sticky-notes-pt-2-isolated-scope/</p>
</li>
<li>
<p><code>transclude: true</code> - the directive creates a new "transcluded" child scope, which prototypically inherits from the parent scope. The transcluded and the isolated scope (if any) are siblings -- the $parent property of each scope references the same parent scope. When a transcluded and an isolate scope both exist, isolate scope property $$nextSibling will reference the transcluded scope. I'm not aware of any nuances with the transcluded scope. <br>
For the picture below, assume the same directive as above with this addition:
<code>transclude: true</code><br><img alt="transcluded scope" src="images/fkWHA.png"></p>
</li>
</ol>
<p>This fiddle has a <code>showScope()</code> function that can be used to examine an
isolate and transcluded scope. See the instructions in the comments in the
fiddle.</p>
<hr>
<h3>Summary</h3>
<p>There are four types of scopes:</p>
<ol>
<li>normal prototypal scope inheritance -- ng-include, ng-switch, ng-controller, directive with <code>scope: true</code>
</li>
<li>normal prototypal scope inheritance with a copy/assignment -- ng-repeat. Each iteration of ng-repeat creates a new child scope, and that new child scope always gets a new property.</li>
<li>isolate scope -- directive with <code>scope: {...}</code>. This one is not prototypal, but '=', '@', and '&amp;' provide a mechanism to access parent scope properties, via attributes.</li>
<li>transcluded scope -- directive with <code>transclude: true</code>. This one is also normal prototypal scope inheritance, but it is also a sibling of any isolate scope.</li>
</ol>
<p>For all scopes (prototypal or not), Angular always tracks a parent-child
relationship (i.e., a hierarchy), via properties $parent and $$childHead and
$$childTail.</p>
<p>Diagrams were generated with graphviz "*.dot" files, which are on github. Tim
Caswell's "Learning JavaScript with Object Graphs" was the inspiration for
using GraphViz for the diagrams.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I in no way want to compete with Mark's answer, but just wanted to highlight
the piece that finally made everything click as someone new to Javascript
inheritance and its prototype chain.</p>
<p><strong>Only property reads search the prototype chain, not writes.</strong> So when you
set</p>
<div class="code"><pre class="code literal-block">myObject.prop = '123';
</pre></div>

<p>It doesn't look up the chain, but when you set</p>
<div class="code"><pre class="code literal-block">myObject.myThing.prop = '123';
</pre></div>

<p><strong>there's a subtle read going on within that write operation</strong> that tries to
look up myThing before writing to its prop. So that's why writing to
object.properties from the child gets at the parent's objects.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-433.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-431.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
