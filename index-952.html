<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 952) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-952.html">
<link rel="prev" href="index-953.html" type="text/html">
<link rel="next" href="index-951.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/preferred-method-to-store-php-arrays-json-encode-vs-serialize/" class="u-url">Preferred method to store PHP arrays (json_encode vs serialize)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/preferred-method-to-store-php-arrays-json-encode-vs-serialize/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T20:25:21+08:00" itemprop="datePublished" title="2023-02-17 20:25">2023-02-17 20:25</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I need to store a multi-dimensional associative array of data in a flat file
for caching purposes. I might occasionally come across the need to convert it
to JSON for use in my web app but the vast majority of the time I will be
using the array directly in PHP.</p>
<p>Would it be more efficient to store the array as JSON or as a PHP serialized
array in this text file? I've looked around and it seems that in the newest
versions of PHP (5.3), <code>json_decode</code> is actually faster than <code>unserialize</code>.</p>
<p>I'm currently leaning towards storing the array as JSON as I feel its easier
to read by a human if necessary, it can be used in both PHP and JavaScript
with very little effort, and from what I've read, it might even be faster to
decode (not sure about encoding, though).</p>
<p>Does anyone know of any pitfalls? Anyone have good benchmarks to show the
performance benefits of either method?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Depends on your priorities.</p>
<p>If performance is your absolute driving characteristic, then by all means use
the fastest one. Just make sure you have a full understanding of the
differences before you make a choice</p>
<ul>
<li>Unlike <code>serialize()</code> you need to add extra parameter to keep UTF-8 characters untouched: <code>json_encode($array, JSON_UNESCAPED_UNICODE)</code> (otherwise it converts UTF-8 characters to Unicode escape sequences).</li>
<li>JSON will have no memory of what the object's original class was (they are always restored as instances of stdClass).</li>
<li>You can't leverage <code>__sleep()</code> and <code>__wakeup()</code> with JSON</li>
<li>By default, only public properties are serialized with JSON. (in <code>PHP&gt;=5.4</code> you can implement JsonSerializable to change this behavior).</li>
<li>JSON is more portable</li>
</ul>
<p>And there's probably a few other differences I can't think of at the moment.</p>
<p>A simple speed test to compare the two</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>

<span class="nb">ini_set</span><span class="p">(</span><span class="s1">'display_errors'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span><span class="p">);</span>

<span class="c1">// Make a big, honkin test array</span>
<span class="c1">// You may need to adjust this depth to avoid memory limit errors</span>
<span class="nv">$testArray</span> <span class="o">=</span> <span class="nx">fillArray</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

<span class="c1">// Time json encoding</span>
<span class="nv">$start</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="nb">json_encode</span><span class="p">(</span><span class="nv">$testArray</span><span class="p">);</span>
<span class="nv">$jsonTime</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="o">-</span> <span class="nv">$start</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"JSON encoded in </span><span class="si">$jsonTime</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

<span class="c1">// Time serialization</span>
<span class="nv">$start</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="nb">serialize</span><span class="p">(</span><span class="nv">$testArray</span><span class="p">);</span>
<span class="nv">$serializeTime</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="o">-</span> <span class="nv">$start</span><span class="p">;</span>
<span class="k">echo</span> <span class="s2">"PHP serialized in </span><span class="si">$serializeTime</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

<span class="c1">// Compare them</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$jsonTime</span> <span class="o">&lt;</span> <span class="nv">$serializeTime</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"json_encode() was roughly %01.2f%% faster than serialize()</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="p">(</span><span class="nv">$serializeTime</span> <span class="o">/</span> <span class="nv">$jsonTime</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$serializeTime</span> <span class="o">&lt;</span> <span class="nv">$jsonTime</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"serialize() was roughly %01.2f%% faster than json_encode()</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="p">(</span><span class="nv">$jsonTime</span> <span class="o">/</span> <span class="nv">$serializeTime</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"Impossible!</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">fillArray</span><span class="p">(</span> <span class="nv">$depth</span><span class="p">,</span> <span class="nv">$max</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">static</span> <span class="nv">$seed</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$seed</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$seed</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">'e'</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">'g'</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$depth</span> <span class="o">&lt;</span> <span class="nv">$max</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$node</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$seed</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$node</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fillArray</span><span class="p">(</span><span class="nv">$depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">$max</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$node</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="s1">'empty'</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p><strong>JSON</strong> is simpler and faster than PHP's serialization format and should be
used <strong>unless</strong> :</p>
<ul>
<li>You're storing deeply nested arrays: <code>json_decode()</code>: "This function will return false if the JSON encoded data is deeper than 127 elements."</li>
<li>You're storing objects that need to be unserialized as the correct class</li>
<li>You're interacting with old PHP versions that don't support json_decode</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-use-wpf-bindings-with-relativesource/" class="u-url">How do I use WPF bindings with RelativeSource?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-use-wpf-bindings-with-relativesource/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T20:24:40+08:00" itemprop="datePublished" title="2023-02-17 20:24">2023-02-17 20:24</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I use <code>RelativeSource</code> with WPF bindings and what are the different
use-cases?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>If you want to bind to another property on the object:</p>
<div class="code"><pre class="code literal-block">{Binding Path=PathToProperty, RelativeSource={RelativeSource Self}}
</pre></div>

<p>If you want to get a property on an ancestor:</p>
<div class="code"><pre class="code literal-block">{Binding Path=PathToProperty,
    RelativeSource={RelativeSource AncestorType={x:Type typeOfAncestor}}}
</pre></div>

<p>If you want to get a property on the templated parent (so you can do 2 way
bindings in a ControlTemplate)</p>
<div class="code"><pre class="code literal-block">{Binding Path=PathToProperty, RelativeSource={RelativeSource TemplatedParent}}
</pre></div>

<p>or, shorter (this only works for OneWay bindings):</p>
<div class="code"><pre class="code literal-block">{TemplateBinding Path=PathToProperty}
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<div class="code"><pre class="code literal-block">Binding RelativeSource={
    RelativeSource Mode=FindAncestor, AncestorType={x:Type ItemType}
}
...
</pre></div>

<p>The default attribute of <code>RelativeSource</code> is the <code>Mode</code> property. A complete
set of valid values is given here (from MSDN):</p>
<ul>
<li>
<p><em>PreviousData</em> Allows you to bind the previous data item (not that control that contains the data item) in the list of data items being displayed.</p>
</li>
<li>
<p><em>TemplatedParent</em> Refers to the element to which the template (in which the data-bound element exists) is applied. This is similar to setting a TemplateBindingExtension and is only applicable if the Binding is within a template.</p>
</li>
<li>
<p><em>Self</em> Refers to the element on which you are setting the binding and allows you to bind one property of that element to another property on the same element.</p>
</li>
<li>
<p><em>FindAncestor</em> Refers to the ancestor in the parent chain of the data-bound element. You can use this to bind to an ancestor of a specific type or its subclasses. This is the mode you use if you want to specify AncestorType and/or AncestorLevel.</p>
</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-use-pickle-to-save-a-dict-or-any-other-python-object/" class="u-url">How can I use pickle to save a dict (or any other Python object)?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-use-pickle-to-save-a-dict-or-any-other-python-object/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T20:24:08+08:00" itemprop="datePublished" title="2023-02-17 20:24">2023-02-17 20:24</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have looked through the information that the Python docs give, but I'm still
a little confused. Could somebody post sample code that would write a new file
then use pickle to dump a dictionary into it?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Try this:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">pickle</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'hello'</span><span class="p">:</span> <span class="s1">'world'</span><span class="p">}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'filename.pickle'</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'filename.pickle'</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span>
</pre></div>

<p>There's nothing about the above solution that is specific to a <code>dict</code> object.
This same approach will will work for many Python objects, including instances
of arbitrary classes and arbitrarily complex nestings of data structures. For
example, replacing the second line with these lines:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">'hello'</span><span class="p">:</span> <span class="s1">'world'</span><span class="p">},</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">2.3333</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"x"</span><span class="p">,</span> 
     <span class="p">(</span><span class="s2">"y"</span><span class="p">,</span> <span class="p">[[[</span><span class="s2">"z"</span><span class="p">],</span> <span class="s2">"y"</span><span class="p">],</span> <span class="s2">"x"</span><span class="p">]),</span> <span class="p">{</span><span class="s1">'today'</span><span class="p">,</span> <span class="n">today</span><span class="p">}]</span>
</pre></div>

<p>will produce a result of <code>True</code> as well.</p>
<p>Some objects can't be pickled due to their very nature. For example, it
doesn't make sense to pickle a structure containing a handle to an open file.</p>
<p><br></p>
<h3>Suggest</h3>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">pickle</span>

<span class="n">your_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'foo'</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">}</span>

<span class="c1"># Store data (serialize)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'filename.pickle'</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">your_data</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

<span class="c1"># Load data (deserialize)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'filename.pickle'</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
    <span class="n">unserialized_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">your_data</span> <span class="o">==</span> <span class="n">unserialized_data</span><span class="p">)</span>
</pre></div>

<p>The advantage of <code>HIGHEST_PROTOCOL</code> is that files get smaller. This makes
unpickling sometimes much faster.</p>
<p><strong>Important notice</strong> : The maximum file size of pickle is about 2GB.</p>
<h3>Alternative way</h3>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">mpu</span>
<span class="n">your_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'foo'</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">}</span>
<span class="n">mpu</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'filename.pickle'</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">unserialized_data</span> <span class="o">=</span> <span class="n">mpu</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'filename.pickle'</span><span class="p">)</span>
</pre></div>

<h3>Alternative Formats</h3>
<ul>
<li>CSV: Super simple format (read &amp; write)</li>
<li>JSON: Nice for writing human-readable data; VERY commonly used (read &amp; write)</li>
<li>YAML: YAML is a superset of JSON, but easier to read (read &amp; write, comparison of JSON and YAML)</li>
<li>pickle: A Python serialization format (read &amp; write)</li>
<li>MessagePack (Python package): More compact representation (read &amp; write)</li>
<li>HDF5 (Python package): Nice for matrices (read &amp; write)</li>
<li>XML: exists too <em>sigh</em> (read &amp; write)</li>
</ul>
<p>For your application, the following might be important:</p>
<ul>
<li>Support by other programming languages</li>
<li>Reading / writing performance</li>
<li>Compactness (file size)</li>
</ul>
<p>See also: Comparison of data serialization formats</p>
<p>In case you are rather looking for a way to make configuration files, you
might want to read my short article Configuration files in Python</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-953.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-951.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
