<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2505) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2505.html">
<link rel="prev" href="index-2506.html" type="text/html">
<link rel="next" href="index-2504.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/rails-include-vs-joins/" class="u-url">Rails :include vs. :joins</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/rails-include-vs-joins/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T21:08:54+08:00" itemprop="datePublished" title="2023-03-04 21:08">2023-03-04 21:08</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>This is more of a "why do things work this way" question rather than a "I
don't know how to do this" question...</p>
<p>So the gospel on pulling associated records that you know you're going to use
is to use <code>:include</code> because you'll get a join and avoid a whole bunch of
extra queries:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Post</span>.<span class="nv">all</span><span class="ss">(</span>:<span class="k">include</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>:<span class="nv">comments</span><span class="ss">)</span>
</pre></div>

<p>However when you look at the logs, there's no join happening:</p>
<div class="code"><pre class="code literal-block">Post Load (3.7ms)   SELECT * FROM "posts"
Comment Load (0.2ms)   SELECT "comments.*" FROM "comments" 
                       WHERE ("comments".post_id IN (1,2,3,4)) 
                       ORDER BY created_at asc)
</pre></div>

<p>It <em>is</em> taking a shortcut because it pulls all of the comments at once, but
it's still not a join (which is what all the documentation seems to say). The
only way I can get a join is to use <code>:joins</code> instead of <code>:include</code>:</p>
<div class="code"><pre class="code literal-block">Post.all(:joins =&gt; :comments)
</pre></div>

<p>And the logs show:</p>
<div class="code"><pre class="code literal-block">Post Load (6.0ms)  SELECT "posts".* FROM "posts" 
                   INNER JOIN "comments" ON "posts".id = "comments".post_id
</pre></div>

<p>Am I missing something? I have an app with half a dozen associations and on
one screen I display data from all of them. Seems like it would be better to
have one join-ed query instead of 6 individuals. I know that performance-wise
it's not always better to do a join rather than individual queries (in fact if
you're going by time spent, it looks like the two individual queries above are
faster than the join), but after all the docs I've been reading I'm surprised
to see <code>:include</code> not working as advertised.</p>
<p>Maybe Rails <em>is</em> cognizant of the performance issue and doesn't join except in
certain cases?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>It appears that the <code>:include</code> functionality was changed with Rails 2.1. Rails
used to do the join in all cases, but for performance reasons it was changed
to use multiple queries in some circumstances. This blog post by Fabio Akita
has some good information on the change (see the section entitled "Optimized
Eager Loading").</p>
<p><br></p>
<h3>Suggest</h3>
<p><code>.joins</code> will just joins the tables and brings selected fields in return. if
you call associations on joins query result, it will fire database queries
again</p>
<p><code>:includes</code> will eager load the included associations and add them in memory.
<code>:includes</code> loads all the included tables attributes. If you call associations
on include query result, it will not fire any queries</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/setting-the-correct-encoding-when-piping-stdout-in-python/" class="u-url">Setting the correct encoding when piping stdout in Python</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/setting-the-correct-encoding-when-piping-stdout-in-python/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T21:07:33+08:00" itemprop="datePublished" title="2023-03-04 21:07">2023-03-04 21:07</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>When piping the output of a Python program, the Python interpreter gets
confused about encoding and sets it to None. This means a program like this:</p>
<div class="code"><pre class="code literal-block"># -*- coding: utf-8 -*-
print u"åäö"
</pre></div>

<p>will work fine when run normally, but fail with:</p>
<blockquote>
<p>UnicodeEncodeError: 'ascii' codec can't encode character u'\xa0' in position
0: ordinal not in range(128)</p>
</blockquote>
<p>when used in a pipe sequence.</p>
<p>What is the best way to make this work when piping? Can I just tell it to use
whatever encoding the shell/filesystem/whatever is using?</p>
<p>The suggestions I have seen thus far is to modify your site.py directly, or
hardcoding the defaultencoding using this hack:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
<span class="nb">print</span> <span class="sa">u</span><span class="s2">"åäö"</span>
</pre></div>

<p>Is there a better way to make piping work?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Your code works when run in an script because Python encodes the output to
whatever encoding your terminal application is using. If you are piping you
must encode it yourself.</p>
<p>A rule of thumb is: Always use Unicode internally. Decode what you receive,
and encode what you send.</p>
<div class="code"><pre class="code literal-block"># -*- coding: utf-8 -*-
print u"åäö".encode('utf-8')
</pre></div>

<p>Another didactic example is a Python program to convert between ISO-8859-1 and
UTF-8, making everything uppercase in between.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">sys</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="c1"># Decode what you receive:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'iso8859-1'</span><span class="p">)</span>

    <span class="c1"># Work with Unicode internally:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="c1"># Encode what you send:</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>

<p>Setting the system default encoding is a bad idea, because some modules and
libraries you use can rely on the fact it is ASCII. Don't do it.</p>
<p><br></p>
<h3>Suggest</h3>
<p>First, regarding this solution:</p>
<div class="code"><pre class="code literal-block"># -*- coding: utf-8 -*-
print u"åäö".encode('utf-8')
</pre></div>

<p>It's not practical to explicitly print with a given encoding every time. That
would be repetitive and error-prone.</p>
<p>A better solution is to change <strong><code>sys.stdout</code></strong> at the start of your program,
to encode with a selected encoding. Here is one solution I found on Python:
How is sys.stdout.encoding chosen?, in particular a comment by "toka":</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/share-data-between-angularjs-controllers/" class="u-url">Share data between AngularJS controllers</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/share-data-between-angularjs-controllers/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T21:06:12+08:00" itemprop="datePublished" title="2023-03-04 21:06">2023-03-04 21:06</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to share data across controllers. Use-case is a multi-step form,
data entered in one input is later used in multiple display locations outside
the original controller. Code below and in jsfiddle here.</p>
<p><strong>HTML</strong></p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">ng-controller=</span><span class="s">"FirstCtrl"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"text"</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"FirstName"</span><span class="nt">&gt;</span><span class="cm">&lt;!-- Input entered here --&gt;</span>
<span class="w">    </span><span class="nt">&lt;br&gt;</span>Input<span class="w"> </span>is<span class="w"> </span>:<span class="w"> </span><span class="nt">&lt;strong&gt;</span><span class="cp">{{</span><span class="nv">FirstName</span><span class="cp">}}</span><span class="nt">&lt;/strong&gt;</span><span class="cm">&lt;!-- Successfully updates here --&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;hr&gt;</span>

<span class="nt">&lt;div</span><span class="w"> </span><span class="na">ng-controller=</span><span class="s">"SecondCtrl"</span><span class="nt">&gt;</span>
<span class="w">    </span>Input<span class="w"> </span>should<span class="w"> </span>also<span class="w"> </span>be<span class="w"> </span>here:<span class="w"> </span><span class="cp">{{</span><span class="nv">FirstName</span><span class="cp">}}</span><span class="cm">&lt;!-- How do I automatically updated it here? --&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p><strong>JS</strong></p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">declare</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">dependencies</span>
<span class="k">var</span><span class="w"> </span><span class="n">myApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">angular</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span><span class="w"> </span><span class="p">[]);</span>

<span class="o">//</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">share</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">controllers</span>
<span class="n">myApp</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s1">'Data'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">doesn</span><span class="s1">'t work, but what will?</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">FirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FirstName</span><span class="p">;</span>
<span class="p">});</span>

<span class="o">//</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Controller</span>
<span class="n">myApp</span><span class="o">.</span><span class="n">controller</span><span class="p">(</span><span class="s1">'FirstCtrl'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="w"> </span><span class="o">$</span><span class="n">scope</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="p">){</span>

<span class="p">});</span>

<span class="o">//</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">Controller</span>
<span class="n">myApp</span><span class="o">.</span><span class="n">controller</span><span class="p">(</span><span class="s1">'SecondCtrl'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="w"> </span><span class="o">$</span><span class="n">scope</span><span class="p">,</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="p">){</span>
<span class="w">    </span><span class="o">$</span><span class="n">scope</span><span class="o">.</span><span class="n">FirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="o">.</span><span class="n">FirstName</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>Any help is greatly appreciated.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>A simple solution is to have your factory return an object and let your
controllers work with a reference to the same object:</p>
<p>JS:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">declare</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">dependencies</span>
<span class="k">var</span><span class="w"> </span><span class="n">myApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">angular</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span><span class="w"> </span><span class="p">[]);</span>

<span class="o">//</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">share</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Fact</span>
<span class="n">myApp</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s1">'Fact'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Field</span><span class="p">:</span><span class="w"> </span><span class="s1">''</span><span class="w"> </span><span class="p">};</span>
<span class="p">});</span>

<span class="o">//</span><span class="w"> </span><span class="n">Two</span><span class="w"> </span><span class="n">controllers</span><span class="w"> </span><span class="n">sharing</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">it</span>
<span class="n">myApp</span><span class="o">.</span><span class="n">controller</span><span class="p">(</span><span class="s1">'FirstCtrl'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="w"> </span><span class="o">$</span><span class="n">scope</span><span class="p">,</span><span class="w"> </span><span class="n">Fact</span><span class="w"> </span><span class="p">){</span>
<span class="w">  </span><span class="o">$</span><span class="n">scope</span><span class="o">.</span><span class="n">Alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fact</span><span class="p">;</span>
<span class="p">});</span>

<span class="n">myApp</span><span class="o">.</span><span class="n">controller</span><span class="p">(</span><span class="s1">'SecondCtrl'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="w"> </span><span class="o">$</span><span class="n">scope</span><span class="p">,</span><span class="w"> </span><span class="n">Fact</span><span class="w"> </span><span class="p">){</span>
<span class="w">  </span><span class="o">$</span><span class="n">scope</span><span class="o">.</span><span class="n">Beta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fact</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>HTML:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">ng-controller=</span><span class="s">"FirstCtrl"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"text"</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"Alpha.Field"</span><span class="nt">&gt;</span>
<span class="w">    </span>First<span class="w"> </span><span class="cp">{{</span><span class="nv">Alpha.Field</span><span class="cp">}}</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span><span class="w"> </span><span class="na">ng-controller=</span><span class="s">"SecondCtrl"</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"text"</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"Beta.Field"</span><span class="nt">&gt;</span>
<span class="w">    </span>Second<span class="w"> </span><span class="cp">{{</span><span class="nv">Beta.Field</span><span class="cp">}}</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p><strong>Demo:</strong> http://jsfiddle.net/HEdJF/</p>
<p>When applications get larger, more complex and harder to test you might not
want to expose the entire object from the factory this way, but instead give
limited access for example via getters and setters:</p>
<div class="code"><pre class="code literal-block"><span class="n">myApp</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s1">'Data'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">FirstName</span><span class="p">:</span><span class="w"> </span><span class="s1">''</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">getFirstName</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">FirstName</span><span class="p">;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">setFirstName</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">firstName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">data</span><span class="o">.</span><span class="n">FirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">firstName</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">});</span>
</pre></div>

<p>With this approach it is up to the consuming controllers to update the factory
with new values, and to watch for changes to get them:</p>
<div class="code"><pre class="code literal-block"><span class="nv">myApp</span>.<span class="nv">controller</span><span class="ss">(</span><span class="s1">'FirstCtrl'</span>,<span class="w"> </span><span class="nv">function</span><span class="w"> </span><span class="ss">(</span>$<span class="nv">scope</span>,<span class="w"> </span><span class="nv">Data</span><span class="ss">)</span><span class="w"> </span>{

<span class="w">    </span>$<span class="nv">scope</span>.<span class="nv">firstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="c1">;</span>

<span class="w">    </span>$<span class="nv">scope</span>.$<span class="nv">watch</span><span class="ss">(</span><span class="s1">'firstName'</span>,<span class="w"> </span><span class="nv">function</span><span class="w"> </span><span class="ss">(</span><span class="nv">newValue</span>,<span class="w"> </span><span class="nv">oldValue</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">newValue</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nv">oldValue</span><span class="ss">)</span><span class="w"> </span><span class="nv">Data</span>.<span class="nv">setFirstName</span><span class="ss">(</span><span class="nv">newValue</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}<span class="ss">)</span><span class="c1">;</span>
}<span class="ss">)</span><span class="c1">;</span>

<span class="nv">myApp</span>.<span class="nv">controller</span><span class="ss">(</span><span class="s1">'SecondCtrl'</span>,<span class="w"> </span><span class="nv">function</span><span class="w"> </span><span class="ss">(</span>$<span class="nv">scope</span>,<span class="w"> </span><span class="nv">Data</span><span class="ss">)</span><span class="w"> </span>{

<span class="w">    </span>$<span class="nv">scope</span>.$<span class="nv">watch</span><span class="ss">(</span><span class="nv">function</span><span class="w"> </span><span class="ss">()</span><span class="w"> </span>{<span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">Data</span>.<span class="nv">getFirstName</span><span class="ss">()</span><span class="c1">; }, function (newValue, oldValue) {</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">newValue</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nv">oldValue</span><span class="ss">)</span><span class="w"> </span>$<span class="nv">scope</span>.<span class="nv">firstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">newValue</span><span class="c1">;</span>
<span class="w">    </span>}<span class="ss">)</span><span class="c1">;</span>
}<span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>HTML:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">ng-controller=</span><span class="s">"FirstCtrl"</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"text"</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"firstName"</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;br&gt;</span>Input<span class="w"> </span>is<span class="w"> </span>:<span class="w"> </span><span class="nt">&lt;strong&gt;</span><span class="cp">{{</span><span class="nv">firstName</span><span class="cp">}}</span><span class="nt">&lt;/strong&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;hr&gt;</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="na">ng-controller=</span><span class="s">"SecondCtrl"</span><span class="nt">&gt;</span>
<span class="w">  </span>Input<span class="w"> </span>should<span class="w"> </span>also<span class="w"> </span>be<span class="w"> </span>here:<span class="w"> </span><span class="cp">{{</span><span class="nv">firstName</span><span class="cp">}}</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p><strong>Demo:</strong> http://jsfiddle.net/27mk1n1o/</p>
<p><br></p>
<h3>Suggest</h3>
<p>I prefer not to use <code>$watch</code> for this. Instead of assigning the entire service
to a controller's scope you can assign just the data.</p>
<p>JS:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">myApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">angular</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span><span class="w"> </span><span class="p">[]);</span>

<span class="n">myApp</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s1">'MyService'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">firstName</span><span class="p">:</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span>
<span class="w">      </span><span class="n">lastName</span><span class="p">:</span><span class="w"> </span><span class="s1">''</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Other</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">go</span><span class="w"> </span><span class="n">here</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">});</span>

<span class="n">myApp</span><span class="o">.</span><span class="n">controller</span><span class="p">(</span><span class="s1">'FirstCtrl'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="o">$</span><span class="n">scope</span><span class="p">,</span><span class="w"> </span><span class="n">MyService</span><span class="p">){</span>
<span class="w">  </span><span class="o">$</span><span class="n">scope</span><span class="o">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyService</span><span class="o">.</span><span class="n">data</span><span class="p">;</span>
<span class="p">});</span>

<span class="n">myApp</span><span class="o">.</span><span class="n">controller</span><span class="p">(</span><span class="s1">'SecondCtrl'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="o">$</span><span class="n">scope</span><span class="p">,</span><span class="w"> </span><span class="n">MyService</span><span class="p">){</span>
<span class="w">   </span><span class="o">$</span><span class="n">scope</span><span class="o">.</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyService</span><span class="o">.</span><span class="n">data</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>HTML:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">ng-controller=</span><span class="s">"FirstCtrl"</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"text"</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"data.firstName"</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;br&gt;</span>Input<span class="w"> </span>is<span class="w"> </span>:<span class="w"> </span><span class="nt">&lt;strong&gt;</span><span class="cp">{{</span><span class="nv">data.firstName</span><span class="cp">}}</span><span class="nt">&lt;/strong&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;hr&gt;</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="na">ng-controller=</span><span class="s">"SecondCtrl"</span><span class="nt">&gt;</span>
<span class="w">  </span>Input<span class="w"> </span>should<span class="w"> </span>also<span class="w"> </span>be<span class="w"> </span>here:<span class="w"> </span><span class="cp">{{</span><span class="nv">data.firstName</span><span class="cp">}}</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>Alternatively you can update the service data with a direct method.</p>
<p>JS:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// A new factory with an update method</span>
<span class="n">myApp</span><span class="p">.</span><span class="n">factory</span><span class="p">(</span><span class="s">'MyService'</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(){</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">firstName</span><span class="p">:</span><span class="w"> </span><span class="s">''</span><span class="p">,</span>
<span class="w">      </span><span class="n">lastName</span><span class="p">:</span><span class="w"> </span><span class="s">''</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="n">update</span><span class="p">:</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Improve this method as needed</span>
<span class="w">      </span><span class="n">this</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">firstName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">first</span><span class="p">;</span>
<span class="w">      </span><span class="n">this</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">lastName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">last</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
<span class="p">});</span>

<span class="c1">// Your controller can use the service's update method</span>
<span class="n">myApp</span><span class="p">.</span><span class="n">controller</span><span class="p">(</span><span class="s">'SecondCtrl'</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="no">$</span><span class="n">scope</span><span class="p">,</span><span class="w"> </span><span class="n">MyService</span><span class="p">){</span>
<span class="w">   </span><span class="no">$</span><span class="n">scope</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">MyService</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>

<span class="w">   </span><span class="no">$</span><span class="n">scope</span><span class="p">.</span><span class="n">updateData</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">MyService</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2506.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2504.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
