<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2020) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2020.html">
<link rel="prev" href="index-2021.html" type="text/html">
<link rel="next" href="index-2019.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/using-openssl-what-does-unable-to-write-random-state-mean/" class="u-url">Using OpenSSL what does "unable to write 'random state'" mean?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/using-openssl-what-does-unable-to-write-random-state-mean/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T14:58:59+08:00" itemprop="datePublished" title="2023-03-03 14:58">2023-03-03 14:58</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm generating a self-signed SSL certificate to protect my server's admin
section, and I keep getting this message from OpenSSL:</p>
<blockquote>
<p>unable to write 'random state'</p>
</blockquote>
<p>What does this mean?</p>
<p>This is on an Ubuntu server. I have upgraded libssl to fix the recent security
vulnerability.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>In practice, the most common reason for this happening seems to be that the
.rnd file in your home directory is owned by root rather than your account.
The quick fix:</p>
<div class="code"><pre class="code literal-block">sudo rm ~/.rnd
</pre></div>

<p>For more information, here's the entry from the OpenSSL FAQ:</p>
<blockquote>
<p>Sometimes the openssl command line utility does not abort with a "PRNG not
seeded" error message, but complains that it is "unable to write 'random
state'". This message refers to the default seeding file (see previous
answer). A possible reason is that no default filename is known because
neither RANDFILE nor HOME is set. (Versions up to 0.9.6 used file ".rnd" in
the current directory in this case, but this has changed with 0.9.6a.)</p>
</blockquote>
<p>So I would check RANDFILE, HOME, and permissions to write to those places in
the filesystem.</p>
<p>If everything seems to be in order, you could try running with strace and see
what exactly is going on.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I know this question is on Linux, but on windows I had the same issue. Turns
out you have to start the command prompt in "Run As Administrator" mode for it
to work. Otherwise you get the same: unable to write 'random state' error.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/fragment-myfragment-not-attached-to-activity/" class="u-url">Fragment MyFragment not attached to Activity</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/fragment-myfragment-not-attached-to-activity/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T14:58:34+08:00" itemprop="datePublished" title="2023-03-03 14:58">2023-03-03 14:58</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've created a small test app which represents my problem. I'm using
ActionBarSherlock to implement tabs with (Sherlock)Fragments.</p>
<p>My code: <code>TestActivity.java</code></p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">TestActivity</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">SherlockFragmentActivity</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">ActionBar</span><span class="w"> </span><span class="n">actionBar</span><span class="p">;</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">        </span><span class="n">setupTabs</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">setupTabs</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">actionBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSupportActionBar</span><span class="p">();</span>
<span class="w">        </span><span class="n">actionBar</span><span class="o">.</span><span class="n">setNavigationMode</span><span class="p">(</span><span class="n">ActionBar</span><span class="o">.</span><span class="n">NAVIGATION_MODE_TABS</span><span class="p">);</span>

<span class="w">        </span><span class="n">addTab1</span><span class="p">();</span>
<span class="w">        </span><span class="n">addTab2</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">addTab1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Tab</span><span class="w"> </span><span class="n">tab1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actionBar</span><span class="o">.</span><span class="n">newTab</span><span class="p">();</span>
<span class="w">        </span><span class="n">tab1</span><span class="o">.</span><span class="n">setTag</span><span class="p">(</span><span class="s2">"1"</span><span class="p">);</span>
<span class="w">        </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">tabText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"1"</span><span class="p">;</span>
<span class="w">        </span><span class="n">tab1</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tabText</span><span class="p">);</span>
<span class="w">        </span><span class="n">tab1</span><span class="o">.</span><span class="n">setTabListener</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">TabListener</span><span class="o">&lt;</span><span class="n">MyFragment</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TestActivity</span><span class="o">.</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="n">MyFragment</span><span class="o">.</span><span class="k">class</span><span class="p">));</span>

<span class="w">        </span><span class="n">actionBar</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">tab1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">addTab2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Tab</span><span class="w"> </span><span class="n">tab1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actionBar</span><span class="o">.</span><span class="n">newTab</span><span class="p">();</span>
<span class="w">        </span><span class="n">tab1</span><span class="o">.</span><span class="n">setTag</span><span class="p">(</span><span class="s2">"2"</span><span class="p">);</span>
<span class="w">        </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">tabText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2"</span><span class="p">;</span>
<span class="w">        </span><span class="n">tab1</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tabText</span><span class="p">);</span>
<span class="w">        </span><span class="n">tab1</span><span class="o">.</span><span class="n">setTabListener</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">TabListener</span><span class="o">&lt;</span><span class="n">MyFragment</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TestActivity</span><span class="o">.</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w"> </span><span class="n">MyFragment</span><span class="o">.</span><span class="k">class</span><span class="p">));</span>

<span class="w">        </span><span class="n">actionBar</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">tab1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><code>TabListener.java</code></p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">TabListener</span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">SherlockFragment</span><span class="o">&gt;</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="n">com</span><span class="o">.</span><span class="n">actionbarsherlock</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ActionBar</span><span class="o">.</span><span class="n">TabListener</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">SherlockFragmentActivity</span><span class="w"> </span><span class="n">mActivity</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">mTag</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mClass</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">TabListener</span><span class="p">(</span><span class="n">SherlockFragmentActivity</span><span class="w"> </span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">tag</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">clz</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mActivity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activity</span><span class="p">;</span>
<span class="w">        </span><span class="n">mTag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tag</span><span class="p">;</span>
<span class="w">        </span><span class="n">mClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clz</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">/*</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ActionBar</span><span class="o">.</span><span class="n">TabListener</span><span class="w"> </span><span class="n">callbacks</span><span class="w"> </span><span class="o">*/</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onTabSelected</span><span class="p">(</span><span class="n">Tab</span><span class="w"> </span><span class="n">tab</span><span class="p">,</span><span class="w"> </span><span class="n">FragmentTransaction</span><span class="w"> </span><span class="n">ft</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SherlockFragment</span><span class="w"> </span><span class="n">preInitializedFragment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SherlockFragment</span><span class="p">)</span><span class="w"> </span><span class="n">mActivity</span><span class="o">.</span><span class="n">getSupportFragmentManager</span><span class="p">()</span><span class="o">.</span><span class="n">findFragmentByTag</span><span class="p">(</span><span class="n">mTag</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fragment</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">initialized</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">preInitializedFragment</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="ow">not</span><span class="p">,</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">activity</span>
<span class="w">            </span><span class="n">SherlockFragment</span><span class="w"> </span><span class="n">mFragment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SherlockFragment</span><span class="p">)</span><span class="w"> </span><span class="n">SherlockFragment</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span><span class="n">mActivity</span><span class="p">,</span><span class="w"> </span><span class="n">mClass</span><span class="o">.</span><span class="n">getName</span><span class="p">());</span>
<span class="w">            </span><span class="n">ft</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">android</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">mFragment</span><span class="p">,</span><span class="w"> </span><span class="n">mTag</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ft</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">preInitializedFragment</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onTabUnselected</span><span class="p">(</span><span class="n">Tab</span><span class="w"> </span><span class="n">tab</span><span class="p">,</span><span class="w"> </span><span class="n">FragmentTransaction</span><span class="w"> </span><span class="n">ft</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SherlockFragment</span><span class="w"> </span><span class="n">preInitializedFragment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SherlockFragment</span><span class="p">)</span><span class="w"> </span><span class="n">mActivity</span><span class="o">.</span><span class="n">getSupportFragmentManager</span><span class="p">()</span><span class="o">.</span><span class="n">findFragmentByTag</span><span class="p">(</span><span class="n">mTag</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">preInitializedFragment</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">Detach</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fragment</span><span class="p">,</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">attached</span>
<span class="w">            </span><span class="n">ft</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">preInitializedFragment</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onTabReselected</span><span class="p">(</span><span class="n">Tab</span><span class="w"> </span><span class="n">tab</span><span class="p">,</span><span class="w"> </span><span class="n">FragmentTransaction</span><span class="w"> </span><span class="n">ft</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">selected</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">selected</span><span class="w"> </span><span class="n">tab</span><span class="o">.</span><span class="w"> </span><span class="n">Usually</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">nothing</span><span class="o">.</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><code>MyFragment.java</code></p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">MyFragment</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">SherlockFragment</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>

<span class="w">        </span><span class="n">new</span><span class="w"> </span><span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="p">,</span><span class="w"> </span><span class="n">Void</span><span class="p">,</span><span class="w"> </span><span class="n">Void</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="err">@</span><span class="n">Override</span>
<span class="w">            </span><span class="n">protected</span><span class="w"> </span><span class="n">Void</span><span class="w"> </span><span class="n">doInBackground</span><span class="p">(</span><span class="n">Void</span><span class="o">...</span><span class="w"> </span><span class="n">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="err">@</span><span class="n">Override</span>
<span class="w">            </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onPostExecute</span><span class="p">(</span><span class="n">Void</span><span class="w"> </span><span class="n">result</span><span class="p">){</span>
<span class="w">                </span><span class="n">getResources</span><span class="p">()</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">app_name</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span><span class="o">.</span><span class="n">execute</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>I've added the <code>Thread.sleep</code> part to simulate downloading data. The code in
the <code>onPostExecute</code> is to simulate use of the <code>Fragment</code>.</p>
<p>When I rotate the screen very fast between landscape and portrait, I get an
Exception at the <code>onPostExecute</code> code:</p>
<blockquote>
<p>java.lang.IllegalStateException: Fragment MyFragment{410f6060} not attached
to Activity</p>
</blockquote>
<p>I think it's because a new <code>MyFragment</code> has been created in the meantime, and
was attached to the Activity before the <code>AsyncTask</code> finished. The code in
<code>onPostExecute</code> calls upon a unattached <code>MyFragment</code>.</p>
<p>But how can I fix this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I've found the very simple answer: <code>isAdded()</code>:</p>
<blockquote>
<p>Return <code>true</code> if the fragment is currently added to its activity.</p>
</blockquote>
<div class="code"><pre class="code literal-block"><span class="nv">@Override</span>
<span class="n">protected</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onPostExecute</span><span class="p">(</span><span class="n">Void</span><span class="w"> </span><span class="k">result</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">isAdded</span><span class="p">())</span><span class="err">{</span>
<span class="w">        </span><span class="n">getResources</span><span class="p">().</span><span class="n">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="nf">app_name</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>To avoid <code>onPostExecute</code> from being called when the <code>Fragment</code> is not attached
to the <code>Activity</code> is to cancel the <code>AsyncTask</code> when pausing or stopping the
<code>Fragment</code>. Then <code>isAdded()</code> would not be necessary anymore. However, it is
advisable to keep this check in place.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The problem is that you are trying to access resources (in this case, strings)
using getResources().getString(), which will try to get the resources from the
Activity. See this source code of the Fragment class:</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span>/**
<span class="w">  </span>*<span class="w"> </span>Return<span class="w"> </span><span class="nt">&lt;code&gt;</span>getActivity().getResources()<span class="nt">&lt;/code&gt;</span>.
<span class="w">  </span>*/
<span class="w"> </span>final<span class="w"> </span>public<span class="w"> </span>Resources<span class="w"> </span>getResources()<span class="w"> </span>{
<span class="w">     </span>if<span class="w"> </span>(mHost<span class="w"> </span>==<span class="w"> </span>null)<span class="w"> </span>{
<span class="w">         </span>throw<span class="w"> </span>new<span class="w"> </span>IllegalStateException("Fragment<span class="w"> </span>"<span class="w"> </span>+<span class="w"> </span>this<span class="w"> </span>+<span class="w"> </span>"<span class="w"> </span>not<span class="w"> </span>attached<span class="w"> </span>to<span class="w"> </span>Activity");
<span class="w">     </span>}
<span class="w">     </span>return<span class="w"> </span>mHost.getContext().getResources();
<span class="w"> </span>}
</pre></div>

<p><code>mHost</code> is the object that holds your Activity.</p>
<p>Because the Activity might not be attached, your getResources() call will
throw an Exception.</p>
<p>The accepted solution IMHO is not the way to go as you are just hiding the
problem. The correct way is just to get the resources from somewhere else that
is always guaranteed to exist, like the application context:</p>
<div class="code"><pre class="code literal-block">youApplicationObject.getResources().getString(...)
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-inspect-the-file-system-of-a-failed-docker-build/" class="u-url">How can I inspect the file system of a failed `docker build`?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-inspect-the-file-system-of-a-failed-docker-build/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T14:58:09+08:00" itemprop="datePublished" title="2023-03-03 14:58">2023-03-03 14:58</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to build a new Docker image for our development process, using
<code>cpanm</code> to install a bunch of Perl modules as a base image for various
projects.</p>
<p>While developing the Dockerfile, <code>cpanm</code> returns a failure code because some
of the modules did not install cleanly.</p>
<p>I'm fairly sure I need to get <code>apt</code> to install some more things.</p>
<p>Where can I find the <code>/.cpanm/work</code> directory quoted in the output, in order
to inspect the logs? In the general case, how can I inspect the file system of
a failed <code>docker build</code> command?</p>
<p>After running a <code>find</code> I discovered</p>
<div class="code"><pre class="code literal-block"><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">aufs</span><span class="o">/</span><span class="n">diff</span><span class="o">/</span><span class="mi">3</span><span class="n">afa404e</span><span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/.</span><span class="n">cpanm</span>
</pre></div>

<p>Is this reliable, or am I better off building a "bare" container and running
stuff manually until I have all the things I need?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Everytime docker successfully executes a <code>RUN</code> command from a Dockerfile, a
new layer in the image filesystem is committed. Conveniently you can use those
layers ids as images to start a new container.</p>
<p>Take the following Dockerfile:</p>
<div class="code"><pre class="code literal-block">FROM busybox
RUN echo 'foo' &gt; /tmp/foo.txt
RUN echo 'bar' &gt;&gt; /tmp/foo.txt
</pre></div>

<p>and build it:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>so-26220957<span class="w"> </span>.
Sending<span class="w"> </span>build<span class="w"> </span>context<span class="w"> </span>to<span class="w"> </span>Docker<span class="w"> </span>daemon<span class="w"> </span><span class="m">47</span>.62<span class="w"> </span>kB
Step<span class="w"> </span><span class="m">1</span>/3<span class="w"> </span>:<span class="w"> </span>FROM<span class="w"> </span>busybox
<span class="w"> </span>---&gt;<span class="w"> </span>00f017a8c2a6
Step<span class="w"> </span><span class="m">2</span>/3<span class="w"> </span>:<span class="w"> </span>RUN<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">'foo'</span><span class="w"> </span>&gt;<span class="w"> </span>/tmp/foo.txt
<span class="w"> </span>---&gt;<span class="w"> </span>Running<span class="w"> </span><span class="k">in</span><span class="w"> </span>4dbd01ebf27f
<span class="w"> </span>---&gt;<span class="w"> </span>044e1532c690
Removing<span class="w"> </span>intermediate<span class="w"> </span>container<span class="w"> </span>4dbd01ebf27f
Step<span class="w"> </span><span class="m">3</span>/3<span class="w"> </span>:<span class="w"> </span>RUN<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">'bar'</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/tmp/foo.txt
<span class="w"> </span>---&gt;<span class="w"> </span>Running<span class="w"> </span><span class="k">in</span><span class="w"> </span>74d81cb9d2b1
<span class="w"> </span>---&gt;<span class="w"> </span>5bd8172529c1
Removing<span class="w"> </span>intermediate<span class="w"> </span>container<span class="w"> </span>74d81cb9d2b1
Successfully<span class="w"> </span>built<span class="w"> </span>5bd8172529c1
</pre></div>

<p>You can now start a new container from <code>00f017a8c2a6</code>, <code>044e1532c690</code> and
<code>5bd8172529c1</code>:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>00f017a8c2a6<span class="w"> </span>cat<span class="w"> </span>/tmp/foo.txt
cat:<span class="w"> </span>/tmp/foo.txt:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory

$<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>044e1532c690<span class="w"> </span>cat<span class="w"> </span>/tmp/foo.txt
foo

$<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>5bd8172529c1<span class="w"> </span>cat<span class="w"> </span>/tmp/foo.txt
foo
bar
</pre></div>

<p>of course you might want to start a shell to explore the filesystem and try
out commands:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span>044e1532c690<span class="w"> </span>sh<span class="w">      </span>
/<span class="w"> </span><span class="c1"># ls -l /tmp</span>
total<span class="w"> </span><span class="m">4</span>
-rw-r--r--<span class="w">    </span><span class="m">1</span><span class="w"> </span>root<span class="w">     </span>root<span class="w">             </span><span class="m">4</span><span class="w"> </span>Mar<span class="w">  </span><span class="m">9</span><span class="w"> </span><span class="m">19</span>:09<span class="w"> </span>foo.txt
/<span class="w"> </span><span class="c1"># cat /tmp/foo.txt </span>
foo
</pre></div>

<hr>
<p>When one of the Dockerfile command fails, what you need to do is to look for
the <strong>id of the preceding layer</strong> and run a shell in a container created from
that id:</p>
<div class="code"><pre class="code literal-block">docker run --rm -it &lt;id_last_working_layer&gt; bash -il
</pre></div>

<p>Once in the container:</p>
<ul>
<li>try the command that failed, and reproduce the issue</li>
<li>then fix the command and test it</li>
<li>finally update your Dockerfile with the fixed command</li>
</ul>
<hr>
<p>If you really need to experiment in the actual layer that failed instead of
working from the last working layer, see Drew's answer.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The top answer works in the case that you want to examine the state
immediately prior to the failed command.</p>
<p>However, the question asks how to examine the state of the failed container
itself. In my situation, the failed command is a build that takes several
hours, so rewinding prior to the failed command and running it again takes a
long time and is not very helpful.</p>
<p>The solution here is to find the container that failed:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>docker<span class="w"> </span>ps<span class="w"> </span>-a
CONTAINER<span class="w"> </span>ID<span class="w">        </span>IMAGE<span class="w">               </span>COMMAND<span class="w">                  </span>CREATED<span class="w">             </span>STATUS<span class="w">                          </span>PORTS<span class="w">               </span>NAMES
6934ada98de6<span class="w">        </span>42e0228751b3<span class="w">        </span><span class="s2">"/bin/sh -c './utils/"</span><span class="w">   </span><span class="m">24</span><span class="w"> </span>minutes<span class="w"> </span>ago<span class="w">      </span>Exited<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>About<span class="w"> </span>a<span class="w"> </span>minute<span class="w"> </span>ago<span class="w">                       </span>sleepy_bell
</pre></div>

<p>Commit it to an image:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>docker<span class="w"> </span>commit<span class="w"> </span>6934ada98de6
sha256:7015687976a478e0e94b60fa496d319cdf4ec847bcd612aecf869a72336e6b83
</pre></div>

<p>And then run the image [if necessary, running bash]:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>7015687976a4<span class="w"> </span><span class="o">[</span>bash<span class="w"> </span>-il<span class="o">]</span>
</pre></div>

<p>Now you are actually looking at the state of the build at the time that it
failed, instead of at the time before running the command that caused the
failure.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2021.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2019.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
