<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2579) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2579.html">
<link rel="prev" href="index-2580.html" type="text/html">
<link rel="next" href="index-2578.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-s-the-best-way-to-build-a-string-of-delimited-items-in-java/" class="u-url">What's the best way to build a string of delimited items in Java?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-s-the-best-way-to-build-a-string-of-delimited-items-in-java/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T02:27:59+08:00" itemprop="datePublished" title="2023-03-05 02:27">2023-03-05 02:27</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>While working in a Java app, I recently needed to assemble a comma-delimited
list of values to pass to another web service without knowing how many
elements there would be in advance. The best I could come up with off the top
of my head was something like this:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">appendWithDelimiter</span><span class="ss">(</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">original</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">addition</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">delimiter</span><span class="w"> </span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="w"> </span><span class="nv">original</span>.<span class="nv">equals</span><span class="ss">(</span><span class="w"> </span><span class="s2">""</span><span class="w"> </span><span class="ss">)</span><span class="w"> </span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">addition</span><span class="c1">;</span>
<span class="w">    </span>}<span class="w"> </span><span class="k">else</span><span class="w"> </span>{
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">original</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">delimiter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">addition</span><span class="c1">;</span>
<span class="w">    </span>}
}

<span class="nv">String</span><span class="w"> </span><span class="nv">parameterString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="c1">;</span>
<span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="w"> </span><span class="nv">condition</span><span class="w"> </span><span class="ss">)</span><span class="w"> </span><span class="nv">parameterString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">appendWithDelimiter</span><span class="ss">(</span><span class="w"> </span><span class="nv">parameterString</span>,<span class="w"> </span><span class="s2">"elementName"</span>,<span class="w"> </span><span class="s2">","</span><span class="w"> </span><span class="ss">)</span><span class="c1">;</span>
<span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="w"> </span><span class="nv">anotherCondition</span><span class="w"> </span><span class="ss">)</span><span class="w"> </span><span class="nv">parameterString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">appendWithDelimiter</span><span class="ss">(</span><span class="w"> </span><span class="nv">parameterString</span>,<span class="w"> </span><span class="s2">"anotherElementName"</span>,<span class="w"> </span><span class="s2">","</span><span class="w"> </span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>I realize this isn't particularly efficient, since there are strings being
created all over the place, but I was going for clarity more than
optimization.</p>
<p>In Ruby, I can do something like this instead, which feels much more elegant:</p>
<div class="code"><pre class="code literal-block"><span class="nv">parameterArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>[]<span class="c1">;</span>
<span class="nv">parameterArray</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">"elementName"</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">condition</span><span class="c1">;</span>
<span class="nv">parameterArray</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s2">"anotherElementName"</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">anotherCondition</span><span class="c1">;</span>
<span class="nv">parameterString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">parameterArray</span>.<span class="nv">join</span><span class="ss">(</span><span class="s2">","</span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>But since Java lacks a join command, I couldn't figure out anything
equivalent.</p>
<p>So, what's the best way to do this in Java?</p>
<p><br><br></p>
<h2>Answer</h2>
<h4>Pre Java 8:</h4>
<p>Apache's commons lang is your friend here - it provides a join method very
similar to the one you refer to in Ruby:</p>
<p><code>StringUtils.join(java.lang.Iterable,char)</code></p>
<hr>
<h4>Java 8:</h4>
<p>Java 8 provides joining out of the box via <code>StringJoiner</code> and <code>String.join()</code>.
The snippets below show how you can use them:</p>
<p><code>StringJoiner</code></p>
<div class="code"><pre class="code literal-block">StringJoiner joiner = new StringJoiner(",");
joiner.add("01").add("02").add("03");
String joinedString = joiner.toString(); // "01,02,03"
</pre></div>

<hr>
<p><code>String.join(CharSequence delimiter, CharSequence... elements))</code></p>
<div class="code"><pre class="code literal-block">String joinedString = String.join(" - ", "04", "05", "06"); // "04 - 05 - 06"
</pre></div>

<hr>
<p><code>String.join(CharSequence delimiter, Iterable&lt;? extends CharSequence&gt;
elements)</code></p>
<div class="code"><pre class="code literal-block">List&lt;String&gt; strings = new LinkedList&lt;&gt;();
strings.add("Java");strings.add("is");
strings.add("cool");
String message = String.join(" ", strings);
//message returned is: "Java is cool"
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You could write a little join-style utility method that works on
java.util.Lists</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">join</span><span class="ss">(</span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">list</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">delim</span><span class="ss">)</span><span class="w"> </span>{

<span class="w">    </span><span class="nv">StringBuilder</span><span class="w"> </span><span class="nv">sb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">StringBuilder</span><span class="ss">()</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">String</span><span class="w"> </span><span class="nv">loopDelim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="c1">;</span>

<span class="w">    </span><span class="k">for</span><span class="ss">(</span><span class="nv">String</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span>:<span class="w"> </span><span class="nv">list</span><span class="ss">)</span><span class="w"> </span>{

<span class="w">        </span><span class="nv">sb</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">loopDelim</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span><span class="nv">sb</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">s</span><span class="ss">)</span><span class="c1">;</span>

<span class="w">        </span><span class="nv">loopDelim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">delim</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">sb</span>.<span class="nv">toString</span><span class="ss">()</span><span class="c1">;</span>
}
</pre></div>

<p>Then use it like so:</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ArrayList</span><span class="o">&lt;</span><span class="nv">String</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>

<span class="w">    </span><span class="k">if</span><span class="ss">(</span><span class="w"> </span><span class="nv">condition</span><span class="w"> </span><span class="ss">)</span><span class="w">        </span><span class="nv">list</span>.<span class="nv">add</span><span class="ss">(</span><span class="s2">"elementName"</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="k">if</span><span class="ss">(</span><span class="w"> </span><span class="nv">anotherCondition</span><span class="w"> </span><span class="ss">)</span><span class="w"> </span><span class="nv">list</span>.<span class="nv">add</span><span class="ss">(</span><span class="s2">"anotherElementName"</span><span class="ss">)</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">join</span><span class="ss">(</span><span class="nv">list</span>,<span class="w"> </span><span class="s2">","</span><span class="ss">)</span><span class="c1">;</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/logging-with-retrofit-2/" class="u-url">Logging with Retrofit 2</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/logging-with-retrofit-2/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T02:26:26+08:00" itemprop="datePublished" title="2023-03-05 02:26">2023-03-05 02:26</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to get the exact JSON that is being sent in the request. Here is my
code:</p>
<div class="code"><pre class="code literal-block"><span class="n">OkHttpClient</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">OkHttpClient</span><span class="p">();</span>
<span class="n">client</span><span class="p">.</span><span class="n">interceptors</span><span class="p">().</span><span class="k">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Interceptor</span><span class="p">()</span><span class="err">{</span>
<span class="w">   </span><span class="nv">@Override</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">com</span><span class="p">.</span><span class="n">squareup</span><span class="p">.</span><span class="n">okhttp</span><span class="p">.</span><span class="n">Response</span><span class="w"> </span><span class="n">intercept</span><span class="p">(</span><span class="n">Chain</span><span class="w"> </span><span class="n">chain</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="n">Request</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="n">request</span><span class="p">();</span>
<span class="w">      </span><span class="nf">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="ss">"\nrequest:\n%s\nheaders:\n%s"</span><span class="p">,</span>
<span class="w">                          </span><span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">().</span><span class="n">toString</span><span class="p">(),</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">()));</span>
<span class="w">      </span><span class="n">com</span><span class="p">.</span><span class="n">squareup</span><span class="p">.</span><span class="n">okhttp</span><span class="p">.</span><span class="n">Response</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="p">.</span><span class="n">proceed</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">response</span><span class="p">;</span>
<span class="w">   </span><span class="err">}</span>
<span class="err">}</span><span class="p">);</span>
<span class="n">Retrofit</span><span class="w"> </span><span class="n">retrofit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Retrofit</span><span class="p">.</span><span class="n">Builder</span><span class="p">()</span>
<span class="w">   </span><span class="p">.</span><span class="n">baseUrl</span><span class="p">(</span><span class="n">API_URL</span><span class="p">)</span>
<span class="w">   </span><span class="p">.</span><span class="n">addConverterFactory</span><span class="p">(</span><span class="n">GsonConverterFactory</span><span class="p">.</span><span class="k">create</span><span class="p">())</span>
<span class="w">   </span><span class="p">.</span><span class="n">client</span><span class="p">(</span><span class="n">client</span><span class="p">).</span><span class="n">build</span><span class="p">();</span>
</pre></div>

<p>But I only see this in the logs:</p>
<div class="code"><pre class="code literal-block"><span class="nl">request</span><span class="p">:</span>
<span class="n">com</span><span class="p">.</span><span class="n">squareup</span><span class="p">.</span><span class="n">okhttp</span><span class="p">.</span><span class="n">RequestBody$1</span><span class="mf">@3ff</span><span class="mi">4074</span><span class="n">d</span>
<span class="nl">headers</span><span class="p">:</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">:</span><span class="w"> </span><span class="n">application</span><span class="o">/</span><span class="n">vnd</span><span class="p">.</span><span class="n">ll</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">list</span><span class="o">+</span><span class="n">json</span>
</pre></div>

<p>How am I supposed to do proper logging, given the removal of <code>setLog()</code> and
<code>setLogLevel()</code> which we used to use with Retrofit 1?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>In Retrofit 2 you should use HttpLoggingInterceptor.</p>
<p>Add dependency to <code>build.gradle</code>. Latest version as of October 2019 is:</p>
<div class="code"><pre class="code literal-block">implementation 'com.squareup.okhttp3:logging-interceptor:4.2.1'
</pre></div>

<p>Create a <code>Retrofit</code> object like the following:</p>
<div class="code"><pre class="code literal-block"><span class="nt">HttpLoggingInterceptor</span><span class="w"> </span><span class="nt">interceptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">HttpLoggingInterceptor</span><span class="o">();</span>
<span class="nt">interceptor</span><span class="p">.</span><span class="nc">setLevel</span><span class="o">(</span><span class="nt">HttpLoggingInterceptor</span><span class="p">.</span><span class="nc">Level</span><span class="p">.</span><span class="nc">BODY</span><span class="o">);</span>
<span class="nt">OkHttpClient</span><span class="w"> </span><span class="nt">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">OkHttpClient</span><span class="p">.</span><span class="nc">Builder</span><span class="o">()</span><span class="p">.</span><span class="nc">addInterceptor</span><span class="o">(</span><span class="nt">interceptor</span><span class="o">)</span><span class="p">.</span><span class="nc">build</span><span class="o">();</span>

<span class="nt">Retrofit</span><span class="w"> </span><span class="nt">retrofit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">Retrofit</span><span class="p">.</span><span class="nc">Builder</span><span class="o">()</span>
<span class="w">        </span><span class="p">.</span><span class="nc">baseUrl</span><span class="o">(</span><span class="s2">"https://backend.example.com"</span><span class="o">)</span>
<span class="w">        </span><span class="p">.</span><span class="nc">client</span><span class="o">(</span><span class="nt">client</span><span class="o">)</span>
<span class="w">        </span><span class="p">.</span><span class="nc">addConverterFactory</span><span class="o">(</span><span class="nt">GsonConverterFactory</span><span class="p">.</span><span class="nc">create</span><span class="o">())</span>
<span class="w">        </span><span class="p">.</span><span class="nc">build</span><span class="o">();</span>

<span class="nt">return</span><span class="w"> </span><span class="nt">retrofit</span><span class="p">.</span><span class="nc">create</span><span class="o">(</span><span class="nt">ApiClient</span><span class="p">.</span><span class="nc">class</span><span class="o">);</span>
</pre></div>

<p>In case of deprecation warnings, simply change <code>setLevel</code> to:</p>
<div class="code"><pre class="code literal-block">interceptor.level(HttpLoggingInterceptor.Level.BODY);
</pre></div>

<p>The above solution gives you logcat messages very similar to the old ones set
by</p>
<div class="code"><pre class="code literal-block">setLogLevel(RestAdapter.LogLevel.FULL)
</pre></div>

<p><strong>In case of<code>java.lang.ClassNotFoundException</code></strong>:</p>
<p>Older Retrofit version might require an older <code>logging-interceptor</code> version.
Take a look at comments sections for details.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I met the thing as you and I tried to ask the author of the book <strong><em>Retrofit:
Love working with APIs on Android</em></strong> (here is the link) (nope! I am not making
some ads for them....but they are really nice guys :) And the author replied
to me very soon, with both Log method on Retrofit 1.9 and Retrofit 2.0-beta.</p>
<p>And here is the code of Retrofit 2.0-beta:</p>
<div class="code"><pre class="code literal-block">HttpLoggingInterceptor logging = new HttpLoggingInterceptor();  
// set your desired log level
logging.setLevel(Level.BODY);

OkHttpClient httpClient = new OkHttpClient();  
// add your other interceptors …

// add logging as last interceptor
httpClient.interceptors().add(logging);  // &lt;-- this is the important line!

Retrofit retrofit = new Retrofit.Builder()  
   .baseUrl(API_BASE_URL)
   .addConverterFactory(GsonConverterFactory.create())
   .client(httpClient)
   .build();
</pre></div>

<p>This is how to add logging method with the help of <strong>HttpLoggingInterceptor</strong>.
Also if you are the reader of that book I mentioned above, you may find that
it says there is not log method with Retrofit 2.0 anymore -- which, I had
asked the author, is not correct and they will update the book next year
talking about it.</p>
<p>// In case you are not that familiar with the Log method in Retrofit, I would
like to share something more.</p>
<p>Also should be noticed that there are some Logging Levels you could pick. I
use the <strong>Level.BODY</strong> most of the time, which will give some thing like this:</p>
<p><img alt="enter image description here" src="images/b1C2E.png"></p>
<p>You can find almost all the http staff inside the picture: the header, the
content and response, etc.</p>
<p>And sometimes you really don't need all the guests to attend your party: I
just want to know whether it's successfully connected, that internet call is
successfully made within my Activiy &amp; Fragmetn. Then you are free to use
<strong>Level.BASIC</strong> , which will return something like this:</p>
<p><img alt="enter image description here" src="images/nkpB9.png"></p>
<p>Can you find the status code <strong>200 OK</strong> inside? That is it :)</p>
<p>Also there is another one, <strong>Level.HEADERS</strong> , which will only return the
header of the network. Ya of course another picture here:</p>
<p><img alt="enter image description here" src="images/eAk66.png"></p>
<p>That's all of the Logging trick ;)</p>
<p>And I would like to share you with the tutorial I learned a lot there. They
have a bunch of great post talking about almost everything related to
Retrofit, and they are continuing updating the post, at the same time Retrofit
2.0 is coming. Please take a look at those work, which I think will save you
lots of time.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-restore-the-permissions-of-files-and-directories-within-git-if-they-have-been-modified/" class="u-url">How to restore the permissions of files and directories within git if they have been modified?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-restore-the-permissions-of-files-and-directories-within-git-if-they-have-been-modified/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T02:24:58+08:00" itemprop="datePublished" title="2023-03-05 02:24">2023-03-05 02:24</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a git checkout. All the file permissions are different than what git
thinks they should be therefore they all show up as modified.</p>
<p>Without touching the content of the files (just want to modify the
permissions) how do I set all the files permissions to what git thinks they
should be?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Git keeps track of filepermission and exposes permission changes when creating
patches using <code>git diff -p</code>. So all we need is:</p>
<ol>
<li>create a reverse patch</li>
<li>include only the permission changes</li>
<li>apply the patch to our working copy</li>
</ol>
<p>As a one-liner:</p>
<div class="code"><pre class="code literal-block">git diff -p -R --no-ext-diff --no-color \
    | grep -E "^(diff|(old|new) mode)" --color=never  \
    | git apply
</pre></div>

<p>you can also add it as an alias to your git config...</p>
<div class="code"><pre class="code literal-block">git config --global --add alias.permission-reset '!git diff -p -R --no-ext-diff --no-color | grep -E "^(diff|(old|new) mode)" --color=never | git apply'
</pre></div>

<p>...and you can invoke it via:</p>
<div class="code"><pre class="code literal-block">git permission-reset
</pre></div>

<p>Note, if you shell is <code>bash</code>, make sure to use <code>'</code> instead of <code>"</code> quotes
around the <code>!git</code>, otherwise it gets substituted with the last <code>git</code> command
you ran.</p>
<p>Thx to @Mixologic for pointing out that by simply using <code>-R</code> on <code>git diff</code>,
the cumbersome <code>sed</code> command is no longer required.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Try <code>git config core.fileMode false</code></p>
<p>From the <code>git config</code> man page:</p>
<blockquote>
<p><code>core.fileMode</code></p>
<p>If false, the executable bit differences between the index and the working
copy are ignored; useful on broken filesystems like FAT. See git-update-
index(1).</p>
<p>The default is true, except git-clone(1) or git-init(1) will probe and set
core.fileMode false if appropriate when the repository is created.</p>
</blockquote>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2580.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2578.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
