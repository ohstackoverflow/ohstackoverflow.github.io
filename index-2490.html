<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2490) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2490.html">
<link rel="prev" href="index-2491.html" type="text/html">
<link rel="next" href="index-2489.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/node-js-fs-readdir-recursive-directory-search/" class="u-url">Node.js fs.readdir recursive directory search</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/node-js-fs-readdir-recursive-directory-search/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T20:02:06+08:00" itemprop="datePublished" title="2023-03-04 20:02">2023-03-04 20:02</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Any ideas on an async directory search using fs.readdir? I realize that we
could introduce recursion and call the read directory function with the next
directory to read, but I'm a little worried about it not being async...</p>
<p>Any ideas? I've looked at node-walk which is great, but doesn't give me just
the files in an array, like readdir does. Although</p>
<p>Looking for output like...</p>
<div class="code"><pre class="code literal-block">['file1.txt', 'file2.txt', 'dir/file3.txt']
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>There are basically two ways of accomplishing this. In an async environment
you'll notice that there are two kinds of loops: serial and parallel. A serial
loop waits for one iteration to complete before it moves onto the next
iteration - this guarantees that every iteration of the loop completes in
order. In a parallel loop, all the iterations are started at the same time,
and one may complete before another, however, it is much faster than a serial
loop. So in this case, it's probably better to use a parallel loop because it
doesn't matter what order the walk completes in, just as long as it completes
and returns the results (unless you want them in order).</p>
<p>A parallel loop would look like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">walk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">  </span><span class="n">fs</span><span class="o">.</span><span class="n">readdir</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">done</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">pending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="o">.</span><span class="n">length</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pending</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">done</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">);</span>
<span class="w">    </span><span class="n">list</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="p">);</span>
<span class="w">      </span><span class="n">fs</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">stat</span><span class="o">.</span><span class="n">isDirectory</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">walk</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!--</span><span class="n">pending</span><span class="p">)</span><span class="w"> </span><span class="n">done</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">);</span>
<span class="w">          </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">results</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!--</span><span class="n">pending</span><span class="p">)</span><span class="w"> </span><span class="n">done</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">};</span>
</pre></div>

<p>A serial loop would look like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">walk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">  </span><span class="n">fs</span><span class="o">.</span><span class="n">readdir</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">done</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">(</span><span class="n">function</span><span class="w"> </span><span class="n">next</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">var</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">];</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">done</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="p">);</span>
<span class="w">      </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="p">);</span>
<span class="w">      </span><span class="n">fs</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">stat</span><span class="o">.</span><span class="n">isDirectory</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">walk</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="w">            </span><span class="n">next</span><span class="p">();</span>
<span class="w">          </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">results</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">          </span><span class="n">next</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">})();</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">};</span>
</pre></div>

<p>And to test it out on your home directory (WARNING: the results list will be
huge if you have a lot of stuff in your home directory):</p>
<div class="code"><pre class="code literal-block"><span class="nv">walk</span><span class="ss">(</span><span class="nv">process</span>.<span class="nv">env</span>.<span class="nv">HOME</span>,<span class="w"> </span><span class="nv">function</span><span class="ss">(</span><span class="nv">err</span>,<span class="w"> </span><span class="nv">results</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">err</span><span class="ss">)</span><span class="w"> </span><span class="nv">throw</span><span class="w"> </span><span class="nv">err</span><span class="c1">;</span>
<span class="w">  </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="nv">results</span><span class="ss">)</span><span class="c1">;</span>
}<span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>EDIT: Improved examples.</p>
<p><br></p>
<h3>Suggest</h3>
<p>This one uses the maximum amount of new, buzzwordy features available in node
8, including Promises, util/promisify, destructuring, async-await, map+reduce
and more, making your co-workers scratch their heads as they try to figure out
what is going on.</p>
<h3>Node 8+</h3>
<p>No external dependencies.</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">promisify</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'util'</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">readdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">promisify</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">readdir</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">promisify</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">stat</span><span class="p">);</span>

<span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">getFiles</span><span class="p">(</span><span class="n">dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">subdirs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">readdir</span><span class="p">(</span><span class="n">dir</span><span class="p">);</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">subdirs</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">async</span><span class="w"> </span><span class="p">(</span><span class="n">subdir</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resolve</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">subdir</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">await</span><span class="w"> </span><span class="n">stat</span><span class="p">(</span><span class="n">res</span><span class="p">))</span><span class="o">.</span><span class="n">isDirectory</span><span class="p">()</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="n">getFiles</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">  </span><span class="p">}));</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">files</span><span class="o">.</span><span class="n">reduce</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="w"> </span><span class="p">[]);</span>
<span class="p">}</span>
</pre></div>

<h4>Usage</h4>
<div class="code"><pre class="code literal-block"><span class="nv">getFiles</span><span class="ss">(</span><span class="nv">__dirname</span><span class="ss">)</span>
<span class="w">  </span>.<span class="k">then</span><span class="ss">(</span><span class="nv">files</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="nv">files</span><span class="ss">))</span>
<span class="w">  </span>.<span class="nv">catch</span><span class="ss">(</span><span class="nv">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">error</span><span class="ss">(</span><span class="nv">e</span><span class="ss">))</span><span class="c1">;</span>
</pre></div>

<h3>Node 10.10+</h3>
<p>Updated for node 10+ with even more whizbang:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">readdir</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">)</span><span class="o">.</span><span class="n">promises</span><span class="p">;</span>

<span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">getFiles</span><span class="p">(</span><span class="n">dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">dirents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">readdir</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">withFileTypes</span><span class="p">:</span><span class="w"> </span><span class="bp">true</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dirents</span><span class="o">.</span><span class="n">map</span><span class="p">((</span><span class="n">dirent</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resolve</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">dirent</span><span class="o">.</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">dirent</span><span class="o">.</span><span class="n">isDirectory</span><span class="p">()</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="n">getFiles</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">  </span><span class="p">}));</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">Array</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="o">...</span><span class="n">files</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Note that starting with node 11.15.0 you can use <code>files.flat()</code> instead of
<code>Array.prototype.concat(...files)</code> to flatten the files array.</p>
<h3>Node 11+</h3>
<p>If you want to blow everybody's head up completely, you can use the following
version using <em>async iterators</em>. In addition to being really cool, it also
allows consumers to pull results one-at-a-time, making it better suited for
really large directories.</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">readdir</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">)</span><span class="o">.</span><span class="n">promises</span><span class="p">;</span>

<span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="o">*</span><span class="w"> </span><span class="n">getFiles</span><span class="p">(</span><span class="n">dir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">dirents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">readdir</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">withFileTypes</span><span class="p">:</span><span class="w"> </span><span class="bp">true</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">dirent</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">dirents</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resolve</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="n">dirent</span><span class="o">.</span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dirent</span><span class="o">.</span><span class="n">isDirectory</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">yield</span><span class="o">*</span><span class="w"> </span><span class="n">getFiles</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">yield</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Usage has changed because the return type is now an async iterator instead of
a promise</p>
<div class="code"><pre class="code literal-block"><span class="p">;(</span><span class="n">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">getFiles</span><span class="p">(</span><span class="s1">'.'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">})()</span>
</pre></div>

<p>In case somebody is interested, I've written more about async iterators here:
https://qwtel.com/posts/software/async-generators-in-the-wild/</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-the-difference-in-applying-gradle-plugin/" class="u-url">What the difference in applying gradle plugin</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-the-difference-in-applying-gradle-plugin/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T20:00:11+08:00" itemprop="datePublished" title="2023-03-04 20:00">2023-03-04 20:00</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I don't understand gradle plugins block</p>
<div class="code"><pre class="code literal-block">apply plugin: 'someplugin1'
apply plugin: 'maven'
</pre></div>

<p>and other one:</p>
<div class="code"><pre class="code literal-block">plugins {
   id 'org.hidetake.ssh' version '1.1.2'
}
</pre></div>

<p>In first block We have some plugin name. in second one package and version. I
don't understand where I should use first block and when second one.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The <code>plugins</code> block is the newer method of applying plugins, and they must be
available in the Gradle plugin repository. The <code>apply</code> approach is the older,
yet more flexible method of adding a plugin to your build.</p>
<p>The new <code>plugins</code> method does not work in multi-project configurations
(<code>subprojects</code>, <code>allprojects</code>), but will work on the build configuration for
each child project.</p>
<p>I would think that as functionality progresses, the <code>plugins</code> configuration
method will overtake the older approach, but at this point both can be and are
used concurrently.</p>
<p><br></p>
<h3>Suggest</h3>
<p>As already mentioned by @cjstehno the <code>apply plugin</code> is a legacy method that
you should avoid.</p>
<blockquote>
<p>With the introduction of the plugins DSL, users should have little reason to
use the legacy method of applying plugins. It is documented here in case a
build author cannot use the plugins DSL due to restrictions in how it
currently works.</p>
</blockquote>
<p>With the new <code>plugins block</code> method, you can add a plugin and control when to
apply it using an optional parameter <code>apply</code>:</p>
<div class="code"><pre class="code literal-block">plugins {
    id «plugin id» version «plugin version» [apply «false»]
}
</pre></div>

<p>You would still use the legacy method in situations where you want to apply an
already added but not applied plugin in your <code>plugins</code> block. E.g, in the
master project a plugin <code>xyz</code> is added but not applied and it should be
applied only in a subproject <code>subPro</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">plugins</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="s">"xyz"</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s">"1.0.0"</span><span class="w"> </span><span class="kr">apply</span><span class="w"> </span><span class="kr">false</span>
<span class="p">}</span>

<span class="n">subprojects</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">subproject</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">subproject</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"subPro"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">apply</span><span class="w"> </span><span class="n">plugin</span><span class="o">:</span><span class="w"> </span><span class="s">'xyz'</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Notice that you don't need the version anymore. The version is required in the
<code>plugins</code> block unless you are using one of the Core Gradle plugins, such as
<code>java</code>, <code>scala</code>, ...</p>
<p>I spent some time understanding the difference while trying to create a
<code>Spring Boot</code> application, and that's why I am answering this again after a
while. The following example for using <code>Spring Boot</code> plugin helped me a lot:</p>
<p>What should currently be used:</p>
<div class="code"><pre class="code literal-block">plugins {
  id "org.springframework.boot" version "2.0.1.RELEASE"
}
</pre></div>

<p>What had been used before Gradle 2.1:</p>
<div class="code"><pre class="code literal-block">buildscript {
  repositories {
    maven {
      url "https://plugins.gradle.org/m2/"
    }
  }
  dependencies {
    classpath "org.springframework.boot:spring-boot-gradle-plugin:2.0.1.RELEASE"
  }
}

apply plugin: "org.springframework.boot"
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/t-sql-cast-versus-convert/" class="u-url">T-SQL Cast versus Convert</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/t-sql-cast-versus-convert/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T19:58:53+08:00" itemprop="datePublished" title="2023-03-04 19:58">2023-03-04 19:58</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What is the general guidance on when you should use <code>CAST</code> versus <code>CONVERT</code>?
Is there any performance issues related to choosing one versus the other? Is
one closer to ANSI-SQL?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><code>CONVERT</code> is SQL Server specific, <code>CAST</code> is ANSI.</p>
<p><code>CONVERT</code> is more flexible in that you can format dates etc. Other than that,
they are pretty much the same. If you don't care about the extended features,
use <code>CAST</code>.</p>
<p>EDIT:</p>
<p>As noted by @beruic and @C-F in the comments below, there is possible loss of
precision when an implicit conversion is used (that is one where you use
neither CAST nor CONVERT). For further information, see CAST and CONVERT and
in particular this graphic: SQL Server Data Type Conversion Chart. With this
extra information, the original advice still remains the same. Use CAST where
possible.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Convert has a style parameter for date to string conversions.</p>
<p>http://msdn.microsoft.com/en-us/library/ms187928.aspx</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2491.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2489.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
