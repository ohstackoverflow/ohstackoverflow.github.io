<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 759) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-759.html">
<link rel="prev" href="index-760.html" type="text/html">
<link rel="next" href="index-758.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/php-define-vs-const/" class="u-url">PHP | define() vs. const</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/php-define-vs-const/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T15:14:59+08:00" itemprop="datePublished" title="2023-02-17 15:14">2023-02-17 15:14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In PHP, you can declare constants in two ways:</p>
<ol>
<li>
<p>With <code>define</code> keyword</p>
<div class="code"><pre class="code literal-block">define('FOO', 1);
</pre></div>

</li>
<li>
<p>Using <code>const</code> keyword</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">FOO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</pre></div>

</li>
</ol>
<hr>
<ul>
<li>What are the main differences between those two?</li>
<li>When and why should you use one and when use the other?</li>
</ul>
<p><br><br></p>
<h2>Answer</h2>
<p>As of PHP 5.3 there are two ways to define constants: Either using the <code>const</code>
keyword or using the <code>define()</code> function:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">FOO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'BAR'</span><span class="p">;</span>
<span class="n">define</span><span class="p">(</span><span class="s1">'FOO'</span><span class="p">,</span><span class="w"> </span><span class="s1">'BAR'</span><span class="p">);</span>
</pre></div>

<p>The fundamental difference between those two ways is that <code>const</code> defines
constants at compile time, whereas <code>define</code> defines them at run time. This
causes most of <code>const</code>'s disadvantages. Some disadvantages of <code>const</code> are:</p>
<ul>
<li>
<code>const</code> cannot be used to conditionally define constants. To define a global constant, it has to be used in the outermost scope:<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FOO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'BAR'</span><span class="p">;</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Invalid</span>
</pre></div>

<p>}
 // but
 if (...) {
     define('FOO', 'BAR'); // Valid
 }</p>
</li>
</ul>
<p>Why would you want to do that anyway? One common application is to check
whether the constant is already defined:</p>
<div class="code"><pre class="code literal-block"><span class="w">     </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="o">!</span><span class="nv">defined</span><span class="ss">(</span><span class="s1">'FOO'</span><span class="ss">))</span><span class="w"> </span>{
<span class="w">     </span><span class="nv">define</span><span class="ss">(</span><span class="s1">'FOO'</span>,<span class="w"> </span><span class="s1">'BAR'</span><span class="ss">)</span><span class="c1">;</span>
<span class="w"> </span>}
</pre></div>

<ul>
<li>
<p><code>const</code> accepts a static scalar (number, string or other constant like <code>true</code>, <code>false</code>, <code>null</code>, <code>__FILE__</code>), whereas <code>define()</code> takes any expression. Since PHP 5.6 constant expressions are allowed in <code>const</code> as well:</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">BIT_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Valid</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">PHP</span><span class="w"> </span><span class="mf">5.6</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">previously</span>
</pre></div>

<p>define('BIT_5', 1 &lt;&lt; 5); // Always valid</p>
</li>
<li>
<p><code>const</code> takes a plain constant name, whereas <code>define()</code> accepts any expression as name. This allows to do things like this:</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span>$<span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="c1">; $i &lt; 32; ++$i) {</span>
<span class="w"> </span><span class="nv">define</span><span class="ss">(</span><span class="s1">'BIT_'</span><span class="w"> </span>.<span class="w"> </span>$<span class="nv">i</span>,<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span>$<span class="nv">i</span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>}</p>
</li>
<li>
<p><code>const</code>s are always case sensitive, whereas <code>define()</code> allows you to define case insensitive constants by passing <code>true</code> as the third argument (Note: defining case-insensitive constants is deprecated as of PHP 7.3.0 and removed since PHP 8.0.0):</p>
<div class="code"><pre class="code literal-block"> define('FOO', 'BAR', true);
</pre></div>

<p>echo FOO; // BAR
 echo foo; // BAR</p>
</li>
</ul>
<p>So, that was the bad side of things. Now let's look at the reason why I
personally always use <code>const</code> unless one of the above situations occurs:</p>
<ul>
<li>
<p><code>const</code> simply reads nicer. It's a language construct instead of a function and also is consistent with how you define constants in classes.</p>
</li>
<li>
<p><code>const</code>, being a language construct, can be statically analysed by automated tooling.</p>
</li>
<li>
<p><code>const</code> defines a constant in the current namespace, while <code>define()</code> has to be passed the full namespace name:</p>
<div class="code"><pre class="code literal-block"> namespace A\B\C;
</pre></div>

<p>// To define the constant A\B\C\FOO:
 const FOO = 'BAR';
 define('A\B\C\FOO', 'BAR');</p>
</li>
<li>
<p>Since PHP 5.6 <code>const</code> constants can also be arrays, while <code>define()</code> does not support arrays yet. However, arrays will be supported for both cases in PHP 7.</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">FOO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Valid</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">PHP</span><span class="w"> </span><span class="mf">5.6</span>
</pre></div>

<p>define('FOO', [1, 2, 3]); // Invalid in PHP 5.6 and valid in PHP 7.0</p>
</li>
</ul>
<p>Finally, note that <code>const</code> can also be used within a class or interface to
define a class constant or interface constant. <code>define</code> cannot be used for
this purpose:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">BAR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Valid</span>
<span class="p">}</span>
<span class="o">//</span><span class="w"> </span><span class="n">But</span>
<span class="k">class</span><span class="w"> </span><span class="n">Baz</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">define</span><span class="p">(</span><span class="s1">'QUX'</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Invalid</span>
<span class="p">}</span>
</pre></div>

<p><strong>Summary</strong></p>
<p>Unless you need any type of conditional or expressional definition, use
<code>const</code>s instead of <code>define()</code>s - simply for the sake of readability!</p>
<p><br></p>
<h3>Suggest</h3>
<p>Until PHP 5.3, <code>const</code> could not be used in the global scope. You could only
use this from within a class. This should be used when you want to set some
kind of constant option or setting that pertains to that class. Or maybe you
want to create some kind of enum.</p>
<p><code>define</code> can be used for the same purpose, but it can only be used in the
global scope. It should only be used for global settings that affect the
entire application.</p>
<p>An example of good <code>const</code> usage is to get rid of magic numbers. Take a look
at PDO's constants. When you need to specify a fetch type, you would type
<code>PDO::FETCH_ASSOC</code>, for example. If consts were not used, you'd end up typing
something like <code>35</code> (or whatever <code>FETCH_ASSOC</code> is defined as). This makes no
sense to the reader.</p>
<p>An example of good <code>define</code> usage is maybe specifying your application's root
path or a library's version number.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/using-linq-to-remove-elements-from-a-list-t/" class="u-url">Using LINQ to remove elements from a List&lt;T&gt;</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/using-linq-to-remove-elements-from-a-list-t/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T15:14:33+08:00" itemprop="datePublished" title="2023-02-17 15:14">2023-02-17 15:14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Say that I have LINQ query such as:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">authors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">authorsList</span>
<span class="w">              </span><span class="n">where</span><span class="w"> </span><span class="n">x</span><span class="o">.</span><span class="n">firstname</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Bob"</span>
<span class="w">              </span><span class="n">select</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</pre></div>

<p>Given that <code>authorsList</code> is of type <code>List&lt;Author&gt;</code>, how can I delete the
<code>Author</code> elements from <code>authorsList</code> that are returned by the query into
<code>authors</code>?</p>
<p>Or, put another way, how can I delete all of the firstname's equalling Bob
from <code>authorsList</code>?</p>
<p>Note: This is a simplified example for the purposes of the question.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Well, it would be easier to exclude them in the first place:</p>
<div class="code"><pre class="code literal-block">authorsList = authorsList.Where(x =&gt; x.FirstName != "Bob").ToList();
</pre></div>

<p>However, that would just change the value of <code>authorsList</code> instead of removing
the authors from the previous collection. Alternatively, you can use
<code>RemoveAll</code>:</p>
<div class="code"><pre class="code literal-block">authorsList.RemoveAll(x =&gt; x.FirstName == "Bob");
</pre></div>

<p>If you really need to do it based on another collection, I'd use a HashSet,
RemoveAll and Contains:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">setToRemove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Author</span><span class="o">&gt;</span><span class="p">(</span><span class="n">authors</span><span class="p">);</span>
<span class="n">authorsList</span><span class="o">.</span><span class="n">RemoveAll</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">setToRemove</span><span class="o">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>It'd be better to use List<t>.RemoveAll to accomplish this.</t></p>
<div class="code"><pre class="code literal-block">authorsList.RemoveAll((x) =&gt; x.firstname == "Bob");
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/git-push-error-insufficient-permission-for-adding-an-object-to-repository-database/" class="u-url">Git Push Error: insufficient permission for adding an object to repository database</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/git-push-error-insufficient-permission-for-adding-an-object-to-repository-database/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T15:14:07+08:00" itemprop="datePublished" title="2023-02-17 15:14">2023-02-17 15:14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>When I try to push to a shared git remote, I get the following error:
<code>insufficient permission for adding an object to repository database</code></p>
<p>Then I read about a fix here: Fix This worked for the next push, since all of
the files were of the correct group, but the next time someone pushed up a
change it made a new item in the objects folder that had their default group
as the group. The only thing I can think of is to change all of the
developer's default group for items they check in, but that seems like a hack.
Any ideas? Thanks.</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>Repair Permissions</h3>
<p>After you have identified and fixed the underlying cause (see below), you'll
want to repair the permissions:</p>
<div class="code"><pre class="code literal-block"><span class="nv">cd</span><span class="w"> </span><span class="o">/</span><span class="nv">path</span><span class="o">/</span><span class="nv">to</span><span class="o">/</span><span class="nv">repo</span><span class="o">/</span>.<span class="nv">git</span>
<span class="nv">sudo</span><span class="w"> </span><span class="nv">chgrp</span><span class="w"> </span><span class="o">-</span><span class="nv">R</span><span class="w"> </span><span class="nv">groupname</span><span class="w"> </span>.
<span class="nv">sudo</span><span class="w"> </span><span class="nv">chmod</span><span class="w"> </span><span class="o">-</span><span class="nv">R</span><span class="w"> </span><span class="nv">g</span><span class="o">+</span><span class="nv">rwX</span><span class="w"> </span>.
<span class="nv">sudo</span><span class="w"> </span><span class="nv">find</span><span class="w"> </span>.<span class="w"> </span><span class="o">-</span><span class="nv">type</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="o">-</span><span class="k">exec</span><span class="w"> </span><span class="nv">chmod</span><span class="w"> </span><span class="nv">g</span><span class="o">+</span><span class="nv">s</span><span class="w"> </span><span class="s1">'{}'</span><span class="w"> </span><span class="o">+</span>
</pre></div>

<p>Note if you want everyone to be able to modify the repository, you don't need
the <code>chgrp</code> and you will want to change the chmod to <code>sudo chmod -R a+rwX .</code></p>
<p>If you do not fix the underlying cause, the error will keep coming back and
you'll have to keep re-running the above commands over and over again.</p>
<h3>Underlying Causes</h3>
<p>The error could be caused by one of the following:</p>
<ul>
<li>The repository isn't configured to be a shared repository (see <code>core.sharedRepository</code> in <code>git help config</code>). If the output of:<div class="code"><pre class="code literal-block"> git config core.sharedRepository
</pre></div>

</li>
</ul>
<p>is not <code>group</code> or <code>true</code> or <code>1</code> or some mask, try running:</p>
<div class="code"><pre class="code literal-block">     git config core.sharedRepository group
</pre></div>

<p>and then re-run the recursive <code>chmod</code> and <code>chgrp</code> (see "Repair Permissions"
above).</p>
<ul>
<li>The operating system doesn't interpret a setgid bit on directories as "all new files and subdirectories should inherit the group owner".</li>
</ul>
<p>When <code>core.sharedRepository</code> is <code>true</code> or <code>group</code>, Git relies on a feature of
GNU operating systems (e.g., every Linux distribution) to ensure that newly
created subdirectories are owned by the correct group (the group that all of
the repository's users are in). This feature is documented in the GNU
coreutils documentation:</p>
<blockquote>
<p>... [If] a directory's set-group-ID bit is set, newly created subfiles
inherit the same group as the directory, and newly created subdirectories
inherit the set-group-ID bit of the parent directory. ... [This mechanism
lets] users share files more easily, by lessening the need to use <code>chmod</code> or
<code>chown</code> to share new files.</p>
</blockquote>
<p>However, not all operating systems have this feature (NetBSD is one example).
For those operating systems, you should make sure that all of your Git users
have the same default group. Alternatively, you can make the repository world-
writable by running <code>git config core.sharedRepository world</code> (but be
careful—this is less secure).</p>
<ul>
<li>
<p>The file system doesn't support the setgid bit (e.g., FAT). ext2, ext3, ext4 all support the setgid bit. As far as I know, the file systems that don't support the setgid bit also don't support the concept of group ownership so all files and directories will be owned by the same group anyway (which group is a mount option). In this case, make sure all Git users are in the group that owns all the files in the file system.</p>
</li>
<li>
<p>Not all of the Git users are in the same group that owns the repository directories. Make sure the group owner on the directories is correct and that all users are in that group.</p>
</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>For Ubuntu (or any Linux)</p>
<p>From project root,</p>
<div class="code"><pre class="code literal-block">cd .git/objects
ls -al
sudo chown -R yourname:yourgroup *
</pre></div>

<p>You can tell yourname and yourgroup by:</p>
<div class="code"><pre class="code literal-block">#<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">yourname</span>
<span class="nv">whoami</span>
#<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">yourgroup</span>
<span class="nv">id</span><span class="w"> </span><span class="o">-</span><span class="nv">g</span><span class="w"> </span><span class="o">-</span><span class="nv">n</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">yourname</span><span class="o">&gt;</span>
</pre></div>

<p>Note: remember the star at the end of the sudo line</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-760.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-758.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
