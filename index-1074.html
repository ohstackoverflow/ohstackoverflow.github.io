<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1074) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1074.html">
<link rel="prev" href="index-1075.html" type="text/html">
<link rel="next" href="index-1073.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-make-an-android-spinner-with-initial-text-select-one/" class="u-url">How to make an Android Spinner with initial text "Select One"?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-make-an-android-spinner-with-initial-text-select-one/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T00:32:38+08:00" itemprop="datePublished" title="2023-02-18 00:32">2023-02-18 00:32</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to use a Spinner that initially (when the user has not made a selection
yet) displays the text "Select One". When the user clicks the spinner, the
list of items is displayed and the user selects one of the options. After the
user has made a selection, the selected item is displayed in the Spinner
instead of "Select One".</p>
<p>I have the following code to create a Spinner:</p>
<div class="code"><pre class="code literal-block">String[] items = new String[] {"One", "Two", "Three"};
Spinner spinner = (Spinner) findViewById(R.id.mySpinner);
ArrayAdapter&lt;String&gt; adapter = new ArrayAdapter&lt;String&gt;(this,
            android.R.layout.simple_spinner_item, items);
adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
spinner.setAdapter(adapter);
</pre></div>

<p>With this code, initially the item "One" is displayed. I could just add a new
item "Select One" to the items, but then "Select One" would also be displayed
in the dropdown list as first item, which is not what I want.</p>
<p>How can I fix this problem?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Here's a general solution that overrides the <code>Spinner</code> view. It overrides
<code>setAdapter()</code> to set the initial position to -1, and proxies the supplied
<code>SpinnerAdapter</code> to display the prompt string for position less than 0.</p>
<p>This has been tested on Android 1.5 through 4.2, but buyer beware! Because
this solution relies on reflection to call the private
<code>AdapterView.setNextSelectedPositionInt()</code> and
<code>AdapterView.setSelectedPositionInt()</code>, it's not guaranteed to work in future
OS updates. It seems likely that it will, but it is by no means guaranteed.</p>
<p>Normally I wouldn't condone something like this, but this question has been
asked enough times and it seems like a reasonable enough request that I
thought I would post my solution.</p>
<div class="code"><pre class="code literal-block"><span class="o">/**</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">modified</span><span class="w"> </span><span class="n">Spinner</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">doesn</span><span class="s1">'t automatically select the first entry in the list.</span>
<span class="w"> </span><span class="o">*</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Shows</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">prompt</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">nothing</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">selected</span><span class="o">.</span>
<span class="w"> </span><span class="o">*</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Limitations</span><span class="p">:</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">prompt</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">empty</span><span class="o">.</span>
<span class="w"> </span><span class="o">*/</span>
<span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">NoDefaultSpinner</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Spinner</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">NoDefaultSpinner</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">NoDefaultSpinner</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">AttributeSet</span><span class="w"> </span><span class="n">attrs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">attrs</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">NoDefaultSpinner</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">AttributeSet</span><span class="w"> </span><span class="n">attrs</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">defStyle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">attrs</span><span class="p">,</span><span class="w"> </span><span class="n">defStyle</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">setAdapter</span><span class="p">(</span><span class="n">SpinnerAdapter</span><span class="w"> </span><span class="n">orig</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">final</span><span class="w"> </span><span class="n">SpinnerAdapter</span><span class="w"> </span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newProxy</span><span class="p">(</span><span class="n">orig</span><span class="p">);</span>

<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">setAdapter</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>

<span class="w">        </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">final</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdapterView</span><span class="o">.</span><span class="k">class</span><span class="o">.</span><span class="n">getDeclaredMethod</span><span class="p">(</span>
<span class="w">                               </span><span class="s2">"setNextSelectedPositionInt"</span><span class="p">,</span><span class="nb nb-Type">int</span><span class="o">.</span><span class="k">class</span><span class="p">);</span>
<span class="w">            </span><span class="n">m</span><span class="o">.</span><span class="n">setAccessible</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span>
<span class="w">            </span><span class="n">m</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

<span class="w">            </span><span class="n">final</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdapterView</span><span class="o">.</span><span class="k">class</span><span class="o">.</span><span class="n">getDeclaredMethod</span><span class="p">(</span>
<span class="w">                               </span><span class="s2">"setSelectedPositionInt"</span><span class="p">,</span><span class="nb nb-Type">int</span><span class="o">.</span><span class="k">class</span><span class="p">);</span>
<span class="w">            </span><span class="n">n</span><span class="o">.</span><span class="n">setAccessible</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span>
<span class="w">            </span><span class="n">n</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span>
<span class="w">        </span><span class="n">catch</span><span class="p">(</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">SpinnerAdapter</span><span class="w"> </span><span class="n">newProxy</span><span class="p">(</span><span class="n">SpinnerAdapter</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">SpinnerAdapter</span><span class="p">)</span><span class="w"> </span><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">reflect</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">newProxyInstance</span><span class="p">(</span>
<span class="w">                </span><span class="n">obj</span><span class="o">.</span><span class="n">getClass</span><span class="p">()</span><span class="o">.</span><span class="n">getClassLoader</span><span class="p">(),</span>
<span class="w">                </span><span class="n">new</span><span class="w"> </span><span class="n">Class</span><span class="p">[]{</span><span class="n">SpinnerAdapter</span><span class="o">.</span><span class="k">class</span><span class="p">},</span>
<span class="w">                </span><span class="n">new</span><span class="w"> </span><span class="n">SpinnerAdapterProxy</span><span class="p">(</span><span class="n">obj</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>



<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Intercepts</span><span class="w"> </span><span class="n">getView</span><span class="p">()</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">prompt</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">SpinnerAdapterProxy</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="n">InvocationHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="n">SpinnerAdapter</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">getView</span><span class="p">;</span>


<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="n">SpinnerAdapterProxy</span><span class="p">(</span><span class="n">SpinnerAdapter</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">this</span><span class="o">.</span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
<span class="w">            </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">this</span><span class="o">.</span><span class="n">getView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpinnerAdapter</span><span class="o">.</span><span class="k">class</span><span class="o">.</span><span class="n">getMethod</span><span class="p">(</span>
<span class="w">                                 </span><span class="s2">"getView"</span><span class="p">,</span><span class="nb nb-Type">int</span><span class="o">.</span><span class="k">class</span><span class="p">,</span><span class="n">View</span><span class="o">.</span><span class="k">class</span><span class="p">,</span><span class="n">ViewGroup</span><span class="o">.</span><span class="k">class</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span>
<span class="w">            </span><span class="n">catch</span><span class="p">(</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="w"> </span><span class="n">invoke</span><span class="p">(</span><span class="nb nb-Type">Object</span><span class="w"> </span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">m</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">getView</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
<span class="w">                       </span><span class="p">(</span><span class="n">Integer</span><span class="p">)(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="err">?</span><span class="w"> </span>
<span class="w">                         </span><span class="n">getView</span><span class="p">((</span><span class="n">Integer</span><span class="p">)</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],(</span><span class="n">View</span><span class="p">)</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],(</span><span class="n">ViewGroup</span><span class="p">)</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="p">:</span><span class="w"> </span>
<span class="w">                         </span><span class="n">m</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span>
<span class="w">            </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InvocationTargetException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">throw</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">getTargetException</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span>
<span class="w">            </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="n">View</span><span class="w"> </span><span class="n">getView</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">View</span><span class="w"> </span><span class="n">convertView</span><span class="p">,</span><span class="w"> </span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span>
<span class="w">          </span><span class="n">throws</span><span class="w"> </span><span class="n">IllegalAccessException</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">position</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">final</span><span class="w"> </span><span class="n">TextView</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">                  </span><span class="p">(</span><span class="n">TextView</span><span class="p">)</span><span class="w"> </span><span class="p">((</span><span class="n">LayoutInflater</span><span class="p">)</span><span class="n">getContext</span><span class="p">()</span><span class="o">.</span><span class="n">getSystemService</span><span class="p">(</span>
<span class="w">                    </span><span class="n">Context</span><span class="o">.</span><span class="n">LAYOUT_INFLATER_SERVICE</span><span class="p">))</span><span class="o">.</span><span class="n">inflate</span><span class="p">(</span>
<span class="w">                      </span><span class="n">android</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">simple_spinner_item</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="bp">false</span><span class="p">);</span>
<span class="w">                </span><span class="n">v</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">getPrompt</span><span class="p">());</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">obj</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="n">convertView</span><span class="p">,</span><span class="n">parent</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Here's a general solution that overrides the <code>Spinner</code> view. It overrides
<code>setAdapter()</code> to set the initial position to -1, and proxies the supplied
<code>SpinnerAdapter</code> to display the prompt string for position less than 0.</p>
<p>This has been tested on Android 1.5 through 4.2, but buyer beware! Because
this solution relies on reflection to call the private
<code>AdapterView.setNextSelectedPositionInt()</code> and
<code>AdapterView.setSelectedPositionInt()</code>, it's not guaranteed to work in future
OS updates. It seems likely that it will, but it is by no means guaranteed.</p>
<p>Normally I wouldn't condone something like this, but this question has been
asked enough times and it seems like a reasonable enough request that I
thought I would post my solution.</p>
<div class="code"><pre class="code literal-block"><span class="o">/**</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">modified</span><span class="w"> </span><span class="n">Spinner</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">doesn</span><span class="s1">'t automatically select the first entry in the list.</span>
<span class="w"> </span><span class="o">*</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Shows</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">prompt</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">nothing</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">selected</span><span class="o">.</span>
<span class="w"> </span><span class="o">*</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Limitations</span><span class="p">:</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">prompt</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">empty</span><span class="o">.</span>
<span class="w"> </span><span class="o">*/</span>
<span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">NoDefaultSpinner</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Spinner</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">NoDefaultSpinner</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">NoDefaultSpinner</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">AttributeSet</span><span class="w"> </span><span class="n">attrs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">attrs</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">NoDefaultSpinner</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">AttributeSet</span><span class="w"> </span><span class="n">attrs</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">defStyle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">attrs</span><span class="p">,</span><span class="w"> </span><span class="n">defStyle</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">setAdapter</span><span class="p">(</span><span class="n">SpinnerAdapter</span><span class="w"> </span><span class="n">orig</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">final</span><span class="w"> </span><span class="n">SpinnerAdapter</span><span class="w"> </span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newProxy</span><span class="p">(</span><span class="n">orig</span><span class="p">);</span>

<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">setAdapter</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>

<span class="w">        </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">final</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdapterView</span><span class="o">.</span><span class="k">class</span><span class="o">.</span><span class="n">getDeclaredMethod</span><span class="p">(</span>
<span class="w">                               </span><span class="s2">"setNextSelectedPositionInt"</span><span class="p">,</span><span class="nb nb-Type">int</span><span class="o">.</span><span class="k">class</span><span class="p">);</span>
<span class="w">            </span><span class="n">m</span><span class="o">.</span><span class="n">setAccessible</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span>
<span class="w">            </span><span class="n">m</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>

<span class="w">            </span><span class="n">final</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AdapterView</span><span class="o">.</span><span class="k">class</span><span class="o">.</span><span class="n">getDeclaredMethod</span><span class="p">(</span>
<span class="w">                               </span><span class="s2">"setSelectedPositionInt"</span><span class="p">,</span><span class="nb nb-Type">int</span><span class="o">.</span><span class="k">class</span><span class="p">);</span>
<span class="w">            </span><span class="n">n</span><span class="o">.</span><span class="n">setAccessible</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span>
<span class="w">            </span><span class="n">n</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span>
<span class="w">        </span><span class="n">catch</span><span class="p">(</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">SpinnerAdapter</span><span class="w"> </span><span class="n">newProxy</span><span class="p">(</span><span class="n">SpinnerAdapter</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">SpinnerAdapter</span><span class="p">)</span><span class="w"> </span><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">reflect</span><span class="o">.</span><span class="n">Proxy</span><span class="o">.</span><span class="n">newProxyInstance</span><span class="p">(</span>
<span class="w">                </span><span class="n">obj</span><span class="o">.</span><span class="n">getClass</span><span class="p">()</span><span class="o">.</span><span class="n">getClassLoader</span><span class="p">(),</span>
<span class="w">                </span><span class="n">new</span><span class="w"> </span><span class="n">Class</span><span class="p">[]{</span><span class="n">SpinnerAdapter</span><span class="o">.</span><span class="k">class</span><span class="p">},</span>
<span class="w">                </span><span class="n">new</span><span class="w"> </span><span class="n">SpinnerAdapterProxy</span><span class="p">(</span><span class="n">obj</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>



<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Intercepts</span><span class="w"> </span><span class="n">getView</span><span class="p">()</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">prompt</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">SpinnerAdapterProxy</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="n">InvocationHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="n">SpinnerAdapter</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">getView</span><span class="p">;</span>


<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="n">SpinnerAdapterProxy</span><span class="p">(</span><span class="n">SpinnerAdapter</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">this</span><span class="o">.</span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
<span class="w">            </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">this</span><span class="o">.</span><span class="n">getView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SpinnerAdapter</span><span class="o">.</span><span class="k">class</span><span class="o">.</span><span class="n">getMethod</span><span class="p">(</span>
<span class="w">                                 </span><span class="s2">"getView"</span><span class="p">,</span><span class="nb nb-Type">int</span><span class="o">.</span><span class="k">class</span><span class="p">,</span><span class="n">View</span><span class="o">.</span><span class="k">class</span><span class="p">,</span><span class="n">ViewGroup</span><span class="o">.</span><span class="k">class</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span>
<span class="w">            </span><span class="n">catch</span><span class="p">(</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="w"> </span><span class="n">invoke</span><span class="p">(</span><span class="nb nb-Type">Object</span><span class="w"> </span><span class="n">proxy</span><span class="p">,</span><span class="w"> </span><span class="n">Method</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">Throwable</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">m</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">getView</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>
<span class="w">                       </span><span class="p">(</span><span class="n">Integer</span><span class="p">)(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="err">?</span><span class="w"> </span>
<span class="w">                         </span><span class="n">getView</span><span class="p">((</span><span class="n">Integer</span><span class="p">)</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],(</span><span class="n">View</span><span class="p">)</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],(</span><span class="n">ViewGroup</span><span class="p">)</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="p">:</span><span class="w"> </span>
<span class="w">                         </span><span class="n">m</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span>
<span class="w">            </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InvocationTargetException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">throw</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">getTargetException</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span>
<span class="w">            </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="n">View</span><span class="w"> </span><span class="n">getView</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">View</span><span class="w"> </span><span class="n">convertView</span><span class="p">,</span><span class="w"> </span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span>
<span class="w">          </span><span class="n">throws</span><span class="w"> </span><span class="n">IllegalAccessException</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">position</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">final</span><span class="w"> </span><span class="n">TextView</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<span class="w">                  </span><span class="p">(</span><span class="n">TextView</span><span class="p">)</span><span class="w"> </span><span class="p">((</span><span class="n">LayoutInflater</span><span class="p">)</span><span class="n">getContext</span><span class="p">()</span><span class="o">.</span><span class="n">getSystemService</span><span class="p">(</span>
<span class="w">                    </span><span class="n">Context</span><span class="o">.</span><span class="n">LAYOUT_INFLATER_SERVICE</span><span class="p">))</span><span class="o">.</span><span class="n">inflate</span><span class="p">(</span>
<span class="w">                      </span><span class="n">android</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">simple_spinner_item</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="bp">false</span><span class="p">);</span>
<span class="w">                </span><span class="n">v</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">getPrompt</span><span class="p">());</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">obj</span><span class="o">.</span><span class="n">getView</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="n">convertView</span><span class="p">,</span><span class="n">parent</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/checking-if-a-variable-is-defined/" class="u-url">Checking if a variable is defined?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/checking-if-a-variable-is-defined/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T00:31:59+08:00" itemprop="datePublished" title="2023-02-18 00:31">2023-02-18 00:31</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How can I check whether a variable is defined in Ruby? Is there an
<code>isset</code>-type method available?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Use the <code>defined?</code> keyword (documentation). It will return a String with the
kind of the item, or <code>nil</code> if it doesn’t exist.</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">1</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">defined</span><span class="err">?</span><span class="w"> </span><span class="n">a</span>
<span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">"local-variable"</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">defined</span><span class="err">?</span><span class="w"> </span><span class="n">b</span>
<span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">nil</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">defined</span><span class="err">?</span><span class="w"> </span><span class="n">nil</span>
<span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">"nil"</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">defined</span><span class="err">?</span><span class="w"> </span><span class="nb nb-Type">String</span>
<span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">"constant"</span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">defined</span><span class="err">?</span><span class="w"> </span><span class="mi">1</span>
<span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">"expression"</span>
</pre></div>

<p>As skalee commented: "It is worth noting that variable which is set to nil is
initialized."</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nil</span><span class="w">  </span>
<span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">defined</span><span class="err">?</span><span class="w"> </span><span class="n">n</span>
<span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">"local-variable"</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>This is useful if you want to do nothing if it does exist but create it if it
doesn't exist.</p>
<div class="code"><pre class="code literal-block"><span class="n">def</span><span class="w"> </span><span class="n">get_var</span>
<span class="w">  </span><span class="err">@</span><span class="k">var</span><span class="w"> </span><span class="o">||=</span><span class="w"> </span><span class="n">SomeClass</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
<span class="n">end</span>
</pre></div>

<p>This only creates the new instance once. After that it just keeps returning
the var.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/enabling-https-on-express-js/" class="u-url">Enabling HTTPS on express.js</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/enabling-https-on-express-js/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T00:31:31+08:00" itemprop="datePublished" title="2023-02-18 00:31">2023-02-18 00:31</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to get HTTPS working on express.js for node, and I can't figure it
out.</p>
<p>This is my <code>app.js</code> code.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>

<span class="k">var</span><span class="w"> </span><span class="n">privateKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="s1">'sslcert/server.key'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">certificate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="s1">'sslcert/server.crt'</span><span class="p">);</span>

<span class="k">var</span><span class="w"> </span><span class="n">credentials</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="w"> </span><span class="n">privateKey</span><span class="p">,</span><span class="w"> </span><span class="n">cert</span><span class="p">:</span><span class="w"> </span><span class="n">certificate</span><span class="p">};</span>


<span class="k">var</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">express</span><span class="o">.</span><span class="n">createServer</span><span class="p">(</span><span class="n">credentials</span><span class="p">);</span>

<span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">);</span>
<span class="p">});</span>

<span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8000</span><span class="p">);</span>
</pre></div>

<p>When I run it, it seems to only respond to HTTP requests.</p>
<p>I wrote simple vanilla <code>node.js</code> based HTTPS app:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w">   </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s2">"fs"</span><span class="p">),</span>
<span class="w">      </span><span class="n">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s2">"https"</span><span class="p">);</span>

<span class="k">var</span><span class="w"> </span><span class="n">privateKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="s1">'sslcert/server.key'</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">();</span>
<span class="k">var</span><span class="w"> </span><span class="n">certificate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="s1">'sslcert/server.crt'</span><span class="p">)</span><span class="o">.</span><span class="n">toString</span><span class="p">();</span>

<span class="k">var</span><span class="w"> </span><span class="n">credentials</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="w"> </span><span class="n">privateKey</span><span class="p">,</span><span class="w"> </span><span class="n">cert</span><span class="p">:</span><span class="w"> </span><span class="n">certificate</span><span class="p">};</span>

<span class="k">var</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">http</span><span class="o">.</span><span class="n">createServer</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">res</span><span class="o">.</span><span class="n">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">'Content-Type'</span><span class="p">:</span><span class="w"> </span><span class="s1">'text/plain'</span><span class="p">});</span>
<span class="w">  </span><span class="n">res</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="s1">'Hello World</span><span class="se">\n</span><span class="s1">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="n">server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8000</span><span class="p">);</span>
</pre></div>

<p>And when I run this app, it <em>does</em> respond to HTTPS requests. Note that I
don't think the toString() on the fs result matters, as I've used combinations
of both and still no es bueno.</p>
<hr>
<p>EDIT TO ADD:</p>
<p>For production systems, you're probably better off using Nginx or HAProxy to
proxy requests to your nodejs app. You can set up nginx to handle the ssl
requests and just speak http to your node app.js.</p>
<p>EDIT TO ADD (4/6/2015)</p>
<p>For systems on using AWS, you are better off using EC2 Elastic Load Balancers
to handle SSL Termination, and allow regular HTTP traffic to your EC2 web
servers. For further security, setup your security group such that only the
ELB is allowed to send HTTP traffic to the EC2 instances, which will prevent
external unencrypted HTTP traffic from hitting your machines.</p>
<hr>
<p><br><br></p>
<h2>Answer</h2>
<p>In express.js (since version 3) you should use that syntax:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">https</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'https'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">privateKey</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="s1">'sslcert/server.key'</span><span class="p">,</span><span class="w"> </span><span class="s1">'utf8'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">certificate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="s1">'sslcert/server.crt'</span><span class="p">,</span><span class="w"> </span><span class="s1">'utf8'</span><span class="p">);</span>

<span class="k">var</span><span class="w"> </span><span class="n">credentials</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="p">:</span><span class="w"> </span><span class="n">privateKey</span><span class="p">,</span><span class="w"> </span><span class="n">cert</span><span class="p">:</span><span class="w"> </span><span class="n">certificate</span><span class="p">};</span>
<span class="k">var</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">express</span><span class="p">();</span>

<span class="o">//</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">here</span>

<span class="k">var</span><span class="w"> </span><span class="n">httpServer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">http</span><span class="o">.</span><span class="n">createServer</span><span class="p">(</span><span class="n">app</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">httpsServer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">https</span><span class="o">.</span><span class="n">createServer</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">);</span>

<span class="n">httpServer</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>
<span class="n">httpsServer</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8443</span><span class="p">);</span>
</pre></div>

<p>In that way you provide express middleware to the native http/https server</p>
<p>If you want your app running on ports below 1024, you will need to use <code>sudo</code>
command (not recommended) or use a reverse proxy (e.g. nginx, haproxy).</p>
<p><br></p>
<h3>Suggest</h3>
<p>First, you need to create <strong>selfsigned.key</strong> and <strong>selfsigned.crt</strong> files. Go
to Create a Self-Signed SSL Certificate Or do following steps.</p>
<p>Go to the terminal and run the following command.</p>
<p><code>sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout
./selfsigned.key -out selfsigned.crt</code></p>
<ul>
<li>After that put the following information</li>
<li>Country Name (2 letter code) [AU]: <strong>US</strong>
</li>
<li>State or Province Name (full name) [Some-State]: <strong>NY</strong>
</li>
<li>Locality Name (eg, city) []: <strong>NY</strong>
</li>
<li>Organization Name (eg, company) [Internet Widgits Pty Ltd]: <strong>xyz (Your - Organization)</strong>
</li>
<li>Organizational Unit Name (eg, section) []: <strong>xyz (Your Unit Name)</strong>
</li>
<li>Common Name (e.g. server FQDN or YOUR name) []: <strong>www.xyz.com (Your URL)</strong>
</li>
<li>Email Address []: <strong>Your email</strong>
</li>
</ul>
<blockquote>
<p>After creation adds key &amp; cert file in your code, and pass the options to
the server.</p>
</blockquote>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">https</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'https'</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3000</span><span class="p">;</span>

<span class="k">var</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="n">__dirname</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'/../certs/selfsigned.key'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">cert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="n">__dirname</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'/../certs/selfsigned.crt'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">key</span><span class="p">:</span><span class="w"> </span><span class="n">key</span><span class="p">,</span>
<span class="w">  </span><span class="n">cert</span><span class="p">:</span><span class="w"> </span><span class="n">cert</span>
<span class="p">};</span>

<span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">express</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">'Now using https..'</span><span class="p">);</span>
<span class="p">});</span>

<span class="k">var</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">https</span><span class="o">.</span><span class="n">createServer</span><span class="p">(</span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">);</span>

<span class="n">server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"server starting on port : "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">port</span><span class="p">)</span>
<span class="p">});</span>
</pre></div>

<ul>
<li>Finally run your application using <strong>https</strong>.</li>
</ul>
<blockquote>
<p>More information https://github.com/sagardere/set-up-SSL-in-nodejs</p>
</blockquote>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1075.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1073.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
