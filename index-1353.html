<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1353) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1353.html">
<link rel="prev" href="index-1354.html" type="text/html">
<link rel="next" href="index-1352.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/enum-to-string-in-modern-c-11-c-14-c-17-and-future-c-20/" class="u-url">enum to string in modern C++11 / C++14 / C++17 and future C++20</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/enum-to-string-in-modern-c-11-c-14-c-17-and-future-c-20/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T07:25:39+08:00" itemprop="datePublished" title="2023-02-18 07:25">2023-02-18 07:25</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <h4>Contrary to all other similar questions, this question is about using the</h4>
<p>new C++ features.</p>
<ul>
<li>2008 c Is there a simple way to convert C++ enum to string?</li>
<li>2008 c Easy way to use variables of enum types as string in C?</li>
<li>2008 c++ How to easily map c++ enums to strings</li>
<li>2008 c++ Making something both a C identifier and a string?</li>
<li>2008 c++ Is there a simple script to convert C++ enum to string?</li>
<li>2009 c++ How to use enums as flags in C++?</li>
<li>2011 c++ How to convert an enum type variable to a string?</li>
<li>2011 c++ Enum to String C++</li>
<li>2011 c++ How to convert an enum type variable to a string?</li>
<li>2012 c How to convert enum names to string in c</li>
<li>2013 c Stringifying an conditionally compiled enum in C</li>
</ul>
<h4>After reading many answers, I did not yet find any:</h4>
<ul>
<li>Elegant way using C++11, C++14 or C++17 new features</li>
<li>Or something ready-to-use in Boost</li>
<li>Else something planned for C++20</li>
</ul>
<h4>Example</h4>
<p>An example is often better than a long explanation.<br>
You can compile and run this snippet on Coliru.<br>
(Another former example is also available)</p>
<div class="code"><pre class="code literal-block"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;map&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>

<span class="kr">struct</span><span class="w"> </span><span class="nc">MyClass</span>
<span class="p">{</span>
<span class="w">    </span><span class="kr">enum</span><span class="w"> </span><span class="kr">class</span><span class="w"> </span><span class="nc">MyEnum</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kr">char</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">AAA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-8</span><span class="p">,</span>
<span class="w">        </span><span class="n">BBB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">'8'</span><span class="p">,</span>
<span class="w">        </span><span class="n">CCC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AAA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">BBB</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">};</span>

<span class="c1">// Replace magic() by some faster compile-time generated code</span>
<span class="c1">// (you're allowed to replace the return type with std::string</span>
<span class="c1">// if that's easier for you)</span>
<span class="kr">const</span><span class="w"> </span><span class="kr">char</span><span class="o">*</span><span class="w"> </span><span class="nf">magic</span><span class="w"> </span><span class="p">(</span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyEnum</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="nf">map</span><span class="o">&lt;</span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyEnum</span><span class="p">,</span><span class="kr">const</span><span class="w"> </span><span class="kr">char</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">MyEnumStrings</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyEnum</span><span class="o">::</span><span class="n">AAA</span><span class="p">,</span><span class="w"> </span><span class="s">"MyClass::MyEnum::AAA"</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyEnum</span><span class="o">::</span><span class="n">BBB</span><span class="p">,</span><span class="w"> </span><span class="s">"MyClass::MyEnum::BBB"</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyEnum</span><span class="o">::</span><span class="n">CCC</span><span class="p">,</span><span class="w"> </span><span class="s">"MyClass::MyEnum::CCC"</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="kr">auto</span><span class="w">   </span><span class="n">it</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">MyEnumStrings</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MyEnumStrings</span><span class="p">.</span><span class="nf">end</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">"Out of range"</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">magic</span><span class="p">(</span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyEnum</span><span class="o">::</span><span class="n">AAA</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="sc">'\n'</span><span class="p">;</span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">magic</span><span class="p">(</span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyEnum</span><span class="o">::</span><span class="n">BBB</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="sc">'\n'</span><span class="p">;</span>
<span class="w">   </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">magic</span><span class="p">(</span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyEnum</span><span class="o">::</span><span class="n">CCC</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="sc">'\n'</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Constraints</h4>
<ul>
<li>Please no valueless duplication of other answers or basic link.</li>
<li>Please avoid bloat macro-based answer, or try to reduce the <code>#define</code> overhead as minimum as possible.</li>
<li>Please no manual <code>enum</code> -&gt; <code>string</code> mapping.</li>
</ul>
<h4>Nice to have</h4>
<ul>
<li>Support <code>enum</code> values starting from a number different from zero</li>
<li>Support negative <code>enum</code> values</li>
<li>Support fragmented <code>enum</code> values</li>
<li>Support <code>class enum</code> (C++11)</li>
<li>Support <code>class enum : &lt;type&gt;</code> having any allowed <code>&lt;type&gt;</code> (C++11)</li>
<li>
<p>Compile-time (not run-time) conversions to a string,<br>
or at least fast execution at run-time (e.g. <code>std::map</code> is not a great
idea...)</p>
</li>
<li>
<p><code>constexpr</code> (C++11, then relaxed in C++14/17/20)</p>
</li>
<li>
<code>noexcept</code> (C++11)</li>
<li>C++17/C++20 friendly snippet</li>
</ul>
<p>One possible idea could be using the C++ compiler capabilities to generate C++
code at compilation-time using meta-programming tricks based on <code>variadic
template class</code> and <code>constexpr</code> functions...</p>
<p><br><br></p>
<h2>Answer</h2>
<h2>Magic Enum header-only library provides static reflection for enums (to</h2>
<p>string, from string, iteration) for C++17.</p>
<div class="code"><pre class="code literal-block"><span class="c1">#include &lt;magic_enum.hpp&gt;</span>

<span class="k">enum</span><span class="w"> </span><span class="nb nb-Type">Color</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">RED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">BLUE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">GREEN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">};</span>

<span class="nb nb-Type">Color</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">Color</span><span class="p">::</span><span class="n">RED</span><span class="p">;</span>
<span class="n">auto</span><span class="w"> </span><span class="n">color_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">magic_enum</span><span class="p">::</span><span class="n">enum_name</span><span class="p">(</span><span class="n">color</span><span class="p">);</span>
<span class="o">//</span><span class="w"> </span><span class="n">color_name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s2">"RED"</span>

<span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="w"> </span><span class="n">color_name</span><span class="p">{</span><span class="s2">"GREEN"</span><span class="p">};</span>
<span class="n">auto</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">magic_enum</span><span class="p">::</span><span class="n">enum_cast</span><span class="o">&lt;</span><span class="nb nb-Type">Color</span><span class="o">&gt;</span><span class="p">(</span><span class="n">color_name</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">has_value</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">color</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb nb-Type">Color</span><span class="p">::</span><span class="n">GREEN</span>
<span class="p">};</span>
</pre></div>

<p>For more examples check home repository https://github.com/Neargye/magic_enum.</p>
<h3>Where is the drawback?</h3>
<p>This library uses a compiler-specific hack (based on <code>__PRETTY_FUNCTION__</code> /
<code>__FUNCSIG__</code>), which works on Clang &gt;= 5, MSVC &gt;= 15.3 and GCC &gt;= 9.</p>
<p>Enum value must be in range <code>[MAGIC_ENUM_RANGE_MIN, MAGIC_ENUM_RANGE_MAX]</code>.</p>
<ul>
<li>
<p>By default <code>MAGIC_ENUM_RANGE_MIN = -128</code>, <code>MAGIC_ENUM_RANGE_MAX = 128</code>.</p>
</li>
<li>
<p>If need another range for all enum types by default, redefine the macro <code>MAGIC_ENUM_RANGE_MIN</code> and <code>MAGIC_ENUM_RANGE_MAX</code>.</p>
</li>
<li>
<p><code>MAGIC_ENUM_RANGE_MIN</code> must be less or equals than <code>0</code> and must be greater than <code>INT16_MIN</code>.</p>
</li>
<li>
<p><code>MAGIC_ENUM_RANGE_MAX</code> must be greater than <code>0</code> and must be less than <code>INT16_MAX</code>.</p>
</li>
<li>
<p>If need another range for specific enum type, add specialization enum_range for necessary enum type.</p>
<div class="code"><pre class="code literal-block"><span class="c1">#include &lt;magic_enum.hpp&gt;</span>
</pre></div>

<p>enum number { one = 100, two = 200, three = 300 };</p>
<p>namespace magic_enum {
template &lt;&gt;
  struct enum_range<number> {
    static constexpr int min = 100;
    static constexpr int max = 300;
};
}</number></p>
</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>(The approach of the better_enums library)</p>
<p>There is a way to do enum to string in current C++ that looks like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">ENUM</span><span class="p">(</span><span class="n">Channel</span><span class="p">,</span><span class="w"> </span><span class="nb">char</span><span class="p">,</span><span class="w"> </span><span class="n">Red</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Green</span><span class="p">,</span><span class="w"> </span><span class="n">Blue</span><span class="p">)</span>

<span class="o">//</span><span class="w"> </span><span class="s2">"Same as"</span><span class="p">:</span>
<span class="o">//</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">Channel</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Red</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Green</span><span class="p">,</span><span class="w"> </span><span class="n">Blue</span><span class="w"> </span><span class="p">};</span>
</pre></div>

<p>Usage:</p>
<div class="code"><pre class="code literal-block"><span class="nt">Channel</span><span class="w">     </span><span class="nt">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">Channel</span><span class="p">::</span><span class="nd">_from_string</span><span class="o">(</span><span class="s2">"Green"</span><span class="o">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nt">Channel</span><span class="p">::</span><span class="nd">Green</span><span class="w"> </span><span class="o">(</span><span class="nt">2</span><span class="o">)</span>
<span class="nt">c</span><span class="p">.</span><span class="nc">_to_string</span><span class="o">();</span><span class="w">                                  </span><span class="o">//</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="s2">"Green"</span>

<span class="nt">for</span><span class="w"> </span><span class="o">(</span><span class="nt">Channel</span><span class="w"> </span><span class="nt">c</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nt">Channel</span><span class="p">::</span><span class="nd">_values</span><span class="o">())</span>
<span class="w">    </span><span class="nt">std</span><span class="p">::</span><span class="nd">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="nt">c</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="nt">std</span><span class="p">::</span><span class="nd">endl</span><span class="o">;</span>

<span class="o">//</span><span class="w"> </span><span class="nt">And</span><span class="w"> </span><span class="nt">so</span><span class="w"> </span><span class="nt">on</span><span class="o">...</span>
</pre></div>

<p>All operations can be made <code>constexpr</code>. You can also implement the C++17
reflection proposal mentioned in the answer by @ecatmur.</p>
<ul>
<li>There is only one macro. I believe this is the minimum possible, because preprocessor stringization (<code>#</code>) is the only way to convert a token to a string in current C++.</li>
<li>The macro is pretty unobtrusive – the constant declarations, including initializers, are pasted into a built-in enum declaration. This means they have the same syntax and meaning as in a built-in enum.</li>
<li>Repetition is eliminated.</li>
<li>The implementation is most natural and useful in at least C++11, due to <code>constexpr</code>. It can also be made to work with C++98 + <code>__VA_ARGS__</code>. It is definitely modern C++.</li>
</ul>
<hr>
<p>The macro's definition is somewhat involved, so I'm answering this in several
ways.</p>
<ul>
<li>The bulk of this answer is an implementation that I think is suitable for the space constraints on StackOverflow.</li>
<li>There is also a CodeProject article describing the basics of the implementation in a long-form tutorial. [ <em>Should I move it here? I think it's too much for a SO answer</em> ].</li>
<li>There is a full-featured library "Better Enums" that implements the macro in a single header file. It also implements N4428 Type Property Queries, the current revision of the C++17 reflection proposal N4113. So, at least for enums declared through this macro, you can have the proposed C++17 enum reflection now, in C++11/C++14.</li>
</ul>
<p>It is straightforward to extend this answer to the features of the library –
nothing "important" is left out here. It is, however, quite tedious, and there
are compiler portability concerns.</p>
<p><strong>Disclaimer</strong> : I am the author of both the CodeProject article and the
library.</p>
<p>You can try the code in this answer, the library, and the implementation of
N4428 live online in Wandbox. The library documentation also contains an
overview of how to use it as N4428, which explains the enums portion of that
proposal.</p>
<hr>
<h2>Explanation</h2>
<p>The code below implements conversions between enums and strings. However, it
can be extended to do other things as well, such as iteration. This answer
wraps an enum in a <code>struct</code>. You can also generate a traits <code>struct</code> alongside
an enum instead.</p>
<p>The strategy is to generate something like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">struct</span><span class="w"> </span><span class="n">Channel</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="n">_enum</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Channel</span><span class="w">          </span><span class="n">_values</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w">     </span><span class="n">_names</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">#__VA_ARGS__ };</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="o">*</span><span class="w"> </span><span class="n">_to_string</span><span class="p">(</span><span class="n">Channel</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">/*</span><span class="w"> </span><span class="n">easy</span><span class="w"> </span><span class="o">*/</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Channel</span><span class="w"> </span><span class="n">_from_string</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">/*</span><span class="w"> </span><span class="n">easy</span><span class="w"> </span><span class="o">*/</span><span class="w"> </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>

<p>The problems are:</p>
<ol>
<li>We will end up with something like <code>{Red = 1, Green, Blue}</code> as the initializer for the values array. This is not valid C++, because <code>Red</code> is not an assignable expression. This is solved by casting each constant to a type <code>T</code> that has an assignment operator, but will drop the assignment: <code>{(T)Red = 1, (T)Green, (T)Blue}</code>.</li>
<li>Similarly, we will end up with <code>{"Red = 1", "Green", "Blue"}</code> as the initializer for the names array. We will need to trim off the <code>" = 1"</code>. I am not aware of a great way to do this at compile time, so we will defer this to run time. As a result, <code>_to_string</code> won't be <code>constexpr</code>, but <code>_from_string</code> can still be <code>constexpr</code>, because we can treat whitespace and equals signs as terminators when comparing with untrimmed strings.</li>
<li>Both the above need a "mapping" macro that can apply another macro to each element in <code>__VA_ARGS__</code>. This is pretty standard. This answer includes a simple version that can handle up to 8 elements.</li>
<li>If the macro is to be truly self-contained, it needs to declare no static data that requires a separate definition. In practice, this means arrays need special treatment. There are two possible solutions: <code>constexpr</code> (or just <code>const</code>) arrays at namespace scope, or regular arrays in non-<code>constexpr</code> static inline functions. The code in this answer is for C++11 and takes the former approach. The CodeProject article is for C++98 and takes the latter.</li>
</ol>
<hr>
<h2>Code</h2>
<div class="code"><pre class="code literal-block"><span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">cstddef</span><span class="o">&gt;</span><span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="k">For</span><span class="w"> </span><span class="n">size_t</span><span class="p">.</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">cstring</span><span class="o">&gt;</span><span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="k">For</span><span class="w"> </span><span class="n">strcspn</span><span class="p">,</span><span class="w"> </span><span class="n">strncpy</span><span class="p">.</span>
<span class="n">#include</span><span class="w"> </span><span class="o">&lt;</span><span class="n">stdexcept</span><span class="o">&gt;</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">For</span><span class="w"> </span><span class="n">runtime_error</span><span class="p">.</span>



<span class="o">//</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="ss">"typical"</span><span class="w"> </span><span class="n">mapping</span><span class="w"> </span><span class="n">macro</span><span class="p">.</span><span class="w"> </span><span class="k">MAP</span><span class="p">(</span><span class="n">macro</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="n">expands</span><span class="w"> </span><span class="k">to</span>
<span class="o">//</span><span class="w"> </span><span class="n">macro</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="n">macro</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="n">macro</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">...</span>
<span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">helper</span><span class="w"> </span><span class="n">macro</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="n">expands</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="k">of</span>
<span class="o">//</span><span class="w"> </span><span class="n">arguments</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">control</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">of</span>
<span class="o">//</span><span class="w"> </span><span class="n">expansion</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">Visual</span><span class="w"> </span><span class="n">C</span><span class="o">++</span><span class="w"> </span><span class="n">compilers</span><span class="p">.</span>
<span class="n">#define</span><span class="w"> </span><span class="k">MAP</span><span class="p">(</span><span class="n">macro</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="err">\</span>
<span class="w">    </span><span class="k">IDENTITY</span><span class="p">(</span><span class="w"> </span><span class="err">\</span>
<span class="w">        </span><span class="n">APPLY</span><span class="p">(</span><span class="n">CHOOSE_MAP_START</span><span class="p">,</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(</span><span class="n">__VA_ARGS__</span><span class="p">))</span><span class="w"> </span><span class="err">\</span>
<span class="w">            </span><span class="p">(</span><span class="n">macro</span><span class="p">,</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="p">))</span>

<span class="n">#define</span><span class="w"> </span><span class="n">CHOOSE_MAP_START</span><span class="p">(</span><span class="nf">count</span><span class="p">)</span><span class="w"> </span><span class="k">MAP</span><span class="w"> </span><span class="err">##</span><span class="w"> </span><span class="nf">count</span>

<span class="n">#define</span><span class="w"> </span><span class="n">APPLY</span><span class="p">(</span><span class="n">macro</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">macro</span><span class="p">(</span><span class="n">__VA_ARGS__</span><span class="p">))</span>

<span class="n">#define</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span>

<span class="n">#define</span><span class="w"> </span><span class="n">MAP1</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w">      </span><span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">#define</span><span class="w"> </span><span class="n">MAP2</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">MAP1</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="p">))</span>
<span class="n">#define</span><span class="w"> </span><span class="n">MAP3</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">MAP2</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="p">))</span>
<span class="n">#define</span><span class="w"> </span><span class="n">MAP4</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">MAP3</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="p">))</span>
<span class="n">#define</span><span class="w"> </span><span class="n">MAP5</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">MAP4</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="p">))</span>
<span class="n">#define</span><span class="w"> </span><span class="n">MAP6</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">MAP5</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="p">))</span>
<span class="n">#define</span><span class="w"> </span><span class="n">MAP7</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">MAP6</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="p">))</span>
<span class="n">#define</span><span class="w"> </span><span class="n">MAP8</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">MAP7</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="p">))</span>

<span class="n">#define</span><span class="w"> </span><span class="n">EVALUATE_COUNT</span><span class="p">(</span><span class="n">_1</span><span class="p">,</span><span class="w"> </span><span class="n">_2</span><span class="p">,</span><span class="w"> </span><span class="n">_3</span><span class="p">,</span><span class="w"> </span><span class="n">_4</span><span class="p">,</span><span class="w"> </span><span class="n">_5</span><span class="p">,</span><span class="w"> </span><span class="n">_6</span><span class="p">,</span><span class="w"> </span><span class="n">_7</span><span class="p">,</span><span class="w"> </span><span class="n">_8</span><span class="p">,</span><span class="w"> </span><span class="nf">count</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="err">\</span>
<span class="w">    </span><span class="nf">count</span>

<span class="n">#define</span><span class="w"> </span><span class="nf">COUNT</span><span class="p">(...)</span><span class="w"> </span><span class="err">\</span>
<span class="w">    </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">EVALUATE_COUNT</span><span class="p">(</span><span class="n">__VA_ARGS__</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>



<span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="ss">"T"</span><span class="w"> </span><span class="n">mentioned</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">drops</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="n">operations</span><span class="p">.</span>
<span class="n">template</span><span class="w"> </span><span class="o">&lt;</span><span class="n">typename</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span>
<span class="n">struct</span><span class="w"> </span><span class="n">ignore_assign</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="n">explicit</span><span class="w"> </span><span class="n">ignore_assign</span><span class="p">(</span><span class="n">U</span><span class="w"> </span><span class="k">value</span><span class="p">)</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">_value</span><span class="p">(</span><span class="k">value</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="err">}</span>
<span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="n">U</span><span class="p">()</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">_value</span><span class="p">;</span><span class="w"> </span><span class="err">}</span>

<span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="n">ignore_assign</span><span class="o">&amp;</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="o">=</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">dummy</span><span class="p">)</span><span class="w"> </span><span class="n">const</span>
<span class="w">        </span><span class="err">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">this</span><span class="p">;</span><span class="w"> </span><span class="err">}</span>

<span class="w">    </span><span class="n">U</span><span class="w">   </span><span class="n">_value</span><span class="p">;</span>
<span class="err">}</span><span class="p">;</span>



<span class="o">//</span><span class="w"> </span><span class="n">Prepends</span><span class="w"> </span><span class="ss">"(ignore_assign&lt;_underlying&gt;)"</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">argument</span><span class="p">.</span>
<span class="n">#define</span><span class="w"> </span><span class="n">IGNORE_ASSIGN_SINGLE</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">ignore_assign</span><span class="o">&lt;</span><span class="n">_underlying</span><span class="o">&gt;</span><span class="p">)</span><span class="n">e</span><span class="p">,</span>
<span class="n">#define</span><span class="w"> </span><span class="n">IGNORE_ASSIGN</span><span class="p">(...)</span><span class="w"> </span><span class="err">\</span>
<span class="w">    </span><span class="k">IDENTITY</span><span class="p">(</span><span class="k">MAP</span><span class="p">(</span><span class="n">IGNORE_ASSIGN_SINGLE</span><span class="p">,</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="p">))</span>

<span class="o">//</span><span class="w"> </span><span class="n">Stringizes</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">argument</span><span class="p">.</span>
<span class="n">#define</span><span class="w"> </span><span class="n">STRINGIZE_SINGLE</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="n">#e</span><span class="p">,</span>
<span class="n">#define</span><span class="w"> </span><span class="n">STRINGIZE</span><span class="p">(...)</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="k">MAP</span><span class="p">(</span><span class="n">STRINGIZE_SINGLE</span><span class="p">,</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="p">))</span>



<span class="o">//</span><span class="w"> </span><span class="ow">Some</span><span class="w"> </span><span class="n">helpers</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">_from_string</span><span class="p">.</span>
<span class="n">constexpr</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="nc">char</span><span class="w">    </span><span class="n">terminators</span><span class="err">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">" =\t\r\n"</span><span class="p">;</span>

<span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">size</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">terminators</span><span class="w"> </span><span class="n">includes</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">implicit</span><span class="w"> </span><span class="s1">'\0'</span><span class="p">.</span>
<span class="n">constexpr</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="n">is_terminator</span><span class="p">(</span><span class="nc">char</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">size_t</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="err">{</span>
<span class="w">    </span><span class="k">return</span>
<span class="w">        </span><span class="k">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">sizeof</span><span class="p">(</span><span class="n">terminators</span><span class="p">)</span><span class="w"> </span><span class="vm">?</span><span class="w"> </span><span class="k">false</span><span class="w"> </span><span class="err">:</span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">terminators</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="vm">?</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="err">:</span>
<span class="w">        </span><span class="n">is_terminator</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="err">}</span>

<span class="n">constexpr</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="n">matches_untrimmed</span><span class="p">(</span><span class="n">const</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="n">untrimmed</span><span class="p">,</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">,</span>
<span class="w">                                 </span><span class="n">size_t</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="err">{</span>
<span class="w">    </span><span class="k">return</span>
<span class="w">        </span><span class="n">is_terminator</span><span class="p">(</span><span class="n">untrimmed</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="vm">?</span><span class="w"> </span><span class="n">s</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'\0'</span><span class="w"> </span><span class="err">:</span>
<span class="w">        </span><span class="n">s</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">untrimmed</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="vm">?</span><span class="w"> </span><span class="k">false</span><span class="w"> </span><span class="err">:</span>
<span class="w">        </span><span class="n">matches_untrimmed</span><span class="p">(</span><span class="n">untrimmed</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="err">}</span>



<span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">macro</span><span class="w"> </span><span class="n">proper</span><span class="p">.</span>
<span class="o">//</span>
<span class="o">//</span><span class="w"> </span><span class="n">There</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">several</span><span class="w"> </span><span class="ss">"simplifications"</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">implementation</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span>
<span class="o">//</span><span class="w"> </span><span class="n">sake</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">brevity</span><span class="p">.</span><span class="w"> </span><span class="k">First</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">viable</span><span class="w"> </span><span class="k">option</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">declaring</span>
<span class="o">//</span><span class="w"> </span><span class="n">constexpr</span><span class="w"> </span><span class="nl">arrays</span><span class="p">:</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="k">scope</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">probably</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">done</span>
<span class="o">//</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">namespaces</span><span class="w"> </span><span class="nl">deep</span><span class="p">:</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">likely</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="k">unique</span><span class="w"> </span><span class="k">for</span>
<span class="o">//</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">little</span><span class="w"> </span><span class="n">enum</span><span class="w"> </span><span class="ss">"library"</span><span class="p">,</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="n">whose</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">is</span>
<span class="o">//</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">enum</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">collisions</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">enums</span><span class="p">.</span>
<span class="o">//</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">am</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">nesting</span><span class="p">.</span>
<span class="o">//</span>
<span class="o">//</span><span class="w"> </span><span class="n">Declaring</span><span class="w"> </span><span class="n">constexpr</span><span class="w"> </span><span class="n">arrays</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">struct</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">viable</span><span class="w"> </span><span class="n">because</span>
<span class="o">//</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="k">out</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="n">line</span><span class="w"> </span><span class="n">definitions</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="ow">in</span>
<span class="o">//</span><span class="w"> </span><span class="n">duplicate</span><span class="w"> </span><span class="n">symbols</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">linking</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">solved</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">weak</span>
<span class="o">//</span><span class="w"> </span><span class="n">symbols</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">compiler</span><span class="o">-</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">system</span><span class="o">-</span><span class="k">specific</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span>
<span class="o">//</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">declare</span><span class="w"> </span><span class="n">constexpr</span><span class="w"> </span><span class="n">arrays</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="ow">in</span>
<span class="o">//</span><span class="w"> </span><span class="n">constexpr</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">restrictions</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">functions</span><span class="p">.</span>
<span class="o">//</span>
<span class="o">//</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">prevents</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">macro</span><span class="w"> </span><span class="n">anywhere</span><span class="w"> </span><span class="ow">except</span><span class="w"> </span><span class="k">at</span>
<span class="o">//</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="k">scope</span><span class="p">.</span><span class="w"> </span><span class="n">Ironically</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">C</span><span class="o">++</span><span class="mi">98</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">can</span>
<span class="o">//</span><span class="w"> </span><span class="k">declare</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">arrays</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">member</span><span class="w"> </span><span class="n">functions</span><span class="p">,</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">actually</span>
<span class="o">//</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">flexible</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">regard</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">shown</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CodeProject</span>
<span class="o">//</span><span class="w"> </span><span class="n">article</span><span class="p">.</span>
<span class="o">//</span>
<span class="o">//</span><span class="w"> </span><span class="k">Second</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">compilation</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">reasons</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">separate</span>
<span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">macro</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ss">"parametric"</span><span class="w"> </span><span class="n">portion</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">portion</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">depends</span>
<span class="o">//</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">knowing</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">former</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">template</span><span class="p">.</span>
<span class="o">//</span>
<span class="o">//</span><span class="w"> </span><span class="n">Third</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">_from_string</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">may</span>
<span class="o">//</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">exposed</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">interface</span><span class="p">.</span>

<span class="n">#define</span><span class="w"> </span><span class="n">ENUM</span><span class="p">(</span><span class="n">EnumName</span><span class="p">,</span><span class="w"> </span><span class="n">Underlying</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w">                               </span><span class="err">\</span>
<span class="n">namespace</span><span class="w"> </span><span class="n">data_</span><span class="w"> </span><span class="err">##</span><span class="w"> </span><span class="n">EnumName</span><span class="w"> </span><span class="err">{</span><span class="w">                                         </span><span class="err">\</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">_underlying</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Underlying</span><span class="p">;</span><span class="w">                                   </span><span class="err">\</span>
<span class="w">    </span><span class="n">enum</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="w"> </span><span class="err">}</span><span class="p">;</span><span class="w">                                             </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="n">size_t</span><span class="w">           </span><span class="n">_size</span><span class="w"> </span><span class="o">=</span><span class="w">                          </span><span class="err">\</span>
<span class="w">        </span><span class="k">IDENTITY</span><span class="p">(</span><span class="nf">COUNT</span><span class="p">(</span><span class="n">__VA_ARGS__</span><span class="p">));</span><span class="w">                                 </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="n">_underlying</span><span class="w">      </span><span class="n">_values</span><span class="err">[]</span><span class="w"> </span><span class="o">=</span><span class="w">                      </span><span class="err">\</span>
<span class="w">        </span><span class="err">{</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">IGNORE_ASSIGN</span><span class="p">(</span><span class="n">__VA_ARGS__</span><span class="p">))</span><span class="w"> </span><span class="err">}</span><span class="p">;</span><span class="w">                     </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">const</span><span class="w">     </span><span class="n">_raw_names</span><span class="err">[]</span><span class="w"> </span><span class="o">=</span><span class="w">                   </span><span class="err">\</span>
<span class="w">        </span><span class="err">{</span><span class="w"> </span><span class="k">IDENTITY</span><span class="p">(</span><span class="n">STRINGIZE</span><span class="p">(</span><span class="n">__VA_ARGS__</span><span class="p">))</span><span class="w"> </span><span class="err">}</span><span class="p">;</span><span class="w">                         </span><span class="err">\</span>
<span class="err">}</span><span class="w">                                                                     </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="n">struct</span><span class="w"> </span><span class="n">EnumName</span><span class="w"> </span><span class="err">{</span><span class="w">                                                     </span><span class="err">\</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">_underlying</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Underlying</span><span class="p">;</span><span class="w">                                   </span><span class="err">\</span>
<span class="w">    </span><span class="n">enum</span><span class="w"> </span><span class="n">_enum</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">_underlying</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">__VA_ARGS__</span><span class="w"> </span><span class="err">}</span><span class="p">;</span><span class="w">                         </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">    </span><span class="n">const</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_to_string</span><span class="p">()</span><span class="w"> </span><span class="n">const</span><span class="w">                                   </span><span class="err">\</span>
<span class="w">    </span><span class="err">{</span><span class="w">                                                                 </span><span class="err">\</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">size_t</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">data_</span><span class="w"> </span><span class="err">##</span><span class="w"> </span><span class="nl">EnumName</span><span class="p">:</span><span class="err">:</span><span class="n">_size</span><span class="p">;</span><span class="w">      </span><span class="err">\</span>
<span class="w">             </span><span class="o">++</span><span class="k">index</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w">                                               </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data_</span><span class="w"> </span><span class="err">##</span><span class="w"> </span><span class="nl">EnumName</span><span class="p">:</span><span class="err">:</span><span class="n">_values</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">_value</span><span class="p">)</span><span class="w">          </span><span class="err">\</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">_trimmed_names</span><span class="p">()</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">;</span><span class="w">                       </span><span class="err">\</span>
<span class="w">        </span><span class="err">}</span><span class="w">                                                             </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">runtime_error</span><span class="p">(</span><span class="ss">"invalid value"</span><span class="p">);</span><span class="w">                    </span><span class="err">\</span>
<span class="w">    </span><span class="err">}</span><span class="w">                                                                 </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">EnumName</span><span class="w"> </span><span class="n">_from_string</span><span class="p">(</span><span class="n">const</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">,</span><span class="w">             </span><span class="err">\</span>
<span class="w">                                           </span><span class="n">size_t</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">          </span><span class="err">\</span>
<span class="w">    </span><span class="err">{</span><span class="w">                                                                 </span><span class="err">\</span>
<span class="w">        </span><span class="k">return</span><span class="w">                                                        </span><span class="err">\</span>
<span class="w">            </span><span class="k">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">data_</span><span class="w"> </span><span class="err">##</span><span class="w"> </span><span class="nl">EnumName</span><span class="p">:</span><span class="err">:</span><span class="n">_size</span><span class="w"> </span><span class="vm">?</span><span class="w">                       </span><span class="err">\</span>
<span class="w">                    </span><span class="k">throw</span><span class="w"> </span><span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">runtime_error</span><span class="p">(</span><span class="ss">"invalid identifier"</span><span class="p">)</span><span class="w"> </span><span class="err">:</span><span class="w">  </span><span class="err">\</span>
<span class="w">            </span><span class="n">matches_untrimmed</span><span class="p">(</span><span class="w">                                        </span><span class="err">\</span>
<span class="w">                </span><span class="n">data_</span><span class="w"> </span><span class="err">##</span><span class="w"> </span><span class="nl">EnumName</span><span class="p">:</span><span class="err">:</span><span class="n">_raw_names</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="vm">?</span><span class="w">            </span><span class="err">\</span>
<span class="w">                    </span><span class="p">(</span><span class="n">EnumName</span><span class="p">)(</span><span class="n">_enum</span><span class="p">)</span><span class="n">data_</span><span class="w"> </span><span class="err">##</span><span class="w"> </span><span class="nl">EnumName</span><span class="p">:</span><span class="err">:</span><span class="n">_values</span><span class="o">[</span><span class="n">      \</span>
<span class="n">                                                            index</span><span class="o">]</span><span class="w"> </span><span class="err">:</span><span class="w">  </span><span class="err">\</span>
<span class="w">            </span><span class="n">_from_string</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">                               </span><span class="err">\</span>
<span class="w">    </span><span class="err">}</span><span class="w">                                                                 </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">    </span><span class="n">EnumName</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span><span class="w">                                              </span><span class="err">\</span>
<span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="n">EnumName</span><span class="p">(</span><span class="n">_enum</span><span class="w"> </span><span class="k">value</span><span class="p">)</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">_value</span><span class="p">(</span><span class="k">value</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="err">}</span><span class="w">               </span><span class="err">\</span>
<span class="w">    </span><span class="n">constexpr</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="n">_enum</span><span class="p">()</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">_enum</span><span class="p">)</span><span class="n">_value</span><span class="p">;</span><span class="w"> </span><span class="err">}</span><span class="w">        </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">  </span><span class="nl">private</span><span class="p">:</span><span class="w">                                                            </span><span class="err">\</span>
<span class="w">    </span><span class="n">_underlying</span><span class="w">     </span><span class="n">_value</span><span class="p">;</span><span class="w">                                           </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="nc">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">const</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">_trimmed_names</span><span class="p">()</span><span class="w">                      </span><span class="err">\</span>
<span class="w">    </span><span class="err">{</span><span class="w">                                                                 </span><span class="err">\</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="nc">char</span><span class="w">     </span><span class="o">*</span><span class="n">the_names</span><span class="o">[</span><span class="n">data_ ## EnumName::_size</span><span class="o">]</span><span class="p">;</span><span class="w">         </span><span class="err">\</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">bool</span><span class="w">     </span><span class="n">initialized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span><span class="w">                          </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="err">!</span><span class="n">initialized</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w">                                           </span><span class="err">\</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">size_t</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">data_</span><span class="w"> </span><span class="err">##</span><span class="w"> </span><span class="nl">EnumName</span><span class="p">:</span><span class="err">:</span><span class="n">_size</span><span class="p">;</span><span class="w">  </span><span class="err">\</span>
<span class="w">                 </span><span class="o">++</span><span class="k">index</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w">                                           </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">                </span><span class="n">size_t</span><span class="w">  </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w">                                      </span><span class="err">\</span>
<span class="w">                    </span><span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">strcspn</span><span class="p">(</span><span class="n">data_</span><span class="w"> </span><span class="err">##</span><span class="w"> </span><span class="nl">EnumName</span><span class="p">:</span><span class="err">:</span><span class="n">_raw_names</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">,</span><span class="err">\</span>
<span class="w">                                 </span><span class="n">terminators</span><span class="p">);</span><span class="w">                        </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">                </span><span class="n">the_names</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">char</span><span class="o">[</span><span class="n">length + 1</span><span class="o">]</span><span class="p">;</span><span class="w">              </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">                </span><span class="nl">std</span><span class="p">:</span><span class="err">:</span><span class="n">strncpy</span><span class="p">(</span><span class="n">the_names</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">,</span><span class="w">                        </span><span class="err">\</span>
<span class="w">                             </span><span class="n">data_</span><span class="w"> </span><span class="err">##</span><span class="w"> </span><span class="nl">EnumName</span><span class="p">:</span><span class="err">:</span><span class="n">_raw_names</span><span class="o">[</span><span class="n">index</span><span class="o">]</span><span class="p">,</span><span class="w">    </span><span class="err">\</span>
<span class="w">                             </span><span class="n">length</span><span class="p">);</span><span class="w">                                 </span><span class="err">\</span>
<span class="w">                </span><span class="n">the_names</span><span class="o">[</span><span class="n">index</span><span class="o">][</span><span class="n">length</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'\0'</span><span class="p">;</span><span class="w">                      </span><span class="err">\</span>
<span class="w">            </span><span class="err">}</span><span class="w">                                                         </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">            </span><span class="n">initialized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w">                                       </span><span class="err">\</span>
<span class="w">        </span><span class="err">}</span><span class="w">                                                             </span><span class="err">\</span>
<span class="w">                                                                      </span><span class="err">\</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">the_names</span><span class="p">;</span><span class="w">                                             </span><span class="err">\</span>
<span class="w">    </span><span class="err">}</span><span class="w">                                                                 </span><span class="err">\</span>
<span class="err">}</span><span class="p">;</span>
</pre></div>

<p>and</p>
<div class="code"><pre class="code literal-block"><span class="c1">// The code above was a "header file". This is a program that uses it.</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">"the_file_above.h"</span>

<span class="n">ENUM</span><span class="p">(</span><span class="n">Channel</span><span class="p">,</span><span class="w"> </span><span class="kr">char</span><span class="p">,</span><span class="w"> </span><span class="n">Red</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Green</span><span class="p">,</span><span class="w"> </span><span class="n">Blue</span><span class="p">)</span>

<span class="n">constexpr</span><span class="w"> </span><span class="n">Channel</span><span class="w">   </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Channel</span><span class="o">::</span><span class="n">_from_string</span><span class="p">(</span><span class="s">"Red"</span><span class="p">);</span>

<span class="kr">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">channel</span><span class="p">.</span><span class="n">_to_string</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">Channel</span><span class="o">::</span><span class="no">Red</span><span class="p">:</span><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">Channel</span><span class="o">::</span><span class="no">Green</span><span class="p">:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">Channel</span><span class="o">::</span><span class="no">Blue</span><span class="p">:</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">static_assert</span><span class="p">(</span><span class="kr">sizeof</span><span class="p">(</span><span class="n">Channel</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kr">sizeof</span><span class="p">(</span><span class="kr">char</span><span class="p">),</span><span class="w"> </span><span class="s">""</span><span class="p">);</span>
</pre></div>

<p>The program above prints <code>Red</code>, as you would expect. There is a degree of type
safety, since you can't create an enum without initializing it, and deleting
one of the cases from the <code>switch</code> will result in a warning from the compiler
(depending on your compiler and flags). Also, note that <code>"Red"</code> was converted
to an enum during compilation.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-difference-between-require-x-and-import-x/" class="u-url">The difference between "require(x)" and "import x"</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/the-difference-between-require-x-and-import-x/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T07:24:04+08:00" itemprop="datePublished" title="2023-02-18 07:24">2023-02-18 07:24</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've just started working on a small node project that will interface with a
MongoDB. However, I cannot seem to get the relevant node modules to import
correctly, even though I have installed them correctly via <code>npm</code>.</p>
<p>For example, the following code throws an error, telling me that "express has
no default export":</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">express</span> <span class="kn">from</span> <span class="s2">"express"</span><span class="p">;</span>
</pre></div>

<p>However, this code works:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s2">"express"</span><span class="p">);</span>
</pre></div>

<p><strong>So my question is, what is the difference in how the import and
variable/require methods function?</strong> I'd like to fix whatever is plaguing my
imports on the project, as it seems likely to cause additional problems down
the road.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This simple image will help to you understand the differences between
<code>require</code> and <code>import</code>.</p>
<p><img alt="enter image description here" src="images/O7XuF.png"></p>
<p><strong>Apart from that,</strong></p>
<p>You <strong>can't</strong> selectively load only the pieces you need with <code>require</code> but
with <code>import</code>, you can selectively load only the pieces you need, which can
save memory.</p>
<p>Loading is <strong>synchronous</strong> (step by step) for <code>require</code> on the other hand
<code>import</code> can be asynchronous(without waiting for previous import) so it <em>can
perform a little better than</em> <code>require</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The major difference between <code>require</code> and <code>import</code>, is that <code>require</code> will
automatically scan <code>node_modules</code> to find modules, but <code>import</code>, which comes
from ES6, won't.</p>
<p>Most people use babel to compile <code>import</code> and <code>export</code>, which makes <code>import</code>
act the same as <code>require</code>.</p>
<p>The future version of Node.js might support <code>import</code> itself (actually, the
experimental version already does), and judging by Node.js' notes, <code>import</code>
won't support <code>node_modules</code>, it base on ES6, and must specify the path of the
module.</p>
<p>So I would suggest you not use <code>import</code> with babel, but this feature is not
yet confirmed, it might support <code>node_modules</code> in the future, who would know?</p>
<hr>
<p>For reference, below is an example of how babel can convert ES6's <code>import</code>
syntax to CommonJS's <code>require</code> syntax.</p>
<p>Say the file<code>app_es6.js</code> contains this import:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">format</span> <span class="kn">from</span> <span class="s1">'date-fns/format'</span><span class="p">;</span>
</pre></div>

<p>This is a directive to import the format function from the node package date-
fns.</p>
<p>The related <code>package.json</code> file could contain something like this:</p>
<div class="code"><pre class="code literal-block">"scripts": {
    "start": "node app.js",
    "build-server-file": "babel app_es6.js --out-file app.js",
    "webpack": "webpack"
}
</pre></div>

<p>The related <code>.babelrc</code> file could be something like this:</p>
<div class="code"><pre class="code literal-block">{
    "presets": [
        [
            "env",
            {
                "targets":
                {
                    "node": "current"
                }
            }
        ]
    ]
}
</pre></div>

<p>This <code>build-server-file</code> script defined in the <code>package.json</code> file is a
directive for babel to parse the <code>app_es6.js</code> file and output the file
<code>app.js</code>.</p>
<p>After running the <code>build-server-file</code> script, if you open <code>app.js</code> and look
for the <code>date-fns</code> import, you will see it has been converted into this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">_format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s2">"date-fns/format"</span><span class="p">);</span>

<span class="k">var</span><span class="w"> </span><span class="n">_format2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_interopRequireDefault</span><span class="p">(</span><span class="n">_format</span><span class="p">);</span>
</pre></div>

<p>Most of that file is gobbledygook to most humans, however computers understand
it.</p>
<hr>
<p>Also for reference, as an example of how a module can be created and imported
into your project, if you install <code>date-fns</code> and then open <code>node_modules/date-
fns/get_year/index.js</code> you can see it contains:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'../parse/index.js'</span><span class="p">)</span>

<span class="n">function</span><span class="w"> </span><span class="n">getYear</span><span class="w"> </span><span class="p">(</span><span class="n">dirtyDate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse</span><span class="p">(</span><span class="n">dirtyDate</span><span class="p">)</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">date</span><span class="o">.</span><span class="n">getFullYear</span><span class="p">()</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">year</span>
<span class="p">}</span>

<span class="n">module</span><span class="o">.</span><span class="n">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getYear</span>
</pre></div>

<p>Using the babel process above, your <code>app_es6.js</code> file could then contain:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">getYear</span> <span class="kn">from</span> <span class="s1">'date-fns/get_year'</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Which</span> <span class="n">year</span> <span class="ow">is</span> <span class="mi">2</span> <span class="n">July</span> <span class="mi">2014</span><span class="err">?</span>
<span class="n">var</span> <span class="n">result</span> <span class="o">=</span> <span class="n">getYear</span><span class="p">(</span><span class="n">new</span> <span class="n">Date</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="o">//=&gt;</span> <span class="mi">2014</span>
</pre></div>

<p>And babel would convert the imports to:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">_get_year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s2">"date-fns/get_year"</span><span class="p">);</span>

<span class="k">var</span><span class="w"> </span><span class="n">_get_year2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_interopRequireDefault</span><span class="p">(</span><span class="n">_get_year</span><span class="p">);</span>
</pre></div>

<p>And handle all references to the function accordingly.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/difference-between-return-and-exit-in-bash-functions/" class="u-url">Difference between return and exit in Bash functions</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/difference-between-return-and-exit-in-bash-functions/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T07:23:37+08:00" itemprop="datePublished" title="2023-02-18 07:23">2023-02-18 07:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What is the difference between the <code>return</code> and <code>exit</code> statement in Bash
functions with respect to exit codes?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>From <code>man bash</code> on <code>return [n]</code>;</p>
<blockquote>
<p>Causes a function to stop executing and return the value specified by n to
its caller. If n is omitted, the return status is that of the last command
executed in the function body.</p>
</blockquote>
<p>... on <code>exit [n]</code>:</p>
<blockquote>
<p>Cause the shell to exit with a status of n. If n is omitted, the exit status
is that of the last command executed. A trap on EXIT is executed before the
shell terminates.</p>
</blockquote>
<p><strong>EDIT:</strong></p>
<p>As per your edit of the question, regarding exit codes, <code>return</code> has nothing
to do with exit codes. Exit codes are intended for <strong>applications/scripts</strong> ,
not functions. So in this regard, the only keyword that sets the exit code of
the script (the one that can be caught by the calling program using the <code>$?</code>
shell variable) is <code>exit</code>.</p>
<p><strong>EDIT 2:</strong></p>
<p>My last statement referring <code>exit</code> is causing some comments. It was made to
differentiate <code>return</code> and <code>exit</code> for the understanding of the OP, and in
fact, at <em>any</em> given point of a program/shell script, <code>exit</code> is the only way
of ending the script with an exit code to the calling process.</p>
<p>Every command executed in the shell produces a local "exit code": it sets the
<code>$?</code> variable to that code, and can be used with <code>if</code>, <code>&amp;&amp;</code> and other
operators to conditionally execute other commands.</p>
<p>These exit codes (and the value of the <code>$?</code> variable) are reset by each
command execution.</p>
<p>Incidentally, the exit code of the last command executed by the script is used
as the exit code of the script itself as seen by the calling process.</p>
<p>Finally, functions, when called, act as shell commands with respect to exit
codes. The exit code of the function ( <em>within</em> the function) is set by using
<code>return</code>. So when in a function <code>return 0</code> is run, the function execution
terminates, giving an exit code of 0.</p>
<p><br></p>
<h3>Suggest</h3>
<p><code>return</code> will cause the current function to go out of scope, while <code>exit</code> will
cause the script to end at the point where it is called. Here is a sample
program to help explain this:</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><span class="ch">#!/bin/bash</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code>retfunc<span class="o">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code><span class="o">{</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"this is retfunc()"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code><span class="o">}</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code>exitfunc<span class="o">()</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-10"><code data-line-number="10"></code></a></td>
<td class="code"><code><span class="o">{</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-11"><code data-line-number="11"></code></a></td>
<td class="code"><code><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"this is exitfunc()"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-12"><code data-line-number="12"></code></a></td>
<td class="code"><code><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-13"><code data-line-number="13"></code></a></td>
<td class="code"><code><span class="o">}</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-14"><code data-line-number="14"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-15"><code data-line-number="15"></code></a></td>
<td class="code"><code>retfunc
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-16"><code data-line-number="16"></code></a></td>
<td class="code"><code><span class="nb">echo</span><span class="w"> </span><span class="s2">"We are still here"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-17"><code data-line-number="17"></code></a></td>
<td class="code"><code>exitfunc
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/difference-between-return-and-exit-in-bash-functions/#-18"><code data-line-number="18"></code></a></td>
<td class="code"><code><span class="nb">echo</span><span class="w"> </span><span class="s2">"We will never see this"</span>
</code></td>
</tr>
</table></div>
<h4>Output</h4>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>./test.sh
this<span class="w"> </span>is<span class="w"> </span>retfunc<span class="o">()</span>
We<span class="w"> </span>are<span class="w"> </span>still<span class="w"> </span>here
this<span class="w"> </span>is<span class="w"> </span>exitfunc<span class="o">()</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1354.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1352.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
