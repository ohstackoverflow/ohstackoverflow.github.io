<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2814) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2814.html">
<link rel="prev" href="index-2815.html" type="text/html">
<link rel="next" href="index-2813.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/possible-eventemitter-memory-leak-detected/" class="u-url">possible EventEmitter memory leak detected</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/possible-eventemitter-memory-leak-detected/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T19:56:02+08:00" itemprop="datePublished" title="2023-03-05 19:56">2023-03-05 19:56</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am getting following warning:</p>
<div class="code"><pre class="code literal-block">(node) warning: possible EventEmitter memory leak detected. 11 listeners added. Use emitter.setMaxListeners() to increase limit.
Trace: 
    at EventEmitter.&lt;anonymous&gt; (events.js:139:15)
    at EventEmitter.&lt;anonymous&gt; (node.js:385:29)
    at Server.&lt;anonymous&gt; (server.js:20:17)
    at Server.emit (events.js:70:17)
    at HTTPParser.onIncoming (http.js:1514:12)
    at HTTPParser.onHeadersComplete (http.js:102:31)
    at Socket.ondata (http.js:1410:22)
    at TCP.onread (net.js:354:27)
</pre></div>

<p>I wrote code like this in server.js:</p>
<div class="code"><pre class="code literal-block">http.createServer(
    function (req, res) { ... }).listen(3013);
</pre></div>

<p>How to fix this ?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This is explained in the node eventEmitter documentation</p>
<p>What version of Node is this? What other code do you have? That isn't normal
behavior.</p>
<p>In short, its: <code>process.setMaxListeners(0);</code></p>
<p>Also see: node.js - request - How to “emitter.setMaxListeners()”?</p>
<p><br></p>
<h3>Suggest</h3>
<p>This is explained in the node eventEmitter documentation</p>
<p>What version of Node is this? What other code do you have? That isn't normal
behavior.</p>
<p>In short, its: <code>process.setMaxListeners(0);</code></p>
<p>Also see: node.js - request - How to “emitter.setMaxListeners()”?</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-are-the-underlying-data-structures-used-for-redis/" class="u-url">What are the underlying data structures used for Redis?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-are-the-underlying-data-structures-used-for-redis/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T19:54:44+08:00" itemprop="datePublished" title="2023-03-05 19:54">2023-03-05 19:54</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to answer two questions in a definitive list:</p>
<ol>
<li>What are the underlying data structures used for Redis?</li>
<li>And what are the main advantages/disadvantages/use cases for each type?</li>
</ol>
<p>So, I've read the Redis lists are actually implemented with linked lists. But
for other types, I'm not able to dig up any information. Also, if someone were
to stumble upon this question and not have a high level summary of the pros
and cons of modifying or accessing different data structures, they'd have a
complete list of <strong>when to best use specific types</strong> to reference as well.</p>
<p>Specifically, I'm looking to outline all types: string, list, set, zset and
hash.</p>
<p>Oh, I've looked at these article, among others, so far:</p>
<ul>
<li>http://redis.io/topics/data-types</li>
<li>http://redis.io/topics/data-types-intro</li>
<li>http://redis.io/topics/faq</li>
</ul>
<p><br><br></p>
<h2>Answer</h2>
<p>I'll try to answer your question, but I'll start with something that may look
strange at first: if you are not interested in Redis internals you <strong>should
not care</strong> about how data types are implemented internally. This is for a
simple reason: for every Redis operation you'll find the time complexity in
the documentation and, if you have the set of operations and the time
complexity, the only other thing you need is some clue about memory usage (and
because we do many optimizations that may vary depending on data, the best way
to get these latter figures are doing a few trivial real world tests).</p>
<p>But since you asked, here is the underlying implementation of every Redis data
type.</p>
<ul>
<li>
<strong>Strings</strong> are implemented using a C dynamic string library so that we don't pay (asymptotically speaking) for allocations in append operations. This way we have O(N) appends, for instance, instead of having quadratic behavior.</li>
<li>
<strong>Lists</strong> are implemented with linked lists.</li>
<li>
<strong>Sets</strong> and <strong>Hashes</strong> are implemented with hash tables.</li>
<li>
<strong>Sorted sets</strong> are implemented with skip lists (a peculiar type of balanced trees).</li>
</ul>
<p>But when lists, sets, and sorted sets are small in number of items and size of
the largest values, a different, much more compact encoding is used. This
encoding differs for different types, but has the feature that it is a compact
blob of data that often forces an O(N) scan for every operation. Since we use
this format only for small objects this is not an issue; scanning a small O(N)
blob is <em>cache oblivious</em> so practically speaking it is very fast, and when
there are too many elements the encoding is automatically switched to the
native encoding (linked list, hash, and so forth).</p>
<p>But your question was not really just about internals, your point was <em>What
type to use to accomplish what?</em>.</p>
<h3>Strings</h3>
<p>This is the base type of all the types. It's one of the four types but is also
the base type of the complex types, because a List is a list of strings, a Set
is a set of strings, and so forth.</p>
<p>A Redis string is a good idea in all the obvious scenarios where you want to
store an HTML page, but also when you want to avoid converting your already
encoded data. So for instance, if you have JSON or MessagePack you may just
store objects as strings. In Redis 2.6 you can even manipulate this kind of
object server side using Lua scripts.</p>
<p>Another interesting usage of strings is bitmaps, and in general random access
arrays of bytes, since Redis exports commands to access random ranges of
bytes, or even single bits. For instance check this good blog post: Fast Easy
real time metrics using Redis.</p>
<h3>Lists</h3>
<p>Lists are good when you are likely to touch only the extremes of the list:
near tail, or near head. Lists are not very good to paginate stuff, because
random access is slow, O(N). So good uses of lists are plain queues and
stacks, or processing items in a loop using RPOPLPUSH with same source and
destination to "rotate" a ring of items.</p>
<p>Lists are also good when we want just to create a capped collection of N items
where <em>usually</em> we access just the top or bottom items, or when N is small.</p>
<h3>Sets</h3>
<p>Sets are an unordered data collection, so they are good every time you have a
collection of items and it is very important to check for existence or size of
the collection in a very fast way. Another cool thing about sets is support
for peeking or popping random elements (SRANDMEMBER and SPOP commands).</p>
<p>Sets are also good to represent relations, e.g., "What are friends of user X?"
and so forth. But other good data structures for this kind of stuff are sorted
sets as we'll see.</p>
<p>Sets support complex operations like intersections, unions, and so forth, so
this is a good data structure for using Redis in a "computational" manner,
when you have data and you want to perform transformations on that data to
obtain some output.</p>
<p>Small sets are encoded in a very efficient way.</p>
<h3>Hashes</h3>
<p>Hashes are the perfect data structure to represent objects, composed of fields
and values. Fields of hashes can also be atomically incremented using HINCRBY.
When you have objects such as users, blog posts, or some other kind of <em>item</em>
, hashes are likely the way to go if you don't want to use your own encoding
like JSON or similar.</p>
<p>However, keep in mind that small hashes are encoded very efficiently by Redis,
and you can ask Redis to atomically GET, SET or increment individual fields in
a very fast fashion.</p>
<p>Hashes can also be used to represent linked data structures, using references.
For instance check the lamernews.com implementation of comments.</p>
<h3>Sorted Sets</h3>
<p>Sorted sets are the <em>only other data structures, besides lists, to maintain
ordered elements</em>. You can do a number of cool stuff with sorted sets. For
instance, you can have all kinds of <strong>Top Something</strong> lists in your web
application. Top users by score, top posts by pageviews, top whatever, but a
single Redis instance will support tons of insertion and get-top-elements
operations per second.</p>
<p>Sorted sets, like regular sets, can be used to describe relations, but they
also allow you to paginate the list of items and to remember the ordering. For
instance, if I remember friends of user X with a sorted set I can easily
remember them in order of accepted friendship.</p>
<p>Sorted sets are good for priority queues.</p>
<p>Sorted sets are like more powerful lists where inserting, removing, or getting
ranges from the the middle of the list is always fast. But they use more
memory, and are O(log(N)) data structures.</p>
<h3>Conclusion</h3>
<p>I hope that I provided some info in this post, but it is far better to
download the source code of lamernews from http://github.com/antirez/lamernews
and understand how it works. Many data structures from Redis are used inside
Lamer News, and there are many clues about what to use to solve a given task.</p>
<p>Sorry for grammar typos, it's midnight here and too tired to review the post
;)</p>
<p><br></p>
<h3>Suggest</h3>
<p>Most of the time, you don't need to understand the underlying data structures
used by Redis. But a bit of knowledge helps you make CPU v/s Memory trade
offs. It also helps you model your data in an efficient manner.</p>
<p>Internally, Redis uses the following data structures :</p>
<ol>
<li>String</li>
<li>Dictionary</li>
<li>Doubly Linked List</li>
<li>Skip List</li>
<li>Zip List</li>
<li>Int Sets</li>
<li>Zip Maps (deprecated in favour of zip list since Redis 2.6)</li>
</ol>
<p>To find the encoding used by a particular key, use the command <code>object
encoding &lt;key&gt;</code>.</p>
<h3>1. Strings</h3>
<p>In Redis, Strings are called Simple Dynamic Strings, or SDS. It's a smallish
wrapper over a <code>char *</code> that allows you to store the length of the string and
number of free bytes as a prefix.</p>
<p>Because the length of the string is stored, strlen is an O(1) operation. Also,
because the length is known, Redis strings are binary safe. It is perfectly
legal for a string to contain the null character.</p>
<p>Strings are the most versatile data structure available in Redis. A String is
<em>all</em> of the following:</p>
<ol>
<li>A string of characters that can store text. See SET and GET commands.</li>
<li>A byte array that can store binary data.</li>
<li>A <code>long</code> that can store numbers. See INCR, DECR, INCRBY and DECRBY commands.</li>
<li>An Array (of <code>chars</code>, <code>ints</code>, <code>longs</code> or any other data type) that can allow efficient random access. See SETRANGE and GETRANGE commands.</li>
<li>A bit array that allows you to set or get individual bits. See SETBIT and GETBIT commands.</li>
<li>A block of memory that you can use to build other data structures. This is used internally to build ziplists and intsets, which are compact, memory-efficient data structures for small number of elements. More on this below.</li>
</ol>
<h3>2. Dictionary</h3>
<p>Redis uses a Dictionary for the following:</p>
<ol>
<li>To map a key to its associated value, where value can be a string, hash, set, sorted set or list.</li>
<li>To map a key to its expiry timestamp.</li>
<li>To implement Hash, Set and Sorted Set data types.</li>
<li>To map Redis commands to the functions that handle those commands.</li>
<li>To map a Redis key to a list of clients that are blocked on that key. See BLPOP.</li>
</ol>
<p>Redis Dictionaries are implemented using Hash Tables. Instead of explaining
the implementation, I will just explain the Redis specific things :</p>
<ol>
<li>Dictionaries use a structure called <code>dictType</code> to extend the behaviour of a hash table. This structure has function pointers, and so the following operations are extendable: a) hash function, b) key comparison, c) key destructor, and d) value destructor.</li>
<li>Dictionaries use the murmurhash2. (Previously they used the djb2 hash function, with seed=5381, but then the hash function was switched to murmur2. See this question for an explanation of the djb2 hash algorithm.)</li>
<li>Redis uses Incremental Hashing, also known as Incremental Resizing. The dictionary has two hash tables. Every time the dictionary is <em>touched</em> , one bucket is migrated from the first (smaller) hash table to the second. This way, Redis prevents an expensive resize operation.</li>
</ol>
<p>The <code>Set</code> data structure uses a Dictionary to guarantee there are no
duplicates. The <code>Sorted Set</code> uses a dictionary to map an element to its score,
which is why ZSCORE is an O(1) operation.</p>
<h3>3. Doubly Linked Lists</h3>
<p>The <code>list</code> data type is implemented using Doubly Linked Lists. Redis'
implementation is straight-from-the-algorithm-textbook. The only change is
that Redis stores the length in the list data structure. This ensures that
LLEN has O(1) complexity.</p>
<h3>4. Skip Lists</h3>
<p>Redis uses Skip Lists as the underlying data structure for Sorted Sets.
Wikipedia has a good introduction. William Pugh's paper Skip Lists: A
Probabilistic Alternative to Balanced Trees has more details.</p>
<p>Sorted Sets use both a Skip List and a Dictionary. The dictionary stores the
score of each element.</p>
<p>Redis' Skip List implementation is different from the standard implementation
in the following ways:</p>
<ol>
<li>Redis allows duplicate scores. If two nodes have the same score, they are sorted by the lexicographical order.</li>
<li>Each node has a back pointer at level 0. This allows you to traverse elements in reverse order of the score.</li>
</ol>
<h3>5. Zip List</h3>
<p>A Zip List is like a doubly linked list, except it does not use pointers and
stores the data inline.</p>
<p>Each node in a doubly linked list has at 3 pointers - one forward pointer, one
backward pointer and one pointer to reference the data stored at that node.
Pointers require memory (8 bytes on a 64 bit system), and so for small lists,
a doubly linked list is very inefficient.</p>
<p>A Zip List stores elements sequentially in a Redis String. Each element has a
small header that stores the length and data type of the element, the offset
to the next element and the offset to the previous element. These offsets
replace the forward and backward pointers. Since the data is stored inline, we
don't need a data pointer.</p>
<p>The Zip list is used to store small lists, sorted sets and hashes. Sorted sets
are flattened into a list like <code>[element1, score1, element2, score2, element3,
score3]</code> and stored in the Zip List. Hashes are flattened into a list like
<code>[key1, value1, key2, value2]</code> etc.</p>
<p>With Zip Lists you have the power to make a tradeoff between CPU and Memory.
Zip Lists are memory-efficient, but they use more CPU than a linked list (or
Hash table/Skip List). Finding an element in the zip list is O(n). Inserting a
new element requires reallocating memory. Because of this, Redis uses this
encoding only for small lists, hashes and sorted sets. You can tweak this
behaviour by altering the values of <code>&lt;datatype&gt;-max-ziplist-entries</code> and
<code>&lt;datatype&gt;-max-ziplist-value&gt;</code> in redis.conf. See Redis Memory Optimization,
section "Special encoding of small aggregate data types" for more information.</p>
<p>The comments on ziplist.c are excellent, and you can understand this data
structure completely without having to read the code.</p>
<h3>6. Int Sets</h3>
<p>Int Sets are a fancy name for "Sorted Integer Arrays".</p>
<p>In Redis, sets are usually implemented using hash tables. For small sets, a
hash table is inefficient memory wise. When the set is composed of integers
only, an array is often more efficient.</p>
<p>An Int Set is a sorted array of integers. To find an element a binary search
algorithm is used. This has a complexity of O(log N). Adding new integers to
this array may require a memory reallocation, which can become expensive for
large integer arrays.</p>
<p>As a further memory optimization, Int Sets come in 3 variants with different
integer sizes: 16 bits, 32 bits and 64 bits. Redis is smart enough to use the
right variant depending on the size of the elements. When a new element is
added and it exceeds the current size, Redis automatically migrates it to the
next size. If a string is added, Redis automatically converts the Int Set to a
regular Hash Table based set.</p>
<p>Int Sets are a tradeoff between CPU and Memory. Int Sets are extremely memory
efficient, and for small sets they are faster than a hash table. But after a
certain number of elements, the O(log N) retrieval time and the cost of
reallocating memory become too much. Based on experiments, the optimal
threshold to switch over to a regular hash table was found to be 512. However,
you can increase this threshold (decreasing it doesn't make sense) based on
your application's needs. See <code>set-max-intset-entries</code> in redis.conf.</p>
<h3>7. Zip Maps</h3>
<p>Zip Maps are dictionaries flattened and stored in a list. They are very
similar to Zip Lists.</p>
<p>Zip Maps have been deprecated since Redis 2.6, and small hashes are stored in
Zip Lists. To learn more about this encoding, refer to the comments in
zipmap.c.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ienumerable-and-recursion-using-yield-return/" class="u-url">IEnumerable and Recursion using yield return</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ienumerable-and-recursion-using-yield-return/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T19:53:24+08:00" itemprop="datePublished" title="2023-03-05 19:53">2023-03-05 19:53</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have an <code>IEnumerable&lt;T&gt;</code> method that I'm using to find controls in a
WebForms page.</p>
<p>The method is recursive and I'm having some problems returning the type I want
when the <code>yield return</code> is returnig the value of the recursive call.</p>
<p>My code looks as follows:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">IEnumerable</span><span class="o">&lt;</span><span class="nv">Control</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">GetDeepControlsByType</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">(</span><span class="nv">this</span><span class="w"> </span><span class="nv">Control</span><span class="w"> </span><span class="nv">control</span><span class="ss">)</span>
{
<span class="w">    </span><span class="nv">foreach</span><span class="ss">(</span><span class="nv">Control</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">control</span>.<span class="nv">Controls</span><span class="ss">)</span>
<span class="w">    </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">c</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">T</span><span class="ss">)</span>
<span class="w">        </span>{
<span class="w">            </span><span class="nv">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">c</span><span class="c1">;</span>
<span class="w">        </span>}

<span class="w">        </span><span class="k">if</span><span class="ss">(</span><span class="nv">c</span>.<span class="nv">Controls</span>.<span class="nv">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span>
<span class="w">        </span>{
<span class="w">            </span><span class="nv">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">c</span>.<span class="nv">GetDeepControlsByType</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">    </span>}
}
</pre></div>

<p>This currently throws a "Cannot convert expression type" error. If however
this method returns type <code>IEnumerable&lt;Object&gt;</code>, the code builds, but the wrong
type is returned in the output.</p>
<p>Is there a way of using <code>yield return</code> whilst also using recursion?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Inside a method that returns <code>IEnumerable&lt;T&gt;</code>, <code>yield return</code> has to return
<code>T</code>, not an <code>IEnumerable&lt;T&gt;</code>.</p>
<p>Replace</p>
<div class="code"><pre class="code literal-block"><span class="nv">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">c</span>.<span class="nv">GetDeepControlsByType</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>
</pre></div>

<p>with:</p>
<div class="code"><pre class="code literal-block"><span class="n">foreach</span><span class="w"> </span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">GetDeepControlsByType</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">())</span>
<span class="p">{</span>
<span class="w">  </span><span class="nb">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You need to yield <em>each of the items</em> yielded by the recursive call:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">IEnumerable</span><span class="o">&lt;</span><span class="nv">Control</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">GetDeepControlsByType</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">(</span><span class="nv">this</span><span class="w"> </span><span class="nv">Control</span><span class="w"> </span><span class="nv">control</span><span class="ss">)</span>
{
<span class="w">    </span><span class="nv">foreach</span><span class="ss">(</span><span class="nv">Control</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">control</span>.<span class="nv">Controls</span><span class="ss">)</span>
<span class="w">    </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">c</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">T</span><span class="ss">)</span>
<span class="w">        </span>{
<span class="w">            </span><span class="nv">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">c</span><span class="c1">;</span>
<span class="w">        </span>}

<span class="w">        </span><span class="k">if</span><span class="ss">(</span><span class="nv">c</span>.<span class="nv">Controls</span>.<span class="nv">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span>
<span class="w">        </span>{
<span class="w">            </span><span class="nv">foreach</span><span class="w"> </span><span class="ss">(</span><span class="nv">Control</span><span class="w"> </span><span class="nv">control</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">c</span>.<span class="nv">GetDeepControlsByType</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">())</span>
<span class="w">            </span>{
<span class="w">                </span><span class="nv">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">control</span><span class="c1">;</span>
<span class="w">            </span>}
<span class="w">        </span>}
<span class="w">    </span>}
}
</pre></div>

<p>Note that there's a cost to recursing in this way - you'll end up creating a
lot of iterators, which can create a performance issue if you have a really
deep control tree. If you want to avoid that, you basically need to do the
recursion yourself within the method, to make sure there's only one iterator
(state machine) created. See this question for more details and a sample
implementation - but this obviously adds a certain amount of complexity too.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2815.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2813.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
