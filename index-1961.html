<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1961) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1961.html">
<link rel="prev" href="index-1962.html" type="text/html">
<link rel="next" href="index-1960.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/resolving-msb3247-found-conflicts-between-different-versions-of-the-same-dependent-assembly/" class="u-url">Resolving MSB3247 - Found conflicts between different versions of the same dependent assembly</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/resolving-msb3247-found-conflicts-between-different-versions-of-the-same-dependent-assembly/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T13:31:05+08:00" itemprop="datePublished" title="2023-03-03 13:31">2023-03-03 13:31</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>A .NET 3.5 solution ended up with this warning when compiling with msbuild.</p>
<p>Sometimes NDepend might help out but in this case it didn't give any further
details. Like Bob I ended up having to resort to opening each assembly in
ILDASM until I found the one that was referencing an older version of the
dependant assembly.</p>
<p>I did try using MSBUILD from VS 2010 Beta 2 (as the Connect article indicated
this was fixed in the next version of the CLR) but that didn't provide any
more detail either (maybe fixed post Beta 2)</p>
<p>Is there a better (more automated) approach?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Change the "MSBuild project build output verbosity" to "Detailed" or above. To
do this, follow these steps:</p>
<ol>
<li>Bring up the Options dialog ( <strong>Tools - &gt; Options...</strong>).</li>
<li>In the left-hand tree, select the <strong>Projects and Solutions</strong> node, and then select <strong>Build and Run</strong>. <ul>
<li>Note: if this node doesn't show up, make sure that the checkbox at the bottom of the dialog <strong>Show all settings</strong> is checked.</li>
</ul>
</li>
<li>
<p>In the tools/options page that appears, set the <strong>MSBuild project build output verbosity</strong> level to the appropriate setting depending on your version:</p>
<ul>
<li>
<strong>Diagnostics</strong> when on VS2012, VS2013 or VS2015 (the message in these versions <em>says</em> you should use "Detailed", but this is plain wrong, you should use "Diagnostics")</li>
<li>
<strong>Detailed</strong> when you're on VS2010</li>
<li>
<strong>Normal</strong> will suffice in VS2008 or older.</li>
<li>Build the project and look in the output window. </li>
</ul>
</li>
</ol>
<p>Check out the MSBuild messages. The <code>ResolveAssemblyReferences</code> task, which is
the task from which MSB3247 originates, should help you debug this particular
issue.</p>
<p>My specific case was an incorrect reference to SqlServerCe. See below. I had
two projects referencing two different versions of SqlServerCe. I went to the
project with the older version, removed the reference, then added the correct
reference.</p>
<div class="code"><pre class="code literal-block">Target ResolveAssemblyReferences:
    Consider app.config remapping of assembly "System.Data.SqlServerCe, ..." 
        from Version "3.5.1.0" [H:\...\Debug\System.Data.SqlServerCe.dll] 
        to Version "9.0.242.0" [C:\Program Files\Microsoft Visual Studio 8\Common7\IDE\PublicAssemblies\System.Data.SqlServerCe.dll]
        to solve conflict and get rid of warning.
    C:\WINDOWS\Microsoft.NET\Framework\v3.5\Microsoft.Common.targets : 
        warning MSB3247: Found conflicts between different versions of the same dependent assembly.
</pre></div>

<hr>
<p>You do not have to open each assembly to determine the versions of referenced
assemblies.</p>
<ul>
<li>You can check the Properties of each Reference.</li>
<li>Open the project properties and check the versions of the References section.</li>
<li>Open the projects with a Text Editor.</li>
<li>Use .Net Reflector.</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>Mike Hadlow has posted a little console app called AsmSpy that rather nicely
lists each assembly's references:</p>
<div class="code"><pre class="code literal-block"><span class="n">Reference</span><span class="o">:</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="na">Net</span><span class="o">.</span><span class="na">Http</span><span class="o">.</span><span class="na">Formatting</span>
<span class="w">        </span><span class="mf">4.0</span><span class="o">.</span><span class="mf">0.0</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">Shared</span><span class="o">.</span><span class="na">MessageStack</span>
<span class="w">        </span><span class="mf">4.0</span><span class="o">.</span><span class="mf">0.0</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="na">Web</span><span class="o">.</span><span class="na">Http</span>

<span class="n">Reference</span><span class="o">:</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="na">Net</span><span class="o">.</span><span class="na">Http</span>
<span class="w">        </span><span class="mf">2.0</span><span class="o">.</span><span class="mf">0.0</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">Shared</span><span class="o">.</span><span class="na">MessageStack</span>
<span class="w">        </span><span class="mf">2.0</span><span class="o">.</span><span class="mf">0.0</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="na">Net</span><span class="o">.</span><span class="na">Http</span><span class="o">.</span><span class="na">Formatting</span>
<span class="w">        </span><span class="mf">4.0</span><span class="o">.</span><span class="mf">0.0</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="na">Net</span><span class="o">.</span><span class="na">Http</span><span class="o">.</span><span class="na">WebRequest</span>
<span class="w">        </span><span class="mf">2.0</span><span class="o">.</span><span class="mf">0.0</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="na">Web</span><span class="o">.</span><span class="na">Http</span><span class="o">.</span><span class="na">Common</span>
<span class="w">        </span><span class="mf">2.0</span><span class="o">.</span><span class="mf">0.0</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="na">Web</span><span class="o">.</span><span class="na">Http</span>
<span class="w">        </span><span class="mf">2.0</span><span class="o">.</span><span class="mf">0.0</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="na">Web</span><span class="o">.</span><span class="na">Http</span><span class="o">.</span><span class="na">WebHost</span>
</pre></div>

<p>This is a much quicker way to get to the bottom of the warning MSB3247, than
to depend on the MSBuild output.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-make-calls-to-a-rest-api-using-c/" class="u-url">How do I make calls to a REST API using C#?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-make-calls-to-a-rest-api-using-c/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T13:30:38+08:00" itemprop="datePublished" title="2023-03-03 13:30">2023-03-03 13:30</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>This is the code I have so far:</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">Class1</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">private</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"https://sub.domain.com/objects.json?api_key=123"</span><span class="p">;</span>
<span class="w">        </span><span class="n">private</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">DATA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@"{""object"":{""name"":""Name""}}"</span><span class="p">;</span>

<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">(</span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Class1</span><span class="p">.</span><span class="n">CreateObject</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateObject</span><span class="p">()</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">HttpWebRequest</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">HttpWebRequest</span><span class="p">)</span><span class="n">WebRequest</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">URL</span><span class="p">);</span>
<span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="n">Method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"POST"</span><span class="p">;</span>
<span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="n">ContentType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"application/json"</span><span class="p">;</span>
<span class="w">            </span><span class="n">request</span><span class="p">.</span><span class="n">ContentLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DATA</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
<span class="w">            </span><span class="n">StreamWriter</span><span class="w"> </span><span class="n">requestWriter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">StreamWriter</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">GetRequestStream</span><span class="p">(),</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">ASCII</span><span class="p">);</span>
<span class="w">            </span><span class="n">requestWriter</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">DATA</span><span class="p">);</span>
<span class="w">            </span><span class="n">requestWriter</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>

<span class="w">             </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">WebResponse</span><span class="w"> </span><span class="n">webResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">GetResponse</span><span class="p">();</span>
<span class="w">                </span><span class="n">Stream</span><span class="w"> </span><span class="n">webStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">webResponse</span><span class="p">.</span><span class="n">GetResponseStream</span><span class="p">();</span>
<span class="w">                </span><span class="n">StreamReader</span><span class="w"> </span><span class="n">responseReader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">StreamReader</span><span class="p">(</span><span class="n">webStream</span><span class="p">);</span>
<span class="w">                </span><span class="n">string</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">responseReader</span><span class="p">.</span><span class="n">ReadToEnd</span><span class="p">();</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">Out</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
<span class="w">                </span><span class="n">responseReader</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">Out</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"-----------------"</span><span class="p">);</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">Out</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>

<p>The problem is that I think the exception block is being triggered (because
when I remove the try-catch, I get a server error (500) message. But I don't
see the Console.Out lines I put in the catch block.</p>
<p>My Console:</p>
<div class="code"><pre class="code literal-block"><span class="n">The</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="s1">'vshost.NotifyLoad'</span><span class="w"> </span><span class="p">(</span><span class="mh">0x1a20</span><span class="p">)</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span><span class="o">.</span>
<span class="n">The</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="s1">'&lt;No Name&gt;'</span><span class="w"> </span><span class="p">(</span><span class="mh">0x1988</span><span class="p">)</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span><span class="o">.</span>
<span class="n">The</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="s1">'vshost.LoadReference'</span><span class="w"> </span><span class="p">(</span><span class="mh">0x1710</span><span class="p">)</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span><span class="o">.</span>
<span class="s1">'ConsoleApplication1.vshost.exe'</span><span class="w"> </span><span class="p">(</span><span class="n">Managed</span><span class="w"> </span><span class="p">(</span><span class="n">v4</span><span class="o">.</span><span class="mf">0.30319</span><span class="p">)):</span><span class="w"> </span><span class="n">Loaded</span><span class="w"> </span><span class="s1">'c:\users\l. preston sego iii\documents</span><span class="se">\v</span><span class="s1">isual studio 11\Projects\ConsoleApplication1\ConsoleApplication1</span><span class="se">\b</span><span class="s1">in\Debug\ConsoleApplication1.exe'</span><span class="p">,</span><span class="w"> </span><span class="n">Symbols</span><span class="w"> </span><span class="n">loaded</span><span class="o">.</span>
<span class="s1">'ConsoleApplication1.vshost.exe'</span><span class="w"> </span><span class="p">(</span><span class="n">Managed</span><span class="w"> </span><span class="p">(</span><span class="n">v4</span><span class="o">.</span><span class="mf">0.30319</span><span class="p">)):</span><span class="w"> </span><span class="n">Loaded</span><span class="w"> </span><span class="s1">'C:\Windows\Microsoft.Net</span><span class="se">\a</span><span class="s1">ssembly\GAC_MSIL\System.Configuration</span><span class="se">\v</span><span class="s1">4.0_4.0.0.0__b03f5f7f11d50a3a\System.Configuration.dll'</span><span class="p">,</span><span class="w"> </span><span class="n">Skipped</span><span class="w"> </span><span class="n">loading</span><span class="w"> </span><span class="n">symbols</span><span class="o">.</span><span class="w"> </span><span class="n">Module</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">optimized</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">debugger</span><span class="w"> </span><span class="n">option</span><span class="w"> </span><span class="s1">'Just My Code'</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">enabled</span><span class="o">.</span>
<span class="n">A</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">chance</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="s1">'System.Net.WebException'</span><span class="w"> </span><span class="n">occurred</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">dll</span>
<span class="n">The</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="s1">'vshost.RunParkingWindow'</span><span class="w"> </span><span class="p">(</span><span class="mh">0x184c</span><span class="p">)</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span><span class="o">.</span>
<span class="n">The</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="s1">'&lt;No Name&gt;'</span><span class="w"> </span><span class="p">(</span><span class="mh">0x1810</span><span class="p">)</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span><span class="o">.</span>
<span class="n">The</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="s1">'[2780] ConsoleApplication1.vshost.exe: Program Trace'</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span><span class="o">.</span>
<span class="n">The</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="s1">'[2780] ConsoleApplication1.vshost.exe: Managed (v4.0.30319)'</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">exited</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="mh">0x0</span><span class="p">)</span><span class="o">.</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>The ASP.NET Web API has replaced the WCF Web API previously mentioned.</p>
<p>I thought I'd post an updated answer since most of these responses are from
early 2012, and this thread is one of the top results when doing a Google
search for "call restful service C#".</p>
<p>Current guidance from Microsoft is to use the Microsoft ASP.NET Web API Client
Libraries to consume a RESTful service. This is available as a NuGet package,
Microsoft.AspNet.WebApi.Client. You will need to add this NuGet package to
your solution.</p>
<p>Here's how your example would look when implemented using the ASP.NET Web API
Client Library:</p>
<div class="code"><pre class="code literal-block"><span class="n">using</span><span class="w"> </span><span class="n">System</span><span class="p">;</span>
<span class="n">using</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Collections</span><span class="o">.</span><span class="n">Generic</span><span class="p">;</span>
<span class="n">using</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Net</span><span class="o">.</span><span class="n">Http</span><span class="p">;</span>
<span class="n">using</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Net</span><span class="o">.</span><span class="n">Http</span><span class="o">.</span><span class="n">Headers</span><span class="p">;</span>

<span class="n">namespace</span><span class="w"> </span><span class="n">ConsoleProgram</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">DataObject</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">get</span><span class="p">;</span><span class="w"> </span><span class="n">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">Class1</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">private</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://sub.domain.com/objects.json"</span><span class="p">;</span>
<span class="w">        </span><span class="n">private</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">urlParameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"?api_key=123"</span><span class="p">;</span>

<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">Main</span><span class="p">(</span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">HttpClient</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">HttpClient</span><span class="p">();</span>
<span class="w">            </span><span class="n">client</span><span class="o">.</span><span class="n">BaseAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Uri</span><span class="p">(</span><span class="n">URL</span><span class="p">);</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">Accept</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="n">format</span><span class="o">.</span>
<span class="w">            </span><span class="n">client</span><span class="o">.</span><span class="n">DefaultRequestHeaders</span><span class="o">.</span><span class="n">Accept</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
<span class="w">            </span><span class="n">new</span><span class="w"> </span><span class="n">MediaTypeWithQualityHeaderValue</span><span class="p">(</span><span class="s2">"application/json"</span><span class="p">));</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">response</span><span class="o">.</span>
<span class="w">            </span><span class="n">HttpResponseMessage</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">GetAsync</span><span class="p">(</span><span class="n">urlParameters</span><span class="p">)</span><span class="o">.</span><span class="n">Result</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">Blocking</span><span class="w"> </span><span class="n">call</span><span class="o">!</span><span class="w"> </span><span class="n">Program</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">wait</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">received</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="n">occurs</span><span class="o">.</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">IsSuccessStatusCode</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">Parse</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="n">body</span><span class="o">.</span>
<span class="w">                </span><span class="k">var</span><span class="w"> </span><span class="n">dataObjects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="o">.</span><span class="n">Content</span><span class="o">.</span><span class="n">ReadAsAsync</span><span class="o">&lt;</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">DataObject</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="o">.</span><span class="n">Result</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="n">Make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Net</span><span class="o">.</span><span class="n">Http</span><span class="o">.</span><span class="n">Formatting</span><span class="o">.</span><span class="n">dll</span>
<span class="w">                </span><span class="n">foreach</span><span class="w"> </span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">dataObjects</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Console</span><span class="o">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s2">"{0}"</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="o">.</span><span class="n">Name</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">else</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Console</span><span class="o">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s2">"{0} ({1})"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">int</span><span class="p">)</span><span class="n">response</span><span class="o">.</span><span class="n">StatusCode</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="o">.</span><span class="n">ReasonPhrase</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="n">here</span><span class="o">.</span>

<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">Dispose</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="n">calls</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">complete</span><span class="o">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">necessary</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">containing</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">disposed</span><span class="w"> </span><span class="n">of</span><span class="p">;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">case</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">HttpClient</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">disposed</span><span class="w"> </span><span class="n">automatically</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="n">terminates</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">superfluous</span><span class="o">.</span>
<span class="w">            </span><span class="n">client</span><span class="o">.</span><span class="n">Dispose</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If you plan on making multiple requests, you should re-use your HttpClient
instance. See this question and its answers for more details on why a using
statement was not used on the HttpClient instance in this case: <em>Do HttpClient
and HttpClientHandler have to be disposed between requests?</em></p>
<p>For more details, including other examples, see <em>Call a Web API From a .NET
Client (C#)</em></p>
<p>This blog post may also be useful: <em>Using HttpClient to Consume ASP.NET Web
API REST Services</em></p>
<p><br></p>
<h3>Suggest</h3>
<p>My suggestion would be to use RestSharp. You can make calls to REST services
and have them cast into POCO objects with very little boilerplate code to
actually have to parse through the response. This will not solve your
particular error, but it answers your overall question of how to make calls to
REST services. Having to change your code to use it should pay off in the ease
of use and robustness moving forward. That is just my two cents though.</p>
<p>Example:</p>
<div class="code"><pre class="code literal-block"><span class="nt">namespace</span><span class="w"> </span><span class="nt">RestSharpThingy</span>
<span class="p">{</span>
<span class="w">    </span><span class="err">using</span><span class="w"> </span><span class="err">System</span><span class="p">;</span>
<span class="w">    </span><span class="err">using</span><span class="w"> </span><span class="err">System.Collections.Generic</span><span class="p">;</span>
<span class="w">    </span><span class="err">using</span><span class="w"> </span><span class="err">System.IO</span><span class="p">;</span>
<span class="w">    </span><span class="err">using</span><span class="w"> </span><span class="err">System.Linq</span><span class="p">;</span>
<span class="w">    </span><span class="err">using</span><span class="w"> </span><span class="err">System.Net</span><span class="p">;</span>
<span class="w">    </span><span class="err">using</span><span class="w"> </span><span class="err">System.Reflection</span><span class="p">;</span>
<span class="w">    </span><span class="err">using</span><span class="w"> </span><span class="err">RestSharp</span><span class="p">;</span>

<span class="w">    </span><span class="err">public</span><span class="w"> </span><span class="err">static</span><span class="w"> </span><span class="err">class</span><span class="w"> </span><span class="err">Program</span>
<span class="w">    </span><span class="err">{</span>
<span class="w">        </span><span class="err">public</span><span class="w"> </span><span class="err">static</span><span class="w"> </span><span class="err">void</span><span class="w"> </span><span class="err">Main()</span>
<span class="w">        </span><span class="err">{</span>
<span class="w">            </span><span class="err">Uri</span><span class="w"> </span><span class="err">baseUrl</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">Uri("</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">httpbin</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="s2">");</span>
<span class="s2">            IRestClient client = new RestClient(baseUrl);</span>
<span class="s2">            IRestRequest request = new RestRequest("</span><span class="n">get</span><span class="s2">", Method.GET) { Credentials = new NetworkCredential("</span><span class="n">testUser</span><span class="s2">", "</span><span class="n">P455w0rd</span><span class="s2">") };</span>

<span class="s2">            request.AddHeader("</span><span class="n">Authorization</span><span class="s2">", "</span><span class="n">Bearer</span><span class="w"> </span><span class="n">qaPmk9Vw8o7r7UOiX-3b-8Z_6r3w0Iu2pecwJ3x7CngjPp2fN3c61Q_5VU3y0rc-vPpkTKuaOI2eRs3bMyA5ucKKzY1thMFoM0wjnReEYeMGyq3JfZ-OIko1if3NmIj79ZSpNotLL2734ts2jGBjw8-uUgKet7jQAaq-qf5aIDwzUo0bnGosEj_UkFxiJKXPPlF2L4iNJSlBqRYrhw08RK1SzB4tf18Airb80WVy1Kewx2NGq5zCC-SCzvJW-mlOtjIDBAQ5intqaRkwRaSyjJ_MagxJF_CLc4BNUYC3hC2ejQDoTE6HYMWMcg0mbyWghMFpOw3gqyfAGjr6LPJcIly__aJ5__iyt-BTkOnMpDAZLTjzx4qDHMPWeND-TlzKWXjVb5yMv5Q6Jg6UmETWbuxyTdvGTJFzanUg1HWzPr7gSs6GLEv9VDTMiC8a5sNcGyLcHBIJo8mErrZrIssHvbT8ZUPWtyJaujKvdgazqsrad9CO3iRsZWQJ3lpvdQwucCsyjoRVoj_mXYhz3JK3wfOjLff16Gy1NLbj4gmOhBBRb8rJnUXnP7rBHs00FAk59BIpKLIPIyMgYBApDCut8V55AgXtGs4MgFFiJKbuaKxq8cdMYEVBTzDJ-S1IR5d6eiTGusD5aFlUkAs9NV_nFw</span><span class="s2">");</span>
<span class="s2">            request.AddParameter("</span><span class="n">clientId</span><span class="s2">", 123);</span>

<span class="s2">            IRestResponse&lt;RootObject&gt; response = client.Execute&lt;RootObject&gt;(request);</span>

<span class="s2">            if (response.IsSuccessful)</span>
<span class="s2">            {</span>
<span class="s2">                response.Data.Write();</span>
<span class="s2">            }</span>
<span class="s2">            else</span>
<span class="s2">            {</span>
<span class="s2">                Console.WriteLine(response.ErrorMessage);</span>
<span class="s2">            }</span>

<span class="s2">            Console.WriteLine();</span>

<span class="s2">            string path = Assembly.GetExecutingAssembly().Location;</span>
<span class="s2">            string name = Path.GetFileName(path);</span>

<span class="s2">            request = new RestRequest("</span><span class="n">post</span><span class="s2">", Method.POST);</span>
<span class="s2">            request.AddFile(name, File.ReadAllBytes(path), name, "</span><span class="n">application</span><span class="o">/</span><span class="n">octet-stream</span><span class="s2">");</span>
<span class="s2">            response = client.Execute&lt;RootObject&gt;(request);</span>
<span class="s2">            if (response.IsSuccessful)</span>
<span class="s2">            {</span>
<span class="s2">                response.Data.Write();</span>
<span class="s2">            }</span>
<span class="s2">            else</span>
<span class="s2">            {</span>
<span class="s2">                Console.WriteLine(response.ErrorMessage);</span>
<span class="s2">            }</span>

<span class="s2">            Console.ReadLine();</span>
<span class="s2">        }</span>

<span class="s2">        private static void Write(this RootObject rootObject)</span>
<span class="s2">        {</span>
<span class="s2">            Console.WriteLine("</span><span class="n">clientId</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.args.clientId);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">Accept</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.headers.Accept);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">AcceptEncoding</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.headers.AcceptEncoding);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">AcceptLanguage</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.headers.AcceptLanguage);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">Authorization</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.headers.Authorization);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">Connection</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.headers.Connection);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">Dnt</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.headers.Dnt);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">Host</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.headers.Host);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">Origin</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.headers.Origin);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">Referer</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.headers.Referer);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">UserAgent</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.headers.UserAgent);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">origin</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.origin);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">url</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.url);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">data</span><span class="o">:</span><span class="w"> </span><span class="s2">" + rootObject.data);</span>
<span class="s2">            Console.WriteLine("</span><span class="n">files</span><span class="o">:</span><span class="w"> </span><span class="s2">");</span>
<span class="s2">            foreach (KeyValuePair&lt;string, string&gt; kvp in rootObject.files ?? Enumerable.Empty&lt;KeyValuePair&lt;string, string&gt;&gt;())</span>
<span class="s2">            {</span>
<span class="s2">                Console.WriteLine("</span><span class="err">\</span><span class="n">t</span><span class="s2">" + kvp.Key + "</span><span class="o">:</span><span class="w"> </span><span class="err">"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">kvp</span><span class="o">.</span><span class="n">Value</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nt">public</span><span class="w"> </span><span class="nt">class</span><span class="w"> </span><span class="nt">Args</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="err">public</span><span class="w"> </span><span class="err">string</span><span class="w"> </span><span class="err">ClientId</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nt">public</span><span class="w"> </span><span class="nt">class</span><span class="w"> </span><span class="nt">Headers</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="err">public</span><span class="w"> </span><span class="err">string</span><span class="w"> </span><span class="err">Accept</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">AcceptEncoding</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">AcceptLanguage</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">Authorization</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">Connection</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">Dnt</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">Host</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">Origin</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">Referer</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">UserAgent</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nt">public</span><span class="w"> </span><span class="nt">class</span><span class="w"> </span><span class="nt">RootObject</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="err">public</span><span class="w"> </span><span class="err">Args</span><span class="w"> </span><span class="err">args</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">Headers</span><span class="w"> </span><span class="nt">Headers</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">Origin</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">Url</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">Data</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">        </span><span class="nt">public</span><span class="w"> </span><span class="nt">Dictionary</span><span class="o">&lt;</span><span class="nt">string</span><span class="o">,</span><span class="w"> </span><span class="nt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">Files</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/select-into-a-table-variable-in-t-sql/" class="u-url">SELECT INTO a table variable in T-SQL</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/select-into-a-table-variable-in-t-sql/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T13:30:13+08:00" itemprop="datePublished" title="2023-03-03 13:30">2023-03-03 13:30</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Got a complex SELECT query, from which I would like to insert all rows into a
table variable, but T-SQL doesn't allow it.</p>
<blockquote>
<p>Along the same lines, you cannot use a table variable with SELECT INTO or
INSERT EXEC queries. http://odetocode.com/Articles/365.aspx</p>
</blockquote>
<p>Short example:</p>
<div class="code"><pre class="code literal-block"><span class="k">declare</span><span class="w"> </span><span class="nv">@userData</span><span class="w"> </span><span class="nc">TABLE</span><span class="p">(</span>
<span class="w">                        </span><span class="n">name</span><span class="w"> </span><span class="nc">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">                        </span><span class="n">oldlocation</span><span class="w"> </span><span class="nc">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="w">                       </span><span class="p">)</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">location</span>
<span class="k">INTO</span><span class="w"> </span><span class="nv">@userData</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">myTable</span>
<span class="w">    </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">otherTable</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">...</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">30</span>
</pre></div>

<p>The data in the table variable would be later used to insert/update it back
into different tables (mostly copy of the same data with minor updates). The
goal of this would be to simply make the script a bit more readable and more
easily customisable than doing the <code>SELECT INTO</code> directly into the right
tables. Performance is not an issue, as the <code>rowcount</code> is fairly small and
it's only manually run when needed.<br>
...or just tell me if I'm doing it all wrong.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Try something like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">DECLARE</span><span class="w"> </span><span class="nv">@userData</span><span class="w"> </span><span class="nc">TABLE</span><span class="p">(</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nc">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">oldlocation</span><span class="w"> </span><span class="nc">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">@userData</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">oldlocation</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">myTable</span>
<span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">otherTable</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="p">...</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>The purpose of <code>SELECT INTO</code> is (per the docs, my emphasis)</p>
<blockquote>
<p>To <strong>create</strong> a new table from values in another table</p>
</blockquote>
<p>But you already <em>have</em> a target table! So what you want is</p>
<blockquote>
<p>The <code>INSERT</code> statement adds one or more new rows to a table</p>
<p>You can specify the data values in the following ways:</p>
<p>...</p>
<p>By using a <code>SELECT</code> subquery to specify the data values for one or more
rows, such as:</p>
<div class="code"><pre class="code literal-block">  INSERT INTO MyTable
 (PriKey, Description)
        SELECT ForeignKey, Description
        FROM SomeView
</pre></div>

</blockquote>
<p>And in <em>this</em> syntax, it's allowed for <code>MyTable</code> to be a table variable.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1962.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1960.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
