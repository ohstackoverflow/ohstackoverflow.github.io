<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1492) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1492.html">
<link rel="prev" href="index-1493.html" type="text/html">
<link rel="next" href="index-1491.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/error-initializing-the-network-channel-from-node-sdk-in-hyperledger-fabric/" class="u-url">Error initializing the network channel from node sdk in hyperledger fabric</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/error-initializing-the-network-channel-from-node-sdk-in-hyperledger-fabric/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T05:11:16+08:00" itemprop="datePublished" title="2023-02-28 05:11">2023-02-28 05:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><strong>Background:</strong> I have modified the first-network files (to a network with 2
Orgs and 1 peer in each of them) and installed my own chaincode on it.
Additionally I have made a connection.yaml file to interact with the network.</p>
<p><strong>Problem:</strong> But when I try to get the network channel &amp; establish the gateway
from nodeSDK, I encounter this error:</p>
<blockquote>
<p>error: [Network]: _initializeInternalChannel: Unable to initialize channel.
Attempted to contact 2 Peers. Last error was Error: 2 UNKNOWN: Stream
removed</p>
<p>Failed to evaluate transaction: Error: Unable to initialize channel.
Attempted to contact 2 Peers. Last error was Error: 2 UNKNOWN: Stream
removed</p>
</blockquote>
<p>Below you can find the code on my client side. The error probably arises when
<code>gateway.getNetwork('mychannel')</code> is executed.</p>
<div class="code"><pre class="code literal-block"><span class="n">let</span><span class="w"> </span><span class="n">connectionProfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yaml</span><span class="o">.</span><span class="n">safeLoad</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="s1">'./connection.yaml'</span><span class="p">,</span><span class="w"> </span><span class="s1">'utf8'</span><span class="p">));</span>
<span class="o">//</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">gateway</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">connecting</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">peer</span><span class="w"> </span><span class="n">node</span><span class="o">.</span>
<span class="k">const</span><span class="w"> </span><span class="n">gateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Gateway</span><span class="p">();</span>
<span class="n">await</span><span class="w"> </span><span class="n">gateway</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">connectionProfile</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">wallet</span><span class="p">,</span><span class="w"> </span><span class="n">identity</span><span class="p">:</span><span class="w"> </span><span class="s1">'user1'</span><span class="p">,</span><span class="w"> </span><span class="n">discovery</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">enabled</span><span class="p">:</span><span class="w"> </span><span class="bp">false</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
<span class="o">//</span><span class="w"> </span><span class="n">Get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">contract</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deployed</span><span class="w"> </span><span class="n">to</span><span class="o">.</span>
<span class="k">const</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">gateway</span><span class="o">.</span><span class="n">getNetwork</span><span class="p">(</span><span class="s1">'mychannel'</span><span class="p">);</span>
<span class="o">//</span><span class="w"> </span><span class="n">Get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">contract</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">network</span><span class="o">.</span>

<span class="k">const</span><span class="w"> </span><span class="n">contract</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">network</span><span class="o">.</span><span class="n">getContract</span><span class="p">(</span><span class="s1">'bankpeerContract'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">contract</span><span class="o">.</span><span class="n">evaluateTransaction</span><span class="p">(</span><span class="s1">'queryAllStamps'</span><span class="p">);</span>
</pre></div>

<p>This is my connection.yaml file:</p>
<div class="code"><pre class="code literal-block"><span class="o">---</span>
<span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">mychannel</span><span class="p">.</span><span class="n">firstnetwork</span><span class="p">.</span><span class="n">connectionprofile</span>
<span class="n">x</span><span class="o">-</span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="ss">"hlfv1"</span>
<span class="nl">description</span><span class="p">:</span><span class="w"> </span><span class="ss">"BankPeerContract methods will be used through this profile"</span>
<span class="nl">version</span><span class="p">:</span><span class="w"> </span><span class="ss">"1.0"</span>

<span class="nl">channels</span><span class="p">:</span>
<span class="w">  </span><span class="nl">mychannel</span><span class="p">:</span>
<span class="w">    </span><span class="nl">orderers</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">orderer</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
<span class="w">    </span><span class="nl">peers</span><span class="p">:</span>
<span class="w">      </span><span class="n">peer0</span><span class="p">.</span><span class="n">org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="nl">com</span><span class="p">:</span>
<span class="w">        </span><span class="nl">endorsingPeer</span><span class="p">:</span><span class="w"> </span><span class="k">true</span>
<span class="w">        </span><span class="nl">chaincodeQuery</span><span class="p">:</span><span class="w"> </span><span class="k">true</span>
<span class="w">        </span><span class="nl">ledgerQuery</span><span class="p">:</span><span class="w"> </span><span class="k">true</span>
<span class="w">        </span><span class="nl">eventSource</span><span class="p">:</span><span class="w"> </span><span class="k">true</span>
<span class="w">      </span><span class="n">peer0</span><span class="p">.</span><span class="n">org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="nl">com</span><span class="p">:</span>
<span class="w">        </span><span class="nl">endorsingPeer</span><span class="p">:</span><span class="w"> </span><span class="k">true</span>
<span class="w">        </span><span class="nl">chaincodeQuery</span><span class="p">:</span><span class="w"> </span><span class="k">true</span>
<span class="w">        </span><span class="nl">ledgerQuery</span><span class="p">:</span><span class="w"> </span><span class="k">true</span>
<span class="w">        </span><span class="nl">eventSource</span><span class="p">:</span><span class="w"> </span><span class="k">true</span>

<span class="nl">organizations</span><span class="p">:</span>
<span class="w">  </span><span class="nl">Org1</span><span class="p">:</span>
<span class="w">    </span><span class="nl">mspid</span><span class="p">:</span><span class="w"> </span><span class="n">Org1MSP</span>
<span class="w">    </span><span class="nl">peers</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">peer0</span><span class="p">.</span><span class="n">org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
<span class="w">    </span><span class="nl">certificateAuthorities</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">certificate</span><span class="o">-</span><span class="n">authority</span><span class="o">-</span><span class="n">org1</span>
<span class="w">    </span><span class="nl">adminPrivateKey</span><span class="p">:</span>
<span class="w">      </span><span class="k">path</span><span class="err">:</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="k">first</span><span class="o">-</span><span class="n">network</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">config</span><span class="o">/</span><span class="n">peerOrganizations</span><span class="o">/</span><span class="n">org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="k">Admin</span><span class="nv">@org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">msp</span><span class="o">/</span><span class="n">keystore</span><span class="o">/</span><span class="mi">63145</span><span class="n">b12cd86abb07b6b5797c5e9506faa8f799e81d3c71d11a6a60840e3b6ae_sk</span>
<span class="w">    </span><span class="nl">signedCert</span><span class="p">:</span>
<span class="w">      </span><span class="k">path</span><span class="err">:</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="k">first</span><span class="o">-</span><span class="n">network</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">config</span><span class="o">/</span><span class="n">peerOrganizations</span><span class="o">/</span><span class="n">org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="k">Admin</span><span class="nv">@org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">msp</span><span class="o">/</span><span class="n">signcerts</span><span class="o">/</span><span class="k">Admin</span><span class="nv">@org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="n">cert</span><span class="p">.</span><span class="n">pem</span>

<span class="w">  </span><span class="nl">Org2</span><span class="p">:</span>
<span class="w">    </span><span class="nl">mspid</span><span class="p">:</span><span class="w"> </span><span class="n">Org2MSP</span>
<span class="w">    </span><span class="nl">peers</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">peer0</span><span class="p">.</span><span class="n">org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
<span class="w">    </span><span class="nl">certificateAuthorities</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">certificate</span><span class="o">-</span><span class="n">authority</span><span class="o">-</span><span class="n">org2</span>
<span class="w">    </span><span class="nl">adminPrivateKey</span><span class="p">:</span>
<span class="w">      </span><span class="k">path</span><span class="err">:</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="k">first</span><span class="o">-</span><span class="n">network</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">config</span><span class="o">/</span><span class="n">peerOrganizations</span><span class="o">/</span><span class="n">org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="k">Admin</span><span class="nv">@org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">msp</span><span class="o">/</span><span class="n">keystore</span><span class="o">/</span><span class="mi">4</span><span class="n">d9b19fdcce70620b45760f5d62c7c877200ab38553b7a8b85245b04ca0e8bdd_sk</span>
<span class="w">    </span><span class="nl">signedCert</span><span class="p">:</span>
<span class="w">      </span><span class="k">path</span><span class="err">:</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="k">first</span><span class="o">-</span><span class="n">network</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">config</span><span class="o">/</span><span class="n">peerOrganizations</span><span class="o">/</span><span class="n">org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="k">Admin</span><span class="nv">@org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">msp</span><span class="o">/</span><span class="n">signcerts</span><span class="o">/</span><span class="k">Admin</span><span class="nv">@org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="n">cert</span><span class="p">.</span><span class="n">pem</span>

<span class="nl">orderers</span><span class="p">:</span>
<span class="w">  </span><span class="n">orderer</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="nl">com</span><span class="p">:</span>
<span class="w">    </span><span class="nl">url</span><span class="p">:</span><span class="w"> </span><span class="nl">grpc</span><span class="p">:</span><span class="o">//</span><span class="nl">localhost</span><span class="p">:</span><span class="mi">7050</span>
<span class="w">    </span><span class="nl">grpcOptions</span><span class="p">:</span>
<span class="w">      </span><span class="n">ssl</span><span class="o">-</span><span class="n">target</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="nl">override</span><span class="p">:</span><span class="w"> </span><span class="n">orderer</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
<span class="w">    </span><span class="nl">tlsCACerts</span><span class="p">:</span>
<span class="w">      </span><span class="k">path</span><span class="err">:</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="k">first</span><span class="o">-</span><span class="n">network</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">config</span><span class="o">/</span><span class="n">ordererOrganizations</span><span class="o">/</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">orderers</span><span class="o">/</span><span class="n">orderer</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">msp</span><span class="o">/</span><span class="n">tlscacerts</span><span class="o">/</span><span class="n">tlsca</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="n">cert</span><span class="p">.</span><span class="n">pem</span>

<span class="nl">peers</span><span class="p">:</span>
<span class="w">  </span><span class="n">peer0</span><span class="p">.</span><span class="n">org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="nl">com</span><span class="p">:</span>
<span class="w">    </span><span class="nl">url</span><span class="p">:</span><span class="w"> </span><span class="nl">grpc</span><span class="p">:</span><span class="o">//</span><span class="nl">localhost</span><span class="p">:</span><span class="mi">7051</span>
<span class="w">    </span><span class="nl">grpcOptions</span><span class="p">:</span>
<span class="w">      </span><span class="n">ssl</span><span class="o">-</span><span class="n">target</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="nl">override</span><span class="p">:</span><span class="w"> </span><span class="n">peer0</span><span class="p">.</span><span class="n">org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
<span class="w">      </span><span class="n">request</span><span class="o">-</span><span class="nl">timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">120001</span>
<span class="w">    </span><span class="nl">tlsCACerts</span><span class="p">:</span>
<span class="w">      </span><span class="k">path</span><span class="err">:</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="k">first</span><span class="o">-</span><span class="n">network</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">config</span><span class="o">/</span><span class="n">peerOrganizations</span><span class="o">/</span><span class="n">org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">peers</span><span class="o">/</span><span class="n">peer0</span><span class="p">.</span><span class="n">org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">msp</span><span class="o">/</span><span class="n">tlscacerts</span><span class="o">/</span><span class="n">tlsca</span><span class="p">.</span><span class="n">org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="n">cert</span><span class="p">.</span><span class="n">pem</span>

<span class="w">  </span><span class="n">peer0</span><span class="p">.</span><span class="n">org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="nl">com</span><span class="p">:</span>
<span class="w">    </span><span class="nl">url</span><span class="p">:</span><span class="w"> </span><span class="nl">grpc</span><span class="p">:</span><span class="o">//</span><span class="nl">localhost</span><span class="p">:</span><span class="mi">9051</span>
<span class="w">    </span><span class="nl">grpcOptions</span><span class="p">:</span>
<span class="w">      </span><span class="n">ssl</span><span class="o">-</span><span class="n">target</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="nl">override</span><span class="p">:</span><span class="w"> </span><span class="n">peer0</span><span class="p">.</span><span class="n">org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span>
<span class="w">      </span><span class="n">request</span><span class="o">-</span><span class="nl">timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">120001</span>
<span class="w">    </span><span class="nl">tlsCACerts</span><span class="p">:</span>
<span class="w">      </span><span class="k">path</span><span class="err">:</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="k">first</span><span class="o">-</span><span class="n">network</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">config</span><span class="o">/</span><span class="n">peerOrganizations</span><span class="o">/</span><span class="n">org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">peers</span><span class="o">/</span><span class="n">peer0</span><span class="p">.</span><span class="n">org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">msp</span><span class="o">/</span><span class="n">tlscacerts</span><span class="o">/</span><span class="n">tlsca</span><span class="p">.</span><span class="n">org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="n">cert</span><span class="p">.</span><span class="n">pem</span>

<span class="nl">certificateAuthorities</span><span class="p">:</span>
<span class="w">  </span><span class="n">ca</span><span class="o">-</span><span class="nl">org1</span><span class="p">:</span>
<span class="w">    </span><span class="nl">url</span><span class="p">:</span><span class="w"> </span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="nl">localhost</span><span class="p">:</span><span class="mi">7054</span>
<span class="w">    </span><span class="nl">httpOptions</span><span class="p">:</span>
<span class="w">      </span><span class="nl">verify</span><span class="p">:</span><span class="w"> </span><span class="k">false</span>
<span class="w">    </span><span class="nl">tlsCACerts</span><span class="p">:</span>
<span class="w">      </span><span class="k">path</span><span class="err">:</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="k">first</span><span class="o">-</span><span class="n">network</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">config</span><span class="o">/</span><span class="n">peerOrganizations</span><span class="o">/</span><span class="n">org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">ca</span><span class="o">/</span><span class="n">ca</span><span class="p">.</span><span class="n">org1</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="n">cert</span><span class="p">.</span><span class="n">pem</span>
<span class="w">    </span><span class="nl">registrar</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nl">enrollId</span><span class="p">:</span><span class="w"> </span><span class="k">admin</span>
<span class="w">        </span><span class="nl">enrollSecret</span><span class="p">:</span><span class="w"> </span><span class="n">adminpw</span>
<span class="w">    </span><span class="nl">caName</span><span class="p">:</span><span class="w"> </span><span class="n">certificate</span><span class="o">-</span><span class="n">authority</span><span class="o">-</span><span class="n">org1</span>
<span class="w">  </span><span class="n">ca</span><span class="o">-</span><span class="nl">org2</span><span class="p">:</span>
<span class="w">    </span><span class="nl">url</span><span class="p">:</span><span class="w"> </span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="nl">localhost</span><span class="p">:</span><span class="mi">8054</span>
<span class="w">    </span><span class="nl">httpOptions</span><span class="p">:</span>
<span class="w">      </span><span class="nl">verify</span><span class="p">:</span><span class="w"> </span><span class="k">false</span>
<span class="w">    </span><span class="nl">tlsCACerts</span><span class="p">:</span>
<span class="w">      </span><span class="k">path</span><span class="err">:</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="k">first</span><span class="o">-</span><span class="n">network</span><span class="o">/</span><span class="n">crypto</span><span class="o">-</span><span class="n">config</span><span class="o">/</span><span class="n">peerOrganizations</span><span class="o">/</span><span class="n">org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">ca</span><span class="o">/</span><span class="n">ca</span><span class="p">.</span><span class="n">org2</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">com</span><span class="o">-</span><span class="n">cert</span><span class="p">.</span><span class="n">pem</span>
<span class="w">    </span><span class="nl">registrar</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nl">enrollId</span><span class="p">:</span><span class="w"> </span><span class="k">admin</span>
<span class="w">        </span><span class="nl">enrollSecret</span><span class="p">:</span><span class="w"> </span><span class="n">adminpw</span>
<span class="w">    </span><span class="nl">caName</span><span class="p">:</span><span class="w"> </span><span class="n">certificate</span><span class="o">-</span><span class="n">authority</span><span class="o">-</span><span class="n">org2</span>
</pre></div>

<p>I have been unable to figure out whether there is some problem with
<code>connection.yaml</code> file or there is something wrong within the network.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>BYFN/EFYN enable TLS on all of the Fabric nodes (peers, orderers, certificate
authorities) to secure communications. Your connection profile has "grpc://"
and "http://" URLs - these should be changed to "grpcs://" and "https://". It
looks like the TLS CA certificates are correct.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/solidity-v0-6-0-fallback-functions-what-are-they-needed-for/" class="u-url">Solidity v0.6.0. Fallback functions. What are they needed for?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/solidity-v0-6-0-fallback-functions-what-are-they-needed-for/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T05:10:56+08:00" itemprop="datePublished" title="2023-02-28 05:10">2023-02-28 05:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>After reading the documentation for Solidity v0.6.0 docs, I still don't
understand the meaning of the <code>fallback</code> functions. I read that it was split
into 2 functions: <code>fallback () external payable</code> and<code>receive () external
payable</code>. That they are anonymous and do not accept any parameters, and in the
overwhelming majority of cases, <code>receive () external payable</code> is used to
receive funds. Can you please explain with the example of my code, some use
cases for these functions, in order to understand all their features,
otherwise somehow everything is in a vacuum, but I understand that this is an
important concept? Even the meaning of the <code>receive () external payable</code>
function is not clear, in which I call on the <code>buyToken ()</code> method, why is it
needed if I call on <code>the buyToken ()</code> in the <code>Remix</code> directly, bypassing the
<code>receive () external payable</code> since she is not visible and anonymous.</p>
<div class="code"><pre class="code literal-block"><span class="n">pragma</span><span class="w"> </span><span class="n">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.7</span><span class="o">.</span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">SPDX</span><span class="o">-</span><span class="n">License</span><span class="o">-</span><span class="n">Identifier</span><span class="p">:</span><span class="w"> </span><span class="n">MIT</span>

<span class="w">    </span><span class="n">contract</span><span class="w"> </span><span class="n">BuyToken</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">mapping</span><span class="p">(</span><span class="n">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">uint256</span><span class="p">)</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">balances</span><span class="p">;</span>
<span class="w">      </span><span class="n">address</span><span class="w"> </span><span class="n">payable</span><span class="w"> </span><span class="n">wallet</span><span class="p">;</span>

<span class="w">      </span><span class="n">event</span><span class="w"> </span><span class="n">Purchase</span><span class="p">(</span>
<span class="w">        </span><span class="n">address</span><span class="w"> </span><span class="n">indexed</span><span class="w"> </span><span class="n">buyer</span><span class="p">,</span>
<span class="w">        </span><span class="n">uint256</span><span class="w"> </span><span class="n">amount</span>
<span class="w">      </span><span class="p">);</span>

<span class="w">      </span><span class="n">constructor</span><span class="p">(</span><span class="n">address</span><span class="w"> </span><span class="n">payable</span><span class="w"> </span><span class="n">_wallet</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">wallet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_wallet</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>


<span class="w">      </span><span class="n">fallback</span><span class="p">()</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">}</span>


<span class="w">      </span><span class="n">receive</span><span class="p">()</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">buyToken</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="n">function</span><span class="w"> </span><span class="n">buyToken</span><span class="p">()</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="n">wallet</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">value</span><span class="p">);</span>
<span class="w">        </span><span class="n">emit</span><span class="w"> </span><span class="n">Purchase</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>When the sender sends ETH to your contract address and doesn't specify any
function (i.e. the <code>data</code> field of the tx is empty), the <code>receive()</code> gets
executed.</p>
<p>Since the <code>receive()</code> just calls <code>buyToken()</code>, it produces the same set of
actions as if the user executed the <code>buyToken()</code> directly.</p>
<p>But other contracts can make a different use of the <code>receive()</code> function.
Example of a simple bank contract:</p>
<div class="code"><pre class="code literal-block">pragma solidity ^0.8;

contract MyContract {
    mapping (address =&gt; uint256) public balances;

    receive() external payable {
        balances[msg.sender] += msg.value;
    }

    function withdraw(uint256 _amount) external {
        require(_amount &lt;= balances[msg.sender], 'Insufficient balance');
        balances[msg.sender] -= _amount;
        payable(msg.sender).transfer(_amount);
    }
}
</pre></div>

<p>Or a timelock:</p>
<div class="code"><pre class="code literal-block"><span class="n">pragma</span><span class="w"> </span><span class="n">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8</span><span class="p">;</span>

<span class="n">contract</span><span class="w"> </span><span class="n">MyContract</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">uint256</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">unlockAfter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1640995200</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2022</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span>

<span class="w">    </span><span class="n">receive</span><span class="p">()</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">payable</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">anyone</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">funds</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">contract</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">withdraw</span><span class="p">()</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">require</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">address</span><span class="p">(</span><span class="mh">0x123</span><span class="p">),</span><span class="w"> </span><span class="s1">'Not authorized'</span><span class="p">);</span>
<span class="w">        </span><span class="n">require</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">timestamp</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">unlockAfter</span><span class="p">,</span><span class="w"> </span><span class="s1">'Not unlocked yet'</span><span class="p">);</span>
<span class="w">        </span><span class="n">payable</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">sender</span><span class="p">)</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">address</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="o">.</span><span class="n">balance</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<hr>
<p>The <code>fallback()</code> functions is used when the function signature (first 4 bytes
of the <code>data</code> field) doesn't match any of the existing functions.</p>
<div class="code"><pre class="code literal-block"><span class="n">pragma</span><span class="w"> </span><span class="n">solidity</span><span class="w"> </span><span class="o">^</span><span class="mf">0.8</span><span class="p">;</span>

<span class="n">contract</span><span class="w"> </span><span class="n">MyContract</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">function</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n n-Quoted">`data`</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="k">starts</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n n-Quoted">`0xc2985578`</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">signature</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n n-Quoted">`foo()`</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="n">fallback</span><span class="p">()</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">executed</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n n-Quoted">`data`</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">empty</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">starts</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="no">unknown</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">signature</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I'm not sure about your code example but here it goes:<br><strong>Fallback function</strong> - I think here is a good explanation. So if not marked
payable, it will throw exception if contract receives plain ether without
data.<br><strong>External payable</strong> - This post explains External well. So it costs less gas
to call external than public. Only in your example it would make sense to
change buyToken() from "public" to "external". Far as I understand there is no
benefit to call public from external...</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/i-am-trying-to-test-this-liquidity-smart-contract-code-but-if-shows-error-liquidity-is-similar-to-ocaml-tezos-s-smart-contract-language/" class="u-url">I am trying to test this liquidity smart contract code but if shows error. Liquidity is similar to ocaml, tezos's smart contract language.</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/i-am-trying-to-test-this-liquidity-smart-contract-code-but-if-shows-error-liquidity-is-similar-to-ocaml-tezos-s-smart-contract-language/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T05:10:39+08:00" itemprop="datePublished" title="2023-02-28 05:10">2023-02-28 05:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have been trying to test the first entry point of this game which is play.
But when it tries to compile it, there's some error showing. How do I proceed
or is there something I am missing?</p>
<div class="code"><pre class="code literal-block"><span class="k">[%%version 0.4]</span>

<span class="na">type game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">{</span>
<span class="w">  </span><span class="na">number</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">nat</span><span class="c1">;</span>
<span class="w">  </span><span class="na">bet</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">tez</span><span class="c1">;</span>
<span class="w">  </span><span class="na">player</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">key_hash</span><span class="c1">;</span>
<span class="na">}</span>

<span class="na">type storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">{</span>
<span class="w">  </span><span class="na">game</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">game option</span><span class="c1">;</span>
<span class="w">  </span><span class="na">oracle_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">address</span><span class="c1">;</span>
<span class="na">}</span>

<span class="na">let%entry play (number</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">nat) storage =</span><span class="w"> </span>
<span class="w">  </span><span class="na">if number&gt;100p then Current.failwith "number must be &lt;</span><span class="o">=</span><span class="s">100"</span><span class="c1">;</span>
<span class="w">  </span><span class="na">if 2p.Current.amount()&gt;Current.balance() then Current.failwith"less balance";</span>

<span class="w">  </span><span class="na">match storage.game with</span>
<span class="w">  </span><span class="na">|some g -&gt; failwith ("game has already started",g)</span>
<span class="w">  </span><span class="na">|None -&gt; </span>
<span class="w">      </span><span class="na">let bet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Current.amount() in</span>
<span class="w">      </span><span class="na">let storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">storage.game &lt;- Some {number, bet, player} in</span>
<span class="w">      </span><span class="na">(([]</span><span class="o">:</span><span class="s">operation list),storage)</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>You forgot to initialize, add this code:</p>
<div class="code"><pre class="code literal-block"><span class="n">let</span><span class="o">%</span><span class="n">init</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="p">(</span><span class="n">oracle_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">address</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="p">{</span><span class="n">game</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">None</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">game</span><span class="w"> </span><span class="n">option</span><span class="p">);</span><span class="w"> </span><span class="n">oracle_id</span><span class="p">}</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1493.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1491.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
