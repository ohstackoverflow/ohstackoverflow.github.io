<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 565) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-565.html">
<link rel="prev" href="index-566.html" type="text/html">
<link rel="next" href="index-564.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/does-javascript-guarantee-object-property-order/" class="u-url">Does JavaScript guarantee object property order?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/does-javascript-guarantee-object-property-order/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T10:04:21+08:00" itemprop="datePublished" title="2023-02-17 10:04">2023-02-17 10:04</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>If I create an object like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="n">obj</span><span class="o">.</span><span class="n">prop1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Foo"</span><span class="p">;</span>
<span class="n">obj</span><span class="o">.</span><span class="n">prop2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Bar"</span><span class="p">;</span>
</pre></div>

<p>Will the resulting object <em>always</em> look like this?</p>
<div class="code"><pre class="code literal-block">{ prop1 : "Foo", prop2 : "Bar" }
</pre></div>

<p>That is, will the properties be in the same order that I added them?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The iteration order for objects follows a certain set of rules since ES2015,
but <strong>it does not (always) follow the insertion order</strong>. Simply put, the
iteration order is a combination of the insertion order for strings keys, and
ascending order for number-like keys:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">order</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">bar</span>
<span class="k">const</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"bar"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w"> </span><span class="p">}</span>
</pre></div>

<p>Using an array or a <code>Map</code> object can be a better way to achieve this. <code>Map</code>
shares some similarities with <code>Object</code> and guarantees the keys to be iterated
in order of insertion, without exception:</p>
<blockquote>
<p>The keys in Map are ordered while keys added to object are not. Thus, when
iterating over it, a Map object returns keys in order of insertion. (Note
that in the ECMAScript 2015 spec objects do preserve creation order for
string and Symbol keys, so traversal of an object with ie only string keys
would yield keys in order of insertion)</p>
</blockquote>
<p>As a note, properties order in objects weren’t guaranteed at all before
ES2015. Definition of an Object from ECMAScript Third Edition (pdf):</p>
<blockquote>
<h4>4.3.3 Object</h4>
<p>An object is a member of the type Object. <strong>It is an unordered collection of
properties</strong> each of which contains a primitive value, object, or function.
A function stored in a property of an object is called a method.</p>
</blockquote>
<p><br></p>
<h3>Suggest</h3>
<p><strong>YES (but not always insertion order).</strong></p>
<p>Most Browsers iterate object properties as:</p>
<ol>
<li>Positive integer keys in ascending order (and strings like "1" that parse as ints)</li>
<li>String keys, in insertion order (ES2015 guarantees this and all browsers comply)</li>
<li>Symbol names, in insertion order (ES2015 guarantees this and all browsers comply)</li>
</ol>
<p>Some older browsers combine categories #1 and #2, iterating all keys in
insertion order. If your keys might parse as integers, it's best not to rely
on any specific iteration order.</p>
<p><strong>Current Language Spec (since ES2015)</strong> insertion order is preserved, except
in the case of keys that parse as positive integers (eg "7" or "99"), where
behavior varies between browsers. For example, Chrome/V8 does not respect
insertion order when the keys are parse as numeric.</p>
<p><strong>Old Language Spec (before ES2015)</strong> : Iteration order was technically
undefined, but all major browsers complied with the ES2015 behavior.</p>
<p>Note that the ES2015 behavior was a good example of the language spec being
driven by existing behavior, and not the other way round. To get a deeper
sense of that backwards-compatibility mindset, see
http://code.google.com/p/v8/issues/detail?id=164, a Chrome bug that covers in
detail the design decisions behind Chrome's iteration order behavior. Per one
of the (rather opinionated) comments on that bug report:</p>
<blockquote>
<p>Standards always follow implementations, that's where XHR came from, and
Google does the same thing by implementing Gears and then embracing
equivalent HTML5 functionality. The right fix is to have ECMA formally
incorporate the de-facto standard behavior into the next rev of the spec.</p>
</blockquote>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/list-of-lists-changes-reflected-across-sublists-unexpectedly/" class="u-url">List of lists changes reflected across sublists unexpectedly</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/list-of-lists-changes-reflected-across-sublists-unexpectedly/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T10:03:53+08:00" itemprop="datePublished" title="2023-02-17 10:03">2023-02-17 10:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I created a list of lists:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; xs = [[1] * 4] * 3
&gt;&gt;&gt; print(xs)
[[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]]
</pre></div>

<p>Then, I changed one of the innermost values:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; xs[0][0] = 5
&gt;&gt;&gt; print(xs)
[[5, 1, 1, 1], [5, 1, 1, 1], [5, 1, 1, 1]]
</pre></div>

<p>Why did every first element of each sublist change to <code>5</code>?</p>
<hr>
<p>See also:</p>
<p>How do I clone a list so that it doesn't change unexpectedly after assignment?
for workarounds for the problem</p>
<p>Python: List of dictionary stores only last appended value in every iteration
for an analogous problem with a list of dicts</p>
<p>How can I initialize a dictionary whose values are distinct empty lists? for
an analogous problem with a dict of lists</p>
<p><br><br></p>
<h2>Answer</h2>
<p>When you write <code>[x]*3</code> you get, essentially, the list <code>[x, x, x]</code>. That is, a
list with 3 references to the same <code>x</code>. When you then modify this single <code>x</code>
it is visible via all three references to it:</p>
<div class="code"><pre class="code literal-block"><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span>
<span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="ss">"id(x): {id(x)}"</span><span class="p">)</span>
<span class="err">#</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="mi">140560897920048</span>
<span class="k">print</span><span class="p">(</span>
<span class="w">    </span><span class="n">f</span><span class="ss">"id(xs[0]): {id(xs[0])}\n"</span>
<span class="w">    </span><span class="n">f</span><span class="ss">"id(xs[1]): {id(xs[1])}\n"</span>
<span class="w">    </span><span class="n">f</span><span class="ss">"id(xs[2]): {id(xs[2])}"</span>
<span class="p">)</span>
<span class="err">#</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">xs</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="mi">140560897920048</span>
<span class="err">#</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">xs</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="mi">140560897920048</span>
<span class="err">#</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">xs</span><span class="o">[</span><span class="n">2</span><span class="o">]</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="mi">140560897920048</span>

<span class="n">x</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="ss">"x: {x}"</span><span class="p">)</span>
<span class="err">#</span><span class="w"> </span><span class="nl">x</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">42, 1, 1, 1</span><span class="o">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="ss">"xs: {xs}"</span><span class="p">)</span>
<span class="err">#</span><span class="w"> </span><span class="nl">xs</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">[42, 1, 1, 1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">42, 1, 1, 1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">42, 1, 1, 1</span><span class="o">]</span><span class="err">]</span>
</pre></div>

<p>To fix it, you need to make sure that you create a new list at each position.
One way to do it is</p>
<div class="code"><pre class="code literal-block">[[<span class="mi">1</span>]<span class="o">*</span><span class="mi">4</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="mi">3</span><span class="ss">)</span>]
</pre></div>

<p>which will reevaluate <code>[1]*4</code> each time instead of evaluating it once and
making 3 references to 1 list.</p>
<hr>
<p>You might wonder why <code>*</code> can't make independent objects the way the list
comprehension does. That's because the multiplication operator <code>*</code> operates on
objects, without seeing expressions. When you use <code>*</code> to multiply <code>[[1] * 4]</code>
by 3, <code>*</code> only sees the 1-element list <code>[[1] * 4]</code> evaluates to, not the <code>[[1]
* 4</code> expression text. <code>*</code> has no idea how to make copies of that element, no
idea how to reevaluate <code>[[1] * 4]</code>, and no idea you even want copies, and in
general, there might not even be a way to copy the element.</p>
<p>The only option <code>*</code> has is to make new references to the existing sublist
instead of trying to make new sublists. Anything else would be inconsistent or
require major redesigning of fundamental language design decisions.</p>
<p>In contrast, a list comprehension reevaluates the element expression on every
iteration. <code>[[1] * 4 for n in range(3)]</code> reevaluates <code>[1] * 4</code> every time for
the same reason <code>[x**2 for x in range(3)]</code> reevaluates <code>x**2</code> every time.
Every evaluation of <code>[1] * 4</code> generates a new list, so the list comprehension
does what you wanted.</p>
<p>Incidentally, <code>[1] * 4</code> also doesn't copy the elements of <code>[1]</code>, but that
doesn't matter, since integers are immutable. You can't do something like
<code>1.value = 2</code> and turn a 1 into a 2.</p>
<p><br></p>
<h3>Suggest</h3>
<div class="code"><pre class="code literal-block"><span class="nv">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="nv">matrix_surprise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>[[<span class="mi">0</span>]<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">size</span>]<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">size</span>
<span class="nv">matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>[[<span class="mi">0</span>]<span class="o">*</span><span class="nv">size</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">_</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">range</span><span class="ss">(</span><span class="nv">size</span><span class="ss">)</span>]
</pre></div>

<p>Live visualization using Python Tutor:</p>
<p><img alt="Frames and Objects" src="images/AE8xf.png"></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-select-rows-with-max-column-value-partition-by-another-column-in-mysql/" class="u-url">How can I SELECT rows with MAX(Column value), PARTITION by another column in MYSQL?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-select-rows-with-max-column-value-partition-by-another-column-in-mysql/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T10:03:23+08:00" itemprop="datePublished" title="2023-02-17 10:03">2023-02-17 10:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a table of player performance:</p>
<div class="code"><pre class="code literal-block"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">TopTen</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">UNSIGNED</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="p">,</span>
<span class="w">  </span><span class="n">home</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">UNSIGNED</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`datetime`</span><span class="kt">DATETIME</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="n">player</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="p">,</span>
<span class="w">  </span><span class="k">resource</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span>
<span class="p">);</span>
</pre></div>

<p>What query will return the rows for each distinct <code>home</code> holding its maximum
value of <code>datetime</code>? In other words, how can I filter by the maximum
<code>datetime</code> (grouped by <code>home</code>) and still include other non-grouped, non-
aggregate columns (such as <code>player</code>) in the result?</p>
<p>For this sample data:</p>
<div class="code"><pre class="code literal-block"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">TopTen</span>
<span class="w">  </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">home</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`datetime`</span><span class="p">,</span><span class="w"> </span><span class="n">player</span><span class="p">,</span><span class="w"> </span><span class="k">resource</span><span class="p">)</span>
<span class="k">VALUES</span>
<span class="w">  </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">'04/03/2009'</span><span class="p">,</span><span class="w"> </span><span class="s1">'john'</span><span class="p">,</span><span class="w"> </span><span class="mi">399</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="s1">'04/03/2009'</span><span class="p">,</span><span class="w"> </span><span class="s1">'juliet'</span><span class="p">,</span><span class="w"> </span><span class="mi">244</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">'04/03/2009'</span><span class="p">,</span><span class="w"> </span><span class="s1">'borat'</span><span class="p">,</span><span class="w"> </span><span class="mi">555</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">'03/03/2009'</span><span class="p">,</span><span class="w"> </span><span class="s1">'john'</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="s1">'03/03/2009'</span><span class="p">,</span><span class="w"> </span><span class="s1">'juliet'</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">'03/03/2009'</span><span class="p">,</span><span class="w"> </span><span class="s1">'borat'</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="s1">'24/12/2008'</span><span class="p">,</span><span class="w"> </span><span class="s1">'borat'</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">),</span>
<span class="w">  </span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="s1">'01/01/2009'</span><span class="p">,</span><span class="w"> </span><span class="s1">'borat'</span><span class="p">,</span><span class="w"> </span><span class="mi">700</span><span class="p">)</span>
<span class="p">;</span>
</pre></div>

<p>the result should be:</p>
<table>
<thead><tr>
<th>id</th>
<th>home</th>
<th>datetime</th>
<th>player</th>
<th>resource</th>
</tr></thead>
<tbody>
<tr>
<td>1</td>
<td>10</td>
<td>04/03/2009</td>
<td>john</td>
<td>399</td>
</tr>
<tr>
<td>2</td>
<td>11</td>
<td>04/03/2009</td>
<td>juliet</td>
<td>244</td>
</tr>
<tr>
<td>5</td>
<td>12</td>
<td>04/03/2009</td>
<td>borat</td>
<td>555</td>
</tr>
<tr>
<td>8</td>
<td>13</td>
<td>01/01/2009</td>
<td>borat</td>
<td>700</td>
</tr>
</tbody>
</table>
<p>I tried a subquery getting the maximum <code>datetime</code> for each <code>home</code>:</p>
<div class="code"><pre class="code literal-block"><span class="c1">-- 1 ..by the MySQL manual:</span>

<span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span>
<span class="w">  </span><span class="n">home</span><span class="p">,</span>
<span class="w">  </span><span class="n">id</span><span class="p">,</span>
<span class="w">  </span><span class="kt">datetime</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span><span class="p">,</span>
<span class="w">  </span><span class="n">player</span><span class="p">,</span>
<span class="w">  </span><span class="k">resource</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">TopTen</span><span class="w"> </span><span class="n">t1</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n n-Quoted">`datetime`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span>
<span class="w">  </span><span class="nf">MAX</span><span class="p">(</span><span class="n">t2</span><span class="p">.</span><span class="kt">datetime</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">TopTen</span><span class="w"> </span><span class="n">t2</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">home</span><span class="p">)</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n n-Quoted">`datetime`</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n n-Quoted">`datetime`</span><span class="w"> </span><span class="k">DESC</span>
</pre></div>

<p>The result-set has 130 rows although database holds 187, indicating the result
includes some duplicates of <code>home</code>.</p>
<p>Then I tried joining to a subquery that gets the maximum <code>datetime</code> for each
row <code>id</code>:</p>
<div class="code"><pre class="code literal-block"><span class="c1">-- 2 ..join</span>

<span class="k">SELECT</span>
<span class="w">  </span><span class="n">s1</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
<span class="w">  </span><span class="n">s1</span><span class="p">.</span><span class="n">home</span><span class="p">,</span>
<span class="w">  </span><span class="n">s1</span><span class="p">.</span><span class="kt">datetime</span><span class="p">,</span>
<span class="w">  </span><span class="n">s1</span><span class="p">.</span><span class="n">player</span><span class="p">,</span>
<span class="w">  </span><span class="n">s1</span><span class="p">.</span><span class="k">resource</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">TopTen</span><span class="w"> </span><span class="n">s1</span>
<span class="k">JOIN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span>
<span class="w">  </span><span class="n">id</span><span class="p">,</span>
<span class="w">  </span><span class="nf">MAX</span><span class="p">(</span><span class="n n-Quoted">`datetime`</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">dt</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">TopTen</span>
<span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">s2</span>
<span class="w">  </span><span class="k">ON</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s2</span><span class="p">.</span><span class="n">id</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n n-Quoted">`datetime`</span>
</pre></div>

<p>Nope. Gives all the records.</p>
<p>I tried various exotic queries, each with various results, but nothing that
got me any closer to solving this problem.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You are so close! All you need to do is select BOTH the home and its max date
time, then join back to the <code>topten</code> table on BOTH fields:</p>
<div class="code"><pre class="code literal-block">SELECT tt.*
FROM topten tt
INNER JOIN
    (SELECT home, MAX(datetime) AS MaxDateTime
    FROM topten
    GROUP BY home) groupedtt 
ON tt.home = groupedtt.home 
AND tt.datetime = groupedtt.MaxDateTime
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>The fastest <code>MySQL</code> solution, without inner queries and without <code>GROUP BY</code>:</p>
<div class="code"><pre class="code literal-block"><span class="k">SELECT</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="o">*</span><span class="w">                    </span><span class="c1">-- get the row that contains the max value</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">topten</span><span class="w"> </span><span class="n">m</span><span class="w">                 </span><span class="c1">-- "m" from "max"</span>
<span class="w">    </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">topten</span><span class="w"> </span><span class="n">b</span><span class="w">        </span><span class="c1">-- "b" from "bigger"</span>
<span class="w">        </span><span class="k">ON</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">home</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">home</span><span class="w">    </span><span class="c1">-- match "max" row with "bigger" row by `home`</span>
<span class="w">        </span><span class="k">AND</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="kt">datetime</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="kt">datetime</span><span class="w">           </span><span class="c1">-- want "bigger" than "max"</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="kt">datetime</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="no">NULL</span><span class="w">      </span><span class="c1">-- keep only if there is no bigger than max</span>
</pre></div>

<p><strong>Explanation</strong> :</p>
<p>Join the table with itself using the <code>home</code> column. The use of <code>LEFT JOIN</code>
ensures all the rows from table <code>m</code> appear in the result set. Those that don't
have a match in table <code>b</code> will have <code>NULL</code>s for the columns of <code>b</code>.</p>
<p>The other condition on the <code>JOIN</code> asks to match only the rows from <code>b</code> that
have bigger value on the <code>datetime</code> column than the row from <code>m</code>.</p>
<p>Using the data posted in the question, the <code>LEFT JOIN</code> will produce this
pairs:</p>
<div class="code"><pre class="code literal-block"><span class="nb">+------------------------------------------+--------------------------------+</span>
<span class="c">|              the row from `m`            |    the matching row from `b`   |</span>
<span class="c">|</span><span class="nb">------------------------------------------</span><span class="c">|</span><span class="nb">--------------------------------</span><span class="c">|</span>
<span class="c">| id  home  datetime     player   resource | id    home   datetime      </span><span class="nt">...</span><span class="c"> |</span>
<span class="c">|</span><span class="nb">----</span><span class="c">|</span><span class="nb">-----</span><span class="c">|</span><span class="nb">------------</span><span class="c">|</span><span class="nb">--------</span><span class="c">|</span><span class="nb">---------</span><span class="c">|</span><span class="nb">------</span><span class="c">|</span><span class="nb">------</span><span class="c">|</span><span class="nb">------------</span><span class="c">|</span><span class="nb">-----</span><span class="c">|</span>
<span class="c">| 1  | 10  | 04/03/2009 | john   | 399     | NULL | NULL | NULL       | </span><span class="nt">...</span><span class="c"> | *</span>
<span class="c">| 2  | 11  | 04/03/2009 | juliet | 244     | NULL | NULL | NULL       | </span><span class="nt">...</span><span class="c"> | *</span>
<span class="c">| 5  | 12  | 04/03/2009 | borat  | 555     | NULL | NULL | NULL       | </span><span class="nt">...</span><span class="c"> | *</span>
<span class="c">| 3  | 10  | 03/03/2009 | john   | 300     | 1    | 10   | 04/03/2009 | </span><span class="nt">...</span><span class="c"> |</span>
<span class="c">| 4  | 11  | 03/03/2009 | juliet | 200     | 2    | 11   | 04/03/2009 | </span><span class="nt">...</span><span class="c"> |</span>
<span class="c">| 6  | 12  | 03/03/2009 | borat  | 500     | 5    | 12   | 04/03/2009 | </span><span class="nt">...</span><span class="c"> |</span>
<span class="c">| 7  | 13  | 24/12/2008 | borat  | 600     | 8    | 13   | 01/01/2009 | </span><span class="nt">...</span><span class="c"> |</span>
<span class="c">| 8  | 13  | 01/01/2009 | borat  | 700     | NULL | NULL | NULL       | </span><span class="nt">...</span><span class="c"> | *</span>
<span class="nb">+------------------------------------------+--------------------------------+</span>
</pre></div>

<p>Finally, the <code>WHERE</code> clause keeps only the pairs that have <code>NULL</code>s in the
columns of <code>b</code> (they are marked with <code>*</code> in the table above); this means, due
to the second condition from the <code>JOIN</code> clause, the row selected from <code>m</code> has
the biggest value in column <code>datetime</code>.</p>
<p>Read the SQL Antipatterns: Avoiding the Pitfalls of Database Programming book
for other SQL tips.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-566.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-564.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
