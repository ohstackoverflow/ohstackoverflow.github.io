<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2460) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2460.html">
<link rel="prev" href="index-2461.html" type="text/html">
<link rel="next" href="index-2459.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-get-utf-8-working-in-java-webapps/" class="u-url">How to get UTF-8 working in Java webapps?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-get-utf-8-working-in-java-webapps/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T17:45:32+08:00" itemprop="datePublished" title="2023-03-04 17:45">2023-03-04 17:45</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I need to get UTF-8 working in my Java webapp (servlets + JSP, no framework
used) to support <code>äöå</code> etc. for regular Finnish text and Cyrillic alphabets
like <code>ЦжФ</code> for special cases.</p>
<p>My setup is the following:</p>
<ul>
<li>Development environment: Windows XP</li>
<li>Production environment: Debian</li>
</ul>
<p>Database used: MySQL 5.x</p>
<p>Users mainly use Firefox2 but also Opera 9.x, FF3, IE7 and Google Chrome are
used to access the site.</p>
<p>How to achieve this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><em>Answering myself as the FAQ of this site encourages it. This works for me:</em></p>
<p>Mostly characters äåö are not a problematic as the default character set used
by browsers and tomcat/java for webapps is latin1 ie. ISO-8859-1 which
"understands" those characters.</p>
<p>To get UTF-8 working under Java+Tomcat+Linux/Windows+Mysql requires the
following:</p>
<h3>Configuring Tomcat's server.xml</h3>
<p>It's necessary to configure that the connector uses UTF-8 to encode url (GET
request) parameters:</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">Connector</span><span class="w"> </span><span class="n">port</span><span class="o">=</span><span class="s2">"8080"</span><span class="w"> </span><span class="n">maxHttpHeaderSize</span><span class="o">=</span><span class="s2">"8192"</span>
<span class="w"> </span><span class="n">maxThreads</span><span class="o">=</span><span class="s2">"150"</span><span class="w"> </span><span class="n">minSpareThreads</span><span class="o">=</span><span class="s2">"25"</span><span class="w"> </span><span class="n">maxSpareThreads</span><span class="o">=</span><span class="s2">"75"</span>
<span class="w"> </span><span class="n">enableLookups</span><span class="o">=</span><span class="s2">"false"</span><span class="w"> </span><span class="n">redirectPort</span><span class="o">=</span><span class="s2">"8443"</span><span class="w"> </span><span class="n">acceptCount</span><span class="o">=</span><span class="s2">"100"</span>
<span class="w"> </span><span class="n">connectionTimeout</span><span class="o">=</span><span class="s2">"20000"</span><span class="w"> </span><span class="n">disableUploadTimeout</span><span class="o">=</span><span class="s2">"true"</span><span class="w"> </span>
<span class="w"> </span><span class="n">compression</span><span class="o">=</span><span class="s2">"on"</span><span class="w"> </span>
<span class="w"> </span><span class="n">compressionMinSize</span><span class="o">=</span><span class="s2">"128"</span><span class="w"> </span>
<span class="w"> </span><span class="n">noCompressionUserAgents</span><span class="o">=</span><span class="s2">"gozilla, traviata"</span><span class="w"> </span>
<span class="w"> </span><span class="n">compressableMimeType</span><span class="o">=</span><span class="s2">"text/html,text/xml,text/plain,text/css,text/ javascript,application/x-javascript,application/javascript"</span>
<span class="w"> </span><span class="n">URIEncoding</span><span class="o">=</span><span class="s2">"UTF-8"</span>
<span class="o">/&gt;</span>
</pre></div>

<p>The key part being <strong>URIEncoding="UTF-8"</strong> in the above example. This
quarantees that Tomcat handles all incoming GET parameters as UTF-8 encoded.
As a result, when the user writes the following to the address bar of the
browser:</p>
<div class="code"><pre class="code literal-block"> https://localhost:8443/ID/Users?action=search&amp;name=*ж*
</pre></div>

<p>the character ж is handled as UTF-8 and is encoded to (usually by the browser
before even getting to the server) as <strong>%D0%B6</strong>.</p>
<p><em>POST request are not affected by this.</em></p>
<h3>CharsetFilter</h3>
<p>Then it's time to force the java webapp to handle all requests and responses
as UTF-8 encoded. This requires that we define a character set filter like the
following:</p>
<div class="code"><pre class="code literal-block"><span class="n">package</span> <span class="n">fi</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">filters</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.</span><span class="o">*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">CharsetFilter</span> <span class="n">implements</span> <span class="n">Filter</span> <span class="p">{</span>

    <span class="n">private</span> <span class="n">String</span> <span class="n">encoding</span><span class="p">;</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">init</span><span class="p">(</span><span class="n">FilterConfig</span> <span class="n">config</span><span class="p">)</span> <span class="n">throws</span> <span class="n">ServletException</span> <span class="p">{</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getInitParameter</span><span class="p">(</span><span class="s2">"requestEncoding"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">encoding</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s2">"UTF-8"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">doFilter</span><span class="p">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="p">,</span> <span class="n">ServletResponse</span> <span class="n">response</span><span class="p">,</span> <span class="n">FilterChain</span> <span class="nb">next</span><span class="p">)</span>
            <span class="n">throws</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">ServletException</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">Respect</span> <span class="n">the</span> <span class="n">client</span><span class="o">-</span><span class="n">specified</span> <span class="n">character</span> <span class="n">encoding</span>
        <span class="o">//</span> <span class="p">(</span><span class="n">see</span> <span class="n">HTTP</span> <span class="n">specification</span> <span class="n">section</span> <span class="mf">3.4.1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">null</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">getCharacterEncoding</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">request</span><span class="o">.</span><span class="n">setCharacterEncoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="o">//</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">default</span> <span class="n">response</span> <span class="n">content</span> <span class="nb">type</span> <span class="ow">and</span> <span class="n">encoding</span>
        <span class="n">response</span><span class="o">.</span><span class="n">setContentType</span><span class="p">(</span><span class="s2">"text/html; charset=UTF-8"</span><span class="p">);</span>
        <span class="n">response</span><span class="o">.</span><span class="n">setCharacterEncoding</span><span class="p">(</span><span class="s2">"UTF-8"</span><span class="p">);</span>

        <span class="nb">next</span><span class="o">.</span><span class="n">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">destroy</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>This filter makes sure that if the browser hasn't set the encoding used in the
request, that it's set to UTF-8.</p>
<p>The other thing done by this filter is to set the default response encoding
ie. the encoding in which the returned html/whatever is. The alternative is to
set the response encoding etc. in each controller of the application.</p>
<p>This filter has to be added to the <strong>web.xml</strong> or the deployment descriptor of
the webapp:</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="cm">&lt;!--CharsetFilter start--&gt;</span>

<span class="w">  </span><span class="nt">&lt;filter&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-name&gt;</span>CharsetFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-class&gt;</span>fi.foo.filters.CharsetFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="w">      </span><span class="nt">&lt;init-param&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-name&gt;</span>requestEncoding<span class="nt">&lt;/param-name&gt;</span>
<span class="w">        </span><span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
<span class="w">      </span><span class="nt">&lt;/init-param&gt;</span>
<span class="w">  </span><span class="nt">&lt;/filter&gt;</span>

<span class="w">  </span><span class="nt">&lt;filter-mapping&gt;</span>
<span class="w">    </span><span class="nt">&lt;filter-name&gt;</span>CharsetFilter<span class="nt">&lt;/filter-name&gt;</span>
<span class="w">    </span><span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">  </span><span class="nt">&lt;/filter-mapping&gt;</span>
</pre></div>

<p>The instructions for making this filter are found at the tomcat wiki
(http://wiki.apache.org/tomcat/Tomcat/UTF-8)</p>
<h3>JSP page encoding</h3>
<p>In your <strong>web.xml</strong> , add the following:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;jsp-config&gt;</span>
<span class="w">    </span><span class="nt">&lt;jsp-property-group&gt;</span>
<span class="w">        </span><span class="nt">&lt;url-pattern&gt;</span>*.jsp<span class="nt">&lt;/url-pattern&gt;</span>
<span class="w">        </span><span class="nt">&lt;page-encoding&gt;</span>UTF-8<span class="nt">&lt;/page-encoding&gt;</span>
<span class="w">    </span><span class="nt">&lt;/jsp-property-group&gt;</span>
<span class="nt">&lt;/jsp-config&gt;</span>
</pre></div>

<p>Alternatively, all JSP-pages of the webapp would need to have the following at
the top of them:</p>
<div class="code"><pre class="code literal-block"><span class="x"> </span><span class="cp">&lt;%</span><span class="vi">@page</span><span class="w"> </span><span class="n">pageEncoding</span><span class="o">=</span><span class="s2">"UTF-8"</span><span class="w"> </span><span class="n">contentType</span><span class="o">=</span><span class="s2">"text/html; charset=UTF-8"</span><span class="cp">%&gt;</span>
</pre></div>

<p>If some kind of a layout with different JSP-fragments is used, then this is
needed in <strong>all</strong> of them.</p>
<h3>HTML-meta tags</h3>
<p>JSP page encoding tells the JVM to handle the characters in the JSP page in
the correct encoding. Then it's time to tell the browser in which encoding the
html page is:</p>
<p>This is done with the following at the top of each xhtml page produced by the
webapp:</p>
<div class="code"><pre class="code literal-block">   <span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
   <span class="cp">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;</span>
   <span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns</span><span class="o">=</span><span class="s">"http://www.w3.org/1999/xhtml"</span> <span class="na">xml:lang</span><span class="o">=</span><span class="s">"fi"</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">'Content-Type'</span> <span class="na">content</span><span class="o">=</span><span class="s">'text/html; charset=UTF-8'</span> <span class="p">/&gt;</span>
   ...
</pre></div>

<h3>JDBC-connection</h3>
<p>When using a db, it has to be defined that the connection uses UTF-8 encoding.
This is done in <strong>context.xml</strong> or wherever the JDBC connection is defiend as
follows:</p>
<div class="code"><pre class="code literal-block"><span class="w">      </span><span class="o">&lt;</span><span class="nt">Resource</span><span class="w"> </span><span class="nt">name</span><span class="o">=</span><span class="s2">"jdbc/AppDB"</span><span class="w"> </span>
<span class="w">        </span><span class="nt">auth</span><span class="o">=</span><span class="s2">"Container"</span>
<span class="w">        </span><span class="nt">type</span><span class="o">=</span><span class="s2">"javax.sql.DataSource"</span>
<span class="w">        </span><span class="nt">maxActive</span><span class="o">=</span><span class="s2">"20"</span><span class="w"> </span><span class="nt">maxIdle</span><span class="o">=</span><span class="s2">"10"</span><span class="w"> </span><span class="nt">maxWait</span><span class="o">=</span><span class="s2">"10000"</span>
<span class="w">        </span><span class="nt">username</span><span class="o">=</span><span class="s2">"foo"</span>
<span class="w">        </span><span class="nt">password</span><span class="o">=</span><span class="s2">"bar"</span>
<span class="w">        </span><span class="nt">driverClassName</span><span class="o">=</span><span class="s2">"com.mysql.jdbc.Driver"</span><span class="w"> </span><span class="nt">url</span><span class="o">=</span><span class="s2">"jdbc:mysql://localhost:3306/      ID_development?useEncoding=true&amp;amp;characterEncoding=UTF-8"</span>
<span class="w">    </span><span class="o">/&gt;</span>
</pre></div>

<h3>MySQL database and tables</h3>
<p>The used database must use UTF-8 encoding. This is achieved by creating the
database with the following:</p>
<div class="code"><pre class="code literal-block"><span class="w">   </span><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n n-Quoted">`ID_development`</span><span class="w"> </span>
<span class="w">   </span><span class="cm">/*!40100 DEFAULT CHARACTER SET utf8 COLLATE utf8_swedish_ci */</span><span class="p">;</span>
</pre></div>

<p>Then, all of the tables need to be in UTF-8 also:</p>
<div class="code"><pre class="code literal-block"><span class="w">   </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w">  </span><span class="n n-Quoted">`Users`</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">unsigned</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">auto_increment</span><span class="p">,</span>
<span class="w">    </span><span class="n n-Quoted">`name`</span><span class="w"> </span><span class="kt">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">collate</span><span class="w"> </span><span class="n">utf8_swedish_ci</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="no">NULL</span>
<span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w">  </span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">)</span>
<span class="w">   </span><span class="p">)</span><span class="w"> </span><span class="k">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_swedish_ci</span><span class="w"> </span><span class="k">ROW_FORMAT</span><span class="o">=</span><span class="k">DYNAMIC</span><span class="p">;</span>
</pre></div>

<p>The key part being <strong>CHARSET=utf8</strong>.</p>
<h3>MySQL server configuration</h3>
<p>MySQL serveri has to be configured also. Typically this is done in Windows by
modifying <strong>my.ini</strong> -file and in Linux by configuring <strong>my.cnf</strong> -file. In
those files it should be defined that all clients connected to the server use
utf8 as the default character set and that the default charset used by the
server is also utf8.</p>
<div class="code"><pre class="code literal-block"><span class="w">   </span><span class="o">[</span><span class="n">client</span><span class="o">]</span>
<span class="w">   </span><span class="n">port</span><span class="o">=</span><span class="mi">3306</span>
<span class="w">   </span><span class="k">default</span><span class="o">-</span><span class="k">character</span><span class="o">-</span><span class="k">set</span><span class="o">=</span><span class="n">utf8</span>

<span class="w">   </span><span class="o">[</span><span class="n">mysql</span><span class="o">]</span>
<span class="w">   </span><span class="k">default</span><span class="o">-</span><span class="k">character</span><span class="o">-</span><span class="k">set</span><span class="o">=</span><span class="n">utf8</span>
</pre></div>

<h3>Mysql procedures and functions</h3>
<p>These also need to have the character set defined. For example:</p>
<div class="code"><pre class="code literal-block"><span class="w">   </span><span class="n">DELIMITER</span><span class="w"> </span><span class="n">$$</span>

<span class="w">   </span><span class="k">DROP</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n n-Quoted">`pathToNode`</span><span class="w"> </span><span class="n">$$</span>
<span class="w">   </span><span class="k">CREATE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n n-Quoted">`pathToNode`</span><span class="w"> </span><span class="p">(</span><span class="n">ryhma_id</span><span class="w"> </span><span class="kt">INT</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="kt">TEXT</span><span class="w"> </span><span class="k">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">utf8</span>
<span class="w">   </span><span class="k">READS</span><span class="w"> </span><span class="k">SQL</span><span class="w"> </span><span class="k">DATA</span>
<span class="w">   </span><span class="k">BEGIN</span>

<span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="k">path</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">CHARACTER</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">utf8</span><span class="p">;</span>

<span class="w">   </span><span class="k">SET</span><span class="w"> </span><span class="k">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">NULL</span><span class="p">;</span>

<span class="w">   </span><span class="p">...</span>

<span class="w">   </span><span class="k">RETURN</span><span class="w"> </span><span class="k">path</span><span class="p">;</span>

<span class="w">   </span><span class="k">END</span><span class="w"> </span><span class="n">$$</span>

<span class="w">   </span><span class="n">DELIMITER</span><span class="w"> </span><span class="p">;</span>
</pre></div>

<h3>GET requests: latin1 and UTF-8</h3>
<p>If and when it's defined in tomcat's server.xml that GET request parameters
are encoded in UTF-8, the following GET requests are handled properly:</p>
<div class="code"><pre class="code literal-block">   https://localhost:8443/ID/Users?action=search&amp;name=Petteri
   https://localhost:8443/ID/Users?action=search&amp;name=ж
</pre></div>

<p>Because ASCII-characters are encoded in the same way both with latin1 and
UTF-8, the string "Petteri" is handled correctly.</p>
<p>The Cyrillic character ж is not understood at all in latin1. Because Tomcat is
instructed to handle request parameters as UTF-8 it encodes that character
correctly as <strong>%D0%B6</strong>.</p>
<p>If and when browsers are instructed to read the pages in UTF-8 encoding (with
request headers and html meta-tag), at least Firefox 2/3 and other browsers
from this period all encode the character themselves as <strong>%D0%B6</strong>.</p>
<p>The end result is that all users with name "Petteri" are found and also all
users with the name "ж" are found.</p>
<h4>But what about äåö?</h4>
<p>HTTP-specification defines that by default URLs are encoded as latin1. This
results in firefox2, firefox3 etc. encoding the following</p>
<div class="code"><pre class="code literal-block">    https://localhost:8443/ID/Users?action=search&amp;name=*Päivi*
</pre></div>

<p>in to the encoded version</p>
<div class="code"><pre class="code literal-block">    https://localhost:8443/ID/Users?action=search&amp;name=*P%E4ivi*
</pre></div>

<p>In latin1 the character <strong>ä</strong> is encoded as <strong>%E4</strong>. <em>Even though the
page/request/everything is defined to use UTF-8</em>. The UTF-8 encoded version of
ä is <strong>%C3%A4</strong></p>
<p>The result of this is that it's quite impossible for the webapp to correly
handle the request parameters from GET requests as some characters are encoded
in latin1 and others in UTF-8. <strong>Notice: POST requests do work as browsers
encode all request parameters from forms completely in UTF-8 if the page is
defined as being UTF-8</strong></p>
<h3>Stuff to read</h3>
<p>A very big thank you for the writers of the following for giving the answers
for my problem:</p>
<ul>
<li>http://tagunov.tripod.com/i18n/i18n.html </li>
<li>http://wiki.apache.org/tomcat/Tomcat/UTF-8 </li>
<li>http://java.sun.com/developer/technicalArticles/Intl/HTTPCharset/ </li>
<li>http://dev.mysql.com/doc/refman/5.0/en/charset-syntax.html </li>
<li>http://cagan327.blogspot.com/2006/05/utf-8-encoding-fix-tomcat-jsp-etc.html </li>
<li>http://cagan327.blogspot.com/2006/05/utf-8-encoding-fix-for-mysql-tomcat.html </li>
<li>http://jeppesn.dk/utf-8.html </li>
<li>http://www.nabble.com/request-parameters-mishandle-utf-8-encoding-td18720039.html </li>
<li>http://www.utoronto.ca/webdocs/HTMLdocs/NewHTML/iso_table.html </li>
<li>http://www.utf8-chartable.de/ </li>
</ul>
<h3>Important Note</h3>
<p>mysql supports the Basic Multilingual Plane using 3-byte UTF-8 characters. If
you need to go outside of that (certain alphabets require more than 3-bytes of
UTF-8), then you either need to use a flavor of <code>VARBINARY</code> column type or use
the <code>utf8mb4</code> character set (which requires MySQL 5.5.3 or later). Just be
aware that using the <code>utf8</code> character set in MySQL won't work 100% of the
time.</p>
<h3>Tomcat with Apache</h3>
<p>One more thing If you are using Apache + Tomcat + mod_JK connector then you
also need to do following changes:</p>
<ol>
<li>Add URIEncoding="UTF-8" into tomcat server.xml file for 8009 connector, it is used by mod_JK connector. <code>&lt;Connector port="8009" protocol="AJP/1.3" redirectPort="8443" URIEncoding="UTF-8"/&gt;</code>
</li>
<li>Goto your apache folder i.e. <code>/etc/httpd/conf</code> and add <code>AddDefaultCharset utf-8</code> in <code>httpd.conf file</code>. <strong>Note:</strong> First check that it is exist or not. If exist you may update it with this line. You can add this line at bottom also.</li>
</ol>
<p><br></p>
<h3>Suggest</h3>
<p>I think you summed it up quite well in your own answer.</p>
<p>In the process of UTF-8-ing(?) from end to end you might also want to make
sure java itself is using UTF-8. Use -Dfile.encoding=utf-8 as parameter to the
JVM (can be configured in catalina.bat).</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-insert-tab-character-when-expandtab-option-is-on-in-vim/" class="u-url">How to insert tab character when expandtab option is on in Vim</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-insert-tab-character-when-expandtab-option-is-on-in-vim/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T17:44:10+08:00" itemprop="datePublished" title="2023-03-04 17:44">2023-03-04 17:44</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>When I'm in insert mode and I have the <code>expandtab</code> option switched on,
pressing <code>Tab ↹</code> results in inserting the configured number of spaces.</p>
<p>But occasionally I want to insert an actual tab character.</p>
<p>Do you know how to do this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can use <code>&lt;CTRL-V&gt;&lt;Tab&gt;</code> in "insert mode". In insert mode, <code>&lt;CTRL-V&gt;</code>
inserts a literal copy of your next character.</p>
<p>If you need to do this often, @Dee<code>Kej suggested (in the comments) setting</code>Shift<code>+</code>Tab` to insert a real tab with this mapping:</p>
<div class="code"><pre class="code literal-block">:inoremap &lt;S-Tab&gt; &lt;C-V&gt;&lt;Tab&gt;
</pre></div>

<p>Also, as noted by @feedbackloop, on Windows you may need to press <code>&lt;CTRL-Q&gt;</code>
rather than <code>&lt;CTRL-V&gt;</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>You can disable expandtab option from within Vim as below:</p>
<div class="code"><pre class="code literal-block">:set expandtab!
</pre></div>

<p>or</p>
<div class="code"><pre class="code literal-block">:set noet
</pre></div>

<p><strong>PS:</strong> And set it back when you are done with inserting tab, with "set
expandtab" or "set et"</p>
<p><strong>PS:</strong> If you have tab set equivalent to 4 spaces in .vimrc (softtabstop),
you may also like to set it to 8 spaces in order to be able to insert a tab by
pressing tab key once instead of twice (set softtabstop=8).</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-does-the-forall-keyword-in-haskell-ghc-do/" class="u-url">What does the `forall` keyword in Haskell/GHC do?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-does-the-forall-keyword-in-haskell-ghc-do/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T17:42:44+08:00" itemprop="datePublished" title="2023-03-04 17:42">2023-03-04 17:42</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm beginning to understand how the <code>forall</code> keyword is used in so-called
"existential types" like this:</p>
<div class="code"><pre class="code literal-block"><span class="nv">data</span><span class="w"> </span><span class="nv">ShowBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">forall</span><span class="w"> </span><span class="nv">s</span>.<span class="w"> </span><span class="k">Show</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">SB</span><span class="w"> </span><span class="nv">s</span>
</pre></div>

<p>This is only a subset, however, of how <code>forall</code> is used and I simply cannot
wrap my mind around its use in things like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">runST</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">forall</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="w"> </span><span class="n">ST</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span>
</pre></div>

<p>Or explaining why these are different:</p>
<div class="code"><pre class="code literal-block"><span class="n">foo</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="p">(</span><span class="n">forall</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">Char</span><span class="p">,</span><span class="w"> </span><span class="n">Bool</span><span class="p">)</span>
<span class="n">bar</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="p">((</span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">Char</span><span class="p">,</span><span class="w"> </span><span class="n">Bool</span><span class="p">))</span>
</pre></div>

<p>Or the whole <code>RankNTypes</code> stuff...</p>
<p>I tend to prefer clear, jargon-free English rather than the kinds of language
which are normal in academic environments. Most of the explanations I attempt
to read on this (the ones I can find through search engines) have these
problems:</p>
<ol>
<li>They're incomplete. They explain one part of the use of this keyword (like "existential types") which makes me feel happy until I read code that uses it in a completely different way (like <code>runST</code>, <code>foo</code> and <code>bar</code> above).</li>
<li>They're densely packed with assumptions that I've read the latest in whatever branch of discrete math, category theory or abstract algebra is popular this week. (If I never read the words "consult the paper <em>whatever</em> for details of implementation" again, it will be too soon.)</li>
<li>They're written in ways that frequently turn even simple concepts into tortuously twisted and fractured grammar and semantics.</li>
</ol>
<p>So...</p>
<p>On to the actual question. Can anybody completely explain the <code>forall</code> keyword
in clear, plain English (or, if it exists somewhere, point to such a clear
explanation which I've missed) that doesn't assume I'm a mathematician steeped
in the jargon?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Let's start with a code example:</p>
<div class="code"><pre class="code literal-block"><span class="n">foob</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Maybe</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">b</span>
<span class="n">foob</span><span class="w"> </span><span class="n">postProcess</span><span class="w"> </span><span class="n">onNothin</span><span class="w"> </span><span class="n">onJust</span><span class="w"> </span><span class="n">mval</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="n">postProcess</span><span class="w"> </span><span class="n">val</span>
<span class="w">    </span><span class="n">where</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">b</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maybe</span><span class="w"> </span><span class="n">onNothin</span><span class="w"> </span><span class="n">onJust</span><span class="w"> </span><span class="n">mval</span>
</pre></div>

<p>This code doesn't compile (syntax error) in plain Haskell 98. It requires an
extension to support the <code>forall</code> keyword.</p>
<p>Basically, there are 3 <strong>different</strong> common uses for the <code>forall</code> keyword (or
at least so it <em>seems</em> ), and each has its own Haskell extension:
<code>ScopedTypeVariables</code>, <code>RankNTypes</code>/<code>Rank2Types</code>, <code>ExistentialQuantification</code>.</p>
<p>The code above doesn't get a syntax error with either of those enabled, but
only type-checks with <code>ScopedTypeVariables</code> enabled.</p>
<p><strong>Scoped Type Variables:</strong></p>
<p>Scoped type variables helps one specify types for code inside <code>where</code> clauses.
It makes the <code>b</code> in <code>val :: b</code> the same one as the <code>b</code> in <code>foob :: forall a b.
(b -&gt; b) -&gt; b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b</code>.</p>
<p><em>A confusing point</em> : you may hear that when you omit the <code>forall</code> from a type
it is actually still implicitly there. (from Norman's answer: "normally these
languages omit the forall from polymorphic types"). This claim is correct,
<strong>but</strong> it refers to the other uses of <code>forall</code>, and not to the
<code>ScopedTypeVariables</code> use.</p>
<p><strong>Rank-N-Types:</strong></p>
<p>Let's start with that <code>mayb :: b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b</code> is equivalent to
<code>mayb :: forall a b. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b</code>, <strong>except</strong> for when
<code>ScopedTypeVariables</code> is enabled.</p>
<p>This means that it works for every <code>a</code> and <code>b</code>.</p>
<p>Let's say you want to do something like this.</p>
<div class="code"><pre class="code literal-block"><span class="n">ghci</span><span class="o">&gt;</span><span class="w"> </span><span class="n">let</span><span class="w"> </span><span class="n">putInList</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">x</span><span class="o">]</span>
<span class="n">ghci</span><span class="o">&gt;</span><span class="w"> </span><span class="n">liftTup</span><span class="w"> </span><span class="n">putInList</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="ss">"Blah"</span><span class="p">)</span>
<span class="p">(</span><span class="o">[</span><span class="n">5</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">"Blah"</span><span class="o">]</span><span class="p">)</span>
</pre></div>

<p>What must be the type of this <code>liftTup</code>? It's <code>liftTup :: (forall x. x -&gt; f x)
-&gt; (a, b) -&gt; (f a, f b)</code>. To see why, let's try to code it:</p>
<div class="code"><pre class="code literal-block"><span class="n">ghci</span><span class="o">&gt;</span><span class="w"> </span><span class="n">let</span><span class="w"> </span><span class="n">liftTup</span><span class="w"> </span><span class="n">liftFunc</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">liftFunc</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">liftFunc</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="n">ghci</span><span class="o">&gt;</span><span class="w"> </span><span class="n">liftTup</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="ss">"Hello"</span><span class="p">)</span>
<span class="w">    </span><span class="k">No</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Num</span><span class="w"> </span><span class="o">[</span><span class="n">Char</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="p">...</span>
<span class="n">ghci</span><span class="o">&gt;</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="n">huh</span><span class="vm">?</span>
<span class="n">ghci</span><span class="o">&gt;</span><span class="w"> </span><span class="err">:</span><span class="n">t</span><span class="w"> </span><span class="n">liftTup</span>
<span class="n">liftTup</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">t1</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="p">)</span>
</pre></div>

<p>"Hmm.. why does GHC infer that the tuple must contain two of the same type?
Let's tell it they don't have to be"</p>
<div class="code"><pre class="code literal-block"><span class="o">--</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">hs</span>
<span class="n">liftTup</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="n">liftTup</span><span class="w"> </span><span class="n">liftFunc</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">liftFunc</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">liftFunc</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>

<span class="n">ghci</span><span class="o">&gt;</span><span class="w"> </span><span class="o">:</span><span class="n">l</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">hs</span>
<span class="w">    </span><span class="n">Couldnt</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="s">'x'</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="n">inferred</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="s">'b'</span>
<span class="w">    </span><span class="p">...</span>
</pre></div>

<p>Hmm. so here GHC doesn't let us apply <code>liftFunc</code> on <code>v</code> because <code>v :: b</code> and
<code>liftFunc</code> wants an <code>x</code>. We really want our function to get a function that
accepts any possible <code>x</code>!</p>
<div class="code"><pre class="code literal-block"><span class="p">{</span><span class="o">-</span><span class="err">#</span><span class="w"> </span><span class="n">LANGUAGE</span><span class="w"> </span><span class="n">RankNTypes</span><span class="w"> </span><span class="err">#</span><span class="o">-</span><span class="p">}</span>
<span class="n">liftTup</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="p">(</span><span class="n">forall</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="n">liftTup</span><span class="w"> </span><span class="n">liftFunc</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">liftFunc</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">liftFunc</span><span class="w"> </span><span class="n">v</span><span class="p">)</span>
</pre></div>

<p>So it's not <code>liftTup</code> that works for all <code>x</code>, it's the function that it gets
that does.</p>
<p><strong>Existential Quantification:</strong></p>
<p>Let's use an example:</p>
<div class="code"><pre class="code literal-block"><span class="o">--</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">hs</span>
<span class="err">{</span><span class="o">-</span><span class="err">#</span><span class="w"> </span><span class="k">LANGUAGE</span><span class="w"> </span><span class="n">ExistentialQuantification</span><span class="w"> </span><span class="err">#</span><span class="o">-</span><span class="err">}</span>
<span class="k">data</span><span class="w"> </span><span class="n">EQList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="n">EQList</span><span class="w"> </span><span class="o">[</span><span class="n">a</span><span class="o">]</span>
<span class="n">eqListLen</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">EQList</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Int</span>
<span class="n">eqListLen</span><span class="w"> </span><span class="p">(</span><span class="n">EQList</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">x</span>

<span class="n">ghci</span><span class="o">&gt;</span><span class="w"> </span><span class="err">:</span><span class="n">l</span><span class="w"> </span><span class="n">test</span><span class="p">.</span><span class="n">hs</span>
<span class="n">ghci</span><span class="o">&gt;</span><span class="w"> </span><span class="n">eqListLen</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">EQList</span><span class="w"> </span><span class="o">[</span><span class="n">"Hello", "World"</span><span class="o">]</span>
<span class="mi">2</span>
</pre></div>

<p>How is that different from Rank-N-Types?</p>
<div class="code"><pre class="code literal-block"><span class="n">ghci</span><span class="o">&gt;</span><span class="w"> </span><span class="err">:</span><span class="k">set</span><span class="w"> </span><span class="o">-</span><span class="n">XRankNTypes</span>
<span class="n">ghci</span><span class="o">&gt;</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="p">(</span><span class="o">[</span><span class="n">"Hello", "World"</span><span class="o">]</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="o">[</span><span class="n">a</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="n">Couldnt</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="s1">'a'</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="n">inferred</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="s1">'[Char]'</span>
<span class="w">    </span><span class="p">...</span>
</pre></div>

<p>With Rank-N-Types, <code>forall a</code> meant that your expression must fit all possible
<code>a</code>s. For example:</p>
<div class="code"><pre class="code literal-block"><span class="n">ghci</span><span class="o">&gt;</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="p">(</span><span class="err">[]</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="o">[</span><span class="n">a</span><span class="o">]</span><span class="p">)</span>
<span class="mi">0</span>
</pre></div>

<p>An empty list does work as a list of any type.</p>
<p>So with Existential-Quantification, <code>forall</code>s in <code>data</code> definitions mean that,
the value contained <strong>can</strong> be of <strong>any</strong> suitable type, not that it <strong>must</strong>
be of <strong>all</strong> suitable types.</p>
<p><br></p>
<h3>Suggest</h3>
<blockquote>
<p>Can anybody <em>completely</em> explain the forall keyword in clear, plain English?</p>
</blockquote>
<p><strong>No.</strong> (Well, maybe Don Stewart can.)</p>
<p>Here are the barriers to a simple, clear explanation or <code>forall</code>:</p>
<ul>
<li>
<p>It's a quantifier. You have a to have at least a little logic (predicate calculus) to have seen a universal or existential quantifier. If you've never seen predicate calculus or are not comfortable with quantifiers (and I have seen students during PhD qualifying exams who are not comfortable), then for you, there's no easy explanation of <code>forall</code>.</p>
</li>
<li>
<p>It's a <em>type</em> quantifier. If you haven't seen System F and gotten some practice writing polymorphic types, you're going to find <code>forall</code> confusing. Experience with Haskell or ML is not enough, because normally these languages omit the <code>forall</code> from polymorphic types. (In my mind, this is a language-design mistake.)</p>
</li>
<li>
<p>In Haskell in particular, <code>forall</code> is used in ways that I find confusing. (I'm not a type theorist, but my work brings me in contact with a <em>lot</em> of type theory, and I'm quite comfortable with it.) For me, the main source of confusion is that <code>forall</code> is used to encode a type that I myself would prefer to write with <code>exists</code>. It's justified by a tricky bit of type isomorphism involving quantifiers and arrows, and every time I want to understand it, I have to look things up and work out the isomorphism myself.</p>
</li>
</ul>
<p>If you are not comfortable with the idea of type isomorphism, or if you don't
have any practice thinking about type isomorphisms, this use of <code>forall</code> is
going to stymie you.</p>
<ul>
<li>While the general concept of <code>forall</code> is always the same (binding to introduce a type variable), the details of different uses can vary significantly. Informal English is not a very good tool for explaining the variations. To really understand what's going on, you need some mathematics. In this case the relevant mathematics can be found in Benjamin Pierce's introductory text <em>Types and Programming Languages</em> , which is a very good book.</li>
</ul>
<p>As for your particular examples,</p>
<ul>
<li>
<p><code>runST</code> <em>should</em> make your head hurt. Higher-rank types (forall to the left of an arrow) are rarely found in the wild. I encourage you to read the paper that introduced <code>runST</code>: "Lazy Functional State Threads". This is a really good paper, and it will give you a much better intuition for the type of <code>runST</code> in particular and for higher-rank types in general. The explanation take several pages, it's very well done, and I'm not going to try to condense it here.</p>
</li>
<li>
<p>Consider</p>
<div class="code"><pre class="code literal-block"><span class="n">foo</span><span class="w"> </span><span class="o">::</span><span class="w"> </span><span class="p">(</span><span class="n">forall</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">Char</span><span class="p">,</span><span class="n">Bool</span><span class="p">)</span>
</pre></div>

<p>bar :: forall a. ((a -&gt; a) -&gt; (Char, Bool))</p>
</li>
</ul>
<p>If I call <code>bar</code>, I can simply pick any type <code>a</code> that I like, and I can pass it
a function from type <code>a</code> to type <code>a</code>. For example, I can pass the function
<code>(+1)</code> or the function <code>reverse</code>. You can think of the <code>forall</code> as saying "I
get to pick the type now". (The technical word for picking the type is
<em>instantiating</em>.)</p>
<p>The restrictions on calling <code>foo</code> are much more stringent: the argument to
<code>foo</code> <em>must</em> be a polymorphic function. With that type, the only functions I
can pass to <code>foo</code> are <code>id</code> or a function that always diverges or errors, like
<code>undefined</code>. The reason is that with <code>foo</code>, the <code>forall</code> is to the left of the
arrow, so as the caller of <code>foo</code> I don't get to pick what <code>a</code> is—rather it's
the <em>implementation</em> of <code>foo</code> that gets to pick what <code>a</code> is. Because <code>forall</code>
is to the left of the arrow, rather than above the arrow as in <code>bar</code>, the
instantiation takes place in the body of the function rather than at the call
site.</p>
<p><strong>Summary:</strong> A <em>complete</em> explanation of the <code>forall</code> keyword requires math
and can be understood only by someone who has studied the math. Even partial
explanations are hard to understand without math. But maybe my partial, non-
math explanations help a little. Go read Launchbury and Peyton Jones on
<code>runST</code>!</p>
<hr>
<p><strong>Addendum:</strong> Jargon "above", "below", "to the left of". These have nothing to
do with the <em>textual</em> ways types are written and everything to do with
abstract-syntax trees. In the abstract syntax, a <code>forall</code> takes the name of a
type variable, and then there is a full type "below" the forall. An arrow
takes two types (argument and result type) and forms a new type (the function
type). The argument type is "to the left of" the arrow; it is the arrow's left
child in the abstract-syntax tree.</p>
<p>Examples:</p>
<ul>
<li>
<p>In <code>forall a . [a] -&gt; [a]</code>, the forall is above the arrow; what's to the left of the arrow is <code>[a]</code>.</p>
</li>
<li>
<p>In</p>
<div class="code"><pre class="code literal-block"><span class="n">forall</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">forall</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fact</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span>
<span class="w">          </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Block</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Fact</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">f</span>
</pre></div>

</li>
</ul>
<p>the type in parentheses would be called "a forall to the left of an arrow".
(I'm using types like this in an optimizer I'm working on.)</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2461.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2459.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
