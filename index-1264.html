<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1264) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1264.html">
<link rel="prev" href="index-1265.html" type="text/html">
<link rel="next" href="index-1263.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-are-mutable-structs-evil/" class="u-url">Why are mutable structs “evil”?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-are-mutable-structs-evil/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T05:11:29+08:00" itemprop="datePublished" title="2023-02-18 05:11">2023-02-18 05:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Following the discussions here on SO I already read several times the remark
that mutable structs are “evil” (like in the answer to this question).</p>
<p>What's the actual problem with mutability and structs in C#?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Structs are value types which means they are copied when they are passed
around.</p>
<p>So if you change a copy you are changing only that copy, not the original and
not any other copies which might be around.</p>
<p>If your struct is immutable then all automatic copies resulting from being
passed by value will be the same.</p>
<p>If you want to change it you have to consciously do it by creating a new
instance of the struct with the modified data. (not a copy)</p>
<p><br></p>
<h3>Suggest</h3>
<p>Where to start ;-p</p>
<p>Eric Lippert's blog is always good for a quote:</p>
<blockquote>
<p>This is yet another reason why mutable value types are evil. Try to always
make value types immutable.</p>
</blockquote>
<p>First, you tend to lose changes quite easily... for example, getting things
out of a list:</p>
<div class="code"><pre class="code literal-block">Foo foo = list[0];
foo.Name = "abc";
</pre></div>

<p>what did that change? Nothing useful...</p>
<p>The same with properties:</p>
<div class="code"><pre class="code literal-block">myObj.SomeProperty.Size = 22; // the compiler spots this one
</pre></div>

<p>forcing you to do:</p>
<div class="code"><pre class="code literal-block">Bar bar = myObj.SomeProperty;
bar.Size = 22;
myObj.SomeProperty = bar;
</pre></div>

<p>less critically, there is a size issue; mutable objects <strong>tend</strong> to have
multiple properties; yet if you have a struct with two <code>int</code>s, a <code>string</code>, a
<code>DateTime</code> and a <code>bool</code>, you can very quickly burn through a lot of memory.
With a class, multiple callers can share a reference to the same instance
(references are small).</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-deal-with-java-lang-outofmemoryerror-java-heap-space-error/" class="u-url">How to deal with "java.lang.OutOfMemoryError: Java heap space" error?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-deal-with-java-lang-outofmemoryerror-java-heap-space-error/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T05:11:01+08:00" itemprop="datePublished" title="2023-02-18 05:11">2023-02-18 05:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am writing a client-side <strong>Swing</strong> application (graphical font designer) on
<strong>Java 5</strong>. Recently, I am running into <code>java.lang.OutOfMemoryError: Java heap
space</code> error because I am not being conservative on memory usage. The user can
open unlimited number of files, and the program keeps the opened objects in
the memory. After a quick research I found Ergonomics in the 5.0 Java Virtual
Machine and others saying on Windows machine the JVM defaults max heap size as
<code>64MB</code>.</p>
<p>Given this situation, how should I deal with this constraint?</p>
<p>I could increase the <strong>max heap size</strong> using <strong>command line</strong> option to java,
but that would require figuring out available RAM and writing some launching
program or script. Besides, increasing to some <strong>finite</strong> max does not
<strong>ultimately</strong> get rid of the issue.</p>
<p>I could rewrite some of my code to persist objects to file system frequently
(using database is the same thing) to free up the memory. It could work, but
it's probably a lot work too.</p>
<p>If you could point me to details of above ideas or some alternatives like
<strong>automatic virtual memory, extending heap size dynamically</strong> , that will be
great.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Ultimately you always have a finite max of heap to use no matter what platform
you are running on. In Windows 32 bit this is around <code>2GB</code> (not specifically
heap but total amount of memory per process). It just happens that Java
chooses to make the default smaller (presumably so that the programmer can't
create programs that have runaway memory allocation without running into this
problem and having to examine exactly what they are doing).</p>
<p>So this given there are several approaches you could take to either determine
what amount of memory you need or to reduce the amount of memory you are
using. One common mistake with garbage collected languages such as Java or C#
is to keep around references to objects that you <strong>no longer</strong> are using, or
allocating many objects when you could <strong>reuse</strong> them instead. As long as
objects have a reference to them they will continue to use heap space as the
garbage collector will not delete them.</p>
<p>In this case you can use a Java memory profiler to determine what methods in
your program are allocating large number of objects and then determine if
there is a way to make sure they are no longer referenced, or to not allocate
them in the first place. One option which I have used in the past is "JMP"
http://www.khelekore.org/jmp/.</p>
<p>If you determine that you are allocating these objects for a reason and you
need to keep around references (depending on what you are doing this might be
the case), you will just need to increase the max heap size when you start the
program. However, once you do the memory profiling and understand how your
objects are getting allocated you should have a better idea about how much
memory you need.</p>
<p>In general if you can't guarantee that your program will run in some finite
amount of memory (perhaps depending on input size) you will always run into
this problem. Only after exhausting all of this will you need to look into
caching objects out to disk etc. At this point you should have a very good
reason to say "I need Xgb of memory" for something and you can't work around
it by improving your algorithms or memory allocation patterns. Generally this
will only usually be the case for algorithms operating on large datasets (like
a database or some scientific analysis program) and then techniques like
caching and memory mapped IO become useful.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Run Java with the command-line option <code>-Xmx</code>, which sets the <em>maximum</em> size of
the heap.</p>
<p>See here for details.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-do-some-functions-have-underscores-before-and-after-the-function-name/" class="u-url">Why do some functions have underscores "__" before and after the function name?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-do-some-functions-have-underscores-before-and-after-the-function-name/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T05:10:37+08:00" itemprop="datePublished" title="2023-02-18 05:10">2023-02-18 05:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>This "underscoring" seems to occur a lot, and I was wondering if this was a
requirement in the Python language, or merely a matter of convention?</p>
<p>Also, could someone name and explain which functions tend to have the
underscores, and why (<code>__init__</code>, for instance)?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>From the Python PEP 8 -- Style Guide for Python Code:</p>
<blockquote>
<h4>Descriptive: Naming Styles</h4>
<p>The following special forms using leading or trailing underscores are
recognized (these can generally be combined with any case convention):</p>
<ul>
<li>
<p><code>_single_leading_underscore</code>: weak "internal use" indicator. E.g. <code>from
M import *</code> does not import objects whose name starts with an underscore.</p>
</li>
<li>
<p><code>single_trailing_underscore_</code>: used by convention to avoid conflicts
with Python keyword, e.g.</p>
</li>
</ul>
<p><code>Tkinter.Toplevel(master, class_='ClassName')</code></p>
<ul>
<li>
<p><code>__double_leading_underscore</code>: when naming a class attribute, invokes
name mangling (inside class FooBar, <code>__boo</code> becomes <code>_FooBar__boo</code>; see
below).</p>
</li>
<li>
<p><code>__double_leading_and_trailing_underscore__</code>: "magic" objects or
attributes that live in user-controlled namespaces. E.g. <code>__init__</code>,
<code>__import__</code> or <code>__file__</code>. Never invent such names; only use them as
documented.</p>
</li>
</ul>
</blockquote>
<p>Note that names with double leading and trailing underscores are essentially
reserved for Python itself: "Never invent such names; only use them as
documented".</p>
<p><br></p>
<h3>Suggest</h3>
<p>The other respondents are correct in describing the double leading and
trailing underscores as a naming convention for "special" or "magic" methods.</p>
<p>While you can call these methods directly (<code>[10, 20].__len__()</code> for example),
the presence of the underscores is a hint that these methods are intended to
be invoked indirectly (<code>len([10, 20])</code> for example). Most python operators
have an associated "magic" method (for example, <code>a[x]</code> is the usual way of
invoking <code>a.__getitem__(x)</code>).</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1265.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1263.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
