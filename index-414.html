<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 414) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-414.html">
<link rel="prev" href="index-415.html" type="text/html">
<link rel="next" href="index-413.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-remove-files-from-git-staging-area/" class="u-url">How to remove files from git staging area?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-remove-files-from-git-staging-area/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T06:14:50+08:00" itemprop="datePublished" title="2023-02-17 06:14">2023-02-17 06:14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I made changes to some of my files in my local repo, and then I did <code>git add
-A</code> which I think added too many files to the staging area. How can I delete
all the files from the staging area?</p>
<p>After I do that, I'll just manually do <code>git add "filename"</code>.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can unstage files from the index using</p>
<div class="code"><pre class="code literal-block">git reset HEAD -- path/to/file
</pre></div>

<p>Just like <code>git add</code>, you can unstage files recursively by directory and so
forth, so to unstage everything at once, run this from the root directory of
your repository:</p>
<div class="code"><pre class="code literal-block">git reset HEAD -- .
</pre></div>

<p>Also, for future reference, the output of <code>git status</code> will tell you the
commands you need to run to move files from one state to another.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Use</p>
<div class="code"><pre class="code literal-block">git reset
</pre></div>

<p>to unstage all the staged files.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/angular-service-vs-angular-factory/" class="u-url">angular.service vs angular.factory</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/angular-service-vs-angular-factory/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T06:14:20+08:00" itemprop="datePublished" title="2023-02-17 06:14">2023-02-17 06:14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have seen both angular.factory() and angular.service() used to declare
services; however, I cannot find <code>angular.service</code> anywhere in official
documentation.</p>
<p>What is the difference between the two methods?<br>
Which should be used for what (assuming they do different things)?</p>
<p><br><br></p>
<h2>Answer</h2>
<div class="code"><pre class="code literal-block">  angular.service('myService', myServiceFunction);
  angular.factory('myFactory', myFactoryFunction);
</pre></div>

<hr>
<p>I had trouble wrapping my head around this concept until I put it to myself
this way:</p>
<p><strong>Service</strong> : the <em>function</em> that you write will be <strong>new</strong> -ed:</p>
<div class="code"><pre class="code literal-block">  myInjectedService  &lt;----  new myServiceFunction()
</pre></div>

<p><strong>Factory</strong> : the <em>function</em> (constructor) that you write will be <strong>invoked</strong>
:</p>
<div class="code"><pre class="code literal-block">  myInjectedFactory  &lt;---  myFactoryFunction()
</pre></div>

<p>What you do with that is up to you, but there are some useful patterns...</p>
<h4>Such as writing a <em>service</em> function to expose a public API:</h4>
<div class="code"><pre class="code literal-block"><span class="c">function myServiceFunction() {</span>
<span class="c">  this</span><span class="nt">.</span><span class="c">awesomeApi = function(optional) {</span>
<span class="c">    // calculate some stuff</span>
<span class="c">    return awesomeListOfValues;</span>
<span class="c">  }</span>
<span class="c">}</span>
<span class="nb">---------------------------------------------------------------------------------</span>
<span class="c">// Injected in your controller</span>
<span class="c">$scope</span><span class="nt">.</span><span class="c">awesome = myInjectedService</span><span class="nt">.</span><span class="c">awesomeApi();</span>
</pre></div>

<h4>Or using a <em>factory</em> function to expose a public API:</h4>
<div class="code"><pre class="code literal-block"><span class="n">function</span> <span class="n">myFactoryFunction</span>() {
  <span class="n">var</span> <span class="n">aPrivateVariable</span> = <span class="s">"yay"</span>;

  <span class="n">function</span> <span class="n">hello</span>() {
    <span class="k">return</span> <span class="s">"hello mars "</span> + <span class="n">aPrivateVariable</span>;
  }

  // <span class="n">expose</span> <span class="n">a</span> <span class="n">public</span> <span class="n">API</span>
  <span class="k">return</span> {
    <span class="n">hello:</span> <span class="n">hello</span>
  };
}
---------------------------------------------------------------------------------
// <span class="n">Injected</span> <span class="nb">in</span> <span class="n">your</span> <span class="n">controller</span>
<span class="nv">$scope</span>.<span class="n">hello</span> = <span class="n">myInjectedFactory</span>.<span class="n">hello</span>();
</pre></div>

<h4>Or using a <em>factory</em> function to return a constructor:</h4>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">myFactoryFunction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">this</span><span class="o">.</span><span class="n">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>
<span class="o">---------------------------------------------------------------------------------</span>
<span class="o">//</span><span class="w"> </span><span class="n">Injected</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">controller</span>
<span class="k">var</span><span class="w"> </span><span class="n">myShinyNewObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">myInjectedFactory</span><span class="p">();</span>
<span class="o">$</span><span class="n">scope</span><span class="o">.</span><span class="n">four</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myShinyNewObject</span><span class="o">.</span><span class="n">a2</span><span class="p">();</span>
</pre></div>

<hr>
<h4>Which one to use?...</h4>
<p>You can accomplish the same thing with both. However, in some cases the
<em>factory</em> gives you a little bit more flexibility to create an injectable with
a simpler syntax. That's because while myInjectedService must always be an
object, myInjectedFactory can be an object, a function reference, or any value
at all. For example, if you wrote a service to create a constructor (as in the
last example above), it would have to be instantiated like so:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">myShinyNewObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">myInjectedService</span><span class="o">.</span><span class="n">myFunction</span><span class="p">()</span>
</pre></div>

<p>which is arguably less desirable than this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">myShinyNewObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">myInjectedFactory</span><span class="p">();</span>
</pre></div>

<p>(But you should be wary about using this type of pattern in the first place
because <em>new</em> -ing objects in your controllers creates hard-to-track
dependencies that are difficult to mock for testing. Better to have a service
manage a collection of objects for you than use <code>new()</code> wily-nilly.)</p>
<hr>
<h4>One more thing, they are all Singletons...</h4>
<p>Also keep in mind that in both cases, angular is helping you manage a
singleton. Regardless of where or how many times you inject your service or
function, you will get the same reference to the same object or function.
(With the exception of when a factory simply returns a value like a number or
string. In that case, you will always get the same value, but not a
reference.)</p>
<p><br></p>
<h3>Suggest</h3>
<p>Simply put ..</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">firstName</span><span class="p">:</span><span class="w"> </span><span class="s1">'john'</span>
<span class="p">};</span>

<span class="o">//</span><span class="w"> </span><span class="n">Factory</span>
<span class="k">const</span><span class="w"> </span><span class="n">addLastNameFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">lastName</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">  </span><span class="o">...</span><span class="n">user</span><span class="p">,</span>
<span class="w">  </span><span class="n">lastName</span><span class="p">,</span>
<span class="p">});</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">addLastNameFactory</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s1">'doe'</span><span class="p">));</span>

<span class="o">//</span><span class="w"> </span><span class="n">Service</span>
<span class="k">const</span><span class="w"> </span><span class="n">addLastNameService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">lastName</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">user</span><span class="o">.</span><span class="n">lastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastName</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">BAD</span><span class="o">!</span><span class="w"> </span><span class="n">Mutation</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">addLastNameService</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="s1">'doe'</span><span class="p">));</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/save-pl-pgsql-output-from-postgresql-to-a-csv-file/" class="u-url">Save PL/pgSQL output from PostgreSQL to a CSV file</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/save-pl-pgsql-output-from-postgresql-to-a-csv-file/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T06:13:53+08:00" itemprop="datePublished" title="2023-02-17 06:13">2023-02-17 06:13</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What is the easiest way to save PL/pgSQL output from a PostgreSQL database to
a CSV file?</p>
<p>I'm using PostgreSQL 8.4 with pgAdmin III and PSQL plugin where I run queries
from.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Do you want the resulting file on the server, or on the client?</p>
<h2>Server side</h2>
<p>If you want something easy to re-use or automate, you can use Postgresql's
built in COPY command. e.g.</p>
<div class="code"><pre class="code literal-block">Copy (Select * From foo) To '/tmp/test.csv' With CSV DELIMITER ',' HEADER;
</pre></div>

<p><strong>This approach runs entirely on the remote server</strong> - it can't write to your
local PC. It also needs to be run as a Postgres "superuser" (normally called
"root") because Postgres can't stop it doing nasty things with that machine's
local filesystem.</p>
<p>That doesn't actually mean you have to be connected as a superuser (automating
that would be a security risk of a different kind), because you can use the
<code>SECURITY DEFINER</code> option to <code>CREATE FUNCTION</code> to make a function which <em>runs
as though you were a superuser</em>.</p>
<p>The crucial part is that your function is there to perform additional checks,
not just by-pass the security - so you could write a function which exports
the exact data you need, or you could write something which can accept various
options as long as they meet a strict whitelist. You need to check two things:</p>
<ol>
<li>Which <strong>files</strong> should the user be allowed to read/write on disk? This might be a particular directory, for instance, and the filename might have to have a suitable prefix or extension.</li>
<li>Which <strong>tables</strong> should the user be able to read/write in the database? This would normally be defined by <code>GRANT</code>s in the database, but the function is now running as a superuser, so tables which would normally be "out of bounds" will be fully accessible. You probably don’t want to let someone invoke your function and add rows on the end of your “users” table…</li>
</ol>
<p>I've written a blog post expanding on this approach, including some examples
of functions that export (or import) files and tables meeting strict
conditions.</p>
<hr>
<h2>Client side</h2>
<p>The other approach is to <strong>do the file handling on the client side</strong> , i.e. in
your application or script. The Postgres server doesn't need to know what file
you're copying to, it just spits out the data and the client puts it
somewhere.</p>
<p>The underlying syntax for this is the <code>COPY TO STDOUT</code> command, and graphical
tools like pgAdmin will wrap it for you in a nice dialog.</p>
<p>The <strong><code>psql</code> command-line client</strong> has a special "meta-command" called
<strong><code>\copy</code></strong> , which takes all the same options as the "real" <code>COPY</code>, but is
run inside the client:</p>
<div class="code"><pre class="code literal-block">\copy (Select * From foo) To '/tmp/test.csv' With CSV DELIMITER ',' HEADER
</pre></div>

<p>Note that there is no terminating <code>;</code>, because meta-commands are terminated by
newline, unlike SQL commands.</p>
<p>From the docs:</p>
<blockquote>
<p>Do not confuse COPY with the psql instruction \copy. \copy invokes COPY FROM
STDIN or COPY TO STDOUT, and then fetches/stores the data in a file
accessible to the psql client. Thus, file accessibility and access rights
depend on the client rather than the server when \copy is used.</p>
</blockquote>
<p>Your application programming language <em>may</em> also have support for pushing or
fetching the data, but you cannot generally use <code>COPY FROM STDIN</code>/<code>TO STDOUT</code>
within a standard SQL statement, because there is no way of connecting the
input/output stream. PHP's PostgreSQL handler ( <em>not</em> PDO) includes very basic
<code>pg_copy_from</code> and <code>pg_copy_to</code> functions which copy to/from a PHP array,
which may not be efficient for large data sets.</p>
<p><br></p>
<h3>Suggest</h3>
<p>There are several solutions:</p>
<h2>1 <code>psql</code> command</h2>
<p><code>psql -d dbname -t -A -F"," -c "select * from users" &gt; output.csv</code></p>
<p>This has the big advantage that you can using it via SSH, like <code>ssh
postgres@host command</code> - enabling you to get</p>
<h2>2 postgres <code>copy</code> command</h2>
<p><code>COPY (SELECT * from users) To '/tmp/output.csv' With CSV;</code></p>
<h2>3 psql interactive (or not)</h2>
<div class="code"><pre class="code literal-block">&gt;psql dbname
psql&gt;\f ','
psql&gt;\a
psql&gt;\o '/tmp/output.csv'
psql&gt;SELECT * from users;
psql&gt;\q
</pre></div>

<p>All of them can be used in scripts, but I prefer #1.</p>
<h2>4 pgadmin but that's not scriptable.</h2>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-415.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-413.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
