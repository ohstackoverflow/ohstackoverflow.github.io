<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1235) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1235.html">
<link rel="prev" href="index-1236.html" type="text/html">
<link rel="next" href="index-1234.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/random-color-generator/" class="u-url">Random color generator</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/random-color-generator/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:29:16+08:00" itemprop="datePublished" title="2023-02-18 04:29">2023-02-18 04:29</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Given this function, I want to replace the <strong>color</strong> with a random color
generator.</p>
<div class="code"><pre class="code literal-block"><span class="nt">document</span><span class="p">.</span><span class="nc">overlay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">GPolyline</span><span class="p">.</span><span class="nc">fromEncoded</span><span class="o">(</span><span class="p">{</span>
<span class="w">    </span><span class="k">color</span><span class="p">:</span><span class="w"> </span><span class="s2">"#0000FF"</span><span class="p">,</span>
<span class="w">    </span><span class="kc">weight</span><span class="o">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="n">points</span><span class="o">:</span><span class="w"> </span><span class="n">encoded_points</span><span class="p">,</span>
<span class="w">    </span><span class="n">zoomFactor</span><span class="o">:</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span>
<span class="w">    </span><span class="n">levels</span><span class="o">:</span><span class="w"> </span><span class="n">encoded_levels</span><span class="p">,</span>
<span class="w">    </span><span class="n">numLevels</span><span class="o">:</span><span class="w"> </span><span class="mi">4</span>
<span class="p">}</span><span class="o">);</span>
</pre></div>

<p>How can I do it?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Use <code>getRandomColor()</code> in place of <code>"#0000FF"</code>:</p>
<div class="code"><pre class="code literal-block">function<span class="w"> </span>getRandomColor()<span class="w"> </span>{
<span class="w">  </span>var<span class="w"> </span>letters<span class="w"> </span>=<span class="w"> </span>'0123456789ABCDEF';
<span class="w">  </span>var<span class="w"> </span>color<span class="w"> </span>=<span class="w"> </span>'#';
<span class="w">  </span>for<span class="w"> </span>(var<span class="w"> </span>i<span class="w"> </span>=<span class="w"> </span>0;<span class="w"> </span>i<span class="w"> </span><span class="nt">&lt; 6</span><span class="err">;</span><span class="w"> </span><span class="err">i++)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="err">color</span><span class="w"> </span><span class="err">+=</span><span class="w"> </span><span class="err">letters[Math.floor(Math.random()</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">16)];</span>
<span class="w">  </span><span class="err">}</span>
<span class="w">  </span><span class="err">return</span><span class="w"> </span><span class="err">color;</span>
<span class="err">}</span>



<span class="err">function</span><span class="w"> </span><span class="err">setRandomColor()</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="err">$("#colorpad").css("background-color",</span><span class="w"> </span><span class="err">getRandomColor());</span>
<span class="err">}</span>


<span class="err">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">"colorpad"</span><span class="w"> </span><span class="na">style=</span><span class="s">"width:300px;height:300px;background-color:#000"</span><span class="nt">&gt;</span>

<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;button</span><span class="w"> </span><span class="na">onclick=</span><span class="s">"setRandomColor()"</span><span class="nt">&gt;</span>Random<span class="w"> </span>Color<span class="nt">&lt;/button&gt;</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I doubt anything will be faster or shorter than this one:</p>
<div class="code"><pre class="code literal-block"><span class="s2">"#"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="ss">((</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">24</span><span class="ss">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">Math</span>.<span class="k">random</span><span class="ss">()</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span>.<span class="nv">toString</span><span class="ss">(</span><span class="mi">16</span><span class="ss">)</span>.<span class="nv">padStart</span><span class="ss">(</span><span class="mi">6</span>,<span class="w"> </span><span class="s2">"0"</span><span class="ss">)</span>
</pre></div>

<p>Challenge!</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/typedef-function-pointer/" class="u-url">Typedef function pointer?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/typedef-function-pointer/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:28:53+08:00" itemprop="datePublished" title="2023-02-18 04:28">2023-02-18 04:28</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm learning how to dynamically load DLL's but what I don't understand is this
line</p>
<div class="code"><pre class="code literal-block">typedef void (*FunctionFunc)();
</pre></div>

<p>I have a few questions. If someone is able to answer them I would be grateful.</p>
<ol>
<li>Why is <code>typedef</code> used?</li>
<li>The syntax looks odd; after <code>void</code> should there not be a function name or something? It looks like an anonymous function.</li>
<li>Is a function pointer created to store the memory address of a function?</li>
</ol>
<p>So I'm confused at the moment; can you clarify things for me?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><code>typedef</code> is a language construct that associates a name to a type.<br>
You use it the same way you would use the original type, for instance</p>
<div class="code"><pre class="code literal-block">typedef int myinteger;
typedef char *mystring;
typedef void (*myfunc)();
</pre></div>

<p>using them like</p>
<div class="code"><pre class="code literal-block"><span class="n">myinteger</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">equivalent</span><span class="w"> </span><span class="n">to</span><span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="n">mystring</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="k">as</span><span class="w">      </span><span class="nb">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">;</span>
<span class="n">myfunc</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w">      </span><span class="o">//</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="n">equally</span><span class="w"> </span><span class="k">as</span><span class="w">  </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="p">)();</span>
</pre></div>

<p>As you can see, you could just replace the <em>typedefed</em> name with its
definition given above.  </p>
<p>The difficulty lies in the pointer to functions syntax and readability in C
and C++, and the <code>typedef</code> can improve the readability of such declarations.
However, the syntax is appropriate, since functions - unlike other simpler
types - may have a return value and parameters, thus the sometimes lengthy and
complex declaration of a pointer to function.</p>
<p>The readability may start to be really tricky with pointers to functions
arrays, and some other even more indirect flavors.</p>
<p>To answer your three questions</p>
<ul>
<li>
<p><strong>Why is typedef used?</strong> To ease the reading of the code - especially for pointers to functions, or structure names.</p>
</li>
<li>
<p><strong>The syntax looks odd (in the pointer to function declaration)</strong> That syntax is not obvious to read, at least when beginning. Using a <code>typedef</code> declaration instead eases the reading</p>
</li>
<li>
<p><strong>Is a function pointer created to store the memory address of a function?</strong> Yes, a function pointer stores the address of a function. This has nothing to do with the <code>typedef</code> construct which only ease the writing/reading of a program ; the compiler just expands the typedef definition before compiling the actual code.</p>
</li>
</ul>
<p>Example:</p>
<div class="code"><pre class="code literal-block"><span class="n">typedef</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">t_somefunc</span><span class="p">)(</span><span class="nb nb-Type">int</span><span class="p">,</span><span class="nb nb-Type">int</span><span class="p">);</span>

<span class="nb nb-Type">int</span><span class="w"> </span><span class="n">product</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">u</span><span class="o">*</span><span class="n">v</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">t_somefunc</span><span class="w"> </span><span class="n">afunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">product</span><span class="p">;</span>
<span class="o">...</span>
<span class="nb nb-Type">int</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">afunc</span><span class="p">)(</span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="mi">456</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">product</span><span class="p">()</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">calculate</span><span class="w"> </span><span class="mi">123</span><span class="o">*</span><span class="mi">456</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<ol>
<li>
<p><code>typedef</code> is used to alias types; in this case you're aliasing <code>FunctionFunc</code> to <code>void(*)()</code>.</p>
</li>
<li>
<p>Indeed the syntax does look odd, have a look at this:</p>
<div class="code"><pre class="code literal-block">typedef   void      (*FunctionFunc)  ( );
</pre></div>

<p>//         ^                ^         ^
//     return type      type name  arguments</p>
</li>
<li>
<p>No, this simply tells the compiler that the <code>FunctionFunc</code> type will be a function pointer, it doesn't <em>define</em> one, like this:</p>
<div class="code"><pre class="code literal-block">FunctionFunc x;
</pre></div>

<p>void doSomething() { printf("Hello there\n"); }
x = &amp;doSomething;</p>
<p>x(); //prints "Hello there"</p>
</li>
</ol>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/gcc-fpic-option/" class="u-url">GCC -fPIC option</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/gcc-fpic-option/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:28:28+08:00" itemprop="datePublished" title="2023-02-18 04:28">2023-02-18 04:28</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have read about GCC's Options for Code Generation Conventions, but could not
understand what "Generate position-independent code (PIC)" does. Please give
an example to explain me what does it mean.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Position Independent Code means that the generated machine code is not
dependent on being located at a specific address in order to work.</p>
<p>E.g. jumps would be generated as relative rather than absolute.</p>
<p>Pseudo-assembly:</p>
<p>PIC: This would work whether the code was at address 100 or 1000</p>
<div class="code"><pre class="code literal-block"><span class="mi">100</span><span class="o">:</span><span class="w"> </span><span class="n">COMPARE</span><span class="w"> </span><span class="n">REG1</span><span class="o">,</span><span class="w"> </span><span class="n">REG2</span>
<span class="mi">101</span><span class="o">:</span><span class="w"> </span><span class="n">JUMP_IF_EQUAL</span><span class="w"> </span><span class="n">CURRENT</span><span class="o">+</span><span class="mi">10</span>
<span class="o">...</span>
<span class="mi">111</span><span class="o">:</span><span class="w"> </span><span class="n">NOP</span>
</pre></div>

<p>Non-PIC: This will only work if the code is at address 100</p>
<div class="code"><pre class="code literal-block"><span class="mi">100</span><span class="o">:</span><span class="w"> </span><span class="n">COMPARE</span><span class="w"> </span><span class="n">REG1</span><span class="o">,</span><span class="w"> </span><span class="n">REG2</span>
<span class="mi">101</span><span class="o">:</span><span class="w"> </span><span class="n">JUMP_IF_EQUAL</span><span class="w"> </span><span class="mi">111</span>
<span class="o">...</span>
<span class="mi">111</span><span class="o">:</span><span class="w"> </span><span class="n">NOP</span>
</pre></div>

<p>EDIT: In response to comment.</p>
<p>If your code is compiled with -fPIC, it's suitable for inclusion in a library
- the library must be able to be relocated from its preferred location in
memory to another address, there could be another already loaded library at
the address your library prefers.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I'll try to explain what has already been said in a simpler way.</p>
<p>Whenever a shared lib is loaded, the loader (the code on the OS which load any
program you run) changes some addresses in the code depending on where the
object was loaded to.</p>
<p>In the above example, the "111" in the non-PIC code is written by the loader
the first time it was loaded.</p>
<p>For not shared objects, you may want it to be like that because the compiler
can make some optimizations on that code.</p>
<p>For shared object, if another process will want to "link" to that code it must
read it to the same virtual addresses or the "111" will make no sense. But
that virtual-space may already be in use in the second process.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1236.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1234.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
