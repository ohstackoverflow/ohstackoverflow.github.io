<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1117) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1117.html">
<link rel="prev" href="index-1118.html" type="text/html">
<link rel="next" href="index-1116.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-are-the-differences-between-abstract-factory-and-factory-design-patterns/" class="u-url">What are the differences between Abstract Factory and Factory design patterns?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-are-the-differences-between-abstract-factory-and-factory-design-patterns/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T01:39:55+08:00" itemprop="datePublished" title="2023-02-18 01:39">2023-02-18 01:39</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I know there are many posts out there about the differences between these two
patterns, but there are a few things that I cannot find.</p>
<p>From what I have been reading, I see that the factory method pattern allows
you to define how to create a single concrete product but hiding the
implementation from the client as they will see a generic product. My first
question is about the abstract factory. Is its role to allow you to create
families of concrete objects in (that can depend on what specific factory you
use) rather than just a single concrete object? Does the abstract factory only
return one very large object or many objects depending on what methods you
call?</p>
<p>My final two questions are about a single quote that I cannot fully understand
that I have seen in numerous places:</p>
<blockquote>
<p>One difference between the two is that with the Abstract Factory pattern, a
class delegates the responsibility of object instantiation to another object
via composition whereas the Factory Method pattern uses inheritance and
relies on a subclass to handle the desired object instantiation.</p>
</blockquote>
<p>My understanding is that the factory method pattern has a Creator interface
that will make the ConcreteCreator be in charge of knowing which
ConcreteProduct to instantiate. Is this what it means by using inheritance to
handle object instantiation?</p>
<p>Now with regards to that quote, how exactly does the Abstract Factory pattern
delegate the responsibility of object instantiation to another object via
composition? What does this mean? It looks like the Abstract Factory pattern
also uses inheritance to do the construction process as well in my eyes, but
then again I am still learning about these patterns.</p>
<p>Any help especially with the last question, would be greatly appreciated.</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>The Difference Between The Two</h3>
<p>The main difference between a "factory method" and an "abstract factory" is
that the factory method is a method, and an abstract factory is an object. I
think a lot of people get these two terms confused, and start using them
interchangeably. I remember that I had a hard time finding exactly what the
difference was when I learnt them.</p>
<p>Because the factory method is just a method, it can be overridden in a
subclass, hence the second half of your quote:</p>
<blockquote>
<p>... the Factory Method pattern uses inheritance and relies on a subclass to
handle the desired object instantiation.</p>
</blockquote>
<p>The quote assumes that an object is calling <em>its own</em> factory method here.
Therefore the only thing that could change the return value would be a
subclass.</p>
<p>The abstract factory is an object that has multiple factory methods on it.
Looking at the first half of your quote:</p>
<blockquote>
<p>... with the Abstract Factory pattern, a class delegates the responsibility
of object instantiation to another object via composition ...</p>
</blockquote>
<p>What they're saying is that there is an object A, who wants to make a Foo
object. Instead of making the Foo object itself (e.g., with a factory method),
it's going to get a <em>different</em> object (the abstract factory) to create the
Foo object.</p>
<h3>Code Examples</h3>
<p>To show you the difference, here is a factory method in use:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">doSomething</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Foo</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">makeFoo</span><span class="p">();</span>
<span class="w">        </span><span class="n">f</span><span class="o">.</span><span class="n">whatever</span><span class="p">();</span><span class="w">   </span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="n">makeFoo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RegularFoo</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="n">makeFoo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="n">subclass</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">overriding</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="n">method</span><span class="w"> </span>
<span class="w">        </span><span class="o">//</span><span class="n">to</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">different</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">SpecialFoo</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>And here is an abstract factory in use:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">Factory</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">A</span><span class="p">(</span><span class="n">Factory</span><span class="w"> </span><span class="n">factory</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">this</span><span class="o">.</span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">doSomething</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="n">The</span><span class="w"> </span><span class="n">concrete</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="s2">"f"</span><span class="w"> </span><span class="n">depends</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">concrete</span><span class="w"> </span><span class="k">class</span>
<span class="w">        </span><span class="o">//</span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">constructor</span><span class="o">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">provide</span><span class="w"> </span><span class="n">a</span>
<span class="w">        </span><span class="o">//</span><span class="n">different</span><span class="w"> </span><span class="n">factory</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="n">object</span><span class="o">.</span>
<span class="w">        </span><span class="n">Foo</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="o">.</span><span class="n">makeFoo</span><span class="p">();</span>
<span class="w">        </span><span class="n">f</span><span class="o">.</span><span class="n">whatever</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">interface</span><span class="w"> </span><span class="n">Factory</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">makeFoo</span><span class="p">();</span>
<span class="w">    </span><span class="n">Bar</span><span class="w"> </span><span class="n">makeBar</span><span class="p">();</span>
<span class="w">    </span><span class="n">Aycufcn</span><span class="w"> </span><span class="n">makeAmbiguousYetCommonlyUsedFakeClassName</span><span class="p">();</span>
<span class="p">}</span>

<span class="o">//</span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">concrete</span><span class="w"> </span><span class="n">factories</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s2">"Factory"</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="n">here</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p><strong>Abstract factory</strong> creates a base class with abstract methods defining
methods for the objects that should be created. Each factory class which
derives the base class can create their own implementation of each object
type.</p>
<p><img alt="enter image description
here" src="https://upload.wikimedia.org/wikipedia/commons/b/b8/AbstractFactory.png"></p>
<p><strong>Factory method</strong> is just a simple method used to create objects in a class.
It's usually added in the aggregate root (The <code>Order</code> class has a method
called <code>CreateOrderLine</code>)</p>
<p><img alt="enter image description
here" src="https://upload.wikimedia.org/wikipedia/commons/e/ed/Factory_Method_UML_class_diagram.png"></p>
<h3>Abstract factory</h3>
<p>In the example below we design an interface so that we can decouple queue
creation from a messaging system and can therefore create implementations for
different queue systems without having to change the code base.</p>
<div class="code"><pre class="code literal-block"><span class="nv">interface</span><span class="w"> </span><span class="nv">IMessageQueueFactory</span>
{
<span class="w">  </span><span class="nv">IMessageQueue</span><span class="w"> </span><span class="nv">CreateOutboundQueue</span><span class="ss">(</span><span class="nv">string</span><span class="w"> </span><span class="nv">name</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">  </span><span class="nv">IMessageQueue</span><span class="w"> </span><span class="nv">CreateReplyQueue</span><span class="ss">(</span><span class="nv">string</span><span class="w"> </span><span class="nv">name</span><span class="ss">)</span><span class="c1">;</span>
}

<span class="nv">public</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">AzureServiceBusQueueFactory</span><span class="w"> </span>:<span class="w"> </span><span class="nv">IMessageQueueFactory</span>
{
<span class="w">      </span><span class="nv">IMessageQueue</span><span class="w"> </span><span class="nv">CreateOutboundQueue</span><span class="ss">(</span><span class="nv">string</span><span class="w"> </span><span class="nv">name</span><span class="ss">)</span>
<span class="w">      </span>{
<span class="w">           </span><span class="o">//</span><span class="nv">init</span><span class="w"> </span><span class="nv">queue</span>
<span class="w">           </span><span class="k">return</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">AzureMessageQueue</span><span class="ss">(</span><span class="cm">/*....*/</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">      </span>}

<span class="w">      </span><span class="nv">IMessageQueue</span><span class="w"> </span><span class="nv">CreateReplyQueue</span><span class="ss">(</span><span class="nv">string</span><span class="w"> </span><span class="nv">name</span><span class="ss">)</span>
<span class="w">      </span>{
<span class="w">           </span><span class="o">//</span><span class="nv">init</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="nv">queue</span>
<span class="w">           </span><span class="k">return</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">AzureResponseMessageQueue</span><span class="ss">(</span><span class="cm">/*....*/</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">      </span>}

}

<span class="nv">public</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">MsmqFactory</span><span class="w"> </span>:<span class="w"> </span><span class="nv">IMessageQueueFactory</span>
{
<span class="w">      </span><span class="nv">IMessageQueue</span><span class="w"> </span><span class="nv">CreateOutboundQueue</span><span class="ss">(</span><span class="nv">string</span><span class="w"> </span><span class="nv">name</span><span class="ss">)</span>
<span class="w">      </span>{
<span class="w">           </span><span class="o">//</span><span class="nv">init</span><span class="w"> </span><span class="nv">queue</span>
<span class="w">           </span><span class="k">return</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">MsmqMessageQueue</span><span class="ss">(</span><span class="cm">/*....*/</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">      </span>}

<span class="w">      </span><span class="nv">IMessageQueue</span><span class="w"> </span><span class="nv">CreateReplyQueue</span><span class="ss">(</span><span class="nv">string</span><span class="w"> </span><span class="nv">name</span><span class="ss">)</span>
<span class="w">      </span>{
<span class="w">           </span><span class="o">//</span><span class="nv">init</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="nv">queue</span>
<span class="w">           </span><span class="k">return</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">MsmqResponseMessageQueue</span><span class="ss">(</span><span class="cm">/*....*/</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">      </span>}
}
</pre></div>

<h3>Factory method</h3>
<p>The problem in HTTP servers is that we always need an response for every
request.</p>
<div class="code"><pre class="code literal-block">public interface IHttpRequest
{
    // .. all other methods ..

    IHttpResponse CreateResponse(int httpStatusCode);
}
</pre></div>

<p>Without the factory method, the HTTP server users (i.e. programmers) would be
forced to use implementation specific classes which defeat the purpose of the
<code>IHttpRequest</code> interface.</p>
<p>Therefore we introduce the factory method so that the creation of the response
class also is abstracted away.</p>
<h3>Summary</h3>
<p>The difference is that the <strong>intended purpose</strong> of the class containing a
factory method <strong>is not to create objects</strong> , while an abstract factory should
only be used to create objects.</p>
<p>One should take care when using factory methods since it's easy to break the
LSP (Liskov Substitution principle) when creating objects.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/is-javascript-s-new-keyword-considered-harmful/" class="u-url">Is JavaScript's "new" keyword considered harmful?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/is-javascript-s-new-keyword-considered-harmful/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T01:38:40+08:00" itemprop="datePublished" title="2023-02-18 01:38">2023-02-18 01:38</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In another question, a user pointed out that the <code>new</code> keyword was dangerous
to use and proposed a solution to object creation that did not use <code>new</code>. I
didn't believe that was true, mostly because I've used Prototype,
Script.aculo.us and other excellent JavaScript libraries, and everyone of them
used the <code>new</code> keyword.</p>
<p>In spite of that, yesterday I was watching Douglas Crockford's talk at YUI
theater and he said the exactly same thing, that he didn't use the <code>new</code>
keyword anymore in his code (Crockford on JavaScript - Act III: Function the
Ultimate - 50:23 minutes).</p>
<p>Is it 'bad' to use the <code>new</code> keyword? What are the advantages and
disadvantages of using it?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Crockford has done a lot to popularize good JavaScript techniques. His
opinionated stance on key elements of the language have sparked many useful
discussions. That said, there are far too many people that take each
proclamation of "bad" or "harmful" as gospel, refusing to look beyond one
man's opinion. It can be a bit frustrating at times.</p>
<p>Use of the functionality provided by the <code>new</code> keyword has several advantages
over building each object from scratch:</p>
<ol>
<li>Prototype inheritance. While often looked at with a mix of suspicion and derision by those accustomed to class-based OO languages, JavaScript's native inheritance technique is a simple and surprisingly effective means of code re-use. And the <code>new</code> keyword is the canonical (and only available cross-platform) means of using it.</li>
<li>Performance. This is a side-effect of #1: if I want to add 10 methods to every object I create, I <em>could</em> just write a creation function that manually assigns each method to each new object... Or, I could assign them to the creation function's <code>prototype</code> and use <code>new</code> to stamp out new objects. Not only is this faster (no code needed for each and every method on the prototype), it avoids ballooning each object with separate properties for each method. On slower machines (or especially, slower JS interpreters) when many objects are being created this can mean a significant savings in time and memory.</li>
</ol>
<p>And yes, <code>new</code> has one crucial disadvantage, ably described by other answers:
if you forget to use it, your code will break without warning. Fortunately,
that disadvantage is easily mitigated - simply add a bit of code to the
function itself:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">accidentally</span><span class="w"> </span><span class="n">omits</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">keyword</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">will</span><span class="w"> </span>
<span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">silently</span><span class="w"> </span><span class="n">correct</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">problem</span><span class="k">...</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>!<span class="p">(</span><span class="n">this</span><span class="w"> </span><span class="n">instanceof</span><span class="w"> </span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">foo</span><span class="p">();</span>

<span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="n">follows</span><span class="k">...</span>
<span class="p">}</span>
</pre></div>

<p>Now you can have the advantages of <code>new</code> without having to worry about
problems caused by accidentally misuse.</p>
<p>John Resig goes into detail on this technique in his Simple "Class"
Instantiation post, as well as including a means of building this behavior
into your "classes" by default. Definitely worth a read... as is his upcoming
book, Secrets of the JavaScript Ninja, which finds hidden gold in this and
many other "harmful" features of the JavaScript language (the <strong>chapter</strong> on
<code>with</code> is especially enlightening for those of us who initially dismissed this
much-maligned feature as a gimmick).</p>
<h3>A general-purpose sanity check</h3>
<p>You could even add an assertion to the check if the thought of broken code
silently working bothers you. Or, as some commented, use the check to
introduce a runtime exception:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="w"> </span><span class="o">!</span><span class="ss">(</span><span class="nv">this</span><span class="w"> </span><span class="nv">instanceof</span><span class="w"> </span><span class="nv">arguments</span>.<span class="nv">callee</span><span class="ss">)</span><span class="w"> </span><span class="ss">)</span><span class="w"> </span>
<span class="w">   </span><span class="nv">throw</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Error</span><span class="ss">(</span><span class="s2">"Constructor called as a function"</span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>Note that this snippet is able to avoid hard-coding the constructor function
name, as unlike the previous example it has no need to actually instantiate
the object - therefore, it can be copied into each target function without
modification.</p>
<h4>ES5 taketh away</h4>
<p>As Sean McMillan, stephenbez and jrh noted, the use of <code>arguments.callee</code> is
invalid in ES5's strict mode. So the above pattern will throw an error if you
use it in that context.</p>
<h4>ES6 and an entirely harmless <code>new</code>
</h4>
<p>ES6 introduces Classes to JavaScript - no, not in the weird Java-aping way
that old-school Crockford did, but in spirit much more like the light-weight
way he (and others) later adopted, taking the best parts of prototypal
inheritance and baking common patterns into the language itself.</p>
<p>...and part of that includes a safe <code>new</code>:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">foo</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">constructor</span><span class="p">()</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">ONLY</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">hit</span><span class="w"> </span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">properly</span><span class="w"> </span><span class="n">constructed</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">new</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">bad</span><span class="w"> </span><span class="n">invocation</span>
<span class="n">foo</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">throws</span><span class="p">,</span><span class="w"> </span>
<span class="o">//</span><span class="w"> </span><span class="n">Uncaught</span><span class="w"> </span><span class="n">TypeError</span><span class="p">:</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">constructors</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">invoked</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="s1">'new'</span>
</pre></div>

<p>But what if you don't <em>want</em> to use the new sugar? What if you just want to
update your perfectly fine old-style prototypal code with the sort of safety
checks shown above such that they keep working in strict mode?</p>
<p>Well, as Nick Parsons notes, ES6 provides a handy check for that as well, in
the form of <code>new.target</code>:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>!<span class="p">(</span><span class="n">new</span><span class="p">.</span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<span class="w">     </span><span class="nb">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="s">"Constructor called as a function"</span><span class="p">);</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="n">follows</span><span class="k">...</span>
<span class="p">}</span>
</pre></div>

<p>So whichever approach you choose, you can - with a bit of thought and good
hygiene - use <code>new</code> without harm.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I have just read some parts of Crockford's book "JavaScript: The Good Parts".
I get the feeling that he considers everything that ever has bitten him as
harmful:</p>
<p>About switch fall through:</p>
<blockquote>
<p>I never allow switch cases to fall through to the next case. I once found a
bug in my code caused by an unintended fall through immediately after having
made a vigorous speech about why fall through was sometimes useful. (page
97, ISBN 978-0-596-51774-8)</p>
</blockquote>
<p>About ++ and --:</p>
<blockquote>
<p>The ++ (increment) and -- (decrement) operators have been known to
contribute to bad code by encouraging excessive trickiness. They are second
only to faulty architecture in enabling viruses and other security menaces.
(page 122)</p>
</blockquote>
<p>About new:</p>
<blockquote>
<p>If you forget to include the <em>new</em> prefix when calling a constructor
function, then <em>this</em> will not be bound to the new object. Sadly, <em>this</em>
will be bound to the global object, so instead of augmenting your new
object, you will be clobbering global variables. That is really bad. There
is no compile warning, and there is no runtime warning. (page 49)</p>
</blockquote>
<p>There are more, but I hope you get the picture.</p>
<p>My answer to your question: <strong>No, it's not harmful.</strong> but if you forget to use
it when you should you could have some problems. If you are developing in a
good environment you notice that.</p>
<p>In the 5th edition of ECMAScript there is support for strict mode. In strict
mode, <code>this</code> is no longer bound to the global object, but to <code>undefined</code>.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-write-a-test-which-expects-an-error-to-be-thrown-in-jasmine/" class="u-url">How can I write a test which expects an 'Error' to be thrown in Jasmine?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-write-a-test-which-expects-an-error-to-be-thrown-in-jasmine/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T01:38:15+08:00" itemprop="datePublished" title="2023-02-18 01:38">2023-02-18 01:38</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to write a test for the Jasmine Test Framework which expects an
error. At the moment I'm using a Jasmine Node.js integration from GitHub.</p>
<p>In my Node.js module I have the following code:</p>
<div class="code"><pre class="code literal-block">throw new Error("Parsing is not possible");
</pre></div>

<p>Now I try to write a test which expects this error:</p>
<div class="code"><pre class="code literal-block">describe('my suite...', function() {
    [..]
    it('should not parse foo', function() {
    [..]
        expect(parser.parse(raw)).toThrow(new Error("Parsing is not possible"));
    });
});
</pre></div>

<p>I tried also <code>Error()</code> and some other variants and just can't figure out how
to make it work.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Try using an anonymous function instead:</p>
<div class="code"><pre class="code literal-block">expect( function(){ parser.parse(raw); } ).toThrow(new Error("Parsing is not possible"));
</pre></div>

<p>you should be passing a function into the <code>expect(...)</code> call. Your incorrect
code:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// incorrect:</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parser</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">raw</span><span class="p">)).</span><span class="n">toThrow</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="s">"Parsing is not possible"</span><span class="p">));</span>
</pre></div>

<p>is trying to actually <strong>call</strong> <code>parser.parse(raw)</code> in an attempt to pass the
result into <code>expect(...)</code>,</p>
<p><br></p>
<h3>Suggest</h3>
<p>You are using:</p>
<div class="code"><pre class="code literal-block">expect(fn).toThrow(e)
</pre></div>

<p>But if you'll have a look on the function comment (expected is string):</p>
<div class="code"><pre class="code literal-block"><span class="mf">294</span><span class="w"> </span><span class="o">/**</span>
<span class="mf">295</span><span class="w">  </span><span class="o">*</span><span class="w"> </span><span class="n">Matcher</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">checks</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nb">exp</span><span class="n">ected</span><span class="w"> </span><span class="n">exception</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">thrown</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">actual</span><span class="mf">.</span>
<span class="mf">296</span><span class="w">  </span><span class="o">*</span>
<span class="mf">297</span><span class="w">  </span><span class="o">*</span><span class="w"> </span><span class="err">@</span><span class="n">param</span><span class="w"> </span><span class="err">{</span><span class="n">String</span><span class="err">}</span><span class="w"> </span><span class="nb">exp</span><span class="n">ected</span>
<span class="mf">298</span><span class="w">  </span><span class="o">*/</span>
<span class="mf">299</span><span class="w"> </span><span class="n">jasmine</span><span class="mf">.</span><span class="n">Matchers</span><span class="mf">.</span><span class="n">prototype</span><span class="mf">.</span><span class="kr">to</span><span class="n">Throw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="nb">exp</span><span class="n">ected</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
</pre></div>

<p>I suppose you should probably write it like this (using lambda - anonymous
function):</p>
<div class="code"><pre class="code literal-block">expect(function() { parser.parse(raw); } ).toThrow("Parsing is not possible");
</pre></div>

<p>This is confirmed in the following example:</p>
<div class="code"><pre class="code literal-block">expect(function () {throw new Error("Parsing is not possible")}).toThrow("Parsing is not possible");
</pre></div>

<p>Douglas Crockford strongly recommends this approach, instead of using "throw
new Error()" (prototyping way):</p>
<div class="code"><pre class="code literal-block">throw {
   name: "Error",
   message: "Parsing is not possible"
}
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1118.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1116.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
