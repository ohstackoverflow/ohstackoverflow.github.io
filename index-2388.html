<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2388) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2388.html">
<link rel="prev" href="index-2389.html" type="text/html">
<link rel="next" href="index-2387.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/combining-c-and-c-how-does-ifdef-cplusplus-work/" class="u-url">Combining C++ and C - how does #ifdef __cplusplus work?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/combining-c-and-c-how-does-ifdef-cplusplus-work/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T12:26:28+08:00" itemprop="datePublished" title="2023-03-04 12:26">2023-03-04 12:26</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm working on a project that has a lot of legacy <strong>C</strong> code. We've started
writing in C++, with the intent to eventually convert the legacy code, as
well. I'm a little confused about how the <strong>C</strong> and C++ interact. I understand
that by wrapping the <strong>C</strong> code with <code>extern "C"</code> the C++ compiler will not
mangle the <strong>C</strong> code's names, but I'm not entirely sure how to implement
this.</p>
<p>So, at the top of each <strong>C</strong> header file (after the include guards), we have</p>
<div class="code"><pre class="code literal-block"><span class="cp">#ifdef __cplusplus</span>
<span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#endif</span>
</pre></div>

<p>and at the bottom, we write</p>
<div class="code"><pre class="code literal-block"><span class="cp">#ifdef __cplusplus</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>

<p>In between the two, we have all of our includes, typedefs, and function
prototypes. I have a few questions, to see if I'm understanding this
correctly:</p>
<ol>
<li>
<p>If I have a C++ file A.hh which includes a <strong>C</strong> header file B.h, includes another <strong>C</strong> header file C.h, how does this work? I think that when the compiler steps into B.h, <code>__cplusplus</code> will be defined, so it will wrap the code with <code>extern "C"</code> (and <code>__cplusplus</code> will not be defined inside this block). So, when it steps into C.h, <code>__cplusplus</code> will not be defined and the code will not be wrapped in <code>extern "C"</code>. Is this correct?</p>
</li>
<li>
<p>Is there anything wrong with wrapping a piece of code with <code>extern "C" { extern "C" { .. } }</code>? What will the second <code>extern "C"</code> do?</p>
</li>
<li>
<p>We don't put this wrapper around the .c files, just the .h files. So, what happens if a function doesn't have a prototype? Does the compiler think that it's a C++ function?</p>
</li>
<li>
<p>We are also using some third-party code which is written in <strong>C</strong> , and does not have this sort of wrapper around it. Any time I include a header from that library, I've been putting an <code>extern "C"</code> around the #include. Is this the right way to deal with that?</p>
</li>
<li>
<p>Finally, is this set up a good idea? Is there anything else we should do? We're going to be mixing <strong>C</strong> and C++ for the foreseeable future, and I want to make sure we're covering all our bases.</p>
</li>
</ol>
<p><br><br></p>
<h2>Answer</h2>
<p><code>extern "C"</code> doesn't really change the way that the compiler reads the code.
If your code is in a .c file, it will be compiled as C, if it is in a .cpp
file, it will be compiled as C++ (unless you do something strange to your
configuration).</p>
<p>What <code>extern "C"</code> does is affect linkage. C++ functions, when compiled, have
their names mangled -- this is what makes overloading possible. The function
name gets modified based on the types and number of parameters, so that two
functions with the same name will have different symbol names.</p>
<p>Code inside an <code>extern "C"</code> is still C++ code. There are limitations on what
you can do in an extern "C" block, but they're all about linkage. You can't
define any new symbols that can't be built with C linkage. That means no
classes or templates, for example.</p>
<p><code>extern "C"</code> blocks nest nicely. There's also <code>extern "C++"</code> if you find
yourself hopelessly trapped inside of <code>extern "C"</code> regions, but it isn't such
a good idea from a cleanliness perspective.</p>
<p>Now, specifically regarding your numbered questions:</p>
<p>Regarding #1: __cplusplus will stay defined inside of <code>extern "C"</code> blocks.
This doesn't matter, though, since the blocks should nest neatly.</p>
<p>Regarding #2: __cplusplus will be defined for any compilation unit that is
being run through the C++ compiler. Generally, that means .cpp files and any
files being included by that .cpp file. The same .h (or .hh or .hpp or what-
have-you) could be interpreted as C or C++ at different times, if different
compilation units include them. If you want the prototypes in the .h file to
refer to C symbol names, then they must have <code>extern "C"</code> when being
interpreted as C++, and they should not have <code>extern "C"</code> when being
interpreted as C -- hence the <code>#ifdef __cplusplus</code> checking.</p>
<p>To answer your question #3: functions without prototypes will have C++ linkage
if they are in .cpp files and not inside of an <code>extern "C"</code> block. This is
fine, though, because if it has no prototype, it can only be called by other
functions in the same file, and then you don't generally care what the linkage
looks like, because you aren't planning on having that function be called by
anything outside the same compilation unit anyway.</p>
<p>For #4, you've got it exactly. If you are including a header for code that has
C linkage (such as code that was compiled by a C compiler), then you must
<code>extern "C"</code> the header -- that way you will be able to link with the library.
(Otherwise, your linker would be looking for functions with names like
<code>_Z1hic</code> when you were looking for <code>void h(int, char)</code></p>
<p>5: This sort of mixing is a common reason to use <code>extern "C"</code>, and I don't see
anything wrong with doing it this way -- just make sure you understand what
you are doing.</p>
<p><br></p>
<h3>Suggest</h3>
<ol>
<li>
<p><code>extern "C"</code> doesn't change the presence or absence of the <code>__cplusplus</code> macro. It just changes the linkage and name-mangling of the wrapped declarations.</p>
</li>
<li>
<p>You can nest <code>extern "C"</code> blocks quite happily.</p>
</li>
<li>
<p>If you compile your <code>.c</code> files as C++ then anything not in an <code>extern "C"</code> block, and without an <code>extern "C"</code> prototype will be treated as a C++ function. If you compile them as C then of course everything will be a C function.</p>
</li>
<li>
<p>Yes</p>
</li>
<li>
<p>You can safely mix C and C++ in this way.</p>
</li>
</ol>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/differences-between-express-router-and-app-get/" class="u-url">Differences between express.Router and app.get?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/differences-between-express-router-and-app-get/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T12:25:03+08:00" itemprop="datePublished" title="2023-03-04 12:25">2023-03-04 12:25</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm starting with NodeJS and Express 4, and I'm a bit confused. I been reading
the Express website, but can't see <em>when</em> to use a route handler or when to
use <code>express.Router</code>.</p>
<p>As I could see, if I want to show a page or something when the user hits
<code>/show</code> for example I should use:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span><span class="w">    </span>
<span class="k">var</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">express</span><span class="p">()</span><span class="w">    </span>
<span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/show"</span><span class="p">,</span><span class="w"> </span><span class="n">someFunction</span><span class="p">)</span>
</pre></div>

<p>At the beginning, I thought this was old (for Express 3). Is that right or
this is the way for Express 4 too?</p>
<p>If this is the way to do it in Express 4, what is <code>express.Router</code> used for?</p>
<p>I read almost the same example as above but using <code>express.Router</code>:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">express</span><span class="o">.</span><span class="n">Router</span><span class="p">();</span>
<span class="n">router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/show"</span><span class="p">,</span><span class="w"> </span><span class="n">someFunction</span><span class="p">)</span>
</pre></div>

<p>So, what's the difference between both examples?</p>
<p>Which one should I use if I just want to do a simple testing website?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>app.js</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">),</span>
<span class="w">    </span><span class="n">dogs</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'./routes/dogs'</span><span class="p">),</span>
<span class="w">    </span><span class="n">cats</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'./routes/cats'</span><span class="p">),</span>
<span class="w">    </span><span class="n">birds</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'./routes/birds'</span><span class="p">);</span>

<span class="k">var</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">express</span><span class="p">();</span>

<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'/dogs'</span><span class="p">,</span><span class="w">  </span><span class="n">dogs</span><span class="p">);</span>
<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'/cats'</span><span class="p">,</span><span class="w">  </span><span class="n">cats</span><span class="p">);</span>
<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">'/birds'</span><span class="p">,</span><span class="w"> </span><span class="n">birds</span><span class="p">);</span>

<span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</pre></div>

<p><strong>dogs.js</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>

<span class="k">var</span><span class="w"> </span><span class="n">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">express</span><span class="o">.</span><span class="n">Router</span><span class="p">();</span>

<span class="n">router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">'GET handler for /dogs route.'</span><span class="p">);</span>
<span class="p">});</span>

<span class="n">router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">res</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">'POST handler for /dogs route.'</span><span class="p">);</span>
<span class="p">});</span>

<span class="n">module</span><span class="o">.</span><span class="n">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">router</span><span class="p">;</span>
</pre></div>

<p>When <code>var app = express()</code> is called, an app object is returned. Think of this
as the <strong>main app</strong>.</p>
<p>When <code>var router = express.Router()</code> is called, a slightly different <strong>mini
app</strong> is returned. The idea behind the <strong>mini app</strong> is that each route in your
app can become quite complicated, and you'd benefit from moving all that code
into a separate file. Each file's router becomes a <strong>mini app</strong> , which has a
very similar structure to the <strong>main app</strong>.</p>
<p>In the example above, the code for the <strong>/dogs</strong> route has been moved into its
own file so it doesn't clutter up the <strong>main app</strong>. The code for <strong>/cats</strong> and
<strong>/birds</strong> would be structured similarly in their own files. By separating
this code into three <strong>mini apps</strong> , you can work on the logic for each one in
isolation, and not worry about how it will affect the other two.</p>
<p>If you have code (middleware) that pertains to all three routes, you can put
it in the <strong>main app</strong> , before the <code>app.use(...)</code> calls. If you have code
(middleware) that pertains to just one of those routes, you can put it in the
file for that route only.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Express 4.0 comes with the new Router. As mentioned on the site:</p>
<blockquote>
<p>The express.Router class can be used to create modular mountable route
handlers. A Router instance is a complete middleware and routing system; for
this reason it is often referred to as a “mini-app”.</p>
</blockquote>
<p>There is a good article at https://scotch.io/tutorials/learn-to-use-the-new-
router-in-expressjs-4 which describes the differences and what can be done
with routers.</p>
<p><strong>To summarize</strong></p>
<p>With routers you can modularize your code more easily. You can use routers as:</p>
<blockquote>
<ol>
<li>Basic Routes: Home, About</li>
<li>Route Middleware to log requests to the console</li>
<li>Route with Parameters</li>
<li>Route Middleware for Parameters to validate specific parameters</li>
<li>Validates a parameter passed to a certain route
</li>
</ol>
</blockquote>
<p>Note:</p>
<p>The <code>app.router</code> object, which was removed in Express 4, has made a comeback
in Express 5. In the new version, it is a just a reference to the base Express
router, unlike in Express 3, where an app had to explicitly load it.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-a-typetag-and-how-do-i-use-it/" class="u-url">What is a TypeTag and how do I use it?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-a-typetag-and-how-do-i-use-it/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T12:23:53+08:00" itemprop="datePublished" title="2023-03-04 12:23">2023-03-04 12:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>All I know about TypeTags is that they somehow replaced Manifests. Information
on the Internet is scarce and doesn't provide me with a good sense of the
subject.</p>
<p>So I'd be happy if someone shared a link to some useful materials on TypeTags
including examples and popular use-cases. Detailed answers and explanations
are also welcome.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>A <code>TypeTag</code> solves the problem that Scala's types are erased at runtime (type
erasure). If we wanna do</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">Foo</span>
<span class="k">class</span><span class="w"> </span><span class="n">Bar</span><span class="w"> </span><span class="n">extends</span><span class="w"> </span><span class="n">Foo</span>

<span class="n">def</span><span class="w"> </span><span class="n">meth</span><span class="o">[</span><span class="n">A</span><span class="o">]</span><span class="p">(</span><span class="nl">xs</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">A</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xs</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="nl">_</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">String</span><span class="o">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">"list of strings"</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="nl">_</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">Foo</span><span class="o">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">"list of foos"</span>
<span class="err">}</span>
</pre></div>

<p>we will get warnings:</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">console</span><span class="o">&gt;</span><span class="err">:</span><span class="mi">23</span><span class="err">:</span><span class="w"> </span><span class="nl">warning</span><span class="p">:</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="k">variable</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">String</span><span class="o">]</span><span class="err">↩</span>
<span class="k">is</span><span class="w"> </span><span class="n">unchecked</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">eliminated</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">erasure</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nl">_</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">String</span><span class="o">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">"list of strings"</span>
<span class="w">                 </span><span class="o">^</span>
<span class="o">&lt;</span><span class="n">console</span><span class="o">&gt;</span><span class="err">:</span><span class="mi">24</span><span class="err">:</span><span class="w"> </span><span class="nl">warning</span><span class="p">:</span><span class="w"> </span><span class="n">non</span><span class="o">-</span><span class="k">variable</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">Foo</span><span class="o">]</span><span class="err">↩</span>
<span class="k">is</span><span class="w"> </span><span class="n">unchecked</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">eliminated</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">erasure</span>
<span class="w">         </span><span class="k">case</span><span class="w"> </span><span class="nl">_</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">[</span><span class="n">Foo</span><span class="o">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="ss">"list of foos"</span>
<span class="w">                 </span><span class="o">^</span>
</pre></div>

<p>To solve this problem Manifests were introduced to Scala. But they have the
problem not being able to represent a lot of useful types, like path-
dependent-types:</p>
<div class="code"><pre class="code literal-block"><span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">Foo</span><span class="p">{</span><span class="k">class</span><span class="w"> </span><span class="n">Bar</span><span class="p">}</span>
<span class="n">defined</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">Foo</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">def</span><span class="w"> </span><span class="n">m</span><span class="p">(</span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="n">Foo</span><span class="p">)(</span><span class="n">b</span><span class="o">:</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">Bar</span><span class="p">)(</span><span class="n">implicit</span><span class="w"> </span><span class="n">ev</span><span class="o">:</span><span class="w"> </span><span class="n">Manifest</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">Bar</span><span class="p">])</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ev</span>
<span class="nl">warning</span><span class="p">:</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">deprecation</span><span class="w"> </span><span class="n">warnings</span><span class="p">;</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">deprecation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">details</span>
<span class="nl">m</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="n">Foo</span><span class="p">)(</span><span class="n">b</span><span class="o">:</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">Bar</span><span class="p">)(</span><span class="n">implicit</span><span class="w"> </span><span class="n">ev</span><span class="o">:</span><span class="w"> </span><span class="n">Manifest</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">Bar</span><span class="p">])</span><span class="n">Manifest</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">Bar</span><span class="p">]</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="n">f1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Foo</span><span class="p">;</span><span class="n">val</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">f1</span><span class="p">.</span><span class="n">Bar</span>
<span class="nl">f1</span><span class="p">:</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foo</span><span class="mf">@681e731</span><span class="n">c</span>
<span class="nl">b1</span><span class="p">:</span><span class="w"> </span><span class="n">f1</span><span class="p">.</span><span class="n">Bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foo$Bar</span><span class="mi">@271768</span><span class="n">ab</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Foo</span><span class="p">;</span><span class="n">val</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">f2</span><span class="p">.</span><span class="n">Bar</span>
<span class="nl">f2</span><span class="p">:</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foo</span><span class="mf">@3e50039</span><span class="n">c</span>
<span class="nl">b2</span><span class="p">:</span><span class="w"> </span><span class="n">f2</span><span class="p">.</span><span class="n">Bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foo$Bar</span><span class="mi">@771</span><span class="n">d16b9</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="n">ev1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">(</span><span class="n">f1</span><span class="p">)(</span><span class="n">b1</span><span class="p">)</span>
<span class="nl">warning</span><span class="p">:</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">deprecation</span><span class="w"> </span><span class="n">warnings</span><span class="p">;</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">deprecation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">details</span>
<span class="nl">ev1</span><span class="p">:</span><span class="w"> </span><span class="n">Manifest</span><span class="p">[</span><span class="n">f1</span><span class="p">.</span><span class="n">Bar</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foo</span><span class="mf">@681e731</span><span class="n">c</span><span class="p">.</span><span class="n">type</span><span class="err">#</span><span class="n">Foo$Bar</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="n">ev2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">(</span><span class="n">f2</span><span class="p">)(</span><span class="n">b2</span><span class="p">)</span>
<span class="nl">warning</span><span class="p">:</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">deprecation</span><span class="w"> </span><span class="n">warnings</span><span class="p">;</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">run</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="o">-</span><span class="n">deprecation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">details</span>
<span class="nl">ev2</span><span class="p">:</span><span class="w"> </span><span class="n">Manifest</span><span class="p">[</span><span class="n">f2</span><span class="p">.</span><span class="n">Bar</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foo</span><span class="mf">@3e50039</span><span class="n">c</span><span class="p">.</span><span class="n">type</span><span class="err">#</span><span class="n">Foo$Bar</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ev1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ev2</span><span class="w"> </span><span class="c1">// they should be different, thus the result is wrong</span>
<span class="nl">res28</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</pre></div>

<p>Thus, they are replaced by TypeTags, which are both much simpler to use and
well integrated into the new Reflection API. With them we can solve the
problem above about path-dependent-types elegantly:</p>
<div class="code"><pre class="code literal-block"><span class="nv">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">def</span><span class="w"> </span><span class="nf">m</span><span class="p">(</span><span class="nv">f</span><span class="o">:</span><span class="w"> </span><span class="nv">Foo</span><span class="p">)(</span><span class="nv">b</span><span class="o">:</span><span class="w"> </span><span class="nv">f</span><span class="o">.</span><span class="nv">Bar</span><span class="p">)(</span><span class="nv">implicit</span><span class="w"> </span><span class="nv">ev</span><span class="o">:</span><span class="w"> </span><span class="nv">TypeTag</span><span class="p">[</span><span class="nv">f</span><span class="o">.</span><span class="nv">Bar</span><span class="p">])</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ev</span>
<span class="nv">m</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nv">f</span><span class="o">:</span><span class="w"> </span><span class="nv">Foo</span><span class="p">)(</span><span class="nv">b</span><span class="o">:</span><span class="w"> </span><span class="nv">f</span><span class="o">.</span><span class="nv">Bar</span><span class="p">)(</span><span class="nv">implicit</span><span class="w"> </span><span class="nv">ev</span><span class="o">:</span><span class="w"> </span><span class="nv">reflect</span><span class="o">.</span><span class="nv">runtime</span><span class="o">.</span><span class="nv">universe</span><span class="o">.</span><span class="nv">TypeTag</span><span class="p">[</span><span class="nv">f</span><span class="o">.</span><span class="nv">Bar</span><span class="p">])</span>↩
<span class="nv">reflect</span><span class="o">.</span><span class="nv">runtime</span><span class="o">.</span><span class="nv">universe</span><span class="o">.</span><span class="nv">TypeTag</span><span class="p">[</span><span class="nv">f</span><span class="o">.</span><span class="nv">Bar</span><span class="p">]</span>

<span class="nv">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">val</span><span class="w"> </span><span class="nv">ev1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">m</span><span class="p">(</span><span class="nv">f1</span><span class="p">)(</span><span class="nv">b1</span><span class="p">)</span>
<span class="nv">ev1</span><span class="o">:</span><span class="w"> </span><span class="nv">reflect</span><span class="o">.</span><span class="nv">runtime</span><span class="o">.</span><span class="nv">universe</span><span class="o">.</span><span class="nv">TypeTag</span><span class="p">[</span><span class="nv">f1</span><span class="o">.</span><span class="nv">Bar</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">TypeTag</span><span class="p">[</span><span class="nv">f1</span><span class="o">.</span><span class="nv">Bar</span><span class="p">]</span>

<span class="nv">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">val</span><span class="w"> </span><span class="nv">ev2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">m</span><span class="p">(</span><span class="nv">f2</span><span class="p">)(</span><span class="nv">b2</span><span class="p">)</span>
<span class="nv">ev2</span><span class="o">:</span><span class="w"> </span><span class="nv">reflect</span><span class="o">.</span><span class="nv">runtime</span><span class="o">.</span><span class="nv">universe</span><span class="o">.</span><span class="nv">TypeTag</span><span class="p">[</span><span class="nv">f2</span><span class="o">.</span><span class="nv">Bar</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">TypeTag</span><span class="p">[</span><span class="nv">f2</span><span class="o">.</span><span class="nv">Bar</span><span class="p">]</span>

<span class="nv">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">ev1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">ev2</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">correct</span><span class="p">,</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">type</span><span class="w"> </span><span class="nv">tags</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">different</span>
<span class="nv">res30</span><span class="o">:</span><span class="w"> </span><span class="nv">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>

<span class="nv">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">ev1</span><span class="o">.</span><span class="nv">tpe</span><span class="w"> </span><span class="o">=:=</span><span class="w"> </span><span class="nv">ev2</span><span class="o">.</span><span class="nv">tpe</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">correct</span><span class="p">,</span><span class="w"> </span><span class="k">to</span><span class="nv">o</span>
<span class="nv">res31</span><span class="o">:</span><span class="w"> </span><span class="nv">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</pre></div>

<p>They are also easy to use to check type parameters:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">scala.reflect.runtime.universe._</span>

<span class="k">def</span> <span class="nf">meth</span><span class="p">[</span><span class="n">A</span> <span class="p">:</span> <span class="n">TypeTag</span><span class="p">](</span><span class="n">xs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">A</span><span class="p">])</span> <span class="o">=</span> <span class="n">typeOf</span><span class="p">[</span><span class="n">A</span><span class="p">]</span> <span class="n">match</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">t</span> <span class="k">if</span> <span class="n">t</span> <span class="o">=:=</span> <span class="n">typeOf</span><span class="p">[</span><span class="n">String</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="s2">"list of strings"</span>
  <span class="k">case</span> <span class="n">t</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span><span class="p">:</span><span class="o">&lt;</span> <span class="n">typeOf</span><span class="p">[</span><span class="n">Foo</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="s2">"list of foos"</span>
<span class="p">}</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">meth</span><span class="p">(</span><span class="n">List</span><span class="p">(</span><span class="s2">"string"</span><span class="p">))</span>
<span class="n">res67</span><span class="p">:</span> <span class="n">String</span> <span class="o">=</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">strings</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">meth</span><span class="p">(</span><span class="n">List</span><span class="p">(</span><span class="n">new</span> <span class="n">Bar</span><span class="p">))</span>
<span class="n">res68</span><span class="p">:</span> <span class="n">String</span> <span class="o">=</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">foos</span>
</pre></div>

<p>At this point, it is extremely important to understand to use <code>=:=</code> (type
equality) and <code>&lt;:&lt;</code> (subtype relation) for equality checks. Do never use <code>==</code>
or <code>!=</code>, unless you absolutely know what you do:</p>
<div class="code"><pre class="code literal-block"><span class="nv">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">typeOf</span><span class="p">[</span><span class="nv">List</span><span class="p">[</span><span class="nv">java</span><span class="o">.</span><span class="nv">lang</span><span class="o">.</span><span class="nv">String</span><span class="p">]]</span><span class="w"> </span><span class="o">=:=</span><span class="w"> </span><span class="nv">typeOf</span><span class="p">[</span><span class="nv">List</span><span class="p">[</span><span class="nv">Predef</span><span class="o">.</span><span class="nv">String</span><span class="p">]]</span>
<span class="nv">res71</span><span class="o">:</span><span class="w"> </span><span class="nv">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">true</span>

<span class="nv">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">typeOf</span><span class="p">[</span><span class="nv">List</span><span class="p">[</span><span class="nv">java</span><span class="o">.</span><span class="nv">lang</span><span class="o">.</span><span class="nv">String</span><span class="p">]]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">typeOf</span><span class="p">[</span><span class="nv">List</span><span class="p">[</span><span class="nv">Predef</span><span class="o">.</span><span class="nv">String</span><span class="p">]]</span>
<span class="nv">res72</span><span class="o">:</span><span class="w"> </span><span class="nv">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">false</span>
</pre></div>

<p>The latter checks for structural equality, which often is not what should be
done because it doesn't care about things such as prefixes (like in the
example).</p>
<p>A <code>TypeTag</code> is completely compiler-generated, that means that the compiler
creates and fills in a <code>TypeTag</code> when one calls a method expecting such a
<code>TypeTag</code>. There exist three different forms of tags:</p>
<ul>
<li>scala.reflect.ClassTag</li>
<li>scala.reflect.api.TypeTags#TypeTag</li>
<li>scala.reflect.api.TypeTags#WeakTypeTag</li>
</ul>
<p><code>ClassTag</code> substitutes <code>ClassManifest</code> whereas <code>TypeTag</code> is more or less the
replacement for <code>Manifest</code>.</p>
<p>The former allows to fully work with generic arrays:</p>
<div class="code"><pre class="code literal-block"><span class="n">scala</span><span class="o">&gt;</span> <span class="kn">import</span> <span class="nn">scala.reflect._</span>
<span class="kn">import</span> <span class="nn">scala.reflect._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="nf">createArr</span><span class="p">[</span><span class="n">A</span><span class="p">](</span><span class="n">seq</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="p">)</span> <span class="o">=</span> <span class="n">Array</span><span class="p">[</span><span class="n">A</span><span class="p">](</span><span class="n">seq</span><span class="p">:</span> <span class="n">_</span><span class="o">*</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">console</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">No</span> <span class="n">ClassTag</span> <span class="n">available</span> <span class="k">for</span> <span class="n">A</span>
       <span class="k">def</span> <span class="nf">createArr</span><span class="p">[</span><span class="n">A</span><span class="p">](</span><span class="n">seq</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="p">)</span> <span class="o">=</span> <span class="n">Array</span><span class="p">[</span><span class="n">A</span><span class="p">](</span><span class="n">seq</span><span class="p">:</span> <span class="n">_</span><span class="o">*</span><span class="p">)</span>
                                           <span class="o">^</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="nf">createArr</span><span class="p">[</span><span class="n">A</span> <span class="p">:</span> <span class="n">ClassTag</span><span class="p">](</span><span class="n">seq</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="p">)</span> <span class="o">=</span> <span class="n">Array</span><span class="p">[</span><span class="n">A</span><span class="p">](</span><span class="n">seq</span><span class="p">:</span> <span class="n">_</span><span class="o">*</span><span class="p">)</span>
<span class="n">createArr</span><span class="p">:</span> <span class="p">[</span><span class="n">A</span><span class="p">](</span><span class="n">seq</span><span class="p">:</span> <span class="n">A</span><span class="o">*</span><span class="p">)(</span><span class="n">implicit</span> <span class="n">evidence</span><span class="err">$</span><span class="mi">1</span><span class="p">:</span> <span class="n">scala</span><span class="o">.</span><span class="n">reflect</span><span class="o">.</span><span class="n">ClassTag</span><span class="p">[</span><span class="n">A</span><span class="p">])</span><span class="n">Array</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">createArr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">res78</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="n">Int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">createArr</span><span class="p">(</span><span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">,</span><span class="s2">"c"</span><span class="p">)</span>
<span class="n">res79</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="n">String</span><span class="p">]</span> <span class="o">=</span> <span class="n">Array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>

<p><code>ClassTag</code> provides only the information needed to create types at runtime
(which are type erased):</p>
<div class="code"><pre class="code literal-block"><span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">classTag</span><span class="o">[</span><span class="n">Int</span><span class="o">]</span>
<span class="nl">res99</span><span class="p">:</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">ClassTag</span><span class="o">[</span><span class="n">Int</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ClassTag</span><span class="o">[</span><span class="n">int</span><span class="o">]</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">classTag</span><span class="o">[</span><span class="n">Int</span><span class="o">]</span><span class="p">.</span><span class="n">runtimeClass</span>
<span class="nl">res100</span><span class="p">:</span><span class="w"> </span><span class="k">Class</span><span class="o">[</span><span class="n">_</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">int</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">classTag</span><span class="o">[</span><span class="n">Int</span><span class="o">]</span><span class="p">.</span><span class="n">newArray</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nl">res101</span><span class="p">:</span><span class="w"> </span><span class="k">Array</span><span class="o">[</span><span class="n">Int</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">classTag</span><span class="o">[</span><span class="n">List[Int</span><span class="o">]</span><span class="err">]</span>
<span class="nl">res104</span><span class="p">:</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">ClassTag</span><span class="o">[</span><span class="n">List[Int</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="err">↩</span>
<span class="w">        </span><span class="n">ClassTag</span><span class="o">[</span><span class="n">class scala.collection.immutable.List</span><span class="o">]</span>
</pre></div>

<p>As one can see above, they don't care about type erasure, therefore if one
wants "full" types <code>TypeTag</code> should be used:</p>
<div class="code"><pre class="code literal-block"><span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">typeTag</span><span class="o">[</span><span class="n">List[Int</span><span class="o">]</span><span class="err">]</span>
<span class="nl">res105</span><span class="p">:</span><span class="w"> </span><span class="n">reflect</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">universe</span><span class="p">.</span><span class="n">TypeTag</span><span class="o">[</span><span class="n">List[Int</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TypeTag</span><span class="o">[</span><span class="n">scala.List[Int</span><span class="o">]</span><span class="err">]</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">typeTag</span><span class="o">[</span><span class="n">List[Int</span><span class="o">]</span><span class="err">]</span><span class="p">.</span><span class="n">tpe</span>
<span class="nl">res107</span><span class="p">:</span><span class="w"> </span><span class="n">reflect</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">universe</span><span class="p">.</span><span class="n">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">List</span><span class="o">[</span><span class="n">Int</span><span class="o">]</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">typeOf</span><span class="o">[</span><span class="n">List[Int</span><span class="o">]</span><span class="err">]</span>
<span class="nl">res108</span><span class="p">:</span><span class="w"> </span><span class="n">reflect</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">universe</span><span class="p">.</span><span class="n">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">List</span><span class="o">[</span><span class="n">Int</span><span class="o">]</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res107</span><span class="w"> </span><span class="o">=</span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">res108</span>
<span class="nl">res109</span><span class="p">:</span><span class="w"> </span><span class="k">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span>
</pre></div>

<p>As one can see, method <code>tpe</code> of <code>TypeTag</code> results in a full <code>Type</code>, which is
the same we get when <code>typeOf</code> is called. Of course, it is possible to use
both, <code>ClassTag</code> and <code>TypeTag</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">def</span><span class="w"> </span><span class="n">m</span><span class="p">[</span><span class="n">A</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ClassTag</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">TypeTag</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">classTag</span><span class="p">[</span><span class="n">A</span><span class="p">],</span><span class="w"> </span><span class="n">typeTag</span><span class="p">[</span><span class="n">A</span><span class="p">])</span>
<span class="nl">m</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">A</span><span class="p">](</span><span class="n">implicit</span><span class="w"> </span><span class="n">evidence$1</span><span class="o">:</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">ClassTag</span><span class="p">[</span><span class="n">A</span><span class="p">],</span><span class="err">↩</span>
<span class="w">       </span><span class="n">implicit</span><span class="w"> </span><span class="n">evidence$2</span><span class="o">:</span><span class="w"> </span><span class="n">reflect</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">universe</span><span class="p">.</span><span class="n">TypeTag</span><span class="p">[</span><span class="n">A</span><span class="p">])</span><span class="err">↩</span>
<span class="w">      </span><span class="p">(</span><span class="n">scala</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">ClassTag</span><span class="p">[</span><span class="n">A</span><span class="p">],</span><span class="w"> </span><span class="n">reflect</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">universe</span><span class="p">.</span><span class="n">TypeTag</span><span class="p">[</span><span class="n">A</span><span class="p">])</span>

<span class="n">scala</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Int</span><span class="p">]]</span>
<span class="nl">res36</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">scala</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">ClassTag</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Int</span><span class="p">]],</span><span class="err">↩</span>
<span class="w">        </span><span class="n">reflect</span><span class="p">.</span><span class="n">runtime</span><span class="p">.</span><span class="n">universe</span><span class="p">.</span><span class="n">TypeTag</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Int</span><span class="p">]])</span><span class="w"> </span><span class="o">=</span><span class="err">↩</span>
<span class="w">       </span><span class="p">(</span><span class="n">scala</span><span class="p">.</span><span class="n">collection</span><span class="p">.</span><span class="n">immutable</span><span class="p">.</span><span class="n">List</span><span class="p">,</span><span class="n">TypeTag</span><span class="p">[</span><span class="n">scala</span><span class="p">.</span><span class="n">List</span><span class="p">[</span><span class="n">Int</span><span class="p">]])</span>
</pre></div>

<p>The remaining question now is what is the sense of <code>WeakTypeTag</code> ? In short,
<code>TypeTag</code> represents a concrete type (this means it only allows fully
instantiated types) whereas <code>WeakTypeTag</code> just allows any type. Most of the
time one does not care which is what (which means <code>TypeTag</code> should be used),
but for example, when macros are used which should work with generic types
they are needed:</p>
<div class="code"><pre class="code literal-block"><span class="nb">object</span> <span class="n">Macro</span> <span class="p">{</span>
  <span class="kn">import</span> <span class="nn">language.experimental.macros</span>
  <span class="kn">import</span> <span class="nn">scala.reflect.macros.Context</span>

  <span class="k">def</span> <span class="nf">anymacro</span><span class="p">[</span><span class="n">A</span><span class="p">](</span><span class="n">expr</span><span class="p">:</span> <span class="n">A</span><span class="p">):</span> <span class="n">String</span> <span class="o">=</span> <span class="n">macro</span> <span class="n">__anymacro</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">__anymacro</span><span class="p">[</span><span class="n">A</span> <span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">WeakTypeTag</span><span class="p">](</span><span class="n">c</span><span class="p">:</span> <span class="n">Context</span><span class="p">)(</span><span class="n">expr</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">Expr</span><span class="p">[</span><span class="n">A</span><span class="p">]):</span> <span class="n">c</span><span class="o">.</span><span class="n">Expr</span><span class="p">[</span><span class="n">A</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">to</span> <span class="n">get</span> <span class="n">a</span> <span class="n">Type</span> <span class="k">for</span> <span class="n">A</span> <span class="n">the</span> <span class="n">c</span><span class="o">.</span><span class="n">WeakTypeTag</span> <span class="n">context</span> <span class="n">bound</span> <span class="n">must</span> <span class="n">be</span> <span class="n">added</span>
    <span class="n">val</span> <span class="n">aType</span> <span class="o">=</span> <span class="n">implicitly</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">WeakTypeTag</span><span class="p">[</span><span class="n">A</span><span class="p">]]</span><span class="o">.</span><span class="n">tpe</span>
    <span class="err">???</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If one replaces <code>WeakTypeTag</code> with <code>TypeTag</code> an error is thrown:</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">console</span><span class="o">&gt;</span><span class="err">:</span><span class="mi">17</span><span class="err">:</span><span class="w"> </span><span class="nl">error</span><span class="p">:</span><span class="w"> </span><span class="n">macro</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">wrong</span><span class="w"> </span><span class="nl">shape</span><span class="p">:</span>
<span class="w"> </span><span class="nl">required</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nl">c</span><span class="p">:</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">macros</span><span class="p">.</span><span class="n">Context</span><span class="p">)(</span><span class="nl">expr</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Expr</span><span class="o">[</span><span class="n">A</span><span class="o">]</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Expr</span><span class="o">[</span><span class="n">String</span><span class="o">]</span>
<span class="w"> </span><span class="k">found</span><span class="w">   </span><span class="err">:</span><span class="w"> </span><span class="p">(</span><span class="nl">c</span><span class="p">:</span><span class="w"> </span><span class="n">scala</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">macros</span><span class="p">.</span><span class="n">Context</span><span class="p">)(</span><span class="nl">expr</span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Expr</span><span class="o">[</span><span class="n">A</span><span class="o">]</span><span class="p">)(</span><span class="n">implicit</span><span class="w"> </span><span class="n">evidence</span><span class="err">$</span><span class="mi">1</span><span class="err">:</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">TypeTag</span><span class="o">[</span><span class="n">A</span><span class="o">]</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Expr</span><span class="o">[</span><span class="n">A</span><span class="o">]</span>
<span class="n">macro</span><span class="w"> </span><span class="n">implementations</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">implicit</span><span class="w"> </span><span class="k">parameters</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="k">than</span><span class="w"> </span><span class="n">WeakTypeTag</span><span class="w"> </span><span class="n">evidences</span>
<span class="w">             </span><span class="n">def</span><span class="w"> </span><span class="n">anymacro</span><span class="o">[</span><span class="n">A</span><span class="o">]</span><span class="p">(</span><span class="nl">expr</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">macro</span><span class="w"> </span><span class="n">__anymacro</span><span class="o">[</span><span class="n">A</span><span class="o">]</span>
<span class="w">                                                      </span><span class="o">^</span>
</pre></div>

<p>For a more detailed explanation about the differences between <code>TypeTag</code> and
<code>WeakTypeTag</code> see this question: Scala Macros: “cannot create TypeTag from a
type T having unresolved type parameters”</p>
<p>The official documentation site of Scala also contains a guide for Reflection.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2389.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2387.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
