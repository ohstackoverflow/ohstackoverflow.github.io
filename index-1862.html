<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1862) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1862.html">
<link rel="prev" href="index-1863.html" type="text/html">
<link rel="next" href="index-1861.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/working-with-select-using-angularjs-s-ng-options/" class="u-url">Working with select using AngularJS's ng-options</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/working-with-select-using-angularjs-s-ng-options/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T11:08:09+08:00" itemprop="datePublished" title="2023-03-03 11:08">2023-03-03 11:08</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have read about it in other posts, but I couldn't figure it out.</p>
<p>I have an array,</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="nt">scope</span><span class="p">.</span><span class="nc">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cp">[</span>
<span class="w">   </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s1">'000001'</span><span class="p">,</span><span class="w"> </span><span class="nx">Title</span><span class="p">:</span><span class="w"> </span><span class="s1">'Chicago'</span><span class="p">},</span>
<span class="w">   </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s1">'000002'</span><span class="p">,</span><span class="w"> </span><span class="nx">Title</span><span class="p">:</span><span class="w"> </span><span class="s1">'New York'</span><span class="p">},</span>
<span class="w">   </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s1">'000003'</span><span class="p">,</span><span class="w"> </span><span class="nx">Title</span><span class="p">:</span><span class="w"> </span><span class="s1">'Washington'</span><span class="p">},</span>
<span class="cp">]</span><span class="o">;</span>
</pre></div>

<p>I want to render it as:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;select&gt;</span>
<span class="w">  </span><span class="nt">&lt;option</span><span class="w"> </span><span class="na">value=</span><span class="s">"000001"</span><span class="nt">&gt;</span>Chicago<span class="nt">&lt;/option&gt;</span>
<span class="w">  </span><span class="nt">&lt;option</span><span class="w"> </span><span class="na">value=</span><span class="s">"000002"</span><span class="nt">&gt;</span>New<span class="w"> </span>York<span class="nt">&lt;/option&gt;</span>
<span class="w">  </span><span class="nt">&lt;option</span><span class="w"> </span><span class="na">value=</span><span class="s">"000003"</span><span class="nt">&gt;</span>Washington<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</pre></div>

<p>And also I want to select the option with ID=000002.</p>
<p>I have read <em>select</em> and tried, but I can't figure it out.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>One thing to note is that ngModel is <em>required</em> for ngOptions to work... note
the <code>ng-model="blah"</code> which is saying "set $scope.blah to the selected value".</p>
<p>Try this:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;select</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"blah"</span><span class="w"> </span><span class="na">ng-options=</span><span class="s">"item.ID as item.Title for item in items"</span><span class="nt">&gt;&lt;/select&gt;</span>
</pre></div>

<p>Here's more from AngularJS's documentation (if you haven't seen it):</p>
<blockquote>
<p>for array data sources:</p>
<ul>
<li>label for value in array</li>
<li>select as label for value in array</li>
<li>label group by group for value in array = select as label group by group
for value in array
</li>
</ul>
<p>for object data sources:</p>
<ul>
<li>label for (key , value) in object</li>
<li>select as label for (key , value) in object</li>
<li>label group by group for (key, value) in object</li>
<li>select as label group by group for (key, value) in object
</li>
</ul>
</blockquote>
<hr>
<p>For some clarification on option tag values in AngularJS:</p>
<p>When you use <code>ng-options</code>, <strong>the values of option tags written out by ng-
options will always be the index of the array item the option tag relates
to</strong>. This is because AngularJS actually allows you to select entire objects
with select controls, and not just primitive types. For example:</p>
<div class="code"><pre class="code literal-block">app.controller('MainCtrl',<span class="w"> </span>function($scope)<span class="w"> </span>{
<span class="w">   </span>$scope.items<span class="w"> </span>=<span class="w"> </span>[
<span class="w">     </span>{<span class="w"> </span>id:<span class="w"> </span>1,<span class="w"> </span>name:<span class="w"> </span>'foo'<span class="w"> </span>},
<span class="w">     </span>{<span class="w"> </span>id:<span class="w"> </span>2,<span class="w"> </span>name:<span class="w"> </span>'bar'<span class="w"> </span>},
<span class="w">     </span>{<span class="w"> </span>id:<span class="w"> </span>3,<span class="w"> </span>name:<span class="w"> </span>'blah'<span class="w"> </span>}
<span class="w">   </span>];
});



<span class="nt">&lt;div</span><span class="w"> </span><span class="na">ng-controller=</span><span class="s">"MainCtrl"</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"selectedItem"</span><span class="w"> </span><span class="na">ng-options=</span><span class="s">"item as item.name for item in items"</span><span class="nt">&gt;&lt;/select&gt;</span>
<span class="w">   </span><span class="nt">&lt;pre&gt;</span><span class="cp">{{</span><span class="nv">selectedItem</span> <span class="o">|</span> <span class="nf">json</span><span class="cp">}}</span><span class="nt">&lt;/pre&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>The above will allow you to select an entire object into <code>$scope.selectedItem</code>
directly. <strong>The point is, with AngularJS, you don't need to worry about what's
in your option tag. Let AngularJS handle that; you should only care about
what's in your model in your scope.</strong></p>
<p>Here is a plunker demonstrating the behavior above, and showing the HTML
written out</p>
<hr>
<p>Dealing with the default option:</p>
<p>There are a few things I've failed to mention above relating to the default
option.</p>
<p><strong>Selecting the first option and removing the empty option:</strong></p>
<p>You can do this by adding a simple <code>ng-init</code> that sets the model (from <code>ng-
model</code>) to the first element in the items your repeating in <code>ng-options</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;select</span><span class="w"> </span><span class="na">ng-init=</span><span class="s">"foo = foo || items[0]"</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"foo"</span><span class="w"> </span><span class="na">ng-options=</span><span class="s">"item as item.name for item in items"</span><span class="nt">&gt;&lt;/select&gt;</span>
</pre></div>

<p>Note: This could get a little crazy if <code>foo</code> happens to be initialized
properly to something "falsy". In that case, you'll want to handle the
initialization of <code>foo</code> in your controller, most likely.</p>
<p><strong>Customizing the default option:</strong></p>
<p>This is a little different; here all you need to do is add an option tag as a
child of your select, with an empty value attribute, then customize its inner
text:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;select</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"foo"</span><span class="w"> </span><span class="na">ng-options=</span><span class="s">"item as item.name for item in items"</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;option</span><span class="w"> </span><span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>Nothing<span class="w"> </span>selected<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</pre></div>

<p>Note: In this case the "empty" option will stay there even after you select a
different option. This isn't the case for the default behavior of selects
under AngularJS.</p>
<p><strong>A customized default option that hides after a selection is made:</strong></p>
<p>If you wanted your customized default option to go away after you select a
value, you can add an ng-hide attribute to your default option:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;select</span><span class="w"> </span><span class="na">ng-model=</span><span class="s">"foo"</span><span class="w"> </span><span class="na">ng-options=</span><span class="s">"item as item.name for item in items"</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;option</span><span class="w"> </span><span class="na">value=</span><span class="s">""</span><span class="w"> </span><span class="na">ng-if=</span><span class="s">"foo"</span><span class="nt">&gt;</span>Select<span class="w"> </span>something<span class="w"> </span>to<span class="w"> </span>remove<span class="w"> </span>me.<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I'm learning AngularJS and was struggling with selection as well. I know this
question is already answered, but I wanted to share some more code
nevertheless.</p>
<p>In my test I have two listboxes: car makes and car models. The models list is
disabled until some make is selected. If selection in makes listbox is later
reset (set to 'Select Make') then the models listbox becomes disabled again
AND its selection is reset as well (to 'Select Model'). Makes are retrieved as
a resource while models are just hard-coded.</p>
<h4>Makes JSON:</h4>
<div class="code"><pre class="code literal-block">[
{"code": "0", "name": "Select Make"},
{"code": "1", "name": "Acura"},
{"code": "2", "name": "Audi"}
]
</pre></div>

<h4>services.js:</h4>
<div class="code"><pre class="code literal-block"><span class="nt">angular</span><span class="p">.</span><span class="nc">module</span><span class="o">(</span><span class="s1">'makeServices'</span><span class="o">,</span><span class="w"> </span><span class="cp">[</span><span class="s1">'ngResource'</span><span class="cp">]</span><span class="o">).</span>
<span class="nt">factory</span><span class="o">(</span><span class="s1">'Make'</span><span class="o">,</span><span class="w"> </span><span class="nt">function</span><span class="o">($</span><span class="nt">resource</span><span class="o">)</span><span class="p">{</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">$resource('makes.json',</span><span class="w"> </span><span class="err">{</span><span class="p">}</span><span class="o">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">method</span><span class="o">:</span><span class="s1">'GET'</span><span class="p">,</span><span class="w"> </span><span class="n">isArray</span><span class="o">:</span><span class="n">true</span><span class="p">}</span>
<span class="w">    </span><span class="err">}</span><span class="o">);</span>
<span class="err">}</span><span class="o">);</span>
</pre></div>

<h4>HTML file:</h4>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">ng:controller=</span><span class="s">"MakeModelCtrl"</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;div&gt;</span>Make<span class="nt">&lt;/div&gt;</span>
<span class="w">  </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"makeListBox"</span>
<span class="w">      </span><span class="na">ng-model=</span><span class="s">"make.selected"</span>
<span class="w">      </span><span class="na">ng-options=</span><span class="s">"make.code as make.name for make in makes"</span>
<span class="w">      </span><span class="na">ng-change=</span><span class="s">"makeChanged(make.selected)"</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;/select&gt;</span>

<span class="w">  </span><span class="nt">&lt;div&gt;</span>Model<span class="nt">&lt;/div&gt;</span>
<span class="w">  </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">"modelListBox"</span>
<span class="w">     </span><span class="na">ng-disabled=</span><span class="s">"makeNotSelected"</span>
<span class="w">     </span><span class="na">ng-model=</span><span class="s">"model.selected"</span>
<span class="w">     </span><span class="na">ng-options=</span><span class="s">"model.code as model.name for model in models"</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<h4>controllers.js:</h4>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="nf">MakeModelCtrl</span><span class="p">(</span>$scope<span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span>$<span class="n">scope</span><span class="p">.</span><span class="n">makeNotSelected</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span>$<span class="n">scope</span><span class="p">.</span><span class="n">make</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">selected</span><span class="p">:</span><span class="w"> </span><span class="s">"0"</span><span class="p">};</span>
<span class="w">    </span>$<span class="n">scope</span><span class="p">.</span><span class="n">makes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Make</span><span class="p">.</span><span class="n">query</span><span class="p">({},</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">makes</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span>$<span class="n">scope</span><span class="p">.</span><span class="n">make</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">selected</span><span class="p">:</span><span class="w"> </span><span class="n">makes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">code</span><span class="p">};</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span>$<span class="n">scope</span><span class="p">.</span><span class="n">makeChanged</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">selectedMakeCode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span>$<span class="n">scope</span><span class="p">.</span><span class="n">makeNotSelected</span><span class="w"> </span><span class="p">=</span><span class="w"> </span>!<span class="n">selectedMakeCode</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>$<span class="n">scope</span><span class="p">.</span><span class="n">makeNotSelected</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span>$<span class="n">scope</span><span class="p">.</span><span class="n">model</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">selected</span><span class="p">:</span><span class="w"> </span><span class="s">"0"</span><span class="p">};</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span>$<span class="n">scope</span><span class="p">.</span><span class="n">models</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span><span class="n">code</span><span class="p">:</span><span class="s">"0"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="s">"Select Model"</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="n">code</span><span class="p">:</span><span class="s">"1"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="s">"Model1"</span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span><span class="n">code</span><span class="p">:</span><span class="s">"2"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="s">"Model2"</span><span class="p">}</span>
<span class="w">    </span><span class="p">];</span>
<span class="w">    </span>$<span class="n">scope</span><span class="p">.</span><span class="n">model</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">selected</span><span class="p">:</span><span class="w"> </span><span class="s">"0"</span><span class="p">};</span>
<span class="p">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/is-fortran-easier-to-optimize-than-c-for-heavy-calculations/" class="u-url">Is Fortran easier to optimize than C for heavy calculations?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/is-fortran-easier-to-optimize-than-c-for-heavy-calculations/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T11:07:43+08:00" itemprop="datePublished" title="2023-03-03 11:07">2023-03-03 11:07</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>From time to time I read that Fortran is or can be faster then C for heavy
calculations. Is that really true? I must admit that I hardly know Fortran,
but the Fortran code I have seen so far did not show that the language has
features that C doesn't have.</p>
<p>If it is true, please tell me why. Please don't tell me what languages or libs
are good for number crunching, I don't intend to write an app or lib to do
that, I'm just curious.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The languages have similar feature-sets. The performance difference comes from
the fact that Fortran says aliasing is not allowed, unless an EQUIVALENCE
statement is used. Any code that has aliasing is not valid Fortran, but it is
up to the programmer and not the compiler to detect these errors. Thus Fortran
compilers ignore possible aliasing of memory pointers and allow them to
generate more efficient code. Take a look at this little example in C:</p>
<div class="code"><pre class="code literal-block"><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">transform</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">float</span><span class="w"> </span><span class="o">*</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">matrix</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;*</span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nb nb-Type">float</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">0</span><span class="p">];</span>
<span class="w">        </span><span class="nb nb-Type">float</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="w">        </span><span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">matrix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">        </span><span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matrix</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">matrix</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>This function would run slower than the Fortran counterpart after
optimization. Why so? If you write values into the output array, you may
change the values of matrix. After all, the pointers could overlap and point
to the same chunk of memory (including the <code>int</code> pointer!). The C compiler is
forced to reload the four matrix values from memory for all computations.</p>
<p>In Fortran the compiler can load the matrix values once and store them in
registers. It can do so because the Fortran compiler assumes pointers/arrays
do not overlap in memory.</p>
<p>Fortunately, the <code>restrict</code> keyword and strict-aliasing have been introduced
to the C99 standard to address this problem. It's well supported in most C++
compilers these days as well. The keyword allows you to give the compiler a
hint that the programmer promises that a pointer does not alias with any other
pointer. The strict-aliasing means that the programmer promises that pointers
of different type will never overlap, for example a <code>double*</code> will not overlap
with an <code>int*</code> (with the specific exception that <code>char*</code> and <code>void*</code> can
overlap with anything).</p>
<p>If you use them you will get the same speed from C and Fortran. However, the
ability to use the <code>restrict</code> keyword only with performance critical functions
means that C (and C++) programs are much safer and easier to write. For
example, consider the invalid Fortran code: <code>CALL TRANSFORM(A(1, 30), A(2,
31), A(3, 32), 30)</code>, which most Fortran compilers will happily compile without
any warning but introduces a bug that only shows up on some compilers, on some
hardware and with some optimization options.</p>
<p><br></p>
<h3>Suggest</h3>
<h3>Yes, in 1980; in 2008? depends</h3>
<p>When I started programming professionally the speed dominance of Fortran was
just being challenged. I remember reading about it in Dr. Dobbs and telling
the older programmers about the article--they laughed.</p>
<p>So I have two views about this, theoretical and practical. <em>In theory</em> Fortran
today has no intrinsic advantage to C/C++ or even any language that allows
assembly code. <em>In practice</em> Fortran today still enjoys the benefits of legacy
of a history and culture built around optimization of numerical code.</p>
<p>Up until and including Fortran 77, language design considerations had
optimization as a main focus. Due to the state of compiler theory and
technology, this often meant <em>restricting</em> features and capability in order to
give the compiler the best shot at optimizing the code. A good analogy is to
think of Fortran 77 as a professional race car that sacrifices features for
speed. These days compilers have gotten better across all languages and
features for programmer productivity are more valued. However, there are still
places where the people are mainly concerned with speed in scientific
computing; these people most likely have inherited code, training and culture
from people who themselves were Fortran programmers.</p>
<p>When one starts talking about optimization of code there are many issues and
the best way to get a feel for this is to lurk where people are whose job it
is to have fast numerical code. But keep in mind that such critically
sensitive code is usually a small fraction of the overall lines of code and
very specialized: A lot of Fortran code is just as "inefficient" as a lot of
other code in other languages and optimization should not even be a primary
concern of such code.</p>
<p>A wonderful place to start in learning about the history and culture of
Fortran is wikipedia. The Fortran Wikipedia entry is superb and I very much
appreciate those who have taken the time and effort to make it of value for
the Fortran community.</p>
<p>(A shortened version of this answer would have been a comment in the excellent
thread started by <strong>Nils</strong> but I don't have the karma to do that. Actually, I
probably wouldn't have written anything at all but for that this thread has
actual information content and sharing as opposed to flame wars and language
bigotry, which is my main experience with this subject. I was overwhelmed and
had to share the love.)</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/can-t-subtract-offset-naive-and-offset-aware-datetimes/" class="u-url">Can't subtract offset-naive and offset-aware datetimes</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/can-t-subtract-offset-naive-and-offset-aware-datetimes/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T11:07:16+08:00" itemprop="datePublished" title="2023-03-03 11:07">2023-03-03 11:07</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a timezone aware <code>timestamptz</code> field in PostgreSQL. When I pull data
from the table, I then want to subtract the time right now so I can get it's
age.</p>
<p>The problem I'm having is that both <code>datetime.datetime.now()</code> and
<code>datetime.datetime.utcnow()</code> seem to return timezone unaware timestamps, which
results in me getting this error:</p>
<div class="code"><pre class="code literal-block"><span class="n">TypeError</span><span class="o">:</span><span class="w"> </span><span class="n">can</span><span class="err">'</span><span class="n">t</span><span class="w"> </span><span class="n">subtract</span><span class="w"> </span><span class="n">offset</span><span class="o">-</span><span class="n">naive</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">offset</span><span class="o">-</span><span class="n">aware</span><span class="w"> </span><span class="n">datetimes</span>
</pre></div>

<p>Is there a way to avoid this (preferably without a third-party module being
used).</p>
<p>EDIT: Thanks for the suggestions, however trying to adjust the timezone seems
to give me errors.. so I'm just going to use timezone unaware timestamps in PG
and always insert using:</p>
<div class="code"><pre class="code literal-block">NOW() AT TIME ZONE 'UTC'
</pre></div>

<p>That way all my timestamps are UTC by default (even though it's more annoying
to do this).</p>
<p><br><br></p>
<h2>Answer</h2>
<p>have you tried to remove the timezone awareness?</p>
<p>from http://pytz.sourceforge.net/</p>
<div class="code"><pre class="code literal-block">naive = dt.replace(tzinfo=None)
</pre></div>

<p>may have to add time zone conversion as well.</p>
<p>edit: Please be aware the age of this answer. An answer involving ADDing the
timezone info instead of removing it in python 3 is below.
https://stackoverflow.com/a/25662061/93380</p>
<p><br></p>
<h3>Suggest</h3>
<p>The correct solution is to <em>add</em> the timezone info e.g., to get the current
time as an aware datetime object in Python 3:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</pre></div>

<p>On older Python versions, you could define the <code>utc</code> tzinfo object yourself
(example from datetime docs):</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">tzinfo</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">datetime</span>

<span class="n">ZERO</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">UTC</span><span class="p">(</span><span class="n">tzinfo</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">utcoffset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ZERO</span>
  <span class="k">def</span> <span class="nf">tzname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">"UTC"</span>
  <span class="k">def</span> <span class="nf">dst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ZERO</span>

<span class="n">utc</span> <span class="o">=</span> <span class="n">UTC</span><span class="p">()</span>
</pre></div>

<p>then:</p>
<div class="code"><pre class="code literal-block">now = datetime.now(utc)
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1863.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1861.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
