<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 799) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-799.html">
<link rel="prev" href="index-800.html" type="text/html">
<link rel="next" href="index-798.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-best-way-to-auto-generate-insert-statements-for-a-sql-server-table/" class="u-url">What is the best way to auto-generate INSERT statements for a SQL Server table?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-best-way-to-auto-generate-insert-statements-for-a-sql-server-table/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:16:38+08:00" itemprop="datePublished" title="2023-02-17 16:16">2023-02-17 16:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>We are writing a new application, and while testing, we will need a bunch of
dummy data. I've added that data by using MS Access to dump excel files into
the relevant tables.</p>
<p>Every so often, we want to "refresh" the relevant tables, which means dropping
them all, re-creating them, and running a saved MS Access append query.</p>
<p>The first part (dropping &amp; re-creating) is an easy sql script, but the last
part makes me cringe. I want a single setup script that has a bunch of INSERTs
to regenerate the dummy data.</p>
<p>I have the data in the tables now. What is the best way to automatically
generate a big list of INSERT statements from that dataset?</p>
<p>The only way I can think of doing it is to save the table to an excel sheet
and then write an excel formula to create an INSERT for every row, which is
surely not the best way.</p>
<p>I'm using the 2008 Management Studio to connect to a SQL Server 2005 database.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Microsoft should advertise this functionality of SSMS 2008. The feature you
are looking for is built into the <strong>Generate Script</strong> utility, but the
functionality is turned off by default and must be enabled when scripting a
table.</p>
<p>This is a quick run through to generate the <code>INSERT</code> statements for all of the
data in your table, using no scripts or add-ins to SQL Management Studio 2008:</p>
<ol>
<li>Right-click on the database and go to <strong>Tasks</strong> &gt; <strong>Generate Scripts</strong>.</li>
<li>Select the tables (or objects) that you want to generate the script against.</li>
<li>Go to <strong>Set scripting options</strong> tab and click on the <strong>Advanced</strong> button.</li>
<li>In the <strong>General</strong> category, go to <strong>Type of data to script</strong>
</li>
<li>There are 3 options: <strong>Schema Only</strong> , <strong>Data Only</strong> , and <strong>Schema and Data</strong>. Select the appropriate option and click on <strong>OK</strong>. <img alt="SqlDataOptions" src="images/fWKfA.png">
</li>
</ol>
<p>You will then get the <code>CREATE TABLE</code> statement and all of the <code>INSERT</code>
statements for the data straight out of SSMS.</p>
<p><br></p>
<h3>Suggest</h3>
<p>We use this stored procedure - it allows you to target specific tables, and
use where clauses. You can find the text here.</p>
<p>For example, it lets you do this:</p>
<div class="code"><pre class="code literal-block"><span class="k">EXEC</span><span class="w"> </span><span class="nv">sp_generate_inserts</span><span class="w"> </span><span class="s1">'titles'</span>
</pre></div>

<hr>
<p>Source code copied from link:</p>
<div class="code"><pre class="code literal-block"><span class="k">SET</span><span class="w"> </span><span class="n">NOCOUNT</span><span class="w"> </span><span class="k">ON</span>
<span class="k">GO</span>

<span class="k">PRINT</span><span class="w"> </span><span class="s1">'Using Master database'</span>
<span class="k">USE</span><span class="w"> </span><span class="n">master</span>
<span class="k">GO</span>

<span class="k">PRINT</span><span class="w"> </span><span class="s1">'Checking for the existence of this procedure'</span>
<span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">OBJECT_ID</span><span class="p">(</span><span class="s1">'sp_generate_inserts'</span><span class="p">,</span><span class="s1">'P'</span><span class="p">))</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="o">--</span><span class="n">means</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">procedure</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="ow">exists</span>
<span class="w">    </span><span class="k">BEGIN</span>
<span class="w">        </span><span class="k">PRINT</span><span class="w"> </span><span class="s1">'Procedure already exists. So, dropping it'</span>
<span class="w">        </span><span class="k">DROP</span><span class="w"> </span><span class="k">PROC</span><span class="w"> </span><span class="n">sp_generate_inserts</span>
<span class="w">    </span><span class="k">END</span>
<span class="k">GO</span>

<span class="o">--</span><span class="n">Turn</span><span class="w"> </span><span class="k">system</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="n">marking</span><span class="w"> </span><span class="k">on</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">sp_MS_upd_sysobj_category</span><span class="w"> </span><span class="mi">1</span>
<span class="k">GO</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">PROC</span><span class="w"> </span><span class="n">sp_generate_inserts</span>
<span class="p">(</span>
<span class="w">    </span><span class="nv">@table_name</span><span class="w"> </span><span class="nc">varchar</span><span class="p">(</span><span class="mi">776</span><span class="p">),</span><span class="w">       </span><span class="o">--</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="nc">table</span><span class="o">/</span><span class="k">view</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="n">statements</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">existing</span><span class="w"> </span><span class="k">data</span>
<span class="w">    </span><span class="nv">@target_table</span><span class="w"> </span><span class="nc">varchar</span><span class="p">(</span><span class="mi">776</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">  </span><span class="o">--</span><span class="w"> </span><span class="k">Use</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">inserted</span>
<span class="w">    </span><span class="nv">@include_column_list</span><span class="w"> </span><span class="nc">bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">       </span><span class="o">--</span><span class="w"> </span><span class="k">Use</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">include</span><span class="o">/</span><span class="n">ommit</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">statement</span>
<span class="w">    </span><span class="nv">@from</span><span class="w"> </span><span class="nc">varchar</span><span class="p">(</span><span class="mi">800</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">      </span><span class="o">--</span><span class="w"> </span><span class="k">Use</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">filter</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">filter</span><span class="w"> </span><span class="k">condition</span><span class="w"> </span><span class="p">(</span><span class="k">using</span><span class="w"> </span><span class="k">WHERE</span><span class="p">)</span>
<span class="w">    </span><span class="nv">@include_timestamp</span><span class="w"> </span><span class="nc">bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">         </span><span class="o">--</span><span class="w"> </span><span class="n">Specify</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">parameter</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">include</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">TIMESTAMP</span><span class="o">/</span><span class="n">ROWVERSION</span><span class="w"> </span><span class="k">column</span><span class="s1">'s data in the INSERT statement</span>
<span class="s1">    @debug_mode bit = 0,            -- If @debug_mode is set to 1, the SQL statements constructed by this procedure will be printed for later examination</span>
<span class="s1">    @owner varchar(64) = NULL,      -- Use this parameter if you are not the owner of the table</span>
<span class="s1">    @ommit_images bit = 0,          -- Use this parameter to generate INSERT statements by omitting the '</span><span class="nc">image</span><span class="s1">' columns</span>
<span class="s1">    @ommit_identity bit = 0,        -- Use this parameter to ommit the identity columns</span>
<span class="s1">    @top int = NULL,            -- Use this parameter to generate INSERT statements only for the TOP n rows</span>
<span class="s1">    @cols_to_include varchar(8000) = NULL,  -- List of columns to be included in the INSERT statement</span>
<span class="s1">    @cols_to_exclude varchar(8000) = NULL,  -- List of columns to be excluded from the INSERT statement</span>
<span class="s1">    @disable_constraints bit = 0,       -- When 1, disables foreign key constraints and enables them after the INSERT statements</span>
<span class="s1">    @ommit_computed_cols bit = 0        -- When 1, computed columns will not be included in the INSERT statement</span>

<span class="s1">)</span>
<span class="s1">AS</span>
<span class="s1">BEGIN</span>

<span class="s1">/***********************************************************************************************************</span>
<span class="s1">Procedure:  sp_generate_inserts  (Build 22) </span>
<span class="s1">        (Copyright © 2002 Narayana Vyas Kondreddi. All rights reserved.)</span>

<span class="s1">Purpose:    To generate INSERT statements from existing data. </span>
<span class="s1">        These INSERTS can be executed to regenerate the data at some other location.</span>
<span class="s1">        This procedure is also useful to create a database setup, where in you can </span>
<span class="s1">        script your data along with your table definitions.</span>

<span class="s1">Written by: Narayana Vyas Kondreddi</span>
<span class="s1">            http://vyaskn.tripod.com</span>
<span class="s1">            http://vyaskn.tripod.com/code/generate_inserts.txt</span>

<span class="s1">Acknowledgements:</span>
<span class="s1">        Divya Kalra -- For beta testing</span>
<span class="s1">        Mark Charsley   -- For reporting a problem with scripting uniqueidentifier columns with NULL values</span>
<span class="s1">        Artur Zeygman   -- For helping me simplify a bit of code for handling non-dbo owned tables</span>
<span class="s1">        Joris Laperre   -- For reporting a regression bug in handling text/ntext columns</span>

<span class="s1">Tested on:  SQL Server 7.0 and SQL Server 2000</span>

<span class="s1">Date created:   January 17th 2001 21:52 GMT</span>

<span class="s1">Date modified:  May 1st 2002 19:50 GMT</span>

<span class="s1">Email:      vyaskn@hotmail.com</span>

<span class="s1">NOTE:       This procedure may not work with tables with too many columns.</span>
<span class="s1">        Results can be unpredictable with huge text columns or SQL Server 2000'</span><span class="n">s</span><span class="w"> </span><span class="nc">sql_variant</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">types</span>
<span class="w">        </span><span class="k">Whenever</span><span class="w"> </span><span class="n">possible</span><span class="p">,</span><span class="w"> </span><span class="k">Use</span><span class="w"> </span><span class="nv">@include_column_list</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">ommit</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">statement</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">better</span><span class="w"> </span><span class="n">results</span>
<span class="w">        </span><span class="nl">IMPORTANT</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">procedure</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">tested</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">internation</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="p">(</span><span class="n">Extended</span><span class="w"> </span><span class="n">characters</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nf">Unicode</span><span class="p">).</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="n">needed</span>
<span class="w">        </span><span class="n">you</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nf">convert</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">datatypes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">character</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">procedure</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">respective</span><span class="w"> </span><span class="nf">unicode</span><span class="w"> </span><span class="n">counterparts</span>
<span class="w">        </span><span class="ow">like</span><span class="w"> </span><span class="nc">nchar</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nc">nvarchar</span>


<span class="n">Example</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span><span class="w">  </span><span class="k">To</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="n">statements</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="s1">'titles'</span><span class="err">:</span>

<span class="w">        </span><span class="k">EXEC</span><span class="w"> </span><span class="n">sp_generate_inserts</span><span class="w"> </span><span class="s1">'titles'</span>

<span class="n">Example</span><span class="w"> </span><span class="mi">2</span><span class="err">:</span><span class="w">  </span><span class="k">To</span><span class="w"> </span><span class="n">ommit</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">statement</span><span class="err">:</span><span class="w"> </span><span class="p">(</span><span class="k">Column</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">included</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">default</span><span class="p">)</span>
<span class="w">        </span><span class="nl">IMPORTANT</span><span class="p">:</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">columns</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">advised</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">ommit</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">shown</span><span class="w"> </span><span class="n">below</span><span class="p">,</span>
<span class="w">        </span><span class="k">to</span><span class="w"> </span><span class="n">avoid</span><span class="w"> </span><span class="n">erroneous</span><span class="w"> </span><span class="n">results</span>

<span class="w">        </span><span class="k">EXEC</span><span class="w"> </span><span class="n">sp_generate_inserts</span><span class="w"> </span><span class="s1">'titles'</span><span class="p">,</span><span class="w"> </span><span class="nv">@include_column_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="n">Example</span><span class="w"> </span><span class="mi">3</span><span class="err">:</span><span class="w">  </span><span class="k">To</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="n">statements</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">'titlesCopy'</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="s1">'titles'</span><span class="w"> </span><span class="nc">table</span><span class="err">:</span>

<span class="w">        </span><span class="k">EXEC</span><span class="w"> </span><span class="n">sp_generate_inserts</span><span class="w"> </span><span class="s1">'titles'</span><span class="p">,</span><span class="w"> </span><span class="s1">'titlesCopy'</span>

<span class="n">Example</span><span class="w"> </span><span class="mi">4</span><span class="err">:</span><span class="w">  </span><span class="k">To</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="n">statements</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">'titles'</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">those</span><span class="w"> </span><span class="n">titles</span><span class="w"> </span>
<span class="w">        </span><span class="n">which</span><span class="w"> </span><span class="n">contain</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="s1">'Computer'</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">them</span><span class="p">:</span>
<span class="w">        </span><span class="nl">NOTE</span><span class="p">:</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">complicate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">clause</span><span class="w"> </span><span class="n">here</span><span class="p">.</span><span class="w"> </span><span class="n">It</span><span class="s1">'s assumed that you are good with T-SQL if you are using this parameter</span>

<span class="s1">        EXEC sp_generate_inserts '</span><span class="n">titles</span><span class="s1">', @from = "from titles where title like '</span><span class="o">%</span><span class="n">Computer</span><span class="o">%</span><span class="s1">'"</span>

<span class="s1">Example 5:  To specify that you want to include TIMESTAMP column'</span><span class="n">s</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">well</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="k">statement</span><span class="err">:</span>
<span class="w">        </span><span class="p">(</span><span class="k">By</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nc">TIMESTAMP</span><span class="w"> </span><span class="k">column</span><span class="s1">'s data is not scripted)</span>

<span class="s1">        EXEC sp_generate_inserts '</span><span class="n">titles</span><span class="s1">', @include_timestamp = 1</span>

<span class="s1">Example 6:  To print the debug information:</span>

<span class="s1">        EXEC sp_generate_inserts '</span><span class="n">titles</span><span class="s1">', @debug_mode = 1</span>

<span class="s1">Example 7:  If you are not the owner of the table, use @owner parameter to specify the owner name</span>
<span class="s1">        To use this option, you must have SELECT permissions on that table</span>

<span class="s1">        EXEC sp_generate_inserts Nickstable, @owner = '</span><span class="n">Nick</span><span class="s1">'</span>

<span class="s1">Example 8:  To generate INSERT statements for the rest of the columns excluding images</span>
<span class="s1">        When using this otion, DO NOT set @include_column_list parameter to 0.</span>

<span class="s1">        EXEC sp_generate_inserts imgtable, @ommit_images = 1</span>

<span class="s1">Example 9:  To generate INSERT statements excluding (ommiting) IDENTITY columns:</span>
<span class="s1">        (By default IDENTITY columns are included in the INSERT statement)</span>

<span class="s1">        EXEC sp_generate_inserts mytable, @ommit_identity = 1</span>

<span class="s1">Example 10:     To generate INSERT statements for the TOP 10 rows in the table:</span>

<span class="s1">        EXEC sp_generate_inserts mytable, @top = 10</span>

<span class="s1">Example 11:     To generate INSERT statements with only those columns you want:</span>

<span class="s1">        EXEC sp_generate_inserts titles, @cols_to_include = "'</span><span class="n">title</span><span class="s1">','</span><span class="n">title_id</span><span class="s1">','</span><span class="n">au_id</span><span class="s1">'"</span>

<span class="s1">Example 12:     To generate INSERT statements by omitting certain columns:</span>

<span class="s1">        EXEC sp_generate_inserts titles, @cols_to_exclude = "'</span><span class="n">title</span><span class="s1">','</span><span class="n">title_id</span><span class="s1">','</span><span class="n">au_id</span><span class="s1">'"</span>

<span class="s1">Example 13: To avoid checking the foreign key constraints while loading data with INSERT statements:</span>

<span class="s1">        EXEC sp_generate_inserts titles, @disable_constraints = 1</span>

<span class="s1">Example 14:     To exclude computed columns from the INSERT statement:</span>
<span class="s1">        EXEC sp_generate_inserts MyTable, @ommit_computed_cols = 1</span>
<span class="s1">***********************************************************************************************************/</span>

<span class="s1">SET NOCOUNT ON</span>

<span class="s1">--Making sure user only uses either @cols_to_include or @cols_to_exclude</span>
<span class="s1">IF ((@cols_to_include IS NOT NULL) AND (@cols_to_exclude IS NOT NULL))</span>
<span class="s1">    BEGIN</span>
<span class="s1">        RAISERROR('</span><span class="k">Use</span><span class="w"> </span><span class="n">either</span><span class="w"> </span><span class="nv">@cols_to_include</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nv">@cols_to_exclude</span><span class="p">.</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">parameters</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">once</span><span class="s1">',16,1)</span>
<span class="s1">        RETURN -1 --Failure. Reason: Both @cols_to_include and @cols_to_exclude parameters are specified</span>
<span class="s1">    END</span>

<span class="s1">--Making sure the @cols_to_include and @cols_to_exclude parameters are receiving values in proper format</span>
<span class="s1">IF ((@cols_to_include IS NOT NULL) AND (PATINDEX('''</span><span class="o">%</span><span class="s1">''',@cols_to_include) = 0))</span>
<span class="s1">    BEGIN</span>
<span class="s1">        RAISERROR('</span><span class="n">Invalid</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">@cols_to_include</span><span class="w"> </span><span class="n">property</span><span class="s1">',16,1)</span>
<span class="s1">        PRINT '</span><span class="n">Specify</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="k">names</span><span class="w"> </span><span class="n">surrounded</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">separated</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">commas</span><span class="s1">'</span>
<span class="s1">        PRINT '</span><span class="nl">Eg</span><span class="p">:</span><span class="w"> </span><span class="k">EXEC</span><span class="w"> </span><span class="n">sp_generate_inserts</span><span class="w"> </span><span class="n">titles</span><span class="p">,</span><span class="w"> </span><span class="nv">@cols_to_include</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">"''title_id'',''title''"</span><span class="s1">'</span>
<span class="s1">        RETURN -1 --Failure. Reason: Invalid use of @cols_to_include property</span>
<span class="s1">    END</span>

<span class="s1">IF ((@cols_to_exclude IS NOT NULL) AND (PATINDEX('''</span><span class="o">%</span><span class="s1">''',@cols_to_exclude) = 0))</span>
<span class="s1">    BEGIN</span>
<span class="s1">        RAISERROR('</span><span class="n">Invalid</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">@cols_to_exclude</span><span class="w"> </span><span class="n">property</span><span class="s1">',16,1)</span>
<span class="s1">        PRINT '</span><span class="n">Specify</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="k">names</span><span class="w"> </span><span class="n">surrounded</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">quotes</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">separated</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">commas</span><span class="s1">'</span>
<span class="s1">        PRINT '</span><span class="nl">Eg</span><span class="p">:</span><span class="w"> </span><span class="k">EXEC</span><span class="w"> </span><span class="n">sp_generate_inserts</span><span class="w"> </span><span class="n">titles</span><span class="p">,</span><span class="w"> </span><span class="nv">@cols_to_exclude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">"''title_id'',''title''"</span><span class="s1">'</span>
<span class="s1">        RETURN -1 --Failure. Reason: Invalid use of @cols_to_exclude property</span>
<span class="s1">    END</span>


<span class="s1">--Checking to see if the database name is specified along wih the table name</span>
<span class="s1">--Your database context should be local to the table for which you want to generate INSERT statements</span>
<span class="s1">--specifying the database name is not allowed</span>
<span class="s1">IF (PARSENAME(@table_name,3)) IS NOT NULL</span>
<span class="s1">    BEGIN</span>
<span class="s1">        RAISERROR('</span><span class="n">Do</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="w"> </span><span class="n">Be</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="s1">',16,1)</span>
<span class="s1">        RETURN -1 --Failure. Reason: Database name is specified along with the table name, which is not allowed</span>
<span class="s1">    END</span>

<span class="s1">--Checking for the existence of '</span><span class="k">user</span><span class="w"> </span><span class="nc">table</span><span class="s1">' or '</span><span class="k">view</span><span class="s1">'</span>
<span class="s1">--This procedure is not written to work on system tables</span>
<span class="s1">--To script the data in system tables, just create a view on the system tables and script the view instead</span>

<span class="s1">IF @owner IS NULL</span>
<span class="s1">    BEGIN</span>
<span class="s1">        IF ((OBJECT_ID(@table_name,'</span><span class="n">U</span><span class="s1">') IS NULL) AND (OBJECT_ID(@table_name,'</span><span class="n">V</span><span class="s1">') IS NULL)) </span>
<span class="s1">            BEGIN</span>
<span class="s1">                RAISERROR('</span><span class="k">User</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">found</span><span class="p">.</span><span class="s1">',16,1)</span>
<span class="s1">                PRINT '</span><span class="n">You</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">view</span><span class="p">.</span><span class="w"> </span><span class="ow">In</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="nv">@owner</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="s1">'</span>
<span class="s1">                PRINT '</span><span class="n">Make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">view</span><span class="p">.</span><span class="s1">'</span>
<span class="s1">                RETURN -1 --Failure. Reason: There is no user table or view with this name</span>
<span class="s1">            END</span>
<span class="s1">    END</span>
<span class="s1">ELSE</span>
<span class="s1">    BEGIN</span>
<span class="s1">        IF NOT EXISTS (SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = @table_name AND (TABLE_TYPE = '</span><span class="n">BASE</span><span class="w"> </span><span class="nc">TABLE</span><span class="s1">' OR TABLE_TYPE = '</span><span class="k">VIEW</span><span class="s1">') AND TABLE_SCHEMA = @owner)</span>
<span class="s1">            BEGIN</span>
<span class="s1">                RAISERROR('</span><span class="k">User</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">view</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">found</span><span class="p">.</span><span class="s1">',16,1)</span>
<span class="s1">                PRINT '</span><span class="n">You</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="nc">table</span><span class="p">.</span><span class="w"> </span><span class="ow">In</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="nv">@owner</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">owner</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="s1">'</span>
<span class="s1">                PRINT '</span><span class="n">Make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">view</span><span class="p">.</span><span class="s1">'</span>
<span class="s1">                RETURN -1 --Failure. Reason: There is no user table or view with this name      </span>
<span class="s1">            END</span>
<span class="s1">    END</span>

<span class="s1">--Variable declarations</span>
<span class="s1">DECLARE     @Column_ID int,         </span>
<span class="s1">        @Column_List varchar(8000), </span>
<span class="s1">        @Column_Name varchar(128), </span>
<span class="s1">        @Start_Insert varchar(786), </span>
<span class="s1">        @Data_Type varchar(128), </span>
<span class="s1">        @Actual_Values varchar(8000),   --This is the string that will be finally executed to generate INSERT statements</span>
<span class="s1">        @IDN varchar(128)       --Will contain the IDENTITY column'</span><span class="n">s</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">table</span>

<span class="o">--</span><span class="k">Variable</span><span class="w"> </span><span class="n">Initialization</span>
<span class="k">SET</span><span class="w"> </span><span class="nv">@IDN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span>
<span class="k">SET</span><span class="w"> </span><span class="nv">@Column_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">SET</span><span class="w"> </span><span class="nv">@Column_Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span>
<span class="k">SET</span><span class="w"> </span><span class="nv">@Column_List</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span>
<span class="k">SET</span><span class="w"> </span><span class="nv">@Actual_Values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span>

<span class="k">IF</span><span class="w"> </span><span class="nv">@owner</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span>
<span class="w">    </span><span class="k">BEGIN</span>
<span class="w">        </span><span class="k">SET</span><span class="w"> </span><span class="nv">@Start_Insert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'INSERT INTO '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'['</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">RTRIM</span><span class="p">(</span><span class="k">COALESCE</span><span class="p">(</span><span class="nv">@target_table</span><span class="p">,</span><span class="nv">@table_name</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">']'</span><span class="w"> </span>
<span class="w">    </span><span class="k">END</span>
<span class="k">ELSE</span>
<span class="w">    </span><span class="k">BEGIN</span>
<span class="w">        </span><span class="k">SET</span><span class="w"> </span><span class="nv">@Start_Insert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'INSERT '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'['</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">LTRIM</span><span class="p">(</span><span class="nf">RTRIM</span><span class="p">(</span><span class="nv">@owner</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'].'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'['</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">RTRIM</span><span class="p">(</span><span class="k">COALESCE</span><span class="p">(</span><span class="nv">@target_table</span><span class="p">,</span><span class="nv">@table_name</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">']'</span><span class="w">      </span>
<span class="w">    </span><span class="k">END</span>


<span class="o">--</span><span class="k">To</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="k">column</span><span class="s1">'s ID</span>

<span class="s1">SELECT  @Column_ID = MIN(ORDINAL_POSITION)  </span>
<span class="s1">FROM    INFORMATION_SCHEMA.COLUMNS (NOLOCK) </span>
<span class="s1">WHERE   TABLE_NAME = @table_name AND</span>
<span class="s1">(@owner IS NULL OR TABLE_SCHEMA = @owner)</span>



<span class="s1">--Loop through all the columns of the table, to get the column names and their data types</span>
<span class="s1">WHILE @Column_ID IS NOT NULL</span>
<span class="s1">    BEGIN</span>
<span class="s1">        SELECT  @Column_Name = QUOTENAME(COLUMN_NAME), </span>
<span class="s1">        @Data_Type = DATA_TYPE </span>
<span class="s1">        FROM    INFORMATION_SCHEMA.COLUMNS (NOLOCK) </span>
<span class="s1">        WHERE   ORDINAL_POSITION = @Column_ID AND </span>
<span class="s1">        TABLE_NAME = @table_name AND</span>
<span class="s1">        (@owner IS NULL OR TABLE_SCHEMA = @owner)</span>



<span class="s1">        IF @cols_to_include IS NOT NULL --Selecting only user specified columns</span>
<span class="s1">        BEGIN</span>
<span class="s1">            IF CHARINDEX( '''' + SUBSTRING(@Column_Name,2,LEN(@Column_Name)-2) + '''',@cols_to_include) = 0 </span>
<span class="s1">            BEGIN</span>
<span class="s1">                GOTO SKIP_LOOP</span>
<span class="s1">            END</span>
<span class="s1">        END</span>

<span class="s1">        IF @cols_to_exclude IS NOT NULL --Selecting only user specified columns</span>
<span class="s1">        BEGIN</span>
<span class="s1">            IF CHARINDEX( '''' + SUBSTRING(@Column_Name,2,LEN(@Column_Name)-2) + '''',@cols_to_exclude) &lt;&gt; 0 </span>
<span class="s1">            BEGIN</span>
<span class="s1">                GOTO SKIP_LOOP</span>
<span class="s1">            END</span>
<span class="s1">        END</span>

<span class="s1">        --Making sure to output SET IDENTITY_INSERT ON/OFF in case the table has an IDENTITY column</span>
<span class="s1">        IF (SELECT COLUMNPROPERTY( OBJECT_ID(QUOTENAME(COALESCE(@owner,USER_NAME())) + '</span><span class="p">.</span><span class="s1">' + @table_name),SUBSTRING(@Column_Name,2,LEN(@Column_Name) - 2),'</span><span class="n">IsIdentity</span><span class="s1">')) = 1 </span>
<span class="s1">        BEGIN</span>
<span class="s1">            IF @ommit_identity = 0 --Determing whether to include or exclude the IDENTITY column</span>
<span class="s1">                SET @IDN = @Column_Name</span>
<span class="s1">            ELSE</span>
<span class="s1">                GOTO SKIP_LOOP          </span>
<span class="s1">        END</span>

<span class="s1">        --Making sure whether to output computed columns or not</span>
<span class="s1">        IF @ommit_computed_cols = 1</span>
<span class="s1">        BEGIN</span>
<span class="s1">            IF (SELECT COLUMNPROPERTY( OBJECT_ID(QUOTENAME(COALESCE(@owner,USER_NAME())) + '</span><span class="p">.</span><span class="s1">' + @table_name),SUBSTRING(@Column_Name,2,LEN(@Column_Name) - 2),'</span><span class="n">IsComputed</span><span class="s1">')) = 1 </span>
<span class="s1">            BEGIN</span>
<span class="s1">                GOTO SKIP_LOOP                  </span>
<span class="s1">            END</span>
<span class="s1">        END</span>

<span class="s1">        --Tables with columns of IMAGE data type are not supported for obvious reasons</span>
<span class="s1">        IF(@Data_Type in ('</span><span class="nc">image</span><span class="s1">'))</span>
<span class="s1">            BEGIN</span>
<span class="s1">                IF (@ommit_images = 0)</span>
<span class="s1">                    BEGIN</span>
<span class="s1">                        RAISERROR('</span><span class="n">Tables</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="nc">image</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">supported</span><span class="p">.</span><span class="s1">',16,1)</span>
<span class="s1">                        PRINT '</span><span class="k">Use</span><span class="w"> </span><span class="nv">@ommit_images</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="n">INSERTs</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">rest</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">columns</span><span class="p">.</span><span class="s1">'</span>
<span class="s1">                        PRINT '</span><span class="n">DO</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="n">ommit</span><span class="w"> </span><span class="k">Column</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="n">statements</span><span class="p">.</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">ommit</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="nv">@include_column_list</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="n">INSERTs</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">fail</span><span class="p">.</span><span class="s1">'</span>
<span class="s1">                        RETURN -1 --Failure. Reason: There is a column with image data type</span>
<span class="s1">                    END</span>
<span class="s1">                ELSE</span>
<span class="s1">                    BEGIN</span>
<span class="s1">                    GOTO SKIP_LOOP</span>
<span class="s1">                    END</span>
<span class="s1">            END</span>

<span class="s1">        --Determining the data type of the column and depending on the data type, the VALUES part of</span>
<span class="s1">        --the INSERT statement is generated. Care is taken to handle columns with NULL values. Also</span>
<span class="s1">        --making sure, not to lose any data from flot, real, money, smallmomey, datetime columns</span>
<span class="s1">        SET @Actual_Values = @Actual_Values  +</span>
<span class="s1">        CASE </span>
<span class="s1">            WHEN @Data_Type IN ('</span><span class="nc">char</span><span class="s1">','</span><span class="nc">varchar</span><span class="s1">','</span><span class="nc">nchar</span><span class="s1">','</span><span class="nc">nvarchar</span><span class="s1">') </span>
<span class="s1">                THEN </span>
<span class="s1">                    '</span><span class="k">COALESCE</span><span class="p">(</span><span class="s1">''''''''</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">REPLACE</span><span class="p">(</span><span class="nf">RTRIM</span><span class="p">(</span><span class="s1">' + @Column_Name + '</span><span class="p">),</span><span class="s1">''''''''</span><span class="p">,</span><span class="s1">''''''''''''</span><span class="p">)</span><span class="o">+</span><span class="s1">''''''''</span><span class="p">,</span><span class="s1">''</span><span class="k">NULL</span><span class="s1">''</span><span class="p">)</span><span class="s1">'</span>
<span class="s1">            WHEN @Data_Type IN ('</span><span class="nc">datetime</span><span class="s1">','</span><span class="nc">smalldatetime</span><span class="s1">') </span>
<span class="s1">                THEN </span>
<span class="s1">                    '</span><span class="k">COALESCE</span><span class="p">(</span><span class="s1">''''''''</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">RTRIM</span><span class="p">(</span><span class="nf">CONVERT</span><span class="p">(</span><span class="nc">char</span><span class="p">,</span><span class="s1">' + @Column_Name + '</span><span class="p">,</span><span class="mi">109</span><span class="p">))</span><span class="o">+</span><span class="s1">''''''''</span><span class="p">,</span><span class="s1">''</span><span class="k">NULL</span><span class="s1">''</span><span class="p">)</span><span class="s1">'</span>
<span class="s1">            WHEN @Data_Type IN ('</span><span class="nc">uniqueidentifier</span><span class="s1">') </span>
<span class="s1">                THEN  </span>
<span class="s1">                    '</span><span class="k">COALESCE</span><span class="p">(</span><span class="s1">''''''''</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">REPLACE</span><span class="p">(</span><span class="nf">CONVERT</span><span class="p">(</span><span class="nc">char</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span><span class="nf">RTRIM</span><span class="p">(</span><span class="s1">' + @Column_Name + '</span><span class="p">)),</span><span class="s1">''''''''</span><span class="p">,</span><span class="s1">''''''''''''</span><span class="p">)</span><span class="o">+</span><span class="s1">''''''''</span><span class="p">,</span><span class="s1">''</span><span class="k">NULL</span><span class="s1">''</span><span class="p">)</span><span class="s1">'</span>
<span class="s1">            WHEN @Data_Type IN ('</span><span class="nc">text</span><span class="s1">','</span><span class="nc">ntext</span><span class="s1">') </span>
<span class="s1">                THEN  </span>
<span class="s1">                    '</span><span class="k">COALESCE</span><span class="p">(</span><span class="s1">''''''''</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">REPLACE</span><span class="p">(</span><span class="nf">CONVERT</span><span class="p">(</span><span class="nc">char</span><span class="p">(</span><span class="mi">8000</span><span class="p">),</span><span class="s1">' + @Column_Name + '</span><span class="p">),</span><span class="s1">''''''''</span><span class="p">,</span><span class="s1">''''''''''''</span><span class="p">)</span><span class="o">+</span><span class="s1">''''''''</span><span class="p">,</span><span class="s1">''</span><span class="k">NULL</span><span class="s1">''</span><span class="p">)</span><span class="s1">'                    </span>
<span class="s1">            WHEN @Data_Type IN ('</span><span class="nc">binary</span><span class="s1">','</span><span class="nc">varbinary</span><span class="s1">') </span>
<span class="s1">                THEN  </span>
<span class="s1">                    '</span><span class="k">COALESCE</span><span class="p">(</span><span class="nf">RTRIM</span><span class="p">(</span><span class="nf">CONVERT</span><span class="p">(</span><span class="nc">char</span><span class="p">,</span><span class="s1">' + '</span><span class="nf">CONVERT</span><span class="p">(</span><span class="nc">int</span><span class="p">,</span><span class="s1">' + @Column_Name + '</span><span class="p">))),</span><span class="s1">''</span><span class="k">NULL</span><span class="s1">''</span><span class="p">)</span><span class="s1">'  </span>
<span class="s1">            WHEN @Data_Type IN ('</span><span class="nc">timestamp</span><span class="s1">','</span><span class="n">rowversion</span><span class="s1">') </span>
<span class="s1">                THEN  </span>
<span class="s1">                    CASE </span>
<span class="s1">                        WHEN @include_timestamp = 0 </span>
<span class="s1">                            THEN </span>
<span class="s1">                                '''</span><span class="k">DEFAULT</span><span class="s1">''' </span>
<span class="s1">                            ELSE </span>
<span class="s1">                                '</span><span class="k">COALESCE</span><span class="p">(</span><span class="nf">RTRIM</span><span class="p">(</span><span class="nf">CONVERT</span><span class="p">(</span><span class="nc">char</span><span class="p">,</span><span class="s1">' + '</span><span class="nf">CONVERT</span><span class="p">(</span><span class="nc">int</span><span class="p">,</span><span class="s1">' + @Column_Name + '</span><span class="p">))),</span><span class="s1">''</span><span class="k">NULL</span><span class="s1">''</span><span class="p">)</span><span class="s1">'  </span>
<span class="s1">                    END</span>
<span class="s1">            WHEN @Data_Type IN ('</span><span class="nc">float</span><span class="s1">','</span><span class="nc">real</span><span class="s1">','</span><span class="nc">money</span><span class="s1">','</span><span class="nc">smallmoney</span><span class="s1">')</span>
<span class="s1">                THEN</span>
<span class="s1">                    '</span><span class="k">COALESCE</span><span class="p">(</span><span class="nf">LTRIM</span><span class="p">(</span><span class="nf">RTRIM</span><span class="p">(</span><span class="s1">' + '</span><span class="nf">CONVERT</span><span class="p">(</span><span class="nc">char</span><span class="p">,</span><span class="w"> </span><span class="s1">' +  @Column_Name  + '</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="s1">' + '</span><span class="p">)),</span><span class="s1">''</span><span class="k">NULL</span><span class="s1">''</span><span class="p">)</span><span class="s1">' </span>
<span class="s1">            ELSE </span>
<span class="s1">                '</span><span class="k">COALESCE</span><span class="p">(</span><span class="nf">LTRIM</span><span class="p">(</span><span class="nf">RTRIM</span><span class="p">(</span><span class="s1">' + '</span><span class="nf">CONVERT</span><span class="p">(</span><span class="nc">char</span><span class="p">,</span><span class="w"> </span><span class="s1">' +  @Column_Name  + '</span><span class="p">)</span><span class="s1">' + '</span><span class="p">)),</span><span class="s1">''</span><span class="k">NULL</span><span class="s1">''</span><span class="p">)</span><span class="s1">' </span>
<span class="s1">        END   + '</span><span class="o">+</span><span class="s1">' +  '''</span><span class="p">,</span><span class="s1">''' + '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'</span>

<span class="s1">        --Generating the column list for the INSERT statement</span>
<span class="s1">        SET @Column_List = @Column_List +  @Column_Name + '</span><span class="p">,</span><span class="s1">'</span>

<span class="s1">        SKIP_LOOP: --The label used in GOTO</span>

<span class="s1">        SELECT  @Column_ID = MIN(ORDINAL_POSITION) </span>
<span class="s1">        FROM    INFORMATION_SCHEMA.COLUMNS (NOLOCK) </span>
<span class="s1">        WHERE   TABLE_NAME = @table_name AND </span>
<span class="s1">        ORDINAL_POSITION &gt; @Column_ID AND</span>
<span class="s1">        (@owner IS NULL OR TABLE_SCHEMA = @owner)</span>


<span class="s1">    --Loop ends here!</span>
<span class="s1">    END</span>

<span class="s1">--To get rid of the extra characters that got concatenated during the last run through the loop</span>
<span class="s1">SET @Column_List = LEFT(@Column_List,len(@Column_List) - 1)</span>
<span class="s1">SET @Actual_Values = LEFT(@Actual_Values,len(@Actual_Values) - 6)</span>

<span class="s1">IF LTRIM(@Column_List) = '' </span>
<span class="s1">    BEGIN</span>
<span class="s1">        RAISERROR('</span><span class="k">No</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">select</span><span class="p">.</span><span class="w"> </span><span class="n">There</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">least</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">generate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">output</span><span class="s1">',16,1)</span>
<span class="s1">        RETURN -1 --Failure. Reason: Looks like all the columns are ommitted using the @cols_to_exclude parameter</span>
<span class="s1">    END</span>

<span class="s1">--Forming the final string that will be executed, to output the INSERT statements</span>
<span class="s1">IF (@include_column_list &lt;&gt; 0)</span>
<span class="s1">    BEGIN</span>
<span class="s1">        SET @Actual_Values = </span>
<span class="s1">            '</span><span class="k">SELECT</span><span class="w"> </span><span class="s1">' +  </span>
<span class="s1">            CASE WHEN @top IS NULL OR @top &lt; 0 THEN '' ELSE '</span><span class="w"> </span><span class="k">TOP</span><span class="w"> </span><span class="s1">' + LTRIM(STR(@top)) + '</span><span class="w"> </span><span class="s1">' END + </span>
<span class="s1">            '''' + RTRIM(@Start_Insert) + </span>
<span class="s1">            '</span><span class="w"> </span><span class="s1">''</span><span class="o">+</span><span class="s1">' + '''</span><span class="p">(</span><span class="s1">' + RTRIM(@Column_List) +  '''</span><span class="o">+</span><span class="s1">' + '''</span><span class="p">)</span><span class="s1">''' + </span>
<span class="s1">            '</span><span class="w"> </span><span class="o">+</span><span class="s1">''</span><span class="k">VALUES</span><span class="p">(</span><span class="s1">''</span><span class="o">+</span><span class="w"> </span><span class="s1">' +  @Actual_Values  + '</span><span class="o">+</span><span class="s1">''</span><span class="p">)</span><span class="s1">''' + '</span><span class="w"> </span><span class="s1">' + </span>
<span class="s1">            COALESCE(@from,'</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">' + CASE WHEN @owner IS NULL THEN '' ELSE '</span><span class="o">[</span><span class="n">' + LTRIM(RTRIM(@owner)) + '</span><span class="o">]</span><span class="p">.</span><span class="s1">' END + '</span><span class="o">[</span><span class="n">' + rtrim(@table_name) + '</span><span class="o">]</span><span class="s1">' + '</span><span class="p">(</span><span class="n">NOLOCK</span><span class="p">)</span><span class="s1">')</span>
<span class="s1">    END</span>
<span class="s1">ELSE IF (@include_column_list = 0)</span>
<span class="s1">    BEGIN</span>
<span class="s1">        SET @Actual_Values = </span>
<span class="s1">            '</span><span class="k">SELECT</span><span class="w"> </span><span class="s1">' + </span>
<span class="s1">            CASE WHEN @top IS NULL OR @top &lt; 0 THEN '' ELSE '</span><span class="w"> </span><span class="k">TOP</span><span class="w"> </span><span class="s1">' + LTRIM(STR(@top)) + '</span><span class="w"> </span><span class="s1">' END + </span>
<span class="s1">            '''' + RTRIM(@Start_Insert) + </span>
<span class="s1">            '</span><span class="w"> </span><span class="s1">''</span><span class="w"> </span><span class="o">+</span><span class="s1">''</span><span class="k">VALUES</span><span class="p">(</span><span class="s1">''</span><span class="o">+</span><span class="w"> </span><span class="s1">' +  @Actual_Values + '</span><span class="o">+</span><span class="s1">''</span><span class="p">)</span><span class="s1">''' + '</span><span class="w"> </span><span class="s1">' + </span>
<span class="s1">            COALESCE(@from,'</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">' + CASE WHEN @owner IS NULL THEN '' ELSE '</span><span class="o">[</span><span class="n">' + LTRIM(RTRIM(@owner)) + '</span><span class="o">]</span><span class="p">.</span><span class="s1">' END + '</span><span class="o">[</span><span class="n">' + rtrim(@table_name) + '</span><span class="o">]</span><span class="s1">' + '</span><span class="p">(</span><span class="n">NOLOCK</span><span class="p">)</span><span class="s1">')</span>
<span class="s1">    END</span>

<span class="s1">--Determining whether to ouput any debug information</span>
<span class="s1">IF @debug_mode =1</span>
<span class="s1">    BEGIN</span>
<span class="s1">        PRINT '</span><span class="cm">/*****START OF DEBUG INFORMATION*****'</span>
<span class="cm">        PRINT 'Beginning of the INSERT statement:'</span>
<span class="cm">        PRINT @Start_Insert</span>
<span class="cm">        PRINT ''</span>
<span class="cm">        PRINT 'The column list:'</span>
<span class="cm">        PRINT @Column_List</span>
<span class="cm">        PRINT ''</span>
<span class="cm">        PRINT 'The SELECT statement executed to generate the INSERTs'</span>
<span class="cm">        PRINT @Actual_Values</span>
<span class="cm">        PRINT ''</span>
<span class="cm">        PRINT '*****END OF DEBUG INFORMATION*****/</span><span class="s1">'</span>
<span class="s1">        PRINT ''</span>
<span class="s1">    END</span>

<span class="s1">PRINT '</span><span class="o">--</span><span class="n">INSERTs</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="s1">''</span><span class="n">sp_generate_inserts</span><span class="s1">''</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="k">procedure</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">Vyas</span><span class="s1">'</span>
<span class="s1">PRINT '</span><span class="o">--</span><span class="n">Build</span><span class="w"> </span><span class="nl">number</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="s1">'</span>
<span class="s1">PRINT '</span><span class="o">--</span><span class="n">Problems</span><span class="o">/</span><span class="n">Suggestions</span><span class="vm">?</span><span class="w"> </span><span class="n">Contact</span><span class="w"> </span><span class="n">Vyas</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">vyaskn</span><span class="nv">@hotmail</span><span class="p">.</span><span class="n">com</span><span class="s1">'</span>
<span class="s1">PRINT '</span><span class="o">--</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">vyaskn</span><span class="p">.</span><span class="n">tripod</span><span class="p">.</span><span class="n">com</span><span class="s1">'</span>
<span class="s1">PRINT ''</span>
<span class="s1">PRINT '</span><span class="k">SET</span><span class="w"> </span><span class="n">NOCOUNT</span><span class="w"> </span><span class="k">ON</span><span class="s1">'</span>
<span class="s1">PRINT ''</span>


<span class="s1">--Determining whether to print IDENTITY_INSERT or not</span>
<span class="s1">IF (@IDN &lt;&gt; '')</span>
<span class="s1">    BEGIN</span>
<span class="s1">        PRINT '</span><span class="k">SET</span><span class="w"> </span><span class="k">IDENTITY_INSERT</span><span class="w"> </span><span class="s1">' + QUOTENAME(COALESCE(@owner,USER_NAME())) + '</span><span class="p">.</span><span class="s1">' + QUOTENAME(@table_name) + '</span><span class="w"> </span><span class="k">ON</span><span class="s1">'</span>
<span class="s1">        PRINT '</span><span class="k">GO</span><span class="s1">'</span>
<span class="s1">        PRINT ''</span>
<span class="s1">    END</span>


<span class="s1">IF @disable_constraints = 1 AND (OBJECT_ID(QUOTENAME(COALESCE(@owner,USER_NAME())) + '</span><span class="p">.</span><span class="s1">' + @table_name, '</span><span class="n">U</span><span class="s1">') IS NOT NULL)</span>
<span class="s1">    BEGIN</span>
<span class="s1">        IF @owner IS NULL</span>
<span class="s1">            BEGIN</span>
<span class="s1">                SELECT  '</span><span class="k">ALTER</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="s1">' + QUOTENAME(COALESCE(@target_table, @table_name)) + '</span><span class="w"> </span><span class="k">NOCHECK</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="ow">ALL</span><span class="s1">' AS '</span><span class="o">--</span><span class="n">Code</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">disable</span><span class="w"> </span><span class="k">constraints</span><span class="w"> </span><span class="n">temporarily</span><span class="s1">'</span>
<span class="s1">            END</span>
<span class="s1">        ELSE</span>
<span class="s1">            BEGIN</span>
<span class="s1">                SELECT  '</span><span class="k">ALTER</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="s1">' + QUOTENAME(@owner) + '</span><span class="p">.</span><span class="s1">' + QUOTENAME(COALESCE(@target_table, @table_name)) + '</span><span class="w"> </span><span class="k">NOCHECK</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="ow">ALL</span><span class="s1">' AS '</span><span class="o">--</span><span class="n">Code</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">disable</span><span class="w"> </span><span class="k">constraints</span><span class="w"> </span><span class="n">temporarily</span><span class="s1">'</span>
<span class="s1">            END</span>

<span class="s1">        PRINT '</span><span class="k">GO</span><span class="s1">'</span>
<span class="s1">    END</span>

<span class="s1">PRINT ''</span>
<span class="s1">PRINT '</span><span class="k">PRINT</span><span class="w"> </span><span class="s1">''</span><span class="n">Inserting</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="s1">' + '</span><span class="o">[</span><span class="n">' + RTRIM(COALESCE(@target_table,@table_name)) + '</span><span class="o">]</span><span class="s1">' + ''''</span>


<span class="s1">--All the hard work pays off here!!! You'</span><span class="n">ll</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="k">INSERT</span><span class="w"> </span><span class="n">statements</span><span class="p">,</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">executes</span><span class="err">!</span>
<span class="k">EXEC</span><span class="w"> </span><span class="p">(</span><span class="nv">@Actual_Values</span><span class="p">)</span>

<span class="k">PRINT</span><span class="w"> </span><span class="s1">'PRINT ''Done'''</span>
<span class="k">PRINT</span><span class="w"> </span><span class="s1">''</span>


<span class="k">IF</span><span class="w"> </span><span class="nv">@disable_constraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">AND</span><span class="w"> </span><span class="p">(</span><span class="nf">OBJECT_ID</span><span class="p">(</span><span class="nf">QUOTENAME</span><span class="p">(</span><span class="k">COALESCE</span><span class="p">(</span><span class="nv">@owner</span><span class="p">,</span><span class="nf">USER_NAME</span><span class="p">()))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'.'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@table_name</span><span class="p">,</span><span class="w"> </span><span class="s1">'U'</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">)</span>
<span class="w">    </span><span class="k">BEGIN</span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">@owner</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span>
<span class="w">            </span><span class="k">BEGIN</span>
<span class="w">                </span><span class="k">SELECT</span><span class="w">  </span><span class="s1">'ALTER TABLE '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">QUOTENAME</span><span class="p">(</span><span class="k">COALESCE</span><span class="p">(</span><span class="nv">@target_table</span><span class="p">,</span><span class="w"> </span><span class="nv">@table_name</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' CHECK CONSTRAINT ALL'</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="s1">'--Code to enable the previously disabled constraints'</span>
<span class="w">            </span><span class="k">END</span>
<span class="w">        </span><span class="k">ELSE</span>
<span class="w">            </span><span class="k">BEGIN</span>
<span class="w">                </span><span class="k">SELECT</span><span class="w">  </span><span class="s1">'ALTER TABLE '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">QUOTENAME</span><span class="p">(</span><span class="nv">@owner</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'.'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">QUOTENAME</span><span class="p">(</span><span class="k">COALESCE</span><span class="p">(</span><span class="nv">@target_table</span><span class="p">,</span><span class="w"> </span><span class="nv">@table_name</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' CHECK CONSTRAINT ALL'</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s1">'--Code to enable the previously disabled constraints'</span>
<span class="w">            </span><span class="k">END</span>

<span class="w">        </span><span class="k">PRINT</span><span class="w"> </span><span class="s1">'GO'</span>
<span class="w">    </span><span class="k">END</span>

<span class="k">PRINT</span><span class="w"> </span><span class="s1">''</span>
<span class="k">IF</span><span class="w"> </span><span class="p">(</span><span class="nv">@IDN</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span>
<span class="w">    </span><span class="k">BEGIN</span>
<span class="w">        </span><span class="k">PRINT</span><span class="w"> </span><span class="s1">'SET IDENTITY_INSERT '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">QUOTENAME</span><span class="p">(</span><span class="k">COALESCE</span><span class="p">(</span><span class="nv">@owner</span><span class="p">,</span><span class="nf">USER_NAME</span><span class="p">()))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'.'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">QUOTENAME</span><span class="p">(</span><span class="nv">@table_name</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' OFF'</span>
<span class="w">        </span><span class="k">PRINT</span><span class="w"> </span><span class="s1">'GO'</span>
<span class="w">    </span><span class="k">END</span>

<span class="k">PRINT</span><span class="w"> </span><span class="s1">'SET NOCOUNT OFF'</span>


<span class="k">SET</span><span class="w"> </span><span class="n">NOCOUNT</span><span class="w"> </span><span class="k">OFF</span>
<span class="k">RETURN</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">--</span><span class="n">Success</span><span class="p">.</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">done</span><span class="err">!</span>
<span class="k">END</span>

<span class="k">GO</span>

<span class="k">PRINT</span><span class="w"> </span><span class="s1">'Created the procedure'</span>
<span class="k">GO</span>


<span class="o">--</span><span class="n">Turn</span><span class="w"> </span><span class="k">system</span><span class="w"> </span><span class="k">object</span><span class="w"> </span><span class="n">marking</span><span class="w"> </span><span class="k">off</span>
<span class="k">EXEC</span><span class="w"> </span><span class="n">master</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="n">sp_MS_upd_sysobj_category</span><span class="w"> </span><span class="mi">2</span>
<span class="k">GO</span>

<span class="k">PRINT</span><span class="w"> </span><span class="s1">'Granting EXECUTE permission on sp_generate_inserts to all users'</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">EXEC</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">sp_generate_inserts</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">public</span>

<span class="k">SET</span><span class="w"> </span><span class="n">NOCOUNT</span><span class="w"> </span><span class="k">OFF</span>
<span class="k">GO</span>

<span class="k">PRINT</span><span class="w"> </span><span class="s1">'Done'</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-append-to-a-file-in-node/" class="u-url">How to append to a file in Node?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-append-to-a-file-in-node/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:16:08+08:00" itemprop="datePublished" title="2023-02-17 16:16">2023-02-17 16:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am trying to <em>append</em> a string to a log file. However writeFile will erase
the content each time before writing the string.</p>
<div class="code"><pre class="code literal-block"><span class="nv">fs</span>.<span class="nv">writeFile</span><span class="ss">(</span><span class="s1">'log.txt'</span>,<span class="w"> </span><span class="s1">'Hello Node'</span>,<span class="w"> </span><span class="nv">function</span><span class="w"> </span><span class="ss">(</span><span class="nv">err</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">err</span><span class="ss">)</span><span class="w"> </span><span class="nv">throw</span><span class="w"> </span><span class="nv">err</span><span class="c1">;</span>
<span class="w">  </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="s1">'It\'</span><span class="nv">s</span><span class="w"> </span><span class="nv">saved</span><span class="o">!</span><span class="err">');</span>
}<span class="ss">)</span><span class="c1">; // =&gt; message.txt erased, contains only 'Hello Node'</span>
</pre></div>

<p>Any idea how to do this the easy way?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>For occasional appends, you can use <code>appendFile</code>, which creates a new file
handle each time it's called:</p>
<p>Asynchronously:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>

<span class="n">fs</span><span class="o">.</span><span class="n">appendFile</span><span class="p">(</span><span class="s1">'message.txt'</span><span class="p">,</span><span class="w"> </span><span class="s1">'data to append'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">err</span><span class="p">;</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'Saved!'</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>

<p>Synchronously:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>

<span class="n">fs</span><span class="o">.</span><span class="n">appendFileSync</span><span class="p">(</span><span class="s1">'message.txt'</span><span class="p">,</span><span class="w"> </span><span class="s1">'data to append'</span><span class="p">);</span>
</pre></div>

<p>But if you append repeatedly to the same file, it's much better to reuse the
file handle.</p>
<p><br></p>
<h3>Suggest</h3>
<p>When you want to write in a log file, i.e. appending data to the end of a
file, <strong>never</strong> use <code>appendFile</code>. <code>appendFile</code> opens a file handle for each
piece of data you add to your file, after a while you get a beautiful <code>EMFILE</code>
error.</p>
<p>I can add that <code>appendFile</code> is not easier to use than a <code>WriteStream</code>.</p>
<p>Example with <code>appendFile</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="nv">new</span><span class="w"> </span><span class="nv">Date</span><span class="ss">()</span>.<span class="nv">toISOString</span><span class="ss">())</span><span class="c1">;</span>
[...<span class="nv">Array</span><span class="ss">(</span><span class="mi">10000</span><span class="ss">)</span>].<span class="nv">forEach</span><span class="ss">(</span><span class="w"> </span><span class="nv">function</span><span class="w"> </span><span class="ss">(</span><span class="nv">item</span>,<span class="nv">index</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">fs</span>.<span class="nv">appendFile</span><span class="ss">(</span><span class="s2">"append.txt"</span>,<span class="w"> </span><span class="nv">index</span><span class="o">+</span><span class="w"> </span><span class="s2">"\n"</span>,<span class="w"> </span><span class="nv">function</span><span class="w"> </span><span class="ss">(</span><span class="nv">err</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">err</span><span class="ss">)</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="nv">err</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}<span class="ss">)</span><span class="c1">;</span>
}<span class="ss">)</span><span class="c1">;</span>
<span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="nv">new</span><span class="w"> </span><span class="nv">Date</span><span class="ss">()</span>.<span class="nv">toISOString</span><span class="ss">())</span><span class="c1">;</span>
</pre></div>

<p>Up to 8000 on my computer, you can append data to the file, then you obtain
this:</p>
<div class="code"><pre class="code literal-block">{ Error: EMFILE: too many open files, open 'C:\mypath\append.txt'
    at Error (native)
  errno: -4066,
  code: 'EMFILE',
  syscall: 'open',
  path: 'C:\\mypath\\append.txt' }
</pre></div>

<p>Moreover, <code>appendFile</code> will write when it is enabled, so your logs will not be
written by timestamp. You can test with example, set 1000 in place of 100000,
order will be random, depends on access to file.</p>
<p>If you want to append to a file, you <strong>must</strong> use a writable stream like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">createWriteStream</span><span class="p">(</span><span class="s2">"append.txt"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">flags</span><span class="p">:</span><span class="s1">'a'</span><span class="p">});</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">()</span><span class="o">.</span><span class="n">toISOString</span><span class="p">());</span>
<span class="p">[</span><span class="o">...</span><span class="n">Array</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
<span class="p">});</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">()</span><span class="o">.</span><span class="n">toISOString</span><span class="p">());</span>
<span class="n">stream</span><span class="o">.</span><span class="n">end</span><span class="p">();</span>
</pre></div>

<p>You end it when you want. You are not even required to use <code>stream.end()</code>,
default option is <code>AutoClose:true</code>, so your file will end when your process
ends and you avoid opening too many files.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-see-docker-image-contents/" class="u-url">How to see docker image contents</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-see-docker-image-contents/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:15:32+08:00" itemprop="datePublished" title="2023-02-17 16:15">2023-02-17 16:15</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I did a docker pull and can list the image that's downloaded. I want to see
the contents of this image. Did a search on the net but no straight answer.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>If the image contains a shell, you can run an interactive shell container
using that image and explore whatever content that image has. If <code>sh</code> is not
available, the busybox <code>ash</code> shell might be.</p>
<p>For instance:</p>
<div class="code"><pre class="code literal-block">docker run -it image_name sh
</pre></div>

<p>Or following for images with an <code>entrypoint</code></p>
<div class="code"><pre class="code literal-block">docker run -it --entrypoint sh image_name
</pre></div>

<p>Or if you want to see how the image was built, meaning the steps in its
<code>Dockerfile</code>, you can:</p>
<div class="code"><pre class="code literal-block">docker image history --no-trunc image_name &gt; image_history
</pre></div>

<p>The steps will be logged into the <code>image_history</code> file.</p>
<p><br></p>
<h3>Suggest</h3>
<p>You should not start a container just to see the image contents. For instance,
you might want to look for malicious content, not run it. Use "create" instead
of "run";</p>
<div class="code"><pre class="code literal-block"><span class="n">docker</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="s2">"tmp_$$"</span><span class="w"> </span><span class="n">image</span><span class="p">:</span><span class="n">tag</span>
<span class="n">docker</span><span class="w"> </span><span class="k">export</span><span class="w"> </span><span class="n">tmp_</span><span class="o">$$</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tar</span><span class="w"> </span><span class="n">t</span>
<span class="n">docker</span><span class="w"> </span><span class="n">rm</span><span class="w"> </span><span class="n">tmp_</span><span class="o">$$</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-800.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-798.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
