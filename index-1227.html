<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1227) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1227.html">
<link rel="prev" href="index-1228.html" type="text/html">
<link rel="next" href="index-1226.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-auto-reload-files-in-node-js/" class="u-url">How to auto-reload files in Node.js?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-auto-reload-files-in-node-js/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:19:29+08:00" itemprop="datePublished" title="2023-02-18 04:19">2023-02-18 04:19</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Any ideas on how I could implement an auto-reload of files in Node.js? I'm
tired of restarting the server every time I change a file. Apparently Node.js'
<code>require()</code> function does not reload files if they already have been required,
so I need to do something like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">sys</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'sys'</span><span class="p">),</span><span class="w"> </span>
<span class="w">    </span><span class="n">http</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">),</span>
<span class="w">    </span><span class="n">posix</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'posix'</span><span class="p">),</span>
<span class="w">    </span><span class="n">json</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'./json'</span><span class="p">);</span>

<span class="k">var</span><span class="w"> </span><span class="n">script_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'/some/path/to/app.js'</span><span class="p">;</span>
<span class="n">this</span><span class="o">.</span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'./app'</span><span class="p">)</span><span class="o">.</span><span class="n">app</span><span class="p">;</span>

<span class="n">process</span><span class="o">.</span><span class="n">watchFile</span><span class="p">(</span><span class="n">script_name</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span><span class="w"> </span><span class="n">prev</span><span class="p">){</span>
<span class="w">    </span><span class="n">posix</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">script_name</span><span class="p">)</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">content</span><span class="p">){</span>
<span class="w">        </span><span class="n">process</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">script_name</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>

<span class="n">http</span><span class="o">.</span><span class="n">createServer</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">app</span><span class="p">)</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="w"> </span><span class="mi">8080</span><span class="w"> </span><span class="p">);</span>
</pre></div>

<p>And in the <em>app.js</em> file I have:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'./file'</span><span class="p">);</span>
<span class="n">this</span><span class="o">.</span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">file</span><span class="o">.</span><span class="n">serveFile</span><span class="p">(</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="s1">'file.js'</span><span class="p">);</span><span class="w">  </span>
<span class="p">}</span>
</pre></div>

<p>But this also isn't working - I get an error in the <code>process.compile()</code>
statement saying that 'require' is not defined. <code>process.compile</code> is evaling
the <em>app.js</em> , but has no clue about the node.js globals.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>A good, up to date alternative to <code>supervisor</code> is <strong><code>nodemon</code></strong> :</p>
<blockquote>
<p>Monitor for any changes in your node.js application and automatically
restart the server - perfect for development</p>
</blockquote>
<p>To use <code>nodemon</code> with version of Node without <code>npx</code> (v8.1 and below, not
advised):</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>npm<span class="w"> </span>install<span class="w"> </span>nodemon<span class="w"> </span>-g
$<span class="w"> </span>nodemon<span class="w"> </span>app.js
</pre></div>

<p>Or to use <code>nodemon</code> with versions of Node with <code>npx</code> bundled in (v8.2+):</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>npm<span class="w"> </span>install<span class="w"> </span>nodemon
$<span class="w"> </span>npx<span class="w"> </span>nodemon<span class="w"> </span>app.js
</pre></div>

<p>Or as devDependency in with an npm script in package.json:</p>
<div class="code"><pre class="code literal-block">"scripts": {
  "start": "nodemon app.js"
},
"devDependencies": {
  "nodemon": "..."
}
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>node-supervisor is awesome</p>
<p>usage to restart on save for old Node versions (not advised):</p>
<div class="code"><pre class="code literal-block">npm install supervisor -g
supervisor app.js
</pre></div>

<p>usage to restart on save for Node versions that come with <code>npx</code>:</p>
<div class="code"><pre class="code literal-block">npm install supervisor
npx supervisor app.js
</pre></div>

<p>or directly call <code>supervisor</code> in an npm script:</p>
<div class="code"><pre class="code literal-block">"scripts": {
  "start": "supervisor app.js"
}
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-private-bytes-virtual-bytes-working-set/" class="u-url">What is private bytes, virtual bytes, working set?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-private-bytes-virtual-bytes-working-set/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:19:06+08:00" itemprop="datePublished" title="2023-02-18 04:19">2023-02-18 04:19</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am trying to use the perfmon windows utility to debug memory leaks in a
process.</p>
<p>This is how perfmon explains the terms:</p>
<p><strong>Working Set</strong> is the current size, in bytes, of the Working Set of this
process. The Working Set is the set of memory pages touched recently by the
threads in the process. If free memory in the computer is above a threshold,
pages are left in the Working Set of a process even if they are not in use.
When free memory falls below a threshold, pages are trimmed from Working Sets.
If they are needed they will then be soft-faulted back into the Working Set
before leaving main memory.</p>
<p><strong>Virtual Bytes</strong> is the current size, in bytes, of the virtual address space
the process is using. Use of virtual address space does not necessarily imply
corresponding use of either disk or main memory pages. Virtual space is
finite, and the process can limit its ability to load libraries.</p>
<p><strong>Private Bytes</strong> is the current size, in bytes, of memory that this process
has allocated that cannot be shared with other processes.</p>
<p>These are the questions I have:</p>
<p><em>Is it the Private Bytes which I should measure to be sure if the process is
having any leaks as it does not involve any shared libraries and any leaks, if
happening, will come from the process itself?</em></p>
<p><em>What is the total memory consumed by the process? Is it the Virtual Bytes or
is it the sum of Virtual Bytes and Working Set?</em></p>
<p><em>Is there any relation between Private Bytes, Working Set and Virtual Bytes?</em></p>
<p><em>Are there any other tools that give a better idea of the memory usage?</em></p>
<p><br><br></p>
<h2>Answer</h2>
<p>The short answer to this question is that <strong>none of these values are a
reliable indicator of how much memory an executable is actually using, and
none of them are really appropriate for debugging a memory leak.</strong></p>
<p><strong>Private Bytes</strong> refer to the amount of memory that the process executable
has <em>asked for</em> - not necessarily the amount it is <em>actually using</em>. They are
"private" because they (usually) exclude memory-mapped files (i.e. shared
DLLs). But - here's the catch - they don't necessarily exclude memory
<em>allocated by those files</em>. There is no way to tell whether a change in
private bytes was due to the executable itself, or due to a linked library.
Private bytes are also <strong>not</strong> exclusively physical memory; they can be paged
to disk or in the standby page list (i.e. no longer in use, but not paged yet
either).</p>
<p><strong>Working Set</strong> refers to the total <strong>physical</strong> memory (RAM) used by the
process. However, unlike private bytes, this also includes memory-mapped files
and various other resources, so it's an even less accurate measurement than
the private bytes. This is the same value that gets reported in Task Manager's
"Mem Usage" and has been the source of endless amounts of confusion in recent
years. Memory in the Working Set is "physical" in the sense that it can be
addressed without a page fault; however, the standby page list is <em>also</em> still
physically in memory but not reported in the Working Set, and this is why you
might see the "Mem Usage" suddenly drop when you minimize an application.</p>
<p><strong>Virtual Bytes</strong> are the total <strong>virtual address space</strong> occupied by the
entire process. This is like the working set, in the sense that it includes
memory-mapped files (shared DLLs), but it also includes data in the standby
list and data that has already been paged out and is sitting in a pagefile on
disk somewhere. The total virtual bytes used by every process on a system
under heavy load will add up to significantly more memory than the machine
actually has.</p>
<p>So the relationships are:</p>
<ul>
<li>Private Bytes are what your app has actually allocated, but include pagefile usage;</li>
<li>Working Set is the non-paged Private Bytes plus memory-mapped files;</li>
<li>Virtual Bytes are the Working Set plus paged Private Bytes and standby list.</li>
</ul>
<p>There's another problem here; just as shared libraries can allocate memory
inside your application module, leading to potential false positives reported
in your app's Private Bytes, <em>your</em> application may also end up allocating
memory inside the <em>shared</em> modules, leading to false <em>negatives</em>. That means
it's actually possible for your application to have a memory leak that never
manifests itself in the Private Bytes at all. Unlikely, but possible.</p>
<p>Private Bytes are a reasonable <strong>approximation</strong> of the amount of memory your
executable is using and can be used to help <em>narrow down</em> a list of potential
candidates for a memory leak; if you see the number growing and growing
constantly and endlessly, you would want to check that process for a leak.
This cannot, however, <em>prove</em> that there is or is not a leak.</p>
<p>One of the most effective tools for detecting/correcting memory leaks in
Windows is actually Visual Studio (link goes to page on using VS for memory
leaks, not the product page). Rational Purify is another possibility.
Microsoft also has a more general best practices document on this subject.
There are more tools listed in this previous question.</p>
<p>I hope this clears a few things up! Tracking down memory leaks is one of the
most difficult things to do in debugging. Good luck.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The definition of the perfmon counters has been broken since the beginning and
for some reason appears to be too hard to correct.</p>
<p>A good overview of Windows memory management is available in the video "
<em>Mysteries of Memory Management Revealed</em> " on MSDN: It covers more topics
than needed to track memory leaks (eg working set management) but gives enough
detail in the relevant topics.</p>
<hr>
<p>To give you a hint of the problem with the perfmon counter descriptions, here
is the inside story about private bytes from " <em>Private Bytes Performance
Counter -- Beware!</em> " on MSDN:</p>
<blockquote>
<p>Q: When is a Private Byte not a Private Byte?</p>
<p>A: When it isn't resident.</p>
<p>The Private Bytes counter reports the commit charge of the process. That is
to say, the amount of space that has been allocated in the swap file to hold
the contents of the private memory in the event that it is swapped out.
Note: I'm avoiding the word "reserved" because of possible confusion with
virtual memory in the reserved state which is not committed.</p>
</blockquote>
<hr>
<p>From " <em>Performance Planning</em> " on MSDN:</p>
<blockquote>
<p>3.3 Private Bytes</p>
<p>3.3.1 Description</p>
<p>Private memory, is defined as memory allocated for a process which cannot be
shared by other processes. This memory is more expensive than shared memory
when multiple such processes execute on a machine. Private memory in
(traditional) unmanaged dlls usually constitutes of C++ statics and is of
the order of 5% of the total working set of the dll.</p>
</blockquote>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/force-add-despite-the-gitignore-file/" class="u-url">Force add despite the .gitignore file</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/force-add-despite-the-gitignore-file/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:18:45+08:00" itemprop="datePublished" title="2023-02-18 04:18">2023-02-18 04:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Is there a way to force <code>git</code> to add a file despite the <code>.gitignore</code> file?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>See <code>man git-add</code>:</p>
<div class="code"><pre class="code literal-block">   -f, --force
       Allow adding otherwise ignored files.
</pre></div>

<p>So run this</p>
<div class="code"><pre class="code literal-block">git add --force my/ignore/file.foo
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Despite Daniel Böhmer's working solution, Ohad Schneider offered a better
solution in a comment:</p>
<p>If the file is usually ignored, and you force adding it - it can be
accidentally ignored again in the future (like when the file is deleted, then
a commit is made and the file is re-created.</p>
<p>You should just un-ignore it in the .gitignore file like this: Unignore
subdirectories of ignored directories in Git</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1228.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1226.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
