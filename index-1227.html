<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1227) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1227.html">
<link rel="prev" href="index-1228.html" type="text/html">
<link rel="next" href="index-1226.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-private-bytes-virtual-bytes-working-set/" class="u-url">What is private bytes, virtual bytes, working set?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-private-bytes-virtual-bytes-working-set/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:19:06+08:00" itemprop="datePublished" title="2023-02-18 04:19">2023-02-18 04:19</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am trying to use the perfmon windows utility to debug memory leaks in a
process.</p>
<p>This is how perfmon explains the terms:</p>
<p><strong>Working Set</strong> is the current size, in bytes, of the Working Set of this
process. The Working Set is the set of memory pages touched recently by the
threads in the process. If free memory in the computer is above a threshold,
pages are left in the Working Set of a process even if they are not in use.
When free memory falls below a threshold, pages are trimmed from Working Sets.
If they are needed they will then be soft-faulted back into the Working Set
before leaving main memory.</p>
<p><strong>Virtual Bytes</strong> is the current size, in bytes, of the virtual address space
the process is using. Use of virtual address space does not necessarily imply
corresponding use of either disk or main memory pages. Virtual space is
finite, and the process can limit its ability to load libraries.</p>
<p><strong>Private Bytes</strong> is the current size, in bytes, of memory that this process
has allocated that cannot be shared with other processes.</p>
<p>These are the questions I have:</p>
<p><em>Is it the Private Bytes which I should measure to be sure if the process is
having any leaks as it does not involve any shared libraries and any leaks, if
happening, will come from the process itself?</em></p>
<p><em>What is the total memory consumed by the process? Is it the Virtual Bytes or
is it the sum of Virtual Bytes and Working Set?</em></p>
<p><em>Is there any relation between Private Bytes, Working Set and Virtual Bytes?</em></p>
<p><em>Are there any other tools that give a better idea of the memory usage?</em></p>
<p><br><br></p>
<h2>Answer</h2>
<p>The short answer to this question is that <strong>none of these values are a
reliable indicator of how much memory an executable is actually using, and
none of them are really appropriate for debugging a memory leak.</strong></p>
<p><strong>Private Bytes</strong> refer to the amount of memory that the process executable
has <em>asked for</em> - not necessarily the amount it is <em>actually using</em>. They are
"private" because they (usually) exclude memory-mapped files (i.e. shared
DLLs). But - here's the catch - they don't necessarily exclude memory
<em>allocated by those files</em>. There is no way to tell whether a change in
private bytes was due to the executable itself, or due to a linked library.
Private bytes are also <strong>not</strong> exclusively physical memory; they can be paged
to disk or in the standby page list (i.e. no longer in use, but not paged yet
either).</p>
<p><strong>Working Set</strong> refers to the total <strong>physical</strong> memory (RAM) used by the
process. However, unlike private bytes, this also includes memory-mapped files
and various other resources, so it's an even less accurate measurement than
the private bytes. This is the same value that gets reported in Task Manager's
"Mem Usage" and has been the source of endless amounts of confusion in recent
years. Memory in the Working Set is "physical" in the sense that it can be
addressed without a page fault; however, the standby page list is <em>also</em> still
physically in memory but not reported in the Working Set, and this is why you
might see the "Mem Usage" suddenly drop when you minimize an application.</p>
<p><strong>Virtual Bytes</strong> are the total <strong>virtual address space</strong> occupied by the
entire process. This is like the working set, in the sense that it includes
memory-mapped files (shared DLLs), but it also includes data in the standby
list and data that has already been paged out and is sitting in a pagefile on
disk somewhere. The total virtual bytes used by every process on a system
under heavy load will add up to significantly more memory than the machine
actually has.</p>
<p>So the relationships are:</p>
<ul>
<li>Private Bytes are what your app has actually allocated, but include pagefile usage;</li>
<li>Working Set is the non-paged Private Bytes plus memory-mapped files;</li>
<li>Virtual Bytes are the Working Set plus paged Private Bytes and standby list.</li>
</ul>
<p>There's another problem here; just as shared libraries can allocate memory
inside your application module, leading to potential false positives reported
in your app's Private Bytes, <em>your</em> application may also end up allocating
memory inside the <em>shared</em> modules, leading to false <em>negatives</em>. That means
it's actually possible for your application to have a memory leak that never
manifests itself in the Private Bytes at all. Unlikely, but possible.</p>
<p>Private Bytes are a reasonable <strong>approximation</strong> of the amount of memory your
executable is using and can be used to help <em>narrow down</em> a list of potential
candidates for a memory leak; if you see the number growing and growing
constantly and endlessly, you would want to check that process for a leak.
This cannot, however, <em>prove</em> that there is or is not a leak.</p>
<p>One of the most effective tools for detecting/correcting memory leaks in
Windows is actually Visual Studio (link goes to page on using VS for memory
leaks, not the product page). Rational Purify is another possibility.
Microsoft also has a more general best practices document on this subject.
There are more tools listed in this previous question.</p>
<p>I hope this clears a few things up! Tracking down memory leaks is one of the
most difficult things to do in debugging. Good luck.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The definition of the perfmon counters has been broken since the beginning and
for some reason appears to be too hard to correct.</p>
<p>A good overview of Windows memory management is available in the video "
<em>Mysteries of Memory Management Revealed</em> " on MSDN: It covers more topics
than needed to track memory leaks (eg working set management) but gives enough
detail in the relevant topics.</p>
<hr>
<p>To give you a hint of the problem with the perfmon counter descriptions, here
is the inside story about private bytes from " <em>Private Bytes Performance
Counter -- Beware!</em> " on MSDN:</p>
<blockquote>
<p>Q: When is a Private Byte not a Private Byte?</p>
<p>A: When it isn't resident.</p>
<p>The Private Bytes counter reports the commit charge of the process. That is
to say, the amount of space that has been allocated in the swap file to hold
the contents of the private memory in the event that it is swapped out.
Note: I'm avoiding the word "reserved" because of possible confusion with
virtual memory in the reserved state which is not committed.</p>
</blockquote>
<hr>
<p>From " <em>Performance Planning</em> " on MSDN:</p>
<blockquote>
<p>3.3 Private Bytes</p>
<p>3.3.1 Description</p>
<p>Private memory, is defined as memory allocated for a process which cannot be
shared by other processes. This memory is more expensive than shared memory
when multiple such processes execute on a machine. Private memory in
(traditional) unmanaged dlls usually constitutes of C++ statics and is of
the order of 5% of the total working set of the dll.</p>
</blockquote>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/force-add-despite-the-gitignore-file/" class="u-url">Force add despite the .gitignore file</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/force-add-despite-the-gitignore-file/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:18:45+08:00" itemprop="datePublished" title="2023-02-18 04:18">2023-02-18 04:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Is there a way to force <code>git</code> to add a file despite the <code>.gitignore</code> file?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>See <code>man git-add</code>:</p>
<div class="code"><pre class="code literal-block">   -f, --force
       Allow adding otherwise ignored files.
</pre></div>

<p>So run this</p>
<div class="code"><pre class="code literal-block">git add --force my/ignore/file.foo
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Despite Daniel Böhmer's working solution, Ohad Schneider offered a better
solution in a comment:</p>
<p>If the file is usually ignored, and you force adding it - it can be
accidentally ignored again in the future (like when the file is deleted, then
a commit is made and the file is re-created.</p>
<p>You should just un-ignore it in the .gitignore file like this: Unignore
subdirectories of ignored directories in Git</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/quickly-reading-very-large-tables-as-dataframes/" class="u-url">Quickly reading very large tables as dataframes</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/quickly-reading-very-large-tables-as-dataframes/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:18:16+08:00" itemprop="datePublished" title="2023-02-18 04:18">2023-02-18 04:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have very large tables (30 million rows) that I would like to load as a
dataframes in R. <code>read.table()</code> has a lot of convenient features, but it seems
like there is a lot of logic in the implementation that would slow things
down. In my case, I am assuming I know the types of the columns ahead of time,
the table does not contain any column headers or row names, and does not have
any pathological characters that I have to worry about.</p>
<p>I know that reading in a table as a list using <code>scan()</code> can be quite fast,
e.g.:</p>
<div class="code"><pre class="code literal-block"><span class="n">datalist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">scan</span><span class="p">(</span><span class="s">'myfile'</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">'\t'</span><span class="p">,</span><span class="nf">list</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">''</span><span class="p">,</span><span class="n">popularity</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">mintime</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">maxtime</span><span class="o">=</span><span class="m">0</span><span class="p">)))</span>
</pre></div>

<p>But some of my attempts to convert this to a dataframe appear to decrease the
performance of the above by a factor of 6:</p>
<div class="code"><pre class="code literal-block"><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.data.frame</span><span class="p">(</span><span class="nf">scan</span><span class="p">(</span><span class="s">'myfile'</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">'\t'</span><span class="p">,</span><span class="nf">list</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s">''</span><span class="p">,</span><span class="n">popularity</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">mintime</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">maxtime</span><span class="o">=</span><span class="m">0</span><span class="p">))))</span>
</pre></div>

<p>Is there a better way of doing this? Or quite possibly completely different
approach to the problem?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>An update, several years later</strong></p>
<p>This answer is old, and R has moved on. Tweaking <code>read.table</code> to run a bit
faster has precious little benefit. Your options are:</p>
<ol>
<li>
<p>Using <code>vroom</code> from the tidyverse package <code>vroom</code> for importing data from csv/tab-delimited files directly into an R tibble. See Hector's answer.</p>
</li>
<li>
<p>Using <code>fread</code> in <code>data.table</code> for importing data from csv/tab-delimited files directly into R. See mnel's answer.</p>
</li>
<li>
<p>Using <code>read_table</code> in <code>readr</code> (on CRAN from April 2015). This works much like <code>fread</code> above. The <em>readme</em> in the link explains the difference between the two functions (<code>readr</code> currently claims to be "1.5-2x slower" than <code>data.table::fread</code>).</p>
</li>
<li>
<p><code>read.csv.raw</code> from <code>iotools</code> provides a third option for quickly reading CSV files.</p>
</li>
<li>
<p>Trying to store as much data as you can in databases rather than flat files. (As well as being a better permanent storage medium, data is passed to and from R in a binary format, which is faster.) <code>read.csv.sql</code> in the <code>sqldf</code> package, as described in JD Long's answer, imports data into a temporary SQLite database and then reads it into R. See also: the <code>RODBC</code> package, and the reverse depends section of the <code>DBI</code> package page. <code>MonetDB.R</code> gives you a data type that pretends to be a data frame but is really a MonetDB underneath, increasing performance. Import data with its <code>monetdb.read.csv</code> function. <code>dplyr</code> allows you to work directly with data stored in several types of database.</p>
</li>
<li>
<p>Storing data in binary formats can also be useful for improving performance. Use <code>saveRDS</code>/<code>readRDS</code> (see below), the <code>h5</code> or <code>rhdf5</code> packages for HDF5 format, or <code>write_fst</code>/<code>read_fst</code> from the <code>fst</code> package.</p>
</li>
</ol>
<hr>
<p><strong>The original answer</strong></p>
<p>There are a couple of simple things to try, whether you use read.table or
scan.</p>
<ol>
<li>
<p>Set <code>nrows</code>= <em>the number of records in your data</em> (<code>nmax</code> in <code>scan</code>).</p>
</li>
<li>
<p>Make sure that <code>comment.char=""</code> to turn off interpretation of comments.</p>
</li>
<li>
<p>Explicitly define the classes of each column using <code>colClasses</code> in <code>read.table</code>.</p>
</li>
<li>
<p>Setting <code>multi.line=FALSE</code> may also improve performance in scan.</p>
</li>
</ol>
<p>If none of these thing work, then use one of the profiling packages to
determine which lines are slowing things down. Perhaps you can write a cut
down version of <code>read.table</code> based on the results.</p>
<p>The other alternative is filtering your data before you read it into R.</p>
<p>Or, if the problem is that you have to read it in regularly, then use these
methods to read the data in once, then save the data frame as a binary blob
with <del><code>save</code></del> <code>saveRDS</code>, then next time you can retrieve it faster with
<del><code>load</code></del> <code>readRDS</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Here is an example that utilizes <code>fread</code> from <code>data.table</code> 1.8.7</p>
<p>The examples come from the help page to <code>fread</code>, with the timings on my
windows XP Core 2 duo E8400.</p>
<div class="code"><pre class="code literal-block"><span class="nf">library</span><span class="p">(</span><span class="nv">data</span><span class="o">.</span><span class="nv">table</span><span class="p">)</span>
<span class="o">#</span><span class="w"> </span><span class="nv">Demo</span><span class="w"> </span><span class="nv">speedup</span>
<span class="nv">n</span><span class="o">=</span><span class="mf">1e6</span>
<span class="nv">DT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">data</span><span class="o">.</span><span class="nf">table</span><span class="p">(</span><span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">1000</span><span class="p">,</span><span class="nv">n</span><span class="p">,</span><span class="nv">replace</span><span class="o">=</span><span class="nv">TRUE</span><span class="p">),</span>
<span class="w">                 </span><span class="nv">b</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">1000</span><span class="p">,</span><span class="nv">n</span><span class="p">,</span><span class="nv">replace</span><span class="o">=</span><span class="nv">TRUE</span><span class="p">),</span>
<span class="w">                 </span><span class="nv">c</span><span class="o">=</span><span class="nf">rnorm</span><span class="p">(</span><span class="nv">n</span><span class="p">),</span>
<span class="w">                 </span><span class="nv">d</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">"foo"</span><span class="p">,</span><span class="s">"bar"</span><span class="p">,</span><span class="s">"baz"</span><span class="p">,</span><span class="s">"qux"</span><span class="p">,</span><span class="s">"quux"</span><span class="p">),</span><span class="nv">n</span><span class="p">,</span><span class="nv">replace</span><span class="o">=</span><span class="nv">TRUE</span><span class="p">),</span>
<span class="w">                 </span><span class="nv">e</span><span class="o">=</span><span class="nf">rnorm</span><span class="p">(</span><span class="nv">n</span><span class="p">),</span>
<span class="w">                 </span><span class="nv">f</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">1000</span><span class="p">,</span><span class="nv">n</span><span class="p">,</span><span class="nv">replace</span><span class="o">=</span><span class="nv">TRUE</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="nv">DT</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="nv">b</span><span class="o">:=</span><span class="nv">NA_integer_</span><span class="p">]</span>
<span class="nv">DT</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="nv">c</span><span class="o">:=</span><span class="nv">NA_real_</span><span class="p">]</span>
<span class="nv">DT</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="nv">d</span><span class="o">:=</span><span class="nv">NA_character_</span><span class="p">]</span>
<span class="nv">DT</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="nv">d</span><span class="o">:=</span><span class="s">""</span><span class="p">]</span>
<span class="nv">DT</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="nv">e</span><span class="o">:=+</span><span class="nv">Inf</span><span class="p">]</span>
<span class="nv">DT</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="nv">e</span><span class="o">:=-</span><span class="nv">Inf</span><span class="p">]</span>
</pre></div>

<h2>standard read.table</h2>
<div class="code"><pre class="code literal-block"><span class="nf">write.table</span><span class="p">(</span><span class="n">DT</span><span class="p">,</span><span class="s">"test.csv"</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">","</span><span class="p">,</span><span class="n">row.names</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="nf">cat</span><span class="p">(</span><span class="s">"File size (MB):"</span><span class="p">,</span><span class="nf">round</span><span class="p">(</span><span class="nf">file.info</span><span class="p">(</span><span class="s">"test.csv"</span><span class="p">)</span><span class="o">$</span><span class="n">size</span><span class="o">/</span><span class="m">1024</span><span class="o">^</span><span class="m">2</span><span class="p">),</span><span class="s">"\n"</span><span class="p">)</span><span class="w">    </span>
<span class="c1">## File size (MB): 51</span>

<span class="nf">system.time</span><span class="p">(</span><span class="n">DF1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">"test.csv"</span><span class="p">,</span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">))</span><span class="w">        </span>
<span class="c1">##    user  system elapsed </span>
<span class="c1">##   24.71    0.15   25.42</span>
<span class="c1"># second run will be faster</span>
<span class="nf">system.time</span><span class="p">(</span><span class="n">DF1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.csv</span><span class="p">(</span><span class="s">"test.csv"</span><span class="p">,</span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">))</span><span class="w">        </span>
<span class="c1">##    user  system elapsed </span>
<span class="c1">##   17.85    0.07   17.98</span>
</pre></div>

<h2>optimized read.table</h2>
<div class="code"><pre class="code literal-block"><span class="nf">system.time</span><span class="p">(</span><span class="n">DF2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.table</span><span class="p">(</span><span class="s">"test.csv"</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s">","</span><span class="p">,</span><span class="n">quote</span><span class="o">=</span><span class="s">""</span><span class="p">,</span><span class="w">  </span>
<span class="w">                          </span><span class="n">stringsAsFactors</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">comment.char</span><span class="o">=</span><span class="s">""</span><span class="p">,</span><span class="n">nrows</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="w">                   </span>
<span class="w">                          </span><span class="n">colClasses</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">"integer"</span><span class="p">,</span><span class="s">"integer"</span><span class="p">,</span><span class="s">"numeric"</span><span class="p">,</span><span class="w">                        </span>
<span class="w">                                       </span><span class="s">"character"</span><span class="p">,</span><span class="s">"numeric"</span><span class="p">,</span><span class="s">"integer"</span><span class="p">)))</span>


<span class="c1">##    user  system elapsed </span>
<span class="c1">##   10.20    0.03   10.32</span>
</pre></div>

<h2>fread</h2>
<div class="code"><pre class="code literal-block"><span class="nf">require</span><span class="p">(</span><span class="n">data.table</span><span class="p">)</span>
<span class="nf">system.time</span><span class="p">(</span><span class="n">DT</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">fread</span><span class="p">(</span><span class="s">"test.csv"</span><span class="p">))</span><span class="w">                                  </span>
<span class="w"> </span><span class="c1">##    user  system elapsed </span>
<span class="c1">##    3.12    0.01    3.22</span>
</pre></div>

<h2>sqldf</h2>
<div class="code"><pre class="code literal-block"><span class="nf">require</span><span class="p">(</span><span class="n">sqldf</span><span class="p">)</span>

<span class="nf">system.time</span><span class="p">(</span><span class="n">SQLDF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.csv.sql</span><span class="p">(</span><span class="s">"test.csv"</span><span class="p">,</span><span class="n">dbname</span><span class="o">=</span><span class="kc">NULL</span><span class="p">))</span>

<span class="c1">##    user  system elapsed </span>
<span class="c1">##   12.49    0.09   12.69</span>

<span class="c1"># sqldf as on SO</span>

<span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">file</span><span class="p">(</span><span class="s">"test.csv"</span><span class="p">)</span>
<span class="nf">system.time</span><span class="p">(</span><span class="n">SQLf</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sqldf</span><span class="p">(</span><span class="s">"select * from f"</span><span class="p">,</span><span class="w"> </span><span class="n">dbname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">tempfile</span><span class="p">(),</span><span class="w"> </span><span class="n">file.format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">T</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">F</span><span class="p">)))</span>

<span class="c1">##    user  system elapsed </span>
<span class="c1">##   10.21    0.47   10.73</span>
</pre></div>

<h2>ff / ffdf</h2>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="nf">require</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>

<span class="w"> </span><span class="nf">system.time</span><span class="p">(</span><span class="n">FFDF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.csv.ffdf</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s">"test.csv"</span><span class="p">,</span><span class="n">nrows</span><span class="o">=</span><span class="n">n</span><span class="p">))</span><span class="w">   </span>
<span class="w"> </span><span class="c1">##    user  system elapsed </span>
<span class="w"> </span><span class="c1">##   10.85    0.10   10.99</span>
</pre></div>

<h2>In summary:</h2>
<div class="code"><pre class="code literal-block">##    user  system elapsed  Method
##   24.71    0.15   25.42  read.csv (first time)
##   17.85    0.07   17.98  read.csv (second time)
##   10.20    0.03   10.32  Optimized read.table
##    3.12    0.01    3.22  fread
##   12.49    0.09   12.69  sqldf
##   10.21    0.47   10.73  sqldf on SO
##   10.85    0.10   10.99  ffdf
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1228.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1226.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
