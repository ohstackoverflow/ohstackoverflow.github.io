<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1219) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1219.html">
<link rel="prev" href="index-1220.html" type="text/html">
<link rel="next" href="index-1218.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/wait-until-all-promises-complete-even-if-some-rejected/" class="u-url">Wait until all promises complete even if some rejected</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/wait-until-all-promises-complete-even-if-some-rejected/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:07:01+08:00" itemprop="datePublished" title="2023-02-18 04:07">2023-02-18 04:07</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Let's say I have a set of <code>Promise</code>s that are making network requests, of
which one will fail:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">does</span><span class="o">-</span><span class="ow">not</span><span class="o">-</span><span class="n">exist</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">TypeError</span>
<span class="k">var</span><span class="w"> </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">fetch</span><span class="p">(</span><span class="s1">'index.html'</span><span class="p">),</span><span class="w"> </span><span class="n">fetch</span><span class="p">(</span><span class="s1">'http://does-not-exist'</span><span class="p">)</span><span class="w"> </span><span class="p">]</span>

<span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
<span class="w">  </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'success'</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">))</span>
<span class="w">  </span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">))</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">executed</span>
</pre></div>

<p>Let's say I want to wait until all of these have finished, regardless of if
one has failed. There might be a network error for a resource that I can live
without, but which if I can get, I want before I proceed. I want to handle
network failures gracefully.</p>
<p>Since <code>Promise.all</code> doesn't leave any room for this, what is the recommended
pattern for handling this, without using a promises library?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Benjamin's answer offers a great abstraction for solving this issue, but I was
hoping for a less abstracted solution. The explicit way to to resolve this
issue is to simply call <code>.catch</code> on the internal promises, and return the
error from their callback.</p>
<div class="code"><pre class="code literal-block"><span class="nv">let</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Promise</span><span class="ss">((</span><span class="nv">res</span>,<span class="w"> </span><span class="nv">rej</span><span class="ss">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">res</span><span class="ss">(</span><span class="s1">'Resolved!'</span><span class="ss">))</span>,
<span class="w">    </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Promise</span><span class="ss">((</span><span class="nv">res</span>,<span class="w"> </span><span class="nv">rej</span><span class="ss">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">rej</span><span class="ss">(</span><span class="s1">'Rejected!'</span><span class="ss">))</span>,
<span class="w">    </span><span class="nv">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">a</span>.<span class="nv">catch</span><span class="ss">(</span><span class="nv">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>{<span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="s1">'"a" failed.'</span><span class="ss">)</span><span class="c1">; return e; }),</span>
<span class="w">    </span><span class="nv">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">b</span>.<span class="nv">catch</span><span class="ss">(</span><span class="nv">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>{<span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="s1">'"b" failed.'</span><span class="ss">)</span><span class="c1">; return e; });</span>

<span class="nv">Promise</span>.<span class="nv">all</span><span class="ss">(</span>[<span class="nv">c</span>,<span class="w"> </span><span class="nv">d</span>]<span class="ss">)</span>
<span class="w">  </span>.<span class="k">then</span><span class="ss">(</span><span class="nb">result</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="s1">'Then'</span>,<span class="w"> </span><span class="nb">result</span><span class="ss">))</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Then</span><span class="w"> </span>[<span class="s2">"Resolved!"</span>,<span class="w"> </span><span class="s2">"Rejected!"</span>]
<span class="w">  </span>.<span class="nv">catch</span><span class="ss">(</span><span class="nv">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="s1">'Catch'</span>,<span class="w"> </span><span class="nv">err</span><span class="ss">))</span><span class="c1">;</span>

<span class="nv">Promise</span>.<span class="nv">all</span><span class="ss">(</span>[<span class="nv">a</span>.<span class="nv">catch</span><span class="ss">(</span><span class="nv">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">e</span><span class="ss">)</span>,<span class="w"> </span><span class="nv">b</span>.<span class="nv">catch</span><span class="ss">(</span><span class="nv">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">e</span><span class="ss">)</span>]<span class="ss">)</span>
<span class="w">  </span>.<span class="k">then</span><span class="ss">(</span><span class="nb">result</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="s1">'Then'</span>,<span class="w"> </span><span class="nb">result</span><span class="ss">))</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Then</span><span class="w"> </span>[<span class="s2">"Resolved!"</span>,<span class="w"> </span><span class="s2">"Rejected!"</span>]
<span class="w">  </span>.<span class="nv">catch</span><span class="ss">(</span><span class="nv">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="s1">'Catch'</span>,<span class="w"> </span><span class="nv">err</span><span class="ss">))</span><span class="c1">;</span>
</pre></div>

<hr>
<p>Taking this one step further, you could write a generic catch handler that
looks like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">catchHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="n">payload</span><span class="p">:</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">resolved</span><span class="p">:</span><span class="w"> </span><span class="bp">false</span><span class="w"> </span><span class="p">});</span>
</pre></div>

<p>then you can do</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">promise</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">promise</span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">catchHandler</span><span class="p">))</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">results</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
<span class="w">    </span><span class="o">.</span><span class="n">catch</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'Promise.all failed'</span><span class="p">))</span>
<span class="o">&lt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">'Resolved!'</span><span class="p">,</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="n">payload</span><span class="p">:</span><span class="w"> </span><span class="n">Promise</span><span class="p">,</span><span class="w"> </span><span class="n">resolved</span><span class="p">:</span><span class="w"> </span><span class="bp">false</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span>
</pre></div>

<p>The problem with this is that the caught values will have a different
interface than the non-caught values, so to clean this up you might do
something like:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">successHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">({</span><span class="w"> </span><span class="n">payload</span><span class="p">:</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">resolved</span><span class="p">:</span><span class="w"> </span><span class="bp">true</span><span class="w"> </span><span class="p">});</span>
</pre></div>

<p>So now you can do this:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;</span><span class="w"> </span><span class="nv">Promise</span>.<span class="nv">all</span><span class="ss">(</span>[<span class="nv">a</span>,<span class="w"> </span><span class="nv">b</span>].<span class="nv">map</span><span class="ss">(</span><span class="nb">result</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">result</span>.<span class="k">then</span><span class="ss">(</span><span class="nv">successHandler</span><span class="ss">)</span>.<span class="nv">catch</span><span class="ss">(</span><span class="nv">catchHandler</span><span class="ss">))</span>
<span class="w">    </span>.<span class="k">then</span><span class="ss">(</span><span class="nv">results</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="nv">results</span>.<span class="nv">filter</span><span class="ss">(</span><span class="nb">result</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">result</span>.<span class="nv">resolved</span><span class="ss">))</span>
<span class="w">    </span>.<span class="nv">catch</span><span class="ss">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="s1">'Promise.all failed'</span><span class="ss">))</span>
<span class="o">&lt;</span><span class="w"> </span>[<span class="w"> </span><span class="s1">'Resolved!'</span><span class="w"> </span>]
</pre></div>

<p>Then to keep it DRY, you get to Benjamin's answer:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">reflect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">promise</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">promise</span>
<span class="w">  </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">successHandler</span><span class="p">)</span>
<span class="w">  </span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">catchHander</span><span class="p">)</span>
</pre></div>

<p>where it now looks like</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;</span><span class="w"> </span><span class="nv">Promise</span>.<span class="nv">all</span><span class="ss">(</span>[<span class="nv">a</span>,<span class="w"> </span><span class="nv">b</span>].<span class="nv">map</span><span class="ss">(</span><span class="nb">result</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">result</span>.<span class="k">then</span><span class="ss">(</span><span class="nv">successHandler</span><span class="ss">)</span>.<span class="nv">catch</span><span class="ss">(</span><span class="nv">catchHandler</span><span class="ss">))</span>
<span class="w">    </span>.<span class="k">then</span><span class="ss">(</span><span class="nv">results</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="nv">results</span>.<span class="nv">filter</span><span class="ss">(</span><span class="nb">result</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">result</span>.<span class="nv">resolved</span><span class="ss">))</span>
<span class="w">    </span>.<span class="nv">catch</span><span class="ss">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="s1">'Promise.all failed'</span><span class="ss">))</span>
<span class="o">&lt;</span><span class="w"> </span>[<span class="w"> </span><span class="s1">'Resolved!'</span><span class="w"> </span>]
</pre></div>

<hr>
<p>The benefits of the second solution are that its abstracted and DRY. The
downside is you have more code, and you have to remember to reflect all your
promises to make things consistent.</p>
<p>I would characterize my solution as explicit and KISS, but indeed less robust.
The interface doesn't guarantee that you know exactly whether the promise
succeeded or failed.</p>
<p>For example you might have this:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="s1">'Not beaking, just bad'</span><span class="p">));</span>
<span class="k">const</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">reject</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="s1">'This actually didnt work'</span><span class="p">));</span>
</pre></div>

<p>This won't get caught by <code>a.catch</code>, so</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;</span><span class="w"> </span><span class="nv">Promise</span>.<span class="nv">all</span><span class="ss">(</span>[<span class="nv">a</span>,<span class="w"> </span><span class="nv">b</span>].<span class="nv">map</span><span class="ss">(</span><span class="nv">promise</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">promise</span>.<span class="nv">catch</span><span class="ss">(</span><span class="nv">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">e</span><span class="ss">))</span>
<span class="w">    </span>.<span class="k">then</span><span class="ss">(</span><span class="nv">results</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="nv">results</span><span class="ss">))</span>
<span class="o">&lt;</span><span class="w"> </span>[<span class="w"> </span><span class="nv">Error</span>,<span class="w"> </span><span class="nv">Error</span><span class="w"> </span>]
</pre></div>

<p>There's no way to tell which one was fatal and which was wasn't. If that's
important then you're going to want to enforce and interface that tracks
whether it was successful or not (which <code>reflect</code> does).</p>
<p>If you just want to handle errors gracefully, then you can just treat errors
as undefined values:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;</span><span class="w"> </span><span class="nv">Promise</span>.<span class="nv">all</span><span class="ss">(</span>[<span class="nv">a</span>.<span class="nv">catch</span><span class="ss">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">undefined</span><span class="ss">)</span>,<span class="w"> </span><span class="nv">b</span>.<span class="nv">catch</span><span class="ss">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">undefined</span><span class="ss">)</span>]<span class="ss">)</span>
<span class="w">    </span>.<span class="k">then</span><span class="ss">((</span><span class="nv">results</span><span class="ss">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">console</span>.<span class="nv">log</span><span class="ss">(</span><span class="s1">'Known values: '</span>,<span class="w"> </span><span class="nv">results</span>.<span class="nv">filter</span><span class="ss">(</span><span class="nv">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">typeof</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">'undefined'</span><span class="ss">)))</span>
<span class="o">&lt;</span><span class="w"> </span>[<span class="w"> </span><span class="s1">'Resolved!'</span><span class="w"> </span>]
</pre></div>

<p>In my case, I don't need to know the error or how it failed--I just care
whether I have the value or not. I'll let the function that generates the
promise worry about logging the specific error.</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">apiMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">fetch</span><span class="p">()</span>
<span class="w">  </span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">error</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">);</span>
<span class="w">    </span><span class="n">throw</span><span class="w"> </span><span class="n">error</span><span class="p">;</span>
<span class="w">  </span><span class="p">});</span>
</pre></div>

<p>That way, the rest of the application can ignore its error if it wants, and
treat it as an undefined value if it wants.</p>
<p>I want my high level functions to fail safely and not worry about the details
on why its dependencies failed, and I also prefer KISS to DRY when I have to
make that tradeoff--which is ultimately why I opted to not use <code>reflect</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Similar answer, but more idiomatic for ES6 perhaps:</p>
<div class="code"><pre class="code literal-block">const<span class="w"> </span>a<span class="w"> </span>=<span class="w"> </span>Promise.resolve(1);
const<span class="w"> </span>b<span class="w"> </span>=<span class="w"> </span>Promise.reject(new<span class="w"> </span>Error(2));
const<span class="w"> </span>c<span class="w"> </span>=<span class="w"> </span>Promise.resolve(3);

Promise.all([a,<span class="w"> </span>b,<span class="w"> </span>c].map(p<span class="w"> </span>=&gt;<span class="w"> </span>p.catch(e<span class="w"> </span>=&gt;<span class="w"> </span>e)))
<span class="w">  </span>.then(results<span class="w"> </span>=&gt;<span class="w"> </span>console.log(results))<span class="w"> </span>//<span class="w"> </span>1,Error:<span class="w"> </span>2,3
<span class="w">  </span>.catch(e<span class="w"> </span>=&gt;<span class="w"> </span>console.log(e));


const<span class="w"> </span>console<span class="w"> </span>=<span class="w"> </span>{<span class="w"> </span>log:<span class="w"> </span>msg<span class="w"> </span>=&gt;<span class="w"> </span>div.innerHTML<span class="w"> </span>+=<span class="w"> </span>msg<span class="w"> </span>+<span class="w"> </span>"<span class="nt">&lt;br&gt;</span>"};


<span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">"div"</span><span class="nt">&gt;&lt;/div&gt;</span>
</pre></div>

<p>Depending on the type(s) of values returned, errors can often be distinguished
easily enough (e.g. use <code>undefined</code> for "don't care", <code>typeof</code> for plain non-
object values, <code>result.message</code>, <code>result.toString().startsWith("Error:")</code>
etc.)</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-make-a-whole-row-in-a-table-clickable-as-a-link/" class="u-url">how to make a whole row in a table clickable as a link?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-make-a-whole-row-in-a-table-clickable-as-a-link/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:06:32+08:00" itemprop="datePublished" title="2023-02-18 04:06">2023-02-18 04:06</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm using Bootstrap and the following doesn't work:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;tbody&gt;</span>
<span class="w">    </span><span class="nt">&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;tr&gt;</span>
<span class="w">            </span><span class="nt">&lt;td&gt;</span>Blah<span class="w"> </span>Blah<span class="nt">&lt;/td&gt;</span>
<span class="w">            </span><span class="nt">&lt;td&gt;</span>1234567<span class="nt">&lt;/td&gt;</span>
<span class="w">            </span><span class="nt">&lt;td&gt;</span>£158,000<span class="nt">&lt;/td&gt;</span>
<span class="w">        </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">    </span><span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/tbody&gt;</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<h2>Author's note I:</h2>
<p>Please look at other answers below, especially ones that do not use jquery.</p>
<h2>Author's note II:</h2>
<p>Preserved for posterity but surely the <em>wrong</em> approach in 2020. (Was non
idiomatic even back in 2017)</p>
<h2>Original Answer</h2>
<p>You are using Bootstrap which means you are using jQuery :^), so one way to do
it is:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;tbody&gt;</span>
<span class="w">    </span><span class="nt">&lt;tr</span><span class="w"> </span><span class="na">class=</span><span class="s">'clickable-row'</span><span class="w"> </span><span class="na">data-href=</span><span class="s">'url://'</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;td&gt;</span>Blah<span class="w"> </span>Blah<span class="nt">&lt;/td&gt;</span><span class="w"> </span><span class="nt">&lt;td&gt;</span>1234567<span class="nt">&lt;/td&gt;</span><span class="w"> </span><span class="nt">&lt;td&gt;</span>£158,000<span class="nt">&lt;/td&gt;</span>
<span class="w">    </span><span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/tbody&gt;</span>


jQuery(document).ready(function($)<span class="w"> </span>{
<span class="w">    </span>$(".clickable-row").click(function()<span class="w"> </span>{
<span class="w">        </span>window.location<span class="w"> </span>=<span class="w"> </span>$(this).data("href");
<span class="w">    </span>});
});
</pre></div>

<p>Of course you don't have to use href or switch locations, you can do whatever
you like in the click handler function. Read up on <code>jQuery</code> and how to write
handlers;</p>
<p>Advantage of using a <em>class</em> over <em>id</em> is that you can apply the solution to
multiple rows:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;tbody&gt;</span>
<span class="w">    </span><span class="nt">&lt;tr</span><span class="w"> </span><span class="na">class=</span><span class="s">'clickable-row'</span><span class="w"> </span><span class="na">data-href=</span><span class="s">'url://link-for-first-row/'</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;td&gt;</span>Blah<span class="w"> </span>Blah<span class="nt">&lt;/td&gt;</span><span class="w"> </span><span class="nt">&lt;td&gt;</span>1234567<span class="nt">&lt;/td&gt;</span><span class="w"> </span><span class="nt">&lt;td&gt;</span>£158,000<span class="nt">&lt;/td&gt;</span>
<span class="w">    </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">    </span><span class="nt">&lt;tr</span><span class="w"> </span><span class="na">class=</span><span class="s">'clickable-row'</span><span class="w"> </span><span class="na">data-href=</span><span class="s">'url://some-other-link/'</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;td&gt;</span>More<span class="w"> </span>money<span class="nt">&lt;/td&gt;</span><span class="w"> </span><span class="nt">&lt;td&gt;</span>1234567<span class="nt">&lt;/td&gt;</span><span class="w"> </span><span class="nt">&lt;td&gt;</span>£800,000<span class="nt">&lt;/td&gt;</span>
<span class="w">    </span><span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/tbody&gt;</span>
</pre></div>

<p>and your code base doesn't change. The same handler would take care of all the
rows.</p>
<h2>Another option</h2>
<p>You can use Bootstrap jQuery callbacks like this (in a <code>document.ready</code>
callback):</p>
<div class="code"><pre class="code literal-block">$("#container").on('click-row.bs.table', function (e, row, $element) {
    window.location = $element.data('href');
});
</pre></div>

<p>This has the advantage of not being reset upon table sorting (which happens
with the other option).</p>
<hr>
<h4>Note</h4>
<p>Since this was posted <code>window.document.location</code> is obsolete (or deprecated at
the very least) use <code>window.location</code> instead.</p>
<p><br></p>
<h3>Suggest</h3>
<p>You can't do that. It is invalid HTML. You can't put a <code>&lt;a&gt;</code> in between a
<code>&lt;tbody&gt;</code> and a <code>&lt;tr&gt;</code>. Try this instead:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;tr</span><span class="w"> </span><span class="na">onclick=</span><span class="s">"window.location='#';"</span><span class="nt">&gt;</span>
<span class="w">   </span>...
<span class="nt">&lt;/tr&gt;</span>
</pre></div>

<p>add style for pointer view</p>
<div class="code"><pre class="code literal-block"><span class="cp">[</span><span class="nx">data</span><span class="na">-href</span><span class="cp">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">cursor</span><span class="p">:</span><span class="w"> </span><span class="kc">pointer</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</pre></div>

<p>When you work up to it, you'd want to use JavaScript to assign the click
handler outside the HTML.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-run-travis-ci-locally/" class="u-url">How to run travis-ci locally</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-run-travis-ci-locally/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T04:06:06+08:00" itemprop="datePublished" title="2023-02-18 04:06">2023-02-18 04:06</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'd rather not have to push every little change to <code>.travis.yml</code> and every
little change I make to the source in order to run the build. With jenkins you
can download jenkins and run locally. Does travis offer something like this?</p>
<blockquote>
<p>Note: I've seen the travis-ci cli and downloaded it, but all it seems to do
is call their API, which then connects to my GitHub repo, so if I don't
push, it won't matter that I restart the last build.</p>
</blockquote>
<p><br><br></p>
<h2>Answer</h2>
<p>This process allows you to completely reproduce any Travis build job on your
computer. Also, you can interrupt the process at any time and debug. Below is
an example where I perfectly reproduce the results of job #191.1 on php-
school/cli-menu .</p>
<h2>Prerequisites</h2>
<ul>
<li>You have public repo on GitHub</li>
<li>You ran at least one build on Travis</li>
<li>You have Docker set up on your computer</li>
</ul>
<h2>Set up the build environment</h2>
<p>Reference: https://docs.travis-ci.com/user/common-build-problems/</p>
<ol>
<li>
<p>Make up your own temporary build ID</p>
<div class="code"><pre class="code literal-block"><span class="nv">BUILDID</span><span class="o">=</span><span class="s2">"build-$RANDOM"</span>
</pre></div>

</li>
<li>
<p>View the build log, open the show more button for WORKER INFORMATION and find the INSTANCE line, paste it in here and run (replace the tag after the colon with the newest available one):</p>
<div class="code"><pre class="code literal-block">INSTANCE="travisci/ci-garnet:packer-1512502276-986baf0"
</pre></div>

</li>
<li>
<p>Run the headless server</p>
<div class="code"><pre class="code literal-block">docker run --name $BUILDID -dit $INSTANCE /sbin/init
</pre></div>

</li>
<li>
<p>Run the attached client</p>
<div class="code"><pre class="code literal-block"><span class="nv">docker</span><span class="w"> </span><span class="k">exec</span><span class="w"> </span><span class="o">-</span><span class="nv">it</span><span class="w"> </span><span class="mh">$B</span><span class="nv">UILDID</span><span class="w"> </span><span class="nv">bash</span><span class="w"> </span><span class="o">-</span><span class="nv">l</span>
</pre></div>

</li>
</ol>
<h2>Run the job</h2>
<p>Now you are now inside your Travis environment. Run <code>su - travis</code> to begin.</p>
<p>This step is well defined but it is more tedious and manual. You will find
every command that Travis runs in the environment. To do this, look for for
everything in the right column which has a tag like <code>0.03s</code>.</p>
<p><img alt="" src="images/yxmQI.png"></p>
<p>On the left side you will see the actual commands. Run those commands, in
order.</p>
<h2>Result</h2>
<p>Now is a good time to run the <code>history</code> command. You can restart the process
and replay those commands to run the same test against an updated code base.</p>
<ul>
<li>If your repo is private: <code>ssh-keygen -t rsa -b 4096 -C "YOUR EMAIL REGISTERED IN GITHUB"</code> then <code>cat ~/.ssh/id_rsa.pub</code> and click here to add a key</li>
<li>FYI: you can <code>git pull</code> from inside docker to load commits from your dev box before you push them to GitHub</li>
<li>If you want to change the commands Travis runs then it is YOUR responsibility to figure out how that translates back into a working <code>.travis.yml</code>.</li>
<li>I don't know how to clean up the Docker environment, it looks complicated, maybe this leaks memory</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>Travis-ci offers a new container-based infrastructure that uses docker. This
can be very useful if you're trying to troubleshoot a travis-ci build by
reproducing it locally. This is taken from Travis CI's documentation.</p>
<h3>Troubleshooting Locally in a Docker Image</h3>
<p>If you're having trouble tracking down the exact problem in a build it often
helps to run the build locally. To do this you need to be using our container
based infrastructure (ie, have <code>sudo: false</code> in your <code>.travis.yml</code>), and to
know which Docker image you are using on Travis CI.</p>
<h4>Running a Container Based Docker Image Locally</h4>
<ol>
<li>Download and install the Docker Engine.</li>
<li>
<p>Select an image from Docker Hub. If you're not using a language-specific image pick <code>ci-ruby</code>. Open a terminal and start an interactive Docker session using the image URL:</p>
<div class="code"><pre class="code literal-block">docker run -it travisci/ubuntu-ruby:18.04 /bin/bash
</pre></div>

</li>
<li>
<p>Switch to the <code>travis</code> user:</p>
<div class="code"><pre class="code literal-block">su - travis
</pre></div>

</li>
<li>
<p>Clone your git repository into the <code>/</code> folder of the image.</p>
</li>
<li>Manually install any dependencies.</li>
<li>Manually run your Travis CI build command.</li>
</ol>
</div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1220.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1218.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
