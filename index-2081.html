<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2081) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2081.html">
<link rel="prev" href="index-2082.html" type="text/html">
<link rel="next" href="index-2080.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/is-there-an-advantage-to-use-a-synchronized-method-instead-of-a-synchronized-block/" class="u-url">Is there an advantage to use a Synchronized Method instead of a Synchronized Block?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/is-there-an-advantage-to-use-a-synchronized-method-instead-of-a-synchronized-block/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T16:29:01+08:00" itemprop="datePublished" title="2023-03-03 16:29">2023-03-03 16:29</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Can any one tell me the advantage of synchronized method over synchronized
block with an example?</p>
<p><br><br></p>
<h2>Answer</h2>
<blockquote>
<p><em>Can anyone tell me the advantage of the synchronized method over the
synchronized block with an example? Thanks.</em></p>
</blockquote>
<p>There is not a clear advantage of using synchronized method over the block.</p>
<p>Perhaps the only one ( but I wouldn't call it an advantage ) is you don't need
to include the object reference <code>this</code>.</p>
<p>Method:</p>
<div class="code"><pre class="code literal-block">public synchronized void method() { // blocks "this" from here.... 
    ...
    ...
    ...
} // to here
</pre></div>

<p>Block:</p>
<div class="code"><pre class="code literal-block">public void method() { 
    synchronized( this ) { // blocks "this" from here .... 
        ....
        ....
        ....
    }  // to here...
}
</pre></div>

<p>See? No advantage at all.</p>
<p>Blocks <strong>do</strong> have advantages over methods though, mostly in flexibility
because you can use another object as lock whereas syncing the method would
lock the entire object.</p>
<p>Compare:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// locks the whole object</span>
<span class="p">...</span><span class="w"> </span>
<span class="n">private</span><span class="w"> </span><span class="n">synchronized</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">someInputRelatedWork</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span><span class="w"> </span>
<span class="p">}</span>
<span class="n">private</span><span class="w"> </span><span class="n">synchronized</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">someOutputRelatedWork</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span><span class="w"> </span>
<span class="p">}</span>
</pre></div>

<p>vs.</p>
<div class="code"><pre class="code literal-block"><span class="c1">// Using specific locks</span>
<span class="n">Object</span><span class="w"> </span><span class="n">inputLock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Object</span><span class="p">();</span>
<span class="n">Object</span><span class="w"> </span><span class="n">outputLock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Object</span><span class="p">();</span>

<span class="n">private</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">someInputRelatedWork</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">synchronized</span><span class="p">(</span><span class="n">inputLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">        </span><span class="p">...</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span>
<span class="p">}</span>
<span class="n">private</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">someOutputRelatedWork</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">synchronized</span><span class="p">(</span><span class="n">outputLock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">        </span><span class="p">...</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Also if the method grows you can still keep the synchronized section
separated:</p>
<div class="code"><pre class="code literal-block"> private void method() {
     ... code here
     ... code here
     ... code here
    synchronized( lock ) { 
        ... very few lines of code here
    }
     ... code here
     ... code here
     ... code here
     ... code here
}
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>The only real difference is that a synchronized block can choose which object
it synchronizes on. A synchronized method can only use <code>'this'</code> (or the
corresponding Class instance for a synchronized class method). For example,
these are semantically equivalent:</p>
<div class="code"><pre class="code literal-block">synchronized void foo() {
  ...
}

void foo() {
    synchronized (this) {
      ...
    }
}
</pre></div>

<p>The latter is more flexible since it can compete for the associated lock of
<em>any</em> object, often a member variable. It's also more granular because you
could have concurrent code executing before and after the block but still
within the method. Of course, you could just as easily use a synchronized
method by refactoring the concurrent code into separate non-synchronized
methods. Use whichever makes the code more comprehensible.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-get-the-picture-size-with-pil/" class="u-url">How do I get the picture size with PIL?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-get-the-picture-size-with-pil/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T16:28:39+08:00" itemprop="datePublished" title="2023-03-03 16:28">2023-03-03 16:28</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I get a size of a pictures sides with PIL or any other Python library?</p>
<p><br><br></p>
<h2>Answer</h2>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'whatever.png'</span><span class="p">)</span>
<span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span>
</pre></div>

<p>According to the documentation.</p>
<p><br></p>
<h3>Suggest</h3>
<p>You can use Pillow (Website, Documentation, GitHub, PyPI). Pillow has the same
interface as PIL, but works with Python 3.</p>
<h3>Installation</h3>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>Pillow
</pre></div>

<p>If you don't have administrator rights (sudo on Debian), you can use</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>Pillow
</pre></div>

<p>Other notes regarding the installation are here.</p>
<h3>Code</h3>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">img</span><span class="p">:</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>
</pre></div>

<h3>Speed</h3>
<p>This needed 3.21 seconds for 30336 images (JPGs from 31x21 to 424x428,
training data from National Data Science Bowl on Kaggle)</p>
<p>This is probably the most important reason to use Pillow instead of something
self-written. And you should use Pillow instead of PIL (python-imaging),
because it works with Python 3.</p>
<h3>Alternative #1: Numpy (deprecated)</h3>
<p>I keep <code>scipy.ndimage.imread</code> as the information is still out there, but keep
in mind:</p>
<blockquote>
<p>imread is deprecated! imread is deprecated in SciPy 1.0.0, and [was] removed
in 1.2.0.</p>
</blockquote>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">scipy.ndimage</span>
<span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">channels</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

<h3>Alternative #2: Pygame</h3>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">pygame</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
<span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span>
<span class="n">height</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-entity-cannot-be-constructed-in-a-linq-to-entities-query/" class="u-url">The entity cannot be constructed in a LINQ to Entities query</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/the-entity-cannot-be-constructed-in-a-linq-to-entities-query/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T16:28:14+08:00" itemprop="datePublished" title="2023-03-03 16:28">2023-03-03 16:28</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>There is an entity type called <code>Product</code> that is generated by entity
framework. I have written this query</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">IQueryable</span><span class="o">&lt;</span><span class="nv">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">GetProducts</span><span class="ss">(</span><span class="nv">int</span><span class="w"> </span><span class="nv">categoryID</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">db</span>.<span class="nv">Products</span>
<span class="w">           </span><span class="nv">where</span><span class="w"> </span><span class="nv">p</span>.<span class="nv">CategoryID</span><span class="o">==</span><span class="w"> </span><span class="nv">categoryID</span>
<span class="w">           </span><span class="nv">select</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Product</span><span class="w"> </span>{<span class="w"> </span><span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">p</span>.<span class="nv">Name</span>}<span class="c1">;</span>
}
</pre></div>

<p>The code below throws the following error :</p>
<blockquote>
<p>"The entity or complex type Shop.Product cannot be constructed in a LINQ to
Entities query"</p>
</blockquote>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">productRepository</span><span class="o">.</span><span class="n">GetProducts</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">Tolist</span><span class="p">();</span>
</pre></div>

<p>But when I use <code>select p</code> instead of <code>select new Product { Name = p.Name};</code> it
works correctly.</p>
<p>How can I preform a custom select section?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You cannot (and should not be able to) project onto a mapped entity. You can,
however, project onto an anonymous type or onto a DTO:</p>
<div class="code"><pre class="code literal-block">public class ProductDTO
{
    public string Name { get; set; }
    // Other field you may need from the Product entity
}
</pre></div>

<p>And your method will return a List of DTO's.</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">ProductDTO</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">GetProducts</span><span class="ss">(</span><span class="nv">int</span><span class="w"> </span><span class="nv">categoryID</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ss">(</span><span class="nv">from</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">db</span>.<span class="nv">Products</span>
<span class="w">            </span><span class="nv">where</span><span class="w"> </span><span class="nv">p</span>.<span class="nv">CategoryID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">categoryID</span>
<span class="w">            </span><span class="nv">select</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ProductDTO</span><span class="w"> </span>{<span class="w"> </span><span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">p</span>.<span class="nv">Name</span><span class="w"> </span>}<span class="ss">)</span>.<span class="nv">ToList</span><span class="ss">()</span><span class="c1">;</span>
}
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You can project into anonymous type, and then from it to model type</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">IEnumerable</span><span class="o">&lt;</span><span class="nv">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">GetProducts</span><span class="ss">(</span><span class="nv">int</span><span class="w"> </span><span class="nv">categoryID</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ss">(</span><span class="nv">from</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">Context</span>.<span class="nv">Set</span><span class="o">&lt;</span><span class="nv">Product</span><span class="o">&gt;</span><span class="ss">()</span>
<span class="w">            </span><span class="nv">where</span><span class="w"> </span><span class="nv">p</span>.<span class="nv">CategoryID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">categoryID</span>
<span class="w">            </span><span class="nv">select</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span>{<span class="w"> </span><span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">p</span>.<span class="nv">Name</span><span class="w"> </span>}<span class="ss">)</span>.<span class="nv">ToList</span><span class="ss">()</span>
<span class="w">           </span>.<span class="nv">Select</span><span class="ss">(</span><span class="nv">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Product</span><span class="w"> </span>{<span class="w"> </span><span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">x</span>.<span class="nv">Name</span><span class="w"> </span>}<span class="ss">)</span><span class="c1">;</span>
}
</pre></div>

<p><strong>Edit</strong> : I am going to be a bit more specific since this question got a lot
of attention.</p>
<p>You cannot project into model type directly (EF restriction), so there is no
way around this. The only way is to project into anonymous type (1st
iteration), and then to model type (2nd iteration).</p>
<p>Please also be aware that when you partially load entities in this manner,
they cannot be updated, so they should remain detached, as they are.</p>
<p>I never did completely understand why this is not possible, and the answers on
this thread do not give strong reasons against it (mostly speaking about
partially loaded data). It is correct that in partially loaded state entity
cannot be updated, but then, this entity would be detached, so accidental
attempts to save them would not be possible.</p>
<p>Consider method I used above: we still have a partially loaded model entity as
a result. This entity is detached.</p>
<p>Consider this (wish-to-exist) possible code:</p>
<div class="code"><pre class="code literal-block"><span class="k">return</span><span class="w"> </span><span class="ss">(</span><span class="nv">from</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">Context</span>.<span class="nv">Set</span><span class="o">&lt;</span><span class="nv">Product</span><span class="o">&gt;</span><span class="ss">()</span>
<span class="w">        </span><span class="nv">where</span><span class="w"> </span><span class="nv">p</span>.<span class="nv">CategoryID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">categoryID</span>
<span class="w">        </span><span class="nv">select</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Product</span><span class="w"> </span>{<span class="w"> </span><span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">p</span>.<span class="nv">Name</span><span class="w"> </span>}<span class="ss">)</span>.<span class="nv">AsNoTracking</span><span class="ss">()</span>.<span class="nv">ToList</span><span class="ss">()</span><span class="c1">;</span>
</pre></div>

<p>This could also result in a list of detached entities, so we would not need to
make two iterations. A compiler would be smart to see that AsNoTracking() has
been used, which will result in detached entities, so it could allow us to do
this. If, however, AsNoTracking() was omitted, it could throw the same
exception as it is throwing now, to warn us that we need to be specific enough
about the result we want.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2082.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2080.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
