<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1615) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1615.html">
<link rel="prev" href="index-1616.html" type="text/html">
<link rel="next" href="index-1614.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/is-there-any-advantage-of-using-map-over-unordered-map-in-case-of-trivial-keys/" class="u-url">Is there any advantage of using map over unordered_map in case of trivial keys?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/is-there-any-advantage-of-using-map-over-unordered-map-in-case-of-trivial-keys/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T05:14:17+08:00" itemprop="datePublished" title="2023-03-03 05:14">2023-03-03 05:14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>A recent talk about <code>unordered_map</code> in C++ made me realize that I should use
<code>unordered_map</code> for most cases where I used <code>map</code> before, because of the
efficiency of lookup ( <em>amortized O(1)</em> vs. <em>O(log n)</em> ). Most times I use a
map, I use either <code>int</code> or <code>std::string</code> as the key type; hence, I've got no
problems with the definition of the hash function. The more I thought about
it, the more I came to realize that I can't find any reason of using a
<code>std::map</code> over a <code>std::unordered_map</code> in the case of keys with simple types
-- I took a look at the interfaces, and didn't find any significant
differences that would impact my code.</p>
<p>Hence the question: is there any real reason to use <code>std::map</code> over
<code>std::unordered_map</code> in the case of simple types like <code>int</code> and <code>std::string</code>?</p>
<p>I'm asking from a strictly programming point of view -- I know that it's not
fully considered standard, and that it may pose problems with porting.</p>
<p>Also, I expect that one of the correct answers might be <em>"it's more efficient
for smaller sets of data"</em> because of a smaller overhead (is that true?) --
hence I'd like to restrict the question to cases where the amount of keys is
non-trivial (&gt;1 024).</p>
<p><strong>Edit:</strong> <em>duh, I forgot the obvious (thanks GMan!) -- yes, maps are ordered
of course -- I know that, and am looking for other reasons.</em></p>
<p><br><br></p>
<h2>Answer</h2>
<p>Don't forget that <code>map</code> keeps its elements ordered. If you can't give that up,
obviously you can't use <code>unordered_map</code>.</p>
<p>Something else to keep in mind is that <code>unordered_map</code> generally uses more
memory. <code>map</code> just has a few house-keeping pointers, and memory for each
object. Contrarily, <code>unordered_map</code> has a big array (these can get quite big
in some implementations), and then additional memory for each object. If you
need to be memory-aware, <code>map</code> should prove better, because it lacks the large
array.</p>
<p>So, if you need pure lookup-retrieval, I'd say <code>unordered_map</code> is the way to
go. But there are always trade-offs, and if you can't afford them, then you
can't use it.</p>
<p>Just from personal experience, I found an enormous improvement in performance
(measured, of course) when using <code>unordered_map</code> instead of <code>map</code> in a main
entity look-up table.</p>
<p>On the other hand, I found it was much slower at repeatedly inserting and
removing elements. It's great for a relatively static collection of elements,
but if you're doing tons of insertions and deletions the hashing + bucketing
seems to add up. (Note, this was over many iterations.)</p>
<p><br></p>
<h3>Suggest</h3>
<p>If you want to compare the speed of your <code>std::map</code> and <code>std::unordered_map</code>
implementations, you could use Google's sparsehash project which has a
time_hash_map program to time them. For example, with gcc 4.4.2 on an x86_64
Linux system</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>./time_hash_map
TR1<span class="w"> </span>UNORDERED_MAP<span class="w"> </span><span class="o">(</span><span class="m">4</span><span class="w"> </span>byte<span class="w"> </span>objects,<span class="w"> </span><span class="m">10000000</span><span class="w"> </span>iterations<span class="o">)</span>:
map_grow<span class="w">              </span><span class="m">126</span>.1<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="m">27427396</span><span class="w"> </span>hashes,<span class="w"> </span><span class="m">40000000</span><span class="w"> </span>copies<span class="o">)</span><span class="w">  </span><span class="m">290</span>.9<span class="w"> </span>MB
map_predict/grow<span class="w">       </span><span class="m">67</span>.4<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="m">10000000</span><span class="w"> </span>hashes,<span class="w"> </span><span class="m">40000000</span><span class="w"> </span>copies<span class="o">)</span><span class="w">  </span><span class="m">232</span>.8<span class="w"> </span>MB
map_replace<span class="w">            </span><span class="m">22</span>.3<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="m">37427396</span><span class="w"> </span>hashes,<span class="w"> </span><span class="m">40000000</span><span class="w"> </span>copies<span class="o">)</span>
map_fetch<span class="w">              </span><span class="m">16</span>.3<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="m">37427396</span><span class="w"> </span>hashes,<span class="w"> </span><span class="m">40000000</span><span class="w"> </span>copies<span class="o">)</span>
map_fetch_empty<span class="w">         </span><span class="m">9</span>.8<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="m">10000000</span><span class="w"> </span>hashes,<span class="w">        </span><span class="m">0</span><span class="w"> </span>copies<span class="o">)</span>
map_remove<span class="w">             </span><span class="m">49</span>.1<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="m">37427396</span><span class="w"> </span>hashes,<span class="w"> </span><span class="m">40000000</span><span class="w"> </span>copies<span class="o">)</span>
map_toggle<span class="w">             </span><span class="m">86</span>.1<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="m">20000000</span><span class="w"> </span>hashes,<span class="w"> </span><span class="m">40000000</span><span class="w"> </span>copies<span class="o">)</span>

STANDARD<span class="w"> </span>MAP<span class="w"> </span><span class="o">(</span><span class="m">4</span><span class="w"> </span>byte<span class="w"> </span>objects,<span class="w"> </span><span class="m">10000000</span><span class="w"> </span>iterations<span class="o">)</span>:
map_grow<span class="w">              </span><span class="m">225</span>.3<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="w">       </span><span class="m">0</span><span class="w"> </span>hashes,<span class="w"> </span><span class="m">20000000</span><span class="w"> </span>copies<span class="o">)</span><span class="w">  </span><span class="m">462</span>.4<span class="w"> </span>MB
map_predict/grow<span class="w">      </span><span class="m">225</span>.1<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="w">       </span><span class="m">0</span><span class="w"> </span>hashes,<span class="w"> </span><span class="m">20000000</span><span class="w"> </span>copies<span class="o">)</span><span class="w">  </span><span class="m">462</span>.6<span class="w"> </span>MB
map_replace<span class="w">           </span><span class="m">151</span>.2<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="w">       </span><span class="m">0</span><span class="w"> </span>hashes,<span class="w"> </span><span class="m">20000000</span><span class="w"> </span>copies<span class="o">)</span>
map_fetch<span class="w">             </span><span class="m">156</span>.0<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="w">       </span><span class="m">0</span><span class="w"> </span>hashes,<span class="w"> </span><span class="m">20000000</span><span class="w"> </span>copies<span class="o">)</span>
map_fetch_empty<span class="w">         </span><span class="m">1</span>.4<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="w">       </span><span class="m">0</span><span class="w"> </span>hashes,<span class="w">        </span><span class="m">0</span><span class="w"> </span>copies<span class="o">)</span>
map_remove<span class="w">            </span><span class="m">141</span>.0<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="w">       </span><span class="m">0</span><span class="w"> </span>hashes,<span class="w"> </span><span class="m">20000000</span><span class="w"> </span>copies<span class="o">)</span>
map_toggle<span class="w">             </span><span class="m">67</span>.3<span class="w"> </span>ns<span class="w">  </span><span class="o">(</span><span class="w">       </span><span class="m">0</span><span class="w"> </span>hashes,<span class="w"> </span><span class="m">20000000</span><span class="w"> </span>copies<span class="o">)</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/when-is-the-init-function-run/" class="u-url">When is the init() function run?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/when-is-the-init-function-run/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T05:13:52+08:00" itemprop="datePublished" title="2023-03-03 05:13">2023-03-03 05:13</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've tried to find a precise explanation of what the <code>init()</code> function does in
Go. I read what Effective Go says but I was unsure if I understood fully what
it said. The exact sentence I am unsure is the following:</p>
<blockquote>
<p>And finally means finally: init is called after all the variable
declarations in the package have evaluated their initializers, and those are
evaluated only after all the imported packages have been initialized.</p>
</blockquote>
<p>What does <code>all the variable declarations in the package have evaluated their
initializers</code> mean? Does it mean if you declare "global" variables in a
package and its files, init() will not run until all of it is evaluated and
then it will run all the init function and then main() when ./main_file_name
is ran?</p>
<p>I also read Mark Summerfield's go book the following:</p>
<blockquote>
<p>If a package has one or more init() functions they are automatically
executed before the main package's main() function is called.</p>
</blockquote>
<p>In my understanding, <code>init()</code> is only relevant when you intend to run main()
right? Anyone understands more precisely <code>init()</code> feel free to correct me</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Yes assuming you have this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">WhatIsThe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AnswerToLife</span><span class="p">()</span>

<span class="k">func</span><span class="w"> </span><span class="n">AnswerToLife</span><span class="p">()</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">42</span>
<span class="p">}</span>

<span class="k">func</span><span class="w"> </span><span class="n">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="n">WhatIsThe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="p">}</span>

<span class="k">func</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">3</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">WhatIsThe</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">"It's all a lie."</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><code>AnswerToLife()</code> is guaranteed to run before <code>init()</code> is called, and <code>init()</code>
is guaranteed to run before <code>main()</code> is called.</p>
<p>Keep in mind that <code>init()</code> is always called, regardless if there's main or
not, so if you import a package that has an <code>init</code> function, it will be
executed.</p>
<p>Additionally, you can have multiple <code>init()</code> functions per package; they will
be executed in the order they show up in the file (after all variables are
initialized of course). If they span multiple files, they will be executed in
lexical file name order (as pointed out by @benc):</p>
<blockquote>
<p>It seems that <code>init()</code> functions are executed in lexical file name order.
The Go spec says "build systems are encouraged to present multiple files
belonging to the same package in lexical file name order to a compiler". It
seems that <code>go build</code> works this way.</p>
</blockquote>
<hr>
<p>A lot of the internal Go packages use <code>init()</code> to initialize tables and such,
for example
https://github.com/golang/go/blob/883bc6/src/compress/bzip2/bzip2.go#L480</p>
<p><br></p>
<h3>Suggest</h3>
<p>See this picture. :)</p>
<p><code>import --&gt; const --&gt; var --&gt; init()</code></p>
<p><img alt="" src="https://astaxie.gitbooks.io/build-web-application-with-%0Agolang/en/images/2.3.init.png?raw=true"></p>
<ol>
<li>
<p>If a package imports other packages, the imported packages are initialized first.</p>
</li>
<li>
<p>Current package's constant initialized then.</p>
</li>
<li>
<p>Current package's variables are initialized then.</p>
</li>
<li>
<p>Finally, <code>init()</code> function of current package is called.</p>
</li>
</ol>
<blockquote>
<p>A package can have multiple init functions (either in a single file or
distributed across multiple files) and they are called in the order in which
they are presented to the compiler.</p>
<p>A package will be initialised only once even if it is imported from multiple
packages.</p>
</blockquote>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-meaning-of-prepended-double-colon/" class="u-url">What is the meaning of prepended double colon "::"?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-meaning-of-prepended-double-colon/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T05:13:27+08:00" itemprop="datePublished" title="2023-03-03 05:13">2023-03-03 05:13</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I found this line of a code in a class which I have to modify:</p>
<div class="code"><pre class="code literal-block">
</pre></div>

<p>and I don't know what exactly means the double colon prepended to the class
name. Without that I would read: declaration of <code>tmpCo</code> as a pointer to an
object of the class <code>Configuration</code>... but the prepended double colon confuses
me.</p>
<p>I also found:</p>
<div class="code"><pre class="code literal-block"><span class="nt">typedef</span><span class="w"> </span><span class="p">::</span><span class="nd">config</span><span class="p">::</span><span class="nd">set</span><span class="w"> </span><span class="nt">ConfigSet</span><span class="o">;</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>This ensures that resolution occurs from the global namespace, instead of
starting at the namespace you're currently in. For instance, if you had two
different classes called <code>Configuration</code> as such:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Configuration</span>; // <span class="k">class</span> <span class="mi">1</span>, <span class="nb">in</span> <span class="n">global</span> <span class="n">namespace</span>
<span class="n">namespace</span> <span class="n">MyApp</span>
{
    <span class="k">class</span> <span class="n">Configuration</span>; // <span class="k">class</span> <span class="mi">2</span>, <span class="n">different</span> <span class="nb">from</span> <span class="k">class</span> <span class="mi">1</span>
    <span class="n">function</span> <span class="n">blah</span>()
    {
        // <span class="n">resolves</span> <span class="nb">to</span> <span class="n">MyApp::Configuration</span>, <span class="k">class</span> <span class="mi">2</span>
        <span class="n">Configuration::doStuff</span>(...) 
        // <span class="n">resolves</span> <span class="nb">to</span> <span class="n">top-level</span> <span class="n">Configuration</span>, <span class="k">class</span> <span class="mi">1</span>
        ::<span class="n">Configuration::doStuff</span>(...)
    }
}
</pre></div>

<p>Basically, it allows you to traverse up to the global namespace since your
name might get clobbered by a new definition inside another namespace, in this
case <code>MyApp</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The <code>::</code> operator is called the scope-resolution operator and does just that,
it resolves scope. So, by prefixing a type-name with this, it tells your
compiler to look in the global namespace for the type.</p>
<p>Example:</p>
<div class="code"><pre class="code literal-block"><span class="nv">int</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="c1">;</span>

<span class="nv">int</span><span class="w"> </span><span class="nv">main</span><span class="ss">(</span><span class="nv">void</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">  </span><span class="nv">int</span><span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="c1">;</span>
<span class="w">  </span>::<span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="c1">;  // set global count to 1</span>
<span class="w">  </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="c1">;    // set local count to 2</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="c1">;</span>
}
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1616.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1614.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
