<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 593) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-593.html">
<link rel="prev" href="index-594.html" type="text/html">
<link rel="next" href="index-592.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-concatenate-two-mp4-files-using-ffmpeg/" class="u-url">How to concatenate two MP4 files using FFmpeg?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-concatenate-two-mp4-files-using-ffmpeg/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T10:50:38+08:00" itemprop="datePublished" title="2023-02-17 10:50">2023-02-17 10:50</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to concatenate two mp4 files using ffmpeg. I need this to be an
automatic process hence why I chose ffmpeg. I'm converting the two files into
<code>.ts</code> files and then concatenating them and then trying to encode that
concatenated <code>.ts</code> file. The files are <code>h264</code> and <code>aac</code> encoded and I'm hoping
to keep the quality the same or as close to original as possible.</p>
<div class="code"><pre class="code literal-block">ffmpeg -i part1.mp4 -vcodec copy -vbsf h264_mp4toannexb -acodec copy part1.ts
ffmpeg -i part2.mp4 -vcodec copy -vbsf h264_mp4toannexb -acodec copy part2.ts
cat part1.ts part2.ts &gt; parts.ts
ffmpeg -y -i parts.ts -acodec copy -ar 44100 -ab 96k -coder ac -vbsf h264_mp4toannexb parts.mp4
</pre></div>

<p>Unfortunately I'm getting the following error message coming back from ffmpeg
during encoding:</p>
<div class="code"><pre class="code literal-block">[<span class="nv">h264</span><span class="w"> </span>@<span class="w"> </span><span class="mi">0</span><span class="nv">x1012600</span>]<span class="nv">sps_id</span><span class="w"> </span><span class="nv">out</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">range</span>
[<span class="nv">h264</span><span class="w"> </span>@<span class="w"> </span><span class="mi">0</span><span class="nv">x1012600</span>]<span class="nv">non</span><span class="o">-</span><span class="nv">existing</span><span class="w"> </span><span class="nv">SPS</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">referenced</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">buffering</span><span class="w"> </span><span class="nv">period</span>
[<span class="nv">h264</span><span class="w"> </span>@<span class="w"> </span><span class="mi">0</span><span class="nv">x1012600</span>]<span class="nv">sps_id</span><span class="w"> </span><span class="nv">out</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">range</span>
[<span class="nv">h264</span><span class="w"> </span>@<span class="w"> </span><span class="mi">0</span><span class="nv">x1012600</span>]<span class="nv">non</span><span class="o">-</span><span class="nv">existing</span><span class="w"> </span><span class="nv">SPS</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">referenced</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">buffering</span><span class="w"> </span><span class="nv">period</span>
[<span class="nv">NULL</span><span class="w"> </span>@<span class="w"> </span><span class="mi">0</span><span class="nv">x101d600</span>]<span class="nv">error</span>,<span class="w"> </span><span class="nv">non</span><span class="w"> </span><span class="nv">monotone</span><span class="w"> </span><span class="nv">timestamps</span><span class="w"> </span><span class="mi">13779431</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">13779431</span><span class="nv">kbits</span><span class="o">/</span><span class="nv">s</span><span class="w">    </span>
<span class="nv">av_interleaved_write_frame</span><span class="ss">()</span>:<span class="w"> </span><span class="nv">Error</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nv">opening</span><span class="w"> </span><span class="nv">file</span>
</pre></div>

<p>This happens about half way through encoding which makes me think that you
can't concat two .ts files together and have it work.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I ended up using mpg as the intermediate format and it worked (NOTE this is a
dangerous example, -qscale 0 will re-encode the video...)</p>
<div class="code"><pre class="code literal-block">ffmpeg -i 1.mp4 -qscale 0 1.mpg
ffmpeg -i 2.mp4 -qscale 0 2.mpg
cat 1.mpg 2.mpg | ffmpeg -f mpeg -i - -qscale 0 -vcodec mpeg4 output.mp4
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p><strong>FOR MP4 FILES</strong></p>
<p>For <strong>.mp4</strong> files (which I obtained from DailyMotion.com: a 50 minute tv
episode, downloadable only in three parts, as three .mp4 video files) the
following was an effective solution for <strong>Windows 7</strong> , and does <strong>NOT</strong>
involve re-encoding the files.</p>
<p>I renamed the files (as <em>file1.mp4</em> , <em>file2.mp4</em> , <em>file3.mp4</em> ) such that
the parts were in the correct order for viewing the complete tv episode.</p>
<p>Then I created a simple <strong>batch file</strong> (concat.bat), with the following
contents:</p>
<div class="code"><pre class="code literal-block">:: Create File List
echo file file1.mp4 &gt;  mylist.txt 
echo file file2.mp4 &gt;&gt; mylist.txt
echo file file3.mp4 &gt;&gt; mylist.txt

:: Concatenate Files
ffmpeg -f concat -i mylist.txt -c copy output.mp4
</pre></div>

<p>The <strong>batch file</strong> , and <strong>ffmpeg.exe</strong> , must both be put in the same folder
as the <strong>.mp4 files</strong> to be joined. Then run the batch file. It will typically
take less than ten seconds to run.<br>
.</p>
<p><strong>Addendum</strong> (2018/10/21) -</p>
<p>If what you were looking for is a method for specifying all the mp4 files in
the current folder without a lot of retyping, try this in your Windows <strong>batch
file</strong> instead ( <strong>MUST</strong> include the option <strong>-safe 0</strong> ):</p>
<div class="code"><pre class="code literal-block">::<span class="w"> </span><span class="nv">Create</span><span class="w"> </span><span class="nv">File</span><span class="w"> </span><span class="nv">List</span>
<span class="k">for</span><span class="w"> </span><span class="o">%%</span><span class="nv">i</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="ss">(</span><span class="o">*</span>.<span class="nv">mp4</span><span class="ss">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">echo</span><span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="s1">'%%i'</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nv">mylist</span>.<span class="nv">txt</span>

::<span class="w"> </span><span class="nv">Concatenate</span><span class="w"> </span><span class="nv">Files</span>
<span class="nv">ffmpeg</span><span class="w"> </span><span class="o">-</span><span class="nv">f</span><span class="w"> </span><span class="nv">concat</span><span class="w"> </span><span class="o">-</span><span class="nv">safe</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="nv">i</span><span class="w"> </span><span class="nv">mylist</span>.<span class="nv">txt</span><span class="w"> </span><span class="o">-</span><span class="nv">c</span><span class="w"> </span><span class="nv">copy</span><span class="w"> </span><span class="nv">output</span>.<span class="nv">mp4</span>
</pre></div>

<p>This works on Windows 7, in a batch file. <strong>Don't</strong> try using it on the
command line, because it only works in a batch file!</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-list-all-collections-in-the-mongodb-shell/" class="u-url">How can I list all collections in the MongoDB shell?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-list-all-collections-in-the-mongodb-shell/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T10:50:10+08:00" itemprop="datePublished" title="2023-02-17 10:50">2023-02-17 10:50</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In the MongoDB shell, how do I list all collections for the current database
that I'm using?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can do...</p>
<p>JavaScript (shell):</p>
<div class="code"><pre class="code literal-block">db.getCollectionNames()
</pre></div>

<p>Node.js:</p>
<div class="code"><pre class="code literal-block">db.listCollections()
</pre></div>

<p>Non-JavaScript (shell only):</p>
<div class="code"><pre class="code literal-block"><span class="k">show</span><span class="w"> </span><span class="nv">collections</span>
</pre></div>

<p>The reason I call that non-JavaScript is because:</p>
<div class="code"><pre class="code literal-block"><span class="err">$</span><span class="w"> </span><span class="n">mongo</span><span class="w"> </span><span class="n">prodmongo</span><span class="o">/</span><span class="n">app</span><span class="w"> </span><span class="o">--</span><span class="n">eval</span><span class="w"> </span><span class="ss">"show collections"</span>
<span class="n">MongoDB</span><span class="w"> </span><span class="n">shell</span><span class="w"> </span><span class="nl">version</span><span class="p">:</span><span class="w"> </span><span class="mf">3.2.10</span>
<span class="n">connecting</span><span class="w"> </span><span class="k">to</span><span class="err">:</span><span class="w"> </span><span class="n">prodmongo</span><span class="o">/</span><span class="n">app</span>
<span class="mi">2016</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">26</span><span class="nl">T19</span><span class="p">:</span><span class="mi">34</span><span class="err">:</span><span class="mf">34.886</span><span class="o">-</span><span class="mi">0400</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="n">QUERY</span><span class="w">    </span><span class="o">[</span><span class="n">thread1</span><span class="o">]</span><span class="w"> </span><span class="nl">SyntaxError</span><span class="p">:</span><span class="w"> </span><span class="n">missing</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">before</span><span class="w"> </span><span class="k">statement</span><span class="w"> </span><span class="err">@</span><span class="p">(</span><span class="n">shell</span><span class="w"> </span><span class="n">eval</span><span class="p">)</span><span class="err">:</span><span class="mi">1</span><span class="err">:</span><span class="mi">5</span>

<span class="err">$</span><span class="w"> </span><span class="n">mongo</span><span class="w"> </span><span class="n">prodmongo</span><span class="o">/</span><span class="n">app</span><span class="w"> </span><span class="o">--</span><span class="n">eval</span><span class="w"> </span><span class="ss">"db.getCollectionNames()"</span>
<span class="n">MongoDB</span><span class="w"> </span><span class="n">shell</span><span class="w"> </span><span class="nl">version</span><span class="p">:</span><span class="w"> </span><span class="mf">3.2.10</span>
<span class="n">connecting</span><span class="w"> </span><span class="k">to</span><span class="err">:</span><span class="w"> </span><span class="n">prodmongo</span><span class="o">/</span><span class="n">app</span>
<span class="o">[</span>
<span class="n">    "Profiles",</span>
<span class="n">    "Unit_Info"</span>
<span class="o">]</span>
</pre></div>

<p>If you really want that sweet, sweet <code>show collections</code> output, you can:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>mongo<span class="w"> </span>prodmongo/app<span class="w"> </span>--eval<span class="w"> </span><span class="s2">"db.getCollectionNames().join('\n')"</span>
MongoDB<span class="w"> </span>shell<span class="w"> </span>version:<span class="w"> </span><span class="m">3</span>.2.10
connecting<span class="w"> </span>to:<span class="w"> </span>prodmongo/app
Profiles
Unit_Info
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<div class="code"><pre class="code literal-block"><span class="o">&gt;</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="nv">collections</span>
</pre></div>

<p>will list all the collections in the currently selected DB, as stated in the
command line help (<code>help</code>).</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-delete-a-stash-created-with-git-stash-create/" class="u-url">How to delete a stash created with git stash create?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-delete-a-stash-created-with-git-stash-create/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T10:49:42+08:00" itemprop="datePublished" title="2023-02-17 10:49">2023-02-17 10:49</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Git stash seems to do a lot of what I want, except that it is a little hard to
script, as the if you have no changes, then <code>git stash; git stash pop</code> will do
something different than if you do have changes in your repository.</p>
<p>It appears that <code>git stash create</code> is the answer to that problem, and
everything works, except for one thing… I can't get rid of the created stash.
Is there any way to get rid of the stash?</p>
<p>To make it 100% clear what I am doing:</p>
<p>Create the stash:</p>
<div class="code"><pre class="code literal-block">~/tmp/a(master) $ git stash create 
60629375d0eb12348f9d31933dd348ad0f038435
~/tmp/a(master) $ git st
# On branch master
# Changes to be committed:
#   (use "git reset HEAD &lt;file&gt;..." to unstage)
#
#   new file:   b
#
~/tmp/a(master) $ git reset --hard
HEAD is now at 555d572 log message
</pre></div>

<p>Use the stash:</p>
<div class="code"><pre class="code literal-block">~/tmp/a(master) $ git apply 60629375d0eb12348f9d31933dd348ad0f038435
fatal: can't open patch '60629375d0eb12348f9d31933dd348ad0f038435': No such file or directory
~/tmp/a(master) $ git stash apply 60629375d0eb12348f9d31933dd348ad0f038435
# On branch master
# Changes to be committed:
#   (use "git reset HEAD &lt;file&gt;..." to unstage)
#
#   new file:   b
#
</pre></div>

<p>Delete the stash: (except that this last bit doesn't work)</p>
<div class="code"><pre class="code literal-block">~<span class="o">/</span><span class="nv">tmp</span><span class="o">/</span><span class="nf">a</span><span class="p">(</span><span class="nv">master</span><span class="p">)</span><span class="w"> </span><span class="p">$</span><span class="w"> </span><span class="nv">git</span><span class="w"> </span><span class="nv">stash</span><span class="w"> </span><span class="nv">drop</span><span class="w"> </span><span class="o">!</span><span class="p">$</span>
<span class="nv">git</span><span class="w"> </span><span class="nv">stash</span><span class="w"> </span><span class="nv">drop</span><span class="w"> </span><span class="mf">60629375d0</span><span class="nv">eb12348f9d31933dd348ad0f038435</span>
<span class="o">'</span><span class="mf">60629375d0</span><span class="nv">eb12348f9d31933dd348ad0f038435</span><span class="o">'</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">stash</span><span class="w"> </span><span class="nv">reference</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p><strong>To delete a normal stash created with<code>git stash</code> , you want <code>git stash drop</code>
or <code>git stash drop stash@{n}</code>. See below for more details.</strong></p>
<hr>
<p>You don't need to delete a stash created with <code>git stash create</code>. From the
docs:</p>
<blockquote>
<p>Create a stash entry (which is a regular commit object) and return its
object name, without storing it anywhere in the ref namespace. This is
intended to be useful for scripts. It is probably not the command you want
to use; see "save" above.</p>
</blockquote>
<p>Since nothing references the stash commit, it will get garbage collected
eventually.</p>
<hr>
<p>A stash created with <code>git stash</code> or <code>git stash save</code> is saved to <code>refs/stash</code>,
and can be deleted with <code>git stash drop</code>. As with all Git objects, the actual
stash contents aren't deleted from your computer until a <code>gc</code> prunes those
objects after they expire (default is 2 weeks later).</p>
<p>Older stashes are saved in the <code>refs/stash</code> reflog (try <code>cat
.git/logs/refs/stash</code>), and can be deleted with <code>git stash drop stash@{n}</code>,
where <code>n</code> is the number shown by <code>git stash list</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p><strong>To delete a normal stash created with<code>git stash</code> , you want <code>git stash drop</code>
or <code>git stash drop stash@{n}</code>. See below for more details.</strong></p>
<hr>
<p>You don't need to delete a stash created with <code>git stash create</code>. From the
docs:</p>
<blockquote>
<p>Create a stash entry (which is a regular commit object) and return its
object name, without storing it anywhere in the ref namespace. This is
intended to be useful for scripts. It is probably not the command you want
to use; see "save" above.</p>
</blockquote>
<p>Since nothing references the stash commit, it will get garbage collected
eventually.</p>
<hr>
<p>A stash created with <code>git stash</code> or <code>git stash save</code> is saved to <code>refs/stash</code>,
and can be deleted with <code>git stash drop</code>. As with all Git objects, the actual
stash contents aren't deleted from your computer until a <code>gc</code> prunes those
objects after they expire (default is 2 weeks later).</p>
<p>Older stashes are saved in the <code>refs/stash</code> reflog (try <code>cat
.git/logs/refs/stash</code>), and can be deleted with <code>git stash drop stash@{n}</code>,
where <code>n</code> is the number shown by <code>git stash list</code>.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-594.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-592.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
