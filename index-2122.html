<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2122) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2122.html">
<link rel="prev" href="index-2123.html" type="text/html">
<link rel="next" href="index-2121.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/when-do-i-use-the-php-constant-php-eol/" class="u-url">When do I use the PHP constant "PHP_EOL"?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/when-do-i-use-the-php-constant-php-eol/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T17:27:32+08:00" itemprop="datePublished" title="2023-03-03 17:27">2023-03-03 17:27</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>When is it a good idea to use <code>PHP_EOL</code>?</p>
<p>I sometimes see this in code samples of PHP. Does this handle DOS/Mac/Unix
endline issues?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Yes, <code>PHP_EOL</code> is ostensibly used to find the newline character in a cross-
platform-compatible way, so it handles DOS/Unix issues.</p>
<p>Note that PHP_EOL represents the endline character for the <em>current</em> system.
For instance, it will not find a Windows endline when executed on a unix-like
system.</p>
<p><br></p>
<h3>Suggest</h3>
<p>From <code>main/php.h</code> of PHP version 7.1.1 and version 5.6.30:</p>
<div class="code"><pre class="code literal-block"><span class="c1">#ifdef PHP_WIN32</span>
<span class="c1">#   include "tsrm_win32.h"</span>
<span class="c1">#   include "win95nt.h"</span>
<span class="c1">#   ifdef PHP_EXPORTS</span>
<span class="c1">#       define PHPAPI __declspec(dllexport)</span>
<span class="c1">#   else</span>
<span class="c1">#       define PHPAPI __declspec(dllimport)</span>
<span class="c1">#   endif</span>
<span class="c1">#   define PHP_DIR_SEPARATOR '\\'</span>
<span class="c1">#   define PHP_EOL "\r\n"</span>
<span class="c1">#else</span>
<span class="c1">#   if defined(__GNUC__) &amp;&amp; __GNUC__ &gt;= 4</span>
<span class="c1">#       define PHPAPI __attribute__ ((visibility("default")))</span>
<span class="c1">#   else</span>
<span class="c1">#       define PHPAPI</span>
<span class="c1">#   endif</span>
<span class="c1">#   define THREAD_LS</span>
<span class="c1">#   define PHP_DIR_SEPARATOR '/'</span>
<span class="c1">#   define PHP_EOL "\n"</span>
<span class="c1">#endif</span>
</pre></div>

<p>As you can see <code>PHP_EOL</code> can be <code>"\r\n"</code> (on Windows servers) or <code>"\n"</code> (on
anything else). On PHP versions <strong>prior</strong> 5.4.0RC8, there were a third value
possible for <code>PHP_EOL</code>: <code>"\r"</code> (on MacOSX servers). It was wrong and has been
fixed on 2012-03-01 with bug 61193.</p>
<p>As others already told you, you can use <code>PHP_EOL</code> in any kind of output (where
<strong>any</strong> of these values are valid - like: HTML, XML, logs...) where you want
unified newlines. Keep in mind that it's the server that it's determining the
value, not the client. Your Windows visitors will get the value from your Unix
server which is inconvenient for them sometimes.</p>
<p>I just wanted to show the possibles values of <code>PHP_EOL</code> backed by the PHP
sources since it hasn't been shown here yet...</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/use-of-finalize-dispose-method-in-c/" class="u-url">Use of Finalize/Dispose method in C#</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/use-of-finalize-dispose-method-in-c/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T17:27:06+08:00" itemprop="datePublished" title="2023-03-03 17:27">2023-03-03 17:27</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>C# 2008</p>
<p>I have been working on this for a while now, and I am still confused about the
use of finalize and dispose methods in code. My questions are below:</p>
<ol>
<li>
<p>I know that we only need a finalizer while disposing unmanaged resources. However, if there are managed resources that make calls to unmanaged resources, would it still need to implement a finalizer?</p>
</li>
<li>
<p>However, if I develop a class that doesn't use any unmanaged resource - directly or indirectly, should I implement the <code>IDisposable</code> to allow the clients of that class to use the 'using statement'? </p>
</li>
</ol>
<p>Would it be feasible to implement IDisposable just to enable clients of your
class to use the using statement?</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="nv">using</span><span class="ss">(</span><span class="nv">myClass</span><span class="w"> </span><span class="nv">objClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">myClass</span><span class="ss">())</span>
{
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">Do</span><span class="w"> </span><span class="nv">stuff</span><span class="w"> </span><span class="nv">here</span>
}
</pre></div>

<ol>
<li>I have developed this simple code below to demonstrate the Finalize/dispose use:<div class="code"><pre class="code literal-block">public class NoGateway : IDisposable
</pre></div>

<p>{
    private WebClient wc = null;</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="n">NoGateway</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">wc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">WebClient</span><span class="p">();</span>
<span class="w">    </span><span class="n">wc</span><span class="o">.</span><span class="n">DownloadStringCompleted</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">wc_DownloadStringCompleted</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">Start</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Async</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">NoGateway</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="bp">true</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="bp">false</span>
<span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">NoGatewayStatus</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Start</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Async</span><span class="s1">'s download</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">here</span>
<span class="w">    </span><span class="n">wc</span><span class="o">.</span><span class="n">DownloadStringAsync</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Uri</span><span class="p">(</span><span class="n">www</span><span class="o">.</span><span class="n">xxxx</span><span class="o">.</span><span class="n">xxx</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">private</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">wc_DownloadStringCompleted</span><span class="p">(</span><span class="n">object</span><span class="w"> </span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">DownloadStringCompletedEventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">here</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">Dispose</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">NoGateway</span><span class="w"> </span><span class="n">object</span>
<span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">Dispose</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">wc</span><span class="o">.</span><span class="n">DownloadStringCompleted</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">wc_DownloadStringCompleted</span><span class="p">;</span>
<span class="w">    </span><span class="n">wc</span><span class="o">.</span><span class="n">Dispose</span><span class="p">();</span>
<span class="w">    </span><span class="n">GC</span><span class="o">.</span><span class="n">SuppressFinalize</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>}</p>
</li>
</ol>
<p>Question about the source code:</p>
<ol>
<li>Here I have not added the finalizer, and normally the finalizer will be called by the GC, and the finalizer will call the Dispose. As I don't have the finalizer, when do I call the Dispose method? Is it the client of the class that has to call it?</li>
</ol>
<p>So my class in the example is called NoGateway and the client could use and
dispose of the class like this:</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="nv">using</span><span class="ss">(</span><span class="nv">NoGateway</span><span class="w"> </span><span class="nv">objNoGateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">NoGateway</span><span class="ss">())</span>
{
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">Do</span><span class="w"> </span><span class="nv">stuff</span><span class="w"> </span><span class="nv">here</span><span class="w">   </span>
}
</pre></div>

<p>Would the Dispose method be automatically called when execution reaches the
end of the using block, or does the client have to manually call the dispose
method? i.e.</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="nv">NoGateway</span><span class="w"> </span><span class="nv">objNoGateway</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">NoGateway</span><span class="ss">()</span><span class="c1">;</span>
<span class="o">//</span><span class="w"> </span><span class="k">Do</span><span class="w"> </span><span class="nv">stuff</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">object</span>
<span class="nv">objNoGateway</span>.<span class="nv">Dispose</span><span class="ss">()</span><span class="c1">; // finished with it</span>
</pre></div>

<ol>
<li>I am using the <code>WebClient</code> class in my <code>NoGateway</code> class. Because <code>WebClient</code> implements the <code>IDisposable</code> interface, does this mean that <code>WebClient</code> indirectly uses unmanaged resources? Is there a hard and fast rule to follow this? How do I know that a class uses unmanaged resources?</li>
</ol>
<p><br><br></p>
<h2>Answer</h2>
<p>The recommended IDisposable pattern is here. When programming a class that
uses IDisposable, generally you should use two patterns:</p>
<p>When implementing a sealed class that doesn't use unmanaged resources, you
simply implement a Dispose method as with normal interface implementations:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="n">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IDisposable</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">Dispose</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">rid</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">managed</span><span class="w"> </span><span class="n">resources</span><span class="p">,</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">Dispose</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">member</span><span class="w"> </span><span class="n">variables</span><span class="o">...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>When implementing an unsealed class, do it like this:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span>:<span class="w"> </span><span class="nv">IDisposable</span>
{<span class="w">    </span>
<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">Dispose</span><span class="ss">()</span>
<span class="w">    </span>{
<span class="w">        </span><span class="nv">Dispose</span><span class="ss">(</span><span class="nv">true</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span><span class="nv">GC</span>.<span class="nv">SuppressFinalize</span><span class="ss">(</span><span class="nv">this</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="nv">protected</span><span class="w"> </span><span class="nv">virtual</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">Dispose</span><span class="ss">(</span><span class="nv">bool</span><span class="w"> </span><span class="nv">disposing</span><span class="ss">)</span>
<span class="w">    </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">disposing</span><span class="ss">)</span>
<span class="w">        </span>{
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="nv">get</span><span class="w"> </span><span class="nv">rid</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">managed</span><span class="w"> </span><span class="nv">resources</span>
<span class="w">        </span>}<span class="w">   </span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="nv">get</span><span class="w"> </span><span class="nv">rid</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">unmanaged</span><span class="w"> </span><span class="nv">resources</span>
<span class="w">    </span>}

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">unmanaged</span><span class="w"> </span><span class="nv">resources</span><span class="w"> </span><span class="nv">directly</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">B</span>
<span class="w">    </span><span class="o">//~</span><span class="nv">B</span><span class="ss">()</span>
<span class="w">    </span><span class="o">//</span>{
<span class="w">    </span><span class="o">//</span><span class="w">    </span><span class="nv">Dispose</span><span class="ss">(</span><span class="nv">false</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="o">//</span>}
}
</pre></div>

<p>Notice that I haven't declared a finalizer in <code>B</code>; you should only implement a
finalizer if you have actual unmanaged resources to dispose. The CLR deals
with finalizable objects differently to non-finalizable objects, even if
<code>SuppressFinalize</code> is called.</p>
<p>So, you shouldn't declare a finalizer unless you have to, but you give
inheritors of your class a hook to call your <code>Dispose</code> and implement a
finalizer themselves if they use unmanaged resources directly:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span>:<span class="w"> </span><span class="nv">B</span>
{
<span class="w">    </span><span class="nv">private</span><span class="w"> </span><span class="nv">IntPtr</span><span class="w"> </span><span class="nv">m_Handle</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">protected</span><span class="w"> </span><span class="nv">override</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">Dispose</span><span class="ss">(</span><span class="nv">bool</span><span class="w"> </span><span class="nv">disposing</span><span class="ss">)</span>
<span class="w">    </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">disposing</span><span class="ss">)</span>
<span class="w">        </span>{
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="nv">get</span><span class="w"> </span><span class="nv">rid</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">managed</span><span class="w"> </span><span class="nv">resources</span>
<span class="w">        </span>}
<span class="w">        </span><span class="nv">ReleaseHandle</span><span class="ss">(</span><span class="nv">m_Handle</span><span class="ss">)</span><span class="c1">;</span>

<span class="w">        </span><span class="nv">base</span>.<span class="nv">Dispose</span><span class="ss">(</span><span class="nv">disposing</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="o">~</span><span class="nv">C</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">Dispose</span><span class="ss">(</span><span class="nv">false</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<p>If you're not using unmanaged resources directly (<code>SafeHandle</code> and friends
doesn't count, as they declare their own finalizers), then don't implement a
finalizer, as the GC deals with finalizable classes differently, even if you
later suppress the finalizer. Also note that, even though <code>B</code> doesn't have a
finalizer, it still calls <code>SuppressFinalize</code> to correctly deal with any
subclasses that do implement a finalizer.</p>
<p>When a class implements the IDisposable interface, it means that somewhere
there are some unmanaged resources that should be got rid of when you've
finished using the class. The actual resources are encapsulated within the
classes; you don't need to explicitly delete them. Simply calling <code>Dispose()</code>
or wrapping the class in a <code>using(...) {}</code> will make sure any unmanaged
resources are got rid of as necessary.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The official pattern to implement <code>IDisposable</code> is hard to understand. I
believe this one is better:</p>
<div class="code"><pre class="code literal-block">public class BetterDisposableClass : IDisposable {

  public void Dispose() {
    CleanUpManagedResources();
    CleanUpNativeResources();
    GC.SuppressFinalize(this);
  }

  protected virtual void CleanUpManagedResources() { 
    // ...
  }
  protected virtual void CleanUpNativeResources() {
    // ...
  }

  ~BetterDisposableClass() {
    CleanUpNativeResources();
  }

}
</pre></div>

<p>An even better solution is to have a rule that you <strong>always</strong> have to create a
wrapper class for any unmanaged resource that you need to handle:</p>
<div class="code"><pre class="code literal-block">public class NativeDisposable : IDisposable {

  public void Dispose() {
    CleanUpNativeResource();
    GC.SuppressFinalize(this);
  }

  protected virtual void CleanUpNativeResource() {
    // ...
  }

  ~NativeDisposable() {
    CleanUpNativeResource();
  }

}
</pre></div>

<p>With <code>SafeHandle</code> and its derivatives, these classes should be <em>very rare</em>.</p>
<p>The result for disposable classes that don't deal directly with unmanaged
resources, even in the presence of inheritance, is powerful: <strong>they don't need
to be concerned with unmanaged resources anymore</strong>. They'll be <em>simple</em> to
implement and to understand:</p>
<div class="code"><pre class="code literal-block">public class ManagedDisposable : IDisposable {

  public virtual void Dispose() {
    // dispose of managed resources
  }

}
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-is-super-super-method-not-allowed-in-java/" class="u-url">Why is super.super.method(); not allowed in Java?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-is-super-super-method-not-allowed-in-java/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T17:26:39+08:00" itemprop="datePublished" title="2023-03-03 17:26">2023-03-03 17:26</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I read this question and thought that would easily be solved (not that it
isn't solvable without) if one could write:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@Override</span>
<span class="k">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">toString</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">super</span><span class="p">.</span><span class="n">super</span><span class="p">.</span><span class="n">toString</span><span class="p">();</span>
<span class="err">}</span>
</pre></div>

<p>I'm not sure if it is useful in many cases, but I wonder <em>why</em> it isn't and if
something like this exists in other languages.</p>
<p>What do you guys think?</p>
<p><strong>EDIT:</strong> To clarify: yes I know, that's impossible in Java and I don't really
miss it. This is nothing I expected to work and was surprised getting a
compiler error. I just had the idea and like to discuss it.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>It violates encapsulation. You shouldn't be able to bypass the parent class's
behaviour. It makes sense to sometimes be able to bypass your <em>own</em> class's
behaviour (particularly from within the same method) but not your parent's.
For example, suppose we have a base "collection of items", a subclass
representing "a collection of red items" and a subclass of that representing
"a collection of big red items". It makes sense to have:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">Items</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">RedItems</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Items</span>
<span class="p">{</span>
<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">item</span><span class="o">.</span><span class="n">isRed</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">NotRedItemException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">BigRedItems</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RedItems</span>
<span class="p">{</span>
<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">item</span><span class="o">.</span><span class="n">isBig</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">NotBigItemException</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>That's fine - RedItems can always be confident that the items it contains are
all red. Now suppose we <em>were</em> able to call super.super.add():</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">NaughtyItems</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">RedItems</span>
<span class="p">{</span>
<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">Item</span><span class="w"> </span><span class="n">item</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">don</span><span class="s1">'t care if it'</span><span class="n">s</span><span class="w"> </span><span class="n">red</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="o">.</span><span class="w"> </span><span class="n">Take</span><span class="w"> </span><span class="n">that</span><span class="p">,</span><span class="w"> </span><span class="n">RedItems</span><span class="o">!</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">super</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Now we could add whatever we like, and the invariant in <code>RedItems</code> is broken.</p>
<p>Does that make sense?</p>
<p><br></p>
<h3>Suggest</h3>
<p>I think Jon Skeet has the correct answer. I'd just like to add that you <em>can</em>
access shadowed variables from superclasses of superclasses by casting <code>this</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">interface</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="k">class</span><span class="w"> </span><span class="n">T1</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="k">class</span><span class="w"> </span><span class="n">T2</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">T1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="k">class</span><span class="w"> </span><span class="n">T3</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">T2</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">        </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">"x=</span><span class="se">\t\t</span><span class="s2">"</span><span class="w">          </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">                </span><span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">"super.x=</span><span class="se">\t\t</span><span class="s2">"</span><span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="n">super</span><span class="o">.</span><span class="n">x</span><span class="p">);</span>
<span class="w">                </span><span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">"((T2)this).x=</span><span class="se">\t</span><span class="s2">"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">T2</span><span class="p">)</span><span class="n">this</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="p">);</span>
<span class="w">                </span><span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">"((T1)this).x=</span><span class="se">\t</span><span class="s2">"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">T1</span><span class="p">)</span><span class="n">this</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="p">);</span>
<span class="w">                </span><span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">"((I)this).x=</span><span class="se">\t</span><span class="s2">"</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">I</span><span class="p">)</span><span class="n">this</span><span class="p">)</span><span class="o">.</span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="nb nb-Type">String</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">new</span><span class="w"> </span><span class="n">T3</span><span class="p">()</span><span class="o">.</span><span class="n">test</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>which produces the output:</p>
<div class="code"><pre class="code literal-block">x=              3
super.x=        2
((T2)this).x=   2
((T1)this).x=   1
((I)this).x=    0
</pre></div>

<p>(example from the JLS)</p>
<p>However, this doesn't work for method calls because method calls are
determined based on the runtime type of the object.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2123.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2121.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
