<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 498) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-498.html">
<link rel="prev" href="index-499.html" type="text/html">
<link rel="next" href="index-497.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/should-css-always-precede-javascript/" class="u-url">Should CSS always precede JavaScript?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/should-css-always-precede-javascript/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T08:23:27+08:00" itemprop="datePublished" title="2023-02-17 08:23">2023-02-17 08:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In countless places online I have seen the recommendation to include CSS prior
to JavaScript. The reasoning is generally, of this form:</p>
<blockquote>
<p>When it comes to ordering your CSS and JavaScript, you want your CSS to come
first. The reason is that the rendering thread has all the style information
it needs to render the page. If the JavaScript includes come first, the
JavaScript engine has to parse it all before continuing on to the next set
of resources. This means the rendering thread can't completely show the
page, since it doesn't have all the styles it needs.</p>
</blockquote>
<p>My actual testing reveals something quite different:</p>
<h4>My test harness</h4>
<p>I use the following Ruby script to generate specific delays for various
resources:</p>
<div class="code"><pre class="code literal-block"><span class="n">require</span><span class="w"> </span><span class="s1">'rubygems'</span>
<span class="n">require</span><span class="w"> </span><span class="s1">'eventmachine'</span>
<span class="n">require</span><span class="w"> </span><span class="s1">'evma_httpserver'</span>
<span class="n">require</span><span class="w"> </span><span class="s1">'date'</span>

<span class="k">class</span><span class="w"> </span><span class="n">Handler</span><span class="w">  </span><span class="o">&lt;</span><span class="w"> </span><span class="n">EventMachine</span><span class="p">::</span><span class="n">Connection</span>
<span class="w">  </span><span class="n">include</span><span class="w"> </span><span class="n">EventMachine</span><span class="p">::</span><span class="n">HttpServer</span>

<span class="w">  </span><span class="n">def</span><span class="w"> </span><span class="n">process_http_request</span>
<span class="w">    </span><span class="n">resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EventMachine</span><span class="p">::</span><span class="n">DelegatedHttpResponse</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="w"> </span><span class="bp">self</span><span class="w"> </span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">unless</span><span class="w"> </span><span class="err">@</span><span class="n">http_query_string</span>

<span class="w">    </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">@</span><span class="n">http_path_info</span>
<span class="w">    </span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">@</span><span class="n">http_query_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"&amp;"</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">{</span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"="</span><span class="p">)}</span><span class="o">.</span><span class="n">flatten</span>
<span class="w">    </span><span class="n">parsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Hash</span><span class="p">[</span><span class="o">*</span><span class="n">array</span><span class="p">]</span>

<span class="w">    </span><span class="n">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parsed</span><span class="p">[</span><span class="s2">"delay"</span><span class="p">]</span><span class="o">.</span><span class="n">to_i</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000.0</span>
<span class="w">    </span><span class="n">jsdelay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parsed</span><span class="p">[</span><span class="s2">"jsdelay"</span><span class="p">]</span><span class="o">.</span><span class="n">to_i</span>

<span class="w">    </span><span class="n">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">delay</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="w">    </span><span class="n">jsdelay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jsdelay</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5000</span><span class="p">)</span>

<span class="w">    </span><span class="n">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">delay</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">jsdelay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jsdelay</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Block which fulfills the request</span>
<span class="w">    </span><span class="n">operation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="n">do</span>
<span class="w">      </span><span class="n">sleep</span><span class="w"> </span><span class="n">delay</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">path</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="o">/.</span><span class="n">js</span><span class="o">$/</span><span class="p">)</span>
<span class="w">        </span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span>
<span class="w">        </span><span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"text/javascript"</span>
<span class="w">        </span><span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"(function(){</span>
<span class="w">            </span><span class="k">var</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">();</span>
<span class="w">            </span><span class="k">while</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="c1">#{jsdelay}){}</span>
<span class="w">          </span><span class="p">})();</span><span class="s2">"</span>
<span class="w">      </span><span class="n">end</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="n">path</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="o">/.</span><span class="n">css</span><span class="o">$/</span><span class="p">)</span>
<span class="w">        </span><span class="n">resp</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span>
<span class="w">        </span><span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"Content-Type"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"text/css"</span>
<span class="w">        </span><span class="n">resp</span><span class="o">.</span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"body {font-size: 50px;}"</span>
<span class="w">      </span><span class="n">end</span>
<span class="w">    </span><span class="n">end</span>

<span class="w">    </span><span class="c1"># Callback block to execute once the request is fulfilled</span>
<span class="w">    </span><span class="n">callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="o">|</span><span class="n">res</span><span class="o">|</span>
<span class="w">        </span><span class="n">resp</span><span class="o">.</span><span class="n">send_response</span>
<span class="w">    </span><span class="n">end</span>

<span class="w">    </span><span class="c1"># Let the thread pool (20 Ruby threads) handle request</span>
<span class="w">    </span><span class="n">EM</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span>
<span class="w">  </span><span class="n">end</span>
<span class="n">end</span>

<span class="n">EventMachine</span><span class="p">::</span><span class="n">run</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">EventMachine</span><span class="p">::</span><span class="n">start_server</span><span class="p">(</span><span class="s2">"0.0.0.0"</span><span class="p">,</span><span class="w"> </span><span class="mi">8081</span><span class="p">,</span><span class="w"> </span><span class="n">Handler</span><span class="p">)</span>
<span class="w">  </span><span class="n">puts</span><span class="w"> </span><span class="s2">"Listening..."</span>
<span class="p">}</span>
</pre></div>

<p>The above mini server allows me to set arbitrary delays for JavaScript files
(both server and client) and arbitrary CSS delays. For example,
<code>http://10.0.0.50:8081/test.css?delay=500</code> gives me a 500 ms delay
transferring the CSS.</p>
<p>I use the following page to test.</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>test<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">'text/javascript'</span><span class="p">&gt;</span>
<span class="w">          </span><span class="kd">var</span><span class="w"> </span><span class="nx">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">();</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">"http://10.0.0.50:8081/test.css?delay=500"</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/css"</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span> <span class="na">src</span><span class="o">=</span><span class="s">"http://10.0.0.50:8081/test2.js?delay=400&amp;amp;jsdelay=1000"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
      Elapsed time is:
      <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">'text/javascript'</span><span class="p">&gt;</span>
<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">startTime</span><span class="p">);</span>
<span class="w">      </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>

<p>When I include the CSS first, the page takes 1.5 seconds to render:</p>
<p><img alt="CSS first" src="images/ZDgrs.png"></p>
<p>When I include the JavaScript first, the page takes 1.4 seconds to render:</p>
<p><img alt="JavaScript first" src="images/5o5SG.png"></p>
<p>I get similar results in Chrome, Firefox and Internet Explorer. In Opera,
however, the ordering simply does not matter.</p>
<p>What appears to be happening is that the JavaScript interpreter refuses to
start until all the CSS is downloaded. So, it seems that having JavaScript
includes first is more efficient as the JavaScript thread gets more run time.</p>
<p>Am I missing something? Is the recommendation to place CSS includes prior to
JavaScript includes not correct?</p>
<p>It is clear that we could add async or use setTimeout to free up the render
thread or put the JavaScript code in the footer, or use a JavaScript loader.
The point here is about ordering of essential JavaScript bits and CSS bits in
the head.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This is a very interesting question. I've always put my CSS <code>&lt;link
href="..."&gt;</code>s before my JavaScript <code>&lt;script src="..."&gt;</code>s because "I read one
time that it's better." So, you're right; it's high time we do some actual
research!</p>
<p>I set up my own test harness in Node.js (code below). Basically, I:</p>
<ul>
<li>Made sure there was no HTTP caching so the browser would have to do a full download each time a page is loaded.</li>
<li>To simulate reality, I included jQuery and the H5BP CSS (so there's a decent amount of script/CSS to parse)</li>
<li>Set up two pages - one with CSS before script, one with CSS after script.</li>
<li>Recorded how long it took for the external script in the <strong><code>&lt;head&gt;</code></strong> to execute</li>
<li>Recorded how long it took for the inline script in the <strong><code>&lt;body&gt;</code></strong> to execute, which is analogous to <code>DOMReady</code>.</li>
<li>Delayed sending CSS and/or script to the browser by 500 ms.</li>
<li>Ran the test 20 times in the three major browsers.</li>
</ul>
<h2>Results</h2>
<p>First, with the CSS file delayed by 500 ms (the unit is milliseconds):</p>
<div class="code"><pre class="code literal-block"><span class="w">     </span><span class="nv">Browser</span>:<span class="w"> </span><span class="nv">Chrome</span><span class="w"> </span><span class="mi">18</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nv">IE</span><span class="w"> </span><span class="mi">9</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nv">Firefox</span><span class="w"> </span><span class="mi">9</span>
<span class="w">         </span><span class="nv">CSS</span>:<span class="w"> </span><span class="nv">first</span><span class="w">  </span><span class="nv">last</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nv">first</span><span class="w">  </span><span class="nv">last</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">last</span>
<span class="o">=======================================================</span>
<span class="nv">Header</span><span class="w"> </span><span class="k">Exec</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="o">|</span><span class="w">              </span><span class="o">|</span>
<span class="nv">Average</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">583</span><span class="w">    </span><span class="mi">36</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">559</span><span class="w">    </span><span class="mi">42</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mi">565</span><span class="w">   </span><span class="mi">49</span>
<span class="nv">St</span><span class="w"> </span><span class="nv">Dev</span><span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="mi">15</span><span class="w">    </span><span class="mi">12</span><span class="w">    </span><span class="o">|</span><span class="w">   </span><span class="mi">9</span><span class="w">     </span><span class="mi">7</span><span class="w">    </span><span class="o">|</span><span class="w">  </span><span class="mi">13</span><span class="w">    </span><span class="mi">6</span>
<span class="o">------------|--------------|--------------|------------</span>
<span class="nv">Body</span><span class="w"> </span><span class="k">Exec</span><span class="w">   </span><span class="o">|</span><span class="w">              </span><span class="o">|</span><span class="w">              </span><span class="o">|</span>
<span class="nv">Average</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">584</span><span class="w">    </span><span class="mi">521</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">559</span><span class="w">    </span><span class="mi">513</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">565</span><span class="w">   </span><span class="mi">519</span>
<span class="nv">St</span><span class="w"> </span><span class="nv">Dev</span><span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="mi">15</span><span class="w">      </span><span class="mi">9</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">9</span><span class="w">      </span><span class="mi">5</span><span class="w">   </span><span class="o">|</span><span class="w">  </span><span class="mi">13</span><span class="w">     </span><span class="mi">7</span>
</pre></div>

<p>Next, I set jQuery to delay by 500 ms instead of the CSS:</p>
<div class="code"><pre class="code literal-block"><span class="w">     </span><span class="nv">Browser</span>:<span class="w"> </span><span class="nv">Chrome</span><span class="w"> </span><span class="mi">18</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nv">IE</span><span class="w"> </span><span class="mi">9</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nv">Firefox</span><span class="w"> </span><span class="mi">9</span>
<span class="w">         </span><span class="nv">CSS</span>:<span class="w"> </span><span class="nv">first</span><span class="w">  </span><span class="nv">last</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nv">first</span><span class="w">  </span><span class="nv">last</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">last</span>
<span class="o">=======================================================</span>
<span class="nv">Header</span><span class="w"> </span><span class="k">Exec</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="o">|</span><span class="w">              </span><span class="o">|</span>
<span class="nv">Average</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">597</span><span class="w">    </span><span class="mi">556</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">562</span><span class="w">    </span><span class="mi">559</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">564</span><span class="w">   </span><span class="mi">564</span>
<span class="nv">St</span><span class="w"> </span><span class="nv">Dev</span><span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="mi">14</span><span class="w">     </span><span class="mi">12</span><span class="w">   </span><span class="o">|</span><span class="w">  </span><span class="mi">11</span><span class="w">      </span><span class="mi">7</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">8</span><span class="w">     </span><span class="mi">8</span>
<span class="o">------------|--------------|--------------|------------</span>
<span class="nv">Body</span><span class="w"> </span><span class="k">Exec</span><span class="w">   </span><span class="o">|</span><span class="w">              </span><span class="o">|</span><span class="w">              </span><span class="o">|</span>
<span class="nv">Average</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">598</span><span class="w">    </span><span class="mi">557</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">563</span><span class="w">    </span><span class="mi">560</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">564</span><span class="w">   </span><span class="mi">565</span>
<span class="nv">St</span><span class="w"> </span><span class="nv">Dev</span><span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="mi">14</span><span class="w">     </span><span class="mi">12</span><span class="w">   </span><span class="o">|</span><span class="w">  </span><span class="mi">10</span><span class="w">      </span><span class="mi">7</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">8</span><span class="w">     </span><span class="mi">8</span>
</pre></div>

<p>Finally, I set <strong>both</strong> jQuery and the CSS to delay by 500 ms:</p>
<div class="code"><pre class="code literal-block"><span class="w">     </span><span class="nv">Browser</span>:<span class="w"> </span><span class="nv">Chrome</span><span class="w"> </span><span class="mi">18</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nv">IE</span><span class="w"> </span><span class="mi">9</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nv">Firefox</span><span class="w"> </span><span class="mi">9</span>
<span class="w">         </span><span class="nv">CSS</span>:<span class="w"> </span><span class="nv">first</span><span class="w">  </span><span class="nv">last</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nv">first</span><span class="w">  </span><span class="nv">last</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="nv">first</span><span class="w"> </span><span class="nv">last</span>
<span class="o">=======================================================</span>
<span class="nv">Header</span><span class="w"> </span><span class="k">Exec</span><span class="w"> </span><span class="o">|</span><span class="w">              </span><span class="o">|</span><span class="w">              </span><span class="o">|</span>
<span class="nv">Average</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">620</span><span class="w">    </span><span class="mi">560</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">577</span><span class="w">    </span><span class="mi">577</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">571</span><span class="w">   </span><span class="mi">567</span>
<span class="nv">St</span><span class="w"> </span><span class="nv">Dev</span><span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="mi">16</span><span class="w">     </span><span class="mi">11</span><span class="w">   </span><span class="o">|</span><span class="w">  </span><span class="mi">19</span><span class="w">      </span><span class="mi">9</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">9</span><span class="w">    </span><span class="mi">10</span>
<span class="o">------------|--------------|--------------|------------</span>
<span class="nv">Body</span><span class="w"> </span><span class="k">Exec</span><span class="w">   </span><span class="o">|</span><span class="w">              </span><span class="o">|</span><span class="w">              </span><span class="o">|</span>
<span class="nv">Average</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="mi">623</span><span class="w">    </span><span class="mi">561</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">578</span><span class="w">    </span><span class="mi">580</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">571</span><span class="w">   </span><span class="mi">568</span>
<span class="nv">St</span><span class="w"> </span><span class="nv">Dev</span><span class="w">      </span><span class="o">|</span><span class="w">  </span><span class="mi">18</span><span class="w">     </span><span class="mi">11</span><span class="w">   </span><span class="o">|</span><span class="w">  </span><span class="mi">19</span><span class="w">      </span><span class="mi">9</span><span class="w">   </span><span class="o">|</span><span class="w">   </span><span class="mi">9</span><span class="w">    </span><span class="mi">10</span>
</pre></div>

<h2>Conclusions</h2>
<p>First, it's important to note that I'm operating under the assumption that you
have scripts located in the <code>&lt;head&gt;</code> of your document (as opposed to the end
of the <code>&lt;body&gt;</code>). There are various arguments regarding why you might link to
your scripts in the <code>&lt;head&gt;</code> versus the end of the document, but that's
outside the scope of this answer. This is strictly about whether <code>&lt;script&gt;</code>s
should go before <code>&lt;link&gt;</code>s in the <code>&lt;head&gt;</code>.</p>
<p><strong>In modern DESKTOP browsers,</strong> it looks like linking to CSS first <strong>never</strong>
provides a performance gain. Putting CSS after script gets you a trivial
amount of gain when both CSS and script are delayed, but gives you large gains
when CSS is delayed. (Shown by the <code>last</code> columns in the first set of
results.)</p>
<p>Given that linking to CSS last does not seem to hurt performance but <em>can</em>
provide gains under certain circumstances, <strong>you should link to external style
sheets <em>after</em> you link to external scripts <em>only on desktop browsers</em></strong> if
the performance of old browsers is not a concern. <strong>Read on for the mobile
situation.</strong></p>
<h2>Why?</h2>
<p>Historically, when a browser encountered a <code>&lt;script&gt;</code> tag pointing to an
external resource, the browser would <strong>stop</strong> parsing the HTML, retrieve the
script, execute it, then continue parsing the HTML. In contrast, if the
browser encountered a <code>&lt;link&gt;</code> for an external style sheet, it would
<em>continue</em> parsing the HTML while it fetched the CSS file (in parallel).</p>
<p>Hence, the widely-repeated advice to put style sheets first – they would
download first, and the first script to download could be loaded in parallel.</p>
<p>However, modern browsers (including all of the browsers I tested with above)
have implemented <em>speculative parsing</em> , where the browser "looks ahead" in
the HTML and begins downloading resources <em>before</em> scripts download and
execute.</p>
<p>In old browsers without speculative parsing, putting scripts first will affect
performance since they will not download in parallel.</p>
<h3>Browser Support</h3>
<p>Speculative parsing was first implemented in: (along with the percentage of
worldwide desktop browser users using this version or greater as of Jan 2012)</p>
<ul>
<li>Chrome 1 (WebKit 525) (100%)</li>
<li>Internet Explorer 8 (75%)</li>
<li>Firefox 3.5 (96%)</li>
<li>Safari 4 (99%)</li>
<li>Opera 11.60 (85%)</li>
</ul>
<p>In total, roughly 85% of desktop browsers in use today support speculative
loading. Putting scripts before CSS will have a performance penalty on 15% of
users <em>globally</em> ; your mileage may vary based on your site's specific
audience. (And remember that number is shrinking.)</p>
<p>On mobile browsers, it's a little harder to get definitive numbers simply due
to how heterogeneous the mobile browser and OS landscape is. Since speculative
rendering was implemented in WebKit 525 (released Mar 2008), and just about
every worthwhile mobile browser is based on WebKit, we can conclude that
"most" mobile browsers <em>should</em> support it. According to quirksmode, iOS
2.2/Android 1.0 use WebKit 525. I have no idea what Windows Phone looks like.</p>
<p><strong>However,</strong> I ran the test on my Android 4 device, and while I saw numbers
similar to the desktop results, I hooked it up to the fantastic new remote
debugger in Chrome for Android, and <em>Network</em> tab showed that the browser was
actually waiting to download the CSS until the JavaScript code completely
loaded – in other words, <strong>even the newest version of WebKit for Android does
not appear to support speculative parsing.</strong> I suspect it might be turned off
due to the CPU, memory, and/or network constraints inherent to mobile devices.</p>
<h2>Code</h2>
<p>Forgive the sloppiness – this was Q&amp;D.</p>
<h4>File <em>app.js</em>
</h4>
<div class="code"><pre class="code literal-block"><span class="nf">var</span><span class="w"> </span><span class="n">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)</span>
<span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">express</span><span class="p">.</span><span class="n">createServer</span><span class="p">()</span>
<span class="p">,</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>

<span class="n">app</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">90</span><span class="p">);</span>

<span class="nf">var</span><span class="w"> </span><span class="k">file</span><span class="o">=</span><span class="err">{}</span><span class="p">;</span>
<span class="n">fs</span><span class="p">.</span><span class="n">readdirSync</span><span class="p">(</span><span class="s1">'.'</span><span class="p">).</span><span class="n">forEach</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="w">    </span><span class="k">file</span><span class="o">[</span><span class="n">f</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="p">.</span><span class="n">readFileSync</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'jquery.js'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'style.css'</span><span class="p">)</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">'/'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">res</span><span class="p">.</span><span class="n">contentType</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="w">        </span><span class="n">res</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="k">file</span><span class="o">[</span><span class="n">f</span><span class="o">]</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span><span class="p">);</span>
<span class="err">}</span><span class="p">);</span>


<span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">'/jquery.js'</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">setTimeout</span><span class="p">(</span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">res</span><span class="p">.</span><span class="n">contentType</span><span class="p">(</span><span class="s1">'text/javascript'</span><span class="p">);</span>
<span class="w">        </span><span class="n">res</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="k">file</span><span class="o">[</span><span class="n">'jquery.js'</span><span class="o">]</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">);</span>
<span class="err">}</span><span class="p">);</span>

<span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">'/style.css'</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">setTimeout</span><span class="p">(</span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">res</span><span class="p">.</span><span class="n">contentType</span><span class="p">(</span><span class="s1">'text/css'</span><span class="p">);</span>
<span class="w">        </span><span class="n">res</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="k">file</span><span class="o">[</span><span class="n">'style.css'</span><span class="o">]</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">);</span>
<span class="err">}</span><span class="p">);</span>


<span class="nf">var</span><span class="w"> </span><span class="n">headresults</span><span class="o">=</span><span class="err">{</span>
<span class="w">    </span><span class="nl">css</span><span class="p">:</span><span class="w"> </span><span class="err">[]</span><span class="p">,</span>
<span class="w">    </span><span class="nl">js</span><span class="p">:</span><span class="w"> </span><span class="err">[]</span>
<span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="n">bodyresults</span><span class="o">=</span><span class="err">{</span>
<span class="w">    </span><span class="nl">css</span><span class="p">:</span><span class="w"> </span><span class="err">[]</span><span class="p">,</span>
<span class="w">    </span><span class="nl">js</span><span class="p">:</span><span class="w"> </span><span class="err">[]</span>
<span class="err">}</span>
<span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s1">'/result/:type/:time/:exec'</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">headresults</span><span class="o">[</span><span class="n">req.params.type</span><span class="o">]</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">parseInt</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="nc">time</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">));</span>
<span class="w">    </span><span class="n">bodyresults</span><span class="o">[</span><span class="n">req.params.type</span><span class="o">]</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">parseInt</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="k">exec</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">));</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="k">end</span><span class="p">();</span>
<span class="err">}</span><span class="p">);</span>

<span class="n">app</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">'/result/:type'</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="n">res</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nf">var</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="p">;</span>
<span class="w">    </span><span class="n">headresults</span><span class="o">[</span><span class="n">req.params.type</span><span class="o">]</span><span class="p">.</span><span class="n">forEach</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">o</span><span class="o">+=</span><span class="s1">'\n'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span><span class="p">);</span>
<span class="w">    </span><span class="n">o</span><span class="o">+=</span><span class="s1">'\n'</span><span class="p">;</span>
<span class="w">    </span><span class="n">bodyresults</span><span class="o">[</span><span class="n">req.params.type</span><span class="o">]</span><span class="p">.</span><span class="n">forEach</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">o</span><span class="o">+=</span><span class="s1">'\n'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span><span class="p">);</span>
<span class="w">    </span><span class="n">res</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">o</span><span class="p">);</span>
<span class="err">}</span><span class="p">);</span>
</pre></div>

<h4>File <em>css.html</em>
</h4>
<div class="code"><pre class="code literal-block"><span class="o">&lt;!</span><span class="n">DOCTYPE</span><span class="w"> </span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">CSS</span><span class="w"> </span><span class="n">first</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="k">var</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">();</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">link</span><span class="w"> </span><span class="n">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span><span class="w"> </span><span class="n">href</span><span class="o">=</span><span class="s2">"style.css"</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">script</span><span class="w"> </span><span class="n">src</span><span class="o">=</span><span class="s2">"jquery.js"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">script</span><span class="w"> </span><span class="n">src</span><span class="o">=</span><span class="s2">"test.js"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="n">document</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">jsload</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">);</span><span class="n">bodyexec</span><span class="o">=</span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>

<h4>File <em>js.html</em>
</h4>
<div class="code"><pre class="code literal-block"><span class="o">&lt;!</span><span class="n">DOCTYPE</span><span class="w"> </span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">CSS</span><span class="w"> </span><span class="n">first</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="k">var</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">();</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">script</span><span class="w"> </span><span class="n">src</span><span class="o">=</span><span class="s2">"jquery.js"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">script</span><span class="w"> </span><span class="n">src</span><span class="o">=</span><span class="s2">"test.js"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">link</span><span class="w"> </span><span class="n">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span><span class="w"> </span><span class="n">href</span><span class="o">=</span><span class="s2">"style.css"</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<span class="w">        </span><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="n">document</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">jsload</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">);</span><span class="n">bodyexec</span><span class="o">=</span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>

<h4>File <em>test.js</em>
</h4>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">jsload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">();</span>


<span class="o">$</span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">$.</span><span class="n">post</span><span class="p">(</span><span class="s1">'/result'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">location</span><span class="o">.</span><span class="n">pathname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.html'</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'/'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">jsload</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'/'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">bodyexec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<p>jQuery was jquery-1.7.1.min.js</p>
<p><br></p>
<h3>Suggest</h3>
<p>There are two main reasons to put CSS before JavaScript.</p>
<ol>
<li>
<p>Old browsers (Internet Explorer 6-7, Firefox 2, etc.) would block all subsequent downloads when they started downloading a script. So if you have <code>a.js</code> followed by <code>b.css</code> they get downloaded sequentially: first a then b. If you have <code>b.css</code> followed by <code>a.js</code> they get downloaded in parallel so the page loads more quickly.</p>
</li>
<li>
<p>Nothing is rendered until all stylesheets are downloaded - this is true in all browsers. Scripts are different - they block rendering of all DOM elements that are <em>below the script tag</em> in the page. If you put your scripts in the HEAD then it means the entire page is blocked from rendering until all stylesheets and all scripts are downloaded. While it makes sense to block all rendering for stylesheets (so you get the correct styling the first time and avoid the flash of unstyled content FOUC), it doesn't make sense to block rendering of the entire page for scripts. Often scripts don't affect any DOM elements or just a portion of DOM elements. <strong>It's best to load scripts as low in the page as possible, or even better load them asynchronously.</strong></p>
</li>
</ol>
<p>It's fun to create examples with Cuzillion. For example, this page has a
script in the HEAD so the entire page is blank until it's done downloading.
However, if we move the script to the end of the BODY block the page header
renders since those DOM elements occur above the SCRIPT tag, as you can see on
this page.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-is-it-bad-style-to-rescue-exception-e-in-ruby/" class="u-url">Why is it bad style to `rescue Exception =&gt; e` in Ruby?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-is-it-bad-style-to-rescue-exception-e-in-ruby/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T08:22:58+08:00" itemprop="datePublished" title="2023-02-17 08:22">2023-02-17 08:22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Ryan Davis’s Ruby QuickRef says (without explanation):</p>
<blockquote>
<p>Don’t rescue Exception. EVER. or I will stab you.</p>
</blockquote>
<p>Why not? What’s the right thing to do?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>TL;DR</strong> : Use <code>StandardError</code> instead for general exception catching. When
the original exception is re-raised (e.g. when rescuing to log the exception
only), rescuing <code>Exception</code> is probably okay.</p>
<hr>
<p><code>Exception</code> is the root of Ruby's exception hierarchy, so when you <code>rescue
Exception</code> you rescue from <em>everything</em> , including subclasses such as
<code>SyntaxError</code>, <code>LoadError</code>, and <code>Interrupt</code>.</p>
<p>Rescuing <code>Interrupt</code> prevents the user from using <code>CTRL``C</code> to exit the
program.</p>
<p>Rescuing <code>SignalException</code> prevents the program from responding correctly to
signals. It will be unkillable except by <code>kill -9</code>.</p>
<p>Rescuing <code>SyntaxError</code> means that <code>eval</code>s that fail will do so silently.</p>
<p>All of these can be shown by running this program, and trying to <code>CTRL``C</code> or
<code>kill</code> it:</p>
<div class="code"><pre class="code literal-block"><span class="k">loop</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nv">begin</span>
<span class="w">    </span><span class="nv">sleep</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nv">eval</span><span class="w"> </span><span class="s2">"djsakru3924r9eiuorwju3498 += 5u84fior8u8t4ruyf8ihiure"</span>
<span class="w">  </span><span class="nv">rescue</span><span class="w"> </span><span class="nv">Exception</span>
<span class="w">    </span><span class="nv">puts</span><span class="w"> </span><span class="s2">"I refuse to fail or be stopped!"</span>
<span class="w">  </span><span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Rescuing from <code>Exception</code> isn't even the default. Doing</p>
<div class="code"><pre class="code literal-block"><span class="nv">begin</span>
<span class="w">  </span>#<span class="w"> </span><span class="nv">iceberg</span><span class="o">!</span>
<span class="nv">rescue</span>
<span class="w">  </span>#<span class="w"> </span><span class="nv">lifeboats</span>
<span class="k">end</span>
</pre></div>

<p>does not rescue from <code>Exception</code>, it rescues from <code>StandardError</code>. You should
generally specify something more specific than the default <code>StandardError</code>,
but rescuing from <code>Exception</code> <em>broadens</em> the scope rather than narrowing it,
and can have catastrophic results and make bug-hunting extremely difficult.</p>
<hr>
<p>If you have a situation where you do want to rescue from <code>StandardError</code> and
you need a variable with the exception, you can use this form:</p>
<div class="code"><pre class="code literal-block"><span class="nv">begin</span>
<span class="w">  </span>#<span class="w"> </span><span class="nv">iceberg</span><span class="o">!</span>
<span class="nv">rescue</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">e</span>
<span class="w">  </span>#<span class="w"> </span><span class="nv">lifeboats</span>
<span class="k">end</span>
</pre></div>

<p>which is equivalent to:</p>
<div class="code"><pre class="code literal-block"><span class="nv">begin</span>
<span class="w">  </span>#<span class="w"> </span><span class="nv">iceberg</span><span class="o">!</span>
<span class="nv">rescue</span><span class="w"> </span><span class="nv">StandardError</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">e</span>
<span class="w">  </span>#<span class="w"> </span><span class="nv">lifeboats</span>
<span class="k">end</span>
</pre></div>

<hr>
<p>One of the few common cases where it’s sane to rescue from <code>Exception</code> is for
logging/reporting purposes, in which case you should immediately re-raise the
exception:</p>
<div class="code"><pre class="code literal-block"><span class="nv">begin</span>
<span class="w">  </span>#<span class="w"> </span><span class="nv">iceberg</span>?
<span class="nv">rescue</span><span class="w"> </span><span class="nv">Exception</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">e</span>
<span class="w">  </span>#<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">some</span><span class="w"> </span><span class="nv">logging</span>
<span class="w">  </span><span class="nv">raise</span><span class="w"> </span>#<span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">enough</span><span class="w"> </span><span class="nv">lifeboats</span><span class="w"> </span><span class="c1">;)</span>
<span class="k">end</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>The <em>real</em> rule is: Don't throw away exceptions. The objectivity of the author
of your quote is questionable, as evidenced by the fact that it ends with</p>
<blockquote>
<p>or I will stab you</p>
</blockquote>
<p>Of course, be aware that signals (by default) throw exceptions, and normally
long-running processes are terminated through a signal, so catching Exception
and not terminating on signal exceptions will make your program very hard to
stop. So don't do this:</p>
<div class="code"><table class="codetable">
<tr>
<td class="linenos linenodiv"><a href="posts/why-is-it-bad-style-to-rescue-exception-e-in-ruby/#-1"><code data-line-number=" 1"></code></a></td>
<td class="code"><code><span class="ch">#! /usr/bin/ruby</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-is-it-bad-style-to-rescue-exception-e-in-ruby/#-2"><code data-line-number=" 2"></code></a></td>
<td class="code"><code>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-is-it-bad-style-to-rescue-exception-e-in-ruby/#-3"><code data-line-number=" 3"></code></a></td>
<td class="code"><code><span class="k">while</span><span class="w"> </span><span class="kp">true</span><span class="w"> </span><span class="k">do</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-is-it-bad-style-to-rescue-exception-e-in-ruby/#-4"><code data-line-number=" 4"></code></a></td>
<td class="code"><code><span class="w">  </span><span class="k">begin</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-is-it-bad-style-to-rescue-exception-e-in-ruby/#-5"><code data-line-number=" 5"></code></a></td>
<td class="code"><code><span class="w">    </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">STDIN</span><span class="o">.</span><span class="n">gets</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-is-it-bad-style-to-rescue-exception-e-in-ruby/#-6"><code data-line-number=" 6"></code></a></td>
<td class="code"><code><span class="w">    </span><span class="c1"># heavy processing</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-is-it-bad-style-to-rescue-exception-e-in-ruby/#-7"><code data-line-number=" 7"></code></a></td>
<td class="code"><code><span class="w">  </span><span class="k">rescue</span><span class="w"> </span><span class="no">Exception</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-is-it-bad-style-to-rescue-exception-e-in-ruby/#-8"><code data-line-number=" 8"></code></a></td>
<td class="code"><code><span class="w">    </span><span class="nb">puts</span><span class="w"> </span><span class="s2">"caught exception </span><span class="si">#{</span><span class="n">e</span><span class="si">}</span><span class="s2">! ohnoes!"</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-is-it-bad-style-to-rescue-exception-e-in-ruby/#-9"><code data-line-number=" 9"></code></a></td>
<td class="code"><code><span class="w">  </span><span class="k">end</span>
</code></td>
</tr>
<tr>
<td class="linenos linenodiv"><a href="posts/why-is-it-bad-style-to-rescue-exception-e-in-ruby/#-10"><code data-line-number="10"></code></a></td>
<td class="code"><code><span class="k">end</span>
</code></td>
</tr>
</table></div>
<p>No, really, don't do it. Don't even run that to see if it works.</p>
<p>However, say you have a threaded server and you want all exceptions to not:</p>
<ol>
<li>be ignored (the default)</li>
<li>stop the server (which happens if you say <code>thread.abort_on_exception = true</code>). </li>
</ol>
<p>Then this is perfectly acceptable in your connection handling thread:</p>
<div class="code"><pre class="code literal-block"><span class="nv">begin</span>
<span class="w">  </span>#<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">stuff</span>
<span class="nv">rescue</span><span class="w"> </span><span class="nv">Exception</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">e</span>
<span class="w">  </span><span class="nv">myLogger</span>.<span class="nv">error</span><span class="ss">(</span><span class="s2">"uncaught #{e} exception while handling connection: #{e.message}"</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">myLogger</span>.<span class="nv">error</span><span class="ss">(</span><span class="s2">"Stack trace: #{backtrace.map {|l| "</span><span class="w">  </span>#{<span class="nv">l</span>}\<span class="nv">n</span><span class="s2">"}.join}"</span><span class="ss">)</span>
<span class="k">end</span>
</pre></div>

<p>The above works out to a variation of Ruby's default exception handler, with
the advantage that it doesn't also kill your program. Rails does this in its
request handler.</p>
<p>Signal exceptions are raised in the main thread. Background threads won't get
them, so there is no point in trying to catch them there.</p>
<p>This is particularly useful in a production environment, where you do <em>not</em>
want your program to simply stop whenever something goes wrong. Then you can
take the stack dumps in your logs and add to your code to deal with specific
exception further down the call chain and in a more graceful manner.</p>
<p>Note also that there is another Ruby idiom which has much the same effect:</p>
<div class="code"><pre class="code literal-block"><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">do_something</span><span class="w"> </span><span class="nv">rescue</span><span class="w"> </span><span class="s2">"something else"</span>
</pre></div>

<p>In this line, if <code>do_something</code> raises an exception, it is caught by Ruby,
thrown away, and <code>a</code> is assigned <code>"something else"</code>.</p>
<p>Generally, don't do that, except in special cases where you <em>know</em> you don't
need to worry. One example:</p>
<div class="code"><pre class="code literal-block">debugger rescue nil
</pre></div>

<p>The <code>debugger</code> function is a rather nice way to set a breakpoint in your code,
but if running outside a debugger, and Rails, it raises an exception. Now
theoretically you shouldn't be leaving debug code lying around in your program
(pff! nobody does that!) but you might want to keep it there for a while for
some reason, but not continually run your debugger.</p>
<p>Note:</p>
<ol>
<li>
<p>If you've run someone else's program that catches signal exceptions and ignores them, (say the code above) then:</p>
<ul>
<li>in Linux, in a shell, type <code>pgrep ruby</code>, or <code>ps | grep ruby</code>, look for your offending program's PID, and then run <code>kill -9 &lt;PID&gt;</code>. </li>
<li>in Windows, use the Task Manager (<code>CTRL</code>-<code>SHIFT</code>-<code>ESC</code>), go to the "processes" tab, find your process, right click it and select "End process".</li>
<li>
<p>If you are working with someone else's program which is, for whatever reason, peppered with these ignore-exception blocks, then putting this at the top of the mainline is one possible cop-out:</p>
<p>%W/INT QUIT TERM/.each { |sig| trap sig,"SYSTEM_DEFAULT" }</p>
</li>
</ul>
</li>
</ol>
<p>This causes the program to respond to the normal termination signals by
immediately terminating, bypassing exception handlers, <em>with no cleanup</em>. So
it could cause data loss or similar. Be careful!</p>
<ol>
<li>If you need to do this:<div class="code"><pre class="code literal-block">begin
</pre></div>

<p>do_something
rescue Exception =&gt; e
  critical_cleanup
  raise
end</p>
</li>
</ol>
<p>you can actually do this:</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="nv">begin</span>
<span class="w">  </span><span class="nv">do_something</span>
<span class="nv">ensure</span>
<span class="w">  </span><span class="nv">critical_cleanup</span>
<span class="k">end</span>
</pre></div>

<p>In the second case, <code>critical cleanup</code> will be called every time, whether or
not an exception is thrown.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-force-my-net-application-to-run-as-administrator/" class="u-url">How do I force my .NET application to run as administrator?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-force-my-net-application-to-run-as-administrator/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T08:22:32+08:00" itemprop="datePublished" title="2023-02-17 08:22">2023-02-17 08:22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Once my program is installed on a client machine, how do I force my program to
run as an administrator on <strong>Windows 7?</strong></p>
<p><br><br></p>
<h2>Answer</h2>
<p>You'll want to modify the manifest that gets embedded in the program. This
works on Visual Studio 2008 and higher: Project + Add New Item, select
"Application Manifest File". Change the <code>&lt;requestedExecutionLevel&gt;</code> element
to:</p>
<div class="code"><pre class="code literal-block"> &lt;requestedExecutionLevel level="requireAdministrator" uiAccess="false" /&gt;
</pre></div>

<p>The user gets the UAC prompt when they start the program. Use wisely; their
patience can wear out quickly.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Adding a <code>requestedExecutionLevel</code> element to your manifest is only half the
battle; you have to remember that UAC can be turned off. If it is, you have to
perform the check the old school way and put up an error dialog if the user is
not administrator<br>
(call <code>IsInRole(WindowsBuiltInRole.Administrator)</code> on your thread's
<code>CurrentPrincipal</code>).</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-499.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-497.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
