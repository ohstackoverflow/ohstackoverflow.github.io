<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 996) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-996.html">
<link rel="prev" href="index-997.html" type="text/html">
<link rel="next" href="index-995.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-change-to-an-older-version-of-node-js/" class="u-url">How to change to an older version of Node.js</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-change-to-an-older-version-of-node-js/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T22:00:15+08:00" itemprop="datePublished" title="2023-02-17 22:00">2023-02-17 22:00</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am running Node.js version <code>v0.5.9-pre</code> on Ubuntu 10.10.</p>
<p>I would like to be using version <code>v0.5.0-pre</code>.</p>
<p>How do I roll back to the older version of node?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>One way is to use NVM, the Node Version Manager.</p>
<p>Use following command to get nvm</p>
<div class="code"><pre class="code literal-block">curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.34.0/install.sh | bash
</pre></div>

<p>You can find it at https://github.com/creationix/nvm</p>
<p>It allows you to easily install and manage multiple versions of node. Here's a
snippet from the help:</p>
<div class="code"><pre class="code literal-block"><span class="n">Usage</span><span class="p">:</span>
<span class="n">nvm</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="w">       </span><span class="n">Download</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span>
<span class="n">nvm</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="w">           </span><span class="n">Modify</span><span class="w"> </span><span class="n">PATH</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span>
<span class="n">nvm</span><span class="w"> </span><span class="n">ls</span><span class="w">                      </span><span class="n">List</span><span class="w"> </span><span class="n">versions</span><span class="w"> </span><span class="p">(</span><span class="n">installed</span><span class="w"> </span><span class="n">versions</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">blue</span><span class="p">)</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>One way is to use NVM, the Node Version Manager.</p>
<p>Use following command to get nvm</p>
<div class="code"><pre class="code literal-block">curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.34.0/install.sh | bash
</pre></div>

<p>You can find it at https://github.com/creationix/nvm</p>
<p>It allows you to easily install and manage multiple versions of node. Here's a
snippet from the help:</p>
<div class="code"><pre class="code literal-block"><span class="n">Usage</span><span class="p">:</span>
<span class="n">nvm</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="w">       </span><span class="n">Download</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span>
<span class="n">nvm</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="w">           </span><span class="n">Modify</span><span class="w"> </span><span class="n">PATH</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span>
<span class="n">nvm</span><span class="w"> </span><span class="n">ls</span><span class="w">                      </span><span class="n">List</span><span class="w"> </span><span class="n">versions</span><span class="w"> </span><span class="p">(</span><span class="n">installed</span><span class="w"> </span><span class="n">versions</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">blue</span><span class="p">)</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-download-a-file-with-node-js-without-using-third-party-libraries/" class="u-url">How to download a file with Node.js (without using third-party libraries)?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-download-a-file-with-node-js-without-using-third-party-libraries/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T21:59:34+08:00" itemprop="datePublished" title="2023-02-17 21:59">2023-02-17 21:59</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I download a file with Node.js <strong>without using third-party libraries</strong>?</p>
<p>I don't need anything special. I only want to download a file from a given
URL, and then save it to a given directory.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can create an HTTP <code>GET</code> request and pipe its <code>response</code> into a writable
file stream:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">'https'</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="w"> </span><span class="n">URLs</span>
<span class="k">const</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>

<span class="k">const</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">createWriteStream</span><span class="p">(</span><span class="s2">"file.jpg"</span><span class="p">);</span>
<span class="k">const</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">http</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"http://i3.ytimg.com/vi/J---aiyznGQ/mqdefault.jpg"</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">response</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>

<span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">completed</span><span class="w"> </span><span class="n">close</span><span class="w"> </span><span class="n">filestream</span>
<span class="w">   </span><span class="n">file</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s2">"finish"</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">       </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"Download Completed"</span><span class="p">);</span>
<span class="w">   </span><span class="p">});</span>
<span class="p">});</span>
</pre></div>

<p>If you want to support gathering information on the command line--like
specifying a target file or directory, or URL--check out something like
Commander.</p>
<p>More detailed explanation in https://sebhastian.com/nodejs-download-file/</p>
<p><br></p>
<h3>Suggest</h3>
<p>Don't forget to handle errors! The following code is based on Augusto Roman's
answer.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>

<span class="k">var</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="n">cb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span><span class="o">.</span><span class="n">createWriteStream</span><span class="p">(</span><span class="n">dest</span><span class="p">);</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">http</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">response</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="w">    </span><span class="n">file</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">'finish'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">cb</span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">close</span><span class="p">()</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">async</span><span class="p">,</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">cb</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">close</span><span class="w"> </span><span class="n">completes</span><span class="o">.</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">  </span><span class="p">})</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Handle</span><span class="w"> </span><span class="n">errors</span>
<span class="w">    </span><span class="n">fs</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">dest</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Delete</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">async</span><span class="o">.</span><span class="w"> </span><span class="p">(</span><span class="n">But</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">don</span><span class="s1">'t check the result)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cb</span><span class="p">)</span><span class="w"> </span><span class="n">cb</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">message</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">};</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-explicit-promise-construction-antipattern-and-how-do-i-avoid-it/" class="u-url">What is the explicit promise construction antipattern and how do I avoid it?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-explicit-promise-construction-antipattern-and-how-do-i-avoid-it/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T21:59:00+08:00" itemprop="datePublished" title="2023-02-17 21:59">2023-02-17 21:59</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I was writing code that does something that looks like:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">getStuffDone</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">getStuffDone</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Q</span><span class="o">.</span><span class="n">defer</span><span class="p">();</span><span class="w"> </span><span class="o">/*</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="o">$</span><span class="n">q</span><span class="o">.</span><span class="n">defer</span><span class="w"> </span><span class="o">*/</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Promise</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">resolve</span><span class="p">,</span><span class="w"> </span><span class="n">reject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="o">$.</span><span class="n">Deferred</span><span class="p">()</span><span class="w"> </span><span class="n">etc</span><span class="o">.</span><span class="w">        </span><span class="o">|</span><span class="w">     </span><span class="o">//</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">promise</span><span class="w"> </span><span class="n">constructor</span>
<span class="w">    </span><span class="n">myPromiseFn</span><span class="p">(</span><span class="n">param</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w">                 </span><span class="o">|</span><span class="w">         </span><span class="n">myPromiseFn</span><span class="p">(</span><span class="n">param</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">/*</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="o">.</span><span class="n">done</span><span class="w"> </span><span class="o">*/</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">d</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">val</span><span class="p">);</span><span class="w">                  </span><span class="o">|</span><span class="w">             </span><span class="n">resolve</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
<span class="w">    </span><span class="p">})</span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">/*</span><span class="w"> </span><span class="o">.</span><span class="n">fail</span><span class="w"> </span><span class="o">*/</span><span class="w"> </span><span class="o">|</span><span class="w">         </span><span class="p">})</span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">d</span><span class="o">.</span><span class="n">reject</span><span class="p">(</span><span class="n">err</span><span class="p">);</span><span class="w">                   </span><span class="o">|</span><span class="w">             </span><span class="n">reject</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span><span class="w">                                  </span><span class="o">|</span><span class="w">         </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">d</span><span class="o">.</span><span class="n">promise</span><span class="p">;</span><span class="w"> </span><span class="o">/*</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">promise</span><span class="p">()</span><span class="w"> </span><span class="o">*/</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="p">});</span>
<span class="p">}</span><span class="w">                                        </span><span class="o">|</span><span class="w"> </span><span class="p">}</span>
</pre></div>

<p>Someone told me this is called the " <strong>deferred antipattern</strong> " or the "
<strong><code>Promise</code> constructor antipattern</strong>" respectively, what's bad about this
code and why is this called an antipattern?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The deferred antipattern (now explicit-construction anti-pattern) coined by
Esailija is a common anti-pattern people who are new to promises make, I've
made it myself when I first used promises. The problem with the above code is
that is fails to utilize the fact that promises chain.</p>
<p>Promises can chain with <code>.then</code> and you can return promises directly. Your
code in <code>getStuffDone</code> can be rewritten as:</p>
<div class="code"><pre class="code literal-block"><span class="nv">function</span><span class="w"> </span><span class="nv">getStuffDone</span><span class="ss">(</span><span class="nv">param</span><span class="ss">)</span>{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">myPromiseFn</span><span class="ss">(</span><span class="nv">param</span><span class="o">+</span><span class="mi">1</span><span class="ss">)</span><span class="c1">; // much nicer, right?</span>
}
</pre></div>

<p>Promises are all about making asynchronous code more readable and behave like
synchronous code without hiding that fact. Promises represent an abstraction
over a value of one time operation, they abstract the notion of a statement or
expression in a programming language.</p>
<p>You should only use deferred objects when you are converting an API to
promises and can't do it automatically, or when you're writing aggregation
functions that are easier expressed this way.</p>
<p>Quoting Esailija:</p>
<blockquote>
<p>This is the most common anti-pattern. It is easy to fall into this when you
don't really understand promises and think of them as glorified event
emitters or callback utility. Let's recap: promises are about making
asynchronous code retain most of the lost properties of synchronous code
such as flat indentation and one exception channel.</p>
</blockquote>
<p><br></p>
<h3>Suggest</h3>
<h2>What's wrong with it?</h2>
<blockquote>
<p>But the pattern works!</p>
</blockquote>
<p>Lucky you. Unfortunately, it probably doesn't, as you likely forgot some edge
case. In more than half of the occurrences I've seen, the author has forgotten
to take care of the error handler:</p>
<div class="code"><pre class="code literal-block"><span class="k">return</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Promise</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nv">resolve</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">getOtherPromise</span><span class="ss">()</span>.<span class="k">then</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nb">result</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">resolve</span><span class="ss">(</span><span class="nb">result</span>.<span class="nv">property</span>.<span class="nv">example</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}<span class="ss">)</span><span class="c1">;</span>
}<span class="ss">)</span>
</pre></div>

<p>If the other promise is rejected, this will happen unnoticed instead of being
propagated to the new promise (where it would get handled) - and the new
promise stays forever pending, which can induce leaks.</p>
<p>The same thing happens in the case that your callback code causes an error -
e.g. when <code>result</code> doesn't have a <code>property</code> and an exception is thrown. That
would go unhandled and leave the new promise unresolved.</p>
<p>In contrast, using <code>.then()</code> does automatically take care of both these
scenarios, and rejects the new promise when an error happens:</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">getOtherPromise</span><span class="ss">()</span>.<span class="k">then</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nb">result</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">     </span><span class="k">return</span><span class="w"> </span><span class="nb">result</span>.<span class="nv">property</span>.<span class="nv">example</span><span class="c1">;</span>
<span class="w"> </span>}<span class="ss">)</span>
</pre></div>

<p>The deferred antipattern is not only cumbersome, but also <strong>error-prone</strong>.
Using <code>.then()</code> for chaining is much safer.</p>
<blockquote>
<p>But I've handled everything!</p>
</blockquote>
<p>Really? Good. However, this will be pretty detailed and copious, especially if
you use a promise library that supports other features like cancellation or
message passing. Or maybe it will in the future, or you want to swap your
library against a better one? You won't want to rewrite your code for that.</p>
<p>The libraries' methods (<code>then</code>) do not only natively support all the features,
they also might have certain optimisations in place. Using them will likely
make your code faster, or at least allow to be optimised by future revisions
of the library.</p>
<h2>How do I avoid it?</h2>
<p>So whenever you find yourself manually creating a <code>Promise</code> or <code>Deferred</code> and
already existing promises are involved, <strong>check the library API first</strong>. The
Deferred antipattern is often applied by people who see promises [only] as an
observer pattern - but promises are <em>more</em> than callbacks: they are supposed
to be composable. Every decent library has lots of easy-to-use functions for
the composition of promises in every thinkable manner, taking care of all the
low-level stuff you don't want to deal with.</p>
<p>If you have found a need to compose some promises in a new way that is not
supported by an existing helper function, writing your own function with
unavoidable Deferreds should be your last option. Consider switching to a more
featureful library, and/or file a bug against your current library. Its
maintainer should be able to derive the composition from existing functions,
implement a new helper function for you and/or help to identify the edge cases
that need to be handled.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-997.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-995.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
