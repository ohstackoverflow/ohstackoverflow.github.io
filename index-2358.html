<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2358) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2358.html">
<link rel="prev" href="index-2359.html" type="text/html">
<link rel="next" href="index-2357.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/named-tuple-and-default-values-for-optional-keyword-arguments/" class="u-url">Named tuple and default values for optional keyword arguments</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/named-tuple-and-default-values-for-optional-keyword-arguments/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T10:13:00+08:00" itemprop="datePublished" title="2023-03-04 10:13">2023-03-04 10:13</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to convert a longish hollow "data" class into a named tuple. My
class currently looks like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Node</span>(<span class="n">object</span>):
    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, <span class="nb">val</span>, <span class="n">left</span>=<span class="n">None</span>, <span class="nb">right</span>=<span class="n">None</span>):
        <span class="nb">self</span>.<span class="nb">val</span> = <span class="nb">val</span>
        <span class="nb">self</span>.<span class="n">left</span> = <span class="n">left</span>
        <span class="nb">self</span>.<span class="nb">right</span> = <span class="nb">right</span>
</pre></div>

<p>After conversion to <code>namedtuple</code> it looks like:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="n">Node</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Node'</span><span class="p">,</span> <span class="s1">'val left right'</span><span class="p">)</span>
</pre></div>

<p>But there is a problem here. My original class allowed me to pass in just a
value and took care of the default by using default values for the
named/keyword arguments. Something like:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">BinaryTree</span>(<span class="n">object</span>):
    <span class="n">def</span> <span class="n">__init__</span>(<span class="nb">self</span>, <span class="nb">val</span>):
        <span class="nb">self</span>.<span class="n">root</span> = <span class="n">Node</span>(<span class="nb">val</span>)
</pre></div>

<p>But this doesn't work in the case of my refactored named tuple since it
expects me to pass all the fields. I can of course replace the occurrences of
<code>Node(val)</code> to <code>Node(val, None, None)</code> but it isn't to my liking.</p>
<p>So does there exist a good trick which can make my re-write successful without
adding a lot of code complexity (metaprogramming) or should I just swallow the
pill and go ahead with the "search and replace"? :)</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>Python 3.7</h3>
<p>Use the <em>defaults</em> parameter.</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'val'</span><span class="p">,</span> <span class="s1">'left'</span><span class="p">,</span> <span class="s1">'right'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Node</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Node'</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Node</span><span class="p">()</span>
<span class="n">Node</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

<p>Or better yet, use the new dataclasses library, which is much nicer than
namedtuple.</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nd">@dataclass</span>
<span class="o">...</span> <span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">val</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
<span class="o">...</span>     <span class="n">left</span><span class="p">:</span> <span class="s1">'Node'</span> <span class="o">=</span> <span class="kc">None</span>
<span class="o">...</span>     <span class="n">right</span><span class="p">:</span> <span class="s1">'Node'</span> <span class="o">=</span> <span class="kc">None</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Node</span><span class="p">()</span>
<span class="n">Node</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

<h3>Before Python 3.7</h3>
<p>Set <code>Node.__new__.__defaults__</code> to the default values.</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Node</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Node'</span><span class="p">,</span> <span class="s1">'val left right'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Node</span><span class="o">.</span><span class="fm">__new__</span><span class="o">.</span><span class="vm">__defaults__</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">_fields</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Node</span><span class="p">()</span>
<span class="n">Node</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

<h3>Before Python 2.6</h3>
<p>Set <code>Node.__new__.func_defaults</code> to the default values.</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Node</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Node'</span><span class="p">,</span> <span class="s1">'val left right'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Node</span><span class="o">.</span><span class="fm">__new__</span><span class="o">.</span><span class="n">func_defaults</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Node</span><span class="o">.</span><span class="n">_fields</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Node</span><span class="p">()</span>
<span class="n">Node</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

<h3>Order</h3>
<p>In all versions of Python, if you set fewer default values than exist in the
namedtuple, the defaults are applied to the rightmost parameters. This allows
you to keep some arguments as required arguments.</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; Node.__new__.__defaults__ = (1,2)
&gt;&gt;&gt; Node()
Traceback (most recent call last):
  ...
TypeError: __new__() missing 1 required positional argument: 'val'
&gt;&gt;&gt; Node(3)
Node(val=3, left=1, right=2)
</pre></div>

<h3>Wrapper for Python 2.6 to 3.6</h3>
<p>Here's a wrapper for you, which even lets you (optionally) set the default
values to something other than <code>None</code>. This does not support required
arguments.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">collections</span>
<span class="k">def</span> <span class="nf">namedtuple_with_defaults</span><span class="p">(</span><span class="n">typename</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="n">default_values</span><span class="o">=</span><span class="p">()):</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="n">typename</span><span class="p">,</span> <span class="n">field_names</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="fm">__new__</span><span class="o">.</span><span class="vm">__defaults__</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">_fields</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default_values</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
        <span class="n">prototype</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="o">**</span><span class="n">default_values</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prototype</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="o">*</span><span class="n">default_values</span><span class="p">)</span>
    <span class="n">T</span><span class="o">.</span><span class="fm">__new__</span><span class="o">.</span><span class="vm">__defaults__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prototype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">T</span>
</pre></div>

<p>Example:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; Node = namedtuple_with_defaults('Node', 'val left right')
&gt;&gt;&gt; Node()
Node(val=None, left=None, right=None)
&gt;&gt;&gt; Node = namedtuple_with_defaults('Node', 'val left right', [1, 2, 3])
&gt;&gt;&gt; Node()
Node(val=1, left=2, right=3)
&gt;&gt;&gt; Node = namedtuple_with_defaults('Node', 'val left right', {'right':7})
&gt;&gt;&gt; Node()
Node(val=None, left=None, right=7)
&gt;&gt;&gt; Node(4)
Node(val=4, left=None, right=7)
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I subclassed namedtuple and overrode the <code>__new__</code> method:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Node'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'value'</span><span class="p">,</span> <span class="s1">'left'</span><span class="p">,</span> <span class="s1">'right'</span><span class="p">])):</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
</pre></div>

<p>This preserves an intuitive type hierarchy, which the creation of a factory
function disguised as a class does not.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/calculate-age-given-the-birth-date-in-the-format-yyyymmdd/" class="u-url">Calculate age given the birth date in the format YYYYMMDD</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/calculate-age-given-the-birth-date-in-the-format-yyyymmdd/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T10:11:11+08:00" itemprop="datePublished" title="2023-03-04 10:11">2023-03-04 10:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How can I calculate an age in years, given a birth date of format YYYYMMDD? Is
it possible using the <code>Date()</code> function?</p>
<p>I am looking for a better solution than the one I am using now:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">dob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'19800810'</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Number</span><span class="p">(</span><span class="n">dob</span><span class="o">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">));</span>
<span class="k">var</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Number</span><span class="p">(</span><span class="n">dob</span><span class="o">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Number</span><span class="p">(</span><span class="n">dob</span><span class="o">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<span class="k">var</span><span class="w"> </span><span class="n">today</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">();</span>
<span class="k">var</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">today</span><span class="o">.</span><span class="n">getFullYear</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">year</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">getMonth</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">getMonth</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">today</span><span class="o">.</span><span class="n">getDate</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">day</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">age</span><span class="o">--</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">alert</span><span class="p">(</span><span class="n">age</span><span class="p">);</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p><strong>I would go for readability:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">_calculateAge</span><span class="p">(</span><span class="n">birthday</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">birthday</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">date</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">ageDifMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">birthday</span><span class="o">.</span><span class="n">getTime</span><span class="p">();</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">ageDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="n">ageDifMs</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">miliseconds</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">epoch</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ageDate</span><span class="o">.</span><span class="n">getUTCFullYear</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1970</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><strong>Disclaimer:</strong> This also has precision issues, so this cannot be completely
trusted either. It can be off by a few hours, on some years, or during
daylight saving (depending on timezone).</p>
<p>Instead I would recommend using a library for this, if precision is very
important. Also <code>@Naveens post</code>, is probably the most accurate, as it doesn't
rely on the time of day.</p>
<hr>
<p><br></p>
<h3>Suggest</h3>
<p><strong>I would go for readability:</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">_calculateAge</span><span class="p">(</span><span class="n">birthday</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">birthday</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">date</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">ageDifMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">birthday</span><span class="o">.</span><span class="n">getTime</span><span class="p">();</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">ageDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="n">ageDifMs</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">miliseconds</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">epoch</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Math</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ageDate</span><span class="o">.</span><span class="n">getUTCFullYear</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1970</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><strong>Disclaimer:</strong> This also has precision issues, so this cannot be completely
trusted either. It can be off by a few hours, on some years, or during
daylight saving (depending on timezone).</p>
<p>Instead I would recommend using a library for this, if precision is very
important. Also <code>@Naveens post</code>, is probably the most accurate, as it doesn't
rely on the time of day.</p>
<hr>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/fileprovider-illegalargumentexception-failed-to-find-configured-root/" class="u-url">FileProvider - IllegalArgumentException: Failed to find configured root</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/fileprovider-illegalargumentexception-failed-to-find-configured-root/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T10:09:55+08:00" itemprop="datePublished" title="2023-03-04 10:09">2023-03-04 10:09</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm trying to take a picture with camera, but I'm getting the following error:</p>
<div class="code"><pre class="code literal-block">FATAL EXCEPTION: main
Process: com.example.marek.myapplication, PID: 6747
java.lang.IllegalArgumentException: Failed to find configured root that contains /storage/emulated/0/Android/data/com.example.marek.myapplication/files/Pictures/JPEG_20170228_175633_470124220.jpg
    at android.support.v4.content.FileProvider$SimplePathStrategy.getUriForFile(FileProvider.java:711)
    at android.support.v4.content.FileProvider.getUriForFile(FileProvider.java:400)
    at com.example.marek.myapplication.MainActivity.dispatchTakePictureIntent(MainActivity.java:56)
    at com.example.marek.myapplication.MainActivity.access$100(MainActivity.java:22)
    at com.example.marek.myapplication.MainActivity$1.onClick(MainActivity.java:35)
</pre></div>

<p>AndroidManifest.xml:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;provider</span>
<span class="w">        </span><span class="na">android:name=</span><span class="s">"android.support.v4.content.FileProvider"</span>
<span class="w">        </span><span class="na">android:authorities=</span><span class="s">"com.example.marek.myapplication.fileprovider"</span>
<span class="w">        </span><span class="na">android:enabled=</span><span class="s">"true"</span>
<span class="w">        </span><span class="na">android:grantUriPermissions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;meta-data</span>
<span class="w">            </span><span class="na">android:name=</span><span class="s">"android.support.FILE_PROVIDER_PATHS"</span>
<span class="w">            </span><span class="na">android:resource=</span><span class="s">"@xml/file_paths"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/provider&gt;</span>
</pre></div>

<p>Java:</p>
<div class="code"><pre class="code literal-block"><span class="n">Intent</span><span class="w"> </span><span class="n">takePictureIntent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">MediaStore</span><span class="p">.</span><span class="n">ACTION_IMAGE_CAPTURE</span><span class="p">);</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Ensure</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">there</span><span class="err">'</span><span class="n">s</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">camera</span><span class="w"> </span><span class="n">activity</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">intent</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">takePictureIntent</span><span class="p">.</span><span class="n">resolveActivity</span><span class="p">(</span><span class="n">getPackageManager</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">Create</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">File</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">photo</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="k">go</span>
<span class="w">        </span><span class="k">File</span><span class="w"> </span><span class="n">photoFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">photoFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createImageFile</span><span class="p">();</span>
<span class="w">        </span><span class="err">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">Toast</span><span class="p">.</span><span class="n">makeText</span><span class="p">(</span><span class="n">getApplicationContext</span><span class="p">(),</span><span class="w"> </span><span class="ss">"Error while saving picture."</span><span class="p">,</span><span class="w"> </span><span class="n">Toast</span><span class="p">.</span><span class="n">LENGTH_LONG</span><span class="p">).</span><span class="n">show</span><span class="p">();</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">Continue</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">File</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">successfully</span><span class="w"> </span><span class="n">created</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">photoFile</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">Uri</span><span class="w"> </span><span class="n">photoURI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FileProvider</span><span class="p">.</span><span class="n">getUriForFile</span><span class="p">(</span><span class="n">this</span><span class="p">,</span>
<span class="w">                    </span><span class="ss">"com.example.marek.myapplication.fileprovider"</span><span class="p">,</span>
<span class="w">                    </span><span class="n">photoFile</span><span class="p">);</span>
<span class="w">            </span><span class="n">takePictureIntent</span><span class="p">.</span><span class="n">putExtra</span><span class="p">(</span><span class="n">MediaStore</span><span class="p">.</span><span class="n">EXTRA_OUTPUT</span><span class="p">,</span><span class="w"> </span><span class="n">photoURI</span><span class="p">);</span>
<span class="w">            </span><span class="n">startActivityForResult</span><span class="p">(</span><span class="n">takePictureIntent</span><span class="p">,</span><span class="w"> </span><span class="n">REQUEST_TAKE_PHOTO</span><span class="p">);</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
</pre></div>

<p>file_paths.xml</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;paths&gt;</span>
<span class="w">    </span><span class="nt">&lt;files-path</span><span class="w"> </span><span class="na">name=</span><span class="s">"my_images"</span><span class="w"> </span><span class="na">path=</span><span class="s">"images/"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/paths&gt;</span>
</pre></div>

<p>I was searching whole day about this error and trying to understand
<code>FileProvider</code>, but I have no idea what this error message tries to tell me.
If you want more info/code, write me in the comment.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Your file is stored under <code>getExternalFilesDir()</code>. That maps to <code>&lt;external-
files-path&gt;</code>, not <code>&lt;files-path&gt;</code>. Also, your file path does not contain
<code>images/</code> in it, so the <code>path</code> attribute in your XML is invalid.</p>
<p>Replace <code>res/xml/file_paths.xml</code> with:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;paths&gt;</span>
<span class="w">    </span><span class="nt">&lt;external-files-path</span><span class="w"> </span><span class="na">name=</span><span class="s">"my_images"</span><span class="w"> </span><span class="na">path=</span><span class="s">"/"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/paths&gt;</span>
</pre></div>

<hr>
<p><strong>UPDATE 2020 MAR 13</strong></p>
<p>Provider path for a specific path as followings:</p>
<ul>
<li>
<code>&lt;files-path/&gt;</code> --&gt; <code>Context.getFilesDir()</code>
</li>
<li>
<code>&lt;cache-path/&gt;</code> --&gt; <code>Context.getCacheDir()</code>
</li>
<li>
<code>&lt;external-path/&gt;</code> --&gt; <code>Environment.getExternalStorageDirectory()</code>
</li>
<li>
<code>&lt;external-files-path/&gt;</code> --&gt; <code>Context.getExternalFilesDir(String)</code>
</li>
<li>
<code>&lt;external-cache-path/&gt;</code> --&gt; <code>Context.getExternalCacheDir()</code>
</li>
<li>
<code>&lt;external-media-path/&gt;</code> --&gt; <code>Context.getExternalMediaDirs()</code>
</li>
</ul>
<p>Ref:
https://developer.android.com/reference/androidx/core/content/FileProvider</p>
<p><br></p>
<h3>Suggest</h3>
<p>This may resolve everyones problem: All tags are added so you don't need to
worry about folders path. Replace res/xml/file_paths.xml with:</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;paths&gt;</span>
<span class="w">  </span><span class="nt">&lt;external-path</span>
<span class="w">    </span><span class="na">name=</span><span class="s">"external"</span>
<span class="w">    </span><span class="na">path=</span><span class="s">"."</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;external-files-path</span>
<span class="w">    </span><span class="na">name=</span><span class="s">"external_files"</span>
<span class="w">    </span><span class="na">path=</span><span class="s">"."</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;cache-path</span>
<span class="w">    </span><span class="na">name=</span><span class="s">"cache"</span>
<span class="w">    </span><span class="na">path=</span><span class="s">"."</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;external-cache-path</span>
<span class="w">    </span><span class="na">name=</span><span class="s">"external_cache"</span>
<span class="w">    </span><span class="na">path=</span><span class="s">"."</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;files-path</span>
<span class="w">    </span><span class="na">name=</span><span class="s">"files"</span>
<span class="w">    </span><span class="na">path=</span><span class="s">"."</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/paths&gt;</span>
</pre></div>

<p><strong>EDIT: 1st June 2021</strong></p>
<p>We should use only specific path which we need. Try alternate path on your own
and use which you needed.</p>
<p><strong>See Accepted answer for more information</strong> :
https://stackoverflow.com/a/42516202/4498813</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2359.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2357.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
