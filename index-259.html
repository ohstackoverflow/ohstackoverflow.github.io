<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 259) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-259.html">
<link rel="prev" href="index-260.html" type="text/html">
<link rel="next" href="index-258.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/python-zhong-de-kong-dui-xiang/" class="u-url">Python 中的空对象</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/python-zhong-de-kong-dui-xiang/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T02:24:12+08:00" itemprop="datePublished" title="2023-02-17 02:24">2023-02-17 02:24</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我如何在 Python 中引用空对象？</p>
<p><br><br></p>
<h2>解答</h2>
<p>在 Python 中，“null”对象是 singleton <code>None</code>。</p>
<p>要检查某物是否为<code>None</code>，请使用<code>is</code>身份运算符：</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="nv">foo</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">None</span>:
<span class="w">    </span>...
</pre></div>

<p><br></p>
<h3>更多建议</h3>
<h2>
<code>None</code>, Python 的 null？</h2>
<p><code>null</code>Python 中没有；相反有<code>None</code>.
如前所述，测试某物是否已<code>None</code>作为值给出的最准确方法是使用<code>is</code>恒等运算符，它测试两个变量是否引用同一对象。</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; foo is None
True
&gt;&gt;&gt; foo = 'bar'
&gt;&gt;&gt; foo is None
False
</pre></div>

<h2>基础</h2>
<h3>存在且只能是一个<code>None</code>
</h3>
<p><code>None</code>是该类的唯一实例<code>NoneType</code>，任何对该类进行实例化的进一步尝试都将返回相同的对象，这就构成了<code>None</code>一个单例。Python
新手经常会看到提到<code>NoneType</code>并想知道它是什么的错误消息。我个人认为这些消息可以简单地提及<code>None</code>名称，因为正如我们很快就会看到的那样，<code>None</code>几乎没有歧义的余地。因此，如果您看到一些<code>TypeError</code>消息提到<code>NoneType</code>不能这样做或不能那样做，只需知道它只是以<code>None</code>无法做到的方式使用的那个。</p>
<p>此外，<code>None</code>是一个内置常量。一旦启动
Python，就可以从任何地方使用它，无论是在模块、类还是函数中。相比之下不是，您需要先通过查询其类来<code>NoneType</code>获取对它的引用。<code>None</code></p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; NoneType
NameError: name 'NoneType' is not defined
&gt;&gt;&gt; type(None)
NoneType
</pre></div>

<p>您可以<code>None</code>使用 Python 的身份函数检查其唯一性<code>id()</code>。它返回分配给对象的唯一编号，每个对象都有一个。如果两个变量的 id
相同，那么它们实际上指向同一个对象。</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; NoneType = type(None)
&gt;&gt;&gt; id(None)
10748000
&gt;&gt;&gt; my_none = NoneType()
&gt;&gt;&gt; id(my_none)
10748000
&gt;&gt;&gt; another_none = NoneType()
&gt;&gt;&gt; id(another_none)
10748000
&gt;&gt;&gt; def function_that_does_nothing(): pass
&gt;&gt;&gt; return_value = function_that_does_nothing()
&gt;&gt;&gt; id(return_value)
10748000
</pre></div>

<h3>
<code>None</code>不能被覆盖</h3>
<p>在更旧的 Python 版本（2.4 之前）中，可以重新分配<code>None</code>，但现在不行了。甚至不作为类属性或在函数范围内。</p>
<div class="code"><pre class="code literal-block"><span class="p">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">Python</span><span class="w"> </span><span class="mf">2.7</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">SomeClass</span><span class="p">(</span><span class="n">object</span><span class="p">)</span><span class="o">:</span>
<span class="p">...</span><span class="w">     </span><span class="n">def</span><span class="w"> </span><span class="n">my_fnc</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
<span class="p">...</span><span class="w">             </span><span class="n">self</span><span class="p">.</span><span class="n">None</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">'</span><span class="n">foo</span><span class="p">'</span>
<span class="nl">SyntaxError:</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="k">assign</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">None</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">def</span><span class="w"> </span><span class="n">my_fnc</span><span class="p">()</span><span class="o">:</span>
<span class="w">        </span><span class="n">None</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">'</span><span class="n">foo</span><span class="p">'</span>
<span class="nl">SyntaxError:</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="k">assign</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">None</span>

<span class="p">#</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">Python</span><span class="w"> </span><span class="mf">3.5</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="nl">SomeClass:</span>
<span class="p">...</span><span class="w">     </span><span class="n">def</span><span class="w"> </span><span class="n">my_fnc</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="o">:</span>
<span class="p">...</span><span class="w">             </span><span class="n">self</span><span class="p">.</span><span class="n">None</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">'</span><span class="n">foo</span><span class="p">'</span>
<span class="nl">SyntaxError:</span><span class="w"> </span><span class="n">invalid</span><span class="w"> </span><span class="n">syntax</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">def</span><span class="w"> </span><span class="n">my_fnc</span><span class="p">()</span><span class="o">:</span>
<span class="w">        </span><span class="n">None</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">'</span><span class="n">foo</span><span class="p">'</span>
<span class="nl">SyntaxError:</span><span class="w"> </span><span class="n">cannot</span><span class="w"> </span><span class="k">assign</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">keyword</span>
</pre></div>

<p>因此可以安全地假设所有<code>None</code>引用都是相同的。没有任何“习俗” <code>None</code>。</p>
<h3>测试<code>None</code>使用<code>is</code>运算符</h3>
<p>在编写代码时，您可能会想像这样测试 <em>Noneness ：</em></p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="nv">value</span><span class="o">==</span><span class="nv">None</span>:
<span class="w">    </span><span class="nv">pass</span>
</pre></div>

<p>或者像这样测试谎言</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">value</span>:
<span class="w">    </span><span class="nv">pass</span>
</pre></div>

<p>您需要了解其中的含义以及为什么明确说明通常是个好主意。</p>
<h4>案例 1：测试一个值是否为<code>None</code>
</h4>
<p>为什么</p>
<div class="code"><pre class="code literal-block">value is None
</pre></div>

<p>而不是</p>
<div class="code"><pre class="code literal-block">value==None
</pre></div>

<p>？</p>
<p>第一个相当于：</p>
<div class="code"><pre class="code literal-block">id(value)==id(None)
</pre></div>

<p>而表达式<code>value==None</code>实际上是这样应用的</p>
<div class="code"><pre class="code literal-block">value.__eq__(None)
</pre></div>

<p>如果这个值真的是<code>None</code>那么你会得到你所期望的。</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; nothing = function_that_does_nothing()
&gt;&gt;&gt; nothing.__eq__(None)
True
</pre></div>

<p>在大多数常见情况下，结果将是相同的，但该<code>__eq__()</code>方法打开了一扇门，使任何准确性保证无效，因为它可以在类中被覆盖以提供特殊行为。</p>
<p>考虑这个类。</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">Empty</span><span class="ss">(</span><span class="nv">object</span><span class="ss">)</span>:
...<span class="w">     </span><span class="nv">def</span><span class="w"> </span><span class="nv">__eq__</span><span class="ss">(</span><span class="nv">self</span>,<span class="w"> </span><span class="nv">other</span><span class="ss">)</span>:
...<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">other</span>
</pre></div>

<p>所以你试穿它<code>None</code>，它起作用了</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; empty = Empty()
&gt;&gt;&gt; empty==None
True
</pre></div>

<p>但它也适用于空字符串</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; empty==''
True
</pre></div>

<p>但是</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; ''==None
False
&gt;&gt;&gt; empty is None
False
</pre></div>

<h4>案例 2：用作<code>None</code>布尔值</h4>
<p>下面两个测试</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="nv">value</span>:
<span class="w">    </span>#<span class="w"> </span><span class="k">Do</span><span class="w"> </span><span class="nv">something</span>

<span class="k">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">value</span>:
<span class="w">    </span>#<span class="w"> </span><span class="k">Do</span><span class="w"> </span><span class="nv">something</span>
</pre></div>

<p>实际上被评估为</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="nv">bool</span><span class="ss">(</span><span class="nv">value</span><span class="ss">)</span>:
<span class="w">    </span>#<span class="w"> </span><span class="k">Do</span><span class="w"> </span><span class="nv">something</span>

<span class="k">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">bool</span><span class="ss">(</span><span class="nv">value</span><span class="ss">)</span>:
<span class="w">    </span>#<span class="w"> </span><span class="k">Do</span><span class="w"> </span><span class="nv">something</span>
</pre></div>

<p><code>None</code> is a "falsey", meaning that if cast to a boolean it will return <code>False</code>
and if applied the <code>not</code> operator it will return <code>True</code>. Note however that
it's not a property unique to <code>None</code>. In addition to <code>False</code> itself, the
property is shared by empty lists, tuples, sets, dicts, strings, as well as 0,
and all objects from classes that implement the <code>__bool__()</code> magic method to
return <code>False</code>.</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">bool</span><span class="ss">(</span><span class="nv">None</span><span class="ss">)</span>
<span class="nv">False</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">None</span>
<span class="nv">True</span>

<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">bool</span><span class="ss">(</span>[]<span class="ss">)</span>
<span class="nv">False</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span>[]
<span class="nv">True</span>

<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">MyFalsey</span><span class="ss">(</span><span class="nv">object</span><span class="ss">)</span>:
...<span class="w">     </span><span class="nv">def</span><span class="w"> </span><span class="nv">__bool__</span><span class="ss">(</span><span class="nv">self</span><span class="ss">)</span>:
...<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="nv">False</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MyFalsey</span><span class="ss">()</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">bool</span><span class="ss">(</span><span class="nv">f</span><span class="ss">)</span>
<span class="nv">False</span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">f</span>
<span class="nv">True</span>
</pre></div>

<p>So when testing for variables in the following way, be extra aware of what
you're including or excluding from the test:</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">some_function</span><span class="ss">(</span><span class="nv">value</span><span class="o">=</span><span class="nv">None</span><span class="ss">)</span>:
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">value</span>:
<span class="w">        </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">init_value</span><span class="ss">()</span>
</pre></div>

<p>In the above, did you mean to call <code>init_value()</code> when the value is set
specifically to <code>None</code>, or did you mean that a value set to <code>0</code>, or the empty
string, or an empty list should also trigger the initialization? Like I said,
be mindful. As it's often the case, in Python <em>explicit is better than
implicit</em>.</p>
<h2>
<code>None</code> in practice</h2>
<h3>
<code>None</code> used as a signal value</h3>
<p><code>None</code> has a special status in Python. It's a favorite baseline value because
many algorithms treat it as an exceptional value. In such scenarios it can be
used as a flag to signal that a condition requires some special handling (such
as the setting of a default value).</p>
<p>You can assign <code>None</code> to the keyword arguments of a function and then
explicitly test for it.</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">my_function</span><span class="ss">(</span><span class="nv">value</span>,<span class="w"> </span><span class="nv">param</span><span class="o">=</span><span class="nv">None</span><span class="ss">)</span>:
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">param</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">None</span>:
<span class="w">        </span>#<span class="w"> </span><span class="k">Do</span><span class="w"> </span><span class="nv">something</span><span class="w"> </span><span class="nv">outrageous</span><span class="o">!</span>
</pre></div>

<p>You can return it as the default when trying to get to an object's attribute
and then explicitly test for it before doing something special.</p>
<div class="code"><pre class="code literal-block"><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">getattr</span><span class="ss">(</span><span class="nv">some_obj</span>,<span class="w"> </span><span class="s1">'some_attribute'</span>,<span class="w"> </span><span class="nv">None</span><span class="ss">)</span>
<span class="k">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">None</span>:
<span class="w">    </span>#<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">something</span><span class="w"> </span><span class="nv">spectacular</span><span class="o">!</span>
</pre></div>

<p>By default a dictionary's <code>get()</code> method returns <code>None</code> when trying to access
a non-existing key:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; some_dict = {}
&gt;&gt;&gt; value = some_dict.get('foo')
&gt;&gt;&gt; value is None
True
</pre></div>

<p>If you were to try to access it by using the subscript notation a <code>KeyError</code>
would be raised</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; value = some_dict['foo']
KeyError: 'foo'
</pre></div>

<p>Likewise if you attempt to pop a non-existing item</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; value = some_dict.pop('foo')
KeyError: 'foo'
</pre></div>

<p>which you can suppress with a default value that is usually set to <code>None</code></p>
<div class="code"><pre class="code literal-block"><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">some_dict</span>.<span class="nv">pop</span><span class="ss">(</span><span class="s1">'foo'</span>,<span class="w"> </span><span class="nv">None</span><span class="ss">)</span>
<span class="k">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">None</span>:
<span class="w">    </span>#<span class="w"> </span><span class="nv">Booom</span><span class="o">!</span>
</pre></div>

<h3>
<code>None</code> used as both a flag and valid value</h3>
<p>The above described uses of <code>None</code> apply when it is not considered a valid
value, but more like a signal to do something special. There are situations
however where it sometimes matters to know where <code>None</code> came from because even
though it's used as a signal it could also be part of the data.</p>
<p>When you query an object for its attribute with <code>getattr(some_obj,
'attribute_name', None)</code> getting back <code>None</code> doesn't tell you if the attribute
you were trying to access was set to <code>None</code> or if it was altogether absent
from the object. The same situation when accessing a key from a dictionary,
like <code>some_dict.get('some_key')</code>, you don't know if <code>some_dict['some_key']</code> is
missing or if it's just set to <code>None</code>. If you need that information, the usual
way to handle this is to directly attempt accessing the attribute or key from
within a <code>try/except</code> construct:</p>
<div class="code"><pre class="code literal-block"><span class="n">try</span><span class="o">:</span>
<span class="w">    </span><span class="c1"># Equivalent to getattr() without specifying a default</span>
<span class="w">    </span><span class="c1"># value = getattr(some_obj, 'some_attribute')</span>
<span class="w">    </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some_obj</span><span class="p">.</span><span class="n">some_attribute</span>
<span class="w">    </span><span class="c1"># Now you handle `None` the data here</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="o">:</span>
<span class="w">        </span><span class="c1"># Do something here because the attribute was set to None</span>
<span class="k">except</span><span class="w"> </span><span class="n">AttributeError</span><span class="o">:</span>
<span class="w">    </span><span class="c1"># We're now handling the exceptional situation from here.</span>
<span class="w">    </span><span class="c1"># We could assign None as a default value if required.</span>
<span class="w">    </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span>
<span class="w">    </span><span class="c1"># In addition, since we now know that some_obj doesn't have the</span>
<span class="w">    </span><span class="c1"># attribute 'some_attribute' we could do something about that.</span>
<span class="w">    </span><span class="n">log_something</span><span class="p">(</span><span class="n">some_obj</span><span class="p">)</span>
</pre></div>

<p>Similarly with dict:</p>
<div class="code"><pre class="code literal-block"><span class="k">try</span><span class="o">:</span>
<span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some_dict</span><span class="o">[</span><span class="s1">'some_key'</span><span class="o">]</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">None</span><span class="o">:</span>
<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="s1">'some_key'</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="kd">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">None</span>
<span class="n">except</span><span class="w"> </span><span class="n">KeyError</span><span class="o">:</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">default</span>
<span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">And</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="s1">'some_key'</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">missing</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dict</span><span class="o">.</span>
<span class="w">    </span><span class="n">log_something</span><span class="o">(</span><span class="n">some_dict</span><span class="o">)</span>
</pre></div>

<p>The above two examples show how to handle object and dictionary cases. What
about functions? The same thing, but we use the double asterisks keyword
argument to that end:</p>
<div class="code"><pre class="code literal-block"><span class="n">def</span><span class="w"> </span><span class="n">my_function</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">:</span>
<span class="w">    </span><span class="nl">try:</span>
<span class="w">        </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kwargs</span><span class="p">['</span><span class="n">some_key</span><span class="p">']</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="nl">None:</span>
<span class="w">            </span><span class="p">#</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="p">'</span><span class="n">some_key</span><span class="p">'</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">explicitly</span>
<span class="w">            </span><span class="p">#</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">None</span>
<span class="w">    </span><span class="n">except</span><span class="w"> </span><span class="nl">KeyError:</span>
<span class="w">        </span><span class="p">#</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="k">assign</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span>
<span class="w">        </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span>
<span class="w">        </span><span class="p">#</span><span class="w"> </span><span class="n">And</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">it</span><span class="p">'</span><span class="n">s</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">coming</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">caller</span><span class="p">.</span>
<span class="w">        </span><span class="n">log_something</span><span class="p">('</span><span class="n">did</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">receive</span><span class="w"> </span><span class="s">"some_key"</span><span class="p">')</span>
</pre></div>

<h3>
<code>None</code> used only as a valid value</h3>
<p>If you find that your code is littered with the above <code>try/except</code> pattern
simply to differentiate between <code>None</code> flags and <code>None</code> data, then just use
another test value. There's a pattern where a value that falls outside the set
of valid values is inserted as part of the data in a data structure and is
used to control and test special conditions (e.g. boundaries, state, etc.).
Such a value is called a <em>sentinel</em> and it can be used the way <code>None</code> is used
as a signal. It's trivial to create a sentinel in Python.</p>
<div class="code"><pre class="code literal-block">undefined = object()
</pre></div>

<p>The <code>undefined</code> object above is unique and doesn't do much of anything that
might be of interest to a program, it's thus an excellent replacement for
<code>None</code> as a flag. Some caveats apply, more about that after the code.</p>
<p>With function</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">my_function</span><span class="ss">(</span><span class="nv">value</span>,<span class="w"> </span><span class="nb">param1</span><span class="o">=</span><span class="nv">undefined</span>,<span class="w"> </span><span class="nb">param2</span><span class="o">=</span><span class="nv">undefined</span><span class="ss">)</span>:
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">param1</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">undefined</span>:
<span class="w">        </span>#<span class="w"> </span><span class="nv">We</span><span class="w"> </span><span class="nv">know</span><span class="w"> </span><span class="nv">nothing</span><span class="w"> </span><span class="nv">was</span><span class="w"> </span><span class="nv">passed</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">it</span>,<span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">even</span><span class="w"> </span><span class="nv">None</span>
<span class="w">        </span><span class="nv">log_something</span><span class="ss">(</span><span class="s1">'param1 was missing'</span><span class="ss">)</span>
<span class="w">        </span><span class="nb">param1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span>


<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">param2</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">undefined</span>:
<span class="w">        </span>#<span class="w"> </span><span class="nv">We</span><span class="w"> </span><span class="nv">got</span><span class="w"> </span><span class="nv">nothing</span><span class="w"> </span><span class="nv">here</span><span class="w"> </span><span class="nv">either</span>
<span class="w">        </span><span class="nv">log_something</span><span class="ss">(</span><span class="s1">'param2 was missing'</span><span class="ss">)</span>
<span class="w">        </span><span class="nb">param2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span>
</pre></div>

<p>With dict</p>
<div class="code"><pre class="code literal-block"><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">some_dict</span>.<span class="nv">get</span><span class="ss">(</span><span class="s1">'some_key'</span>,<span class="w"> </span><span class="nv">undefined</span><span class="ss">)</span>
<span class="k">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">None</span>:
<span class="w">    </span><span class="nv">log_something</span><span class="ss">(</span><span class="s2">"'some_key' was set to None"</span><span class="ss">)</span>

<span class="k">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">undefined</span>:
<span class="w">    </span>#<span class="w"> </span><span class="nv">We</span><span class="w"> </span><span class="nv">know</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">dict</span><span class="w"> </span><span class="nv">didn</span><span class="s1">'t have '</span><span class="nv">some_key</span><span class="err">'</span>
<span class="w">    </span><span class="nv">log_something</span><span class="ss">(</span><span class="s2">"'some_key' was not set at all"</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span>
</pre></div>

<p>With an object</p>
<div class="code"><pre class="code literal-block"><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">getattr</span><span class="ss">(</span><span class="nv">obj</span>,<span class="w"> </span><span class="s1">'some_attribute'</span>,<span class="w"> </span><span class="nv">undefined</span><span class="ss">)</span>
<span class="k">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">None</span>:
<span class="w">    </span><span class="nv">log_something</span><span class="ss">(</span><span class="s2">"'obj.some_attribute' was set to None"</span><span class="ss">)</span>
<span class="k">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">undefined</span>:
<span class="w">    </span>#<span class="w"> </span><span class="nv">We</span><span class="w"> </span><span class="nv">know</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">there</span><span class="err">'s no obj.some_attribute</span>
<span class="w">    </span><span class="nv">log_something</span><span class="ss">(</span><span class="s2">"no 'some_attribute' set on obj"</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span>
</pre></div>

<p>As I mentioned earlier, custom sentinels come with some caveats. First,
they're not keywords like <code>None</code>, so Python doesn't protect them. You can
overwrite your <code>undefined</code> above at any time, anywhere in the module it's
defined, so be careful how you expose and use them. Next, the instance
returned by <code>object()</code> is not a singleton. If you make that call 10 times you
get 10 different objects. Finally, usage of a sentinel is highly
idiosyncratic. A sentinel is specific to the library it's used in and as such
its scope should generally be limited to the library's internals. It shouldn't
"leak" out. External code should only become aware of it, if their purpose is
to extend or supplement the library's API.</p>
<p><br><br><a href="posts/null-object-in-python/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/zai-net-zhong-fa-song-http-post-qing-qiu/" class="u-url">在 .NET 中发送 HTTP POST 请求</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/zai-net-zhong-fa-song-http-post-qing-qiu/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T02:23:47+08:00" itemprop="datePublished" title="2023-02-17 02:23">2023-02-17 02:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>如何发出 HTTP POST请求并在正文中发送数据？</p>
<p><br><br></p>
<h2>解答</h2>
<p>有几种方法可以执行 HTTP GET和POST请求：</p>
<hr>
<h3>方法 A：HttpClient（首选）</h3>
<p>适用于：.NET Framework 4.5+、.NET Standard 1.1+ 和 .NET Core 1.0+。</p>
<p>它是目前首选的方法，并且是异步的和高性能的。在大多数情况下使用内置版本，但对于非常旧的平台，有一个NuGet 包。</p>
<div class="code"><pre class="code literal-block">using System.Net.Http;
</pre></div>

<h4>设置</h4>
<p>建议<code>HttpClient</code>在您的应用程序的生命周期内实例化一个并共享它，除非您有特定的理由不这样做。</p>
<div class="code"><pre class="code literal-block">private static readonly HttpClient client = new HttpClient();
</pre></div>

<p>请<code>HttpClientFactory</code>参阅依赖项注入解决方案。</p>
<hr>
<ul>
<li>
<p>邮政</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;</span>
</pre></div>

<p>{
      { "thing1", "hello" },
      { "thing2", "world" }
  };</p>
<p>var content = new FormUrlEncodedContent(values);</p>
<p>var response = await client.PostAsync("http://www.example.com/recepticle.aspx", content);</p>
<p>var responseString = await response.Content.ReadAsStringAsync();</p>
</li>
<li>
<p>得到</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">responseString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">GetStringAsync</span><span class="p">(</span><span class="s2">"http://www.example.com/recepticle.aspx"</span><span class="p">);</span>
</pre></div>

</li>
</ul>
<hr>
<h3>方法 B：第三方库</h3>
<p><em><strong>安息</strong></em></p>
<ul>
<li>邮政<div class="code"><pre class="code literal-block"><span class="w">   </span><span class="k">var</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RestClient</span><span class="p">(</span><span class="s2">"http://example.com"</span><span class="p">);</span>
</pre></div>

<p>// client.Authenticator = new HttpBasicAuthenticator(username, password);
   var request = new RestRequest("resource/{id}");
   request.AddParameter("thing1", "Hello");
   request.AddParameter("thing2", "world");
   request.AddHeader("header", "value");
   request.AddFile("file", path);
   var response = client.Post(request);
   var content = response.Content; // Raw content as string
   var response2 = client.Post<person>(request);
   var name = response2.Data.Name;</person></p>
</li>
</ul>
<p><em><strong>Flurl.HTTP</strong></em></p>
<p>它是一个较新的库，具有流畅的 API、测试助手、在后台使用 HttpClient，并且是可移植的。它可以通过NuGet获得。</p>
<div class="code"><pre class="code literal-block">    using Flurl.Http;
</pre></div>

<hr>
<ul>
<li>
<p>邮政</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">responseString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="s2">"http://www.example.com/recepticle.aspx"</span>
<span class="w">  </span><span class="o">.</span><span class="n">PostUrlEncodedAsync</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">thing1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hello"</span><span class="p">,</span><span class="w"> </span><span class="n">thing2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"world"</span><span class="w"> </span><span class="p">})</span>
<span class="w">  </span><span class="o">.</span><span class="n">ReceiveString</span><span class="p">();</span>
</pre></div>

</li>
<li>
<p><code>GET</code></p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">responseString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="s2">"http://www.example.com/recepticle.aspx"</span>
<span class="w">  </span><span class="o">.</span><span class="n">GetStringAsync</span><span class="p">();</span>
</pre></div>

</li>
</ul>
<hr>
<h3>方法C：HttpWebRequest（新作不推荐）</h3>
<p>适用于：.NET Framework 1.1+、.NET Standard 2.0+、.NET Core 1.0+。在 .NET Core
中，它主要是为了兼容性——它包装<code>HttpClient</code>，性能较低，并且不会获得新功能。</p>
<div class="code"><pre class="code literal-block"><span class="nv">using</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Net</span><span class="c1">;</span>
<span class="nv">using</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Text</span><span class="c1">;  // For class Encoding</span>
<span class="nv">using</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">IO</span><span class="c1">;    // For StreamReader</span>
</pre></div>

<hr>
<ul>
<li>
<p>邮政</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">HttpWebRequest</span><span class="p">)</span><span class="n">WebRequest</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="s2">"http://www.example.com/recepticle.aspx"</span><span class="p">);</span>
</pre></div>

<p>var postData = "thing1=" + Uri.EscapeDataString("hello");
      postData += "&amp;thing2=" + Uri.EscapeDataString("world");
  var data = Encoding.ASCII.GetBytes(postData);</p>
<p>request.Method = "POST";
  request.ContentType = "application/x-www-form-urlencoded";
  request.ContentLength = data.Length;</p>
<p>using (var stream = request.GetRequestStream())
  {
      stream.Write(data, 0, data.Length);
  }</p>
<p>var response = (HttpWebResponse)request.GetResponse();</p>
<p>var responseString = new StreamReader(response.GetResponseStream()).ReadToEnd();</p>
</li>
<li>
<p>得到</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">HttpWebRequest</span><span class="p">)</span><span class="n">WebRequest</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="s2">"http://www.example.com/recepticle.aspx"</span><span class="p">);</span>
</pre></div>

<p>var response = (HttpWebResponse)request.GetResponse();</p>
<p>var responseString = new StreamReader(response.GetResponseStream()).ReadToEnd();</p>
</li>
</ul>
<hr>
<h3>方法D：WebClient（不推荐用于新工作）</h3>
<p>这是一个包装器<code>HttpWebRequest</code>。比较<code>HttpClient</code>。</p>
<p>适用于：.NET Framework 1.1+、NET Standard 2.0+ 和 .NET Core 2.0+。</p>
<p>在某些情况下（.NET Framework 4.5-4.8），如果您需要同步进行 HTTP 请求，<code>WebClient</code>仍然可以使用。</p>
<div class="code"><pre class="code literal-block">using System.Net;
using System.Collections.Specialized;
</pre></div>

<hr>
<ul>
<li>
<p>邮政</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="n">using</span><span class="w"> </span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">WebClient</span><span class="p">())</span>
</pre></div>

<p>{
      var values = new NameValueCollection();
      values["thing1"] = "hello";
      values["thing2"] = "world";</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">UploadValues</span><span class="p">(</span><span class="s2">"http://www.example.com/recepticle.aspx"</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="p">);</span>

<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">responseString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Encoding</span><span class="o">.</span><span class="n">Default</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
</pre></div>

<p>}</p>
</li>
<li>
<p>得到</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="n">using</span><span class="w"> </span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">WebClient</span><span class="p">())</span>
</pre></div>

<p>{
      var responseString = client.DownloadString("http://www.example.com/recepticle.aspx");
  }</p>
</li>
</ul>
<p><br></p>
<h3>更多建议</h3>
<p>简单的 GET 请求</p>
<div class="code"><pre class="code literal-block"><span class="n">using</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Net</span><span class="p">;</span>

<span class="o">...</span>

<span class="n">using</span><span class="w"> </span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">wb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">WebClient</span><span class="p">())</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wb</span><span class="o">.</span><span class="n">DownloadString</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>简单的 POST 请求</p>
<div class="code"><pre class="code literal-block"><span class="n">using</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Net</span><span class="p">;</span>
<span class="n">using</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Collections</span><span class="o">.</span><span class="n">Specialized</span><span class="p">;</span>

<span class="o">...</span>

<span class="n">using</span><span class="w"> </span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">wb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">WebClient</span><span class="p">())</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">NameValueCollection</span><span class="p">();</span>
<span class="w">    </span><span class="n">data</span><span class="p">[</span><span class="s2">"username"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myUser"</span><span class="p">;</span>
<span class="w">    </span><span class="n">data</span><span class="p">[</span><span class="s2">"password"</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"myPassword"</span><span class="p">;</span>

<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wb</span><span class="o">.</span><span class="n">UploadValues</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="s2">"POST"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">responseInString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Encoding</span><span class="o">.</span><span class="n">UTF8</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><br><br><a href="posts/send-http-post-request-in-net/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ru-he-zai-java-zhong-jiang-shu-zi-si-she-wu-ru-dao-n-wei-xiao-shu/" class="u-url">如何在 Java 中将数字四舍五入到 n 位小数</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ru-he-zai-java-zhong-jiang-shu-zi-si-she-wu-ru-dao-n-wei-xiao-shu/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T02:23:22+08:00" itemprop="datePublished" title="2023-02-17 02:23">2023-02-17 02:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我想要的是一种将 double 转换为字符串的方法，该字符串使用 half-up 方法四舍五入 - 即，如果要四舍五入的小数是
5，它总是四舍五入到下一个数字。在大多数情况下，这是大多数人期望的标准四舍五入方法。</p>
<p>我也希望只显示有效数字——即不应该有任何尾随零。</p>
<p>我知道这样做的一种方法是使用<code>String.format</code>方法：</p>
<div class="code"><pre class="code literal-block">String.format("%.5g%n", 0.912385);
</pre></div>

<p>回报：</p>
<div class="code"><pre class="code literal-block"><span class="mf">0.91239</span>
</pre></div>

<p>这很好，但是它总是显示小数点后 5 位的数字，即使它们并不重要：</p>
<div class="code"><pre class="code literal-block">String.format("%.5g%n", 0.912300);
</pre></div>

<p>回报：</p>
<div class="code"><pre class="code literal-block"><span class="mf">0.91230</span>
</pre></div>

<p>另一种方法是使用<code>DecimalFormatter</code>：</p>
<div class="code"><pre class="code literal-block">DecimalFormat df = new DecimalFormat("#.#####");
df.format(0.912385);
</pre></div>

<p>回报：</p>
<div class="code"><pre class="code literal-block"><span class="mf">0.91238</span>
</pre></div>

<p>但是，正如您所见，这使用了半偶数舍入。也就是说，如果前一位是偶数，它将向下舍入。我想要的是：</p>
<div class="code"><pre class="code literal-block"><span class="mf">0.912385</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mf">0.91239</span>
<span class="mf">0.912300</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mf">0.9123</span>
</pre></div>

<p>在 Java 中实现此目的的最佳方法是什么？</p>
<p><br><br></p>
<h2>解答</h2>
<p>使用<code>setRoundingMode</code>，明确设置<code>RoundingMode</code>以处理半偶数回合的问题，然后使用格式模式来获得所需的输出。</p>
<p>例子：</p>
<div class="code"><pre class="code literal-block"><span class="nv">DecimalFormat</span><span class="w"> </span><span class="nv">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">DecimalFormat</span><span class="ss">(</span><span class="s2">"#.####"</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">df</span>.<span class="nv">setRoundingMode</span><span class="ss">(</span><span class="nv">RoundingMode</span>.<span class="nv">CEILING</span><span class="ss">)</span><span class="c1">;</span>
<span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">Number</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span>:<span class="w"> </span><span class="nv">Arrays</span>.<span class="nv">asList</span><span class="ss">(</span><span class="mi">12</span>,<span class="w"> </span><span class="mi">123</span>.<span class="mi">12345</span>,<span class="w"> </span><span class="mi">0</span>.<span class="mi">23</span>,<span class="w"> </span><span class="mi">0</span>.<span class="mi">1</span>,<span class="w"> </span><span class="mi">2341234</span>.<span class="mi">212431324</span><span class="ss">))</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">Double</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">n</span>.<span class="nv">doubleValue</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">System</span>.<span class="nv">out</span>.<span class="nv">println</span><span class="ss">(</span><span class="nv">df</span>.<span class="nv">format</span><span class="ss">(</span><span class="nv">d</span><span class="ss">))</span><span class="c1">;</span>
}
</pre></div>

<p>给出输出：</p>
<div class="code"><pre class="code literal-block"><span class="mf">12</span>
<span class="mf">123.1235</span>
<span class="mf">0.23</span>
<span class="mf">0.1</span>
<span class="mf">2341234.2125</span>
</pre></div>

<hr>
<p><strong>编辑</strong> ：原始答案没有解决 double
值的准确性。如果您不太关心向上或向下舍入，那很好。但是，如果您想要精确舍入，则需要考虑值的预期精度。浮点值在内部具有二进制表示。这意味着像 2.7735
这样的值在内部实际上并没有那个确切的值。它可以稍大或稍小。如果内部值稍小，则不会四舍五入到
2.7740。要补救这种情况，您需要了解您正在使用的值的准确性，并在四舍五入之前添加或减去该值。例如，当您知道您的值最多精确到 6
位数字时，然后要向上舍入中间值，将该精度添加到该值：</p>
<div class="code"><pre class="code literal-block">Double d = n.doubleValue() + 1e-6;
</pre></div>

<p>要向下舍入，请减去准确度。</p>
<p><br></p>
<h3>更多建议</h3>
<p>假设<code>value</code>是一个<code>double</code>，你可以这样做：</p>
<div class="code"><pre class="code literal-block">(double)Math.round(value * 100000d) / 100000d
</pre></div>

<p>这是 5 位数的精度。零的个数表示小数位数。</p>
<p><br><br><a href="posts/how-to-round-a-number-to-n-decimal-places-in-java/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-260.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-258.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
