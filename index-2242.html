<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2242) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2242.html">
<link rel="prev" href="index-2243.html" type="text/html">
<link rel="next" href="index-2241.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/add-placeholder-text-inside-uitextview-in-swift/" class="u-url">Add placeholder text inside UITextView in Swift?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/add-placeholder-text-inside-uitextview-in-swift/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T01:36:27+08:00" itemprop="datePublished" title="2023-03-04 01:36">2023-03-04 01:36</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How can I add a placeholder in a <code>UITextView</code>, similar to the one you can set
for <code>UITextField</code>, in <code>Swift</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>Updated for Swift 4</strong></p>
<p><code>UITextView</code> doesn't inherently have a placeholder property so you'd have to
create and manipulate one programmatically using <code>UITextViewDelegate</code> methods.
I recommend using either solution #1 or #2 below depending on the desired
behavior.</p>
<p><strong>Note: For either solution, add<code>UITextViewDelegate</code> to the class and set
<code>textView.delegate = self</code> to use the text view’s delegate methods.</strong></p>
<hr>
<p><strong><em>Solution #1</em></strong> <em>- If you want the placeholder to disappear as soon as the
user selects the text view:</em></p>
<p>First set the <code>UITextView</code> to contain the placeholder text and set it to a
light gray color to mimic the look of a <code>UITextField</code>'s placeholder text.
Either do so in the <code>viewDidLoad</code> or upon the text view's creation.</p>
<div class="code"><pre class="code literal-block">textView.text = "Placeholder"
textView.textColor = UIColor.lightGray
</pre></div>

<p>Then when the user begins to edit the text view, if the text view contains a
placeholder (i.e. if its text color is light gray) clear the placeholder text
and set the text color to black in order to accommodate the user's entry.</p>
<div class="code"><pre class="code literal-block"><span class="k">func</span><span class="w"> </span><span class="n">textViewDidBeginEditing</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="n">textView</span><span class="p">:</span><span class="w"> </span><span class="n">UITextView</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">textView</span><span class="o">.</span><span class="n">textColor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UIColor</span><span class="o">.</span><span class="n">lightGray</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">textView</span><span class="o">.</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nil</span>
<span class="w">        </span><span class="n">textView</span><span class="o">.</span><span class="n">textColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UIColor</span><span class="o">.</span><span class="n">black</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Then when the user finishes editing the text view and it's resigned as the
first responder, if the text view is empty, reset its placeholder by re-adding
the placeholder text and setting its color to light gray.</p>
<div class="code"><pre class="code literal-block"><span class="k">func</span><span class="w"> </span><span class="n">textViewDidEndEditing</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="n">textView</span><span class="p">:</span><span class="w"> </span><span class="n">UITextView</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">textView</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">isEmpty</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">textView</span><span class="o">.</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Placeholder"</span>
<span class="w">        </span><span class="n">textView</span><span class="o">.</span><span class="n">textColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UIColor</span><span class="o">.</span><span class="n">lightGray</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<hr>
<p><strong><em>Solution #2</em></strong> <em>- If you want the placeholder to show whenever the text
view is empty, even if the text view’s selected:</em></p>
<p>First set the placeholder in the <code>viewDidLoad</code>:</p>
<div class="code"><pre class="code literal-block">textView.text = "Placeholder"
textView.textColor = UIColor.lightGray

textView.becomeFirstResponder()

textView.selectedTextRange = textView.textRange(from: textView.beginningOfDocument, to: textView.beginningOfDocument)
</pre></div>

<p>(Note: Since the OP wanted to have the text view selected as soon as the view
loads, I incorporated text view selection into the above code. If this is not
your desired behavior and you do not want the text view selected upon view
load, remove the last two lines from the above code chunk.)</p>
<p>Then utilize the <code>shouldChangeTextInRange</code> <code>UITextViewDelegate</code> method, like
so:</p>
<div class="code"><pre class="code literal-block"><span class="k">func</span><span class="w"> </span><span class="n">textView</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="n">textView</span><span class="p">:</span><span class="w"> </span><span class="n">UITextView</span><span class="p">,</span><span class="w"> </span><span class="n">shouldChangeTextIn</span><span class="w"> </span><span class="nb">range</span><span class="p">:</span><span class="w"> </span><span class="n">NSRange</span><span class="p">,</span><span class="w"> </span><span class="n">replacementText</span><span class="w"> </span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Bool</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Combine</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">textView</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replacement</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">to</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">string</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">currentText</span><span class="p">:</span><span class="nb nb-Type">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textView</span><span class="o">.</span><span class="n">text</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">updatedText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">currentText</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">NSString</span><span class="p">)</span><span class="o">.</span><span class="n">replacingCharacters</span><span class="p">(</span><span class="ow">in</span><span class="p">:</span><span class="w"> </span><span class="nb">range</span><span class="p">,</span><span class="w"> </span><span class="n">with</span><span class="p">:</span><span class="w"> </span><span class="n">text</span><span class="p">)</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">empty</span><span class="p">,</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">placeholder</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cursor</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">beginning</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">view</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">updatedText</span><span class="o">.</span><span class="n">isEmpty</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">textView</span><span class="o">.</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Placeholder"</span>
<span class="w">        </span><span class="n">textView</span><span class="o">.</span><span class="n">textColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UIColor</span><span class="o">.</span><span class="n">lightGray</span>

<span class="w">        </span><span class="n">textView</span><span class="o">.</span><span class="n">selectedTextRange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textView</span><span class="o">.</span><span class="n">textRange</span><span class="p">(</span><span class="n">from</span><span class="p">:</span><span class="w"> </span><span class="n">textView</span><span class="o">.</span><span class="n">beginningOfDocument</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">:</span><span class="w"> </span><span class="n">textView</span><span class="o">.</span><span class="n">beginningOfDocument</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">view</span><span class="s1">'s placeholder is showing and the</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">replacement</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">greater</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">set</span><span class="w"> </span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">black</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">replacement</span><span class="w"> </span><span class="n">string</span>
<span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">textView</span><span class="o">.</span><span class="n">textColor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UIColor</span><span class="o">.</span><span class="n">lightGray</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">text</span><span class="o">.</span><span class="n">isEmpty</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">textView</span><span class="o">.</span><span class="n">textColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UIColor</span><span class="o">.</span><span class="n">black</span>
<span class="w">        </span><span class="n">textView</span><span class="o">.</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">case</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">usual</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">behavior</span><span class="o">...</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="bp">true</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">...</span><span class="n">otherwise</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">updates</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">already</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">made</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span>
<span class="p">}</span>
</pre></div>

<p>And also implement <code>textViewDidChangeSelection</code> to prevent the user from
changing the position of the cursor while the placeholder's visible. (Note:
<code>textViewDidChangeSelection</code> is called before the view loads so only check the
text view's color if the window is visible):</p>
<div class="code"><pre class="code literal-block"><span class="k">func</span><span class="w"> </span><span class="n">textViewDidChangeSelection</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="n">textView</span><span class="p">:</span><span class="w"> </span><span class="n">UITextView</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">window</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">textView</span><span class="o">.</span><span class="n">textColor</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">UIColor</span><span class="o">.</span><span class="n">lightGray</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">textView</span><span class="o">.</span><span class="n">selectedTextRange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textView</span><span class="o">.</span><span class="n">textRange</span><span class="p">(</span><span class="n">from</span><span class="p">:</span><span class="w"> </span><span class="n">textView</span><span class="o">.</span><span class="n">beginningOfDocument</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">:</span><span class="w"> </span><span class="n">textView</span><span class="o">.</span><span class="n">beginningOfDocument</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<hr>
<h3><strong>Floating Placeholder</strong></h3>
<hr>
<p>It's simple, safe and reliable to position a placeholder label above a text
view, set its font, color and manage placeholder visibility by tracking
changes to the text view's character count.</p>
<p><em>Update: Incorporated suggestions made by @RakshithaMurangaRodrigo in Feb 10,
'23 comment</em></p>
<p><strong>Swift 5:</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">NotesViewController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">UIViewController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="err">@</span><span class="n">IBOutlet</span><span class="w"> </span><span class="k">var</span><span class="w"> </span><span class="n">textView</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">UITextView</span><span class="o">!</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">placeholderLabel</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">UILabel</span><span class="o">!</span>

<span class="w">    </span><span class="n">override</span><span class="w"> </span><span class="k">func</span><span class="w"> </span><span class="n">viewDidLoad</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">viewDidLoad</span><span class="p">()</span>

<span class="w">        </span><span class="n">textView</span><span class="o">.</span><span class="n">delegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span>
<span class="w">        </span><span class="n">placeholderLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UILabel</span><span class="p">()</span>
<span class="w">        </span><span class="n">placeholderLabel</span><span class="o">.</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Enter some text..."</span>
<span class="w">        </span><span class="n">placeholderLabel</span><span class="o">.</span><span class="n">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">.</span><span class="n">italicSystemFont</span><span class="p">(</span><span class="n">ofSize</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">textView</span><span class="o">.</span><span class="n">font</span><span class="err">?</span><span class="o">.</span><span class="n">pointSize</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
<span class="w">        </span><span class="n">placeholderLabel</span><span class="o">.</span><span class="n">sizeToFit</span><span class="p">()</span>
<span class="w">        </span><span class="n">textView</span><span class="o">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">placeholderLabel</span><span class="p">)</span>
<span class="w">        </span><span class="n">placeholderLabel</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">textView</span><span class="o">.</span><span class="n">font</span><span class="err">?</span><span class="o">.</span><span class="n">pointSize</span><span class="p">)</span><span class="o">!</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="n">placeholderLabel</span><span class="o">.</span><span class="n">textColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">.</span><span class="n">tertiaryLabel</span>
<span class="w">        </span><span class="n">placeholderLabel</span><span class="o">.</span><span class="n">isHidden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">textView</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">isEmpty</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">extension</span><span class="w"> </span><span class="n">NotesViewController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">UITextViewDelegate</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">func</span><span class="w"> </span><span class="n">textViewDidChange</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="n">textView</span><span class="p">:</span><span class="w"> </span><span class="n">UITextView</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">placeholderLabel</span><span class="err">?</span><span class="o">.</span><span class="n">isHidden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">textView</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">isEmpty</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">func</span><span class="w"> </span><span class="n">textViewDidEndEditing</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="n">textView</span><span class="p">:</span><span class="w"> </span><span class="n">UITextView</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">         </span>
<span class="w">        </span><span class="n">placeholderLabel</span><span class="err">?</span><span class="o">.</span><span class="n">isHidden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">textView</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">isEmpty</span><span class="w">     </span>
<span class="w">    </span><span class="p">}</span><span class="w">  </span>
<span class="w">    </span><span class="k">func</span><span class="w"> </span><span class="n">textViewDidBeginEditing</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="n">textView</span><span class="p">:</span><span class="w"> </span><span class="n">UITextView</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">         </span>
<span class="w">        </span><span class="n">placeholderLabel</span><span class="err">?</span><span class="o">.</span><span class="n">isHidden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span><span class="w">     </span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<hr>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-s-the-best-strategy-for-unit-testing-database-driven-applications/" class="u-url">What's the best strategy for unit-testing database-driven applications?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-s-the-best-strategy-for-unit-testing-database-driven-applications/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T01:36:01+08:00" itemprop="datePublished" title="2023-03-04 01:36">2023-03-04 01:36</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I work with a lot of web applications that are driven by databases of varying
complexity on the backend. Typically, there's an ORM layer separate from the
business and presentation logic. This makes unit-testing the business logic
fairly straightforward; things can be implemented in discrete modules and any
data needed for the test can be faked through object mocking.</p>
<p>But testing the ORM and database itself has always been fraught with problems
and compromises.</p>
<p>Over the years, I have tried a few strategies, none of which completely
satisfied me.</p>
<ul>
<li>
<p>Load a test database with known data. Run tests against the ORM and confirm that the right data comes back. The disadvantage here is that your test DB has to keep up with any schema changes in the application database, and might get out of sync. It also relies on artificial data, and may not expose bugs that occur due to stupid user input. Finally, if the test database is small, it won't reveal inefficiencies like a missing index. (OK, that last one isn't really what unit testing should be used for, but it doesn't hurt.)</p>
</li>
<li>
<p>Load a copy of the production database and test against that. The problem here is that you may have no idea what's in the production DB at any given time; your tests may need to be rewritten if data changes over time. </p>
</li>
</ul>
<p>Some people have pointed out that both of these strategies rely on specific
data, and a unit test should test only functionality. To that end, I've seen
suggested:</p>
<ul>
<li>Use a mock database server, and check only that the ORM is sending the correct queries in response to a given method call.</li>
</ul>
<p>What strategies have you used for testing database-driven applications, if
any? What has worked the best for you?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I've actually used your first approach with quite some success, but in a
slightly different ways that I think would solve some of your problems:</p>
<ol>
<li>
<p>Keep the entire schema and scripts for creating it in source control so that anyone can create the current database schema after a check out. In addition, keep sample data in data files that get loaded by part of the build process. As you discover data that causes errors, add it to your sample data to check that errors don't re-emerge.</p>
</li>
<li>
<p>Use a continuous integration server to build the database schema, load the sample data, and run tests. This is how we keep our test database in sync (rebuilding it at every test run). Though this requires that the CI server have access and ownership of its own dedicated database instance, I say that having our db schema built 3 times a day has dramatically helped find errors that probably would not have been found till just before delivery (if not later). I can't say that I rebuild the schema before every commit. Does anybody? With this approach you won't have to (well maybe we should, but its not a big deal if someone forgets).</p>
</li>
<li>
<p>For my group, user input is done at the application level (not db) so this is tested via standard unit tests.</p>
</li>
</ol>
<p>Loading Production Database Copy:<br>
This was the approach that was used at my last job. It was a huge pain cause
of a couple of issues:</p>
<ol>
<li>The copy would get out of date from the production version</li>
<li>Changes would be made to the copy's schema and wouldn't get propagated to the production systems. At this point we'd have diverging schemas. Not fun.</li>
</ol>
<p>Mocking Database Server:<br>
We also do this at my current job. After every commit we execute unit tests
against the application code that have mock db accessors injected. Then three
times a day we execute the full db build described above. I definitely
recommend both approaches.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I'm always running tests against an in-memory DB (HSQLDB or Derby) for these
reasons:</p>
<ul>
<li>It makes you think which data to keep in your test DB and why. Just hauling your production DB into a test system translates to "I have no idea what I'm doing or why and if something breaks, it wasn't me!!" ;)</li>
<li>It makes sure the database can be recreated with little effort in a new place (for example when we need to replicate a bug from production)</li>
<li>It helps enormously with the quality of the DDL files.</li>
</ul>
<p>The in-memory DB is loaded with fresh data once the tests start and after most
tests, I invoke ROLLBACK to keep it stable. <strong>ALWAYS</strong> keep the data in the
test DB stable! If the data changes all the time, you can't test.</p>
<p>The data is loaded from SQL, a template DB or a dump/backup. I prefer dumps if
they are in a readable format because I can put them in VCS. If that doesn't
work, I use a CSV file or XML. If I have to load enormous amounts of data ...
I don't. You never have to load enormous amounts of data :) Not for unit
tests. Performance tests are another issue and different rules apply.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-pass-data-to-angular-routed-components/" class="u-url">How do I pass data to Angular routed components?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-pass-data-to-angular-routed-components/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T01:35:34+08:00" itemprop="datePublished" title="2023-03-04 01:35">2023-03-04 01:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In one of my Angular 2 routes's templates ( <strong>FirstComponent</strong> ) I have a
button</p>
<p><strong>first.component.html</strong></p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"button"</span><span class="w"> </span><span class="na">click=</span><span class="s">"routeWithData()"</span><span class="nt">&gt;</span>Pass<span class="w"> </span>data<span class="w"> </span>and<span class="w"> </span>route<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>My <strong>goal</strong> is to achieve:</p>
<blockquote>
<p>Button click -&gt; route to another component while preserving data and without
using the other component as a directive.</p>
</blockquote>
<p>This is what I tried...</p>
<p><strong>1ST APPROACH</strong></p>
<p>In the same view I am storing collecting same data based on user interaction.</p>
<p><strong>first.component.ts</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">export</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">FirstComponent</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">constructor</span><span class="p">(</span><span class="n">private</span><span class="w"> </span><span class="n">_router</span><span class="p">:</span><span class="w"> </span><span class="n">Router</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>

<span class="w">     </span><span class="n">property1</span><span class="p">:</span><span class="w"> </span><span class="n">number</span><span class="p">;</span>
<span class="w">     </span><span class="n">property2</span><span class="p">:</span><span class="w"> </span><span class="n">string</span><span class="p">;</span>
<span class="w">     </span><span class="n">property3</span><span class="p">:</span><span class="w"> </span><span class="n">TypeXY</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">class</span><span class="p">,</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">primitive</span><span class="w"> </span><span class="n">type</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="n">above</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">DOM</span><span class="w"> </span><span class="n">events</span>
<span class="w">    </span><span class="n">routeWithData</span><span class="p">(){</span>
<span class="w">         </span><span class="o">//</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="n">route</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Normally I'd route to <strong>SecondComponent</strong> by</p>
<div class="code"><pre class="code literal-block"> this._router.navigate(['SecondComponent']);
</pre></div>

<p>eventually passing the data by</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="nt">this</span><span class="p">.</span><span class="nc">_router</span><span class="p">.</span><span class="nc">navigate</span><span class="o">(</span><span class="cp">[</span><span class="s1">'SecondComponent'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nx">p1</span><span class="p">:</span><span class="w"> </span><span class="nx">this.property1</span><span class="p">,</span><span class="w"> </span><span class="nx">p2</span><span class="p">:</span><span class="w"> </span><span class="nx">property2</span><span class="w"> </span><span class="p">}</span><span class="cp">]</span><span class="o">);</span>
</pre></div>

<p>whereas the definition of the link with parameters would be</p>
<div class="code"><pre class="code literal-block"><span class="nv">@RouteConfig</span><span class="p">(</span><span class="o">[</span>
<span class="n">      // ...</span>
<span class="n">      { path: '/SecondComponent/:p1:p2', name: 'SecondComponent', component: SecondComponent} </span>
<span class="n">)</span><span class="o">]</span>
</pre></div>

<p>The issue with this approach is that I guess <strong>I can't pass complex data</strong>
(e.g. an <strong>object</strong> like property3) in-url;</p>
<p><strong>2ND APPROACH</strong></p>
<p>An alternative would be including SecondComponent as <strong>directive</strong> in
FirstComponent.</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="o">&lt;</span><span class="n">SecondComponent</span><span class="w"> </span><span class="o">[</span><span class="n">p3</span><span class="o">]=</span><span class="ss">"property3"</span><span class="o">&gt;&lt;/</span><span class="n">SecondComponent</span><span class="o">&gt;</span>
</pre></div>

<p>However I want to <strong>route</strong> to that component, not include it!</p>
<p><strong>3RD APPROACH</strong></p>
<p>The most viable solution I see here would be to use a <strong>Service</strong> (e.g.
FirstComponentService) to</p>
<ul>
<li>
<strong>store</strong> the data (_firstComponentService.storeData()) on routeWithData() in FirstComponent</li>
<li>
<strong>retrieve</strong> the data (_firstComponentService.retrieveData()) in <strong>ngOnInit()</strong> in <strong>SecondComponent</strong>
</li>
</ul>
<p>While this approach seems perfectly viable, I wonder whether this is the
easiest / most elegant way to achieve the goal.</p>
<p>In general I'd like to know whether I'm missing other <strong>potential approaches</strong>
to pass the data between components, particularly <strong>with the less possible
amount of code</strong></p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>Update 4.0.0</strong></p>
<p>See Angular Angular Router - Fetch data before navigating for more details.</p>
<p><strong>Original</strong></p>
<p>Using a service is the way to go. In route params you should only pass data
that you want to be reflected in the browser URL bar.</p>
<p>See Angular Angular Cookbook Component Communication - Bidirectional Service.</p>
<p>The router shipped with RC.4 re-introduces <code>data</code></p>
<div class="code"><pre class="code literal-block"><span class="n">constructor</span><span class="p">(</span><span class="n">private</span><span class="w"> </span><span class="n">route</span><span class="p">:</span><span class="w"> </span><span class="n">ActivatedRoute</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>



<span class="k">const</span><span class="w"> </span><span class="n">routes</span><span class="p">:</span><span class="w"> </span><span class="n">RouterConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"> </span><span class="n">redirectTo</span><span class="p">:</span><span class="w"> </span><span class="s1">'/heroes'</span><span class="p">,</span><span class="w"> </span><span class="n">pathMatch</span><span class="p">:</span><span class="w"> </span><span class="s1">'full'</span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="n">path</span><span class="p">:</span><span class="w"> </span><span class="s1">'heroes'</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">:</span><span class="w"> </span><span class="n">HeroDetailComponent</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">some_data</span><span class="p">:</span><span class="w"> </span><span class="s1">'some value'</span><span class="p">}}</span>
<span class="p">];</span>



<span class="k">class</span><span class="w"> </span><span class="n">HeroDetailComponent</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">ngOnInit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">sub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">route</span>
<span class="w">      </span><span class="o">.</span><span class="n">data</span>
<span class="w">      </span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">v</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">ngOnDestroy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">sub</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>See also the Plunker.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I think since we don't have <strong>$rootScope</strong> kind of thing in angular 2 as in
angular 1.x. We can use angular 2 shared service/class while in
<strong>ngOnDestroy</strong> pass data to service and after routing take the data from the
service in <strong>ngOnInit</strong> function:</p>
<p><strong>Here I am using DataService to share hero object:</strong></p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="p">{</span> <span class="n">Hero</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'./hero'</span><span class="p">;</span>
<span class="n">export</span> <span class="k">class</span> <span class="nc">DataService</span> <span class="p">{</span>
  <span class="n">public</span> <span class="n">hero</span><span class="p">:</span> <span class="n">Hero</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><strong>Pass object from first page component:</strong></p>
<div class="code"><pre class="code literal-block"> ngOnDestroy() {
    this.dataService.hero = this.hero; 
 }
</pre></div>

<p><strong>Take object from second page component:</strong></p>
<div class="code"><pre class="code literal-block"> ngOnInit() {
    this.hero = this.dataService.hero; 
 }
</pre></div>

<p>Here is an example: plunker</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2243.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2241.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
