<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1722) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1722.html">
<link rel="prev" href="index-1723.html" type="text/html">
<link rel="next" href="index-1721.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-execute-a-string-containing-python-code-in-python/" class="u-url">How do I execute a string containing Python code in Python?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-execute-a-string-containing-python-code-in-python/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:47:42+08:00" itemprop="datePublished" title="2023-03-03 07:47">2023-03-03 07:47</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I execute a string containing Python code in Python?</p>
<hr>
<p><strong>Do not ever use<code>eval</code> (or <code>exec</code>) on data that could possibly come from
outside the program in any form. It is a critical security risk. You allow the
author of the data to run arbitrary code on your computer.</strong> If you are here
because you want to create multiple variables in your Python program following
a pattern, <strong>you almost certainly have an XY problem</strong>. Do not create those
variables at all - instead, use a list or dict appropriately.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>In the example a string is executed as code using the exec function.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">StringIO</span>

<span class="c1"># create file-like string to capture output</span>
<span class="n">codeOut</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<span class="n">codeErr</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>

<span class="n">code</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">def f(x):</span>
<span class="s2">    x = x + 1</span>
<span class="s2">    return x</span>

<span class="s2">print 'This is my output.'</span>
<span class="s2">"""</span>

<span class="c1"># capture output and errors</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">codeOut</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">codeErr</span>

<span class="n">exec</span> <span class="n">code</span>

<span class="c1"># restore stdout and stderr</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">__stdout__</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">__stderr__</span>

<span class="nb">print</span> <span class="n">f</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">codeErr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="nb">print</span> <span class="s2">"error:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">"</span> <span class="o">%</span> <span class="n">s</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">codeOut</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="nb">print</span> <span class="s2">"output:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">s</span>

<span class="n">codeOut</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">codeErr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>In the example a string is executed as code using the exec function.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">StringIO</span>

<span class="c1"># create file-like string to capture output</span>
<span class="n">codeOut</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
<span class="n">codeErr</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>

<span class="n">code</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">def f(x):</span>
<span class="s2">    x = x + 1</span>
<span class="s2">    return x</span>

<span class="s2">print 'This is my output.'</span>
<span class="s2">"""</span>

<span class="c1"># capture output and errors</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">codeOut</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">codeErr</span>

<span class="n">exec</span> <span class="n">code</span>

<span class="c1"># restore stdout and stderr</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">__stdout__</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">__stderr__</span>

<span class="nb">print</span> <span class="n">f</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">codeErr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="nb">print</span> <span class="s2">"error:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">"</span> <span class="o">%</span> <span class="n">s</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">codeOut</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="nb">print</span> <span class="s2">"output:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">s</span>

<span class="n">codeOut</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">codeErr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ruby-what-does-require-false-in-gemfile-mean/" class="u-url">Ruby: What does 'require: false' in Gemfile mean?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ruby-what-does-require-false-in-gemfile-mean/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:47:20+08:00" itemprop="datePublished" title="2023-03-03 07:47">2023-03-03 07:47</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Does this:</p>
<div class="code"><pre class="code literal-block">gem 'whenever', require: false
</pre></div>

<p>mean that the gem needs to be installed, or does it mean it is not required?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This means install the gem, but do not call require when you start Bundler. So
you will need to manually call</p>
<div class="code"><pre class="code literal-block">require "whenever"
</pre></div>

<p>if you want to use the library.</p>
<p>If you were to do</p>
<div class="code"><pre class="code literal-block">gem "whenever", require: "whereever"
</pre></div>

<p>then bundler would download the gem named whenever, but would call</p>
<div class="code"><pre class="code literal-block">require "whereever"
</pre></div>

<p>This is often used if the name of library to require is different than the
name of the gem.</p>
<p><br></p>
<h3>Suggest</h3>
<p>You use <code>:require =&gt; false</code> when you want the gem to be installed but not
"required".</p>
<p>So in the example you gave: <code>gem 'whenever', :require =&gt; false</code> when someone
runs bundle install the whenever gem would be installed as with <code>gem install
whenever</code>. Whenever is used to create cron jobs by running a rake task but
isn't usually used from within the rails (or other framework if not rails)
application.</p>
<p>So you can use <code>:require =&gt; false</code> for anything that you need to run from the
command line but don't need within your code.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/efficiently-convert-rows-to-columns-in-sql-server/" class="u-url">Efficiently convert rows to columns in sql server</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/efficiently-convert-rows-to-columns-in-sql-server/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:46:55+08:00" itemprop="datePublished" title="2023-03-03 07:46">2023-03-03 07:46</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm looking for an efficient way to convert rows to columns in SQL server, I
heard that PIVOT is not very fast, and I need to deal with lot of records.</p>
<p>This is my example:</p>
<div class="code"><pre class="code literal-block"><span class="c">   </span><span class="nb">-------------------------------</span>
<span class="c">   | Id | Value  | ColumnName    |</span>
<span class="c">   </span><span class="nb">-------------------------------</span>
<span class="c">   | 1  | John   | FirstName     |</span>
<span class="c">   | 2  | 2</span><span class="nt">.</span><span class="c">4    | Amount        |</span>
<span class="c">   | 3  | ZH1E4A | PostalCode    |</span>
<span class="c">   | 4  | Fork   | LastName      |</span>
<span class="c">   | 5  | 857685 | AccountNumber |</span>
<span class="c">   </span><span class="nb">-------------------------------</span>
</pre></div>

<p>This is my result:</p>
<div class="code"><pre class="code literal-block"><span class="nb">---------------------------------------------------------------------</span>
<span class="c">| FirstName  |Amount|   PostalCode   |   LastName  |  AccountNumber |</span>
<span class="nb">---------------------------------------------------------------------</span>
<span class="c">| John       | 2</span><span class="nt">.</span><span class="c">4  |   ZH1E4A       |   Fork      |  857685        |</span>
<span class="nb">---------------------------------------------------------------------</span>
</pre></div>

<p>How can I build the result?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>There are several ways that you can transform data from multiple rows into
columns.</p>
<h3>Using <code>PIVOT</code>
</h3>
<p>In SQL Server you can use the <code>PIVOT</code> function to transform the data from rows
to columns:</p>
<div class="code"><pre class="code literal-block"><span class="nv">select</span><span class="w"> </span><span class="nv">Firstname</span>,<span class="w"> </span><span class="nv">Amount</span>,<span class="w"> </span><span class="nv">PostalCode</span>,<span class="w"> </span><span class="nv">LastName</span>,<span class="w"> </span><span class="nv">AccountNumber</span>
<span class="nv">from</span>
<span class="ss">(</span>
<span class="w">  </span><span class="nv">select</span><span class="w"> </span><span class="nv">value</span>,<span class="w"> </span><span class="nv">columnname</span>
<span class="w">  </span><span class="nv">from</span><span class="w"> </span><span class="nv">yourtable</span>
<span class="ss">)</span><span class="w"> </span><span class="nv">d</span>
<span class="nv">pivot</span>
<span class="ss">(</span>
<span class="w">  </span><span class="nv">max</span><span class="ss">(</span><span class="nv">value</span><span class="ss">)</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="nv">columnname</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="ss">(</span><span class="nv">Firstname</span>,<span class="w"> </span><span class="nv">Amount</span>,<span class="w"> </span><span class="nv">PostalCode</span>,<span class="w"> </span><span class="nv">LastName</span>,<span class="w"> </span><span class="nv">AccountNumber</span><span class="ss">)</span>
<span class="ss">)</span><span class="w"> </span><span class="nv">piv</span><span class="c1">;</span>
</pre></div>

<p>See Demo.</p>
<h4>Pivot with unknown number of <code>columnnames</code>
</h4>
<p>If you have an unknown number of <code>columnnames</code> that you want to transpose,
then you can use dynamic SQL:</p>
<div class="code"><pre class="code literal-block"><span class="k">DECLARE</span><span class="w"> </span><span class="nv">@cols</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nc">NVARCHAR</span><span class="p">(</span><span class="nf">MAX</span><span class="p">),</span>
<span class="w">    </span><span class="nv">@query</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="nc">NVARCHAR</span><span class="p">(</span><span class="nf">MAX</span><span class="p">)</span>

<span class="k">select</span><span class="w"> </span><span class="nv">@cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">STUFF</span><span class="p">((</span><span class="k">SELECT</span><span class="w"> </span><span class="s1">','</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">QUOTENAME</span><span class="p">(</span><span class="n">ColumnName</span><span class="p">)</span><span class="w"> </span>
<span class="w">                    </span><span class="k">from</span><span class="w"> </span><span class="n">yourtable</span>
<span class="w">                    </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">ColumnName</span><span class="p">,</span><span class="w"> </span><span class="n">id</span>
<span class="w">                    </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">id</span>
<span class="w">            </span><span class="k">FOR</span><span class="w"> </span><span class="nc">XML</span><span class="w"> </span><span class="k">PATH</span><span class="p">(</span><span class="s1">''</span><span class="p">),</span><span class="w"> </span><span class="n">TYPE</span>
<span class="w">            </span><span class="p">).</span><span class="k">value</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span><span class="w"> </span><span class="s1">'NVARCHAR(MAX)'</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span>

<span class="k">set</span><span class="w"> </span><span class="nv">@query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="s1">'SELECT '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@cols</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">N</span><span class="s1">' from </span>
<span class="s1">             (</span>
<span class="s1">                select value, ColumnName</span>
<span class="s1">                from yourtable</span>
<span class="s1">            ) x</span>
<span class="s1">            pivot </span>
<span class="s1">            (</span>
<span class="s1">                max(value)</span>
<span class="s1">                for ColumnName in ('</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@cols</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">N</span><span class="s1">')</span>
<span class="s1">            ) p '</span>

<span class="k">exec</span><span class="w"> </span><span class="n">sp_executesql</span><span class="w"> </span><span class="nv">@query</span><span class="p">;</span>
</pre></div>

<p>See Demo.</p>
<h3>Using an aggregate function</h3>
<p>If you do not want to use the <code>PIVOT</code> function, then you can use an aggregate
function with a <code>CASE</code> expression:</p>
<div class="code"><pre class="code literal-block"><span class="nv">select</span>
<span class="w">  </span><span class="nv">max</span><span class="ss">(</span><span class="nv">case</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">columnname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'FirstName'</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="k">end</span><span class="ss">)</span><span class="w"> </span><span class="nv">Firstname</span>,
<span class="w">  </span><span class="nv">max</span><span class="ss">(</span><span class="nv">case</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">columnname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'Amount'</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="k">end</span><span class="ss">)</span><span class="w"> </span><span class="nv">Amount</span>,
<span class="w">  </span><span class="nv">max</span><span class="ss">(</span><span class="nv">case</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">columnname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'PostalCode'</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="k">end</span><span class="ss">)</span><span class="w"> </span><span class="nv">PostalCode</span>,
<span class="w">  </span><span class="nv">max</span><span class="ss">(</span><span class="nv">case</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">columnname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'LastName'</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="k">end</span><span class="ss">)</span><span class="w"> </span><span class="nv">LastName</span>,
<span class="w">  </span><span class="nv">max</span><span class="ss">(</span><span class="nv">case</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">columnname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'AccountNumber'</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="k">end</span><span class="ss">)</span><span class="w"> </span><span class="nv">AccountNumber</span>
<span class="nv">from</span><span class="w"> </span><span class="nv">yourtable</span>
</pre></div>

<p>See Demo.</p>
<h3>Using multiple joins</h3>
<p>This could also be completed using multiple joins, but you will need some
column to associate each of the rows which you do not have in your sample
data. But the basic syntax would be:</p>
<div class="code"><pre class="code literal-block">select fn.value as FirstName,
  a.value as Amount,
  pc.value as PostalCode,
  ln.value as LastName,
  an.value as AccountNumber
from yourtable fn
left join yourtable a
  on fn.somecol = a.somecol
  and a.columnname = 'Amount'
left join yourtable pc
  on fn.somecol = pc.somecol
  and pc.columnname = 'PostalCode'
left join yourtable ln
  on fn.somecol = ln.somecol
  and ln.columnname = 'LastName'
left join yourtable an
  on fn.somecol = an.somecol
  and an.columnname = 'AccountNumber'
where fn.columnname = 'Firstname'
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>This is rather a method than just a single script but gives you much more
flexibility.</p>
<p>First of all There are 3 objects:</p>
<ol>
<li>User defined TABLE type [<code>ColumnActionList</code>] -&gt; holds data as parameter </li>
<li>SP [<code>proc_PivotPrepare</code>] -&gt; prepares our data</li>
<li>SP [<code>proc_PivotExecute</code>] -&gt; execute the script</li>
</ol>
<p>CREATE TYPE [dbo].[ColumnActionList] AS TABLE ( [ID] [smallint] NOT NULL,
[ColumnName] nvarchar NOT NULL, [Action] nchar NOT NULL ); GO</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="o">[</span><span class="n">dbo</span><span class="o">]</span><span class="p">.</span><span class="o">[</span><span class="n">proc_PivotPrepare</span><span class="o">]</span><span class="w"> </span>
<span class="w">    </span><span class="p">(</span>
<span class="w">    </span><span class="nv">@DB_Name</span><span class="w">        </span><span class="nc">nvarchar</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span>
<span class="w">    </span><span class="nv">@TableName</span><span class="w">      </span><span class="nc">nvarchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">AS</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@DB_Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ISNULL</span><span class="p">(</span><span class="nv">@DB_Name</span><span class="p">,</span><span class="nf">db_name</span><span class="p">())</span>
<span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="nv">@SQL_Code</span><span class="w"> </span><span class="nc">nvarchar</span><span class="p">(</span><span class="nf">max</span><span class="p">)</span>

<span class="w">    </span><span class="k">DECLARE</span><span class="w"> </span><span class="nv">@MyTab</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="p">(</span><span class="n">ID</span><span class="w"> </span><span class="nc">smallint</span><span class="w"> </span><span class="k">identity</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="o">[</span><span class="n">Column_Name</span><span class="o">]</span><span class="w"> </span><span class="nc">nvarchar</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span><span class="w"> </span><span class="o">[</span><span class="n">Type</span><span class="o">]</span><span class="w"> </span><span class="nc">nchar</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="o">[</span><span class="n">Set Action SQL</span><span class="o">]</span><span class="w"> </span><span class="nc">nvarchar</span><span class="p">(</span><span class="nf">max</span><span class="p">));</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@SQL_Code</span><span class="w">        </span><span class="o">=</span><span class="w">   </span><span class="s1">'SELECT [&lt;| SQL_Code |&gt;] = '' '' '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''----------------------------------------------------------------------------------------------------'' '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''-----| Declare user defined type [ID] / [ColumnName] / [PivotAction] '' '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''----------------------------------------------------------------------------------------------------'' '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''DECLARE @ColumnListWithActions ColumnActionList;'''</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''----------------------------------------------------------------------------------------------------'' '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''-----| Set [PivotAction] (''''S'''' as default) to select dimentions and values '' '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''-----|'''</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''-----| ''''S'''' = Stable column || ''''D'''' = Dimention column || ''''V'''' = Value column '' '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''----------------------------------------------------------------------------------------------------'' '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''INSERT INTO  @ColumnListWithActions VALUES ('' + CAST( ROW_NUMBER() OVER (ORDER BY [NAME]) as nvarchar(10)) + '', '' + '''''''' + [NAME] + ''''''''+ '', ''''S'''');'''</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'FROM ['</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@DB_Name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'].sys.columns  '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'WHERE object_id = object_id(''['</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@DB_Name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">']..['</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@TableName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">']'') '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''----------------------------------------------------------------------------------------------------'' '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''-----| Execute sp_PivotExecute with parameters: columns and dimentions and main table name'' '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''----------------------------------------------------------------------------------------------------'' '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''EXEC [dbo].[sp_PivotExecute] @ColumnListWithActions, '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">''''''</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@TableName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">''''''</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">';'''</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'UNION ALL '</span>
<span class="w">                                        </span><span class="o">+</span><span class="w"> </span><span class="s1">'SELECT ''----------------------------------------------------------------------------------------------------'' '</span><span class="w">                            </span>
<span class="k">EXECUTE</span><span class="w"> </span><span class="n">SP_EXECUTESQL</span><span class="w"> </span><span class="nv">@SQL_Code</span><span class="p">;</span>

<span class="k">GO</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="o">[</span><span class="n">dbo</span><span class="o">]</span><span class="p">.</span><span class="o">[</span><span class="n">sp_PivotExecute</span><span class="o">]</span>
<span class="p">(</span>
<span class="nv">@ColumnListWithActions</span><span class="w">  </span><span class="n">ColumnActionList</span><span class="w"> </span><span class="n">ReadOnly</span>
<span class="p">,</span><span class="nv">@TableName</span><span class="w">                     </span><span class="nc">nvarchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">AS</span>


<span class="o">--</span><span class="err">#######################################################################################################################</span>
<span class="o">--</span><span class="err">###</span><span class="o">|</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">Select</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="k">user</span><span class="o">-</span><span class="n">defined</span><span class="o">-</span><span class="nc">table</span><span class="o">-</span><span class="k">variable</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="nc">table</span>
<span class="o">--</span><span class="err">#######################################################################################################################</span>

<span class="k">IF</span><span class="w"> </span><span class="nf">OBJECT_ID</span><span class="p">(</span><span class="s1">'tempdb.dbo.#ColumnListWithActions'</span><span class="p">,</span><span class="w"> </span><span class="s1">'U'</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">#ColumnListWithActions</span><span class="p">;</span><span class="w"> </span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">#ColumnListWithActions</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@ColumnListWithActions</span><span class="p">;</span>

<span class="o">--</span><span class="err">#######################################################################################################################</span>
<span class="o">--</span><span class="err">###</span><span class="o">|</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Preparing</span><span class="w"> </span><span class="n">lists</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">column</span><span class="w"> </span><span class="n">groups</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">strings</span><span class="p">:</span>
<span class="o">--</span><span class="err">#######################################################################################################################</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@ColumnName</span><span class="w">                     </span><span class="nc">nvarchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@Destiny</span><span class="w">                        </span><span class="nc">nchar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@ListOfColumns_Stable</span><span class="w">           </span><span class="nc">nvarchar</span><span class="p">(</span><span class="nf">max</span><span class="p">)</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@ListOfColumns_Dimension</span><span class="w">    </span><span class="nc">nvarchar</span><span class="p">(</span><span class="nf">max</span><span class="p">)</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@ListOfColumns_Variable</span><span class="w">     </span><span class="nc">nvarchar</span><span class="p">(</span><span class="nf">max</span><span class="p">)</span>
<span class="o">--</span><span class="err">############################</span>
<span class="o">--</span><span class="err">###</span><span class="o">|</span><span class="w"> </span><span class="nc">Cursor</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">Stable</span><span class="w"> </span><span class="n">Columns</span>
<span class="o">--</span><span class="err">############################</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="n">ColumnListStringCreator_S</span><span class="w"> </span><span class="nc">CURSOR</span><span class="w"> </span><span class="k">FOR</span>
<span class="k">SELECT</span><span class="w">      </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span>
<span class="k">FROM</span><span class="w">        </span><span class="n">#ColumnListWithActions</span>
<span class="k">WHERE</span><span class="w">       </span><span class="o">[</span><span class="n">Action</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'S'</span>
<span class="k">OPEN</span><span class="w"> </span><span class="n">ColumnListStringCreator_S</span><span class="p">;</span>
<span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ColumnListStringCreator_S</span>
<span class="k">INTO</span><span class="w"> </span><span class="nv">@ColumnName</span>
<span class="w">  </span><span class="k">WHILE</span><span class="w"> </span><span class="nb">@@FETCH_STATUS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">   </span><span class="k">BEGIN</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@ListOfColumns_Stable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ISNULL</span><span class="p">(</span><span class="nv">@ListOfColumns_Stable</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' ['</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@ColumnName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'] ,'</span><span class="p">;</span>
<span class="w">        </span><span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ColumnListStringCreator_S</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">@ColumnName</span>
<span class="w">   </span><span class="k">END</span>

<span class="k">CLOSE</span><span class="w"> </span><span class="n">ColumnListStringCreator_S</span><span class="p">;</span>
<span class="k">DEALLOCATE</span><span class="w"> </span><span class="n">ColumnListStringCreator_S</span><span class="p">;</span>

<span class="o">--</span><span class="err">############################</span>
<span class="o">--</span><span class="err">###</span><span class="o">|</span><span class="w"> </span><span class="nc">Cursor</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">Dimension</span><span class="w"> </span><span class="n">Columns</span>
<span class="o">--</span><span class="err">############################</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="n">ColumnListStringCreator_D</span><span class="w"> </span><span class="nc">CURSOR</span><span class="w"> </span><span class="k">FOR</span>
<span class="k">SELECT</span><span class="w">      </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span>
<span class="k">FROM</span><span class="w">        </span><span class="n">#ColumnListWithActions</span>
<span class="k">WHERE</span><span class="w">       </span><span class="o">[</span><span class="n">Action</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'D'</span>
<span class="k">OPEN</span><span class="w"> </span><span class="n">ColumnListStringCreator_D</span><span class="p">;</span>
<span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ColumnListStringCreator_D</span>
<span class="k">INTO</span><span class="w"> </span><span class="nv">@ColumnName</span>
<span class="w">  </span><span class="k">WHILE</span><span class="w"> </span><span class="nb">@@FETCH_STATUS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">   </span><span class="k">BEGIN</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@ListOfColumns_Dimension</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ISNULL</span><span class="p">(</span><span class="nv">@ListOfColumns_Dimension</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' ['</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@ColumnName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'] ,'</span><span class="p">;</span>
<span class="w">        </span><span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ColumnListStringCreator_D</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">@ColumnName</span>
<span class="w">   </span><span class="k">END</span>

<span class="k">CLOSE</span><span class="w"> </span><span class="n">ColumnListStringCreator_D</span><span class="p">;</span>
<span class="k">DEALLOCATE</span><span class="w"> </span><span class="n">ColumnListStringCreator_D</span><span class="p">;</span>

<span class="o">--</span><span class="err">############################</span>
<span class="o">--</span><span class="err">###</span><span class="o">|</span><span class="w"> </span><span class="nc">Cursor</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">List</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">Variable</span><span class="w"> </span><span class="n">Columns</span>
<span class="o">--</span><span class="err">############################</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="n">ColumnListStringCreator_V</span><span class="w"> </span><span class="nc">CURSOR</span><span class="w"> </span><span class="k">FOR</span>
<span class="k">SELECT</span><span class="w">      </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span>
<span class="k">FROM</span><span class="w">        </span><span class="n">#ColumnListWithActions</span>
<span class="k">WHERE</span><span class="w">       </span><span class="o">[</span><span class="n">Action</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'V'</span>
<span class="k">OPEN</span><span class="w"> </span><span class="n">ColumnListStringCreator_V</span><span class="p">;</span>
<span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ColumnListStringCreator_V</span>
<span class="k">INTO</span><span class="w"> </span><span class="nv">@ColumnName</span>
<span class="w">  </span><span class="k">WHILE</span><span class="w"> </span><span class="nb">@@FETCH_STATUS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">   </span><span class="k">BEGIN</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@ListOfColumns_Variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ISNULL</span><span class="p">(</span><span class="nv">@ListOfColumns_Variable</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' ['</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@ColumnName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'] ,'</span><span class="p">;</span>
<span class="w">        </span><span class="k">FETCH</span><span class="w"> </span><span class="k">NEXT</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ColumnListStringCreator_V</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">@ColumnName</span>
<span class="w">   </span><span class="k">END</span>

<span class="k">CLOSE</span><span class="w"> </span><span class="n">ColumnListStringCreator_V</span><span class="p">;</span>
<span class="k">DEALLOCATE</span><span class="w"> </span><span class="n">ColumnListStringCreator_V</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="nv">@ListOfColumns_Variable</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nf">LEFT</span><span class="p">(</span><span class="nv">@ListOfColumns_Variable</span><span class="p">,</span><span class="w"> </span><span class="nf">LEN</span><span class="p">(</span><span class="nv">@ListOfColumns_Variable</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="nv">@ListOfColumns_Dimension</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">LEFT</span><span class="p">(</span><span class="nv">@ListOfColumns_Dimension</span><span class="p">,</span><span class="w"> </span><span class="nf">LEN</span><span class="p">(</span><span class="nv">@ListOfColumns_Dimension</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="nv">@ListOfColumns_Stable</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="nf">LEFT</span><span class="p">(</span><span class="nv">@ListOfColumns_Stable</span><span class="p">,</span><span class="w"> </span><span class="nf">LEN</span><span class="p">(</span><span class="nv">@ListOfColumns_Stable</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="o">--</span><span class="err">#######################################################################################################################</span>
<span class="o">--</span><span class="err">###</span><span class="o">|</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Preparing</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="ow">between</span><span class="w"> </span><span class="n">Dimension</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="n">excluding</span><span class="w"> </span><span class="n">NULLs</span>
<span class="o">--</span><span class="err">#######################################################################################################################</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@DIM_TAB</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="p">(</span><span class="o">[</span><span class="n">DIM_ID</span><span class="o">]</span><span class="w"> </span><span class="nc">smallint</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="nc">nvarchar</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">@DIM_TAB</span><span class="w"> </span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">DIM_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="p">),</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">#ColumnListWithActions</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">Action</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'D'</span><span class="p">;</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@DIM_ID</span><span class="w"> </span><span class="nc">smallint</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w">      </span><span class="nv">@DIM_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>


<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@SQL_Dimentions</span><span class="w"> </span><span class="nc">nvarchar</span><span class="p">(</span><span class="nf">max</span><span class="p">);</span>

<span class="k">IF</span><span class="w"> </span><span class="nf">OBJECT_ID</span><span class="p">(</span><span class="s1">'tempdb.dbo.##ALL_Dimentions'</span><span class="p">,</span><span class="w"> </span><span class="s1">'U'</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">##ALL_Dimentions</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="nv">@SQL_Dimentions</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="s1">'SELECT [xxx_ID_xxx] = ROW_NUMBER() OVER (ORDER BY '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@ListOfColumns_Dimension</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'), '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@ListOfColumns_Dimension</span>
<span class="w">                                            </span><span class="o">+</span><span class="w"> </span><span class="s1">' INTO ##ALL_Dimentions '</span>
<span class="w">                                            </span><span class="o">+</span><span class="w"> </span><span class="s1">' FROM (SELECT DISTINCT'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@ListOfColumns_Dimension</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' FROM  '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@TableName</span>
<span class="w">                                            </span><span class="o">+</span><span class="w"> </span><span class="s1">' WHERE '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@DIM_TAB</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">DIM_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@DIM_ID</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' IS NOT NULL '</span><span class="p">;</span>
<span class="w">                                            </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@DIM_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@DIM_ID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">WHILE</span><span class="w"> </span><span class="nv">@DIM_ID</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="o">[</span><span class="n">DIM_ID</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@DIM_TAB</span><span class="p">)</span>
<span class="w">            </span><span class="k">BEGIN</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@SQL_Dimentions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@SQL_Dimentions</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'AND '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@DIM_TAB</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">DIM_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@DIM_ID</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="s1">' IS NOT NULL '</span><span class="p">;</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@DIM_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@DIM_ID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">END</span>

<span class="k">SELECT</span><span class="w"> </span><span class="nv">@SQL_Dimentions</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">@SQL_Dimentions</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' )x'</span><span class="p">;</span>

<span class="k">EXECUTE</span><span class="w"> </span><span class="n">SP_EXECUTESQL</span><span class="w">  </span><span class="nv">@SQL_Dimentions</span><span class="p">;</span>

<span class="o">--</span><span class="err">#######################################################################################################################</span>
<span class="o">--</span><span class="err">###</span><span class="o">|</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Preparing</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="ow">between</span><span class="w"> </span><span class="n">Stable</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="n">excluding</span><span class="w"> </span><span class="n">NULLs</span>
<span class="o">--</span><span class="err">#######################################################################################################################</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@StabPos_TAB</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="p">(</span><span class="o">[</span><span class="n">StabPos_ID</span><span class="o">]</span><span class="w"> </span><span class="nc">smallint</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="nc">nvarchar</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">@StabPos_TAB</span><span class="w"> </span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">StabPos_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="p">),</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">#ColumnListWithActions</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">Action</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'S'</span><span class="p">;</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@StabPos_ID</span><span class="w"> </span><span class="nc">smallint</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w">      </span><span class="nv">@StabPos_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>


<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@SQL_MainStableColumnTable</span><span class="w"> </span><span class="nc">nvarchar</span><span class="p">(</span><span class="nf">max</span><span class="p">);</span>

<span class="k">IF</span><span class="w"> </span><span class="nf">OBJECT_ID</span><span class="p">(</span><span class="s1">'tempdb.dbo.##ALL_StableColumns'</span><span class="p">,</span><span class="w"> </span><span class="s1">'U'</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">##ALL_StableColumns</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="nv">@SQL_MainStableColumnTable</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s1">'SELECT xxx_ID_xxx = ROW_NUMBER() OVER (ORDER BY '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@ListOfColumns_Stable</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'), '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@ListOfColumns_Stable</span>
<span class="w">                                            </span><span class="o">+</span><span class="w"> </span><span class="s1">' INTO ##ALL_StableColumns '</span>
<span class="w">                                            </span><span class="o">+</span><span class="w"> </span><span class="s1">' FROM (SELECT DISTINCT'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@ListOfColumns_Stable</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' FROM  '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@TableName</span>
<span class="w">                                            </span><span class="o">+</span><span class="w"> </span><span class="s1">' WHERE '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@StabPos_TAB</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">StabPos_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@StabPos_ID</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' IS NOT NULL '</span><span class="p">;</span>
<span class="w">                                            </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@StabPos_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@StabPos_ID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">WHILE</span><span class="w"> </span><span class="nv">@StabPos_ID</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="o">[</span><span class="n">StabPos_ID</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@StabPos_TAB</span><span class="p">)</span>
<span class="w">            </span><span class="k">BEGIN</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@SQL_MainStableColumnTable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@SQL_MainStableColumnTable</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'AND '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@StabPos_TAB</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">StabPos_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@StabPos_ID</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="s1">' IS NOT NULL '</span><span class="p">;</span>
<span class="w">            </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@StabPos_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@StabPos_ID</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">            </span><span class="k">END</span>

<span class="k">SELECT</span><span class="w"> </span><span class="nv">@SQL_MainStableColumnTable</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nv">@SQL_MainStableColumnTable</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' )x'</span><span class="p">;</span>

<span class="k">EXECUTE</span><span class="w"> </span><span class="n">SP_EXECUTESQL</span><span class="w">  </span><span class="nv">@SQL_MainStableColumnTable</span><span class="p">;</span>

<span class="o">--</span><span class="err">#######################################################################################################################</span>
<span class="o">--</span><span class="err">###</span><span class="o">|</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Preparing</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="n">ID</span>
<span class="o">--</span><span class="err">#######################################################################################################################</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@FULL_SQL_1</span><span class="w"> </span><span class="nc">NVARCHAR</span><span class="p">(</span><span class="nf">MAX</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="nv">@FULL_SQL_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@i</span><span class="w"> </span><span class="nc">smallint</span>

<span class="k">IF</span><span class="w"> </span><span class="nf">OBJECT_ID</span><span class="p">(</span><span class="s1">'tempdb.dbo.##FinalTab'</span><span class="p">,</span><span class="w"> </span><span class="s1">'U'</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="ow">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="n">##FinalTab</span><span class="p">;</span>

<span class="k">SELECT</span><span class="w"> </span><span class="nv">@FULL_SQL_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'SELECT t.*, dim.[xxx_ID_xxx] '</span>
<span class="w">                                    </span><span class="o">+</span><span class="w"> </span><span class="s1">' INTO ##FinalTab '</span>
<span class="w">                                    </span><span class="o">+</span><span class="w">   </span><span class="s1">'FROM '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@TableName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' t '</span>
<span class="w">                                    </span><span class="o">+</span><span class="w">   </span><span class="s1">'JOIN ##ALL_Dimentions dim '</span>
<span class="w">                                    </span><span class="o">+</span><span class="w">   </span><span class="s1">'ON t.'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@DIM_TAB</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">DIM_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' = dim.'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@DIM_TAB</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">DIM_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">                                </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w">                               </span>
<span class="w">                                </span><span class="k">WHILE</span><span class="w"> </span><span class="nv">@i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="o">[</span><span class="n">DIM_ID</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@DIM_TAB</span><span class="p">)</span>
<span class="w">                                    </span><span class="k">BEGIN</span>
<span class="w">                                    </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@FULL_SQL_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@FULL_SQL_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' AND t.'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@DIM_TAB</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">DIM_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' = dim.'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@DIM_TAB</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">DIM_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@i</span><span class="p">)</span>
<span class="w">                                    </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@i</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span>
<span class="w">                                </span><span class="k">END</span>
<span class="k">EXECUTE</span><span class="w"> </span><span class="n">SP_EXECUTESQL</span><span class="w"> </span><span class="nv">@FULL_SQL_1</span>

<span class="o">--</span><span class="err">#######################################################################################################################</span>
<span class="o">--</span><span class="err">###</span><span class="o">|</span><span class="w"> </span><span class="n">Step</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Selecting</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="k">data</span>
<span class="o">--</span><span class="err">#######################################################################################################################</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@STAB_TAB</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="p">(</span><span class="o">[</span><span class="n">STAB_ID</span><span class="o">]</span><span class="w"> </span><span class="nc">smallint</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="nc">nvarchar</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">@STAB_TAB</span><span class="w"> </span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">STAB_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="p">),</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">#ColumnListWithActions</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">Action</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'S'</span><span class="p">;</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@VAR_TAB</span><span class="w"> </span><span class="nc">TABLE</span><span class="w"> </span><span class="p">(</span><span class="o">[</span><span class="n">VAR_ID</span><span class="o">]</span><span class="w"> </span><span class="nc">smallint</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="nc">nvarchar</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">@VAR_TAB</span><span class="w"> </span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">VAR_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ROW_NUMBER</span><span class="p">()</span><span class="w"> </span><span class="k">OVER</span><span class="p">(</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="p">),</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">#ColumnListWithActions</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">Action</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'V'</span><span class="p">;</span>

<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@y</span><span class="w"> </span><span class="nc">smallint</span><span class="p">;</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@x</span><span class="w"> </span><span class="nc">smallint</span><span class="p">;</span>
<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@z</span><span class="w"> </span><span class="nc">smallint</span><span class="p">;</span>


<span class="k">DECLARE</span><span class="w"> </span><span class="nv">@FinalCode</span><span class="w"> </span><span class="nc">nvarchar</span><span class="p">(</span><span class="nf">max</span><span class="p">)</span>

<span class="k">SELECT</span><span class="w"> </span><span class="nv">@FinalCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">' SELECT ID1.*'</span>
<span class="w">                                        </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                                        </span><span class="k">WHILE</span><span class="w"> </span><span class="nv">@y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="o">[</span><span class="n">xxx_ID_xxx</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">##FinalTab</span><span class="p">)</span>
<span class="w">                                            </span><span class="k">BEGIN</span>
<span class="w">                                                </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                                                </span><span class="k">WHILE</span><span class="w"> </span><span class="nv">@z</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="o">[</span><span class="n">VAR_ID</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@VAR_TAB</span><span class="p">)</span>
<span class="w">                                                    </span><span class="k">BEGIN</span>
<span class="w">                                                        </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@FinalCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@FinalCode</span><span class="w"> </span><span class="o">+</span><span class="w">    </span><span class="s1">', [ID'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">CAST</span><span class="p">((</span><span class="nv">@y</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nc">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'.'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@VAR_TAB</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">VAR_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@z</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'] =  ID'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">CAST</span><span class="p">((</span><span class="nv">@y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nc">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'.'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@VAR_TAB</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">VAR_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@z</span><span class="p">)</span>
<span class="w">                                                        </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                                                    </span><span class="k">END</span>
<span class="w">                                                    </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                                                </span><span class="k">END</span>
<span class="w">        </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@FinalCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@FinalCode</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                                        </span><span class="s1">' FROM ( SELECT * FROM ##ALL_StableColumns)ID1'</span><span class="p">;</span>
<span class="w">                                        </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                                        </span><span class="k">WHILE</span><span class="w"> </span><span class="nv">@y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="o">[</span><span class="n">xxx_ID_xxx</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">##FinalTab</span><span class="p">)</span>
<span class="w">                                        </span><span class="k">BEGIN</span>
<span class="w">                                            </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                                            </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@FinalCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@FinalCode</span><span class="w"> </span>
<span class="w">                                                                                </span><span class="o">+</span><span class="w"> </span><span class="s1">' LEFT JOIN (SELECT '</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="nv">@ListOfColumns_Stable</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' , '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">@ListOfColumns_Variable</span><span class="w"> </span>
<span class="w">                                                                                </span><span class="o">+</span><span class="w"> </span><span class="s1">' FROM ##FinalTab WHERE [xxx_ID_xxx] = '</span><span class="w"> </span>
<span class="w">                                                                                </span><span class="o">+</span><span class="w"> </span><span class="nf">CAST</span><span class="p">(</span><span class="nv">@y</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nc">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' )ID'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">CAST</span><span class="p">((</span><span class="nv">@y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nc">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="w">  </span>
<span class="w">                                                                                </span><span class="o">+</span><span class="w"> </span><span class="s1">' ON 1 = 1'</span><span class="w"> </span>
<span class="w">                                                                                </span><span class="k">WHILE</span><span class="w"> </span><span class="nv">@x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="nf">MAX</span><span class="p">(</span><span class="o">[</span><span class="n">STAB_ID</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@STAB_TAB</span><span class="p">)</span>
<span class="w">                                                                                </span><span class="k">BEGIN</span>
<span class="w">                                                                                    </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@FinalCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@FinalCode</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' AND ID1.'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@STAB_TAB</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">STAB_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' = ID'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">CAST</span><span class="p">((</span><span class="nv">@y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nc">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">'.'</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">[</span><span class="n">ColumnName</span><span class="o">]</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">@STAB_TAB</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="o">[</span><span class="n">STAB_ID</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@x</span><span class="p">)</span>
<span class="w">                                                                                    </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@x</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span>
<span class="w">                                                                                </span><span class="k">END</span>
<span class="w">                                            </span><span class="k">SELECT</span><span class="w"> </span><span class="nv">@y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">@y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                                        </span><span class="k">END</span>

<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">##ALL_Dimentions</span><span class="p">;</span>
<span class="k">EXECUTE</span><span class="w"> </span><span class="n">SP_EXECUTESQL</span><span class="w"> </span><span class="nv">@FinalCode</span><span class="p">;</span>
</pre></div>

<p>From executing the first query (by passing source DB and table name) you will
get a pre-created execution query for the second SP, all you have to do is
define is the column from your source: + Stable + Value (will be used to
concentrate values based on that) + Dim (column you want to use to pivot by)</p>
<p>Names and datatypes will be defined automatically!</p>
<p>I cant recommend it for any production environments but does the job for adhoc
BI requests.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1723.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1721.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
