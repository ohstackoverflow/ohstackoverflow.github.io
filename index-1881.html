<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1881) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1881.html">
<link rel="prev" href="index-1882.html" type="text/html">
<link rel="next" href="index-1880.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-apply-opacity-to-a-css-color-variable/" class="u-url">How do I apply opacity to a CSS color variable?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-apply-opacity-to-a-css-color-variable/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T11:36:24+08:00" itemprop="datePublished" title="2023-03-03 11:36">2023-03-03 11:36</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am designing an app in electron, so I have access to CSS variables. I have
defined a color variable in <code>vars.css</code>:</p>
<div class="code"><pre class="code literal-block"><span class="p">:</span><span class="nd">root</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nv">--color</span><span class="p">:</span><span class="w"> </span><span class="mh">#f0f0f0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>I want to use this color in <code>main.css</code>, but with some opacity applied:</p>
<div class="code"><pre class="code literal-block"><span class="c1">#element {</span>
<span class="w">  </span><span class="n">background</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">somehow</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="k">var</span><span class="p">(</span><span class="o">--</span><span class="n">color</span><span class="p">)</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">opacity</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>How would I go about doing this? I am not using any preprocessor, only CSS. I
would prefer an all-CSS answer, but I will accept JavaScript/jQuery.</p>
<p>I cannot use <code>opacity</code> because I am using a background image that should not
be transparent.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can't take an existing color value and apply an alpha channel to it.
Namely, you can't take an existing hex value such as <code>#f0f0f0</code>, give it an
alpha component and use the resulting value with another property.</p>
<p>However, custom properties allow you to convert your hex value into an RGB
triplet for use with <code>rgba()</code>, store that value in the custom property
(including the commas!), substitute that value using <code>var()</code> into an <code>rgba()</code>
function with your desired alpha value, and it'll just work:</p>
<div class="code"><pre class="code literal-block">:root<span class="w"> </span>{
<span class="w">  </span>/*<span class="w"> </span>#f0f0f0<span class="w"> </span>in<span class="w"> </span>decimal<span class="w"> </span>RGB<span class="w"> </span>*/
<span class="w">  </span>--color:<span class="w"> </span>240,<span class="w"> </span>240,<span class="w"> </span>240;
}

body<span class="w"> </span>{
<span class="w">  </span>color:<span class="w"> </span>#000;
<span class="w">  </span>background-color:<span class="w"> </span>#000;
}

#element<span class="w"> </span>{
<span class="w">  </span>background-color:<span class="w"> </span>rgba(var(--color),<span class="w"> </span>0.8);
}


<span class="nt">&lt;p</span><span class="w"> </span><span class="na">id=</span><span class="s">"element"</span><span class="nt">&gt;</span>If<span class="w"> </span>you<span class="w"> </span>can<span class="w"> </span>see<span class="w"> </span>this,<span class="w"> </span>your<span class="w"> </span>browser<span class="w"> </span>supports<span class="w"> </span>custom<span class="w"> </span>properties.<span class="nt">&lt;/p&gt;</span>
</pre></div>

<p>This seems almost too good to be true.1 How does it work?</p>
<p>The magic lies in the fact that the values of custom properties are
substituted <em>as is</em> when replacing <code>var()</code> references in a property value,
<em>before</em> that property's value is computed. This means that as far as custom
properties are concerned, the value of <code>--color</code> in your example isn't a color
value at all <em>until</em> a <code>var(--color)</code> expression appears somewhere that
expects a color value (and only in that context). From section 2.1 of the css-
variables spec:</p>
<blockquote>
<p>The allowed syntax for custom properties is extremely permissive. The
<declaration-value> production matches any sequence of one or more tokens,
so long as the sequence does not contain <bad-string-token>, <bad-url- token>, unmatched &lt;)-token&gt;, &lt;]-token&gt;, or &lt;}-token&gt;, or top-level
<semicolon-token> tokens or <delim-token> tokens with a value of "!".</delim-token></semicolon-token></bad-url-></bad-string-token></declaration-value></p>
<p>For example, the following is a valid custom property:</p>
<div class="code"><pre class="code literal-block"><span class="nt">--foo</span><span class="o">:</span><span class="w"> </span><span class="nt">if</span><span class="o">(</span><span class="nt">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nt">5</span><span class="o">)</span><span class="w"> </span><span class="nt">this</span><span class="p">.</span><span class="nc">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">10</span><span class="o">;</span>
</pre></div>

<p>While this value is obviously useless as a variable, as it would be invalid
in any normal property, it might be read and acted on by JavaScript.</p>
</blockquote>
<p>And section 3:</p>
<blockquote>
<p>If a property contains one or more var() functions, and those functions are
syntactically valid, the entire property’s grammar must be assumed to be
valid at parse time. It is only syntax-checked at computed-value time, after
var() functions have been substituted.</p>
</blockquote>
<p>This means that the <code>240, 240, 240</code> value you see above gets substituted
directly into the <code>rgba()</code> function <em>before</em> the declaration is computed. So
this:</p>
<div class="code"><pre class="code literal-block"><span class="c1">#element {</span>
<span class="w">  </span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="k">var</span><span class="p">(</span><span class="o">--</span><span class="n">color</span><span class="p">),</span><span class="w"> </span><span class="mf">0.8</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>which doesn't appear to be valid CSS at first because <code>rgba()</code> expects no less
than four comma-separated numeric values, becomes this:</p>
<div class="code"><pre class="code literal-block"><span class="p">#</span><span class="nn">element</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="nb">rgba</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span><span class="w"> </span><span class="mi">240</span><span class="p">,</span><span class="w"> </span><span class="mi">240</span><span class="p">,</span><span class="w"> </span><span class="mf">0.8</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>which, of course, is perfectly valid CSS.</p>
<p>Taking it one step further, you can store the alpha component in its own
custom property:</p>
<div class="code"><pre class="code literal-block"><span class="p">:</span><span class="nd">root</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nv">--color</span><span class="p">:</span><span class="w"> </span><span class="mi">240</span><span class="p">,</span><span class="w"> </span><span class="mi">240</span><span class="p">,</span><span class="w"> </span><span class="mi">240</span><span class="p">;</span>
<span class="w">  </span><span class="nv">--alpha</span><span class="p">:</span><span class="w"> </span><span class="mf">0.8</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>and substitute it, with the same result:</p>
<div class="code"><pre class="code literal-block"><span class="c1">#element {</span>
<span class="w">  </span><span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="n">rgba</span><span class="p">(</span><span class="k">var</span><span class="p">(</span><span class="o">--</span><span class="n">color</span><span class="p">),</span><span class="w"> </span><span class="k">var</span><span class="p">(</span><span class="o">--</span><span class="n">alpha</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

<p>This allows you to have different alpha values that you can swap around on-
the-fly.</p>
<hr>
<p>1 Well, it is, if you're running the code snippet in a browser that doesn't
support custom properties.</p>
<p><br></p>
<h3>Suggest</h3>
<h2>Relative color syntax</h2>
<p>With this new CSS ability ( <em>css-color-5</em> ) which allows color format
transformations, it also will also allow adding opacity to any color in any
format, for example, to <code>RGB</code> (relative transformations can be done to any
other format):</p>
<div class="code"><pre class="code literal-block"><span class="n">html</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">--</span><span class="n">color</span><span class="p">:</span><span class="w"> </span><span class="n">blue</span><span class="w"> </span><span class="p">}</span>
<span class="o">.</span><span class="n">with</span><span class="o">-</span><span class="n">opacity</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">background</span><span class="p">:</span><span class="w"> </span><span class="n">rgb</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="k">var</span><span class="p">(</span><span class="o">--</span><span class="n">color</span><span class="p">)</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">50</span><span class="o">%</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
</pre></div>

<hr>
<p><em>(As of writing, not yet available in browsers. Will update once arrives)</em></p>
<h4>👉 Codepen demo</h4>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-override-trait-function-and-call-it-from-the-overridden-function/" class="u-url">How to override trait function and call it from the overridden function?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-override-trait-function-and-call-it-from-the-overridden-function/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T11:35:59+08:00" itemprop="datePublished" title="2023-03-03 11:35">2023-03-03 11:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Scenario:</p>
<div class="code"><pre class="code literal-block"><span class="nt">trait</span><span class="w"> </span><span class="nt">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">function</span><span class="w"> </span><span class="err">calc($v)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="err">return</span><span class="w"> </span><span class="err">$v+1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">}</span>

<span class="nt">class</span><span class="w"> </span><span class="nt">MyClass</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">use</span><span class="w"> </span><span class="err">A</span><span class="p">;</span>

<span class="w">    </span><span class="err">function</span><span class="w"> </span><span class="err">calc($v)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="err">$v++</span><span class="p">;</span>
<span class="w">        </span><span class="err">return</span><span class="w"> </span><span class="n">A</span><span class="p">:</span><span class="o">:</span><span class="nb">calc</span><span class="p">(</span><span class="err">$</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">}</span>

<span class="nt">print</span><span class="w"> </span><span class="o">(</span><span class="nt">new</span><span class="w"> </span><span class="nt">MyClass</span><span class="o">())</span><span class="nt">-</span><span class="o">&gt;</span><span class="nt">calc</span><span class="o">(</span><span class="nt">2</span><span class="o">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nt">should</span><span class="w"> </span><span class="nt">print</span><span class="w"> </span><span class="nt">4</span>
</pre></div>

<p>This code doesn't work, and I cannot find a way to call a trait function like
it was inherited. I tried calling <code>self::calc($v)</code>, <code>static::calc($v)</code>,
<code>parent::calc($v)</code>, <code>A::calc($v)</code> and the following:</p>
<div class="code"><pre class="code literal-block"><span class="nv">trait</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">function</span><span class="w"> </span><span class="nv">calc</span><span class="ss">(</span>$<span class="nv">v</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="k">return</span><span class="w"> </span>$<span class="nv">v</span><span class="o">+</span><span class="mi">1</span><span class="c1">;</span>
<span class="w">    </span>}
}

<span class="nv">class</span><span class="w"> </span><span class="nv">MyClass</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">use</span><span class="w"> </span><span class="nv">A</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">calc</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">traitcalc</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="nv">function</span><span class="w"> </span><span class="nv">calc</span><span class="ss">(</span>$<span class="nv">v</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span>$<span class="nv">v</span><span class="o">++</span><span class="c1">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">traitcalc</span><span class="ss">(</span>$<span class="nv">v</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<p>Nothing works.</p>
<p>Is there a way to make it work or must I override completely the trait
function which is much more complex than this :)</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Your last one was almost there:</p>
<div class="code"><pre class="code literal-block"><span class="n">trait</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">function</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="err">$</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="err">$</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">class</span><span class="w"> </span><span class="n">MyClass</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">use</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">calc</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="n">protected</span><span class="w"> </span><span class="n">traitcalc</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kr">function</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="err">$</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">$</span><span class="n">v</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">traitcalc</span><span class="p">(</span><span class="err">$</span><span class="n">v</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The trait is not a class. You can't access its members directly. It's
basically just automated copy and paste...</p>
<p><br></p>
<h3>Suggest</h3>
<p>If the class implements the method directly, it will not use the traits
version. Perhaps what you are thinking of is:</p>
<div class="code"><pre class="code literal-block"><span class="n">trait</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="o">$</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">v</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="n">MyClass</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="o">$</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">v</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="n">MyChildClass</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">MyClass</span><span class="p">{</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="n">MyTraitChildClass</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">MyClass</span><span class="p">{</span>
<span class="w">    </span><span class="n">use</span><span class="w"> </span><span class="n">A</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">print</span><span class="w"> </span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">MyChildClass</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">calc</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="mi">4</span>

<span class="nb">print</span><span class="w"> </span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">MyTraitChildClass</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">calc</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="mi">3</span>
</pre></div>

<p>Because the child classes do not implement the method directly, they will
first use that of the trait if there otherwise use that of the parent class.</p>
<p>If you want, the trait can use method in the parent class (assuming you know
the method would be there) e.g.</p>
<div class="code"><pre class="code literal-block"><span class="nt">trait</span><span class="w"> </span><span class="nt">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">function</span><span class="w"> </span><span class="err">calc($v)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="err">return</span><span class="w"> </span><span class="n">parent</span><span class="p">:</span><span class="o">:</span><span class="nb">calc</span><span class="p">(</span><span class="err">$</span><span class="n">v</span><span class="o">*</span><span class="mi">3</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="err">}</span>
<span class="o">//</span><span class="w"> </span><span class="o">....</span><span class="w"> </span><span class="nt">other</span><span class="w"> </span><span class="nt">code</span><span class="w"> </span><span class="nt">from</span><span class="w"> </span><span class="nt">above</span>
<span class="nt">print</span><span class="w"> </span><span class="o">(</span><span class="nt">new</span><span class="w"> </span><span class="nt">MyTraitChildClass</span><span class="o">())</span><span class="nt">-</span><span class="o">&gt;</span><span class="nt">calc</span><span class="o">(</span><span class="nt">2</span><span class="o">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nt">will</span><span class="w"> </span><span class="nt">print</span><span class="w"> </span><span class="nt">8</span><span class="w"> </span><span class="o">(</span><span class="nt">2</span><span class="o">*</span><span class="nt">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">2</span><span class="o">)</span>
</pre></div>

<p>You can also provide for ways to override, but still access the trait method
as follows:</p>
<div class="code"><pre class="code literal-block"><span class="n">trait</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">trait_calc</span><span class="p">(</span><span class="o">$</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">v</span><span class="o">*</span><span class="mi">3</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="n">MyClass</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="o">$</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">v</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="n">MyTraitChildClass</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">MyClass</span><span class="p">{</span>
<span class="w">    </span><span class="n">use</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">A</span><span class="p">::</span><span class="n">trait_calc</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">calc</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="n">MySecondTraitChildClass</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">MyClass</span><span class="p">{</span>
<span class="w">    </span><span class="n">use</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">A</span><span class="p">::</span><span class="n">trait_calc</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">calc</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="o">$</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">trait_calc</span><span class="p">(</span><span class="o">$</span><span class="n">v</span><span class="p">)</span><span class="o">+.</span><span class="mi">5</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


<span class="nb">print</span><span class="w"> </span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">MyTraitChildClass</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">calc</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="mi">6</span>
<span class="n">echo</span><span class="w"> </span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="nb">print</span><span class="w"> </span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">MySecondTraitChildClass</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">calc</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="mf">6.5</span>
</pre></div>

<p>You can see it work at
http://sandbox.onlinephpfunctions.com/code/e53f6e8f9834aea5e038aec4766ac7e1c19cc2b5</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/access-control-request-headers-is-added-to-header-in-ajax-request-with-jquery/" class="u-url">Access Control Request Headers, is added to header in AJAX request with jQuery</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/access-control-request-headers-is-added-to-header-in-ajax-request-with-jquery/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T11:35:34+08:00" itemprop="datePublished" title="2023-03-03 11:35">2023-03-03 11:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I would like to add a custom header to an AJAX POST request from jQuery.</p>
<p>I have tried this:</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="p">.</span><span class="nc">ajax</span><span class="o">(</span><span class="p">{</span>
<span class="w">    </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
<span class="w">    </span><span class="n">url</span><span class="o">:</span><span class="w"> </span><span class="n">url</span><span class="p">,</span>
<span class="w">    </span><span class="n">headers</span><span class="o">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="s2">"My-First-Header"</span><span class="o">:</span><span class="s2">"first value"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"My-Second-Header"</span><span class="o">:</span><span class="s2">"second value"</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="o">//</span><span class="nt">OR</span>
<span class="w">    </span><span class="o">//</span><span class="nt">beforeSend</span><span class="o">:</span><span class="w"> </span><span class="nt">function</span><span class="o">(</span><span class="nt">xhr</span><span class="o">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w">  </span><span class="err">xhr.setRequestHeader("My-First-Header",</span><span class="w"> </span><span class="err">"first</span><span class="w"> </span><span class="err">value")</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w">  </span><span class="err">xhr.setRequestHeader("My-Second-Header",</span><span class="w"> </span><span class="err">"second</span><span class="w"> </span><span class="err">value")</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="p">}</span>
<span class="err">}</span><span class="o">)</span><span class="p">.</span><span class="nc">done</span><span class="o">(</span><span class="nt">function</span><span class="o">(</span><span class="nt">data</span><span class="o">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="err">alert(data)</span><span class="p">;</span>
<span class="p">}</span><span class="o">);</span>
</pre></div>

<p>When I send this request and I watch with FireBug, I see this header:</p>
<blockquote>
<p>OPTIONS xxxx/yyyy HTTP/1.1<br>
 Host: 127.0.0.1:6666<br>
 User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:11.0) Gecko/20100101
Firefox/11.0<br>
 Accept: text/html,application/xhtml+xml,application/xml;q=0.9, <em>/</em> ;q=0.8<br>
 Accept-Language: fr,fr-fr;q=0.8,en-us;q=0.5,en;q=0.3<br>
 Accept-Encoding: gzip, deflate<br>
 Connection: keep-alive<br>
 Origin: null<br>
 Access-Control-Request-Method: POST<br><strong>Access-Control-Request-Headers: my-first-header,my-second-header</strong><br>
 Pragma: no-cache<br>
 Cache-Control: no-cache<br></p>
</blockquote>
<p>Why do my custom headers go to <code>Access-Control-Request-Headers</code>:</p>
<blockquote>
<p>Access-Control-Request-Headers: my-first-header,my-second-header</p>
</blockquote>
<p>I was expecting a header values like this:</p>
<blockquote>
<p>My-First-Header: first value<br>
 My-Second-Header: second value</p>
</blockquote>
<p>Is it possible?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>What you saw in Firefox was not the actual request; note that the HTTP method
is OPTIONS, not POST. It was actually the 'pre-flight' request that the
browser makes to determine whether a cross-domain AJAX request should be
allowed:</p>
<p>http://www.w3.org/TR/cors/</p>
<p>The Access-Control-Request-Headers header in the pre-flight request includes
the list of headers in the actual request. The server is then expected to
report back whether these headers are supported in this context or not, before
the browser submits the actual request.</p>
<p><br></p>
<h3>Suggest</h3>
<p>This code below works for me. I always use only single quotes, and it works
fine. I suggest you should use only single quotes <em>or</em> only double quotes, but
not mixed up.</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="p">.</span><span class="nc">ajax</span><span class="o">(</span><span class="p">{</span>
<span class="w">    </span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="s1">'YourRestEndPoint'</span><span class="p">,</span>
<span class="w">    </span><span class="n">headers</span><span class="o">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="s1">'Authorization'</span><span class="o">:</span><span class="s1">'Basic xxxxxxxxxxxxx'</span><span class="p">,</span>
<span class="w">        </span><span class="s1">'X-CSRF-TOKEN'</span><span class="o">:</span><span class="s1">'xxxxxxxxxxxxxxxxxxxx'</span><span class="p">,</span>
<span class="w">        </span><span class="s1">'Content-Type'</span><span class="o">:</span><span class="s1">'application/json'</span>
<span class="w">    </span><span class="p">}</span><span class="o">,</span>
<span class="w">    </span><span class="nt">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="o">,</span>
<span class="w">    </span><span class="nt">dataType</span><span class="o">:</span><span class="w"> </span><span class="s1">'json'</span><span class="o">,</span>
<span class="w">    </span><span class="nt">data</span><span class="o">:</span><span class="w"> </span><span class="nt">YourData</span><span class="o">,</span>
<span class="w">    </span><span class="nt">success</span><span class="o">:</span><span class="w"> </span><span class="nt">function</span><span class="o">(</span><span class="nt">data</span><span class="o">)</span><span class="p">{</span>
<span class="w">      </span><span class="err">console.log('</span><span class="n">succes</span><span class="p">:</span><span class="w"> </span><span class="err">'</span><span class="o">+</span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="err">}</span><span class="o">);</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1882.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1880.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
