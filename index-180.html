<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 180) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-180.html">
<link rel="prev" href="index-181.html" type="text/html">
<link rel="next" href="index-179.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/zhao-bu-dao-huo-wu-fa-jia-zai-zhu-lei-shi-shi-yao-yi-si/" class="u-url">“找不到或无法加载主类”是什么意思？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/zhao-bu-dao-huo-wu-fa-jia-zai-zhu-lei-shi-shi-yao-yi-si/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T00:09:03+08:00" itemprop="datePublished" title="2023-02-17 00:09">2023-02-17 00:09</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>新的 Java 开发人员遇到的一个常见问题是他们的程序无法运行并显示错误消息：<code>Could not find or load main class ...</code></p>
<p>这是什么意思，是什么原因造成的，您应该如何解决？</p>
<p><br><br></p>
<h2>解答</h2>
<h3>命令<code>java &lt;class-name&gt;</code>语法</h3>
<p>首先，您需要了解使用<code>java</code>（或<code>javaw</code>）命令启动程序的正确方法。</p>
<p>正常的语法1是这样的：</p>
<div class="code"><pre class="code literal-block">    java [ &lt;options&gt; ] &lt;class-name&gt; [&lt;arg&gt; ...]
</pre></div>

<p>其中<code>&lt;option&gt;</code>是命令行选项（以“-”字符开头），<code>&lt;class-name&gt;</code>是完全限定的 Java
类名，<code>&lt;arg&gt;</code>是传递给应用程序的任意命令行参数。</p>
<hr>
<p>1 - 在这个答案的末尾附近描述了一些其他语法。</p>
<p>类的完全限定名 (FQN) 按照惯例编写，就像在 Java 源代码中一样；例如</p>
<div class="code"><pre class="code literal-block">    packagename.packagename2.packagename3.ClassName
</pre></div>

<p>但是，某些版本的<code>java</code>命令允许您使用斜线而不是句号；例如</p>
<div class="code"><pre class="code literal-block">    packagename/packagename2/packagename3/ClassName
</pre></div>

<p>这（令人困惑地）看起来像一个文件路径名，但不是一个。请注意，术语 <em>完全限定名称</em> 是标准的 Java 术语......不是我编造的让你感到困惑的东西:-)</p>
<p>以下是命令的示例<code>java</code>：</p>
<div class="code"><pre class="code literal-block">    java -Xmx100m com.acme.example.ListUsers fred joe bert
</pre></div>

<p>以上将导致<code>java</code>命令执行以下操作：</p>
<ol>
<li>搜索<code>com.acme.example.ListUsers</code>类的编译版本。</li>
<li>加载类。</li>
<li>检查该类是否有一个带有 <em>签名的</em><code>main</code>方法， <em>返回类型</em> 和 <em>修饰符</em> 由. （注意，方法参数的名称不是 <strong>签名</strong> 的一部分。） <strong> </strong> __<code>public static void main(String[])</code> ****</li>
<li>调用该方法并将命令行参数（“fred”、“joe”、“bert”）作为<code>String[]</code>.</li>
</ol>
<h3>Java找不到类的原因</h3>
<p>当您收到消息“Could not find or load main class
...”时，这意味着第一步失败了。该<code>java</code>命令无法找到类。事实上，消息中的“...”将是要查找的 <em>完全限定的类名。</em><code>java</code></p>
<p>那么为什么它可能找不到类呢？</p>
<h3>原因 #1 - 你在类名参数上犯了一个错误</h3>
<p>第一个可能的原因是您可能提供了错误的类名。（或者...正确的类名，但格式不对。）考虑上面的例子，这里有多种指定类名的 <strong>错误方法：</strong></p>
<ul>
<li>示例 #1 - 一个简单的类名：<div class="code"><pre class="code literal-block">java ListUser
</pre></div>

</li>
</ul>
<p>当类在包中声明时，例如，您必须在命令中 <em>使用</em> 包含包名称的<code>com.acme.example</code>完整类名；例如 __<code>java</code></p>
<div class="code"><pre class="code literal-block">    java com.acme.example.ListUser
</pre></div>

<ul>
<li>
<p>示例 #2 - 文件名或路径名而不是类名：</p>
<div class="code"><pre class="code literal-block">java ListUser.class
</pre></div>

<p>java com/acme/example/ListUser.class</p>
</li>
<li>
<p>示例 #3 - 大小写不正确的类名：</p>
<div class="code"><pre class="code literal-block">java com.acme.example.listuser
</pre></div>

</li>
<li>
<p>示例 #4 - 错字</p>
<div class="code"><pre class="code literal-block">java com.acme.example.mistuser
</pre></div>

</li>
<li>
<p>示例 #5 - 源文件名（Java 11 或更高版本除外；见下文）</p>
<div class="code"><pre class="code literal-block">java ListUser.java
</pre></div>

</li>
<li>
<p>示例 #6 - 你完全忘记了类名</p>
<div class="code"><pre class="code literal-block">java lots of arguments
</pre></div>

</li>
</ul>
<h3>原因 #2 - 应用程序的类路径指定不正确</h3>
<p>第二个可能的原因是类名是正确的，但是命令<code>java</code>找不到类。要理解这一点，您需要理解“类路径”的概念。Oracle 文档对此进行了 <em>很好的</em> 解释：</p>
<ul>
<li>命令<code>java</code>文档</li>
<li>设置类路径。</li>
<li>Java 教程 - PATH 和 CLASSPATH</li>
</ul>
<p>所以...如果您正确指定了类名，接下来要检查的是您是否正确指定了类路径：</p>
<ol>
<li>阅读上面链接的三个文件。（是的......阅读它们！重要的是 Java 程序员至少 <em>了解Java 类路径机制如何工作的基础知识。）</em>
</li>
<li>查看运行命令时生效的命令行和/或 CLASSPATH 环境变量<code>java</code>。检查目录名和 JAR 文件名是否正确。</li>
<li>如果类路径中有 <em>相对</em> 路径名，请检查它们是否正确解析...从运行命令时生效的当前目录<code>java</code>。</li>
<li>检查类（错误消息中提到的）是否位于 <em>有效的</em> 类路径中。</li>
<li>请注意， Windows 与 Linux 和 Mac OS 的类路径语法 <em>不同。</em> （类路径分隔符<code>;</code>在 Windows 和<code>:</code>其他操作系统上。如果您为您的平台使用了错误的分隔符，您将不会收到明确的错误消息。相反，您将在路径上看到一个不存在的文件或目录，这些文件或目录将被静默忽略.)</li>
</ol>
<h3>原因 #2a - 类路径上有错误的目录</h3>
<p>当您将一个目录放在类路径中时，它在理论上对应于限定名称空间的根目录。 <em>通过将完全限定名称映射到路径名</em>
，类位于该根下的目录结构中。因此，例如，如果“/usr/local/acme/classes”在类路径上，那么当 JVM 查找名为
的类时，它将<code>com.acme.example.Foon</code>查找具有以下路径名的“.class”文件：</p>
<div class="code"><pre class="code literal-block">  /usr/local/acme/classes/com/acme/example/Foon.class
</pre></div>

<p>如果您将“/usr/local/acme/classes/com/acme/example”放在类路径中，那么 JVM 将无法找到该类。</p>
<h3>原因 #2b - 子目录路径与 FQN 不匹配</h3>
<p>如果您的类 FQN 是<code>com.acme.example.Foon</code>，那么 JVM
将在目录“com/acme/example”中寻找“Foon.class”：</p>
<ul>
<li>
<p>如果您的目录结构与上述模式中的包命名不匹配，JVM 将找不到您的类。</p>
</li>
<li>
<p>如果你试图通过移动它 <em>来重命名</em> 一个类，那也会失败......但异常堆栈跟踪会有所不同。它可能会说这样的话：</p>
<div class="code"><pre class="code literal-block">Caused by: java.lang.NoClassDefFoundError: &lt;path&gt; (wrong name: &lt;name&gt;)
</pre></div>

</li>
</ul>
<p>因为类文件中的 FQN 与类加载器期望找到的内容不匹配。</p>
<p>举一个具体的例子，假设：</p>
<ul>
<li>你想<code>com.acme.example.Foon</code>上课，</li>
<li>完整的文件路径是<code>/usr/local/acme/classes/com/acme/example/Foon.class</code>，</li>
<li>您当前的工作目录是<code>/usr/local/acme/classes/com/acme/example/</code>，</li>
</ul>
<p>然后：</p>
<div class="code"><pre class="code literal-block"># wrong, FQN is needed
java Foon

# wrong, there is no `com/acme/example` folder in the current working directory
java com.acme.example.Foon

# wrong, similar to above
java -classpath . com.acme.example.Foon

# fine; relative classpath set
java -classpath ../../.. com.acme.example.Foon

# fine; absolute classpath set
java -classpath /usr/local/acme/classes com.acme.example.Foon
</pre></div>

<p>笔记：</p>
<ul>
<li>在大多数 Java 版本中，该<code>-classpath</code>选项可以缩短为。检查等<code>-cp</code>的相应手册条目。<code>java``javac</code>
</li>
<li>在类路径中的绝对路径名和相对路径名之间进行选择时要仔细考虑。请记住，如果当前目录更改，相对路径名可能会“中断”。</li>
</ul>
<h3>原因 #2c - 类路径中缺少依赖项</h3>
<p>类路径需要包含您的应用程序所依赖的所有其他 <em>（</em> 非系统）类。（系统类是自动定位的，你很少需要关心这个。）为了正确加载主类，JVM 需要找到：</p>
<ul>
<li>班级本身。</li>
<li>超类层次结构中的所有类和接口（例如，请参阅类路径中存在 Java 类但启动失败并显示错误：无法找到或加载主类）</li>
<li>通过变量或变量声明、方法调用或字段访问表达式引用的所有类和接口。</li>
</ul>
<p>（注意：JLS 和 JVM 规范允许 JVM 在一定范围内“延迟”加载类，这会影响何时抛出类加载器异常。）</p>
<h3>原因 #3 - 该类已在错误的包中声明</h3>
<p>偶尔会发生有人将源代码文件放入其源代码树中的错误文件夹中，或者他们遗漏了声明<code>package</code>。如果您在 IDE 中执行此操作，IDE
的编译器将立即告诉您。同样，如果您使用合适的 Java 构建工具，该工具将以<code>javac</code>检测问题的方式运行。但是，如果您手动构建 Java
代码，编译器可能不会注意到问题，并且生成的“.class”文件不在您期望的位置。</p>
<h3>还是找不到问题？</h3>
<p>有很多东西要检查，很容易漏掉一些东西。尝试将选项添加<code>-Xdiag</code>到<code>java</code>命令行（作为
之后的第一件事<code>java</code>）。它将输出有关类加载的各种信息，这可能会为您提供有关真正问题所在的线索。</p>
<p>此外，请考虑从网站、文档等复制和粘贴不可见或非 ASCII
字符可能导致的问题。并考虑“homoglyphs”，其中两个字母或符号看起来相同......但不是。</p>
<p>You may run into this problem if you have invalid or incorrect signatures in
<code>META-INF/*.SF</code>. You can try opening up the .jar in your favorite ZIP editor,
and removing files from <code>META-INF</code> until all you have is your <code>MANIFEST.MF</code>.
However this is NOT RECOMMENDED in general. (The invalid signature may be the
result of someone having injected malware into the original signed JAR file.
If you erase the invalid signature, you are in infecting your application with
the malware!) The recommended approach is to get hold of JAR files with valid
signatures, or rebuild them from the (authentic) original source code.</p>
<p>Finally, you can apparently run into this problem if there is a syntax error
in the <code>MANIFEST.MF</code> file (see https://stackoverflow.com/a/67145190/139985).</p>
<hr>
<h3>Alternative syntaxes for <code>java</code>
</h3>
<p>There are three alternative syntaxes for the launching Java programs using the
<code>java command</code>.</p>
<ol>
<li>The syntax used for launching an "executable" JAR file is as follows:<div class="code"><pre class="code literal-block">java [ &lt;options&gt; ] -jar &lt;jar-file-name&gt; [&lt;arg&gt; ...]
</pre></div>

</li>
</ol>
<p>e.g.</p>
<div class="code"><pre class="code literal-block">    java -Xmx100m -jar /usr/local/acme-example/listuser.jar fred
</pre></div>

<p>The name of the entry-point class (i.e. <code>com.acme.example.ListUser</code>) and the
classpath are specified in the MANIFEST of the JAR file.</p>
<ol>
<li>The syntax for launching an application from a module (Java 9 and later) is as follows:<div class="code"><pre class="code literal-block">java [ &lt;options&gt; ] --module &lt;module&gt;[/&lt;mainclass&gt;] [&lt;arg&gt; ...]
</pre></div>

</li>
</ol>
<p>The name of the entrypoint class is either defined by the <code>&lt;module&gt;</code> itself,
or is given by the optional <code>&lt;mainclass&gt;</code>.</p>
<ol>
<li>From Java 11 onwards, you can use the <code>java</code> command to compile and run a single source code file using the following syntax:<div class="code"><pre class="code literal-block">java [ &lt;options&gt; ] &lt;sourcefile&gt; [&lt;arg&gt; ...]
</pre></div>

</li>
</ol>
<p>where <code>&lt;sourcefile&gt;</code> is (typically) a file with the suffix ".java".</p>
<p>For more details, please refer to the official documentation for the <code>java</code>
command for the Java release that you are using.</p>
<hr>
<h3>IDEs</h3>
<p>A typical Java IDE has support for running Java applications in the IDE JVM
itself or in a child JVM. These are <em>generally</em> immune from this particular
exception, because the IDE uses its own mechanisms to construct the runtime
classpath, identify the main class and create the <code>java</code> command line.</p>
<p>However it is still possible for this exception to occur, if you do things
behind the back of the IDE. For example, if you have previously set up an
Application Launcher for your Java app in Eclipse, and you then moved the JAR
file containing the "main" class to a different place in the file system
<em>without telling Eclipse</em> , Eclipse would unwittingly launch the JVM with an
incorrect classpath.</p>
<p>In short, if you get this problem in an IDE, check for things like stale IDE
state, broken project references or broken launcher configurations.</p>
<p>It is also possible for an IDE to simply get confused. IDE's are hugely
complicated pieces of software comprising many interacting parts. Many of
these parts adopt various caching strategies in order to make the IDE as a
whole responsive. These can sometimes go wrong, and one possible symptom is
problems when launching applications. If you suspect this could be happening,
it is worth trying other things like restarting your IDE, rebuilding the
project and so on.</p>
<hr>
<h3>Other References</h3>
<ul>
<li>From the Oracle Java Tutorials - Common Problems (and Their Solutions)</li>
</ul>
<p><br></p>
<h3>更多建议</h3>
<p>如果您的源代码名称是 HelloWorld.java，那么您的编译代码将是<code>HelloWorld.class</code>.</p>
<p>如果您使用以下方式调用它，您将收到该错误：</p>
<div class="code"><pre class="code literal-block">java HelloWorld.class
</pre></div>

<p>相反，使用这个：</p>
<div class="code"><pre class="code literal-block">java HelloWorld
</pre></div>

<p><br><br><a href="posts/what-does-could-not-find-or-load-main-class-mean/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/shi-zhong-zai-xin-xuan-xiang-qia-zhong-da-kai-wen-jian/" class="u-url">始终在新选项卡中打开文件</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/shi-zhong-zai-xin-xuan-xiang-qia-zhong-da-kai-wen-jian/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T00:08:27+08:00" itemprop="datePublished" title="2023-02-17 00:08">2023-02-17 00:08</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我正在使用带有新引入的选项卡的 Visual Studio Code 1.3.1。</p>
<p>当我单击文件时，第一个文件将在选项卡中打开。如果我不对此文件进行任何更改，则单击的第二个文件将在同一选项卡中打开。</p>
<p>我怎样才能避免这种情况并使 Visual Studio Code 始终打开一个新选项卡？</p>
<p><br><br></p>
<h2>解答</h2>
<p>当您在左侧边栏的文件浏览器中 [单击] 文件或从快速打开菜单（<code>Ctrl</code>- <code>P</code>，键入文件名，<code>Enter</code>）打开它时，Visual Studio
Code 会以所谓的“预览模式”打开它，这使您可以快速 <strong>查看</strong> 文件。</p>
<p>预览模式选项卡不会保持打开状态。一旦您从侧边栏打开另一个文件，就会使用现有的预览模式选项卡（如果存在）。您可以通过查看选项卡栏中的标题来确定选项卡是否处于预览模式。如果标题为
<em>italic</em> ，则该选项卡处于预览模式。</p>
<p>要打开文件进行编辑（即不要在预览模式下打开），请双击边栏中的文件，或在边栏中单击它，然后双击其预览模式选项卡的标题。</p>
<p>如果您想一起禁用预览模式，可以通过<code>"workbench.editor.enablePreview":
false</code>在设置文件中进行设置来实现。您还可以使用该<code>"workbench.editor.enablePreviewFromQuickOpen"</code>选项仅从快速打开菜单中禁用它。</p>
<p>在您可以禁用预览模式之前，您需要打开您的设置文件。</p>
<p><strong>专业提示</strong> ：您可以使用命令面板（快捷键 Ctrl+Shift+P）打开您的设置文件，只需输入“ <code>Preferences: Open User
Settings</code>”！</p>
<p>打开设置文件（您 <em>的</em>
设置文件应位于右侧）后，添加该<code>"workbench.editor.enablePreview"</code>属性，并将其值设置为<code>false</code>.</p>
<p>您可以在此处了解有关 Visual Studio Code 的“预览模式”的更多信息。</p>
<p><br></p>
<h3>更多建议</h3>
<p>如果您不想禁用 <em>预览模式，</em> 您可以明确告知<code>vscode</code>让特定选项卡保持打开状态。如上所述，带有斜体文本的选项卡标题处于 <em>预览模式</em> 。</p>
<p>要使选项卡退出 <em>预览模式，</em> 您可以右键单击选项卡并选择或使用映射到命令的<code>keep open</code>快捷方式<code>cmd</code>+ 。<code>k</code>
<code>enter``workbench.action.keepEditor</code></p>
<p>此外，双击选项卡也会使其退出 <em>预览模式</em> （在<code>vscode</code>1.44.0 中验证）。</p>
<p><br><br><a href="posts/open-files-always-in-a-new-tab/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/promises-he-observables-you-shi-yao-qu-bie/" class="u-url">Promises 和 Observables 有什么区别？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/promises-he-observables-you-shi-yao-qu-bie/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T00:07:35+08:00" itemprop="datePublished" title="2023-02-17 00:07">2023-02-17 00:07</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p><code>Promise</code>Angular和Angular之间有什么区别<code>Observable</code>？</p>
<p>每个例子都有助于理解这两种情况。我们可以在什么情况下使用每个案例？</p>
<p><br><br></p>
<h2>解答</h2>
<p><strong>承诺</strong></p>
<p>A在异步操作完成或失败时<code>Promise</code>处理 <strong>单个事件。</strong></p>
<p>注意：有些<code>Promise</code>库支持取消，但 ES6<code>Promise</code>目前还不支持。</p>
<p><strong>可观察的</strong></p>
<p>An<code>Observable</code>类似于 a <strong><code>Stream</code></strong> （在许多语言中）并允许传递零个或多个事件，其中为每个事件调用回调。</p>
<p>通常<code>Observable</code>是首选，<code>Promise</code>因为它提供了和更多的功能<code>Promise</code>。<code>Observable</code>处理 0 个、1
个或多个事件都没有关系。您可以在每种情况下使用相同的 API。</p>
<p><code>Observable``Promise</code>也比可取消 <strong>具有</strong> 优势。如果不再需要对服务器的 HTTP 请求或其他一些昂贵的异步操作的结果，则
an<code>Subscription</code>允许<code>Observable</code>取消订阅，而 a<code>Promise</code>最终会调用成功或失败的回调，即使您不需要通知或它提供的结果了。</p>
<p>虽然 a<code>Promise</code>会立即启动，但<code>Observable</code>只有在您订阅后才会启动。这就是 Observable 被称为惰性的原因。</p>
<p>Observable 提供类似于数组的 <strong>运算符</strong> ，如<code>map</code>, <code>forEach</code>, , ...<code>reduce</code></p>
<p>还有一些功能强大的运算符，例如<code>retry()</code>, or <code>replay()</code>, ... 通常非常方便。rxjs 附带的运算符列表</p>
<p>延迟执行允许在通过订阅执行可观察对象之前建立一个运算符链，以进行更具声明性的编程。</p>
<p><br></p>
<h3>更多建议</h3>
<p>和<code>Promises</code>都<code>Observables</code>为我们提供了抽象，帮助我们处理应用程序的 <strong>异步性质。</strong>
Günter和@Relu清楚地指出了它们之间的区别。</p>
<p>由于一个代码片段抵得上一千个单词，让我们通过下面的示例来更容易地理解它们。</p>
<blockquote>
<p>感谢@Christoph Burgdorf 的精彩文章</p>
</blockquote>
<hr>
<p>Angular 使用 Rx.js Observables 而不是 promises 来处理 HTTP。</p>
<p>假设您正在构建一个 <strong>搜索功能</strong> ，该功能应在您键入时立即显示结果。这听起来很熟悉，但这项任务伴随着许多挑战。</p>
<ul>
<li>我们不希望每次用户按下一个键时都访问服务器端点。它应该用大量的HTTP请求淹没它们。基本上，我们只想在用户停止输入而不是每次击键时点击它。</li>
<li>不要为后续请求使用 <strong>相同的查询参数命中搜索端点。</strong>
</li>
<li>处理乱序响应。当我们同时有多个请求在进行中时，我们必须考虑到它们以意想不到的顺序返回的情况。想象一下，我们首先输入 <strong>computer</strong> ，停止，一个请求发出，我们输入 <strong>car</strong> ，停止，一个请求发出。现在我们有两个正在处理的请求。 <strong>不幸的是，携带computer</strong> 结果的请求在携带 <strong>car</strong> 结果的请求之后返回。</li>
</ul>
<p>该演示将仅包含两个文件：<code>app.ts</code>和<code>wikipedia-service.ts</code>. 不过，在现实世界中，我们很可能会将事情进一步拆分。</p>
<hr>
<p>下面是一个 <strong>基于 Promise 的</strong> 实现，它不处理任何描述的边缘情况。</p>
<p><code>wikipedia-service.ts</code></p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="p">{</span> <span class="n">Injectable</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">URLSearchParams</span><span class="p">,</span> <span class="n">Jsonp</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'@angular/http'</span><span class="p">;</span>

<span class="nd">@Injectable</span><span class="p">()</span>
<span class="n">export</span> <span class="k">class</span> <span class="nc">WikipediaService</span> <span class="p">{</span>
  <span class="n">constructor</span><span class="p">(</span><span class="n">private</span> <span class="n">jsonp</span><span class="p">:</span> <span class="n">Jsonp</span><span class="p">)</span> <span class="p">{}</span>

  <span class="n">search</span> <span class="p">(</span><span class="n">term</span><span class="p">:</span> <span class="n">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">search</span> <span class="o">=</span> <span class="n">new</span> <span class="n">URLSearchParams</span><span class="p">()</span>
    <span class="n">search</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'action'</span><span class="p">,</span> <span class="s1">'opensearch'</span><span class="p">);</span>
    <span class="n">search</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'search'</span><span class="p">,</span> <span class="n">term</span><span class="p">);</span>
    <span class="n">search</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'format'</span><span class="p">,</span> <span class="s1">'json'</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">this</span><span class="o">.</span><span class="n">jsonp</span>
                <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'http://en.wikipedia.org/w/api.php?callback=JSONP_CALLBACK'</span><span class="p">,</span> <span class="p">{</span> <span class="n">search</span> <span class="p">})</span>
                <span class="o">.</span><span class="n">toPromise</span><span class="p">()</span>
                <span class="o">.</span><span class="n">then</span><span class="p">((</span><span class="n">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>我们正在注入服务，以使用给定的搜索词对 <strong>Wikipedia API</strong><code>Jsonp</code>发出GET请求。请注意，我们调用是为了从 an到 a 。最终以
a作为我们搜索方法的返回类型。
****<code>toPromise``Observable&lt;Response&gt;``Promise&lt;Response&gt;``Promise&lt;Array&lt;string&gt;&gt;</code></p>
<p><code>app.ts</code></p>
<div class="code"><pre class="code literal-block"><span class="o">//</span> <span class="n">check</span> <span class="n">the</span> <span class="n">plnkr</span> <span class="k">for</span> <span class="n">the</span> <span class="n">full</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">imports</span>
<span class="kn">import</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span> <span class="kn">from</span> <span class="s1">'...'</span><span class="p">;</span>

<span class="nd">@Component</span><span class="p">({</span>
  <span class="n">selector</span><span class="p">:</span> <span class="s1">'my-app'</span><span class="p">,</span>
  <span class="n">template</span><span class="p">:</span> <span class="err">`</span>
    <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">h2</span><span class="o">&gt;</span><span class="n">Wikipedia</span> <span class="n">Search</span><span class="o">&lt;/</span><span class="n">h2</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nb">input</span> <span class="c1">#term type="text" (keyup)="search(term.value)"&gt;</span>
      <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">li</span> <span class="o">*</span><span class="n">ngFor</span><span class="o">=</span><span class="s2">"let item of items"</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">item</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
  <span class="err">`</span>
<span class="p">})</span>
<span class="n">export</span> <span class="k">class</span> <span class="nc">AppComponent</span> <span class="p">{</span>
  <span class="n">items</span><span class="p">:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="n">constructor</span><span class="p">(</span><span class="n">private</span> <span class="n">wikipediaService</span><span class="p">:</span> <span class="n">WikipediaService</span><span class="p">)</span> <span class="p">{}</span>

  <span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">this</span><span class="o">.</span><span class="n">wikipediaService</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">items</span> <span class="o">=&gt;</span> <span class="n">this</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>这里也没有太多惊喜。我们<code>WikipediaService</code>通过搜索方法向模板注入并公开其功能。该模板简单地绑定到 <strong>keyup</strong>
并调用<code>search(term.value)</code>.</p>
<p><strong>我们解开 WikipediaService 的搜索方法返回的Promise</strong>
的结果，并将其作为一个简单的字符串数组公开给模板，以便我们可以<code>*ngFor</code>循环遍历它并为我们建立一个列表。</p>
<p>请参阅Plunker上 <strong>基于 Promise</strong> 的实现示例</p>
<hr>
<p><strong>Observables</strong> 真正闪耀的地方</p>
<p><strong>让我们更改我们的代码，使其不再在每次击键时敲打端点，而是仅在用户停止输入400 毫秒</strong> 后才发送请求 ****</p>
<p>要揭示这种超能力，我们首先需要获得一个<code>Observable&lt;string&gt;</code>带有用户输入的搜索词的 。我们可以利用 Angular
的<code>formControl</code>指令，而不是手动绑定到 keyup
事件。要使用此指令，我们首先需要将其导入<code>ReactiveFormsModule</code>到我们的应用程序模块中。</p>
<p><code>app.ts</code></p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="p">{</span> <span class="n">NgModule</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">BrowserModule</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'@angular/platform-browser'</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">JsonpModule</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'@angular/http'</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">ReactiveFormsModule</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">'@angular/forms'</span><span class="p">;</span>

<span class="nd">@NgModule</span><span class="p">({</span>
  <span class="n">imports</span><span class="p">:</span> <span class="p">[</span><span class="n">BrowserModule</span><span class="p">,</span> <span class="n">JsonpModule</span><span class="p">,</span> <span class="n">ReactiveFormsModule</span><span class="p">]</span>
  <span class="n">declarations</span><span class="p">:</span> <span class="p">[</span><span class="n">AppComponent</span><span class="p">],</span>
  <span class="n">bootstrap</span><span class="p">:</span> <span class="p">[</span><span class="n">AppComponent</span><span class="p">]</span>
<span class="p">})</span>
<span class="n">export</span> <span class="k">class</span> <span class="nc">AppModule</span> <span class="p">{}</span>
</pre></div>

<p>导入后，我们可以在模板中使用 formControl 并将其设置为名称“term”。</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="k">input</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="ss">"text"</span><span class="w"> </span><span class="o">[</span><span class="n">formControl</span><span class="o">]=</span><span class="ss">"term"</span><span class="o">/&gt;</span>
</pre></div>

<p><code>FormControl</code>在我们的组件中，我们创建了一个from的实例<code>@angular/form</code>，并将其作为我们组件上名称术语下的字段公开。</p>
<p>在幕后， <strong>term</strong> 自动公开一个我们可以订阅的<code>Observable&lt;string&gt;</code>as
属性。<code>valueChanges</code>现在我们有了一个<code>Observable&lt;string&gt;</code>，克服用户输入就像调用<code>debounceTime(400)</code>我们的<code>Observable</code>.
这将返回一个新值<code>Observable&lt;string&gt;</code>，只有在 400 毫秒内没有出现新值时才会发出新值。</p>
<div class="code"><pre class="code literal-block"><span class="k">export</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">App</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">items</span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">Array</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="n">term</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">FormControl</span><span class="p">();</span>
<span class="w">  </span><span class="n">constructor</span><span class="p">(</span><span class="n">private</span><span class="w"> </span><span class="n">wikipediaService</span><span class="p">:</span><span class="w"> </span><span class="n">WikipediaService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">term</span><span class="o">.</span><span class="n">valueChanges</span>
<span class="w">              </span><span class="o">.</span><span class="n">debounceTime</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span><span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">wait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mi">400</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="n">pause</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">events</span>
<span class="w">              </span><span class="o">.</span><span class="n">distinctUntilChanged</span><span class="p">()</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">ignore</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="n">search</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">previous</span>
<span class="w">              </span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">term</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">wikipediaService</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">term</span><span class="p">)</span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">items</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>为我们的应用程序已经显示结果的搜索词发送另一个请求将是一种资源浪费。为了实现所需的行为，我们所要做的就是<code>distinctUntilChanged</code>在我们调用之后立即调用操作员<code>debounceTime(400)</code></p>
<p>请参阅Plunker上 <strong>Observable</strong> 实现的示例</p>
<blockquote>
<p>对于乱序响应的处理，请查看全文http://blog.thoughtram.io/angular/2016/01/06/taking-
advantage-of-observables-in-angular2.html</p>
</blockquote>
<p>就我在 Angular 中使用 HTTP 而言，我同意在正常用例中使用 Observable 而不是 Promise
没有太大区别。在实践中，这些优势都与这里无关。我希望将来能看到一些高级用例:)</p>
<hr>
<blockquote>
<p>了解更多</p>
<ul>
<li>https://angular-2-training-book.rangle.io/handout/observables/</li>
<li>https://angular.io/tutorial/toh-pt6#observables
</li>
</ul>
</blockquote>
<p><br><br><a href="posts/what-is-the-difference-between-promises-and-observables/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-181.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-179.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
