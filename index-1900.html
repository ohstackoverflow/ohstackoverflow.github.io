<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1900) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1900.html">
<link rel="prev" href="index-1901.html" type="text/html">
<link rel="next" href="index-1899.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/junit-5-how-to-assert-an-exception-is-thrown/" class="u-url">JUnit 5: How to assert an exception is thrown?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/junit-5-how-to-assert-an-exception-is-thrown/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T12:04:59+08:00" itemprop="datePublished" title="2023-03-03 12:04">2023-03-03 12:04</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Is there a better way to assert that a method throws an exception in JUnit 5?</p>
<p>Currently, I have to use an @Rule in order to verify that my test throws an
exception, but this doesn't work for the cases where I expect multiple methods
to throw exceptions in my test.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can use <code>assertThrows()</code>, which allows you to test multiple exceptions
within the same test. With support for lambdas in Java 8, this is the
canonical way to test for exceptions in JUnit.</p>
<p>Per the JUnit docs:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="n">junit</span><span class="o">.</span><span class="n">jupiter</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">Assertions</span><span class="o">.</span><span class="n">assertThrows</span><span class="p">;</span>

<span class="nd">@Test</span>
<span class="n">void</span> <span class="n">exceptionTesting</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">MyException</span> <span class="n">thrown</span> <span class="o">=</span> <span class="n">assertThrows</span><span class="p">(</span>
           <span class="n">MyException</span><span class="o">.</span><span class="n">class</span><span class="p">,</span>
           <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">myObject</span><span class="o">.</span><span class="n">doThing</span><span class="p">(),</span>
           <span class="s2">"Expected doThing() to throw, but it didn't"</span>
    <span class="p">);</span>

    <span class="n">assertTrue</span><span class="p">(</span><span class="n">thrown</span><span class="o">.</span><span class="n">getMessage</span><span class="p">()</span><span class="o">.</span><span class="n">contentEquals</span><span class="p">(</span><span class="s2">"Stuff"</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>In Java 8 and JUnit 5 (Jupiter) we can assert for exceptions as follows. Using
<code>org.junit.jupiter.api.Assertions.assertThrows</code></p>
<blockquote>
<p><strong>public static &lt; T extends Throwable &gt; T assertThrows(Class&lt; T &gt;
expectedType, Executable executable)</strong></p>
<p>Asserts that execution of the supplied executable throws an exception of the
expectedType and returns the exception.</p>
<p>If no exception is thrown, or if an exception of a different type is thrown,
this method will fail.</p>
<p>If you do not want to perform additional checks on the exception instance,
simply ignore the return value.</p>
</blockquote>
<div class="code"><pre class="code literal-block"><span class="nv">@Test</span>
<span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">itShouldThrowNullPointerExceptionWhenBlahBlah</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">assertThrows</span><span class="p">(</span><span class="n">NullPointerException</span><span class="p">.</span><span class="k">class</span><span class="p">,</span>
<span class="w">            </span><span class="p">()</span><span class="o">-&gt;</span><span class="err">{</span>
<span class="w">            </span><span class="o">//</span><span class="n">do</span><span class="w"> </span><span class="n">whatever</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">here</span>
<span class="w">            </span><span class="o">//</span><span class="n">ex</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="n">objectName</span><span class="p">.</span><span class="n">thisMethodShoulThrowNullPointerExceptionForNullParameter</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
<span class="w">            </span><span class="err">}</span><span class="p">);</span>
<span class="err">}</span>
</pre></div>

<p>That approach will use the Functional Interface <code>Executable</code> in
<code>org.junit.jupiter.api</code>.</p>
<p>Refer :</p>
<ul>
<li>http://junit.org/junit5/docs/current/user-guide/#writing-tests-assertions</li>
<li>http://junit.org/junit5/docs/5.0.0-M2/api/org/junit/jupiter/api/Executable.html</li>
<li>http://junit.org/junit5/docs/5.0.0-M4/api/org/junit/jupiter/api/Assertions.html#assertThrows-java.lang.Class-org.junit.jupiter.api.function.Executable-</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-properly-handle-404-in-asp-net-mvc/" class="u-url">How can I properly handle 404 in ASP.NET MVC?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-properly-handle-404-in-asp-net-mvc/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T12:04:29+08:00" itemprop="datePublished" title="2023-03-03 12:04">2023-03-03 12:04</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am using RC2</p>
<p><strong>Using URL Routing:</strong></p>
<div class="code"><pre class="code literal-block">routes.MapRoute(
    "Error",
     "{*url}",
     new { controller = "Errors", action = "NotFound" }  // 404s
);
</pre></div>

<p>The above seems to take care of requests like this (assuming default route
tables setup by initial MVC project): "/blah/blah/blah/blah"</p>
<p><strong>Overriding HandleUnknownAction() in the controller itself:</strong></p>
<div class="code"><pre class="code literal-block"><span class="c1">// 404s - handle here (bad action requested</span>
<span class="n">protected</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">HandleUnknownAction</span><span class="p">(</span><span class="nb">string</span><span class="w"> </span><span class="n">actionName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ViewData</span><span class="p">[</span><span class="s">"actionName"</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">actionName</span><span class="p">;</span>
<span class="w">    </span><span class="n">View</span><span class="p">(</span><span class="s">"NotFound"</span><span class="p">).</span><span class="n">ExecuteResult</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">ControllerContext</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>However the previous strategies do not handle a request to a Bad/Unknown
controller. For example, I do not have a "/IDoNotExist", if I request this I
get the generic 404 page from the web server and not my 404 if I use routing +
override.</p>
<p>So finally, my question is: <em>Is there any way to catch this type of request
using a route or something else in the MVC framework itself?</em></p>
<p>OR should I just default to using Web.Config customErrors as my 404 handler
and forget all this? I assume if I go with customErrors I'll have to store the
generic 404 page outside of /Views due to the Web.Config restrictions on
direct access.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The code is taken from
http://blogs.microsoft.co.il/blogs/shay/archive/2009/03/06/real-world-error-
hadnling-in-asp-net-mvc-rc2.aspx and works in ASP.net MVC 1.0 as well</p>
<p>Here's how I handle http exceptions:</p>
<div class="code"><pre class="code literal-block"><span class="nt">protected</span><span class="w"> </span><span class="nt">void</span><span class="w"> </span><span class="nt">Application_Error</span><span class="o">(</span><span class="nt">object</span><span class="w"> </span><span class="nt">sender</span><span class="o">,</span><span class="w"> </span><span class="nt">EventArgs</span><span class="w"> </span><span class="nt">e</span><span class="o">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="err">Exception</span><span class="w"> </span><span class="err">exception</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">Server.GetLastError()</span><span class="p">;</span>
<span class="w">   </span><span class="err">//</span><span class="w"> </span><span class="err">Log</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">exception.</span>

<span class="w">   </span><span class="err">ILogger</span><span class="w"> </span><span class="err">logger</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">Container.Resolve&lt;ILogger&gt;()</span><span class="p">;</span>
<span class="w">   </span><span class="err">logger.Error(exception)</span><span class="p">;</span>

<span class="w">   </span><span class="err">Response.Clear()</span><span class="p">;</span>

<span class="w">   </span><span class="err">HttpException</span><span class="w"> </span><span class="err">httpException</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">exception</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="err">HttpException</span><span class="p">;</span>

<span class="w">   </span><span class="err">RouteData</span><span class="w"> </span><span class="err">routeData</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">RouteData()</span><span class="p">;</span>
<span class="w">   </span><span class="err">routeData.Values.Add("controller",</span><span class="w"> </span><span class="err">"Error")</span><span class="p">;</span>

<span class="w">   </span><span class="err">if</span><span class="w"> </span><span class="err">(httpException</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="err">null)</span>
<span class="w">   </span><span class="err">{</span>
<span class="w">       </span><span class="err">routeData.Values.Add("action",</span><span class="w"> </span><span class="err">"Index")</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="nt">else</span><span class="w"> </span><span class="o">//</span><span class="nt">It</span><span class="s1">'s an Http Exception, Let'</span><span class="nt">s</span><span class="w"> </span><span class="nt">handle</span><span class="w"> </span><span class="nt">it</span><span class="o">.</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">       </span><span class="err">switch</span><span class="w"> </span><span class="err">(httpException.GetHttpCode())</span>
<span class="w">       </span><span class="err">{</span>
<span class="w">          </span><span class="err">case</span><span class="w"> </span><span class="err">404:</span>
<span class="w">              </span><span class="err">//</span><span class="w"> </span><span class="err">Page</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">found.</span>
<span class="w">              </span><span class="err">routeData.Values.Add("action",</span><span class="w"> </span><span class="err">"HttpError404")</span><span class="p">;</span>
<span class="w">              </span><span class="err">break</span><span class="p">;</span>
<span class="w">          </span><span class="err">case</span><span class="w"> </span><span class="err">500:</span>
<span class="w">              </span><span class="err">//</span><span class="w"> </span><span class="err">Server</span><span class="w"> </span><span class="err">error.</span>
<span class="w">              </span><span class="err">routeData.Values.Add("action",</span><span class="w"> </span><span class="err">"HttpError500")</span><span class="p">;</span>
<span class="w">              </span><span class="err">break</span><span class="p">;</span>

<span class="w">           </span><span class="err">//</span><span class="w"> </span><span class="err">Here</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">can</span><span class="w"> </span><span class="err">handle</span><span class="w"> </span><span class="err">Views</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">error</span><span class="w"> </span><span class="err">codes.</span>
<span class="w">           </span><span class="err">//</span><span class="w"> </span><span class="err">I</span><span class="w"> </span><span class="err">choose</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">General</span><span class="w"> </span><span class="err">error</span><span class="w"> </span><span class="err">template</span><span class="w">  </span>
<span class="w">           </span><span class="n">default</span><span class="p">:</span>
<span class="w">              </span><span class="n">routeData</span><span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">"action"</span><span class="p">,</span><span class="w"> </span><span class="s2">"General"</span><span class="p">);</span>
<span class="w">              </span><span class="err">break</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="err">}</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nt">Pass</span><span class="w"> </span><span class="nt">exception</span><span class="w"> </span><span class="nt">details</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">target</span><span class="w"> </span><span class="nt">error</span><span class="w"> </span><span class="nt">View</span><span class="o">.</span>
<span class="w">  </span><span class="nt">routeData</span><span class="p">.</span><span class="nc">Values</span><span class="p">.</span><span class="nc">Add</span><span class="o">(</span><span class="s2">"error"</span><span class="o">,</span><span class="w"> </span><span class="nt">exception</span><span class="o">);</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nt">Clear</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">error</span><span class="w"> </span><span class="nt">on</span><span class="w"> </span><span class="nt">server</span><span class="o">.</span>
<span class="w">  </span><span class="nt">Server</span><span class="p">.</span><span class="nc">ClearError</span><span class="o">();</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nt">Avoid</span><span class="w"> </span><span class="nt">IIS7</span><span class="w"> </span><span class="nt">getting</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">middle</span>
<span class="w">  </span><span class="nt">Response</span><span class="p">.</span><span class="nc">TrySkipIisCustomErrors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">true</span><span class="o">;</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nt">Call</span><span class="w"> </span><span class="nt">target</span><span class="w"> </span><span class="nt">Controller</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">pass</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">routeData</span><span class="o">.</span>
<span class="w">  </span><span class="nt">IController</span><span class="w"> </span><span class="nt">errorController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">new</span><span class="w"> </span><span class="nt">ErrorController</span><span class="o">();</span>
<span class="w">  </span><span class="nt">errorController</span><span class="p">.</span><span class="nc">Execute</span><span class="o">(</span><span class="nt">new</span><span class="w"> </span><span class="nt">RequestContext</span><span class="o">(</span><span class="w">    </span>
<span class="w">       </span><span class="nt">new</span><span class="w"> </span><span class="nt">HttpContextWrapper</span><span class="o">(</span><span class="nt">Context</span><span class="o">),</span><span class="w"> </span><span class="nt">routeData</span><span class="o">));</span>
<span class="err">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<h2>Requirements for 404</h2>
<p>The following are my requirements for a 404 solution and below i show how i
implement it:</p>
<ul>
<li>I want to handle matched routes with bad actions</li>
<li>I want to handle matched routes with bad controllers</li>
<li>I want to handle un-matched routes (arbitrary urls that my app can't understand) - i don't want these bubbling up to the Global.asax or IIS because then i can't redirect back into my MVC app properly</li>
<li>I want a way to handle in the same manner as above, custom 404s - like when an ID is submitted for an object that does not exist (maybe deleted)</li>
<li>I want all my 404s to return an MVC view (not a static page) to which i can pump more data later if necessary (good 404 designs) <em>and</em> they <em>must</em> return the HTTP 404 status code</li>
</ul>
<h2>Solution</h2>
<p>I think you should save <code>Application_Error</code> in the Global.asax for higher
things, like unhandled exceptions and logging (like Shay Jacoby's answer
shows) but not 404 handling. This is why my suggestion keeps the 404 stuff out
of the Global.asax file.</p>
<h3>Step 1: Have a common place for 404-error logic</h3>
<p>This is a good idea for maintainability. Use an ErrorController so that future
improvements to your well designed 404 page can adapt easily. Also, <strong>make
sure your response has the 404 code</strong>!</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">ErrorController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">MyController</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">#region Http404</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ActionResult</span><span class="w"> </span><span class="n">Http404</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">url</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Response</span><span class="o">.</span><span class="n">StatusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">int</span><span class="p">)</span><span class="n">HttpStatusCode</span><span class="o">.</span><span class="n">NotFound</span><span class="p">;</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">NotFoundViewModel</span><span class="p">();</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">relative</span><span class="w"> </span><span class="p">(</span><span class="s1">'NotFound'</span><span class="w"> </span><span class="n">route</span><span class="p">)</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Requested</span><span class="w"> </span><span class="n">path</span>
<span class="w">        </span><span class="n">model</span><span class="o">.</span><span class="n">RequestedUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Request</span><span class="o">.</span><span class="n">Url</span><span class="o">.</span><span class="n">OriginalString</span><span class="o">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Request</span><span class="o">.</span><span class="n">Url</span><span class="o">.</span><span class="n">OriginalString</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="err">?</span>
<span class="w">            </span><span class="n">Request</span><span class="o">.</span><span class="n">Url</span><span class="o">.</span><span class="n">OriginalString</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">url</span><span class="p">;</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Dont</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">stuck</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="s1">'retry loop'</span><span class="w"> </span><span class="n">by</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">allowing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Referrer</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Request</span>
<span class="w">        </span><span class="n">model</span><span class="o">.</span><span class="n">ReferrerUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Request</span><span class="o">.</span><span class="n">UrlReferrer</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">            </span><span class="n">Request</span><span class="o">.</span><span class="n">UrlReferrer</span><span class="o">.</span><span class="n">OriginalString</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">model</span><span class="o">.</span><span class="n">RequestedUrl</span><span class="w"> </span><span class="err">?</span>
<span class="w">            </span><span class="n">Request</span><span class="o">.</span><span class="n">UrlReferrer</span><span class="o">.</span><span class="n">OriginalString</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">TODO</span><span class="p">:</span><span class="w"> </span><span class="n">insert</span><span class="w"> </span><span class="n">ILogger</span><span class="w"> </span><span class="n">here</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">View</span><span class="p">(</span><span class="s2">"NotFound"</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">NotFoundViewModel</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">RequestedUrl</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">get</span><span class="p">;</span><span class="w"> </span><span class="n">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">ReferrerUrl</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">get</span><span class="p">;</span><span class="w"> </span><span class="n">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">#endregion</span>
<span class="p">}</span>
</pre></div>

<h3>Step 2: Use a base Controller class so you can easily invoke your custom</h3>
<p>404 action and wire up <code>HandleUnknownAction</code></p>
<p>404s in ASP.NET MVC need to be caught at a number of places. The first is
<code>HandleUnknownAction</code>.</p>
<p>The <code>InvokeHttp404</code> method creates a common place for re-routing to the
<code>ErrorController</code> and our new <code>Http404</code> action. Think DRY!</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">MyController</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Controller</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">#region Http404 handling</span>

<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">HandleUnknownAction</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">actionName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">controller</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">ErrorController</span><span class="w"> </span><span class="n">dont</span><span class="w"> </span><span class="s1">'nest'</span><span class="w"> </span><span class="n">exceptions</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">typeof</span><span class="p">(</span><span class="n">ErrorController</span><span class="p">))</span>
<span class="w">            </span><span class="n">this</span><span class="o">.</span><span class="n">InvokeHttp404</span><span class="p">(</span><span class="n">HttpContext</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ActionResult</span><span class="w"> </span><span class="n">InvokeHttp404</span><span class="p">(</span><span class="n">HttpContextBase</span><span class="w"> </span><span class="n">httpContext</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">IController</span><span class="w"> </span><span class="n">errorController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ObjectFactory</span><span class="o">.</span><span class="n">GetInstance</span><span class="o">&lt;</span><span class="n">ErrorController</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">errorRoute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">RouteData</span><span class="p">();</span>
<span class="w">        </span><span class="n">errorRoute</span><span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">"controller"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Error"</span><span class="p">);</span>
<span class="w">        </span><span class="n">errorRoute</span><span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">"action"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Http404"</span><span class="p">);</span>
<span class="w">        </span><span class="n">errorRoute</span><span class="o">.</span><span class="n">Values</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s2">"url"</span><span class="p">,</span><span class="w"> </span><span class="n">httpContext</span><span class="o">.</span><span class="n">Request</span><span class="o">.</span><span class="n">Url</span><span class="o">.</span><span class="n">OriginalString</span><span class="p">);</span>
<span class="w">        </span><span class="n">errorController</span><span class="o">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">RequestContext</span><span class="p">(</span>
<span class="w">             </span><span class="n">httpContext</span><span class="p">,</span><span class="w"> </span><span class="n">errorRoute</span><span class="p">));</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">EmptyResult</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">#endregion</span>
<span class="p">}</span>
</pre></div>

<h3>Step 3: Use Dependency Injection in your Controller Factory and wire up 404</h3>
<p>HttpExceptions</p>
<p>Like so (it doesn't have to be StructureMap):</p>
<p><em>MVC1.0 example:</em></p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">StructureMapControllerFactory</span><span class="w"> </span>:<span class="w"> </span><span class="nv">DefaultControllerFactory</span>
{
<span class="w">    </span><span class="nv">protected</span><span class="w"> </span><span class="nv">override</span><span class="w"> </span><span class="nv">IController</span><span class="w"> </span><span class="nv">GetControllerInstance</span><span class="ss">(</span><span class="nv">Type</span><span class="w"> </span><span class="nv">controllerType</span><span class="ss">)</span>
<span class="w">    </span>{
<span class="w">        </span><span class="nv">try</span>
<span class="w">        </span>{
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">controllerType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nv">base</span>.<span class="nv">GetControllerInstance</span><span class="ss">(</span><span class="nv">controllerType</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">        </span><span class="nv">catch</span><span class="w"> </span><span class="ss">(</span><span class="nv">HttpException</span><span class="w"> </span><span class="nv">ex</span><span class="ss">)</span>
<span class="w">        </span>{
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">ex</span>.<span class="nv">GetHttpCode</span><span class="ss">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">(</span><span class="nv">int</span><span class="ss">)</span><span class="nv">HttpStatusCode</span>.<span class="nv">NotFound</span><span class="ss">)</span>
<span class="w">            </span>{
<span class="w">                </span><span class="nv">IController</span><span class="w"> </span><span class="nv">errorController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ObjectFactory</span>.<span class="nv">GetInstance</span><span class="o">&lt;</span><span class="nv">ErrorController</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">                </span><span class="ss">((</span><span class="nv">ErrorController</span><span class="ss">)</span><span class="nv">errorController</span><span class="ss">)</span>.<span class="nv">InvokeHttp404</span><span class="ss">(</span><span class="nv">RequestContext</span>.<span class="nv">HttpContext</span><span class="ss">)</span><span class="c1">;</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nv">errorController</span><span class="c1">;</span>
<span class="w">            </span>}
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nv">throw</span><span class="w"> </span><span class="nv">ex</span><span class="c1">;</span>
<span class="w">        </span>}

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">ObjectFactory</span>.<span class="nv">GetInstance</span><span class="ss">(</span><span class="nv">controllerType</span><span class="ss">)</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">Controller</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<p><em>MVC2.0 example:</em></p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="nv">protected</span><span class="w"> </span><span class="nv">override</span><span class="w"> </span><span class="nv">IController</span><span class="w"> </span><span class="nv">GetControllerInstance</span><span class="ss">(</span><span class="nv">RequestContext</span><span class="w"> </span><span class="nv">requestContext</span>,<span class="w"> </span><span class="nv">Type</span><span class="w"> </span><span class="nv">controllerType</span><span class="ss">)</span>
<span class="w">    </span>{
<span class="w">        </span><span class="nv">try</span>
<span class="w">        </span>{
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">controllerType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nv">base</span>.<span class="nv">GetControllerInstance</span><span class="ss">(</span><span class="nv">requestContext</span>,<span class="w"> </span><span class="nv">controllerType</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">        </span><span class="nv">catch</span><span class="w"> </span><span class="ss">(</span><span class="nv">HttpException</span><span class="w"> </span><span class="nv">ex</span><span class="ss">)</span>
<span class="w">        </span>{
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">ex</span>.<span class="nv">GetHttpCode</span><span class="ss">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">404</span><span class="ss">)</span>
<span class="w">            </span>{
<span class="w">                </span><span class="nv">IController</span><span class="w"> </span><span class="nv">errorController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ObjectFactory</span>.<span class="nv">GetInstance</span><span class="o">&lt;</span><span class="nv">ErrorController</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">                </span><span class="ss">((</span><span class="nv">ErrorController</span><span class="ss">)</span><span class="nv">errorController</span><span class="ss">)</span>.<span class="nv">InvokeHttp404</span><span class="ss">(</span><span class="nv">requestContext</span>.<span class="nv">HttpContext</span><span class="ss">)</span><span class="c1">;</span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nv">errorController</span><span class="c1">;</span>
<span class="w">            </span>}
<span class="w">            </span><span class="k">else</span>
<span class="w">                </span><span class="nv">throw</span><span class="w"> </span><span class="nv">ex</span><span class="c1">;</span>
<span class="w">        </span>}

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">ObjectFactory</span>.<span class="nv">GetInstance</span><span class="ss">(</span><span class="nv">controllerType</span><span class="ss">)</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">Controller</span><span class="c1">;</span>
<span class="w">    </span>}
</pre></div>

<p>I think its better to catch errors closer to where they originate. This is why
i prefer the above to the <code>Application_Error</code> handler.</p>
<p>This is the second place to catch 404s.</p>
<h3>Step 4: Add a NotFound route to Global.asax for urls that fail to be parsed</h3>
<p>into your app</p>
<p>This route should point to our <code>Http404</code> action. Notice the <code>url</code> param will
be a relative url because the routing engine is stripping the domain part
here? That is why we have all that conditional url logic in Step 1.</p>
<div class="code"><pre class="code literal-block">        routes.MapRoute("NotFound", "{*url}", 
            new { controller = "Error", action = "Http404" });
</pre></div>

<p>This is the third and final place to catch 404s in an MVC app that you don't
invoke yourself. If you don't catch unmatched routes here then MVC will pass
the problem up to ASP.NET (Global.asax) and you don't really want that in this
situation.</p>
<h3>Step 5: Finally, invoke 404s when your app can't find something</h3>
<p>Like when a bad ID is submitted to my Loans controller (derives from
<code>MyController</code>):</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">// GET: /Detail/ID</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">ActionResult</span><span class="w"> </span><span class="n">Detail</span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="n">ID</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Loan</span><span class="w"> </span><span class="n">loan</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">_svc</span><span class="p">.</span><span class="n">GetLoans</span><span class="p">().</span><span class="n">WithID</span><span class="p">(</span><span class="n">ID</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">loan</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">null</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">InvokeHttp404</span><span class="p">(</span><span class="n">HttpContext</span><span class="p">);</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">View</span><span class="p">(</span><span class="n">loan</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>

<p>It would be nice if all this could be hooked up in fewer places with less code
but i think this solution is more maintainable, more testable and fairly
pragmatic.</p>
<p>Thanks for the feedback so far. I'd love to get more.</p>
<p><strong>NOTE: This has been edited significantly from my original answer but the
purpose/requirements are the same - this is why i have not added a new
answer</strong></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/dependency-injection-error-unable-to-resolve-service-for-type-while-attempting-to-activate-while-class-is-registered/" class="u-url">Dependency Injection error: Unable to resolve service for type while attempting to activate, while class is registered</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/dependency-injection-error-unable-to-resolve-service-for-type-while-attempting-to-activate-while-class-is-registered/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T12:04:02+08:00" itemprop="datePublished" title="2023-03-03 12:04">2023-03-03 12:04</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I created an .NET Core MVC application and use Dependency Injection and
Repository Pattern to inject a repository to my controller. However, I am
getting an error:</p>
<blockquote>
<p>InvalidOperationException: Unable to resolve service for type
'WebApplication1.Data.BloggerRepository' while attempting to activate
'WebApplication1.Controllers.BlogController'.</p>
</blockquote>
<p><strong>Repository:</strong></p>
<div class="code"><pre class="code literal-block">public interface IBloggerRepository { ... }

public class BloggerRepository : IBloggerRepository { ... }
</pre></div>

<p><strong>Controller:</strong></p>
<div class="code"><pre class="code literal-block">public class BlogController : Controller
{
    private readonly IBloggerRepository _repository;

    public BlogController(BloggerRepository repository)
    {
        _repository = repository;
    }

    public IActionResult Index() { ... }
}
</pre></div>

<p><strong>Startup.cs:</strong></p>
<div class="code"><pre class="code literal-block">public void ConfigureServices(IServiceCollection services)
{
    services.AddMvc();

    services.AddScoped&lt;IBloggerRepository, BloggerRepository&gt;();
}
</pre></div>

<p>I'm not sure what I'm doing wrong. Any ideas?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>To break down the error message:</p>
<blockquote>
<p>Unable to resolve service for type 'WebApplication1.Data.BloggerRepository'
while attempting to activate 'WebApplication1.Controllers.BlogController'.</p>
</blockquote>
<p>That is saying that your application is trying to create an instance of
<code>BlogController</code> but it doesn't know <em>how</em> to create an instance of
<code>BloggerRepository</code> to pass into the constructor.</p>
<p>Now look at your startup:</p>
<div class="code"><pre class="code literal-block">services.AddScoped&lt;IBloggerRepository, BloggerRepository&gt;();
</pre></div>

<p>That is saying whenever a <code>IBloggerRepository</code> is required, create a
<code>BloggerRepository</code> and pass that in.</p>
<p>However, your controller class is asking for the concrete class
<code>BloggerRepository</code> and the dependency injection container doesn't know what
to do when asked for that directly.</p>
<p>I'm guessing you just made a typo, but a fairly common one. So the simple fix
is to change your controller to accept something that the DI container <em>does</em>
know how to process, in this case, the interface:</p>
<div class="code"><pre class="code literal-block">public BlogController(IBloggerRepository repository)
//                    ^
//                    Add this!
{
    _repository = repository;
}
</pre></div>

<p>Note that some objects have their own custom ways to be registered, this is
more common when you use external Nuget packages, so it pays to read the
documentation for them. For example if you got a message saying:</p>
<blockquote>
<p>Unable to resolve service for type
'Microsoft.AspNetCore.Http.IHttpContextAccessor' ...</p>
</blockquote>
<p>Then you would fix that using the custom extension method provided by that
library which would be:</p>
<div class="code"><pre class="code literal-block">services.AddHttpContextAccessor();
</pre></div>

<p>For other packages - always read the docs.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I ran into this issue because in the dependency injection setup I was missing
a dependency of a repository that is a dependency of a controller:</p>
<div class="code"><pre class="code literal-block">services.AddScoped&lt;IDependencyOne, DependencyOne&gt;();    &lt;-- I was missing this line!
services.AddScoped&lt;IDependencyTwoThatIsDependentOnDependencyOne, DependencyTwoThatIsDependentOnDependencyOne&gt;();
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1901.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1899.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
