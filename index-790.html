<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 790) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-790.html">
<link rel="prev" href="index-791.html" type="text/html">
<link rel="next" href="index-789.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/asking-the-user-for-input-until-they-give-a-valid-response/" class="u-url">Asking the user for input until they give a valid response</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/asking-the-user-for-input-until-they-give-a-valid-response/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:03:06+08:00" itemprop="datePublished" title="2023-02-17 16:03">2023-02-17 16:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am writing a program that accepts user input.</p>
<div class="code"><pre class="code literal-block"><span class="c1">#note: Python 2.7 users should use `raw_input`, the equivalent of 3.X's `input`</span>
<span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="n">input</span><span class="p">(</span><span class="s2">"Please enter your age: "</span><span class="p">))</span>
<span class="k">if</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="o">:</span><span class="w"> </span>
<span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="s2">"You are able to vote in the United States!"</span><span class="p">)</span>
<span class="k">else</span><span class="o">:</span>
<span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="s2">"You are not able to vote in the United States."</span><span class="p">)</span>
</pre></div>

<p>The program works as expected as long as the the user enters meaningful data.</p>
<div class="code"><pre class="code literal-block">Please enter your age: 23
You are able to vote in the United States!
</pre></div>

<p>But it fails if the user enters invalid data:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Please</span><span class="w"> </span><span class="nv">enter</span><span class="w"> </span><span class="nv">your</span><span class="w"> </span><span class="nv">age</span>:<span class="w"> </span><span class="nv">dickety</span><span class="w"> </span><span class="nv">six</span>
<span class="nv">Traceback</span><span class="w"> </span><span class="ss">(</span><span class="nv">most</span><span class="w"> </span><span class="nv">recent</span><span class="w"> </span><span class="k">call</span><span class="w"> </span><span class="nl">last</span><span class="ss">)</span>:
<span class="w">  </span><span class="nv">File</span><span class="w"> </span><span class="s2">"canyouvote.py"</span>,<span class="w"> </span><span class="nv">line</span><span class="w"> </span><span class="mi">1</span>,<span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">module</span><span class="o">&gt;</span>
<span class="w">    </span><span class="nv">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">int</span><span class="ss">(</span><span class="nv">input</span><span class="ss">(</span><span class="s2">"Please enter your age: "</span><span class="ss">))</span>
<span class="nv">ValueError</span>:<span class="w"> </span><span class="nv">invalid</span><span class="w"> </span><span class="nv">literal</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">int</span><span class="ss">()</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">base</span><span class="w"> </span><span class="mi">10</span>:<span class="w"> </span><span class="s1">'dickety six'</span>
</pre></div>

<p>Instead of crashing, I would like the program to ask for the input again. Like
this:</p>
<div class="code"><pre class="code literal-block">Please enter your age: dickety six
Sorry, I didn't understand that.
Please enter your age: 26
You are able to vote in the United States!
</pre></div>

<p>How do I ask for valid input instead of crashing or accepting invalid values
(e.g. <code>-1</code>)?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The simplest way to accomplish this is to put the <code>input</code> method in a while
loop. Use <code>continue</code> when you get bad input, and <code>break</code> out of the loop when
you're satisfied.</p>
<h3>When Your Input Might Raise an Exception</h3>
<p>Use <code>try</code> and <code>except</code> to detect when the user enters data that can't be
parsed.</p>
<div class="code"><pre class="code literal-block"><span class="k">while</span><span class="w"> </span><span class="nv">True</span>:
<span class="w">    </span><span class="nv">try</span>:
<span class="w">        </span>#<span class="w"> </span><span class="nv">Note</span>:<span class="w"> </span><span class="nv">Python</span><span class="w"> </span><span class="mi">2</span>.<span class="nv">x</span><span class="w"> </span><span class="nv">users</span><span class="w"> </span><span class="nv">should</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">raw_input</span>,<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">equivalent</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">3</span>.<span class="nv">x</span><span class="err">'s input</span>
<span class="err">        age = int(input("Please enter your age: "))</span>
<span class="err">    except ValueError:</span>
<span class="w">        </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Sorry, I didn't understand that."</span><span class="ss">)</span>
<span class="w">        </span>#<span class="nv">better</span><span class="w"> </span><span class="nv">try</span><span class="w"> </span><span class="nv">again</span>...<span class="w"> </span><span class="k">Return</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="k">loop</span>
<span class="w">        </span><span class="k">continue</span>
<span class="w">    </span><span class="k">else</span>:
<span class="w">        </span>#<span class="nv">age</span><span class="w"> </span><span class="nv">was</span><span class="w"> </span><span class="nv">successfully</span><span class="w"> </span><span class="nv">parsed</span><span class="o">!</span>
<span class="w">        </span>#<span class="nv">we</span><span class="err">'re ready to exit the loop.</span>
<span class="err">        break</span>
<span class="err">if age &gt;= 18: </span>
<span class="err">    print("You are able to vote in the United States!")</span>
<span class="err">else:</span>
<span class="err">    print("You are not able to vote in the United States.")</span>
</pre></div>

<h3>Implementing Your Own Validation Rules</h3>
<p>If you want to reject values that Python can successfully parse, you can add
your own validation logic.</p>
<div class="code"><pre class="code literal-block"><span class="k">while</span><span class="w"> </span><span class="nv">True</span>:
<span class="w">    </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">input</span><span class="ss">(</span><span class="s2">"Please enter a loud message (must be all caps): "</span><span class="ss">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">data</span>.<span class="nv">isupper</span><span class="ss">()</span>:
<span class="w">        </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Sorry, your response was not loud enough."</span><span class="ss">)</span>
<span class="w">        </span><span class="k">continue</span>
<span class="w">    </span><span class="k">else</span>:
<span class="w">        </span>#<span class="nv">we</span><span class="err">'re happy with the value given.</span>
<span class="w">        </span>#<span class="nv">we</span><span class="err">'re ready to exit the loop.</span>
<span class="err">        break</span>

<span class="err">while True:</span>
<span class="err">    data = input("Pick an answer from A to D:")</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">data</span>.<span class="nv">lower</span><span class="ss">()</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="ss">(</span><span class="s1">'a'</span>,<span class="w"> </span><span class="s1">'b'</span>,<span class="w"> </span><span class="s1">'c'</span>,<span class="w"> </span><span class="s1">'d'</span><span class="ss">)</span>:
<span class="w">        </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Not an appropriate choice."</span><span class="ss">)</span>
<span class="w">    </span><span class="k">else</span>:
<span class="w">        </span><span class="k">break</span>
</pre></div>

<h3>Combining Exception Handling and Custom Validation</h3>
<p>Both of the above techniques can be combined into one loop.</p>
<div class="code"><pre class="code literal-block"><span class="k">while</span><span class="w"> </span><span class="nv">True</span>:
<span class="w">    </span><span class="nv">try</span>:
<span class="w">        </span><span class="nv">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">int</span><span class="ss">(</span><span class="nv">input</span><span class="ss">(</span><span class="s2">"Please enter your age: "</span><span class="ss">))</span>
<span class="w">    </span><span class="nv">except</span><span class="w"> </span><span class="nv">ValueError</span>:
<span class="w">        </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Sorry, I didn't understand that."</span><span class="ss">)</span>
<span class="w">        </span><span class="k">continue</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">age</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span>:
<span class="w">        </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Sorry, your response must not be negative."</span><span class="ss">)</span>
<span class="w">        </span><span class="k">continue</span>
<span class="w">    </span><span class="k">else</span>:
<span class="w">        </span>#<span class="nv">age</span><span class="w"> </span><span class="nv">was</span><span class="w"> </span><span class="nv">successfully</span><span class="w"> </span><span class="nv">parsed</span>,<span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">we</span><span class="err">'re happy with its value.</span>
<span class="w">        </span>#<span class="nv">we</span><span class="err">'re ready to exit the loop.</span>
<span class="err">        break</span>
<span class="err">if age &gt;= 18: </span>
<span class="err">    print("You are able to vote in the United States!")</span>
<span class="err">else:</span>
<span class="err">    print("You are not able to vote in the United States.")</span>
</pre></div>

<h3>Encapsulating it All in a Function</h3>
<p>If you need to ask your user for a lot of different values, it might be useful
to put this code in a function, so you don't have to retype it every time.</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">get_non_negative_int</span><span class="ss">(</span><span class="nv">prompt</span><span class="ss">)</span>:
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nv">True</span>:
<span class="w">        </span><span class="nv">try</span>:
<span class="w">            </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">int</span><span class="ss">(</span><span class="nv">input</span><span class="ss">(</span><span class="nv">prompt</span><span class="ss">))</span>
<span class="w">        </span><span class="nv">except</span><span class="w"> </span><span class="nv">ValueError</span>:
<span class="w">            </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Sorry, I didn't understand that."</span><span class="ss">)</span>
<span class="w">            </span><span class="k">continue</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span>:
<span class="w">            </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Sorry, your response must not be negative."</span><span class="ss">)</span>
<span class="w">            </span><span class="k">continue</span>
<span class="w">        </span><span class="k">else</span>:
<span class="w">            </span><span class="k">break</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">value</span>

<span class="nv">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">get_non_negative_int</span><span class="ss">(</span><span class="s2">"Please enter your age: "</span><span class="ss">)</span>
<span class="nv">kids</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">get_non_negative_int</span><span class="ss">(</span><span class="s2">"Please enter the number of children you have: "</span><span class="ss">)</span>
<span class="nv">salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">get_non_negative_int</span><span class="ss">(</span><span class="s2">"Please enter your yearly earnings, in dollars: "</span><span class="ss">)</span>
</pre></div>

<h4>Putting It All Together</h4>
<p>You can extend this idea to make a very generic input function:</p>
<div class="code"><pre class="code literal-block"><span class="s s-Atom">def</span> <span class="nf">sanitised_input</span><span class="p">(</span><span class="s s-Atom">prompt</span><span class="p">,</span> <span class="s s-Atom">type_</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">min_</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">max_</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">range_</span><span class="o">=</span><span class="nv">None</span><span class="p">)</span><span class="o">:</span>
    <span class="s s-Atom">if</span> <span class="s s-Atom">min_</span> <span class="o">is</span> <span class="o">not</span> <span class="nv">None</span> <span class="s s-Atom">and</span> <span class="s s-Atom">max_</span> <span class="o">is</span> <span class="o">not</span> <span class="nv">None</span> <span class="s s-Atom">and</span> <span class="s s-Atom">max_</span> <span class="o">&lt;</span> <span class="s s-Atom">min_</span><span class="o">:</span>
        <span class="s s-Atom">raise</span> <span class="nv">ValueError</span><span class="p">(</span><span class="s2">"min_ must be less than or equal to max_."</span><span class="p">)</span>
    <span class="s s-Atom">while</span> <span class="nv">True</span><span class="o">:</span>
        <span class="s s-Atom">ui</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="s s-Atom">prompt</span><span class="p">)</span>
        <span class="s s-Atom">if</span> <span class="s s-Atom">type_</span> <span class="o">is</span> <span class="o">not</span> <span class="nv">None</span><span class="o">:</span>
            <span class="s s-Atom">try</span><span class="p">:</span>
                <span class="s s-Atom">ui</span> <span class="o">=</span> <span class="nf">type_</span><span class="p">(</span><span class="s s-Atom">ui</span><span class="p">)</span>
            <span class="s s-Atom">except</span> <span class="nv">ValueError</span><span class="o">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s2">"Input type must be {0}."</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">type_</span><span class="p">.</span><span class="k">__</span><span class="s s-Atom">name__</span><span class="p">))</span>
                <span class="s s-Atom">continue</span>
        <span class="s s-Atom">if</span> <span class="s s-Atom">max_</span> <span class="o">is</span> <span class="o">not</span> <span class="nv">None</span> <span class="s s-Atom">and</span> <span class="s s-Atom">ui</span> <span class="o">&gt;</span> <span class="s s-Atom">max_</span><span class="o">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="s2">"Input must be less than or equal to {0}."</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">max_</span><span class="p">))</span>
        <span class="s s-Atom">elif</span> <span class="s s-Atom">min_</span> <span class="o">is</span> <span class="o">not</span> <span class="nv">None</span> <span class="s s-Atom">and</span> <span class="s s-Atom">ui</span> <span class="o">&lt;</span> <span class="s s-Atom">min_</span><span class="o">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="s2">"Input must be greater than or equal to {0}."</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">min_</span><span class="p">))</span>
        <span class="s s-Atom">elif</span> <span class="s s-Atom">range_</span> <span class="o">is</span> <span class="o">not</span> <span class="nv">None</span> <span class="s s-Atom">and</span> <span class="s s-Atom">ui</span> <span class="o">not</span> <span class="s s-Atom">in</span> <span class="s s-Atom">range_</span><span class="o">:</span>
            <span class="s s-Atom">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">range_</span><span class="p">,</span> <span class="s s-Atom">range</span><span class="p">)</span><span class="o">:</span>
                <span class="s s-Atom">template</span> <span class="o">=</span> <span class="s2">"Input must be between {0.start} and {0.stop}."</span>
                <span class="nf">print</span><span class="p">(</span><span class="s s-Atom">template</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">range_</span><span class="p">))</span>
            <span class="s s-Atom">else</span><span class="p">:</span>
                <span class="s s-Atom">template</span> <span class="o">=</span> <span class="s2">"Input must be {0}."</span>
                <span class="s s-Atom">if</span> <span class="nf">len</span><span class="p">(</span><span class="s s-Atom">range_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="o">:</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s s-Atom">template</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="o">*</span><span class="s s-Atom">range_</span><span class="p">))</span>
                <span class="s s-Atom">else</span><span class="p">:</span>
                    <span class="s s-Atom">expected</span> <span class="o">=</span> <span class="s2">" or "</span><span class="p">.</span><span class="nf">join</span><span class="p">((</span>
                        <span class="s2">", "</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="s s-Atom">x</span><span class="p">)</span> <span class="s s-Atom">for</span> <span class="s s-Atom">x</span> <span class="s s-Atom">in</span> <span class="s s-Atom">range_</span><span class="p">[</span><span class="o">:-</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="nf">str</span><span class="p">(</span><span class="s s-Atom">range_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">))</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s s-Atom">template</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">expected</span><span class="p">))</span>
        <span class="s s-Atom">else</span><span class="p">:</span>
            <span class="s s-Atom">return</span> <span class="s s-Atom">ui</span>
</pre></div>

<p>With usage such as:</p>
<div class="code"><pre class="code literal-block">age = sanitised_input("Enter your age: ", int, 1, 101)
answer = sanitised_input("Enter your answer: ", str.lower, range_=('a', 'b', 'c', 'd'))
</pre></div>

<h3>Common Pitfalls, and Why you Should Avoid Them</h3>
<h4>The Redundant Use of Redundant <code>input</code> Statements</h4>
<p>This method works but is generally considered poor style:</p>
<div class="code"><pre class="code literal-block"><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">input</span><span class="ss">(</span><span class="s2">"Please enter a loud message (must be all caps): "</span><span class="ss">)</span>
<span class="k">while</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">data</span>.<span class="nv">isupper</span><span class="ss">()</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Sorry, your response was not loud enough."</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">input</span><span class="ss">(</span><span class="s2">"Please enter a loud message (must be all caps): "</span><span class="ss">)</span>
</pre></div>

<p>It might look attractive initially because it's shorter than the <code>while True</code>
method, but it violates the Don't Repeat Yourself principle of software
development. This increases the likelihood of bugs in your system. What if you
want to backport to 2.7 by changing <code>input</code> to <code>raw_input</code>, but accidentally
change only the first <code>input</code> above? It's a <code>SyntaxError</code> just waiting to
happen.</p>
<h4>Recursion Will Blow Your Stack</h4>
<p>If you've just learned about recursion, you might be tempted to use it in
<code>get_non_negative_int</code> so you can dispose of the while loop.</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">get_non_negative_int</span><span class="ss">(</span><span class="nv">prompt</span><span class="ss">)</span>:
<span class="w">    </span><span class="nv">try</span>:
<span class="w">        </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">int</span><span class="ss">(</span><span class="nv">input</span><span class="ss">(</span><span class="nv">prompt</span><span class="ss">))</span>
<span class="w">    </span><span class="nv">except</span><span class="w"> </span><span class="nv">ValueError</span>:
<span class="w">        </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Sorry, I didn't understand that."</span><span class="ss">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">get_non_negative_int</span><span class="ss">(</span><span class="nv">prompt</span><span class="ss">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span>:
<span class="w">        </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Sorry, your response must not be negative."</span><span class="ss">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">get_non_negative_int</span><span class="ss">(</span><span class="nv">prompt</span><span class="ss">)</span>
<span class="w">    </span><span class="k">else</span>:
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">value</span>
</pre></div>

<p>This appears to work fine most of the time, but if the user enters invalid
data enough times, the script will terminate with a <code>RuntimeError: maximum
recursion depth exceeded</code>. You may think "no fool would make 1000 mistakes in
a row", but you're underestimating the ingenuity of fools!</p>
<p><br></p>
<h3>Suggest</h3>
<p>Why would you do a <code>while True</code> and then break out of this loop while you can
also just put your requirements in the while statement since all you want is
to stop once you have the age?</p>
<div class="code"><pre class="code literal-block"><span class="nv">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">None</span>
<span class="k">while</span><span class="w"> </span><span class="nv">age</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">None</span>:
<span class="w">    </span><span class="nv">input_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">input</span><span class="ss">(</span><span class="s2">"Please enter your age: "</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">try</span>:
<span class="w">        </span>#<span class="w"> </span><span class="nv">try</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">convert</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="nv">input</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">number</span>
<span class="w">        </span><span class="nv">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">int</span><span class="ss">(</span><span class="nv">input_value</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">except</span><span class="w"> </span><span class="nv">ValueError</span>:
<span class="w">        </span>#<span class="w"> </span><span class="nv">tell</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">user</span><span class="w"> </span><span class="nv">off</span>
<span class="w">        </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"{input} is not a number, please enter a number only"</span>.<span class="nv">format</span><span class="ss">(</span><span class="nv">input</span><span class="o">=</span><span class="nv">input_value</span><span class="ss">))</span>
<span class="k">if</span><span class="w"> </span><span class="nv">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"You are able to vote in the United States!"</span><span class="ss">)</span>
<span class="k">else</span>:
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"You are not able to vote in the United States."</span><span class="ss">)</span>
</pre></div>

<p>This would result in the following:</p>
<div class="code"><pre class="code literal-block">Please enter your age: *potato*
potato is not a number, please enter a number only
Please enter your age: *5*
You are not able to vote in the United States.
</pre></div>

<p>this will work since age will never have a value that will not make sense and
the code follows the logic of your "business process"</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-do-i-replace-a-character-at-a-particular-index-in-javascript/" class="u-url">How do I replace a character at a particular index in JavaScript?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-do-i-replace-a-character-at-a-particular-index-in-javascript/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:02:32+08:00" itemprop="datePublished" title="2023-02-17 16:02">2023-02-17 16:02</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a string, let's say <code>Hello world</code> and I need to replace the char at
index 3. How can I replace a char by specifying a index?</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="nb">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hello world"</span><span class="p">;</span>
</pre></div>

<p>I need something like</p>
<div class="code"><pre class="code literal-block">str.replaceAt(0,"h");
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>In JavaScript, strings are <strong>immutable</strong> , which means the best you can do is
to create a new string with the changed content and assign the variable to
point to it.</p>
<p>You'll need to define the <code>replaceAt()</code> function yourself:</p>
<div class="code"><pre class="code literal-block"><span class="nv">String</span>.<span class="nv">prototype</span>.<span class="nv">replaceAt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">function</span><span class="ss">(</span><span class="nv">index</span>,<span class="w"> </span><span class="nv">replacement</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">this</span>.<span class="nv">substring</span><span class="ss">(</span><span class="mi">0</span>,<span class="w"> </span><span class="nv">index</span><span class="ss">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">replacement</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">this</span>.<span class="nv">substring</span><span class="ss">(</span><span class="nv">index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">replacement</span>.<span class="nv">length</span><span class="ss">)</span><span class="c1">;</span>
}
</pre></div>

<p>And use it like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">hello</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Hello World"</span><span class="p">;</span>
<span class="n">alert</span><span class="p">(</span><span class="n">hello</span><span class="o">.</span><span class="n">replaceAt</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s2">"!!"</span><span class="p">));</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">He</span><span class="o">!!</span><span class="n">o</span><span class="w"> </span><span class="n">World</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>There is no <code>replaceAt</code> function in JavaScript. You can use the following code
to replace any character in any string at specified position:</p>
<div class="code"><pre class="code literal-block">function<span class="w"> </span>rep()<span class="w"> </span>{
<span class="w">    </span>var<span class="w"> </span>str<span class="w"> </span>=<span class="w"> </span>'Hello<span class="w"> </span>World';
<span class="w">    </span>str<span class="w"> </span>=<span class="w"> </span>setCharAt(str,4,'a');
<span class="w">    </span>alert(str);
}

function<span class="w"> </span>setCharAt(str,index,chr)<span class="w"> </span>{
<span class="w">    </span>if(index<span class="w"> </span>&gt;<span class="w"> </span>str.length-1)<span class="w"> </span>return<span class="w"> </span>str;
<span class="w">    </span>return<span class="w"> </span>str.substring(0,index)<span class="w"> </span>+<span class="w"> </span>chr<span class="w"> </span>+<span class="w"> </span>str.substring(index+1);
}


<span class="nt">&lt;button</span><span class="w"> </span><span class="na">onclick=</span><span class="s">"rep();"</span><span class="nt">&gt;</span>click<span class="nt">&lt;/button&gt;</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-usestate-set-method-is-not-reflecting-a-change-immediately/" class="u-url">The useState set method is not reflecting a change immediately</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/the-usestate-set-method-is-not-reflecting-a-change-immediately/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:02:04+08:00" itemprop="datePublished" title="2023-02-17 16:02">2023-02-17 16:02</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am trying to learn hooks and the <code>useState</code> method has made me confused. I
am assigning an initial value to a state in the form of an array. The set
method in <code>useState</code> is not working for me, both with and without the spread
syntax.</p>
<p>I have made an API on another PC that I am calling and fetching the data which
I want to set into the state.</p>
<p>Here is my code:</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"root"</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">script</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"text/babel"</span> <span class="n">defer</span><span class="o">&gt;</span>
<span class="o">//</span> <span class="kn">import</span> <span class="nn">React</span><span class="o">,</span> <span class="p">{</span> <span class="n">useState</span><span class="p">,</span> <span class="n">useEffect</span> <span class="p">}</span> <span class="kn">from</span> <span class="s2">"react"</span><span class="p">;</span>
<span class="o">//</span> <span class="kn">import</span> <span class="nn">ReactDOM</span> <span class="kn">from</span> <span class="s2">"react-dom"</span><span class="p">;</span>
<span class="n">const</span> <span class="p">{</span> <span class="n">useState</span><span class="p">,</span> <span class="n">useEffect</span> <span class="p">}</span> <span class="o">=</span> <span class="n">React</span><span class="p">;</span> <span class="o">//</span> <span class="n">web</span><span class="o">-</span><span class="n">browser</span> <span class="n">variant</span>

<span class="n">const</span> <span class="n">StateSelector</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="n">const</span> <span class="n">initialValue</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="n">category</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
      <span class="n">photo</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
      <span class="n">description</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
      <span class="nb">id</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="n">name</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
      <span class="n">rating</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>
  <span class="p">];</span>

  <span class="n">const</span> <span class="p">[</span><span class="n">movies</span><span class="p">,</span> <span class="n">setMovies</span><span class="p">]</span> <span class="o">=</span> <span class="n">useState</span><span class="p">(</span><span class="n">initialValue</span><span class="p">);</span>

  <span class="n">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="p">(</span><span class="k">async</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">const</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fetch</span><span class="p">(</span><span class="s2">"http://192.168.1.164:5000/movies/display"</span><span class="p">);</span>
        <span class="o">//</span> <span class="n">const</span> <span class="n">json</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">();</span>
        <span class="o">//</span> <span class="n">const</span> <span class="n">result</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">result</span><span class="p">;</span>
        <span class="n">const</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="n">category</span><span class="p">:</span> <span class="s2">"cat1"</span><span class="p">,</span>
            <span class="n">description</span><span class="p">:</span> <span class="s2">"desc1"</span><span class="p">,</span>
            <span class="nb">id</span><span class="p">:</span> <span class="s2">"1546514491119"</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span> <span class="s2">"randomname2"</span><span class="p">,</span>
            <span class="n">photo</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
            <span class="n">rating</span><span class="p">:</span> <span class="s2">"3"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="n">category</span><span class="p">:</span> <span class="s2">"cat2"</span><span class="p">,</span>
            <span class="n">description</span><span class="p">:</span> <span class="s2">"desc1"</span><span class="p">,</span>
            <span class="nb">id</span><span class="p">:</span> <span class="s2">"1546837819818"</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span> <span class="s2">"randomname1"</span><span class="p">,</span>
            <span class="n">rating</span><span class="p">:</span> <span class="s2">"5"</span>
          <span class="p">}</span>
        <span class="p">];</span>
        <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"result ="</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
        <span class="n">setMovies</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">"movies ="</span><span class="p">,</span> <span class="n">movies</span><span class="p">);</span>
      <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">})();</span>
  <span class="p">},</span> <span class="p">[]);</span>

  <span class="k">return</span> <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">hello</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">const</span> <span class="n">rootElement</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s2">"root"</span><span class="p">);</span>
<span class="n">ReactDOM</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">&lt;</span><span class="n">StateSelector</span> <span class="o">/&gt;</span><span class="p">,</span> <span class="n">rootElement</span><span class="p">);</span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">"https://unpkg.com/@babel/standalone@7/babel.min.js"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">"https://unpkg.com/react@17/umd/react.production.min.js"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">"https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</pre></div>

<p>Neither <code>setMovies(result)</code> nor <code>setMovies(...result)</code> works.</p>
<p>I expect the <code>result</code> variable to be pushed into the <code>movies</code> array.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Much like <code>.setState()</code> in class components created by extending
<code>React.Component</code> or <code>React.PureComponent</code>, the state update using the updater
provided by <code>useState</code> hook is also asynchronous, and will not be reflected
immediately.</p>
<p><strong>Also, the main issue here is not just the asynchronous nature but the fact
that state values are used by functions based on their current closures, and
state updates will reflect in the next re-render by which the existing
closures are not affected, but new ones are created</strong>. Now in the current
state, the values within hooks are obtained by existing closures, and when a
re-render happens, the closures are updated based on whether the function is
recreated again or not.</p>
<p>Even if you add a <code>setTimeout</code> the function, though the timeout will run after
some time by which the re-render would have happened, the <code>setTimeout</code> will
still use the value from its previous closure and not the updated one.</p>
<div class="code"><pre class="code literal-block">setMovies(result);
console.log(movies) // movies here will not be updated
</pre></div>

<p>If you want to perform an action on state update, you need to use the
<code>useEffect</code> hook, much like using <code>componentDidUpdate</code> in class components
since the setter returned by <code>useState</code> doesn't have a callback pattern</p>
<div class="code"><pre class="code literal-block"><span class="n">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">action</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">movies</span>
<span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">movies</span><span class="o">]</span><span class="p">);</span>
</pre></div>

<p>As far as the syntax to update state is concerned, <code>setMovies(result)</code> will
replace the previous <code>movies</code> value in the state with those available from the
async request.</p>
<p>However, if you want to merge the response with the previously existing
values, you must use the callback syntax of state updation along with the
correct use of spread syntax like</p>
<div class="code"><pre class="code literal-block">setMovies(prevMovies =&gt; ([...prevMovies, ...result]));
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p><em>Additional details to the previous answer:</em></p>
<p>While React's <code>setState</code> <em>is</em> asynchronous (both classes and hooks), and it's
tempting to use that fact to explain the observed behavior, it is not the
<em><strong>reason why</strong></em> it happens.</p>
<p>TLDR: The reason is a closure scope around an immutable <code>const</code> value.</p>
<hr>
<h4><em>Solutions:</em></h4>
<ul>
<li>
<p>read the value in render function (not inside nested functions):</p>
<div class="code"><pre class="code literal-block">  useEffect(() =&gt; { setMovies(result) }, [])
</pre></div>

<p>console.log(movies)</p>
</li>
<li>
<p>add the variable into dependencies (and use the react-hooks/exhaustive-deps eslint rule):</p>
<div class="code"><pre class="code literal-block">  useEffect(() =&gt; { setMovies(result) }, [])
</pre></div>

<p>useEffect(() =&gt; { console.log(movies) }, [movies])</p>
</li>
<li>
<p>use a temporary variable:</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="n">useEffect</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="k">const</span><span class="w"> </span><span class="n">newMovies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span>
<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">newMovies</span><span class="p">)</span>
<span class="n">setMovies</span><span class="p">(</span><span class="n">newMovies</span><span class="p">)</span>
</pre></div>

<p>}, [])</p>
</li>
<li>
<p>use a mutable reference (if we don't need a state and only want to remember the value - updating a ref doesn't trigger re-render):</p>
<div class="code"><pre class="code literal-block"><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">moviesRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useRef</span><span class="p">(</span><span class="n">initialValue</span><span class="p">)</span>
</pre></div>

<p>useEffect(() =&gt; {
    moviesRef.current = result
    console.log(moviesRef.current)
  }, [])</p>
</li>
</ul>
<hr>
<h4><em>Explanation why it happens:</em></h4>
<p>If async was the only reason, it would be possible to <code>await setState()</code>.</p>
<p>However, both <code>props</code> and <code>state</code> are assumed to be unchanging during 1
render.</p>
<blockquote>
<p>Treat <code>this.state</code> as if it were immutable.</p>
</blockquote>
<p>With hooks, this assumption is enhanced by using <strong>constant values</strong> with the
<code>const</code> keyword:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="p">[</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">setState</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">useState</span><span class="p">(</span><span class="s1">'initial'</span><span class="p">)</span>
</pre></div>

<p>The value might be different between 2 renders, but remains a constant inside
the render itself and inside any closures (functions that live longer even
after render is finished, e.g. <code>useEffect</code>, event handlers, inside any Promise
or setTimeout).</p>
<p>Consider following fake, but <strong>synchronous</strong> , React-like implementation:</p>
<div class="code"><pre class="code literal-block">//<span class="w"> </span>sync<span class="w"> </span>implementation:

let<span class="w"> </span>internalState
let<span class="w"> </span>renderAgain

const<span class="w"> </span>setState<span class="w"> </span>=<span class="w"> </span>(updateFn)<span class="w"> </span>=&gt;<span class="w"> </span>{
<span class="w">  </span>internalState<span class="w"> </span>=<span class="w"> </span>updateFn(internalState)
<span class="w">  </span>renderAgain()
}

const<span class="w"> </span>useState<span class="w"> </span>=<span class="w"> </span>(defaultState)<span class="w"> </span>=&gt;<span class="w"> </span>{
<span class="w">  </span>if<span class="w"> </span>(!internalState)<span class="w"> </span>{
<span class="w">    </span>internalState<span class="w"> </span>=<span class="w"> </span>defaultState
<span class="w">  </span>}
<span class="w">  </span>return<span class="w"> </span>[internalState,<span class="w"> </span>setState]
}

const<span class="w"> </span>render<span class="w"> </span>=<span class="w"> </span>(component,<span class="w"> </span>node)<span class="w"> </span>=&gt;<span class="w"> </span>{
<span class="w">  </span>const<span class="w"> </span>{html,<span class="w"> </span>handleClick}<span class="w"> </span>=<span class="w"> </span>component()
<span class="w">  </span>node.innerHTML<span class="w"> </span>=<span class="w"> </span>html
<span class="w">  </span>renderAgain<span class="w"> </span>=<span class="w"> </span>()<span class="w"> </span>=&gt;<span class="w"> </span>render(component,<span class="w"> </span>node)
<span class="w">  </span>return<span class="w"> </span>handleClick
}

//<span class="w"> </span>test:

const<span class="w"> </span>MyComponent<span class="w"> </span>=<span class="w"> </span>()<span class="w"> </span>=&gt;<span class="w"> </span>{
<span class="w">  </span>const<span class="w"> </span>[x,<span class="w"> </span>setX]<span class="w"> </span>=<span class="w"> </span>useState(1)
<span class="w">  </span>console.log('in<span class="w"> </span>render:',<span class="w"> </span>x)<span class="w"> </span>//<span class="w"> </span>✅

<span class="w">  </span>const<span class="w"> </span>handleClick<span class="w"> </span>=<span class="w"> </span>()<span class="w"> </span>=&gt;<span class="w"> </span>{
<span class="w">    </span>setX(current<span class="w"> </span>=&gt;<span class="w"> </span>current<span class="w"> </span>+<span class="w"> </span>1)
<span class="w">    </span>console.log('in<span class="w"> </span>handler/effect/Promise/setTimeout:',<span class="w"> </span>x)<span class="w"> </span>//<span class="w"> </span>❌<span class="w"> </span>NOT<span class="w"> </span>updated
<span class="w">  </span>}

<span class="w">  </span>return<span class="w"> </span>{
<span class="w">    </span>html:<span class="w"> </span>`<span class="nt">&lt;button&gt;</span><span class="cp">${</span><span class="n">x</span><span class="cp">}</span><span class="nt">&lt;/button&gt;</span>`,
<span class="w">    </span>handleClick
<span class="w">  </span>}
}

const<span class="w"> </span>triggerClick<span class="w"> </span>=<span class="w"> </span>render(MyComponent,<span class="w"> </span>document.getElementById('root'))
triggerClick()
triggerClick()
triggerClick()


<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"root"</span><span class="nt">&gt;&lt;/div&gt;</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-791.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-789.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
