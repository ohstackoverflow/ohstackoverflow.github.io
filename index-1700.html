<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1700) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1700.html">
<link rel="prev" href="index-1701.html" type="text/html">
<link rel="next" href="index-1699.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/login-failed-for-user-iis-apppool-asp-net-v4-0/" class="u-url">Login failed for user 'IIS APPPOOL\ASP.NET v4.0'</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/login-failed-for-user-iis-apppool-asp-net-v4-0/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:17:38+08:00" itemprop="datePublished" title="2023-03-03 07:17">2023-03-03 07:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a web project (C# Asp.Net, EF 4, MS SQL 2008 and IIS 7) and I need to
migrate it to IIS 7 locally (at the moment works fine with CASSINI).</p>
<p>Locally in IIS I have my <code>Default Web Site</code> with my deploy. Both my deploy and
<code>Default Web Site</code> are on pool ASP.NET v4.0 (look image for settings) the pool
target Framework 4 as my web project. <img alt="Pool Settings" src="images/nNY78.png"> When
visiting the site, the browser does not show the page and allow the browser to
download the page instead.</p>
<p>I have other projects running on IIS locally and they work with no problems
(but they do not use Entity Framework).</p>
<p>Using the Event Logger I see errors as below:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Exception</span><span class="w"> </span><span class="nv">information</span>:<span class="w"> </span>
<span class="w">    </span><span class="nv">Exception</span><span class="w"> </span><span class="nv">type</span>:<span class="w"> </span><span class="nv">EntityException</span><span class="w"> </span>
<span class="w">    </span><span class="nv">Exception</span><span class="w"> </span><span class="nv">message</span>:<span class="w"> </span><span class="nv">The</span><span class="w"> </span><span class="nv">underlying</span><span class="w"> </span><span class="nv">provider</span><span class="w"> </span><span class="nv">failed</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">Open</span>.
<span class="w">   </span><span class="nv">at</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Data</span>.<span class="nv">EntityClient</span>.<span class="nv">EntityConnection</span>.<span class="nv">OpenStoreConnectionIf</span><span class="ss">(</span><span class="nv">Boolean</span><span class="w"> </span><span class="nv">openCondition</span>,<span class="w"> </span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">storeConnectionToOpen</span>,<span class="w"> </span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">originalConnection</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">exceptionCode</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">attemptedOperation</span>,<span class="w"> </span><span class="nv">Boolean</span><span class="o">&amp;</span><span class="w"> </span><span class="nv">closeStoreConnectionOnFailure</span><span class="ss">)</span>


<span class="w">    </span><span class="nv">Login</span><span class="w"> </span><span class="nv">failed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">user</span><span class="w"> </span><span class="s1">'IIS APPPOOL\ASP.NET v4.0'</span>.
<span class="w">       </span><span class="nv">at</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Data</span>.<span class="nv">ProviderBase</span>.<span class="nv">DbConnectionPool</span>.<span class="nv">GetConnection</span><span class="ss">(</span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">owningObject</span><span class="ss">)</span>
<span class="w">       </span><span class="nv">at</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Data</span>.<span class="nv">ProviderBase</span>.<span class="nv">DbConnectionFactory</span>.<span class="nv">GetConnection</span><span class="ss">(</span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">owningConnection</span><span class="ss">)</span>
<span class="w">       </span><span class="nv">at</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Data</span>.<span class="nv">ProviderBase</span>.<span class="nv">DbConnectionClosed</span>.<span class="nv">OpenConnection</span><span class="ss">(</span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">outerConnection</span>,<span class="w"> </span><span class="nv">DbConnectionFactory</span><span class="w"> </span><span class="nv">connectionFactory</span><span class="ss">)</span>
<span class="w">       </span><span class="nv">at</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Data</span>.<span class="nv">SqlClient</span>.<span class="nv">SqlConnection</span>.<span class="nv">Open</span><span class="ss">()</span>
<span class="w">       </span><span class="nv">at</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Data</span>.<span class="nv">EntityClient</span>.<span class="nv">EntityConnection</span>.<span class="nv">OpenStoreConnectionIf</span><span class="ss">(</span><span class="nv">Boolean</span><span class="w"> </span><span class="nv">openCondition</span>,<span class="w"> </span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">storeConnectionToOpen</span>,<span class="w"> </span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">originalConnection</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">exceptionCode</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">attemptedOperation</span>,<span class="w"> </span><span class="nv">Boolean</span><span class="o">&amp;</span><span class="w"> </span><span class="nv">closeStoreConnectionOnFailure</span><span class="ss">)</span>
</pre></div>

<p>Related question</p>
<p>UPDATE: You can read in the resources on this question that permissions must
be granted on MS SQL 2008 manually as arift explain in his answer. Using IIS
7.5 and MS SQL 2008 R2, setting manually permission should not be necessary.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Looks like it's failing trying to open a connection to SQL Server.</p>
<p>You need to add a login to SQL Server for <code>IIS APPPOOL\ASP.NET v4.0</code> and grant
permissions to the database.</p>
<p>In SSMS, under the server, expand Security, then right click Logins and select
"New Login...".</p>
<p>In the New Login dialog, enter the app pool as the login name and click "OK".</p>
<p><img alt="enter image description here" src="images/6sfIM.png"></p>
<p>You can then right click the login for the app pool, select Properties and
select "User Mapping". Check the appropriate database, and the appropriate
roles. I think you could just select <code>db_datareader</code> and <code>db_datawriter</code>, but
I think you would still need to grant permissions to execute stored procedures
if you do that through EF. You can check the details for the roles here.</p>
<p><br></p>
<h3>Suggest</h3>
<p>You can change the ApplicationPoolIdentity from IIS7 -&gt; Application Pools -&gt;
Advanced Settings. <img alt="AdvancedSettings" src="images/PcbL4.png"></p>
<p>Under ApplicationPoolIdentity you will find local system. This will make your
application run under <code>NT AUTHORITY\SYSTEM</code>, which is an existing login for
the database by default.</p>
<p><strong>Edit: Before applying this suggestion you should note and understand the
security implications.</strong></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/git-patch-does-not-apply/" class="u-url">git: patch does not apply</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/git-patch-does-not-apply/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:17:13+08:00" itemprop="datePublished" title="2023-03-03 07:17">2023-03-03 07:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a certain patch called my_pcc_branch.patch.</p>
<p>When I try to apply it, I get following message:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>git<span class="w"> </span>apply<span class="w"> </span>--check<span class="w"> </span>my_pcc_branch.patch
warning:<span class="w"> </span>src/main/java/.../AbstractedPanel.java<span class="w"> </span>has<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">100644</span>,<span class="w"> </span>expected<span class="w"> </span><span class="m">100755</span>
error:<span class="w"> </span>patch<span class="w"> </span>failed:<span class="w"> </span>src/main/java/.../AbstractedPanel.java:13
error:<span class="w"> </span>src/main/java/.../AbstractedPanel.java:<span class="w"> </span>patch<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>apply
</pre></div>

<p>What does it mean?</p>
<p>How can I fix this problem?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Johannes Sixt from the msysgit@googlegroups.com mailing list suggested using
following command line arguments:</p>
<div class="code"><pre class="code literal-block">git apply --ignore-space-change --ignore-whitespace mychanges.patch
</pre></div>

<p>This solved my problem.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Johannes Sixt from the msysgit@googlegroups.com mailing list suggested using
following command line arguments:</p>
<div class="code"><pre class="code literal-block">git apply --ignore-space-change --ignore-whitespace mychanges.patch
</pre></div>

<p>This solved my problem.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/android-expand-collapse-animation/" class="u-url">Android: Expand/collapse animation</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/android-expand-collapse-animation/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:16:44+08:00" itemprop="datePublished" title="2023-03-03 07:16">2023-03-03 07:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Let's say I have a vertical linearLayout with :</p>
<div class="code"><pre class="code literal-block"><span class="k">[v1]</span>
<span class="k">[v2]</span>
</pre></div>

<p>By default v1 has visibily = GONE. I would like to show v1 with an expand
animation and push down v2 at the same time.</p>
<p>I tried something like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">Animation</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Animation</span><span class="p">()</span>
<span class="err">{</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">initialHeight</span><span class="p">;</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">applyTransformation</span><span class="p">(</span><span class="nc">float</span><span class="w"> </span><span class="n">interpolatedTime</span><span class="p">,</span><span class="w"> </span><span class="n">Transformation</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">final</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">newHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nc">int</span><span class="p">)(</span><span class="n">initialHeight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">interpolatedTime</span><span class="p">);</span>
<span class="w">        </span><span class="n">v</span><span class="p">.</span><span class="n">getLayoutParams</span><span class="p">().</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newHeight</span><span class="p">;</span>
<span class="w">        </span><span class="n">v</span><span class="p">.</span><span class="n">requestLayout</span><span class="p">();</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="k">initialize</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">parentWidth</span><span class="p">,</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">parentHeight</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">super</span><span class="p">.</span><span class="k">initialize</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">parentWidth</span><span class="p">,</span><span class="w"> </span><span class="n">parentHeight</span><span class="p">);</span>
<span class="w">        </span><span class="n">initialHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">height</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">willChangeBounds</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span><span class="p">;</span>
</pre></div>

<p>But with this solution, I have a blink when the animation starts. I think it's
caused by v1 displaying full size before the animation is applied.</p>
<p>With javascript, this is one line of jQuery! Any simple way to do this with
android?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I see that this question became popular so I post my actual solution. The main
advantage is that you don't have to know the expanded height to apply the
animation and once the view is expanded, it adapts height if content changes.
It works great for me.</p>
<div class="code"><pre class="code literal-block"><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">expand</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="k">View</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">matchParentMeasureSpec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">View</span><span class="p">.</span><span class="n">MeasureSpec</span><span class="p">.</span><span class="n">makeMeasureSpec</span><span class="p">(((</span><span class="k">View</span><span class="p">)</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">getParent</span><span class="p">()).</span><span class="n">getWidth</span><span class="p">(),</span><span class="w"> </span><span class="k">View</span><span class="p">.</span><span class="n">MeasureSpec</span><span class="p">.</span><span class="n">EXACTLY</span><span class="p">);</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">wrapContentMeasureSpec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">View</span><span class="p">.</span><span class="n">MeasureSpec</span><span class="p">.</span><span class="n">makeMeasureSpec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">View</span><span class="p">.</span><span class="n">MeasureSpec</span><span class="p">.</span><span class="n">UNSPECIFIED</span><span class="p">);</span>
<span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">measure</span><span class="p">(</span><span class="n">matchParentMeasureSpec</span><span class="p">,</span><span class="w"> </span><span class="n">wrapContentMeasureSpec</span><span class="p">);</span>
<span class="w">    </span><span class="n">final</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">targetHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">getMeasuredHeight</span><span class="p">();</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Older</span><span class="w"> </span><span class="n">versions</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">android</span><span class="w"> </span><span class="p">(</span><span class="n">pre</span><span class="w"> </span><span class="n">API</span><span class="w"> </span><span class="mi">21</span><span class="p">)</span><span class="w"> </span><span class="n">cancel</span><span class="w"> </span><span class="n">animations</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">views</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mf">0.</span>
<span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">getLayoutParams</span><span class="p">().</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">setVisibility</span><span class="p">(</span><span class="k">View</span><span class="p">.</span><span class="n">VISIBLE</span><span class="p">);</span>
<span class="w">    </span><span class="n">Animation</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Animation</span><span class="p">()</span>
<span class="w">    </span><span class="err">{</span>
<span class="w">        </span><span class="nv">@Override</span>
<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">applyTransformation</span><span class="p">(</span><span class="nc">float</span><span class="w"> </span><span class="n">interpolatedTime</span><span class="p">,</span><span class="w"> </span><span class="n">Transformation</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">v</span><span class="p">.</span><span class="n">getLayoutParams</span><span class="p">().</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">interpolatedTime</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="vm">?</span><span class="w"> </span><span class="n">LayoutParams</span><span class="p">.</span><span class="n">WRAP_CONTENT</span>
<span class="w">                    </span><span class="err">:</span><span class="w"> </span><span class="p">(</span><span class="nc">int</span><span class="p">)(</span><span class="n">targetHeight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">interpolatedTime</span><span class="p">);</span>
<span class="w">            </span><span class="n">v</span><span class="p">.</span><span class="n">requestLayout</span><span class="p">();</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="nv">@Override</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">willChangeBounds</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span><span class="p">;</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Expansion</span><span class="w"> </span><span class="n">speed</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">1</span><span class="n">dp</span><span class="o">/</span><span class="n">ms</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">setDuration</span><span class="p">((</span><span class="nc">int</span><span class="p">)(</span><span class="n">targetHeight</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">getContext</span><span class="p">().</span><span class="n">getResources</span><span class="p">().</span><span class="n">getDisplayMetrics</span><span class="p">().</span><span class="n">density</span><span class="p">));</span>
<span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">startAnimation</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="err">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">collapse</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="k">View</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">final</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">initialHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">getMeasuredHeight</span><span class="p">();</span>

<span class="w">    </span><span class="n">Animation</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Animation</span><span class="p">()</span>
<span class="w">    </span><span class="err">{</span>
<span class="w">        </span><span class="nv">@Override</span>
<span class="w">        </span><span class="n">protected</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">applyTransformation</span><span class="p">(</span><span class="nc">float</span><span class="w"> </span><span class="n">interpolatedTime</span><span class="p">,</span><span class="w"> </span><span class="n">Transformation</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">interpolatedTime</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="err">{</span>
<span class="w">                </span><span class="n">v</span><span class="p">.</span><span class="n">setVisibility</span><span class="p">(</span><span class="k">View</span><span class="p">.</span><span class="n">GONE</span><span class="p">);</span>
<span class="w">            </span><span class="err">}</span><span class="k">else</span><span class="err">{</span>
<span class="w">                </span><span class="n">v</span><span class="p">.</span><span class="n">getLayoutParams</span><span class="p">().</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initialHeight</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nc">int</span><span class="p">)(</span><span class="n">initialHeight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">interpolatedTime</span><span class="p">);</span>
<span class="w">                </span><span class="n">v</span><span class="p">.</span><span class="n">requestLayout</span><span class="p">();</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="nv">@Override</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">boolean</span><span class="w"> </span><span class="n">willChangeBounds</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span><span class="p">;</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Collapse</span><span class="w"> </span><span class="n">speed</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">1</span><span class="n">dp</span><span class="o">/</span><span class="n">ms</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">setDuration</span><span class="p">((</span><span class="nc">int</span><span class="p">)(</span><span class="n">initialHeight</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">getContext</span><span class="p">().</span><span class="n">getResources</span><span class="p">().</span><span class="n">getDisplayMetrics</span><span class="p">().</span><span class="n">density</span><span class="p">));</span>
<span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">startAnimation</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="err">}</span>
</pre></div>

<p>As mentioned by @Jefferson in the comments, you can obtain a smoother
animation by changing the duration (and hence the speed) of the animation.
Currently, it has been set at a speed of 1dp/ms</p>
<p><br></p>
<h3>Suggest</h3>
<p>I stumbled over the same problem today and I guess the real solution to this
question is this</p>
<div class="code"><pre class="code literal-block">&lt;LinearLayout android:id="@+id/container"
android:animateLayoutChanges="true"
...
 /&gt;
</pre></div>

<p><em><strong>You will have to set this property for all topmost layouts, which are
involved in the shift.</strong></em> If you now set the visibility of one layout to GONE,
the other will take the space as the disappearing one is releasing it. There
will be a default animation which is some kind of "fading out", but I think
you can change this - but the last one I have not tested, for now.</p>
<hr>
<p>If using this in a RecyclerView item, set the visibility of the view to
expand/collapse in onBindViewHolder and call notifyItemChanged(position) to
trigger the transformation.</p>
<div class="code"><pre class="code literal-block"><span class="n">override</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="n">onBindViewHolder</span><span class="p">(</span><span class="nl">holder</span><span class="p">:</span><span class="w"> </span><span class="n">ItemViewHolder</span><span class="p">,</span><span class="w"> </span><span class="k">position</span><span class="err">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="p">...</span>

<span class="w">        </span><span class="n">holder</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">visibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">data</span><span class="o">[</span><span class="n">position</span><span class="o">]</span><span class="p">.</span><span class="n">listVisibility</span>
<span class="w">        </span><span class="n">holder</span><span class="p">.</span><span class="n">expandCollapse</span><span class="p">.</span><span class="n">setOnClickListener</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="k">data</span><span class="o">[</span><span class="n">position</span><span class="o">]</span><span class="p">.</span><span class="n">listVisibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">data</span><span class="o">[</span><span class="n">position</span><span class="o">]</span><span class="p">.</span><span class="n">listVisibility</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">View</span><span class="p">.</span><span class="n">GONE</span><span class="p">)</span><span class="w"> </span><span class="k">View</span><span class="p">.</span><span class="n">VISIBLE</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">View</span><span class="p">.</span><span class="n">GONE</span>
<span class="w">            </span><span class="n">notifyItemChanged</span><span class="p">(</span><span class="k">position</span><span class="p">)</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
</pre></div>

<p>If you perform expensive operations in onBindViewHolder you can optimize for
partial changes using notifyItemChanged(position, payload)</p>
<div class="code"><pre class="code literal-block"><span class="n">private</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="n">UPDATE_LIST_VISIBILITY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="n">override</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="n">onBindViewHolder</span><span class="p">(</span><span class="n">holder</span><span class="p">:</span><span class="w"> </span><span class="n">ItemViewHolder</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="p">,</span><span class="w"> </span><span class="n">payloads</span><span class="p">:</span><span class="w"> </span><span class="n">MutableList</span><span class="o">&lt;</span><span class="n">Any</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">payloads</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">UPDATE_LIST_VISIBILITY</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">holder</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">visibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">]</span><span class="o">.</span><span class="n">listVisibility</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">onBindViewHolder</span><span class="p">(</span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">override</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="n">onBindViewHolder</span><span class="p">(</span><span class="n">holder</span><span class="p">:</span><span class="w"> </span><span class="n">ItemViewHolder</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">...</span>

<span class="w">        </span><span class="n">holder</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">visibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">]</span><span class="o">.</span><span class="n">listVisibility</span>
<span class="w">        </span><span class="n">holder</span><span class="o">.</span><span class="n">expandCollapse</span><span class="o">.</span><span class="n">setOnClickListener</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">]</span><span class="o">.</span><span class="n">listVisibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">]</span><span class="o">.</span><span class="n">listVisibility</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">View</span><span class="o">.</span><span class="n">GONE</span><span class="p">)</span><span class="w"> </span><span class="n">View</span><span class="o">.</span><span class="n">VISIBLE</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">View</span><span class="o">.</span><span class="n">GONE</span>
<span class="w">            </span><span class="n">notifyItemChanged</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">UPDATE_LIST_VISIBILITY</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1701.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1699.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
