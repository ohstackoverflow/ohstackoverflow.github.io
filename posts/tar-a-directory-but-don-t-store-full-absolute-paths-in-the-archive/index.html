<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tar a directory, but don't store full absolute paths in the archive | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/tar-a-directory-but-don-t-store-full-absolute-paths-in-the-archive/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-can-i-include-a-yaml-file-inside-another/" title="How can I include a YAML file inside another?" type="text/html">
<link rel="next" href="../why-do-i-get-attributeerror-nonetype-object-has-no-attribute-something/" title="Why do I get AttributeError: 'NoneType' object has no attribute 'something'?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Tar a directory, but don't store full absolute paths in the archive">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/tar-a-directory-but-don-t-store-full-absolute-paths-in-the-archive/">
<meta property="og:description" content="I have the following command in the part of a backup shell script:
tar -cjf site1.bz2 /var/www/site1/


When I list the contents of the archive, I get:
tar -tf site1.bz2
var/www/site1/style.css
var/ww">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T15:14:20+08:00">
<meta property="article:tag" content="backup">
<meta property="article:tag" content="bash">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="tar">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Tar a directory, but don't store full absolute paths in the archive</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T15:14:20+08:00" itemprop="datePublished" title="2023-03-03 15:14">2023-03-03 15:14</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I have the following command in the part of a backup shell script:</p>
<div class="code"><pre class="code literal-block"><span class="n">tar</span><span class="w"> </span><span class="o">-</span><span class="n">cjf</span><span class="w"> </span><span class="n">site1</span><span class="o">.</span><span class="n">bz2</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span>
</pre></div>

<p>When I list the contents of the archive, I get:</p>
<div class="code"><pre class="code literal-block"><span class="n">tar</span><span class="w"> </span><span class="o">-</span><span class="n">tf</span><span class="w"> </span><span class="n">site1</span><span class="o">.</span><span class="n">bz2</span>
<span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span><span class="n">style</span><span class="o">.</span><span class="n">css</span>
<span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
<span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span><span class="n">page2</span><span class="o">.</span><span class="n">html</span>
<span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span><span class="n">page3</span><span class="o">.</span><span class="n">html</span>
<span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">img1</span><span class="o">.</span><span class="n">png</span>
<span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">img2</span><span class="o">.</span><span class="n">png</span>
<span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span><span class="n">subdir</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
</pre></div>

<p>But I would like to remove the part <code>/var/www/site1</code> from directory and file
names within the archive, in order to simplify extraction and avoid useless
constant directory structure. Never know, in case I would extract backuped
websites in a place where web data weren't stored under <code>/var/www</code>.</p>
<p>For the example above, I would like to have :</p>
<div class="code"><pre class="code literal-block">tar -tf site1.bz2
style.css
index.html
page2.html
page3.html
images/img1.png
images/img2.png
subdir/index.html
</pre></div>

<p>So, that when I extract, files are extracted in the current directory and I
don't need to move extracted files afterwards, and so that sub-directory
structures is preserved.</p>
<p>There are already many questions about tar and backuping in <code>stackoverflow</code>
and at other places on the web, but most of them ask for dropping the entire
sub-directory structure (flattening), or just add or remove the initial / in
the names (I don't know what it changes exactly when extracting), but no more.</p>
<p>After having read some of the solutions found here and there as well as the
manual, I tried :</p>
<div class="code"><pre class="code literal-block"><span class="n">tar</span><span class="w"> </span><span class="o">-</span><span class="n">cjf</span><span class="w"> </span><span class="n">site1</span><span class="o">.</span><span class="n">bz2</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span>
<span class="n">tar</span><span class="w"> </span><span class="o">-</span><span class="n">cjf</span><span class="w"> </span><span class="n">site1</span><span class="o">.</span><span class="n">bz2</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span>
<span class="n">tar</span><span class="w"> </span><span class="o">-</span><span class="n">cjf</span><span class="w"> </span><span class="n">site1</span><span class="o">.</span><span class="n">bz2</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span>
<span class="n">tar</span><span class="w"> </span><span class="o">-</span><span class="n">cjf</span><span class="w"> </span><span class="n">site1</span><span class="o">.</span><span class="n">bz2</span><span class="w"> </span><span class="o">--</span><span class="n">strip</span><span class="o">-</span><span class="n">components</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="o">/</span>
</pre></div>

<p>But none of them worked the way I want. Some do nothing, some others don't
archive sub-directories anymore.</p>
<p>It's inside a backup shell script launched by a Cron, so I don't know well,
which user runs it, what is the path and the current directory, so always
writing absolute path is required for everything, and would prefer not
changing current directory to avoid breaking something further in the script
(because it doesn't only backup websites, but also databases, then send all
that to FTP etc.)</p>
<p>How to achieve this?</p>
<p>Have I just misunderstood how the option -C works?</p>
<p><br><br></p>
<h2>Answer</h2>
<div class="code"><pre class="code literal-block"><span class="n">tar</span><span class="w"> </span><span class="o">-</span><span class="n">cjf</span><span class="w"> </span><span class="n">site1</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">bz2</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">site1</span><span class="w"> </span><span class="o">.</span>
</pre></div>

<p>In the above example, tar will change to directory <code>/var/www/site1</code> before
doing its thing because the option <code>-C /var/www/site1</code> was given.</p>
<p>From <code>man tar</code>:</p>
<div class="code"><pre class="code literal-block">OTHER OPTIONS

  -C, --directory DIR
       change to directory DIR
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>The option <code>-C</code> works; just for clarification I'll post 2 examples:</p>
<ol>
<li>creation of a tarball without the full path: full path <code>/home/testuser/workspace/project/application.war</code> and what we want is just <code>project/application.war</code> so:<div class="code"><pre class="code literal-block">tar -cvf output_filename.tar  -C /home/testuser/workspace project
</pre></div>

</li>
</ol>
<p>Note: there is a space between <code>workspace</code> and <code>project</code>; tar will replace
full path with just <code>project</code> .</p>
<ol>
<li>extraction of tarball with changing the target path (default to <code>.</code>, i.e current directory)<div class="code"><pre class="code literal-block">tar -xvf output_filename.tar -C /home/deploy/
</pre></div>

</li>
</ol>
<p><code>tar</code> will extract tarball based on given path and preserving the creation
path; in our example the file <code>application.war</code> will be extracted to
<code>/home/deploy/project/application.war</code>.</p>
<p><code>/home/deploy</code>: given on extract<br><code>project</code>: given on creation of tarball</p>
<p>Note : if you want to place the created tarball in a target directory, you
just add the target path before tarball name. e.g.:</p>
<div class="code"><pre class="code literal-block">tar -cvf /path/to/place/output_filename.tar  -C /home/testuser/workspace project
</pre></div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/backup/" rel="tag">backup</a></li>
            <li><a class="tag p-category" href="../../categories/bash/" rel="tag">bash</a></li>
            <li><a class="tag p-category" href="../../categories/linux/" rel="tag">linux</a></li>
            <li><a class="tag p-category" href="../../categories/tar/" rel="tag">tar</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-can-i-include-a-yaml-file-inside-another/" rel="prev" title="How can I include a YAML file inside another?">Previous post</a>
            </li>
            <li class="next">
                <a href="../why-do-i-get-attributeerror-nonetype-object-has-no-attribute-something/" rel="next" title="Why do I get AttributeError: 'NoneType' object has no attribute 'something'?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
