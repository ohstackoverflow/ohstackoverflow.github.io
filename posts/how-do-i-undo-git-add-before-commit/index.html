<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How do I undo 'git add' before commit? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-do-i-undo-git-add-before-commit/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-do-i-rename-a-local-git-branch/" title="How do I rename a local Git branch?" type="text/html">
<link rel="next" href="../what-is-the-operator-in-c/" title='What is the "--&gt;" operator in C++?' type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="How do I undo 'git add' before commit?">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-do-i-undo-git-add-before-commit/">
<meta property="og:description" content="Want to improve this post? Provide detailed answers to this question,
including citations and an explanation of why your answer is correct. Answers
without enough detail may be edited or deleted.
I mi">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-16T18:15:20+08:00">
<meta property="article:tag" content="git">
<meta property="article:tag" content="git-add">
<meta property="article:tag" content="undo">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How do I undo 'git add' before commit?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T18:15:20+08:00" itemprop="datePublished" title="2023-02-16 18:15">2023-02-16 18:15</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p><strong>Want to improve this post?</strong> Provide detailed answers to this question,
including citations and an explanation of why your answer is correct. Answers
without enough detail may be edited or deleted.</p>
<p>I mistakenly added files to Git using the command:</p>
<div class="code"><pre class="code literal-block">git add myfile.txt
</pre></div>

<p>I have not yet run <code>git commit</code>. How do I undo this so that these changes will
not be included in the commit?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Undo <code>git add</code> for uncommitted changes with:</p>
<div class="code"><pre class="code literal-block">git reset &lt;file&gt;
</pre></div>

<p>That will remove the file from the current index (the "about to be committed"
list) without changing anything else.</p>
<hr>
<p>To unstage all changes for all files:</p>
<div class="code"><pre class="code literal-block">git reset
</pre></div>

<hr>
<p>In old versions of Git, the above commands are equivalent to <code>git reset HEAD
&lt;file&gt;</code> and <code>git reset HEAD</code> respectively, and will fail if <code>HEAD</code> is
undefined (because you haven't yet made any commits in your repository) or
ambiguous (because you created a branch called <code>HEAD</code>, which is a stupid thing
that you shouldn't do). This was changed in Git 1.8.2, though, so in modern
versions of Git you can use the commands above even prior to making your first
commit:</p>
<blockquote>
<p>"git reset" (without options or parameters) used to error out when you do
not have any commits in your history, but it now gives you an empty index
(to match non-existent commit you are not even on).</p>
</blockquote>
<p>Documentation: <strong>git reset</strong></p>
<p><br></p>
<h3>Suggest</h3>
<p>You want:</p>
<div class="code"><pre class="code literal-block">git rm --cached &lt;added_file_to_undo&gt;
</pre></div>

<p>Reasoning:</p>
<p>When I was new to this, I first tried</p>
<div class="code"><pre class="code literal-block">git reset .
</pre></div>

<p>(to undo my entire initial add), only to get this (not so) helpful message:</p>
<div class="code"><pre class="code literal-block"><span class="n">fatal</span><span class="o">:</span><span class="w"> </span><span class="n">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="s1">'HEAD'</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="n">ref</span><span class="o">.</span>
</pre></div>

<p>It turns out that this is because the HEAD ref (branch?) doesn't exist until
after the first commit. That is, you'll run into the same beginner's problem
as me if your workflow, like mine, was something like:</p>
<ol>
<li>cd to my great new project directory to try out Git, the new hotness</li>
<li><code>git init</code></li>
<li><code>git add .</code></li>
<li><code>git status</code></li>
</ol>
<p>... lots of crap scrolls by ...</p>
<p>=&gt; Damn, I didn't want to add all of that.</p>
<ol>
<li>google "undo git add"</li>
</ol>
<p>=&gt; find Stack Overflow - yay</p>
<ol>
<li><code>git reset .</code></li>
</ol>
<p>=&gt; fatal: Failed to resolve 'HEAD' as a valid ref.</p>
<p>It further turns out that there's a bug logged against the unhelpfulness of
this in the mailing list.</p>
<p>And that the correct solution was right there in the Git status output (which,
yes, I glossed over as 'crap)</p>
<blockquote>
<div class="code"><pre class="code literal-block">...
# Changes to be committed:
#   (use "git rm --cached &lt;file&gt;..." to unstage)
...
</pre></div>

</blockquote>
<p>And the solution indeed is to use <code>git rm --cached FILE</code>.</p>
<p>Note the warnings elsewhere here - <code>git rm</code> deletes your local working copy of
the file, but <em>not</em> if you use <strong>--cached</strong>. Here's the result of <code>git help
rm</code>:</p>
<blockquote>
<p>--cached Use this option to unstage and remove paths only from the index.
Working tree files, whether modified or not, will be left.</p>
</blockquote>
<p>I proceed to use</p>
<div class="code"><pre class="code literal-block">git rm --cached .
</pre></div>

<p>to remove everything and start again. Didn't work though, because while <code>add
.</code> is recursive, turns out <code>rm</code> needs <code>-r</code> to recurse. Sigh.</p>
<div class="code"><pre class="code literal-block">git rm -r --cached .
</pre></div>

<p>Okay, now I'm back to where I started. Next time I'm going to use <code>-n</code> to do a
dry run and see what will be added:</p>
<div class="code"><pre class="code literal-block">git add -n .
</pre></div>

<p>I zipped up everything to a safe place before trusting <code>git help rm</code> about the
<code>--cached</code> not destroying anything (and what if I misspelled it).</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/git/" rel="tag">git</a></li>
            <li><a class="tag p-category" href="../../categories/git-add/" rel="tag">git-add</a></li>
            <li><a class="tag p-category" href="../../categories/undo/" rel="tag">undo</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-do-i-rename-a-local-git-branch/" rel="prev" title="How do I rename a local Git branch?">Previous post</a>
            </li>
            <li class="next">
                <a href="../what-is-the-operator-in-c/" rel="next" title='What is the "--&gt;" operator in C++?'>Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
