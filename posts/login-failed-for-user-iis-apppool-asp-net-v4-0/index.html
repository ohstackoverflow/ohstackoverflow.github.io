<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Login failed for user 'IIS APPPOOL\ASP.NET v4.0' | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/login-failed-for-user-iis-apppool-asp-net-v4-0/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../git-patch-does-not-apply/" title="git: patch does not apply" type="text/html">
<link rel="next" href="../adding-script-tag-to-react-jsx/" title="Adding script tag to React/JSX" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Login failed for user 'IIS APPPOOL\ASP.NET v4.0'">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/login-failed-for-user-iis-apppool-asp-net-v4-0/">
<meta property="og:description" content="I have a web project (C# Asp.Net, EF 4, MS SQL 2008 and IIS 7) and I need to
migrate it to IIS 7 locally (at the moment works fine with CASSINI).
Locally in IIS I have my Default Web Site with my depl">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T07:17:38+08:00">
<meta property="article:tag" content=".net-c#">
<meta property="article:tag" content="asp.net">
<meta property="article:tag" content="iis-7">
<meta property="article:tag" content="web-config">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Login failed for user 'IIS APPPOOL\ASP.NET v4.0'</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:17:38+08:00" itemprop="datePublished" title="2023-03-03 07:17">2023-03-03 07:17</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I have a web project (C# Asp.Net, EF 4, MS SQL 2008 and IIS 7) and I need to
migrate it to IIS 7 locally (at the moment works fine with CASSINI).</p>
<p>Locally in IIS I have my <code>Default Web Site</code> with my deploy. Both my deploy and
<code>Default Web Site</code> are on pool ASP.NET v4.0 (look image for settings) the pool
target Framework 4 as my web project. <img alt="Pool Settings" src="../../images/nNY78.png"> When
visiting the site, the browser does not show the page and allow the browser to
download the page instead.</p>
<p>I have other projects running on IIS locally and they work with no problems
(but they do not use Entity Framework).</p>
<p>Using the Event Logger I see errors as below:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Exception</span><span class="w"> </span><span class="nv">information</span>:<span class="w"> </span>
<span class="w">    </span><span class="nv">Exception</span><span class="w"> </span><span class="nv">type</span>:<span class="w"> </span><span class="nv">EntityException</span><span class="w"> </span>
<span class="w">    </span><span class="nv">Exception</span><span class="w"> </span><span class="nv">message</span>:<span class="w"> </span><span class="nv">The</span><span class="w"> </span><span class="nv">underlying</span><span class="w"> </span><span class="nv">provider</span><span class="w"> </span><span class="nv">failed</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">Open</span>.
<span class="w">   </span><span class="nv">at</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Data</span>.<span class="nv">EntityClient</span>.<span class="nv">EntityConnection</span>.<span class="nv">OpenStoreConnectionIf</span><span class="ss">(</span><span class="nv">Boolean</span><span class="w"> </span><span class="nv">openCondition</span>,<span class="w"> </span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">storeConnectionToOpen</span>,<span class="w"> </span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">originalConnection</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">exceptionCode</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">attemptedOperation</span>,<span class="w"> </span><span class="nv">Boolean</span><span class="o">&amp;</span><span class="w"> </span><span class="nv">closeStoreConnectionOnFailure</span><span class="ss">)</span>


<span class="w">    </span><span class="nv">Login</span><span class="w"> </span><span class="nv">failed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">user</span><span class="w"> </span><span class="s1">'IIS APPPOOL\ASP.NET v4.0'</span>.
<span class="w">       </span><span class="nv">at</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Data</span>.<span class="nv">ProviderBase</span>.<span class="nv">DbConnectionPool</span>.<span class="nv">GetConnection</span><span class="ss">(</span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">owningObject</span><span class="ss">)</span>
<span class="w">       </span><span class="nv">at</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Data</span>.<span class="nv">ProviderBase</span>.<span class="nv">DbConnectionFactory</span>.<span class="nv">GetConnection</span><span class="ss">(</span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">owningConnection</span><span class="ss">)</span>
<span class="w">       </span><span class="nv">at</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Data</span>.<span class="nv">ProviderBase</span>.<span class="nv">DbConnectionClosed</span>.<span class="nv">OpenConnection</span><span class="ss">(</span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">outerConnection</span>,<span class="w"> </span><span class="nv">DbConnectionFactory</span><span class="w"> </span><span class="nv">connectionFactory</span><span class="ss">)</span>
<span class="w">       </span><span class="nv">at</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Data</span>.<span class="nv">SqlClient</span>.<span class="nv">SqlConnection</span>.<span class="nv">Open</span><span class="ss">()</span>
<span class="w">       </span><span class="nv">at</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Data</span>.<span class="nv">EntityClient</span>.<span class="nv">EntityConnection</span>.<span class="nv">OpenStoreConnectionIf</span><span class="ss">(</span><span class="nv">Boolean</span><span class="w"> </span><span class="nv">openCondition</span>,<span class="w"> </span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">storeConnectionToOpen</span>,<span class="w"> </span><span class="nv">DbConnection</span><span class="w"> </span><span class="nv">originalConnection</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">exceptionCode</span>,<span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">attemptedOperation</span>,<span class="w"> </span><span class="nv">Boolean</span><span class="o">&amp;</span><span class="w"> </span><span class="nv">closeStoreConnectionOnFailure</span><span class="ss">)</span>
</pre></div>

<p>Related question</p>
<p>UPDATE: You can read in the resources on this question that permissions must
be granted on MS SQL 2008 manually as arift explain in his answer. Using IIS
7.5 and MS SQL 2008 R2, setting manually permission should not be necessary.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Looks like it's failing trying to open a connection to SQL Server.</p>
<p>You need to add a login to SQL Server for <code>IIS APPPOOL\ASP.NET v4.0</code> and grant
permissions to the database.</p>
<p>In SSMS, under the server, expand Security, then right click Logins and select
"New Login...".</p>
<p>In the New Login dialog, enter the app pool as the login name and click "OK".</p>
<p><img alt="enter image description here" src="../../images/6sfIM.png"></p>
<p>You can then right click the login for the app pool, select Properties and
select "User Mapping". Check the appropriate database, and the appropriate
roles. I think you could just select <code>db_datareader</code> and <code>db_datawriter</code>, but
I think you would still need to grant permissions to execute stored procedures
if you do that through EF. You can check the details for the roles here.</p>
<p><br></p>
<h3>Suggest</h3>
<p>You can change the ApplicationPoolIdentity from IIS7 -&gt; Application Pools -&gt;
Advanced Settings. <img alt="AdvancedSettings" src="../../images/PcbL4.png"></p>
<p>Under ApplicationPoolIdentity you will find local system. This will make your
application run under <code>NT AUTHORITY\SYSTEM</code>, which is an existing login for
the database by default.</p>
<p><strong>Edit: Before applying this suggestion you should note and understand the
security implications.</strong></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/net-c/" rel="tag">.net-c#</a></li>
            <li><a class="tag p-category" href="../../categories/aspnet/" rel="tag">asp.net</a></li>
            <li><a class="tag p-category" href="../../categories/iis-7/" rel="tag">iis-7</a></li>
            <li><a class="tag p-category" href="../../categories/web-config/" rel="tag">web-config</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../git-patch-does-not-apply/" rel="prev" title="git: patch does not apply">Previous post</a>
            </li>
            <li class="next">
                <a href="../adding-script-tag-to-react-jsx/" rel="next" title="Adding script tag to React/JSX">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
