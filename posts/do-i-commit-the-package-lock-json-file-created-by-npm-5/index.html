<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Do I commit the package-lock.json file created by npm 5? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/do-i-commit-the-package-lock-json-file-created-by-npm-5/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-do-i-set-a-variable-to-the-output-of-a-command-in-bash/" title="How do I set a variable to the output of a command in Bash?" type="text/html">
<link rel="next" href="../javascript-check-if-variable-exists-is-defined-initialized/" title="JavaScript check if variable exists (is defined/initialized)" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Do I commit the package-lock.json file created by npm 5?">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/do-i-commit-the-package-lock-json-file-created-by-npm-5/">
<meta property="og:description" content="npm 5 was released today and one of the new features include deterministic
installs with the creation of a package-lock.json file.
Is this file supposed to be kept in source control?
I'm assuming it's">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-16T21:51:16+08:00">
<meta property="article:tag" content="git">
<meta property="article:tag" content="lockfile">
<meta property="article:tag" content="node.js">
<meta property="article:tag" content="npm">
<meta property="article:tag" content="version-control">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Do I commit the package-lock.json file created by npm 5?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T21:51:16+08:00" itemprop="datePublished" title="2023-02-16 21:51">2023-02-16 21:51</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>npm 5 was released today and one of the new features include deterministic
installs with the creation of a <code>package-lock.json</code> file.</p>
<p>Is this file supposed to be kept in source control?</p>
<p>I'm assuming it's similar to <code>yarn.lock</code> and <code>composer.lock</code>, both of which
are supposed to be kept in source control.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Yes, <code>package-lock.json</code> is intended to be checked into source control. If
you're using npm 5+, you may see this notice on the command line: <code>created a
lockfile as package-lock.json. You should commit this file.</code> According to <code>npm
help package-lock.json</code>:</p>
<blockquote>
<p><code>package-lock.json</code> is automatically generated for any operations where npm
modifies either the <code>node_modules</code> tree, or <code>package.json</code>. It describes the
exact tree that was generated, such that subsequent installs are able to
generate identical trees, regardless of intermediate dependency updates.</p>
<p><strong>This file is intended to be committed into source repositories</strong> , and
serves various purposes:</p>
<ul>
<li>
<p>Describe a single representation of a dependency tree such that
teammates, deployments, and continuous integration are guaranteed to install
exactly the same dependencies.</p>
</li>
<li>
<p>Provide a facility for users to "time-travel" to previous states of
<code>node_modules</code> without having to commit the directory itself.</p>
</li>
<li>
<p>To facilitate greater visibility of tree changes through readable source
control diffs.</p>
</li>
<li>
<p>And optimize the installation process by allowing npm to skip repeated
metadata resolutions for previously-installed packages.</p>
</li>
</ul>
<p>One key detail about <code>package-lock.json</code> is that it cannot be published, and
it will be ignored if found in any place other than the toplevel package. It
shares a format with npm-shrinkwrap.json, which is essentially the same
file, but allows publication. This is not recommended unless deploying a CLI
tool or otherwise using the publication process for producing production
packages.</p>
<p>If both <code>package-lock.json</code> and <code>npm-shrinkwrap.json</code> are present in the
root of a package, <code>package-lock.json</code> will be completely ignored.</p>
</blockquote>
<p><br></p>
<h3>Suggest</h3>
<p>Yes, you SHOULD:</p>
<ol>
<li><strong>commit the<code>package-lock.json</code>.</strong></li>
<li>
<strong>use<code>npm ci</code> instead of <code>npm install</code></strong> when building your applications both on your CI and your local development machine</li>
</ol>
<p>The <code>npm ci</code> workflow <em>requires</em> the existence of a <code>package-lock.json</code>.</p>
<hr>
<p>A big downside of <code>npm install</code> command is its unexpected behavior that it may
mutate the <code>package-lock.json</code>, whereas <code>npm ci</code> only uses the versions
specified in the lockfile and produces an error</p>
<ul>
<li>if the <code>package-lock.json</code> and <code>package.json</code> are out of sync</li>
<li>if a <code>package-lock.json</code> is missing.</li>
</ul>
<p>Hence, running <code>npm install</code> locally, esp. in larger teams with multiple
developers, may lead to lots of conflicts within the <code>package-lock.json</code> and
developers to decide to completely delete the <code>package-lock.json</code> instead.</p>
<p>Yet there is a strong use-case for being able to trust that the project's
dependencies resolve repeatably in a reliable way across different machines.</p>
<p>From a <code>package-lock.json</code> you get exactly that: a known-to-work state.</p>
<p>In the past, I had projects without <code>package-lock.json</code> / <code>npm-
shrinkwrap.json</code> / <code>yarn.lock</code> files whose build would fail one day because a
random dependency got a breaking update.</p>
<p>Those issue are hard to resolve as you sometimes have to guess what the last
working version was.</p>
<p>If you want to add a new dependency, you still run <code>npm install {dependency}</code>.
If you want to upgrade, use either <code>npm update {dependency}</code> or <code>npm install
${dependendency}@{version}</code> and commit the changed <code>package-lock.json</code>.</p>
<p>If an upgrade fails, you can revert to the last known working <code>package-
lock.json</code>.</p>
<hr>
<p>To quote npm doc:</p>
<blockquote>
<p>It is highly recommended you commit the generated package lock to source
control: this will allow anyone else on your team, your deployments, your
CI/continuous integration, and anyone else who runs npm install in your
package source to get the exact same dependency tree that you were
developing on. Additionally, the diffs from these changes are human-readable
and will inform you of any changes npm has made to your node_modules, so you
can notice if any transitive dependencies were updated, hoisted, etc.</p>
</blockquote>
<p>And in regards to the difference between <code>npm ci</code> vs <code>npm install</code>:</p>
<blockquote>
<ul>
<li>The project must have an existing package-lock.json or npm-
shrinkwrap.json.</li>
<li>If dependencies in the package lock do not match those in package.json,
<code>npm ci</code> will exit with an error, instead of updating the package lock.</li>
<li>
<code>npm ci</code> can only install entire projects at a time: individual
dependencies cannot be added with this command.</li>
<li>If a <code>node_modules</code> is already present, it will be automatically removed
before <code>npm ci</code> begins its install.</li>
<li>It will never write to <code>package.json</code> or any of the package-locks:
installs are essentially frozen.
</li>
</ul>
</blockquote>
<hr>
<p>Note: I posted a similar answer here</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/git/" rel="tag">git</a></li>
            <li><a class="tag p-category" href="../../categories/lockfile/" rel="tag">lockfile</a></li>
            <li><a class="tag p-category" href="../../categories/nodejs/" rel="tag">node.js</a></li>
            <li><a class="tag p-category" href="../../categories/npm/" rel="tag">npm</a></li>
            <li><a class="tag p-category" href="../../categories/version-control/" rel="tag">version-control</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-do-i-set-a-variable-to-the-output-of-a-command-in-bash/" rel="prev" title="How do I set a variable to the output of a command in Bash?">Previous post</a>
            </li>
            <li class="next">
                <a href="../javascript-check-if-variable-exists-is-defined-initialized/" rel="next" title="JavaScript check if variable exists (is defined/initialized)">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
