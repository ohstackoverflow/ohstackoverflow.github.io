<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DateTime 与 DateTimeOffset | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/datetime-yu-datetimeoffset/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../ru-he-lian-jie-dao-markdown-zhong-tong-yi-wen-dang-de-yi-bu-fen/" title="如何链接到 Markdown 中同一文档的一部分？" type="text/html">
<link rel="next" href="../ru-he-cong-grep-r-zhong-pai-chu-mu-lu/" title="如何从 grep -R 中排除目录？" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="DateTime 与 DateTimeOffset">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/datetime-yu-datetimeoffset/">
<meta property="og:description" content="DateTimea和 a之间有什么区别，DateTimeOffset什么时候应该使用？

DateTime目前，我们有一种以时区感知方式处理 .NET 的标准方法：每当我们生成一个DateTime时，我们都会以 UTC
进行（例如，使用DateTime.UtcNow），而每当我们显示一个时，我们都会从 UTC 转换回用户的本地时间.
这很好用，但我一直在阅读有关DateTimeOffset它如何捕">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T07:12:37+08:00">
<meta property="article:tag" content=".net">
<meta property="article:tag" content="cSharp">
<meta property="article:tag" content="datetime">
<meta property="article:tag" content="datetimeoffset">
<meta property="article:tag" content="timezone">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">DateTime 与 DateTimeOffset</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T07:12:37+08:00" itemprop="datePublished" title="2023-02-17 07:12">2023-02-17 07:12</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p><code>DateTime</code>a和 a之间有什么区别，<code>DateTimeOffset</code>什么时候应该使用？</p>
<hr>
<p><code>DateTime</code>目前，我们有一种以时区感知方式处理 .NET 的标准方法：每当我们生成一个<code>DateTime</code>时，我们都会以 UTC
进行（例如，使用<code>DateTime.UtcNow</code>），而每当我们显示一个时，我们都会从 UTC 转换回用户的本地时间.</p>
<p>这很好用，但我一直在阅读有关<code>DateTimeOffset</code>它如何捕获对象本身的本地时间和 UTC 时间的信息。</p>
<p><br><br></p>
<h2>解答</h2>
<p><code>DateTimeOffset</code> <em>是瞬时时间</em> （也称为 <em>绝对时间</em>
）的表示。就此而言，我的意思是对每个人来说都是普遍的时刻（不考虑闰秒或时间膨胀的相对论效应）。表示瞬时时间的另一种方法是使用<code>DateTime</code>where
<code>.Kind</code>is <code>DateTimeKind.Utc</code>。</p>
<p>这与 <em>日历时间</em> （也称为 <em>民用时间</em> ）不同，后者是某人日历上的一个位置，全球有许多不同的日历。我们称这些日历 <em>为时区</em>
。<code>DateTime</code>日历时间由where
<code>.Kind</code>is<code>DateTimeKind.Unspecified</code>或表示<code>DateTimeKind.Local</code>。并且<code>.Local</code>仅在您对使用结果的计算机的位置有隐含理解的情况下才有意义。（例如，用户的工作站）</p>
<p>那么，为什么<code>DateTimeOffset</code>不使用 UTC<code>DateTime</code>呢？ <strong>一切都与视角有关。</strong> 让我们打个比方——我们假装自己是摄影师。</p>
<p>想象一下，您正站在日历时间轴上，将相机对准摆在您面前的瞬时时间轴上的一个人。您根据您所在时区的规则排列您的相机 -
由于夏令时或您所在时区的法律定义的其他变化，该规则会定期更改。（你没有稳定的手，所以你的相机摇摇欲坠。）</p>
<p>站在照片中的人会看到你的相机来自的角度。如果其他人在拍照，他们可能会从不同的角度拍摄。这就是代表<code>Offset</code>的部分<code>DateTimeOffset</code>。</p>
<p>因此，如果您将相机标记为“东部时间”，则有时您从 -5 指向，有时您从 -4
指向。世界各地都有摄像机，都标记了不同的事物，并且都从不同的角度指向同一条瞬时时间线。其中一些彼此相邻（或重叠），因此仅知道偏移量不足以确定时间与哪个时区相关。</p>
<p>那么 UTC 呢？好吧，这是唯一一台手感稳定的相机。它在三脚架上，牢牢固定在地面上。它不会去任何地方。我们称其视角为零偏移。</p>
<p><img alt="瞬时时间与日历时间可视化" src="../../images/QE5xq.png"></p>
<p>那么 - 这个类比告诉我们什么？它提供了一些直观的指导方针——</p>
<ul>
<li>
<p>如果您特别表示相对于某个地方的时间，请用日历时间表示它<code>DateTime</code>。请确保您永远不会将一个日历与另一个混淆。<code>Unspecified</code>应该是你的假设。<code>Local</code>仅来自 有用<code>DateTime.Now</code>。例如，我可能会获取<code>DateTime.Now</code>它并将其保存在数据库中——但是当我检索它时，我必须假设它是<code>Unspecified</code>. 我不能相信我的本地日历与它最初使用的日历相同。</p>
</li>
<li>
<p>如果您必须始终确定时刻，请确保您代表的是瞬时时间。用于<code>DateTimeOffset</code>强制执行它，或<code>DateTime</code>按惯例使用 UTC。</p>
</li>
<li>
<p>如果您需要跟踪瞬时时刻，但您还想知道“用户认为它在他们本地日历上的时间是几点？” - 那么你 <em>必须</em> 使用<code>DateTimeOffset</code>. 这对于计时系统非常重要，例如 - 无论是技术还是法律问题。</p>
</li>
<li>
<p>如果您需要修改以前记录的内容<code>DateTimeOffset</code>——仅在偏移量中没有足够的信息来确保新的偏移量仍然与用户相关。您 <em>还</em> 必须存储一个时区标识符（想想——我需要那个相机的名称，这样即使位置发生了变化我也可以拍一张新照片）。</p>
</li>
</ul>
<p>还应该指出的是，Noda Time有一个表示要求<code>ZonedDateTime</code>这样做，而 .Net 基类库没有任何类似的东西。您需要同时存储
a<code>DateTimeOffset</code>和 a<code>TimeZoneInfo.Id</code>值。</p>
<ul>
<li>有时，您会想要表示“正在查看它的任何人”本地的日历时间。例如，在定义 <em>今天的</em> 含义时。今天总是午夜到午夜，但这些代表了瞬时时间线上近乎无限数量的重叠范围。（在实践中，我们有有限数量的时区，但您可以将偏移量表示为滴答）因此在这些情况下，请确保您了解如何限制“谁在问？” 将问题缩小到一个时区，或者酌情将它们转换回瞬时时间。</li>
</ul>
<p>这里有一些关于<code>DateTimeOffset</code>支持这个类比的其他小细节，以及一些保持直白的技巧：</p>
<ul>
<li>
<p>如果比较两个<code>DateTimeOffset</code>值，则在比较之前首先将它们归一化为零偏移量。也就是说，<code>2012-01-01T00:00:00+00:00</code>和<code>2012-01-01T02:00:00+02:00</code>指的是同一个瞬间，因此是等价的。</p>
</li>
<li>
<p>如果您正在进行任何单元测试并且需要确定偏移量，请分别测试 <em>值</em> 和<code>DateTimeOffset</code>属性<code>.Offset</code>。</p>
</li>
<li>
<p>.Net 框架中内置了一种单向隐式转换，可让您将 a 传递<code>DateTime</code>给任何<code>DateTimeOffset</code>参数或变量。这样做时， <strong>很<code>.Kind</code>重要</strong>。如果您传递 UTC 类型，它将以零偏移量传入，但如果您传递 or <code>.Local</code>，<code>.Unspecified</code>它将假定为 <strong>local</strong> 。该框架基本上是在说，“好吧，你让我将日历时间转换为瞬时时间，但我不知道这是从哪里来的，所以我只打算使用本地日历。” <code>DateTime</code>如果您在具有不同时区的计算机上加载未指定的，这是一个巨大的问题。（恕我直言 - 应该抛出异常 - 但事实并非如此。）</p>
</li>
</ul>
<p><strong>无耻的插头：</strong></p>
<p>许多人与我分享他们发现这个类比非常有价值，所以我将其包含在我的 Pluralsight
课程“日期和时间基础”中。您将在标题为“日历时间与瞬时时间”的剪辑中的第二个模块“上下文问题”中找到相机类比的分步演练。</p>
<p><br></p>
<h3>更多建议</h3>
<p>来自微软：</p>
<blockquote>
<p>DateTimeOffset 值的这些用途比 DateTime 值的用途更常见。因此，应将 DateTimeOffset
视为应用程序开发的默认日期和时间类型。</p>
</blockquote>
<p>来源：“在 DateTime、DateTimeOffset、TimeSpan 和 TimeZoneInfo 之间进行选择”， <em>MSDN</em></p>
<p><code>DateTimeOffset</code>当我们的应用程序处理特定时间点时（例如，创建/更新记录时），我们几乎将其用于所有事情。作为旁注，我们<code>DATETIMEOFFSET</code>也在
SQL Server 2008 中使用。</p>
<p><code>DateTime</code>当您只想处理日期、时间或在一般意义上处理任何一个时，我认为这很有用。例如，如果您有一个要在每天早上 7
点响起的闹钟，您可以将其存储在一个<code>DateTime</code>应用程序<code>DateTimeKind</code>中<code>Unspecified</code>，因为无论夏令时如何，您都希望它在早上
7 点响起。但是如果你想表示警报发生的历史，你会使用<code>DateTimeOffset</code>.</p>
<p>混合使用类型时要小心<code>DateTimeOffset</code>，<code>DateTime</code>尤其是在类型之间进行分配和比较时。此外，只比较<code>DateTime</code>相同的实例<code>DateTimeKind</code>，因为<code>DateTime</code>比较时会忽略时区偏移。</p>
<p><br><br><a href="../datetime-vs-datetimeoffset/">查看原文</a></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/net/" rel="tag">.net</a></li>
            <li><a class="tag p-category" href="../../categories/csharp/" rel="tag">cSharp</a></li>
            <li><a class="tag p-category" href="../../categories/datetime/" rel="tag">datetime</a></li>
            <li><a class="tag p-category" href="../../categories/datetimeoffset/" rel="tag">datetimeoffset</a></li>
            <li><a class="tag p-category" href="../../categories/timezone/" rel="tag">timezone</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../ru-he-lian-jie-dao-markdown-zhong-tong-yi-wen-dang-de-yi-bu-fen/" rel="prev" title="如何链接到 Markdown 中同一文档的一部分？">Previous post</a>
            </li>
            <li class="next">
                <a href="../ru-he-cong-grep-r-zhong-pai-chu-mu-lu/" rel="next" title="如何从 grep -R 中排除目录？">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
