<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bash 命令中单引号内变量的扩展 | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/bash-ming-ling-zhong-dan-yin-hao-nei-bian-liang-de-kuo-zhan/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../composer-lock-ying-gai-zhi-li-yu-ban-ben-kong-zhi-ma/" title="composer.lock 应该致力于版本控制吗？" type="text/html">
<link rel="next" href="../wei-shi-yao-shi-yong-pian-duan-he-shi-shi-yong-pian-duan-er-bu-shi-huo-dong/" title="为什么使用片段，何时使用片段而不是活动？" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Bash 命令中单引号内变量的扩展">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/bash-ming-ling-zhong-dan-yin-hao-nei-bian-liang-de-kuo-zhan/">
<meta property="og:description" content="我想从bash 脚本 运行命令，该脚本在单引号和变量中包含单引号和一些其他命令。
例如repo forall -c '....$variable'
在这种格式中，$被转义并且变量不被扩展。
我尝试了以下变体，但被拒绝了：
repo forall -c '....&quot;$variable&quot; '

repo forall -c &quot; '....$variable' &quot;

&quot; repo forall -c '">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T23:38:40+08:00">
<meta property="article:tag" content="bash">
<meta property="article:tag" content="quotes">
<meta property="article:tag" content="shell">
<meta property="article:tag" content="variables">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Bash 命令中单引号内变量的扩展</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T23:38:40+08:00" itemprop="datePublished" title="2023-02-17 23:38">2023-02-17 23:38</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p><em>我想从bash 脚本</em> 运行命令，该脚本在单引号和变量中包含单引号和一些其他命令。</p>
<p>例如<code>repo forall -c '....$variable'</code></p>
<p>在这种格式中，<code>$</code>被转义并且变量不被扩展。</p>
<p>我尝试了以下变体，但被拒绝了：</p>
<div class="code"><pre class="code literal-block"><span class="n">repo</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="s1">'...."$variable" '</span>

<span class="n">repo</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="s2">" '....$variable' "</span>

<span class="s2">" repo forall -c '....$variable' "</span>

<span class="n">repo</span><span class="w"> </span><span class="n">forall</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="s2">"'"</span><span class="w"> </span><span class="o">....$</span><span class="n">variable</span><span class="w"> </span><span class="s2">"'"</span>
</pre></div>

<p>如果我用值代替变量，命令就可以正常执行。</p>
<p>请告诉我哪里出错了。</p>
<p><br><br></p>
<h2>解答</h2>
<p>在单引号内，所有内容都按字面意思保留，无一例外。</p>
<p>这意味着您必须关闭引号，插入一些内容，然后再次重新输入。</p>
<div class="code"><pre class="code literal-block"><span class="s1">'before'</span><span class="s2">"$variable"</span><span class="s1">'after'</span>
<span class="s1">'before'</span><span class="s2">"'"</span><span class="s1">'after'</span>
<span class="s1">'before'</span>\<span class="s1">''</span><span class="n">after</span><span class="s1">'</span>
</pre></div>

<p>单词连接只是通过并置来完成。正如您可以验证的那样，上面的每一行都是 shell
的一个单词。引号（单引号或双引号，视情况而定）不要隔离单词。它们仅用于禁用对各种特殊字符的解释，如空格、<code>$</code>...<code>;</code>有关引用的好教程，请参阅 Mark
Reed 的回答。也相关：哪些字符需要在 bash 中转义？</p>
<h3>不要连接由 shell 解释的字符串</h3>
<p>您应该绝对避免通过连接变量来构建 shell 命令。这是一个类似于连接 SQL 片段（SQL 注入！）的坏主意。</p>
<p>通常可以在命令中使用占位符，并将命令与变量一起提供，以便被调用者可以从调用参数列表中接收它们。</p>
<p>例如，下面是非常不安全的。不要这样做</p>
<div class="code"><pre class="code literal-block"><span class="n">script</span><span class="o">=</span><span class="s2">"echo </span><span class="se">\"</span><span class="s2">Argument 1 is: $myvar</span><span class="se">\"</span><span class="s2">"</span>
<span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="s2">"$script"</span>
</pre></div>

<p>如果 的内容<code>$myvar</code>不受信任，这里是一个漏洞利用：</p>
<div class="code"><pre class="code literal-block"><span class="n">myvar</span><span class="o">=</span><span class="s1">'foo"; echo "you were hacked'</span>
</pre></div>

<p>代替上述调用，使用位置参数。以下调用更好——它不可利用：</p>
<div class="code"><pre class="code literal-block"><span class="n">script</span><span class="o">=</span><span class="s1">'echo "arg 1 is: $1"'</span>
<span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="s2">"$script"</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="s2">"$myvar"</span>
</pre></div>

<p>请注意在对 的赋值中使用了单刻度<code>script</code>，这意味着它是按字面意思进行的，没有变量扩展或任何其他形式的解释。</p>
<p><br></p>
<h3>更多建议</h3>
<p>该<code>repo</code>命令不在乎它得到什么样的引号。如果需要参数扩展，请使用双引号。如果这意味着您最终不得不反斜杠很多东西，请对其中的大部分使用单引号，然后将它们分开并在需要扩展的部分进入双引号。</p>
<div class="code"><pre class="code literal-block">repo forall -c 'literal stuff goes here; '"stuff with $parameters here"' more literal stuff'
</pre></div>

<p>解释如下，如果你感兴趣的话。</p>
<p>当您从 shell 运行命令时，该命令接收的参数是一个以 null 结尾的字符串数组。这些字符串绝对可以包含 <em>任何</em> 非空字符。</p>
<p>但是当 shell
从命令行构建字符串数组时，它会特殊地解释一些字符；这是为了使命令更容易（实际上，可能）键入。例如，空格通常表示数组中字符串之间的边界；因此，个别论点有时被称为“词”。但是一个论点仍然可能有空格；你只需要一些方法来告诉
shell 那是你想要的。</p>
<p>您可以在任何字符（包括空格或另一个反斜杠）前使用反斜杠来告诉 shell 按字面意义对待该字符。但是虽然你可以这样做：</p>
<div class="code"><pre class="code literal-block">reply=\”That\'ll\ be\ \$4.96,\ please,\"\ said\ the\ cashier
</pre></div>

<p>……它会让人厌烦。因此 shell 提供了另一种选择：引号。这些有两个主要品种。</p>
<p>双引号称为“分组引号”。它们防止通配符和别名被扩展，但它们主要用于在单词中包含空格。参数和命令扩展等其他事情（由 a
表示的事情<code>$</code>）仍然会发生。当然，如果你想要双引号内的文字双引号，你必须反斜杠它：</p>
<div class="code"><pre class="code literal-block">reply="\"That'll be \$4.96, please,\" said the cashier"
</pre></div>

<p>单引号更加严厉。它们之间的所有内容都完全按字面意思理解，包括反斜杠。绝对没有办法在单引号内获得文字单引号。</p>
<p>幸运的是，shell 中的引号 <em>不是单词分隔符</em>
；就他们自己而言，他们不会终止一个词。您可以在同一个词中加入和退出引号，包括在不同类型的引号之间，以获得所需的结果：</p>
<div class="code"><pre class="code literal-block">reply='"That'\''ll be $4.96, please," said the cashier'
</pre></div>

<p>所以这更容易 - 反斜杠少了很多，尽管关闭单引号，反斜杠文字单引号，开放单引号序列需要一些时间来适应。</p>
<p>现代 shell 添加了另一种 POSIX 标准未指定的引用样式，其中前导单引号以美元符号为前缀。如此引用的字符串遵循与 C 编程语言的 ANSI
标准版本中的字符串文字类似的约定，因此有时称为“ANSI 字符串”和 ... 对“
<code>$'</code>ANSI<code>'</code>引号”。在这样的字符串中，上述关于按字面意义使用反斜杠的建议不再适用。相反，它们再次变得特殊 -
您不仅可以通过在其前面加上反斜杠来包含文字单引号或反斜杠，而且 shell 还会扩展 ANSI C
字符转义（例如换行符、制表<code>\n</code>符<code>\t</code>和<code>\xHH</code>带有十六进制代码<code>HH</code>). 然而，否则，它们表现为单引号字符串：没有参数或命令替换发生：</p>
<div class="code"><pre class="code literal-block">reply=$'"That\'ll be $4.96, please," said the cashier'
</pre></div>

<p>需要注意的重要一点是，存储在<code>reply</code>变量中的单个字符串在所有这些示例中都 <em>完全相同。</em> 同样，在 shell
解析完命令行后，运行的命令无法准确说明每个参数字符串的实际键入方式——或者即使它是键入的，而不是以某种方式以编程方式创建 <em>的</em> 。</p>
<p><br><br><a href="../expansion-of-variables-inside-single-quotes-in-a-command-in-bash/">查看原文</a></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/bash/" rel="tag">bash</a></li>
            <li><a class="tag p-category" href="../../categories/quotes/" rel="tag">quotes</a></li>
            <li><a class="tag p-category" href="../../categories/shell/" rel="tag">shell</a></li>
            <li><a class="tag p-category" href="../../categories/variables/" rel="tag">variables</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../composer-lock-ying-gai-zhi-li-yu-ban-ben-kong-zhi-ma/" rel="prev" title="composer.lock 应该致力于版本控制吗？">Previous post</a>
            </li>
            <li class="next">
                <a href="../wei-shi-yao-shi-yong-pian-duan-he-shi-shi-yong-pian-duan-er-bu-shi-huo-dong/" rel="next" title="为什么使用片段，何时使用片段而不是活动？">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
