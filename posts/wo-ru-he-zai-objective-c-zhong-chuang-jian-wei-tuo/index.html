<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>我如何在 Objective-C 中创建委托？ | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/wo-ru-he-zai-objective-c-zhong-chuang-jian-wei-tuo/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../gei-ding-ha-xi-tu-zhong-de-jian-ru-he-geng-xin-zhi/" title="给定哈希图中的键，如何更新值？" type="text/html">
<link rel="next" href="../wu-fa-jiang-shi-yong-jvm-mu-biao-1-8-gou-jian-de-zi-jie-ma-nei-lian-dao-shi-yong-jvm-mu-biao-1-6-gou-jian-de-zi-jie-ma-zhong/" title="无法将使用 JVM 目标 1.8 构建的字节码内联到使用 JVM 目标 1.6 构建的字节码中" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="我如何在 Objective-C 中创建委托？">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/wo-ru-he-zai-objective-c-zhong-chuang-jian-wei-tuo/">
<meta property="og:description" content="我知道代表如何工作，也知道如何使用它们。
但是我该如何创建它们呢？

解答
Objective-C
委托是已分配给delegate另一个对象属性的对象。要创建一个，您可以定义一个实现您感兴趣的委托方法的类，并将该类标记为实现委托协议。
例如，假设您有一个UIWebView. 如果你想实现它的委托webViewDidStartLoad:方法，你可以创建一个这样的类：
@interface MyCla">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T14:38:23+08:00">
<meta property="article:tag" content="callback">
<meta property="article:tag" content="cocoa">
<meta property="article:tag" content="delegates">
<meta property="article:tag" content="ios">
<meta property="article:tag" content="objective-c">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">我如何在 Objective-C 中创建委托？</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T14:38:23+08:00" itemprop="datePublished" title="2023-02-17 14:38">2023-02-17 14:38</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>我知道代表如何工作，也知道如何使用它们。</p>
<p>但是我该如何创建它们呢？</p>
<p><br><br></p>
<h2>解答</h2>
<p>Objective-C
委托是已分配给<code>delegate</code>另一个对象属性的对象。要创建一个，您可以定义一个实现您感兴趣的委托方法的类，并将该类标记为实现委托协议。</p>
<p>例如，假设您有一个<code>UIWebView</code>. 如果你想实现它的委托<code>webViewDidStartLoad:</code>方法，你可以创建一个这样的类：</p>
<div class="code"><pre class="code literal-block"><span class="k">@interface</span> <span class="bp">MyClass</span><span class="o">&lt;</span><span class="bp">UIWebViewDelegate</span><span class="o">&gt;</span>
<span class="c1">// ...</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="bp">MyClass</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">webViewDidStartLoad:</span><span class="p">(</span><span class="bp">UIWebView</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">webView</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="c1">// ... </span>
<span class="p">}</span>
<span class="k">@end</span>
</pre></div>

<p>然后您可以创建 MyClass 的实例并将其分配为 Web 视图的委托：</p>
<div class="code"><pre class="code literal-block"><span class="bp">MyClass</span><span class="w"> </span><span class="o">*</span><span class="n">instanceOfMyClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">MyClass</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">init</span><span class="p">];</span>
<span class="n">myWebView</span><span class="p">.</span><span class="n">delegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instanceOfMyClass</span><span class="p">;</span>
</pre></div>

<p>另一方面<code>UIWebView</code>，它可能具有与此类似的代码，以查看委托是否使用
响应消息<code>webViewDidStartLoad:</code>并<code>respondsToSelector:</code>在适当时发送它。</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="p">(</span><span class="o">[</span><span class="n">self.delegate respondsToSelector:@selector(webViewDidStartLoad:)</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="o">[</span><span class="n">self.delegate webViewDidStartLoad:self</span><span class="o">]</span><span class="p">;</span>
<span class="err">}</span>
</pre></div>

<p>委托属性本身通常被声明<code>weak</code>（在 ARC 中）或<code>assign</code>（在 ARC
之前）以避免保留循环，因为对象的委托通常持有对该对象的强引用。（例如，视图控制器通常是它包含的视图的委托。）</p>
<h3>为你的班级制作代表</h3>
<p>要定义您自己的委托，您必须在某处声明它们的方法，如Apple 文档中关于协议的讨论。你通常声明一个正式的协议。从 UIWebView.h
转述的声明如下所示：</p>
<div class="code"><pre class="code literal-block"><span class="k">@protocol</span> <span class="bp">UIWebViewDelegate</span> <span class="o">&lt;</span><span class="bp">NSObject</span><span class="o">&gt;</span>
<span class="k">@optional</span>
<span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">webViewDidStartLoad</span><span class="o">:</span><span class="p">(</span><span class="bp">UIWebView</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">webView</span><span class="p">;</span>
<span class="c1">// ... other methods here</span>
<span class="k">@end</span>
</pre></div>

<p>这类似于接口或抽象基类，因为它<code>UIWebViewDelegate</code>在本例中为您的委托创建了一个特殊类型。委托实施者必须采用此协议：</p>
<div class="code"><pre class="code literal-block"><span class="k">@interface</span> <span class="bp">MyClass</span><span class="w"> </span><span class="o">&lt;</span><span class="bp">UIWebViewDelegate</span><span class="o">&gt;</span>
<span class="c1">// ...</span>
<span class="k">@end</span>
</pre></div>

<p>然后实现协议中的方法。对于在协议中声明为的方法（与大多数委托方法一样），您需要在对其调用特定方法之前<code>@optional</code>进行检查。<code>-respondsToSelector:</code></p>
<h4>命名</h4>
<p>委托方法通常以委托类名开头命名，并将委托对象作为第一个参数。他们还经常使用 will-、should- 或 did-
形式。因此，<code>webViewDidStartLoad:</code>（第一个参数是网络视图）而不是<code>loadStarted</code>（不带参数）例如。</p>
<h4>速度优化</h4>
<p>您可以在设置委托时缓存该信息，而不是每次我们要向选择器发送消息时都检查委托是否响应选择器。一种非常简洁的方法是使用位域，如下所示：</p>
<div class="code"><pre class="code literal-block"><span class="k">@protocol</span> <span class="nc">SomethingDelegate</span> <span class="o">&lt;</span><span class="bp">NSObject</span><span class="o">&gt;</span>
<span class="k">@optional</span>
<span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">something</span><span class="o">:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">something</span><span class="w"> </span><span class="n">didFinishLoadingItem</span><span class="o">:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">item</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">something:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">something</span><span class="w"> </span><span class="nf">didFailWithError:</span><span class="p">(</span><span class="bp">NSError</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@interface</span> <span class="nc">Something</span> : <span class="bp">NSObject</span>
<span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span><span class="w"> </span><span class="k">weak</span><span class="p">)</span><span class="w"> </span><span class="kt">id</span><span class="w"> </span><span class="o">&lt;</span><span class="n">SomethingDelegate</span><span class="o">&gt;</span><span class="w"> </span><span class="n">delegate</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">Something</span> <span class="p">{</span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">didFinishLoadingItem</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">didFailWithError</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">delegateRespondsTo</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@synthesize</span><span class="w"> </span><span class="n">delegate</span><span class="p">;</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setDelegate:</span><span class="p">(</span><span class="kt">id</span><span class="w"> </span><span class="o">&lt;</span><span class="n">SomethingDelegate</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">aDelegate</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">delegate</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">aDelegate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">delegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aDelegate</span><span class="p">;</span>

<span class="w">    </span><span class="n">delegateRespondsTo</span><span class="p">.</span><span class="n">didFinishLoadingItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">delegate</span><span class="w"> </span><span class="n">respondsToSelector</span><span class="o">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">something</span><span class="o">:</span><span class="n">didFinishLoadingItem</span><span class="o">:</span><span class="p">)];</span>
<span class="w">    </span><span class="n">delegateRespondsTo</span><span class="p">.</span><span class="n">didFailWithError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">delegate</span><span class="w"> </span><span class="n">respondsToSelector</span><span class="o">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">something</span><span class="o">:</span><span class="n">didFailWithError</span><span class="o">:</span><span class="p">)];</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">@end</span>
</pre></div>

<p>然后，在正文中，我们可以检查我们的委托是否通过访问我们的<code>delegateRespondsTo</code>结构来处理消息，而不是<code>-respondsToSelector:</code>一遍又一遍地发送。</p>
<h4>非正式代表</h4>
<p>在协议存在之前，通常使用类别来声明<code>NSObject</code>委托可以实现的方法。例如，<code>CALayer</code>仍然这样做：</p>
<div class="code"><pre class="code literal-block"><span class="k">@interface</span> <span class="bp">NSObject</span><span class="nl">(CALayerDelegate)</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">displayLayer:</span><span class="p">(</span><span class="bp">CALayer</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="nv">layer</span><span class="p">;</span>
<span class="c1">// ... other methods here</span>
<span class="k">@end</span>
</pre></div>

<p>这告诉编译器任何对象都可以实现<code>displayLayer:</code>.</p>
<p>然后，您将使用<code>-respondsToSelector:</code>与上述相同的方法来调用此方法。委托实现此方法并分配<code>delegate</code>属性，仅此而已（没有声明您符合协议）。这种方法在
Apple
的库中很常见，但新代码应该使用上面更现代的协议方法，因为这种方法会造成污染<code>NSObject</code>（这使得自动完成功能变得不那么有用）并且使编译器很难警告您拼写错误和类似错误。</p>
<p><br></p>
<h3>更多建议</h3>
<p>批准的答案很好，但如果您正在寻找 1 分钟的答案，请尝试以下操作：</p>
<p>MyClass.h 文件应如下所示（添加带有注释的委托行！）</p>
<div class="code"><pre class="code literal-block"><span class="cp">#import &lt;BlaClass/BlaClass.h&gt;</span>

<span class="k">@class</span> <span class="bp">MyClass</span>;<span class="w">             </span><span class="c1">//define class, so protocol can see MyClass</span>
<span class="k">@protocol</span> <span class="nc">MyClassDelegate</span> <span class="o">&lt;</span><span class="bp">NSObject</span><span class="o">&gt;</span><span class="w">   </span><span class="c1">//define delegate protocol</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="n">myClassDelegateMethod</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="bp">MyClass</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">sender</span><span class="p">;</span><span class="w">  </span><span class="c1">//define delegate method to be implemented within another class</span>
<span class="k">@end</span><span class="w"> </span><span class="c1">//end protocol</span>

<span class="k">@interface</span> <span class="bp">MyClass</span> : <span class="bp">NSObject</span> <span class="p">{</span>
<span class="p">}</span>
<span class="k">@property</span><span class="w"> </span><span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span><span class="w"> </span><span class="k">weak</span><span class="p">)</span><span class="w"> </span><span class="kt">id</span><span class="w"> </span><span class="o">&lt;</span><span class="n">MyClassDelegate</span><span class="o">&gt;</span><span class="w"> </span><span class="n">delegate</span><span class="p">;</span><span class="w"> </span><span class="c1">//define MyClassDelegate as delegate</span>

<span class="k">@end</span>
</pre></div>

<p>MyClass.m 文件应该是这样的</p>
<div class="code"><pre class="code literal-block"><span class="cp">#import "MyClass.h"</span>
<span class="k">@implementation</span> <span class="bp">MyClass</span><span class="w"> </span>
<span class="k">@synthesize</span><span class="w"> </span><span class="n">delegate</span><span class="p">;</span><span class="w"> </span><span class="c1">//synthesise  MyClassDelegate delegate</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">myMethodToDoStuff</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">delegate</span><span class="w"> </span><span class="n">myClassDelegateMethod</span><span class="o">:</span><span class="nb">self</span><span class="p">];</span><span class="w"> </span><span class="c1">//this will call the method implemented in your other class    </span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></div>

<p>要在另一个类中使用您的委托（在本例中 UIViewController 称为 MyVC）MyVC.h：</p>
<div class="code"><pre class="code literal-block"><span class="c1">#import "MyClass.h"</span>
<span class="nd">@interface</span> <span class="n">MyVC</span><span class="p">:</span><span class="n">UIViewController</span> <span class="o">&lt;</span><span class="n">MyClassDelegate</span><span class="o">&gt;</span> <span class="p">{</span> <span class="o">//</span><span class="n">make</span> <span class="n">it</span> <span class="n">a</span> <span class="n">delegate</span> <span class="k">for</span> <span class="n">MyClassDelegate</span>
<span class="p">}</span>
</pre></div>

<p>MyVC.m:</p>
<div class="code"><pre class="code literal-block">myClass.delegate = self;          //set its delegate to self somewhere
</pre></div>

<p>实现委托方法</p>
<div class="code"><pre class="code literal-block"><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">myClassDelegateMethod:</span><span class="w"> </span><span class="p">(</span><span class="bp">MyClass</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nv">sender</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">NSLog</span><span class="p">(</span><span class="s">@"Delegates are great!"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><br><br><a href="../how-do-i-create-delegates-in-objective-c/">查看原文</a></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/callback/" rel="tag">callback</a></li>
            <li><a class="tag p-category" href="../../categories/cocoa/" rel="tag">cocoa</a></li>
            <li><a class="tag p-category" href="../../categories/delegates/" rel="tag">delegates</a></li>
            <li><a class="tag p-category" href="../../categories/ios/" rel="tag">ios</a></li>
            <li><a class="tag p-category" href="../../categories/objective-c/" rel="tag">objective-c</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../gei-ding-ha-xi-tu-zhong-de-jian-ru-he-geng-xin-zhi/" rel="prev" title="给定哈希图中的键，如何更新值？">Previous post</a>
            </li>
            <li class="next">
                <a href="../wu-fa-jiang-shi-yong-jvm-mu-biao-1-8-gou-jian-de-zi-jie-ma-nei-lian-dao-shi-yong-jvm-mu-biao-1-6-gou-jian-de-zi-jie-ma-zhong/" rel="next" title="无法将使用 JVM 目标 1.8 构建的字节码内联到使用 JVM 目标 1.6 构建的字节码中">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
