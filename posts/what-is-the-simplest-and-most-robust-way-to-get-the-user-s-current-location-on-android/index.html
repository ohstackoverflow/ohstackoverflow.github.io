<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>What is the simplest and most robust way to get the user's current location on Android? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/what-is-the-simplest-and-most-robust-way-to-get-the-user-s-current-location-on-android/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../pandas-merging-101/" title="Pandas Merging 101" type="text/html">
<link rel="next" href="../could-not-find-a-declaration-file-for-module-module-name-path-to-module-name-js-implicitly-has-an-any-type/" title="Could not find a declaration file for module 'module-name'. '/path/to/module-name.js' implicitly has an 'any' type" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="What is the simplest and most robust way to get the user's current loc">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/what-is-the-simplest-and-most-robust-way-to-get-the-user-s-current-location-on-android/">
<meta property="og:description" content="The LocationManager API on Android seems like it's a bit of a pain to use
for an application that only needs an occasional and rough approximation of
the user's location.
The app I'm working on isn't ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T11:21:24+08:00">
<meta property="article:tag" content="android">
<meta property="article:tag" content="geolocation">
<meta property="article:tag" content="latitude-longitude">
<meta property="article:tag" content="location">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">What is the simplest and most robust way to get the user's current location on Android?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T11:21:24+08:00" itemprop="datePublished" title="2023-02-17 11:21">2023-02-17 11:21</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>The <code>LocationManager</code> API on Android seems like it's a bit of a pain to use
for an application that only needs an occasional and rough approximation of
the user's location.</p>
<p>The app I'm working on isn't really a location app per se, but it does need to
get the user's location in order to display a list of nearby businesses. It
doesn't need to worry about if the user is moving around or anything like
that.</p>
<p>Here's what I'd like to do:</p>
<ol>
<li>Show the user a list of nearby locations.</li>
<li>Preload the user's location so that by the time I need it in <code>Activity</code> X, it will be available.</li>
<li>I don't particularly care about accuracy or frequency of update. Just grabbing one location is sufficient as long as it's not way off. Maybe if I want to be fancy I'll update the location once every few mins or so, but it's not a huge priority.</li>
<li>Work for any device as long as it has either a GPS or a Network Location provider.</li>
</ol>
<p>It seems like it shouldn't be that hard, but it appears to me that I have to
spin up two different location providers (GPS and NETWORK) and manage each's
lifecycle. Not only that, but I have to duplicate the same code in multiple
activities to satisfy #2. I've tried using <code>getBestProvider()</code> in the past to
cut the solution down to just using one location provider, but that seems to
only give you the best "theoretical" provider rather than the provider that's
actually going to give you the best results.</p>
<p>Is there a simpler way to accomplish this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Here's what I do:</p>
<ol>
<li>First of all I check what providers are enabled. Some may be disabled on the device, some may be disabled in application manifest.</li>
<li>If any provider is available I start location listeners and timeout timer. It's 20 seconds in my example, may not be enough for GPS so you can enlarge it.</li>
<li>If I get update from location listener I use the provided value. I stop listeners and timer.</li>
<li>If I don't get any updates and timer elapses I have to use last known values.</li>
<li>I grab last known values from available providers and choose the most recent of them.</li>
</ol>
<p>Here's how I use my class:</p>
<div class="code"><pre class="code literal-block"><span class="n">LocationResult</span><span class="w"> </span><span class="n">locationResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LocationResult</span><span class="p">()</span><span class="err">{</span>
<span class="w">    </span><span class="nv">@Override</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">gotLocation</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="n">location</span><span class="p">)</span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="n">Got</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">location</span><span class="err">!</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span><span class="p">;</span>
<span class="n">MyLocation</span><span class="w"> </span><span class="n">myLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyLocation</span><span class="p">();</span>
<span class="n">myLocation</span><span class="p">.</span><span class="n">getLocation</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">locationResult</span><span class="p">);</span>
</pre></div>

<p>And here's MyLocation class:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">java.util.Timer</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.TimerTask</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.location.Location</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.location.LocationListener</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.location.LocationManager</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="p">;</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">MyLocation</span> <span class="p">{</span>
    <span class="n">Timer</span> <span class="n">timer1</span><span class="p">;</span>
    <span class="n">LocationManager</span> <span class="n">lm</span><span class="p">;</span>
    <span class="n">LocationResult</span> <span class="n">locationResult</span><span class="p">;</span>
    <span class="n">boolean</span> <span class="n">gps_enabled</span><span class="o">=</span><span class="n">false</span><span class="p">;</span>
    <span class="n">boolean</span> <span class="n">network_enabled</span><span class="o">=</span><span class="n">false</span><span class="p">;</span>

    <span class="n">public</span> <span class="n">boolean</span> <span class="n">getLocation</span><span class="p">(</span><span class="n">Context</span> <span class="n">context</span><span class="p">,</span> <span class="n">LocationResult</span> <span class="n">result</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="o">//</span><span class="n">I</span> <span class="n">use</span> <span class="n">LocationResult</span> <span class="n">callback</span> <span class="k">class</span> <span class="nc">to</span> <span class="k">pass</span> <span class="n">location</span> <span class="n">value</span> <span class="kn">from</span> <span class="nn">MyLocation</span> <span class="n">to</span> <span class="n">user</span> <span class="n">code</span><span class="o">.</span>
        <span class="n">locationResult</span><span class="o">=</span><span class="n">result</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">lm</span><span class="o">==</span><span class="n">null</span><span class="p">)</span>
            <span class="n">lm</span> <span class="o">=</span> <span class="p">(</span><span class="n">LocationManager</span><span class="p">)</span> <span class="n">context</span><span class="o">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="o">.</span><span class="n">LOCATION_SERVICE</span><span class="p">);</span>

        <span class="o">//</span><span class="n">exceptions</span> <span class="n">will</span> <span class="n">be</span> <span class="n">thrown</span> <span class="k">if</span> <span class="n">provider</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">permitted</span><span class="o">.</span>
        <span class="k">try</span><span class="p">{</span><span class="n">gps_enabled</span><span class="o">=</span><span class="n">lm</span><span class="o">.</span><span class="n">isProviderEnabled</span><span class="p">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="n">GPS_PROVIDER</span><span class="p">);}</span><span class="n">catch</span><span class="p">(</span><span class="ne">Exception</span> <span class="n">ex</span><span class="p">){}</span>
        <span class="k">try</span><span class="p">{</span><span class="n">network_enabled</span><span class="o">=</span><span class="n">lm</span><span class="o">.</span><span class="n">isProviderEnabled</span><span class="p">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="n">NETWORK_PROVIDER</span><span class="p">);}</span><span class="n">catch</span><span class="p">(</span><span class="ne">Exception</span> <span class="n">ex</span><span class="p">){}</span>

        <span class="o">//</span><span class="n">don</span><span class="s1">'t start listeners if no provider is enabled</span>
        <span class="k">if</span><span class="p">(</span><span class="err">!</span><span class="n">gps_enabled</span> <span class="o">&amp;&amp;</span> <span class="err">!</span><span class="n">network_enabled</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">false</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="n">gps_enabled</span><span class="p">)</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">requestLocationUpdates</span><span class="p">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="n">GPS_PROVIDER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">locationListenerGps</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">network_enabled</span><span class="p">)</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">requestLocationUpdates</span><span class="p">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="n">NETWORK_PROVIDER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">locationListenerNetwork</span><span class="p">);</span>
        <span class="n">timer1</span><span class="o">=</span><span class="n">new</span> <span class="n">Timer</span><span class="p">();</span>
        <span class="n">timer1</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">new</span> <span class="n">GetLastLocation</span><span class="p">(),</span> <span class="mi">20000</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">LocationListener</span> <span class="n">locationListenerGps</span> <span class="o">=</span> <span class="n">new</span> <span class="n">LocationListener</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onLocationChanged</span><span class="p">(</span><span class="n">Location</span> <span class="n">location</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">timer1</span><span class="o">.</span><span class="n">cancel</span><span class="p">();</span>
            <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">location</span><span class="p">);</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">locationListenerNetwork</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onProviderDisabled</span><span class="p">(</span><span class="n">String</span> <span class="n">provider</span><span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onProviderEnabled</span><span class="p">(</span><span class="n">String</span> <span class="n">provider</span><span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onStatusChanged</span><span class="p">(</span><span class="n">String</span> <span class="n">provider</span><span class="p">,</span> <span class="nb">int</span> <span class="n">status</span><span class="p">,</span> <span class="n">Bundle</span> <span class="n">extras</span><span class="p">)</span> <span class="p">{}</span>
    <span class="p">};</span>

    <span class="n">LocationListener</span> <span class="n">locationListenerNetwork</span> <span class="o">=</span> <span class="n">new</span> <span class="n">LocationListener</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onLocationChanged</span><span class="p">(</span><span class="n">Location</span> <span class="n">location</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">timer1</span><span class="o">.</span><span class="n">cancel</span><span class="p">();</span>
            <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">location</span><span class="p">);</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
            <span class="n">lm</span><span class="o">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">locationListenerGps</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onProviderDisabled</span><span class="p">(</span><span class="n">String</span> <span class="n">provider</span><span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onProviderEnabled</span><span class="p">(</span><span class="n">String</span> <span class="n">provider</span><span class="p">)</span> <span class="p">{}</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">onStatusChanged</span><span class="p">(</span><span class="n">String</span> <span class="n">provider</span><span class="p">,</span> <span class="nb">int</span> <span class="n">status</span><span class="p">,</span> <span class="n">Bundle</span> <span class="n">extras</span><span class="p">)</span> <span class="p">{}</span>
    <span class="p">};</span>

    <span class="k">class</span> <span class="nc">GetLastLocation</span> <span class="n">extends</span> <span class="n">TimerTask</span> <span class="p">{</span>
        <span class="nd">@Override</span>
        <span class="n">public</span> <span class="n">void</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
             <span class="n">lm</span><span class="o">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">locationListenerGps</span><span class="p">);</span>
             <span class="n">lm</span><span class="o">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">locationListenerNetwork</span><span class="p">);</span>

             <span class="n">Location</span> <span class="n">net_loc</span><span class="o">=</span><span class="n">null</span><span class="p">,</span> <span class="n">gps_loc</span><span class="o">=</span><span class="n">null</span><span class="p">;</span>
             <span class="k">if</span><span class="p">(</span><span class="n">gps_enabled</span><span class="p">)</span>
                 <span class="n">gps_loc</span><span class="o">=</span><span class="n">lm</span><span class="o">.</span><span class="n">getLastKnownLocation</span><span class="p">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="n">GPS_PROVIDER</span><span class="p">);</span>
             <span class="k">if</span><span class="p">(</span><span class="n">network_enabled</span><span class="p">)</span>
                 <span class="n">net_loc</span><span class="o">=</span><span class="n">lm</span><span class="o">.</span><span class="n">getLastKnownLocation</span><span class="p">(</span><span class="n">LocationManager</span><span class="o">.</span><span class="n">NETWORK_PROVIDER</span><span class="p">);</span>

             <span class="o">//</span><span class="k">if</span> <span class="n">there</span> <span class="n">are</span> <span class="n">both</span> <span class="n">values</span> <span class="n">use</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">one</span>
             <span class="k">if</span><span class="p">(</span><span class="n">gps_loc</span><span class="o">!=</span><span class="n">null</span> <span class="o">&amp;&amp;</span> <span class="n">net_loc</span><span class="o">!=</span><span class="n">null</span><span class="p">){</span>
                 <span class="k">if</span><span class="p">(</span><span class="n">gps_loc</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span><span class="o">&gt;</span><span class="n">net_loc</span><span class="o">.</span><span class="n">getTime</span><span class="p">())</span>
                     <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">gps_loc</span><span class="p">);</span>
                 <span class="k">else</span>
                     <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">net_loc</span><span class="p">);</span>
                 <span class="k">return</span><span class="p">;</span>
             <span class="p">}</span>

             <span class="k">if</span><span class="p">(</span><span class="n">gps_loc</span><span class="o">!=</span><span class="n">null</span><span class="p">){</span>
                 <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">gps_loc</span><span class="p">);</span>
                 <span class="k">return</span><span class="p">;</span>
             <span class="p">}</span>
             <span class="k">if</span><span class="p">(</span><span class="n">net_loc</span><span class="o">!=</span><span class="n">null</span><span class="p">){</span>
                 <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">net_loc</span><span class="p">);</span>
                 <span class="k">return</span><span class="p">;</span>
             <span class="p">}</span>
             <span class="n">locationResult</span><span class="o">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">null</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">abstract</span> <span class="k">class</span> <span class="nc">LocationResult</span><span class="p">{</span>
        <span class="n">public</span> <span class="n">abstract</span> <span class="n">void</span> <span class="n">gotLocation</span><span class="p">(</span><span class="n">Location</span> <span class="n">location</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Somebody may also want to modify my logic. For example if you get update from
Network provider don't stop listeners but continue waiting. GPS gives more
accurate data so it's worth waiting for it. If timer elapses and you've got
update from Network but not from GPS then you can use value provided from
Network.</p>
<p>One more approach is to use LocationClient
http://developer.android.com/training/location/retrieve-current.html. But it
requires Google Play Services apk to be installed on user device.</p>
<p><br></p>
<h3>Suggest</h3>
<p>After searching for best implementation how to get best precise user location
I managed to combine all the best methods and come up with following class:</p>
<div class="code"><pre class="code literal-block"><span class="o">/**</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Retrieve</span><span class="w"> </span><span class="n">accurate</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">GPS</span><span class="w"> </span><span class="nb">or</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">services</span><span class="p">.</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Class</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="n">example</span><span class="p">:</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="o">*</span><span class="w">      </span><span class="p">...</span>
<span class="w"> </span><span class="o">*</span><span class="w">      </span><span class="n">my_location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MyLocation</span><span class="p">();</span>
<span class="w"> </span><span class="o">*</span><span class="w">      </span><span class="n">my_location</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">main</span><span class="p">.</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">locationResult</span><span class="p">);</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="n">LocationResult</span><span class="w"> </span><span class="n">locationResult</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">LocationResult</span><span class="p">(){</span>
<span class="w"> </span><span class="o">*</span><span class="w">      </span><span class="p">@</span><span class="n">Override</span>
<span class="w"> </span><span class="o">*</span><span class="w">      </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">gotLocation</span><span class="p">(</span><span class="n">final</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="n">location</span><span class="p">){</span>
<span class="w"> </span><span class="o">*</span><span class="w">          </span><span class="c1">// do something</span>
<span class="w"> </span><span class="o">*</span><span class="w">          </span><span class="n">location</span><span class="p">.</span><span class="n">getLongitude</span><span class="p">();</span>
<span class="w"> </span><span class="o">*</span><span class="w">          </span><span class="n">location</span><span class="p">.</span><span class="n">getLatitude</span><span class="p">();</span>
<span class="w"> </span><span class="o">*</span><span class="w">      </span><span class="p">}</span>
<span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="p">};</span>
<span class="w"> </span><span class="o">*/</span>
<span class="n">class</span><span class="w"> </span><span class="n">MyLocation</span><span class="p">{</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">GPS</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="p">.</span><span class="w"> </span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">connected</span><span class="w"> </span><span class="n">satellites</span><span class="w"> </span><span class="n">count</span><span class="p">.</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">min_gps_sat_count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Iteration</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">time</span><span class="p">.</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">iteration_timeout_step</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span>

<span class="w">    </span><span class="n">LocationResult</span><span class="w"> </span><span class="n">locationResult</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="n">bestLocation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">null</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Handler</span><span class="p">();</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">LocationManager</span><span class="w"> </span><span class="n">myLocationManager</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">;</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">gps_enabled</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">false</span><span class="p">;</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">counts</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">sat_count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="n">showTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">boolean</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">false</span><span class="p">;</span>
<span class="w">            </span><span class="n">counts</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"counts="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">counts</span><span class="p">);</span>

<span class="w">            </span><span class="c1">//if timeout (1 min) exceeded, stop tying</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">counts</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">120</span><span class="p">){</span>
<span class="w">                </span><span class="n">stop</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">true</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">//update last best location</span>
<span class="w">            </span><span class="n">bestLocation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">getLocation</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>

<span class="w">            </span><span class="c1">//if location is not ready or don`t exists, try again</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">bestLocation</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">gps_enabled</span><span class="p">){</span>
<span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"BestLocation not ready, continue to wait"</span><span class="p">);</span>
<span class="w">                </span><span class="n">handler</span><span class="p">.</span><span class="n">postDelayed</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">iteration_timeout_step</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">                </span><span class="c1">//if best location is known, calculate if we need to continue to look for better location</span>
<span class="w">                </span><span class="c1">//if gps is enabled and min satellites count has not been connected or min check count is smaller then 4 (2 sec)  </span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">stop</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">false</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!<span class="n">needToStop</span><span class="p">()){</span>
<span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connected "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sat_count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">" sattelites. continue waiting.."</span><span class="p">);</span>
<span class="w">                    </span><span class="n">handler</span><span class="p">.</span><span class="n">postDelayed</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">iteration_timeout_step</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"#########################################"</span><span class="p">);</span>
<span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"BestLocation found return result to main. sat_count="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sat_count</span><span class="p">);</span>
<span class="w">                    </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"#########################################"</span><span class="p">);</span>

<span class="w">                    </span><span class="c1">// removing all updates and listeners</span>
<span class="w">                    </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">gpsLocationListener</span><span class="p">);</span>
<span class="w">                    </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">removeUpdates</span><span class="p">(</span><span class="n">networkLocationListener</span><span class="p">);</span><span class="w">    </span>
<span class="w">                    </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">removeGpsStatusListener</span><span class="p">(</span><span class="n">gpsStatusListener</span><span class="p">);</span>
<span class="w">                    </span><span class="n">sat_count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">                    </span><span class="c1">// send best location to locationResult</span>
<span class="w">                    </span><span class="n">locationResult</span><span class="p">.</span><span class="n">gotLocation</span><span class="p">(</span><span class="n">bestLocation</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Determine</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="nb">find</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="n">location</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="n">needToStop</span><span class="p">(){</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span>!<span class="n">gps_enabled</span><span class="p">){</span>
<span class="w">                          </span><span class="k">return</span><span class="w"> </span><span class="n">true</span><span class="p">;</span>
<span class="w">                     </span><span class="p">}</span>
<span class="w">          </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">counts</span><span class="w"> </span><span class="o">&lt;</span><span class="p">=</span><span class="w"> </span><span class="mi">4</span><span class="p">){</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">sat_count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">min_gps_sat_count</span><span class="p">){</span>
<span class="w">                </span><span class="c1">//if 20-25 sec and 3 satellites found then stop</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">counts</span><span class="w"> </span><span class="o">&gt;</span><span class="p">=</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">sat_count</span><span class="w"> </span><span class="o">&gt;</span><span class="p">=</span><span class="w"> </span><span class="mi">3</span><span class="p">){</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">true</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">false</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Best</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">class</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">LocationResult</span><span class="p">{</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">abstract</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">gotLocation</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="n">location</span><span class="p">);</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Initialize</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="nb">and</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">listeners</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">@</span><span class="n">param</span><span class="w"> </span><span class="n">Context</span><span class="w"> </span><span class="n">ctx</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">@</span><span class="n">param</span><span class="w"> </span><span class="n">LocationResult</span><span class="w"> </span><span class="n">result</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">init</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">LocationResult</span><span class="w"> </span><span class="n">result</span><span class="p">){</span>
<span class="w">        </span><span class="n">context</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">;</span>
<span class="w">        </span><span class="n">locationResult</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>

<span class="w">        </span><span class="n">myLocationManager</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">LocationManager</span><span class="p">)</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="n">LOCATION_SERVICE</span><span class="p">);</span>

<span class="w">        </span><span class="n">gps_enabled</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">Boolean</span><span class="p">)</span><span class="w"> </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">isProviderEnabled</span><span class="p">(</span><span class="n">LocationManager</span><span class="p">.</span><span class="n">GPS_PROVIDER</span><span class="p">);</span>

<span class="w">        </span><span class="n">bestLocation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">null</span><span class="p">;</span>
<span class="w">        </span><span class="n">counts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// turning on location updates</span>
<span class="w">        </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">requestLocationUpdates</span><span class="p">(</span><span class="s">"network"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">networkLocationListener</span><span class="p">);</span>
<span class="w">        </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">requestLocationUpdates</span><span class="p">(</span><span class="s">"gps"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">gpsLocationListener</span><span class="p">);</span>
<span class="w">        </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">addGpsStatusListener</span><span class="p">(</span><span class="n">gpsStatusListener</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// starting best location finder loop</span>
<span class="w">        </span><span class="n">handler</span><span class="p">.</span><span class="n">postDelayed</span><span class="p">(</span><span class="n">showTime</span><span class="p">,</span><span class="w"> </span><span class="n">iteration_timeout_step</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">GpsStatus</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span><span class="w"> </span><span class="n">OnChainged</span><span class="w"> </span><span class="n">counts</span><span class="w"> </span><span class="n">connected</span><span class="w"> </span><span class="n">satellites</span><span class="w"> </span><span class="n">count</span><span class="p">.</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">GpsStatus</span><span class="p">.</span><span class="n">Listener</span><span class="w"> </span><span class="n">gpsStatusListener</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">GpsStatus</span><span class="p">.</span><span class="n">Listener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onGpsStatusChanged</span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">             </span><span class="k">if</span><span class="p">(</span><span class="n">event</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GpsStatus</span><span class="p">.</span><span class="n">GPS_EVENT_SATELLITE_STATUS</span><span class="p">){</span>
<span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// Check number of satellites in list to determine fix state</span>
<span class="w">                     </span><span class="n">GpsStatus</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">myLocationManager</span><span class="p">.</span><span class="n">getGpsStatus</span><span class="p">(</span><span class="nb">null</span><span class="p">);</span>
<span class="w">                     </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">GpsSatellite</span><span class="o">&gt;</span><span class="n">satellites</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">status</span><span class="p">.</span><span class="n">getSatellites</span><span class="p">();</span>

<span class="w">                     </span><span class="n">sat_count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">                     </span><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">GpsSatellite</span><span class="o">&gt;</span><span class="n">satI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">satellites</span><span class="p">.</span><span class="n">iterator</span><span class="p">();</span>
<span class="w">                     </span><span class="k">while</span><span class="p">(</span><span class="n">satI</span><span class="p">.</span><span class="n">hasNext</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                         </span><span class="n">GpsSatellite</span><span class="w"> </span><span class="n">satellite</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">satI</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="w">                         </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Satellite: snr="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">satellite</span><span class="p">.</span><span class="n">getSnr</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">", elevation="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">satellite</span><span class="p">.</span><span class="n">getElevation</span><span class="p">());</span><span class="w">                         </span>
<span class="w">                         </span><span class="n">sat_count</span><span class="o">++</span><span class="p">;</span>
<span class="w">                     </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
<span class="w">                    </span><span class="n">sat_count</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">min_gps_sat_count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                 </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"#### sat_count = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sat_count</span><span class="p">);</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Gps</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">LocationListener</span><span class="w"> </span><span class="n">gpsLocationListener</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">LocationListener</span><span class="p">(){</span>
<span class="w">        </span><span class="p">@</span><span class="n">Override</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onLocationChanged</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="n">location</span><span class="p">){</span>

<span class="w">        </span><span class="p">}</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onProviderDisabled</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">provider</span><span class="p">){}</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onProviderEnabled</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">provider</span><span class="p">){}</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onStatusChanged</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">provider</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">extras</span><span class="p">){}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Network</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">listener</span><span class="p">.</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">LocationListener</span><span class="w"> </span><span class="n">networkLocationListener</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">LocationListener</span><span class="p">(){</span>
<span class="w">        </span><span class="p">@</span><span class="n">Override</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onLocationChanged</span><span class="p">(</span><span class="n">Location</span><span class="w"> </span><span class="n">location</span><span class="p">){</span>

<span class="w">        </span><span class="p">}</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onProviderDisabled</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">provider</span><span class="p">){}</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onProviderEnabled</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">provider</span><span class="p">){}</span>
<span class="w">         </span><span class="n">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onStatusChanged</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">provider</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">extras</span><span class="p">){}</span>
<span class="w">    </span><span class="p">};</span>


<span class="w">    </span><span class="o">/**</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="n">Returns</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">LocationManager</span><span class="p">.</span><span class="n">getBestProvider</span><span class="p">()</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">@</span><span class="n">param</span><span class="w"> </span><span class="n">context</span>
<span class="w">     </span><span class="o">*</span><span class="w"> </span><span class="p">@</span><span class="k">return</span><span class="w"> </span><span class="n">Location</span><span class="o">|</span><span class="nb">null</span>
<span class="w">     </span><span class="o">*/</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Location</span><span class="w"> </span><span class="n">getLocation</span><span class="p">(</span><span class="n">Context</span><span class="w"> </span><span class="n">context</span><span class="p">){</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"getLocation()"</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// fetch last known location and update it</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">LocationManager</span><span class="w"> </span><span class="n">lm</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">LocationManager</span><span class="p">)</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="n">LOCATION_SERVICE</span><span class="p">);</span>

<span class="w">            </span><span class="n">Criteria</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Criteria</span><span class="p">();</span>
<span class="w">            </span><span class="n">criteria</span><span class="p">.</span><span class="n">setAccuracy</span><span class="p">(</span><span class="n">Criteria</span><span class="p">.</span><span class="n">ACCURACY_FINE</span><span class="p">);</span>
<span class="w">             </span><span class="n">criteria</span><span class="p">.</span><span class="n">setAltitudeRequired</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
<span class="w">             </span><span class="n">criteria</span><span class="p">.</span><span class="n">setBearingRequired</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
<span class="w">             </span><span class="n">criteria</span><span class="p">.</span><span class="n">setCostAllowed</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>
<span class="w">             </span><span class="n">String</span><span class="w"> </span><span class="n">strLocationProvider</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">lm</span><span class="p">.</span><span class="n">getBestProvider</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span><span class="w"> </span><span class="n">true</span><span class="p">);</span>

<span class="w">             </span><span class="n">System</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"strLocationProvider="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">strLocationProvider</span><span class="p">);</span>
<span class="w">             </span><span class="n">Location</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">lm</span><span class="p">.</span><span class="n">getLastKnownLocation</span><span class="p">(</span><span class="n">strLocationProvider</span><span class="p">);</span>
<span class="w">             </span><span class="k">if</span><span class="p">(</span><span class="n">location</span><span class="w"> </span>!<span class="p">=</span><span class="w"> </span><span class="nb">null</span><span class="p">){</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">location</span><span class="p">;</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">             </span><span class="k">return</span><span class="w"> </span><span class="nb">null</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">null</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>This class tries to connect to <code>min_gps_sat_count</code> satellites if GPS is
enabled. Else returns <code>LocationManager.getBestProvider()</code> location. Check the
code!</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/android/" rel="tag">android</a></li>
            <li><a class="tag p-category" href="../../categories/geolocation/" rel="tag">geolocation</a></li>
            <li><a class="tag p-category" href="../../categories/latitude-longitude/" rel="tag">latitude-longitude</a></li>
            <li><a class="tag p-category" href="../../categories/location/" rel="tag">location</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../pandas-merging-101/" rel="prev" title="Pandas Merging 101">Previous post</a>
            </li>
            <li class="next">
                <a href="../could-not-find-a-declaration-file-for-module-module-name-path-to-module-name-js-implicitly-has-an-any-type/" rel="next" title="Could not find a declaration file for module 'module-name'. '/path/to/module-name.js' implicitly has an 'any' type">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
