<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Error while installing json gem 'mkmf.rb can't find header files for ruby' | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/error-while-installing-json-gem-mkmf-rb-can-t-find-header-files-for-ruby/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-to-manually-include-external-aar-package-using-gradle-for-android/" title="How to manually include external aar package using Gradle for Android" type="text/html">
<link rel="next" href="../restore-a-postgres-backup-file-using-the-command-line/" title="Restore a postgres backup file using the command line?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Error while installing json gem 'mkmf.rb can't find header files for r">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/error-while-installing-json-gem-mkmf-rb-can-t-find-header-files-for-ruby/">
<meta property="og:description" content="For context, it on a remote server which has a firewall. I'm setting up my
environment through a proxy. I have ruby 1.8.7. When I try to gem install..
sudo gem install --http-proxy &lt;host address&gt;:&lt;por">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T04:24:55+08:00">
<meta property="article:tag" content="json">
<meta property="article:tag" content="ruby">
<meta property="article:tag" content="rubygems">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Error while installing json gem 'mkmf.rb can't find header files for ruby'</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T04:24:55+08:00" itemprop="datePublished" title="2023-03-03 04:24">2023-03-03 04:24</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>For context, it on a remote server which has a firewall. I'm setting up my
environment through a proxy. I have <code>ruby 1.8.7</code>. When I try to gem install..</p>
<div class="code"><pre class="code literal-block">sudo gem install --http-proxy &lt;host address&gt;:&lt;port&gt; json
</pre></div>

<p>I get the following error:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Building</span><span class="w"> </span><span class="nv">native</span><span class="w"> </span><span class="nv">extensions</span>.<span class="w">  </span><span class="nv">This</span><span class="w"> </span><span class="nv">could</span><span class="w"> </span><span class="nv">take</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="k">while</span>...
<span class="nv">ERROR</span>:<span class="w">  </span><span class="nv">Error</span><span class="w"> </span><span class="nv">installing</span><span class="w"> </span><span class="nv">json</span>:
<span class="w">        </span><span class="nv">ERROR</span>:<span class="w"> </span><span class="nv">Failed</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">build</span><span class="w"> </span><span class="nv">gem</span><span class="w"> </span><span class="nv">native</span><span class="w"> </span><span class="nv">extension</span>.

<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">ruby</span><span class="w"> </span><span class="nv">extconf</span>.<span class="nv">rb</span>
<span class="nv">mkmf</span>.<span class="nv">rb</span><span class="w"> </span><span class="nv">can</span><span class="err">'t find header files for ruby at /usr/lib/ruby/ruby.h</span>

<span class="err">Gem files will remain installed in /usr/lib64/ruby/gems/1.8/gems/json-1.8.1 for inspection.</span>
<span class="err">Results logged to /usr/lib64/ruby/gems/1.8/gems/json-1.8.1/ext/json/ext/generator/gem_make.out</span>
</pre></div>

<p>Since I was unsure what the problem is, I googled and found these</p>
<ul>
<li>
<p>gem install: Failed to build gem native extension (can't find header files) - the instructions here seem to be specific to the gem being installed.</p>
</li>
<li>
<p>How to install json gem - Failed to build gem native extension This seems to be slightly different error.</p>
</li>
</ul>
<p>Any hints? Thanks!</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Modern era update, as stated by mimoralea:</p>
<blockquote>
<p>In case that you are using ruby 2.0 or 2.2 (thanks @patrick-davey).</p>
<div class="code"><pre class="code literal-block">sudo apt-get install ruby2.0-dev
sudo apt-get install ruby2.2-dev
sudo apt-get install ruby2.3-dev
</pre></div>

</blockquote>
<p>or, generic way:</p>
<blockquote>
<div class="code"><pre class="code literal-block">sudo apt-get install ruby-dev
</pre></div>

<p>or</p>
<div class="code"><pre class="code literal-block">sudo apt-get install ruby`ruby -e 'puts RUBY_VERSION[/\d+\.\d+/]'`-dev
</pre></div>

</blockquote>
<hr>
<p>The first link you’ve posted is <em>exactly</em> your case: there is no ruby
development environment installed. Development env is needed to compile ruby
extensions, which are mostly written in <code>C</code>. Proxy has nothing to do with the
problem: everything is downloaded fine, just compilation fails.</p>
<p>I would suggest you to install <code>ruby-dev</code> (<code>ruby-devel</code> for rpm-based distros)
package onto you target machine.</p>
<p><code>gcc</code> package might be needed as well.</p>
<p>Try:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>ruby-dev
</pre></div>

<p>Or, for Redhat distro:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>ruby-devel
</pre></div>

<p>Or, for [open]SuSE:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>sudo<span class="w"> </span>zypper<span class="w"> </span>install<span class="w"> </span>ruby-devel
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>For <strong>Xcode 11 on macOS 10.14</strong> , this can happen even after installing Xcode
and installing command-line tools and accepting the license with</p>
<div class="code"><pre class="code literal-block">sudo xcode-select --install
sudo xcodebuild -license accept
</pre></div>

<p>The issue is that Xcode 11 ships the macOS 10.15 SDK which includes headers
for ruby2.6, but not for macOS 10.14's ruby2.3. You can verify that this is
your problem by running</p>
<div class="code"><pre class="code literal-block">ruby -rrbconfig -e 'puts RbConfig::CONFIG["rubyhdrdir"]'
</pre></div>

<p>which on macOS 10.14 with Xcode 11 prints the <strong>non-existent</strong> path</p>
<div class="code"><pre class="code literal-block"><span class="o">/</span><span class="nv">Applications</span><span class="o">/</span><span class="nv">Xcode</span>.<span class="nv">app</span><span class="o">/</span><span class="nv">Contents</span><span class="o">/</span><span class="nv">Developer</span><span class="o">/</span><span class="nv">Platforms</span><span class="o">/</span><span class="nv">MacOSX</span>.<span class="nv">platform</span><span class="o">/</span><span class="nv">Developer</span><span class="o">/</span><span class="nv">SDKs</span><span class="o">/</span><span class="nv">MacOSX10</span>.<span class="mi">15</span>.<span class="nv">sdk</span><span class="o">/</span><span class="nv">System</span><span class="o">/</span><span class="nv">Library</span><span class="o">/</span><span class="nv">Frameworks</span><span class="o">/</span><span class="nv">Ruby</span>.<span class="nv">framework</span><span class="o">/</span><span class="nv">Versions</span><span class="o">/</span><span class="mi">2</span>.<span class="mi">3</span><span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="k">include</span><span class="o">/</span><span class="nv">ruby</span><span class="o">-</span><span class="mi">2</span>.<span class="mi">3</span>.<span class="mi">0</span>
</pre></div>

<p>However, Xcode 11 installs a macOS 10.14 SDK within
<code>/Library/Developer/CommandLineTools/SDKs/MacOS10.14.sdk</code>. It isn't necessary
to pollute the system directories by installing the old header files as
suggested in other answers. Instead, by selecting that SDK, the appropriate
ruby2.3 headers will be found:</p>
<div class="code"><pre class="code literal-block">sudo xcode-select --switch /Library/Developer/CommandLineTools
ruby -rrbconfig -e 'puts RbConfig::CONFIG["rubyhdrdir"]'
</pre></div>

<p>This should now correctly print</p>
<div class="code"><pre class="code literal-block"><span class="o">/</span><span class="nv">Library</span><span class="o">/</span><span class="nv">Developer</span><span class="o">/</span><span class="nv">CommandLineTools</span><span class="o">/</span><span class="nv">SDKs</span><span class="o">/</span><span class="nv">MacOSX10</span>.<span class="mi">14</span>.<span class="nv">sdk</span><span class="o">/</span><span class="nv">System</span><span class="o">/</span><span class="nv">Library</span><span class="o">/</span><span class="nv">Frameworks</span><span class="o">/</span><span class="nv">Ruby</span>.<span class="nv">framework</span><span class="o">/</span><span class="nv">Versions</span><span class="o">/</span><span class="mi">2</span>.<span class="mi">3</span><span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="k">include</span><span class="o">/</span><span class="nv">ruby</span><span class="o">-</span><span class="mi">2</span>.<span class="mi">3</span>.<span class="mi">0</span>
</pre></div>

<p>Likewise, <code>gem install</code> should work while that SDK is selected.</p>
<p>To switch back to the current Xcode SDK, use</p>
<div class="code"><pre class="code literal-block">sudo xcode-select --switch /Applications/Xcode.app
</pre></div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/json/" rel="tag">json</a></li>
            <li><a class="tag p-category" href="../../categories/ruby/" rel="tag">ruby</a></li>
            <li><a class="tag p-category" href="../../categories/rubygems/" rel="tag">rubygems</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-to-manually-include-external-aar-package-using-gradle-for-android/" rel="prev" title="How to manually include external aar package using Gradle for Android">Previous post</a>
            </li>
            <li class="next">
                <a href="../restore-a-postgres-backup-file-using-the-command-line/" rel="next" title="Restore a postgres backup file using the command line?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
