<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>十亿次相对进口 | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/shi-yi-ci-xiang-dui-jin-kou/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../ru-he-xian-shi-wo-de-quan-ju-git-pei-zhi/" title="如何显示我的全局 Git 配置？" type="text/html">
<link rel="next" href="../ru-he-zhi-jie-chu-shi-hua-yi-ge-hashmap-zi-mian-yi-si/" title="如何直接初始化一个HashMap（字面意思）？" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="十亿次相对进口">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/shi-yi-ci-xiang-dui-jin-kou/">
<meta property="og:description" content="我来过这里：

http://www.python.org/dev/peps/pep-0328/
http://docs.python.org/2/tutorial/modules.html#packages
Python 包：相对导入
python 相对导入示例代码不起作用
python 2.5 中的相对导入
Python 中的相对导入
Python：禁用相对导入

还有很多我没有复制的 URL">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T01:42:03+08:00">
<meta property="article:tag" content="import">
<meta property="article:tag" content="python">
<meta property="article:tag" content="python-packaging">
<meta property="article:tag" content="relative-import">
<meta property="article:tag" content="relative-path">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">十亿次相对进口</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T01:42:03+08:00" itemprop="datePublished" title="2023-02-17 01:42">2023-02-17 01:42</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>我来过这里：</p>
<ul>
<li>http://www.python.org/dev/peps/pep-0328/</li>
<li>http://docs.python.org/2/tutorial/modules.html#packages</li>
<li>Python 包：相对导入</li>
<li>python 相对导入示例代码不起作用</li>
<li>python 2.5 中的相对导入</li>
<li>Python 中的相对导入</li>
<li>Python：禁用相对导入</li>
</ul>
<p>还有很多我没有复制的 URL，一些在 SO 上，一些在其他网站上，当我认为我会很快找到解决方案时。</p>
<p>永远反复出现的问题是：我该如何解决这个“尝试在非包中进行相对导入”消息？</p>
<div class="code"><pre class="code literal-block"><span class="ne">ImportError</span><span class="p">:</span> <span class="n">attempted</span> <span class="n">relative</span> <span class="kn">import</span> <span class="nn">with</span> <span class="n">no</span> <span class="n">known</span> <span class="n">parent</span> <span class="n">package</span>
</pre></div>

<p>我在 pep-0328 上构建了一个包的精确副本：</p>
<div class="code"><pre class="code literal-block">package/
    __init__.py
    subpackage1/
        __init__.py
        moduleX.py
        moduleY.py
    subpackage2/
        __init__.py
        moduleZ.py
    moduleA.py
</pre></div>

<p>导入是从控制台完成的。</p>
<p>我确实在相应的模块中创建了名为 spam 和 eggs 的函数。自然是不行了。答案显然在我列出的第 4 个 URL
中，但对我来说都是校友。在我访问的其中一个 URL 上有这样的回复：</p>
<blockquote>
<p>相对导入使用模块的名称属性来确定该模块在包层次结构中的位置。如果模块的名称不包含任何包信息（例如，它被设置为“main”），那么相对导入将被解析为就好像该模块是顶级模块一样，而不管该模块实际位于文件系统中的什么位置。</p>
</blockquote>
<p>上面的回复看起来很有希望，但对我来说都是象形文字。所以我的问题是，如何让 Python 不返回给我“Attempted relative import in
non-package”？据推测，有一个涉及-m 的答案。</p>
<p>有人能告诉我为什么 Python 会给出该错误消息，“非包”是什么意思，为什么以及如何定义“包”，以及用幼儿园儿童容易理解的术语给出的准确 <em>答案</em> 。</p>
<p><br><br></p>
<h2>解答</h2>
<p><strong>脚本与模块</strong></p>
<p>这是一个解释。简而言之，直接运行 Python 文件与从其他地方导入该文件之间存在很大差异。 <strong>仅仅知道文件在哪个目录中并不能确定 Python
认为它在哪个包中。</strong> 此外，这还取决于您如何将文件加载到 Python 中（通过运行或导入）。</p>
<p>加载 Python 文件有两种方法：作为顶级脚本，或作为模块。<code>python
myfile.py</code>如果您直接执行文件，例如通过在命令行中键入，文件将作为顶级脚本加载。<code>import</code>当在其他文件中遇到语句时，它会作为模块加载。一次只能有一个顶层脚本；顶级脚本是您开始运行的
Python 文件。</p>
<p><strong>命名</strong></p>
<p>加载文件时，会为其指定一个名称（存储在其<code>__name__</code>属性中）。</p>
<ul>
<li>如果它作为顶级脚本加载，则其名称为<code>__main__</code>.</li>
<li>如果它作为模块加载，它的名称是 [文件名，前面是它所属的任何包/子包的名称，用点分隔]，例如，<code>package.subpackage1.moduleX</code>.</li>
</ul>
<p>但请注意，如果您<code>moduleX</code>使用诸如 之类的东西从 shell 命令行作为模块加载<code>python -m
package.subpackage1.moduleX</code>，则<code>__name__</code>仍然是<code>__main__</code>.</p>
<p>因此，例如在您的示例中：</p>
<div class="code"><pre class="code literal-block">package/
    __init__.py
    subpackage1/
        __init__.py
        moduleX.py
    moduleA.py
</pre></div>

<p>如果你导入<code>moduleX</code>（注意： <em>导入的</em>
，不是直接执行的），它的名字就是<code>package.subpackage1.moduleX</code>。如果您导入<code>moduleA</code>，它的名称将是<code>package.moduleA</code>。但是，如果您
<em>直接</em>
<code>moduleX</code>从命令行运行，它的名称将改为<code>__main__</code>，如果您直接<code>moduleA</code>从命令行运行，它的名称将是<code>__main__</code>。当一个模块作为顶级脚本运行时，它失去了它的正常名称，而是它的名称<code>__main__</code>。</p>
<p><strong>不通过包含它的包访问模块</strong></p>
<p>还有一个问题：模块的名称取决于它是从其所在目录“直接”导入还是通过包导入。如果您在目录中运行
Python，并尝试在同一目录（或其子目录）中导入文件，这只会有所不同。例如，如果您在目录中启动 Python
解释器<code>package/subpackage1</code>然后执行<code>import
moduleX</code>，则名称<code>moduleX</code>将只是<code>moduleX</code>，而不是<code>package.subpackage1.moduleX</code>。这是因为当交互式输入解释器时，Python
将当前目录添加到它的搜索路径中；如果在当前目录下找到要导入的模块，它就不知道该目录是包的一部分，包信息也不会成为模块名称的一部分。</p>
<p>一种特殊情况是，如果您以交互方式运行解释器（例如，只需键入<code>python</code>并开始即时输入 Python
代码）。在这种情况下，该交互式会话的名称是<code>__main__</code>。</p>
<p>现在这里是你的错误信息的关键： <strong>如果一个模块的名字没有点，它不被认为是包的一部分</strong>
。文件实际在磁盘上的位置并不重要。重要的是它的名字是什么，它的名字取决于你如何加载它。</p>
<p>现在看看您在问题中包含的引述：</p>
<blockquote>
<p>相对导入使用模块的名称属性来确定该模块在包层次结构中的位置。如果模块的名称不包含任何包信息（例如，它被设置为“main”），那么相对导入将被解析为就好像该模块是顶级模块一样，而不管该模块实际位于文件系统中的什么位置。</p>
</blockquote>
<p><strong>相对进口...</strong></p>
<p>相对导入使用模块的 <em>名称</em> 来确定它在包中的位置。当您使用诸如 之类的相对导入时<code>from .. import
foo</code>，点表示要在包层次结构中提升一些级别。例如，如果您当前的模块名称是<code>package.subpackage1.moduleX</code>，那么<code>..moduleA</code>就意味着<code>package.moduleA</code>.
要使 a<code>from .. import</code>起作用，模块名称中的点数必须至少与语句中的点数一样多<code>import</code>。</p>
<p><strong>...在一个包中只是相对的</strong></p>
<p>但是，如果您的模块名称是<code>__main__</code>，则不认为它在包中。它的名字没有点，因此你不能<code>from ..
import</code>在里面使用语句。如果您尝试这样做，您将收到“非包中的相对导入”错误。</p>
<p><strong>脚本无法导入 relative</strong></p>
<p>您可能所做的是尝试<code>moduleX</code>从命令行运行等。当您这样做时，它的名称被设置为<code>__main__</code>，这意味着其中的相对导入将失败，因为它的名称不会显示它在包中。请注意，如果您从模块所在的同一目录运行
Python，然后尝试导入该模块，也会发生这种情况，因为如上所述，Python 会“过早地”在当前目录中找到该模块而没有意识到包的一部分。</p>
<p>还请记住，当您运行交互式解释器时，该交互式会话的“名称”始终是<code>__main__</code>。因此， <strong>您不能直接从交互式会话进行相对导入</strong>
。相对导入仅在模块文件中使用。</p>
<p><strong>两种解决方案：</strong></p>
<ol>
<li>
<p>如果你真的想<code>moduleX</code>直接运行，但你仍然希望它被视为包的一部分，你可以这样做<code>python -m package.subpackage1.moduleX</code>。告诉<code>-m</code>Python 将其作为模块加载，而不是作为顶级脚本加载。</p>
</li>
<li>
<p>或者您可能实际上并不想 <em>运行</em> <code>moduleX</code>，您只是想运行一些其他脚本，比如说<code>myfile.py</code>，它 <em>使用</em> 内部函数<code>moduleX</code>。如果是这种情况，请将其放在<code>myfile.py</code> <em>其他地方</em> —— <em>而不是</em> 在目录内<code>package</code>——然后运行它。如果<code>myfile.py</code>你在里面做类似的事情<code>from package.moduleA import spam</code>，它会工作得很好。</p>
</li>
</ol>
<p><strong>笔记</strong></p>
<ul>
<li>
<p>对于这些解决方案中的任何一个，包目录（<code>package</code>在您的示例中）必须可以从 Python 模块搜索路径 ( <code>sys.path</code>) 访问。如果不是，您将根本无法可靠地使用包中的任何内容。</p>
</li>
<li>
<p>从 Python 2.6 开始，用于包解析目的的模块“名称”不仅由其<code>__name__</code>属性决定，而且由<code>__package__</code>属性决定。这就是为什么我避免使用显式符号<code>__name__</code>来引用模块的“名称”。从 Python 2.6 开始，模块的“名称”是 effectively <code>__package__ + '.' + __name__</code>，或者只是<code>__name__</code>if<code>__package__</code>是<code>None</code>。）</p>
</li>
</ul>
<p><br></p>
<h3>更多建议</h3>
<p>这确实是 python 中的一个问题。 <strong>混淆的根源是人们错误地将相对导入作为路径相对，而事实并非如此。</strong></p>
<p>例如，当您在 <em>faa.py</em> 中编写时：</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">foo</span>
</pre></div>

<p><em>仅当faa.py</em> 在执行期间作为包的一部分被 python识别 <em>和加载</em> 时，这才有意义。在这种情况下， <em>faa.py</em> 的 <strong>模块名称</strong>
将是例如 <em>some_packagename.faa</em> 。如果文件只是因为它在当前目录中而被加载，那么当 python
运行时，它的名称将不会引用任何包，最终相对导入将失败。 <strong> </strong></p>
<p>在当前目录中引用模块的一个简单解决方案是使用这个：</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span> <span class="n">__package__</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">__package__</span> <span class="o">==</span> <span class="s1">''</span><span class="p">:</span>
    <span class="c1"># uses current directory visibility</span>
    <span class="kn">import</span> <span class="nn">foo</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># uses current package visibility</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">foo</span>
</pre></div>

<p><br><br><a href="../relative-imports-for-the-billionth-time/">查看原文</a></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/import/" rel="tag">import</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/python-packaging/" rel="tag">python-packaging</a></li>
            <li><a class="tag p-category" href="../../categories/relative-import/" rel="tag">relative-import</a></li>
            <li><a class="tag p-category" href="../../categories/relative-path/" rel="tag">relative-path</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../ru-he-xian-shi-wo-de-quan-ju-git-pei-zhi/" rel="prev" title="如何显示我的全局 Git 配置？">Previous post</a>
            </li>
            <li class="next">
                <a href="../ru-he-zhi-jie-chu-shi-hua-yi-ge-hashmap-zi-mian-yi-si/" rel="next" title="如何直接初始化一个HashMap（字面意思）？">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
