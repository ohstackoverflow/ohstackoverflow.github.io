<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>UnicodeEncodeError: 'ascii' codec can't encode character u'\xa0' in position 20: ordinal not in range(128) | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/unicodeencodeerror-ascii-codec-can-t-encode-character-u-xa0-in-position-20-ordinal-not-in-range-128/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../what-s-a-quick-way-to-comment-uncomment-lines-in-vim/" title="What's a quick way to comment/uncomment lines in Vim?" type="text/html">
<link rel="next" href="../safely-turning-a-json-string-into-an-object/" title="Safely turning a JSON string into an object" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="UnicodeEncodeError: 'ascii' codec can't encode character u'\xa0' in po">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/unicodeencodeerror-ascii-codec-can-t-encode-character-u-xa0-in-position-20-ordinal-not-in-range-128/">
<meta property="og:description" content="I'm having problems dealing with unicode characters from text fetched from
different web pages (on different sites). I am using BeautifulSoup.
The problem is that the error is not always reproducible;">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T02:01:24+08:00">
<meta property="article:tag" content="beautifulsoup">
<meta property="article:tag" content="python">
<meta property="article:tag" content="python-2.x">
<meta property="article:tag" content="python-unicode">
<meta property="article:tag" content="unicode">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">UnicodeEncodeError: 'ascii' codec can't encode character u'\xa0' in position 20: ordinal not in range(128)</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T02:01:24+08:00" itemprop="datePublished" title="2023-02-17 02:01">2023-02-17 02:01</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I'm having problems dealing with unicode characters from text fetched from
different web pages (on different sites). I am using BeautifulSoup.</p>
<p>The problem is that the error is not always reproducible; it sometimes works
with some pages, and sometimes, it barfs by throwing a <code>UnicodeEncodeError</code>. I
have tried just about everything I can think of, and yet I have not found
anything that works consistently without throwing some kind of Unicode-related
error.</p>
<p>One of the sections of code that is causing problems is shown below:</p>
<div class="code"><pre class="code literal-block"><span class="nv">agent_telno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">agent</span>.<span class="nv">find</span><span class="ss">(</span><span class="s1">'div'</span>,<span class="w"> </span><span class="s1">'agent_contact_number'</span><span class="ss">)</span>
<span class="nv">agent_telno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">agent_telno</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nv">agent_telno</span>.<span class="nv">contents</span>[<span class="mi">0</span>]
<span class="nv">p</span>.<span class="nv">agent_info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">str</span><span class="ss">(</span><span class="nv">agent_contact</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">agent_telno</span><span class="ss">)</span>.<span class="nv">strip</span><span class="ss">()</span>
</pre></div>

<p>Here is a stack trace produced on SOME strings when the snippet above is run:</p>
<div class="code"><pre class="code literal-block">Traceback (most recent call last):
  File "foobar.py", line 792, in &lt;module&gt;
    p.agent_info = str(agent_contact + ' ' + agent_telno).strip()
UnicodeEncodeError: 'ascii' codec can't encode character u'\xa0' in position 20: ordinal not in range(128)
</pre></div>

<p>I suspect that this is because some pages (or more specifically, pages from
some of the sites) may be encoded, whilst others may be unencoded. All the
sites are based in the UK and provide data meant for UK consumption - so there
are no issues relating to internalization or dealing with text written in
anything other than English.</p>
<p>Does anyone have any ideas as to how to solve this so that I can CONSISTENTLY
fix this problem?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Read the Python Unicode HOWTO. This error is the very first example.</p>
<p>Do not use <code>str()</code> to convert from unicode to encoded text / bytes.</p>
<p>Instead, use <code>.encode()</code> to encode the string:</p>
<div class="code"><pre class="code literal-block">p.agent_info = u' '.join((agent_contact, agent_telno)).encode('utf-8').strip()
</pre></div>

<p>or work entirely in unicode.</p>
<p><br></p>
<h3>Suggest</h3>
<p>This is a classic python unicode pain point! Consider the following:</p>
<div class="code"><pre class="code literal-block">a = u'bats\u00E0'
print a
 =&gt; batsà
</pre></div>

<p>All good so far, but if we call str(a), let's see what happens:</p>
<div class="code"><pre class="code literal-block">str(a)
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
UnicodeEncodeError: 'ascii' codec can't encode character u'\xe0' in position 4: ordinal not in range(128)
</pre></div>

<p>Oh dip, that's not gonna do anyone any good! To fix the error, encode the
bytes explicitly with .encode and tell python what codec to use:</p>
<div class="code"><pre class="code literal-block">a.encode('utf-8')
 =&gt; 'bats\xc3\xa0'
print a.encode('utf-8')
 =&gt; batsà
</pre></div>

<p>Voil\u00E0!</p>
<p>The issue is that when you call str(), python uses the default character
encoding to try and encode the bytes you gave it, which in your case are
sometimes representations of unicode characters. To fix the problem, you have
to tell python how to deal with the string you give it by using
.encode('whatever_unicode'). Most of the time, you should be fine using utf-8.</p>
<p>For an excellent exposition on this topic, see Ned Batchelder's PyCon talk
here: http://nedbatchelder.com/text/unipain.html</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/beautifulsoup/" rel="tag">beautifulsoup</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/python-2x/" rel="tag">python-2.x</a></li>
            <li><a class="tag p-category" href="../../categories/python-unicode/" rel="tag">python-unicode</a></li>
            <li><a class="tag p-category" href="../../categories/unicode/" rel="tag">unicode</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../what-s-a-quick-way-to-comment-uncomment-lines-in-vim/" rel="prev" title="What's a quick way to comment/uncomment lines in Vim?">Previous post</a>
            </li>
            <li class="next">
                <a href="../safely-turning-a-json-string-into-an-object/" rel="next" title="Safely turning a JSON string into an object">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
