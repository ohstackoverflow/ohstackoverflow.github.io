<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>退出应用程序是否令人不悦？ | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/tui-chu-ying-yong-cheng-xu-shi-fou-ling-ren-bu-yue/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../php-mi-ma-de-an-quan-ha-xi-he-yan/" title="PHP 密码的安全哈希和盐" type="text/html">
<link rel="next" href="../chu-li-java-lang-outofmemoryerror-permgen-space-cuo-wu/" title="处理“java.lang.OutOfMemoryError: PermGen space”错误" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="退出应用程序是否令人不悦？">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/tui-chu-ying-yong-cheng-xu-shi-fou-ling-ren-bu-yue/">
<meta property="og:description" content="继续尝试学习 Android，我刚刚阅读了以下内容：

问题： 用户是否可以选择终止应用程序，除非我们放入一个菜单选项来终止它？ 如果不存在这样的选项，用户如何终止应用程序？
回答：（Romain Guy）： 用户没有，系统自动处理。 这就是 Activity 生命周期（尤其是
onPause/onStop/onDestroy）的用途。无论您做什么，都不要放置“退出”或“退出”应用程序按钮。它对A">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T04:14:43+08:00">
<meta property="article:tag" content="android">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">退出应用程序是否令人不悦？</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T04:14:43+08:00" itemprop="datePublished" title="2023-02-17 04:14">2023-02-17 04:14</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>继续尝试学习 Android，我刚刚阅读了以下内容：</p>
<blockquote>
<p>问题： <em>用户是否可以选择终止应用程序，除非我们放入一个菜单选项来终止它？ 如果不存在这样的选项，用户如何终止应用程序？</em></p>
<p>回答：（Romain Guy）： <em>用户没有，系统自动处理。 这就是 Activity 生命周期（尤其是
onPause/onStop/onDestroy）的用途。无论您做什么，都不要放置“退出”或“退出”应用程序按钮。它对Android的应用程序模型没有用。这也与核心应用程序的工作方式相反。</em></p>
</blockquote>
<p>呵呵，我在 Android 世界中迈出的每一步都会遇到某种问题 =(</p>
<p>显然，您无法退出 Android 中的应用程序（但 Android
系统可以随时完全破坏您的应用程序）。那是怎么回事？我开始认为不可能编写一个作为“普通应用程序”运行的应用程序——用户可以在他/她决定退出时退出该应用程序。这不是应该依赖操作系统来做的事情。</p>
<p>我尝试创建的应用程序不是 Android Market
的应用程序。它不是一个供大众“广泛使用”的应用程序，它是一个将在非常狭窄的业务领域中使用的业务应用程序。</p>
<p>我真的很期待为 Android 平台开发，因为它解决了 Windows Mobile 和 .NET
中存在的许多问题。然而，上周对我来说有点令人失望……我希望我不必放弃 Android，但它现在看起来不太好 =(</p>
<p>有没有办法让我 <strong>真正</strong> 退出应用程序？</p>
<p><br><br></p>
<h2>解答</h2>
<p>这最终将解决您的问题，但我首先想解决您在撰写本文时已经给出的各种答案的各种评论中提出的一些问题。我无意改变你的想法——相反，这些是为将来阅读这篇文章的其他人准备的。</p>
<blockquote>
<p>关键是我不能让 Android 确定我的应用程序何时终止。那一定是用户的选择。</p>
</blockquote>
<p>数百万人对环境根据需要关闭应用程序的模型非常满意。这些用户根本不会考虑“终止”Android 应用程序，就像他们不会考虑“终止”网页或“终止”恒温器一样。</p>
<p>iPhone 用户的情况大致相同，因为按下 iPhone 按钮并不一定“感觉”应用程序已终止，因为许多 iPhone
应用程序会从用户停止的地方开始，即使应用程序真的被关闭了（因为 iPhone 只允许目前一次一个第三方应用程序）。</p>
<blockquote>
<p>正如我上面所说的，我的应用程序中发生了很多事情（数据被推送到设备，列出了应该始终存在的任务，等等）。</p>
</blockquote>
<p>我不知道“列出始终应该存在的任务列表”是什么意思，但是“将数据推送到设备”是一个令人愉快的小说，无论如何都不应该通过活动来完成。使用计划任务（通过<code>AlarmManager</code>）更新您的数据以获得最大的可靠性。</p>
<blockquote>
<p>我们的用户每次接到电话并且 Android 决定终止该应用程序时都需要登录，但不能这样做。</p>
</blockquote>
<p>有许多处理此问题的 iPhone 和 Android 应用程序。通常，这是因为他们持有登录凭据，而不是强制用户每次都手动登录。</p>
<blockquote>
<p>例如，我们希望在退出应用程序时检查更新</p>
</blockquote>
<p>这在任何操作系统上都是错误的。就您所知，您的应用程序“退出”的原因是因为操作系统正在关闭，然后您的更新过程将在中途失败。通常，这不是一件好事。要么在启动时检查更新，要么完全异步地检查更新（例如，通过计划任务），从不在退出时检查更新。</p>
<blockquote>
<p>一些评论表明，点击后退按钮根本不会终止应用程序（请参阅上面我的问题中的链接）。</p>
</blockquote>
<p>按下后退按钮不会“终止应用程序”。当用户按下 BACK 按钮时，它会完成屏幕上的活动。</p>
<blockquote>
<p>它应该只在用户想要终止它时终止——永远不要以任何其他方式终止。如果你不能在 Android 中编写行为类似的应用程序，那么我认为 Android
不能用于编写真正的应用程序 =(</p>
</blockquote>
<p>那么 Web
应用程序也不能。或者WebOS，如果我正确理解他们的模型（还没有机会玩一个）。在所有这些中，用户不会“终止”任何东西——他们只是离开。iPhone
有点不同，因为它目前只允许一次运行一件事（除了少数例外），因此离开的行为意味着应用程序的相当立即终止。</p>
<blockquote>
<p>有没有办法让我真正退出应用程序？</p>
</blockquote>
<p>正如其他人告诉您的那样，用户（通过
BACK）或您的代码（通过<code>finish()</code>）可以关闭您当前运行的活动。对于正确编写的应用程序，用户通常不需要任何其他东西，就像他们使用 Web
应用程序不需要“退出”选项一样。</p>
<hr>
<p>根据定义，没有两个应用程序环境是相同的。这意味着随着新趋势的出现和其他趋势的消失，您可以看到环境中的趋势。</p>
<p>例如，越来越多的运动试图消除“文件”的概念。大多数 Web 应用程序不会强迫用户考虑文件。iPhone 应用程序通常不会强迫用户想到文件。Android
应用程序通常不会强迫用户想到文件。等等。</p>
<p>同样，越来越多的运动试图消除“终止”应用程序的概念。大多数 Web 应用程序不会强制用户注销，而是在用户一段时间不活动后隐式注销。Android
也是如此，在较小程度上，iPhone（可能还有 WebOS）也是如此。</p>
<p>这需要更加重视应用程序设计，关注业务目标，而不是坚持与以前的应用程序环境绑定的实施模型。没有时间或不愿意这样做的开发人员会对破坏他们现有心智模型的新环境感到沮丧。这不是任何一种环境的错，就像风暴绕过它而不是穿过它是一座山的错一样。</p>
<p>例如，一些开发环境，如Hypercard和 Smalltalk，将应用程序和开发工具混合在一个设置中。除了应用程序的语言扩展（例如，
Excel中的VBA、AutoCAD 中的
Lisp）之外，这个概念并没有流行起来。因此，那些想出假设应用程序本身存在开发工具的心智模型的开发人员要么必须改变他们的模型，要么将自己限制在他们的模型适用的环境中。</p>
<p>所以，当你写：</p>
<blockquote>
<p>连同我发现的其他乱七八糟的事情，我认为开发我们的 Android 应用程序不会发生。</p>
</blockquote>
<p>这似乎是最好的，对你来说，现在。同样，我会建议您不要尝试将您的应用程序移植到 Web，因为您在 Android 上报告的一些相同问题也会在 Web
应用程序中发现（例如，没有“终止”）。或者，相反，如果有一天您 <em>将</em> 应用程序移植到 Web，您可能会发现 Web 应用程序的流程可能更适合
Android，此时您可以重新访问 Android 端口。</p>
<p><br></p>
<h3>更多建议</h3>
<p>我只想在这里为该线程的未来读者添加一个更正。很长一段时间我都无法理解这种特殊的细微差别，所以我想确保你们不会犯同样的错误：</p>
<p><strong><code>System.exit()</code> 如果您在堆栈上有多个活动，则不会终止您的应用程序。</strong>实际发生的是 <strong>进程被杀死并立即重新启动</strong>
，堆栈上的活动减少了一个。当您的应用程序被“强制关闭”对话框终止时，甚至当您尝试从 DDMS
中终止进程时，也会发生这种情况。据我所知，这是一个完全没有记录的事实。</p>
<p>简短的回答是，如果你想退出你的应用程序，你必须跟踪堆栈中的所有活动以及<code>finish()</code>用户想要退出时的所有活动（不，没有办法遍历活动堆栈，所以你必须自己管理所有这些）。即使这样实际上也不会终止进程或您可能拥有的任何悬空引用。它只是完成活动。另外，我不确定是否<code>Process.killProcess(Process.myPid())</code>效果更好；我还没有测试过。</p>
<p>另一方面，如果您可以让 Activity
保留在您的堆栈中，那么还有另一种方法可以让事情变得非常简单：只需将您的进程置于后台<code>Activity.moveTaskToBack(true)</code>并显示主屏幕。</p>
<p>长答案涉及解释这种行为背后的哲学。该哲学源于许多假设：</p>
<ol>
<li>首先，这只会在您的应用程序位于前台时发生。如果它在后台，进程就会终止。但是，如果它在前台，操作系统会假定用户想继续做他/她正在做的事情。（如果你想从 DDMS 中终止进程，你应该先点击主页按钮，然后终止它）</li>
<li>它还假定每个活动都独立于所有其他活动。这通常是正确的，例如在您的应用程序启动浏览器活动的情况下，它是完全独立的并且不是您编写的。浏览器活动可能会也可能不会在同一个任务上创建，具体取决于其清单属性。</li>
<li>它假定您的每项活动都是完全自力更生的，并且可以立即终止/恢复。（我很不喜欢这个特定的假设，因为我的应用程序有很多依赖大量缓存数据的活动，这些数据太大而无法在 期间有效序列化<code>onSaveInstanceState</code>，但是你会怎么做？）对于大多数编写良好的 Android 应用程序来说，这应该是正确的，因为您永远不知道您的应用程序何时会在后台被终止。</li>
<li>最后一个因素与其说是一个假设，不如说是操作系统的限制： <em>显式杀死应用程序与应用程序崩溃相同，也与 Android 杀死应用程序以回收内存相同。</em> 这最终导致我们的致命一击：由于 Android 无法判断应用程序是退出、崩溃还是在后台被杀死，它假定用户想要返回他们离开的地方，因此 ActivityManager 重新启动进程。</li>
</ol>
<p>仔细想想，这对平台来说是合适的。首先，这正是当进程在后台被终止并且用户返回到它时发生的情况，因此需要在它停止的地方重新启动它。其次，这是当应用程序崩溃并显示可怕的强制关闭对话框时发生的情况。</p>
<p>假设我希望我的用户能够拍照并上传。我从我的活动中启动相机活动，并要求它返回图像。相机被推到我当前任务的顶部（而不是在它自己的任务中创建）。如果相机出现错误并崩溃，是否会导致整个应用程序崩溃？从用户的角度来看，只有
Camera 出现故障，他们应该返回到之前的 Activity。所以它只是用堆栈中所有相同的活动重新启动进程，减去相机。由于您的 Activity <em>应该</em>
被设计成可以随时终止和恢复它们，所以这应该不是问题。不幸的是，并不是所有的应用程序都可以这样设计，所以它 <em>是</em> 对我们许多人来说都是一个问题，不管
Romain Guy 或其他人告诉你什么。因此，我们需要使用变通方法。</p>
<p>所以，我的结束建议：</p>
<ul>
<li>不要试图终止进程。调用<code>finish()</code>所有活动或调用<code>moveTaskToBack(true)</code>.</li>
<li>如果您的进程崩溃或被杀死，并且像我一样，您需要内存中现在丢失的数据，您将需要返回到根活动。为此，您应该<code>startActivity()</code>使用包含标志的 Intent进行调用<code>Intent.FLAG_ACTIVITY_CLEAR_TOP</code>。</li>
<li>如果你想从 Eclipse DDMS 的角度杀死你的应用程序，它最好不要在前台，否则它会自行重启。您应该先按主页按钮，然后 <em>终止</em> 进程。</li>
</ul>
<p><br><br><a href="../is-quitting-an-application-frowned-upon/">查看原文</a></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/android/" rel="tag">android</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../php-mi-ma-de-an-quan-ha-xi-he-yan/" rel="prev" title="PHP 密码的安全哈希和盐">Previous post</a>
            </li>
            <li class="next">
                <a href="../chu-li-java-lang-outofmemoryerror-permgen-space-cuo-wu/" rel="next" title="处理“java.lang.OutOfMemoryError: PermGen space”错误">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
