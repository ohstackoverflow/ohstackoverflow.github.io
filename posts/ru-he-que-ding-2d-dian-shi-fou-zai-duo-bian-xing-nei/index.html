<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>如何确定 2D 点是否在多边形内？ | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/ru-he-que-ding-2d-dian-shi-fou-zai-duo-bian-xing-nei/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../ru-he-rang-android-she-bei-zhen-dong-pin-lu-bu-tong/" title="如何让 Android 设备振动？频率不同？" type="text/html">
<link rel="next" href="../zai-gong-ju-lan-shang-xian-shi-hou-tui-jian-tou/" title="在工具栏上显示后退箭头" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="如何确定 2D 点是否在多边形内？">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/ru-he-que-ding-2d-dian-shi-fou-zai-duo-bian-xing-nei/">
<meta property="og:description" content="我正在尝试在多边形算法中创建一个 快速 2D
点，用于命中测试（例如Polygon.contains(p:Point)）。对有效技术的建议将不胜感激。

解答
对于图形，我宁愿不喜欢整数。许多系统使用整数进行 UI 绘制（像素毕竟是整数），但 macOS，例如，对所有内容都使用浮点数。macOS
只知道点，一个点可以转换为一个像素，但根据显示器分辨率，它可能会转换为其他东西。在视网膜屏幕上，半个点">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-18T01:35:32+08:00">
<meta property="article:tag" content="collision-detection">
<meta property="article:tag" content="graphics">
<meta property="article:tag" content="performance">
<meta property="article:tag" content="point-in-polygon">
<meta property="article:tag" content="polygon">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">如何确定 2D 点是否在多边形内？</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T01:35:32+08:00" itemprop="datePublished" title="2023-02-18 01:35">2023-02-18 01:35</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>我正在尝试在多边形算法中创建一个 <em>快速</em> 2D
点，用于命中测试（例如<code>Polygon.contains(p:Point)</code>）。对有效技术的建议将不胜感激。</p>
<p><br><br></p>
<h2>解答</h2>
<p>对于图形，我宁愿不喜欢整数。许多系统使用整数进行 UI 绘制（像素毕竟是整数），但 macOS，例如，对所有内容都使用浮点数。macOS
只知道点，一个点可以转换为一个像素，但根据显示器分辨率，它可能会转换为其他东西。在视网膜屏幕上，半个点 (0.5/0.5) 是像素。不过，我从未注意到
macOS 用户界面比其他用户界面慢得多。毕竟，3D API（OpenGL 或 Direct3D）也可以使用浮点数，现代图形库经常利用 GPU 加速。</p>
<p>现在你说速度是你最关心的，好吧，让我们追求速度。在你运行任何复杂的算法之前，先做一个简单的测试。在多边形周围创建一个 <em>轴对齐的边界框。</em>
这非常简单、快速并且已经可以为您节省大量计算。这是如何运作的？遍历多边形的所有点并找到 X 和 Y 的最小/最大值。</p>
<p>例如你有积分<code>(9/1), (4/3), (2/7), (8/2), (3/6)</code>。这意味着 Xmin 为 2，Xmax 为 9，Ymin 为 1，Ymax
为 7。具有两条边 (2/1) 和 (9/7) 的矩形外部的点不能在多边形内。</p>
<div class="code"><pre class="code literal-block"><span class="c1">// p is your point, p.x is the x coord, p.y is the y coord</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Xmin</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Xmax</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Ymin</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Ymax</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Definitely not within the polygon!</span>
<span class="p">}</span>
</pre></div>

<p>这是针对任何点运行的第一个测试。如您所见，此测试速度超快，但也非常粗糙。要处理边界矩形内的点，我们需要更复杂的算法。有几种方法可以计算它。哪种方法有效还取决于多边形是否可以有孔或始终是实心的。下面是实心的例子（一个凸的，一个凹的）：</p>
<p><img alt="无孔多边形" src="../../images/G76ta.jpg"></p>
<p>这是一个有洞的：</p>
<p><img alt="带孔的多边形" src="../../images/oDCCd.gif"></p>
<p>绿色的中间有个洞！</p>
<p>可以处理上述所有三种情况并且仍然非常快的最简单的算法称为 <strong>光线投射</strong>
。该算法的想法非常简单：从多边形外的任何地方绘制一条虚拟射线到您的点，并计算它击中多边形一侧的频率。如果命中数为偶数，则在多边形外部，如果为奇数，则在多边形内部。</p>
<p><img alt="演示光线如何穿过多边形" src="../../images/2EzSM.png"></p>
<p>缠绕 <strong>数算法</strong>
将是一种替代方法，它对于非常接近多边形线的点更准确，但速度也慢得多。由于有限的浮点精度和舍入问题，对于太靠近多边形边的点，光线投射可能会失败，但实际上这几乎不是问题，就好像一个点位于靠近边的位置，通常在视觉上什至不可能查看器识别它是已经在里面还是还在外面。</p>
<p>你还有上面的边界框，还记得吗？只需在边界框外选择一个点并将其用作射线的起点。例如，该点<code>(Xmin - e/p.y)</code>肯定在多边形之外。</p>
<p>但什么是<code>e</code>？好吧，<code>e</code>（实际上是 epsilon）给边界框一些 <em>填充</em>
。正如我所说，如果我们开始时离多边形线太近，光线追踪就会失败。由于边界框可能等于多边形（如果多边形是轴对齐的矩形，则边界框等于多边形本身！），我们需要一些填充来确保安全，仅此而已。你应该选择多大<code>e</code>？不太大。这取决于您用于绘图的坐标系比例。如果您的像素步长为
1.0，则只需选择 1.0（但 0.1 也可以）</p>
<p>现在我们有了带有起点和终点坐标的射线，问题从“ <em>是多边形内的点</em> ”转移到“ <em>射线与多边形边相交的频率</em>
”。因此我们不能像以前那样只处理多边形点，现在我们需要实际的边。边总是由两点定义。</p>
<div class="code"><pre class="code literal-block">side 1: (X1/Y1)-(X2/Y2)
side 2: (X2/Y2)-(X3/Y3)
side 3: (X3/Y3)-(X4/Y4)
:
</pre></div>

<p>您需要针对所有方面测试射线。将射线视为矢量，将每条边都视为矢量。射线必须恰好击中每一侧一次或根本不击中。它不能两次击中同一侧。二维空间中的两条线总是恰好相交一次，除非它们是平行的，在这种情况下它们永远不会相交。然而，由于向量的长度有限，两个向量可能不平行并且永远不会相交，因为它们太短而永远不会相遇。</p>
<div class="code"><pre class="code literal-block"><span class="c1">// Test the ray against all sides</span>
<span class="nb">int</span><span class="w"> </span><span class="n">intersections</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">side</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">numberOfSides</span><span class="p">;</span><span class="w"> </span><span class="n">side</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Test if current side intersects with ray.</span>
<span class="w">    </span><span class="c1">// If yes, intersections++;</span>
<span class="p">}</span>
<span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">intersections</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Inside of polygon</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Outside of polygon</span>
<span class="p">}</span>
</pre></div>

<p>到目前为止一切顺利，但是如何测试两个向量是否相交？这是一些 C 代码（未测试），应该可以解决问题：</p>
<div class="code"><pre class="code literal-block"><span class="p">#</span><span class="nn">define</span><span class="w"> </span><span class="nt">NO</span><span class="w"> </span><span class="nt">0</span>
<span class="p">#</span><span class="nn">define</span><span class="w"> </span><span class="nt">YES</span><span class="w"> </span><span class="nt">1</span>
<span class="p">#</span><span class="nn">define</span><span class="w"> </span><span class="nt">COLLINEAR</span><span class="w"> </span><span class="nt">2</span>

<span class="nt">int</span><span class="w"> </span><span class="nt">areIntersecting</span><span class="o">(</span>
<span class="w">    </span><span class="nt">float</span><span class="w"> </span><span class="nt">v1x1</span><span class="o">,</span><span class="w"> </span><span class="nt">float</span><span class="w"> </span><span class="nt">v1y1</span><span class="o">,</span><span class="w"> </span><span class="nt">float</span><span class="w"> </span><span class="nt">v1x2</span><span class="o">,</span><span class="w"> </span><span class="nt">float</span><span class="w"> </span><span class="nt">v1y2</span><span class="o">,</span>
<span class="w">    </span><span class="nt">float</span><span class="w"> </span><span class="nt">v2x1</span><span class="o">,</span><span class="w"> </span><span class="nt">float</span><span class="w"> </span><span class="nt">v2y1</span><span class="o">,</span><span class="w"> </span><span class="nt">float</span><span class="w"> </span><span class="nt">v2x2</span><span class="o">,</span><span class="w"> </span><span class="nt">float</span><span class="w"> </span><span class="nt">v2y2</span>
<span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">float</span><span class="w"> </span><span class="err">d1,</span><span class="w"> </span><span class="err">d2</span><span class="p">;</span>
<span class="w">    </span><span class="err">float</span><span class="w"> </span><span class="err">a1,</span><span class="w"> </span><span class="err">a2,</span><span class="w"> </span><span class="err">b1,</span><span class="w"> </span><span class="err">b2,</span><span class="w"> </span><span class="err">c1,</span><span class="w"> </span><span class="err">c2</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">Convert</span><span class="w"> </span><span class="err">vector</span><span class="w"> </span><span class="err">1</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">(line</span><span class="w"> </span><span class="err">1)</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">infinite</span><span class="w"> </span><span class="err">length.</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">We</span><span class="w"> </span><span class="err">want</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">linear</span><span class="w"> </span><span class="err">equation</span><span class="w"> </span><span class="err">standard</span><span class="w"> </span><span class="n">form</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">See</span><span class="o">:</span><span class="w"> </span><span class="n">http</span><span class="o">://</span><span class="n">en</span><span class="o">.</span><span class="n">wikipedia</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">wiki</span><span class="o">/</span><span class="n">Linear_equation</span>
<span class="w">    </span><span class="n">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v1y2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v1y1</span><span class="p">;</span>
<span class="w">    </span><span class="err">b1</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">v1x1</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">v1x2</span><span class="p">;</span>
<span class="w">    </span><span class="err">c1</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">(v1x2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v1y1)</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">(v1x1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v1y2)</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">Every</span><span class="w"> </span><span class="err">point</span><span class="w"> </span><span class="err">(x,y),</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">solves</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">equation</span><span class="w"> </span><span class="err">above,</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">line,</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">every</span><span class="w"> </span><span class="err">point</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">does</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">solve</span><span class="w"> </span><span class="err">it,</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">not.</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">equation</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">a</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">positive</span><span class="w"> </span><span class="err">result</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">one</span><span class="w"> </span><span class="err">side</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">negative</span><span class="w"> </span><span class="err">one</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">side</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">it.</span><span class="w"> </span><span class="err">We</span><span class="w"> </span><span class="err">insert</span><span class="w"> </span><span class="err">(x1,y1)</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">(x2,y2)</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">vector</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">2</span><span class="w"> </span><span class="err">into</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">equation</span><span class="w"> </span><span class="err">above.</span>
<span class="w">    </span><span class="err">d1</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">(a1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v2x1)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">(b1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v2y1)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">c1</span><span class="p">;</span>
<span class="w">    </span><span class="err">d2</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">(a1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v2x2)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">(b1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v2y2)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">c1</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">d1</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">d2</span><span class="w"> </span><span class="err">both</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">same</span><span class="w"> </span><span class="err">sign,</span><span class="w"> </span><span class="err">they</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">both</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">same</span><span class="w"> </span><span class="err">side</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">our</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">1</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">case</span><span class="w"> </span><span class="err">no</span><span class="w"> </span><span class="err">intersection</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">possible.</span><span class="w"> </span><span class="err">Careful,</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">0</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">special</span><span class="w"> </span><span class="err">case,</span><span class="w"> </span><span class="err">that's</span><span class="w"> </span><span class="err">why</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">don't</span><span class="w"> </span><span class="err">test</span><span class="w"> </span><span class="err">"&gt;="</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">"&lt;=",</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">but</span><span class="w"> </span><span class="err">"&lt;"</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">"&gt;".</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(d1</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">0</span><span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span><span class="err">d2</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">0)</span><span class="w"> </span><span class="err">return</span><span class="w"> </span><span class="err">NO</span><span class="p">;</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(d1</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="err">0</span><span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span><span class="err">d2</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="err">0)</span><span class="w"> </span><span class="err">return</span><span class="w"> </span><span class="err">NO</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">fact</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">vector</span><span class="w"> </span><span class="err">2</span><span class="w"> </span><span class="err">intersected</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">infinite</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">1</span><span class="w"> </span><span class="err">above</span><span class="w"> </span><span class="err">doesn't</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">mean</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">also</span><span class="w"> </span><span class="err">intersects</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">vector</span><span class="w"> </span><span class="err">1.</span><span class="w"> </span><span class="err">Vector</span><span class="w"> </span><span class="err">1</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">only</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">subset</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">that</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">infinite</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">1,</span><span class="w"> </span><span class="err">so</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">may</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">intersected</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">before</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">vector</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">started</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">ended.</span><span class="w"> </span><span class="err">To</span><span class="w"> </span><span class="err">know</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">sure,</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">repeat</span><span class="w"> </span><span class="err">the</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">same</span><span class="w"> </span><span class="err">test</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">way</span><span class="w"> </span><span class="err">round.</span><span class="w"> </span><span class="err">We</span><span class="w"> </span><span class="err">start</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">calculating</span><span class="w"> </span><span class="err">the</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">infinite</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">2</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">linear</span><span class="w"> </span><span class="err">equation</span><span class="w"> </span><span class="err">standard</span><span class="w"> </span><span class="err">form.</span>
<span class="w">    </span><span class="err">a2</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">v2y2</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">v2y1</span><span class="p">;</span>
<span class="w">    </span><span class="err">b2</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">v2x1</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">v2x2</span><span class="p">;</span>
<span class="w">    </span><span class="err">c2</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">(v2x2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v2y1)</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">(v2x1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v2y2)</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">Calculate</span><span class="w"> </span><span class="err">d1</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">d2</span><span class="w"> </span><span class="err">again,</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">time</span><span class="w"> </span><span class="err">using</span><span class="w"> </span><span class="err">points</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">vector</span><span class="w"> </span><span class="err">1.</span>
<span class="w">    </span><span class="err">d1</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">(a2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v1x1)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">(b2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v1y1)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">c2</span><span class="p">;</span>
<span class="w">    </span><span class="err">d2</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">(a2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v1x2)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">(b2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v1y2)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">c2</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">Again,</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">both</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">same</span><span class="w"> </span><span class="err">sign</span><span class="w"> </span><span class="err">(and</span><span class="w"> </span><span class="err">neither</span><span class="w"> </span><span class="err">one</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">0),</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">no</span><span class="w"> </span><span class="err">intersection</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">possible.</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(d1</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">0</span><span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span><span class="err">d2</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">0)</span><span class="w"> </span><span class="err">return</span><span class="w"> </span><span class="err">NO</span><span class="p">;</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(d1</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="err">0</span><span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span><span class="err">d2</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="err">0)</span><span class="w"> </span><span class="err">return</span><span class="w"> </span><span class="err">NO</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">get</span><span class="w"> </span><span class="err">here,</span><span class="w"> </span><span class="err">only</span><span class="w"> </span><span class="err">two</span><span class="w"> </span><span class="err">possibilities</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">left.</span><span class="w"> </span><span class="err">Either</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">two</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">vectors</span><span class="w"> </span><span class="err">intersect</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">exactly</span><span class="w"> </span><span class="err">one</span><span class="w"> </span><span class="err">point</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">they</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">collinear,</span><span class="w"> </span><span class="err">which</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">means</span><span class="w"> </span><span class="err">they</span><span class="w"> </span><span class="err">intersect</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">any</span><span class="w"> </span><span class="err">number</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">points</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">zero</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">infinite.</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">((a1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">b2)</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">(a2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">b1)</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="err">0.0f)</span><span class="w"> </span><span class="err">return</span><span class="w"> </span><span class="err">COLLINEAR</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">they</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">collinear,</span><span class="w"> </span><span class="err">they</span><span class="w"> </span><span class="err">must</span><span class="w"> </span><span class="err">intersect</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">exactly</span><span class="w"> </span><span class="err">one</span><span class="w"> </span><span class="err">point.</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">YES</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>输入值是向量 1（和）和向量 2（和）的 <em>两个端点</em> 。所以你有 2 个向量、4 个点、8
个坐标。并且很清楚。增加交叉点，什么都不做。<code>v1x1/v1y1``v1x2/v1y2``v2x1/v2y1``v2x2/v2y2``YES``NO``YES``NO</code></p>
<p>共线呢？这意味着两个向量位于同一条无限线上，取决于位置和长度，它们根本不相交或者它们相交于无数个点。我不确定如何处理这种情况，无论如何我都不会将其视为交集。好吧，由于浮点舍入错误，这种情况在实践中是相当罕见的；更好的代码可能不会测试<code>==
0.0f</code>，而是测试类似的东西<code>&lt; epsilon</code>，其中 epsilon 是一个相当小的数字。</p>
<p>如果您需要测试更多的点，您当然可以通过将多边形边的线性方程标准形式保存在内存中来加快整个过程，这样您就不必每次都重新计算这些。这将为您在每次测试中节省两次浮点乘法和三个浮点减法，以换取在内存中为每个多边形边存储三个浮点值。这是典型的内存与计算时间的权衡。</p>
<p>最后但同样重要的是：如果您可以使用 3D 硬件来解决问题，那么还有一个有趣的选择。让 GPU
为您完成所有工作。创建一个屏幕外的绘画表面。用黑色完全填充它。现在让 OpenGL 或 Direct3D
绘制您的多边形（如果您只想测试该点是否在其中任何一个内，甚至可以绘制所有多边形，但您不关心哪个多边形）并用不同的填充多边形颜色，例如白色。要检查一个点是否在多边形内，从绘图表面获取该点的颜色。这只是一次
O(1) 内存提取。</p>
<p>当然，这种方法只有在您的绘图表面不必很大时才可用。如果它不能放入 GPU 内存，则此方法比在 CPU 上执行要慢。如果它必须很大并且您的 GPU
支持现代着色器，您仍然可以通过将上面显示的光线投射实现为 GPU 着色器来使用
GPU，这绝对是可能的。对于大量的多边形或大量要测试的点，这会有所回报，考虑一些 GPU 将能够并行测试 64 到 256 个点。但是请注意，将数据从
CPU 传输到 GPU 并返回总是很昂贵，因此仅针对几个简单的多边形测试几个点，其中点或多边形是动态的并且会经常变化，GPU 方法很少支付离开。</p>
<p><br></p>
<h3>更多建议</h3>
<p>我认为以下代码是最好的解决方案（取自此处）：</p>
<div class="code"><pre class="code literal-block"><span class="nc">int</span><span class="w"> </span><span class="n">pnpoly</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">nvert</span><span class="p">,</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">*</span><span class="n">vertx</span><span class="p">,</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">*</span><span class="n">verty</span><span class="p">,</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="n">testx</span><span class="p">,</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="n">testy</span><span class="p">)</span>
<span class="err">{</span>
<span class="w">  </span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvert</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nvert</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">((</span><span class="n">verty</span><span class="o">[</span><span class="n">i</span><span class="o">]&gt;</span><span class="n">testy</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">verty</span><span class="o">[</span><span class="n">j</span><span class="o">]&gt;</span><span class="n">testy</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">     </span><span class="p">(</span><span class="n">testx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">vertx</span><span class="o">[</span><span class="n">j</span><span class="o">]-</span><span class="n">vertx</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">testy</span><span class="o">-</span><span class="n">verty</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">verty</span><span class="o">[</span><span class="n">j</span><span class="o">]-</span><span class="n">verty</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vertx</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">       </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">!</span><span class="n">c</span><span class="p">;</span>
<span class="w">  </span><span class="err">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="err">}</span>
</pre></div>

<h4>参数</h4>
<ul>
<li>
<strong>nvert</strong> ：多边形中的顶点数。是否重复最后的第一个顶点在上面提到的文章中已经讨论过。</li>
<li>
<strong>vertx, verty</strong> ：包含多边形顶点的 x 和 y 坐标的数组。</li>
<li>
<strong>testx, testy</strong> ：测试点的 X 和 y 坐标。</li>
</ul>
<p>它既简短又高效，适用于凸多边形和凹多边形。如前所述，您应该先检查边界矩形并单独处理多边形孔。</p>
<p>这背后的想法很简单。作者是这样描述的：</p>
<blockquote>
<p>我从测试点水平运行半无限射线（增加 x，固定 y），并计算它穿过多少条边。在每次交叉时，光线都会在内部和外部之间切换。这被称为若尔当曲线定理。</p>
</blockquote>
<p>每次水平光线穿过任何边缘时，变量 c 都会从 0 切换到 1，然后从 1 切换到 0。所以基本上它是在跟踪交叉边的数量是偶数还是奇数。0 表示偶数，1
表示奇数。</p>
<p><br><br><a href="../how-can-i-determine-whether-a-2d-point-is-within-a-polygon/">查看原文</a></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/collision-detection/" rel="tag">collision-detection</a></li>
            <li><a class="tag p-category" href="../../categories/graphics/" rel="tag">graphics</a></li>
            <li><a class="tag p-category" href="../../categories/performance/" rel="tag">performance</a></li>
            <li><a class="tag p-category" href="../../categories/point-in-polygon/" rel="tag">point-in-polygon</a></li>
            <li><a class="tag p-category" href="../../categories/polygon/" rel="tag">polygon</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../ru-he-rang-android-she-bei-zhen-dong-pin-lu-bu-tong/" rel="prev" title="如何让 Android 设备振动？频率不同？">Previous post</a>
            </li>
            <li class="next">
                <a href="../zai-gong-ju-lan-shang-xian-shi-hou-tui-jian-tou/" rel="next" title="在工具栏上显示后退箭头">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
