<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How to align two different pictures in such a way, that they match as close as possible? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-to-align-two-different-pictures-in-such-a-way-that-they-match-as-close-as-possible/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../proof-of-a-algorithm-s-optimality-when-heuristics-always-underestimates/" title="Proof of A* algorithm's optimality when heuristics always underestimates" type="text/html">
<link rel="next" href="../neural-network-in-javascript-not-learning-properly/" title="Neural network in Javascript not learning properly" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="How to align two different pictures in such a way, that they match as ">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-to-align-two-different-pictures-in-such-a-way-that-they-match-as-close-as-possible/">
<meta property="og:description" content="I need to automatically align an image B on top of another image A in
such a way, that the contents of the image match as good as possible.
The images can be shifted in x/y directions and rotated up t">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-28T03:22:19+08:00">
<meta property="article:tag" content="artificial-intelligence">
<meta property="article:tag" content="image-processing">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How to align two different pictures in such a way, that they match as close as possible?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T03:22:19+08:00" itemprop="datePublished" title="2023-02-28 03:22">2023-02-28 03:22</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I need to automatically align an image <strong>B</strong> on top of another image <strong>A</strong> in
such a way, that the contents of the image match as good as possible.</p>
<p>The images can be shifted in x/y directions and rotated up to 5 degrees on z,
but they won't be distorted (i.e. scaled or keystoned).</p>
<p>Maybe someone can recommend some good links or books on this topic, or share
some thoughts how such an alignment of images could be done.</p>
<p>If there wasn't the rotation problem, then I could simply try to compare rows
of pixels with a brute-force method until I find a match, and then I know the
offset and can align the image.</p>
<p>Do I need AI for this?</p>
<p>I'm having a hard time finding resources on image processing which go into
detail how these alignment-algorithms work.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>So what people often do in this case is first find points in the images that
match then compute the best transformation matrix with least squares. The
point matching is not particularly simple and often times you just use human
input for this task, you have to do it all the time for calibrating cameras.
Anyway, if you want to fully automate this process you can use feature
extraction techniques to find matching points, there are volumes of research
papers written on this topic and any standard computer vision text will have a
chapter on this. Once you have N matching points, solving for the least
squares transformation matrix is pretty straightforward and, again, can be
found in any computer vision text, so I'll assume you got that covered.</p>
<p>If you don't want to find point correspondences you could directly optimize
the rotation and translation using steepest descent, trouble is this is non-
convex so there are no guarantees you will find the correct transformation.
You could do random restarts or simulated annealing or any other global
optimization tricks on top of this, that would most likely work. I can't find
any references to this problem, but it's basically a digital image
stabilization algorithm I had to implement it when I took computer vision but
that was many years ago, here are the relevant slides though, look at
"stabilization revisited". Yes, I know those slides are terrible, I didn't
make them :) However, the method for determining the gradient is quite an
elegant one, since finite difference is clearly intractable.</p>
<p>Edit: I finally found the paper that went over how to do this here, it's a
really great paper and it explains the Lucas-Kanade algorithm very nicely.
Also, this site has a whole lot of material and source code on image alignment
that will probably be useful.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/artificial-intelligence/" rel="tag">artificial-intelligence</a></li>
            <li><a class="tag p-category" href="../../categories/image-processing/" rel="tag">image-processing</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../proof-of-a-algorithm-s-optimality-when-heuristics-always-underestimates/" rel="prev" title="Proof of A* algorithm's optimality when heuristics always underestimates">Previous post</a>
            </li>
            <li class="next">
                <a href="../neural-network-in-javascript-not-learning-properly/" rel="next" title="Neural network in Javascript not learning properly">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
