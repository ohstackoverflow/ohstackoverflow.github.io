<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Refresh image with a new one at the same url | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/refresh-image-with-a-new-one-at-the-same-url/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-to-make-http-request-in-swift/" title="How to make HTTP request in Swift?" type="text/html">
<link rel="next" href="../react-uncaught-typeerror-cannot-read-property-setstate-of-undefined/" title="React - uncaught TypeError: Cannot read property 'setState' of undefined" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Refresh image with a new one at the same url">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/refresh-image-with-a-new-one-at-the-same-url/">
<meta property="og:description" content="I am accessing a link on my site that will provide a new image each time it is
accessed.
The issue I am running into is that if I try to load the image in the
background and then update the one on the">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T13:08:57+08:00">
<meta property="article:tag" content="image">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="refresh">
<meta property="article:tag" content="url">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Refresh image with a new one at the same url</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T13:08:57+08:00" itemprop="datePublished" title="2023-03-03 13:08">2023-03-03 13:08</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I am accessing a link on my site that will provide a new image each time it is
accessed.</p>
<p>The issue I am running into is that if I try to load the image in the
background and then update the one on the page, the image doesn't change--
though it is updated when I reload the page.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">newImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Image</span><span class="p">();</span>
<span class="n">newImage</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://localhost/image.jpg"</span><span class="p">;</span>

<span class="n">function</span><span class="w"> </span><span class="n">updateImage</span><span class="p">()</span>
<span class="p">{</span>
<span class="k">if</span><span class="p">(</span><span class="n">newImage</span><span class="o">.</span><span class="n">complete</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s2">"theText"</span><span class="p">)</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newImage</span><span class="o">.</span><span class="n">src</span><span class="p">;</span>
<span class="w">    </span><span class="n">newImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Image</span><span class="p">();</span>
<span class="w">    </span><span class="n">number</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="n">newImage</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://localhost/image/id/image.jpg?time="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">();</span>
<span class="p">}</span>

<span class="w">    </span><span class="n">setTimeout</span><span class="p">(</span><span class="n">updateImage</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Headers as FireFox sees them:</p>
<div class="code"><pre class="code literal-block">HTTP/1.x 200 OK
Cache-Control: no-cache, must-revalidate
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: image/jpeg
Expires: Fri, 30 Oct 1998 14:19:41 GMT
Server: Microsoft-HTTPAPI/1.0
Date: Thu, 02 Jul 2009 23:06:04 GMT
</pre></div>

<p>I need to force a refresh of just that image on the page. Any ideas?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>What I ended up doing was having the server map any request for an image at
that directory to the source that I was trying to update. I then had my timer
append a number onto the end of the name so the DOM would see it as a new
image and load it.</p>
<p>E.g.</p>
<div class="code"><pre class="code literal-block">http://localhost/image.jpg
//and
http://localhost/image01.jpg
</pre></div>

<p>will request the same image generation code but it will look like different
images to the browser.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">newImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Image</span><span class="p">();</span>
<span class="n">newImage</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://localhost/image.jpg"</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">function</span><span class="w"> </span><span class="n">updateImage</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">newImage</span><span class="o">.</span><span class="n">complete</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s2">"theText"</span><span class="p">)</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newImage</span><span class="o">.</span><span class="n">src</span><span class="p">;</span>
<span class="w">        </span><span class="n">newImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Image</span><span class="p">();</span>
<span class="w">        </span><span class="n">newImage</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://localhost/image/id/image"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">count</span><span class="o">++</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">".jpg"</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">setTimeout</span><span class="p">(</span><span class="n">updateImage</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>I've seen a lot of variation in answers for how to do this, so I thought I'd
summarize them here (plus add a 4th method of my own invention):</p>
<hr>
<h3>(1) Add a unique cache-busting query parameter to the URL, such as:</h3>
<div class="code"><pre class="code literal-block"><span class="nv">newImage</span>.<span class="nv">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"image.jpg?t="</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Date</span><span class="ss">()</span>.<span class="k">getTime</span><span class="ss">()</span><span class="c1">;</span>
</pre></div>

<p><strong>Pros:</strong> 100% reliable, quick &amp; easy to understand and implement.</p>
<p><strong>Cons:</strong> Bypasses caching altogether, meaning unnecessary delays and
bandwidth use whenever the image <em>doesn't</em> change between views. Will
potentially fill browser cache (and any intermediate caches) with many, many
copies of exactly the same image! Also, requires modifying image URL.</p>
<p><strong>When to use:</strong> Use when image is constantly changing, such as for a live
webcam feed. If you use this method, <em>make sure to serve the images themselves
with<code>Cache-control: no-cache</code> HTTP headers!!!</em> (Often this can be set up using
a .htaccess file). Otherwise you'll be progressively filling caches up with
old versions of the image!</p>
<hr>
<h3>(2) Add query parameter to the URL that changes only when the file does,</h3>
<p>e.g.:</p>
<div class="code"><pre class="code literal-block">echo '&lt;img src="image.jpg?m=' . filemtime('image.jpg') . '"&gt;';
</pre></div>

<p>(That's PHP server-side code, but the important point here is just that a ?m=
<em>[file last-modified time]</em> querystring is appended to the filename).</p>
<p><strong>Pros:</strong> 100% reliable, quick &amp; easy to understand and implement, <em>and</em>
preserves caching advantages perfectly.</p>
<p><strong>Cons:</strong> Requires modifying the image URL. Also, a little more work for the
server - it has to get access to the file-last-modified time. Also, requires
server-side information, so not suitable for a purely client-side-only
solution to check for a refreshed image.</p>
<p><strong>When to use:</strong> When you want to cache images, but may need to update them at
the server end from time to time without changing the filename itself. AND
when you can easily ensure that the correct querystring is added to every
image instance in your HTML.</p>
<hr>
<h3>(3) Serve your images with the header `Cache-control: max-age=0, must-</h3>
<p>revalidate`, and add a unique <em>memcache</em> -busting fragment identifier to the
URL, such as:</p>
<div class="code"><pre class="code literal-block"><span class="nv">newImage</span>.<span class="nv">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"image.jpg#"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Date</span><span class="ss">()</span>.<span class="k">getTime</span><span class="ss">()</span><span class="c1">;</span>
</pre></div>

<p>The idea here is that the cache-control header puts images in the browser
cache, but immediately markes them stale, so that and every time they are re-
displayed the browser must check with the server to see if they've changed.
This ensures that the browser's <em>HTTP cache</em> always returns the latest copy of
the image. However, browsers will often re-use an in-memory copy of an image
if they have one, and not even check their HTTP cache in that case. To prevent
this, a fragment identifier is used: Comparison of in-memory image <code>src</code>'s
includes the fragment identifier, but it gets stripped of before querying the
HTTP cache. (So, e.g., <code>image.jpg#A</code> and <code>image.jpg#B</code> might both be displayed
from the <code>image.jpg</code> entry in the browser's HTTP cache, but <code>image.jpg#B</code>
would never be displayed using in-memory retained image data from when
<code>image.jpg#A</code> was last displayed).</p>
<p><strong>Pros:</strong> Makes proper use of HTTP caching mechanisms, and uses cached images
if they haven't changed. Works for servers that choke on a querystring added
to a static image URL (since servers never see fragment identifiers - they're
for the browsers' own use only).</p>
<p><strong>Cons:</strong> Relies on somewhat dubious (or at least poorly documented) behaviour
of browsers, in regard to images with fragment identifiers in their URLs
(However, I've tested this successfully in FF27, Chrome33, and IE11). Does
still send a revalidation request to the server for every image view, which
may be overkill if images only change rarely and/or latency is a big issue
(since you need to wait for the revalidation response even when the cached
image is still good). Requires modifying image URLs.</p>
<p><strong>When to use:</strong> Use when images may change frequently, or need to be
refreshed intermittently by the client without server-side script involvement,
but where you still want the advantage of caching. For example, polling a live
webcam that updates an image irregularly every few minutes. Alternatively, use
instead of (1) or (2) if your server doesn't allow querystrings on static
image URLs.</p>
<p><em><strong>[EDIT 2021: No longer works on recent Chrome &amp; Edge: The internal memcache
in those browsers now ignores fragment identifiers (maybe since the switch to
the Blink engine?). But see method (4) below, it's now MUCH easier on those
two browsers specifically, so consider combining this method with a simplified
version of (4) to cover those two browsers].</strong></em></p>
<hr>
<h3>(4) Forcibly refresh a particular image using Javascript, by first loading</h3>
<p>it into a hidden <code>&lt;iframe&gt;</code> and then calling <code>location.reload(true)</code> on the
iframe's <code>contentWindow</code>.</p>
<p>The steps are:</p>
<ul>
<li>
<p>Load the image to be refreshed into a hidden iframe. <em><strong>[EDIT 2021: For Chrome and Edge, load a HTML page with an<code>&lt;img&gt;</code> tag, not the raw image file].</strong></em> This is just a setup step - it can be done long in advance the actual refresh, if desired. It doesn't even matter if the image fails to load at this stage!</p>
</li>
<li>
<p><em><strong>[EDIT 2021: This step is now unnecessary in recent Chrome and Edge].</strong></em> Once that's done, blank out all copies of that image on your page(s) or anywhere in any DOM nodes (even off-page ones stored in javascript variables). This is necessary because the browser may otherwise display the image from a stale in-memory copy (IE11 especially does this): You need to ensure all <em>in-memory</em> copies are cleared, before refreshing the HTTP cache. If other javascript code is running asynchronously, you may also need to prevent that code from creating new copies of the to-be-refreshed image in the meantime.</p>
</li>
<li>
<p>Call <code>iframe.contentWindow.location.reload(true)</code>. The <code>true</code> forces a cache bypass, reloading directly from the server and overwriting the existing cached copy.</p>
</li>
<li>
<p><em><strong>[EDIT 2021: This step is now unnecessary in recent Chrome and Edge - on those browsers, existing images will just automatically update themselves after the previous step!]</strong></em> Once it's finished <em>re</em> -loading, restore the blanked images. They should now display the fresh version from the server!</p>
</li>
</ul>
<p>For same-domain images, you can load the image into the iframe directly.
<em><strong>[EDIT 2021: Not on Chrome, Edge].</strong></em> For cross-domain images, you have to
instead load a HTML page <em>from your domain</em> that contains the image in an
<code>&lt;img&gt;</code> tag, otherwise you'll get an "Access Denied" error when trying to call
<code>iframe.contentWindow.reload(...)</code>. <em><strong>[Do this for Chrome &amp; Edge also].</strong></em></p>
<p><strong>Pros:</strong> Works just like the image.reload() function you <em>wish</em> the DOM had!
Allows images to by cached normally (even with in-the-future expiry dates if
you want them, thus avoiding frequent revalidation). Allows you to refresh a
particular image without altering the URLs for that image on the current page,
or on any other pages, using only client-side code.</p>
<p><strong>Cons:</strong> Relies on Javascript. Not 100% guaranteed to work properly in every
browser (I've tested this successfully in FF27, Chrome33, and IE11 though).
Very complicated relative to the other methods. <em><strong>[EDIT 2021: Unless you only
need recent Chrome &amp; Edge support, in which case it's very much simpler].</strong></em></p>
<p><strong>When to use:</strong> When you have a collection of basically static images that
you'd like cached, but you still need to be able to update them occasionally
and get immediate visual feedback that the update took place. (Especially when
just refreshing the whole browser page wouldn't work, as in some web apps
built on AJAX for example). And when methods (1)-(3) aren't feasible because
(for whatever reason) you can't change all the URLs that might potentially
display the image you need to have updated. (Note that using those 3 methods
the image will be refreshed, but if <em>another</em> page then tries to displays that
image <em>without</em> the appropriate querystring or fragment identifier, it may
show an older version instead).</p>
<p>The details of implementing this in a fairy robust and flexible manner are
given below:</p>
<p>Let's assume your website contains a blank 1x1 pixel .gif at the URL path
<code>/img/1x1blank.gif</code>, and also has the following one-line PHP script (only
required for applying forced refresh to <em>cross-domain</em> images, and can be
rewritten in any server-side scripting language, of course) at the URL path
<code>/echoimg.php</code>:</p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="nx">img</span><span class="w"> </span><span class="nx">src</span><span class="o">=</span><span class="s2">"</span><span class="cp">&lt;?</span><span class="o">=</span><span class="nb">htmlspecialchars</span><span class="p">(</span><span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'src'</span><span class="p">],</span><span class="nx">ENT_COMPAT</span><span class="o">|</span><span class="nx">ENT_HTML5</span><span class="p">,</span><span class="s1">'UTF-8'</span><span class="p">)</span><span class="cp">?&gt;</span><span class="s2">"</span><span class="o">&gt;</span>
</pre></div>

<p>Then, here's a realistic implementation of how you might do all this in
Javascript. It looks a bit complicated, but there's a lot of comments, and the
important function is just forceImgReload() - the first two just blank and un-
blank images, and should be designed to work efficiently with your own HTML,
so code them as works best for you; much of the complications in them may be
unnecessary for your website:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">blank</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">images</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">changing</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">/</span><span class="n">img</span><span class="o">/</span><span class="mi">1</span><span class="n">x1blank</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span>
<span class="o">//</span><span class="w"> </span><span class="c1">##### You should code the actual contents of this function according to your page design, and what images there are on them!!! #####</span>
<span class="o">//</span><span class="w"> </span><span class="n">Optionally</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="p">(</span><span class="ow">or</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">structure</span><span class="p">)</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">those</span><span class="w"> </span><span class="n">images</span><span class="w"> </span><span class="n">affected</span><span class="o">.</span>
<span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">imgReloadRestore</span><span class="p">()</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">restore</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">later</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">that</span><span class="s1">'s an efficient way of doing it (otherwise, you don'</span><span class="n">t</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">anything</span><span class="p">)</span><span class="o">.</span>
<span class="o">//</span><span class="w"> </span><span class="n">NOTE</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="n">here</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">forceImgReload</span><span class="p">(),</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">MAY</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">relative</span><span class="w"> </span><span class="n">URI</span><span class="p">;</span>
<span class="o">//</span><span class="w"> </span><span class="n">However</span><span class="p">,</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">aware</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="s1">'re reading the src property of an &lt;img&gt; DOM object, you'</span><span class="n">ll</span><span class="w"> </span><span class="n">always</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">fully</span><span class="o">-</span><span class="n">qualified</span><span class="w"> </span><span class="n">URI</span><span class="p">,</span>
<span class="o">//</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="n">attribute</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">relative</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">original</span><span class="w"> </span><span class="n">HTML</span><span class="o">.</span><span class="w">  </span><span class="n">So</span><span class="w"> </span><span class="n">watch</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">compare</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">two</span><span class="o">!</span>
<span class="o">//</span><span class="w"> </span><span class="n">NOTE</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">design</span><span class="w"> </span><span class="n">makes</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">efficient</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">obtain</span><span class="w"> </span><span class="p">(</span><span class="n">say</span><span class="p">)</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">ids</span><span class="w"> </span><span class="p">(</span><span class="n">of</span><span class="w"> </span><span class="n">identical</span><span class="w"> </span><span class="n">images</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">first</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">src</span><span class="p">,</span>
<span class="o">//</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">pass</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">forceImgReload</span><span class="p">()</span><span class="w"> </span><span class="n">along</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="p">(</span><span class="ow">or</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">of</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="n">argument</span><span class="p">:</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">replacement</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">to</span>
<span class="o">//</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">function</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">imgReloadRestore</span><span class="p">(),</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">forceImgReload</span><span class="p">(),</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">anonymous</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">forceImgReload</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="ow">and</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">overwrite</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">earlier</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">forceImgReload</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">truthy</span><span class="p">),</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">appropriate</span><span class="o">.</span>
<span class="n">function</span><span class="w"> </span><span class="n">imgReloadBlank</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### Everything here is provisional on the way the pages are designed, and what images they contain; what follows is for example purposes only!</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### For really simple pages containing just a single image that's always the one being refreshed, this function could be as simple as just the one line:</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### document.getElementById("myImage").src = "/img/1x1blank.gif";</span>

<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">blankList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[],</span>
<span class="w">      </span><span class="n">fullSrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">/*</span><span class="w"> </span><span class="n">Fully</span><span class="w"> </span><span class="n">qualified</span><span class="w"> </span><span class="p">(</span><span class="n">absolute</span><span class="p">)</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="w"> </span><span class="n">prepend</span><span class="w"> </span><span class="n">protocol</span><span class="p">,</span><span class="w"> </span><span class="n">server</span><span class="o">/</span><span class="n">domain</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">present</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="o">*/</span><span class="p">,</span>
<span class="w">      </span><span class="n">imgs</span><span class="p">,</span><span class="w"> </span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="p">(</span><span class="o">/*</span><span class="w"> </span><span class="n">window</span><span class="w"> </span><span class="n">accessible</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="n">frames</span><span class="o">/</span><span class="n">iframes</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">parent</span><span class="w"> </span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="n">anything</span><span class="w"> </span><span class="n">opened</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">window</span><span class="o">.</span><span class="n">open</span><span class="p">(),</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">anything</span><span class="w"> </span><span class="n">recursively</span><span class="w"> </span><span class="n">reachable</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="o">*/</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="n">images</span><span class="p">:</span>
<span class="w">    </span><span class="n">imgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theWindow</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s2">"img"</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imgs</span><span class="o">.</span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">;)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imgs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">src</span><span class="o">===</span><span class="n">fullSrc</span><span class="p">)</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">body</span><span class="o">.</span><span class="n">querySelectorAll</span><span class="p">(),</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="n">attribute</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">would</span><span class="w"> </span><span class="n">probably</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">efficient</span><span class="p">,</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">supported</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">img</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/img/1x1blank.gif"</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">blank</span><span class="w"> </span><span class="n">them</span>
<span class="w">      </span><span class="n">blankList</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">img</span><span class="p">);</span><span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">optionally</span><span class="p">,</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">blanked</span><span class="w"> </span><span class="n">images</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">restoring</span><span class="w"> </span><span class="n">easy</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">on</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="p">(</span><span class="o">/*</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="n">DOM</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">held</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">javascript</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">image</span><span class="o">-</span><span class="n">caching</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="o">*/</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">src</span><span class="o">===</span><span class="n">fullSrc</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">img</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/img/1x1blank.gif"</span><span class="p">;</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">on</span><span class="o">-</span><span class="n">page</span><span class="w"> </span><span class="n">images</span><span class="o">!</span>
<span class="w">    </span><span class="n">blankList</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">img</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### If necessary, do something here that tells all accessible windows not to create any *new* images with src===fullSrc, until further notice,</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### (or perhaps to create them initially blank instead and add them to blankList).</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### For example, you might have (say) a global object window.top.blankedSrces as a propery of your topmost window, initially set = {}.  Then you could do:</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">#####</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">#####     var bs = window.top.blankedSrces;</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">#####     if (bs.hasOwnProperty(src)) bs[src]++; else bs[src] = 1;</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">#####</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### And before creating a new image using javascript, you'd first ensure that (blankedSrces.hasOwnProperty(src)) was false...</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### Note that incrementing a counter here rather than just setting a flag allows for the possibility that multiple forced-reloads of the same image are underway at once, or are overlapping.</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">blankList</span><span class="p">;</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">optional</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">blankList</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">restoring</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">blanked</span><span class="w"> </span><span class="n">images</span><span class="o">!</span><span class="w">  </span><span class="n">This</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">gets</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">imgReloadRestore</span><span class="p">(),</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">isn</span><span class="s1">'t used otherwise.</span>
<span class="p">}</span>




<span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">restores</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">blanked</span><span class="w"> </span><span class="n">images</span><span class="p">,</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">blanked</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">imgReloadBlank</span><span class="p">(</span><span class="n">src</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="n">argument</span><span class="o">.</span>
<span class="o">//</span><span class="w"> </span><span class="c1">##### You should code the actual contents of this function according to your page design, and what images there are on them, as well as how/if images are dimensioned, etc!!! #####</span>
<span class="n">function</span><span class="w"> </span><span class="n">imgReloadRestore</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">blankList</span><span class="p">,</span><span class="n">imgDim</span><span class="p">,</span><span class="n">loadError</span><span class="p">);</span>
<span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### Everything here is provisional on the way the pages are designed, and what images they contain; what follows is for example purposes only!</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### For really simple pages containing just a single image that's always the one being refreshed, this function could be as simple as just the one line:</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### document.getElementById("myImage").src = src;</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### if in imgReloadBlank() you did something to tell all accessible windows not to create any *new* images with src===fullSrc until further notice, retract that setting now!</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">##### For example, if you used the global object window.top.blankedSrces as described there, then you could do:</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">#####</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">#####     var bs = window.top.blankedSrces;</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="c1">#####     if (bs.hasOwnProperty(src)&amp;&amp;--bs[src]) return; else delete bs[src];  // return here means don't restore until ALL forced reloads complete.</span>

<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imgDim</span><span class="o">&amp;&amp;</span><span class="n">imgDim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imgDim</span><span class="o">&amp;&amp;</span><span class="n">imgDim</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">width</span><span class="p">)</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">"px"</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s2">"px"</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">loadError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="o">/*</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="p">,</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">couldn</span><span class="s1">'t load, e.g: src = "/img/brokenImg.jpg"; or alert("Couldn'</span><span class="n">t</span><span class="w"> </span><span class="n">refresh</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">server</span><span class="o">!</span><span class="s2">"); */}</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">saved</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="n">blankList</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">imgReloadBlank</span><span class="p">(),</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">restore</span><span class="p">:</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blankList</span><span class="o">.</span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">;)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="p">(</span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blankList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">width</span><span class="p">)</span><span class="w"> </span><span class="n">img</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="n">img</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">height</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>




<span class="o">//</span><span class="w"> </span><span class="n">Force</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">reloaded</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">bypassing</span><span class="o">/</span><span class="n">refreshing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cache</span><span class="o">.</span>
<span class="o">//</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">limitations</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">browser</span><span class="w"> </span><span class="n">API</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">actually</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">TWO</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">attempts</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">hidden</span><span class="w"> </span><span class="n">iframe</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">iframe</span><span class="o">.</span><span class="n">contentWindow</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span>
<span class="o">//</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">domain</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="w"> </span><span class="n">cross</span><span class="o">-</span><span class="n">domain</span><span class="w"> </span><span class="n">restrictions</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">effect</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">isCrossDomain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span><span class="p">,</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">crash</span><span class="o">!</span>
<span class="o">//</span><span class="w"> </span><span class="n">imgDim</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="mi">2</span><span class="o">-</span><span class="n">element</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="n">containing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="n">dimensions</span><span class="p">,</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">omitted</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">updated</span><span class="p">,</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">applicable</span><span class="o">.</span>
<span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="s2">"twostage"</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="bp">true</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">occur</span><span class="w"> </span><span class="n">immediately</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">function</span>
<span class="o">//</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="p">(</span><span class="bp">true</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">proceed</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="mi">2</span><span class="n">nd</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="p">(</span><span class="n">including</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">blank</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">reload</span><span class="w"> </span><span class="n">procedure</span><span class="p">),</span><span class="w"> </span><span class="bp">false</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">cancel</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">optional</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="n">imgDim</span><span class="o">.</span>
<span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">allows</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">early</span><span class="o">...</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">example</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">upload</span><span class="w"> </span><span class="p">(</span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="p">)</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="p">(</span><span class="n">then</span><span class="p">)</span><span class="w"> </span><span class="n">refresh</span><span class="o">.</span>
<span class="n">function</span><span class="w"> </span><span class="n">forceImgReload</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">isCrossDomain</span><span class="p">,</span><span class="w"> </span><span class="n">imgDim</span><span class="p">,</span><span class="w"> </span><span class="n">twostage</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">blankList</span><span class="p">,</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">                                </span><span class="o">//</span><span class="w"> </span><span class="n">step</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">started</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="nb">load</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">wait</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">proceeding</span><span class="w"> </span><span class="p">(</span><span class="n">twostage</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">only</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">started</span><span class="w"> </span><span class="n">forced</span><span class="w"> </span><span class="n">reload</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cancelled</span>
<span class="w">      </span><span class="n">iframe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">window</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="s2">"iframe"</span><span class="p">),</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">Hidden</span><span class="w"> </span><span class="n">iframe</span><span class="p">,</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nb">load</span><span class="o">+</span><span class="n">reload</span><span class="o">.</span>
<span class="w">      </span><span class="n">loadCallback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w">                          </span><span class="o">//</span><span class="w"> </span><span class="n">Callback</span><span class="w"> </span><span class="n">function</span><span class="p">,</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">iframe</span><span class="w"> </span><span class="nb">load</span><span class="o">+</span><span class="n">reload</span><span class="w"> </span><span class="n">completes</span><span class="w"> </span><span class="p">(</span><span class="ow">or</span><span class="w"> </span><span class="n">fails</span><span class="p">)</span><span class="o">.</span>
<span class="w">      </span><span class="p">{</span><span class="w">                                                   </span><span class="o">//</span><span class="w"> </span><span class="n">Will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">TWICE</span><span class="w"> </span><span class="n">unless</span><span class="w"> </span><span class="n">twostage</span><span class="o">-</span><span class="n">mode</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">cancelled</span><span class="o">.</span><span class="w"> </span><span class="p">(</span><span class="n">Once</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="nb">load</span><span class="p">,</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">reload</span><span class="p">)</span><span class="o">.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">step</span><span class="p">)</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">completed</span><span class="o">.</span><span class="w">  </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">doesn</span><span class="s1">'t actually matter if this load succeeded or not!</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">twostage</span><span class="p">)</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">wait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">twostage</span><span class="o">-</span><span class="n">mode</span><span class="w"> </span><span class="n">proceed</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">cancel</span><span class="p">;</span><span class="w"> </span><span class="n">don</span><span class="s1">'t do anything else just yet</span>
<span class="w">          </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">blankList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imgReloadBlank</span><span class="p">(</span><span class="n">src</span><span class="p">);</span><span class="w"> </span><span class="n">iframe</span><span class="o">.</span><span class="n">contentWindow</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">initiate</span><span class="w"> </span><span class="n">forced</span><span class="o">-</span><span class="n">reload</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">step</span><span class="o">===</span><span class="mi">2</span><span class="p">)</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">forced</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="nb">load</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">done</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">imgReloadRestore</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">blankList</span><span class="p">,</span><span class="n">imgDim</span><span class="p">,(</span><span class="n">e</span><span class="o">||</span><span class="n">window</span><span class="o">.</span><span class="n">event</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="o">===</span><span class="s2">"error"</span><span class="p">);</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">checks</span><span class="w"> </span><span class="n">whether</span><span class="w"> </span><span class="n">loadCallback</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s2">"load"</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s2">"error"</span><span class="w"> </span><span class="n">event</span><span class="o">.</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iframe</span><span class="o">.</span><span class="n">parentNode</span><span class="p">)</span><span class="w"> </span><span class="n">iframe</span><span class="o">.</span><span class="n">parentNode</span><span class="o">.</span><span class="n">removeChild</span><span class="p">(</span><span class="n">iframe</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">  </span><span class="n">iframe</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">;</span>
<span class="w">  </span><span class="n">window</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">appendChild</span><span class="p">(</span><span class="n">iframe</span><span class="p">);</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">NOTE</span><span class="p">:</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="n">AFTER</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="n">src</span><span class="p">,</span><span class="w"> </span><span class="n">Firefox</span><span class="w"> </span><span class="n">MAY</span><span class="w"> </span><span class="n">fail</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">fire</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">event</span><span class="o">!</span>
<span class="w">  </span><span class="n">iframe</span><span class="o">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="s2">"load"</span><span class="p">,</span><span class="n">loadCallback</span><span class="p">,</span><span class="bp">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">iframe</span><span class="o">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="s2">"error"</span><span class="p">,</span><span class="n">loadCallback</span><span class="p">,</span><span class="bp">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">iframe</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">isCrossDomain</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="s2">"/echoimg.php?src="</span><span class="o">+</span><span class="n">encodeURIComponent</span><span class="p">(</span><span class="n">src</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">src</span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">src</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">cross</span><span class="o">-</span><span class="n">domain</span><span class="p">,</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="n">unless</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">embed</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">same</span><span class="o">-</span><span class="n">domain</span><span class="w"> </span><span class="n">html</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="p">(</span><span class="n">using</span><span class="w"> </span><span class="n">server</span><span class="o">-</span><span class="n">side</span><span class="w"> </span><span class="n">script</span><span class="p">)</span><span class="o">!!!</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">twostage</span>
<span class="w">    </span><span class="err">?</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">proceed</span><span class="p">,</span><span class="n">dim</span><span class="p">)</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">twostage</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="n">twostage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">proceed</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">imgDim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">dim</span><span class="o">||</span><span class="n">imgDim</span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">overwrite</span><span class="w"> </span><span class="n">imgDim</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">forceImgReload</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">case</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">correct</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="n">dimensions</span><span class="w"> </span><span class="n">now</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">didn</span><span class="s1">'t when forceImgReload() was called.</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">step</span><span class="o">===</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">blankList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imgReloadBlank</span><span class="p">(</span><span class="n">src</span><span class="p">);</span><span class="w"> </span><span class="n">iframe</span><span class="o">.</span><span class="n">contentWindow</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="bp">true</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iframe</span><span class="o">.</span><span class="n">contentWindow</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span><span class="w"> </span><span class="n">iframe</span><span class="o">.</span><span class="n">contentWindow</span><span class="o">.</span><span class="n">stop</span><span class="p">();</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iframe</span><span class="o">.</span><span class="n">parentNode</span><span class="p">)</span><span class="w"> </span><span class="n">iframe</span><span class="o">.</span><span class="n">parentNode</span><span class="o">.</span><span class="n">removeChild</span><span class="p">(</span><span class="n">iframe</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Then, to force a refresh of an image located on the same domain as your page,
you can just do:</p>
<div class="code"><pre class="code literal-block"><span class="n">forceImgReload</span><span class="p">(</span><span class="s2">"myimage.jpg"</span><span class="p">);</span>
</pre></div>

<p>To refresh an image from somewhere else (cross-domain):</p>
<div class="code"><pre class="code literal-block"><span class="n">forceImgReload</span><span class="p">(</span><span class="s2">"http://someother.server.com/someimage.jpg"</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">);</span>
</pre></div>

<p>A more advanced application might be to reload an image after uploading a new
version to your server, preparing the initial stage of the reload process
simultaneous with the upload, to minimize the visible reload delay to the
user. If you're doing the upload via AJAX, and the server is returning a very
simple JSON array [success, width, height] then your code might look something
like this:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">fileForm</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">reference</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">&lt;</span><span class="n">input</span><span class="w"> </span><span class="n">typ</span><span class="o">=</span><span class="s2">"file"</span><span class="o">&gt;</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">uploading</span><span class="o">.</span>
<span class="o">//</span><span class="w"> </span><span class="n">serverURL</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">uploaded</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">accessible</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">uploaded</span><span class="o">.</span>
<span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">uploadImageToServer</span><span class="o">.</span><span class="n">php</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="p">[</span><span class="n">success</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">]</span><span class="o">.</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">ints</span><span class="p">)</span><span class="o">.</span>
<span class="n">function</span><span class="w"> </span><span class="n">uploadAndRefreshCache</span><span class="p">(</span><span class="n">fileForm</span><span class="p">,</span><span class="w"> </span><span class="n">serverURL</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">xhr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">XMLHttpRequest</span><span class="p">(),</span>
<span class="w">      </span><span class="n">proceedWithImageRefresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">forceImgReload</span><span class="p">(</span><span class="n">serverURL</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">);</span>
<span class="w">  </span><span class="n">xhr</span><span class="o">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="s2">"load"</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="k">var</span><span class="w"> </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xhr</span><span class="o">.</span><span class="n">responseText</span><span class="p">);</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">arr</span><span class="o">&amp;&amp;</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">proceedWithImageRefresh</span><span class="p">(</span><span class="bp">false</span><span class="p">);</span><span class="w"> </span><span class="n">doSomethingOnUploadFailure</span><span class="p">(</span><span class="o">...</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">proceedWithImageRefresh</span><span class="p">(</span><span class="bp">true</span><span class="p">,[</span><span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ar</span><span class="p">[</span><span class="mi">2</span><span class="p">]]);</span><span class="w"> </span><span class="n">doSomethingOnUploadSuccess</span><span class="p">(</span><span class="o">...</span><span class="p">);</span><span class="w"> </span><span class="p">}});</span>
<span class="w">  </span><span class="n">xhr</span><span class="o">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="s2">"error"</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">proceedWithImageRefresh</span><span class="p">(</span><span class="bp">false</span><span class="p">);</span><span class="w"> </span><span class="n">doSomethingOnUploadError</span><span class="p">(</span><span class="o">...</span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="n">xhr</span><span class="o">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="s2">"abort"</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="n">proceedWithImageRefresh</span><span class="p">(</span><span class="bp">false</span><span class="p">);</span><span class="w"> </span><span class="n">doSomethingOnUploadAborted</span><span class="p">(</span><span class="o">...</span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">additional</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="n">listener</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">track</span><span class="w"> </span><span class="n">upload</span><span class="w"> </span><span class="n">progress</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">graphical</span><span class="w"> </span><span class="n">progress</span><span class="w"> </span><span class="n">bar</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="o">...</span>
<span class="w">  </span><span class="n">xhr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"post"</span><span class="p">,</span><span class="s2">"uploadImageToServer.php"</span><span class="p">);</span>
<span class="w">  </span><span class="n">xhr</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">FormData</span><span class="p">(</span><span class="n">fileForm</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

<hr>
<p>A final note: Although this topic is about images, it potentially applies to
other kinds of files or resources also. For example, preventing the use of
stale script or css files, or perhaps even refreshing updated PDF documents
(using (4) only if set up to open in-browser). Method (4) might require some
changes to the above javascript, in these cases.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/image/" rel="tag">image</a></li>
            <li><a class="tag p-category" href="../../categories/javascript/" rel="tag">javascript</a></li>
            <li><a class="tag p-category" href="../../categories/refresh/" rel="tag">refresh</a></li>
            <li><a class="tag p-category" href="../../categories/url/" rel="tag">url</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-to-make-http-request-in-swift/" rel="prev" title="How to make HTTP request in Swift?">Previous post</a>
            </li>
            <li class="next">
                <a href="../react-uncaught-typeerror-cannot-read-property-setstate-of-undefined/" rel="next" title="React - uncaught TypeError: Cannot read property 'setState' of undefined">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
