<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>如何制作出色的 R 可重现示例 | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/ru-he-zhi-zuo-chu-se-de-r-ke-zhong-xian-shi-li/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../prop-yu-attr/" title=".prop() 与 .attr()" type="text/html">
<link rel="next" href="../shi-yao-shi-san-fa-ze/" title="什么是三法则？" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="如何制作出色的 R 可重现示例">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/ru-he-zhi-zuo-chu-se-de-r-ke-zhong-xian-shi-li/">
<meta property="og:description" content="这个问题的答案是 社区的努力。编辑现有答案以改进这篇文章。它目前不接受新的答案或互动。
在与同事讨论性能、教学、发送错误报告或在邮件列表和 Stack Overflow 上搜索指导时，经常会询问可重现的示例并且总是有帮助的。
创建优秀示例的技巧是什么？你如何粘贴数据结构r以文本格式？您还应该包括哪些其他信息？
除了使用dput(),dump()还是还有其他技巧吗structure()？什么时候应该">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-16T21:22:53+08:00">
<meta property="article:tag" content="r">
<meta property="article:tag" content="r-faq">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">如何制作出色的 R 可重现示例</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T21:22:53+08:00" itemprop="datePublished" title="2023-02-16 21:22">2023-02-16 21:22</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p><strong>这个问题的答案是 社区的努力</strong>。编辑现有答案以改进这篇文章。它目前不接受新的答案或互动。</p>
<p>在与同事讨论性能、教学、发送错误报告或在邮件列表和 Stack Overflow 上搜索指导时，经常会询问可重现的示例并且总是有帮助的。</p>
<p>创建优秀示例的技巧是什么？你如何粘贴数据结构r以文本格式？您还应该包括哪些其他信息？</p>
<p>除了使用<code>dput()</code>,<code>dump()</code>还是还有其他技巧吗<code>structure()</code>？什么时候应该包含<code>library()</code>or<code>require()</code>语句？除了<code>c</code>,
<code>df</code>, <code>data</code>, 等，还应该避免使用哪些保留字？</p>
<p>一个人如何成为伟大的r可重现的例子？</p>
<p><br><br></p>
<h2>解答</h2>
<p>基本上， <strong>最小可重现示例 (MRE)</strong> 应该能让其他人在他们的机器上 <em>准确重现您的问题。</em></p>
<p><strong>请不要发布您的数据、代码或控制台输出的图像！</strong></p>
<h2>tl；博士</h2>
<p>MRE 由以下项目组成：</p>
<ul>
<li>一个 <strong>最小的数据集</strong> ，是证明问题所必需的</li>
<li>重现问题所需的最小可运行代码，可以在给定数据 <strong>集 <em>上</em> 运行</strong>
</li>
<li>关于所使用的s、R 版本和它运行的操作系统的所有 <strong>必要信息，也许是</strong><code>library``sessionInfo()</code>
</li>
<li>在随机过程的情况下，一个 <strong>种子</strong> （由 设置<code>set.seed()</code>）使其他人能够复制与您完全相同的结果</li>
</ul>
<p>有关良好 MRE 的示例，请参阅您正在使用的函数的帮助页面底部的“示例”部分。只需在 R 控制台中键入 eg<code>help(mean)</code>或
short即可。<code>?mean</code></p>
<h2>提供最小数据集</h2>
<p>通常，共享庞大的数据集是没有必要的，而且可能会阻止其他人阅读您的问题。因此，最好使用内置数据集或创建一个类似于原始数据的小型“玩具”示例，这实际上就是
<em>minimal</em> 的意思。如果出于某种原因您确实需要共享您的原始数据，您应该使用一种方法，例如<code>dput()</code>允许其他人获得您的数据的精确副本。</p>
<h4>内置数据集</h4>
<p>您可以使用其中一个内置数据集。内置数据集的完整列表可以通过<code>data()</code>. 每个数据集都有一个简短的描述，并且可以获得更多信息，例如<code>?iris</code>，对于
R 附带的“iris”数据集。已安装的包可能包含其他数据集。</p>
<h4>创建示例数据集</h4>
<p><em>初步说明：</em> 有时您可能需要特殊格式（即类），例如因子、日期或时间序列。对于这些，请使用以下函数：<code>as.factor</code>, <code>as.Date</code>,
<code>as.xts</code>, ... <em>示例：</em></p>
<div class="code"><pre class="code literal-block"><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="s">"2020-12-30"</span><span class="p">)</span>
</pre></div>

<p>在哪里</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span>(<span class="nb">d</span>)
<span class="c1"># [1] "Date"</span>
</pre></div>

<p><strong>载体</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1">## random vector normal distributed</span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">runif</span><span class="p">(</span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1">## random vector uniformly distributed    </span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1">## 10 random draws out of 1, 2, ..., 100    </span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">  </span><span class="c1">## 10 random draws out of built-in latin alphabet</span>
</pre></div>

<p><strong>矩阵</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">dimnames</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="w"> </span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">]))</span>
<span class="n">m</span>
<span class="c1">#   A B C  D</span>
<span class="c1"># A 1 4 7 10</span>
<span class="c1"># B 2 5 8 11</span>
<span class="c1"># C 3 6 9 12</span>
</pre></div>

<p><strong>数据框</strong></p>
<div class="code"><pre class="code literal-block"><span class="nf">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span><span class="w">  </span><span class="c1">## for sake of reproducibility</span>
<span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">6</span>
<span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">,</span><span class="w"> </span>
<span class="w">                  </span><span class="n">date</span><span class="o">=</span><span class="nf">seq.Date</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="s">"2020-12-26"</span><span class="p">),</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="s">"2020-12-31"</span><span class="p">),</span><span class="w"> </span><span class="s">"day"</span><span class="p">),</span>
<span class="w">                  </span><span class="n">group</span><span class="o">=</span><span class="nf">rep</span><span class="p">(</span><span class="kc">LETTERS</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">n</span><span class="o">/</span><span class="m">2</span><span class="p">),</span>
<span class="w">                  </span><span class="n">age</span><span class="o">=</span><span class="nf">sample</span><span class="p">(</span><span class="m">18</span><span class="o">:</span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span>
<span class="w">                  </span><span class="n">type</span><span class="o">=</span><span class="nf">factor</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">"type"</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">)),</span>
<span class="w">                  </span><span class="n">x</span><span class="o">=</span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">dat</span>
<span class="c1">#   id       date group age   type         x</span>
<span class="c1"># 1  1 2020-12-26     A  27 type 1 0.0356312</span>
<span class="c1"># 2  2 2020-12-27     B  19 type 2 1.3149588</span>
<span class="c1"># 3  3 2020-12-28     A  20 type 3 0.9781675</span>
<span class="c1"># 4  4 2020-12-29     B  26 type 4 0.8817912</span>
<span class="c1"># 5  5 2020-12-30     A  26 type 5 0.4822047</span>
<span class="c1"># 6  6 2020-12-31     B  28 type 6 0.9657529</span>
</pre></div>

<p><strong>注意：</strong> 虽然它被广泛使用，但最好不要命名你的数据框<code>df</code>，因为它是F 分布的<code>df()</code>密度（即曲线在点处的高度）的 R
函数，你可能会与它发生冲突。<code>x</code></p>
<h4>复制原始数据</h4>
<p>如果您有特定原因，或者数据太难构建示例，您可以提供原始数据的一小部分，最好使用<code>dput</code>.</p>
<p><strong>为什么使用<code>dput()</code>？</strong></p>
<p><code>dput</code>抛出在控制台上准确重现数据所需的所有信息。您可以简单地复制输出并将其粘贴到您的问题中。</p>
<p><code>dat</code>如果您在问题中共享调用（从上面）产生的输出仍然缺少有关变量类和其他功能的信息。此外，列中的空格<code>type</code>使得很难对其进行任何操作。即使我们开始使用这些数据，我们也无法正确获取您数据的重要特征。</p>
<div class="code"><pre class="code literal-block">  id       date group age   type         x
1  1 2020-12-26     A  27 type 1 0.0356312
2  2 2020-12-27     B  19 type 2 1.3149588
3  3 2020-12-28     A  20 type 3 0.9781675
</pre></div>

<p><strong>子集你的数据</strong></p>
<p>要共享子集，请使用<code>head()</code>或<code>subset()</code>索引<code>iris[1:4, ]</code>。然后把它包起来<code>dput()</code>给其他人一些可以立即放入R的东西。
<em>例子</em></p>
<div class="code"><pre class="code literal-block">dput(iris[1:4, ]) # first four rows of the iris data set
</pre></div>

<p><em>控制台输出以分享您的问题：</em></p>
<div class="code"><pre class="code literal-block">structure(list(Sepal.Length = c(5.1, 4.9, 4.7, 4.6), Sepal.Width = c(3.5, 
3, 3.2, 3.1), Petal.Length = c(1.4, 1.4, 1.3, 1.5), Petal.Width = c(0.2, 
0.2, 0.2, 0.2), Species = structure(c(1L, 1L, 1L, 1L), .Label = c("setosa", 
"versicolor", "virginica"), class = "factor")), row.names = c(NA, 
4L), class = "data.frame")
</pre></div>

<p>使用 时<code>dput</code>，您可能还想只包含相关列，例如 dput(mtcars[1:3, c(2, 5, 6)])</p>
<p><strong>注意：</strong>
如果您的数据框具有多个级别的因子，则<code>dput</code>输出可能会很笨拙，因为它仍会列出所有可能的因子级别，即使它们不存在于您的数据子集中。要解决此问题，您可以使用该<code>droplevels()</code>功能。请注意下面的物种如何成为只有一个水平的因素，例如<code>dput(droplevels(iris[1:4,
]))</code>。另一个警告是它<code>dput</code>不适用于键控<code>data.table</code>对象或<code>tbl_df</code>来自.
在这些情况下，您可以在共享之前转换回常规数据框，.<code>grouped_df``tidyverse``dput(as.data.frame(my_data))</code></p>
<h2>生成最少的代码</h2>
<p>结合最少的数据（见上文），您的代码应该通过简单的复制和粘贴在另一台机器上准确地重现问题。</p>
<p>这应该是容易的部分，但通常不是。你不应该做什么：</p>
<ul>
<li>显示各种数据转换；确保提供的数据已经是正确的格式（当然，除非这是问题所在）</li>
<li>复制粘贴整个脚本，在某处给出错误。尝试找出导致错误的确切行。通常情况下，您会发现问题出在自己身上。</li>
</ul>
<p>你应该做什么：</p>
<ul>
<li>添加你使用的包，如果你使用任何（使用<code>library()</code>）</li>
<li>在新的 R 会话中测试运行您的代码，以确保代码可运行。人们应该能够在控制台中复制粘贴您的数据和代码，并获得与您相同的结果。</li>
<li>如果您打开连接或创建文件，请添加一些代码以关闭它们或删除文件（使用<code>unlink()</code>）</li>
<li>如果您更改选项，请确保代码包含将它们还原为原始选项的语句。（例如<code>op &lt;- par(mfrow=c(1,2)) ...some code... par(op)</code>）</li>
</ul>
<h2>提供必要的信息</h2>
<p>在大多数情况下，只需 R 版本和操作系统就足够了。当与包发生冲突时，提供
的输出<code>sessionInfo()</code>真的很有帮助。在谈论与其他应用程序的连接时（无论是通过 ODBC
还是其他任何方式），还应提供这些应用程序的版本号，如果可能，还应提供有关设置的必要信息。</p>
<p><em>如果您在R Studio</em> 中运行 R ，使用<code>rstudioapi::versionInfo()</code>可以帮助报告您的 RStudio 版本。</p>
<p>如果您对特定包有问题，您可能希望通过提供<code>packageVersion("name of the package")</code>.</p>
<h2>种子</h2>
<p>使用<code>set.seed()</code>您可以指定一个种子1，即特定状态，R
的随机数生成器是固定的。这使得随机函数（例如<code>sample()</code>、<code>rnorm()</code>和<code>runif()</code>许多其他函数）始终返回相同的结果成为可能，
<em>示例：</em></p>
<div class="code"><pre class="code literal-block">set.seed(42)
rnorm(3)
# [1]  1.3709584 -0.5646982  0.3631284

set.seed(42)
rnorm(3)
# [1]  1.3709584 -0.5646982  0.3631284
</pre></div>

<p>1 <strong>注意：</strong> R &gt;3.6.0 和之前版本的输出不同。指定您用于随机过程的 R
版本，如果您在遵循旧问题时得到略有不同的结果，请不要感到惊讶。要在这种情况下获得相同的结果，您可以在之前使用 -function （例如：）。
****<code>set.seed()``RNGversion()``set.seed()``RNGversion("3.5.2")</code></p>
<p><br></p>
<h3>更多建议</h3>
<p>（这是我从How to write a reproducible example中得到的建议。我试图让它简短但有趣）。</p>
<h2>如何编写可重现的示例</h2>
<p>如果您提供可重现的示例，您最有可能在解决 R 问题时得到很好的帮助。一个可重现的例子允许其他人通过复制和粘贴 R 代码来重现你的问题。</p>
<p>您需要包括四样东西才能使您的示例可重现：所需的包、数据、代码和 R 环境的描述。</p>
<ul>
<li>
<p><strong>包</strong> 应该在脚本的顶部加载，所以很容易看出示例需要哪些包。</p>
</li>
<li>
<p>在电子邮件或 Stack Overflow 问题中包含 <strong>数据的</strong><code>dput()</code>最简单方法是使用生成 R 代码来重新创建它。例如，要<code>mtcars</code>在 R 中重新创建数据集，我将执行以下步骤：</p>
<ol>
<li>
<code>dput(mtcars)</code>在 R 中运行</li>
<li>复制输出</li>
<li>在我的可重现脚本中，键入<code>mtcars &lt;-</code>然后粘贴。</li>
<li>
<p>花一点时间确保您的 <strong>代码</strong> 易于他人阅读：</p>
</li>
<li>
<p>确保您使用了空格并且您的变量名称简洁但信息丰富</p>
</li>
<li>
<p>使用评论指出您的问题所在</p>
</li>
<li>
<p>尽力删除与问题无关的所有内容。<br>
你的代码越短，就越容易理解。</p>
</li>
</ol>
</li>
<li>
<p><code>sessionInfo()</code>在代码的注释中包含 的输出。这总结了您的 <strong>R 环境</strong> ，并且可以轻松检查您是否使用了过时的包。</p>
</li>
</ul>
<p>您可以通过启动一个新的 R 会话并粘贴您的脚本来检查您是否确实制作了一个可重现的示例。</p>
<p>在将所有代码放入电子邮件之前，请考虑将其放在Gist github上。它会给你的代码很好的语法高亮显示，你不必担心任何东西被电子邮件系统破坏。</p>
<p><br><br><a href="../how-to-make-a-great-r-reproducible-example/">查看原文</a></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/r/" rel="tag">r</a></li>
            <li><a class="tag p-category" href="../../categories/r-faq/" rel="tag">r-faq</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../prop-yu-attr/" rel="prev" title=".prop() 与 .attr()">Previous post</a>
            </li>
            <li class="next">
                <a href="../shi-yao-shi-san-fa-ze/" rel="next" title="什么是三法则？">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
