<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How to detect when an Android app goes to the background and come back to the foreground | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-to-detect-when-an-android-app-goes-to-the-background-and-come-back-to-the-foreground/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../precision-string-format-specifier-in-swift/" title="Precision String Format Specifier In Swift" type="text/html">
<link rel="next" href="../how-to-uninstall-python-2-7-on-a-mac-os-x-10-6-4/" title="How to uninstall Python 2.7 on a Mac OS X 10.6.4?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="How to detect when an Android app goes to the background and come back">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-to-detect-when-an-android-app-goes-to-the-background-and-come-back-to-the-foreground/">
<meta property="og:description" content="I am trying to write an app that does something specific when it is brought
back to the foreground after some amount of time. Is there a way to detect
when an app is sent to the background or brought ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T12:41:00+08:00">
<meta property="article:tag" content="android">
<meta property="article:tag" content="background">
<meta property="article:tag" content="foreground">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How to detect when an Android app goes to the background and come back to the foreground</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T12:41:00+08:00" itemprop="datePublished" title="2023-03-03 12:41">2023-03-03 12:41</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I am trying to write an app that does something specific when it is brought
back to the foreground after some amount of time. Is there a way to detect
when an app is sent to the background or brought to the foreground?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The <code>onPause()</code> and <code>onResume()</code> methods are called when the application is
brought to the background and into the foreground again. However, they are
also called when the application is started for the first time and before it
is killed. You can read more in <em>Activity</em>.</p>
<p>There isn't any direct approach to get the application status while in the
background or foreground, but even I have faced this issue and found the
solution with <code>onWindowFocusChanged</code> and <code>onStop</code>.</p>
<p>For more details check here <em>Android: Solution to detect when an Android app
goes to the background and come back to the foreground without getRunningTasks
or getRunningAppProcesses</em>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Here's how I've managed to solve this. It works on the premise that using a
time reference between activity transitions will most likely provide adequate
evidence that an app has been "backgrounded" or not.</p>
<p>First, I've used an android.app.Application instance (let's call it
MyApplication) which has a Timer, a TimerTask, a constant to represent the
maximum number of milliseconds that the transition from one activity to
another could reasonably take (I went with a value of 2s), and a boolean to
indicate whether or not the app was "in the background":</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">MyApplication</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">Application</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">Timer</span><span class="w"> </span><span class="n">mActivityTransitionTimer</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">TimerTask</span><span class="w"> </span><span class="n">mActivityTransitionTimerTask</span><span class="p">;</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">boolean</span><span class="w"> </span><span class="n">wasInBackground</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">long</span><span class="w"> </span><span class="n">MAX_ACTIVITY_TRANSITION_TIME_MS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2000</span><span class="p">;</span>
<span class="w">    </span><span class="o">...</span>
</pre></div>

<p>The application also provides two methods for starting and stopping the
timer/task:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">startActivityTransitionTimer</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">this</span>.<span class="nv">mActivityTransitionTimer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Timer</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">this</span>.<span class="nv">mActivityTransitionTimerTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">TimerTask</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">public</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">run</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">MyApplication</span>.<span class="nv">this</span>.<span class="nv">wasInBackground</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">true</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">    </span>}<span class="c1">;</span>

<span class="w">    </span><span class="nv">this</span>.<span class="nv">mActivityTransitionTimer</span>.<span class="nv">schedule</span><span class="ss">(</span><span class="nv">mActivityTransitionTimerTask</span>,
<span class="w">                                           </span><span class="nv">MAX_ACTIVITY_TRANSITION_TIME_MS</span><span class="ss">)</span><span class="c1">;</span>
}

<span class="nv">public</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">stopActivityTransitionTimer</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">this</span>.<span class="nv">mActivityTransitionTimerTask</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">this</span>.<span class="nv">mActivityTransitionTimerTask</span>.<span class="nv">cancel</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">this</span>.<span class="nv">mActivityTransitionTimer</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">this</span>.<span class="nv">mActivityTransitionTimer</span>.<span class="nv">cancel</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="nv">this</span>.<span class="nv">wasInBackground</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">false</span><span class="c1">;</span>
}
</pre></div>

<p>The last piece of this solution is to add a call to each of these methods from
the onResume() and onPause() events of all activities or, preferably, in a
base Activity from which all of your concrete Activities inherit:</p>
<div class="code"><pre class="code literal-block"><span class="nv">@Override</span>
<span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onResume</span><span class="p">()</span>
<span class="err">{</span>
<span class="w">    </span><span class="n">super</span><span class="p">.</span><span class="n">onResume</span><span class="p">();</span>

<span class="w">    </span><span class="n">MyApplication</span><span class="w"> </span><span class="n">myApp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">MyApplication</span><span class="p">)</span><span class="n">this</span><span class="p">.</span><span class="n">getApplication</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">myApp</span><span class="p">.</span><span class="n">wasInBackground</span><span class="p">)</span>
<span class="w">    </span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="n">Do</span><span class="w"> </span><span class="k">specific</span><span class="w"> </span><span class="n">came</span><span class="o">-</span><span class="n">here</span><span class="o">-</span><span class="k">from</span><span class="o">-</span><span class="n">background</span><span class="w"> </span><span class="n">code</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="n">myApp</span><span class="p">.</span><span class="n">stopActivityTransitionTimer</span><span class="p">();</span>
<span class="err">}</span>

<span class="nv">@Override</span>
<span class="k">public</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onPause</span><span class="p">()</span>
<span class="err">{</span>
<span class="w">    </span><span class="n">super</span><span class="p">.</span><span class="n">onPause</span><span class="p">();</span>
<span class="w">    </span><span class="p">((</span><span class="n">MyApplication</span><span class="p">)</span><span class="n">this</span><span class="p">.</span><span class="n">getApplication</span><span class="p">()).</span><span class="n">startActivityTransitionTimer</span><span class="p">();</span>
<span class="err">}</span>
</pre></div>

<p>So in the case when the user is simply navigating between the activities of
your app, the onPause() of the departing activity starts the timer, but almost
immediately the new activity being entered cancels the timer before it can
reach the max transition time. And so <strong>wasInBackground</strong> would be <strong>false</strong>.</p>
<p>On the other hand when an Activity comes to the foreground from the Launcher,
device wake up, end phone call, etc., more than likely the timer task executed
prior to this event, and thus <strong>wasInBackground</strong> was set to <strong>true</strong>.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/android/" rel="tag">android</a></li>
            <li><a class="tag p-category" href="../../categories/background/" rel="tag">background</a></li>
            <li><a class="tag p-category" href="../../categories/foreground/" rel="tag">foreground</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../precision-string-format-specifier-in-swift/" rel="prev" title="Precision String Format Specifier In Swift">Previous post</a>
            </li>
            <li class="next">
                <a href="../how-to-uninstall-python-2-7-on-a-mac-os-x-10-6-4/" rel="next" title="How to uninstall Python 2.7 on a Mac OS X 10.6.4?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
