<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How to overcome "datetime.datetime not JSON serializable"? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-to-overcome-datetime-datetime-not-json-serializable/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-to-remove-the-space-between-inline-inline-block-elements/" title="How to remove the space between inline/inline-block elements?" type="text/html">
<link rel="next" href="../how-do-i-collapse-sections-of-code-in-visual-studio-code-for-windows/" title="How do I collapse sections of code in Visual Studio Code for Windows?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content='How to overcome "datetime.datetime not JSON serializable"?'>
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-to-overcome-datetime-datetime-not-json-serializable/">
<meta property="og:description" content="I have a basic dict as follows:
sample = {}
sample['title'] = &quot;String&quot;
sample['somedate'] = somedatetimehere


When I try to do jsonify(sample) I get:
TypeError: datetime.datetime(2012, 8, 8, 21, 46, ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T04:03:10+08:00">
<meta property="article:tag" content="json">
<meta property="article:tag" content="python">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How to overcome "datetime.datetime not JSON serializable"?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T04:03:10+08:00" itemprop="datePublished" title="2023-02-17 04:03">2023-02-17 04:03</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I have a basic dict as follows:</p>
<div class="code"><pre class="code literal-block">sample = {}
sample['title'] = "String"
sample['somedate'] = somedatetimehere
</pre></div>

<p>When I try to do <code>jsonify(sample)</code> I get:</p>
<div class="code"><pre class="code literal-block"><span class="n">TypeError</span><span class="o">:</span><span class="w"> </span><span class="n">datetime</span><span class="o">.</span><span class="na">datetime</span><span class="o">(</span><span class="mi">2012</span><span class="o">,</span><span class="w"> </span><span class="mi">8</span><span class="o">,</span><span class="w"> </span><span class="mi">8</span><span class="o">,</span><span class="w"> </span><span class="mi">21</span><span class="o">,</span><span class="w"> </span><span class="mi">46</span><span class="o">,</span><span class="w"> </span><span class="mi">24</span><span class="o">,</span><span class="w"> </span><span class="mi">862000</span><span class="o">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="n">serializable</span>
</pre></div>

<p>What can I do such that my dictionary sample can overcome the error above?</p>
<p><strong>Note:</strong> Though it may not be relevant, the dictionaries are generated from
the retrieval of records out of <code>mongodb</code> where when I print out
<code>str(sample['somedate'])</code>, the output is <code>2012-08-08 21:46:24.862000</code>.</p>
<p><br><br></p>
<h2>Answer</h2>
<h2>Updated for 2018</h2>
<p>The original answer accommodated the way MongoDB "date" fields were
represented as:</p>
<p><code>{"$date": 1506816000000}</code></p>
<p>If you want a generic Python solution for serializing <code>datetime</code> to json,
check out @jjmontes' answer for a quick solution which requires no
dependencies.</p>
<hr>
<p>As you are using mongoengine (per comments) and pymongo is a dependency,
pymongo has built-in utilities to help with json serialization:<br>
http://api.mongodb.org/python/1.10.1/api/bson/json_util.html</p>
<p>Example usage (serialization):</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">bson</span> <span class="kn">import</span> <span class="n">json_util</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">anObject</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">json_util</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
</pre></div>

<p>Example usage (deserialization):</p>
<div class="code"><pre class="code literal-block"><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">aJsonString</span><span class="p">,</span><span class="w"> </span><span class="n">object_hook</span><span class="o">=</span><span class="n">json_util</span><span class="o">.</span><span class="n">object_hook</span><span class="p">)</span>
</pre></div>

<hr>
<h3>Django</h3>
<p>Django provides a native <code>DjangoJSONEncoder</code> serializer that deals with this
kind of properly.</p>
<p>See
https://docs.djangoproject.com/en/dev/topics/serialization/#djangojsonencoder</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">django.core.serializers.json</span> <span class="kn">import</span> <span class="n">DjangoJSONEncoder</span>

<span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
  <span class="n">item</span><span class="p">,</span>
  <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
  <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
  <span class="bp">cls</span><span class="o">=</span><span class="n">DjangoJSONEncoder</span>
<span class="p">)</span>
</pre></div>

<p>One difference I've noticed between <code>DjangoJSONEncoder</code> and using a custom
<code>default</code> like this:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

<span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
  <span class="n">item</span><span class="p">,</span>
  <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
  <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
  <span class="n">default</span><span class="o">=</span><span class="n">default</span>
<span class="p">)</span>
</pre></div>

<p>Is that Django strips a bit of the data:</p>
<div class="code"><pre class="code literal-block"> "last_login": "2018-08-03T10:51:42.990", # DjangoJSONEncoder 
 "last_login": "2018-08-03T10:51:42.990239", # default
</pre></div>

<p>So, you may need to be careful about that in some cases.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Building on other answers, a simple solution based on a specific serializer
that just converts <code>datetime.datetime</code> and <code>datetime.date</code> objects to strings.</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>

<span class="k">def</span> <span class="nf">json_serial</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""JSON serializer for objects not serializable by default json code"""</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="n">date</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="k">raise</span> <span class="ne">TypeError</span> <span class="p">(</span><span class="s2">"Type </span><span class="si">%s</span><span class="s2"> not serializable"</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
</pre></div>

<p>As seen, the code just checks to find out if object is of class
<code>datetime.datetime</code> or <code>datetime.date</code>, and then uses <code>.isoformat()</code> to
produce a serialized version of it, according to ISO 8601 format, YYYY-MM-
DDTHH:MM:SS (which is easily decoded by JavaScript). If more complex
serialized representations are sought, other code could be used instead of
str() (see other answers to this question for examples). The code ends by
raising an exception, to deal with the case it is called with a non-
serializable type.</p>
<p>This json_serial function can be used as follows:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">dumps</span>

<span class="nb">print</span> <span class="n">dumps</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="n">json_serial</span><span class="p">)</span>
</pre></div>

<p>The details about how the default parameter to json.dumps works can be found
in Section Basic Usage of the json module documentation.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/json/" rel="tag">json</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-to-remove-the-space-between-inline-inline-block-elements/" rel="prev" title="How to remove the space between inline/inline-block elements?">Previous post</a>
            </li>
            <li class="next">
                <a href="../how-do-i-collapse-sections-of-code-in-visual-studio-code-for-windows/" rel="next" title="How do I collapse sections of code in Visual Studio Code for Windows?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
