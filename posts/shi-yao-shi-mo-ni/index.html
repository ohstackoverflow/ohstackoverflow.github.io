<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>什么是模拟？ | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/shi-yao-shi-mo-ni/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../ru-he-zai-wo-de-cheng-xu-beng-kui-shi-zi-dong-sheng-cheng-dui-zhan-gen-zong/" title="如何在我的程序崩溃时自动生成堆栈跟踪" type="text/html">
<link rel="next" href="../wo-ying-gai-ru-he-chu-li-package-xxx-is-not-available-for-r-version-xyz-jing-gao/" title="我应该如何处理“package 'xxx' is not available (for R version xyz)”警告？" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="什么是模拟？">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/shi-yao-shi-mo-ni/">
<meta property="og:description" content="什么是模拟？.

解答
序言：如果你查字典里的名词 mock， 你会发现这个词的其中一个定义是 something made as an imitation 。

模拟主要用于单元测试。被测对象可能依赖于其他（复杂）对象。为了隔离您要测试的对象的行为，您可以用模拟真实对象行为的模拟来替换其他对象。如果将真实对象合并到单元测试中是不切实际的，这将很有用。
简而言之，模拟就是创建模拟真实对象行为的对象">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T18:32:08+08:00">
<meta property="article:tag" content="mocking">
<meta property="article:tag" content="unit-testing">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">什么是模拟？</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T18:32:08+08:00" itemprop="datePublished" title="2023-02-17 18:32">2023-02-17 18:32</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>什么是模拟？.</p>
<p><br><br></p>
<h2>解答</h2>
<p>序言：如果你查字典里的名词 <em>mock，</em> 你会发现这个词的其中一个定义是 <em>something made as an imitation</em> 。</p>
<hr>
<p>模拟主要用于单元测试。被测对象可能依赖于其他（复杂）对象。为了隔离您要测试的对象的行为，您可以用模拟真实对象行为的模拟来替换其他对象。如果将真实对象合并到单元测试中是不切实际的，这将很有用。</p>
<p>简而言之，模拟就是创建模拟真实对象行为的对象。</p>
<hr>
<p>有时您可能想要区分 <em>mocking</em> 和 <em>stubbing</em>
。关于这个主题可能会有一些分歧，但我对存根的定义是“最小”模拟对象。存根实现的行为刚好足以让被测对象执行测试。</p>
<p>模拟类似于存根，但测试还将验证被测对象是否按预期调用了模拟。测试的一部分是验证模拟是否被正确使用。</p>
<p>举个例子：你可以通过实现一个简单的内存结构来存储记录来存根数据库。然后被测对象可以读取记录并将记录写入数据库存根以允许它执行测试。这可以测试与数据库无关的对象的一些行为，并且将包含数据库存根只是为了让测试运行。</p>
<p>相反，如果您想要验证被测对象是否将某些特定数据写入数据库，则必须模拟数据库。然后，您的测试将包含关于写入数据库模拟的内容的断言。</p>
<p><br></p>
<h3>更多建议</h3>
<p>其他答案解释了什么是嘲笑。 <em>让我用不同的例子</em> 向您介绍它。相信我，它实际上比您想象的要简单得多。</p>
<p><strong>tl;dr</strong> 它是原始类的一个实例。它注入了其他数据，因此您可以避免测试注入的部分，而只 <em>专注</em> 于测试类/函数的 <strong>实现细节。</strong></p>
<h2>简单示例：</h2>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">func</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="p">(</span><span class="n">num1</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="p">,</span><span class="w"> </span><span class="n">num2</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Int</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Line</span><span class="w"> </span><span class="n">A</span><span class="w"> </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">num1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">num2</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Line</span><span class="w"> </span><span class="n">B</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">let</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">under</span><span class="w"> </span><span class="n">test</span>
<span class="n">assertEqual</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">6</span><span class="p">)</span>
</pre></div>

<p>如您所见，我没有测试 LineA，即我没有验证输入参数。我没有验证 num1、num2 是否为整数。我对此没有断言。</p>
<p>我只是在测试 LineB（我的 <em>实现</em> ）是否给出了模拟值<code>1</code>并且<code>5</code>是否按照我的预期进行。</p>
<p>显然，在现实中这会变得更加复杂。参数可以是自定义对象，如 Person、Address，或者实现细节可以是多个<code>+</code>. 但是测试的逻辑是一样的。</p>
<h3>非编码示例：</h3>
<p>假设您正在构建一台机器来识别用于机场安检的电子设备的类型和品牌名称。机器通过处理它用相机看到的东西来做到这一点。</p>
<p>现在你的经理走进门，要求你对它进行单元测试。</p>
<p>然后，作为开发人员，您可以将 1000 个真实对象（如 MacBook pro、Google Nexus、香蕉、iPad
等）放在它前面，然后测试它是否一切正常。</p>
<p>但您也可以使用 <strong>模拟</strong> 对象，例如外观相同的 MacBook pro（没有真正的内部零件）或它前面的塑料香蕉。您可以避免投资 1000
台真正的笔记本电脑和腐烂的香蕉。</p>
<p>关键是你不是要测试香蕉是不是假的。也没有测试笔记本电脑是否是假的。您所做的只是测试您的机器是否在看到香蕉后会说，<code>not an electronic
device</code>而对于 MacBook Pro，它会说：<code>Laptop,
Apple</code>。对于机器来说，其检测结果对于伪造/模拟电子设备和真实电子设备应该是相同的。如果您的机器还考虑了笔记本电脑（X
射线扫描）或香蕉的内部结构，那么您的模拟机内部结构也需要看起来相同。但您也可以使用不再工作的 MacBook。</p>
<p>如果您的机器测试了设备是否可以开机，那么您需要真正的设备。</p>
<p>上面提到的逻辑也适用于实际代码的单元测试。也就是说，函数应该与您从真实 <em>输入</em> （和交互）中获得的真实值或您在单元测试期间注入的 <em>模拟值一样工作。</em>
就像你如何避免使用真正的香蕉或 MacBook 一样，通过单元测试（和模拟）你可以避免做一些导致服务器返回 500、403、200
等状态代码的事情（强制您的服务器仅在服务器关闭时触发 500，而 200 是在服务器启动时触发。</p>
<p>如果您必须在服务器启动和关闭之间不断等待 10 秒，则很难运行 100 个以网络为中心的测试）。因此，您可以注入/模拟状态代码为 500、200、403
等的响应，并使用注入/模拟值测试您的单元/函数。</p>
<p><strong>意识到：</strong></p>
<p>有时您没有正确模拟实际对象。或者你不嘲笑每一种可能性。例如，你的假笔记本电脑是黑色的，你的机器可以准确地与它们一起工作，但它不能准确地与 <em>白色</em>
假笔记本电脑一起工作。稍后当您将这台机器运送给客户时，他们会抱怨它不能一直工作。您收到随机报告说它不起作用。您需要 3
个月的时间才能弄清楚假冒笔记本电脑的颜色需要更多样，以便您可以适当地测试您的模块。</p>
<p>对于真实的编码示例，对于返回图像数据的状态代码 200 和未返回图像数据的状态代码 200，您的实现可能有所不同。出于这个原因，最好使用提供代码覆盖率的
IDE ，例如下图显示您的单元测试永远不会通过标有 <em>brown</em> 的行。</p>
<p><img alt="在此处输入图像描述" src="../../images/ias4p.jpg"></p>
<p>图片来源</p>
<h3>真实世界的编码示例：</h3>
<p>假设您正在编写一个 iOS 应用程序并进行网络调用。您的工作是测试 <em>您的</em>
应用程序。测试/确定网络呼叫是否按预期工作不是您的责任。测试它是另一方（服务器团队）的责任。您必须删除此（网络）依赖项，然后继续测试 <em>围绕</em>
它工作的所有代码。</p>
<p>网络调用可以通过 JSON 响应返回不同的状态代码 404、500、200、303 等。</p>
<p>您的应用程序应该适用于 <em>所有</em> 这些（如果出现错误，您的应用程序应该抛出预期的错误）。您使用 mocking
所做的是创建“假想的——类似于真实的”网络响应（例如带有 JSON 文件的 200 代码）并测试您的代码，而 <em>无需</em>
“进行真实的网络调用并等待您的网络响应”。您手动硬编码/返回所有类型网络响应的网络响应，并查看您的应用程序是否按预期工作。（你 <em>永远不会</em>
用不正确的数据假设/测试 200，因为那不是你的责任，你的责任是用正确的 200 测试 <em>你的</em> 应用程序，或者在 400、500
的情况下，你测试你的应用程序是否抛出正确的错误）</p>
<p>这种创造虚构的——类似于真实的东西被称为模拟。</p>
<p>为此，您 <strong>不能</strong> 使用原始代码（您的原始代码没有预先插入的响应，对吗？）。您 <strong>必须</strong>
向其中添加一些东西，注入/插入通常不需要的虚拟数据（或您班级的一部分）。</p>
<p>因此，您创建了一个原始类的实例，并添加了您需要的任何内容（这里是网络 HTTPResponse、数据，或者在失败的情况下，您传递了正确的
errorString、HTTPResponse），然后测试模拟 <em>类</em> 。</p>
<p>长话短说，模拟是为了 <em>简化</em> 和 <em>限制</em> 您正在测试的内容，并让您提供类所依赖的内容。在这个例子中，你 <strong>避免测试</strong> 网络 <strong>调用本身</strong> ，而是
<strong>测试</strong> 你的应用程序是否像你期望的那样 <strong>使用注入的输出/响应</strong> ——通过 <em>模拟</em> 类</p>
<p>不用说，您可以分别测试每个网络响应。</p>
<hr>
<p>现在我一直在想的一个问题是：合同/端点和基本上我的 API 的 JSON 响应不断更新。我如何编写考虑到这一点的单元测试？</p>
<p>对此进行详细说明：假设模型需要一个名为<code>username</code>. 你测试这个并且你的测试通过。2 周后后端将密钥的名称更改为<code>id</code>.
您的测试仍然通过。正确的？或不？</p>
<p>更新模拟是后端开发人员的责任吗？他们提供更新的模拟是否应该成为我们协议的一部分？</p>
<p>上述问题的答案是：单元测试+您作为客户端开发人员的开发过程应该/会捕获过时的模拟响应。如果你问我如何？那么答案是：</p>
<p>如果不使用更新的
API，我们实际的应用程序会失败（或没有失败但没有所需的行为）......因此如果失败......我们将对我们的开发代码进行更改。这再次导致我们的测试失败......我们必须纠正它。（实际上，如果我们要正确地执行
TDD 过程，我们就不会编写任何关于该字段的代码，除非我们为它编写测试......并且看到它失败然后去为它编写实际的开发代码。）</p>
<p>这一切都意味着后端不必说：“嘿，我们更新了模拟”……它 <em>最终</em>
会通过您的代码开发/调试发生。‌ّ因为这是开发过程的一部分！尽管如果后端为您提供模拟响应，那么它会更容易。</p>
<p>我的全部观点是（如果你不能自动获取更新的模拟 API 响应）可能需要人工交互，即手动 <strong>更新</strong> JSON
和召开简短会议以确保它们的值是最新的将成为你流程的一部分</p>
<p>本节的编写得益于我们 CocoaHead 聚会小组中的闲散讨论</p>
<h3>困惑：</h3>
<p>我花了一段时间才不混淆“类的单元测试”和“类的存根/模拟”。例如，在我们的代码库中，我们有：</p>
<ul>
<li>类设备</li>
<li>类 DeviceTests</li>
<li>模拟设备类</li>
<li>类设备管理器</li>
</ul>
<hr>
<ul>
<li>
<code>class Device</code>是实际的类本身。</li>
<li>
<code>class DeviceTests``Device</code>是我们为课程编写单元测试的地方</li>
<li>
<code>class MockDevice</code> is a <em>mock</em> class of <code>Device</code>. We use it only for the purpose of testing. e.g. if our <code>DeviceManager</code> needs to get <em>unit-tested</em> then we need dummy/mock instances of the <code>Device</code> class. The <code>MockDevice</code> can be used to fulfill the need of dummy/mock instances.</li>
</ul>
<p>tldr you use mock classes/objects to test <em>other</em> objects. You don't use mock
objects to test themselves.</p>
<hr>
<p><strong>For iOS devs only:</strong></p>
<p>A very good example of mocking is this Practical Protocol-Oriented talk by
Natasha Muraschev. Just skip to minute 18:30, though the slides may become out
of sync with the actual video 🤷‍♂️</p>
<p>I really like this part from the transcript:</p>
<blockquote>
<p>Because this is testing...we do want to make sure that the <code>get</code> function
from the <code>Gettable</code> is called, <strong>because it can return and the function
could theoretically assign an array of food items from anywhere</strong>. We need
to make sure that it is called;</p>
</blockquote>
<p><br><br><a href="../what-is-mocking/">查看原文</a></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/mocking/" rel="tag">mocking</a></li>
            <li><a class="tag p-category" href="../../categories/unit-testing/" rel="tag">unit-testing</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../ru-he-zai-wo-de-cheng-xu-beng-kui-shi-zi-dong-sheng-cheng-dui-zhan-gen-zong/" rel="prev" title="如何在我的程序崩溃时自动生成堆栈跟踪">Previous post</a>
            </li>
            <li class="next">
                <a href="../wo-ying-gai-ru-he-chu-li-package-xxx-is-not-available-for-r-version-xyz-jing-gao/" rel="next" title="我应该如何处理“package 'xxx' is not available (for R version xyz)”警告？">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
