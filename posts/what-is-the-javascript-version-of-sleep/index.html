<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>What is the JavaScript version of sleep()? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/what-is-the-javascript-version-of-sleep/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-do-i-loop-through-or-enumerate-a-javascript-object/" title="How do I loop through or enumerate a JavaScript object?" type="text/html">
<link rel="next" href="../what-is-init-py-for/" title="What is __init__.py for?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="What is the JavaScript version of sleep()?">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/what-is-the-javascript-version-of-sleep/">
<meta property="og:description" content="Is there a better way to engineer a sleep in JavaScript than the following
pausecomp function (taken from here)?
function pausecomp(millis)
{
    var date = new Date();
    var curDate = null;
    do ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-16T19:34:54+08:00">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="sleep">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">What is the JavaScript version of sleep()?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T19:34:54+08:00" itemprop="datePublished" title="2023-02-16 19:34">2023-02-16 19:34</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>Is there a better way to engineer a <code>sleep</code> in JavaScript than the following
<code>pausecomp</code> function (taken from here)?</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="nf">pausecomp</span><span class="p">(</span>millis<span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nb">var</span><span class="w"> </span><span class="nb">date</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">();</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="s">curDate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">null</span><span class="p">;</span>
<span class="w">    </span><span class="n">do</span><span class="w"> </span><span class="s">{</span><span class="w"> </span><span class="s">curDate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Date</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">curDate</span><span class="o">-</span><span class="nb">date</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">millis</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>This is not a duplicate of Sleep in JavaScript - delay between actions; I want
a <em>real sleep</em> in the middle of a function, and not a delay before a piece of
code executes.</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>2017 — 2021 update</h3>
<p>Since 2009 when this question was asked, JavaScript has evolved significantly.
All other answers are now obsolete or overly complicated. Here is the current
best practice:</p>
<div class="code"><pre class="code literal-block"><span class="nv">function</span><span class="w"> </span><span class="nv">sleep</span><span class="ss">(</span><span class="nv">ms</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Promise</span><span class="ss">(</span><span class="nv">resolve</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">setTimeout</span><span class="ss">(</span><span class="nv">resolve</span>,<span class="w"> </span><span class="nv">ms</span><span class="ss">))</span><span class="c1">;</span>
}
</pre></div>

<p>Or as a one-liner:</p>
<div class="code"><pre class="code literal-block">await new Promise(r =&gt; setTimeout(r, 2000));
</pre></div>

<p>As a function:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Promise</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">setTimeout</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">ms</span><span class="p">));</span>
</pre></div>

<p>or in Typescript:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ms</span><span class="p">:</span><span class="w"> </span><span class="n">number</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Promise</span><span class="p">((</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">setTimeout</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">ms</span><span class="p">));</span>
</pre></div>

<p>use it as:</p>
<div class="code"><pre class="code literal-block">await sleep(&lt;duration&gt;);
</pre></div>

<h4>Demo:</h4>
<div class="code"><pre class="code literal-block">function<span class="w"> </span>sleep(ms)<span class="w"> </span>{
<span class="w">    </span>return<span class="w"> </span>new<span class="w"> </span>Promise(resolve<span class="w"> </span>=&gt;<span class="w"> </span>setTimeout(resolve,<span class="w"> </span>ms));
}

async<span class="w"> </span>function<span class="w"> </span>demo()<span class="w"> </span>{
<span class="w">    </span>for<span class="w"> </span>(let<span class="w"> </span>i<span class="w"> </span>=<span class="w"> </span>0;<span class="w"> </span>i<span class="w"> </span><span class="nt">&lt; 5</span><span class="err">;</span> <span class="err">i++)</span> <span class="err">{</span>
        <span class="err">console.log(`Waiting</span> <span class="err">${i}</span> <span class="err">seconds...`);</span>
        <span class="err">await</span> <span class="err">sleep(i</span> <span class="err">*</span> <span class="err">1000);</span>
    <span class="err">}</span>
    <span class="err">console.log('Done');</span>
<span class="err">}</span>

<span class="err">demo();</span>
</pre></div>

<p>Note that,</p>
<ol>
<li>
<code>await</code> can only be executed in functions prefixed with the <code>async</code> keyword, or at the top level of your script in an increasing number of environments.</li>
<li>
<code>await</code> only pauses the current <code>async</code> function. This means it does not block the execution of the rest of the script, which is what you want in the vast majority of the cases. If you do want a blocking construct, see this answer using <code>Atomics``.wait</code>, but note that most browsers will not allow it on the browser's main thread.</li>
</ol>
<p>Two new JavaScript features (as of 2017) helped write this "sleep" function:</p>
<ul>
<li>Promises, a native feature of ES2015 (aka ES6). We also use arrow functions in the definition of the sleep function.</li>
<li>The <code>async/await</code> feature lets the code explicitly wait for a promise to settle (resolve or reject).</li>
</ul>
<h3>Compatibility</h3>
<ul>
<li>promises are supported in Node v0.12+ and widely supported in browsers, except IE</li>
<li>
<code>async</code>/<code>await</code> landed in V8 and has been enabled by default since Chrome 55 (released in Dec 2016) <ul>
<li>it landed in Node 7 in October 2016</li>
<li>and also landed in Firefox Nightly in November 2016</li>
</ul>
</li>
</ul>
<p>If for some reason you're using Node older than 7 (which reached end of life
in 2017), or are targeting old browsers, <code>async</code>/<code>await</code> can still be used via
Babel (a tool that will transpile JavaScript + new features into plain old
JavaScript), with the <code>transform-async-to-generator</code> plugin.</p>
<p><br></p>
<h3>Suggest</h3>
<p>(See the updated answer for 2016)</p>
<p>I think it's perfectly reasonable to want to perform an action, wait, and then
perform another action. If you are used to writing in multi-threaded
languages, you probably have the idea of yielding execution for a set amount
of time until your thread wakes up.</p>
<p>The issue here is that JavaScript is a single-thread event-based model. While
in a specific case, it might be nice to have the whole engine wait for a few
seconds, in general it is bad practice. Suppose I wanted to make use of your
functions while writing my own? When I called your method, my methods would
all freeze up. If JavaScript could somehow preserve your function's execution
context, store it somewhere, then bring it back and continue later, then sleep
could happen, but that would basically be threading.</p>
<p>So you are pretty much stuck with what others have suggested -- you'll need to
break your code up into multiple functions.</p>
<p>Your question is a bit of a false choice, then. There is no way to sleep in
the way you want, nor should you pursue the solution you suggest.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/javascript/" rel="tag">javascript</a></li>
            <li><a class="tag p-category" href="../../categories/sleep/" rel="tag">sleep</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-do-i-loop-through-or-enumerate-a-javascript-object/" rel="prev" title="How do I loop through or enumerate a JavaScript object?">Previous post</a>
            </li>
            <li class="next">
                <a href="../what-is-init-py-for/" rel="next" title="What is __init__.py for?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
