<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Relative imports for the billionth time | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/relative-imports-for-the-billionth-time/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-do-i-show-my-global-git-configuration/" title="How do I show my global Git configuration?" type="text/html">
<link rel="next" href="../how-to-directly-initialize-a-hashmap-in-a-literal-way/" title="How to directly initialize a HashMap (in a literal way)?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Relative imports for the billionth time">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/relative-imports-for-the-billionth-time/">
<meta property="og:description" content="I've been here:

http://www.python.org/dev/peps/pep-0328/
http://docs.python.org/2/tutorial/modules.html#packages
Python packages: relative imports
python relative import example code does not work
Re">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T01:41:42+08:00">
<meta property="article:tag" content="import">
<meta property="article:tag" content="python">
<meta property="article:tag" content="python-packaging">
<meta property="article:tag" content="relative-import">
<meta property="article:tag" content="relative-path">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Relative imports for the billionth time</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T01:41:42+08:00" itemprop="datePublished" title="2023-02-17 01:41">2023-02-17 01:41</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I've been here:</p>
<ul>
<li>http://www.python.org/dev/peps/pep-0328/</li>
<li>http://docs.python.org/2/tutorial/modules.html#packages</li>
<li>Python packages: relative imports</li>
<li>python relative import example code does not work</li>
<li>Relative imports in python 2.5</li>
<li>Relative imports in Python</li>
<li>Python: Disabling relative import</li>
</ul>
<p>and plenty of URLs that I did not copy, some on SO, some on other sites, back
when I thought I'd have the solution quickly.</p>
<p>The forever-recurring question is this: how do I solve this "Attempted
relative import in non-package" message?</p>
<div class="code"><pre class="code literal-block"><span class="ne">ImportError</span><span class="p">:</span> <span class="n">attempted</span> <span class="n">relative</span> <span class="kn">import</span> <span class="nn">with</span> <span class="n">no</span> <span class="n">known</span> <span class="n">parent</span> <span class="n">package</span>
</pre></div>

<p>I built an exact replica of the package on pep-0328:</p>
<div class="code"><pre class="code literal-block">package/
    __init__.py
    subpackage1/
        __init__.py
        moduleX.py
        moduleY.py
    subpackage2/
        __init__.py
        moduleZ.py
    moduleA.py
</pre></div>

<p>The imports were done from the console.</p>
<p>I did make functions named spam and eggs in their appropriate modules.
Naturally, it didn't work. The answer is apparently in the 4th URL I listed,
but it's all alumni to me. There was this response on one of the URLs I
visited:</p>
<blockquote>
<p>Relative imports use a module's name attribute to determine that module's
position in the package hierarchy. If the module's name does not contain any
package information (e.g. it is set to 'main') then relative imports are
resolved as if the module were a top level module, regardless of where the
module is actually located on the file system.</p>
</blockquote>
<p>The above response looks promising, but it's all hieroglyphs to me. So my
question, how do I make Python not return to me "Attempted relative import in
non-package"? has an answer that involves -m, supposedly.</p>
<p>Can somebody please tell me why Python gives that error message, what it means
by "non-package", why and how do you define a 'package', and <em>the precise
answer put in terms easy enough for a kindergartener to understand</em>.</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>Script vs. Module</strong></p>
<p>Here's an explanation. The short version is that there is a big difference
between directly running a Python file, and importing that file from somewhere
else. <strong>Just knowing what directory a file is in does not determine what
package Python thinks it is in.</strong> That depends, additionally, on how you load
the file into Python (by running or by importing).</p>
<p>There are two ways to load a Python file: as the top-level script, or as a
module. A file is loaded as the top-level script if you execute it directly,
for instance by typing <code>python myfile.py</code> on the command line. It is loaded as
a module when an <code>import</code> statement is encountered inside some other file.
There can only be one top-level script at a time; the top-level script is the
Python file you ran to start things off.</p>
<p><strong>Naming</strong></p>
<p>When a file is loaded, it is given a name (which is stored in its <code>__name__</code>
attribute).</p>
<ul>
<li>If it was loaded as the top-level script, its name is <code>__main__</code>.</li>
<li>If it was loaded as a module, its name is [ the filename, preceded by the names of any packages/subpackages of which it is a part, separated by dots ], for example, <code>package.subpackage1.moduleX</code>.</li>
</ul>
<p>But be aware, if you load <code>moduleX</code> as a module from shell command line using
something like <code>python -m package.subpackage1.moduleX</code>, the <code>__name__</code> will
still be <code>__main__</code>.</p>
<p>So for instance in your example:</p>
<div class="code"><pre class="code literal-block">package/
    __init__.py
    subpackage1/
        __init__.py
        moduleX.py
    moduleA.py
</pre></div>

<p>if you imported <code>moduleX</code> (note: <em>imported</em> , not directly executed), its name
would be <code>package.subpackage1.moduleX</code>. If you imported <code>moduleA</code>, its name
would be <code>package.moduleA</code>. However, if you <em>directly run</em> <code>moduleX</code> from the
command line, its name will instead be <code>__main__</code>, and if you directly run
<code>moduleA</code> from the command line, its name will be <code>__main__</code>. When a module is
run as the top-level script, it loses its normal name and its name is instead
<code>__main__</code>.</p>
<p><strong>Accessing a module NOT through its containing package</strong></p>
<p>There is an additional wrinkle: the module's name depends on whether it was
imported "directly" from the directory it is in or imported via a package.
This only makes a difference if you run Python in a directory, and try to
import a file in that same directory (or a subdirectory of it). For instance,
if you start the Python interpreter in the directory <code>package/subpackage1</code> and
then do <code>import moduleX</code>, the name of <code>moduleX</code> will just be <code>moduleX</code>, and
not <code>package.subpackage1.moduleX</code>. This is because Python adds the current
directory to its search path when the interpreter is entered interactively; if
it finds the to-be-imported module in the current directory, it will not know
that that directory is part of a package, and the package information will not
become part of the module's name.</p>
<p>A special case is if you run the interpreter interactively (e.g., just type
<code>python</code> and start entering Python code on the fly). In this case, the name of
that interactive session is <code>__main__</code>.</p>
<p>Now here is the crucial thing for your error message: <strong>if a module's name has
no dots, it is not considered to be part of a package</strong>. It doesn't matter
where the file actually is on disk. All that matters is what its name is, and
its name depends on how you loaded it.</p>
<p>Now look at the quote you included in your question:</p>
<blockquote>
<p>Relative imports use a module's name attribute to determine that module's
position in the package hierarchy. If the module's name does not contain any
package information (e.g. it is set to 'main') then relative imports are
resolved as if the module were a top-level module, regardless of where the
module is actually located on the file system.</p>
</blockquote>
<p><strong>Relative imports...</strong></p>
<p>Relative imports use the module's <em>name</em> to determine where it is in a
package. When you use a relative import like <code>from .. import foo</code>, the dots
indicate to step up some number of levels in the package hierarchy. For
instance, if your current module's name is <code>package.subpackage1.moduleX</code>, then
<code>..moduleA</code> would mean <code>package.moduleA</code>. For a <code>from .. import</code> to work, the
module's name must have at least as many dots as there are in the <code>import</code>
statement.</p>
<p><strong>... are only relative in a package</strong></p>
<p>However, if your module's name is <code>__main__</code>, it is not considered to be in a
package. Its name has no dots, and therefore you cannot use <code>from .. import</code>
statements inside it. If you try to do so, you will get the "relative-import
in non-package" error.</p>
<p><strong>Scripts can't import relative</strong></p>
<p>What you probably did is you tried to run <code>moduleX</code> or the like from the
command line. When you did this, its name was set to <code>__main__</code>, which means
that relative imports within it will fail, because its name does not reveal
that it is in a package. Note that this will also happen if you run Python
from the same directory where a module is, and then try to import that module,
because, as described above, Python will find the module in the current
directory "too early" without realizing it is part of a package.</p>
<p>Also remember that when you run the interactive interpreter, the "name" of
that interactive session is always <code>__main__</code>. Thus <strong>you cannot do relative
imports directly from an interactive session</strong>. Relative imports are only for
use within module files.</p>
<p><strong>Two solutions:</strong></p>
<ol>
<li>
<p>If you really do want to run <code>moduleX</code> directly, but you still want it to be considered part of a package, you can do <code>python -m package.subpackage1.moduleX</code>. The <code>-m</code> tells Python to load it as a module, not as the top-level script.</p>
</li>
<li>
<p>Or perhaps you don't actually want to <em>run</em> <code>moduleX</code>, you just want to run some other script, say <code>myfile.py</code>, that <em>uses</em> functions inside <code>moduleX</code>. If that is the case, put <code>myfile.py</code> <em>somewhere else</em> – <em>not</em> inside the <code>package</code> directory – and run it. If inside <code>myfile.py</code> you do things like <code>from package.moduleA import spam</code>, it will work fine.</p>
</li>
</ol>
<p><strong>Notes</strong></p>
<ul>
<li>
<p>For either of these solutions, the package directory (<code>package</code> in your example) must be accessible from the Python module search path (<code>sys.path</code>). If it is not, you will not be able to use anything in the package reliably at all.</p>
</li>
<li>
<p>Since Python 2.6, the module's "name" for package-resolution purposes is determined not just by its <code>__name__</code> attributes but also by the <code>__package__</code> attribute. That's why I'm avoiding using the explicit symbol <code>__name__</code> to refer to the module's "name". Since Python 2.6 a module's "name" is effectively <code>__package__ + '.' + __name__</code>, or just <code>__name__</code> if <code>__package__</code> is <code>None</code>.)</p>
</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>This is really a problem within python. <strong>The origin of confusion is that
people mistakenly takes the relative import as path relative which is not.</strong></p>
<p>For example when you write in <em>faa.py</em> :</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">foo</span>
</pre></div>

<p>This has a meaning only if <em>faa.py</em> was <em>identified and loaded</em> by python,
during execution, as a part of a package. In that case,the <strong>module's name</strong>
for <em>faa.py</em> would be for example <em>some_packagename.faa</em>. If the file was
loaded just because it is in the current directory, when python is run, then
its name would not refer to any package and eventually relative import would
fail.</p>
<p>A simple solution to refer modules in the current directory, is to use this:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span> <span class="n">__package__</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">__package__</span> <span class="o">==</span> <span class="s1">''</span><span class="p">:</span>
    <span class="c1"># uses current directory visibility</span>
    <span class="kn">import</span> <span class="nn">foo</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># uses current package visibility</span>
    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">foo</span>
</pre></div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/import/" rel="tag">import</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/python-packaging/" rel="tag">python-packaging</a></li>
            <li><a class="tag p-category" href="../../categories/relative-import/" rel="tag">relative-import</a></li>
            <li><a class="tag p-category" href="../../categories/relative-path/" rel="tag">relative-path</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-do-i-show-my-global-git-configuration/" rel="prev" title="How do I show my global Git configuration?">Previous post</a>
            </li>
            <li class="next">
                <a href="../how-to-directly-initialize-a-hashmap-in-a-literal-way/" rel="next" title="How to directly initialize a HashMap (in a literal way)?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
