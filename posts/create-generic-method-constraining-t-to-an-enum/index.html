<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Create Generic method constraining T to an Enum | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/create-generic-method-constraining-t-to-an-enum/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-to-align-content-of-a-div-to-the-bottom/" title="How to align content of a div to the bottom" type="text/html">
<link rel="next" href="../how-to-do-case-insensitive-string-comparison/" title="How to do case insensitive string comparison?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Create Generic method constraining T to an Enum">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/create-generic-method-constraining-t-to-an-enum/">
<meta property="og:description" content="I'm building a function to extend the Enum.Parse concept that

Allows a default value to be parsed in case that an Enum value is not found
Is case insensitive

So I wrote the following:
public static ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T02:41:23+08:00">
<meta property="article:tag" content=".net-c#">
<meta property="article:tag" content="enums">
<meta property="article:tag" content="generic-constraints">
<meta property="article:tag" content="generics">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Create Generic method constraining T to an Enum</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T02:41:23+08:00" itemprop="datePublished" title="2023-02-17 02:41">2023-02-17 02:41</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I'm building a function to extend the <code>Enum.Parse</code> concept that</p>
<ul>
<li>Allows a default value to be parsed in case that an Enum value is not found</li>
<li>Is case insensitive</li>
</ul>
<p>So I wrote the following:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">GetEnumFromString</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">(</span><span class="nv">string</span><span class="w"> </span><span class="nv">value</span>,<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">defaultValue</span><span class="ss">)</span><span class="w"> </span><span class="nv">where</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span>:<span class="w"> </span><span class="nv">Enum</span>
{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">string</span>.<span class="nv">IsNullOrEmpty</span><span class="ss">(</span><span class="nv">value</span><span class="ss">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">defaultValue</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">foreach</span><span class="w"> </span><span class="ss">(</span><span class="nv">T</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">Enum</span>.<span class="nv">GetValues</span><span class="ss">(</span><span class="nv">typeof</span><span class="ss">(</span><span class="nv">T</span><span class="ss">)))</span>
<span class="w">    </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">item</span>.<span class="nv">ToString</span><span class="ss">()</span>.<span class="k">ToLower</span><span class="ss">()</span>.<span class="nv">Equals</span><span class="ss">(</span><span class="nv">value</span>.<span class="nv">Trim</span><span class="ss">()</span>.<span class="k">ToLower</span><span class="ss">()))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">item</span><span class="c1">;</span>
<span class="w">    </span>}
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">defaultValue</span><span class="c1">;</span>
}
</pre></div>

<p>I am getting a Error Constraint cannot be special class <code>System.Enum</code>.</p>
<p>Fair enough, but is there a workaround to allow a Generic Enum, or am I going
to have to mimic the <code>Parse</code> function and pass a type as an attribute, which
forces the ugly boxing requirement to your code.</p>
<p><strong>EDIT</strong> All suggestions below have been greatly appreciated, thanks.</p>
<p>Have settled on (I've left the loop to maintain case insensitivity - I am
using this when parsing XML)</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">EnumUtils</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">ParseEnum</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">)</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">struct</span><span class="p">,</span><span class="w"> </span><span class="n">IConvertible</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nb">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">IsEnum</span><span class="p">)</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ArgumentException</span><span class="p">(</span><span class="s2">"T must be an enumerated type"</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>

<span class="w">        </span><span class="n">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Enum</span><span class="o">.</span><span class="n">GetValues</span><span class="p">(</span><span class="nb">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">)))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">ToString</span><span class="p">()</span><span class="o">.</span><span class="n">ToLower</span><span class="p">()</span><span class="o">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">Trim</span><span class="p">()</span><span class="o">.</span><span class="n">ToLower</span><span class="p">()))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">item</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><strong>EDIT:</strong> (16th Feb 2015) Christopher Currens has posted a compiler enforced
type-safe generic solution in MSIL or F# below, which is well worth a look,
and an upvote. I will remove this edit if the solution bubbles further up the
page.</p>
<p><strong>EDIT 2:</strong> (13th Apr 2021) As this has now been addressed, and supported,
since C# 7.3, I have changed the accepted answer, though full perusal of the
top answers is worth it for academic, and historical, interest :)</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>This feature is finally supported in C# 7.3!</h3>
<p>The following snippet (from the dotnet samples) demonstrates how:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="nb nb-Type">int</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">EnumNamedValues</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Enum</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="nb nb-Type">int</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enum</span><span class="o">.</span><span class="n">GetValues</span><span class="p">(</span><span class="nb">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">));</span>

<span class="w">    </span><span class="n">foreach</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">values</span><span class="p">)</span>
<span class="w">        </span><span class="n">result</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="n">Enum</span><span class="o">.</span><span class="n">GetName</span><span class="p">(</span><span class="nb">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="n">item</span><span class="p">));</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Be sure to set your language version in your C# project to version 7.3.</p>
<hr>
<p>Original Answer below:</p>
<p>I'm late to the game, but I took it as a challenge to see how it could be
done. It's not possible in C# (or VB.NET, but scroll down for F#), but <em>is
possible</em> in MSIL. I wrote this little....thing</p>
<div class="code"><pre class="code literal-block"><span class="err">//</span><span class="w"> </span><span class="nv">license</span><span class="p">:</span><span class="w"> </span><span class="nv">http</span><span class="p">:</span><span class="err">//www</span><span class="p">.</span><span class="err">apache</span><span class="p">.</span><span class="err">org/licenses/L</span><span class="kt">IC</span><span class="err">EN</span><span class="kt">S</span><span class="err">E</span><span class="p">-</span><span class="mf">2.0</span><span class="p">.</span>html
<span class="p">.</span>assembly<span class="w"> </span><span class="err">MyThing</span><span class="p">{}</span>
<span class="k">.class</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span>sealed<span class="w"> </span><span class="err">MyThing</span><span class="p">.</span><span class="err">Thing</span>
<span class="w">       </span>extends<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="err">Object</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">.method</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="err">!!T</span><span class="w">  </span><span class="err">GetEnum</span><span class="kt">F</span><span class="err">rom</span><span class="kt">S</span><span class="err">tring&lt;</span>valuetype<span class="w"> </span><span class="p">.</span>ctor<span class="w"> </span><span class="p">(</span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="err">Enum</span><span class="p">)</span><span class="w"> </span><span class="err">T&gt;</span><span class="p">(</span>string<span class="w"> </span><span class="err">str</span><span class="kt">V</span><span class="err">alue</span><span class="p">,</span>
<span class="w">                                                                                          </span><span class="err">!!T</span><span class="w"> </span><span class="err">default</span><span class="kt">V</span><span class="err">alue</span><span class="p">)</span><span class="w"> </span>cil<span class="w"> </span>managed
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="p">.</span>maxstack<span class="w">  </span><span class="mi">2</span>
<span class="w">    </span><span class="k">.locals</span><span class="w"> </span>init<span class="w"> </span><span class="p">(</span><span class="kt">[</span><span class="mi">0</span><span class="err">]</span><span class="w"> </span><span class="err">!!T</span><span class="w"> </span><span class="err">temp</span><span class="p">,</span>
<span class="w">                  </span><span class="kt">[</span><span class="mi">1</span><span class="err">]</span><span class="w"> </span><span class="err">!!T</span><span class="w"> </span><span class="err">return_value</span><span class="p">,</span>
<span class="w">                  </span><span class="kt">[</span><span class="mi">2</span><span class="err">]</span><span class="w"> </span>class<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="kt">C</span><span class="err">ollections</span><span class="p">.</span><span class="kt">I</span><span class="err">Enumerator</span><span class="w"> </span><span class="k">enum</span><span class="err">erator</span><span class="p">,</span>
<span class="w">                  </span><span class="kt">[</span><span class="mi">3</span><span class="err">]</span><span class="w"> </span>class<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="kt">ID</span><span class="err">isposable</span><span class="w"> </span><span class="err">disposer</span><span class="p">)</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="nf">if</span><span class="p">(</span><span class="err">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="err">str</span><span class="kt">V</span><span class="err">alue</span><span class="p">))</span><span class="w"> </span>return<span class="w"> </span><span class="err">default</span><span class="kt">V</span><span class="err">alue;</span>
<span class="w">    </span>ldarg<span class="w"> </span>strValue
<span class="w">    </span>call<span class="w"> </span>bool<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">String</span><span class="p">:</span><span class="nl">:IsNullOrEmpty</span><span class="p">(</span><span class="err">string</span><span class="p">)</span>
<span class="w">    </span><span class="err">brfalse</span><span class="p">.</span><span class="err">s</span><span class="w"> </span><span class="err">HA</span><span class="kt">SV</span><span class="err">ALUE</span>
<span class="w">    </span>br<span class="w"> </span><span class="err">RETURN</span><span class="kt">D</span><span class="err">E</span><span class="kt">F</span><span class="w">         </span><span class="err">//</span><span class="w"> </span>return<span class="w"> </span>default<span class="w"> </span>it<span class="w"> </span>empty

<span class="w">    </span><span class="err">//</span><span class="w"> </span>foreach<span class="w"> </span><span class="p">(</span><span class="err">T</span><span class="w"> </span>item<span class="w"> </span>in<span class="w"> </span><span class="err">Enum</span><span class="p">.</span><span class="nf">GetValues</span><span class="p">(</span><span class="nf">typeof</span><span class="p">(</span><span class="err">T</span><span class="p">)))</span>
<span class="w">  </span><span class="nv">HASVALUE</span><span class="p">:</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">Enum</span><span class="p">.</span><span class="err">Get</span><span class="kt">V</span><span class="err">alues</span><span class="p">.</span><span class="nf">GetEnumerator</span><span class="p">()</span>
<span class="w">    </span>ldtoken<span class="w"> </span><span class="err">!!T</span>
<span class="w">    </span>call<span class="w"> </span>class<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="err">Type</span><span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">Type</span><span class="p">:</span><span class="nl">:GetTypeFromHandle</span><span class="p">(</span>valuetype<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="err">RuntimeTypeHandle</span><span class="p">)</span>
<span class="w">    </span>call<span class="w"> </span>class<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="err">Array</span><span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">Enum</span><span class="p">:</span><span class="nl">:GetValues</span><span class="p">(</span>class<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="err">Type</span><span class="p">)</span>
<span class="w">    </span>callvirt<span class="w"> </span>instance<span class="w"> </span>class<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="kt">C</span><span class="err">ollections</span><span class="p">.</span><span class="kt">I</span><span class="err">Enumerator</span><span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">Array</span><span class="p">:</span><span class="nl">:GetEnumerator</span><span class="p">()</span><span class="w"> </span>
<span class="w">    </span>stloc<span class="w"> </span><span class="k">enum</span><span class="err">erator</span>
<span class="w">    </span><span class="p">.</span>try
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nv">CONDITION</span><span class="p">:</span>
<span class="w">        </span>ldloc<span class="w"> </span><span class="k">enum</span><span class="err">erator</span>
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>bool<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="kt">C</span><span class="err">ollections</span><span class="p">.</span><span class="nv">IEnumerator</span><span class="p">:</span><span class="nl">:MoveNext</span><span class="p">()</span>
<span class="w">        </span><span class="err">brfalse</span><span class="p">.</span><span class="err">s</span><span class="w"> </span><span class="err">LEA</span><span class="kt">V</span><span class="err">E</span>

<span class="w">      </span><span class="nv">STATEMENTS</span><span class="p">:</span>
<span class="w">        </span><span class="err">//</span><span class="w"> </span><span class="err">T</span><span class="w"> </span>item<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="err">T</span><span class="p">)</span><span class="err">Enumerator</span><span class="p">.</span><span class="kt">C</span><span class="err">urrent</span>
<span class="w">        </span>ldloc<span class="w"> </span><span class="k">enum</span><span class="err">erator</span>
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>object<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="kt">C</span><span class="err">ollections</span><span class="p">.</span><span class="nv">IEnumerator</span><span class="p">:</span><span class="nl">:get_Current</span><span class="p">()</span>
<span class="w">        </span><span class="err">unbox</span><span class="p">.</span>any<span class="w"> </span><span class="err">!!T</span>
<span class="w">        </span>stloc<span class="w"> </span>temp
<span class="w">        </span><span class="err">ldloca</span><span class="p">.</span><span class="err">s</span><span class="w"> </span>temp
<span class="w">        </span><span class="err">constrained</span><span class="p">.</span><span class="w"> </span><span class="err">!!T</span>

<span class="w">        </span><span class="err">//</span><span class="w"> </span>if<span class="w"> </span><span class="p">(</span><span class="err">item</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">().</span><span class="nf">Equals</span><span class="p">(</span><span class="err">value</span><span class="p">.</span><span class="nf">Trim</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">()))</span><span class="w"> </span>return<span class="w"> </span><span class="err">item;</span>
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>string<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">Object</span><span class="p">:</span><span class="nl">:ToString</span><span class="p">()</span>
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>string<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">String</span><span class="p">:</span><span class="nl">:ToLower</span><span class="p">()</span>
<span class="w">        </span>ldarg<span class="w"> </span>strValue
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>string<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">String</span><span class="p">:</span><span class="nl">:Trim</span><span class="p">()</span>
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>string<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">String</span><span class="p">:</span><span class="nl">:ToLower</span><span class="p">()</span>
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>bool<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">String</span><span class="p">:</span><span class="nl">:Equals</span><span class="p">(</span><span class="err">string</span><span class="p">)</span>
<span class="w">        </span><span class="err">brfalse</span><span class="p">.</span><span class="err">s</span><span class="w"> </span><span class="kt">C</span><span class="err">ON</span><span class="kt">DI</span><span class="err">T</span><span class="kt">I</span><span class="err">ON</span>
<span class="w">        </span>ldloc<span class="w"> </span>temp
<span class="w">        </span>stloc<span class="w"> </span><span class="err">return_value</span>
<span class="w">        </span><span class="err">leave</span><span class="p">.</span><span class="err">s</span><span class="w"> </span><span class="err">RETURN</span><span class="kt">V</span><span class="err">AL</span>

<span class="w">      </span><span class="nv">LEAVE</span><span class="p">:</span>
<span class="w">        </span><span class="err">leave</span><span class="p">.</span><span class="err">s</span><span class="w"> </span><span class="err">RETURN</span><span class="kt">D</span><span class="err">E</span><span class="kt">F</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">final</span><span class="err">ly</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="err">//</span><span class="w"> </span><span class="err">ArrayList's</span><span class="w"> </span><span class="err">Enumerator</span><span class="w"> </span>may<span class="w"> </span>or<span class="w"> </span>may<span class="w"> </span>not<span class="w"> </span>inherit<span class="w"> </span>from<span class="w"> </span><span class="kt">ID</span><span class="err">isposable</span>
<span class="w">        </span>ldloc<span class="w"> </span><span class="k">enum</span><span class="err">erator</span>
<span class="w">        </span>isinst<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="kt">ID</span><span class="err">isposable</span>
<span class="w">        </span><span class="err">stloc</span><span class="p">.</span><span class="err">s</span><span class="w"> </span>disposer
<span class="w">        </span><span class="err">ldloc</span><span class="p">.</span><span class="err">s</span><span class="w"> </span>disposer
<span class="w">        </span>ldnull
<span class="w">        </span>ceq
<span class="w">        </span><span class="err">brtrue</span><span class="p">.</span><span class="err">s</span><span class="w"> </span><span class="err">LEA</span><span class="kt">V</span><span class="err">E</span><span class="kt">FI</span><span class="err">NALLY</span>
<span class="w">        </span><span class="err">ldloc</span><span class="p">.</span><span class="err">s</span><span class="w"> </span>disposer
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>void<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">IDisposable</span><span class="p">:</span><span class="nl">:Dispose</span><span class="p">()</span>
<span class="w">      </span><span class="nv">LEAVEFINALLY</span><span class="p">:</span>
<span class="w">        </span>endfinally
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="nv">RETURNDEF</span><span class="p">:</span>
<span class="w">    </span>ldarg<span class="w"> </span>defaultValue
<span class="w">    </span>stloc<span class="w"> </span><span class="err">return_value</span>

<span class="w">  </span><span class="nv">RETURNVAL</span><span class="p">:</span>
<span class="w">    </span>ldloc<span class="w"> </span><span class="err">return_value</span>
<span class="w">    </span>ret
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Which generates a function that <strong>would</strong> look like this, if it were valid C#:</p>
<div class="code"><pre class="code literal-block">T GetEnumFromString&lt;T&gt;(string valueString, T defaultValue) where T : Enum
</pre></div>

<p>Then with the following C# code:</p>
<div class="code"><pre class="code literal-block"><span class="n">using</span><span class="w"> </span><span class="n">MyThing</span><span class="p">;</span>
<span class="o">//</span><span class="w"> </span><span class="n">stuff</span><span class="o">...</span>
<span class="n">private</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">MyEnum</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Yes</span><span class="p">,</span><span class="w"> </span><span class="n">No</span><span class="p">,</span><span class="w"> </span><span class="n">Okay</span><span class="w"> </span><span class="p">}</span>
<span class="k">static</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">Main</span><span class="p">(</span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Thing</span><span class="o">.</span><span class="n">GetEnumFromString</span><span class="p">(</span><span class="s2">"No"</span><span class="p">,</span><span class="w"> </span><span class="n">MyEnum</span><span class="o">.</span><span class="n">Yes</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">MyEnum</span><span class="o">.</span><span class="n">No</span>
<span class="w">    </span><span class="n">Thing</span><span class="o">.</span><span class="n">GetEnumFromString</span><span class="p">(</span><span class="s2">"Invalid"</span><span class="p">,</span><span class="w"> </span><span class="n">MyEnum</span><span class="o">.</span><span class="n">Okay</span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">MyEnum</span><span class="o">.</span><span class="n">Okay</span>
<span class="w">    </span><span class="n">Thing</span><span class="o">.</span><span class="n">GetEnumFromString</span><span class="p">(</span><span class="s2">"AnotherInvalid"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">compiler</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">Enum</span>
<span class="p">}</span>
</pre></div>

<p>Unfortunately, this means having this part of your code written in MSIL
instead of C#, with the only added benefit being that you're able to constrain
this method by <code>System.Enum</code>. It's also kind of a bummer, because it gets
compiled into a separate assembly. However, it doesn't mean you have to deploy
it that way.</p>
<p>By removing the line <code>.assembly MyThing{}</code> and invoking ilasm as follows:</p>
<div class="code"><pre class="code literal-block">ilasm.exe /DLL /OUTPUT=MyThing.netmodule
</pre></div>

<p>you get a netmodule instead of an assembly.</p>
<p>Unfortunately, VS2010 (and earlier, obviously) does not support adding
netmodule references, which means you'd have to leave it in 2 separate
assemblies when you're debugging. The only way you can add them as part of
your assembly would be to run csc.exe yourself using the <code>/addmodule:{files}</code>
command line argument. It wouldn't be <em>too</em> painful in an MSBuild script. Of
course, if you're brave or stupid, you can run csc yourself manually each
time. And it certainly gets more complicated as multiple assemblies need
access to it.</p>
<p>So, it CAN be done in .Net. Is it worth the extra effort? Um, well, I guess
I'll let you decide on that one.</p>
<hr>
<h4>F# Solution as alternative</h4>
<p>Extra Credit: It turns out that a generic restriction on <code>enum</code> is possible in
at least one other .NET language besides MSIL: F#.</p>
<div class="code"><pre class="code literal-block"><span class="k">type</span><span class="w"> </span><span class="nc">MyThing</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">member</span><span class="w"> </span><span class="n">GetEnumFromString</span><span class="o">&lt;</span><span class="k">'</span><span class="n">T</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="k">'</span><span class="n">T</span><span class="w"> </span><span class="o">:&gt;</span><span class="w"> </span><span class="n">Enum</span><span class="o">&gt;</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="n">defaultValue</span><span class="o">:</span><span class="w"> </span><span class="k">'</span><span class="n">T</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="sd">/// protect for null (only required in interop with C#)</span>
<span class="w">        </span><span class="k">let</span><span class="w"> </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">isNull</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nn">String</span><span class="p">.</span><span class="n">Empty</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">str</span>

<span class="w">        </span><span class="nn">Enum</span><span class="p">.</span><span class="n">GetValues</span><span class="o">(</span><span class="n">typedefof</span><span class="o">&lt;</span><span class="k">'</span><span class="n">T</span><span class="o">&gt;)</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Seq</span><span class="p">.</span><span class="n">cast</span><span class="o">&lt;_&gt;</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Seq</span><span class="p">.</span><span class="n">tryFind</span><span class="o">(</span><span class="k">fun</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nn">String</span><span class="p">.</span><span class="n">Compare</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="n">ToString</span><span class="bp">()</span><span class="o">,</span><span class="w"> </span><span class="n">str</span><span class="o">.</span><span class="n">Trim</span><span class="bp">()</span><span class="o">,</span><span class="w"> </span><span class="k">true</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">)</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">defaultValue</span>
</pre></div>

<p>This one is easier to maintain since it's a well-known language with full
Visual Studio IDE support, but you still need a separate project in your
solution for it. However, it naturally produces considerably different IL (the
code <em>is</em> very different) and it relies on the <code>FSharp.Core</code> library, which,
just like any other external library, needs to become part of your
distribution.</p>
<p>Here's how you can use it (basically the same as the MSIL solution), and to
show that it correctly fails on otherwise synonymous structs:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">works</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">inferred</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">StringComparison</span>
<span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyThing</span><span class="o">.</span><span class="n">GetEnumFromString</span><span class="p">(</span><span class="s2">"OrdinalIgnoreCase"</span><span class="p">,</span><span class="w"> </span><span class="n">StringComparison</span><span class="o">.</span><span class="n">Ordinal</span><span class="p">);</span>
<span class="o">//</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">restriction</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">recognized</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">C</span><span class="c1">#, this fails at compile time</span>
<span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyThing</span><span class="o">.</span><span class="n">GetEnumFromString</span><span class="p">(</span><span class="s2">"OrdinalIgnoreCase"</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">);</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<h3>This feature is finally supported in C# 7.3!</h3>
<p>The following snippet (from the dotnet samples) demonstrates how:</p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="nb nb-Type">int</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">EnumNamedValues</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Enum</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Dictionary</span><span class="o">&lt;</span><span class="nb nb-Type">int</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enum</span><span class="o">.</span><span class="n">GetValues</span><span class="p">(</span><span class="nb">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">));</span>

<span class="w">    </span><span class="n">foreach</span><span class="w"> </span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">values</span><span class="p">)</span>
<span class="w">        </span><span class="n">result</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="n">Enum</span><span class="o">.</span><span class="n">GetName</span><span class="p">(</span><span class="nb">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="n">item</span><span class="p">));</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Be sure to set your language version in your C# project to version 7.3.</p>
<hr>
<p>Original Answer below:</p>
<p>I'm late to the game, but I took it as a challenge to see how it could be
done. It's not possible in C# (or VB.NET, but scroll down for F#), but <em>is
possible</em> in MSIL. I wrote this little....thing</p>
<div class="code"><pre class="code literal-block"><span class="err">//</span><span class="w"> </span><span class="nv">license</span><span class="p">:</span><span class="w"> </span><span class="nv">http</span><span class="p">:</span><span class="err">//www</span><span class="p">.</span><span class="err">apache</span><span class="p">.</span><span class="err">org/licenses/L</span><span class="kt">IC</span><span class="err">EN</span><span class="kt">S</span><span class="err">E</span><span class="p">-</span><span class="mf">2.0</span><span class="p">.</span>html
<span class="p">.</span>assembly<span class="w"> </span><span class="err">MyThing</span><span class="p">{}</span>
<span class="k">.class</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span>sealed<span class="w"> </span><span class="err">MyThing</span><span class="p">.</span><span class="err">Thing</span>
<span class="w">       </span>extends<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="err">Object</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">.method</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="err">!!T</span><span class="w">  </span><span class="err">GetEnum</span><span class="kt">F</span><span class="err">rom</span><span class="kt">S</span><span class="err">tring&lt;</span>valuetype<span class="w"> </span><span class="p">.</span>ctor<span class="w"> </span><span class="p">(</span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="err">Enum</span><span class="p">)</span><span class="w"> </span><span class="err">T&gt;</span><span class="p">(</span>string<span class="w"> </span><span class="err">str</span><span class="kt">V</span><span class="err">alue</span><span class="p">,</span>
<span class="w">                                                                                          </span><span class="err">!!T</span><span class="w"> </span><span class="err">default</span><span class="kt">V</span><span class="err">alue</span><span class="p">)</span><span class="w"> </span>cil<span class="w"> </span>managed
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="p">.</span>maxstack<span class="w">  </span><span class="mi">2</span>
<span class="w">    </span><span class="k">.locals</span><span class="w"> </span>init<span class="w"> </span><span class="p">(</span><span class="kt">[</span><span class="mi">0</span><span class="err">]</span><span class="w"> </span><span class="err">!!T</span><span class="w"> </span><span class="err">temp</span><span class="p">,</span>
<span class="w">                  </span><span class="kt">[</span><span class="mi">1</span><span class="err">]</span><span class="w"> </span><span class="err">!!T</span><span class="w"> </span><span class="err">return_value</span><span class="p">,</span>
<span class="w">                  </span><span class="kt">[</span><span class="mi">2</span><span class="err">]</span><span class="w"> </span>class<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="kt">C</span><span class="err">ollections</span><span class="p">.</span><span class="kt">I</span><span class="err">Enumerator</span><span class="w"> </span><span class="k">enum</span><span class="err">erator</span><span class="p">,</span>
<span class="w">                  </span><span class="kt">[</span><span class="mi">3</span><span class="err">]</span><span class="w"> </span>class<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="kt">ID</span><span class="err">isposable</span><span class="w"> </span><span class="err">disposer</span><span class="p">)</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="nf">if</span><span class="p">(</span><span class="err">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="err">str</span><span class="kt">V</span><span class="err">alue</span><span class="p">))</span><span class="w"> </span>return<span class="w"> </span><span class="err">default</span><span class="kt">V</span><span class="err">alue;</span>
<span class="w">    </span>ldarg<span class="w"> </span>strValue
<span class="w">    </span>call<span class="w"> </span>bool<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">String</span><span class="p">:</span><span class="nl">:IsNullOrEmpty</span><span class="p">(</span><span class="err">string</span><span class="p">)</span>
<span class="w">    </span><span class="err">brfalse</span><span class="p">.</span><span class="err">s</span><span class="w"> </span><span class="err">HA</span><span class="kt">SV</span><span class="err">ALUE</span>
<span class="w">    </span>br<span class="w"> </span><span class="err">RETURN</span><span class="kt">D</span><span class="err">E</span><span class="kt">F</span><span class="w">         </span><span class="err">//</span><span class="w"> </span>return<span class="w"> </span>default<span class="w"> </span>it<span class="w"> </span>empty

<span class="w">    </span><span class="err">//</span><span class="w"> </span>foreach<span class="w"> </span><span class="p">(</span><span class="err">T</span><span class="w"> </span>item<span class="w"> </span>in<span class="w"> </span><span class="err">Enum</span><span class="p">.</span><span class="nf">GetValues</span><span class="p">(</span><span class="nf">typeof</span><span class="p">(</span><span class="err">T</span><span class="p">)))</span>
<span class="w">  </span><span class="nv">HASVALUE</span><span class="p">:</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">Enum</span><span class="p">.</span><span class="err">Get</span><span class="kt">V</span><span class="err">alues</span><span class="p">.</span><span class="nf">GetEnumerator</span><span class="p">()</span>
<span class="w">    </span>ldtoken<span class="w"> </span><span class="err">!!T</span>
<span class="w">    </span>call<span class="w"> </span>class<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="err">Type</span><span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">Type</span><span class="p">:</span><span class="nl">:GetTypeFromHandle</span><span class="p">(</span>valuetype<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="err">RuntimeTypeHandle</span><span class="p">)</span>
<span class="w">    </span>call<span class="w"> </span>class<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="err">Array</span><span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">Enum</span><span class="p">:</span><span class="nl">:GetValues</span><span class="p">(</span>class<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="err">Type</span><span class="p">)</span>
<span class="w">    </span>callvirt<span class="w"> </span>instance<span class="w"> </span>class<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="kt">C</span><span class="err">ollections</span><span class="p">.</span><span class="kt">I</span><span class="err">Enumerator</span><span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">Array</span><span class="p">:</span><span class="nl">:GetEnumerator</span><span class="p">()</span><span class="w"> </span>
<span class="w">    </span>stloc<span class="w"> </span><span class="k">enum</span><span class="err">erator</span>
<span class="w">    </span><span class="p">.</span>try
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nv">CONDITION</span><span class="p">:</span>
<span class="w">        </span>ldloc<span class="w"> </span><span class="k">enum</span><span class="err">erator</span>
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>bool<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="kt">C</span><span class="err">ollections</span><span class="p">.</span><span class="nv">IEnumerator</span><span class="p">:</span><span class="nl">:MoveNext</span><span class="p">()</span>
<span class="w">        </span><span class="err">brfalse</span><span class="p">.</span><span class="err">s</span><span class="w"> </span><span class="err">LEA</span><span class="kt">V</span><span class="err">E</span>

<span class="w">      </span><span class="nv">STATEMENTS</span><span class="p">:</span>
<span class="w">        </span><span class="err">//</span><span class="w"> </span><span class="err">T</span><span class="w"> </span>item<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="err">T</span><span class="p">)</span><span class="err">Enumerator</span><span class="p">.</span><span class="kt">C</span><span class="err">urrent</span>
<span class="w">        </span>ldloc<span class="w"> </span><span class="k">enum</span><span class="err">erator</span>
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>object<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="kt">C</span><span class="err">ollections</span><span class="p">.</span><span class="nv">IEnumerator</span><span class="p">:</span><span class="nl">:get_Current</span><span class="p">()</span>
<span class="w">        </span><span class="err">unbox</span><span class="p">.</span>any<span class="w"> </span><span class="err">!!T</span>
<span class="w">        </span>stloc<span class="w"> </span>temp
<span class="w">        </span><span class="err">ldloca</span><span class="p">.</span><span class="err">s</span><span class="w"> </span>temp
<span class="w">        </span><span class="err">constrained</span><span class="p">.</span><span class="w"> </span><span class="err">!!T</span>

<span class="w">        </span><span class="err">//</span><span class="w"> </span>if<span class="w"> </span><span class="p">(</span><span class="err">item</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">().</span><span class="nf">Equals</span><span class="p">(</span><span class="err">value</span><span class="p">.</span><span class="nf">Trim</span><span class="p">().</span><span class="nf">ToLower</span><span class="p">()))</span><span class="w"> </span>return<span class="w"> </span><span class="err">item;</span>
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>string<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">Object</span><span class="p">:</span><span class="nl">:ToString</span><span class="p">()</span>
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>string<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">String</span><span class="p">:</span><span class="nl">:ToLower</span><span class="p">()</span>
<span class="w">        </span>ldarg<span class="w"> </span>strValue
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>string<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">String</span><span class="p">:</span><span class="nl">:Trim</span><span class="p">()</span>
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>string<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">String</span><span class="p">:</span><span class="nl">:ToLower</span><span class="p">()</span>
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>bool<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">String</span><span class="p">:</span><span class="nl">:Equals</span><span class="p">(</span><span class="err">string</span><span class="p">)</span>
<span class="w">        </span><span class="err">brfalse</span><span class="p">.</span><span class="err">s</span><span class="w"> </span><span class="kt">C</span><span class="err">ON</span><span class="kt">DI</span><span class="err">T</span><span class="kt">I</span><span class="err">ON</span>
<span class="w">        </span>ldloc<span class="w"> </span>temp
<span class="w">        </span>stloc<span class="w"> </span><span class="err">return_value</span>
<span class="w">        </span><span class="err">leave</span><span class="p">.</span><span class="err">s</span><span class="w"> </span><span class="err">RETURN</span><span class="kt">V</span><span class="err">AL</span>

<span class="w">      </span><span class="nv">LEAVE</span><span class="p">:</span>
<span class="w">        </span><span class="err">leave</span><span class="p">.</span><span class="err">s</span><span class="w"> </span><span class="err">RETURN</span><span class="kt">D</span><span class="err">E</span><span class="kt">F</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">final</span><span class="err">ly</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="err">//</span><span class="w"> </span><span class="err">ArrayList's</span><span class="w"> </span><span class="err">Enumerator</span><span class="w"> </span>may<span class="w"> </span>or<span class="w"> </span>may<span class="w"> </span>not<span class="w"> </span>inherit<span class="w"> </span>from<span class="w"> </span><span class="kt">ID</span><span class="err">isposable</span>
<span class="w">        </span>ldloc<span class="w"> </span><span class="k">enum</span><span class="err">erator</span>
<span class="w">        </span>isinst<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="kt">ID</span><span class="err">isposable</span>
<span class="w">        </span><span class="err">stloc</span><span class="p">.</span><span class="err">s</span><span class="w"> </span>disposer
<span class="w">        </span><span class="err">ldloc</span><span class="p">.</span><span class="err">s</span><span class="w"> </span>disposer
<span class="w">        </span>ldnull
<span class="w">        </span>ceq
<span class="w">        </span><span class="err">brtrue</span><span class="p">.</span><span class="err">s</span><span class="w"> </span><span class="err">LEA</span><span class="kt">V</span><span class="err">E</span><span class="kt">FI</span><span class="err">NALLY</span>
<span class="w">        </span><span class="err">ldloc</span><span class="p">.</span><span class="err">s</span><span class="w"> </span>disposer
<span class="w">        </span>callvirt<span class="w"> </span>instance<span class="w"> </span>void<span class="w"> </span><span class="kt">[</span><span class="err">mscorlib]</span><span class="kt">S</span><span class="err">ystem</span><span class="p">.</span><span class="nv">IDisposable</span><span class="p">:</span><span class="nl">:Dispose</span><span class="p">()</span>
<span class="w">      </span><span class="nv">LEAVEFINALLY</span><span class="p">:</span>
<span class="w">        </span>endfinally
<span class="w">    </span><span class="p">}</span>

<span class="w">  </span><span class="nv">RETURNDEF</span><span class="p">:</span>
<span class="w">    </span>ldarg<span class="w"> </span>defaultValue
<span class="w">    </span>stloc<span class="w"> </span><span class="err">return_value</span>

<span class="w">  </span><span class="nv">RETURNVAL</span><span class="p">:</span>
<span class="w">    </span>ldloc<span class="w"> </span><span class="err">return_value</span>
<span class="w">    </span>ret
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Which generates a function that <strong>would</strong> look like this, if it were valid C#:</p>
<div class="code"><pre class="code literal-block">T GetEnumFromString&lt;T&gt;(string valueString, T defaultValue) where T : Enum
</pre></div>

<p>Then with the following C# code:</p>
<div class="code"><pre class="code literal-block"><span class="n">using</span><span class="w"> </span><span class="n">MyThing</span><span class="p">;</span>
<span class="o">//</span><span class="w"> </span><span class="n">stuff</span><span class="o">...</span>
<span class="n">private</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">MyEnum</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Yes</span><span class="p">,</span><span class="w"> </span><span class="n">No</span><span class="p">,</span><span class="w"> </span><span class="n">Okay</span><span class="w"> </span><span class="p">}</span>
<span class="k">static</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">Main</span><span class="p">(</span><span class="n">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Thing</span><span class="o">.</span><span class="n">GetEnumFromString</span><span class="p">(</span><span class="s2">"No"</span><span class="p">,</span><span class="w"> </span><span class="n">MyEnum</span><span class="o">.</span><span class="n">Yes</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">MyEnum</span><span class="o">.</span><span class="n">No</span>
<span class="w">    </span><span class="n">Thing</span><span class="o">.</span><span class="n">GetEnumFromString</span><span class="p">(</span><span class="s2">"Invalid"</span><span class="p">,</span><span class="w"> </span><span class="n">MyEnum</span><span class="o">.</span><span class="n">Okay</span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">returns</span><span class="w"> </span><span class="n">MyEnum</span><span class="o">.</span><span class="n">Okay</span>
<span class="w">    </span><span class="n">Thing</span><span class="o">.</span><span class="n">GetEnumFromString</span><span class="p">(</span><span class="s2">"AnotherInvalid"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">compiler</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">Enum</span>
<span class="p">}</span>
</pre></div>

<p>Unfortunately, this means having this part of your code written in MSIL
instead of C#, with the only added benefit being that you're able to constrain
this method by <code>System.Enum</code>. It's also kind of a bummer, because it gets
compiled into a separate assembly. However, it doesn't mean you have to deploy
it that way.</p>
<p>By removing the line <code>.assembly MyThing{}</code> and invoking ilasm as follows:</p>
<div class="code"><pre class="code literal-block">ilasm.exe /DLL /OUTPUT=MyThing.netmodule
</pre></div>

<p>you get a netmodule instead of an assembly.</p>
<p>Unfortunately, VS2010 (and earlier, obviously) does not support adding
netmodule references, which means you'd have to leave it in 2 separate
assemblies when you're debugging. The only way you can add them as part of
your assembly would be to run csc.exe yourself using the <code>/addmodule:{files}</code>
command line argument. It wouldn't be <em>too</em> painful in an MSBuild script. Of
course, if you're brave or stupid, you can run csc yourself manually each
time. And it certainly gets more complicated as multiple assemblies need
access to it.</p>
<p>So, it CAN be done in .Net. Is it worth the extra effort? Um, well, I guess
I'll let you decide on that one.</p>
<hr>
<h4>F# Solution as alternative</h4>
<p>Extra Credit: It turns out that a generic restriction on <code>enum</code> is possible in
at least one other .NET language besides MSIL: F#.</p>
<div class="code"><pre class="code literal-block"><span class="k">type</span><span class="w"> </span><span class="nc">MyThing</span><span class="w"> </span><span class="o">=</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">member</span><span class="w"> </span><span class="n">GetEnumFromString</span><span class="o">&lt;</span><span class="k">'</span><span class="n">T</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="k">'</span><span class="n">T</span><span class="w"> </span><span class="o">:&gt;</span><span class="w"> </span><span class="n">Enum</span><span class="o">&gt;</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="n">defaultValue</span><span class="o">:</span><span class="w"> </span><span class="k">'</span><span class="n">T</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="sd">/// protect for null (only required in interop with C#)</span>
<span class="w">        </span><span class="k">let</span><span class="w"> </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">isNull</span><span class="w"> </span><span class="n">str</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nn">String</span><span class="p">.</span><span class="n">Empty</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">str</span>

<span class="w">        </span><span class="nn">Enum</span><span class="p">.</span><span class="n">GetValues</span><span class="o">(</span><span class="n">typedefof</span><span class="o">&lt;</span><span class="k">'</span><span class="n">T</span><span class="o">&gt;)</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Seq</span><span class="p">.</span><span class="n">cast</span><span class="o">&lt;_&gt;</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nn">Seq</span><span class="p">.</span><span class="n">tryFind</span><span class="o">(</span><span class="k">fun</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nn">String</span><span class="p">.</span><span class="n">Compare</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="n">ToString</span><span class="bp">()</span><span class="o">,</span><span class="w"> </span><span class="n">str</span><span class="o">.</span><span class="n">Trim</span><span class="bp">()</span><span class="o">,</span><span class="w"> </span><span class="k">true</span><span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="o">)</span>
<span class="w">        </span><span class="o">|&gt;</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">defaultValue</span>
</pre></div>

<p>This one is easier to maintain since it's a well-known language with full
Visual Studio IDE support, but you still need a separate project in your
solution for it. However, it naturally produces considerably different IL (the
code <em>is</em> very different) and it relies on the <code>FSharp.Core</code> library, which,
just like any other external library, needs to become part of your
distribution.</p>
<p>Here's how you can use it (basically the same as the MSIL solution), and to
show that it correctly fails on otherwise synonymous structs:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">works</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">inferred</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">StringComparison</span>
<span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyThing</span><span class="o">.</span><span class="n">GetEnumFromString</span><span class="p">(</span><span class="s2">"OrdinalIgnoreCase"</span><span class="p">,</span><span class="w"> </span><span class="n">StringComparison</span><span class="o">.</span><span class="n">Ordinal</span><span class="p">);</span>
<span class="o">//</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">restriction</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">recognized</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">C</span><span class="c1">#, this fails at compile time</span>
<span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyThing</span><span class="o">.</span><span class="n">GetEnumFromString</span><span class="p">(</span><span class="s2">"OrdinalIgnoreCase"</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">);</span>
</pre></div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/net-c/" rel="tag">.net-c#</a></li>
            <li><a class="tag p-category" href="../../categories/enums/" rel="tag">enums</a></li>
            <li><a class="tag p-category" href="../../categories/generic-constraints/" rel="tag">generic-constraints</a></li>
            <li><a class="tag p-category" href="../../categories/generics/" rel="tag">generics</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-to-align-content-of-a-div-to-the-bottom/" rel="prev" title="How to align content of a div to the bottom">Previous post</a>
            </li>
            <li class="next">
                <a href="../how-to-do-case-insensitive-string-comparison/" rel="next" title="How to do case insensitive string comparison?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
