<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>`pg_tblspc` missing after installation of latest version of OS X (Yosemite or El Capitan) | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/pg-tblspc-missing-after-installation-of-latest-version-of-os-x-yosemite-or-el-capitan/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-to-print-to-console-in-pytest/" title="How to print to console in pytest?" type="text/html">
<link rel="next" href="../javascript-for-in-vs-for/" title="JavaScript for...in vs for" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="`pg_tblspc` missing after installation of latest version of OS X (Yose">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/pg-tblspc-missing-after-installation-of-latest-version-of-os-x-yosemite-or-el-capitan/">
<meta property="og:description" content="I use postgres from homebrew in my OS X, but when I reboot my system,
sometimes the postgres doesn't start after the reboot, and so I manually tried
to start it with postgres -D /usr/local/var/postgre">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T08:52:16+08:00">
<meta property="article:tag" content="homebrew">
<meta property="article:tag" content="macos">
<meta property="article:tag" content="osx-yosemite">
<meta property="article:tag" content="postgresql">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">`pg_tblspc` missing after installation of latest version of OS X (Yosemite or El Capitan)</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T08:52:16+08:00" itemprop="datePublished" title="2023-03-03 08:52">2023-03-03 08:52</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I use postgres from homebrew in my OS X, but when I reboot my system,
sometimes the postgres doesn't start after the reboot, and so I manually tried
to start it with <code>postgres -D /usr/local/var/postgres</code>, but then the error
occurred with the following message: <code>FATAL: could not open directory
"pg_tblspc": No such file or directory</code>.</p>
<p>The last time it occurred, I couldn't get it to the original state, so I
decided to uninstall the whole postgres system and then re-installed it and
created users, tables, datasets, etc... It was so disgusting, but it
frequently occurs on my system, say once in a few months.</p>
<p>So why does it lose the <code>pg_tblspc</code> file frequently? And is there anything
that I can do to avoid the loss of the file?</p>
<p>I haven't upgraded my homebrew and postgres to the latest version (i.e. I've
been using the same version). Also, all the things that I did on the postgres
database is delete the table and populate the new data every day. I haven't
changed the user, password, etc...</p>
<p>EDIT (mbannert): I felt the need to add this, since the thread is the top hit
on google for this issue and for many the symptom is different. Homebrewers
likely will encounter this error message:</p>
<div class="code"><pre class="code literal-block">No such file or directory
Is the server running locally and accepting
connections on Unix domain socket "/tmp/.s.PGSQL.5432"?
</pre></div>

<p>So, if you just experienced this after the Yosemite upgrade you now you're
covered for now reading this thread.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Solved... in part.</p>
<p>Apparently, Installing the latest versions of OS X (e.g. Yosemite or El
Capitan) removes some directories in <code>/usr/local/var/postgres</code>.</p>
<p>To fix this you simply recreate the missing directories:</p>
<div class="code"><pre class="code literal-block"><span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">pg_commit_ts</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">pg_dynshmem</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">pg_logical</span><span class="o">/</span><span class="n">mappings</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">pg_logical</span><span class="o">/</span><span class="n">snapshots</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">pg_replslot</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">pg_serial</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">pg_snapshots</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">pg_stat</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">pg_stat_tmp</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">pg_tblspc</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">pg_twophase</span>
</pre></div>

<p>Or, more concisely ( <em>thanks to Nate</em> ):</p>
<div class="code"><pre class="code literal-block"><span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="p">{{</span><span class="n">pg_commit_ts</span><span class="p">,</span><span class="n">pg_dynshmem</span><span class="p">,</span><span class="n">pg_replslot</span><span class="p">,</span><span class="n">pg_serial</span><span class="p">,</span><span class="n">pg_snapshots</span><span class="p">,</span><span class="n">pg_stat</span><span class="p">,</span><span class="n">pg_stat_tmp</span><span class="p">,</span><span class="n">pg_tblspc</span><span class="p">,</span><span class="n">pg_twophase</span><span class="p">},</span><span class="n">pg_logical</span><span class="o">/</span><span class="p">{</span><span class="n">mappings</span><span class="p">,</span><span class="n">snapshots</span><span class="p">}}</span>
</pre></div>

<p>Rerunning <code>pg_ctl start -D /usr/local/var/postgres</code> now starts the server
normally and, at least for me, without any data loss.</p>
<p><strong>UPDATE</strong></p>
<p>On my system, some of those directories are empty even when Postgres is
running. Maybe, as part of some "cleaning" operation, Yosemite removes any
empty directories? In any case, I went ahead and created a '.keep' file in
each directory to prevent future deletion.</p>
<div class="code"><pre class="code literal-block"><span class="n">touch</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="p">{{</span><span class="n">pg_commit_ts</span><span class="p">,</span><span class="n">pg_dynshmem</span><span class="p">,</span><span class="n">pg_replslot</span><span class="p">,</span><span class="n">pg_serial</span><span class="p">,</span><span class="n">pg_snapshots</span><span class="p">,</span><span class="n">pg_stat</span><span class="p">,</span><span class="n">pg_stat_tmp</span><span class="p">,</span><span class="n">pg_tblspc</span><span class="p">,</span><span class="n">pg_twophase</span><span class="p">},</span><span class="n">pg_logical</span><span class="o">/</span><span class="p">{</span><span class="n">mappings</span><span class="p">,</span><span class="n">snapshots</span><span class="p">}}</span><span class="o">/.</span><span class="n">keep</span>
</pre></div>

<p><em><strong>Note</strong> : Creating the <code>.keep</code> file in those directories will create some
noise in your logfile, but doesn't appear to negatively affect anything else.</em></p>
<p><br></p>
<h3>Suggest</h3>
<p>Donavan's answer is spot on, I just wanted to add that as i did different
things with the database (e.g. <code>rake db:test</code>), it went looking for different
directories that haven't been mentioned above and would choke when they
weren't present, in my case <code>pg_logical/mappings</code>, so you may want to setup a
terminal running:</p>
<div class="code"><pre class="code literal-block"><span class="n">tail</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">postgres</span><span class="o">/</span><span class="n">server</span><span class="o">.</span><span class="n">log</span>
</pre></div>

<p>and watch it for missing folders while you go thru your typical database
activities.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/homebrew/" rel="tag">homebrew</a></li>
            <li><a class="tag p-category" href="../../categories/macos/" rel="tag">macos</a></li>
            <li><a class="tag p-category" href="../../categories/osx-yosemite/" rel="tag">osx-yosemite</a></li>
            <li><a class="tag p-category" href="../../categories/postgresql/" rel="tag">postgresql</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-to-print-to-console-in-pytest/" rel="prev" title="How to print to console in pytest?">Previous post</a>
            </li>
            <li class="next">
                <a href="../javascript-for-in-vs-for/" rel="next" title="JavaScript for...in vs for">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
