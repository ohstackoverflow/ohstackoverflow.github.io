<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The calling thread cannot access this object because a different thread owns it | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/the-calling-thread-cannot-access-this-object-because-a-different-thread-owns-it/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../reference-requirements-txt-for-the-install-requires-kwarg-in-setuptools-setup-py-file/" title="Reference requirements.txt for the install_requires kwarg in setuptools setup.py file" type="text/html">
<link rel="next" href="../what-is-object-serialization/" title="What is object serialization?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="The calling thread cannot access this object because a different threa">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/the-calling-thread-cannot-access-this-object-because-a-different-thread-owns-it/">
<meta property="og:description" content='My code is as below
public CountryStandards()
{
    InitializeComponent();
    try
    {
        FillPageControls();
    }
    catch (Exception ex)
    {
        MessageBox.Show(ex.Message, "Country S'>
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T16:15:02+08:00">
<meta property="article:tag" content=".net-c#">
<meta property="article:tag" content="backgroundworker">
<meta property="article:tag" content="multithreading">
<meta property="article:tag" content="wpf">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">The calling thread cannot access this object because a different thread owns it</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T16:15:02+08:00" itemprop="datePublished" title="2023-03-03 16:15">2023-03-03 16:15</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>My code is as below</p>
<div class="code"><pre class="code literal-block">public<span class="w"> </span>CountryStandards()
{
<span class="w">    </span>InitializeComponent();
<span class="w">    </span>try
<span class="w">    </span>{
<span class="w">        </span>FillPageControls();
<span class="w">    </span>}
<span class="w">    </span>catch<span class="w"> </span>(Exception<span class="w"> </span>ex)
<span class="w">    </span>{
<span class="w">        </span>MessageBox.Show(ex.Message,<span class="w"> </span>"Country<span class="w"> </span>Standards",<span class="w"> </span>MessageBoxButton.OK,<span class="w"> </span>MessageBoxImage.Error);
<span class="w">    </span>}
}

///<span class="w"> </span><span class="nt">&lt;summary&gt;</span>
///<span class="w"> </span>Fills<span class="w"> </span>the<span class="w"> </span>page<span class="w"> </span>controls.
///<span class="w"> </span><span class="nt">&lt;/summary&gt;</span>
private<span class="w"> </span>void<span class="w"> </span>FillPageControls()
{
<span class="w">    </span>popUpProgressBar.IsOpen<span class="w"> </span>=<span class="w"> </span>true;
<span class="w">    </span>lblProgress.Content<span class="w"> </span>=<span class="w"> </span>"Loading.<span class="w"> </span>Please<span class="w"> </span>wait...";
<span class="w">    </span>progress.IsIndeterminate<span class="w"> </span>=<span class="w"> </span>true;
<span class="w">    </span>worker<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>BackgroundWorker();
<span class="w">    </span>worker.DoWork<span class="w"> </span>+=<span class="w"> </span>new<span class="w"> </span>System.ComponentModel.DoWorkEventHandler(worker_DoWork);
<span class="w">    </span>worker.ProgressChanged<span class="w"> </span>+=<span class="w"> </span>new<span class="w"> </span>System.ComponentModel.ProgressChangedEventHandler(worker_ProgressChanged);
<span class="w">    </span>worker.WorkerReportsProgress<span class="w"> </span>=<span class="w"> </span>true;
<span class="w">    </span>worker.WorkerSupportsCancellation<span class="w"> </span>=<span class="w"> </span>true;
<span class="w">    </span>worker.RunWorkerCompleted<span class="w"> </span>+=<span class="w"> </span>new<span class="w"> </span>System.ComponentModel.RunWorkerCompletedEventHandler(worker_RunWorkerCompleted);
<span class="w">    </span>worker.RunWorkerAsync();<span class="w">                    </span>
}

private<span class="w"> </span>void<span class="w"> </span>worker_DoWork(object<span class="w"> </span>sender,<span class="w"> </span>System.ComponentModel.DoWorkEventArgs<span class="w"> </span>e)
{
<span class="w">    </span>GetGridData(null,<span class="w"> </span>0);<span class="w"> </span>//<span class="w"> </span>filling<span class="w"> </span>grid
}

private<span class="w"> </span>void<span class="w"> </span>worker_ProgressChanged(object<span class="w"> </span>sender,<span class="w"> </span>System.ComponentModel.ProgressChangedEventArgs<span class="w"> </span>e)
{
<span class="w">    </span>progress.Value<span class="w"> </span>=<span class="w"> </span>e.ProgressPercentage;
}

private<span class="w"> </span>void<span class="w"> </span>worker_RunWorkerCompleted(object<span class="w"> </span>sender,<span class="w"> </span>System.ComponentModel.RunWorkerCompletedEventArgs<span class="w"> </span>e)
{
<span class="w">    </span>worker<span class="w"> </span>=<span class="w"> </span>null;
<span class="w">    </span>popUpProgressBar.IsOpen<span class="w"> </span>=<span class="w"> </span>false;
<span class="w">    </span>//filling<span class="w"> </span>Region<span class="w"> </span>dropdown
<span class="w">    </span>Standards.UDMCountryStandards<span class="w"> </span>objUDMCountryStandards<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>Standards.UDMCountryStandards();
<span class="w">    </span>objUDMCountryStandards.Operation<span class="w"> </span>=<span class="w"> </span>"SELECT_REGION";
<span class="w">    </span>DataSet<span class="w"> </span>dsRegionStandards<span class="w"> </span>=<span class="w"> </span>objStandardsBusinessLayer.GetCountryStandards(objUDMCountryStandards);
<span class="w">    </span>if<span class="w"> </span>(!StandardsDefault.IsNullOrEmptyDataTable(dsRegionStandards,<span class="w"> </span>0))
<span class="w">        </span>StandardsDefault.FillComboBox(cmbRegion,<span class="w"> </span>dsRegionStandards.Tables[0],<span class="w"> </span>"Region",<span class="w"> </span>"RegionId");

<span class="w">    </span>//filling<span class="w"> </span>Currency<span class="w"> </span>dropdown
<span class="w">    </span>objUDMCountryStandards<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>Standards.UDMCountryStandards();
<span class="w">    </span>objUDMCountryStandards.Operation<span class="w"> </span>=<span class="w"> </span>"SELECT_CURRENCY";
<span class="w">    </span>DataSet<span class="w"> </span>dsCurrencyStandards<span class="w"> </span>=<span class="w"> </span>objStandardsBusinessLayer.GetCountryStandards(objUDMCountryStandards);
<span class="w">    </span>if<span class="w"> </span>(!StandardsDefault.IsNullOrEmptyDataTable(dsCurrencyStandards,<span class="w"> </span>0))
<span class="w">        </span>StandardsDefault.FillComboBox(cmbCurrency,<span class="w"> </span>dsCurrencyStandards.Tables[0],<span class="w"> </span>"CurrencyName",<span class="w"> </span>"CurrencyId");

<span class="w">    </span>if<span class="w"> </span>(Users.UserRole<span class="w"> </span>!=<span class="w"> </span>"Admin")
<span class="w">        </span>btnSave.IsEnabled<span class="w"> </span>=<span class="w"> </span>false;

}

///<span class="w"> </span><span class="nt">&lt;summary&gt;</span>
///<span class="w"> </span>Gets<span class="w"> </span>the<span class="w"> </span>grid<span class="w"> </span>data.
///<span class="w"> </span><span class="nt">&lt;/summary&gt;</span>
///<span class="w"> </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">"sender"</span><span class="nt">&gt;</span>The<span class="w"> </span>sender.<span class="nt">&lt;/param&gt;</span>
///<span class="w"> </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">"pageIndex"</span><span class="nt">&gt;</span>Index<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>page.(<span class="w"> </span>used<span class="w"> </span>in<span class="w"> </span>case<span class="w"> </span>of<span class="w"> </span>paging)<span class="w">   </span><span class="nt">&lt;/pamam&gt;</span>
private<span class="w"> </span>void<span class="w"> </span>GetGridData(object<span class="w"> </span>sender,<span class="w"> </span>int<span class="w"> </span>pageIndex)
{
<span class="w">    </span>Standards.UDMCountryStandards<span class="w"> </span>objUDMCountryStandards<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>Standards.UDMCountryStandards();
<span class="w">    </span>objUDMCountryStandards.Operation<span class="w"> </span>=<span class="w"> </span>"SELECT";
<span class="w">    </span>objUDMCountryStandards.Country<span class="w"> </span>=<span class="w"> </span>txtSearchCountry.Text.Trim()<span class="w"> </span>!=<span class="w"> </span>string.Empty<span class="w"> </span>?<span class="w"> </span>txtSearchCountry.Text<span class="w"> </span>:<span class="w"> </span>null;
<span class="w">    </span>DataSet<span class="w"> </span>dsCountryStandards<span class="w"> </span>=<span class="w"> </span>objStandardsBusinessLayer.GetCountryStandards(objUDMCountryStandards);
<span class="w">    </span>if<span class="w"> </span>(!StandardsDefault.IsNullOrEmptyDataTable(dsCountryStandards,<span class="w"> </span>0)<span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span>(chkbxMarketsSearch.IsChecked<span class="w"> </span>==<span class="w"> </span>true<span class="w"> </span>||<span class="w"> </span>chkbxBudgetsSearch.IsChecked<span class="w"> </span>==<span class="w"> </span>true<span class="w"> </span>||<span class="w"> </span>chkbxProgramsSearch.IsChecked<span class="w"> </span>==<span class="w"> </span>true))
<span class="w">    </span>{
<span class="w">        </span>DataTable<span class="w"> </span>objDataTable<span class="w"> </span>=<span class="w"> </span>StandardsDefault.FilterDatatableForModules(dsCountryStandards.Tables[0],<span class="w"> </span>"Country",<span class="w"> </span>chkbxMarketsSearch,<span class="w"> </span>chkbxBudgetsSearch,<span class="w"> </span>chkbxProgramsSearch);
<span class="w">        </span>dgCountryList.ItemsSource<span class="w"> </span>=<span class="w"> </span>objDataTable.DefaultView;
<span class="w">    </span>}
<span class="w">    </span>else
<span class="w">    </span>{
<span class="w">        </span>MessageBox.Show("No<span class="w"> </span>Records<span class="w"> </span>Found",<span class="w"> </span>"Country<span class="w"> </span>Standards",<span class="w"> </span>MessageBoxButton.OK,<span class="w"> </span>MessageBoxImage.Information);
<span class="w">        </span>btnClear_Click(null,<span class="w"> </span>null);
<span class="w">    </span>}
}
</pre></div>

<p>The step <code>objUDMCountryStandards.Country = txtSearchCountry.Text.Trim() !=
string.Empty ? txtSearchCountry.Text : null;</code> in get grid data throws
exception</p>
<blockquote>
<p>The calling thread cannot access this object because a different thread owns
it.</p>
</blockquote>
<p>What's wrong here?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This is a common problem with people getting started. Whenever you update your
UI elements from a thread other than the main thread, you need to use:</p>
<div class="code"><pre class="code literal-block">this.Dispatcher.Invoke(() =&gt;
{
    ...// your code here.
});
</pre></div>

<p>You can also use <code>control.Dispatcher.CheckAccess()</code> to check whether the
current thread owns the control. If it does own it, your code looks as normal.
Otherwise, use above pattern.</p>
<p><br></p>
<h3>Suggest</h3>
<p>To add my 2 cents, the exception can occur even if you call your code through
<code>System.Windows.Threading.Dispatcher.CurrentDispatcher.Invoke()</code>.<br>
The point is that you have to call <code>Invoke()</code> of the <code>Dispatcher</code> of the
<strong>control that you're trying to access</strong> , which in some cases may not be the
same as <code>System.Windows.Threading.Dispatcher.CurrentDispatcher</code>. So instead
you should use <code>YourControl.Dispatcher.Invoke()</code> to be safe. I was banging my
head for a couple of hours before I realized this.</p>
<h3>Update</h3>
<p>For future readers, it looks like this has changed in the newer versions of
.NET (4.0 and above). Now you no longer have to worry about the correct
dispatcher when updating UI-backing properties in your VM. WPF engine will
marshal cross-thread calls on the correct UI thread. See more details here.
Thanks to @aaronburro for the info and link. You may also want to read our
conversation below in comments.</p>
<h3>Update 2</h3>
<p>Since this is a popular post now, I thought I'd share my experience that I had
in the following years. The behavior seems to be that any <strong>property
bindings</strong> will update correctly in cross-thread calls (no marshalling
required; WPF will handle it for you). OTOH <strong>command bindings</strong> will need to
be delegated to the UI dispatcher. I have tested it with both MVVM Light and
the relatively new Community Toolkit and it seems to be the case with both the
old Framework and the new .NET 5 and 6. <code>AsyncRelayCommand</code> fails to update
the UI when invoked from non-UI thread (This happens when <code>CanExecuteChanged</code>
is fired from a worker thread which updates, for example, button's <code>Enabled</code>
property). The solution of course is to store UI dispatcher somewhere in the
global space in your VM upon startup and then use it when updating the UI.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/net-c/" rel="tag">.net-c#</a></li>
            <li><a class="tag p-category" href="../../categories/backgroundworker/" rel="tag">backgroundworker</a></li>
            <li><a class="tag p-category" href="../../categories/multithreading/" rel="tag">multithreading</a></li>
            <li><a class="tag p-category" href="../../categories/wpf/" rel="tag">wpf</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../reference-requirements-txt-for-the-install-requires-kwarg-in-setuptools-setup-py-file/" rel="prev" title="Reference requirements.txt for the install_requires kwarg in setuptools setup.py file">Previous post</a>
            </li>
            <li class="next">
                <a href="../what-is-object-serialization/" rel="next" title="What is object serialization?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
