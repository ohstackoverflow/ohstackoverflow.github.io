<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Simple Digit Recognition OCR in OpenCV-Python | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/simple-digit-recognition-ocr-in-opencv-python/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../is-there-a-standardized-method-to-swap-two-variables-in-python/" title="Is there a standardized method to swap two variables in Python?" type="text/html">
<link rel="next" href="../what-s-the-difference-between-net-core-net-framework-and-xamarin/" title="What's the difference between .NET Core, .NET Framework, and Xamarin?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Simple Digit Recognition OCR in OpenCV-Python">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/simple-digit-recognition-ocr-in-opencv-python/">
<meta property="og:description" content='I am trying to implement a "Digit Recognition OCR" in OpenCV-Python (cv2). It
is just for learning purposes. I would like to learn both KNearest and SVM
features in OpenCV.
I have 100 samples (i.e. im'>
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T15:51:22+08:00">
<meta property="article:tag" content="computer-vision">
<meta property="article:tag" content="numpy">
<meta property="article:tag" content="ocr">
<meta property="article:tag" content="opencv">
<meta property="article:tag" content="python">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Simple Digit Recognition OCR in OpenCV-Python</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T15:51:22+08:00" itemprop="datePublished" title="2023-03-03 15:51">2023-03-03 15:51</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I am trying to implement a "Digit Recognition OCR" in OpenCV-Python (cv2). It
is just for learning purposes. I would like to learn both KNearest and SVM
features in OpenCV.</p>
<p>I have 100 samples (i.e. images) of each digit. I would like to train with
them.</p>
<p>There is a sample <code>letter_recog.py</code> that comes with OpenCV sample. But I still
couldn't figure out on how to use it. I don't understand what are the samples,
responses etc. Also, it loads a txt file at first, which I didn't understand
first.</p>
<p>Later on searching a little bit, I could find a letter_recognition.data in cpp
samples. I used it and made a code for cv2.KNearest in the model of
letter_recog.py (just for testing):</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="n">fn</span> <span class="o">=</span> <span class="s1">'letter-recognition.data'</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">loadtxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">','</span><span class="p">,</span> <span class="n">converters</span><span class="o">=</span><span class="p">{</span> <span class="mi">0</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">ch</span> <span class="p">:</span> <span class="nb">ord</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span><span class="o">-</span><span class="nb">ord</span><span class="p">(</span><span class="s1">'A'</span><span class="p">)</span> <span class="p">})</span>
<span class="n">samples</span><span class="p">,</span> <span class="n">responses</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:],</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">KNearest</span><span class="p">()</span>
<span class="n">retval</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span><span class="n">responses</span><span class="p">)</span>
<span class="n">retval</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">neigh_resp</span><span class="p">,</span> <span class="n">dists</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">results</span><span class="o">.</span><span class="kp">ravel</span><span class="p">()</span>
</pre></div>

<p>It gave me an array of size 20000, I don't understand what it is.</p>
<p><strong>Questions:</strong></p>
<p>1) What is letter_recognition.data file? How to build that file from my own
data set?</p>
<p>2) What does <code>results.reval()</code> denote?</p>
<p>3) How we can write a simple digit recognition tool using
letter_recognition.data file (either KNearest or SVM)?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Well, I decided to workout myself on my question to solve the above problem.
What I wanted is to implement a simple OCR using KNearest or SVM features in
OpenCV. And below is what I did and how. (it is just for learning how to use
KNearest for simple OCR purposes).</p>
<p><strong>1)</strong> My first question was about <code>letter_recognition.data</code> file that comes
with OpenCV samples. I wanted to know what is inside that file.</p>
<p>It contains a letter, along with 16 features of that letter.</p>
<p>And <code>this SOF</code> helped me to find it. These 16 features are explained in the
paper <strong><code>Letter Recognition Using Holland-Style Adaptive Classifiers</code></strong>.
(Although I didn't understand some of the features at the end)</p>
<p><strong>2)</strong> Since I knew, without understanding all those features, it is difficult
to do that method. I tried some other papers, but all were a little difficult
for a beginner.</p>
<p>So I just decided to take all the pixel values as my features. (I was not
worried about accuracy or performance, I just wanted it to work, at least with
the least accuracy)</p>
<p>I took the below image for my training data:</p>
<p><img alt="enter image description here" src="../../images/IwQY6.png"></p>
<p>(I know the amount of training data is less. But, since all letters are of the
same font and size, I decided to try on this).</p>
<p><strong>To prepare the data for training, I made a small code in OpenCV. It does the
following things:</strong></p>
<ol>
<li>It loads the image.</li>
<li>Selects the digits (obviously by contour finding and applying constraints on area and height of letters to avoid false detections).</li>
<li>Draws the bounding rectangle around one letter and wait for <code>key press manually</code>. This time we <strong>press the digit key ourselves</strong> corresponding to the letter in the box.</li>
<li>Once the corresponding digit key is pressed, it resizes this box to 10x10 and saves all 100 pixel values in an array (here, samples) and corresponding manually entered digit in another array(here, responses).</li>
<li>Then save both the arrays in separate <code>.txt</code> files.</li>
</ol>
<p>At the end of the manual classification of digits, all the digits in the
training data (<code>train.png</code>) are labeled manually by ourselves, image will look
like below:</p>
<p><img alt="enter image description here" src="../../images/jyAhT.png"></p>
<p>Below is the code I used for the above purpose (of course, not so clean):</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">'pitrain.png'</span><span class="p">)</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="kp">copy</span><span class="p">()</span>

<span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
<span class="n">blur</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span><span class="n">gray</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
<span class="n">thresh</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span><span class="n">blur</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#################      Now finding Contours         ###################</span>

<span class="n">contours</span><span class="p">,</span><span class="n">hierarchy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">RETR_LIST</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>

<span class="n">samples</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="kp">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">responses</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span><span class="mi">58</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">50</span><span class="p">:</span>
        <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>

        <span class="k">if</span>  <span class="n">h</span><span class="o">&gt;</span><span class="mi">28</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">im</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">roi</span> <span class="o">=</span> <span class="n">thresh</span><span class="p">[</span><span class="n">y</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">]</span>
            <span class="n">roismall</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="kp">resize</span><span class="p">(</span><span class="n">roi</span><span class="p">,(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">'norm'</span><span class="p">,</span><span class="n">im</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">27</span><span class="p">:</span>  <span class="c1"># (escape to quit)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="n">responses</span><span class="o">.</span><span class="kp">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
                <span class="kp">sample</span> <span class="o">=</span> <span class="n">roismall</span><span class="o">.</span><span class="kp">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
                <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">append</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span><span class="kp">sample</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="n">responses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">array</span><span class="p">(</span><span class="n">responses</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">responses</span><span class="o">.</span><span class="kp">reshape</span><span class="p">((</span><span class="n">responses</span><span class="o">.</span><span class="kp">size</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span> <span class="s2">"training complete"</span>

<span class="n">np</span><span class="o">.</span><span class="kp">savetxt</span><span class="p">(</span><span class="s1">'generalsamples.data'</span><span class="p">,</span><span class="n">samples</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="kp">savetxt</span><span class="p">(</span><span class="s1">'generalresponses.data'</span><span class="p">,</span><span class="n">responses</span><span class="p">)</span>
</pre></div>

<hr>
<p><strong>Now we enter in to training and testing part.</strong></p>
<p>For the testing part, I used the below image, which has the same type of
letters I used for the training phase.</p>
<p><img alt="enter image description here" src="../../images/dPaE8.png"></p>
<p><strong>For training we do as follows</strong> :</p>
<ol>
<li>Load the <code>.txt</code> files we already saved earlier</li>
<li>create an instance of the classifier we are using (it is KNearest in this case)</li>
<li>Then we use KNearest.train function to train the data</li>
</ol>
<p><strong>For testing purposes, we do as follows:</strong></p>
<ol>
<li>We load the image used for testing</li>
<li>process the image as earlier and extract each digit using contour methods</li>
<li>Draw a bounding box for it, then resize it to 10x10, and store its pixel values in an array as done earlier.</li>
<li>Then we use KNearest.find_nearest() function to find the nearest item to the one we gave. ( If lucky, it recognizes the correct digit.)</li>
</ol>
<p>I included last two steps (training and testing) in single code below:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1">#######   training part    ############### </span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">loadtxt</span><span class="p">(</span><span class="s1">'generalsamples.data'</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">loadtxt</span><span class="p">(</span><span class="s1">'generalresponses.data'</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">responses</span><span class="o">.</span><span class="kp">reshape</span><span class="p">((</span><span class="n">responses</span><span class="o">.</span><span class="kp">size</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">KNearest</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span><span class="n">responses</span><span class="p">)</span>

<span class="c1">############################# testing part  #########################</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">'pi.png'</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">zeros</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="kp">shape</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
<span class="n">thresh</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="n">contours</span><span class="p">,</span><span class="n">hierarchy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">thresh</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">RETR_LIST</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>

<span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">50</span><span class="p">:</span>
        <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>
        <span class="k">if</span>  <span class="n">h</span><span class="o">&gt;</span><span class="mi">28</span><span class="p">:</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">im</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">roi</span> <span class="o">=</span> <span class="n">thresh</span><span class="p">[</span><span class="n">y</span><span class="p">:</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">,</span><span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">]</span>
            <span class="n">roismall</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="kp">resize</span><span class="p">(</span><span class="n">roi</span><span class="p">,(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
            <span class="n">roismall</span> <span class="o">=</span> <span class="n">roismall</span><span class="o">.</span><span class="kp">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
            <span class="n">roismall</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">roismall</span><span class="p">)</span>
            <span class="n">retval</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">neigh_resp</span><span class="p">,</span> <span class="n">dists</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">roismall</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])))</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">string</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">'im'</span><span class="p">,</span><span class="n">im</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s1">'out'</span><span class="p">,</span><span class="n">out</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

<p>And it worked, below is the result I got:</p>
<p><img alt="enter image description here" src="../../images/xS3gF.png"></p>
<hr>
<p>Here it worked with 100% accuracy. I assume this is because all the digits are
of the same kind and the same size.</p>
<p>But anyway, this is a good start to go for beginners (I hope so).</p>
<p><br></p>
<h3>Suggest</h3>
<p>For those who interested in C++ code can refer below code. Thanks <strong>Abid
Rahman</strong> for the nice explanation.</p>
<hr>
<p>The procedure is same as above but, the contour finding uses only first
hierarchy level contour, so that the algorithm uses only outer contour for
each digit.</p>
<h3>Code for creating sample and Label data</h3>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="n">Process</span><span class="w"> </span><span class="nc">image</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">extract</span><span class="w"> </span><span class="n">contour</span>
<span class="n">Mat</span><span class="w"> </span><span class="n">thr</span><span class="p">,</span><span class="n">gray</span><span class="p">,</span><span class="n">con</span><span class="p">;</span>
<span class="n">Mat</span><span class="w"> </span><span class="n">src</span><span class="o">=</span><span class="n">imread</span><span class="p">(</span><span class="ss">"digit.png"</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">cvtColor</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">gray</span><span class="p">,</span><span class="n">CV_BGR2GRAY</span><span class="p">);</span>
<span class="n">threshold</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span><span class="n">thr</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="n">THRESH_BINARY_INV</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">Threshold</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">contour</span>
<span class="n">thr</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>

<span class="o">//</span><span class="w"> </span><span class="k">Create</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="k">data</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">vector</span><span class="w"> </span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">contours</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">storing</span><span class="w"> </span><span class="n">contour</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">Vec4i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">hierarchy</span><span class="p">;</span>
<span class="n">Mat</span><span class="w"> </span><span class="n">sample</span><span class="p">;</span>
<span class="n">Mat</span><span class="w"> </span><span class="n">response_array</span><span class="p">;</span><span class="w">  </span>
<span class="n">findContours</span><span class="p">(</span><span class="w"> </span><span class="n">con</span><span class="p">,</span><span class="w"> </span><span class="n">contours</span><span class="p">,</span><span class="w"> </span><span class="n">hierarchy</span><span class="p">,</span><span class="n">CV_RETR_CCOMP</span><span class="p">,</span><span class="w"> </span><span class="n">CV_CHAIN_APPROX_SIMPLE</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">Find</span><span class="w"> </span><span class="n">contour</span>

<span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="w"> </span><span class="n">contours</span><span class="p">.</span><span class="k">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">hierarchy</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">iterate</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="n">hierarchy</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="n">contours</span>
<span class="err">{</span>
<span class="w">    </span><span class="n">Rect</span><span class="w"> </span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="n">boundingRect</span><span class="p">(</span><span class="n">contours</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">Find</span><span class="w"> </span><span class="n">bounding</span><span class="w"> </span><span class="n">rect</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">contour</span>
<span class="w">    </span><span class="n">rectangle</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">Point</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">r</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="n">Point</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="n">r</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="n">r</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="n">r</span><span class="p">.</span><span class="n">height</span><span class="p">),</span><span class="w"> </span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">Mat</span><span class="w"> </span><span class="n">ROI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thr</span><span class="p">(</span><span class="n">r</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">Crop</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">image</span>
<span class="w">    </span><span class="n">Mat</span><span class="w"> </span><span class="n">tmp1</span><span class="p">,</span><span class="w"> </span><span class="n">tmp2</span><span class="p">;</span>
<span class="w">    </span><span class="n">resize</span><span class="p">(</span><span class="n">ROI</span><span class="p">,</span><span class="n">tmp1</span><span class="p">,</span><span class="w"> </span><span class="k">Size</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">INTER_LINEAR</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">resize</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">10</span><span class="n">X10</span>
<span class="w">    </span><span class="n">tmp1</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">tmp2</span><span class="p">,</span><span class="n">CV_32FC1</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="nf">convert</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nc">float</span>
<span class="w">    </span><span class="n">sample</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">tmp2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Store</span><span class="w">  </span><span class="n">sample</span><span class="w"> </span><span class="k">data</span>
<span class="w">    </span><span class="n">imshow</span><span class="p">(</span><span class="ss">"src"</span><span class="p">,</span><span class="n">src</span><span class="p">);</span>
<span class="w">    </span><span class="nc">int</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Read</span><span class="w"> </span><span class="k">corresponding</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">contour</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">keyoard</span>
<span class="w">    </span><span class="n">c</span><span class="o">-=</span><span class="mh">0x30</span><span class="p">;</span><span class="w">     </span><span class="o">//</span><span class="w"> </span><span class="nf">Convert</span><span class="w"> </span><span class="nf">ascii</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">intiger</span><span class="w"> </span><span class="k">value</span>
<span class="w">    </span><span class="n">response_array</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Store</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">mat</span>
<span class="w">    </span><span class="n">rectangle</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">Point</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">r</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="n">Point</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="n">r</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="n">r</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="n">r</span><span class="p">.</span><span class="n">height</span><span class="p">),</span><span class="w"> </span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w">    </span>
<span class="err">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">Store</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">file</span>
<span class="n">Mat</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="n">tmp</span><span class="p">;</span>
<span class="n">tmp</span><span class="o">=</span><span class="n">response_array</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="n">make</span><span class="w"> </span><span class="n">continuous</span>
<span class="n">tmp</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">response</span><span class="p">,</span><span class="n">CV_32FC1</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nf">Convert</span><span class="w">  </span><span class="k">to</span><span class="w"> </span><span class="nc">float</span>

<span class="n">FileStorage</span><span class="w"> </span><span class="k">Data</span><span class="p">(</span><span class="ss">"TrainingData.yml"</span><span class="p">,</span><span class="nl">FileStorage</span><span class="p">:</span><span class="err">:</span><span class="k">WRITE</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Store</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">file</span>
<span class="k">Data</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"data"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sample</span><span class="p">;</span>
<span class="k">Data</span><span class="p">.</span><span class="k">release</span><span class="p">();</span>

<span class="n">FileStorage</span><span class="w"> </span><span class="n">Label</span><span class="p">(</span><span class="ss">"LabelData.yml"</span><span class="p">,</span><span class="nl">FileStorage</span><span class="p">:</span><span class="err">:</span><span class="k">WRITE</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Store</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">file</span>
<span class="n">Label</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="ss">"label"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">response</span><span class="p">;</span>
<span class="n">Label</span><span class="p">.</span><span class="k">release</span><span class="p">();</span>
<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="ss">"Training and Label data created successfully....!! "</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

<span class="n">imshow</span><span class="p">(</span><span class="ss">"src"</span><span class="p">,</span><span class="n">src</span><span class="p">);</span>
<span class="n">waitKey</span><span class="p">();</span>
</pre></div>

<h3>Code for training and testing</h3>
<div class="code"><pre class="code literal-block"><span class="n">Mat</span><span class="w"> </span><span class="n">thr</span><span class="p">,</span><span class="n">gray</span><span class="p">,</span><span class="n">con</span><span class="p">;</span>
<span class="n">Mat</span><span class="w"> </span><span class="n">src</span><span class="o">=</span><span class="n">imread</span><span class="p">(</span><span class="ss">"dig.png"</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">cvtColor</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="n">gray</span><span class="p">,</span><span class="n">CV_BGR2GRAY</span><span class="p">);</span>
<span class="n">threshold</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span><span class="n">thr</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="n">THRESH_BINARY_INV</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Threshold</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">input</span>
<span class="n">thr</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">con</span><span class="p">);</span>


<span class="o">//</span><span class="w"> </span><span class="k">Read</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">training</span>
<span class="n">Mat</span><span class="w"> </span><span class="n">sample</span><span class="p">;</span>
<span class="n">Mat</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="n">tmp</span><span class="p">;</span>
<span class="n">FileStorage</span><span class="w"> </span><span class="k">Data</span><span class="p">(</span><span class="ss">"TrainingData.yml"</span><span class="p">,</span><span class="nl">FileStorage</span><span class="p">:</span><span class="err">:</span><span class="k">READ</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Read</span><span class="w"> </span><span class="n">traing</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Mat</span>
<span class="k">Data</span><span class="o">[</span><span class="n">"data"</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">sample</span><span class="p">;</span>
<span class="k">Data</span><span class="p">.</span><span class="k">release</span><span class="p">();</span>

<span class="n">FileStorage</span><span class="w"> </span><span class="n">Label</span><span class="p">(</span><span class="ss">"LabelData.yml"</span><span class="p">,</span><span class="nl">FileStorage</span><span class="p">:</span><span class="err">:</span><span class="k">READ</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Read</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Mat</span>
<span class="n">Label</span><span class="o">[</span><span class="n">"label"</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">response</span><span class="p">;</span>
<span class="n">Label</span><span class="p">.</span><span class="k">release</span><span class="p">();</span>


<span class="n">KNearest</span><span class="w"> </span><span class="n">knn</span><span class="p">;</span>
<span class="n">knn</span><span class="p">.</span><span class="n">train</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span><span class="n">response</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Train</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">responses</span>
<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="ss">"Training compleated.....!!"</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">vector</span><span class="w"> </span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">contours</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Vector</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">storing</span><span class="w"> </span><span class="n">contour</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="w"> </span><span class="n">Vec4i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">hierarchy</span><span class="p">;</span>

<span class="o">//</span><span class="k">Create</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">contour</span><span class="w"> </span><span class="n">finding</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">cropping</span>
<span class="n">findContours</span><span class="p">(</span><span class="w"> </span><span class="n">con</span><span class="p">,</span><span class="w"> </span><span class="n">contours</span><span class="p">,</span><span class="w"> </span><span class="n">hierarchy</span><span class="p">,</span><span class="n">CV_RETR_CCOMP</span><span class="p">,</span><span class="w"> </span><span class="n">CV_CHAIN_APPROX_SIMPLE</span><span class="w"> </span><span class="p">);</span>
<span class="n">Mat</span><span class="w"> </span><span class="n">dst</span><span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="k">rows</span><span class="p">,</span><span class="n">src</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span><span class="n">CV_8UC3</span><span class="p">,</span><span class="nl">Scalar</span><span class="p">:</span><span class="err">:</span><span class="ow">all</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

<span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="w"> </span><span class="n">contours</span><span class="p">.</span><span class="k">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">hierarchy</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">iterate</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="k">each</span><span class="w"> </span><span class="n">contour</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="n">hierarchy</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="p">.</span>
<span class="err">{</span>
<span class="w">    </span><span class="n">Rect</span><span class="w"> </span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="n">boundingRect</span><span class="p">(</span><span class="n">contours</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
<span class="w">    </span><span class="n">Mat</span><span class="w"> </span><span class="n">ROI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thr</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="n">Mat</span><span class="w"> </span><span class="n">tmp1</span><span class="p">,</span><span class="w"> </span><span class="n">tmp2</span><span class="p">;</span>
<span class="w">    </span><span class="n">resize</span><span class="p">(</span><span class="n">ROI</span><span class="p">,</span><span class="n">tmp1</span><span class="p">,</span><span class="w"> </span><span class="k">Size</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">INTER_LINEAR</span><span class="w"> </span><span class="p">);</span>
<span class="w">    </span><span class="n">tmp1</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">tmp2</span><span class="p">,</span><span class="n">CV_32FC1</span><span class="p">);</span>
<span class="w">    </span><span class="nc">float</span><span class="w"> </span><span class="n">p</span><span class="o">=</span><span class="n">knn</span><span class="p">.</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">tmp2</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="nc">char</span><span class="w"> </span><span class="n">name</span><span class="o">[</span><span class="n">4</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="n">sprintf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="ss">"%d"</span><span class="p">,(</span><span class="nc">int</span><span class="p">)</span><span class="n">p</span><span class="p">);</span>
<span class="w">    </span><span class="n">putText</span><span class="p">(</span><span class="w"> </span><span class="n">dst</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">Point</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">r</span><span class="p">.</span><span class="n">y</span><span class="o">+</span><span class="n">r</span><span class="p">.</span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">);</span>
<span class="err">}</span>

<span class="n">imshow</span><span class="p">(</span><span class="ss">"src"</span><span class="p">,</span><span class="n">src</span><span class="p">);</span>
<span class="n">imshow</span><span class="p">(</span><span class="ss">"dst"</span><span class="p">,</span><span class="n">dst</span><span class="p">);</span>
<span class="n">imwrite</span><span class="p">(</span><span class="ss">"dest.jpg"</span><span class="p">,</span><span class="n">dst</span><span class="p">);</span>
<span class="n">waitKey</span><span class="p">();</span>
</pre></div>

<h3>Result</h3>
<p>In the result the dot in the first line is detected as 8 and we haven’t
trained for dot. Also I am considering every contour in first hierarchy level
as the sample input, user can avoid it by computing the area.</p>
<p><img alt="Results" src="../../images/Hm0B8.jpg"></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/computer-vision/" rel="tag">computer-vision</a></li>
            <li><a class="tag p-category" href="../../categories/numpy/" rel="tag">numpy</a></li>
            <li><a class="tag p-category" href="../../categories/ocr/" rel="tag">ocr</a></li>
            <li><a class="tag p-category" href="../../categories/opencv/" rel="tag">opencv</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../is-there-a-standardized-method-to-swap-two-variables-in-python/" rel="prev" title="Is there a standardized method to swap two variables in Python?">Previous post</a>
            </li>
            <li class="next">
                <a href="../what-s-the-difference-between-net-core-net-framework-and-xamarin/" rel="next" title="What's the difference between .NET Core, .NET Framework, and Xamarin?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
