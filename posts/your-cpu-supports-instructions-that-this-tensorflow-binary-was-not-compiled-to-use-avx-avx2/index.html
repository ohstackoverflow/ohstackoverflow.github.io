<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX AVX2 | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/your-cpu-supports-instructions-that-this-tensorflow-binary-was-not-compiled-to-use-avx-avx2/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-do-i-call-a-parent-class-s-method-from-a-child-class-in-python/" title="How do I call a parent class's method from a child class in Python?" type="text/html">
<link rel="next" href="../what-do-the-star-and-double-star-operators-mean-in-a-function-call/" title="What do the * (star) and ** (double star) operators mean in a function call?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Your CPU supports instructions that this TensorFlow binary was not com">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/your-cpu-supports-instructions-that-this-tensorflow-binary-was-not-compiled-to-use-avx-avx2/">
<meta property="og:description" content="I have recently installed tensorflow (Windows CPU version) and received the
following message:

Successfully installed tensorflow-1.4.0 tensorflow-tensorboard-0.4.0rc2

Then when I tried to run
import">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T14:44:22+08:00">
<meta property="article:tag" content="avx">
<meta property="article:tag" content="cpu">
<meta property="article:tag" content="python">
<meta property="article:tag" content="tensorflow">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX AVX2</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T14:44:22+08:00" itemprop="datePublished" title="2023-02-17 14:44">2023-02-17 14:44</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I have recently installed tensorflow (Windows CPU version) and received the
following message:</p>
<blockquote>
<p>Successfully installed tensorflow-1.4.0 tensorflow-tensorboard-0.4.0rc2</p>
</blockquote>
<p>Then when I tried to run</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">hello</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="s1">'Hello, TensorFlow!'</span><span class="p">)</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">hello</span><span class="p">)</span>
<span class="s1">'Hello, TensorFlow!'</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
<span class="mi">42</span>
<span class="n">sess</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

<p>(which I found through https://github.com/tensorflow/tensorflow)</p>
<p>I received the following message:</p>
<blockquote>
<p>2017-11-02 01:56:21.698935: I C:\tf_jenkins\home\workspace\rel-
win\M\windows\PY\36\tensorflow\core\platform\cpu_feature_guard.cc:137] Your
CPU supports instructions that this TensorFlow binary was not compiled to
use: AVX AVX2</p>
</blockquote>
<p>But when I ran</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">hello</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="s1">'Hello, TensorFlow!'</span><span class="p">)</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">hello</span><span class="p">))</span>
</pre></div>

<p>it ran as it should and output <code>Hello, TensorFlow!</code>, which indicates that the
installation was successful indeed but there is something else that is wrong.</p>
<p>Do you know what the problem is and how to fix it?</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>What is this warning about?</h3>
<p>Modern CPUs provide a lot of low-level instructions, besides the usual
arithmetic and logic, known as extensions, e.g. SSE2, SSE4, AVX, etc. From the
Wikipedia:</p>
<blockquote>
<p><strong>Advanced Vector Extensions</strong> ( <strong>AVX</strong> ) are extensions to the x86
instruction set architecture for microprocessors from Intel and AMD proposed
by Intel in March 2008 and first supported by Intel with the Sandy Bridge
processor shipping in Q1 2011 and later on by AMD with the Bulldozer
processor shipping in Q3 2011. AVX provides new features, new instructions
and a new coding scheme.</p>
</blockquote>
<p>In particular, AVX introduces fused multiply-accumulate (FMA) operations,
which speed up linear algebra computation, namely dot-product, matrix
multiply, convolution, etc. Almost every machine-learning training involves a
great deal of these operations, hence will be faster on a CPU that supports
AVX and FMA (up to 300%). The warning states that your CPU does support AVX
(hooray!).</p>
<p>I'd like to stress here: it's all about <strong>CPU only</strong>.</p>
<h3>Why isn't it used then?</h3>
<p>Because tensorflow default distribution is built without CPU extensions, such
as SSE4.1, SSE4.2, AVX, AVX2, FMA, etc. The default builds (ones from <code>pip
install tensorflow</code>) are intended to be compatible with as many CPUs as
possible. Another argument is that even with these extensions CPU is a lot
slower than a GPU, and it's expected for medium- and large-scale machine-
learning training to be performed on a GPU.</p>
<h3>What should you do?</h3>
<p><strong>If you have a GPU</strong> , you shouldn't care about AVX support, because most
expensive ops will be dispatched on a GPU device (unless explicitly set not
to). In this case, you can simply ignore this warning by</p>
<div class="code"><pre class="code literal-block"><span class="c1"># Just disables the warning, doesn't take advantage of AVX/FMA to run faster</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'TF_CPP_MIN_LOG_LEVEL'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'2'</span>
</pre></div>

<p>... or by setting <code>export TF_CPP_MIN_LOG_LEVEL=2</code> if you're on Unix.
Tensorflow is working fine anyway, but you won't see these annoying warnings.</p>
<hr>
<p><strong>If you don't have a GPU</strong> and want to utilize CPU as much as possible, <strong>you
should build tensorflow from the source optimized for <em>your</em> CPU</strong> with AVX,
AVX2, and FMA enabled if your CPU supports them. It's been discussed in this
question and also this GitHub issue. Tensorflow uses an ad-hoc build system
called bazel and building it is not that trivial, but is certainly doable.
After this, not only will the warning disappear, tensorflow performance should
also improve.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Update the tensorflow binary for your CPU &amp; OS using this command</p>
<div class="code"><pre class="code literal-block"><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">--</span><span class="n">ignore</span><span class="o">-</span><span class="n">installed</span><span class="w"> </span><span class="o">--</span><span class="n">upgrade</span><span class="w"> </span><span class="s2">"Download URL"</span>
</pre></div>

<p>The download url of the whl file can be found here</p>
<p>https://github.com/lakshayg/tensorflow-build</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/avx/" rel="tag">avx</a></li>
            <li><a class="tag p-category" href="../../categories/cpu/" rel="tag">cpu</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/tensorflow/" rel="tag">tensorflow</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-do-i-call-a-parent-class-s-method-from-a-child-class-in-python/" rel="prev" title="How do I call a parent class's method from a child class in Python?">Previous post</a>
            </li>
            <li class="next">
                <a href="../what-do-the-star-and-double-star-operators-mean-in-a-function-call/" rel="next" title="What do the * (star) and ** (double star) operators mean in a function call?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
