<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Why is `[` better than `subset`? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/why-is-better-than-subset/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../why-do-all-the-c-files-written-by-my-lecturer-start-with-a-single-on-the-first-line/" title="Why do all the C files written by my lecturer start with a single # on the first line?" type="text/html">
<link rel="next" href="../shards-and-replicas-in-elasticsearch/" title="Shards and replicas in Elasticsearch" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Why is `[` better than `subset`?">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/why-is-better-than-subset/">
<meta property="og:description" content="When I need to filter a data.frame, i.e., extract rows that meet certain
conditions, I prefer to use the subset function:
subset(airquality, Month == 8 &amp; Temp &gt; 90)


Rather than the [ function:
airqu">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T12:53:26+08:00">
<meta property="article:tag" content="filter">
<meta property="article:tag" content="r">
<meta property="article:tag" content="r-faq">
<meta property="article:tag" content="subset">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Why is `[` better than `subset`?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T12:53:26+08:00" itemprop="datePublished" title="2023-03-03 12:53">2023-03-03 12:53</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>When I need to filter a data.frame, i.e., extract rows that meet certain
conditions, I prefer to use the <code>subset</code> function:</p>
<div class="code"><pre class="code literal-block">subset(airquality, Month == 8 &amp; Temp &gt; 90)
</pre></div>

<p>Rather than the <code>[</code> function:</p>
<div class="code"><pre class="code literal-block">airquality[airquality$Month == 8 &amp; airquality$Temp &gt; 90, ]
</pre></div>

<p>There are two main reasons for my preference:</p>
<ol>
<li>
<p>I find the code reads better, from left to right. Even people who know nothing about R could tell what the <code>subset</code> statement above is doing.</p>
</li>
<li>
<p>Because columns can be referred to as variables in the <code>select</code> expression, I can save a few keystrokes. In my example above, I only had to type <code>airquality</code> once with <code>subset</code>, but three times with <code>[</code>.</p>
</li>
</ol>
<p>So I was living happy, using <code>subset</code> everywhere because it is shorter and
reads better, even advocating its beauty to my fellow R coders. But yesterday
my world broke apart. While reading the <code>subset</code> documentation, I notice this
section:</p>
<blockquote>
<p>Warning</p>
<p>This is a convenience function intended for use interactively. For
programming it is better to use the standard subsetting functions like [,
and in particular the non-standard evaluation of argument subset can have
unanticipated consequences.</p>
</blockquote>
<p>Could someone help clarify what the authors mean?</p>
<p>First, what do they mean by " <em>for use interactively</em> "? I know what an
interactive session is, as opposed to a script run in BATCH mode but I don't
see what difference it should make.</p>
<p>Then, could you please explain " <em>the non-standard evaluation of argument
subset</em> " and why it is dangerous, maybe provide an example?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This question was answered in well in the comments by @James, pointing to an
excellent explanation by Hadley Wickham of the dangers of <code>subset</code> (and
functions like it) [here]. Go read it!</p>
<p>It's a somewhat long read, so it may be helpful to record here the example
that Hadley uses that most directly addresses the question of "what can go
wrong?":</p>
<p>Hadley suggests the following example: suppose we want to subset and then
reorder a data frame using the following functions:</p>
<div class="code"><pre class="code literal-block"><span class="n">scramble</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="nf">sample</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="w"> </span><span class="p">]</span>

<span class="n">subscramble</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">scramble</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="p">))</span>
<span class="p">}</span>

<span class="nf">subscramble</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">cyl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">4</span><span class="p">)</span>
</pre></div>

<p>This returns the error:</p>
<blockquote>
<p>Error in eval(expr, envir, enclos) : object 'cyl' not found</p>
</blockquote>
<p>because R no longer "knows" where to find the object called 'cyl'. He also
points out the truly bizarre stuff that can happen if by chance there is an
object called 'cyl' in the global environment:</p>
<div class="code"><pre class="code literal-block"><span class="n">cyl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">4</span>
<span class="nf">subscramble</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">cyl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">4</span><span class="p">)</span>

<span class="n">cyl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">rep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">T</span><span class="p">)</span>
<span class="nf">subscramble</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="n">cyl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">4</span><span class="p">)</span>
</pre></div>

<p>(Run them and see for yourself, it's pretty crazy.)</p>
<p><br></p>
<h3>Suggest</h3>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/filter/" rel="tag">filter</a></li>
            <li><a class="tag p-category" href="../../categories/r/" rel="tag">r</a></li>
            <li><a class="tag p-category" href="../../categories/r-faq/" rel="tag">r-faq</a></li>
            <li><a class="tag p-category" href="../../categories/subset/" rel="tag">subset</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../why-do-all-the-c-files-written-by-my-lecturer-start-with-a-single-on-the-first-line/" rel="prev" title="Why do all the C files written by my lecturer start with a single # on the first line?">Previous post</a>
            </li>
            <li class="next">
                <a href="../shards-and-replicas-in-elasticsearch/" rel="next" title="Shards and replicas in Elasticsearch">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
