<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Why did my Git repo enter a detached HEAD state? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/why-did-my-git-repo-enter-a-detached-head-state/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../uploading-both-data-and-files-in-one-form-using-ajax/" title="Uploading both data and files in one form using Ajax?" type="text/html">
<link rel="next" href="../how-do-i-define-a-method-which-takes-a-lambda-as-a-parameter-in-java-8/" title="How do I define a method which takes a lambda as a parameter in Java 8?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Why did my Git repo enter a detached HEAD state?">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/why-did-my-git-repo-enter-a-detached-head-state/">
<meta property="og:description" content="I ended up with a detached head today, the same problem as described in: git
push says everything up-to-date even though I have local changes
As far as I know I didn't do anything out of the ordinary,">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T09:15:35+08:00">
<meta property="article:tag" content="git">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Why did my Git repo enter a detached HEAD state?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T09:15:35+08:00" itemprop="datePublished" title="2023-03-03 09:15">2023-03-03 09:15</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I ended up with a detached head today, the same problem as described in: git
push says everything up-to-date even though I have local changes</p>
<p>As far as I know I didn't do anything out of the ordinary, just commits and
pushes from my local repo.</p>
<p>So how did I end up with a <code>detached HEAD</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Any checkout of a commit that is not the name of one of <em>your</em> branches will
get you a detached HEAD. A SHA1 which represents the tip of a branch still
gives a detached HEAD. Only a checkout of a local branch <em>name</em> avoids that
mode.</p>
<p>See committing with a detached HEAD</p>
<blockquote>
<p>When HEAD is detached, commits work like normal, except no named branch gets
updated. (You can think of this as an anonymous branch.)</p>
</blockquote>
<p><img alt="alt text" src="../../images/YwJDh.png"></p>
<p>For example, if you checkout a "remote branch" without tracking it first, you
can end up with a detached HEAD.</p>
<p>See git: switch branch without detaching head</p>
<p>Meaning: <code>git checkout origin/main</code> (or <code>origin/master</code> in the old days) would
result in:</p>
<div class="code"><pre class="code literal-block"><span class="n">Note</span><span class="o">:</span><span class="w"> </span><span class="n">switching</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s1">'origin/main'</span><span class="o">.</span>

<span class="n">You</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s1">'detached HEAD'</span><span class="w"> </span><span class="n">state</span><span class="o">.</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">look</span><span class="w"> </span><span class="n">around</span><span class="o">,</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">experimental</span>
<span class="n">changes</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">commit</span><span class="w"> </span><span class="n">them</span><span class="o">,</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">discard</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">commits</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">this</span>
<span class="n">state</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">impacting</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">branches</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">switching</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">branch</span><span class="o">.</span>

<span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">retain</span><span class="w"> </span><span class="n">commits</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">create</span><span class="o">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">may</span>
<span class="k">do</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="o">(</span><span class="n">now</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">later</span><span class="o">)</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="n">command</span><span class="o">.</span><span class="w"> </span><span class="n">Example</span><span class="o">:</span>

<span class="w">  </span><span class="n">git</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="o">&lt;</span><span class="k">new</span><span class="o">-</span><span class="n">branch</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>

<span class="n">Or</span><span class="w"> </span><span class="n">undo</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="k">with</span><span class="o">:</span>

<span class="w">  </span><span class="n">git</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="o">-</span>

<span class="n">Turn</span><span class="w"> </span><span class="n">off</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">advice</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">setting</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="n">advice</span><span class="o">.</span><span class="na">detachedHead</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="kc">false</span>

<span class="n">HEAD</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">a1b2c3d</span><span class="w"> </span><span class="n">My</span><span class="w"> </span><span class="n">commit</span><span class="w"> </span><span class="n">message</span>
</pre></div>

<p>That is why you should not use <code>git checkout</code> anymore, but the new <code>git
switch</code> command.</p>
<p>With <code>git switch</code>, the same attempt to "checkout" (switch to) a remote branch
would fail immediately:</p>
<div class="code"><pre class="code literal-block">git switch origin/main
fatal: a branch is expected, got remote branch 'origin/main'
</pre></div>

<hr>
<p>To add more on <code>git switch</code>:</p>
<p>With Git 2.23 (August 2019), you don't have to use the confusing <code>git
checkout</code> command anymore.</p>
<p><code>git switch</code> can also checkout a branch, and get a detach HEAD, except:</p>
<ul>
<li>it has an explicit <code>--detach</code> option</li>
</ul>
<blockquote>
<p>To check out commit <code>HEAD~3</code> for temporary inspection or experiment without
creating a new branch:</p>
<div class="code"><pre class="code literal-block">git switch --detach HEAD~3
HEAD is now at 9fc9555312 Merge branch 'cc/shared-index-permbits'
</pre></div>

</blockquote>
<ul>
<li>it cannot detached by mistake a remote tracking branch</li>
</ul>
<p>See:</p>
<div class="code"><pre class="code literal-block">C:\Users\vonc\arepo&gt;git checkout origin/master
Note: switching to 'origin/master'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by switching back to a branch.
</pre></div>

<p>Vs. using the new <code>git switch</code> command:</p>
<div class="code"><pre class="code literal-block">C:\Users\vonc\arepo&gt;git switch origin/master
fatal: a branch is expected, got remote branch 'origin/master'
</pre></div>

<p>If you wanted to create a new local branch tracking a remote branch:</p>
<div class="code"><pre class="code literal-block">git switch &lt;branch&gt;
</pre></div>

<blockquote>
<p>If <code>&lt;branch&gt;</code> is not found but there does exist a tracking branch in exactly
one remote (call it <code>&lt;remote&gt;</code>) with a matching name, treat as equivalent to</p>
<div class="code"><pre class="code literal-block">git switch -c &lt;branch&gt; --track &lt;remote&gt;/&lt;branch&gt;
</pre></div>

</blockquote>
<p>No more mistake!<br>
No more unwanted detached HEAD!</p>
<p>And if you <code>git switch &lt;tag&gt;</code> instead of <code>git switch --detach &lt;tag&gt;</code>, Git 2.36
will help you to remember the missing <code>--detach</code> option.</p>
<p><br></p>
<h3>Suggest</h3>
<p><strong>I reproduced this just now by accident:</strong></p>
<ol>
<li>
<p>lists the remote branches</p>
<div class="code"><pre class="code literal-block">git branch -r
  origin/Feature/f1234
  origin/master
</pre></div>

</li>
<li>
<p>I want to checkout one locally, so I cut paste:</p>
<div class="code"><pre class="code literal-block">git checkout origin/Feature/f1234
</pre></div>

</li>
<li>
<p>Presto! Detached HEAD state</p>
<div class="code"><pre class="code literal-block">You are in 'detached HEAD' state. [...])
</pre></div>

</li>
</ol>
<hr>
<p><strong>Solution #1:</strong></p>
<p>Do not include <code>origin/</code> at the front of my branch spec when checking it out:</p>
<div class="code"><pre class="code literal-block">git checkout Feature/f1234
</pre></div>

<p><strong>Solution #2:</strong></p>
<p>Add <code>-b</code> parameter which creates a local branch from the remote</p>
<p><code>git checkout -b origin/Feature/f1234</code> or</p>
<p><code>git checkout -b Feature/f1234</code> it will fall back to origin automatically</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/git/" rel="tag">git</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../uploading-both-data-and-files-in-one-form-using-ajax/" rel="prev" title="Uploading both data and files in one form using Ajax?">Previous post</a>
            </li>
            <li class="next">
                <a href="../how-do-i-define-a-method-which-takes-a-lambda-as-a-parameter-in-java-8/" rel="next" title="How do I define a method which takes a lambda as a parameter in Java 8?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
