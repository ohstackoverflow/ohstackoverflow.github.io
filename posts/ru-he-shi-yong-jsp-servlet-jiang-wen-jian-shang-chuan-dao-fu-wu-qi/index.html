<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>如何使用 JSP/Servlet 将文件上传到服务器？ | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/ru-he-shi-yong-jsp-servlet-jiang-wen-jian-shang-chuan-dao-fu-wu-qi/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../sql-server-shu-ju-lei-xing-de-c-deng-jie-wu/" title="SQL Server 数据类型的 C# 等价物" type="text/html">
<link rel="next" href="../wei-shi-yao-wo-de-uitableview-de-ding-bu-you-e-wai-de-tian-chong-zai-ios7-zhong-ju-you-uitableviewstylegrouped-yang-shi/" title="为什么我的 UITableView 的顶部有额外的填充，在 iOS7 中具有 UITableViewStyleGrouped 样式" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="如何使用 JSP/Servlet 将文件上传到服务器？">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/ru-he-shi-yong-jsp-servlet-jiang-wen-jian-shang-chuan-dao-fu-wu-qi/">
<meta property="og:description" content='如何使用 JSP/Servlet 将文件上传到服务器？
我试过这个：
&lt;form action="upload" method="post"&gt;
    &lt;input type="text" name="description" /&gt;
    &lt;input type="file" name="file" /&gt;
    &lt;input type="submit" /&gt;
&lt;/form&gt;


但是，我只得到'>
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T16:55:12+08:00">
<meta property="article:tag" content="file-upload">
<meta property="article:tag" content="jakarta-ee">
<meta property="article:tag" content="java">
<meta property="article:tag" content="jsp">
<meta property="article:tag" content="servlets">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">如何使用 JSP/Servlet 将文件上传到服务器？</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:55:12+08:00" itemprop="datePublished" title="2023-02-17 16:55">2023-02-17 16:55</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>如何使用 JSP/Servlet 将文件上传到服务器？</p>
<p>我试过这个：</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">"upload"</span><span class="w"> </span><span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"text"</span><span class="w"> </span><span class="na">name=</span><span class="s">"description"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"file"</span><span class="w"> </span><span class="na">name=</span><span class="s">"file"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"submit"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>

<p>但是，我只得到文件名，没有得到文件内容。当我添加<code>enctype="multipart/form-
data"</code>到<code>&lt;form&gt;</code>，然后<code>request.getParameter()</code>返回<code>null</code>。</p>
<p>在研究过程中，我偶然发现了Apache Common FileUpload。我试过这个：</p>
<div class="code"><pre class="code literal-block"><span class="n">FileItemFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DiskFileItemFactory</span><span class="p">();</span>
<span class="n">ServletFileUpload</span><span class="w"> </span><span class="n">upload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ServletFileUpload</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<span class="n">List</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">upload</span><span class="o">.</span><span class="n">parseRequest</span><span class="p">(</span><span class="n">request</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">died</span><span class="o">.</span>
</pre></div>

<p>不幸的是，servlet 抛出了一个没有明确消息和原因的异常。这是堆栈跟踪：</p>
<div class="code"><pre class="code literal-block"><span class="n">SEVERE</span><span class="p">:</span><span class="w"> </span><span class="n">Servlet</span><span class="o">.</span><span class="n">service</span><span class="p">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">servlet</span><span class="w"> </span><span class="n">UploadServlet</span><span class="w"> </span><span class="n">threw</span><span class="w"> </span><span class="n">exception</span>
<span class="n">javax</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">ServletException</span><span class="p">:</span><span class="w"> </span><span class="n">Servlet</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">threw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">exception</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">ApplicationFilterChain</span><span class="o">.</span><span class="n">internalDoFilter</span><span class="p">(</span><span class="n">ApplicationFilterChain</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">313</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">ApplicationFilterChain</span><span class="o">.</span><span class="n">doFilter</span><span class="p">(</span><span class="n">ApplicationFilterChain</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">206</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StandardWrapperValve</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">StandardWrapperValve</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">233</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StandardContextValve</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">StandardContextValve</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">191</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StandardHostValve</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">StandardHostValve</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">127</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">valves</span><span class="o">.</span><span class="n">ErrorReportValve</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">ErrorReportValve</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">102</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StandardEngineValve</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">StandardEngineValve</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">109</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">CoyoteAdapter</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="n">CoyoteAdapter</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">298</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">coyote</span><span class="o">.</span><span class="n">http11</span><span class="o">.</span><span class="n">Http11Processor</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">Http11Processor</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">852</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">coyote</span><span class="o">.</span><span class="n">http11</span><span class="o">.</span><span class="n">Http11Protocol</span><span class="o">$</span><span class="n">Http11ConnectionHandler</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">Http11Protocol</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">588</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">tomcat</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">JIoEndpoint</span><span class="o">$</span><span class="n">Worker</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">JIoEndpoint</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">489</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Thread</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">637</span><span class="p">)</span>
</pre></div>

<p><br><br></p>
<h2>解答</h2>
<h3>介绍</h3>
<p>要浏览并选择要上传的文件，您需要<code>&lt;input type="file"&gt;</code>在表单中有一个 HTML 字段。正如HTML
规范中所述，您必须使用该<code>POST</code>方法，并且<code>enctype</code>必须将表单的属性设置为<code>"multipart/form-data"</code>.</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">"upload"</span><span class="w"> </span><span class="na">method=</span><span class="s">"post"</span><span class="w"> </span><span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"text"</span><span class="w"> </span><span class="na">name=</span><span class="s">"description"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"file"</span><span class="w"> </span><span class="na">name=</span><span class="s">"file"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"submit"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>

<p>提交这样的表单后，二进制多部分表单数据在请求正文中以与未设置时不同的格式提供。<code>enctype</code></p>
<p>在 Servlet 3.0（2009 年 12 月）之前，Servlet API 本身并不支持<code>multipart/form-data</code>.
它仅支持默认形式的 enctype <code>application/x-www-form-
urlencoded</code>。使用多部分表单数据时，和consorts<code>request.getParameter()</code>都会返回。<code>null</code>这就是著名的Apache
Commons FileUpload出现的地方。</p>
<h3>不要手动解析它！</h3>
<p>理论上你可以根据
自己解析请求体<code>ServletRequest#getInputStream()</code>。然而，这是一项精确而乏味的工作，需要对RFC2388有准确的了解。您不应该尝试自己执行此操作或复制粘贴在
Internet 其他地方找到的一些本地开发的无库代码。许多在线资源在这方面都失败了，例如 roseindia.net。另请参阅上传 pdf
文件。您应该使用数百万用户多年来使用（并隐式测试！）的真实库。这样的库已经证明了它的健壮性。</p>
<h3>当您已经使用 Servlet 3.0 或更新版本时，请使用本机 API</h3>
<p>如果您至少使用 Servlet 3.0（Tomcat 7、Jetty 9、JBoss AS 6、GlassFish 3 等，它们自 2010
年以来就已经存在），那么您可以只使用提供的标准 API
来收集各个多部分表单数据项（<code>HttpServletRequest#getPart()</code>大多数为此，Servlet 3.0 实现 <em>实际上</em> 在幕后使用
Apache Commons FileUpload！）。<code>getParameter()</code>此外，正常的表单字段可以通过通常的方式获得。</p>
<p>首先注释您的 servlet，<code>@MultipartConfig</code>以便让它识别和支持<code>multipart/form-
data</code>请求，从而开始<code>getPart()</code>工作：</p>
<div class="code"><pre class="code literal-block"><span class="err">@</span><span class="n">WebServlet</span><span class="p">(</span><span class="s2">"/upload"</span><span class="p">)</span>
<span class="err">@</span><span class="n">MultipartConfig</span>
<span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">UploadServlet</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">HttpServlet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>
<span class="p">}</span>
</pre></div>

<p>然后，按如下方式实现它<code>doPost()</code>：</p>
<div class="code"><pre class="code literal-block"><span class="nv">protected</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">doPost</span><span class="ss">(</span><span class="nv">HttpServletRequest</span><span class="w"> </span><span class="nv">request</span>,<span class="w"> </span><span class="nv">HttpServletResponse</span><span class="w"> </span><span class="nv">response</span><span class="ss">)</span><span class="w"> </span><span class="nv">throws</span><span class="w"> </span><span class="nv">ServletException</span>,<span class="w"> </span><span class="nv">IOException</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">String</span><span class="w"> </span><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">request</span>.<span class="nv">getParameter</span><span class="ss">(</span><span class="s2">"description"</span><span class="ss">)</span><span class="c1">; // Retrieves &lt;input type="text" name="description"&gt;</span>
<span class="w">    </span><span class="nv">Part</span><span class="w"> </span><span class="nv">filePart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">request</span>.<span class="nv">getPart</span><span class="ss">(</span><span class="s2">"file"</span><span class="ss">)</span><span class="c1">; // Retrieves &lt;input type="file" name="file"&gt;</span>
<span class="w">    </span><span class="nv">String</span><span class="w"> </span><span class="nv">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Paths</span>.<span class="nv">get</span><span class="ss">(</span><span class="nv">filePart</span>.<span class="nv">getSubmittedFileName</span><span class="ss">())</span>.<span class="nv">getFileName</span><span class="ss">()</span>.<span class="nv">toString</span><span class="ss">()</span><span class="c1">; // MSIE fix.</span>
<span class="w">    </span><span class="nv">InputStream</span><span class="w"> </span><span class="nv">fileContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">filePart</span>.<span class="nv">getInputStream</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span>...<span class="w"> </span><span class="ss">(</span><span class="k">do</span><span class="w"> </span><span class="nv">your</span><span class="w"> </span><span class="nv">job</span><span class="w"> </span><span class="nv">here</span><span class="ss">)</span>
}
</pre></div>

<p>注意<code>Path#getFileName()</code>. 这是关于获取文件名的 MSIE 修复。此浏览器错误地发送完整的文件路径以及名称，而不是仅发送文件名。</p>
<p>如果您想通过任一方式上传多个文件<code>multiple="true"</code>，</p>
<div class="code"><pre class="code literal-block">&lt;input type="file" name="files" multiple="true" /&gt;
</pre></div>

<p>或具有多个输入的老式方式，</p>
<div class="code"><pre class="code literal-block">&lt;input type="file" name="files" /&gt;
&lt;input type="file" name="files" /&gt;
&lt;input type="file" name="files" /&gt;
...
</pre></div>

<p>然后你可以按照下面的方式收集它们（不幸的是没有这样的方法<code>request.getParts("files")</code>）：</p>
<div class="code"><pre class="code literal-block"><span class="n">protected</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Part</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fileParts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">getParts</span><span class="p">().</span><span class="n">stream</span><span class="p">().</span><span class="n">filter</span><span class="p">(</span><span class="n">part</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">"files"</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="n">part</span><span class="p">.</span><span class="n">getName</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">part</span><span class="p">.</span><span class="n">getSize</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="n">toList</span><span class="p">());</span><span class="w"> </span><span class="c1">// Retrieves &lt;input type="file" name="files" multiple="true"&gt;</span>

<span class="w">    </span><span class="n">for</span><span class="w"> </span><span class="p">(</span><span class="n">Part</span><span class="w"> </span><span class="n">filePart</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fileParts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">String</span><span class="w"> </span><span class="n">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Paths</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">filePart</span><span class="p">.</span><span class="n">getSubmittedFileName</span><span class="p">()).</span><span class="n">getFileName</span><span class="p">().</span><span class="n">toString</span><span class="p">();</span><span class="w"> </span><span class="c1">// MSIE fix.</span>
<span class="w">        </span><span class="n">InputStream</span><span class="w"> </span><span class="n">fileContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filePart</span><span class="p">.</span><span class="n">getInputStream</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// ... (do your job here)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3>当你还没有使用 Servlet 3.1 时，手动获取提交的文件名</h3>
<p>请注意，这<code>Part#getSubmittedFileName()</code>是在 Servlet 3.1 中引入的（Tomcat 8、Jetty 9、WildFly
8、GlassFish 4 等，它们自 2013 年以来就已经存在）。如果您还没有使用 Servlet
3.1（真的吗？），那么您需要一个额外的实用方法来获取提交的文件名。</p>
<div class="code"><pre class="code literal-block"><span class="nv">private</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">getSubmittedFileName</span><span class="ss">(</span><span class="nv">Part</span><span class="w"> </span><span class="nv">part</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">String</span><span class="w"> </span><span class="nv">cd</span><span class="w"> </span>:<span class="w"> </span><span class="nv">part</span>.<span class="nv">getHeader</span><span class="ss">(</span><span class="s2">"content-disposition"</span><span class="ss">)</span>.<span class="nv">split</span><span class="ss">(</span><span class="s2">";"</span><span class="ss">))</span><span class="w"> </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">cd</span>.<span class="nv">trim</span><span class="ss">()</span>.<span class="nv">startsWith</span><span class="ss">(</span><span class="s2">"filename"</span><span class="ss">))</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">String</span><span class="w"> </span><span class="nv">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cd</span>.<span class="nv">substring</span><span class="ss">(</span><span class="nv">cd</span>.<span class="nv">indexOf</span><span class="ss">(</span><span class="s1">'='</span><span class="ss">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span>.<span class="nv">trim</span><span class="ss">()</span>.<span class="nv">replace</span><span class="ss">(</span><span class="s2">"\"", "</span><span class="err">");</span>
<span class="err">            return fileName.substring(fileName.lastIndexOf('/') + 1).substring(fileName.lastIndexOf('\\') + 1); // MSIE fix.</span>
<span class="err">        }</span>
<span class="err">    }</span>
<span class="err">    return null;</span>
<span class="err">}</span>



<span class="err">String fileName = getSubmittedFileName(filePart);</span>
</pre></div>

<p>请注意有关获取文件名的 MSIE 修复程序。此浏览器错误地发送完整的文件路径以及名称，而不是仅发送文件名。</p>
<h3>如果您还没有使用 Servlet 3.0，请使用 Apache Commons FileUpload</h3>
<p>如果您还没有使用 Servlet 3.0（是不是该升级了？它是十多年前发布的！），通常的做法是使用Apache Commons
FileUpload来解析多部分表单数据请求。它有出色的用户指南和常见问题解答（请仔细阅读）。还有 O'Reilly (" cos ")
<code>MultipartRequest</code>，但它有一些（小）错误，多年来不再积极维护。我不推荐使用它。Apache Commons FileUpload
仍在积极维护，目前非常成熟。</p>
<p>为了使用 Apache Commons FileUpload，您的 webapp 中至少需要有以下文件<code>/WEB-INF/lib</code>：</p>
<ul>
<li><code>commons-fileupload.jar</code></li>
<li><code>commons-io.jar</code></li>
</ul>
<p>您最初的尝试很可能失败了，因为您忘记了公共 IO。</p>
<p>以下是使用 Apache Commons FileUpload 时的<code>doPost()</code>启动示例：<code>UploadServlet</code></p>
<div class="code"><pre class="code literal-block"><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">FileItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ServletFileUpload</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">DiskFileItemFactory</span><span class="p">())</span><span class="o">.</span><span class="n">parseRequest</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FileItem</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">isFormField</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">Process</span><span class="w"> </span><span class="n">regular</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"text|radio|checkbox|etc"</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="p">)</span><span class="o">.</span>
<span class="w">                </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">fieldName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">getFieldName</span><span class="p">();</span>
<span class="w">                </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">fieldValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">getString</span><span class="p">();</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">(</span><span class="n">do</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">job</span><span class="w"> </span><span class="n">here</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">Process</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"file"</span><span class="p">)</span><span class="o">.</span>
<span class="w">                </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">fieldName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">getFieldName</span><span class="p">();</span>
<span class="w">                </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FilenameUtils</span><span class="o">.</span><span class="n">getName</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getName</span><span class="p">());</span>
<span class="w">                </span><span class="n">InputStream</span><span class="w"> </span><span class="n">fileContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">();</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">(</span><span class="n">do</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">job</span><span class="w"> </span><span class="n">here</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileUploadException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ServletException</span><span class="p">(</span><span class="s2">"Cannot parse multipart request."</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>
<span class="p">}</span>
</pre></div>

<p>非常重要的是，您不要事先对同一个请求调用<code>getParameter()</code>, <code>getParameterMap()</code>,
<code>getParameterValues()</code>, <code>getInputStream()</code>,等。<code>getReader()</code>否则 servlet
容器将读取并解析请求主体，因此 Apache Commons FileUpload 将获得一个空请求主体。另见 ao
ServletFileUpload#parseRequest(request) returns an empty list。</p>
<p>注意<code>FilenameUtils#getName()</code>. 这是关于获取文件名的 MSIE
修复。此浏览器错误地发送完整的文件路径以及名称，而不是仅发送文件名。</p>
<p>或者，您也可以将所有内容<code>Filter</code>包装在一个自动解析所有内容并将内容放回请求的参数映射中，以便您可以继续使用<code>request.getParameter()</code>通常的方式并通过
检索上传的文件<code>request.getAttribute()</code>。您可以在这篇博客文章中找到示例。</p>
<h3>
<code>getParameter()</code>仍然返回的GlassFish3 错误的解决方法<code>null</code>
</h3>
<p>请注意，早于 3.1.2 的 Glassfish 版本有一个错误，其中<code>getParameter()</code>仍然会返回<code>null</code>.
<code>getPart()</code>如果您的目标是这样的容器并且无法升级它，那么您需要借助此实用程序方法从中提取值：</p>
<div class="code"><pre class="code literal-block"><span class="nv">private</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">getValue</span><span class="ss">(</span><span class="nv">Part</span><span class="w"> </span><span class="nv">part</span><span class="ss">)</span><span class="w"> </span><span class="nv">throws</span><span class="w"> </span><span class="nv">IOException</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">BufferedReader</span><span class="w"> </span><span class="nv">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">BufferedReader</span><span class="ss">(</span><span class="nv">new</span><span class="w"> </span><span class="nv">InputStreamReader</span><span class="ss">(</span><span class="nv">part</span>.<span class="nv">getInputStream</span><span class="ss">()</span>,<span class="w"> </span><span class="s2">"UTF-8"</span><span class="ss">))</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">StringBuilder</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">StringBuilder</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">char</span>[]<span class="w"> </span><span class="nv">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">char</span>[<span class="mi">1024</span>]<span class="c1">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">int</span><span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="c1">; (length = reader.read(buffer)) &gt; 0;) {</span>
<span class="w">        </span><span class="nv">value</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">buffer</span>,<span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="nv">length</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">value</span>.<span class="nv">toString</span><span class="ss">()</span><span class="c1">;</span>
}



<span class="nv">String</span><span class="w"> </span><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">getValue</span><span class="ss">(</span><span class="nv">request</span>.<span class="nv">getPart</span><span class="ss">(</span><span class="s2">"description"</span><span class="ss">))</span><span class="c1">; // Retrieves &lt;input type="text" name="description"&gt;</span>
</pre></div>

<h3>保存上传的文件（不要使用<code>getRealPath()</code>nor <code>part.write()</code>！）</h3>
<p>有关将获得的<code>InputStream</code>（<code>fileContent</code>如上述代码片段所示的变量）正确保存到磁盘或数据库的详细信息，请参阅以下答案：</p>
<ul>
<li>在 servlet 应用程序中保存上传文件的推荐方法</li>
<li>如何上传图片并将其保存在数据库中？</li>
<li>如何将 Part 转换为 Blob，以便将其存储在 MySQL 中？</li>
</ul>
<h3>服务上传的文件</h3>
<p>有关将保存的文件从磁盘或数据库正确提供回客户端的详细信息，请参阅以下答案：</p>
<ul>
<li>使用 <graphicimage> 或 <img> 标签从 webapps / webcontext / deploy 文件夹外部加载图像</graphicimage>
</li>
<li>如何在 JSP 页面中从数据库中检索和显示图像？</li>
<li>在 Java Web 应用程序中从应用程序服务器外部提供静态数据的最简单方法</li>
<li>支持HTTP缓存的静态资源servlet抽象模板</li>
</ul>
<h3>Ajax化表单</h3>
<p>Head to the following answers how to upload using Ajax (and jQuery). Do note
that the servlet code to collect the form data does not need to be changed for
this! Only the way how you respond may be changed, but this is rather trivial
(i.e. instead of forwarding to JSP, just print some JSON or XML or even plain
text depending on whatever the script responsible for the Ajax call is
expecting).</p>
<ul>
<li>How can I upload files to a server using JSP/Servlet and Ajax?</li>
<li>Send a file as multipart through XMLHttpRequest</li>
<li>HTML5 drag and drop file upload to Java Servlet</li>
</ul>
<hr>
<p>Hope this all helps :)</p>
<p><br></p>
<h3>更多建议</h3>
<p>如果您碰巧使用Spring MVC，这就是方法（我将其留在此处以防有人发现它有用）：</p>
<p><code>enctype</code>使用属性设置为“ ”的表单（与BalusC 的答案<code>multipart/form-data</code>相同）：</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">"upload"</span><span class="w"> </span><span class="na">method=</span><span class="s">"post"</span><span class="w"> </span><span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"file"</span><span class="w"> </span><span class="na">name=</span><span class="s">"file"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"submit"</span><span class="w"> </span><span class="na">value=</span><span class="s">"Upload"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>

<p>在您的控制器中，将请求参数映射<code>file</code>到<code>MultipartFile</code>类型如下：</p>
<div class="code"><pre class="code literal-block"><span class="err">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/upload"</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequestMethod</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
<span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">handleUpload</span><span class="p">(</span><span class="err">@</span><span class="n">RequestParam</span><span class="p">(</span><span class="s2">"file"</span><span class="p">)</span><span class="w"> </span><span class="n">MultipartFile</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">.</span><span class="n">getBytes</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">alternatively</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">();</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="n">logic</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><code>MultipartFile</code>您可以使用's<code>getOriginalFilename()</code>和获取文件名和大小<code>getSize()</code>。</p>
<p>我已经用 Spring 版本对此进行了测试<code>4.1.1.RELEASE</code>。</p>
<p><br><br><a href="../how-can-i-upload-files-to-a-server-using-jsp-servlet/">查看原文</a></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/file-upload/" rel="tag">file-upload</a></li>
            <li><a class="tag p-category" href="../../categories/jakarta-ee/" rel="tag">jakarta-ee</a></li>
            <li><a class="tag p-category" href="../../categories/java/" rel="tag">java</a></li>
            <li><a class="tag p-category" href="../../categories/jsp/" rel="tag">jsp</a></li>
            <li><a class="tag p-category" href="../../categories/servlets/" rel="tag">servlets</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../sql-server-shu-ju-lei-xing-de-c-deng-jie-wu/" rel="prev" title="SQL Server 数据类型的 C# 等价物">Previous post</a>
            </li>
            <li class="next">
                <a href="../wei-shi-yao-wo-de-uitableview-de-ding-bu-you-e-wai-de-tian-chong-zai-ios7-zhong-ju-you-uitableviewstylegrouped-yang-shi/" rel="next" title="为什么我的 UITableView 的顶部有额外的填充，在 iOS7 中具有 UITableViewStyleGrouped 样式">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
