<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Join/Where with LINQ and Lambda | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/join-where-with-linq-and-lambda/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../what-is-the-purpose-of-the-html-no-js-class/" title='What is the purpose of the HTML "no-js" class?' type="text/html">
<link rel="next" href="../how-do-i-force-sublime-text-to-indent-two-spaces-per-tab/" title="How do I force Sublime Text to indent two spaces per tab?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Join/Where with LINQ and Lambda">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/join-where-with-linq-and-lambda/">
<meta property="og:description" content="I'm having trouble with a query written in LINQ and Lambda. So far, I'm
getting a lot of errors here's my code:
int id = 1;
var query = database.Posts.Join(database.Post_Metas,
                       ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-18T05:18:45+08:00">
<meta property="article:tag" content=".net-c#">
<meta property="article:tag" content="join">
<meta property="article:tag" content="lambda">
<meta property="article:tag" content="linq">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Join/Where with LINQ and Lambda</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T05:18:45+08:00" itemprop="datePublished" title="2023-02-18 05:18">2023-02-18 05:18</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I'm having trouble with a query written in LINQ and Lambda. So far, I'm
getting a lot of errors here's my code:</p>
<div class="code"><pre class="code literal-block"><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">database</span><span class="o">.</span><span class="n">Posts</span><span class="o">.</span><span class="n">Join</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">Post_Metas</span><span class="p">,</span>
<span class="w">                                </span><span class="n">post</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">database</span><span class="o">.</span><span class="n">Posts</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="o">.</span><span class="n">ID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">id</span><span class="p">),</span>
<span class="w">                                </span><span class="n">meta</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">database</span><span class="o">.</span><span class="n">Post_Metas</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="o">.</span><span class="n">Post_ID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">id</span><span class="p">),</span>
<span class="w">                                </span><span class="p">(</span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="n">Meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="p">});</span>
</pre></div>

<p>I'm not sure if this query is correct.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I find that if you're familiar with SQL syntax, using the LINQ query syntax is
much clearer, more natural, and makes it easier to spot errors:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
<span class="w">   </span><span class="n">from</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">database</span><span class="o">.</span><span class="n">Posts</span>
<span class="w">   </span><span class="n">join</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">database</span><span class="o">.</span><span class="n">Post_Metas</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">post</span><span class="o">.</span><span class="n">ID</span><span class="w"> </span><span class="n">equals</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="n">Post_ID</span>
<span class="w">   </span><span class="n">where</span><span class="w"> </span><span class="n">post</span><span class="o">.</span><span class="n">ID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">id</span>
<span class="w">   </span><span class="n">select</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="n">Meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="p">};</span>
</pre></div>

<p>If you're really stuck on using lambdas though, your syntax is quite a bit
off. Here's the same query, using the LINQ extension methods:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">database</span><span class="o">.</span><span class="n">Posts</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s2">"from"</span><span class="w"> </span><span class="n">statement</span>
<span class="w">   </span><span class="o">.</span><span class="n">Join</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">Post_Metas</span><span class="p">,</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">inner</span><span class="w"> </span><span class="n">join</span>
<span class="w">      </span><span class="n">post</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">post</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span><span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">primary</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="p">(</span><span class="n">the</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s2">"on"</span><span class="w"> </span><span class="n">clause</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="s2">"join"</span><span class="w"> </span><span class="n">statement</span><span class="p">)</span>
<span class="w">      </span><span class="n">meta</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">meta</span><span class="o">.</span><span class="n">Post_ID</span><span class="p">,</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">Select</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">foreign</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="p">(</span><span class="n">the</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s2">"on"</span><span class="w"> </span><span class="n">clause</span><span class="p">)</span>
<span class="w">      </span><span class="p">(</span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="n">meta</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">post</span><span class="p">,</span><span class="w"> </span><span class="n">Meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">selection</span>
<span class="w">   </span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="n">postAndMeta</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">postAndMeta</span><span class="o">.</span><span class="n">Post</span><span class="o">.</span><span class="n">ID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">statement</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You could go two ways with this. Using LINQPad (invaluable if you're new to
LINQ) and a dummy database, I built the following queries:</p>
<div class="code"><pre class="code literal-block">Posts.Join(
    Post_metas,
    post =&gt; post.Post_id,
    meta =&gt; meta.Post_id,
    (post, meta) =&gt; new { Post = post, Meta = meta }
)
</pre></div>

<p>or</p>
<div class="code"><pre class="code literal-block">from p in Posts
join pm in Post_metas on p.Post_id equals pm.Post_id
select new { Post = p, Meta = pm }
</pre></div>

<p>In this particular case, I think the LINQ syntax is cleaner (I change between
the two depending upon which is easiest to read).</p>
<p>The thing I'd like to point out though is that if you have appropriate foreign
keys in your database, (between post and post_meta) then you probably don't
need an explicit join unless you're trying to load a large number of records.
Your example seems to indicate that you are trying to load a single post and
its metadata. Assuming that there are many post_meta records for each post,
then you could do the following:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Posts</span><span class="o">.</span><span class="n">Single</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">ID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">metas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">post</span><span class="o">.</span><span class="n">Post_metas</span><span class="o">.</span><span class="n">ToList</span><span class="p">();</span>
</pre></div>

<p>If you want to avoid the n+1 problem, then you can explicitly tell LINQ to SQL
to load all of the related items in one go (although this may be an advanced
topic for when you're more familiar with L2S). The example below says "when
you load a Post, also load all of its records associated with it via the
foreign key represented by the 'Post_metas' property":</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">dataLoadOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DataLoadOptions</span><span class="p">();</span>
<span class="n">dataLoadOptions</span><span class="o">.</span><span class="n">LoadWith</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">Post_metas</span><span class="p">);</span>

<span class="k">var</span><span class="w"> </span><span class="n">dataContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MyDataContext</span><span class="p">();</span>
<span class="n">dataContext</span><span class="o">.</span><span class="n">LoadOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataLoadOptions</span><span class="p">;</span>

<span class="k">var</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Posts</span><span class="o">.</span><span class="n">Single</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">ID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Post_metas</span><span class="w"> </span><span class="n">loaded</span><span class="w"> </span><span class="n">automagically</span>
</pre></div>

<p>It is possible to make many <code>LoadWith</code> calls on a single set of
<code>DataLoadOptions</code> for the same type, or many different types. If you do this
lots though, you might just want to consider caching.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/net-c/" rel="tag">.net-c#</a></li>
            <li><a class="tag p-category" href="../../categories/join/" rel="tag">join</a></li>
            <li><a class="tag p-category" href="../../categories/lambda/" rel="tag">lambda</a></li>
            <li><a class="tag p-category" href="../../categories/linq/" rel="tag">linq</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../what-is-the-purpose-of-the-html-no-js-class/" rel="prev" title='What is the purpose of the HTML "no-js" class?'>Previous post</a>
            </li>
            <li class="next">
                <a href="../how-do-i-force-sublime-text-to-indent-two-spaces-per-tab/" rel="next" title="How do I force Sublime Text to indent two spaces per tab?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
