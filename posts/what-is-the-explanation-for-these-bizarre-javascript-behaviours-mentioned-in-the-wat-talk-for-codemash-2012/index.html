<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>What is the explanation for these bizarre JavaScript behaviours mentioned in the 'Wat' talk for CodeMash 2012? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/what-is-the-explanation-for-these-bizarre-javascript-behaviours-mentioned-in-the-wat-talk-for-codemash-2012/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-do-you-handle-multiple-submit-buttons-in-asp-net-mvc-framework/" title="How do you handle multiple submit buttons in ASP.NET MVC Framework?" type="text/html">
<link rel="next" href="../indentationerror-unindent-does-not-match-any-outer-indentation-level/" title="IndentationError: unindent does not match any outer indentation level" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="What is the explanation for these bizarre JavaScript behaviours mentio">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/what-is-the-explanation-for-these-bizarre-javascript-behaviours-mentioned-in-the-wat-talk-for-codemash-2012/">
<meta property="og:description" content="The 'Wat' talk for CodeMash 2012 basically points out a few bizarre quirks
with Ruby and JavaScript.
I have made a JSFiddle of the results at http://jsfiddle.net/fe479/9/.
The behaviours specific to J">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T14:09:27+08:00">
<meta property="article:tag" content="javascript">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">What is the explanation for these bizarre JavaScript behaviours mentioned in the 'Wat' talk for CodeMash 2012?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T14:09:27+08:00" itemprop="datePublished" title="2023-02-17 14:09">2023-02-17 14:09</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>The <em>'Wat' talk for CodeMash 2012</em> basically points out a few bizarre quirks
with Ruby and JavaScript.</p>
<p>I have made a JSFiddle of the results at http://jsfiddle.net/fe479/9/.</p>
<p>The behaviours specific to JavaScript (as I don't know Ruby) are listed below.</p>
<p>I found in the JSFiddle that some of my results didn't correspond with those
in the video, and I am not sure why. I am, however, curious to know how
JavaScript is handling working behind the scenes in each case.</p>
<div class="code"><pre class="code literal-block">Empty Array + Empty Array
[] + []
result:
&lt;Empty String&gt;
</pre></div>

<p>I am quite curious about the <code>+</code> operator when used with arrays in JavaScript.
This matches the video's result.</p>
<div class="code"><pre class="code literal-block"><span class="n">Empty</span><span class="w"> </span><span class="k">Array</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">Object</span>
<span class="err">[]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">{}</span>
<span class="k">result</span><span class="err">:</span>
<span class="o">[</span><span class="n">Object</span><span class="o">]</span>
</pre></div>

<p>This matches the video's result. What's going on here? Why is this an object.
What does the <code>+</code> operator do?</p>
<div class="code"><pre class="code literal-block"><span class="k">Object</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Empty</span><span class="w"> </span><span class="k">Array</span>
<span class="err">{}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">[]</span>
<span class="k">result</span><span class="err">:</span>
<span class="o">[</span><span class="n">Object</span><span class="o">]</span>
</pre></div>

<p>This doesn't match the video. The video suggests that the result is 0, whereas
I get [Object].</p>
<div class="code"><pre class="code literal-block"><span class="k">Object</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">Object</span>
<span class="err">{}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="err">{}</span>
<span class="k">result</span><span class="err">:</span>
<span class="o">[</span><span class="n">Object</span><span class="o">][</span><span class="n">Object</span><span class="o">]</span>
</pre></div>

<p>This doesn't match the video either, and how does outputting a variable result
in two objects? Maybe my JSFiddle is wrong.</p>
<div class="code"><pre class="code literal-block">Array(16).join("wat" - 1)
result:
NaNNaNNaNNaNNaNNaNNaNNaNNaNNaNNaNNaNNaNNaNNaNNaN
</pre></div>

<p>Doing wat + 1 results in <code>wat1wat1wat1wat1</code>...</p>
<p>I suspect this is just straightforward behaviour that trying to subtract a
number from a string results in NaN.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Here's a list of explanations for the results you're seeing (and supposed to
be seeing). The references I'm using are from the ECMA-262 standard.</p>
<ol>
<li>
<h4><code>[] + []</code></h4>
</li>
</ol>
<p>When using the addition operator, both the left and right operands are
converted to primitives first (§11.6.1). As per §9.1, converting an object (in
this case an array) to a primitive returns its default value, which for
objects with a valid <code>toString()</code> method is the result of calling
<code>object.toString()</code> (§8.12.8). For arrays this is the same as calling
<code>array.join()</code> (§15.4.4.2). Joining an empty array results in an empty string,
so step #7 of the addition operator returns the concatenation of two empty
strings, which is the empty string.</p>
<ol>
<li>
<h4><code>[] + {}</code></h4>
</li>
</ol>
<p>Similar to <code>[] + []</code>, both operands are converted to primitives first. For
"Object objects" (§15.2), this is again the result of calling
<code>object.toString()</code>, which for non-null, non-undefined objects is <code>"[object
Object]"</code> (§15.2.4.2).</p>
<ol>
<li>
<h4><code>{} + []</code></h4>
</li>
</ol>
<p>The <code>{}</code> here is not parsed as an object, but instead as an empty block
(§12.1, at least as long as you're not forcing that statement to be an
expression, but more about that later). The return value of empty blocks is
empty, so the result of that statement is the same as <code>+[]</code>. The unary <code>+</code>
operator (§11.4.6) returns <code>ToNumber(ToPrimitive(operand))</code>. As we already
know, <code>ToPrimitive([])</code> is the empty string, and according to §9.3.1,
<code>ToNumber("")</code> is 0.</p>
<ol>
<li>
<h4><code>{} + {}</code></h4>
</li>
</ol>
<p>Similar to the previous case, the first <code>{}</code> is parsed as a block with empty
return value. Again, <code>+{}</code> is the same as <code>ToNumber(ToPrimitive({}))</code>, and
<code>ToPrimitive({})</code> is <code>"[object Object]"</code> (see <code>[] + {}</code>). So to get the result
of <code>+{}</code>, we have to apply <code>ToNumber</code> on the string <code>"[object Object]"</code>. When
following the steps from §9.3.1, we get <code>NaN</code> as a result:</p>
<blockquote>
<p>If the grammar cannot interpret the String as an expansion of
<em>StringNumericLiteral</em> , then the result of ToNumber is <strong>NaN</strong>.</p>
</blockquote>
<ol>
<li>
<h4><code>Array(16).join("wat" - 1)</code></h4>
</li>
</ol>
<p>As per §15.4.1.1 and §15.4.2.2, <code>Array(16)</code> creates a new array with length
16. To get the value of the argument to join, §11.6.2 steps #5 and #6 show
that we have to convert both operands to a number using <code>ToNumber</code>.
<code>ToNumber(1)</code> is simply 1 (§9.3), whereas <code>ToNumber("wat")</code> again is <code>NaN</code> as
per §9.3.1. Following step 7 of §11.6.2, §11.6.3 dictates that</p>
<blockquote>
<p>If either operand is <strong>NaN</strong> , the result is <strong>NaN</strong>.</p>
</blockquote>
<p>So the argument to <code>Array(16).join</code> is <code>NaN</code>. Following §15.4.4.5
(<code>Array.prototype.join</code>), we have to call <code>ToString</code> on the argument, which is
<code>"NaN"</code> (§9.8.1):</p>
<blockquote>
<p>If <em>m</em> is <strong>NaN</strong> , return the String <strong><code>"NaN"</code></strong>.</p>
</blockquote>
<p>Following step 10 of §15.4.4.5, we get 15 repetitions of the concatenation of
<code>"NaN"</code> and the empty string, which equals the result you're seeing. When
using <code>"wat" + 1</code> instead of <code>"wat" - 1</code> as argument, the addition operator
converts <code>1</code> to a string instead of converting <code>"wat"</code> to a number, so it
effectively calls <code>Array(16).join("wat1")</code>.</p>
<p>As to why you're seeing different results for the <code>{} + []</code> case: When using
it as a function argument, you're forcing the statement to be an
<em>ExpressionStatement</em> , which makes it impossible to parse <code>{}</code> as empty
block, so it's instead parsed as an empty object literal.</p>
<p><br></p>
<h3>Suggest</h3>
<p>This is more of a comment than an answer, but for some reason I can't comment
on your question. I wanted to correct your JSFiddle code. However, I posted
this on Hacker News and someone suggested that I repost it here.</p>
<p>The problem in the JSFiddle code is that <code>({})</code> (opening braces inside of
parentheses) is not the same as <code>{}</code> (opening braces as the start of a line of
code). So when you type <code>out({} + [])</code> you are forcing the <code>{}</code> to be
something which it is not when you type <code>{} + []</code>. This is part of the overall
'wat'-ness of Javascript.</p>
<p>The basic idea was simple JavaScript wanted to allow both of these forms:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">u</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">v</span><span class="c1">;</span>

<span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">x</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">y</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">z</span><span class="c1">;</span>
}
</pre></div>

<p>To do so, two interpretations were made of the opening brace: 1. it is <em>not
required</em> and 2. it can appear <em>anywhere</em>.</p>
<p>This was a wrong move. Real code doesn't have an opening brace appearing in
the middle of nowhere, and real code also tends to be more fragile when it
uses the first form rather than the second. (About once every other month at
my last job, I'd get called to a coworker's desk when their modifications to
my code weren't working, and the problem was that they'd added a line to the
"if" without adding curly braces. I eventually just adopted the habit that the
curly braces are always required, even when you're only writing one line.)</p>
<p>Fortunately in many cases eval() will replicate the full wat-ness of
JavaScript. The JSFiddle code should read:</p>
<div class="code"><pre class="code literal-block">function<span class="w"> </span>out(code)<span class="w"> </span>{
<span class="w">    </span>function<span class="w"> </span>format(x)<span class="w"> </span>{
<span class="w">        </span>return<span class="w"> </span>typeof<span class="w"> </span>x<span class="w"> </span>===<span class="w"> </span>"string"<span class="w"> </span>?
<span class="w">            </span>JSON.stringify(x)<span class="w"> </span>:<span class="w"> </span>x;
<span class="w">    </span>}<span class="w">   </span>
<span class="w">    </span>document.writeln('<span class="ni">&amp;gt;&amp;gt;&amp;gt;</span><span class="w"> </span>'<span class="w"> </span>+<span class="w"> </span>code);
<span class="w">    </span>document.writeln(format(eval(code)));
}
document.writeln("<span class="nt">&lt;pre&gt;</span>");
out('[]<span class="w"> </span>+<span class="w"> </span>[]');
out('[]<span class="w"> </span>+<span class="w"> </span>{}');
out('{}<span class="w"> </span>+<span class="w"> </span>[]');
out('{}<span class="w"> </span>+<span class="w"> </span>{}');
out('Array(16).join("wat"<span class="w"> </span>+<span class="w"> </span>1)');
out('Array(16).join("wat<span class="w"> </span>-<span class="w"> </span>1")');
out('Array(16).join("wat"<span class="w"> </span>-<span class="w"> </span>1)<span class="w"> </span>+<span class="w"> </span>"<span class="w"> </span>Batman!"');
document.writeln("<span class="nt">&lt;/pre&gt;</span>");
</pre></div>

<p>[Also that is the first time I have written document.writeln in many many many
years, and I feel a little dirty writing anything involving both
document.writeln() and eval().]</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/javascript/" rel="tag">javascript</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-do-you-handle-multiple-submit-buttons-in-asp-net-mvc-framework/" rel="prev" title="How do you handle multiple submit buttons in ASP.NET MVC Framework?">Previous post</a>
            </li>
            <li class="next">
                <a href="../indentationerror-unindent-does-not-match-any-outer-indentation-level/" rel="next" title="IndentationError: unindent does not match any outer indentation level">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
