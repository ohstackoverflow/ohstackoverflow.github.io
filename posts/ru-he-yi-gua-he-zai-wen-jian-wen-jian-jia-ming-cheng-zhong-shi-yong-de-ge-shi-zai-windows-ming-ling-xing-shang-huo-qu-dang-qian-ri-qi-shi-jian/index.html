<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>如何以适合在文件/文件夹名称中使用的格式在 Windows 命令行上获取当前日期/时间？ | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/ru-he-yi-gua-he-zai-wen-jian-wen-jian-jia-ming-cheng-zhong-shi-yong-de-ge-shi-zai-windows-ming-ling-xing-shang-huo-qu-dang-qian-ri-qi-shi-jian/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../ru-he-jian-cha-zi-dian-shi-fou-wei-kong/" title="如何检查字典是否为空？" type="text/html">
<link rel="next" href="../ngif-he-ngfor-zai-tong-yi-yuan-su-shang-dao-zhi-cuo-wu/" title="*ngIf 和 *ngFor 在同一元素上导致错误" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="如何以适合在文件/文件夹名称中使用的格式在 Windows 命令行上获取当前日期/时间？">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/ru-he-yi-gua-he-zai-wen-jian-wen-jian-jia-ming-cheng-zhong-shi-yong-de-ge-shi-zai-windows-ming-ling-xing-shang-huo-qu-dang-qian-ri-qi-shi-jian/">
<meta property="og:description" content="更新：现在是 2016 年了，除非有真正令人信服的向后兼容原因，否则我会为此使用 PowerShell，特别是因为使用date.
请参阅@npocmaka 的https://stackoverflow.com/a/19799236/8479

我可以使用什么 Windows 命令行语句以我可以放入文件名的格式获取当前日期时间？
我想要一个 .bat 文件，它将一个目录压缩到一个存档中，并将当前日期">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T23:18:15+08:00">
<meta property="article:tag" content="batch-file">
<meta property="article:tag" content="cmd">
<meta property="article:tag" content="datetime">
<meta property="article:tag" content="windows">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">如何以适合在文件/文件夹名称中使用的格式在 Windows 命令行上获取当前日期/时间？</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T23:18:15+08:00" itemprop="datePublished" title="2023-02-17 23:18">2023-02-17 23:18</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>更新：现在是 2016 年了，除非有真正令人信服的向后兼容原因，否则我会为此使用 PowerShell，特别是因为使用<code>date</code>.
请参阅@npocmaka 的https://stackoverflow.com/a/19799236/8479</p>
<hr>
<p>我可以使用什么 Windows 命令行语句以我可以放入文件名的格式获取当前日期时间？</p>
<p>我想要一个 .bat 文件，它将一个目录压缩到一个存档中，并将当前日期和时间作为名称的一部分，例如，<code>Code_2008-10-14_2257.zip</code>.
有没有什么简单的方法可以独立于机器的区域设置来做到这一点？</p>
<p>我真的不介意日期格式，理想情况下是 yyyy-mm-dd，但任何简单的都可以。</p>
<p>到目前为止，我得到了这个，它在我的机器上给了我<code>Tue_10_14_2008_230050_91</code>：</p>
<div class="code"><pre class="code literal-block"><span class="n">rem</span><span class="w"> </span><span class="k">Get</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">datetime</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="nf">format</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">filename</span><span class="p">.</span>
<span class="k">set</span><span class="w"> </span><span class="n">_my_datetime</span><span class="o">=%</span><span class="nc">date</span><span class="o">%</span><span class="n">_</span><span class="o">%</span><span class="nc">time</span><span class="o">%</span>
<span class="k">set</span><span class="w"> </span><span class="n">_my_datetime</span><span class="o">=%</span><span class="nl">_my_datetime</span><span class="p">:</span><span class="w"> </span><span class="o">=</span><span class="n">_</span><span class="o">%</span>
<span class="k">set</span><span class="w"> </span><span class="n">_my_datetime</span><span class="o">=%</span><span class="nl">_my_datetime</span><span class="p">:</span><span class="err">:</span><span class="o">=%</span>
<span class="k">set</span><span class="w"> </span><span class="n">_my_datetime</span><span class="o">=%</span><span class="nl">_my_datetime</span><span class="p">:</span><span class="o">/=</span><span class="n">_</span><span class="o">%</span>
<span class="k">set</span><span class="w"> </span><span class="n">_my_datetime</span><span class="o">=%</span><span class="nl">_my_datetime</span><span class="p">:.</span><span class="o">=</span><span class="n">_</span><span class="o">%</span>

<span class="n">rem</span><span class="w"> </span><span class="n">Now</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nc">timestamp</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ZIP</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">name</span><span class="p">.</span>
<span class="ss">"d:\Program Files\7-Zip\7z.exe"</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="n">Code_</span><span class="o">%</span><span class="n">_my_datetime</span><span class="o">%</span><span class="p">.</span><span class="n">zip</span><span class="w"> </span><span class="n">Code</span>
</pre></div>

<p>我可以忍受这个，但它似乎有点笨拙。理想情况下，它会更简短，并具有前面提到的格式。</p>
<p>我使用的是 Windows Server 2003 和 Windows XP
Professional。我不想安装额外的实用程序来实现此目的（尽管我知道有些实用程序可以很好地格式化日期）。</p>
<p><br><br></p>
<h2>解答</h2>
<p>请参阅 <em>Windows 批处理文件 (.bat) 以获取 MMDDYYYY 格式的当前日期</em> ：</p>
<div class="code"><pre class="code literal-block"><span class="nv">@echo</span><span class="w"> </span><span class="k">off</span>
<span class="k">For</span><span class="w"> </span><span class="o">/</span><span class="n">f</span><span class="w"> </span><span class="ss">"tokens=2-4 delims=/ "</span><span class="w"> </span><span class="o">%%</span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">(</span><span class="s1">'date /t'</span><span class="p">)</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="p">(</span><span class="k">set</span><span class="w"> </span><span class="n">mydate</span><span class="o">=%%</span><span class="n">c</span><span class="o">-%%</span><span class="n">a</span><span class="o">-%%</span><span class="n">b</span><span class="p">)</span>
<span class="k">For</span><span class="w"> </span><span class="o">/</span><span class="n">f</span><span class="w"> </span><span class="ss">"tokens=1-2 delims=/:"</span><span class="w"> </span><span class="o">%%</span><span class="n">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">(</span><span class="s1">'time /t'</span><span class="p">)</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="p">(</span><span class="k">set</span><span class="w"> </span><span class="n">mytime</span><span class="o">=%%</span><span class="n">a</span><span class="o">%%</span><span class="n">b</span><span class="p">)</span>
<span class="n">echo</span><span class="w"> </span><span class="o">%</span><span class="n">mydate</span><span class="o">%</span><span class="n">_</span><span class="o">%</span><span class="n">mytime</span><span class="o">%</span>
</pre></div>

<p>如果您更喜欢 24 小时/军用格式的时间，您可以将第二行 FOR 替换为：</p>
<div class="code"><pre class="code literal-block"><span class="k">For</span><span class="w"> </span><span class="o">/</span><span class="nv">f</span><span class="w"> </span><span class="s2">"tokens=1-2 delims=/:"</span><span class="w"> </span><span class="o">%%</span><span class="nv">a</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="ss">(</span><span class="s2">"%TIME%"</span><span class="ss">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="ss">(</span><span class="nv">set</span><span class="w"> </span><span class="nv">mytime</span><span class="o">=%%</span><span class="nv">a</span><span class="o">%%</span><span class="nv">b</span><span class="ss">)</span>
</pre></div>

<blockquote>
<p>C:&gt;.\date.bat<br>
2008-10-14_0642</p>
</blockquote>
<p>如果您希望日期独立于区域日/月顺序，您可以使用“WMIC os GET LocalDateTime”作为来源，因为它是按 ISO 顺序排列的：</p>
<div class="code"><pre class="code literal-block"><span class="nv">@echo</span><span class="w"> </span><span class="k">off</span>
<span class="k">for</span><span class="w"> </span><span class="o">/</span><span class="n">F</span><span class="w"> </span><span class="ss">"usebackq tokens=1,2 delims=="</span><span class="w"> </span><span class="o">%%</span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">(</span><span class="err">`</span><span class="n">wmic</span><span class="w"> </span><span class="n">os</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="o">/</span><span class="k">VALUE</span><span class="w"> </span><span class="mi">2</span><span class="o">^&gt;</span><span class="n">NUL</span><span class="err">`</span><span class="p">)</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="s1">'.%%i.'</span><span class="o">==</span><span class="s1">'.LocalDateTime.'</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">ldt</span><span class="o">=%%</span><span class="n">j</span>
<span class="k">set</span><span class="w"> </span><span class="n">ldt</span><span class="o">=%</span><span class="nl">ldt</span><span class="p">:</span><span class="o">~</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="o">%-%</span><span class="nl">ldt</span><span class="p">:</span><span class="o">~</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="o">%-%</span><span class="nl">ldt</span><span class="p">:</span><span class="o">~</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span><span class="w"> </span><span class="o">%</span><span class="nl">ldt</span><span class="p">:</span><span class="o">~</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span><span class="err">:</span><span class="o">%</span><span class="nl">ldt</span><span class="p">:</span><span class="o">~</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="o">%</span><span class="err">:</span><span class="o">%</span><span class="nl">ldt</span><span class="p">:</span><span class="o">~</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="o">%</span>
<span class="n">echo</span><span class="w"> </span><span class="k">Local</span><span class="w"> </span><span class="nc">date</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="o">[</span><span class="n">%ldt%</span><span class="o">]</span>
</pre></div>

<blockquote>
<p>C:&gt;test.cmd<br>
本地日期是 [2012-06-19 10:23:47.048]</p>
</blockquote>
<p><br></p>
<h3>更多建议</h3>
<p>另外两种不依赖于时间设置的方法（均取自：How get data/time independent from
localization:）。并且两者都获得星期几，并且它们都不需要管理员权限！：</p>
<ol>
<li>
<strong>MAKECAB</strong> - 将在每个 Windows 系统上运行（速度快，但会创建一个小的临时文件）（foxidrive 脚本）：<div class="code"><pre class="code literal-block"><span class="nv">@echo</span><span class="w"> </span><span class="k">off</span>
</pre></div>

<p>pushd "%temp%"
makecab /D RptFileName=~.rpt /D InfFileName=~.inf /f nul &gt;nul
for /f "tokens=3-7" %%a in ('find /i "makecab"^&lt;~.rpt') do (
   set "current-date=%%e-%%b-%%c"
   set "current-time=%%d"
   set "weekday=%%a"
)
del ~.*
popd
echo %weekday% %current-date% %current-time%
pause</p>
</li>
</ol>
<p>有关获取日期功能的更多信息。</p>
<ol>
<li>
<p><strong>ROBOCOPY</strong> - 它不是 Windows XP 和 Windows Server 2003 的本机命令，但可以从 Microsoft 站点下载。但内置于 Windows Vista 及更高版本的所有内容中：</p>
<div class="code"><pre class="code literal-block"><span class="nv">@echo</span><span class="w"> </span><span class="k">off</span>
</pre></div>

<p>setlocal
for /f "skip=8 tokens=2,3,4,5,6,7,8 delims=: " %%D in ('robocopy /l * \ \ /ns /nc /ndl /nfl /np /njh /XF * /XD *') do (
 set "dow=%%D"
 set "month=%%E"
 set "day=%%F"
 set "HH=%%G"
 set "MM=%%H"
 set "SS=%%I"
 set "year=%%J"
)</p>
<p>echo Day of the week: %dow%
echo Day of the month : %day%
echo Month : %month%
echo hour : %HH%
echo minutes : %MM%
echo seconds : %SS%
echo year : %year%
endlocal</p>
</li>
</ol>
<p>以及另外三种使用其他 Windows 脚本语言的方法。它们会给你更多的灵活性，例如你可以获得一年中的星期几，以毫秒为单位的时间等等。</p>
<ol>
<li>
<p><strong>JScript/批处理</strong> 混合（需要另存为<code>.bat</code>）。JScript 在 NT 及更高版本的每个系统上都可用，作为Windows Script Host的一部分（尽管可以通过注册表禁用，但这种情况很少见）：</p>
<div class="code"><pre class="code literal-block"><span class="p">@</span><span class="k">if</span><span class="w"> </span><span class="p">(@</span><span class="n">X</span><span class="p">)</span><span class="o">==</span><span class="p">(@</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="k">@end</span><span class="w"> </span><span class="cm">/* ---Harmless hybrid line that begins a JScript comment</span>
</pre></div>

<p>@echo off
cscript //E:JScript //nologo "%~f0"
exit /b 0
<em>------------------------------------------------------------------------------</em>/</p>
<p>function GetCurrentDate() {
        // Today date time which will used to set as default date.
        var todayDate = new Date();
        todayDate = todayDate.getFullYear() + "-" +
                       ("0" + (todayDate.getMonth() + 1)).slice(-2) + "-" +
                       ("0" + todayDate.getDate()).slice(-2) + " " + ("0" + todayDate.getHours()).slice(-2) + ":" +
                       ("0" + todayDate.getMinutes()).slice(-2);</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">todayDate</span><span class="c1">;</span>
}
</pre></div>

<p>WScript.Echo(GetCurrentDate());</p>
</li>
<li>
<p><strong>VSCRIPT/BATCH</strong> 混合（ <em>是否可以在不使用临时文件的情况下在批处理文件中嵌入和执行 VBScript？</em> ）与 JScript 的情况相同，但混合并不是那么完美：</p>
<div class="code"><pre class="code literal-block"><span class="nl">:sub</span><span class="w"> </span><span class="nv">echo</span><span class="ss">(</span><span class="nv">str</span><span class="ss">)</span><span class="w"> </span>:<span class="k">end</span><span class="w"> </span><span class="nv">sub</span>
</pre></div>

<p>echo off
'&gt;nul 2&gt;&amp;1|| copy /Y %windir%\System32\doskey.exe %windir%\System32\'.exe &gt;nul
'&amp; echo current date:
'&amp; cscript /nologo /E:vbscript "%~f0"
'&amp; exit /b</p>
<p>'0 = vbGeneralDate - Default. Returns date: mm/dd/yy and time if specified: hh:mm:ss PM/AM.
'1 = vbLongDate - Returns date: weekday, monthname, year
'2 = vbShortDate - Returns date: mm/dd/yy
'3 = vbLongTime - Returns time: hh:mm:ss PM/AM
'4 = vbShortTime - Return time: hh:mm</p>
<p>WScript.echo  Replace(FormatDateTime(Date,1),", ","-")</p>
</li>
<li>
<p><strong>PowerShell</strong> - 可以安装在每台装有 .NET 的机器上 - 从 Microsoft 下载（v1、v2、v3（仅适用于 Windows 7 及更高版本））。它默认安装在 Windows 7/Windows Server 2008 及更高版本的所有系统上：</p>
<div class="code"><pre class="code literal-block">C:\&gt; powershell get-date -format "{dd-MMM-yyyy HH:mm}"
</pre></div>

</li>
</ol>
<p>从批处理文件中使用它：</p>
<div class="code"><pre class="code literal-block"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="o">/</span><span class="n">f</span><span class="w"> </span><span class="ss">"delims="</span><span class="w"> </span><span class="o">%%</span><span class="err">#</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">(</span><span class="s1">'powershell get-date -format "{dd-MMM-yyyy HH:mm}"'</span><span class="p">)</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="nv">@set</span><span class="w"> </span><span class="n">_date</span><span class="o">=%%</span><span class="err">#</span>
</pre></div>

<ol>
<li>
<p><strong>自编译的 jscript.net/batch</strong> （从未见过没有 .NET 的 Windows 机器，所以我认为这是一个非常可移植的）：</p>
<div class="code"><pre class="code literal-block"><span class="p">@</span><span class="k">if</span><span class="w"> </span><span class="p">(@</span><span class="n">X</span><span class="p">)</span><span class="o">==</span><span class="p">(@</span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="k">@end</span><span class="w"> </span><span class="cm">/****** silent line that start JScript comment ******</span>
</pre></div>

<p>@echo off
::::::::::::::::::::::::::::::::::::
:::       Compile the script    ::::
::::::::::::::::::::::::::::::::::::
setlocal
if exist "%~n0.exe" goto :skip_compilation</p>
<p>set "frm=%SystemRoot%\Microsoft.NET\Framework\"</p>
<p>:: Searching the latest installed .NET framework
for /f "tokens=<em> delims=" %%v in ('dir /b /s /a:d /o:-n "%SystemRoot%\Microsoft.NET\Framework\v</em>"') do (
    if exist "%%v\jsc.exe" (
        rem :: the javascript.net compiler
        set "jsc=%%~dpsnfxv\jsc.exe"
        goto :break_loop
    )
)
echo jsc.exe not found &amp;&amp; exit /b 0
:break_loop</p>
<p>call %jsc% /nologo /out:"%~n0.exe" "%~dpsfnx0"
::::::::::::::::::::::::::::::::::::
:::       End of compilation    ::::
::::::::::::::::::::::::::::::::::::
:skip_compilation</p>
<p>"%~n0.exe"</p>
<p>exit /b 0</p>
<p><strong><em>*</em>* End of JScript comment </strong>****/
import System;
import System.IO;</p>
<p>var dt=DateTime.Now;
Console.WriteLine(dt.ToString("yyyy-MM-dd hh:mm:ss"));</p>
</li>
<li>
<p><strong>Logman</strong> 这无法获取年份和星期几。它相对较慢并且还会创建一个临时文件，并且基于 logman 放置在其日志文件中的时间戳。它适用于 Windows XP 及更高版本的所有内容。它可能永远不会被任何人使用——包括我——但这是另一种方式……</p>
<div class="code"><pre class="code literal-block"><span class="nv">@echo</span><span class="w"> </span><span class="k">off</span>
</pre></div>

<p>setlocal
del /q /f %temp%\timestampfile_*</p>
<p>Logman.exe stop ts-CPU 1&gt;nul 2&gt;&amp;1
Logman.exe delete ts-CPU 1&gt;nul 2&gt;&amp;1</p>
<p>Logman.exe create counter ts-CPU  -sc 2 -v mmddhhmm -max 250 -c "\Processor(<em>Total)\%% Processor Time" -o %temp%\timestampfile</em> &gt;nul
Logman.exe start ts-CPU 1&gt;nul 2&gt;&amp;1</p>
<p>Logman.exe stop ts-CPU &gt;nul 2&gt;&amp;1
Logman.exe delete ts-CPU &gt;nul 2&gt;&amp;1
for /f "tokens=2 delims=<em>." %%t in  ('dir /b %temp%\timestampfile</em><em>^&amp;del /q/f %temp%\timestampfile_</em>') do set timestamp=%%t</p>
<p>echo %timestamp%
echo MM: %timestamp:~0,2%
echo dd: %timestamp:~2,2%
echo hh: %timestamp:~4,2%
echo mm: %timestamp:~6,2%</p>
<p>endlocal
exit /b 0</p>
</li>
<li>
<p><strong>WMIC</strong> 的另一种方法也给出了一年中的第几周和星期几，但不是毫秒（对于毫秒，请查看 foxidrive 的答案）：</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="w"> </span><span class="o">/</span><span class="n">f</span><span class="w"> </span><span class="o">%%</span><span class="err">#</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">(</span><span class="s1">'wMIC Path Win32_LocalTime Get /Format:value'</span><span class="p">)</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="nv">@for</span><span class="w"> </span><span class="o">/</span><span class="n">f</span><span class="w"> </span><span class="o">%%</span><span class="err">@</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p">(</span><span class="ss">"%%#"</span><span class="p">)</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="nv">@set</span><span class="w"> </span><span class="o">%%</span><span class="err">@</span>
</pre></div>

<p>echo %day%
echo %DayOfWeek%
echo %hour%
echo %minute%
echo %month%
echo %quarter%
echo %second%
echo %weekinmonth%
echo %year%</p>
</li>
<li>
<p>通过一些努力使用 <strong>TYPEPERF</strong> 以尽可能快地与不同的语言设置兼容：</p>
<div class="code"><pre class="code literal-block"><span class="nv">@echo</span><span class="w"> </span><span class="k">off</span>
</pre></div>

<p>setlocal</p>
<p>:: Check if Windows is Windows XP and use Windows XP valid counter for UDP performance
::if defined USERDOMAIN_roamingprofile (set "v=v4") else (set "v=")</p>
<p>for /f "tokens=4 delims=. " %%# in ('ver') do if %%# GTR 5 (set "v=v4") else ("v=")
set "mon="
for /f "skip=2 delims=," %%# in ('typeperf "\UDP%v%*" -si 0 -sc 1') do (
   if not defined mon (
      for /f "tokens=1-7 delims=.:/ " %%a in (%%#) do (
        set mon=%%a
        set date=%%b
        set year=%%c
        set hour=%%d
        set minute=%%e
        set sec=%%f
        set ms=%%g
      )
   )
)
echo %year%.%mon%.%date%
echo %hour%:%minute%:%sec%.%ms%
endlocal</p>
</li>
<li>
<p><strong>MSHTA</strong> 允许调用类似于上面#3 中演示的 JScript 方法的 JavaScript 方法。请记住，涉及月份值的 JavaScript 日期对象属性的编号是从 0 到 11，而不是 1 到 12。因此值 9 表示十月。</p>
<div class="code"><pre class="code literal-block">&lt;!-- : Batch portion
</pre></div>

<p>@echo off
setlocal</p>
<p>for /f "delims=" %%I in ('mshta "%~f0"') do set "now.%%~I"</p>
<p>rem Display all variables beginning with "now."
set now.</p>
<p>goto :EOF</p>
<p>end batch / begin HTA --&gt;</p>
<p><script>
    resizeTo(0,0)
    var fso = new ActiveXObject('Scripting.FileSystemObject').GetStandardStream(1),
        now = new Date(),
        props=['getDate','getDay','getFullYear','getHours','getMilliseconds','getMinutes',
            'getMonth','getSeconds','getTime','getTimezoneOffset','getUTCDate','getUTCDay',
            'getUTCFullYear','getUTCHours','getUTCMilliseconds','getUTCMinutes','getUTCMonth',
            'getUTCSeconds','getYear','toDateString','toGMTString','toLocaleDateString',
            'toLocaleTimeString','toString','toTimeString','toUTCString','valueOf'],
        output = [];</p>
<div class="code"><pre class="code literal-block"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nf">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">props</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="k">output</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">props</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;()=&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">now</span><span class="o">[</span><span class="n">props[i</span><span class="o">]</span><span class="err">]</span><span class="p">())</span><span class="err">}</span>
<span class="k">close</span><span class="p">(</span><span class="n">fso</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="k">output</span><span class="p">.</span><span class="k">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)));</span>
</pre></div>

</script></p>
</li>
</ol>
<p><br><br><a href="../how-do-i-get-current-date-time-on-the-windows-command-line-in-a-suitable-format-for-usage-in-a-file-folder-name/">查看原文</a></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/batch-file/" rel="tag">batch-file</a></li>
            <li><a class="tag p-category" href="../../categories/cmd/" rel="tag">cmd</a></li>
            <li><a class="tag p-category" href="../../categories/datetime/" rel="tag">datetime</a></li>
            <li><a class="tag p-category" href="../../categories/windows/" rel="tag">windows</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../ru-he-jian-cha-zi-dian-shi-fou-wei-kong/" rel="prev" title="如何检查字典是否为空？">Previous post</a>
            </li>
            <li class="next">
                <a href="../ngif-he-ngfor-zai-tong-yi-yuan-su-shang-dao-zhi-cuo-wu/" rel="next" title="*ngIf 和 *ngFor 在同一元素上导致错误">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
