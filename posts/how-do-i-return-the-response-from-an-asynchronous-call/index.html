<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How do I return the response from an asynchronous call? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-do-i-return-the-response-from-an-asynchronous-call/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-do-i-merge-two-dictionaries-in-a-single-expression-in-python/" title="How do I merge two dictionaries in a single expression in Python?" type="text/html">
<link rel="next" href="../what-is-the-difference-between-px-dip-dp-and-sp/" title="What is the difference between px, dip, dp, and sp?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="How do I return the response from an asynchronous call?">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-do-i-return-the-response-from-an-asynchronous-call/">
<meta property="og:description" content="How do I return the response/result from a function foo that makes an
asynchronous request?
I am trying to return the value from the callback, as well as assigning the
result to a local variable insid">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-16T18:29:52+08:00">
<meta property="article:tag" content="ajax">
<meta property="article:tag" content="asynchronous">
<meta property="article:tag" content="javascript">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How do I return the response from an asynchronous call?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T18:29:52+08:00" itemprop="datePublished" title="2023-02-16 18:29">2023-02-16 18:29</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>How do I return the response/result from a function <code>foo</code> that makes an
asynchronous request?</p>
<p>I am trying to return the value from the callback, as well as assigning the
result to a local variable inside the function and returning that one, but
none of those ways actually return the response — they all return <code>undefined</code>
or whatever the initial value of the variable <code>result</code> is.</p>
<p><strong>Example of an asynchronous function that accepts a callback</strong> (using
jQuery's <code>ajax</code> function):</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>

<span class="w">    </span><span class="n">$</span><span class="p">.</span><span class="n">ajax</span><span class="p">(</span><span class="err">{</span>
<span class="w">        </span><span class="n">url</span><span class="o">:</span><span class="w"> </span><span class="s1">'...'</span><span class="p">,</span>
<span class="w">        </span><span class="n">success</span><span class="o">:</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">;</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">response</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">tried</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">one</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">well</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="k">always</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="n n-Quoted">`undefined`</span>
<span class="err">}</span>
</pre></div>

<p><strong>Example using Node.js:</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>

<span class="w">    </span><span class="n">fs</span><span class="p">.</span><span class="n">readFile</span><span class="p">(</span><span class="s2">"path/to/file"</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">data</span><span class="p">;</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">data</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">tried</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">one</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">well</span>
<span class="w">    </span><span class="err">}</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="k">always</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="n n-Quoted">`undefined`</span>
<span class="err">}</span>
</pre></div>

<p><strong>Example using the<code>then</code> block of a promise:</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>

<span class="w">    </span><span class="k">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="k">then</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">response</span><span class="p">;</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">response</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="n">tried</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">one</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">well</span>
<span class="w">    </span><span class="err">}</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">It</span><span class="w"> </span><span class="k">always</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="n n-Quoted">`undefined`</span>
<span class="err">}</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<blockquote>
<p><em>→ For a more general explanation of asynchronous behaviour with different
examples, see</em> Why is my variable unaltered after I modify it inside of a
function? - Asynchronous code reference</p>
<p><em>→ If you already understand the problem, skip to the possible solutions
below.</em></p>
</blockquote>
<h2>The problem</h2>
<p>The <strong>A</strong> in Ajax stands for <strong>asynchronous</strong>. That means sending the request
(or rather receiving the response) is taken out of the normal execution flow.
In your example, <code>$.ajax</code> returns immediately and the next statement, <code>return
result;</code>, is executed before the function you passed as <code>success</code> callback was
even called.</p>
<p>Here is an analogy which hopefully makes the difference between synchronous
and asynchronous flow clearer:</p>
<h3>Synchronous</h3>
<p>Imagine you make a phone call to a friend and ask him to look something up for
you. Although it might take a while, you wait on the phone and stare into
space, until your friend gives you the answer that you needed.</p>
<p>The same is happening when you make a function call containing "normal" code:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">findItem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">item</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">item_not_found</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">search</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">item</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">var</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findItem</span><span class="p">();</span>

<span class="o">//</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">item</span>
<span class="n">doSomethingElse</span><span class="p">();</span>
</pre></div>

<p>Even though <code>findItem</code> might take a long time to execute, any code coming
after <code>var item = findItem();</code> has to <em>wait</em> until the function returns the
result.</p>
<h3>Asynchronous</h3>
<p>You call your friend again for the same reason. But this time you tell him
that you are in a hurry and he should <em>call you back</em> on your mobile phone.
You hang up, leave the house, and do whatever you planned to do. Once your
friend calls you back, you are dealing with the information he gave to you.</p>
<p>That's exactly what's happening when you do an Ajax request.</p>
<div class="code"><pre class="code literal-block"><span class="nv">findItem</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nv">item</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">Do</span><span class="w"> </span><span class="nv">something</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">item</span>
}<span class="ss">)</span><span class="c1">;</span>
<span class="nv">doSomethingElse</span><span class="ss">()</span><span class="c1">;</span>
</pre></div>

<p>Instead of waiting for the response, the execution continues immediately and
the statement after the Ajax call is executed. To get the response eventually,
you provide a function to be called once the response was received, a
<em>callback</em> (notice something? <em>call back</em> ?). Any statement coming after that
call is executed before the callback is called.</p>
<hr>
<h2>Solution(s)</h2>
<p><strong>Embrace the asynchronous nature of JavaScript!</strong> While certain asynchronous
operations provide synchronous counterparts (so does "Ajax"), it's generally
discouraged to use them, especially in a browser context.</p>
<p>Why is it bad do you ask?</p>
<p>JavaScript runs in the UI thread of the browser and any long-running process
will lock the UI, making it unresponsive. Additionally, there is an upper
limit on the execution time for JavaScript and the browser will ask the user
whether to continue the execution or not.</p>
<p>All of this results in a really bad user experience. The user won't be able to
tell whether everything is working fine or not. Furthermore, the effect will
be worse for users with a slow connection.</p>
<p>In the following we will look at three different solutions that are all
building on top of each other:</p>
<ul>
<li>
<strong>Promises with<code>async/await</code></strong> (ES2017+, available in older browsers if you use a transpiler or regenerator)</li>
<li>
<strong>Callbacks</strong> (popular in node)</li>
<li>
<strong>Promises with<code>then()</code></strong> (ES2015+, available in older browsers if you use one of the many promise libraries)</li>
</ul>
<p><strong>All three are available in current browsers, and node 7+.</strong></p>
<hr>
<h3>ES2017+: Promises with <code>async/await</code>
</h3>
<p>The ECMAScript version released in 2017 introduced <em>syntax-level support</em> for
asynchronous functions. With the help of <code>async</code> and <code>await</code>, you can write
asynchronous in a "synchronous style". The code is still asynchronous, but
it's easier to read/understand.</p>
<p><code>async/await</code> builds on top of promises: an <code>async</code> function always returns a
promise. <code>await</code> "unwraps" a promise and either result in the value the
promise was resolved with or throws an error if the promise was rejected.</p>
<p><strong>Important:</strong> You can only use <code>await</code> inside an <code>async</code> function or in a
JavaScript module. Top-level <code>await</code> is not supported outside of modules, so
you might have to make an async IIFE (Immediately Invoked Function Expression)
to start an <code>async</code> context if not using a module.</p>
<p>You can read more about <code>async</code> and <code>await</code> on MDN.</p>
<p>Here is an example that elaborates the <em>delay</em> function <code>findItem()</code> above:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="s1">'superagent'</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">promise</span><span class="p">.</span>
<span class="n">var</span><span class="w"> </span><span class="n">superagent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">require</span><span class="p">(</span><span class="s1">'superagent'</span><span class="p">)</span>

<span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">isn</span><span class="s1">'t declared as `async` because it already returns a promise</span>
<span class="s1">function delay() {</span>
<span class="s1">  // `delay` returns a promise</span>
<span class="s1">  return new Promise(function(resolve, reject) {</span>
<span class="s1">    // Only `delay` is able to resolve or reject the promise</span>
<span class="s1">    setTimeout(function() {</span>
<span class="s1">      resolve(42); // After 3 seconds, resolve the promise with value 42</span>
<span class="s1">    }, 3000);</span>
<span class="s1">  });</span>
<span class="s1">}</span>

<span class="s1">async function getAllBooks() {</span>
<span class="s1">  try {</span>
<span class="s1">    // GET a list of book IDs of the current user</span>
<span class="s1">    var bookIDs = await superagent.get('</span><span class="o">/</span><span class="k">user</span><span class="o">/</span><span class="n">books</span><span class="s1">');</span>
<span class="s1">    // wait for 3 seconds (just for the sake of this example)</span>
<span class="s1">    await delay();</span>
<span class="s1">    // GET information about each book</span>
<span class="s1">    return superagent.get('</span><span class="o">/</span><span class="n">books</span><span class="o">/</span><span class="n">ids</span><span class="o">=</span><span class="s1">'+JSON.stringify(bookIDs));</span>
<span class="s1">  } catch(error) {</span>
<span class="s1">    // If any of the awaited promises was rejected, this catch block</span>
<span class="s1">    // would catch the rejection reason</span>
<span class="s1">    return null;</span>
<span class="s1">  }</span>
<span class="s1">}</span>

<span class="s1">// Start an IIFE to use `await` at the top level</span>
<span class="s1">(async function(){</span>
<span class="s1">  let books = await getAllBooks();</span>
<span class="s1">  console.log(books);</span>
<span class="s1">})();</span>
</pre></div>

<p>Current browser and node versions support <code>async/await</code>. You can also support
older environments by transforming your code to ES5 with the help of
regenerator (or tools that use regenerator, such as Babel).</p>
<hr>
<h3>Let functions accept <em>callbacks</em>
</h3>
<p>A callback is when function 1 is passed to function 2. Function 2 can call
function 1 whenever it is ready. In the context of an asynchronous process,
the callback will be called whenever the asynchronous process is done.
Usually, the result is passed to the callback.</p>
<p>In the example of the question, you can make <code>foo</code> accept a callback and use
it as <code>success</code> callback. So this</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">();</span>
<span class="o">//</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">depends</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="s1">'result'</span>
</pre></div>

<p>becomes</p>
<div class="code"><pre class="code literal-block">foo(function(result) {
    // Code that depends on 'result'
});
</pre></div>

<p>Here we defined the function "inline" but you can pass any function reference:</p>
<div class="code"><pre class="code literal-block">function myCallback(result) {
    // Code that depends on 'result'
}

foo(myCallback);
</pre></div>

<p><code>foo</code> itself is defined as follows:</p>
<div class="code"><pre class="code literal-block"><span class="nt">function</span><span class="w"> </span><span class="nt">foo</span><span class="o">(</span><span class="nt">callback</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">$.ajax({</span>
<span class="w">        </span><span class="err">//</span><span class="w"> </span><span class="err">...</span>
<span class="w">        </span><span class="n">success</span><span class="p">:</span><span class="w"> </span><span class="n">callback</span>
<span class="w">    </span><span class="p">}</span><span class="o">);</span>
<span class="err">}</span>
</pre></div>

<p><code>callback</code> will refer to the function we pass to <code>foo</code> when we call it and we
pass it on to <code>success</code>. I.e. once the Ajax request is successful, <code>$.ajax</code>
will call <code>callback</code> and pass the response to the callback (which can be
referred to with <code>result</code>, since this is how we defined the callback).</p>
<p>You can also process the response before passing it to the callback:</p>
<div class="code"><pre class="code literal-block"><span class="nt">function</span><span class="w"> </span><span class="nt">foo</span><span class="o">(</span><span class="nt">callback</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">$.ajax({</span>
<span class="w">        </span><span class="err">//</span><span class="w"> </span><span class="err">...</span>
<span class="w">        </span><span class="n">success</span><span class="p">:</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">example</span><span class="p">,</span><span class="w"> </span><span class="k">filter</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">response</span>
<span class="w">            </span><span class="nf">callback</span><span class="p">(</span><span class="n">filtered_response</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="err">}</span><span class="o">);</span>
<span class="err">}</span>
</pre></div>

<p>It's easier to write code using callbacks than it may seem. After all,
JavaScript in the browser is heavily event-driven (DOM events). Receiving the
Ajax response is nothing else but an event. Difficulties could arise when you
have to work with third-party code, but most problems can be solved by just
thinking through the application flow.</p>
<hr>
<h3>ES2015+: Promises with then()</h3>
<p>The Promise API is a new feature of ECMAScript 6 (ES2015), but it has good
browser support already. There are also many libraries which implement the
standard Promises API and provide additional methods to ease the use and
composition of asynchronous functions (e.g., bluebird).</p>
<p>Promises are containers for <em>future</em> values. When the promise receives the
value (it is <em>resolved</em> ) or when it is canceled ( <em>rejected</em> ), it notifies
all of its "listeners" who want to access this value.</p>
<p>The advantage over plain callbacks is that they allow you to decouple your
code and they are easier to compose.</p>
<p>Here is an example of using a promise:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">delay</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`delay`</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">promise</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Promise</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">resolve</span><span class="p">,</span><span class="w"> </span><span class="n">reject</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">Only</span><span class="w"> </span><span class="n n-Quoted">`delay`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">able</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">reject</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">promise</span>
<span class="w">    </span><span class="k">set</span><span class="n">Timeout</span><span class="p">(</span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="n">resolve</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">After</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">resolve</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">promise</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="mi">42</span>
<span class="w">    </span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="mi">3000</span><span class="p">);</span>
<span class="w">  </span><span class="err">}</span><span class="p">);</span>
<span class="err">}</span>

<span class="n">delay</span><span class="p">()</span>
<span class="w">  </span><span class="p">.</span><span class="k">then</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`delay`</span><span class="w"> </span><span class="k">returns</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">promise</span>
<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">v</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Log</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="n">once</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">resolved</span>
<span class="w">  </span><span class="err">}</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">catch</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">Or</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">rejected</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="n">would</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">happen</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">example</span><span class="p">,</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n n-Quoted">`reject`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">called</span><span class="p">).</span>
<span class="w">  </span><span class="err">}</span><span class="p">);</span>


<span class="p">.</span><span class="k">as</span><span class="o">-</span><span class="n">console</span><span class="o">-</span><span class="k">wrapper</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">max</span><span class="o">-</span><span class="n">height</span><span class="o">:</span><span class="w"> </span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="o">!</span><span class="n">important</span><span class="p">;</span><span class="w"> </span><span class="n">top</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="err">}</span>
</pre></div>

<p>Applied to our Ajax call we could use promises like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">ajax</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Promise</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">resolve</span><span class="p">,</span><span class="w"> </span><span class="n">reject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">xhr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">XMLHttpRequest</span><span class="p">();</span>
<span class="w">    </span><span class="n">xhr</span><span class="o">.</span><span class="n">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">resolve</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">responseText</span><span class="p">);</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">xhr</span><span class="o">.</span><span class="n">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reject</span><span class="p">;</span>
<span class="w">    </span><span class="n">xhr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">);</span>
<span class="w">    </span><span class="n">xhr</span><span class="o">.</span><span class="n">send</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>

<span class="n">ajax</span><span class="p">(</span><span class="s2">"https://jsonplaceholder.typicode.com/todos/1"</span><span class="p">)</span>
<span class="w">  </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Code</span><span class="w"> </span><span class="n">depending</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">result</span>
<span class="w">  </span><span class="p">})</span>
<span class="w">  </span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">An</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">occurred</span>
<span class="w">  </span><span class="p">});</span>


<span class="o">.</span><span class="k">as</span><span class="o">-</span><span class="n">console</span><span class="o">-</span><span class="n">wrapper</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">max</span><span class="o">-</span><span class="n">height</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="o">!</span><span class="n">important</span><span class="p">;</span><span class="w"> </span><span class="n">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</pre></div>

<p>Describing all the advantages that promise offer is beyond the scope of this
answer, but if you write new code, you should seriously consider them. They
provide a great abstraction and separation of your code.</p>
<p>More information about promises: HTML5 rocks - JavaScript Promises.</p>
<h4>Side note: jQuery's deferred objects</h4>
<p>Deferred objects are jQuery's custom implementation of promises (before the
Promise API was standardized). They behave almost like promises but expose a
slightly different API.</p>
<p>Every Ajax method of jQuery already returns a "deferred object" (actually a
promise of a deferred object) which you can just return from your function:</p>
<div class="code"><pre class="code literal-block"><span class="nv">function</span><span class="w"> </span><span class="nv">ajax</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="k">return</span><span class="w"> </span>$.<span class="nv">ajax</span><span class="ss">(</span>...<span class="ss">)</span><span class="c1">;</span>
}

<span class="nv">ajax</span><span class="ss">()</span>.<span class="nv">done</span><span class="ss">(</span><span class="nv">function</span><span class="ss">(</span><span class="nb">result</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">Code</span><span class="w"> </span><span class="nv">depending</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nb">result</span>
}<span class="ss">)</span>.<span class="nv">fail</span><span class="ss">(</span><span class="nv">function</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">An</span><span class="w"> </span><span class="nv">error</span><span class="w"> </span><span class="nv">occurred</span>
}<span class="ss">)</span><span class="c1">;</span>
</pre></div>

<h4>Side note: Promise gotchas</h4>
<p>Keep in mind that promises and deferred objects are just <em>containers</em> for a
future value, they are not the value itself. For example, suppose you had the
following:</p>
<div class="code"><pre class="code literal-block"><span class="nt">function</span><span class="w"> </span><span class="nt">checkPassword</span><span class="o">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">$.ajax({</span>
<span class="w">        </span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="s1">'/password'</span><span class="p">,</span>
<span class="w">        </span><span class="n">data</span><span class="o">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">username</span><span class="o">:</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="s1">'#username'</span><span class="p">)</span><span class="o">.</span><span class="nf">val</span><span class="p">(),</span>
<span class="w">            </span><span class="n">password</span><span class="o">:</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="s1">'#password'</span><span class="p">)</span><span class="o">.</span><span class="nf">val</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span><span class="o">,</span>
<span class="w">        </span><span class="nt">type</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="o">,</span>
<span class="w">        </span><span class="nt">dataType</span><span class="o">:</span><span class="w"> </span><span class="s1">'json'</span>
<span class="w">    </span><span class="err">}</span><span class="o">);</span>
<span class="err">}</span>

<span class="nt">if</span><span class="w"> </span><span class="o">(</span><span class="nt">checkPassword</span><span class="o">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">Tell</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">user</span><span class="w"> </span><span class="err">they're</span><span class="w"> </span><span class="err">logged</span><span class="w"> </span><span class="err">in</span>
<span class="p">}</span>
</pre></div>

<p>This code misunderstands the above asynchronous issues. Specifically,
<code>$.ajax()</code> doesn't freeze the code while it checks the '/password' page on
your server - it sends a request to the server and while it waits, it
immediately returns a jQuery Ajax Deferred object, not the response from the
server. That means the <code>if</code> statement is going to always get this Deferred
object, treat it as <code>true</code>, and proceed as though the user is logged in. Not
good.</p>
<p>But the fix is easy:</p>
<div class="code"><pre class="code literal-block"><span class="nf">checkPassword</span><span class="p">()</span>
<span class="na">.done</span><span class="p">(</span><span class="no">function</span><span class="p">(</span><span class="no">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="no">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Tell the user they're logged in</span>
<span class="w">    </span><span class="err">}</span><span class="w"> </span><span class="nf">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Tell the user their password was bad</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">})</span>
<span class="na">.fail</span><span class="p">(</span><span class="no">function</span><span class="p">(</span><span class="no">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Tell the user something bad happened</span>
<span class="err">})</span><span class="c1">;</span>
</pre></div>

<hr>
<h3>Not recommended: Synchronous "Ajax" calls</h3>
<p>As I mentioned, some(!) asynchronous operations have synchronous counterparts.
I don't advocate their use, but for completeness' sake, here is how you would
perform a synchronous call:</p>
<h4>Without jQuery</h4>
<p>If you directly use a <code>XMLHttpRequest</code> object, pass <code>false</code> as third argument
to <code>.open</code>.</p>
<h4>jQuery</h4>
<p>If you use jQuery, you can set the <code>async</code> option to <code>false</code>. Note that this
option is <em>deprecated</em> since jQuery 1.8. You can then either still use a
<code>success</code> callback or access the <code>responseText</code> property of the jqXHR object:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">jqXHR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$.</span><span class="n">ajax</span><span class="p">({</span>
<span class="w">        </span><span class="o">//...</span>
<span class="w">        </span><span class="n">async</span><span class="p">:</span><span class="w"> </span><span class="bp">false</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">jqXHR</span><span class="o">.</span><span class="n">responseText</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>If you use any other jQuery Ajax method, such as <code>$.get</code>, <code>$.getJSON</code>, etc.,
you have to change it to <code>$.ajax</code> (since you can only pass configuration
parameters to <code>$.ajax</code>).</p>
<p><strong>Heads up!</strong> It is not possible to make a synchronous JSONP request. JSONP by
its very nature is always asynchronous (one more reason to not even consider
this option).</p>
<p><br></p>
<h3>Suggest</h3>
<h2>If you're <em>not</em> using jQuery in your code, this answer is for you</h2>
<p>Your code should be something along the lines of this:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">httpRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">XMLHttpRequest</span><span class="p">();</span>
<span class="w">    </span><span class="n">httpRequest</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span><span class="w"> </span><span class="s2">"/echo/json"</span><span class="p">);</span>
<span class="w">    </span><span class="n">httpRequest</span><span class="o">.</span><span class="n">send</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">httpRequest</span><span class="o">.</span><span class="n">responseText</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Always</span><span class="w"> </span><span class="n">ends</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="s1">'undefined'</span>
</pre></div>

<p>Felix Kling did a fine job writing an answer for people using jQuery for AJAX,
but I've decided to provide an alternative for people who aren't.</p>
<p>(Note, for those using the new <code>fetch</code> API, Angular or promises I've added
another answer below)</p>
<hr>
<h2>What you're facing</h2>
<p>This is a short summary of "Explanation of the problem" from the other answer,
if you're not sure after reading this, read that.</p>
<p>The <strong>A</strong> in AJAX stands for <strong>asynchronous</strong>. That means sending the request
(or rather receiving the response) is taken out of the normal execution flow.
In your example, <code>.send</code> returns immediately and the next statement, <code>return
result;</code>, is executed before the function you passed as <code>success</code> callback was
even called.</p>
<p>This means when you're returning, the listener you've defined did not execute
yet, which means the value you're returning has not been defined.</p>
<p>Here is a simple analogy:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">getFive</span><span class="p">(){</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="n">setTimeout</span><span class="p">(</span><span class="n">function</span><span class="p">(){</span>
<span class="w">         </span><span class="n">a</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span>
<span class="w">    </span><span class="p">},</span><span class="mi">10</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>(Fiddle)</p>
<p>The value of <code>a</code> returned is <code>undefined</code> since the <code>a=5</code> part has not executed
yet. AJAX acts like this, you're returning the value before the server got the
chance to tell your browser what that value is.</p>
<p>One possible solution to this problem is to code <em>re-actively</em> , telling your
program what to do when the calculation completed.</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">onComplete</span><span class="p">(</span><span class="n">a</span><span class="p">){</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">completes</span><span class="p">,</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">this</span>
<span class="w">    </span><span class="n">alert</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">function</span><span class="w"> </span><span class="n">getFive</span><span class="p">(</span><span class="n">whenDone</span><span class="p">){</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="n">setTimeout</span><span class="p">(</span><span class="n">function</span><span class="p">(){</span>
<span class="w">         </span><span class="n">a</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span>
<span class="w">         </span><span class="n">whenDone</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span><span class="mi">10</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>This is called CPS. Basically, we're passing <code>getFive</code> an action to perform
when it completes, we're telling our code how to react when an event completes
(like our AJAX call, or in this case the timeout).</p>
<p>Usage would be:</p>
<div class="code"><pre class="code literal-block">getFive(onComplete);
</pre></div>

<p>Which should alert "5" to the screen. (Fiddle).</p>
<h2>Possible solutions</h2>
<p>There are basically two ways how to solve this:</p>
<ol>
<li>Make the AJAX call synchronous (let’s call it SJAX).</li>
<li>Restructure your code to work properly with callbacks.</li>
</ol>
<h3>1. Synchronous AJAX - Don't do it!!</h3>
<p>As for synchronous AJAX, <strong>don't do it!</strong> Felix's answer raises some
compelling arguments about why it's a bad idea. To sum it up, it'll freeze the
user's browser until the server returns the response and create a very bad
user experience. Here is another short summary taken from MDN on why:</p>
<blockquote>
<p>XMLHttpRequest supports both synchronous and asynchronous communications. In
general, however, asynchronous requests should be preferred to synchronous
requests for performance reasons.</p>
<p>In short, synchronous requests block the execution of code... ...this can
cause serious issues...</p>
</blockquote>
<p>If you <em>have</em> to do it, you can pass a flag. Here is how:</p>
<div class="code"><pre class="code literal-block"><span class="n">var</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XMLHttpRequest</span><span class="p">();</span>
<span class="n">request</span><span class="p">.</span><span class="k">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span><span class="w"> </span><span class="s1">'yourURL'</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`false`</span><span class="w"> </span><span class="n">makes</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">synchronous</span>
<span class="n">request</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="no">null</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="k">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="o">//</span><span class="w"> </span><span class="n">That</span><span class="s1">'s HTTP for '</span><span class="n">ok</span><span class="s1">'</span>
<span class="s1">  console.log(request.responseText);</span>
<span class="s1">}</span>
</pre></div>

<h3>2. Restructure code</h3>
<p>Let your function accept a callback. In the example code <code>foo</code> can be made to
accept a callback. We'll be telling our code how to <em>react</em> when <code>foo</code>
completes.</p>
<p>So:</p>
<div class="code"><pre class="code literal-block"><span class="n">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foo</span><span class="p">();</span>
<span class="o">//</span><span class="w"> </span><span class="k">Code</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">depends</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n n-Quoted">`result`</span><span class="w"> </span><span class="n">goes</span><span class="w"> </span><span class="n">here</span>
</pre></div>

<p>Becomes:</p>
<div class="code"><pre class="code literal-block"><span class="n">foo</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">Code</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">depends</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n n-Quoted">`result`</span>
<span class="err">}</span><span class="p">);</span>
</pre></div>

<p>Here we passed an anonymous function, but we could just as easily pass a
reference to an existing function, making it look like:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">myHandler</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="k">Code</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">depends</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n n-Quoted">`result`</span>
<span class="err">}</span>
<span class="n">foo</span><span class="p">(</span><span class="n">myHandler</span><span class="p">);</span>
</pre></div>

<p>For more details on how this sort of callback design is done, check Felix's
answer.</p>
<p>Now, let's define foo itself to act accordingly</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">httpRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">XMLHttpRequest</span><span class="p">();</span>
<span class="w">    </span><span class="n">httpRequest</span><span class="o">.</span><span class="n">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">When</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">loaded</span>
<span class="w">       </span><span class="n">callback</span><span class="p">(</span><span class="n">httpRequest</span><span class="o">.</span><span class="n">responseText</span><span class="p">);</span><span class="o">//</span><span class="w"> </span><span class="n">We</span><span class="s1">'re calling our method</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">httpRequest</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span><span class="w"> </span><span class="s2">"/echo/json"</span><span class="p">);</span>
<span class="w">    </span><span class="n">httpRequest</span><span class="o">.</span><span class="n">send</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>(fiddle)</p>
<p>We have now made our <em>foo</em> function accept an action to run when the AJAX
completes successfully. We can extend this further by checking if the response
status is not 200 and acting accordingly (create a fail handler and such).
Effectively it is solving our issue.</p>
<p>If you're still having a hard time understanding this, read the AJAX getting
started guide at MDN.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/ajax/" rel="tag">ajax</a></li>
            <li><a class="tag p-category" href="../../categories/asynchronous/" rel="tag">asynchronous</a></li>
            <li><a class="tag p-category" href="../../categories/javascript/" rel="tag">javascript</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-do-i-merge-two-dictionaries-in-a-single-expression-in-python/" rel="prev" title="How do I merge two dictionaries in a single expression in Python?">Previous post</a>
            </li>
            <li class="next">
                <a href="../what-is-the-difference-between-px-dip-dp-and-sp/" rel="next" title="What is the difference between px, dip, dp, and sp?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
