<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>为什么现代 Perl 默认避免使用 UTF-8？ | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/wei-shi-yao-xian-dai-perl-mo-ren-bi-mian-shi-yong-utf-8/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../c-ru-he-chuang-jian-yi-ge-guidzhi/" title="C#如何创建一个Guid值？" type="text/html">
<link rel="next" href="../ru-he-zai-powershell-zhong-chu-li-ming-ling-xing-can-shu/" title="如何在 PowerShell 中处理命令行参数" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="为什么现代 Perl 默认避免使用 UTF-8？">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/wei-shi-yao-xian-dai-perl-mo-ren-bi-mian-shi-yong-utf-8/">
<meta property="og:description" content="我想知道为什么大多数使用 Perl 构建的现代解决方案默认情况下不启用UTF-8。
我知道核心 Perl 脚本有很多遗留问题，可能会破坏某些东西。但是，从我的角度来看，在 21世纪，大型新项目（或具有广阔前景的项目）应该从头开始对其软件进行
UTF-8 证明。我仍然没有看到它发生。例如，Moose启用 strict 和
warnings，但不启用Unicode。Modern::Perl也减少了样板">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-18T01:43:51+08:00">
<meta property="article:tag" content="perl">
<meta property="article:tag" content="unicode">
<meta property="article:tag" content="utf-8">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">为什么现代 Perl 默认避免使用 UTF-8？</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T01:43:51+08:00" itemprop="datePublished" title="2023-02-18 01:43">2023-02-18 01:43</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>我想知道为什么大多数使用 Perl 构建的现代解决方案默认情况下不启用UTF-8。</p>
<p>我知道核心 Perl 脚本有很多遗留问题，可能会破坏某些东西。但是，从我的角度来看，在 21世纪，大型新项目（或具有广阔前景的项目）应该从头开始对其软件进行
UTF-8 证明。我仍然没有看到它发生。例如，Moose启用 strict 和
warnings，但不启用Unicode。Modern::Perl也减少了样板文件，但没有 UTF-8 处理。</p>
<p>为什么？在 2011 年的现代 Perl 项目中是否有一些理由避免使用 UTF-8？</p>
<hr>
<p>评论@tchrist 太长了，所以我在这里添加它。</p>
<p>看来我没有说清楚。让我尝试添加一些内容。</p>
<p><strong>tchrist</strong> 和我对情况的看法非常相似，但我们的结论却完全相反。我同意，Unicode 的情况很复杂，但这就是为什么我们（Perl
用户和编码人员）需要一些层（或 pragma）来使 UTF-8 处理像现在一样容易。</p>
<p><strong>tchrist</strong> 指出要涵盖的许多方面，我会阅读并思考几天甚至几周。不过，这不是我的意思。 <strong>tchrist</strong> 试图证明没有一种方法可以“启用
UTF-8”。我没有太多的知识可以与之争论。所以，我坚持使用实例。</p>
<p>我玩过Rakudo，UTF-8 就在 <strong>我需要的时候</strong>
。我没有任何问题，它只是工作。也许在更深的地方存在一些限制，但一开始，我测试的所有内容都按预期工作。</p>
<p>这不应该也是现代 Perl 5 的目标吗？我更强调一点：我并不是建议将 UTF-8 作为核心 Perl 的默认字符集，我建议开发 <strong>新</strong> 项目的人可以
<strong>通过 snap</strong> 触发它。 ****</p>
<p>另一个例子，但语气更消极。框架应该使开发更容易。几年前，我尝试过 Web 框架，但因为“启用
UTF-8”太晦涩难懂而放弃了它们。我没有找到如何以及在何处挂接 Unicode
支持。太费时间了，我发现走老路更容易。现在我看到这里有一个赏金来处理与Mason 2 相同的问题： <em>How to make Mason2 UTF-8
clean?</em>. 因此，它是一个非常新的框架，但是将它与 UTF-8 一起使用需要深入了解其内部结构。它就像一个大大的红色标志：停止，不要使用我！</p>
<p>我真的很喜欢 Perl。但是处理 Unicode 是很痛苦的。我仍然发现自己在撞墙。某种程度上 <strong>tchrist</strong> 是对的并回答了我的问题：新项目不吸引
UTF-8 因为它在 Perl 5 中太复杂了。</p>
<p><br><br></p>
<h2>解答</h2>
<h2>𝙎𝙞𝙢𝙥𝙡𝙚𝙨𝙩℞ : ___</h2>
<ol>
<li>
<p>将您的<code>PERL_UNICODE</code>变量设置为<code>AS</code>. 这使得所有 Perl 脚本都解码<code>@ARGV</code>为 UTF-8 字符串，并将 stdin、stdout 和 stderr 这三个的编码设置为 UTF-8。这两者都是全局效应，而不是词汇效应。</p>
</li>
<li>
<p>在你的源文件（程序、模块、库、hickey）的顶部<code>do</code>，通过以下方式突出声明你正在运行 perl 5.12 或更高版本：</p>
<div class="code"><pre class="code literal-block"><span class="nv">use</span><span class="w"> </span><span class="nv">v5</span>.<span class="mi">12</span><span class="c1">;  # minimal for unicode string feature</span>
</pre></div>

<p>use v5.14;  # optimal for unicode string feature</p>
</li>
<li>
<p>启用警告，因为之前的声明仅启用限制和功能，而不启用警告。我还建议将 Unicode 警告提升为异常，因此请同时使用这两行，而不仅仅是其中之一。但是请注意，在 v5.14 下，<code>utf8</code>警告类包含三个其他子警告，它们都可以单独启用：<code>nonchar</code>、<code>surrogate</code>和<code>non_unicode</code>。您可能希望对这些施加更大的控制。</p>
<div class="code"><pre class="code literal-block">use warnings;
</pre></div>

<p>use warnings qw( FATAL utf8 );</p>
</li>
<li>
<p>声明此源单元编码为 UTF-8。尽管曾几何时，这个 pragma 做了其他事情，但现在它只服务于这个单一的目的，没有其他：</p>
<div class="code"><pre class="code literal-block">use utf8;
</pre></div>

</li>
<li>
<p>声明 <em>在这个词法范围内而不是在其他地方</em> 打开文件句柄的任何东西都假定该流是用 UTF-8 编码的，除非你另有说明。这样你就不会影响其他模块或其他程序的代码。</p>
<div class="code"><pre class="code literal-block">use open qw( :encoding(UTF-8) :std );
</pre></div>

</li>
<li>
<p>通过启用命名字符<code>\N{CHARNAME}</code>。</p>
<div class="code"><pre class="code literal-block">use charnames qw( :full :short );
</pre></div>

</li>
<li>
<p>如果您有<code>DATA</code>句柄，则必须显式设置其编码。如果你希望它是 UTF-8，那么说：</p>
<div class="code"><pre class="code literal-block">binmode(DATA, ":encoding(UTF-8)");
</pre></div>

</li>
</ol>
<p>当然，您最终可能会发现自己关心的其他事情没有尽头，但这些足以接近国家目标“让一切都只使用 UTF-8”，尽管这些术语的意义有所减弱。</p>
<p>另一个编译指示虽然与 Unicode 无关，但却是：</p>
<div class="code"><pre class="code literal-block">      use autodie;
</pre></div>

<p>强烈推荐。</p>
<p>🌴🐪🐫🐪🌞𝕲𝖔𝕿𝖍𝖔𝖚𝖆𝖓𝖉𝕯𝖔𝕷𝖎𝖐𝖊𝖜𝖎𝖘𝖊🌞🐪🐫🐪🐁 ___ _</p>
<hr>
<h3>🎁🐪𝖋𝖔𝖗𝖀𝖓𝖎𝖈𝖔𝖉𝖊⸗𝕬𝖜𝖆𝖗𝖊𝕮𝖔𝖉𝖊🎁🎁</h3>
<hr>
<p>这些天我自己的样板看起来像这样：</p>
<div class="code"><pre class="code literal-block"><span class="k">use</span><span class="w"> </span><span class="mf">5.014</span><span class="p">;</span>

<span class="k">use</span><span class="w"> </span><span class="n">utf8</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">strict</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">autodie</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">warnings</span><span class="p">;</span><span class="w"> </span>
<span class="k">use</span><span class="w"> </span><span class="n">warnings</span><span class="w">    </span><span class="n">qw</span><span class="o">&lt;</span><span class="w"> </span><span class="n">FATAL</span><span class="w">  </span><span class="n">utf8</span><span class="w">     </span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="k">open</span><span class="w">        </span><span class="n">qw</span><span class="o">&lt;</span><span class="w"> </span><span class="err">:</span><span class="n">std</span><span class="w">  </span><span class="err">:</span><span class="n">utf8</span><span class="w">     </span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">charnames</span><span class="w">   </span><span class="n">qw</span><span class="o">&lt;</span><span class="w"> </span><span class="err">:</span><span class="k">full</span><span class="w"> </span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">feature</span><span class="w">     </span><span class="n">qw</span><span class="o">&lt;</span><span class="w"> </span><span class="n">unicode_strings</span><span class="w"> </span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">use</span><span class="w"> </span><span class="k">File</span><span class="o">::</span><span class="n">Basename</span><span class="w">      </span><span class="n">qw</span><span class="o">&lt;</span><span class="w"> </span><span class="n">basename</span><span class="w"> </span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">Carp</span><span class="w">                </span><span class="n">qw</span><span class="o">&lt;</span><span class="w"> </span><span class="n">carp</span><span class="w"> </span><span class="n">croak</span><span class="w"> </span><span class="n">confess</span><span class="w"> </span><span class="n">cluck</span><span class="w"> </span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">Encode</span><span class="w">              </span><span class="n">qw</span><span class="o">&lt;</span><span class="w"> </span><span class="n">encode</span><span class="w"> </span><span class="n">decode</span><span class="w"> </span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="nf">Unicode</span><span class="o">::</span><span class="k">Normalize</span><span class="w">  </span><span class="n">qw</span><span class="o">&lt;</span><span class="w"> </span><span class="n">NFD</span><span class="w"> </span><span class="n">NFC</span><span class="w"> </span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">END</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">close</span><span class="w"> </span><span class="n">STDOUT</span><span class="w"> </span><span class="err">}</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">grep</span><span class="w"> </span><span class="o">/</span><span class="err">\</span><span class="n">P</span><span class="err">{</span><span class="nf">ASCII</span><span class="err">}</span><span class="o">/</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">@ARGV</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"> </span>
<span class="w">   </span><span class="nv">@ARGV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">map</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">decode</span><span class="p">(</span><span class="ss">"UTF-8"</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="err">}</span><span class="w"> </span><span class="nv">@ARGV</span><span class="p">;</span>
<span class="err">}</span>

<span class="err">$</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">basename</span><span class="p">(</span><span class="err">$</span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">shorter</span><span class="w"> </span><span class="n">messages</span>
<span class="err">$</span><span class="o">|</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="n">binmode</span><span class="p">(</span><span class="k">DATA</span><span class="p">,</span><span class="w"> </span><span class="ss">":utf8"</span><span class="p">);</span>

<span class="err">#</span><span class="w"> </span><span class="n">give</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">dump</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">untrapped</span><span class="w"> </span><span class="n">exceptions</span>
<span class="k">local</span><span class="w"> </span><span class="err">$</span><span class="n">SIG</span><span class="err">{</span><span class="n">__DIE__</span><span class="err">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sub</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">confess</span><span class="w"> </span><span class="ss">"Uncaught exception: @_"</span><span class="w"> </span><span class="n">unless</span><span class="w"> </span><span class="err">$</span><span class="o">^</span><span class="n">S</span><span class="p">;</span>
<span class="err">}</span><span class="p">;</span>

<span class="err">#</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">promote</span><span class="w"> </span><span class="n">run</span><span class="o">-</span><span class="nc">time</span><span class="w"> </span><span class="n">warnings</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">stack</span><span class="o">-</span><span class="n">dumped</span>
<span class="err">#</span><span class="w">   </span><span class="n">exceptions</span><span class="w"> </span><span class="o">*</span><span class="n">unless</span><span class="o">*</span><span class="w"> </span><span class="n">we</span><span class="err">'</span><span class="n">re</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="ow">in</span>
<span class="err">#</span><span class="w">   </span><span class="n">which</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">cluck</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="k">dump</span><span class="w"> </span><span class="n">instead</span>
<span class="k">local</span><span class="w"> </span><span class="err">$</span><span class="n">SIG</span><span class="err">{</span><span class="n">__WARN__</span><span class="err">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sub</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="err">$</span><span class="o">^</span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">cluck</span><span class="w">   </span><span class="ss">"Trapped warning: @_"</span><span class="w"> </span><span class="err">}</span><span class="w"> </span>
<span class="w">    </span><span class="k">else</span><span class="w">     </span><span class="err">{</span><span class="w"> </span><span class="n">confess</span><span class="w"> </span><span class="ss">"Deadly warning: @_"</span><span class="w">  </span><span class="err">}</span>
<span class="err">}</span><span class="p">;</span>

<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;&gt;</span><span class="p">)</span><span class="w">  </span><span class="err">{</span>
<span class="w">    </span><span class="n">chomp</span><span class="p">;</span>
<span class="w">    </span><span class="err">$</span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NFD</span><span class="p">(</span><span class="err">$</span><span class="n">_</span><span class="p">);</span>
<span class="w">    </span><span class="p">...</span>
<span class="err">}</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">say</span><span class="w"> </span><span class="n">NFC</span><span class="p">(</span><span class="err">$</span><span class="n">_</span><span class="p">);</span>
<span class="err">}</span>

<span class="n">__END__</span>
</pre></div>

<hr>
<h2>🎅𝕹𝖔𝕸𝖆𝖌𝖎𝖈𝕭𝖚𝖑𝖑𝖊𝖙🎅</h2>
<hr>
<p>说“Perl 应该 [ <strong>不知何故！</strong> ] 默认启用 Unicode” 甚至没有开始考虑在某种罕见和孤立的情况下说出足够多的用处。Unicode
不仅仅是一个更大的字符集；这也是这些角色如何以多种方式互动的方式。</p>
<p>即使是（某些）人们似乎认为他们想要的头脑简单的最小措施也肯定会悲惨地破坏数百万行代码，这些代码没有机会“升级”到你漂亮的新美丽新世界现代 <em>性</em> 。</p>
<p>这比人们想象的要复杂得多。在过去的几年里，我想了很多很多。我很想证明我错了。但我不认为我是。Unicode
从根本上说比您想要强加于它的模型更复杂，这里有您永远无法掩盖的复杂性。如果你尝试，你要么会破坏你自己的代码，要么会破坏其他人的代码。在某些时候，您只需要分解并了解
Unicode 是什么。你不能假装它不是。</p>
<p>🐪 竭尽全力使 Unicode
变得简单，远远超过我用过的任何其他东西。如果您认为这不好，请暂时尝试其他方法。然后回到🐪：要么你会回到一个更美好的世界，要么你会带来同样的知识，这样我们就可以利用你的新知识使🐪在这些事情上做得更好。</p>
<hr>
<h3>💡𝕴𝖉𝖊𝖆𝖘𝖆⸗𝕬𝖜𝖆𝖗𝖊🐪𝕷𝖆𝖚𝖓𝖉𝖗𝖞💡💡</h3>
<hr>
<p>至少，这里有一些似乎是 🐪 “默认启用 Unicode”所需的东西，正如您所说：</p>
<ol>
<li>
<p>默认情况下，所有🐪源代码都应该是UTF-8。你可以用<code>use utf8</code>or得到它<code>export PERL5OPTS=-Mutf8</code>。</p>
</li>
<li>
<p>🐪<code>DATA</code>句柄应为 UTF-8。您必须在每个包的基础上执行此操作，如<code>binmode(DATA, ":encoding(UTF-8)")</code>.</p>
</li>
<li>
<p>🐪 脚本的程序参数默认应该理解为 UTF-8。<code>export PERL_UNICODE=A</code>, 或<code>perl -CA</code>, 或<code>export PERL5OPTS=-CA</code>。</p>
</li>
<li>
<p>标准输入、输出和错误流应默认为 UTF-8。<code>export PERL_UNICODE=S</code>对于所有这些，或者<code>I</code>, <code>O</code>, 和/或<code>E</code>只是其中的一些。这就像<code>perl -CS</code>。</p>
</li>
<li>
<p>🐪 打开的任何其他句柄应被视为 UTF-8，除非另有声明；<code>export PERL_UNICODE=D</code>或与<code>i</code>其中<code>o</code>的特定部分一起使用；<code>export PERL5OPTS=-CD</code>会工作。这<code>-CSAD</code>对他们所有人都是如此。</p>
</li>
<li>
<p>覆盖两个基地以及您打开的所有流<code>export PERL5OPTS=-Mopen=:utf8,:std</code>。请参见 <em>单引号</em> 。</p>
</li>
<li>
<p>您不想错过 UTF-8 编码错误。尝试<code>export PERL5OPTS=-Mwarnings=FATAL,utf8</code>。并确保您的输入流始终<code>binmode</code>指向<code>:encoding(UTF-8)</code>，而不仅仅是指向<code>:utf8</code>。</p>
</li>
<li>
<p>🐪 应该将 128–255 之间的代码点理解为相应的 Unicode 代码点，而不仅仅是无属性的二进制值。<code>use feature "unicode_strings"</code>或<code>export PERL5OPTS=-Mfeature=unicode_strings</code>。这将使<code>uc("\xDF") eq "SS"</code>和<code>"\xE9" =~ /\w/</code>。一个简单的<code>export PERL5OPTS=-Mv5.12</code>或更好的也会得到它。</p>
</li>
<li>
<p>命名的 Unicode 字符在默认情况下不启用，所以添加<code>export PERL5OPTS=-Mcharnames=:full,:short,latin,greek</code>或一些这样的。请参见 <em>uninames</em> 和tcgrep。</p>
</li>
<li>
<p>您几乎总是需要访问来自标准<code>Unicode::Normalize</code>模块各种类型分解的功能。<code>export PERL5OPTS=-MUnicode::Normalize=NFD,NFKD,NFC,NFKD</code>，然后总是通过 NFD 运行传入的东西，从 NFC 运行出站的东西。据我所知，这些还没有 I/O 层，但请参阅 <em>nfc</em> 、 <em>nfd</em> 、 <em>nfkd</em> 和 <em>nfkc</em> 。</p>
</li>
<li>
<p>🐪 中使用<code>eq</code>, <code>ne</code>, <code>lc</code>, <code>cmp</code>, <code>sort</code>, &amp;c&amp;cc 的字符串比较总是错误的。因此<code>@a = sort @b</code>，您需要<code>@a = Unicode::Collate-&gt;new-&gt;sort(@b)</code>. 不妨将其添加到您的<code>export PERL5OPTS=-MUnicode::Collate</code>. 您可以缓存用于二进制比较的密钥。</p>
</li>
<li>
<p>🐪 内置函数喜欢<code>printf</code>并<code>write</code>使用 Unicode 数据做错事。您需要为前者使用模块，同时为<code>Unicode::GCString</code>后者使用模块。<code>Unicode::LineBreak</code>请参阅 <em>uwc</em> 和 <em>unifmt</em> 。</p>
</li>
<li>
<p>如果你想让它们计数为整数，那么你将不得不通过函数运行你的捕获<code>\d+</code>，因为 🐪 的内置 <em>atoi (3) 目前</em> 还不够聪明。<code>Unicode::UCD::num</code> __</p>
</li>
<li>
<p>您将在 👽 文件系统上遇到文件系统问题。一些文件系统默默地强制转换为 NFC；其他人默默地强制转换为 NFD。而其他人还在做其他事情。有些人甚至完全不理会这件事，这会导致更大的问题。所以你必须自己处理 NFC/NFD 以保持理智。</p>
</li>
<li>
<p>您所有涉及<code>a-z</code>or<code>A-Z</code>和此类的🐪 代码都 <strong>必须更改</strong> ，包括<code>m//</code>、<code>s///</code>和<code>tr///</code>。它应该作为一个尖叫的红旗脱颖而出，表明您的代码已损坏。但尚不清楚它必须如何改变。获得正确的属性并了解它们的案例，比您想象的要难。我每天都使用 <em>unichars</em> 和 <em>uniprops 。</em></p>
</li>
<li>
<p>使用的代码<code>\p{Lu}</code>几乎和使用<code>[A-Za-z]</code>. 您需要<code>\p{Upper}</code>改为使用，并知道原因。是的，<code>\p{Lowercase}</code>and<code>\p{Lower}</code>不同于<code>\p{Ll}</code>and <code>\p{Lowercase_Letter}</code>。</p>
</li>
<li>
<p>使用的代码<code>[a-zA-Z]</code>更糟。它不能使用<code>\pL</code>or <code>\p{Letter}</code>；它需要使用<code>\p{Alphabetic}</code>. 不是所有的字母都是字母，你知道的！</p>
</li>
<li>
<p>如果你正在寻找 🐪 变量<code>/[\$\@\%]\w+/</code>，那么你就有问题了。您需要寻找<code>/[\$\@\%]\p{IDS}\p{IDC}*/</code>，甚至没有考虑标点符号变量或包变量。</p>
</li>
<li>
<p>如果您正在检查空格，那么您应该在<code>\h</code>和之间进行选择<code>\v</code>，具体取决于。而且你永远不应该使用<code>\s</code>，因为它 <strong>并不意味着</strong> <code>[\h\v]</code>，这与普遍的看法相反。</p>
</li>
<li>
<p>如果您使用的<code>\n</code>是线边界，甚至是<code>\r\n</code>，那么您做错了。你必须使用<code>\R</code>，这是不一样的！</p>
</li>
<li>
<p>如果您不知道何时以及是否调用Unicode::Stringprep，那么您最好学习一下。</p>
</li>
<li>
<p>不区分大小写的比较需要检查两个东西是否是相同的字母，而不管它们的变音符号等等。最简单的方法是使用标准的 Unicode::Collat​​e模块。<code>Unicode::Collate-&gt;new(level =&gt; 1)-&gt;cmp($a, $b)</code>. 还有<code>eq</code>方法等等，您可能也应该了解<code>match</code>和<code>substr</code>方法。这些与 🐪 内置函数相比具有明显的优势。</p>
</li>
<li>
<p>有时这仍然不够，您需要Unicode::Collat​​e::Locale模块，如 in <code>Unicode::Collate::Locale-&gt;new(locale =&gt; "de__phonebook", level =&gt; 1)-&gt;cmp($a, $b)</code>instead。认为那<code>Unicode::Collate::-&gt;new(level =&gt; 1)-&gt;eq("d", "ð")</code>是真的，但却<code>Unicode::Collate::Locale-&gt;new(locale=&gt;"is",level =&gt; 1)-&gt;eq("d", " ð")</code>是假的。同样，“ae”和“æ”表示<code>eq</code>您不使用语言环境，或者如果您使用英语语言环境，但它们在冰岛语言环境中是不同的。怎么办？这很难，我告诉你。您可以使用 <em>ucsort</em> 来测试其中的一些东西。</p>
</li>
<li>
<p>考虑如何匹配字符串“ <em>niño</em> ”中的模式 CVCV（辅音、元音、辅音、元音）。它的 NFD 形式——你最好记得把它放进去——变成了“nin\x{303}o”。现在你打算怎么办？即使假装元音是<code>[aeiou]</code>（顺便说一下，这是错误的），你也不能做任何类似的事情<code>(?=[aeiou])\X)</code>，因为即使在 NFD 中，像 'ø' 这样的代码点 <strong>也不会分解</strong> ！但是，使用我刚刚向您展示的 UCA 比较，它将测试等于“o”。不能靠NFD，得靠UCA。</p>
</li>
</ol>
<hr>
<h3>💩𝔸𝕤𝕤𝕦𝕞𝕖𝔹𝕣𝕠𝕜𝕖𝕟𝕟𝕖𝕤𝕤💩</h3>
<hr>
<p>这还不是全部。人们对 Unicode 做出了一百万个错误的假设。在他们理解这些东西之前，他们的🐪代码将被破解。</p>
<ol>
<li>
<p>假设它可以在不指定编码的情况下打开文本文件的代码已损坏。</p>
</li>
<li>
<p>假定默认编码是某种本机平台编码的代码已损坏。</p>
</li>
<li>
<p>假定日文或中文网页在 UTF-16 中比在 UTF-8 中占用更少空间的代码是错误的。</p>
</li>
<li>
<p>假定 Perl 内部使用 UTF-8 的代码是错误的。</p>
</li>
<li>
<p>假设编码错误总是引发异常的代码是错误的。</p>
</li>
<li>
<p>假定 Perl 代码点限制为 0x10_FFFF 的代码是错误的。</p>
</li>
<li>
<p>假定您可以设置<code>$/</code>为适用于任何有效行分隔符的内容的代码是错误的。</p>
</li>
<li>
<p>假设 casefolding 的往返相等的代码，如<code>lc(uc($s)) eq $s</code>or <code>uc(lc($s)) eq $s</code>，是完全错误的。考虑到<code>uc("σ")</code>和<code>uc("ς")</code>都是<code>"Σ"</code>，但<code>lc("Σ")</code>不可能同时返回这两个。</p>
</li>
<li>
<p>Code that assumes every lowercase code point has a distinct uppercase one, or vice versa, is broken. For example, <code>"ª"</code> is a lowercase letter with no uppercase; whereas both <code>"ᵃ"</code> and <code>"ᴬ"</code> are letters, but they are not lowercase letters; however, they are both lowercase code points without corresponding uppercase versions. Got that? They are <strong>not</strong> <code>\p{Lowercase_Letter}</code>, despite being both <code>\p{Letter}</code> and <code>\p{Lowercase}</code>.</p>
</li>
<li>
<p>Code that assumes changing the case doesn’t change the length of the string is broken.</p>
</li>
<li>
<p>Code that assumes there are only two cases is broken. There’s also titlecase.</p>
</li>
<li>
<p>Code that assumes only letters have case is broken. Beyond just letters, it turns out that numbers, symbols, and even marks have case. In fact, changing the case can even make something change its main general category, like a <code>\p{Mark}</code> turning into a <code>\p{Letter}</code>. It can also make it switch from one script to another.</p>
</li>
<li>
<p>Code that assumes that case is never locale-dependent is broken.</p>
</li>
<li>
<p>Code that assumes Unicode gives a fig about POSIX locales is broken.</p>
</li>
<li>
<p>Code that assumes you can remove diacritics to get at base ASCII letters is evil, still, broken, brain-damaged, wrong, and justification for capital punishment.</p>
</li>
<li>
<p>Code that assumes that diacritics <code>\p{Diacritic}</code> and marks <code>\p{Mark}</code> are the same thing is broken.</p>
</li>
<li>
<p>Code that assumes <code>\p{GC=Dash_Punctuation}</code> covers as much as <code>\p{Dash}</code> is broken.</p>
</li>
<li>
<p>Code that assumes dash, hyphens, and minuses are the same thing as each other, or that there is only one of each, is broken and wrong.</p>
</li>
<li>
<p>Code that assumes every code point takes up no more than one print column is broken.</p>
</li>
<li>
<p>Code that assumes that all <code>\p{Mark}</code> characters take up zero print columns is broken.</p>
</li>
<li>
<p>Code that assumes that characters which look alike <em>are</em> alike is broken.</p>
</li>
<li>
<p>Code that assumes that characters which do <em>not</em> look alike are <em>not</em> alike is broken.</p>
</li>
<li>
<p>Code that assumes there is a limit to the number of code points in a row that just one <code>\X</code> can match is wrong.</p>
</li>
<li>
<p>Code that assumes <code>\X</code> can never start with a <code>\p{Mark}</code> character is wrong.</p>
</li>
<li>
<p>Code that assumes that <code>\X</code> can never hold two non-<code>\p{Mark}</code> characters is wrong.</p>
</li>
<li>
<p>Code that assumes that it cannot use <code>"\x{FFFF}"</code> is wrong.</p>
</li>
<li>
<p>Code that assumes a non-BMP code point that requires two UTF-16 (surrogate) code units will encode to two separate UTF-8 characters, one per code unit, is wrong. It doesn’t: it encodes to single code point.</p>
</li>
<li>
<p>Code that transcodes from UTF‐16 or UTF‐32 with leading BOMs into UTF‐8 is broken if it puts a BOM at the start of the resulting UTF-8. This is so stupid the engineer should have their eyelids removed.</p>
</li>
<li>
<p>Code that assumes the CESU-8 is a valid UTF encoding is wrong. Likewise, code that thinks encoding U+0000 as <code>"\xC0\x80"</code> is UTF-8 is broken and wrong. These guys also deserve the eyelid treatment.</p>
</li>
<li>
<p>Code that assumes characters like <code>&gt;</code> always points to the right and <code>&lt;</code> always points to the left are wrong — because they in fact do not.</p>
</li>
<li>
<p>Code that assumes if you first output character <code>X</code> and then character <code>Y</code>, that those will show up as <code>XY</code> is wrong. Sometimes they don’t.</p>
</li>
<li>
<p><strong>Code that assumes that ASCII is good enough for writing English properly is stupid, shortsighted, illiterate, broken, evil, and wrong.</strong> Off with their heads! If that seems too extreme, we can compromise: henceforth they may type only with their big toe from one foot. (The rest will be duct taped.)</p>
</li>
<li>
<p>Code that assumes that all <code>\p{Math}</code> code points are visible characters is wrong.</p>
</li>
<li>
<p>Code that assumes <code>\w</code> contains only letters, digits, and underscores is wrong.</p>
</li>
<li>
<p>Code that assumes that <code>^</code> and <code>~</code> are punctuation marks is wrong.</p>
</li>
<li>
<p>Code that assumes that <code>ü</code> has an umlaut is wrong.</p>
</li>
<li>
<p>Code that believes things like <code>₨</code> contain any letters in them is wrong.</p>
</li>
<li>
<p>Code that believes <code>\p{InLatin}</code> is the same as <code>\p{Latin}</code> is heinously broken. </p>
</li>
<li>
<p>Code that believe that <code>\p{InLatin}</code> is almost ever useful is almost certainly wrong.</p>
</li>
<li>
<p>Code that believes that given <code>$FIRST_LETTER</code> as the first letter in some alphabet and <code>$LAST_LETTER</code> as the last letter in that same alphabet, that <code>[${FIRST_LETTER}-${LAST_LETTER}]</code> has any meaning whatsoever is almost always complete broken and wrong and meaningless.</p>
</li>
<li>
<p>Code that believes someone’s name can only contain certain characters is stupid, offensive, and wrong.</p>
</li>
<li>
<p>Code that tries to reduce Unicode to ASCII is not merely wrong, its perpetrator should never be allowed to work in programming again. Period. I’m not even positive they should even be allowed to see again, since it obviously hasn’t done them much good so far.</p>
</li>
<li>
<p>Code that believes there’s some way to pretend textfile encodings don’t exist is broken and dangerous. Might as well poke the other eye out, too.</p>
</li>
<li>
<p>Code that converts unknown characters to <code>?</code> is broken, stupid, braindead, and runs contrary to the standard recommendation, which says <strong>NOT TO DO THAT!</strong> RTFM for why not.</p>
</li>
<li>
<p>Code that believes it can reliably guess the encoding of an unmarked textfile is guilty of a fatal mélange of hubris and naïveté that only a lightning bolt from Zeus will fix.</p>
</li>
<li>
<p>Code that believes you can use 🐪 <code>printf</code> widths to pad and justify Unicode data is broken and wrong.</p>
</li>
<li>
<p>Code that believes once you successfully create a file by a given name, that when you run <code>ls</code> or <code>readdir</code> on its enclosing directory, you’ll actually find that file with the name you created it under is buggy, broken, and wrong. Stop being surprised by this!</p>
</li>
<li>
<p>Code that believes UTF-16 is a fixed-width encoding is stupid, broken, and wrong. Revoke their programming licence.</p>
</li>
<li>
<p>Code that treats code points from one plane one whit differently than those from any other plane is <em>ipso facto</em> broken and wrong. Go back to school.</p>
</li>
<li>
<p>Code that believes that stuff like <code>/s/i</code> can only match <code>"S"</code> or <code>"s"</code> is broken and wrong. You’d be surprised.</p>
</li>
<li>
<p>Code that uses <code>\PM\pM*</code> to find grapheme clusters instead of using <code>\X</code> is broken and wrong.</p>
</li>
<li>
<p>People who want to go back to the ASCII world should be whole-heartedly encouraged to do so, and in honor of their glorious upgrade they should be provided <em>gratis</em> with a pre-electric manual typewriter for all their data-entry needs. Messages sent to them should be sent via an ᴀʟʟᴄᴀᴘs telegraph at 40 characters per line and hand-delivered by a courier. STOP.</p>
</li>
</ol>
<hr>
<h2>😱 𝕾 𝖀 𝕸 𝕸 𝕬 𝕽 𝖄 😱</h2>
<hr>
<p>I don’t know how much more “default Unicode in 🐪” you can get than what I’ve
written. Well, yes I do: you should be using <code>Unicode::Collate</code> and
<code>Unicode::LineBreak</code>, too. And probably more.</p>
<p>As you see, there are far too many Unicode things that you really <em>do</em> have to
worry about for there to <em>ever</em> exist any such thing as “default to Unicode”.</p>
<p>What you’re going to discover, just as we did back in 🐪 5.8, that it is simply
impossible to impose all these things on code that hasn’t been designed right
from the beginning to account for them. Your well-meaning selfishness just
broke the entire world.</p>
<p>And even once you do, there are still critical issues that require a great
deal of thought to get right. There is no switch you can flip. Nothing but
brain, and I mean <em>real brain</em> , will suffice here. There’s a heck of a lot of
stuff you have to learn. Modulo the retreat to the manual typewriter, you
simply cannot hope to sneak by in ignorance. This is the 21ˢᵗ century, and you
cannot wish Unicode away by willful ignorance.</p>
<p>You have to learn it. Period. It will never be so easy that “everything just
works,” because that will guarantee that a lot of things <strong>don’t</strong> work —
which invalidates the assumption that there can ever be a way to “make it all
work.”</p>
<p>You may be able to get a few reasonable defaults for a very few and very
limited operations, but not without thinking about things a whole lot more
than I think you have.</p>
<p>As just one example, canonical ordering is going to cause some real headaches.
😭<code>"\x{F5}"</code> <strong>‘õ’</strong> , <code>"o\x{303}"</code> <strong>‘õ’</strong> , <code>"o\x{303}\x{304}"</code> <strong>‘ȭ’</strong> , and
<code>"o\x{304}\x{303}"</code> <strong>‘ō̃’</strong> should all match <strong>‘õ’</strong> , but how in the world
are you going to do that? This is harder than it looks, but it’s something you
need to account for. 💣</p>
<p>If there’s one thing I know about Perl, it is what its Unicode bits do and do
not do, and this thing I promise you: <strong>“ ̲ᴛ̲ʜ̲ᴇ̲ʀ̲ᴇ̲ ̲ɪ̲s̲ ̲ɴ̲ᴏ̲
̲U̲ɴ̲ɪ̲ᴄ̲ᴏ̲ᴅ̲ᴇ̲ ̲ᴍ̲ᴀ̲ɢ̲ɪ̲ᴄ̲ ̲ʙ̲ᴜ̲ʟ̲ʟ̲ᴇ̲ᴛ̲ ̲ ”</strong> 😞</p>
<p>You cannot just change some defaults and get smooth sailing. It’s true that I
run 🐪 with <code>PERL_UNICODE</code> set to <code>"SA"</code>, but that’s all, and even that is
mostly for command-line stuff. For real work, I go through all the many steps
outlined above, and I do it very, <strong> very</strong> carefully.</p>
<hr>
<h2>😈 ¡ƨdləɥ ƨᴉɥʇ ədoɥ puɐ ʻλɐp əɔᴉu ɐ əʌɐɥ ʻʞɔnl poo⅁ 😈</h2>
<p><br></p>
<h3>更多建议</h3>
<p>处理 Unicode 文本有两个阶段。第一个是“如何在不丢失信息的情况下输入和输出”。第二个是“我如何根据当地语言惯例处理文本”。</p>
<p>tchrist 的帖子涵盖了两者，但第二部分是他帖子中 99% 的文本的来源。大多数程序甚至不能正确处理
I/O，因此在您开始担心规范化和整理之前了解这一点很重要。</p>
<p>这篇文章旨在解决第一个问题</p>
<p>当您将数据读入 Perl 时，它并不关心它是什么编码。它分配一些内存并将字节存储在那里。如果你说<code>print
$str</code>，它只是将这些字节输出到你的终端，这可能被设置为假设写入它的所有内容都是 UTF-8，并且你的文本显示出来。</p>
<p>奇妙。</p>
<p>除了，它不是。如果您尝试将数据视为文本，您会发现发生了一些不好的事情。您只需看看<code>length</code>Perl
对您的字符串的看法与您对您的字符串的看法是否不一致。写一行这样的：<code>perl -E 'while(&lt;&gt;){ chomp; say length
}'</code>然后输入<code>文字化け</code>，你会得到 12... 不是正确答案，4。</p>
<p>那是因为 Perl 假定您的字符串不是文本。你必须告诉它这是文本，然后它才会给你正确的答案。</p>
<p>这很容易；Encode 模块具有执行此操作的功能。通用入口点是<code>Encode::decode</code>（或者<code>use Encode
qw(decode)</code>，当然）。该函数从外部世界获取一些字符串（我们称之为“八位字节”，一种“8 位字节”的奇特说法），并将其转换为 Perl
可以理解的文本。第一个参数是字符编码名称，如“UTF-8”或“ASCII”或“EUC-JP”。第二个参数是字符串。返回值是包含文本的 Perl 标量。</p>
<p>（还有<code>Encode::decode_utf8</code>，它假定编码为 UTF-8。）</p>
<p>如果我们重写我们的一行代码：</p>
<div class="code"><pre class="code literal-block"><span class="nv">perl</span><span class="w"> </span><span class="o">-</span><span class="nv">MEncode</span><span class="o">=</span><span class="nv">decode</span><span class="w"> </span><span class="o">-</span><span class="nv">E</span><span class="w"> </span><span class="s1">'while(&lt;&gt;){ chomp; say length decode("UTF-8", $_) }'</span>
</pre></div>

<p>我们输入文字化け，结果是“4”。成功。</p>
<p>那就是 Perl 中 99% 的 Unicode 问题的解决方案。</p>
<p>关键是，无论何时任何文本进入您的程序，您都必须对其进行解码。互联网无法传输字符。文件不能存储字符。您的数据库中没有字符。只有八位字节，您不能将八位字节视为
Perl 中的字符。您必须使用编码模块将编码的八位字节解码为 Perl 字符。</p>
<p>问题的另一半是从程序中获取数据。这很容易；你只是说<code>use Encode qw(encode)</code>，决定你的数据将采用什么编码（UTF-8 到理解 UTF-8
的终端，UTF-16 用于 Windows 上的文件等），然后输出结果而不是仅仅<code>encode($encoding, $data)</code>输出<code>$data</code>.</p>
<p>此操作将 Perl 的字符（您的程序所操作的字符）转换为外部世界可以使用的八位字节。如果我们可以通过 Internet
或将字符发送到我们的终端，那会容易得多，但我们不能：仅八位字节。所以我们必须将字符转换为八位字节，否则结果是不确定的。</p>
<p>总结一下：编码所有输出并解码所有输入。</p>
<p>现在我们讨论三个问题，这三个问题会让这件事变得有点挑战。首先是图书馆。他们是否正确处理文本？答案是……他们尝试。如果您下载网页，LWP
将以文本形式返回结果。如果您对结果调用正确的方法，那就是（恰好是<code>decoded_content</code>，而不是<code>content</code>，这只是它从服务器获得的八位字节流。）数据库驱动程序可能不稳定；如果您仅将
DBD::SQLite 与 Perl 一起使用，它会成功，但是如果其他一些工具将文本存储为数据库中 UTF-8
以外的某种编码......那么......它不会被正确处理直到你编写代码来正确处理它。</p>
<p>输出数据通常更容易，但是如果您看到“打印的宽字符”，那么您就知道您在某处弄乱了编码。该警告的意思是“嘿，您正试图向外界泄露 Perl
字符，这没有任何意义”。您的程序似乎可以工作（因为另一端通常可以正确处理原始 Perl
字符），但它非常损坏并且可能随时停止工作。用显式修复它<code>Encode::encode</code>！</p>
<p>第二个问题是 UTF-8 编码的源代码。除非你<code>use utf8</code>在每个文件的顶部声明，否则 Perl 不会假定你的源代码是
UTF-8。这意味着每次你说类似的东西时<code>my $var = 'ほげ'</code>，你都在向你的程序中注入垃圾，这将彻底破坏一切。您不必“使用
utf8”，但如果您不这样做，则 <em>不得</em> 在您的程序中使用任何非 ASCII 字符。</p>
<p>第三个问题是 Perl 如何处理 The Past。很久以前，还没有 Unicode 这样的东西，Perl 假定一切都是 Latin-1
文本或二进制。因此，当数据进入您的程序并且您开始将其视为文本时，Perl 将每个八位字节视为 Latin-1
字符。这就是为什么当我们询问“文字化け”的长度时，得到的是 12。Perl 假设我们正在操作 Latin-1 字符串“æååã”（它有 12
个字符，其中一些是非打印字符）。</p>
<p>这称为“隐式升级”，这是一件非常合理的事情，但如果您的文本不是 Latin-1，则这不是您想要的。这就是显式解码输入至关重要的原因：如果你不这样做，Perl
会这样做，而且它可能会做错。</p>
<p>人们会遇到麻烦，因为他们的数据一半是正确的字符串，而有些仍然是二进制的。Perl 会将仍然是二进制的部分解释为 Latin-1
文本，然后将其与正确的字符数据组合起来。这将使它看起来像正确处理你的角色破坏了你的程序，但实际上，你只是没有足够地修复它。</p>
<p>下面是一个示例：您有一个读取 UTF-8 编码文本文件的程序，您将 Unicode 添加<code>PILE OF POO</code>到每一行，然后将其打印出来。你这样写：</p>
<div class="code"><pre class="code literal-block"><span class="k">while</span><span class="ss">(</span><span class="o">&lt;&gt;</span><span class="ss">)</span>{
<span class="w">    </span><span class="nv">chomp</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">say</span><span class="w"> </span><span class="s2">"$_ 💩"</span><span class="c1">;</span>
}
</pre></div>

<p>然后在一些 UTF-8 编码的数据上运行，比如：</p>
<div class="code"><pre class="code literal-block">perl poo.pl input-data.txt
</pre></div>

<p>它打印 UTF-8 数据，每行末尾都有一个 poo。完美，我的程序有效！</p>
<p>但是不，你只是在做二进制连接。您正在从文件中读取八位字节，删除<code>\n</code>带有 chomp 的字符，然后添加字符的 UTF-8 表示中的字节<code>PILE OF
POO</code>。当你修改你的程序来解码文件中的数据并对输出进行编码时，你会注意到你得到的是垃圾（“ð©”）而不是便便。这会让您相信解码输入文件是错误的做法。它不是。</p>
<p>问题是 poo 被隐式升级为 latin-1。如果您<code>use utf8</code>制作文字文本而不是二进制文本，那么它将再次起作用！</p>
<p>（这是我在用 Unicode
帮助人们时遇到的第一个问题。他们做对了一部分，但那破坏了他们的程序。这就是未定义结果的可悲之处：你可以有一个可以工作很长时间的程序，但是当你开始修复它时，它中断了。别担心；如果您正在向程序添加编码/解码语句并且它中断了，这仅意味着您还有更多工作要做。下次，当您从一开始就考虑到
Unicode 进行设计时，它将是容易多了！）</p>
<p>这就是您真正需要了解的关于 Perl 和 Unicode 的全部内容。如果你告诉 Perl 你的数据是什么，它在所有流行的编程语言中拥有最好的
Unicode 支持。但是，如果您假设它会神奇地知道您输入的是哪种文本，那么您将无法挽回地丢弃您的数据。仅仅因为你的程序今天在你的 UTF-8
终端上运行并不意味着它明天就能在 UTF-16 编码的文件上运行。因此，现在就确保它的安全，让您免于因破坏用户数据而头疼！</p>
<p>处理 Unicode 最简单的部分是编码输出和解码输入。困难的部分是找到所有的输入和输出，并确定它是哪种编码。但这就是你赚大钱的原因:)</p>
<p><br><br><a href="../why-does-modern-perl-avoid-utf-8-by-default/">查看原文</a></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/perl/" rel="tag">perl</a></li>
            <li><a class="tag p-category" href="../../categories/unicode/" rel="tag">unicode</a></li>
            <li><a class="tag p-category" href="../../categories/utf-8/" rel="tag">utf-8</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../c-ru-he-chuang-jian-yi-ge-guidzhi/" rel="prev" title="C#如何创建一个Guid值？">Previous post</a>
            </li>
            <li class="next">
                <a href="../ru-he-zai-powershell-zhong-chu-li-ming-ling-xing-can-shu/" rel="next" title="如何在 PowerShell 中处理命令行参数">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
