<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How does the "this" keyword work, and when should it be used? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-does-the-this-keyword-work-and-when-should-it-be-used/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-do-i-remove-the-passphrase-for-the-ssh-key-without-having-to-create-a-new-key/" title="How do I remove the passphrase for the SSH key without having to create a new key?" type="text/html">
<link rel="next" href="../how-to-convert-a-string-to-number-in-typescript/" title="How to convert a string to number in TypeScript?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content='How does the "this" keyword work, and when should it be used?'>
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-does-the-this-keyword-work-and-when-should-it-be-used/">
<meta property="og:description" content="I am looking to find a clear explanation of what the &quot;this&quot; keyword does, and
how to use it correctly.
It seems to behave strangely, and I don't fully understand why.
How does this work and when shoul">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T02:06:34+08:00">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="this">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How does the "this" keyword work, and when should it be used?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T02:06:34+08:00" itemprop="datePublished" title="2023-02-17 02:06">2023-02-17 02:06</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I am looking to find a clear explanation of what the "this" keyword does, and
how to use it correctly.</p>
<p>It seems to behave strangely, and I don't fully understand why.</p>
<p>How does <code>this</code> work and when should it be used?</p>
<p><br><br></p>
<h2>Answer</h2>
<p><code>this</code> is a keyword in JavaScript that is a property of an execution context.
Its main use is in functions and constructors. The rules for <code>this</code> are quite
simple (if you stick to best practices).</p>
<h3>Technical description of <code>this</code> in the specification</h3>
<p>The ECMAScript standard defines <code>this</code> via the abstract operation (abbreviated
<em>AO</em> ) ResolveThisBinding:</p>
<blockquote>
<p>The [AO] ResolveThisBinding […] determines the binding of the keyword <code>this</code>
using the LexicalEnvironment of the running execution context. [Steps]:</p>
<ol>
<li>Let <em>envRec</em> be GetThisEnvironment().</li>
<li>Return ? <em>envRec</em>.GetThisBinding().
</li>
</ol>
</blockquote>
<p>Global Environment Records, module Environment Records, and function
Environment Records each have their own GetThisBinding method.</p>
<p>The GetThisEnvironment AO finds the current running execution context’s
LexicalEnvironment and finds the closest ascendant Environment Record (by
iteratively accessing their [[OuterEnv]] properties) which has a <em>this</em>
binding (i.e. HasThisBinding returns <strong>true</strong> ). This process ends in one of
the three Environment Record types.</p>
<p>The value of <code>this</code> often depends on whether code is in strict mode.</p>
<p>The return value of GetThisBinding reflects the value of <code>this</code> of the current
execution context, so whenever a new execution context is established, <code>this</code>
resolves to a distinct value. This can also happen when the current execution
context is modified. The following subsections list the five cases where this
can happen.</p>
<p>You can put the code samples in the AST explorer to follow along with
specification details.</p>
<h4>1. Global execution context in scripts</h4>
<p>This is script code evaluated at the top level, e.g. directly inside a
<code>&lt;script&gt;</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;script&gt;</span>
//<span class="w"> </span>Global<span class="w"> </span>context
console.log(this);<span class="w"> </span>//<span class="w"> </span>Logs<span class="w"> </span>global<span class="w"> </span>object.

setTimeout(function(){
<span class="w">  </span>console.log("Not<span class="w"> </span>global<span class="w"> </span>context");
});
<span class="nt">&lt;/script&gt;</span>
</pre></div>

<p>When in the initial global execution context of a script, evaluating <code>this</code>
causes GetThisBinding to take the following steps:</p>
<blockquote>
<p>The GetThisBinding concrete method of a global Environment Record <em>envRec</em>
[…] [does this]:</p>
<ol>
<li>Return <em>envRec</em>.[[GlobalThisValue]].
</li>
</ol>
</blockquote>
<p>The [[GlobalThisValue]] property of a global Environment Record is always set
to the host-defined global object, which is reachable via <code>globalThis</code>
(<code>window</code> on Web, <code>global</code> on Node.js; Docs on MDN). Follow the steps of
InitializeHostDefinedRealm to learn how the [[GlobalThisValue]] property comes
to be.</p>
<h4>2. Global execution context in modules</h4>
<p>Modules have been introduced in ECMAScript 2015.</p>
<p>This applies to modules, e.g. when directly inside a <code>&lt;script type="module"&gt;</code>,
as opposed to a simple <code>&lt;script&gt;</code>.</p>
<p>When in the initial global execution context of a module, evaluating <code>this</code>
causes GetThisBinding to take the following steps:</p>
<blockquote>
<p>The GetThisBinding concrete method of a module Environment Record […] [does
this]:</p>
<ol>
<li>Return <strong>undefined</strong>.
</li>
</ol>
</blockquote>
<p>In modules, the value of <code>this</code> is always <code>undefined</code> in the global context.
Modules are implicitly in strict mode.</p>
<h4>3. Entering eval code</h4>
<p>There are two kinds of <code>eval</code> calls: direct and indirect. This distinction
exists since the ECMAScript 5th edition.</p>
<ul>
<li>A direct <code>eval</code> call usually looks like <code>eval(</code>…<code>);</code> or <code>(eval)(</code>…<code>);</code> (or <code>((eval))(</code>…<code>);</code>, etc.).1 It’s only <em>direct</em> if the call expression fits a narrow pattern.2</li>
<li>An indirect <code>eval</code> call involves calling the function reference <code>eval</code> in any other way. It could be <code>eval?.(</code>…<code>)</code>, <code>(</code>…<code>, eval)(</code>…<code>)</code>, <code>window.eval(</code>…<code>)</code>, <code>eval.call(</code>…<code>,</code>…<code>)</code>, etc. Given <code>const aliasEval1 = eval; window.aliasEval2 = eval;</code>, it would also be <code>aliasEval1(</code>…<code>)</code>, <code>aliasEval2(</code>…<code>)</code>. Separately, given <code>const originalEval = eval; window.eval = (x) =&gt; originalEval(x);</code>, calling <code>eval(</code>…<code>)</code> would also be indirect.</li>
</ul>
<p>See chuckj’s answer to <em>“(1, eval)('this') vs eval('this') in JavaScript?”</em>
and Dmitry Soshnikov’s ECMA-262-5 in detail – Chapter 2: Strict Mode
(archived) for when you might use an indirect <code>eval()</code> call.</p>
<p>PerformEval executes the <code>eval</code> code. It creates a new declarative Environment
Record as its LexicalEnvironment, which is where GetThisEnvironment gets the
<code>this</code> value from.</p>
<p>Then, if <code>this</code> appears in <code>eval</code> code, the GetThisBinding method of the
Environment Record found by GetThisEnvironment is called and its value
returned.</p>
<p>And the created declarative Environment Record depends on whether the <code>eval</code>
call was direct or indirect:</p>
<ul>
<li>In a direct eval, it will be based on the current running execution context’s LexicalEnvironment.</li>
<li>In an indirect eval, it will be based on the [[GlobalEnv]] property (a global Environment Record) of the Realm Record which executed the indirect eval.</li>
</ul>
<p>Which means:</p>
<ul>
<li>In a direct eval, the <code>this</code> value doesn’t change; it’s taken from the lexical scope that called <code>eval</code>.</li>
<li>In an indirect eval, the <code>this</code> value is the global object (<code>globalThis</code>).</li>
</ul>
<p><em>What about<code>new Function</code>?</em> — <code>new Function</code> is similar to <code>eval</code>, but it
doesn’t call the code immediately; it creates a function. A <em>this</em> binding
doesn’t apply anywhere here, except when the function is called, which works
normally, as explained in the next subsection.</p>
<h4>4. Entering function code</h4>
<p>Entering function code occurs when <em>calling</em> a function.</p>
<p>There are four categories of syntax to invoke a function.</p>
<ul>
<li>The EvaluateCall AO is performed for these three:3<ul>
<li>Normal function calls</li>
<li>Optional chaining calls</li>
<li>Tagged templates</li>
</ul>
</li>
<li>And EvaluateNew is performed for this one:3<ul>
<li>Constructor invocations</li>
</ul>
</li>
</ul>
<p>The actual function call happens at the Call AO, which is called with a
<em>thisValue</em> determined from context; this argument is passed along in a long
chain of call-related calls. Call calls the [[Call]] internal slot of the
function. This calls PrepareForOrdinaryCall where a new function Environment
Record is created:</p>
<blockquote>
<p>A <em>function Environment Record</em> is a declarative Environment Record that is
used to represent the top-level scope of a function and, if the function is
not an <em>ArrowFunction</em> , provides a <code>this</code> binding. If a function is not an
<em>ArrowFunction</em> function and references <code>super</code>, its function Environment
Record also contains the state that is used to perform <code>super</code> method
invocations from within the function.</p>
</blockquote>
<p>In addition, there is the [[ThisValue]] field in a function Environment
Record:</p>
<blockquote>
<p>This is the <code>this</code> value used for this invocation of the function.</p>
</blockquote>
<p>The NewFunctionEnvironment call also sets the function environment’s
[[ThisBindingStatus]] property.</p>
<p>[[Call]] also calls OrdinaryCallBindThis, where the appropriate <em>thisArgument</em>
is determined based on:</p>
<ul>
<li>the original reference,</li>
<li>the kind of the function, and</li>
<li>whether or not the code is in strict mode.</li>
</ul>
<p>Once determined, a final call to the BindThisValue method of the newly created
function Environment Record actually sets the [[ThisValue]] field to the
<em>thisArgument</em>.</p>
<p>Finally, this very field is where a function Environment Record’s
GetThisBinding AO gets the value for <code>this</code> from:</p>
<blockquote>
<p>The GetThisBinding concrete method of a function Environment Record <em>envRec</em>
[…] [does this]:</p>
<p>[…]<br>
 3. Return <em>envRec</em>.[[ThisValue]].</p>
</blockquote>
<p>Again, how exactly the <em>this</em> value is determined depends on many factors;
this was just a general overview. With this technical background, let’s
examine all the concrete examples.</p>
<h5>Arrow functions</h5>
<p>When an arrow function is evaluated, the [[ThisMode]] internal slot of the
function object is set to <em>“lexical”</em> in OrdinaryFunctionCreate.</p>
<p>At OrdinaryCallBindThis, which takes a function <em>F</em> :</p>
<blockquote>
<ol>
<li>Let <em>thisMode</em> be <em>F</em>.[[ThisMode]].</li>
<li>If <em>thisMode</em> is <em>lexical</em> , return NormalCompletion(<code>undefined</code>). […]
</li>
</ol>
</blockquote>
<p>which just means that the rest of the algorithm which binds <em>this</em> is skipped.
An arrow function does not bind its own <em>this</em> value.</p>
<p>So, what is <code>this</code> inside an arrow function, then? Looking back at
ResolveThisBinding and GetThisEnvironment, the HasThisBinding method
explicitly returns <strong>false</strong>.</p>
<blockquote>
<p>The HasThisBinding concrete method of a function Environment Record <em>envRec</em>
[…] [does this]:</p>
<ol>
<li>If <em>envRec</em>.[[ThisBindingStatus]] is <em>lexical</em> , return <strong>false</strong> ;
otherwise, return <strong>true</strong>.
</li>
</ol>
</blockquote>
<p>So the outer environment is looked up instead, iteratively. The process will
end in one of the three environments that have a <em>this</em> binding.</p>
<p>This just means that, <strong>in arrow function bodies,<code>this</code> comes from the lexical
scope of the arrow function</strong>, or in other words (from Arrow function vs
function declaration / expressions: Are they equivalent / exchangeable?):</p>
<blockquote>
<p>Arrow functions don’t have their own <code>this</code> […] binding. Instead, [this
identifier is] resolved in the lexical scope like any other variable. That
means that inside an arrow function, <code>this</code> [refers] to the [value of
<code>this</code>] in the environment the arrow function is <em>defined</em> in (i.e.
“outside” the arrow function).</p>
</blockquote>
<h5>Function properties</h5>
<p>In normal functions (<code>function</code>, methods), <code>this</code> is determined <strong>by how the
function is called</strong>.</p>
<p>This is where these “syntax variants” come in handy.</p>
<p>Consider this object containing a function:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">refObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">func</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span>
<span class="w">      </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
</pre></div>

<p>Alternatively:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">refObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">func</span><span class="p">(){</span>
<span class="w">      </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">};</span>
</pre></div>

<p>In any of the following function calls, the <code>this</code> value inside <code>func</code> will be
<code>refObj</code>.1</p>
<ul>
<li><code>refObj.func()</code></li>
<li><code>refObj["func"]()</code></li>
<li><code>refObj?.func()</code></li>
<li><code>refObj.func?.()</code></li>
<li>`refObj.func```</li>
</ul>
<p>If the called function is syntactically a property of a base object, then this
base will be the “reference” of the call, which, in usual cases, will be the
value of <code>this</code>. This is explained by the evaluation steps linked above; for
example, in <code>refObj.func()</code> (or <code>refObj["func"]()</code>), the
<em>CallMemberExpression</em> is the entire expression <code>refObj.func()</code>, which
consists of the <em>MemberExpression</em> <code>refObj.func</code> and the <em>Arguments</em> <code>()</code>.</p>
<p>But also, <code>refObj.func</code> and <code>refObj</code> play three roles, each:</p>
<ul>
<li>they’re both expressions,</li>
<li>they’re both references, and</li>
<li>they’re both values.</li>
</ul>
<p><code>refObj.func</code> as a <em>value</em> is the callable function object; the corresponding
<em>reference</em> is used to determine the <code>this</code> binding.</p>
<p>The optional chaining and tagged template examples work very similarly:
basically, the reference is everything before the <code>?.()</code>, before the <code>```, or
before the</code>()`.</p>
<p>EvaluateCall uses IsPropertyReference of that reference to determine if it is
a property of an object, syntactically. It’s trying to get the [[Base]]
property of the reference (which is e.g. <code>refObj</code>, when applied to
<code>refObj.func</code>; or <code>foo.bar</code> when applied to <code>foo.bar.baz</code>). If it is written
as a property, then GetThisValue will get this [[Base]] property and use it as
the <em>this</em> value.</p>
<p>Note: Getters / Setters work the same way as methods, regarding <code>this</code>. Simple
properties don’t affect the execution context, e.g. here, <code>this</code> is in global
scope:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Is</span><span class="w"> </span><span class="err">`</span><span class="n">globalThis</span><span class="o">.</span><span class="n">a</span><span class="err">`</span><span class="o">.</span>
<span class="w">    </span><span class="p">[</span><span class="n">this</span><span class="o">.</span><span class="n">a</span><span class="p">]:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Refers</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="err">`</span><span class="n">globalThis</span><span class="o">.</span><span class="n">a</span><span class="err">`</span><span class="o">.</span>
<span class="w">  </span><span class="p">};</span>
</pre></div>

<h5>Calls without base reference, strict mode, and <code>with</code>
</h5>
<p>A call without a base reference is usually a function that isn’t called as a
property. For example:</p>
<div class="code"><pre class="code literal-block">func(); // As opposed to `refObj.func();`.
</pre></div>

<p>This also happens when passing or assigning methods, or using the comma
operator. This is where the difference between Reference Record and Value is
relevant.</p>
<p>Note function <code>j</code>: following the specification, you will notice that <code>j</code> can
only return the function object (Value) itself, but not a Reference Record.
Therefore the base reference <code>refObj</code> is lost.</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="n">ref</span><span class="o">.</span>
<span class="k">const</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">refObj</span><span class="o">.</span><span class="k">func</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">refObj</span><span class="o">.</span><span class="k">func</span><span class="p">;</span>

<span class="n">g</span><span class="p">(</span><span class="n">refObj</span><span class="o">.</span><span class="k">func</span><span class="p">);</span>
<span class="n">h</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="n">ref</span><span class="o">.</span>
<span class="n">j</span><span class="p">()();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="n">ref</span><span class="o">.</span>
<span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">refObj</span><span class="o">.</span><span class="k">func</span><span class="p">)();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Another</span><span class="w"> </span><span class="n">common</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">remove</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="n">ref</span><span class="o">.</span>
</pre></div>

<dl>
<dt>EvaluateCall calls Call with a <em>thisValue</em> of <strong>undefined</strong> here. This makes a</dt>
<dt>difference in OrdinaryCallBindThis ( <em>F</em> : the function object; <em>thisArgument</em>
</dt>
<dd>the <em>thisValue</em> passed to Call):</dd>
</dl>
<blockquote>
<ol>
<li>Let <em>thisMode</em> be <em>F</em>.[[ThisMode]].
</li>
</ol>
<p>[…]</p>
<ol>
<li>If <em>thisMode</em> is <em>strict</em> , let <em>thisValue</em> be <em>thisArgument</em>.</li>
<li>Else,<ol>
<li>If <em>thisArgument</em> is <strong>undefined</strong> or <strong>null</strong> , then</li>
<li>Let <em>globalEnv</em> be <em>calleeRealm</em>.[[GlobalEnv]].</li>
<li>[…]</li>
<li>Let <em>thisValue</em> be <em>globalEnv</em>.[[GlobalThisValue]].</li>
<li>Else,</li>
<li>Let <em>thisValue</em> be ! ToObject(thisArgument).</li>
<li>NOTE: ToObject produces wrapper objects […].
</li>
</ol>
</li>
</ol>
<p>[…]</p>
</blockquote>
<p>Note: step 5 sets the actual value of <code>this</code> to the supplied <em>thisArgument</em> in
strict mode — <code>undefined</code> in this case. In “sloppy mode”, an undefined or null
<em>thisArgument</em> results in <code>this</code> being the global <em>this</em> value.</p>
<p>If IsPropertyReference returns <strong>false</strong> , then EvaluateCall takes these
steps:</p>
<blockquote>
<ol>
<li>Let <em>refEnv</em> be <em>ref</em>.[[Base]].</li>
<li>Assert: <em>refEnv</em> is an Environment Record.</li>
<li>Let <em>thisValue</em> be <em>refEnv</em>.WithBaseObject().
</li>
</ol>
</blockquote>
<p>This is where an undefined <em>thisValue</em> may come from:
<em>refEnv</em>.WithBaseObject() is always <strong>undefined</strong> , <em>except</em> in <code>with</code>
statements. In this case, <em>thisValue</em> will be the binding object.</p>
<p>There’s also <code>Symbol.unscopables</code> (Docs on MDN) to control the <code>with</code> binding
behavior.</p>
<p>To summarize, so far:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">f1</span><span class="p">()</span><span class="err">{</span>
<span class="w">  </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<span class="err">}</span>

<span class="k">function</span><span class="w"> </span><span class="n">f2</span><span class="p">()</span><span class="err">{</span>
<span class="w">  </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<span class="err">}</span>

<span class="k">function</span><span class="w"> </span><span class="n">f3</span><span class="p">()</span><span class="err">{</span>
<span class="w">  </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<span class="err">}</span>

<span class="n">const</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">f1</span><span class="p">,</span>
<span class="w">    </span><span class="n">f2</span><span class="p">,</span>
<span class="w">    </span><span class="err">[</span><span class="n">Symbol</span><span class="p">.</span><span class="n">unscopables</span><span class="err">]</span><span class="o">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="n">f2</span><span class="o">:</span><span class="w"> </span><span class="no">true</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">  </span><span class="err">}</span><span class="p">;</span>

<span class="n">f1</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Logs</span><span class="w"> </span><span class="n n-Quoted">`globalThis`</span><span class="p">.</span>

<span class="k">with</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="err">{</span>
<span class="w">  </span><span class="n">f1</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Logs</span><span class="w"> </span><span class="n n-Quoted">`o`</span><span class="p">.</span>
<span class="w">  </span><span class="n">f2</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`f2`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">unscopable</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">logs</span><span class="w"> </span><span class="n n-Quoted">`globalThis`</span><span class="p">.</span>
<span class="w">  </span><span class="n">f3</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`f3`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n n-Quoted">`o`</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">logs</span><span class="w"> </span><span class="n n-Quoted">`globalThis`</span><span class="p">.</span>
<span class="err">}</span>
</pre></div>

<p>and:</p>
<div class="code"><pre class="code literal-block"><span class="s2">"use strict"</span><span class="p">;</span>

<span class="k">function</span><span class="w"> </span><span class="n">f</span><span class="p">()</span><span class="err">{</span>
<span class="w">  </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<span class="err">}</span>

<span class="n">f</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Logs</span><span class="w"> </span><span class="n n-Quoted">`undefined`</span><span class="p">.</span>

<span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`with`</span><span class="w"> </span><span class="n">statements</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">strict</span><span class="o">-</span><span class="k">mode</span><span class="w"> </span><span class="k">code</span><span class="p">.</span>
</pre></div>

<p>Note that when evaluating <code>this</code>, <strong>it doesn’t matter <em>where</em> a normal
function is defined</strong>.</p>
<h5>
<code>.call</code>, <code>.apply</code>, <code>.bind</code>, <em>thisArg</em> , and primitives</h5>
<p>Another consequence of step 5 of OrdinaryCallBindThis, in conjunction with
step 6.2 (6.b in the spec), is that a primitive <em>this</em> value is coerced to an
object <em>only</em> in “sloppy” mode.</p>
<p>To examine this, let’s introduce another source for the <em>this</em> value: the
three methods that override the <em>this</em> binding:4</p>
<ul>
<li><code>Function.prototype.apply(thisArg, argArray)</code></li>
<li>
<code>Function.prototype.</code> {<code>call</code>, <code>bind</code>} <code>(thisArg, ...args)</code>
</li>
</ul>
<p><code>.bind</code> creates a bound function, whose <em>this</em> binding is set to <em>thisArg</em> and
cannot change again. <code>.call</code> and <code>.apply</code> call the function immediately, with
the <em>this</em> binding set to <em>thisArg</em>.</p>
<p><code>.call</code> and <code>.apply</code> map directly to Call, using the specified <em>thisArg</em>.
<code>.bind</code> creates a bound function with BoundFunctionCreate. These have <em>their
own</em> [[Call]] method which looks up the function object’s [[BoundThis]]
internal slot.</p>
<p>Examples of setting a custom <em>this</em> value:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">f</span><span class="p">()</span><span class="err">{</span>
<span class="w">  </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<span class="err">}</span>

<span class="n">const</span><span class="w"> </span><span class="n">myObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span><span class="p">,</span>
<span class="w">  </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">myObj</span><span class="p">),</span>
<span class="w">  </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">m</span><span class="p">();</span>

<span class="o">//</span><span class="w"> </span><span class="k">All</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n n-Quoted">`myObj`</span><span class="p">.</span>
<span class="n">g</span><span class="p">();</span>
<span class="n">f</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">myObj</span><span class="p">)();</span>
<span class="n">f</span><span class="p">.</span><span class="k">call</span><span class="p">(</span><span class="n">myObj</span><span class="p">);</span>
<span class="n">h</span><span class="p">(</span><span class="n">g</span><span class="p">);</span>
</pre></div>

<p>For objects, this is the same in strict and non-strict mode.</p>
<p>Now, try to supply a primitive value:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">f</span><span class="p">(){</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="n">myString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"s"</span><span class="p">,</span>
<span class="w">  </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">myString</span><span class="p">);</span>

<span class="n">g</span><span class="p">();</span><span class="w">              </span><span class="o">//</span><span class="w"> </span><span class="n">Logs</span><span class="w"> </span><span class="err">`</span><span class="nb nb-Type">String</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"s"</span><span class="w"> </span><span class="p">}</span><span class="err">`</span><span class="o">.</span>
<span class="n">f</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">myString</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Logs</span><span class="w"> </span><span class="err">`</span><span class="nb nb-Type">String</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"s"</span><span class="w"> </span><span class="p">}</span><span class="err">`</span><span class="o">.</span>
</pre></div>

<p>In non-strict mode, primitives are coerced to their object-wrapped form. It’s
the same kind of object you get when calling <code>Object("s")</code> or <code>new
String("s")</code>. In strict mode, you <em>can</em> use primitives:</p>
<div class="code"><pre class="code literal-block"><span class="s2">"use strict"</span><span class="p">;</span>

<span class="n">function</span><span class="w"> </span><span class="n">f</span><span class="p">(){</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="n">myString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"s"</span><span class="p">,</span>
<span class="w">  </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">myString</span><span class="p">);</span>

<span class="n">g</span><span class="p">();</span><span class="w">              </span><span class="o">//</span><span class="w"> </span><span class="n">Logs</span><span class="w"> </span><span class="err">`</span><span class="s2">"s"</span><span class="err">`</span><span class="o">.</span>
<span class="n">f</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">myString</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Logs</span><span class="w"> </span><span class="err">`</span><span class="s2">"s"</span><span class="err">`</span><span class="o">.</span>
</pre></div>

<p>Libraries make use of these methods, e.g. jQuery sets the <code>this</code> to the DOM
element selected here:</p>
<div class="code"><pre class="code literal-block">$("button").click(function(){
  console.log(this); // Logs the clicked button.
});
</pre></div>

<h5>Constructors, classes, and <code>new</code>
</h5>
<p>When calling a function as a constructor using the <code>new</code> operator, EvaluateNew
calls Construct, which calls the [[Construct]] method. If the function is a
base constructor (i.e. not a <code>class extends</code>…<code>{</code>…<code>}</code>), it sets <em>thisArgument</em>
to a new object created from the constructor’s prototype. Properties set on
<code>this</code> in the constructor will end up on the resulting instance object. <code>this</code>
is implicitly returned, unless you explicitly return your own non-primitive
value.</p>
<p>A <code>class</code> is a new way of creating constructor functions, introduced in
ECMAScript 2015.</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">Old</span><span class="p">(</span><span class="n">a</span><span class="p">){</span>
<span class="w">  </span><span class="n">this</span><span class="o">.</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Old</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">o</span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">Logs</span><span class="w"> </span><span class="err">`</span><span class="n">Old</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">p</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="err">`</span><span class="o">.</span>

<span class="k">class</span><span class="w"> </span><span class="n">New</span><span class="p">{</span>
<span class="w">  </span><span class="n">constructor</span><span class="p">(</span><span class="n">a</span><span class="p">){</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">New</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Logs</span><span class="w"> </span><span class="err">`</span><span class="n">New</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">p</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="err">`</span><span class="o">.</span>
</pre></div>

<p>Class definitions are implicitly in strict mode:</p>
<div class="code"><pre class="code literal-block"><span class="n">class</span><span class="w"> </span><span class="n">A</span><span class="err">{</span>
<span class="w">  </span><span class="n">m1</span><span class="p">()</span><span class="err">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="w">  </span><span class="err">}</span>
<span class="w">  </span><span class="n">m2</span><span class="p">()</span><span class="err">{</span>
<span class="w">    </span><span class="n">const</span><span class="w"> </span><span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">m1</span><span class="p">;</span>

<span class="w">    </span><span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">m1</span><span class="p">());</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">}</span>

<span class="k">new</span><span class="w"> </span><span class="n">A</span><span class="p">().</span><span class="n">m2</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Logs</span><span class="w"> </span><span class="n n-Quoted">`undefined`</span><span class="p">.</span>
</pre></div>

<h5><code>super</code></h5>
<p>The exception to the behavior with <code>new</code> is <code>class extends</code>…<code>{</code>…<code>}</code>, as
mentioned above. Derived classes do not immediately set their <em>this</em> value
upon invocation; they only do so once the base class is reached through a
series of <code>super</code> calls (happens implicitly without an own <code>constructor</code>).
Using <code>this</code> before calling <code>super</code> is not allowed.</p>
<p>Calling <code>super</code> calls the super constructor with the <em>this</em> value of the
lexical scope (the function Environment Record) of the call. GetThisValue has
a special rule for <code>super</code> calls. It uses BindThisValue to set <code>this</code> to that
Environment Record.</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="n">DerivedNew</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">New</span><span class="p">{</span>
<span class="w">  </span><span class="n">constructor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">a2</span><span class="p">){</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Using</span><span class="w"> </span><span class="err">`</span><span class="n">this</span><span class="err">`</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="err">`</span><span class="n">super</span><span class="err">`</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">ReferenceError</span><span class="o">.</span>
<span class="w">    </span><span class="n">super</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a2</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">const</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DerivedNew</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n2</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Logs</span><span class="w"> </span><span class="err">`</span><span class="n">DerivedNew</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">p</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">}</span><span class="err">`</span><span class="o">.</span>
</pre></div>

<h4>5. Evaluating class fields</h4>
<p>Instance fields and static fields were introduced in ECMAScript 2022.</p>
<p>When a <code>class</code> is evaluated, ClassDefinitionEvaluation is performed, modifying
the running execution context. For each <em>ClassElement</em> :</p>
<ul>
<li>if a field is static, then <code>this</code> refers to the class itself,</li>
<li>if a field is not static, then <code>this</code> refers to the instance.</li>
</ul>
<p>Private fields (e.g. <code>#x</code>) and methods are added to a PrivateEnvironment.</p>
<p>Static blocks are currently a TC39 stage 3 proposal. Static blocks work the
same as static fields and methods: <code>this</code> inside them refers to the class
itself.</p>
<p>Note that in methods and getters / setters, <code>this</code> works just like in normal
function properties.</p>
<div class="code"><pre class="code literal-block"><span class="n">class</span><span class="w"> </span><span class="n">Demo</span><span class="err">{</span>
<span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="w">  </span><span class="n">b</span><span class="p">()</span><span class="err">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="w">  </span><span class="err">}</span>
<span class="w">  </span><span class="n">static</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="w">  </span><span class="n">static</span><span class="w"> </span><span class="n">d</span><span class="p">()</span><span class="err">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="w">  </span><span class="err">}</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">Getters</span><span class="p">,</span><span class="w"> </span><span class="k">set</span><span class="n">ters</span><span class="p">,</span><span class="w"> </span><span class="n">private</span><span class="w"> </span><span class="n">modifiers</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">possible</span><span class="p">.</span>
<span class="err">}</span>

<span class="n">const</span><span class="w"> </span><span class="n">demo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Demo</span><span class="p">;</span>

<span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">demo</span><span class="p">.</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">demo</span><span class="p">.</span><span class="n">b</span><span class="p">());</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Both</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n n-Quoted">`demo`</span><span class="p">.</span>
<span class="n">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">Demo</span><span class="p">.</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">Demo</span><span class="p">.</span><span class="n">d</span><span class="p">());</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Both</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n n-Quoted">`Demo`</span><span class="p">.</span>
</pre></div>

<hr>
<p>1: <code>(o.f)()</code> is equivalent to <code>o.f()</code>; <code>(f)()</code> is equivalent to <code>f()</code>. This is
explained in this 2ality article (archived). Particularly see how a
<em>ParenthesizedExpression</em> is evaluated.</p>
<p>2: It must be a <em>MemberExpression</em> , must not be a property, must have a
[[ReferencedName]] of exactly <strong>"eval"</strong> , and must be the %eval% intrinsic
object.</p>
<p>3: Whenever the specification says <em>“Let</em> ref <em>be the result of evaluating</em>
X.”, then <em>X</em> is some expression that you need to find the evaluation steps
for. For example, evaluating a <em>MemberExpression</em> or <em>CallExpression</em> is the
result of one of these algorithms. Some of them result in a Reference Record.</p>
<p>4: There are also several other native and host methods that allow providing a
<em>this</em> value, notably <code>Array.prototype.map</code>, <code>Array.prototype.forEach</code>, etc.
that accept a <em>thisArg</em> as their second argument. Anyone can make their own
methods to alter <code>this</code> like <code>(func, thisArg) =&gt; func.bind(thisArg)</code>, <code>(func,
thisArg) =&gt; func.call(thisArg)</code>, etc. As always, MDN offers great
documentation.</p>
<hr>
<h3>Just for fun, test your understanding with some examples</h3>
<p>For each code snippet, answer the question: <em>“What is the value of<code>this</code> at
the marked line? Why?”</em>.</p>
<p><em>To reveal the answers, click the gray boxes.</em></p>
<ol>
<li>if(true){
      console.log(this); // What is <code>this</code> here?
    }</li>
</ol>
<blockquote>
<p><code>globalThis</code>. The marked line is evaluated in the initial global execution
context.</p>
</blockquote>
<ol>
<li>
<p>const obj = {};</p>
<p>function myFun(){
  return { // What is <code>this</code> here?
    "is obj": this === obj,
    "is globalThis": this === globalThis
  };
}</p>
<p>obj.method = myFun;</p>
<p>console.log(obj.method());</p>
</li>
</ol>
<blockquote>
<p><code>obj</code>. When calling a function as a property of an object, it is called with
the <em>this</em> binding set to the <em>base</em> of the reference <code>obj.method</code>, i.e.
<code>obj</code>.</p>
</blockquote>
<ol>
<li>
<p>const obj = {
        myMethod: function(){
          return { // What is <code>this</code> here?
            "is obj": this === obj,
            "is globalThis": this === globalThis
          };
        }
      },
      myFun = obj.myMethod;</p>
<p>console.log(myFun());</p>
</li>
</ol>
<blockquote>
<p><code>globalThis</code>. Since the function value <code>myFun</code> / <code>obj.myMethod</code> is not
called off of an object, as a property, the <em>this</em> binding will be
<code>globalThis</code>. This is different from Python, in which accessing a method
(<code>obj.myMethod</code>) creates a bound method object.</p>
</blockquote>
<ol>
<li>
<p>const obj = {
        myFun: () =&gt; ({ // What is <code>this</code> here?
          "is obj": this === obj,
          "is globalThis": this === globalThis
        })
      };</p>
<p>console.log(obj.myFun());</p>
</li>
</ol>
<blockquote>
<p><code>globalThis</code>. Arrow functions don’t create their own <em>this</em> binding. The
lexical scope is the same as the initial global scope, so <code>this</code> is
<code>globalThis</code>.</p>
</blockquote>
<ol>
<li>
<p>function myFun(){
      console.log(this); // What is <code>this</code> here?
    }</p>
<p>const obj = {
    myMethod: function(){
      eval("myFun()");
    }
  };</p>
<p>obj.myMethod();</p>
</li>
</ol>
<blockquote>
<p><code>globalThis</code>. When evaluating the direct eval call, <code>this</code> is <code>obj</code>.
However, in the eval code, <code>myFun</code> is not called off of an object, so the
<em>this</em> binding is set to the global object.</p>
</blockquote>
<ol>
<li>
<p>function myFun() {
      // What is <code>this</code> here?
      return {
        "is obj": this === obj,
        "is globalThis": this === globalThis
      };
    }</p>
<p>const obj = {};</p>
<p>console.log(myFun.call(obj));</p>
</li>
</ol>
<blockquote>
<p><code>obj</code>. The line <code>myFun.call(obj);</code> is invoking the special built-in function
<code>Function.prototype.call</code>, which accepts <code>thisArg</code> as the first argument.</p>
</blockquote>
<ol>
<li>
<p>class MyCls{
      arrow = () =&gt; ({ // What is <code>this</code> here?
        "is MyCls": this === MyCls,
        "is globalThis": this === globalThis,
        "is instance": this instanceof MyCls
      });
    }</p>
<p>console.log(new MyCls().arrow());</p>
</li>
</ol>
<blockquote>
<p>It’s the instance of <code>MyCls</code>. Arrow functions don’t change the <em>this</em>
binding, so it comes from lexical scope. Therefore, this is <em>exactly the
same</em> as with the class fields mentioned above, like <code>a = this;</code>. Try
changing it to <code>static arrow</code>. Do you get the result you expect?</p>
</blockquote>
<p><br></p>
<h3>Suggest</h3>
<p>The <code>this</code> keyword behaves differently in JavaScript compared to other
languages. In Object Oriented languages, the <code>this</code> keyword refers to the
current instance of the class. In JavaScript the value of <code>this</code> is determined
by the invocation context of function ( <em><code>context.function()</code></em> ) and where it
is called.</p>
<p><strong>1. When used in global context</strong></p>
<p>When you use <code>this</code> in global context, it is bound to global object (<code>window</code>
in browser)</p>
<div class="code"><pre class="code literal-block"><span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">this</span><span class="p">);</span><span class="w">  </span><span class="c1">//[object Window]</span>
</pre></div>

<p>When you use <code>this</code> inside a function defined in the global context, <code>this</code> is
still bound to global object since the function is actually made a method of
global context.</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="nf">f1</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">f1</span><span class="p">());</span><span class="w">  </span><span class="o">//</span><span class="p">[</span><span class="n">object</span><span class="w"> </span><span class="n">Window</span><span class="p">]</span>
</pre></div>

<p>Above <code>f1</code> is made a method of global object. Thus we can also call it on
<code>window</code> object as follows:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="nf">f</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">.</span><span class="n">f</span><span class="p">());</span><span class="w"> </span><span class="o">//</span><span class="p">[</span><span class="n">object</span><span class="w"> </span><span class="n">Window</span><span class="p">]</span>
</pre></div>

<p><strong>2. When used inside object method</strong></p>
<p>When you use <code>this</code> keyword inside an object method, <code>this</code> is bound to the
"immediate" enclosing object.</p>
<div class="code"><pre class="code literal-block"><span class="n">var</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="s">"obj"</span><span class="p">,</span>
<span class="w">    </span><span class="nl">f</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">":"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">f</span><span class="p">());</span><span class="w">  </span><span class="c1">//[object Object]:obj</span>
</pre></div>

<p>Above I have put the word immediate in double quotes. It is to make the point
that if you nest the object inside another object, then <code>this</code> is bound to the
immediate parent.</p>
<div class="code"><pre class="code literal-block"><span class="n">var</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="s">"obj1"</span><span class="p">,</span>
<span class="w">    </span><span class="nl">nestedobj</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">name</span><span class="p">:</span><span class="s">"nestedobj"</span><span class="p">,</span>
<span class="w">        </span><span class="nl">f</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">":"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w">            </span>
<span class="p">}</span>

<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">nestedobj</span><span class="p">.</span><span class="n">f</span><span class="p">());</span><span class="w"> </span><span class="c1">//[object Object]:nestedobj</span>
</pre></div>

<p>Even if you add function explicitly to the object as a method, it still
follows above rules, that is <code>this</code> still points to the immediate parent
object.</p>
<div class="code"><pre class="code literal-block"><span class="n">var</span><span class="w"> </span><span class="n">obj1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="s">"obj1"</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">function</span><span class="w"> </span><span class="n">returnName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">":"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">obj1</span><span class="p">.</span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">returnName</span><span class="p">;</span><span class="w"> </span><span class="c1">//add method to object</span>
<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj1</span><span class="p">.</span><span class="n">f</span><span class="p">());</span><span class="w"> </span><span class="c1">//[object Object]:obj1</span>
</pre></div>

<p><strong>3. When invoking context-less function</strong></p>
<p>When you use <code>this</code> inside function that is invoked without any context (i.e.
not on any object), it is bound to the global object (<code>window</code> in
browser)(even if the function is defined inside the object) .</p>
<div class="code"><pre class="code literal-block"><span class="n">var</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"global"</span><span class="p">;</span>

<span class="n">var</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">    </span><span class="nl">context</span><span class="p">:</span><span class="w"> </span><span class="s">"object"</span><span class="p">,</span>
<span class="w">    </span><span class="nl">method</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">                  </span>
<span class="w">        </span><span class="n">function</span><span class="w"> </span><span class="nf">f</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">var</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"function"</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">":"</span><span class="w"> </span><span class="o">+</span><span class="n">this</span><span class="p">.</span><span class="n">context</span><span class="p">;</span><span class="w"> </span>
<span class="w">        </span><span class="p">};</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">();</span><span class="w"> </span><span class="c1">//invoked without context</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">method</span><span class="p">());</span><span class="w"> </span><span class="c1">//[object Window]:global</span>
</pre></div>

<p><strong>Trying it all with functions</strong></p>
<p>We can try above points with functions too. However there are some
differences.</p>
<ul>
<li>Above we added members to objects using object literal notation. We can add members to functions by using <code>this</code>. to specify them.</li>
<li>Object literal notation creates an instance of object which we can use immediately. With function we may need to first create its instance using <code>new</code> operator.</li>
<li>Also in an object literal approach, we can explicitly add members to already defined object using dot operator. This gets added to the specific instance only. However I have added variable to the function prototype so that it gets reflected in all instances of the function.</li>
</ul>
<p>Below I tried out all the things that we did with Object and <code>this</code> above, but
by first creating function instead of directly writing an object.</p>
<div class="code"><pre class="code literal-block"><span class="cm">/********************************************************************* </span>
<span class="cm">  1. When you add variable to the function using this keyword, it </span>
<span class="cm">     gets added to the function prototype, thus allowing all function </span>
<span class="cm">     instances to have their own copy of the variables added.</span>
<span class="cm">*********************************************************************/</span>
<span class="n">function</span><span class="w"> </span><span class="nf">functionDef</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"ObjDefinition"</span><span class="p">;</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">getName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span><span class="w">                </span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="o">+</span><span class="s">":"</span><span class="o">+</span><span class="n">this</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">obj1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">functionDef</span><span class="p">();</span>
<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj1</span><span class="p">.</span><span class="n">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"&lt;br /&gt;"</span><span class="p">);</span><span class="w"> </span><span class="c1">//[object Object]:ObjDefinition</span>

<span class="cm">/********************************************************************* </span>
<span class="cm">   2. Members explicitly added to the function protorype also behave </span>
<span class="cm">      as above: all function instances have their own copy of the </span>
<span class="cm">      variable added.</span>
<span class="cm">*********************************************************************/</span>
<span class="n">functionDef</span><span class="p">.</span><span class="n">prototype</span><span class="p">.</span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">functionDef</span><span class="p">.</span><span class="n">prototype</span><span class="p">.</span><span class="n">getVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">"v"</span><span class="o">+</span><span class="n">this</span><span class="p">.</span><span class="n">version</span><span class="p">;</span><span class="w"> </span><span class="c1">//see how this.version refers to the</span>
<span class="w">                             </span><span class="c1">//version variable added through </span>
<span class="w">                             </span><span class="c1">//prototype</span>
<span class="p">}</span>
<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj1</span><span class="p">.</span><span class="n">getVersion</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"&lt;br /&gt;"</span><span class="p">);</span><span class="w"> </span><span class="c1">//v1</span>

<span class="cm">/********************************************************************* </span>
<span class="cm">   3. Illustrating that the function variables added by both above </span>
<span class="cm">      ways have their own copies across function instances</span>
<span class="cm">*********************************************************************/</span>
<span class="n">functionDef</span><span class="p">.</span><span class="n">prototype</span><span class="p">.</span><span class="n">incrementVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">version</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">var</span><span class="w"> </span><span class="n">obj2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">functionDef</span><span class="p">();</span>
<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">getVersion</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"&lt;br /&gt;"</span><span class="p">);</span><span class="w"> </span><span class="c1">//v1</span>

<span class="n">obj2</span><span class="p">.</span><span class="n">incrementVersion</span><span class="p">();</span><span class="w">      </span><span class="c1">//incrementing version in obj2</span>
<span class="w">                              </span><span class="c1">//does not affect obj1 version</span>

<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">getVersion</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"&lt;br /&gt;"</span><span class="p">);</span><span class="w"> </span><span class="c1">//v2</span>
<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj1</span><span class="p">.</span><span class="n">getVersion</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"&lt;br /&gt;"</span><span class="p">);</span><span class="w"> </span><span class="c1">//v1</span>

<span class="cm">/********************************************************************* </span>
<span class="cm">   4. `this` keyword refers to the immediate parent object. If you </span>
<span class="cm">       nest the object through function prototype, then `this` inside </span>
<span class="cm">       object refers to the nested object not the function instance</span>
<span class="cm">*********************************************************************/</span>
<span class="n">functionDef</span><span class="p">.</span><span class="n">prototype</span><span class="p">.</span><span class="n">nestedObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="err">'</span><span class="n">nestedObj</span><span class="err">'</span><span class="p">,</span><span class="w"> </span>
<span class="w">                                    </span><span class="nl">getName1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span>
<span class="w">                                        </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="o">+</span><span class="s">":"</span><span class="o">+</span><span class="n">this</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
<span class="w">                                    </span><span class="p">}</span><span class="w">                            </span>
<span class="w">                                  </span><span class="p">};</span>

<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj2</span><span class="p">.</span><span class="n">nestedObj</span><span class="p">.</span><span class="n">getName1</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">"&lt;br /&gt;"</span><span class="p">);</span><span class="w"> </span><span class="c1">//[object Object]:nestedObj</span>

<span class="cm">/********************************************************************* </span>
<span class="cm">   5. If the method is on an object's prototype chain, `this` refers </span>
<span class="cm">      to the object the method was called on, as if the method was on </span>
<span class="cm">      the object.</span>
<span class="cm">*********************************************************************/</span>
<span class="n">var</span><span class="w"> </span><span class="n">ProtoObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">fun</span><span class="o">:</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">};</span>
<span class="n">var</span><span class="w"> </span><span class="n">obj3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Object</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">ProtoObj</span><span class="p">);</span><span class="w"> </span><span class="c1">//creating an object setting ProtoObj</span>
<span class="w">                                    </span><span class="c1">//as its prototype</span>
<span class="n">obj3</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">999</span><span class="p">;</span><span class="w">                       </span><span class="c1">//adding instance member to obj3</span>
<span class="n">document</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj3</span><span class="p">.</span><span class="n">fun</span><span class="p">()</span><span class="o">+</span><span class="s">"&lt;br /&gt;"</span><span class="p">);</span><span class="c1">//999</span>
<span class="w">                                    </span><span class="c1">//calling obj3.fun() makes </span>
<span class="w">                                    </span><span class="c1">//ProtoObj.fun() to access obj3.a as </span>
<span class="w">                                    </span><span class="c1">//if fun() is defined on obj3</span>
</pre></div>

<p><strong>4. When used inside constructor function</strong>.</p>
<p>When the function is used as a constructor (that is when it is called with
<code>new</code> keyword), <code>this</code> inside function body points to the new object being
constructed.</p>
<div class="code"><pre class="code literal-block"><span class="n">var</span><span class="w"> </span><span class="n">myname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"global context"</span><span class="p">;</span>
<span class="k">function</span><span class="w"> </span><span class="n">SimpleFun</span><span class="p">()</span>
<span class="err">{</span>
<span class="w">    </span><span class="n">this</span><span class="p">.</span><span class="n">myname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"simple function"</span><span class="p">;</span>
<span class="err">}</span>

<span class="n">var</span><span class="w"> </span><span class="n">obj1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleFun</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="n">adds</span><span class="w"> </span><span class="n">myname</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">obj1</span>
<span class="o">//</span><span class="mf">1.</span><span class="w"> </span><span class="n n-Quoted">`new`</span><span class="w"> </span><span class="n">causes</span><span class="w"> </span><span class="n n-Quoted">`this`</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">SimpleFun</span><span class="p">()</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="kt">point</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span>
<span class="o">//</span><span class="w">   </span><span class="n">object</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">constructed</span><span class="w"> </span><span class="n">thus</span><span class="w"> </span><span class="n">adding</span><span class="w"> </span><span class="k">any</span><span class="w"> </span><span class="k">member</span>
<span class="o">//</span><span class="w">   </span><span class="n">created</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">SimipleFun</span><span class="p">()</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">membername</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span>
<span class="o">//</span><span class="w">   </span><span class="n">object</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">constructed</span>
<span class="o">//</span><span class="mf">2.</span><span class="w"> </span><span class="k">And</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n n-Quoted">`new`</span><span class="w"> </span><span class="n">makes</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">newly</span><span class="w"> </span>
<span class="o">//</span><span class="w">   </span><span class="n">constructed</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">explicit</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">specified</span>

<span class="n">document</span><span class="p">.</span><span class="k">write</span><span class="p">(</span><span class="n">obj1</span><span class="p">.</span><span class="n">myname</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="k">simple</span><span class="w"> </span><span class="k">function</span>
</pre></div>

<p><strong>5. When used inside function defined on prototype chain</strong></p>
<p>If the method is on an object's prototype chain, <code>this</code> inside such method
refers to the object the method was called on, as if the method is defined on
the object.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">ProtoObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">fun</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
<span class="o">//</span><span class="nb nb-Type">Object</span><span class="o">.</span><span class="n">create</span><span class="p">()</span><span class="w"> </span><span class="n">creates</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">ProtoObj</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">its</span>
<span class="o">//</span><span class="n">prototype</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">assigns</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">obj3</span><span class="p">,</span><span class="w"> </span><span class="n">thus</span><span class="w"> </span><span class="n">making</span><span class="w"> </span><span class="n">fun</span><span class="p">()</span><span class="w"> </span>
<span class="o">//</span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">prototype</span><span class="w"> </span><span class="n">chain</span>

<span class="k">var</span><span class="w"> </span><span class="n">obj3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">ProtoObj</span><span class="p">);</span>
<span class="n">obj3</span><span class="o">.</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">999</span><span class="p">;</span>
<span class="n">document</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">obj3</span><span class="o">.</span><span class="n">fun</span><span class="p">());</span><span class="w"> </span><span class="o">//</span><span class="mi">999</span>

<span class="o">//</span><span class="n">Notice</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">fun</span><span class="p">()</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">obj3</span><span class="s1">'s prototype but </span>
<span class="o">//</span><span class="err">`</span><span class="n">this</span><span class="o">.</span><span class="n">a</span><span class="err">`</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">fun</span><span class="p">()</span><span class="w"> </span><span class="n">retrieves</span><span class="w"> </span><span class="n">obj3</span><span class="o">.</span><span class="n">a</span>
</pre></div>

<p><strong>6. Inside call(), apply() and bind() functions</strong></p>
<ul>
<li>All these methods are defined on <code>Function.prototype</code>.</li>
<li>These methods allows to write a function once and invoke it in different context. In other words, they allows to specify the value of <code>this</code> which will be used while the function is being executed. They also take any parameters to be passed to the original function when it is invoked.</li>
<li>
<strong><code>fun.apply(obj1 [, argsArray])</code></strong> Sets <code>obj1</code> as the value of <code>this</code> inside <code>fun()</code> and calls <code>fun()</code> passing elements of <code>argsArray</code> as its arguments.</li>
<li>
<strong><code>fun.call(obj1 [, arg1 [, arg2 [,arg3 [, ...]]]])</code></strong> - Sets <code>obj1</code> as the value of <code>this</code> inside <code>fun()</code> and calls <code>fun()</code> passing <code>arg1, arg2, arg3, ...</code> as its arguments.</li>
<li>
<strong><code>fun.bind(obj1 [, arg1 [, arg2 [,arg3 [, ...]]]])</code></strong> - Returns the reference to the function <code>fun</code> with <code>this</code> inside fun bound to <code>obj1</code> and parameters of <code>fun</code> bound to the parameters specified <code>arg1, arg2, arg3,...</code>.</li>
<li>
<p>By now the difference between <code>apply</code>, <code>call</code> and <code>bind</code> must have become apparent. <code>apply</code> allows to specify the arguments to function as array-like object i.e. an object with a numeric <code>length</code> property and corresponding non-negative integer properties. Whereas <code>call</code> allows to specify the arguments to the function directly. Both <code>apply</code> and <code>call</code> immediately invokes the function in the specified context and with the specified arguments. On the other hand, <code>bind</code> simply returns the function bound to the specified <code>this</code> value and the arguments. We can capture the reference to this returned function by assigning it to a variable and later we can call it any time.</p>
<p>function add(inc1, inc2)
{
    return this.a + inc1 + inc2;
}</p>
<p>var o = { a : 4 };
document.write(add.call(o, 5, 6)+"<br>"); //15
      //above add.call(o,5,6) sets <code>this</code> inside
      //add() to <code>o</code> and calls add() resulting:
      // this.a + inc1 + inc2 = 
      // <code>o.a</code> i.e. 4 + 5 + 6 = 15
document.write(add.apply(o, [5, 6]) + "<br>"); //15
      // <code>o.a</code> i.e. 4 + 5 + 6 = 15</p>
<p>var g = add.bind(o, 5, 6);       //g: <code>o.a</code> i.e. 4 + 5 + 6
document.write(g()+"<br>");    //15</p>
<p>var h = add.bind(o, 5);          //h: <code>o.a</code> i.e. 4 + 5 + ?
document.write(h(6) + "<br>"); //15
      // 4 + 5 + 6 = 15
document.write(h() + "<br>");  //NaN
      //no parameter is passed to h()
      //thus inc2 inside add() is <code>undefined</code>
      //4 + 5 + undefined = NaN</p>
</li>
</ul>
<p><strong>7.<code>this</code> inside event handlers</strong></p>
<ul>
<li>When you assign function directly to event handlers of an element, use of <code>this</code> directly inside event handling function refers to the corresponding element. Such direct function assignment can be done using <code>addeventListener</code> method or through the traditional event registration methods like <code>onclick</code>.</li>
<li>Similarly, when you use <code>this</code> directly inside the event property (like <code>&lt;button onclick="...this..." &gt;</code>) of the element, it refers to the element.</li>
<li>However use of <code>this</code> indirectly through the other function called inside the event handling function or event property resolves to the global object <code>window</code>.</li>
<li>The same above behavior is achieved when we attach the function to the event handler using Microsoft's Event Registration model method <code>attachEvent</code>. Instead of assigning the function to the event handler (and the thus making the function method of the element), it calls the function on the event (effectively calling it in global context).</li>
</ul>
<p><em>I recommend to better try this in JSFiddle.</em></p>
<div class="code"><pre class="code literal-block"><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="w"> </span>
<span class="w">    </span><span class="k">function</span><span class="w"> </span><span class="n">clickedMe</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">       </span><span class="n">alert</span><span class="p">(</span><span class="n">this</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">" : "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">tagName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">" : "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">this</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span><span class="w"> </span>
<span class="w">    </span><span class="n">document</span><span class="p">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s2">"button1"</span><span class="p">).</span><span class="n">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span><span class="w"> </span><span class="n">clickedMe</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p">);</span>
<span class="w">    </span><span class="n">document</span><span class="p">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s2">"button2"</span><span class="p">).</span><span class="n">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clickedMe</span><span class="p">;</span>
<span class="w">    </span><span class="n">document</span><span class="p">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s2">"button5"</span><span class="p">).</span><span class="n">attachEvent</span><span class="p">(</span><span class="s1">'onclick'</span><span class="p">,</span><span class="w"> </span><span class="n">clickedMe</span><span class="p">);</span><span class="w">   </span>
<span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">h3</span><span class="o">&gt;</span><span class="k">Using</span><span class="w"> </span><span class="n n-Quoted">`this`</span><span class="w"> </span><span class="s2">"directly"</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="k">handler</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="n">property</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">button</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s2">"button1"</span><span class="o">&gt;</span><span class="n">click</span><span class="p">()</span><span class="w"> </span><span class="s2">"assigned"</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">addEventListner</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">button</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s2">"button2"</span><span class="o">&gt;</span><span class="n">click</span><span class="p">()</span><span class="w"> </span><span class="s2">"assigned"</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">click</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">button</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s2">"button3"</span><span class="w"> </span><span class="n">onclick</span><span class="o">=</span><span class="s2">"alert(this+ ' : ' + this.tagName + ' : ' + this.id);"</span><span class="o">&gt;</span><span class="n">used</span><span class="w"> </span><span class="n n-Quoted">`this`</span><span class="w"> </span><span class="n">directly</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">click</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="n">property</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">h3</span><span class="o">&gt;</span><span class="k">Using</span><span class="w"> </span><span class="n n-Quoted">`this`</span><span class="w"> </span><span class="s2">"indirectly"</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="k">handler</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="n">property</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">button</span><span class="w"> </span><span class="n">onclick</span><span class="o">=</span><span class="s2">"alert((function(){return this + ' : ' + this.tagName + ' : ' + this.id;})());"</span><span class="o">&gt;</span><span class="n n-Quoted">`this`</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">indirectly</span><span class="p">,</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="o">&lt;</span><span class="n">br</span><span class="w"> </span><span class="o">/&gt;</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="n">property</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="w"> </span><span class="o">/&gt;</span>

<span class="o">&lt;</span><span class="n">button</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s2">"button4"</span><span class="w"> </span><span class="n">onclick</span><span class="o">=</span><span class="s2">"clickedMe()"</span><span class="o">&gt;</span><span class="n n-Quoted">`this`</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">indirectly</span><span class="p">,</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="o">&lt;</span><span class="n">br</span><span class="w"> </span><span class="o">/&gt;</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="n">property</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">br</span><span class="w"> </span><span class="o">/&gt;</span>

<span class="n">IE</span><span class="w"> </span><span class="k">only</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">button</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s2">"button5"</span><span class="o">&gt;</span><span class="n">click</span><span class="p">()</span><span class="w"> </span><span class="s2">"attached"</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">attachEvent</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
</pre></div>

<p><strong>8.<code>this</code> in ES6 arrow function</strong></p>
<p>In an arrow function, <code>this</code> will behave like common variables: it will be
inherited from its lexical scope. The function's <code>this</code>, where the arrow
function is defined, will be the arrow function's <code>this</code>.</p>
<p>So, that's the same behavior as:</p>
<div class="code"><pre class="code literal-block">(function(){}).bind(this)
</pre></div>

<p>See the following code:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">globalArrowFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">globalArrowFunction</span><span class="p">());</span><span class="w"> </span><span class="o">//</span><span class="n">window</span>

<span class="k">const</span><span class="w"> </span><span class="n">contextObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">method1</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">},</span>
<span class="w">  </span><span class="n">method2</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">this</span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">contextObject</span><span class="o">.</span><span class="n">method1</span><span class="p">());</span><span class="w"> </span><span class="o">//</span><span class="n">window</span>

<span class="k">const</span><span class="w"> </span><span class="n">contextLessFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contextObject</span><span class="o">.</span><span class="n">method1</span><span class="p">;</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">contextLessFunction</span><span class="p">());</span><span class="w"> </span><span class="o">//</span><span class="n">window</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">contextObject</span><span class="o">.</span><span class="n">method2</span><span class="p">()())</span><span class="w"> </span><span class="o">//</span><span class="n">contextObject</span>

<span class="k">const</span><span class="w"> </span><span class="n">innerArrowFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contextObject</span><span class="o">.</span><span class="n">method2</span><span class="p">();</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">innerArrowFunction</span><span class="p">());</span><span class="w"> </span><span class="o">//</span><span class="n">contextObject</span>
</pre></div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/javascript/" rel="tag">javascript</a></li>
            <li><a class="tag p-category" href="../../categories/this/" rel="tag">this</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-do-i-remove-the-passphrase-for-the-ssh-key-without-having-to-create-a-new-key/" rel="prev" title="How do I remove the passphrase for the SSH key without having to create a new key?">Previous post</a>
            </li>
            <li class="next">
                <a href="../how-to-convert-a-string-to-number-in-typescript/" rel="next" title="How to convert a string to number in TypeScript?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
