<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Is there a way to detect if a browser window is not currently active? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/is-there-a-way-to-detect-if-a-browser-window-is-not-currently-active/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../check-if-a-string-contains-a-string-in-c/" title="Check if a string contains a string in C++" type="text/html">
<link rel="next" href="../what-is-the-equivalent-of-the-c-pair-l-r-in-java/" title="What is the equivalent of the C++ Pair&lt;L,R&gt; in Java?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Is there a way to detect if a browser window is not currently active?">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/is-there-a-way-to-detect-if-a-browser-window-is-not-currently-active/">
<meta property="og:description" content="I have JavaScript that is doing activity periodically. When the user is not
looking at the site (i.e., the window or tab does not have focus), it'd be
nice to not run.
Is there a way to do this using ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T17:09:29+08:00">
<meta property="article:tag" content="browser">
<meta property="article:tag" content="focus">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="window">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Is there a way to detect if a browser window is not currently active?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T17:09:29+08:00" itemprop="datePublished" title="2023-02-17 17:09">2023-02-17 17:09</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I have JavaScript that is doing activity periodically. When the user is not
looking at the site (i.e., the window or tab does not have focus), it'd be
nice to not run.</p>
<p>Is there a way to do this using JavaScript?</p>
<p>My reference point: Gmail Chat plays a sound if the window you're using isn't
active.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Since originally writing this answer, a new specification has reached
<em>recommendation</em> status thanks to the W3C. The Page Visibility API (on MDN)
now allows us to more accurately detect when a page is hidden to the user.</p>
<div class="code"><pre class="code literal-block">document.addEventListener("visibilitychange", onchange);
</pre></div>

<p>Current browser support:</p>
<ul>
<li>Chrome 13+</li>
<li>Internet Explorer 10+</li>
<li>Firefox 10+</li>
<li>Opera 12.10+ [read notes]</li>
</ul>
<p>The following code falls back to the less reliable blur/focus method in
incompatible browsers:</p>
<div class="code"><pre class="code literal-block"><span class="p">(</span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="nf">var</span><span class="w"> </span><span class="n">hidden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">"hidden"</span><span class="p">;</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nl">Standards</span><span class="p">:</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hidden</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">document</span><span class="p">)</span>
<span class="w">    </span><span class="n">document</span><span class="p">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="ss">"visibilitychange"</span><span class="p">,</span><span class="w"> </span><span class="n">onchange</span><span class="p">);</span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">hidden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">"mozHidden"</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">document</span><span class="p">)</span>
<span class="w">    </span><span class="n">document</span><span class="p">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="ss">"mozvisibilitychange"</span><span class="p">,</span><span class="w"> </span><span class="n">onchange</span><span class="p">);</span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">hidden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">"webkitHidden"</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">document</span><span class="p">)</span>
<span class="w">    </span><span class="n">document</span><span class="p">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="ss">"webkitvisibilitychange"</span><span class="p">,</span><span class="w"> </span><span class="n">onchange</span><span class="p">);</span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">hidden</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">"msHidden"</span><span class="p">)</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">document</span><span class="p">)</span>
<span class="w">    </span><span class="n">document</span><span class="p">.</span><span class="n">addEventListener</span><span class="p">(</span><span class="ss">"msvisibilitychange"</span><span class="p">,</span><span class="w"> </span><span class="n">onchange</span><span class="p">);</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">IE</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">lower</span><span class="err">:</span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ss">"onfocusin"</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">document</span><span class="p">)</span>
<span class="w">    </span><span class="n">document</span><span class="p">.</span><span class="n">onfocusin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="p">.</span><span class="n">onfocusout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onchange</span><span class="p">;</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="ow">All</span><span class="w"> </span><span class="nl">others</span><span class="p">:</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="k">window</span><span class="p">.</span><span class="n">onpageshow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">window</span><span class="p">.</span><span class="n">onpagehide</span>
<span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="k">window</span><span class="p">.</span><span class="n">onfocus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">window</span><span class="p">.</span><span class="n">onblur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onchange</span><span class="p">;</span>

<span class="w">  </span><span class="k">function</span><span class="w"> </span><span class="n">onchange</span><span class="w"> </span><span class="p">(</span><span class="n">evt</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nf">var</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">"visible"</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">"hidden"</span><span class="p">,</span>
<span class="w">        </span><span class="n">evtMap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span>
<span class="w">          </span><span class="nl">focus</span><span class="p">:</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="nl">focusin</span><span class="p">:</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="nl">pageshow</span><span class="p">:</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="nl">blur</span><span class="p">:</span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="nl">focusout</span><span class="p">:</span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="nl">pagehide</span><span class="p">:</span><span class="n">h</span>
<span class="w">        </span><span class="err">}</span><span class="p">;</span>

<span class="w">    </span><span class="n">evt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evt</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="k">window</span><span class="p">.</span><span class="n">event</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">evt</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">evtMap</span><span class="p">)</span>
<span class="w">      </span><span class="n">document</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evtMap</span><span class="o">[</span><span class="n">evt.type</span><span class="o">]</span><span class="p">;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">      </span><span class="n">document</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">className</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">[</span><span class="n">hidden</span><span class="o">]</span><span class="w"> </span><span class="vm">?</span><span class="w"> </span><span class="ss">"hidden"</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="ss">"visible"</span><span class="p">;</span>
<span class="w">  </span><span class="err">}</span>

<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="p">(</span><span class="n">but</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">browser</span><span class="w"> </span><span class="n">supports</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Page</span><span class="w"> </span><span class="n">Visibility</span><span class="w"> </span><span class="n">API</span><span class="p">)</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">document</span><span class="o">[</span><span class="n">hidden</span><span class="o">]</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="n">undefined</span><span class="w"> </span><span class="p">)</span>
<span class="w">    </span><span class="n">onchange</span><span class="p">(</span><span class="err">{</span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="n">document</span><span class="o">[</span><span class="n">hidden</span><span class="o">]</span><span class="w"> </span><span class="vm">?</span><span class="w"> </span><span class="ss">"blur"</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="ss">"focus"</span><span class="err">}</span><span class="p">);</span>
<span class="err">}</span><span class="p">)();</span>
</pre></div>

<p><code>onfocusin</code> and <code>onfocusout</code> are required for IE 9 and lower, while all others
make use of <code>onfocus</code> and <code>onblur</code>, except for iOS, which uses <code>onpageshow</code>
and <code>onpagehide</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I would use jQuery because then all you have to do is this:</p>
<div class="code"><pre class="code literal-block">$(window).blur(function(){
  //your code here
});
$(window).focus(function(){
  //your code
});
</pre></div>

<p>Or at least it worked for me.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/browser/" rel="tag">browser</a></li>
            <li><a class="tag p-category" href="../../categories/focus/" rel="tag">focus</a></li>
            <li><a class="tag p-category" href="../../categories/javascript/" rel="tag">javascript</a></li>
            <li><a class="tag p-category" href="../../categories/window/" rel="tag">window</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../check-if-a-string-contains-a-string-in-c/" rel="prev" title="Check if a string contains a string in C++">Previous post</a>
            </li>
            <li class="next">
                <a href="../what-is-the-equivalent-of-the-c-pair-l-r-in-java/" rel="next" title="What is the equivalent of the C++ Pair&lt;L,R&gt; in Java?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
