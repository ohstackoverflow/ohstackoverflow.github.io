<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How can I safely create a directory (possibly including intermediate directories)? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-can-i-safely-create-a-directory-possibly-including-intermediate-directories/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-can-i-validate-an-email-address-in-javascript/" title="How can I validate an email address in JavaScript?" type="text/html">
<link rel="next" href="../how-do-i-push-a-new-local-branch-to-a-remote-git-repository-and-track-it-too/" title="How do I push a new local branch to a remote Git repository and track it too?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="How can I safely create a directory (possibly including intermediate d">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-can-i-safely-create-a-directory-possibly-including-intermediate-directories/">
<meta property="og:description" content="I am writing a file using Python, and I want it to be placed in a specific
path. How can I safely make sure that the path exists?
That is: how can I check whether the folder exists, along with its par">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-16T18:40:07+08:00">
<meta property="article:tag" content="directory">
<meta property="article:tag" content="exception">
<meta property="article:tag" content="operating-system">
<meta property="article:tag" content="path">
<meta property="article:tag" content="python">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How can I safely create a directory (possibly including intermediate directories)?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T18:40:07+08:00" itemprop="datePublished" title="2023-02-16 18:40">2023-02-16 18:40</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I am writing a file using Python, and I want it to be placed in a specific
path. How can I safely make sure that the path exists?</p>
<p>That is: how can I check whether the folder exists, along with its parents? If
there are missing folders along the path, how can I create them?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>On Python ≥ 3.5, use <code>pathlib.Path.mkdir</code>:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="n">Path</span><span class="p">(</span><span class="s2">"/my/directory"</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

<p>For older versions of Python, I see two answers with good qualities, each with
a small flaw, so I will give my take on it:</p>
<p>Try <code>os.path.exists</code>, and consider <code>os.makedirs</code> for the creation.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</pre></div>

<p>As noted in comments and elsewhere, there's a race condition – if the
directory is created between the <code>os.path.exists</code> and the <code>os.makedirs</code> calls,
the <code>os.makedirs</code> will fail with an <code>OSError</code>. Unfortunately, blanket-catching
<code>OSError</code> and continuing is not foolproof, as it will ignore a failure to
create the directory due to other factors, such as insufficient permissions,
full disk, etc.</p>
<p>One option would be to trap the <code>OSError</code> and examine the embedded error code
(see Is there a cross-platform way of getting information from Python’s
OSError):</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">errno</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">!=</span> <span class="n">errno</span><span class="o">.</span><span class="n">EEXIST</span><span class="p">:</span>
        <span class="k">raise</span>
</pre></div>

<p>Alternatively, there could be a second <code>os.path.exists</code>, but suppose another
created the directory after the first check, then removed it before the second
one – we could still be fooled.</p>
<p>Depending on the application, the danger of concurrent operations may be more
or less than the danger posed by other factors such as file permissions. The
developer would have to know more about the particular application being
developed and its expected environment before choosing an implementation.</p>
<p>Modern versions of Python improve this code quite a bit, both by exposing
<code>FileExistsError</code> (in 3.3+)...</p>
<div class="code"><pre class="code literal-block"><span class="k">try</span><span class="o">:</span>
<span class="w">    </span><span class="n">os</span><span class="o">.</span><span class="na">makedirs</span><span class="o">(</span><span class="s2">"path/to/directory"</span><span class="o">)</span>
<span class="n">except</span><span class="w"> </span><span class="n">FileExistsError</span><span class="o">:</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">exists</span>
<span class="w">    </span><span class="n">pass</span>
</pre></div>

<p>...and by allowing a keyword argument to <code>os.makedirs</code> called <code>exist_ok</code> (in
3.2+).</p>
<div class="code"><pre class="code literal-block"><span class="nv">os</span>.<span class="nv">makedirs</span><span class="ss">(</span><span class="s2">"path/to/directory"</span>,<span class="w"> </span><span class="nv">exist_ok</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span><span class="w">  </span>#<span class="w"> </span><span class="nv">succeeds</span><span class="w"> </span><span class="nv">even</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">directory</span><span class="w"> </span><span class="nv">exists</span>.
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<h3>Python 3.5+:</h3>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s1">'/my/directory'</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

<p><code>pathlib.Path.mkdir</code> as used above recursively creates the directory and does
not raise an exception if the directory already exists. If you don't need or
want the parents to be created, skip the <code>parents</code> argument.</p>
<h3>Python 3.2+:</h3>
<p><strong>Using<code>pathlib</code>:</strong></p>
<p>If you can, install the current <code>pathlib</code> backport named <code>pathlib2</code>. Do not
install the older unmaintained backport named <code>pathlib</code>. Next, refer to the
Python 3.5+ section above and use it the same.</p>
<p>If using Python 3.4, even though it comes with <code>pathlib</code>, it is missing the
useful <code>exist_ok</code> option. The backport is intended to offer a newer and
superior implementation of <code>mkdir</code> which includes this missing option.</p>
<p><strong>Using<code>os</code>:</strong></p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

<p><code>os.makedirs</code> as used above recursively creates the directory and does not
raise an exception if the directory already exists. It has the optional
<code>exist_ok</code> argument only if using Python 3.2+, with a default value of
<code>False</code>. This argument does not exist in Python 2.x up to 2.7. As such, there
is no need for manual exception handling as with Python 2.7.</p>
<h3>Python 2.7+:</h3>
<p><strong>Using<code>pathlib</code>:</strong></p>
<p>If you can, install the current <code>pathlib</code> backport named <code>pathlib2</code>. Do not
install the older unmaintained backport named <code>pathlib</code>. Next, refer to the
Python 3.5+ section above and use it the same.</p>
<p><strong>Using<code>os</code>:</strong></p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">os</span>
<span class="k">try</span><span class="p">:</span> 
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">raise</span>
</pre></div>

<p>While a naive solution may first use <code>os.path.isdir</code> followed by
<code>os.makedirs</code>, the solution above reverses the order of the two operations. In
doing so, it prevents a common race condition having to do with a duplicated
attempt at creating the directory, and also disambiguates files from
directories.</p>
<p>Note that capturing the exception and using <code>errno</code> is of limited usefulness
because <code>OSError: [Errno 17] File exists</code>, i.e. <code>errno.EEXIST</code>, is raised for
both files and directories. It is more reliable simply to check if the
directory exists.</p>
<h3>Alternative:</h3>
<p><code>mkpath</code> creates the nested directory, and does nothing if the directory
already exists. This works in both Python 2 and 3. Note however that
<code>distutils</code> has been deprecated, and is scheduled for removal in Python 3.12.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">distutils.dir_util</span>
<span class="n">distutils</span><span class="o">.</span><span class="n">dir_util</span><span class="o">.</span><span class="n">mkpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>

<p>Per Bug 10948, a severe limitation of this alternative is that it works only
once per python process for a given path. In other words, if you use it to
create a directory, then delete the directory from inside or outside Python,
then use <code>mkpath</code> again to recreate the same directory, <code>mkpath</code> will simply
silently use its invalid cached info of having previously created the
directory, and will not actually make the directory again. In contrast,
<code>os.makedirs</code> doesn't rely on any such cache. This limitation may be okay for
some applications.</p>
<hr>
<p>With regard to the directory's <em>mode</em> , please refer to the documentation if
you care about it.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/directory/" rel="tag">directory</a></li>
            <li><a class="tag p-category" href="../../categories/exception/" rel="tag">exception</a></li>
            <li><a class="tag p-category" href="../../categories/operating-system/" rel="tag">operating-system</a></li>
            <li><a class="tag p-category" href="../../categories/path/" rel="tag">path</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-can-i-validate-an-email-address-in-javascript/" rel="prev" title="How can I validate an email address in JavaScript?">Previous post</a>
            </li>
            <li class="next">
                <a href="../how-do-i-push-a-new-local-branch-to-a-remote-git-repository-and-track-it-too/" rel="next" title="How do I push a new local branch to a remote Git repository and track it too?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
