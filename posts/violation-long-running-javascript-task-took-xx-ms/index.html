<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Violation Long running JavaScript task took xx ms | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/violation-long-running-javascript-task-took-xx-ms/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../jquery-ajax-cross-domain/" title="jQuery AJAX cross domain" type="text/html">
<link rel="next" href="../what-is-suppresswarnings-unchecked-in-java/" title='What is SuppressWarnings ("unchecked") in Java?' type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Violation Long running JavaScript task took xx ms">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/violation-long-running-javascript-task-took-xx-ms/">
<meta property="og:description" content="Recently, I got this kind of warning, and this is my first time getting it:

[Violation] Long running JavaScript task took 234ms
[Violation] Forced reflow while executing JavaScript took 45ms



I'm w">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T06:22:15+08:00">
<meta property="article:tag" content="dom">
<meta property="article:tag" content="google-chrome">
<meta property="article:tag" content="javascript">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Violation Long running JavaScript task took xx ms</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T06:22:15+08:00" itemprop="datePublished" title="2023-03-03 06:22">2023-03-03 06:22</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>Recently, I got this kind of warning, and this is my first time getting it:</p>
<blockquote>
<div class="code"><pre class="code literal-block"><span class="o">[</span><span class="n">Violation</span><span class="o">]</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="n">JavaScript</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="n">took</span><span class="w"> </span><span class="mi">234</span><span class="n">ms</span>
<span class="o">[</span><span class="n">Violation</span><span class="o">]</span><span class="w"> </span><span class="n">Forced</span><span class="w"> </span><span class="n">reflow</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">executing</span><span class="w"> </span><span class="n">JavaScript</span><span class="w"> </span><span class="n">took</span><span class="w"> </span><span class="mi">45</span><span class="n">ms</span>
</pre></div>

</blockquote>
<p>I'm working on a group project and I have no idea where this is coming from.
This never happened before. Suddenly, it appeared when someone else got
involved in the project. How do I find what file/function causes this warning?
I've been looking for the answer, but mostly about the solution on how to
solve it. I can't solve it if I can't even find the source of the problem.</p>
<p>In this case, the warning appears only on Chrome. I tried to use Edge, but I
didn't get any similar warnings, and I haven't tested it on Firefox yet.</p>
<p>I even get the error from <code>jquery.min.js</code>:</p>
<blockquote>
<div class="code"><pre class="code literal-block"><span class="o">[</span><span class="n">Violation</span><span class="o">]</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="n">took</span><span class="w"> </span><span class="mi">231</span><span class="n">ms</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="p">(</span><span class="mi">50</span><span class="n">ms</span><span class="w"> </span><span class="n">allowed</span><span class="p">)</span>
</pre></div>

<p>jquery.min.js:2
</p>
</blockquote>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>Update</strong> : Chrome 58+ hid these and other debug messages by default. To
display them click the arrow next to 'Info' and select 'Verbose'.</p>
<p>Chrome 57 turned on 'hide violations' by default. To turn them back on you
need to enable filters and uncheck the 'hide violations' box.</p>
<blockquote>
<p>suddenly it appears when someone else involved in the project</p>
</blockquote>
<p>I think it's more likely you updated to Chrome 56. This warning is a wonderful
new feature, in my opinion, please only turn it off if you're desperate and
your assessor will take marks away from you. The underlying problems are there
in the other browsers but the browsers just aren't telling you there's a
problem. The Chromium ticket is here but there isn't really any interesting
discussion on it.</p>
<p>These messages are warnings instead of errors because it's not really going to
cause major problems. It may cause frames to get dropped or otherwise cause a
less smooth experience.</p>
<p>They're worth investigating and fixing to improve the quality of your
application however. The way to do this is by paying attention to what
circumstances the messages appear, and doing performance testing to narrow
down where the issue is occurring. The simplest way to start performance
testing is to insert some code like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">someMethodIThinkMightBeSlow</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">performance</span><span class="o">.</span><span class="n">now</span><span class="p">();</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="n">stuff</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">function</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">performance</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">startTime</span><span class="p">;</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">someMethodIThinkMightBeSlow</span><span class="w"> </span><span class="n">took</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">duration</span><span class="p">}</span><span class="n">ms</span><span class="err">`</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>If you want to get more advanced, you could also use Chrome's profiler, or
make use of a benchmarking library like this one.</p>
<p>Once you've found some code that's taking a long time (50ms is Chrome's
threshold), you have a couple of options:</p>
<ol>
<li>Cut out some/all of that task that may be unnecessary</li>
<li>Figure out how to do the same task faster</li>
<li>Divide the code into multiple asynchronous steps</li>
</ol>
<p>(1) and (2) may be difficult or impossible, but it's sometimes really easy and
should be your first attempts. If needed, it should always be possible to do
(3). To do this you will use something like:</p>
<div class="code"><pre class="code literal-block">setTimeout(functionToRunVerySoonButNotNow);
</pre></div>

<p>or</p>
<div class="code"><pre class="code literal-block"><span class="c1">// This one is not available natively in IE, but there are polyfills available.</span>
<span class="n">Promise</span><span class="p">.</span><span class="n">resolve</span><span class="p">().</span><span class="nb">then</span><span class="p">(</span><span class="n">functionToRunVerySoonButNotNow</span><span class="p">);</span>
</pre></div>

<p>You can read more about the asynchronous nature of JavaScript here.</p>
<p><br></p>
<h3>Suggest</h3>
<p>These are just warnings as everyone mentioned. However, if you're keen on
resolving these (which you should), then you need to identify what is causing
the warning first. There's no one reason due to which you can get force reflow
warning. Someone has created a list for some possible options. You can follow
the discussion for more information.<br>
Here's the gist of the possible reasons:</p>
<blockquote>
<h2>What forces layout / reflow</h2>
<p>All of the below properties or methods, when requested/called in JavaScript,
will trigger the browser to synchronously calculate the style and layout*.
This is also called reflow or layout thrashing, and is common performance
bottleneck.</p>
<h4>Element</h4>
<p>Box metrics</p>
<ul>
<li>
<code>elem.offsetLeft</code>, <code>elem.offsetTop</code>, <code>elem.offsetWidth</code>,
<code>elem.offsetHeight</code>, <code>elem.offsetParent</code>
</li>
<li>
<code>elem.clientLeft</code>, <code>elem.clientTop</code>, <code>elem.clientWidth</code>,
<code>elem.clientHeight</code>
</li>
<li>
<code>elem.getClientRects()</code>, <code>elem.getBoundingClientRect()</code>
</li>
</ul>
<p>Scroll stuff</p>
<ul>
<li>
<code>elem.scrollBy()</code>, <code>elem.scrollTo()</code>
</li>
<li>
<code>elem.scrollIntoView()</code>, <code>elem.scrollIntoViewIfNeeded()</code>
</li>
<li>
<code>elem.scrollWidth</code>, <code>elem.scrollHeight</code>
</li>
<li>
<code>elem.scrollLeft</code>, <code>elem.scrollTop</code> also, setting them</li>
</ul>
<p>Focus</p>
<ul>
<li>
<code>elem.focus()</code> can trigger a <em>double</em> forced layout (source)</li>
</ul>
<p>Also…</p>
<ul>
<li>
<code>elem.computedRole</code>, <code>elem.computedName</code>
</li>
<li>
<code>elem.innerText</code> (source)
</li>
</ul>
<h4>getComputedStyle</h4>
<p><code>window.getComputedStyle()</code> will typically force style recalc (source)</p>
<p><code>window.getComputedStyle()</code> will force layout, as well, if any of the
following is true:</p>
<ol>
<li>The element is in a shadow tree</li>
<li>There are media queries (viewport-related ones). Specifically, one of
the following: (source) * <code>min-width</code>, <code>min-height</code>, <code>max-width</code>, <code>max-
height</code>, <code>width</code>, <code>height</code> * <code>aspect-ratio</code>, <code>min-aspect-ratio</code>, <code>max-
aspect-ratio</code><ul>
<li>
<code>device-pixel-ratio</code>, <code>resolution</code>, <code>orientation</code>
</li>
</ul>
</li>
<li>The property requested is one of the following: (source)<ul>
<li>
<code>height</code>, <code>width</code> * <code>top</code>, <code>right</code>, <code>bottom</code>, <code>left</code> * <code>margin</code>
[<code>-top</code>, <code>-right</code>, <code>-bottom</code>, <code>-left</code>, or <em>shorthand</em> ] only if the margin
is fixed. * <code>padding</code> [<code>-top</code>, <code>-right</code>, <code>-bottom</code>, <code>-left</code>, or <em>shorthand</em>
] only if the padding is fixed. * <code>transform</code>, <code>transform-origin</code>,
<code>perspective-origin</code> * <code>translate</code>, <code>rotate</code>, <code>scale</code> * <code>webkit-filter</code>,
<code>backdrop-filter</code> * <code>motion-path</code>, <code>motion-offset</code>, <code>motion-rotation</code> * <code>x</code>,
<code>y</code>, <code>rx</code>, <code>ry</code>
</li>
</ul>
</li>
</ol>
<h4>window</h4>
<ul>
<li>
<code>window.scrollX</code>, <code>window.scrollY</code>
</li>
<li>
<code>window.innerHeight</code>, <code>window.innerWidth</code>
</li>
<li>
<code>window.getMatchedCSSRules()</code> only forces style
</li>
</ul>
<h4>Forms</h4>
<ul>
<li><code>inputElem.focus()</code></li>
<li>
<code>inputElem.select()</code>, <code>textareaElem.select()</code> (source)
</li>
</ul>
<h4>Mouse events</h4>
<ul>
<li>
<code>mouseEvt.layerX</code>, <code>mouseEvt.layerY</code>, <code>mouseEvt.offsetX</code>,
<code>mouseEvt.offsetY</code> (source)
</li>
</ul>
<h4>document</h4>
<ul>
<li>
<code>doc.scrollingElement</code> only forces style
</li>
</ul>
<h4>Range</h4>
<ul>
<li>
<code>range.getClientRects()</code>, <code>range.getBoundingClientRect()</code>
</li>
</ul>
<h4>SVG</h4>
<ul>
<li>Quite a lot; haven't made an exhaustive list , but Tony Gentilcore's
2011 Layout Triggering List pointed to a few.
</li>
</ul>
<h4>contenteditable</h4>
<ul>
<li>Lots &amp; lots of stuff, …including copying an image to clipboard (source)
</li>
</ul>
</blockquote>
<p>Check more here.</p>
<p>Also, here's Chromium source code from the original issue and a discussion
about a performance API for the warnings.</p>
<hr>
<p><strong>Edit:</strong> There's also an article on how to minimize layout reflow on
PageSpeed Insight by Google. It explains what browser reflow is:</p>
<blockquote>
<p>Reflow is the name of the web browser process for re-calculating the
positions and geometries of elements in the document, for the purpose of re-
rendering part or all of the document. Because reflow is a user-blocking
operation in the browser, it is useful for developers to understand how to
improve reflow time and also to understand the effects of various document
properties (DOM depth, CSS rule efficiency, different types of style
changes) on reflow time. Sometimes reflowing a single element in the
document may require reflowing its parent elements and also any elements
which follow it.</p>
</blockquote>
<p>In addition, it explains how to minimize it:</p>
<blockquote>
<ol>
<li>Reduce unnecessary DOM depth. Changes at one level in the DOM tree can
cause changes at every level of the tree - all the way up to the root, and
all the way down into the children of the modified node. This leads to more
time being spent performing reflow.</li>
<li>Minimize CSS rules, and remove unused CSS rules.</li>
<li>If you make complex rendering changes such as animations, do so out of
the flow. Use position-absolute or position-fixed to accomplish this.</li>
<li>Avoid unnecessary complex CSS selectors - descendant selectors in
particular - which require more CPU power to do selector matching.
</li>
</ol>
</blockquote>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/dom/" rel="tag">dom</a></li>
            <li><a class="tag p-category" href="../../categories/google-chrome/" rel="tag">google-chrome</a></li>
            <li><a class="tag p-category" href="../../categories/javascript/" rel="tag">javascript</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../jquery-ajax-cross-domain/" rel="prev" title="jQuery AJAX cross domain">Previous post</a>
            </li>
            <li class="next">
                <a href="../what-is-suppresswarnings-unchecked-in-java/" rel="next" title='What is SuppressWarnings ("unchecked") in Java?'>Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
