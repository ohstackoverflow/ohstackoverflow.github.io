<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How to add a changed file to an older (not last) commit in Git | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-to-add-a-changed-file-to-an-older-not-last-commit-in-git/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-to-check-django-version/" title="How to check Django version" type="text/html">
<link rel="next" href="../how-do-i-bind-to-list-of-checkbox-values-with-angularjs/" title="How do I bind to list of checkbox values with AngularJS?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="How to add a changed file to an older (not last) commit in Git">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-to-add-a-changed-file-to-an-older-not-last-commit-in-git/">
<meta property="og:description" content="I have changed several things over the last hour and committed them step by
step, but I just realized I've forgot to add a changed file some commits ago.
The Log looks like this:
GIT TidyUpRequests u:">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T17:54:58+08:00">
<meta property="article:tag" content="git">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How to add a changed file to an older (not last) commit in Git</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T17:54:58+08:00" itemprop="datePublished" title="2023-02-17 17:54">2023-02-17 17:54</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I have changed several things over the last hour and committed them step by
step, but I just realized I've forgot to add a changed file some commits ago.</p>
<p>The Log looks like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">GIT</span><span class="w"> </span><span class="n">TidyUpRequests</span><span class="w"> </span><span class="nl">u</span><span class="p">:</span><span class="mi">1</span><span class="w"> </span><span class="nl">d</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="nf">log</span><span class="w"> </span>
<span class="k">commit</span><span class="w"> </span><span class="n">fc6734b6351f6c36a587dba6dbd9d5efa30c09ce</span><span class="w"> </span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">David</span><span class="w"> </span><span class="n">Klein</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span>
<span class="nc">Date</span><span class="err">:</span><span class="w">   </span><span class="n">Tue</span><span class="w"> </span><span class="n">Apr</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">43</span><span class="err">:</span><span class="mi">55</span><span class="w"> </span><span class="mi">2010</span><span class="w"> </span><span class="o">+</span><span class="mi">0200</span>

<span class="w">    </span><span class="n">The</span><span class="w"> </span><span class="n">Main</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">Webservices</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">once</span>

<span class="k">commit</span><span class="w"> </span><span class="mi">8</span><span class="n">a2c6014c2b035e37aebd310a6393a1ecb39f463</span><span class="w"> </span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">David</span><span class="w"> </span><span class="n">Klein</span><span class="w"> </span><span class="o">&lt;&gt;</span>
<span class="nc">Date</span><span class="err">:</span><span class="w">   </span><span class="n">Tue</span><span class="w"> </span><span class="n">Apr</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">43</span><span class="err">:</span><span class="mi">27</span><span class="w"> </span><span class="mi">2010</span><span class="w"> </span><span class="o">+</span><span class="mi">0200</span>

<span class="w">    </span><span class="n">ISBNDBQueryHandler</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">XPath</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">XPath</span><span class="p">.</span><span class="n">fs</span><span class="w"> </span><span class="n">too</span>

<span class="k">commit</span><span class="w"> </span><span class="mi">06</span><span class="n">a504e277fd98d97eed4dad22dfa5933d81451f</span><span class="w"> </span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">David</span><span class="w"> </span><span class="n">Klein</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span>
<span class="nc">Date</span><span class="err">:</span><span class="w">   </span><span class="n">Tue</span><span class="w"> </span><span class="n">Apr</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">30</span><span class="err">:</span><span class="mi">34</span><span class="w"> </span><span class="mi">2010</span><span class="w"> </span><span class="o">+</span><span class="mi">0200</span>

<span class="w">    </span><span class="n">AmazonQueryHandler</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">XPath</span><span class="w"> </span><span class="n">Helper</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">XPath</span><span class="p">.</span><span class="n">fs</span>

<span class="k">commit</span><span class="w"> </span><span class="n">a0865e28be35a3011d0b6091819ec32922dd2dd8</span><span class="w"> </span><span class="o">&lt;---</span><span class="w"> </span><span class="n">changed</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="n">here</span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">David</span><span class="w"> </span><span class="n">Klein</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span>
<span class="nc">Date</span><span class="err">:</span><span class="w">   </span><span class="n">Tue</span><span class="w"> </span><span class="n">Apr</span><span class="w"> </span><span class="mi">27</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">29</span><span class="err">:</span><span class="mi">53</span><span class="w"> </span><span class="mi">2010</span><span class="w"> </span><span class="o">+</span><span class="mi">0200</span>

<span class="w">    </span><span class="n">Factored</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="ow">some</span><span class="w"> </span><span class="n">common</span><span class="w"> </span><span class="n">XPath</span><span class="w"> </span><span class="n">Operations</span>
</pre></div>

<p>Any ideas?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Use <code>git rebase</code>. Specifically:</p>
<ol>
<li>Use <code>git stash</code> to store the changes you want to add.</li>
<li>Use <code>git rebase -i HEAD~10</code> (or however many commits back you want to see).</li>
<li>Mark the commit in question (<code>a0865...</code>) for edit by changing the word <code>pick</code> at the start of the line into <code>edit</code>. Don't delete the other lines as that would delete the commits.<sup id="fnref:vimnote"><a class="footnote-ref" href="#fn:vimnote">1</a></sup>
</li>
<li>Save the rebase file, and git will drop back to the shell and wait for you to fix that commit.</li>
<li>Pop the stash by using <code>git stash pop</code>
</li>
<li>Add your file with <code>git add &lt;file&gt;</code>.</li>
<li>Amend the commit with <code>git commit --amend --no-edit</code>.</li>
<li>Do a <code>git rebase --continue</code> which will rewrite the rest of your commits against the new one.</li>
<li>Repeat from step 2 onwards if you have marked more than one commit for edit.</li>
</ol>
<p><br></p>
<h3>Suggest</h3>
<p>To "fix" an old commit with a small change, without changing the commit
message of the old commit, where <code>OLDCOMMIT</code> is something like <code>091b73a</code>:</p>
<div class="code"><pre class="code literal-block">git add &lt;my fixed files&gt;
git commit --fixup=OLDCOMMIT
git rebase --interactive --autosquash OLDCOMMIT^
</pre></div>

<p>You can also use <code>git commit --squash=OLDCOMMIT</code> to edit the old commit
message during rebase.</p>
<p>See documentation for git commit and git rebase. As always, when rewriting git
history, you should only fixup or squash commits you have not yet published to
anyone else (including random internet users and build servers).</p>
<hr>
<p><strong>Detailed explanation</strong></p>
<ul>
<li>
<code>git commit --fixup=OLDCOMMIT</code> copies the <code>OLDCOMMIT</code> commit message and automatically prefixes <code>fixup!</code> so it can be put in the correct order during interactive rebase. (<code>--squash=OLDCOMMIT</code> does the same but prefixes <code>squash!</code>.)</li>
<li>
<code>git rebase --interactive</code> will bring up a text editor (which can be configured) to confirm (or edit) the <em>rebase instruction sequence</em>. There is info for rebase instruction changes in the file; just <strong>save and quit</strong> the editor (<code>:wq</code> in <code>vim</code>) to continue with the rebase.</li>
<li>
<code>--autosquash</code> will automatically put any <code>--fixup=OLDCOMMIT</code> commits in the correct order. Note that <code>--autosquash</code> is only valid when the <code>--interactive</code> option is used.</li>
<li>The <code>^</code> in <code>OLDCOMMIT^</code> means it's a reference to the commit just before <code>OLDCOMMIT</code>. (<code>OLDCOMMIT^</code> is the first parent of <code>OLDCOMMIT</code>.)</li>
</ul>
<hr>
<p><strong>Optional automation</strong></p>
<p>The above steps are good for verification and/or modifying the <em>rebase
instruction sequence</em> , but it's also possible to skip/automate the
interactive rebase text editor by:</p>
<ul>
<li>Setting <code>GIT_SEQUENCE_EDITOR</code> to a script.</li>
<li>Creating a git alias to automatically autosquash all queued fixups.</li>
<li>Creating a git alias to automatically fixup a single commit.</li>
</ul>
<div class="footnote">
<hr>
<ol>
<li id="fn:vimnote">
<p>If you are using <code>vim</code> then you will have to hit the <code>Insert</code> key
to edit, then <code>Esc</code> and type in <code>:wq</code> to save the file, quit the editor, and
apply the changes. Alternatively, you can configure a user-friendly git commit
editor with <code>git config --global core.editor "nano"</code>. <a class="footnote-backref" href="#fnref:vimnote" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/git/" rel="tag">git</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-to-check-django-version/" rel="prev" title="How to check Django version">Previous post</a>
            </li>
            <li class="next">
                <a href="../how-do-i-bind-to-list-of-checkbox-values-with-angularjs/" rel="next" title="How do I bind to list of checkbox values with AngularJS?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
