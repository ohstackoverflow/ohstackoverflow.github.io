<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>error: 'Can't connect to local MySQL server through socket '/var/run/mysqld/mysqld.sock' (2)' -- Missing /var/run/mysqld/mysqld.sock | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/error-can-t-connect-to-local-mysql-server-through-socket-var-run-mysqld-mysqld-sock-2-missing-var-run-mysqld-mysqld-sock/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../create-windows-service-from-executable/" title="Create Windows service from executable" type="text/html">
<link rel="next" href="../change-values-in-array-when-doing-foreach/" title="change values in array when doing foreach" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="error: 'Can't connect to local MySQL server through socket '/var/run/m">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/error-can-t-connect-to-local-mysql-server-through-socket-var-run-mysqld-mysqld-sock-2-missing-var-run-mysqld-mysqld-sock/">
<meta property="og:description" content="My problem started off with me not being able to log in as root any more on my
mysql install. I was attempting to run mysql without passwords turned on...
but whenever I ran the command
# mysqld_safe ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T11:53:31+08:00">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="mysql">
<meta property="article:tag" content="ubuntu">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">error: 'Can't connect to local MySQL server through socket '/var/run/mysqld/mysqld.sock' (2)' -- Missing /var/run/mysqld/mysqld.sock</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T11:53:31+08:00" itemprop="datePublished" title="2023-03-03 11:53">2023-03-03 11:53</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>My problem started off with me not being able to log in as root any more on my
mysql install. I was attempting to run mysql without passwords turned on...
but whenever I ran the command</p>
<div class="code"><pre class="code literal-block"># mysqld_safe --skip-grant-tables &amp;
</pre></div>

<p>I would never get the prompt back. I was trying to follow these instructions
to recover the password.</p>
<p>The screen just looks like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">root</span><span class="err">@</span><span class="n">jj</span><span class="o">-</span><span class="n">SFF</span><span class="o">-</span><span class="n">PC</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="c1"># mysqld_safe --skip-grant-tables</span>
<span class="mi">120816</span><span class="w"> </span><span class="mi">11</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">53</span><span class="w"> </span><span class="n">mysqld_safe</span><span class="w"> </span><span class="n">Logging</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">syslog</span><span class="o">.</span>
<span class="mi">120816</span><span class="w"> </span><span class="mi">11</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">53</span><span class="w"> </span><span class="n">mysqld_safe</span><span class="w"> </span><span class="n">Starting</span><span class="w"> </span><span class="n">mysqld</span><span class="w"> </span><span class="n">daemon</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">databases</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span>
</pre></div>

<p>and I don't get a prompt to start typing the SQL commands to reset the
password.</p>
<p>When I kill it by pressing <code>CTRL</code> + <code>C</code>, I get the following message:</p>
<div class="code"><pre class="code literal-block"><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="s1">'Can'</span><span class="n">t</span><span class="w"> </span><span class="n">connect</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="n">socket</span><span class="w"> </span><span class="s1">'/var/run/mysqld/mysqld.sock'</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="s1">'</span>

<span class="n">Check</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">mysqld</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">running</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">socket</span><span class="p">:</span><span class="w"> </span><span class="s1">'/var/run/mysqld/mysqld.sock'</span><span class="w"> </span><span class="n">exists</span><span class="o">!</span>
</pre></div>

<p>If I retry the command and leave it long enough, I do get the following series
of messages:</p>
<div class="code"><pre class="code literal-block"><span class="n">root</span><span class="err">@</span><span class="n">jj</span><span class="o">-</span><span class="n">SFF</span><span class="o">-</span><span class="n">PC</span><span class="p">:</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">mysqld</span><span class="c1"># 120816 13:15:02 mysqld_safe Logging to syslog.</span>
<span class="mi">120816</span><span class="w"> </span><span class="mi">13</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">02</span><span class="w"> </span><span class="n">mysqld_safe</span><span class="w"> </span><span class="n">Starting</span><span class="w"> </span><span class="n">mysqld</span><span class="w"> </span><span class="n">daemon</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">databases</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span>
<span class="mi">120816</span><span class="w"> </span><span class="mi">13</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">42</span><span class="w"> </span><span class="n">mysqld_safe</span><span class="w"> </span><span class="n">mysqld</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">pid</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">mysqld</span><span class="o">/</span><span class="n">mysqld</span><span class="o">.</span><span class="n">pid</span><span class="w"> </span><span class="n">ended</span>

<span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="w">  </span><span class="n">Done</span><span class="w">                    </span><span class="n">mysqld_safe</span><span class="w"> </span><span class="o">--</span><span class="n">skip</span><span class="o">-</span><span class="n">grant</span><span class="o">-</span><span class="n">tables</span>
<span class="n">root</span><span class="err">@</span><span class="n">jj</span><span class="o">-</span><span class="n">SFF</span><span class="o">-</span><span class="n">PC</span><span class="p">:</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">mysqld</span><span class="c1">#</span>
</pre></div>

<p>But then if I try to log in as root by doing:</p>
<div class="code"><pre class="code literal-block"># mysql -u root
</pre></div>

<p>I get the following error message:</p>
<div class="code"><pre class="code literal-block"><span class="n">ERROR</span><span class="w"> </span><span class="mi">2002</span><span class="w"> </span><span class="p">(</span><span class="n">HY000</span><span class="p">):</span><span class="w"> </span><span class="n">Can</span><span class="s1">'t connect to local MySQL server through socket '</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">mysqld</span><span class="o">/</span><span class="n">mysqld</span><span class="o">.</span><span class="n">sock</span><span class="s1">' (2)</span>
</pre></div>

<p>I checked and <code>/var/run/mysqld/mysqld.sock</code> file doesn't not exist. The folder
does, but not the file.</p>
<p>Also, I don't know if this helps or not, but I ran <code>find / -name mysqld</code> and
it came up with:</p>
<div class="code"><pre class="code literal-block"><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">mysqld</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">folder</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">mysqld</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">file</span>
<span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">mysqld</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">folder</span>
</pre></div>

<p>I don't know if this is normal or not. But I'm including this info just in
case it helps.</p>
<p><strong>I finally decided to uninstall and reinstall mysql.</strong></p>
<div class="code"><pre class="code literal-block">apt-get remove mysql-server
apt-get remove mysql-client
apt-get remove mysql-common
apt-get remove phpmyadmin
</pre></div>

<p>After reinstalling all packages again in the same order as above, during the
phpmyadmin install, I got the same error:</p>
<div class="code"><pre class="code literal-block"><span class="n">ERROR</span><span class="w"> </span><span class="mi">2002</span><span class="w"> </span><span class="p">(</span><span class="n">HY000</span><span class="p">):</span><span class="w"> </span><span class="n">Can</span><span class="s1">'t connect to local MySQL server through socket '</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">mysqld</span><span class="o">/</span><span class="n">mysqld</span><span class="o">.</span><span class="n">sock</span><span class="s1">' (2)</span>
</pre></div>

<p>So I tried again to uninstall/reinstall. This time, after I uninstalled the
packages, I also manually renamed all mysql files and directories to
<code>mysql.bad</code> in their respective locations.</p>
<div class="code"><pre class="code literal-block"><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span><span class="w"> </span>
<span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">mysql</span>
<span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">mysql</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">perl5</span><span class="o">/</span><span class="n">DBD</span><span class="o">/</span><span class="n">mysql</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">perl5</span><span class="o">/</span><span class="n">auto</span><span class="o">/</span><span class="n">DBD</span><span class="o">/</span><span class="n">mysql</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">mysql</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">mysql</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">dbconfig</span><span class="o">-</span><span class="n">common</span><span class="o">/</span><span class="n">internal</span><span class="o">/</span><span class="n">mysql</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">mysql</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apparmor</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">abstractions</span><span class="o">/</span><span class="n">mysql</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">mysql</span>
</pre></div>

<p>Then I tried to reinstall <code>mysql-server</code> and <code>mysql-client</code> again. But I've
noticed that it doesn't prompt me for a password. Isn't it supposed to ask for
an admin password?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>To find all socket files on your system run:</p>
<div class="code"><pre class="code literal-block">sudo find / -type s
</pre></div>

<p>My Mysql server system had the socket open at <code>/var/lib/mysql/mysql.sock</code></p>
<p>Once you find where the socket is being opened, add or edit the line to your
/etc/my.cnf file with the path to the socket file:</p>
<div class="code"><pre class="code literal-block"><span class="n">socket</span><span class="o">=/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">mysql</span><span class="o">.</span><span class="n">sock</span>
</pre></div>

<p>Sometimes the system startup script that launched the command line executable
specifies a flag <code>--socket=path</code>. This flag could override the my.cnf
location, and that would result in a socket not being found where the my.cnf
file indicates it should be. Then when you try to run the mysql command line
client, it will read my.cnf to find the socket, but it will not find it since
it deviates from where the server created one. So, Unless you care where the
socket resides, just changing the my.cnf to match should work.</p>
<p>Then, stop the mysqld process. How you do this will vary by system.</p>
<p>If you're super user in the linux system, try one of the following if you
don't know the specific method your Mysql setup uses:</p>
<ul>
<li><code>service mysqld stop</code></li>
<li><code>/etc/init.d/mysqld stop</code></li>
<li><code>mysqladmin -u root -p shutdown</code></li>
<li>Some systems aren't setup to have an elegant way to stop mysql (or for some reason mysql doesn't respond) and you can force terminate mysql with either: <ul>
<li>One step: <code>pkill -9 mysqld</code>
</li>
<li>Two step (least preferred): </li>
<li>Find the process id of mysql with either <code>pgrep mysql</code> or <code>ps aux | grep mysql | grep -v grep</code>
</li>
<li>Assuming the process id is <code>4969</code> terminate with <code>kill -9 4969</code>
</li>
</ul>
</li>
</ul>
<p>After you do this you might want to look for a pid file in <code>/var/run/mysqld/</code>
and delete it</p>
<p>Make sure the permissions on your socket is such that whatever user mysqld is
running as can read/write to it. An easy test is to open it up to full
read/write and see if it still works:</p>
<div class="code"><pre class="code literal-block"><span class="n">chmod</span><span class="w"> </span><span class="mi">777</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">mysqld</span><span class="o">/</span><span class="n">mysqld</span><span class="o">.</span><span class="n">sock</span>
</pre></div>

<p>If that fixes the issue, you can tailor the permissions and ownership of the
socket as needed based on your security settings.</p>
<p>Also, the directory the socket resides in has to be reachable by the user
running the mysqld process.</p>
<p><br></p>
<h3>Suggest</h3>
<p>To find all socket files on your system run:</p>
<div class="code"><pre class="code literal-block">sudo find / -type s
</pre></div>

<p>My Mysql server system had the socket open at <code>/var/lib/mysql/mysql.sock</code></p>
<p>Once you find where the socket is being opened, add or edit the line to your
/etc/my.cnf file with the path to the socket file:</p>
<div class="code"><pre class="code literal-block"><span class="n">socket</span><span class="o">=/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">mysql</span><span class="o">.</span><span class="n">sock</span>
</pre></div>

<p>Sometimes the system startup script that launched the command line executable
specifies a flag <code>--socket=path</code>. This flag could override the my.cnf
location, and that would result in a socket not being found where the my.cnf
file indicates it should be. Then when you try to run the mysql command line
client, it will read my.cnf to find the socket, but it will not find it since
it deviates from where the server created one. So, Unless you care where the
socket resides, just changing the my.cnf to match should work.</p>
<p>Then, stop the mysqld process. How you do this will vary by system.</p>
<p>If you're super user in the linux system, try one of the following if you
don't know the specific method your Mysql setup uses:</p>
<ul>
<li><code>service mysqld stop</code></li>
<li><code>/etc/init.d/mysqld stop</code></li>
<li><code>mysqladmin -u root -p shutdown</code></li>
<li>Some systems aren't setup to have an elegant way to stop mysql (or for some reason mysql doesn't respond) and you can force terminate mysql with either: <ul>
<li>One step: <code>pkill -9 mysqld</code>
</li>
<li>Two step (least preferred): </li>
<li>Find the process id of mysql with either <code>pgrep mysql</code> or <code>ps aux | grep mysql | grep -v grep</code>
</li>
<li>Assuming the process id is <code>4969</code> terminate with <code>kill -9 4969</code>
</li>
</ul>
</li>
</ul>
<p>After you do this you might want to look for a pid file in <code>/var/run/mysqld/</code>
and delete it</p>
<p>Make sure the permissions on your socket is such that whatever user mysqld is
running as can read/write to it. An easy test is to open it up to full
read/write and see if it still works:</p>
<div class="code"><pre class="code literal-block"><span class="n">chmod</span><span class="w"> </span><span class="mi">777</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">mysqld</span><span class="o">/</span><span class="n">mysqld</span><span class="o">.</span><span class="n">sock</span>
</pre></div>

<p>If that fixes the issue, you can tailor the permissions and ownership of the
socket as needed based on your security settings.</p>
<p>Also, the directory the socket resides in has to be reachable by the user
running the mysqld process.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/linux/" rel="tag">linux</a></li>
            <li><a class="tag p-category" href="../../categories/mysql/" rel="tag">mysql</a></li>
            <li><a class="tag p-category" href="../../categories/ubuntu/" rel="tag">ubuntu</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../create-windows-service-from-executable/" rel="prev" title="Create Windows service from executable">Previous post</a>
            </li>
            <li class="next">
                <a href="../change-values-in-array-when-doing-foreach/" rel="next" title="change values in array when doing foreach">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
