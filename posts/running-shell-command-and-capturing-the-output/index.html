<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Running shell command and capturing the output | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/running-shell-command-and-capturing-the-output/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-do-i-find-the-location-of-my-python-site-packages-directory/" title="How do I find the location of my Python site-packages directory?" type="text/html">
<link rel="next" href="../how-can-i-merge-two-commits-into-one-if-i-already-started-rebase/" title="How can I merge two commits into one if I already started rebase?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Running shell command and capturing the output">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/running-shell-command-and-capturing-the-output/">
<meta property="og:description" content="I want to write a function that will execute a shell command and return its
output as a string , no matter, is it an error or success message. I just
want to get the same result that I would have gott">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T03:17:53+08:00">
<meta property="article:tag" content="python">
<meta property="article:tag" content="shell">
<meta property="article:tag" content="subprocess">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Running shell command and capturing the output</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T03:17:53+08:00" itemprop="datePublished" title="2023-02-17 03:17">2023-02-17 03:17</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I want to write a function that will execute a shell command and return its
output <strong>as a string</strong> , no matter, is it an error or success message. I just
want to get the same result that I would have gotten with the command line.</p>
<p>What would be a code example that would do such a thing?</p>
<p>For example:</p>
<div class="code"><pre class="code literal-block"><span class="nt">def</span><span class="w"> </span><span class="nt">run_command</span><span class="o">(</span><span class="nt">cmd</span><span class="o">):</span>
<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="o">??????</span>

<span class="nt">print</span><span class="w"> </span><span class="nt">run_command</span><span class="o">(</span><span class="s1">'mysqladmin create test -uroot -pmysqladmin12'</span><span class="o">)</span>
<span class="err">#</span><span class="w"> </span><span class="nt">Should</span><span class="w"> </span><span class="nt">output</span><span class="w"> </span><span class="nt">something</span><span class="w"> </span><span class="nt">like</span><span class="o">:</span>
<span class="err">#</span><span class="w"> </span><span class="nt">mysqladmin</span><span class="o">:</span><span class="w"> </span><span class="nt">CREATE</span><span class="w"> </span><span class="nt">DATABASE</span><span class="w"> </span><span class="nt">failed</span><span class="o">;</span><span class="w"> </span><span class="nt">error</span><span class="o">:</span><span class="w"> </span><span class="s1">'Can'</span><span class="nt">t</span><span class="w"> </span><span class="nt">create</span><span class="w"> </span><span class="nt">database</span><span class="w"> </span><span class="s1">'test'</span><span class="o">;</span><span class="w"> </span><span class="nt">database</span><span class="w"> </span><span class="nt">exists</span><span class="err">'</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>In all officially maintained versions of Python, the simplest approach is to
use the <code>subprocess.check_output</code> function:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; subprocess.check_output(['ls', '-l'])
b'total 0\n-rw-r--r--  1 memyself  staff  0 Mar 14 11:04 files\n'
</pre></div>

<p><code>check_output</code> runs a single program that takes only arguments as input.1 It
returns the result exactly as printed to <code>stdout</code>. If you need to write input
to <code>stdin</code>, skip ahead to the <code>run</code> or <code>Popen</code> sections. If you want to
execute complex shell commands, see the note on <code>shell=True</code> at the end of
this answer.</p>
<p>The <code>check_output</code> function works in all officially maintained versions of
Python. But for more recent versions, a more flexible approach is available.</p>
<h4>Modern versions of Python (3.5 or higher): <code>run</code>
</h4>
<p>If you're using <strong>Python 3.5+</strong> , and <strong>do not need backwards compatibility</strong>
, the new <code>run</code> function is recommended by the official documentation for most
tasks. It provides a very general, high-level API for the <code>subprocess</code> module.
To capture the output of a program, pass the <code>subprocess.PIPE</code> flag to the
<code>stdout</code> keyword argument. Then access the <code>stdout</code> attribute of the returned
<code>CompletedProcess</code> object:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">subprocess</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">'ls'</span><span class="p">,</span> <span class="s1">'-l'</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span>
<span class="sa">b</span><span class="s1">'total 0</span><span class="se">\n</span><span class="s1">-rw-r--r--  1 memyself  staff  0 Mar 14 11:04 files</span><span class="se">\n</span><span class="s1">'</span>
</pre></div>

<p>The return value is a <code>bytes</code> object, so if you want a proper string, you'll
need to <code>decode</code> it. Assuming the called process returns a UTF-8-encoded
string:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; result.stdout.decode('utf-8')
'total 0\n-rw-r--r--  1 memyself  staff  0 Mar 14 11:04 files\n'
</pre></div>

<p>This can all be compressed to a one-liner if desired:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; subprocess.run(['ls', '-l'], stdout=subprocess.PIPE).stdout.decode('utf-8')
'total 0\n-rw-r--r--  1 memyself  staff  0 Mar 14 11:04 files\n'
</pre></div>

<p>If you want to pass input to the process's <code>stdin</code>, you can pass a <code>bytes</code>
object to the <code>input</code> keyword argument:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; cmd = ['awk', 'length($0) &gt; 5']
&gt;&gt;&gt; ip = 'foo\nfoofoo\n'.encode('utf-8')
&gt;&gt;&gt; result = subprocess.run(cmd, stdout=subprocess.PIPE, input=ip)
&gt;&gt;&gt; result.stdout.decode('utf-8')
'foofoo\n'
</pre></div>

<p>You can capture errors by passing <code>stderr=subprocess.PIPE</code> (capture to
<code>result.stderr</code>) or <code>stderr=subprocess.STDOUT</code> (capture to <code>result.stdout</code>
along with regular output). If you want <code>run</code> to throw an exception when the
process returns a nonzero exit code, you can pass <code>check=True</code>. (Or you can
check the <code>returncode</code> attribute of <code>result</code> above.) When security is not a
concern, you can also run more complex shell commands by passing <code>shell=True</code>
as described at the end of this answer.</p>
<p>Later versions of Python streamline the above further. In Python 3.7+, the
above one-liner can be spelled like this:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; subprocess.run(['ls', '-l'], capture_output=True, text=True).stdout
'total 0\n-rw-r--r--  1 memyself  staff  0 Mar 14 11:04 files\n'
</pre></div>

<p>Using <code>run</code> this way adds just a bit of complexity, compared to the old way of
doing things. But now you can do almost anything you need to do with the <code>run</code>
function alone.</p>
<h4>Older versions of Python (3-3.4): more about <code>check_output</code>
</h4>
<p>If you are using an older version of Python, or need modest backwards
compatibility, you can use the <code>check_output</code> function as briefly described
above. It has been available since Python 2.7.</p>
<div class="code"><pre class="code literal-block">subprocess.check_output(*popenargs, **kwargs)
</pre></div>

<p>It takes takes the same arguments as <code>Popen</code> (see below), and returns a string
containing the program's output. The beginning of this answer has a more
detailed usage example. In Python 3.5+, <code>check_output</code> is equivalent to
executing <code>run</code> with <code>check=True</code> and <code>stdout=PIPE</code>, and returning just the
<code>stdout</code> attribute.</p>
<p>You can pass <code>stderr=subprocess.STDOUT</code> to ensure that error messages are
included in the returned output. When security is not a concern, you can also
run more complex shell commands by passing <code>shell=True</code> as described at the
end of this answer.</p>
<p>If you need to pipe from <code>stderr</code> or pass input to the process, <code>check_output</code>
won't be up to the task. See the <code>Popen</code> examples below in that case.</p>
<h4>Complex applications and legacy versions of Python (2.6 and below):</h4>
<p><code>Popen</code></p>
<p>If you need deep backwards compatibility, or if you need more sophisticated
functionality than <code>check_output</code> or <code>run</code> provide, you'll have to work
directly with <code>Popen</code> objects, which encapsulate the low-level API for
subprocesses.</p>
<p>The <code>Popen</code> constructor accepts either <strong>a single command</strong> without arguments,
or <strong>a list</strong> containing a command as its first item, followed by any number
of arguments, each as a separate item in the list. <code>shlex.split</code> can help
parse strings into appropriately formatted lists. <code>Popen</code> objects also accept
a host of different arguments for process IO management and low-level
configuration.</p>
<p>To send input and capture output, <code>communicate</code> is almost always the preferred
method. As in:</p>
<div class="code"><pre class="code literal-block">output = subprocess.Popen(["mycmd", "myarg"], 
                          stdout=subprocess.PIPE).communicate()[0]
</pre></div>

<p>Or</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">subprocess</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">'ls'</span><span class="p">,</span> <span class="s1">'-a'</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> 
<span class="o">...</span>                                    <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span> <span class="n">out</span>
<span class="o">.</span>
<span class="o">..</span>
<span class="n">foo</span>
</pre></div>

<p>If you set <code>stdin=PIPE</code>, <code>communicate</code> also allows you to pass data to the
process via <code>stdin</code>:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; cmd = ['awk', 'length($0) &gt; 5']
&gt;&gt;&gt; p = subprocess.Popen(cmd, stdout=subprocess.PIPE,
...                           stderr=subprocess.PIPE,
...                           stdin=subprocess.PIPE)
&gt;&gt;&gt; out, err = p.communicate('foo\nfoofoo\n')
&gt;&gt;&gt; print out
foofoo
</pre></div>

<p>Note Aaron Hall's answer, which indicates that on some systems, you may need
to set <code>stdout</code>, <code>stderr</code>, and <code>stdin</code> all to <code>PIPE</code> (or <code>DEVNULL</code>) to get
<code>communicate</code> to work at all.</p>
<p>In some rare cases, you may need complex, real-time output capturing. Vartec's
answer suggests a way forward, but methods other than <code>communicate</code> are prone
to deadlocks if not used carefully.</p>
<p>As with all the above functions, when security is not a concern, you can run
more complex shell commands by passing <code>shell=True</code>.</p>
<h4>Notes</h4>
<p><strong>1. Running shell commands: the<code>shell=True</code> argument</strong></p>
<p>Normally, each call to <code>run</code>, <code>check_output</code>, or the <code>Popen</code> constructor
executes a <em>single program</em>. That means no fancy bash-style pipes. If you want
to run complex shell commands, you can pass <code>shell=True</code>, which all three
functions support. For example:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt; subprocess.check_output('cat books/* | wc', shell=True, text=True)
' 1299377 17005208 101299376\n'
</pre></div>

<p>However, doing this raises security concerns. If you're doing anything more
than light scripting, you might be better off calling each process separately,
and passing the output from each as an input to the next, via</p>
<div class="code"><pre class="code literal-block">run(cmd, [stdout=etc...], input=other_output)
</pre></div>

<p>Or</p>
<div class="code"><pre class="code literal-block">Popen(cmd, [stdout=etc...]).communicate(other_output)
</pre></div>

<p>The temptation to directly connect pipes is strong; resist it. Otherwise,
you'll likely see deadlocks or have to do hacky things like this.</p>
<p><br></p>
<h3>Suggest</h3>
<p>This is way easier, but only works on Unix (including Cygwin) and Python2.7.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">commands</span>
<span class="nb">print</span> <span class="n">commands</span><span class="o">.</span><span class="n">getstatusoutput</span><span class="p">(</span><span class="s1">'wc -l file'</span><span class="p">)</span>
</pre></div>

<p>It returns a tuple with the (return_value, output).</p>
<p>For a solution that works in both Python2 and Python3, use the <code>subprocess</code>
module instead:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">([</span><span class="s2">"date"</span><span class="p">],</span><span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<span class="nb">print</span> <span class="n">response</span>
</pre></div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/shell/" rel="tag">shell</a></li>
            <li><a class="tag p-category" href="../../categories/subprocess/" rel="tag">subprocess</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-do-i-find-the-location-of-my-python-site-packages-directory/" rel="prev" title="How do I find the location of my Python site-packages directory?">Previous post</a>
            </li>
            <li class="next">
                <a href="../how-can-i-merge-two-commits-into-one-if-i-already-started-rebase/" rel="next" title="How can I merge two commits into one if I already started rebase?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
