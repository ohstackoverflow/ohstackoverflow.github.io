<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How do I select rows from a DataFrame based on column values? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-do-i-select-rows-from-a-dataframe-based-on-column-values/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../least-astonishment-and-the-mutable-default-argument/" title='"Least Astonishment" and the Mutable Default Argument' type="text/html">
<link rel="next" href="../initialization-of-an-arraylist-in-one-line/" title="Initialization of an ArrayList in one line" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="How do I select rows from a DataFrame based on column values?">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-do-i-select-rows-from-a-dataframe-based-on-column-values/">
<meta property="og:description" content="How can I select rows from a DataFrame based on values in some column in
Pandas?
In SQL, I would use:
SELECT *
FROM table
WHERE column_name = some_value



Answer
To select rows whose column value equ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-16T19:50:17+08:00">
<meta property="article:tag" content="dataframe">
<meta property="article:tag" content="pandas">
<meta property="article:tag" content="python">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How do I select rows from a DataFrame based on column values?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T19:50:17+08:00" itemprop="datePublished" title="2023-02-16 19:50">2023-02-16 19:50</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>How can I select rows from a DataFrame based on values in some column in
Pandas?</p>
<p>In SQL, I would use:</p>
<div class="code"><pre class="code literal-block">SELECT *
FROM table
WHERE column_name = some_value
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>To select rows whose column value equals a scalar, <code>some_value</code>, use <code>==</code>:</p>
<div class="code"><pre class="code literal-block">df.loc[df['column_name'] == some_value]
</pre></div>

<p>To select rows whose column value is in an iterable, <code>some_values</code>, use
<code>isin</code>:</p>
<div class="code"><pre class="code literal-block">df.loc[df['column_name'].isin(some_values)]
</pre></div>

<p>Combine multiple conditions with <code>&amp;</code>:</p>
<div class="code"><pre class="code literal-block">df.loc[(df['column_name'] &gt;= A) &amp; (df['column_name'] &lt;= B)]
</pre></div>

<p>Note the parentheses. Due to Python's operator precedence rules, <code>&amp;</code> binds
more tightly than <code>&lt;=</code> and <code>&gt;=</code>. Thus, the parentheses in the last example are
necessary. Without the parentheses</p>
<div class="code"><pre class="code literal-block">df['column_name'] &gt;= A &amp; df['column_name'] &lt;= B
</pre></div>

<p>is parsed as</p>
<div class="code"><pre class="code literal-block">df['column_name'] &gt;= (A &amp; df['column_name']) &lt;= B
</pre></div>

<p>which results in a Truth value of a Series is ambiguous error.</p>
<hr>
<p>To select rows whose column value <em>does not equal</em> <code>some_value</code>, use <code>!=</code>:</p>
<div class="code"><pre class="code literal-block">df.loc[df['column_name'] != some_value]
</pre></div>

<p><code>isin</code> returns a boolean Series, so to select rows whose value is <em>not</em> in
<code>some_values</code>, negate the boolean Series using <code>~</code>:</p>
<div class="code"><pre class="code literal-block">df.loc[~df['column_name'].isin(some_values)]
</pre></div>

<hr>
<p>For example,</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'A'</span><span class="p">:</span> <span class="s1">'foo bar foo bar foo bar foo foo'</span><span class="o">.</span><span class="kp">split</span><span class="p">(),</span>
                   <span class="s1">'B'</span><span class="p">:</span> <span class="s1">'one one two three two two one three'</span><span class="o">.</span><span class="kp">split</span><span class="p">(),</span>
                   <span class="s1">'C'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="s1">'D'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1">#      A      B  C   D</span>
<span class="c1"># 0  foo    one  0   0</span>
<span class="c1"># 1  bar    one  1   2</span>
<span class="c1"># 2  foo    two  2   4</span>
<span class="c1"># 3  bar  three  3   6</span>
<span class="c1"># 4  foo    two  4   8</span>
<span class="c1"># 5  bar    two  5  10</span>
<span class="c1"># 6  foo    one  6  12</span>
<span class="c1"># 7  foo  three  7  14</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'A'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'foo'</span><span class="p">])</span>
</pre></div>

<p>yields</p>
<div class="code"><pre class="code literal-block">     A      B  C   D
0  foo    one  0   0
2  foo    two  2   4
4  foo    two  4   8
6  foo    one  6  12
7  foo  three  7  14
</pre></div>

<hr>
<p>If you have multiple values you want to include, put them in a list (or more
generally, any iterable) and use <code>isin</code>:</p>
<div class="code"><pre class="code literal-block">print(df.loc[df['B'].isin(['one','three'])])
</pre></div>

<p>yields</p>
<div class="code"><pre class="code literal-block">     A      B  C   D
0  foo    one  0   0
1  bar    one  1   2
3  bar  three  3   6
6  foo    one  6  12
7  foo  three  7  14
</pre></div>

<hr>
<p>Note, however, that if you wish to do this many times, it is more efficient to
make an index first, and then use <code>df.loc</code>:</p>
<div class="code"><pre class="code literal-block">df = df.set_index(['B'])
print(df.loc['one'])
</pre></div>

<p>yields</p>
<div class="code"><pre class="code literal-block">       A  C   D
B              
one  foo  0   0
one  bar  1   2
one  foo  6  12
</pre></div>

<p>or, to include multiple values from the index use <code>df.index.isin</code>:</p>
<div class="code"><pre class="code literal-block">df.loc[df.index.isin(['one','two'])]
</pre></div>

<p>yields</p>
<div class="code"><pre class="code literal-block">       A  C   D
B              
one  foo  0   0
one  bar  1   2
two  foo  2   4
two  foo  4   8
two  bar  5  10
one  foo  6  12
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>There are several ways to select rows from a Pandas dataframe:</p>
<ol>
<li><strong>Boolean indexing (<code>df[df['col'] == value</code>] )</strong></li>
<li><strong>Positional indexing (<code>df.iloc[...]</code>)</strong></li>
<li><strong>Label indexing (<code>df.xs(...)</code>)</strong></li>
<li><strong><code>df.query(...)</code> API</strong></li>
</ol>
<p>Below I show you examples of each, with advice when to use certain techniques.
Assume our criterion is column <code>'A'</code> == <code>'foo'</code></p>
<p>(Note on performance: For each base type, we can keep things simple by using
the Pandas API or we can venture outside the API, usually into NumPy, and
speed things up.)</p>
<hr>
<p><strong>Setup</strong></p>
<p>The first thing we'll need is to identify a condition that will act as our
criterion for selecting rows. We'll start with the OP's case <code>column_name ==
some_value</code>, and include some other common use cases.</p>
<p>Borrowing from @unutbu:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'A'</span><span class="p">:</span> <span class="s1">'foo bar foo bar foo bar foo foo'</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
                   <span class="s1">'B'</span><span class="p">:</span> <span class="s1">'one one two three two two one three'</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
                   <span class="s1">'C'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="s1">'D'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">})</span>
</pre></div>

<hr>
<h2><strong>1. Boolean indexing</strong></h2>
<p>... Boolean indexing requires finding the true value of each row's <code>'A'</code>
column being equal to <code>'foo'</code>, then using those truth values to identify which
rows to keep. Typically, we'd name this series, an array of truth values,
<code>mask</code>. We'll do so here as well.</p>
<div class="code"><pre class="code literal-block">mask = df['A'] == 'foo'
</pre></div>

<p>We can then use this mask to slice or index the data frame</p>
<div class="code"><pre class="code literal-block"><span class="n">df</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>

<span class="w">     </span><span class="n">A</span><span class="w">      </span><span class="n">B</span><span class="w">  </span><span class="n">C</span><span class="w">   </span><span class="n">D</span>
<span class="mi">0</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">one</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="mi">0</span>
<span class="mi">2</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">two</span><span class="w">  </span><span class="mi">2</span><span class="w">   </span><span class="mi">4</span>
<span class="mi">4</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">two</span><span class="w">  </span><span class="mi">4</span><span class="w">   </span><span class="mi">8</span>
<span class="mi">6</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">one</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">12</span>
<span class="mi">7</span><span class="w">  </span><span class="n">foo</span><span class="w">  </span><span class="n">three</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">14</span>
</pre></div>

<p>This is one of the simplest ways to accomplish this task and if performance or
intuitiveness isn't an issue, this should be your chosen method. However, if
performance is a concern, then you might want to consider an alternative way
of creating the <code>mask</code>.</p>
<hr>
<h2><strong>2. Positional indexing</strong></h2>
<p>Positional indexing (<code>df.iloc[...]</code>) has its use cases, but this isn't one of
them. In order to identify where to slice, we first need to perform the same
boolean analysis we did above. This leaves us performing one extra step to
accomplish the same task.</p>
<div class="code"><pre class="code literal-block"><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'foo'</span>
<span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="o">[</span><span class="n">pos</span><span class="o">]</span>

<span class="w">     </span><span class="n">A</span><span class="w">      </span><span class="n">B</span><span class="w">  </span><span class="n">C</span><span class="w">   </span><span class="n">D</span>
<span class="mi">0</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">one</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="mi">0</span>
<span class="mi">2</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">two</span><span class="w">  </span><span class="mi">2</span><span class="w">   </span><span class="mi">4</span>
<span class="mi">4</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">two</span><span class="w">  </span><span class="mi">4</span><span class="w">   </span><span class="mi">8</span>
<span class="mi">6</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">one</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">12</span>
<span class="mi">7</span><span class="w">  </span><span class="n">foo</span><span class="w">  </span><span class="n">three</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">14</span>
</pre></div>

<h2><strong>3. Label indexing</strong></h2>
<p><em>Label</em> indexing can be very handy, but in this case, we are again doing more
work for no benefit</p>
<div class="code"><pre class="code literal-block">df.set_index('A', append=True, drop=False).xs('foo', level=1)

     A      B  C   D
0  foo    one  0   0
2  foo    two  2   4
4  foo    two  4   8
6  foo    one  6  12
7  foo  three  7  14
</pre></div>

<h2><strong>4.<code>df.query()</code> API</strong></h2>
<p><em><code>pd.DataFrame.query</code></em> is a very elegant/intuitive way to perform this task,
but is often slower. <strong>However</strong> , if you pay attention to the timings below,
for large data, the query is very efficient. More so than the standard
approach and of similar magnitude as my best suggestion.</p>
<div class="code"><pre class="code literal-block">df.query('A == "foo"')

     A      B  C   D
0  foo    one  0   0
2  foo    two  2   4
4  foo    two  4   8
6  foo    one  6  12
7  foo  three  7  14
</pre></div>

<hr>
<p>My preference is to use the <code>Boolean</code> <code>mask</code></p>
<p>Actual improvements can be made by modifying how we create our <code>Boolean</code>
<code>mask</code>.</p>
<p><strong><code>mask</code> alternative 1</strong> <em>Use the underlying NumPy array and forgo the
overhead of creating another<code>pd.Series</code></em></p>
<div class="code"><pre class="code literal-block">mask = df['A'].values == 'foo'
</pre></div>

<p>I'll show more complete time tests at the end, but just take a look at the
performance gains we get using the sample data frame. First, we look at the
difference in creating the <code>mask</code></p>
<div class="code"><pre class="code literal-block"><span class="nf">%timeit</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="sc">'A'</span><span class="p">].</span><span class="n">values</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="err">'</span><span class="n">foo</span><span class="err">'</span>
<span class="nf">%timeit</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="sc">'A'</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="err">'</span><span class="n">foo</span><span class="err">'</span>

<span class="mf">5.84</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mi">195</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="w"> </span><span class="n">dev</span><span class="p">.</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">runs</span><span class="p">,</span><span class="w"> </span><span class="mi">100000</span><span class="w"> </span><span class="n">loops</span><span class="w"> </span><span class="n">each</span><span class="p">)</span>
<span class="mi">166</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">4.45</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="w"> </span><span class="n">dev</span><span class="p">.</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">runs</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="n">loops</span><span class="w"> </span><span class="n">each</span><span class="p">)</span>
</pre></div>

<p>Evaluating the <code>mask</code> with the NumPy array is ~ 30 times faster. This is
partly due to NumPy evaluation often being faster. It is also partly due to
the lack of overhead necessary to build an index and a corresponding
<code>pd.Series</code> object.</p>
<p>Next, we'll look at the timing for slicing with one <code>mask</code> versus the other.</p>
<div class="code"><pre class="code literal-block"><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="sc">'A'</span><span class="p">].</span><span class="n">values</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="err">'</span><span class="n">foo</span><span class="err">'</span>
<span class="nf">%timeit</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
<span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="sc">'A'</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="err">'</span><span class="n">foo</span><span class="err">'</span>
<span class="nf">%timeit</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

<span class="mi">219</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">12.3</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="w"> </span><span class="n">dev</span><span class="p">.</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">runs</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="n">loops</span><span class="w"> </span><span class="n">each</span><span class="p">)</span>
<span class="mi">239</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">7.03</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="w"> </span><span class="n">dev</span><span class="p">.</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">runs</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="n">loops</span><span class="w"> </span><span class="n">each</span><span class="p">)</span>
</pre></div>

<p>The performance gains aren't as pronounced. We'll see if this holds up over
more robust testing.</p>
<hr>
<p><strong><code>mask</code> alternative 2</strong> We could have reconstructed the data frame as well.
There is a big caveat when reconstructing a dataframe—you must take care of
the <code>dtypes</code> when doing so!</p>
<p>Instead of <code>df[mask]</code> we will do this</p>
<div class="code"><pre class="code literal-block"><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="k">values</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="k">index</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div>

<p>If the data frame is of mixed type, which our example is, then when we get
<code>df.values</code> the resulting array is of <code>dtype</code> <code>object</code> and consequently, all
columns of the new data frame will be of <code>dtype</code> <code>object</code>. Thus requiring the
<code>astype(df.dtypes)</code> and killing any potential performance gains.</p>
<div class="code"><pre class="code literal-block"><span class="nf">%timeit</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
<span class="nf">%timeit</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">values</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">).</span><span class="n">astype</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">dtypes</span><span class="p">)</span>

<span class="mi">216</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">10.4</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="w"> </span><span class="n">dev</span><span class="p">.</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">runs</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="n">loops</span><span class="w"> </span><span class="n">each</span><span class="p">)</span>
<span class="mf">1.43</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">39.6</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="w"> </span><span class="n">dev</span><span class="p">.</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">runs</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="n">loops</span><span class="w"> </span><span class="n">each</span><span class="p">)</span>
</pre></div>

<p>However, if the data frame is not of mixed type, this is a very useful way to
do it.</p>
<p>Given</p>
<div class="code"><pre class="code literal-block"><span class="nv">np</span>.<span class="k">random</span>.<span class="nv">seed</span><span class="ss">(</span>[<span class="mi">3</span>,<span class="mi">1415</span>]<span class="ss">)</span>
<span class="nv">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">pd</span>.<span class="nv">DataFrame</span><span class="ss">(</span><span class="nv">np</span>.<span class="k">random</span>.<span class="nv">randint</span><span class="ss">(</span><span class="mi">10</span>,<span class="w"> </span><span class="nv">size</span><span class="o">=</span><span class="ss">(</span><span class="mi">10</span>,<span class="w"> </span><span class="mi">5</span><span class="ss">))</span>,<span class="w"> </span><span class="nv">columns</span><span class="o">=</span><span class="nv">list</span><span class="ss">(</span><span class="s1">'ABCDE'</span><span class="ss">))</span>

<span class="nv">d1</span>

<span class="w">   </span><span class="nv">A</span><span class="w">  </span><span class="nv">B</span><span class="w">  </span><span class="nv">C</span><span class="w">  </span><span class="nv">D</span><span class="w">  </span><span class="nv">E</span>
<span class="mi">0</span><span class="w">  </span><span class="mi">0</span><span class="w">  </span><span class="mi">2</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="mi">8</span>
<span class="mi">1</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">0</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">8</span><span class="w">  </span><span class="mi">6</span>
<span class="mi">2</span><span class="w">  </span><span class="mi">0</span><span class="w">  </span><span class="mi">2</span><span class="w">  </span><span class="mi">0</span><span class="w">  </span><span class="mi">4</span><span class="w">  </span><span class="mi">9</span>
<span class="mi">3</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="mi">2</span><span class="w">  </span><span class="mi">4</span><span class="w">  </span><span class="mi">3</span>
<span class="mi">4</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">4</span>
<span class="mi">5</span><span class="w">  </span><span class="mi">5</span><span class="w">  </span><span class="mi">3</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">5</span><span class="w">  </span><span class="mi">9</span>
<span class="mi">6</span><span class="w">  </span><span class="mi">8</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">4</span><span class="w">  </span><span class="mi">7</span>
<span class="mi">7</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">2</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">5</span>
<span class="mi">8</span><span class="w">  </span><span class="mi">2</span><span class="w">  </span><span class="mi">8</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">5</span><span class="w">  </span><span class="mi">8</span>
<span class="mi">9</span><span class="w">  </span><span class="mi">4</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">1</span><span class="w">  </span><span class="mi">5</span>
</pre></div>

<hr>
<div class="code"><pre class="code literal-block"><span class="o">%%</span><span class="n">timeit</span>
<span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d1</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="p">.</span><span class="k">values</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">7</span>
<span class="n">d1</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>

<span class="mi">179</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">8.73</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="w"> </span><span class="n">dev</span><span class="p">.</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">runs</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="n">loops</span><span class="w"> </span><span class="k">each</span><span class="p">)</span>
</pre></div>

<p>Versus</p>
<div class="code"><pre class="code literal-block"><span class="o">%%</span><span class="n">timeit</span>
<span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d1</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="p">.</span><span class="k">values</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">7</span>
<span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d1</span><span class="p">.</span><span class="k">values</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">d1</span><span class="p">.</span><span class="k">index</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">d1</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>

<span class="mi">87</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="mf">5.12</span><span class="w"> </span><span class="n">µs</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="err">±</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="w"> </span><span class="n">dev</span><span class="p">.</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">runs</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="w"> </span><span class="n">loops</span><span class="w"> </span><span class="k">each</span><span class="p">)</span>
</pre></div>

<p>We cut the time in half.</p>
<hr>
<p><strong><code>mask</code> alternative 3</strong></p>
<p>@unutbu also shows us how to use <code>pd.Series.isin</code> to account for each element
of <code>df['A']</code> being in a set of values. This evaluates to the same thing if our
set of values is a set of one value, namely <code>'foo'</code>. But it also generalizes
to include larger sets of values if needed. Turns out, this is still pretty
fast even though it is a more general solution. The only real loss is in
intuitiveness for those not familiar with the concept.</p>
<div class="code"><pre class="code literal-block"><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="p">.</span><span class="n">isin</span><span class="p">(</span><span class="o">[</span><span class="n">'foo'</span><span class="o">]</span><span class="p">)</span>
<span class="n">df</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>

<span class="w">     </span><span class="n">A</span><span class="w">      </span><span class="n">B</span><span class="w">  </span><span class="n">C</span><span class="w">   </span><span class="n">D</span>
<span class="mi">0</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">one</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="mi">0</span>
<span class="mi">2</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">two</span><span class="w">  </span><span class="mi">2</span><span class="w">   </span><span class="mi">4</span>
<span class="mi">4</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">two</span><span class="w">  </span><span class="mi">4</span><span class="w">   </span><span class="mi">8</span>
<span class="mi">6</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">one</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">12</span>
<span class="mi">7</span><span class="w">  </span><span class="n">foo</span><span class="w">  </span><span class="n">three</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">14</span>
</pre></div>

<p>However, as before, we can utilize NumPy to improve performance while
sacrificing virtually nothing. We'll use <code>np.in1d</code></p>
<div class="code"><pre class="code literal-block"><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">df</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="p">.</span><span class="k">values</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">'foo'</span><span class="o">]</span><span class="p">)</span>
<span class="n">df</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>

<span class="w">     </span><span class="n">A</span><span class="w">      </span><span class="n">B</span><span class="w">  </span><span class="n">C</span><span class="w">   </span><span class="n">D</span>
<span class="mi">0</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">one</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="mi">0</span>
<span class="mi">2</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">two</span><span class="w">  </span><span class="mi">2</span><span class="w">   </span><span class="mi">4</span>
<span class="mi">4</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">two</span><span class="w">  </span><span class="mi">4</span><span class="w">   </span><span class="mi">8</span>
<span class="mi">6</span><span class="w">  </span><span class="n">foo</span><span class="w">    </span><span class="n">one</span><span class="w">  </span><span class="mi">6</span><span class="w">  </span><span class="mi">12</span>
<span class="mi">7</span><span class="w">  </span><span class="n">foo</span><span class="w">  </span><span class="n">three</span><span class="w">  </span><span class="mi">7</span><span class="w">  </span><span class="mi">14</span>
</pre></div>

<hr>
<p><strong>Timing</strong></p>
<p>I'll include other concepts mentioned in other posts as well for reference.</p>
<p><em>Code Below</em></p>
<p>Each <em>column</em> in this table represents a different length data frame over
which we test each function. Each column shows relative time taken, with the
fastest function given a base index of <code>1.0</code>.</p>
<div class="code"><pre class="code literal-block">res.div(res.min())

                         10        30        100       300       1000      3000      10000     30000
mask_standard         2.156872  1.850663  2.034149  2.166312  2.164541  3.090372  2.981326  3.131151
mask_standard_loc     1.879035  1.782366  1.988823  2.338112  2.361391  3.036131  2.998112  2.990103
mask_with_values      1.010166  1.000000  1.005113  1.026363  1.028698  1.293741  1.007824  1.016919
mask_with_values_loc  1.196843  1.300228  1.000000  1.000000  1.038989  1.219233  1.037020  1.000000
query                 4.997304  4.765554  5.934096  4.500559  2.997924  2.397013  1.680447  1.398190
xs_label              4.124597  4.272363  5.596152  4.295331  4.676591  5.710680  6.032809  8.950255
mask_with_isin        1.674055  1.679935  1.847972  1.724183  1.345111  1.405231  1.253554  1.264760
mask_with_in1d        1.000000  1.083807  1.220493  1.101929  1.000000  1.000000  1.000000  1.144175
</pre></div>

<p>You'll notice that the fastest times seem to be shared between
<code>mask_with_values</code> and <code>mask_with_in1d</code>.</p>
<div class="code"><pre class="code literal-block">res.T.plot(loglog=True)
</pre></div>

<p><img alt="Enter image description here" src="../../images/ljeTd.png"></p>
<p><strong>Functions</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">def</span><span class="w"> </span><span class="n">mask_standard</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'foo'</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>

<span class="n">def</span><span class="w"> </span><span class="n">mask_standard_loc</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'foo'</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>

<span class="n">def</span><span class="w"> </span><span class="n">mask_with_values</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="p">.</span><span class="k">values</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'foo'</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>

<span class="n">def</span><span class="w"> </span><span class="n">mask_with_values_loc</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="p">.</span><span class="k">values</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'foo'</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>

<span class="n">def</span><span class="w"> </span><span class="n">query</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="s1">'A == "foo"'</span><span class="p">)</span>

<span class="n">def</span><span class="w"> </span><span class="n">xs_label</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'A'</span><span class="p">,</span><span class="w"> </span><span class="n">append</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="k">drop</span><span class="o">=</span><span class="k">False</span><span class="p">).</span><span class="n">xs</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">def</span><span class="w"> </span><span class="n">mask_with_isin</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="p">.</span><span class="n">isin</span><span class="p">(</span><span class="o">[</span><span class="n">'foo'</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>

<span class="n">def</span><span class="w"> </span><span class="n">mask_with_in1d</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">df</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="p">.</span><span class="k">values</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">'foo'</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>
</pre></div>

<hr>
<p><strong>Testing</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">'mask_standard'</span><span class="p">,</span> <span class="s1">'mask_standard_loc'</span><span class="p">,</span> <span class="s1">'mask_with_values'</span><span class="p">,</span> <span class="s1">'mask_with_values_loc'</span><span class="p">,</span>
        <span class="s1">'query'</span><span class="p">,</span> <span class="s1">'xs_label'</span><span class="p">,</span> <span class="s1">'mask_with_isin'</span><span class="p">,</span> <span class="s1">'mask_with_in1d'</span>
    <span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">30000</span><span class="p">],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">]</span> <span class="o">*</span> <span class="n">j</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">index</span><span class="p">:</span><span class="n">a</span>
        <span class="n">stmt</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{}</span><span class="s1">(d)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">setp</span> <span class="o">=</span> <span class="s1">'from __main__ import d, </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">setp</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>

<hr>
<p><strong>Special Timing</strong></p>
<p>Looking at the special case when we have a single non-object <code>dtype</code> for the
entire data frame.</p>
<p><em>Code Below</em></p>
<div class="code"><pre class="code literal-block"><span class="n">spec</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

<span class="w">                     </span><span class="mi">10</span><span class="w">        </span><span class="mi">30</span><span class="w">        </span><span class="mi">100</span><span class="w">       </span><span class="mi">300</span><span class="w">       </span><span class="mi">1000</span><span class="w">      </span><span class="mi">3000</span><span class="w">      </span><span class="mi">10000</span><span class="w">     </span><span class="mi">30000</span>
<span class="n">mask_with_values</span><span class="w">  </span><span class="mf">1.009030</span><span class="w">  </span><span class="mf">1.000000</span><span class="w">  </span><span class="mf">1.194276</span><span class="w">  </span><span class="mf">1.000000</span><span class="w">  </span><span class="mf">1.236892</span><span class="w">  </span><span class="mf">1.095343</span><span class="w">  </span><span class="mf">1.000000</span><span class="w">  </span><span class="mf">1.000000</span>
<span class="n">mask_with_in1d</span><span class="w">    </span><span class="mf">1.104638</span><span class="w">  </span><span class="mf">1.094524</span><span class="w">  </span><span class="mf">1.156930</span><span class="w">  </span><span class="mf">1.072094</span><span class="w">  </span><span class="mf">1.000000</span><span class="w">  </span><span class="mf">1.000000</span><span class="w">  </span><span class="mf">1.040043</span><span class="w">  </span><span class="mf">1.027100</span>
<span class="n">reconstruct</span><span class="w">       </span><span class="mf">1.000000</span><span class="w">  </span><span class="mf">1.142838</span><span class="w">  </span><span class="mf">1.000000</span><span class="w">  </span><span class="mf">1.355440</span><span class="w">  </span><span class="mf">1.650270</span><span class="w">  </span><span class="mf">2.222181</span><span class="w">  </span><span class="mf">2.294913</span><span class="w">  </span><span class="mf">3.406735</span>
</pre></div>

<p>Turns out, reconstruction isn't worth it past a few hundred rows.</p>
<div class="code"><pre class="code literal-block">spec.T.plot(loglog=True)
</pre></div>

<p><img alt="Enter image description here" src="../../images/K1bNc.png"></p>
<p><strong>Functions</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">seed</span><span class="p">(</span><span class="o">[</span><span class="n">3,1415</span><span class="o">]</span><span class="p">)</span>
<span class="n">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="k">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)),</span><span class="w"> </span><span class="n">columns</span><span class="o">=</span><span class="n">list</span><span class="p">(</span><span class="s1">'ABCDE'</span><span class="p">))</span>

<span class="n">def</span><span class="w"> </span><span class="n">mask_with_values</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="p">.</span><span class="k">values</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'foo'</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>

<span class="n">def</span><span class="w"> </span><span class="n">mask_with_in1d</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">df</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="p">.</span><span class="k">values</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">'foo'</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span>

<span class="n">def</span><span class="w"> </span><span class="n">reconstruct</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="k">values</span>
<span class="w">    </span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">df</span><span class="o">[</span><span class="n">'A'</span><span class="o">]</span><span class="p">.</span><span class="k">values</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">'foo'</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">v</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="k">index</span><span class="o">[</span><span class="n">mask</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="w">    </span><span class="k">index</span><span class="o">=[</span><span class="n">'mask_with_values', 'mask_with_in1d', 'reconstruct'</span><span class="o">]</span><span class="p">,</span>
<span class="w">    </span><span class="n">columns</span><span class="o">=[</span><span class="n">10, 30, 100, 300, 1000, 3000, 10000, 30000</span><span class="o">]</span><span class="p">,</span>
<span class="w">    </span><span class="n">dtype</span><span class="o">=</span><span class="nc">float</span>
<span class="p">)</span>
</pre></div>

<p><strong>Testing</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">]</span> <span class="o">*</span> <span class="n">j</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">stmt</span> <span class="o">=</span> <span class="s1">'</span><span class="si">{}</span><span class="s1">(d)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">setp</span> <span class="o">=</span> <span class="s1">'from __main__ import d, </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeit</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">setp</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/dataframe/" rel="tag">dataframe</a></li>
            <li><a class="tag p-category" href="../../categories/pandas/" rel="tag">pandas</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../least-astonishment-and-the-mutable-default-argument/" rel="prev" title='"Least Astonishment" and the Mutable Default Argument'>Previous post</a>
            </li>
            <li class="next">
                <a href="../initialization-of-an-arraylist-in-one-line/" rel="next" title="Initialization of an ArrayList in one line">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
