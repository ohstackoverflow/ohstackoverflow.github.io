<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How to convert a factor to integer\numeric without loss of information? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-to-convert-a-factor-to-integer-numeric-without-loss-of-information/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-do-i-merge-my-local-uncommitted-changes-into-another-git-branch/" title="How do I merge my local uncommitted changes into another Git branch?" type="text/html">
<link rel="next" href="../how-do-i-achieve-the-theoretical-maximum-of-4-flops-per-cycle/" title="How do I achieve the theoretical maximum of 4 FLOPs per cycle?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="How to convert a factor to integer\numeric without loss of information">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-to-convert-a-factor-to-integer-numeric-without-loss-of-information/">
<meta property="og:description" content="When I convert a factor to a numeric or integer, I get the underlying level
codes, not the values as numbers.
f &lt;- factor(sample(runif(5), 20, replace = TRUE))
##  [1] 0.0248644019011408 0.02486440190">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T17:57:45+08:00">
<meta property="article:tag" content="casting">
<meta property="article:tag" content="r">
<meta property="article:tag" content="r-faq">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How to convert a factor to integer\numeric without loss of information?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T17:57:45+08:00" itemprop="datePublished" title="2023-02-17 17:57">2023-02-17 17:57</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>When I convert a factor to a numeric or integer, I get the underlying level
codes, not the values as numbers.</p>
<div class="code"><pre class="code literal-block"><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="nf">sample</span><span class="p">(</span><span class="nf">runif</span><span class="p">(</span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>
<span class="c1">##  [1] 0.0248644019011408 0.0248644019011408 0.179684827337041 </span>
<span class="c1">##  [4] 0.0284090070053935 0.363644931698218  0.363644931698218 </span>
<span class="c1">##  [7] 0.179684827337041  0.249704354675487  0.249704354675487 </span>
<span class="c1">## [10] 0.0248644019011408 0.249704354675487  0.0284090070053935</span>
<span class="c1">## [13] 0.179684827337041  0.0248644019011408 0.179684827337041 </span>
<span class="c1">## [16] 0.363644931698218  0.249704354675487  0.363644931698218 </span>
<span class="c1">## [19] 0.179684827337041  0.0284090070053935</span>
<span class="c1">## 5 Levels: 0.0248644019011408 0.0284090070053935 ... 0.363644931698218</span>

<span class="nf">as.numeric</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1">##  [1] 1 1 3 2 5 5 3 4 4 1 4 2 3 1 3 5 4 5 3 2</span>

<span class="nf">as.integer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1">##  [1] 1 1 3 2 5 5 3 4 4 1 4 2 3 1 3 5 4 5 3 2</span>
</pre></div>

<p>I have to resort to <code>paste</code> to get the real values:</p>
<div class="code"><pre class="code literal-block">as.numeric(paste(f))
##  [1] 0.02486440 0.02486440 0.17968483 0.02840901 0.36364493 0.36364493
##  [7] 0.17968483 0.24970435 0.24970435 0.02486440 0.24970435 0.02840901
## [13] 0.17968483 0.02486440 0.17968483 0.36364493 0.24970435 0.36364493
## [19] 0.17968483 0.02840901
</pre></div>

<p>Is there a better way to convert a factor to numeric?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>See the Warning section of <code>?factor</code>:</p>
<blockquote>
<p>In particular, <code>as.numeric</code> applied to a factor is meaningless, and may
happen by implicit coercion. To transform a factor <code>f</code> to approximately its
original numeric values, <code>as.numeric(levels(f))[f]</code> is recommended and
slightly more efficient than <code>as.numeric(as.character(f))</code>.</p>
</blockquote>
<p>The FAQ on R has similar advice.</p>
<hr>
<p><strong>Why is<code>as.numeric(levels(f))[f]</code> more efficent than
<code>as.numeric(as.character(f))</code>?</strong></p>
<p><code>as.numeric(as.character(f))</code> is effectively <code>as.numeric(levels(f)[f])</code>, so
you are performing the conversion to numeric on <code>length(x)</code> values, rather
than on <code>nlevels(x)</code> values. The speed difference will be most apparent for
long vectors with few levels. If the values are mostly unique, there won't be
much difference in speed. However you do the conversion, this operation is
unlikely to be the bottleneck in your code, so don't worry too much about it.</p>
<hr>
<p><strong>Some timings</strong></p>
<div class="code"><pre class="code literal-block"><span class="n">library</span><span class="p">(</span><span class="n">microbenchmark</span><span class="p">)</span>
<span class="n">microbenchmark</span><span class="p">(</span>
<span class="w">  </span><span class="k">as</span><span class="p">.</span><span class="nc">numeric</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="o">[</span><span class="n">f</span><span class="o">]</span><span class="p">,</span>
<span class="w">  </span><span class="k">as</span><span class="p">.</span><span class="nc">numeric</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">[</span><span class="n">f</span><span class="o">]</span><span class="p">),</span>
<span class="w">  </span><span class="k">as</span><span class="p">.</span><span class="nc">numeric</span><span class="p">(</span><span class="k">as</span><span class="p">.</span><span class="k">character</span><span class="p">(</span><span class="n">f</span><span class="p">)),</span>
<span class="w">  </span><span class="n">paste0</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
<span class="w">  </span><span class="n">paste</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
<span class="w">  </span><span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e5</span>
<span class="p">)</span>
<span class="err">##</span><span class="w"> </span><span class="nl">Unit</span><span class="p">:</span><span class="w"> </span><span class="n">microseconds</span>
<span class="err">##</span><span class="w">                         </span><span class="n">expr</span><span class="w">   </span><span class="nf">min</span><span class="w">    </span><span class="n">lq</span><span class="w">      </span><span class="n">mean</span><span class="w"> </span><span class="n">median</span><span class="w">     </span><span class="n">uq</span><span class="w">      </span><span class="nf">max</span><span class="w"> </span><span class="n">neval</span>
<span class="err">##</span><span class="w">     </span><span class="k">as</span><span class="p">.</span><span class="nc">numeric</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="o">[</span><span class="n">f</span><span class="o">]</span><span class="w"> </span><span class="mf">3.982</span><span class="w"> </span><span class="mf">5.120</span><span class="w">  </span><span class="mf">6.088624</span><span class="w">  </span><span class="mf">5.405</span><span class="w">  </span><span class="mf">5.974</span><span class="w"> </span><span class="mf">1981.418</span><span class="w"> </span><span class="mf">1e+05</span>
<span class="err">##</span><span class="w">     </span><span class="k">as</span><span class="p">.</span><span class="nc">numeric</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">[</span><span class="n">f</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="mf">5.973</span><span class="w"> </span><span class="mf">7.111</span><span class="w">  </span><span class="mf">8.352032</span><span class="w">  </span><span class="mf">7.396</span><span class="w">  </span><span class="mf">8.250</span><span class="w"> </span><span class="mf">4256.380</span><span class="w"> </span><span class="mf">1e+05</span>
<span class="err">##</span><span class="w">  </span><span class="k">as</span><span class="p">.</span><span class="nc">numeric</span><span class="p">(</span><span class="k">as</span><span class="p">.</span><span class="k">character</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="w"> </span><span class="mf">6.827</span><span class="w"> </span><span class="mf">8.249</span><span class="w">  </span><span class="mf">9.628264</span><span class="w">  </span><span class="mf">8.534</span><span class="w">  </span><span class="mf">9.671</span><span class="w"> </span><span class="mf">1983.694</span><span class="w"> </span><span class="mf">1e+05</span>
<span class="err">##</span><span class="w">                    </span><span class="n">paste0</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="mf">7.964</span><span class="w"> </span><span class="mf">9.387</span><span class="w"> </span><span class="mf">11.026351</span><span class="w">  </span><span class="mf">9.956</span><span class="w"> </span><span class="mf">10.810</span><span class="w"> </span><span class="mf">2911.257</span><span class="w"> </span><span class="mf">1e+05</span>
<span class="err">##</span><span class="w">                     </span><span class="n">paste</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="mf">7.965</span><span class="w"> </span><span class="mf">9.387</span><span class="w"> </span><span class="mf">11.127308</span><span class="w">  </span><span class="mf">9.956</span><span class="w"> </span><span class="mf">11.093</span><span class="w"> </span><span class="mf">2419.458</span><span class="w"> </span><span class="mf">1e+05</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>R has a number of (undocumented) convenience functions for converting factors:</p>
<ul>
<li><code>as.character.factor</code></li>
<li><code>as.data.frame.factor</code></li>
<li><code>as.Date.factor</code></li>
<li><code>as.list.factor</code></li>
<li><code>as.vector.factor</code></li>
<li>...</li>
</ul>
<p>But annoyingly, there is nothing to handle the <em>factor - &gt; numeric</em>
conversion. As an extension of Joshua Ulrich's answer, I would suggest to
overcome this omission with the definition of your own idiomatic function:</p>
<div class="code"><pre class="code literal-block"><span class="k">as</span><span class="p">.</span><span class="k">double</span><span class="p">.</span><span class="n">factor</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="err">{</span><span class="k">as</span><span class="p">.</span><span class="nc">numeric</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="err">}</span>
</pre></div>

<p>that you can store at the beginning of your script, or even better in your
<code>.Rprofile</code> file.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/casting/" rel="tag">casting</a></li>
            <li><a class="tag p-category" href="../../categories/r/" rel="tag">r</a></li>
            <li><a class="tag p-category" href="../../categories/r-faq/" rel="tag">r-faq</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-do-i-merge-my-local-uncommitted-changes-into-another-git-branch/" rel="prev" title="How do I merge my local uncommitted changes into another Git branch?">Previous post</a>
            </li>
            <li class="next">
                <a href="../how-do-i-achieve-the-theoretical-maximum-of-4-flops-per-cycle/" rel="next" title="How do I achieve the theoretical maximum of 4 FLOPs per cycle?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
