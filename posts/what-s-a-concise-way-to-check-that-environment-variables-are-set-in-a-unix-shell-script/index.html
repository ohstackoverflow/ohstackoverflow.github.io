<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>What's a concise way to check that environment variables are set in a Unix shell script? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/what-s-a-concise-way-to-check-that-environment-variables-are-set-in-a-unix-shell-script/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../is-it-not-possible-to-stringify-an-error-using-json-stringify/" title="Is it not possible to stringify an Error using JSON.stringify?" type="text/html">
<link rel="next" href="../what-is-the-difference-between-classic-and-integrated-pipeline-mode-in-iis7/" title="What is the difference between 'classic' and 'integrated' pipeline mode in IIS7?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="What's a concise way to check that environment variables are set in a ">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/what-s-a-concise-way-to-check-that-environment-variables-are-set-in-a-unix-shell-script/">
<meta property="og:description" content="I've got a few Unix shell scripts where I need to check that certain
environment variables are set before I start doing stuff, so I do this sort of
thing:
if [ -z &quot;$STATE&quot; ]; then
    echo &quot;Need to se">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T03:32:14+08:00">
<meta property="article:tag" content="bash">
<meta property="article:tag" content="shell">
<meta property="article:tag" content="unix">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">What's a concise way to check that environment variables are set in a Unix shell script?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T03:32:14+08:00" itemprop="datePublished" title="2023-03-03 03:32">2023-03-03 03:32</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I've got a few Unix shell scripts where I need to check that certain
environment variables are set before I start doing stuff, so I do this sort of
thing:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span>[<span class="w"> </span><span class="o">-</span><span class="nv">z</span><span class="w"> </span><span class="s2">"$STATE"</span><span class="w"> </span>]<span class="c1">; then</span>
<span class="w">    </span><span class="nv">echo</span><span class="w"> </span><span class="s2">"Need to set STATE"</span>
<span class="w">    </span><span class="k">exit</span><span class="w"> </span><span class="mi">1</span>
<span class="nv">fi</span>

<span class="k">if</span><span class="w"> </span>[<span class="w"> </span><span class="o">-</span><span class="nv">z</span><span class="w"> </span><span class="s2">"$DEST"</span><span class="w"> </span>]<span class="c1">; then</span>
<span class="w">    </span><span class="nv">echo</span><span class="w"> </span><span class="s2">"Need to set DEST"</span>
<span class="w">    </span><span class="k">exit</span><span class="w"> </span><span class="mi">1</span>
<span class="nv">fi</span>
</pre></div>

<p>which is a lot of typing. Is there a more elegant idiom for checking that a
set of environment variables is set?</p>
<p>EDIT: I should mention that these variables have no meaningful default value -
the script should error out if any are unset.</p>
<p><br><br></p>
<h2>Answer</h2>
<h4>Parameter Expansion</h4>
<p>The obvious answer is to use one of the special forms of parameter expansion:</p>
<div class="code"><pre class="code literal-block">:<span class="w"> </span><span class="cp">${</span><span class="n">STATE</span><span class="err">?</span><span class="s2">"Need to set STATE"</span><span class="cp">}</span>
:<span class="w"> </span><span class="cp">${</span><span class="n">DEST</span><span class="p">:</span><span class="err">?</span><span class="s2">"Need to set DEST non-empty"</span><span class="cp">}</span>
</pre></div>

<p>Or, better (see section on 'Position of double quotes' below):</p>
<div class="code"><pre class="code literal-block">:<span class="w"> </span>"<span class="cp">${</span><span class="n">STATE</span><span class="err">?</span><span class="n">Need</span> <span class="n">to</span> <span class="nb">set</span> <span class="n">STATE</span><span class="cp">}</span>"
:<span class="w"> </span>"<span class="cp">${</span><span class="n">DEST</span><span class="p">:</span><span class="err">?</span><span class="n">Need</span> <span class="n">to</span> <span class="nb">set</span> <span class="n">DEST</span> <span class="n">non</span><span class="o">-</span><span class="n">empty</span><span class="cp">}</span>"
</pre></div>

<p>The first variant (using just <code>?</code>) requires STATE to be set, but STATE="" (an
empty string) is OK — not exactly what you want, but the alternative and older
notation.</p>
<p>The second variant (using <code>:?</code>) requires DEST to be set and non-empty.</p>
<p>If you supply no message, the shell provides a default message.</p>
<p>The <code>${var?}</code> construct is portable back to Version 7 UNIX and the Bourne
Shell (1978 or thereabouts). The <code>${var:?}</code> construct is slightly more recent:
I think it was in System III UNIX circa 1981, but it may have been in PWB UNIX
before that. It is therefore in the Korn Shell, and in the POSIX shells,
including specifically Bash.</p>
<p>It is usually documented in the shell's man page in a section called Parameter
Expansion. For example, the <code>bash</code> manual says:</p>
<blockquote>
<div class="code"><pre class="code literal-block"><span class="cp">${</span><span class="n">parameter</span><span class="p">:</span><span class="err">?</span><span class="n">word</span><span class="cp">}</span>
</pre></div>

<p>Display Error if Null or Unset. If parameter is null or unset, the expansion
of word (or a message to that effect if word is not present) is written to
the standard error and the shell, if it is not interactive, exits.
Otherwise, the value of parameter is substituted.</p>
</blockquote>
<h4>The Colon Command</h4>
<p>I should probably add that the colon command simply has its arguments
evaluated and then succeeds. It is the original shell comment notation (before
'<code>#</code>' to end of line). For a long time, Bourne shell scripts had a colon as
the first character. The C Shell would read a script and use the first
character to determine whether it was for the C Shell (a '<code>#</code>' hash) or the
Bourne shell (a '<code>:</code>' colon). Then the kernel got in on the act and added
support for '<code>#!/path/to/program</code>' and the Bourne shell got '<code>#</code>' comments,
and the colon convention went by the wayside. But if you come across a script
that starts with a colon, now you will know why.</p>
<hr>
<h4>Position of double quotes</h4>
<p>blong asked in a comment:</p>
<blockquote>
<p>Any thoughts on this discussion?
https://github.com/koalaman/shellcheck/issues/380#issuecomment-145872749</p>
</blockquote>
<p>The gist of the discussion is:</p>
<blockquote>
<p>… However, when I <code>shellcheck</code> it (with version 0.4.1), I get this message:</p>
<div class="code"><pre class="code literal-block"><span class="n">In</span><span class="w"> </span><span class="n">script</span><span class="o">.</span><span class="n">sh</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">13</span><span class="p">:</span>
<span class="p">:</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">FOO</span><span class="p">:</span><span class="err">?</span><span class="s2">"The environment variable 'FOO' must be set and non-empty"</span><span class="p">}</span>
<span class="w">  </span><span class="o">^--</span><span class="w"> </span><span class="n">SC2086</span><span class="p">:</span><span class="w"> </span><span class="n">Double</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="n">globbing</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="n">splitting</span><span class="o">.</span>
</pre></div>

<p>Any advice on what I should do in this case?</p>
</blockquote>
<p>The short answer is "do as <code>shellcheck</code> suggests":</p>
<div class="code"><pre class="code literal-block">:<span class="w"> </span>"<span class="cp">${</span><span class="n">STATE</span><span class="err">?</span><span class="n">Need</span> <span class="n">to</span> <span class="nb">set</span> <span class="n">STATE</span><span class="cp">}</span>"
:<span class="w"> </span>"<span class="cp">${</span><span class="n">DEST</span><span class="p">:</span><span class="err">?</span><span class="n">Need</span> <span class="n">to</span> <span class="nb">set</span> <span class="n">DEST</span> <span class="n">non</span><span class="o">-</span><span class="n">empty</span><span class="cp">}</span>"
</pre></div>

<p>To illustrate why, study the following. Note that the <code>:</code> command doesn't echo
its arguments (but the shell does evaluate the arguments). We want to see the
arguments, so the code below uses <code>printf "%s\n"</code> in place of <code>:</code>.</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>mkdir<span class="w"> </span>junk
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>junk
$<span class="w"> </span>&gt;<span class="w"> </span>abc
$<span class="w"> </span>&gt;<span class="w"> </span>def
$<span class="w"> </span>&gt;<span class="w"> </span>ghi
$<span class="w"> </span>
$<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="s2">"*"</span>
$<span class="w"> </span><span class="nb">printf</span><span class="w"> </span><span class="s2">"%s\n"</span><span class="w"> </span><span class="si">${</span><span class="nv">x</span><span class="p">:?You must set x</span><span class="si">}</span><span class="w">    </span><span class="c1"># Careless; not recommended</span>
abc
def
ghi
$<span class="w"> </span><span class="nb">unset</span><span class="w"> </span>x
$<span class="w"> </span><span class="nb">printf</span><span class="w"> </span><span class="s2">"%s\n"</span><span class="w"> </span><span class="si">${</span><span class="nv">x</span><span class="p">:?You must set x</span><span class="si">}</span><span class="w">    </span><span class="c1"># Careless; not recommended</span>
bash:<span class="w"> </span>x:<span class="w"> </span>You<span class="w"> </span>must<span class="w"> </span><span class="nb">set</span><span class="w"> </span>x
$<span class="w"> </span><span class="nb">printf</span><span class="w"> </span><span class="s2">"%s\n"</span><span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">x</span><span class="p">:?You must set x</span><span class="si">}</span><span class="s2">"</span><span class="w">  </span><span class="c1"># Careful: should be used</span>
bash:<span class="w"> </span>x:<span class="w"> </span>You<span class="w"> </span>must<span class="w"> </span><span class="nb">set</span><span class="w"> </span>x
$<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="s2">"*"</span>
$<span class="w"> </span><span class="nb">printf</span><span class="w"> </span><span class="s2">"%s\n"</span><span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">x</span><span class="p">:?You must set x</span><span class="si">}</span><span class="s2">"</span><span class="w">  </span><span class="c1"># Careful: should be used</span>
*
$<span class="w"> </span><span class="nb">printf</span><span class="w"> </span><span class="s2">"%s\n"</span><span class="w"> </span><span class="si">${</span><span class="nv">x</span><span class="p">:?</span><span class="s2">"You must set x"</span><span class="si">}</span><span class="w">  </span><span class="c1"># Not quite careful enough</span>
abc
def
ghi
$<span class="w"> </span><span class="nv">x</span><span class="o">=</span>
$<span class="w"> </span><span class="nb">printf</span><span class="w"> </span><span class="s2">"%s\n"</span><span class="w"> </span><span class="si">${</span><span class="nv">x</span><span class="p">:?</span><span class="s2">"You must set x"</span><span class="si">}</span><span class="w">  </span><span class="c1"># Not quite careful enough</span>
bash:<span class="w"> </span>x:<span class="w"> </span>You<span class="w"> </span>must<span class="w"> </span><span class="nb">set</span><span class="w"> </span>x
$<span class="w"> </span><span class="nb">unset</span><span class="w"> </span>x
$<span class="w"> </span><span class="nb">printf</span><span class="w"> </span><span class="s2">"%s\n"</span><span class="w"> </span><span class="si">${</span><span class="nv">x</span><span class="p">:?</span><span class="s2">"You must set x"</span><span class="si">}</span><span class="w">  </span><span class="c1"># Not quite careful enough</span>
bash:<span class="w"> </span>x:<span class="w"> </span>You<span class="w"> </span>must<span class="w"> </span><span class="nb">set</span><span class="w"> </span>x
$
</pre></div>

<p>Note how the value in <code>$x</code> is expanded to first <code>*</code> and then a list of file
names when the overall expression is not in double quotes. This is what
<code>shellcheck</code> is recommending should be fixed. I have not verified that it
doesn't object to the form where the expression is enclosed in double quotes,
but it is a reasonable assumption that it would be OK.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Try this:</p>
<div class="code"><pre class="code literal-block">[<span class="w"> </span><span class="o">-</span><span class="nv">z</span><span class="w"> </span><span class="s2">"$STATE"</span><span class="w"> </span>]<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">echo</span><span class="w"> </span><span class="s2">"Need to set STATE"</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">exit</span><span class="w"> </span><span class="mi">1</span><span class="c1">;</span>
</pre></div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/bash/" rel="tag">bash</a></li>
            <li><a class="tag p-category" href="../../categories/shell/" rel="tag">shell</a></li>
            <li><a class="tag p-category" href="../../categories/unix/" rel="tag">unix</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../is-it-not-possible-to-stringify-an-error-using-json-stringify/" rel="prev" title="Is it not possible to stringify an Error using JSON.stringify?">Previous post</a>
            </li>
            <li class="next">
                <a href="../what-is-the-difference-between-classic-and-integrated-pipeline-mode-in-iis7/" rel="next" title="What is the difference between 'classic' and 'integrated' pipeline mode in IIS7?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
