<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How can I determine whether a 2D Point is within a Polygon? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-can-i-determine-whether-a-2d-point-is-within-a-polygon/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-to-make-an-android-device-vibrate-with-different-frequency/" title="How to make an Android device vibrate? with different frequency?" type="text/html">
<link rel="next" href="../display-back-arrow-on-toolbar/" title="Display Back Arrow on Toolbar" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="How can I determine whether a 2D Point is within a Polygon?">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-can-i-determine-whether-a-2d-point-is-within-a-polygon/">
<meta property="og:description" content="I'm trying to create a fast 2D point inside polygon algorithm, for use in
hit-testing (e.g. Polygon.contains(p:Point)). Suggestions for effective
techniques would be appreciated.

Answer
For graphics,">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-18T01:35:07+08:00">
<meta property="article:tag" content="collision-detection">
<meta property="article:tag" content="graphics">
<meta property="article:tag" content="performance">
<meta property="article:tag" content="point-in-polygon">
<meta property="article:tag" content="polygon">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How can I determine whether a 2D Point is within a Polygon?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T01:35:07+08:00" itemprop="datePublished" title="2023-02-18 01:35">2023-02-18 01:35</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I'm trying to create a <em>fast</em> 2D point inside polygon algorithm, for use in
hit-testing (e.g. <code>Polygon.contains(p:Point)</code>). Suggestions for effective
techniques would be appreciated.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>For graphics, I'd rather not prefer integers. Many systems use integers for UI
painting (pixels are ints after all), but macOS, for example, uses float for
everything. macOS only knows points and a point can translate to one pixel,
but depending on monitor resolution, it might translate to something else. On
retina screens half a point (0.5/0.5) is pixel. Still, I never noticed that
macOS UIs are significantly slower than other UIs. After all, 3D APIs (OpenGL
or Direct3D) also work with floats and modern graphics libraries very often
take advantage of GPU acceleration.</p>
<p>Now you said speed is your main concern, okay, let's go for speed. Before you
run any sophisticated algorithm, first do a simple test. Create an <em>axis
aligned bounding box</em> around your polygon. This is very easy, fast and can
already save you a lot of calculations. How does that work? Iterate over all
points of the polygon and find the min/max values of X and Y.</p>
<p>E.g. you have the points <code>(9/1), (4/3), (2/7), (8/2), (3/6)</code>. This means Xmin
is 2, Xmax is 9, Ymin is 1 and Ymax is 7. A point outside of the rectangle
with the two edges (2/1) and (9/7) cannot be within the polygon.</p>
<div class="code"><pre class="code literal-block"><span class="c1">// p is your point, p.x is the x coord, p.y is the y coord</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Xmin</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Xmax</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">Ymin</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Ymax</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Definitely not within the polygon!</span>
<span class="p">}</span>
</pre></div>

<p>This is the first test to run for any point. As you can see, this test is
ultra fast but it's also very coarse. To handle points that are within the
bounding rectangle, we need a more sophisticated algorithm. There are a couple
of ways how this can be calculated. Which method works also depends on whether
the polygon can have holes or will always be solid. Here are examples of solid
ones (one convex, one concave):</p>
<p><img alt="Polygon without hole" src="../../images/G76ta.jpg"></p>
<p>And here's one with a hole:</p>
<p><img alt="Polygon with hole" src="../../images/oDCCd.gif"></p>
<p>The green one has a hole in the middle!</p>
<p>The easiest algorithm, that can handle all three cases above and is still
pretty fast is named <strong>ray casting</strong>. The idea of the algorithm is pretty
simple: Draw a virtual ray from anywhere outside the polygon to your point and
count how often it hits a side of the polygon. If the number of hits is even,
it's outside of the polygon, if it's odd, it's inside.</p>
<p><img alt="Demonstrating how the ray cuts through a polygon" src="../../images/2EzSM.png"></p>
<p>The <strong>winding number algorithm</strong> would be an alternative, it is more accurate
for points being very close to a polygon line but it's also much slower. Ray
casting may fail for points too close to a polygon side because of limited
floating point precision and rounding issues, but in reality that is hardly a
problem, as if a point lies that close to a side, it's often visually not even
possible for a viewer to recognize if it is already inside or still outside.</p>
<p>You still have the bounding box of above, remember? Just pick a point outside
the bounding box and use it as starting point for your ray. E.g. the point
<code>(Xmin - e/p.y)</code> is outside the polygon for sure.</p>
<p>But what is <code>e</code>? Well, <code>e</code> (actually epsilon) gives the bounding box some
<em>padding</em>. As I said, ray tracing fails if we start too close to a polygon
line. Since the bounding box might equal the polygon (if the polygon is an
axis aligned rectangle, the bounding box is equal to the polygon itself!), we
need some padding to make this safe, that's all. How big should you choose
<code>e</code>? Not too big. It depends on the coordinate system scale you use for
drawing. If your pixel step width is 1.0, then just choose 1.0 (yet 0.1 would
have worked as well)</p>
<p>Now that we have the ray with its start and end coordinates, the problem
shifts from " <em>is the point within the polygon</em> " to " <em>how often does the ray
intersects a polygon side</em> ". Therefore we can't just work with the polygon
points as before, now we need the actual sides. A side is always defined by
two points.</p>
<div class="code"><pre class="code literal-block">side 1: (X1/Y1)-(X2/Y2)
side 2: (X2/Y2)-(X3/Y3)
side 3: (X3/Y3)-(X4/Y4)
:
</pre></div>

<p>You need to test the ray against all sides. Consider the ray to be a vector
and every side to be a vector. The ray has to hit each side exactly once or
never at all. It can't hit the same side twice. Two lines in 2D space will
always intersect exactly once, unless they are parallel, in which case they
never intersect. However since vectors have a limited length, two vectors
might not be parallel and still never intersect because they are too short to
ever meet each other.</p>
<div class="code"><pre class="code literal-block"><span class="c1">// Test the ray against all sides</span>
<span class="nb">int</span><span class="w"> </span><span class="n">intersections</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">side</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">numberOfSides</span><span class="p">;</span><span class="w"> </span><span class="n">side</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Test if current side intersects with ray.</span>
<span class="w">    </span><span class="c1">// If yes, intersections++;</span>
<span class="p">}</span>
<span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">intersections</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Inside of polygon</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Outside of polygon</span>
<span class="p">}</span>
</pre></div>

<p>So far so well, but how do you test if two vectors intersect? Here's some C
code (not tested), that should do the trick:</p>
<div class="code"><pre class="code literal-block"><span class="p">#</span><span class="nn">define</span><span class="w"> </span><span class="nt">NO</span><span class="w"> </span><span class="nt">0</span>
<span class="p">#</span><span class="nn">define</span><span class="w"> </span><span class="nt">YES</span><span class="w"> </span><span class="nt">1</span>
<span class="p">#</span><span class="nn">define</span><span class="w"> </span><span class="nt">COLLINEAR</span><span class="w"> </span><span class="nt">2</span>

<span class="nt">int</span><span class="w"> </span><span class="nt">areIntersecting</span><span class="o">(</span>
<span class="w">    </span><span class="nt">float</span><span class="w"> </span><span class="nt">v1x1</span><span class="o">,</span><span class="w"> </span><span class="nt">float</span><span class="w"> </span><span class="nt">v1y1</span><span class="o">,</span><span class="w"> </span><span class="nt">float</span><span class="w"> </span><span class="nt">v1x2</span><span class="o">,</span><span class="w"> </span><span class="nt">float</span><span class="w"> </span><span class="nt">v1y2</span><span class="o">,</span>
<span class="w">    </span><span class="nt">float</span><span class="w"> </span><span class="nt">v2x1</span><span class="o">,</span><span class="w"> </span><span class="nt">float</span><span class="w"> </span><span class="nt">v2y1</span><span class="o">,</span><span class="w"> </span><span class="nt">float</span><span class="w"> </span><span class="nt">v2x2</span><span class="o">,</span><span class="w"> </span><span class="nt">float</span><span class="w"> </span><span class="nt">v2y2</span>
<span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">float</span><span class="w"> </span><span class="err">d1,</span><span class="w"> </span><span class="err">d2</span><span class="p">;</span>
<span class="w">    </span><span class="err">float</span><span class="w"> </span><span class="err">a1,</span><span class="w"> </span><span class="err">a2,</span><span class="w"> </span><span class="err">b1,</span><span class="w"> </span><span class="err">b2,</span><span class="w"> </span><span class="err">c1,</span><span class="w"> </span><span class="err">c2</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">Convert</span><span class="w"> </span><span class="err">vector</span><span class="w"> </span><span class="err">1</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">(line</span><span class="w"> </span><span class="err">1)</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">infinite</span><span class="w"> </span><span class="err">length.</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">We</span><span class="w"> </span><span class="err">want</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">linear</span><span class="w"> </span><span class="err">equation</span><span class="w"> </span><span class="err">standard</span><span class="w"> </span><span class="n">form</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="o">*</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">See</span><span class="o">:</span><span class="w"> </span><span class="n">http</span><span class="o">://</span><span class="n">en</span><span class="o">.</span><span class="n">wikipedia</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">wiki</span><span class="o">/</span><span class="n">Linear_equation</span>
<span class="w">    </span><span class="n">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v1y2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v1y1</span><span class="p">;</span>
<span class="w">    </span><span class="err">b1</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">v1x1</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">v1x2</span><span class="p">;</span>
<span class="w">    </span><span class="err">c1</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">(v1x2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v1y1)</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">(v1x1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v1y2)</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">Every</span><span class="w"> </span><span class="err">point</span><span class="w"> </span><span class="err">(x,y),</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">solves</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">equation</span><span class="w"> </span><span class="err">above,</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">line,</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">every</span><span class="w"> </span><span class="err">point</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">does</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">solve</span><span class="w"> </span><span class="err">it,</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">not.</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">equation</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">a</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">positive</span><span class="w"> </span><span class="err">result</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">one</span><span class="w"> </span><span class="err">side</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">negative</span><span class="w"> </span><span class="err">one</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">side</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">it.</span><span class="w"> </span><span class="err">We</span><span class="w"> </span><span class="err">insert</span><span class="w"> </span><span class="err">(x1,y1)</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">(x2,y2)</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">vector</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">2</span><span class="w"> </span><span class="err">into</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">equation</span><span class="w"> </span><span class="err">above.</span>
<span class="w">    </span><span class="err">d1</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">(a1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v2x1)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">(b1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v2y1)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">c1</span><span class="p">;</span>
<span class="w">    </span><span class="err">d2</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">(a1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v2x2)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">(b1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v2y2)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">c1</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">d1</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">d2</span><span class="w"> </span><span class="err">both</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">same</span><span class="w"> </span><span class="err">sign,</span><span class="w"> </span><span class="err">they</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">both</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">same</span><span class="w"> </span><span class="err">side</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">our</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">1</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">case</span><span class="w"> </span><span class="err">no</span><span class="w"> </span><span class="err">intersection</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">possible.</span><span class="w"> </span><span class="err">Careful,</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">0</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">special</span><span class="w"> </span><span class="err">case,</span><span class="w"> </span><span class="err">that's</span><span class="w"> </span><span class="err">why</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">don't</span><span class="w"> </span><span class="err">test</span><span class="w"> </span><span class="err">"&gt;="</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">"&lt;=",</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">but</span><span class="w"> </span><span class="err">"&lt;"</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">"&gt;".</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(d1</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">0</span><span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span><span class="err">d2</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">0)</span><span class="w"> </span><span class="err">return</span><span class="w"> </span><span class="err">NO</span><span class="p">;</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(d1</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="err">0</span><span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span><span class="err">d2</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="err">0)</span><span class="w"> </span><span class="err">return</span><span class="w"> </span><span class="err">NO</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">fact</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">vector</span><span class="w"> </span><span class="err">2</span><span class="w"> </span><span class="err">intersected</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">infinite</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">1</span><span class="w"> </span><span class="err">above</span><span class="w"> </span><span class="err">doesn't</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">mean</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">also</span><span class="w"> </span><span class="err">intersects</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">vector</span><span class="w"> </span><span class="err">1.</span><span class="w"> </span><span class="err">Vector</span><span class="w"> </span><span class="err">1</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">only</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">subset</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">that</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">infinite</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">1,</span><span class="w"> </span><span class="err">so</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">may</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">intersected</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">before</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">vector</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">started</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">ended.</span><span class="w"> </span><span class="err">To</span><span class="w"> </span><span class="err">know</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">sure,</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">repeat</span><span class="w"> </span><span class="err">the</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">same</span><span class="w"> </span><span class="err">test</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">other</span><span class="w"> </span><span class="err">way</span><span class="w"> </span><span class="err">round.</span><span class="w"> </span><span class="err">We</span><span class="w"> </span><span class="err">start</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">calculating</span><span class="w"> </span><span class="err">the</span><span class="w"> </span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">infinite</span><span class="w"> </span><span class="err">line</span><span class="w"> </span><span class="err">2</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">linear</span><span class="w"> </span><span class="err">equation</span><span class="w"> </span><span class="err">standard</span><span class="w"> </span><span class="err">form.</span>
<span class="w">    </span><span class="err">a2</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">v2y2</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">v2y1</span><span class="p">;</span>
<span class="w">    </span><span class="err">b2</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">v2x1</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">v2x2</span><span class="p">;</span>
<span class="w">    </span><span class="err">c2</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">(v2x2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v2y1)</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">(v2x1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v2y2)</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">Calculate</span><span class="w"> </span><span class="err">d1</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">d2</span><span class="w"> </span><span class="err">again,</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">time</span><span class="w"> </span><span class="err">using</span><span class="w"> </span><span class="err">points</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">vector</span><span class="w"> </span><span class="err">1.</span>
<span class="w">    </span><span class="err">d1</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">(a2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v1x1)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">(b2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v1y1)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">c2</span><span class="p">;</span>
<span class="w">    </span><span class="err">d2</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">(a2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v1x2)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">(b2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">v1y2)</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="err">c2</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">Again,</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">both</span><span class="w"> </span><span class="err">have</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">same</span><span class="w"> </span><span class="err">sign</span><span class="w"> </span><span class="err">(and</span><span class="w"> </span><span class="err">neither</span><span class="w"> </span><span class="err">one</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">0),</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">no</span><span class="w"> </span><span class="err">intersection</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">possible.</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(d1</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">0</span><span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span><span class="err">d2</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">0)</span><span class="w"> </span><span class="err">return</span><span class="w"> </span><span class="err">NO</span><span class="p">;</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(d1</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="err">0</span><span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span><span class="err">d2</span><span class="w"> </span><span class="err">&lt;</span><span class="w"> </span><span class="err">0)</span><span class="w"> </span><span class="err">return</span><span class="w"> </span><span class="err">NO</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">we</span><span class="w"> </span><span class="err">get</span><span class="w"> </span><span class="err">here,</span><span class="w"> </span><span class="err">only</span><span class="w"> </span><span class="err">two</span><span class="w"> </span><span class="err">possibilities</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">left.</span><span class="w"> </span><span class="err">Either</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">two</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">vectors</span><span class="w"> </span><span class="err">intersect</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">exactly</span><span class="w"> </span><span class="err">one</span><span class="w"> </span><span class="err">point</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">they</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">collinear,</span><span class="w"> </span><span class="err">which</span>
<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">means</span><span class="w"> </span><span class="err">they</span><span class="w"> </span><span class="err">intersect</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">any</span><span class="w"> </span><span class="err">number</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">points</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">zero</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">infinite.</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">((a1</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">b2)</span><span class="w"> </span><span class="err">-</span><span class="w"> </span><span class="err">(a2</span><span class="w"> </span><span class="err">*</span><span class="w"> </span><span class="err">b1)</span><span class="w"> </span><span class="err">==</span><span class="w"> </span><span class="err">0.0f)</span><span class="w"> </span><span class="err">return</span><span class="w"> </span><span class="err">COLLINEAR</span><span class="p">;</span>

<span class="w">    </span><span class="err">//</span><span class="w"> </span><span class="err">If</span><span class="w"> </span><span class="err">they</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">collinear,</span><span class="w"> </span><span class="err">they</span><span class="w"> </span><span class="err">must</span><span class="w"> </span><span class="err">intersect</span><span class="w"> </span><span class="err">in</span><span class="w"> </span><span class="err">exactly</span><span class="w"> </span><span class="err">one</span><span class="w"> </span><span class="err">point.</span>
<span class="w">    </span><span class="err">return</span><span class="w"> </span><span class="err">YES</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>The input values are the <em>two endpoints</em> of vector 1 (<code>v1x1/v1y1</code> and
<code>v1x2/v1y2</code>) and vector 2 (<code>v2x1/v2y1</code> and <code>v2x2/v2y2</code>). So you have 2
vectors, 4 points, 8 coordinates. <code>YES</code> and <code>NO</code> are clear. <code>YES</code> increases
intersections, <code>NO</code> does nothing.</p>
<p>What about COLLINEAR? It means both vectors lie on the same infinite line,
depending on position and length, they don't intersect at all or they
intersect in an endless number of points. I'm not absolutely sure how to
handle this case, I would not count it as intersection either way. Well, this
case is rather rare in practice anyway because of floating point rounding
errors; better code would probably not test for <code>== 0.0f</code> but instead for
something like <code>&lt; epsilon</code>, where epsilon is a rather small number.</p>
<p>If you need to test a larger number of points, you can certainly speed up the
whole thing a bit by keeping the linear equation standard forms of the polygon
sides in memory, so you don't have to recalculate these every time. This will
save you two floating point multiplications and three floating point
subtractions on every test in exchange for storing three floating point values
per polygon side in memory. It's a typical memory vs computation time trade
off.</p>
<p>Last but not least: If you may use 3D hardware to solve the problem, there is
an interesting alternative. Just let the GPU do all the work for you. Create a
painting surface that is off screen. Fill it completely with the color black.
Now let OpenGL or Direct3D paint your polygon (or even all of your polygons if
you just want to test if the point is within any of them, but you don't care
for which one) and fill the polygon(s) with a different color, e.g. white. To
check if a point is within the polygon, get the color of this point from the
drawing surface. This is just a O(1) memory fetch.</p>
<p>Of course this method is only usable if your drawing surface doesn't have to
be huge. If it cannot fit into the GPU memory, this method is slower than
doing it on the CPU. If it would have to be huge and your GPU supports modern
shaders, you can still use the GPU by implementing the ray casting shown above
as a GPU shader, which absolutely is possible. For a larger number of polygons
or a large number of points to test, this will pay off, consider some GPUs
will be able to test 64 to 256 points in parallel. Note however that
transferring data from CPU to GPU and back is always expensive, so for just
testing a couple of points against a couple of simple polygons, where either
the points or the polygons are dynamic and will change frequently, a GPU
approach will rarely pay off.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I think the following piece of code is the best solution (taken from here):</p>
<div class="code"><pre class="code literal-block"><span class="nc">int</span><span class="w"> </span><span class="n">pnpoly</span><span class="p">(</span><span class="nc">int</span><span class="w"> </span><span class="n">nvert</span><span class="p">,</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">*</span><span class="n">vertx</span><span class="p">,</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">*</span><span class="n">verty</span><span class="p">,</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="n">testx</span><span class="p">,</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="n">testy</span><span class="p">)</span>
<span class="err">{</span>
<span class="w">  </span><span class="nc">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nvert</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nvert</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">((</span><span class="n">verty</span><span class="o">[</span><span class="n">i</span><span class="o">]&gt;</span><span class="n">testy</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">verty</span><span class="o">[</span><span class="n">j</span><span class="o">]&gt;</span><span class="n">testy</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">     </span><span class="p">(</span><span class="n">testx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">vertx</span><span class="o">[</span><span class="n">j</span><span class="o">]-</span><span class="n">vertx</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">testy</span><span class="o">-</span><span class="n">verty</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">verty</span><span class="o">[</span><span class="n">j</span><span class="o">]-</span><span class="n">verty</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vertx</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">       </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">!</span><span class="n">c</span><span class="p">;</span>
<span class="w">  </span><span class="err">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="err">}</span>
</pre></div>

<h4>Arguments</h4>
<ul>
<li>
<strong>nvert</strong> : Number of vertices in the polygon. Whether to repeat the first vertex at the end has been discussed in the article referred above.</li>
<li>
<strong>vertx, verty</strong> : Arrays containing the x- and y-coordinates of the polygon's vertices.</li>
<li>
<strong>testx, testy</strong> : X- and y-coordinate of the test point.</li>
</ul>
<p>It's both short and efficient and works both for convex and concave polygons.
As suggested before, you should check the bounding rectangle first and treat
polygon holes separately.</p>
<p>The idea behind this is pretty simple. The author describes it as follows:</p>
<blockquote>
<p>I run a semi-infinite ray horizontally (increasing x, fixed y) out from the
test point, and count how many edges it crosses. At each crossing, the ray
switches between inside and outside. This is called the Jordan curve
theorem.</p>
</blockquote>
<p>The variable c is switching from 0 to 1 and 1 to 0 each time the horizontal
ray crosses any edge. So basically it's keeping track of whether the number of
edges crossed are even or odd. 0 means even and 1 means odd.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/collision-detection/" rel="tag">collision-detection</a></li>
            <li><a class="tag p-category" href="../../categories/graphics/" rel="tag">graphics</a></li>
            <li><a class="tag p-category" href="../../categories/performance/" rel="tag">performance</a></li>
            <li><a class="tag p-category" href="../../categories/point-in-polygon/" rel="tag">point-in-polygon</a></li>
            <li><a class="tag p-category" href="../../categories/polygon/" rel="tag">polygon</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-to-make-an-android-device-vibrate-with-different-frequency/" rel="prev" title="How to make an Android device vibrate? with different frequency?">Previous post</a>
            </li>
            <li class="next">
                <a href="../display-back-arrow-on-toolbar/" rel="next" title="Display Back Arrow on Toolbar">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
