<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How can I upload files to a server using JSP/Servlet? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-can-i-upload-files-to-a-server-using-jsp-servlet/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../c-equivalent-of-sql-server-datatypes/" title="C# Equivalent of SQL Server DataTypes" type="text/html">
<link rel="next" href="../why-is-there-extra-padding-at-the-top-of-my-uitableview-with-style-uitableviewstylegrouped-in-ios7/" title="Why is there extra padding at the top of my UITableView with style UITableViewStyleGrouped in iOS7" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="How can I upload files to a server using JSP/Servlet?">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-can-i-upload-files-to-a-server-using-jsp-servlet/">
<meta property="og:description" content='How can I upload files to server using JSP/Servlet?
I tried this:
&lt;form action="upload" method="post"&gt;
    &lt;input type="text" name="description" /&gt;
    &lt;input type="file" name="file" /&gt;
    &lt;input typ'>
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T16:54:50+08:00">
<meta property="article:tag" content="file-upload">
<meta property="article:tag" content="jakarta-ee">
<meta property="article:tag" content="java">
<meta property="article:tag" content="jsp">
<meta property="article:tag" content="servlets">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How can I upload files to a server using JSP/Servlet?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T16:54:50+08:00" itemprop="datePublished" title="2023-02-17 16:54">2023-02-17 16:54</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>How can I upload files to server using JSP/Servlet?</p>
<p>I tried this:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">"upload"</span><span class="w"> </span><span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"text"</span><span class="w"> </span><span class="na">name=</span><span class="s">"description"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"file"</span><span class="w"> </span><span class="na">name=</span><span class="s">"file"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"submit"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>

<p>However, I only get the file name, not the file content. When I add
<code>enctype="multipart/form-data"</code> to the <code>&lt;form&gt;</code>, then <code>request.getParameter()</code>
returns <code>null</code>.</p>
<p>During research I stumbled upon Apache Common FileUpload. I tried this:</p>
<div class="code"><pre class="code literal-block"><span class="n">FileItemFactory</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">DiskFileItemFactory</span><span class="p">();</span>
<span class="n">ServletFileUpload</span><span class="w"> </span><span class="n">upload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ServletFileUpload</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<span class="n">List</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">upload</span><span class="o">.</span><span class="n">parseRequest</span><span class="p">(</span><span class="n">request</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">died</span><span class="o">.</span>
</pre></div>

<p>Unfortunately, the servlet threw an exception without a clear message and
cause. Here is the stacktrace:</p>
<div class="code"><pre class="code literal-block"><span class="n">SEVERE</span><span class="p">:</span><span class="w"> </span><span class="n">Servlet</span><span class="o">.</span><span class="n">service</span><span class="p">()</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">servlet</span><span class="w"> </span><span class="n">UploadServlet</span><span class="w"> </span><span class="n">threw</span><span class="w"> </span><span class="n">exception</span>
<span class="n">javax</span><span class="o">.</span><span class="n">servlet</span><span class="o">.</span><span class="n">ServletException</span><span class="p">:</span><span class="w"> </span><span class="n">Servlet</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">threw</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">exception</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">ApplicationFilterChain</span><span class="o">.</span><span class="n">internalDoFilter</span><span class="p">(</span><span class="n">ApplicationFilterChain</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">313</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">ApplicationFilterChain</span><span class="o">.</span><span class="n">doFilter</span><span class="p">(</span><span class="n">ApplicationFilterChain</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">206</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StandardWrapperValve</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">StandardWrapperValve</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">233</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StandardContextValve</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">StandardContextValve</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">191</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StandardHostValve</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">StandardHostValve</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">127</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">valves</span><span class="o">.</span><span class="n">ErrorReportValve</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">ErrorReportValve</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">102</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StandardEngineValve</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">StandardEngineValve</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">109</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">catalina</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">CoyoteAdapter</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="n">CoyoteAdapter</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">298</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">coyote</span><span class="o">.</span><span class="n">http11</span><span class="o">.</span><span class="n">Http11Processor</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">Http11Processor</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">852</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">coyote</span><span class="o">.</span><span class="n">http11</span><span class="o">.</span><span class="n">Http11Protocol</span><span class="o">$</span><span class="n">Http11ConnectionHandler</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">Http11Protocol</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">588</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">tomcat</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">JIoEndpoint</span><span class="o">$</span><span class="n">Worker</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">JIoEndpoint</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">489</span><span class="p">)</span>
<span class="w">    </span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Thread</span><span class="o">.</span><span class="n">java</span><span class="p">:</span><span class="mi">637</span><span class="p">)</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<h3>Introduction</h3>
<p>To browse and select a file for upload you need a HTML <code>&lt;input type="file"&gt;</code>
field in the form. As stated in the HTML specification you have to use the
<code>POST</code> method and the <code>enctype</code> attribute of the form has to be set to
<code>"multipart/form-data"</code>.</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">"upload"</span><span class="w"> </span><span class="na">method=</span><span class="s">"post"</span><span class="w"> </span><span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"text"</span><span class="w"> </span><span class="na">name=</span><span class="s">"description"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"file"</span><span class="w"> </span><span class="na">name=</span><span class="s">"file"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"submit"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>

<p>After submitting such a form, the binary multipart form data is available in
the request body in a different format than when the <code>enctype</code> isn't set.</p>
<p>Before Servlet 3.0 (Dec 2009), the Servlet API didn't natively support
<code>multipart/form-data</code>. It supports only the default form enctype of
<code>application/x-www-form-urlencoded</code>. The <code>request.getParameter()</code> and consorts
would all return <code>null</code> when using multipart form data. This is where the well
known Apache Commons FileUpload came into the picture.</p>
<h3>Don't manually parse it!</h3>
<p>You can in theory parse the request body yourself based on
<code>ServletRequest#getInputStream()</code>. However, this is a precise and tedious work
which requires precise knowledge of RFC2388. You shouldn't try to do this on
your own or copypaste some homegrown library-less code found elsewhere on the
Internet. Many online sources have failed hard in this, such as roseindia.net.
See also uploading of pdf file. You should rather use a real library which is
used (and implicitly tested!) by millions of users for years. Such a library
has proven its robustness.</p>
<h3>When you're already on Servlet 3.0 or newer, use native API</h3>
<p>If you're using at least Servlet 3.0 (Tomcat 7, Jetty 9, JBoss AS 6, GlassFish
3, etc, they exist already since 2010), then you can just use standard API
provided <code>HttpServletRequest#getPart()</code> to collect the individual multipart
form data items (most Servlet 3.0 implementations <em>actually</em> use Apache
Commons FileUpload under the covers for this!). Also, normal form fields are
available by <code>getParameter()</code> the usual way.</p>
<p>First annotate your servlet with <code>@MultipartConfig</code> in order to let it
recognize and support <code>multipart/form-data</code> requests and thus get <code>getPart()</code>
to work:</p>
<div class="code"><pre class="code literal-block"><span class="err">@</span><span class="n">WebServlet</span><span class="p">(</span><span class="s2">"/upload"</span><span class="p">)</span>
<span class="err">@</span><span class="n">MultipartConfig</span>
<span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">UploadServlet</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">HttpServlet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>
<span class="p">}</span>
</pre></div>

<p>Then, implement its <code>doPost()</code> as follows:</p>
<div class="code"><pre class="code literal-block"><span class="nv">protected</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">doPost</span><span class="ss">(</span><span class="nv">HttpServletRequest</span><span class="w"> </span><span class="nv">request</span>,<span class="w"> </span><span class="nv">HttpServletResponse</span><span class="w"> </span><span class="nv">response</span><span class="ss">)</span><span class="w"> </span><span class="nv">throws</span><span class="w"> </span><span class="nv">ServletException</span>,<span class="w"> </span><span class="nv">IOException</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">String</span><span class="w"> </span><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">request</span>.<span class="nv">getParameter</span><span class="ss">(</span><span class="s2">"description"</span><span class="ss">)</span><span class="c1">; // Retrieves &lt;input type="text" name="description"&gt;</span>
<span class="w">    </span><span class="nv">Part</span><span class="w"> </span><span class="nv">filePart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">request</span>.<span class="nv">getPart</span><span class="ss">(</span><span class="s2">"file"</span><span class="ss">)</span><span class="c1">; // Retrieves &lt;input type="file" name="file"&gt;</span>
<span class="w">    </span><span class="nv">String</span><span class="w"> </span><span class="nv">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Paths</span>.<span class="nv">get</span><span class="ss">(</span><span class="nv">filePart</span>.<span class="nv">getSubmittedFileName</span><span class="ss">())</span>.<span class="nv">getFileName</span><span class="ss">()</span>.<span class="nv">toString</span><span class="ss">()</span><span class="c1">; // MSIE fix.</span>
<span class="w">    </span><span class="nv">InputStream</span><span class="w"> </span><span class="nv">fileContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">filePart</span>.<span class="nv">getInputStream</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span>...<span class="w"> </span><span class="ss">(</span><span class="k">do</span><span class="w"> </span><span class="nv">your</span><span class="w"> </span><span class="nv">job</span><span class="w"> </span><span class="nv">here</span><span class="ss">)</span>
}
</pre></div>

<p>Note the <code>Path#getFileName()</code>. This is a MSIE fix as to obtaining the file
name. This browser incorrectly sends the full file path along the name instead
of only the file name.</p>
<p>In case you want to upload multiple files via either <code>multiple="true"</code>,</p>
<div class="code"><pre class="code literal-block">&lt;input type="file" name="files" multiple="true" /&gt;
</pre></div>

<p>or the old-fashioned way with multiple inputs,</p>
<div class="code"><pre class="code literal-block">&lt;input type="file" name="files" /&gt;
&lt;input type="file" name="files" /&gt;
&lt;input type="file" name="files" /&gt;
...
</pre></div>

<p>then you can collect them as below (unfortunately there is no such method as
<code>request.getParts("files")</code>):</p>
<div class="code"><pre class="code literal-block"><span class="n">protected</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Part</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fileParts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="n">getParts</span><span class="p">().</span><span class="n">stream</span><span class="p">().</span><span class="n">filter</span><span class="p">(</span><span class="n">part</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">"files"</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="n">part</span><span class="p">.</span><span class="n">getName</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">part</span><span class="p">.</span><span class="n">getSize</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="n">toList</span><span class="p">());</span><span class="w"> </span><span class="c1">// Retrieves &lt;input type="file" name="files" multiple="true"&gt;</span>

<span class="w">    </span><span class="n">for</span><span class="w"> </span><span class="p">(</span><span class="n">Part</span><span class="w"> </span><span class="n">filePart</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fileParts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">String</span><span class="w"> </span><span class="n">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Paths</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">filePart</span><span class="p">.</span><span class="n">getSubmittedFileName</span><span class="p">()).</span><span class="n">getFileName</span><span class="p">().</span><span class="n">toString</span><span class="p">();</span><span class="w"> </span><span class="c1">// MSIE fix.</span>
<span class="w">        </span><span class="n">InputStream</span><span class="w"> </span><span class="n">fileContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filePart</span><span class="p">.</span><span class="n">getInputStream</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// ... (do your job here)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3>When you're not on Servlet 3.1 yet, manually get submitted file name</h3>
<p>Note that <code>Part#getSubmittedFileName()</code> was introduced in Servlet 3.1 (Tomcat
8, Jetty 9, WildFly 8, GlassFish 4, etc, they exist since 2013 already). If
you're not on Servlet 3.1 yet (really?), then you need an additional utility
method to obtain the submitted file name.</p>
<div class="code"><pre class="code literal-block"><span class="nv">private</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">getSubmittedFileName</span><span class="ss">(</span><span class="nv">Part</span><span class="w"> </span><span class="nv">part</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">String</span><span class="w"> </span><span class="nv">cd</span><span class="w"> </span>:<span class="w"> </span><span class="nv">part</span>.<span class="nv">getHeader</span><span class="ss">(</span><span class="s2">"content-disposition"</span><span class="ss">)</span>.<span class="nv">split</span><span class="ss">(</span><span class="s2">";"</span><span class="ss">))</span><span class="w"> </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">cd</span>.<span class="nv">trim</span><span class="ss">()</span>.<span class="nv">startsWith</span><span class="ss">(</span><span class="s2">"filename"</span><span class="ss">))</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">String</span><span class="w"> </span><span class="nv">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cd</span>.<span class="nv">substring</span><span class="ss">(</span><span class="nv">cd</span>.<span class="nv">indexOf</span><span class="ss">(</span><span class="s1">'='</span><span class="ss">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span>.<span class="nv">trim</span><span class="ss">()</span>.<span class="nv">replace</span><span class="ss">(</span><span class="s2">"\"", "</span><span class="err">");</span>
<span class="err">            return fileName.substring(fileName.lastIndexOf('/') + 1).substring(fileName.lastIndexOf('\\') + 1); // MSIE fix.</span>
<span class="err">        }</span>
<span class="err">    }</span>
<span class="err">    return null;</span>
<span class="err">}</span>



<span class="err">String fileName = getSubmittedFileName(filePart);</span>
</pre></div>

<p>Note the MSIE fix as to obtaining the file name. This browser incorrectly
sends the full file path along the name instead of only the file name.</p>
<h3>When you're not on Servlet 3.0 yet, use Apache Commons FileUpload</h3>
<p>If you're not on Servlet 3.0 yet (isn't it about time to upgrade? it's
released over a decade ago!), the common practice is to make use of Apache
Commons FileUpload to parse the multpart form data requests. It has an
excellent User Guide and FAQ (carefully go through both). There's also the
O'Reilly ("cos") <code>MultipartRequest</code>, but it has some (minor) bugs and isn't
actively maintained anymore for years. I wouldn't recommend using it. Apache
Commons FileUpload is still actively maintained and currently very mature.</p>
<p>In order to use Apache Commons FileUpload, you need to have at least the
following files in your webapp's <code>/WEB-INF/lib</code>:</p>
<ul>
<li><code>commons-fileupload.jar</code></li>
<li><code>commons-io.jar</code></li>
</ul>
<p>Your initial attempt failed most likely because you forgot the commons IO.</p>
<p>Here's a kickoff example how the <code>doPost()</code> of your <code>UploadServlet</code> may look
like when using Apache Commons FileUpload:</p>
<div class="code"><pre class="code literal-block"><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">FileItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ServletFileUpload</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">DiskFileItemFactory</span><span class="p">())</span><span class="o">.</span><span class="n">parseRequest</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">FileItem</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">isFormField</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">Process</span><span class="w"> </span><span class="n">regular</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"text|radio|checkbox|etc"</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="p">)</span><span class="o">.</span>
<span class="w">                </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">fieldName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">getFieldName</span><span class="p">();</span>
<span class="w">                </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">fieldValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">getString</span><span class="p">();</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">(</span><span class="n">do</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">job</span><span class="w"> </span><span class="n">here</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">Process</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"file"</span><span class="p">)</span><span class="o">.</span>
<span class="w">                </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">fieldName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">getFieldName</span><span class="p">();</span>
<span class="w">                </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">fileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FilenameUtils</span><span class="o">.</span><span class="n">getName</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">getName</span><span class="p">());</span>
<span class="w">                </span><span class="n">InputStream</span><span class="w"> </span><span class="n">fileContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">();</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="p">(</span><span class="n">do</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">job</span><span class="w"> </span><span class="n">here</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileUploadException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ServletException</span><span class="p">(</span><span class="s2">"Cannot parse multipart request."</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="o">...</span>
<span class="p">}</span>
</pre></div>

<p>It's very important that you don't call <code>getParameter()</code>, <code>getParameterMap()</code>,
<code>getParameterValues()</code>, <code>getInputStream()</code>, <code>getReader()</code>, etc on the same
request beforehand. Otherwise the servlet container will read and parse the
request body and thus Apache Commons FileUpload will get an empty request
body. See also a.o. ServletFileUpload#parseRequest(request) returns an empty
list.</p>
<p>Note the <code>FilenameUtils#getName()</code>. This is a MSIE fix as to obtaining the
file name. This browser incorrectly sends the full file path along the name
instead of only the file name.</p>
<p>Alternatively you can also wrap this all in a <code>Filter</code> which parses it all
automagically and put the stuff back in the parametermap of the request so
that you can continue using <code>request.getParameter()</code> the usual way and
retrieve the uploaded file by <code>request.getAttribute()</code>. You can find an
example in this blog article.</p>
<h3>Workaround for GlassFish3 bug of <code>getParameter()</code> still returning <code>null</code>
</h3>
<p>Note that Glassfish versions older than 3.1.2 had a bug wherein the
<code>getParameter()</code> still returns <code>null</code>. If you are targeting such a container
and can't upgrade it, then you need to extract the value from <code>getPart()</code> with
help of this utility method:</p>
<div class="code"><pre class="code literal-block"><span class="nv">private</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="nv">getValue</span><span class="ss">(</span><span class="nv">Part</span><span class="w"> </span><span class="nv">part</span><span class="ss">)</span><span class="w"> </span><span class="nv">throws</span><span class="w"> </span><span class="nv">IOException</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">BufferedReader</span><span class="w"> </span><span class="nv">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">BufferedReader</span><span class="ss">(</span><span class="nv">new</span><span class="w"> </span><span class="nv">InputStreamReader</span><span class="ss">(</span><span class="nv">part</span>.<span class="nv">getInputStream</span><span class="ss">()</span>,<span class="w"> </span><span class="s2">"UTF-8"</span><span class="ss">))</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">StringBuilder</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">StringBuilder</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">char</span>[]<span class="w"> </span><span class="nv">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">char</span>[<span class="mi">1024</span>]<span class="c1">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">int</span><span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="c1">; (length = reader.read(buffer)) &gt; 0;) {</span>
<span class="w">        </span><span class="nv">value</span>.<span class="nv">append</span><span class="ss">(</span><span class="nv">buffer</span>,<span class="w"> </span><span class="mi">0</span>,<span class="w"> </span><span class="nv">length</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">value</span>.<span class="nv">toString</span><span class="ss">()</span><span class="c1">;</span>
}



<span class="nv">String</span><span class="w"> </span><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">getValue</span><span class="ss">(</span><span class="nv">request</span>.<span class="nv">getPart</span><span class="ss">(</span><span class="s2">"description"</span><span class="ss">))</span><span class="c1">; // Retrieves &lt;input type="text" name="description"&gt;</span>
</pre></div>

<h3>Saving uploaded file (don't use <code>getRealPath()</code> nor <code>part.write()</code>!)</h3>
<p>Head to the following answers for detail on properly saving the obtained
<code>InputStream</code> (the <code>fileContent</code> variable as shown in the above code snippets)
to disk or database:</p>
<ul>
<li>Recommended way to save uploaded files in a servlet application</li>
<li>How to upload an image and save it in database?</li>
<li>How to convert Part to Blob, so I can store it in MySQL?</li>
</ul>
<h3>Serving uploaded file</h3>
<p>Head to the following answers for detail on properly serving the saved file
from disk or database back to the client:</p>
<ul>
<li>Load images from outside of webapps / webcontext / deploy folder using <graphicimage> or <img> tag</graphicimage>
</li>
<li>How to retrieve and display images from a database in a JSP page?</li>
<li>Simplest way to serve static data from outside the application server in a Java web application</li>
<li>Abstract template for static resource servlet supporting HTTP caching</li>
</ul>
<h3>Ajaxifying the form</h3>
<p>Head to the following answers how to upload using Ajax (and jQuery). Do note
that the servlet code to collect the form data does not need to be changed for
this! Only the way how you respond may be changed, but this is rather trivial
(i.e. instead of forwarding to JSP, just print some JSON or XML or even plain
text depending on whatever the script responsible for the Ajax call is
expecting).</p>
<ul>
<li>How can I upload files to a server using JSP/Servlet and Ajax?</li>
<li>Send a file as multipart through XMLHttpRequest</li>
<li>HTML5 drag and drop file upload to Java Servlet</li>
</ul>
<hr>
<p>Hope this all helps :)</p>
<p><br></p>
<h3>Suggest</h3>
<p>If you happen to use Spring MVC, this is how to (I'm leaving this here in case
someone find it useful):</p>
<p>Use a form with <code>enctype</code> attribute set to "<code>multipart/form-data</code>" (the same
as BalusC's answer):</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">"upload"</span><span class="w"> </span><span class="na">method=</span><span class="s">"post"</span><span class="w"> </span><span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"file"</span><span class="w"> </span><span class="na">name=</span><span class="s">"file"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">"submit"</span><span class="w"> </span><span class="na">value=</span><span class="s">"Upload"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>

<p>In your controller, map the request parameter <code>file</code> to <code>MultipartFile</code> type
as follows:</p>
<div class="code"><pre class="code literal-block"><span class="err">@</span><span class="n">RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"/upload"</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RequestMethod</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
<span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">handleUpload</span><span class="p">(</span><span class="err">@</span><span class="n">RequestParam</span><span class="p">(</span><span class="s2">"file"</span><span class="p">)</span><span class="w"> </span><span class="n">MultipartFile</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="o">.</span><span class="n">getBytes</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">alternatively</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">();</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="n">logic</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>You can get the filename and size using <code>MultipartFile</code>'s
<code>getOriginalFilename()</code> and <code>getSize()</code>.</p>
<p>I've tested this with Spring version <code>4.1.1.RELEASE</code>.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/file-upload/" rel="tag">file-upload</a></li>
            <li><a class="tag p-category" href="../../categories/jakarta-ee/" rel="tag">jakarta-ee</a></li>
            <li><a class="tag p-category" href="../../categories/java/" rel="tag">java</a></li>
            <li><a class="tag p-category" href="../../categories/jsp/" rel="tag">jsp</a></li>
            <li><a class="tag p-category" href="../../categories/servlets/" rel="tag">servlets</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../c-equivalent-of-sql-server-datatypes/" rel="prev" title="C# Equivalent of SQL Server DataTypes">Previous post</a>
            </li>
            <li class="next">
                <a href="../why-is-there-extra-padding-at-the-top-of-my-uitableview-with-style-uitableviewstylegrouped-in-ios7/" rel="next" title="Why is there extra padding at the top of my UITableView with style UITableViewStyleGrouped in iOS7">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
