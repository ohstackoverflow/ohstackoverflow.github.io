<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fragment MyFragment not attached to Activity | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/fragment-myfragment-not-attached-to-activity/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-can-i-inspect-the-file-system-of-a-failed-docker-build/" title="How can I inspect the file system of a failed `docker build`?" type="text/html">
<link rel="next" href="../using-openssl-what-does-unable-to-write-random-state-mean/" title="Using OpenSSL what does &quot;unable to write 'random state'&quot; mean?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Fragment MyFragment not attached to Activity">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/fragment-myfragment-not-attached-to-activity/">
<meta property="og:description" content="I've created a small test app which represents my problem. I'm using
ActionBarSherlock to implement tabs with (Sherlock)Fragments.
My code: TestActivity.java
public class TestActivity extends Sherlock">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T14:58:34+08:00">
<meta property="article:tag" content="actionbarsherlock">
<meta property="article:tag" content="android">
<meta property="article:tag" content="android-fragments">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Fragment MyFragment not attached to Activity</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T14:58:34+08:00" itemprop="datePublished" title="2023-03-03 14:58">2023-03-03 14:58</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I've created a small test app which represents my problem. I'm using
ActionBarSherlock to implement tabs with (Sherlock)Fragments.</p>
<p>My code: <code>TestActivity.java</code></p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">TestActivity</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">SherlockFragmentActivity</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">ActionBar</span><span class="w"> </span><span class="n">actionBar</span><span class="p">;</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">        </span><span class="n">setupTabs</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">setupTabs</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">actionBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSupportActionBar</span><span class="p">();</span>
<span class="w">        </span><span class="n">actionBar</span><span class="o">.</span><span class="n">setNavigationMode</span><span class="p">(</span><span class="n">ActionBar</span><span class="o">.</span><span class="n">NAVIGATION_MODE_TABS</span><span class="p">);</span>

<span class="w">        </span><span class="n">addTab1</span><span class="p">();</span>
<span class="w">        </span><span class="n">addTab2</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">addTab1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Tab</span><span class="w"> </span><span class="n">tab1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actionBar</span><span class="o">.</span><span class="n">newTab</span><span class="p">();</span>
<span class="w">        </span><span class="n">tab1</span><span class="o">.</span><span class="n">setTag</span><span class="p">(</span><span class="s2">"1"</span><span class="p">);</span>
<span class="w">        </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">tabText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"1"</span><span class="p">;</span>
<span class="w">        </span><span class="n">tab1</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tabText</span><span class="p">);</span>
<span class="w">        </span><span class="n">tab1</span><span class="o">.</span><span class="n">setTabListener</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">TabListener</span><span class="o">&lt;</span><span class="n">MyFragment</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TestActivity</span><span class="o">.</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="n">MyFragment</span><span class="o">.</span><span class="k">class</span><span class="p">));</span>

<span class="w">        </span><span class="n">actionBar</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">tab1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">addTab2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Tab</span><span class="w"> </span><span class="n">tab1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">actionBar</span><span class="o">.</span><span class="n">newTab</span><span class="p">();</span>
<span class="w">        </span><span class="n">tab1</span><span class="o">.</span><span class="n">setTag</span><span class="p">(</span><span class="s2">"2"</span><span class="p">);</span>
<span class="w">        </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">tabText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2"</span><span class="p">;</span>
<span class="w">        </span><span class="n">tab1</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">tabText</span><span class="p">);</span>
<span class="w">        </span><span class="n">tab1</span><span class="o">.</span><span class="n">setTabListener</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">TabListener</span><span class="o">&lt;</span><span class="n">MyFragment</span><span class="o">&gt;</span><span class="p">(</span><span class="n">TestActivity</span><span class="o">.</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="s2">"2"</span><span class="p">,</span><span class="w"> </span><span class="n">MyFragment</span><span class="o">.</span><span class="k">class</span><span class="p">));</span>

<span class="w">        </span><span class="n">actionBar</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">tab1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><code>TabListener.java</code></p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">TabListener</span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">SherlockFragment</span><span class="o">&gt;</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="n">com</span><span class="o">.</span><span class="n">actionbarsherlock</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">ActionBar</span><span class="o">.</span><span class="n">TabListener</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">SherlockFragmentActivity</span><span class="w"> </span><span class="n">mActivity</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">mTag</span><span class="p">;</span>
<span class="w">    </span><span class="n">private</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mClass</span><span class="p">;</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">TabListener</span><span class="p">(</span><span class="n">SherlockFragmentActivity</span><span class="w"> </span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="n">tag</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">clz</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mActivity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">activity</span><span class="p">;</span>
<span class="w">        </span><span class="n">mTag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tag</span><span class="p">;</span>
<span class="w">        </span><span class="n">mClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clz</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">/*</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ActionBar</span><span class="o">.</span><span class="n">TabListener</span><span class="w"> </span><span class="n">callbacks</span><span class="w"> </span><span class="o">*/</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onTabSelected</span><span class="p">(</span><span class="n">Tab</span><span class="w"> </span><span class="n">tab</span><span class="p">,</span><span class="w"> </span><span class="n">FragmentTransaction</span><span class="w"> </span><span class="n">ft</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SherlockFragment</span><span class="w"> </span><span class="n">preInitializedFragment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SherlockFragment</span><span class="p">)</span><span class="w"> </span><span class="n">mActivity</span><span class="o">.</span><span class="n">getSupportFragmentManager</span><span class="p">()</span><span class="o">.</span><span class="n">findFragmentByTag</span><span class="p">(</span><span class="n">mTag</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fragment</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">initialized</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">preInitializedFragment</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="ow">not</span><span class="p">,</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">activity</span>
<span class="w">            </span><span class="n">SherlockFragment</span><span class="w"> </span><span class="n">mFragment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SherlockFragment</span><span class="p">)</span><span class="w"> </span><span class="n">SherlockFragment</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span><span class="n">mActivity</span><span class="p">,</span><span class="w"> </span><span class="n">mClass</span><span class="o">.</span><span class="n">getName</span><span class="p">());</span>
<span class="w">            </span><span class="n">ft</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">android</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">mFragment</span><span class="p">,</span><span class="w"> </span><span class="n">mTag</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ft</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">preInitializedFragment</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onTabUnselected</span><span class="p">(</span><span class="n">Tab</span><span class="w"> </span><span class="n">tab</span><span class="p">,</span><span class="w"> </span><span class="n">FragmentTransaction</span><span class="w"> </span><span class="n">ft</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SherlockFragment</span><span class="w"> </span><span class="n">preInitializedFragment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">SherlockFragment</span><span class="p">)</span><span class="w"> </span><span class="n">mActivity</span><span class="o">.</span><span class="n">getSupportFragmentManager</span><span class="p">()</span><span class="o">.</span><span class="n">findFragmentByTag</span><span class="p">(</span><span class="n">mTag</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">preInitializedFragment</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">Detach</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fragment</span><span class="p">,</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">attached</span>
<span class="w">            </span><span class="n">ft</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">preInitializedFragment</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onTabReselected</span><span class="p">(</span><span class="n">Tab</span><span class="w"> </span><span class="n">tab</span><span class="p">,</span><span class="w"> </span><span class="n">FragmentTransaction</span><span class="w"> </span><span class="n">ft</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">selected</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">selected</span><span class="w"> </span><span class="n">tab</span><span class="o">.</span><span class="w"> </span><span class="n">Usually</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">nothing</span><span class="o">.</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><code>MyFragment.java</code></p>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">MyFragment</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">SherlockFragment</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="err">@</span><span class="n">Override</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">super</span><span class="o">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>

<span class="w">        </span><span class="n">new</span><span class="w"> </span><span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="p">,</span><span class="w"> </span><span class="n">Void</span><span class="p">,</span><span class="w"> </span><span class="n">Void</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="err">@</span><span class="n">Override</span>
<span class="w">            </span><span class="n">protected</span><span class="w"> </span><span class="n">Void</span><span class="w"> </span><span class="n">doInBackground</span><span class="p">(</span><span class="n">Void</span><span class="o">...</span><span class="w"> </span><span class="n">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="err">@</span><span class="n">Override</span>
<span class="w">            </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">onPostExecute</span><span class="p">(</span><span class="n">Void</span><span class="w"> </span><span class="n">result</span><span class="p">){</span>
<span class="w">                </span><span class="n">getResources</span><span class="p">()</span><span class="o">.</span><span class="n">getString</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">app_name</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span><span class="o">.</span><span class="n">execute</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>I've added the <code>Thread.sleep</code> part to simulate downloading data. The code in
the <code>onPostExecute</code> is to simulate use of the <code>Fragment</code>.</p>
<p>When I rotate the screen very fast between landscape and portrait, I get an
Exception at the <code>onPostExecute</code> code:</p>
<blockquote>
<p>java.lang.IllegalStateException: Fragment MyFragment{410f6060} not attached
to Activity</p>
</blockquote>
<p>I think it's because a new <code>MyFragment</code> has been created in the meantime, and
was attached to the Activity before the <code>AsyncTask</code> finished. The code in
<code>onPostExecute</code> calls upon a unattached <code>MyFragment</code>.</p>
<p>But how can I fix this?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I've found the very simple answer: <code>isAdded()</code>:</p>
<blockquote>
<p>Return <code>true</code> if the fragment is currently added to its activity.</p>
</blockquote>
<div class="code"><pre class="code literal-block"><span class="nv">@Override</span>
<span class="n">protected</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">onPostExecute</span><span class="p">(</span><span class="n">Void</span><span class="w"> </span><span class="k">result</span><span class="p">)</span><span class="err">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">isAdded</span><span class="p">())</span><span class="err">{</span>
<span class="w">        </span><span class="n">getResources</span><span class="p">().</span><span class="n">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="nf">app_name</span><span class="p">);</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<p>To avoid <code>onPostExecute</code> from being called when the <code>Fragment</code> is not attached
to the <code>Activity</code> is to cancel the <code>AsyncTask</code> when pausing or stopping the
<code>Fragment</code>. Then <code>isAdded()</code> would not be necessary anymore. However, it is
advisable to keep this check in place.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The problem is that you are trying to access resources (in this case, strings)
using getResources().getString(), which will try to get the resources from the
Activity. See this source code of the Fragment class:</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span>/**
<span class="w">  </span>*<span class="w"> </span>Return<span class="w"> </span><span class="nt">&lt;code&gt;</span>getActivity().getResources()<span class="nt">&lt;/code&gt;</span>.
<span class="w">  </span>*/
<span class="w"> </span>final<span class="w"> </span>public<span class="w"> </span>Resources<span class="w"> </span>getResources()<span class="w"> </span>{
<span class="w">     </span>if<span class="w"> </span>(mHost<span class="w"> </span>==<span class="w"> </span>null)<span class="w"> </span>{
<span class="w">         </span>throw<span class="w"> </span>new<span class="w"> </span>IllegalStateException("Fragment<span class="w"> </span>"<span class="w"> </span>+<span class="w"> </span>this<span class="w"> </span>+<span class="w"> </span>"<span class="w"> </span>not<span class="w"> </span>attached<span class="w"> </span>to<span class="w"> </span>Activity");
<span class="w">     </span>}
<span class="w">     </span>return<span class="w"> </span>mHost.getContext().getResources();
<span class="w"> </span>}
</pre></div>

<p><code>mHost</code> is the object that holds your Activity.</p>
<p>Because the Activity might not be attached, your getResources() call will
throw an Exception.</p>
<p>The accepted solution IMHO is not the way to go as you are just hiding the
problem. The correct way is just to get the resources from somewhere else that
is always guaranteed to exist, like the application context:</p>
<div class="code"><pre class="code literal-block">youApplicationObject.getResources().getString(...)
</pre></div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/actionbarsherlock/" rel="tag">actionbarsherlock</a></li>
            <li><a class="tag p-category" href="../../categories/android/" rel="tag">android</a></li>
            <li><a class="tag p-category" href="../../categories/android-fragments/" rel="tag">android-fragments</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-can-i-inspect-the-file-system-of-a-failed-docker-build/" rel="prev" title="How can I inspect the file system of a failed `docker build`?">Previous post</a>
            </li>
            <li class="next">
                <a href="../using-openssl-what-does-unable-to-write-random-state-mean/" rel="next" title="Using OpenSSL what does &quot;unable to write 'random state'&quot; mean?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
