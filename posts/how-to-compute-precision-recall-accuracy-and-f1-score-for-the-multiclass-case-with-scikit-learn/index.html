<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How to compute precision, recall, accuracy and f1-score for the multiclass case with scikit learn? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-to-compute-precision-recall-accuracy-and-f1-score-for-the-multiclass-case-with-scikit-learn/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../what-is-the-difference-between-q-learning-and-sarsa/" title="What is the difference between Q-learning and SARSA?" type="text/html">
<link rel="next" href="../is-it-possible-for-a-computer-to-learn-a-regular-expression-by-user-provided-examples/" title='Is it possible for a computer to "learn" a regular expression by user-provided examples?' type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="How to compute precision, recall, accuracy and f1-score for the multic">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-to-compute-precision-recall-accuracy-and-f1-score-for-the-multiclass-case-with-scikit-learn/">
<meta property="og:description" content="I'm working in a sentiment analysis problem the data looks like this:
label instances
    5    1190
    4     838
    3     239
    1     204
    2     127


So my data is unbalanced since 1190 instan">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-28T02:23:55+08:00">
<meta property="article:tag" content="artificial-intelligence">
<meta property="article:tag" content="machine-learning">
<meta property="article:tag" content="nlp">
<meta property="article:tag" content="python">
<meta property="article:tag" content="scikit-learn">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How to compute precision, recall, accuracy and f1-score for the multiclass case with scikit learn?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-28T02:23:55+08:00" itemprop="datePublished" title="2023-02-28 02:23">2023-02-28 02:23</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I'm working in a sentiment analysis problem the data looks like this:</p>
<div class="code"><pre class="code literal-block">label instances
    5    1190
    4     838
    3     239
    1     204
    2     127
</pre></div>

<p>So my data is unbalanced since 1190 <code>instances</code> are labeled with <code>5</code>. For the
classification Im using scikit's SVC. The problem is I do not know how to
balance my data in the right way in order to compute accurately the precision,
recall, accuracy and f1-score for the multiclass case. So I tried the
following approaches:</p>
<p>First:</p>
<div class="code"><pre class="code literal-block">    wclf = SVC(kernel='linear', C= 1, class_weight={1: 10})
    wclf.fit(X, y)
    weighted_prediction = wclf.predict(X_test)

print 'Accuracy:', accuracy_score(y_test, weighted_prediction)
print 'F1 score:', f1_score(y_test, weighted_prediction,average='weighted')
print 'Recall:', recall_score(y_test, weighted_prediction,
                              average='weighted')
print 'Precision:', precision_score(y_test, weighted_prediction,
                                    average='weighted')
print '\n clasification report:\n', classification_report(y_test, weighted_prediction)
print '\n confussion matrix:\n',confusion_matrix(y_test, weighted_prediction)
</pre></div>

<p>Second:</p>
<div class="code"><pre class="code literal-block">auto_wclf = SVC(kernel='linear', C= 1, class_weight='auto')
auto_wclf.fit(X, y)
auto_weighted_prediction = auto_wclf.predict(X_test)

print 'Accuracy:', accuracy_score(y_test, auto_weighted_prediction)

print 'F1 score:', f1_score(y_test, auto_weighted_prediction,
                            average='weighted')

print 'Recall:', recall_score(y_test, auto_weighted_prediction,
                              average='weighted')

print 'Precision:', precision_score(y_test, auto_weighted_prediction,
                                    average='weighted')

print '\n clasification report:\n', classification_report(y_test,auto_weighted_prediction)

print '\n confussion matrix:\n',confusion_matrix(y_test, auto_weighted_prediction)
</pre></div>

<p>Third:</p>
<div class="code"><pre class="code literal-block"><span class="n">clf</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">'linear'</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>


<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_score</span><span class="p">,</span> \
    <span class="n">recall_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">,</span> \
    <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">f1_score</span>

<span class="nb">print</span> <span class="s1">'Accuracy:'</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">'F1 score:'</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">'Recall:'</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">'Precision:'</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">'</span><span class="se">\n</span><span class="s1"> clasification report:</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">prediction</span><span class="p">)</span>
<span class="nb">print</span> <span class="s1">'</span><span class="se">\n</span><span class="s1"> confussion matrix:</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>


<span class="n">F1</span> <span class="n">score</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">classification</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">676</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">default</span> <span class="err">`</span><span class="n">weighted</span><span class="err">`</span> <span class="n">averaging</span> <span class="ow">is</span> <span class="n">deprecated</span><span class="p">,</span> <span class="ow">and</span> <span class="kn">from</span> <span class="nn">version</span> <span class="mf">0.18</span><span class="p">,</span> <span class="n">use</span> <span class="n">of</span> <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span> <span class="ow">or</span> <span class="n">F</span><span class="o">-</span><span class="n">score</span> <span class="k">with</span> <span class="n">multiclass</span> <span class="ow">or</span> <span class="n">multilabel</span> <span class="n">data</span> <span class="ow">or</span> <span class="n">pos_label</span><span class="o">=</span><span class="kc">None</span> <span class="n">will</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">an</span> <span class="n">exception</span><span class="o">.</span> <span class="n">Please</span> <span class="nb">set</span> <span class="n">an</span> <span class="n">explicit</span> <span class="n">value</span> <span class="k">for</span> <span class="err">`</span><span class="n">average</span><span class="err">`</span><span class="p">,</span> <span class="n">one</span> <span class="n">of</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">'micro'</span><span class="p">,</span> <span class="s1">'macro'</span><span class="p">,</span> <span class="s1">'weighted'</span><span class="p">,</span> <span class="s1">'samples'</span><span class="p">)</span><span class="o">.</span> <span class="n">In</span> <span class="n">cross</span> <span class="n">validation</span> <span class="n">use</span><span class="p">,</span> <span class="k">for</span> <span class="n">instance</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">"f1_weighted"</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">"f1"</span><span class="o">.</span>
  <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">)</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">classification</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1172</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">default</span> <span class="err">`</span><span class="n">weighted</span><span class="err">`</span> <span class="n">averaging</span> <span class="ow">is</span> <span class="n">deprecated</span><span class="p">,</span> <span class="ow">and</span> <span class="kn">from</span> <span class="nn">version</span> <span class="mf">0.18</span><span class="p">,</span> <span class="n">use</span> <span class="n">of</span> <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span> <span class="ow">or</span> <span class="n">F</span><span class="o">-</span><span class="n">score</span> <span class="k">with</span> <span class="n">multiclass</span> <span class="ow">or</span> <span class="n">multilabel</span> <span class="n">data</span> <span class="ow">or</span> <span class="n">pos_label</span><span class="o">=</span><span class="kc">None</span> <span class="n">will</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">an</span> <span class="n">exception</span><span class="o">.</span> <span class="n">Please</span> <span class="nb">set</span> <span class="n">an</span> <span class="n">explicit</span> <span class="n">value</span> <span class="k">for</span> <span class="err">`</span><span class="n">average</span><span class="err">`</span><span class="p">,</span> <span class="n">one</span> <span class="n">of</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">'micro'</span><span class="p">,</span> <span class="s1">'macro'</span><span class="p">,</span> <span class="s1">'weighted'</span><span class="p">,</span> <span class="s1">'samples'</span><span class="p">)</span><span class="o">.</span> <span class="n">In</span> <span class="n">cross</span> <span class="n">validation</span> <span class="n">use</span><span class="p">,</span> <span class="k">for</span> <span class="n">instance</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">"f1_weighted"</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">"f1"</span><span class="o">.</span>
  <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">)</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">classification</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1082</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">default</span> <span class="err">`</span><span class="n">weighted</span><span class="err">`</span> <span class="n">averaging</span> <span class="ow">is</span> <span class="n">deprecated</span><span class="p">,</span> <span class="ow">and</span> <span class="kn">from</span> <span class="nn">version</span> <span class="mf">0.18</span><span class="p">,</span> <span class="n">use</span> <span class="n">of</span> <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span> <span class="ow">or</span> <span class="n">F</span><span class="o">-</span><span class="n">score</span> <span class="k">with</span> <span class="n">multiclass</span> <span class="ow">or</span> <span class="n">multilabel</span> <span class="n">data</span> <span class="ow">or</span> <span class="n">pos_label</span><span class="o">=</span><span class="kc">None</span> <span class="n">will</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">an</span> <span class="n">exception</span><span class="o">.</span> <span class="n">Please</span> <span class="nb">set</span> <span class="n">an</span> <span class="n">explicit</span> <span class="n">value</span> <span class="k">for</span> <span class="err">`</span><span class="n">average</span><span class="err">`</span><span class="p">,</span> <span class="n">one</span> <span class="n">of</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">'micro'</span><span class="p">,</span> <span class="s1">'macro'</span><span class="p">,</span> <span class="s1">'weighted'</span><span class="p">,</span> <span class="s1">'samples'</span><span class="p">)</span><span class="o">.</span> <span class="n">In</span> <span class="n">cross</span> <span class="n">validation</span> <span class="n">use</span><span class="p">,</span> <span class="k">for</span> <span class="n">instance</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">"f1_weighted"</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">"f1"</span><span class="o">.</span>
  <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">)</span>
 <span class="mf">0.930416613529</span>
</pre></div>

<p>However, Im getting warnings like this:</p>
<div class="code"><pre class="code literal-block"><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">classification</span><span class="p">.</span><span class="n">py</span><span class="o">:</span><span class="mi">1172</span><span class="o">:</span>
<span class="n">DeprecationWarning</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n n-Quoted">`weighted`</span><span class="w"> </span><span class="n">averaging</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="p">,</span>
<span class="k">and</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mf">0.18</span><span class="p">,</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="kt">precision</span><span class="p">,</span><span class="w"> </span><span class="n">recall</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">score</span><span class="w"> </span><span class="k">with</span><span class="w"> </span>
<span class="n">multiclass</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">multilabel</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">pos_label</span><span class="o">=</span><span class="k">None</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span>
<span class="n">exception</span><span class="p">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">explicit</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n n-Quoted">`average`</span><span class="p">,</span><span class="w"> </span><span class="k">one</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="p">(</span><span class="k">None</span><span class="p">,</span><span class="w"> </span>
<span class="s1">'micro'</span><span class="p">,</span><span class="w"> </span><span class="s1">'macro'</span><span class="p">,</span><span class="w"> </span><span class="s1">'weighted'</span><span class="p">,</span><span class="w"> </span><span class="s1">'samples'</span><span class="p">).</span><span class="w"> </span><span class="k">In</span><span class="w"> </span><span class="k">cross</span><span class="w"> </span><span class="k">validation</span><span class="w"> </span><span class="k">use</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>
<span class="k">instance</span><span class="p">,</span><span class="w"> </span><span class="n">scoring</span><span class="o">=</span><span class="s2">"f1_weighted"</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">scoring</span><span class="o">=</span><span class="s2">"f1"</span>
</pre></div>

<p>How can I deal correctly with my unbalanced data in order to compute in the
right way classifier's metrics?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I think there is a lot of confusion about which weights are used for what. I
am not sure I know precisely what bothers you so I am going to cover different
topics, bear with me ;).</p>
<h3>Class weights</h3>
<p>The weights from the <code>class_weight</code> parameter are used to <strong>train the
classifier</strong>. They <strong>are not used in the calculation of any of the metrics you
are using</strong> : with different class weights, the numbers will be different
simply because the classifier is different.</p>
<p>Basically in every scikit-learn classifier, the class weights are used to tell
your model how important a class is. That means that during the training, the
classifier will make extra efforts to classify properly the classes with high
weights.<br>
How they do that is algorithm-specific. If you want details about how it works
for SVC and the doc does not make sense to you, feel free to mention it.</p>
<h3>The metrics</h3>
<p>Once you have a classifier, you want to know how well it is performing. Here
you can use the metrics you mentioned: <code>accuracy</code>, <code>recall_score</code>,
<code>f1_score</code>...</p>
<p>Usually when the class distribution is unbalanced, accuracy is considered a
poor choice as it gives high scores to models which just predict the most
frequent class.</p>
<p>I will not detail all these metrics but note that, with the exception of
<code>accuracy</code>, they are naturally applied at the class level: as you can see in
this <code>print</code> of a classification report they are defined for each class. They
rely on concepts such as <code>true positives</code> or <code>false negative</code> that require
defining which class is the <em>positive</em> one.</p>
<div class="code"><pre class="code literal-block">             precision    recall  f1-score   support

          0       0.65      1.00      0.79        17
          1       0.57      0.75      0.65        16
          2       0.33      0.06      0.10        17
avg / total       0.52      0.60      0.51        50
</pre></div>

<h3>The warning</h3>
<div class="code"><pre class="code literal-block"><span class="n">F1</span><span class="w"> </span><span class="n">score</span><span class="o">:/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="mf">.7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">metrics</span><span class="o">/</span><span class="n">classification</span><span class="p">.</span><span class="n">py</span><span class="o">:</span><span class="mi">676</span><span class="o">:</span><span class="w"> </span><span class="n">DeprecationWarning</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span>
<span class="k">default</span><span class="w"> </span><span class="n n-Quoted">`weighted`</span><span class="w"> </span><span class="n">averaging</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mf">0.18</span><span class="p">,</span><span class="w"> </span>
<span class="k">use</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="kt">precision</span><span class="p">,</span><span class="w"> </span><span class="n">recall</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">F</span><span class="o">-</span><span class="n">score</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">multiclass</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">multilabel</span><span class="w"> </span><span class="k">data</span><span class="w">  </span>
<span class="k">or</span><span class="w"> </span><span class="n">pos_label</span><span class="o">=</span><span class="k">None</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">exception</span><span class="p">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">explicit</span><span class="w"> </span>
<span class="k">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n n-Quoted">`average`</span><span class="p">,</span><span class="w"> </span><span class="k">one</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="p">(</span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="s1">'micro'</span><span class="p">,</span><span class="w"> </span><span class="s1">'macro'</span><span class="p">,</span><span class="w"> </span><span class="s1">'weighted'</span><span class="p">,</span><span class="w"> </span>
<span class="s1">'samples'</span><span class="p">).</span><span class="w"> </span><span class="k">In</span><span class="w"> </span><span class="k">cross</span><span class="w"> </span><span class="k">validation</span><span class="w"> </span><span class="k">use</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">instance</span><span class="p">,</span><span class="w"> </span>
<span class="n">scoring</span><span class="o">=</span><span class="s2">"f1_weighted"</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">scoring</span><span class="o">=</span><span class="s2">"f1"</span><span class="p">.</span>
</pre></div>

<p>You get this warning because you are using the f1-score, recall and precision
without defining how they should be computed! The question could be rephrased:
from the above classification report, how do you output <strong>one</strong> global number
for the f1-score? You could:</p>
<ol>
<li>Take the average of the f1-score for each class: that's the <code>avg / total</code> result above. It's also called <em>macro</em> averaging.</li>
<li>Compute the f1-score using the global count of true positives / false negatives, etc. (you sum the number of true positives / false negatives for each class). Aka <em>micro</em> averaging.</li>
<li>Compute a weighted average of the f1-score. Using <code>'weighted'</code> in scikit-learn will weigh the f1-score by the support of the class: the more elements a class has, the more important the f1-score for this class in the computation.</li>
</ol>
<p>These are 3 of the options in scikit-learn, the warning is there to say you
<strong>have to pick one</strong>. So you have to specify an <code>average</code> argument for the
score method.</p>
<p>Which one you choose is up to how you want to measure the performance of the
classifier: for instance macro-averaging does not take class imbalance into
account and the f1-score of class 1 will be just as important as the f1-score
of class 5. If you use weighted averaging however you'll get more importance
for the class 5.</p>
<p>The whole argument specification in these metrics is not super-clear in
scikit-learn right now, it will get better in version 0.18 according to the
docs. They are removing some non-obvious standard behavior and they are
issuing warnings so that developers notice it.</p>
<h3>Computing scores</h3>
<p>Last thing I want to mention (feel free to skip it if you're aware of it) is
that scores are only meaningful if they are computed on data that the
classifier <strong>has never seen</strong>. This is extremely important as any score you
get on data that was used in fitting the classifier is completely irrelevant.</p>
<p>Here's a way to do it using <code>StratifiedShuffleSplit</code>, which gives you a random
splits of your data (after shuffling) that preserve the label distribution.</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">StratifiedShuffleSplit</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>

<span class="c1"># We use a utility to generate artificial classification data.</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_informative</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">sss</span> <span class="o">=</span> <span class="n">StratifiedShuffleSplit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="n">sss</span><span class="p">:</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">test_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>
    <span class="n">svc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">"macro"</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">"macro"</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">"macro"</span><span class="p">))</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Lot of very detailed answers here but I don't think you are answering the
right questions. As I understand the question, there are two concerns:</p>
<ol>
<li>How to I score a multiclass problem?</li>
<li>How do I deal with unbalanced data?</li>
</ol>
<h3>1.</h3>
<p>You can use most of the scoring functions in scikit-learn with both multiclass
problem as with single class problems. Ex.:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_fscore_support</span> <span class="k">as</span> <span class="n">score</span>

<span class="n">predicted</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> 
<span class="n">y_test</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

<span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">fscore</span><span class="p">,</span> <span class="n">support</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predicted</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'precision: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'recall: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recall</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'fscore: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fscore</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'support: </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">support</span><span class="p">))</span>
</pre></div>

<p>This way you end up with tangible and interpretable numbers for each of the
classes.</p>
<div class="code"><pre class="code literal-block">| Label | Precision | Recall | FScore | Support |
|-------|-----------|--------|--------|---------|
| 1     | 94%       | 83%    | 0.88   | 204     |
| 2     | 71%       | 50%    | 0.54   | 127     |
| ...   | ...       | ...    | ...    | ...     |
| 4     | 80%       | 98%    | 0.89   | 838     |
| 5     | 93%       | 81%    | 0.91   | 1190    |
</pre></div>

<p>Then...</p>
<h3>2.</h3>
<p>... you can tell if the unbalanced data is even a problem. If the scoring for
the less represented classes (class 1 and 2) are lower than for the classes
with more training samples (class 4 and 5) then you know that the unbalanced
data is in fact a problem, and you can act accordingly, as described in some
of the other answers in this thread. However, if the same class distribution
is present in the data you want to predict on, your unbalanced training data
is a good representative of the data, and hence, the unbalance is a good
thing.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/artificial-intelligence/" rel="tag">artificial-intelligence</a></li>
            <li><a class="tag p-category" href="../../categories/machine-learning/" rel="tag">machine-learning</a></li>
            <li><a class="tag p-category" href="../../categories/nlp/" rel="tag">nlp</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/scikit-learn/" rel="tag">scikit-learn</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../what-is-the-difference-between-q-learning-and-sarsa/" rel="prev" title="What is the difference between Q-learning and SARSA?">Previous post</a>
            </li>
            <li class="next">
                <a href="../is-it-possible-for-a-computer-to-learn-a-regular-expression-by-user-provided-examples/" rel="next" title='Is it possible for a computer to "learn" a regular expression by user-provided examples?'>Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
