<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>What is a NullReferenceException, and how do I fix it? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/what-is-a-nullreferenceexception-and-how-do-i-fix-it/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../getting-the-class-name-of-an-instance/" title="Getting the class name of an instance" type="text/html">
<link rel="next" href="../addtransient-addscoped-and-addsingleton-services-differences/" title="AddTransient, AddScoped and AddSingleton Services Differences" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="What is a NullReferenceException, and how do I fix it?">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/what-is-a-nullreferenceexception-and-how-do-i-fix-it/">
<meta property="og:description" content="This question's answers are a community effort. Edit existing answers to
improve this post. It is not currently accepting new answers or interactions.
I have some code and when it executes, it throws ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-16T23:48:36+08:00">
<meta property="article:tag" content=".net">
<meta property="article:tag" content=".net-c#">
<meta property="article:tag" content="null">
<meta property="article:tag" content="nullreferenceexception">
<meta property="article:tag" content="vb.net">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">What is a NullReferenceException, and how do I fix it?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-16T23:48:36+08:00" itemprop="datePublished" title="2023-02-16 23:48">2023-02-16 23:48</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p><strong>This question's answers are a community effort</strong>. Edit existing answers to
improve this post. It is not currently accepting new answers or interactions.</p>
<p>I have some code and when it executes, it throws a <code>NullReferenceException</code>,
saying:</p>
<blockquote>
<p>Object reference not set to an instance of an object.</p>
</blockquote>
<p>What does this mean, and what can I do to fix this error?</p>
<p><br><br></p>
<h2>Answer</h2>
<h2>What is the cause?</h2>
<h3>Bottom Line</h3>
<p>You are trying to use something that is <code>null</code> (or <code>Nothing</code> in VB.NET). This
means you either set it to <code>null</code>, or you never set it to anything at all.</p>
<p>Like anything else, <code>null</code> gets passed around. If it is <code>null</code> <em>in</em> method
"A", it could be that method "B" passed a <code>null</code> <em>to</em> method "A".</p>
<p><code>null</code> can have different meanings:</p>
<ol>
<li>Object variables that are <strong>uninitialized</strong> and hence <strong>point to nothing.</strong> In this case, if you access members of such objects, it causes a <code>NullReferenceException</code>.</li>
<li>The developer is <strong>using<code>null</code> intentionally to indicate there is no meaningful value available.</strong> Note that C# has the concept of nullable datatypes for variables (like database tables can have nullable fields) - you can assign <code>null</code> to them to indicate there is no value stored in it, for example <code>int? a = null;</code> (which is a shortcut for <code>Nullable&lt;int&gt; a = null;</code>) where the question mark indicates it is allowed to store <code>null</code> in variable <code>a</code>. You can check that either with <code>if (a.HasValue) {...}</code> or with <code>if (a==null) {...}</code>. Nullable variables, like <code>a</code> this example, allow to access the value via <code>a.Value</code> explicitly, or just as normal via <code>a</code>. <br><strong>Note</strong> that accessing it via <code>a.Value</code> throws an <code>InvalidOperationException</code>
instead of a <code>NullReferenceException</code> if <code>a</code> is <code>null</code> - you should do the
check beforehand, i.e. if you have another non-nullable variable <code>int b;</code> then
you should do assignments like <code>if (a.HasValue) { b = a.Value; }</code> or shorter
<code>if (a != null) { b = a; }</code>.</li>
</ol>
<p>The rest of this article goes into more detail and shows mistakes that many
programmers often make which can lead to a <code>NullReferenceException</code>.</p>
<h3>More Specifically</h3>
<p>The <code>runtime</code> throwing a <code>NullReferenceException</code> <strong>always</strong> means the same
thing: you are trying to use a reference, and the reference is not initialized
(or it was <em>once</em> initialized, but is <em>no longer</em> initialized).</p>
<p>This means the reference is <code>null</code>, and you cannot access members (such as
methods) through a <code>null</code> reference. The simplest case:</p>
<div class="code"><pre class="code literal-block"><span class="nv">string</span><span class="w"> </span><span class="nv">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">null</span><span class="c1">;</span>
<span class="nv">foo</span>.<span class="k">ToUpper</span><span class="ss">()</span><span class="c1">;</span>
</pre></div>

<p>This will throw a <code>NullReferenceException</code> at the second line because you
can't call the instance method <code>ToUpper()</code> on a <code>string</code> reference pointing to
<code>null</code>.</p>
<h2>Debugging</h2>
<p>How do you find the source of a <code>NullReferenceException</code>? Apart from looking
at the exception itself, which will be thrown exactly at the location where it
occurs, the general rules of debugging in Visual Studio apply: place strategic
breakpoints and inspect your variables, either by hovering the mouse over
their names, opening a (Quick)Watch window or using the various debugging
panels like Locals and Autos.</p>
<p>If you want to find out where the reference is or isn't set, right-click its
name and select "Find All References". You can then place a breakpoint at
every found location and run your program with the debugger attached. Every
time the debugger breaks on such a breakpoint, you need to determine whether
you expect the reference to be non-null, inspect the variable, and verify that
it points to an instance when you expect it to.</p>
<p>By following the program flow this way, you can find the location where the
instance should not be null, and why it isn't properly set.</p>
<h2>Examples</h2>
<p>Some common scenarios where the exception can be thrown:</p>
<h4>Generic</h4>
<div class="code"><pre class="code literal-block">ref1.ref2.ref3.member
</pre></div>

<p>If ref1 or ref2 or ref3 is null, then you'll get a <code>NullReferenceException</code>.
If you want to solve the problem, then find out which one is null by rewriting
the expression to its simpler equivalent:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ref1</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r1</span><span class="o">.</span><span class="n">ref2</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r2</span><span class="o">.</span><span class="n">ref3</span><span class="p">;</span>
<span class="n">r3</span><span class="o">.</span><span class="n">member</span>
</pre></div>

<p>Specifically, in <code>HttpContext.Current.User.Identity.Name</code>, the
<code>HttpContext.Current</code> could be null, or the <code>User</code> property could be null, or
the <code>Identity</code> property could be null.</p>
<h4>Indirect</h4>
<div class="code"><pre class="code literal-block">public class Person 
{
    public int Age { get; set; }
}
public class Book 
{
    public Person Author { get; set; }
}
public class Example 
{
    public void Foo() 
    {
        Book b1 = new Book();
        int authorAge = b1.Author.Age; // You never initialized the Author property.
                                       // there is no Person to get an Age from.
    }
}
</pre></div>

<p>If you want to avoid the child (Person) null reference, you could initialize
it in the parent (Book) object's constructor.</p>
<h4>Nested Object Initializers</h4>
<p>The same applies to nested object initializers:</p>
<div class="code"><pre class="code literal-block">Book b1 = new Book 
{ 
   Author = { Age = 45 } 
};
</pre></div>

<p>This translates to:</p>
<div class="code"><pre class="code literal-block">Book b1 = new Book();
b1.Author.Age = 45;
</pre></div>

<p>While the <code>new</code> keyword is used, it only creates a new instance of <code>Book</code>, but
not a new instance of <code>Person</code>, so the <code>Author</code> the property is still <code>null</code>.</p>
<h4>Nested Collection Initializers</h4>
<div class="code"><pre class="code literal-block">public class Person 
{
    public ICollection&lt;Book&gt; Books { get; set; }
}
public class Book 
{
    public string Title { get; set; }
}
</pre></div>

<p>The nested collection <code>Initializers</code> behave the same:</p>
<div class="code"><pre class="code literal-block">Person p1 = new Person 
{
    Books = {
         new Book { Title = "Title1" },
         new Book { Title = "Title2" },
    }
};
</pre></div>

<p>This translates to:</p>
<div class="code"><pre class="code literal-block">Person p1 = new Person();
p1.Books.Add(new Book { Title = "Title1" });
p1.Books.Add(new Book { Title = "Title2" });
</pre></div>

<p>The <code>new Person</code> only creates an instance of <code>Person</code>, but the <code>Books</code>
collection is still <code>null</code>. The collection <code>Initializer</code> syntax does not
create a collection for <code>p1.Books</code>, it only translates to the
<code>p1.Books.Add(...)</code> statements.</p>
<h4>Array</h4>
<div class="code"><pre class="code literal-block">int[] numbers = null;
int n = numbers[0]; // numbers is null. There is no array to index.
</pre></div>

<h4>Array Elements</h4>
<div class="code"><pre class="code literal-block"><span class="nv">Person</span>[]<span class="w"> </span><span class="nv">people</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Person</span>[<span class="mi">5</span>]<span class="c1">;</span>
<span class="nv">people</span>[<span class="mi">0</span>].<span class="nv">Age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nv">people</span>[<span class="mi">0</span>]<span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">null</span>.<span class="w"> </span><span class="nv">The</span><span class="w"> </span><span class="nv">array</span><span class="w"> </span><span class="nv">was</span><span class="w"> </span><span class="nv">allocated</span><span class="w"> </span><span class="nv">but</span><span class="w"> </span><span class="nv">not</span>
<span class="w">                   </span><span class="o">//</span><span class="w"> </span><span class="nv">initialized</span>.<span class="w"> </span><span class="nv">There</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">Person</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">set</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">Age</span><span class="w"> </span><span class="k">for</span>.
</pre></div>

<h4>Jagged Arrays</h4>
<div class="code"><pre class="code literal-block">long[][] array = new long[1][];
array[0][0] = 3; // is null because only the first dimension is yet initialized.
                 // Use array[0] = new long[2]; first.
</pre></div>

<h4>Collection/List/Dictionary</h4>
<div class="code"><pre class="code literal-block">Dictionary&lt;string, int&gt; agesForNames = null;
int age = agesForNames["Bob"]; // agesForNames is null.
                               // There is no Dictionary to perform the lookup.
</pre></div>

<h4>Range Variable (Indirect/Deferred)</h4>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">get</span><span class="p">;</span><span class="w"> </span><span class="n">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">var</span><span class="w"> </span><span class="n">people</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">people</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="nb nb-Type">null</span><span class="p">);</span>
<span class="k">var</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">people</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">Name</span><span class="p">;</span>
<span class="n">string</span><span class="w"> </span><span class="n">firstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span><span class="o">.</span><span class="n">First</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">thrown</span><span class="w"> </span><span class="n">here</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">actually</span><span class="w"> </span><span class="n">occurs</span>
<span class="w">                                  </span><span class="o">//</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">above</span><span class="o">.</span><span class="w">  </span><span class="s2">"p"</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">the</span>
<span class="w">                                  </span><span class="o">//</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="o">.</span>
</pre></div>

<h4>Events (C#)</h4>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">Demo</span>
{
<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">event</span><span class="w"> </span><span class="nv">EventHandler</span><span class="w"> </span><span class="nv">StateChanged</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">protected</span><span class="w"> </span><span class="nv">virtual</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">OnStateChanged</span><span class="ss">(</span><span class="nv">EventArgs</span><span class="w"> </span><span class="nv">e</span><span class="ss">)</span>
<span class="w">    </span>{<span class="w">        </span>
<span class="w">        </span><span class="nv">StateChanged</span><span class="ss">(</span><span class="nv">this</span>,<span class="w"> </span><span class="nv">e</span><span class="ss">)</span><span class="c1">; // Exception is thrown here </span>
<span class="w">                               </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">event</span><span class="w"> </span><span class="nv">handlers</span><span class="w"> </span><span class="nv">have</span><span class="w"> </span><span class="nv">been</span><span class="w"> </span><span class="nv">attached</span>
<span class="w">                               </span><span class="o">//</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">StateChanged</span><span class="w"> </span><span class="nv">event</span>
<span class="w">    </span>}
}
</pre></div>

<p>(Note: The VB.NET compiler inserts null checks for event usage, so it's not
necessary to check events for <code>Nothing</code> in VB.NET.)</p>
<h4>Bad Naming Conventions:</h4>
<p>If you named fields differently from locals, you might have realized that you
never initialized the field.</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">Form1</span>
{
<span class="w">    </span><span class="nv">private</span><span class="w"> </span><span class="nv">Customer</span><span class="w"> </span><span class="nv">customer</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">private</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">Form1_Load</span><span class="ss">(</span><span class="nv">object</span><span class="w"> </span><span class="nv">sender</span>,<span class="w"> </span><span class="nv">EventArgs</span><span class="w"> </span><span class="nv">e</span><span class="ss">)</span><span class="w"> </span>
<span class="w">    </span>{
<span class="w">        </span><span class="nv">Customer</span><span class="w"> </span><span class="nv">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Customer</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">        </span><span class="nv">customer</span>.<span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"John"</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="nv">private</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="nv">Button_Click</span><span class="ss">(</span><span class="nv">object</span><span class="w"> </span><span class="nv">sender</span>,<span class="w"> </span><span class="nv">EventArgs</span><span class="w"> </span><span class="nv">e</span><span class="ss">)</span>
<span class="w">    </span>{
<span class="w">        </span><span class="k">MessageBox</span>.<span class="k">Show</span><span class="ss">(</span><span class="nv">customer</span>.<span class="nv">Name</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<p>This can be solved by following the convention to prefix fields with an
underscore:</p>
<div class="code"><pre class="code literal-block">    private Customer _customer;
</pre></div>

<h4>ASP.NET Page Life cycle:</h4>
<div class="code"><pre class="code literal-block"><span class="n">public</span><span class="w"> </span><span class="n">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">Issues_Edit</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">System</span><span class="o">.</span><span class="n">Web</span><span class="o">.</span><span class="n">UI</span><span class="o">.</span><span class="n">Page</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="n">TestIssue</span><span class="w"> </span><span class="n">myIssue</span><span class="p">;</span>

<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">Page_Load</span><span class="p">(</span><span class="n">object</span><span class="w"> </span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">EventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IsPostBack</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">             </span><span class="o">//</span><span class="w"> </span><span class="n">Only</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="nb">load</span><span class="p">,</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">button</span><span class="w"> </span><span class="n">clicked</span>
<span class="w">             </span><span class="n">myIssue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">TestIssue</span><span class="p">();</span><span class="w"> </span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">protected</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">SaveButton_Click</span><span class="p">(</span><span class="n">object</span><span class="w"> </span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">EventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">myIssue</span><span class="o">.</span><span class="n">Entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"NullReferenceException here!"</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h4>ASP.NET Session Values</h4>
<div class="code"><pre class="code literal-block"><span class="c1">// if the "FirstName" session value has not yet been set,</span>
<span class="c1">// then this line will throw a NullReferenceException</span>
<span class="nb">string</span><span class="w"> </span><span class="n">firstName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Session</span><span class="p">[</span><span class="s">"FirstName"</span><span class="p">].</span><span class="n">ToString</span><span class="p">();</span>
</pre></div>

<h4>ASP.NET MVC empty view models</h4>
<p>If the exception occurs when referencing a property of <code>@Model</code> in an <code>ASP.NET
MVC View</code>, you need to understand that the <code>Model</code> gets set in your action
method, when you <code>return</code> a view. When you return an empty model (or model
property) from your controller, the exception occurs when the views access it:</p>
<div class="code"><pre class="code literal-block">//<span class="w"> </span>Controller
public<span class="w"> </span>class<span class="w"> </span>Restaurant:Controller
{
<span class="w">    </span>public<span class="w"> </span>ActionResult<span class="w"> </span>Search()
<span class="w">    </span>{
<span class="w">        </span>return<span class="w"> </span>View();<span class="w">  </span>//<span class="w"> </span>Forgot<span class="w"> </span>the<span class="w"> </span>provide<span class="w"> </span>a<span class="w"> </span>Model<span class="w"> </span>here.
<span class="w">    </span>}
}

//<span class="w"> </span>Razor<span class="w"> </span>view<span class="w"> </span>
@foreach<span class="w"> </span>(var<span class="w"> </span>restaurantSearch<span class="w"> </span>in<span class="w"> </span>Model.RestaurantSearch)<span class="w">  </span>//<span class="w"> </span>Throws.
{
}

<span class="nt">&lt;p&gt;</span>@Model.somePropertyName<span class="nt">&lt;/p&gt;</span><span class="w"> </span><span class="cm">&lt;!-- Also throws --&gt;</span>
</pre></div>

<h4>WPF Control Creation Order and Events</h4>
<p><code>WPF</code> controls are created during the call to <code>InitializeComponent</code> in the
order they appear in the visual tree. A <code>NullReferenceException</code> will be
raised in the case of early-created controls with event handlers, etc., that
fire during <code>InitializeComponent</code> which reference late-created controls.</p>
<p>For example:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;Grid&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Combobox declared first --&gt;</span>
<span class="w">    </span><span class="nt">&lt;ComboBox</span><span class="w"> </span><span class="na">Name=</span><span class="s">"comboBox1"</span><span class="w"> </span>
<span class="w">              </span><span class="na">Margin=</span><span class="s">"10"</span>
<span class="w">              </span><span class="na">SelectedIndex=</span><span class="s">"0"</span><span class="w"> </span>
<span class="w">              </span><span class="na">SelectionChanged=</span><span class="s">"comboBox1_SelectionChanged"</span><span class="nt">&gt;</span>
<span class="w">       </span><span class="nt">&lt;ComboBoxItem</span><span class="w"> </span><span class="na">Content=</span><span class="s">"Item 1"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">       </span><span class="nt">&lt;ComboBoxItem</span><span class="w"> </span><span class="na">Content=</span><span class="s">"Item 2"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">       </span><span class="nt">&lt;ComboBoxItem</span><span class="w"> </span><span class="na">Content=</span><span class="s">"Item 3"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/ComboBox&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Label declared later --&gt;</span>
<span class="w">    </span><span class="nt">&lt;Label</span><span class="w"> </span><span class="na">Name=</span><span class="s">"label1"</span><span class="w"> </span>
<span class="w">           </span><span class="na">Content=</span><span class="s">"Label"</span>
<span class="w">           </span><span class="na">Margin=</span><span class="s">"10"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Grid&gt;</span>
</pre></div>

<p>Here <code>comboBox1</code> is created before <code>label1</code>. If <code>comboBox1_SelectionChanged</code>
attempts to reference `label1, it will not yet have been created.</p>
<div class="code"><pre class="code literal-block">private void comboBox1_SelectionChanged(object sender, SelectionChangedEventArgs e)
{
    label1.Content = comboBox1.SelectedIndex.ToString(); // NullReferenceException here!!
}
</pre></div>

<p>Changing the order of the declarations in the <code>XAML</code> (i.e., listing <code>label1</code>
before <code>comboBox1</code>, ignoring issues of design philosophy) would at least
resolve the <code>NullReferenceException</code> here.</p>
<h4>Cast with <code>as</code>
</h4>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">myThing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">someObject</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Thing</span><span class="p">;</span>
</pre></div>

<p>This doesn't throw an <code>InvalidCastException</code> but returns a <code>null</code> when the
cast fails (and when <code>someObject</code> is itself null). So be aware of that.</p>
<h4>LINQ <code>FirstOrDefault()</code> and <code>SingleOrDefault()</code>
</h4>
<p>The plain versions <code>First()</code> and <code>Single()</code> throw exceptions when there is
nothing. The "OrDefault" versions return <code>null</code> in that case. So be aware of
that.</p>
<h4>foreach</h4>
<p><code>foreach</code> throws when you try to iterate on a <code>null</code> collection. Usually
caused by unexpected <code>null</code> result from methods that return collections.</p>
<div class="code"><pre class="code literal-block"><span class="n">List</span><span class="o">&lt;</span><span class="nb nb-Type">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span><span class="w">    </span>
<span class="n">foreach</span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">NullReferenceException</span><span class="w"> </span><span class="n">here</span>
</pre></div>

<p>More realistic example - select nodes from XML document. Will throw if nodes
are not found but initial debugging shows that all properties valid:</p>
<div class="code"><pre class="code literal-block"><span class="n">foreach</span><span class="w"> </span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">myData</span><span class="o">.</span><span class="n">MyXml</span><span class="o">.</span><span class="n">DocumentNode</span><span class="o">.</span><span class="n">SelectNodes</span><span class="p">(</span><span class="s2">"//Data"</span><span class="p">))</span>
</pre></div>

<hr>
<h2>Ways to Avoid</h2>
<h4>Explicitly check for <code>null</code> and ignore <code>null</code> values.</h4>
<p>If you expect the reference sometimes to be <code>null</code>, you can check for it being
<code>null</code> before accessing instance members:</p>
<div class="code"><pre class="code literal-block"><span class="nv">void</span><span class="w"> </span><span class="nv">PrintName</span><span class="ss">(</span><span class="nv">Person</span><span class="w"> </span><span class="nv">p</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">p</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span><span class="w"> </span>
<span class="w">    </span>{
<span class="w">        </span><span class="nv">Console</span>.<span class="nv">WriteLine</span><span class="ss">(</span><span class="nv">p</span>.<span class="nv">Name</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<h4>Explicitly check for <code>null</code> and provide a default value.</h4>
<p>Methods you call expecting an instance can return <code>null</code>, for example when the
object being sought cannot be found. You can choose to return a default value
when this is the case:</p>
<div class="code"><pre class="code literal-block"><span class="nv">string</span><span class="w"> </span><span class="nv">GetCategory</span><span class="ss">(</span><span class="nv">Book</span><span class="w"> </span><span class="nv">b</span><span class="ss">)</span><span class="w"> </span>
{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s2">"Unknown"</span><span class="c1">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">b</span>.<span class="nv">Category</span><span class="c1">;</span>
}
</pre></div>

<h4>Explicitly check for <code>null</code> from method calls and throw a custom</h4>
<p>exception.</p>
<p>You can also throw a custom exception, only to catch it in the calling code:</p>
<div class="code"><pre class="code literal-block"><span class="n">string</span><span class="w"> </span><span class="n">GetCategory</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">bookTitle</span><span class="p">)</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">library</span><span class="o">.</span><span class="n">FindBook</span><span class="p">(</span><span class="n">bookTitle</span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">book</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">)</span>
<span class="w">        </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">BookNotFoundException</span><span class="p">(</span><span class="n">bookTitle</span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">Your</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">exception</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">book</span><span class="o">.</span><span class="n">Category</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Use <code>Debug.Assert</code> if a value should never be <code>null</code>, to catch the problem</h4>
<p>earlier than the exception occurs.</p>
<p>When you know during development that a method could, but never should return
<code>null</code>, you can use <code>Debug.Assert()</code> to break as soon as possible when it does
occur:</p>
<div class="code"><pre class="code literal-block"><span class="n">string</span><span class="w"> </span><span class="n">GetTitle</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">knownBookID</span><span class="p">)</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">You</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="o">.</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">book</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">library</span><span class="o">.</span><span class="n">GetBook</span><span class="p">(</span><span class="n">knownBookID</span><span class="p">);</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">occur</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">method</span><span class="o">.</span>
<span class="w">    </span><span class="n">Debug</span><span class="o">.</span><span class="n">Assert</span><span class="p">(</span><span class="n">book</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">,</span><span class="w"> </span><span class="s2">"Library didn't return a book for known book ID."</span><span class="p">);</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Some</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">code</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">book</span><span class="o">.</span><span class="n">Title</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Will</span><span class="w"> </span><span class="n">never</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">NullReferenceException</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Debug</span><span class="w"> </span><span class="n">mode</span><span class="o">.</span>
<span class="p">}</span>
</pre></div>

<p>Though this check will not end up in your release build, causing it to throw
the <code>NullReferenceException</code> again when <code>book == null</code> at runtime in release
mode.</p>
<h4>Use <code>GetValueOrDefault()</code> for <code>nullable</code> value types to provide a default</h4>
<p>value when they are <code>null</code>.</p>
<div class="code"><pre class="code literal-block">DateTime? appointment = null;
Console.WriteLine(appointment.GetValueOrDefault(DateTime.Now));
// Will display the default value provided (DateTime.Now), because appointment is null.

appointment = new DateTime(2022, 10, 20);
Console.WriteLine(appointment.GetValueOrDefault(DateTime.Now));
// Will display the appointment date, not the default
</pre></div>

<h4>Use the null coalescing operator: <code>??</code> [C#] or <code>If()</code> [VB].</h4>
<p>The shorthand to providing a default value when a <code>null</code> is encountered:</p>
<div class="code"><pre class="code literal-block"><span class="n">IService</span><span class="w"> </span><span class="n">CreateService</span><span class="p">(</span><span class="n">ILogger</span><span class="w"> </span><span class="nb">log</span><span class="p">,</span><span class="w"> </span><span class="n">Int32</span><span class="err">?</span><span class="w"> </span><span class="n">frobPowerLevel</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="k">var</span><span class="w"> </span><span class="n">serviceImpl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">MyService</span><span class="p">(</span><span class="nb">log</span><span class="w"> </span><span class="err">??</span><span class="w"> </span><span class="n">NullLog</span><span class="o">.</span><span class="n">Instance</span><span class="p">);</span>

<span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="s2">"GetValueOrDefault()"</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">rewritten</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span>
<span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">coalesce</span><span class="w"> </span><span class="n">operator</span><span class="p">:</span>
<span class="w">   </span><span class="n">serviceImpl</span><span class="o">.</span><span class="n">FrobPowerLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frobPowerLevel</span><span class="w"> </span><span class="err">??</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h4>Use the null condition operator: <code>?.</code> or <code>?[x]</code> for arrays (available in</h4>
<p>C# 6 and VB.NET 14):</p>
<p>This is also sometimes called the safe navigation or Elvis (after its shape)
operator. If the expression on the left side of the operator is null, then the
right side will not be evaluated, and null is returned instead. That means
cases like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person</span><span class="o">.</span><span class="n">Title</span><span class="o">.</span><span class="n">ToUpper</span><span class="p">();</span>
</pre></div>

<p>If the person does not have a title, this will throw an exception because it
is trying to call <code>ToUpper</code> on a property with a null value.</p>
<p>In <code>C# 5</code> and below, this can be guarded with:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person</span><span class="o">.</span><span class="n">Title</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">person</span><span class="o">.</span><span class="n">Title</span><span class="o">.</span><span class="n">ToUpper</span><span class="p">();</span>
</pre></div>

<p>Now the title variable will be null instead of throwing an exception. C# 6
introduces a shorter syntax for this:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person</span><span class="o">.</span><span class="n">Title</span><span class="err">?</span><span class="o">.</span><span class="n">ToUpper</span><span class="p">();</span>
</pre></div>

<p>This will result in the title variable being <code>null</code>, and the call to <code>ToUpper</code>
is not made if <code>person.Title</code> is <code>null</code>.</p>
<p>Of course, you <em>still</em> have to check <code>title</code> for <code>null</code> or use the null
condition operator together with the null coalescing operator (<code>??</code>) to supply
a default value:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// regular null check</span>
<span class="nb">int</span><span class="w"> </span><span class="n">titleLength</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">title</span><span class="w"> </span>!<span class="p">=</span><span class="w"> </span><span class="nb">null</span><span class="p">)</span>
<span class="w">    </span><span class="n">titleLength</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">title</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span><span class="w"> </span><span class="c1">// If title is null, this would throw NullReferenceException</span>

<span class="c1">// combining the `?` and the `??` operator</span>
<span class="nb">int</span><span class="w"> </span><span class="n">titleLength</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">title</span>?<span class="p">.</span><span class="n">Length</span><span class="w"> </span>??<span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</pre></div>

<p>Likewise, for arrays you can use <code>?[i]</code> as follows:</p>
<div class="code"><pre class="code literal-block"><span class="nc">int</span><span class="err">[]</span><span class="w"> </span><span class="n">myIntArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="nf">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="nc">int</span><span class="vm">?</span><span class="w"> </span><span class="n">elem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myIntArray</span><span class="vm">?</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="err">!</span><span class="n">elem</span><span class="p">.</span><span class="n">HasValue</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="ss">"No value"</span><span class="p">);</span>
</pre></div>

<p>This will do the following: If <code>myIntArray</code> is <code>null</code>, the expression returns
<code>null</code> and you can safely check it. If it contains an array, it will do the
same as: <code>elem = myIntArray[i];</code> and returns the ith element.</p>
<h4>Use null context (available in C# 8):</h4>
<p>Introduced in <code>C# 8</code>, null contexts and nullable reference types perform
static analysis on variables and provide a compiler warning if a value can be
potentially <code>null</code> or have been set to <code>null</code>. The nullable reference types
allow types to be explicitly allowed to be <code>null</code>.</p>
<p>The nullable annotation context and nullable warning context can be set for a
project using the <code>Nullable</code> element in your <code>csproj</code> file. This element
configures how the compiler interprets the nullability of types and what
warnings are generated. Valid settings are:</p>
<ul>
<li>
<code>enable</code>: The nullable annotation context is enabled. The nullable warning context is enabled. Variables of a reference type, string, for example, are non-nullable. All nullability warnings are enabled.</li>
<li>
<code>disable</code>: The nullable annotation context is disabled. The nullable warning context is disabled. Variables of a reference type are oblivious, just like earlier versions of C#. All nullability warnings are disabled.</li>
<li>
<code>safeonly</code>: The nullable annotation context is enabled. The nullable warning context is safeonly. Variables of a reference type are non-nullable. All safety nullability warnings are enabled.</li>
<li>
<code>warnings</code>: The nullable annotation context is disabled. The nullable warning context is enabled. Variables of a reference type are oblivious. All nullability warnings are enabled.</li>
<li>
<code>safeonlywarnings</code>: The nullable annotation context is disabled. The nullable warning context is safeonly. Variables of a reference type are oblivious. All safety nullability warnings are enabled.</li>
</ul>
<p>A nullable reference type is noted using the same syntax as nullable value
types: a <code>?</code> is appended to the type of the variable.</p>
<h4>Special techniques for debugging and fixing null derefs in iterators</h4>
<p><code>C#</code> supports "iterator blocks" (called "generators" in some other popular
languages). <code>NullReferenceException</code> can be particularly tricky to debug in
iterator blocks because of deferred execution:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">IEnumerable</span><span class="o">&lt;</span><span class="nv">Frob</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">GetFrobs</span><span class="ss">(</span><span class="nv">FrobFactory</span><span class="w"> </span><span class="nv">f</span>,<span class="w"> </span><span class="nv">int</span><span class="w"> </span><span class="nv">count</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">int</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="c1">; i &lt; count; ++i)</span>
<span class="w">    </span><span class="nv">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">f</span>.<span class="nv">MakeFrob</span><span class="ss">()</span><span class="c1">;</span>
}
...
<span class="nv">FrobFactory</span><span class="w"> </span><span class="nv">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">whatever</span><span class="c1">;</span>
<span class="nv">IEnumerable</span><span class="o">&lt;</span><span class="nv">Frobs</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">frobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">GetFrobs</span><span class="ss">()</span><span class="c1">;</span>
...
<span class="nv">foreach</span><span class="ss">(</span><span class="nv">Frob</span><span class="w"> </span><span class="nv">frob</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">frobs</span><span class="ss">)</span><span class="w"> </span>{<span class="w"> </span>...<span class="w"> </span>}
</pre></div>

<p>If <code>whatever</code> results in <code>null</code> then <code>MakeFrob</code> will throw. Now, you might
think that the right thing to do is this:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// DON'T DO THIS</span>
<span class="n">public</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">Frob</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetFrobs</span><span class="p">(</span><span class="n">FrobFactory</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">null</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ArgumentNullException</span><span class="p">(</span><span class="s">"f"</span><span class="p">,</span><span class="w"> </span><span class="s">"factory must not be null"</span><span class="p">);</span>
<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">      </span><span class="n">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">MakeFrob</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>Why is this wrong? Because the iterator block does not actually <em>run</em> until
the <code>foreach</code>! The call to <code>GetFrobs</code> simply returns an object which <em>when
iterated</em> will run the iterator block.</p>
<p>By writing a <code>null</code> check like this you prevent the <code>NullReferenceException</code>,
but you move the <code>NullArgumentException</code> to the point of the <em>iteration</em> , not
to the point of the <em>call</em> , and that is <em>very confusing to debug</em>.</p>
<p>The correct fix is:</p>
<div class="code"><pre class="code literal-block"><span class="c1">// DO THIS</span>
<span class="n">public</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">Frob</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetFrobs</span><span class="p">(</span><span class="n">FrobFactory</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="c1">// No yields in a public method that throws!</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">null</span><span class="p">)</span><span class="w"> </span>
<span class="w">       </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ArgumentNullException</span><span class="p">(</span><span class="s">"f"</span><span class="p">,</span><span class="w"> </span><span class="s">"factory must not be null"</span><span class="p">);</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">GetFrobsForReal</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">count</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">private</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">Frob</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetFrobsForReal</span><span class="p">(</span><span class="n">FrobFactory</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="c1">// Yields in a private method</span>
<span class="w">   </span><span class="n">Debug</span><span class="p">.</span><span class="n">Assert</span><span class="p">(</span><span class="n">f</span><span class="w"> </span>!<span class="p">=</span><span class="w"> </span><span class="nb">null</span><span class="p">);</span>
<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">        </span><span class="n">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">MakeFrob</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>That is, make a private helper method that has the iterator block logic and a
public surface method that does the <code>null</code> check and returns the iterator. Now
when <code>GetFrobs</code> is called, the <code>null</code> check happens immediately, and then
<code>GetFrobsForReal</code> executes when the sequence is iterated.</p>
<p>If you examine the reference source for <code>LINQ</code> to Objects you will see that
this technique is used throughout. It is slightly more clunky to write, but it
makes debugging nullity errors much easier. <strong>Optimize your code for the
convenience of the caller, not the convenience of the author</strong>.</p>
<h4>A note on null dereferences in unsafe code</h4>
<p><code>C#</code> has an "unsafe" mode which is, as the name implies, extremely dangerous
because the normal safety mechanisms which provide memory safety and type
safety are not enforced. <strong>You should not be writing unsafe code unless you
have a thorough and deep understanding of how memory works</strong>.</p>
<p>In unsafe mode, you should be aware of two important facts:</p>
<ul>
<li>dereferencing a null <strong>pointer</strong> produces the same exception as dereferencing a null <strong>reference</strong>
</li>
<li>dereferencing an invalid non-null pointer <strong>can</strong> produce that exception in some circumstances</li>
</ul>
<p>To understand why that is, it helps to understand how .NET produces
<code>NullReferenceException</code> in the first place. (These details apply to .NET
running on Windows; other operating systems use similar mechanisms.)</p>
<p>Memory is virtualized in <code>Windows</code>; each process gets a virtual memory space
of many "pages" of memory that are tracked by the operating system. Each page
of memory has flags set on it that determine how it may be used: read from,
written to, executed, and so on. The <em>lowest</em> page is marked as "produce an
error if ever used in any way".</p>
<p>Both a null pointer and a null reference in <code>C#</code> are internally represented as
the number zero, and so any attempt to dereference it into its corresponding
memory storage causes the operating system to produce an error. The .NET
runtime then detects this error and turns it into the
<code>NullReferenceException</code>.</p>
<p>That's why dereferencing both a null pointer and a null reference produces the
same exception.</p>
<p>What about the second point? Dereferencing <em>any</em> invalid pointer that falls in
the lowest page of virtual memory causes the same operating system error, and
thereby the same exception.</p>
<p>Why does this make sense? Well, suppose we have a struct containing two ints,
and an unmanaged pointer equal to null. If we attempt to dereference the
second int in the struct, the <code>CLR</code> will not attempt to access the storage at
location zero; it will access the storage at location four. But logically this
is a null dereference because we are getting to that address <em>via</em> the null.</p>
<p>If you are working with unsafe code and you get a <code>NullReferenceException</code>,
just be aware that the offending pointer need not be null. It can be any
location in the lowest page, and this exception will be produced.</p>
<p><br></p>
<h3>Suggest</h3>
<h2>NullReference Exception — Visual Basic</h2>
<p>The <code>NullReference Exception</code> for <strong>Visual Basic</strong> is no different from the
one in <strong>C#</strong>. After all, they are both reporting the same exception defined
in the .NET Framework which they both use. Causes unique to Visual Basic are
rare (perhaps only one).</p>
<p>This answer will use Visual Basic terms, syntax, and context. The examples
used come from a large number of past Stack Overflow questions. This is to
maximize relevance by using the <em>kinds</em> of situations often seen in posts. A
bit more explanation is also provided for those who might need it. An example
similar to yours is <em>very</em> likely listed here.</p>
<p><strong>Note:</strong></p>
<ol>
<li>This is concept-based: there is no code for you to paste into your project. It is intended to help you understand what causes a <code>NullReferenceException</code> (NRE), how to find it, how to fix it, and how to avoid it. An NRE can be caused many ways so this is unlikely to be your sole encounter.</li>
<li>The examples (from Stack Overflow posts) do not always show the best way to do something in the first place.</li>
<li>Typically, the simplest remedy is used.</li>
</ol>
<h3>Basic Meaning</h3>
<p>The message <em>"Object not set to an instance of Object"</em> means you are trying
to use an object which has not been initialized. This boils down to one of
these:</p>
<ul>
<li>Your code <em>declared</em> an object variable, but it did not <em>initialize</em> it (create an instance or ' <em>instantiate</em> ' it)</li>
<li>Something which your code assumed would initialize an object, did not</li>
<li>Possibly, other code prematurely invalidated an object still in use</li>
</ul>
<h3>Finding The Cause</h3>
<p>Since the problem is an object reference which is <code>Nothing</code>, the answer is to
examine them to find out which one. Then determine why it is not initialized.
Hold the mouse over the various variables and Visual Studio (VS) will show
their values - the culprit will be <code>Nothing</code>.</p>
<p><img alt="IDE debug display" src="../../images/5ndSA.jpg"></p>
<p>You should also remove any Try/Catch blocks from the relevant code, especially
ones where there is nothing in the Catch block. This will cause your code to
crash when it tries to use an object which is <code>Nothing</code>. <strong>This is what you
want</strong> because it will identify the exact <em>location</em> of the problem, and allow
you to identify the object causing it.</p>
<p>A <code>MsgBox</code> in the Catch which displays <code>Error while...</code> will be of little
help. This method also leads to <em>very bad</em> Stack Overflow questions, because
you can't describe the actual exception, the object involved or even the line
of code where it happens.</p>
<p>You can also use the <code>Locals Window</code> ( <strong>Debug - &gt; Windows -&gt; Locals</strong>) to
examine your objects.</p>
<p>Once you know what and where the problem is, it is usually fairly easy to fix
and faster than posting a new question.</p>
<p>See also:</p>
<ul>
<li>Breakpoints</li>
<li>MSDN: How to: Use the Try/Catch Block to Catch Exceptions</li>
<li>MSDN: Best Practices for Exceptions</li>
</ul>
<h3>Examples and Remedies</h3>
<h3>Class Objects / Creating an Instance</h3>
<div class="code"><pre class="code literal-block"><span class="n">Dim</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">CashRegister</span>
<span class="p">...</span>
<span class="n">TextBox1</span><span class="p">.</span><span class="n">Text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">reg</span><span class="p">.</span><span class="n">Amount</span><span class="w">         </span><span class="p">'</span><span class="w"> </span><span class="n">NRE</span>
</pre></div>

<p>The problem is that <code>Dim</code> does not create a CashRegister <em>object</em> ; it only
declares a variable named <code>reg</code> of that Type. <em>Declaring</em> an object variable
and creating an <em>instance</em> are two different things.</p>
<p><strong>Remedy</strong></p>
<p>The <code>New</code> operator can often be used to create the instance when you declare
it:</p>
<div class="code"><pre class="code literal-block"><span class="n">Dim</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="k">As</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">CashRegister</span><span class="w">        </span><span class="s1">' [New] creates instance, invokes the constructor</span>

<span class="s1">'</span><span class="w"> </span><span class="n">Longer</span><span class="p">,</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">explicit</span><span class="w"> </span><span class="nl">form</span><span class="p">:</span>
<span class="n">Dim</span><span class="w"> </span><span class="n">reg</span><span class="w"> </span><span class="k">As</span><span class="w"> </span><span class="n">CashRegister</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">New</span><span class="w"> </span><span class="n">CashRegister</span>
</pre></div>

<p>When it is only appropriate to create the instance later:</p>
<div class="code"><pre class="code literal-block"><span class="n">Private</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">CashRegister</span><span class="w">         </span><span class="p">'</span><span class="w"> </span><span class="n">Declare</span>
<span class="w">  </span><span class="p">...</span>
<span class="kt">reg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New</span><span class="w"> </span><span class="n">CashRegister</span><span class="p">()</span><span class="w">            </span><span class="p">'</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">instance</span>
</pre></div>

<p>Note: <strong>Do not</strong> use <code>Dim</code> again in a procedure, including the constructor
(<code>Sub New</code>):</p>
<div class="code"><pre class="code literal-block"><span class="n">Private</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">CashRegister</span>
<span class="p">'...</span>

<span class="n">Public</span><span class="w"> </span><span class="n">Sub</span><span class="w"> </span><span class="n">New</span><span class="p">()</span>
<span class="w">   </span><span class="p">'...</span>
<span class="w">   </span><span class="n">Dim</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">New</span><span class="w"> </span><span class="n">CashRegister</span>
<span class="n">End</span><span class="w"> </span><span class="n">Sub</span>
</pre></div>

<p>This will create a <em>local</em> variable, <code>reg</code>, which exists only in that context
(sub). The <code>reg</code> variable with module level <code>Scope</code> which you will use
everywhere else remains <code>Nothing</code>.</p>
<blockquote>
<p><strong>Missing the<code>New</code> operator is the #1 cause of <code>NullReference Exceptions</code></strong>
seen in the Stack Overflow questions reviewed.</p>
<p>Visual Basic tries to make the process clear repeatedly using <strong><code>New</code></strong> :
Using the <strong><code>New</code></strong> Operator creates a <strong>new</strong> object and calls <strong><code>Sub
New</code></strong> -- the constructor -- where your object can perform any other
initialization.</p>
</blockquote>
<p>To be clear, <code>Dim</code> (or <code>Private</code>) only <em>declares</em> a variable and its <code>Type</code>.
The <em>Scope</em> of the variable - whether it exists for the entire module/class or
is local to a procedure - is determined by <em>where</em> it is declared. <code>Private |
Friend | Public</code> defines the access level, not <em>Scope</em>.</p>
<p>For more information, see:</p>
<ul>
<li>New Operator</li>
<li>Scope in Visual Basic</li>
<li>Access Levels in Visual Basic</li>
<li>Value Types and Reference Types</li>
</ul>
<hr>
<h3>Arrays</h3>
<p>Arrays must also be instantiated:</p>
<div class="code"><pre class="code literal-block">Private arr as String()
</pre></div>

<p>This array has only been declared, not created. There are several ways to
initialize an array:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Private</span><span class="w"> </span><span class="nv">arr</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">String</span><span class="ss">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">New</span><span class="w"> </span><span class="nv">String</span><span class="ss">(</span><span class="mi">10</span><span class="ss">)</span>{}
<span class="err">' or</span>
<span class="err">Private arr() As String = New String(10){}</span>

<span class="s1">' For a local array (in a procedure) and using '</span><span class="nv">Option</span><span class="w"> </span><span class="nv">Infer</span><span class="err">':</span>
<span class="err">Dim arr = New String(10) {}</span>
</pre></div>

<p>Note: Beginning with VS 2010, when initializing a local array using a literal
and <code>Option Infer</code>, the <code>As &lt;Type&gt;</code> and <code>New</code> elements are optional:</p>
<div class="code"><pre class="code literal-block">Dim myDbl As Double() = {1.5, 2, 9.9, 18, 3.14}
Dim myDbl = New Double() {1.5, 2, 9.9, 18, 3.14}
Dim myDbl() = {1.5, 2, 9.9, 18, 3.14}
</pre></div>

<p>The data Type and array size are inferred from the data being assigned.
Class/Module level declarations still require <code>As &lt;Type&gt;</code> with <code>Option
Strict</code>:</p>
<div class="code"><pre class="code literal-block">Private myDoubles As Double() = {1.5, 2, 9.9, 18, 3.14}
</pre></div>

<p><strong>Example: Array of class objects</strong></p>
<div class="code"><pre class="code literal-block"><span class="nv">Dim</span><span class="w"> </span><span class="nv">arrFoo</span><span class="ss">(</span><span class="mi">5</span><span class="ss">)</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">Foo</span>

<span class="k">For</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">Integer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">To</span><span class="w"> </span><span class="nv">arrFoo</span>.<span class="nv">Count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="nv">arrFoo</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span>.<span class="nv">Bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="w">       </span><span class="err">' Exception</span>
<span class="err">Next</span>
</pre></div>

<p>The array has been created, but the <code>Foo</code> objects in it have not.</p>
<p><strong>Remedy</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">For</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">Integer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">To</span><span class="w"> </span><span class="nv">arrFoo</span>.<span class="nv">Count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nv">arrFoo</span><span class="ss">(</span><span class="nv">i</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">New</span><span class="w"> </span><span class="nv">Foo</span><span class="ss">()</span><span class="w">         </span><span class="err">' Create Foo instance</span>
<span class="err">    arrFoo(i).Bar = i * 10</span>
<span class="err">Next</span>
</pre></div>

<p>Using a <code>List(Of T)</code> will make it quite difficult to have an element without a
valid object:</p>
<div class="code"><pre class="code literal-block"><span class="n">Dim</span><span class="w"> </span><span class="n">FooList</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">New</span><span class="w"> </span><span class="n">List</span><span class="p">(</span><span class="n">Of</span><span class="w"> </span><span class="n">Foo</span><span class="p">)</span><span class="w">     </span><span class="s1">' List created, but it is empty</span>
<span class="n">Dim</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Foo</span><span class="w">                        </span><span class="s1">' Temporary variable for the loop</span>

<span class="n">For</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="mi">5</span>
<span class="w">    </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New</span><span class="w"> </span><span class="n">Foo</span><span class="p">()</span><span class="w">                    </span><span class="s1">' Foo instance created</span>
<span class="w">    </span><span class="n">f</span><span class="o">.</span><span class="n">Bar</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">FooList</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w">                   </span><span class="s1">' Foo object added to list</span>
<span class="n">Next</span>
</pre></div>

<p>For more information, see:</p>
<ul>
<li>Option Infer Statement</li>
<li>Scope in Visual Basic</li>
<li>Arrays in Visual Basic</li>
</ul>
<hr>
<h3>Lists and Collections</h3>
<p>.NET collections (of which there are many varieties - Lists, Dictionary, etc.)
must also be instantiated or created.</p>
<div class="code"><pre class="code literal-block">Private myList As List(Of String)
..
myList.Add("ziggy")           ' NullReference
</pre></div>

<p>You get the same exception for the same reason - <code>myList</code> was only declared,
but no instance created. The remedy is the same:</p>
<div class="code"><pre class="code literal-block">myList = New List(Of String)

' Or create an instance when declared:
Private myList As New List(Of String)
</pre></div>

<p>A common oversight is a class which uses a collection <code>Type</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Public</span><span class="w"> </span><span class="nv">Class</span><span class="w"> </span><span class="nv">Foo</span>
<span class="w">    </span><span class="nv">Private</span><span class="w"> </span><span class="nv">barList</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">List</span><span class="ss">(</span><span class="nv">Of</span><span class="w"> </span><span class="nv">Bar</span><span class="ss">)</span>

<span class="w">    </span><span class="nv">Friend</span><span class="w"> </span><span class="nv">Function</span><span class="w"> </span><span class="nv">BarCount</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">Integer</span>
<span class="w">        </span><span class="k">Return</span><span class="w"> </span><span class="nv">barList</span>.<span class="nv">Count</span>
<span class="w">    </span><span class="k">End</span><span class="w"> </span><span class="nv">Function</span>

<span class="w">    </span><span class="nv">Friend</span><span class="w"> </span><span class="nv">Sub</span><span class="w"> </span><span class="nv">AddItem</span><span class="ss">(</span><span class="nv">newBar</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">Bar</span><span class="ss">)</span>
<span class="w">        </span><span class="k">If</span><span class="w"> </span><span class="nv">barList</span>.<span class="nv">Contains</span><span class="ss">(</span><span class="nv">newBar</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">False</span><span class="w"> </span><span class="k">Then</span>
<span class="w">            </span><span class="nv">barList</span>.<span class="nv">Add</span><span class="ss">(</span><span class="nv">newBar</span><span class="ss">)</span>
<span class="w">        </span><span class="k">End</span><span class="w"> </span><span class="k">If</span>
<span class="w">    </span><span class="k">End</span><span class="w"> </span><span class="nv">Function</span>
</pre></div>

<p>Either procedure will result in an NRE, because <code>barList</code> is only declared,
not instantiated. Creating an instance of <code>Foo</code> will not also create an
instance of the internal <code>barList</code>. It may have been the intent to do this in
the constructor:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Public</span><span class="w"> </span><span class="nv">Sub</span><span class="w"> </span><span class="nv">New</span><span class="w">         </span><span class="err">' Constructor</span>
<span class="w">    </span><span class="err">' Stuff to do when a new Foo is created...</span>
<span class="err">    barList = New List(Of Bar)</span>
<span class="err">End Sub</span>
</pre></div>

<p>As before, this is incorrect:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Public</span><span class="w"> </span><span class="nv">Sub</span><span class="w"> </span><span class="nv">New</span><span class="ss">()</span>
<span class="w">    </span><span class="err">' Creates another barList local to this procedure</span>
<span class="err">     Dim barList As New List(Of Bar)</span>
<span class="err">End Sub</span>
</pre></div>

<p>For more information, see <code>List(Of T)</code> Class.</p>
<hr>
<h3>Data Provider Objects</h3>
<p>Working with databases presents many opportunities for a NullReference because
there can be many objects (<code>Command</code>, <code>Connection</code>, <code>Transaction</code>, <code>Dataset</code>,
<code>DataTable</code>, <code>DataRows</code>....) in use at once. <strong>Note:</strong> It does not matter
which data provider you are using -- MySQL, SQL Server, OleDB, etc. -- the
<em>concepts</em> are the same.</p>
<p><strong>Example 1</strong></p>
<div class="code"><pre class="code literal-block">Dim da As OleDbDataAdapter
Dim ds As DataSet
Dim MaxRows As Integer

con.Open()
Dim sql = "SELECT * FROM tblfoobar_List"
da = New OleDbDataAdapter(sql, con)
da.Fill(ds, "foobar")
con.Close()

MaxRows = ds.Tables("foobar").Rows.Count      ' Error
</pre></div>

<p>As before, the <code>ds</code> Dataset object was declared, but an instance was never
created. The <code>DataAdapter</code> will fill an existing <code>DataSet</code>, not create one. In
this case, since <code>ds</code> is a local variable, <em>the IDE warns you</em> that this might
happen:</p>
<p><img alt="img" src="../../images/E5d94.jpg"></p>
<p>When declared as a module/class level variable, as appears to be the case with
<code>con</code>, the compiler can't know if the object was created by an upstream
procedure. Do not ignore warnings.</p>
<p><strong>Remedy</strong></p>
<div class="code"><pre class="code literal-block">Dim ds As New DataSet
</pre></div>

<p><strong>Example 2</strong></p>
<div class="code"><pre class="code literal-block">ds = New DataSet
da = New OleDBDataAdapter(sql, con)
da.Fill(ds, "Employees")

txtID.Text = ds.Tables("Employee").Rows(0).Item(1)
txtID.Name = ds.Tables("Employee").Rows(0).Item(2)
</pre></div>

<p>A typo is a problem here: <code>Employees</code> vs <code>Employee</code>. There was no <code>DataTable</code>
named "Employee" created, so a <code>NullReferenceException</code> results trying to
access it. Another potential problem is assuming there will be <code>Items</code> which
may not be so when the SQL includes a WHERE clause.</p>
<p><strong>Remedy</strong></p>
<p>Since this uses one table, using <code>Tables(0)</code> will avoid spelling errors.
Examining <code>Rows.Count</code> can also help:</p>
<div class="code"><pre class="code literal-block"><span class="k">If</span><span class="w"> </span><span class="nv">ds</span>.<span class="nv">Tables</span><span class="ss">(</span><span class="mi">0</span><span class="ss">)</span>.<span class="nv">Rows</span>.<span class="nv">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">Then</span>
<span class="w">    </span><span class="nv">txtID</span>.<span class="nv">Text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ds</span>.<span class="nv">Tables</span><span class="ss">(</span><span class="mi">0</span><span class="ss">)</span>.<span class="nv">Rows</span><span class="ss">(</span><span class="mi">0</span><span class="ss">)</span>.<span class="nv">Item</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">txtID</span>.<span class="nv">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ds</span>.<span class="nv">Tables</span><span class="ss">(</span><span class="mi">0</span><span class="ss">)</span>.<span class="nv">Rows</span><span class="ss">(</span><span class="mi">0</span><span class="ss">)</span>.<span class="nv">Item</span><span class="ss">(</span><span class="mi">2</span><span class="ss">)</span>
<span class="k">End</span><span class="w"> </span><span class="k">If</span>
</pre></div>

<p><code>Fill</code> is a function returning the number of <code>Rows</code> affected which can also be
tested:</p>
<div class="code"><pre class="code literal-block"><span class="k">If</span><span class="w"> </span><span class="nv">da</span>.<span class="nv">Fill</span><span class="ss">(</span><span class="nv">ds</span>,<span class="w"> </span><span class="s2">"Employees"</span><span class="ss">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">Then</span>...
</pre></div>

<p><strong>Example 3</strong></p>
<div class="code"><pre class="code literal-block"><span class="nv">Dim</span><span class="w"> </span><span class="nv">da</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">New</span><span class="w"> </span><span class="nv">OleDb</span>.<span class="nv">OleDbDataAdapter</span><span class="ss">(</span><span class="err">"SELECT TICKET.TICKET_NO,</span>
<span class="err">        TICKET.CUSTOMER_ID, ... FROM TICKET_RESERVATION AS TICKET INNER JOIN</span>
<span class="w">        </span><span class="nv">FLIGHT_DETAILS</span><span class="w"> </span><span class="nv">AS</span><span class="w"> </span><span class="nv">FLIGHT</span><span class="w"> </span>...<span class="w"> </span><span class="nv">WHERE</span><span class="w"> </span>[<span class="nv">TICKET</span>.<span class="nv">TICKET_NO</span>]<span class="o">=</span><span class="w"> </span>...<span class="err">", con)</span>
<span class="err">Dim ds As New DataSet</span>
<span class="err">da.Fill(ds)</span>

<span class="k">If</span><span class="w"> </span><span class="nv">ds</span>.<span class="nv">Tables</span><span class="ss">(</span><span class="s2">"TICKET_RESERVATION"</span><span class="ss">)</span>.<span class="nv">Rows</span>.<span class="nv">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">Then</span>
</pre></div>

<p>The <code>DataAdapter</code> will provide <code>TableNames</code> as shown in the previous example,
but it does not parse names from the SQL or database table. As a result,
<code>ds.Tables("TICKET_RESERVATION")</code> references a non-existent table.</p>
<p>The <strong>Remedy</strong> is the same, reference the table by index:</p>
<div class="code"><pre class="code literal-block"><span class="k">If</span><span class="w"> </span><span class="nv">ds</span>.<span class="nv">Tables</span><span class="ss">(</span><span class="mi">0</span><span class="ss">)</span>.<span class="nv">Rows</span>.<span class="nv">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">Then</span>
</pre></div>

<p>See also DataTable Class.</p>
<hr>
<h3>Object Paths / Nested</h3>
<div class="code"><pre class="code literal-block"><span class="k">If</span><span class="w"> </span><span class="nv">myFoo</span>.<span class="nv">Bar</span>.<span class="nv">Items</span><span class="w"> </span><span class="nv">IsNot</span><span class="w"> </span><span class="nv">Nothing</span><span class="w"> </span><span class="k">Then</span>
<span class="w">   </span>...
</pre></div>

<p>The code is only testing <code>Items</code> while both <code>myFoo</code> and <code>Bar</code> may also be
Nothing. The <strong>remedy</strong> is to test the entire chain or path of objects one at
a time:</p>
<div class="code"><pre class="code literal-block"><span class="k">If</span><span class="w"> </span><span class="ss">(</span><span class="nv">myFoo</span><span class="w"> </span><span class="nv">IsNot</span><span class="w"> </span><span class="nv">Nothing</span><span class="ss">)</span><span class="w"> </span><span class="nv">AndAlso</span>
<span class="w">    </span><span class="ss">(</span><span class="nv">myFoo</span>.<span class="nv">Bar</span><span class="w"> </span><span class="nv">IsNot</span><span class="w"> </span><span class="nv">Nothing</span><span class="ss">)</span><span class="w"> </span><span class="nv">AndAlso</span>
<span class="w">    </span><span class="ss">(</span><span class="nv">myFoo</span>.<span class="nv">Bar</span>.<span class="nv">Items</span><span class="w"> </span><span class="nv">IsNot</span><span class="w"> </span><span class="nv">Nothing</span><span class="ss">)</span><span class="w"> </span><span class="k">Then</span>
<span class="w">    </span>....
</pre></div>

<p><code>AndAlso</code> is important. Subsequent tests will not be performed once the first
<code>False</code> condition is encountered. This allows the code to safely 'drill' into
the object(s) one 'level' at a time, evaluating <code>myFoo.Bar</code> only after (and
if) <code>myFoo</code> is determined to be valid. Object chains or paths can get quite
long when coding complex objects:</p>
<div class="code"><pre class="code literal-block">myBase.myNodes(3).Layer.SubLayer.Foo.Files.Add("somefilename")
</pre></div>

<p>It is not possible to reference anything 'downstream' of a <code>null</code> object. This
also applies to controls:</p>
<div class="code"><pre class="code literal-block">myWebBrowser.Document.GetElementById("formfld1").InnerText = "some value"
</pre></div>

<p>Here, <code>myWebBrowser</code> or <code>Document</code> could be Nothing or the <code>formfld1</code> element
may not exist.</p>
<hr>
<h3>UI Controls</h3>
<div class="code"><pre class="code literal-block">Dim cmd5 As New SqlCommand("select Cartons, Pieces, Foobar " _
     &amp; "FROM Invoice where invoice_no = '" &amp; _
     Me.ComboBox5.SelectedItem.ToString.Trim &amp; "' And category = '" &amp; _
     Me.ListBox1.SelectedItem.ToString.Trim &amp; "' And item_name = '" &amp; _
     Me.ComboBox2.SelectedValue.ToString.Trim &amp; "' And expiry_date = '" &amp; _
     Me.expiry.Text &amp; "'", con)
</pre></div>

<p>Among other things, this code does not anticipate that the user may not have
selected something in one or more UI controls. <code>ListBox1.SelectedItem</code> may
well be <code>Nothing</code>, so <code>ListBox1.SelectedItem.ToString</code> will result in an NRE.</p>
<p><strong>Remedy</strong></p>
<p>Validate data before using it (also use <code>Option Strict</code> and SQL parameters):</p>
<div class="code"><pre class="code literal-block"><span class="nv">Dim</span><span class="w"> </span><span class="nv">expiry</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">DateTime</span><span class="w">         </span><span class="err">' for text date validation</span>
<span class="err">If (ComboBox5.SelectedItems.Count &gt; 0) AndAlso</span>
<span class="err">    (ListBox1.SelectedItems.Count &gt; 0) AndAlso</span>
<span class="err">    (ComboBox2.SelectedItems.Count &gt; 0) AndAlso</span>
<span class="err">    (DateTime.TryParse(expiry.Text, expiry) Then</span>

<span class="w">    </span><span class="err">'... do stuff</span>
<span class="err">Else</span>
<span class="err">    MessageBox.Show(...error message...)</span>
<span class="err">End If</span>
</pre></div>

<p>Alternatively, you can use <code>(ComboBox5.SelectedItem IsNot Nothing) AndAlso...</code></p>
<hr>
<h3>Visual Basic Forms</h3>
<div class="code"><pre class="code literal-block"><span class="n">Public</span><span class="w"> </span><span class="n">Class</span><span class="w"> </span><span class="n">Form1</span>

<span class="w">    </span><span class="n">Private</span><span class="w"> </span><span class="n">NameBoxes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New</span><span class="w"> </span><span class="n">TextBox</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">Controls</span><span class="p">(</span><span class="s2">"TextBox1"</span><span class="p">),</span><span class="w"> </span><span class="n">_</span>
<span class="w">                   </span><span class="n">Controls</span><span class="p">(</span><span class="s2">"TextBox2"</span><span class="p">),</span><span class="w"> </span><span class="n">Controls</span><span class="p">(</span><span class="s2">"TextBox3"</span><span class="p">),</span><span class="w"> </span><span class="n">_</span>
<span class="w">                   </span><span class="n">Controls</span><span class="p">(</span><span class="s2">"TextBox4"</span><span class="p">),</span><span class="w"> </span><span class="n">Controls</span><span class="p">(</span><span class="s2">"TextBox5"</span><span class="p">),</span><span class="w"> </span><span class="n">_</span>
<span class="w">                   </span><span class="n">Controls</span><span class="p">(</span><span class="s2">"TextBox6"</span><span class="p">)}</span>

<span class="w">    </span><span class="s1">' same thing in a different format:</span>
<span class="w">    </span><span class="n">Private</span><span class="w"> </span><span class="n">boxList</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="n">New</span><span class="w"> </span><span class="n">List</span><span class="p">(</span><span class="n">Of</span><span class="w"> </span><span class="n">TextBox</span><span class="p">)</span><span class="w"> </span><span class="n">From</span><span class="w"> </span><span class="p">{</span><span class="n">TextBox1</span><span class="p">,</span><span class="w"> </span><span class="n">TextBox2</span><span class="p">,</span><span class="w"> </span><span class="n">TextBox3</span><span class="w"> </span><span class="o">...</span><span class="p">}</span>

<span class="w">    </span><span class="s1">' Immediate NRE:</span>
<span class="w">    </span><span class="n">Private</span><span class="w"> </span><span class="n">somevar</span><span class="w"> </span><span class="n">As</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Me</span><span class="o">.</span><span class="n">Controls</span><span class="p">(</span><span class="s2">"TextBox1"</span><span class="p">)</span><span class="o">.</span><span class="n">Text</span>
</pre></div>

<p>This is a fairly common way to get an NRE. In C#, depending on how it is
coded, the IDE will report that <code>Controls</code> does not exist in the current
context, or "cannot reference non-static member". So, to some extent, this is
a VB-only situation. It is also complex because it can result in a failure
cascade.</p>
<p><em>The arrays and collections cannot be initialized this way.</em> This
initialization code will run <em>before</em> the constructor creates the <code>Form</code> or
the <code>Controls</code>. As a result:</p>
<ul>
<li>Lists and Collection will simply be empty</li>
<li>The Array will contain five elements of Nothing</li>
<li>The <code>somevar</code> assignment will result in an immediate NRE because Nothing doesn't have a <code>.Text</code> property</li>
</ul>
<p>Referencing array elements later will result in an NRE. If you do this in
<code>Form_Load</code>, due to an odd bug, the IDE <em>may not</em> report the exception when it
happens. The exception will pop up <em>later</em> when your code tries to use the
array. This "silent exception" is detailed in this post. For our purposes, the
key is that when something catastrophic happens while creating a form (<code>Sub
New</code> or <code>Form Load</code> event), exceptions may go unreported, the code exits the
procedure and just displays the form.</p>
<p>Since no other code in your <code>Sub New</code> or <code>Form Load</code> event will run after the
NRE, <em>a great many other things</em> can be left uninitialized.</p>
<div class="code"><pre class="code literal-block"><span class="nv">Sub</span><span class="w"> </span><span class="nv">Form_Load</span><span class="ss">(</span>...<span class="nv">_</span>
<span class="w">   </span><span class="err">'...</span>
<span class="w">   </span><span class="nv">Dim</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">NameBoxes</span><span class="ss">(</span><span class="mi">2</span><span class="ss">)</span>.<span class="nv">Text</span><span class="w">        </span><span class="err">' NRE</span>
<span class="w">   </span><span class="err">' ...</span>
<span class="w">   </span><span class="err">' More code (which will likely not be executed)</span>
<span class="w">   </span><span class="err">' ...</span>
<span class="err">End Sub</span>
</pre></div>

<p><strong>Note</strong> this applies to any and all control and component references making
these illegal where they are:</p>
<div class="code"><pre class="code literal-block">Public Class Form1

    Private myFiles() As String = Me.OpenFileDialog1.FileName &amp; ...
    Private dbcon As String = OpenFileDialog1.FileName &amp; ";Jet Oledb..."
    Private studentName As String = TextBox13.Text
</pre></div>

<p><strong>Partial Remedy</strong></p>
<p>It is curious that VB does not provide a warning, but the remedy is to
<strong>declare</strong> the containers at the form level, but <strong>initialize</strong> them in form
load event handler when the controls <strong>do</strong> exist. This can be done in <code>Sub
New</code> as long as your code is after the <code>InitializeComponent</code> call:</p>
<div class="code"><pre class="code literal-block"><span class="err">' Module level declaration</span>
<span class="err">Private NameBoxes as TextBox()</span>
<span class="err">Private studentName As String</span>

<span class="err">' Form Load, Form Shown or Sub New:</span>
<span class="err">'</span>
<span class="s1">' Using the OP'</span><span class="nv">s</span><span class="w"> </span><span class="nv">approach</span><span class="w"> </span><span class="ss">(</span><span class="nv">illegal</span><span class="w"> </span><span class="nv">using</span><span class="w"> </span><span class="nv">OPTION</span><span class="w"> </span><span class="nv">STRICT</span><span class="ss">)</span>
<span class="nv">NameBoxes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">New</span><span class="w"> </span><span class="nv">TextBox</span><span class="ss">()</span><span class="w"> </span>{<span class="nv">Me</span>.<span class="nv">Controls</span><span class="ss">(</span><span class="s2">"TextBox1"</span><span class="ss">)</span>,<span class="w"> </span><span class="nv">Me</span>.<span class="nv">Controls</span><span class="ss">(</span><span class="s2">"TestBox2"</span><span class="ss">)</span>,<span class="w"> </span>...<span class="ss">)</span>
<span class="nv">studentName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">TextBox32</span>.<span class="nv">Text</span><span class="w">           </span><span class="err">' For simple control references</span>
</pre></div>

<p>The array code may not be out of the woods yet. Any controls which are in a
container control (like a <code>GroupBox</code> or <code>Panel</code>) will not be found in
<code>Me.Controls</code>; they will be in the Controls collection of that Panel or
GroupBox. Nor will a control be returned when the control name is misspelled
(<code>"TeStBox2"</code>). In such cases, <code>Nothing</code> will again be stored in those array
elements and an NRE will result when you attempt to reference it.</p>
<p>These should be easy to find now that you know what you are looking for: <img alt="VS
shows you the error of your ways" src="../../images/5ndSA.jpg"></p>
<p>"Button2" resides on a <code>Panel</code></p>
<p><strong>Remedy</strong></p>
<p>Rather than indirect references by name using the form's <code>Controls</code>
collection, use the control reference:</p>
<div class="code"><pre class="code literal-block">' Declaration
Private NameBoxes As TextBox()

' Initialization -  simple and easy to read, hard to botch:
NameBoxes = New TextBox() {TextBox1, TextBox2, ...)

' Initialize a List
NamesList = New List(Of TextBox)({TextBox1, TextBox2, TextBox3...})
' or
NamesList = New List(Of TextBox)
NamesList.AddRange({TextBox1, TextBox2, TextBox3...})
</pre></div>

<hr>
<h3>Function Returning Nothing</h3>
<div class="code"><pre class="code literal-block"><span class="nv">Private</span><span class="w"> </span><span class="nv">bars</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">New</span><span class="w"> </span><span class="nv">List</span><span class="ss">(</span><span class="nv">Of</span><span class="w"> </span><span class="nv">Bars</span><span class="ss">)</span><span class="w">        </span><span class="err">' Declared and created</span>

<span class="err">Public Function BarList() As List(Of Bars)</span>
<span class="err">    bars.Clear</span>
<span class="err">    If someCondition Then</span>
<span class="err">        For n As Integer = 0 to someValue</span>
<span class="err">            bars.Add(GetBar(n))</span>
<span class="err">        Next n</span>
<span class="err">    Else</span>
<span class="err">        Exit Function</span>
<span class="err">    End If</span>

<span class="err">    Return bars</span>
<span class="err">End Function</span>
</pre></div>

<p>This is a case where the IDE will warn you that ' <em>not all paths return a
value and a<code>NullReferenceException</code> may result</em>'. You can suppress the
warning, by replacing <code>Exit Function</code> with <code>Return Nothing</code>, but that does not
solve the problem. Anything which tries to use the return when <code>someCondition
= False</code> will result in an NRE:</p>
<div class="code"><pre class="code literal-block"><span class="nv">bList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">myFoo</span>.<span class="nv">BarList</span><span class="ss">()</span>
<span class="k">For</span><span class="w"> </span><span class="nv">Each</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">Bar</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">bList</span><span class="w">      </span><span class="err">' EXCEPTION</span>
<span class="err">      ...</span>
</pre></div>

<p><strong>Remedy</strong></p>
<p>Replace <code>Exit Function</code> in the function with <code>Return bList</code>. Returning an
<em>empty</em> <code>List</code> is not the same as returning <code>Nothing</code>. If there is a chance
that a returned object can be <code>Nothing</code>, test before using it:</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="nv">bList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">myFoo</span>.<span class="nv">BarList</span><span class="ss">()</span>
<span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="nv">bList</span><span class="w"> </span><span class="nv">IsNot</span><span class="w"> </span><span class="nv">Nothing</span><span class="w"> </span><span class="k">Then</span>...
</pre></div>

<hr>
<h3>Poorly Implemented Try/Catch</h3>
<p>A badly implemented Try/Catch can hide where the problem is and result in new
ones:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Dim</span><span class="w"> </span><span class="nv">dr</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">SqlDataReader</span>
<span class="nv">Try</span>
<span class="w">    </span><span class="nv">Dim</span><span class="w"> </span><span class="nv">lnk</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">LinkButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">TryCast</span><span class="ss">(</span><span class="nv">sender</span>,<span class="w"> </span><span class="nv">LinkButton</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">Dim</span><span class="w"> </span><span class="nv">gr</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">GridViewRow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">DirectCast</span><span class="ss">(</span><span class="nv">lnk</span>.<span class="nv">NamingContainer</span>,<span class="w"> </span><span class="nv">GridViewRow</span><span class="ss">)</span>
<span class="w">    </span><span class="nv">Dim</span><span class="w"> </span><span class="nv">eid</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">GridView1</span>.<span class="nv">DataKeys</span><span class="ss">(</span><span class="nv">gr</span>.<span class="nv">RowIndex</span><span class="ss">)</span>.<span class="nv">Value</span>.<span class="nv">ToString</span><span class="ss">()</span>
<span class="w">    </span><span class="nv">ViewState</span><span class="ss">(</span><span class="s2">"username"</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">eid</span>
<span class="w">    </span><span class="nv">sqlQry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">"select FirstName, Surname, DepartmentName, ExtensionName, jobTitle,</span>
<span class="w">             </span><span class="nv">Pager</span>,<span class="w"> </span><span class="nv">mailaddress</span>,<span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">employees1</span><span class="w"> </span><span class="nv">where</span><span class="w"> </span><span class="nv">username</span><span class="o">=</span><span class="s1">'" &amp; eid &amp; "'</span><span class="err">"</span>
<span class="err">    If connection.State &lt;&gt; ConnectionState.Open Then</span>
<span class="err">        connection.Open()</span>
<span class="err">    End If</span>
<span class="err">    command = New SqlCommand(sqlQry, connection)</span>

<span class="err">    'More code fooing and barring</span>

<span class="err">    dr = command.ExecuteReader()</span>
<span class="err">    If dr.Read() Then</span>
<span class="w">        </span><span class="nv">lblFirstName</span>.<span class="nv">Text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Convert</span>.<span class="nv">ToString</span><span class="ss">(</span><span class="nv">dr</span><span class="ss">(</span><span class="s2">"FirstName"</span><span class="ss">))</span>
<span class="w">        </span>...
<span class="w">    </span><span class="k">End</span><span class="w"> </span><span class="k">If</span>
<span class="w">    </span><span class="nv">mpe</span>.<span class="k">Show</span><span class="ss">()</span>
<span class="nv">Catch</span>

<span class="nv">Finally</span>
<span class="w">    </span><span class="nv">command</span>.<span class="nv">Dispose</span><span class="ss">()</span>
<span class="w">    </span><span class="nv">dr</span>.<span class="nv">Close</span><span class="ss">()</span><span class="w">             </span><span class="err">' &lt;-- NRE</span>
<span class="err">    connection.Close()</span>
<span class="err">End Try</span>
</pre></div>

<p>This is a case of an object not being created as expected, but also
demonstrates the counter usefulness of an empty <code>Catch</code>.</p>
<p>There is an extra comma in the SQL (after 'mailaddress') which results in an
exception at <code>.ExecuteReader</code>. After the <code>Catch</code> does nothing, <code>Finally</code> tries
to perform clean up, but since you cannot <code>Close</code> a null <code>DataReader</code> object,
a brand new <code>NullReferenceException</code> results.</p>
<p>An empty <code>Catch</code> block is the devil's playground. This OP was baffled why he
was getting an NRE in the <code>Finally</code> block. In other situations, an empty
<code>Catch</code> may result in something else much further downstream going haywire and
cause you to spend time looking at the wrong things in the wrong place for the
problem. (The "silent exception" described above provides the same
entertainment value.)</p>
<p><strong>Remedy</strong></p>
<p>Don't use empty Try/Catch blocks - let the code crash so you can a) identify
the cause b) identify the location and c) apply a proper remedy. Try/Catch
blocks are not intended to hide exceptions from the person uniquely qualified
to fix them - the developer.</p>
<hr>
<h3>DBNull is not the same as Nothing</h3>
<div class="code"><pre class="code literal-block"><span class="k">For</span><span class="w"> </span><span class="nv">Each</span><span class="w"> </span><span class="nv">row</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">DataGridViewRow</span><span class="w"> </span><span class="nv">In</span><span class="w"> </span><span class="nv">dgvPlanning</span>.<span class="nv">Rows</span>
<span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="nv">Not</span><span class="w"> </span><span class="nv">IsDBNull</span><span class="ss">(</span><span class="nv">row</span>.<span class="nv">Cells</span><span class="ss">(</span><span class="mi">0</span><span class="ss">)</span>.<span class="nv">Value</span><span class="ss">)</span><span class="w"> </span><span class="k">Then</span>
<span class="w">        </span>...
</pre></div>

<p>The <code>IsDBNull</code> function is used to test if a <em>value</em> equals <code>System.DBNull</code>:
From MSDN:</p>
<blockquote>
<p>The System.DBNull value indicates that the Object represents missing or non-
existent data. DBNull is not the same as Nothing, which indicates that a
variable has not yet been initialized.</p>
</blockquote>
<p><strong>Remedy</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">If</span><span class="w"> </span><span class="nv">row</span>.<span class="nv">Cells</span><span class="ss">(</span><span class="mi">0</span><span class="ss">)</span><span class="w"> </span><span class="nv">IsNot</span><span class="w"> </span><span class="nv">Nothing</span><span class="w"> </span><span class="k">Then</span><span class="w"> </span>...
</pre></div>

<p>As before, you can test for Nothing, then for a specific value:</p>
<div class="code"><pre class="code literal-block"><span class="k">If</span><span class="w"> </span><span class="ss">(</span><span class="nv">row</span>.<span class="nv">Cells</span><span class="ss">(</span><span class="mi">0</span><span class="ss">)</span><span class="w"> </span><span class="nv">IsNot</span><span class="w"> </span><span class="nv">Nothing</span><span class="ss">)</span><span class="w"> </span><span class="nv">AndAlso</span><span class="w"> </span><span class="ss">(</span><span class="nv">IsDBNull</span><span class="ss">(</span><span class="nv">row</span>.<span class="nv">Cells</span><span class="ss">(</span><span class="mi">0</span><span class="ss">)</span>.<span class="nv">Value</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">False</span><span class="ss">)</span><span class="w"> </span><span class="k">Then</span>
</pre></div>

<p><strong>Example 2</strong></p>
<div class="code"><pre class="code literal-block"><span class="nv">Dim</span><span class="w"> </span><span class="nv">getFoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">(</span><span class="nv">From</span><span class="w"> </span><span class="nv">f</span><span class="w"> </span><span class="nv">In</span><span class="w"> </span><span class="nv">dbContext</span>.<span class="nv">FooBars</span>
<span class="w">               </span><span class="nv">Where</span><span class="w"> </span><span class="nv">f</span>.<span class="nv">something</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">something</span>
<span class="w">               </span><span class="nv">Select</span><span class="w"> </span><span class="nv">f</span><span class="ss">)</span>.<span class="nv">FirstOrDefault</span>

<span class="k">If</span><span class="w"> </span><span class="nv">Not</span><span class="w"> </span><span class="nv">IsDBNull</span><span class="ss">(</span><span class="nv">getFoo</span><span class="ss">)</span><span class="w"> </span><span class="k">Then</span>
<span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="nv">IsDBNull</span><span class="ss">(</span><span class="nv">getFoo</span>.<span class="nv">user_id</span><span class="ss">)</span><span class="w"> </span><span class="k">Then</span>
<span class="w">        </span><span class="nv">txtFirst</span>.<span class="nv">Text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">getFoo</span>.<span class="nv">first_name</span>
<span class="w">    </span><span class="k">Else</span>
<span class="w">       </span>...
</pre></div>

<p><code>FirstOrDefault</code> returns the first item or the default value, which is
<code>Nothing</code> for reference types and never <code>DBNull</code>:</p>
<div class="code"><pre class="code literal-block"><span class="k">If</span><span class="w"> </span><span class="nv">getFoo</span><span class="w"> </span><span class="nv">IsNot</span><span class="w"> </span><span class="nv">Nothing</span><span class="w"> </span><span class="k">Then</span>...
</pre></div>

<hr>
<h3>Controls</h3>
<div class="code"><pre class="code literal-block"><span class="nv">Dim</span><span class="w"> </span><span class="nv">chk</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">CheckBox</span>

<span class="nv">chk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CType</span><span class="ss">(</span><span class="nv">Me</span>.<span class="nv">Controls</span><span class="ss">(</span><span class="nv">chkName</span><span class="ss">)</span>,<span class="w"> </span><span class="nv">CheckBox</span><span class="ss">)</span>
<span class="k">If</span><span class="w"> </span><span class="nv">chk</span>.<span class="nv">Checked</span><span class="w"> </span><span class="k">Then</span>
<span class="w">    </span><span class="k">Return</span><span class="w"> </span><span class="nv">chk</span>
<span class="k">End</span><span class="w"> </span><span class="k">If</span>
</pre></div>

<p>If a <code>CheckBox</code> with <code>chkName</code> can't be found (or exists in a <code>GroupBox</code>),
then <code>chk</code> will be Nothing and be attempting to reference any property will
result in an exception.</p>
<p><strong>Remedy</strong></p>
<div class="code"><pre class="code literal-block"><span class="k">If</span><span class="w"> </span><span class="ss">(</span><span class="nv">chk</span><span class="w"> </span><span class="nv">IsNot</span><span class="w"> </span><span class="nv">Nothing</span><span class="ss">)</span><span class="w"> </span><span class="nv">AndAlso</span><span class="w"> </span><span class="ss">(</span><span class="nv">chk</span>.<span class="nv">Checked</span><span class="ss">)</span><span class="w"> </span><span class="k">Then</span><span class="w"> </span>...
</pre></div>

<h4>The DataGridView</h4>
<p>The DGV has a few quirks seen periodically:</p>
<div class="code"><pre class="code literal-block">dgvBooks.DataSource = loan.Books
dgvBooks.Columns("ISBN").Visible = True       ' NullReferenceException
dgvBooks.Columns("Title").DefaultCellStyle.Format = "C"
dgvBooks.Columns("Author").DefaultCellStyle.Format = "C"
dgvBooks.Columns("Price").DefaultCellStyle.Format = "C"
</pre></div>

<p>If <code>dgvBooks</code> has <code>AutoGenerateColumns = True</code>, it will create the columns,
but it does not name them, so the above code fails when it references them by
name.</p>
<p><strong>Remedy</strong></p>
<p>Name the columns manually, or reference by index:</p>
<div class="code"><pre class="code literal-block">dgvBooks.Columns(0).Visible = True
</pre></div>

<h4>Example 2 — Beware of the NewRow</h4>
<div class="code"><pre class="code literal-block"><span class="nv">xlWorkSheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">xlWorkBook</span>.<span class="nv">Sheets</span><span class="ss">(</span><span class="s2">"sheet1"</span><span class="ss">)</span>

<span class="k">For</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">To</span><span class="w"> </span><span class="nv">myDGV</span>.<span class="nv">RowCount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">For</span><span class="w"> </span><span class="nv">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">To</span><span class="w"> </span><span class="nv">myDGV</span>.<span class="nv">ColumnCount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="k">For</span><span class="w"> </span><span class="nv">k</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">Integer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">To</span><span class="w"> </span><span class="nv">myDGV</span>.<span class="nv">Columns</span>.<span class="nv">Count</span>
<span class="w">            </span><span class="nv">xlWorkSheet</span>.<span class="nv">Cells</span><span class="ss">(</span><span class="mi">1</span>,<span class="w"> </span><span class="nv">k</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">myDGV</span>.<span class="nv">Columns</span><span class="ss">(</span><span class="nv">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span>.<span class="nv">HeaderText</span>
<span class="w">            </span><span class="nv">xlWorkSheet</span>.<span class="nv">Cells</span><span class="ss">(</span><span class="nv">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>,<span class="w"> </span><span class="nv">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">myDGV</span><span class="ss">(</span><span class="nv">j</span>,<span class="w"> </span><span class="nv">i</span><span class="ss">)</span>.<span class="nv">Value</span>.<span class="nv">ToString</span><span class="ss">()</span>
<span class="w">        </span><span class="k">Next</span>
<span class="w">    </span><span class="k">Next</span>
<span class="k">Next</span>
</pre></div>

<p>When your <code>DataGridView</code> has <code>AllowUserToAddRows</code> as <code>True</code> (the default), the
<code>Cells</code> in the blank/new row at the bottom will all contain <code>Nothing</code>. Most
attempts to use the contents (for example, <code>ToString</code>) will result in an NRE.</p>
<p><strong>Remedy</strong></p>
<p>Use a <code>For/Each</code> loop and test the <code>IsNewRow</code> property to determine if it is
that last row. This works whether <code>AllowUserToAddRows</code> is true or not:</p>
<div class="code"><pre class="code literal-block"><span class="k">For</span><span class="w"> </span><span class="nv">Each</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="nv">As</span><span class="w"> </span><span class="nv">DataGridViewRow</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">myDGV</span>.<span class="nv">Rows</span>
<span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="nv">r</span>.<span class="nv">IsNewRow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">False</span><span class="w"> </span><span class="k">Then</span>
<span class="w">         </span><span class="err">' ok to use this row</span>
</pre></div>

<p>If you do use a <code>For n</code> loop, modify the row count or use <code>Exit For</code> when
<code>IsNewRow</code> is true.</p>
<hr>
<h3>My.Settings (StringCollection)</h3>
<p>Under certain circumstances, trying to use an item from <code>My.Settings</code> which is
a <code>StringCollection</code> can result in a NullReference the first time you use it.
The solution is the same, but not as obvious. Consider:</p>
<div class="code"><pre class="code literal-block">My.Settings.FooBars.Add("ziggy")         ' foobars is a string collection
</pre></div>

<p>Since VB is managing Settings for you, it is reasonable to expect it to
initialize the collection. It will, but only if you have previously added an
initial entry to the collection (in the Settings editor). Since the collection
is (apparently) initialized when an item is added, it remains <code>Nothing</code> when
there are no items in the Settings editor to add.</p>
<p><strong>Remedy</strong></p>
<p>Initialize the settings collection in the form's <code>Load</code> event handler, if/when
needed:</p>
<div class="code"><pre class="code literal-block"><span class="k">If</span><span class="w"> </span><span class="nv">My</span>.<span class="nv">Settings</span>.<span class="nv">FooBars</span><span class="w"> </span><span class="nv">Is</span><span class="w"> </span><span class="nv">Nothing</span><span class="w"> </span><span class="k">Then</span>
<span class="w">    </span><span class="nv">My</span>.<span class="nv">Settings</span>.<span class="nv">FooBars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">New</span><span class="w"> </span><span class="nv">System</span>.<span class="nv">Collections</span>.<span class="nv">Specialized</span>.<span class="nv">StringCollection</span>
<span class="k">End</span><span class="w"> </span><span class="k">If</span>
</pre></div>

<p>Typically, the <code>Settings</code> collection will only need to be initialized the
first time the application runs. An alternate remedy is to add an initial
value to your collection in <strong>Project - &gt; Settings | FooBars</strong>, save the
project, then remove the fake value.</p>
<hr>
<h2>Key Points</h2>
<p>You probably forgot the <code>New</code> operator.</p>
<p>or</p>
<p>Something you assumed would perform flawlessly to return an initialized object
to your code, did not.</p>
<p>Don't ignore compiler warnings (ever) and use <code>Option Strict On</code> (always).</p>
<hr>
<p>MSDN NullReference Exception</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/net/" rel="tag">.net</a></li>
            <li><a class="tag p-category" href="../../categories/net-c/" rel="tag">.net-c#</a></li>
            <li><a class="tag p-category" href="../../categories/null/" rel="tag">null</a></li>
            <li><a class="tag p-category" href="../../categories/nullreferenceexception/" rel="tag">nullreferenceexception</a></li>
            <li><a class="tag p-category" href="../../categories/vbnet/" rel="tag">vb.net</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../getting-the-class-name-of-an-instance/" rel="prev" title="Getting the class name of an instance">Previous post</a>
            </li>
            <li class="next">
                <a href="../addtransient-addscoped-and-addsingleton-services-differences/" rel="next" title="AddTransient, AddScoped and AddSingleton Services Differences">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
