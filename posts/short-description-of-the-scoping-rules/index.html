<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Short description of the scoping rules? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/short-description-of-the-scoping-rules/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../is-there-a-naming-convention-for-git-repositories/" title="Is there a naming convention for git repositories?" type="text/html">
<link rel="next" href="../hiding-axis-text-in-matplotlib-plots/" title="Hiding axis text in matplotlib plots" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Short description of the scoping rules?">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/short-description-of-the-scoping-rules/">
<meta property="og:description" content="What exactly are the Python scoping rules?
If I have some code:
code1
class Foo:
   code2
   def spam.....
      code3
      for code4..:
       code5
       x()


Where is x found? Some possible choi">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T03:56:48+08:00">
<meta property="article:tag" content="python">
<meta property="article:tag" content="scope">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Short description of the scoping rules?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T03:56:48+08:00" itemprop="datePublished" title="2023-03-03 03:56">2023-03-03 03:56</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>What <strong>exactly</strong> are the Python scoping rules?</p>
<p>If I have some code:</p>
<div class="code"><pre class="code literal-block"><span class="nv">code1</span>
<span class="nv">class</span><span class="w"> </span><span class="nv">Foo</span>:
<span class="w">   </span><span class="nv">code2</span>
<span class="w">   </span><span class="nv">def</span><span class="w"> </span><span class="nv">spam</span>.....
<span class="w">      </span><span class="nv">code3</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="nv">code4</span>..:
<span class="w">       </span><span class="nv">code5</span>
<span class="w">       </span><span class="nv">x</span><span class="ss">()</span>
</pre></div>

<p>Where is <code>x</code> found? Some possible choices include the list below:</p>
<ol>
<li>In the enclosing source file</li>
<li>In the class namespace</li>
<li>In the function definition</li>
<li>In the for loop index variable</li>
<li>Inside the for loop</li>
</ol>
<p>Also there is the context during execution, when the function <code>spam</code> is passed
somewhere else. And maybe lambda functions pass a bit differently?</p>
<p>There must be a simple reference or algorithm somewhere. It's a confusing
world for intermediate Python programmers.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Actually, a concise rule for Python Scope resolution, from Learning Python,
3rd. Ed.. (These rules are specific to variable names, not attributes. If you
reference it without a period, these rules apply.)</p>
<p><strong>LEGB Rule</strong></p>
<ul>
<li>
<p><strong>L</strong> ocal — Names assigned in any way within a function (<code>def</code> or <code>lambda</code>), and not declared global in that function</p>
</li>
<li>
<p><strong>E</strong> nclosing-function — Names assigned in the local scope of any and all statically enclosing functions (<code>def</code> or <code>lambda</code>), from inner to outer</p>
</li>
<li>
<p><strong>G</strong> lobal (module) — Names assigned at the top-level of a module file, or by executing a <code>global</code> statement in a <code>def</code> within the file</p>
</li>
<li>
<p><strong>B</strong> uilt-in (Python) — Names preassigned in the built-in names module: <code>open</code>, <code>range</code>, <code>SyntaxError</code>, etc</p>
</li>
</ul>
<p>So, in the case of</p>
<div class="code"><pre class="code literal-block"><span class="nv">code1</span>
<span class="nv">class</span><span class="w"> </span><span class="nv">Foo</span>:
<span class="w">    </span><span class="nv">code2</span>
<span class="w">    </span><span class="nv">def</span><span class="w"> </span><span class="nv">spam</span><span class="ss">()</span>:
<span class="w">        </span><span class="nv">code3</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nv">code4</span>:
<span class="w">            </span><span class="nv">code5</span>
<span class="w">            </span><span class="nv">x</span><span class="ss">()</span>
</pre></div>

<p>The <code>for</code> loop does not have its own namespace. In LEGB order, the scopes
would be</p>
<ul>
<li>L: Local in <code>def spam</code> (in <code>code3</code>, <code>code4</code>, and <code>code5</code>)</li>
<li>E: Any enclosing functions (if the whole example were in another <code>def</code>)</li>
<li>G: Were there any <code>x</code> declared globally in the module (in <code>code1</code>)?</li>
<li>B: Any builtin <code>x</code> in Python.</li>
</ul>
<p><code>x</code> will never be found in <code>code2</code> (even in cases where you might expect it
would, see Antti's answer or here).</p>
<p><br></p>
<h3>Suggest</h3>
<p>Essentially, the only thing in Python that introduces a new scope is a
function definition. Classes are a bit of a special case in that anything
defined directly in the body is placed in the class's namespace, but they are
not directly accessible from within the methods (or nested classes) they
contain.</p>
<p>In your example there are only 3 scopes where x will be searched in:</p>
<ul>
<li>
<p>spam's scope - containing everything defined in code3 and code5 (as well as code4, your loop variable)</p>
</li>
<li>
<p>The global scope - containing everything defined in code1, as well as Foo (and whatever changes after it)</p>
</li>
<li>
<p>The builtins namespace. A bit of a special case - this contains the various Python builtin functions and types such as len() and str(). Generally this shouldn't be modified by any user code, so expect it to contain the standard functions and nothing else.</p>
</li>
</ul>
<p>More scopes only appear when you introduce a nested function (or lambda) into
the picture. These will behave pretty much as you'd expect however. The nested
function can access everything in the local scope, as well as anything in the
enclosing function's scope. eg.</p>
<div class="code"><pre class="code literal-block">def foo():
    x=4
    def bar():
        print x  # Accesses x from foo's scope
    bar()  # Prints 4
    x=5
    bar()  # Prints 5
</pre></div>

<p><strong>Restrictions:</strong></p>
<p>Variables in scopes other than the local function's variables can be accessed,
but can't be rebound to new parameters without further syntax. Instead,
assignment will create a new <strong>local</strong> variable instead of affecting the
variable in the parent scope. For example:</p>
<div class="code"><pre class="code literal-block"><span class="n">global_var1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>
<span class="n">global_var2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="n">def</span><span class="w"> </span><span class="k">func</span><span class="p">():</span>
<span class="w">    </span><span class="c1"># This is OK: It's just accessing, not rebinding</span>
<span class="w">    </span><span class="n">global_var1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># This won't affect global_var2. Instead it creates a new variable</span>
<span class="w">    </span><span class="n">global_var2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>

<span class="w">    </span><span class="n">local1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">embedded_func</span><span class="p">():</span>
<span class="w">        </span><span class="c1"># Again, this doen't affect func's local1 variable.  It creates a </span>
<span class="w">        </span><span class="c1"># new local variable also called local1 instead.</span>
<span class="w">        </span><span class="n">local1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">        </span><span class="nb">print</span><span class="w"> </span><span class="n">local1</span>

<span class="w">    </span><span class="n">embedded_func</span><span class="p">()</span><span class="w"> </span><span class="c1"># Prints 5</span>
<span class="w">    </span><span class="nb">print</span><span class="w"> </span><span class="n">local1</span><span class="w">    </span><span class="c1"># Prints 4</span>
</pre></div>

<p>In order to actually modify the bindings of global variables from within a
function scope, you need to specify that the variable is global with the
global keyword. Eg:</p>
<div class="code"><pre class="code literal-block"><span class="n">global_var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="n">def</span><span class="w"> </span><span class="n">change_global</span><span class="p">():</span>
<span class="w">    </span><span class="n">global</span><span class="w"> </span><span class="n">global_var</span>
<span class="w">    </span><span class="n">global_var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">global_var</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</pre></div>

<p>Currently there is no way to do the same for variables in enclosing <em>function</em>
scopes, but Python 3 introduces a new keyword, "<code>nonlocal</code>" which will act in
a similar way to global, but for nested function scopes.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/scope/" rel="tag">scope</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../is-there-a-naming-convention-for-git-repositories/" rel="prev" title="Is there a naming convention for git repositories?">Previous post</a>
            </li>
            <li class="next">
                <a href="../hiding-axis-text-in-matplotlib-plots/" rel="next" title="Hiding axis text in matplotlib plots">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
