<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Create Git branch with current changes | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/create-git-branch-with-current-changes/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-to-mock-void-methods-with-mockito/" title="How to mock void methods with Mockito" type="text/html">
<link rel="next" href="../how-do-i-expire-a-php-session-after-30-minutes/" title="How do I expire a PHP session after 30 minutes?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content="Create Git branch with current changes">
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/create-git-branch-with-current-changes/">
<meta property="og:description" content="I started working on my master branch thinking that my task would be easy.
After a while I realized it would take more work and I want to do all this
work in a new branch.
How can I create a new branc">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-02-17T05:02:50+08:00">
<meta property="article:tag" content="git">
<meta property="article:tag" content="git-branch">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Create Git branch with current changes</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T05:02:50+08:00" itemprop="datePublished" title="2023-02-17 05:02">2023-02-17 05:02</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I started working on my <em>master</em> branch thinking that my task would be easy.
After a while I realized it would take more work and I want to do all this
work in a new branch.</p>
<p>How can I create a new branch and take all these changes with me without
dirtying <em>master</em>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>If you hadn't made any commit yet, only (1: branch) and (3: checkout) would be
enough.<br>
Or, in one command: <strong><code>git checkout -b newBranch</code></strong></p>
<p>With Git 2.23+ (Q3 2019), the new command <code>git switch</code> would create the branch
in one line (with the same kind of <code>reset --hard</code>, so <strong>beware of its effect</strong>
):</p>
<div class="code"><pre class="code literal-block">#<span class="w"> </span><span class="nv">First</span>,<span class="w"> </span><span class="nv">save</span><span class="w"> </span><span class="nv">your</span><span class="w"> </span><span class="nv">work</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">progress</span><span class="o">!</span>
<span class="nv">git</span><span class="w"> </span><span class="nv">stash</span>

#<span class="w"> </span><span class="k">Then</span>,<span class="w"> </span><span class="nv">one</span><span class="w"> </span><span class="nv">command</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">create</span><span class="w"> </span><span class="o">*</span><span class="nv">and</span><span class="o">*</span><span class="w"> </span><span class="nv">switch</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">branch</span>
<span class="nv">git</span><span class="w"> </span><span class="nv">switch</span><span class="w"> </span><span class="o">-</span><span class="nv">f</span><span class="w"> </span><span class="o">-</span><span class="nv">c</span><span class="w"> </span><span class="nv">topic</span><span class="o">/</span><span class="nv">wip</span><span class="w"> </span><span class="nv">HEAD</span><span class="o">~</span><span class="mi">3</span>
</pre></div>

<hr>
<p>Or, as suggested in Alia's answer, use <code>git switch -m</code>, <em>without</em> <code>git stash</code>:</p>
<div class="code"><pre class="code literal-block">git switch -c topic/wip -m
</pre></div>

<blockquote>
<h3><code>--merge</code></h3>
<p>If you have local modifications to one or more files that are different
between the current branch and the branch to which you are switching, the
command refuses to switch branches in order to preserve your modifications
in context.</p>
<p>However, with this option, <strong>a three-way merge between the current branch,
your working tree contents, and the new branch is done, and you will be on
the new branch</strong>.</p>
<p>When a merge conflict happens, the index entries for conflicting paths are
left unmerged, and you need to resolve the conflicts and mark the resolved
paths with <code>git add</code> (or <code>git rm</code> if the merge should result in deletion of
the path).</p>
</blockquote>
<hr>
<p>As mentioned in the <code>git reset</code> man page:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>git<span class="w"> </span>stash<span class="w">                </span><span class="c1"># (0) Save your work in progress</span>
$<span class="w"> </span>git<span class="w"> </span>branch<span class="w"> </span>topic/wip<span class="w">     </span><span class="c1"># (1)</span>
$<span class="w"> </span>git<span class="w"> </span>reset<span class="w"> </span>--hard<span class="w"> </span>HEAD~3<span class="w">  </span><span class="c1"># (2)  NOTE: use $git reset --soft HEAD~3 (explanation below)</span>
$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>topic/wip<span class="w">   </span><span class="c1"># (3)</span>
</pre></div>

<ol>
<li>You have made some commits, but realize they were premature to be in the "<code>master</code>" branch. You want to continue polishing them in a topic branch, so create "<code>topic/wip</code>" branch off of the current <code>HEAD</code>.</li>
<li>Rewind the <code>master</code> branch to get rid of those three commits.</li>
<li>Switch to "<code>topic/wip</code>" branch and keep working.</li>
</ol>
<p>Again: new way (since 2019 and Git2.23) to do all that in one command:</p>
<div class="code"><pre class="code literal-block">git switch -f -c topic/wip HEAD~3
</pre></div>

<hr>
<p>Note: due to the "destructive" effect of a <code>git reset --hard</code> command (it does
resets the index and working tree. Any changes to tracked files in the working
tree since <code>&lt;commit&gt;</code> are discarded), I would rather go with:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>git<span class="w"> </span>reset<span class="w"> </span>--soft<span class="w"> </span>HEAD~3<span class="w">  </span><span class="c1"># (2)</span>
</pre></div>

<p>This would make sure I'm not losing any private file (not added to the index).<br>
The <code>--soft</code> option won't touch the index file nor the working tree at all
(but resets the head to <code>&lt;commit&gt;</code>, just like all modes do).</p>
<hr>
<p><br></p>
<h3>Suggest</h3>
<p>Like stated in this question: Git: Create a branch from unstagged/uncommited
changes on master: stash is not necessary.</p>
<p>Just use:</p>
<p><code>git checkout -b feature/newbranch</code></p>
<p>Any uncommitted work will be taken along to the new branch.</p>
<p>If you try to push you will get the following message</p>
<blockquote>
<p>fatal: The current branch feature/newbranch has no upstream branch. To push
the current branch and set the remote as upstream, use</p>
<div class="code"><pre class="code literal-block">git push --set-upstream origin feature/newbranch
</pre></div>

</blockquote>
<p>Just do as suggested to create the branch remotely:</p>
<p><code>git push --set-upstream origin feature/newbranch</code></p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/git/" rel="tag">git</a></li>
            <li><a class="tag p-category" href="../../categories/git-branch/" rel="tag">git-branch</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-to-mock-void-methods-with-mockito/" rel="prev" title="How to mock void methods with Mockito">Previous post</a>
            </li>
            <li class="next">
                <a href="../how-do-i-expire-a-php-session-after-30-minutes/" rel="next" title="How do I expire a PHP session after 30 minutes?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
