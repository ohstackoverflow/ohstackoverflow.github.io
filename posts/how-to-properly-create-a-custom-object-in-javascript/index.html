<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How to "properly" create a custom object in JavaScript? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/how-to-properly-create-a-custom-object-in-javascript/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../how-to-clean-node-modules-folder-of-packages-that-are-not-in-package-json/" title="How to clean node_modules folder of packages that are not in package.json?" type="text/html">
<link rel="next" href="../mysql-error-key-specification-without-a-key-length/" title="MySQL error: key specification without a key length" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content='How to "properly" create a custom object in JavaScript?'>
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/how-to-properly-create-a-custom-object-in-javascript/">
<meta property="og:description" content="I wonder about what the best way is to create an JavaScript object that has
properties and methods.
I have seen examples where the person used var self = this and then uses
self. in all functions to m">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T07:08:17+08:00">
<meta property="article:tag" content="javascript">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How to "properly" create a custom object in JavaScript?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T07:08:17+08:00" itemprop="datePublished" title="2023-03-03 07:08">2023-03-03 07:08</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>I wonder about what the best way is to create an JavaScript object that has
properties and methods.</p>
<p>I have seen examples where the person used <code>var self = this</code> and then uses
<code>self.</code> in all functions to make sure the scope is always correct.</p>
<p>Then I have seen examples of using <code>.prototype</code> to add properties, while
others do it inline.</p>
<p>Can someone give me a proper example of a JavaScript object with some
properties and methods?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>There are two models for implementing classes and instances in JavaScript: the
prototyping way, and the closure way. Both have advantages and drawbacks, and
there are plenty of extended variations. Many programmers and libraries have
different approaches and class-handling utility functions to paper over some
of the uglier parts of the language.</p>
<p>The result is that in mixed company you will have a mishmash of metaclasses,
all behaving slightly differently. What's worse, most JavaScript tutorial
material is terrible and serves up some kind of in-between compromise to cover
all bases, leaving you very confused. (Probably the author is also confused.
JavaScript's object model is very different to most programming languages, and
in many places straight-up badly designed.)</p>
<p>Let's start with <strong>the prototype way</strong>. This is the most JavaScript-native you
can get: there is a minimum of overhead code and instanceof will work with
instances of this kind of object.</p>
<div class="code"><pre class="code literal-block">function Shape(x, y) {
    this.x= x;
    this.y= y;
}
</pre></div>

<p>We can add methods to the instance created by <code>new Shape</code> by writing them to
the <code>prototype</code> lookup of this constructor function:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Shape</span>.<span class="nv">prototype</span>.<span class="nv">toString</span><span class="o">=</span><span class="w"> </span><span class="nv">function</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s1">'Shape at '</span><span class="o">+</span><span class="nv">this</span>.<span class="nv">x</span><span class="o">+</span><span class="s1">', '</span><span class="o">+</span><span class="nv">this</span>.<span class="nv">y</span><span class="c1">;</span>
}<span class="c1">;</span>
</pre></div>

<p>Now to subclass it, in as much as you can call what JavaScript does
subclassing. We do that by completely replacing that weird magic <code>prototype</code>
property:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">Circle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Shape</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">invoke</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="k">class</span><span class="s1">'s constructor function to take co-ords</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">Circle</span><span class="o">.</span><span class="n">prototype</span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Shape</span><span class="p">();</span>
</pre></div>

<p>before adding methods to it:</p>
<div class="code"><pre class="code literal-block"><span class="nv">Circle</span>.<span class="nv">prototype</span>.<span class="nv">toString</span><span class="o">=</span><span class="w"> </span><span class="nv">function</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s1">'Circular '</span><span class="o">+</span><span class="nv">Shape</span>.<span class="nv">prototype</span>.<span class="nv">toString</span>.<span class="nv">call</span><span class="ss">(</span><span class="nv">this</span><span class="ss">)</span><span class="o">+</span><span class="s1">' with radius '</span><span class="o">+</span><span class="nv">this</span>.<span class="nv">r</span><span class="c1">;</span>
}
</pre></div>

<p>This example will work and you will see code like it in many tutorials. But
man, that <code>new Shape()</code> is ugly: we're instantiating the base class even
though no actual Shape is to be created. It happens to work in this simple
case because JavaScript is so sloppy: it allows zero arguments to be passed
in, in which case <code>x</code> and <code>y</code> become <code>undefined</code> and are assigned to the
prototype's <code>this.x</code> and <code>this.y</code>. If the constructor function were doing
anything more complicated, it would fall flat on its face.</p>
<p>So what we need to do is find a way to create a prototype object which
contains the methods and other members we want at a class level, without
calling the base class's constructor function. To do this we are going to have
to start writing helper code. This is the simplest approach I know of:</p>
<div class="code"><pre class="code literal-block"><span class="nv">function</span><span class="w"> </span><span class="nv">subclassOf</span><span class="ss">(</span><span class="nv">base</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">_subclassOf</span>.<span class="nv">prototype</span><span class="o">=</span><span class="w"> </span><span class="nv">base</span>.<span class="nv">prototype</span><span class="c1">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">_subclassOf</span><span class="ss">()</span><span class="c1">;</span>
}
<span class="nv">function</span><span class="w"> </span><span class="nv">_subclassOf</span><span class="ss">()</span><span class="w"> </span>{}<span class="c1">;</span>
</pre></div>

<p>This transfers the base class's members in its prototype to a new constructor
function which does nothing, then uses that constructor. Now we can write
simply:</p>
<div class="code"><pre class="code literal-block">function Circle(x, y, r) {
    Shape.call(this, x, y);
    this.r= r;
}
Circle.prototype= subclassOf(Shape);
</pre></div>

<p>instead of the <code>new Shape()</code> wrongness. We now have an acceptable set of
primitives to built classes.</p>
<p>There are a few refinements and extensions we can consider under this model.
For example here is a syntactical-sugar version:</p>
<div class="code"><pre class="code literal-block"><span class="n">Function</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">subclass</span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">base</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">c</span><span class="o">=</span><span class="w"> </span><span class="n">Function</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">subclass</span><span class="o">.</span><span class="n">nonconstructor</span><span class="p">;</span>
<span class="w">    </span><span class="n">c</span><span class="o">.</span><span class="n">prototype</span><span class="o">=</span><span class="w"> </span><span class="n">base</span><span class="o">.</span><span class="n">prototype</span><span class="p">;</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">prototype</span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">c</span><span class="p">();</span>
<span class="p">};</span>
<span class="n">Function</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">subclass</span><span class="o">.</span><span class="n">nonconstructor</span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>

<span class="o">...</span>

<span class="n">function</span><span class="w"> </span><span class="n">Circle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Shape</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">Circle</span><span class="o">.</span><span class="n">subclass</span><span class="p">(</span><span class="n">Shape</span><span class="p">);</span>
</pre></div>

<p>Either version has the drawback that the constructor function cannot be
inherited, as it is in many languages. So even if your subclass adds nothing
to the construction process, it must remember to call the base constructor
with whatever arguments the base wanted. This can be slightly automated using
<code>apply</code>, but still you have to write out:</p>
<div class="code"><pre class="code literal-block">function Point() {
    Shape.apply(this, arguments);
}
Point.subclass(Shape);
</pre></div>

<p>So a common extension is to break out the initialisation stuff into its own
function rather than the constructor itself. This function can then inherit
from the base just fine:</p>
<div class="code"><pre class="code literal-block"><span class="nv">function</span><span class="w"> </span><span class="nv">Shape</span><span class="ss">()</span><span class="w"> </span>{<span class="w"> </span><span class="nv">this</span>.<span class="nv">_init</span>.<span class="nv">apply</span><span class="ss">(</span><span class="nv">this</span>,<span class="w"> </span><span class="nv">arguments</span><span class="ss">)</span><span class="c1">; }</span>
<span class="nv">Shape</span>.<span class="nv">prototype</span>.<span class="nv">_init</span><span class="o">=</span><span class="w"> </span><span class="nv">function</span><span class="ss">(</span><span class="nv">x</span>,<span class="w"> </span><span class="nv">y</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">this</span>.<span class="nv">x</span><span class="o">=</span><span class="w"> </span><span class="nv">x</span><span class="c1">;</span>
<span class="w">    </span><span class="nv">this</span>.<span class="nv">y</span><span class="o">=</span><span class="w"> </span><span class="nv">y</span><span class="c1">;</span>
}<span class="c1">;</span>

<span class="nv">function</span><span class="w"> </span><span class="nv">Point</span><span class="ss">()</span><span class="w"> </span>{<span class="w"> </span><span class="nv">this</span>.<span class="nv">_init</span>.<span class="nv">apply</span><span class="ss">(</span><span class="nv">this</span>,<span class="w"> </span><span class="nv">arguments</span><span class="ss">)</span><span class="c1">; }</span>
<span class="nv">Point</span>.<span class="nv">subclass</span><span class="ss">(</span><span class="nv">Shape</span><span class="ss">)</span><span class="c1">;</span>
<span class="o">//</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">need</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">write</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">initialiser</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">Point</span><span class="o">!</span>
</pre></div>

<p>Now we've just got the same constructor function boilerplate for each class.
Maybe we can move that out into its own helper function so we don't have to
keep typing it, for example instead of <code>Function.prototype.subclass</code>, turning
it round and letting the base class's Function spit out subclasses:</p>
<div class="code"><pre class="code literal-block"><span class="n">Function</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">makeSubclass</span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">Class</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="s1">'_init'</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">this</span><span class="p">)</span>
<span class="w">            </span><span class="n">this</span><span class="o">.</span><span class="n">_init</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">arguments</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Function</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">makeSubclass</span><span class="o">.</span><span class="n">nonconstructor</span><span class="o">.</span><span class="n">prototype</span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">prototype</span><span class="p">;</span>
<span class="w">    </span><span class="n">Class</span><span class="o">.</span><span class="n">prototype</span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Function</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">makeSubclass</span><span class="o">.</span><span class="n">nonconstructor</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Class</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">Function</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">makeSubclass</span><span class="o">.</span><span class="n">nonconstructor</span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>

<span class="o">...</span>

<span class="n">Shape</span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="o">.</span><span class="n">makeSubclass</span><span class="p">();</span>
<span class="n">Shape</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">_init</span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">Point</span><span class="o">=</span><span class="w"> </span><span class="n">Shape</span><span class="o">.</span><span class="n">makeSubclass</span><span class="p">();</span>

<span class="n">Circle</span><span class="o">=</span><span class="w"> </span><span class="n">Shape</span><span class="o">.</span><span class="n">makeSubclass</span><span class="p">();</span>
<span class="n">Circle</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">_init</span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Shape</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">_init</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>

<p>...which is starting to look a bit more like other languages, albeit with
slightly clumsier syntax. You can sprinkle in a few extra features if you
like. Maybe you want <code>makeSubclass</code> to take and remember a class name and
provide a default <code>toString</code> using it. Maybe you want to make the constructor
detect when it has accidentally been called without the <code>new</code> operator (which
would otherwise often result in very annoying debugging):</p>
<div class="code"><pre class="code literal-block"><span class="nv">Function</span>.<span class="nv">prototype</span>.<span class="nv">makeSubclass</span><span class="o">=</span><span class="w"> </span><span class="nv">function</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">function</span><span class="w"> </span><span class="nv">Class</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="o">!</span><span class="ss">(</span><span class="nv">this</span><span class="w"> </span><span class="nv">instanceof</span><span class="w"> </span><span class="nv">Class</span><span class="ss">))</span>
<span class="w">            </span><span class="nv">throw</span><span class="ss">(</span><span class="s1">'Constructor called without "new"'</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">        </span>...
</pre></div>

<p>Maybe you want to pass in all the new members and have <code>makeSubclass</code> add them
to the prototype, to save you having to write <code>Class.prototype...</code> quite so
much. A lot of class systems do that, eg:</p>
<div class="code"><pre class="code literal-block"><span class="nt">Circle</span><span class="o">=</span><span class="w"> </span><span class="nt">Shape</span><span class="p">.</span><span class="nc">makeSubclass</span><span class="o">(</span><span class="p">{</span>
<span class="w">    </span><span class="n">_init</span><span class="p">:</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">Shape</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">_init</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">        </span><span class="err">this.r=</span><span class="w"> </span><span class="err">r</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="o">,</span>
<span class="w">    </span><span class="o">...</span>
<span class="err">}</span><span class="o">);</span>
</pre></div>

<p>There are a lot of potential features you might consider desirable in an
object system and no-one really agrees on one particular formula.</p>
<hr>
<p>The <strong>closure way</strong> , then. This avoids the problems of JavaScript's
prototype-based inheritance, by not using inheritance at all. Instead:</p>
<div class="code"><pre class="code literal-block"><span class="n">function</span><span class="w"> </span><span class="n">Shape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">that</span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>

<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>

<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">toString</span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s1">'Shape at '</span><span class="o">+</span><span class="n">that</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="s1">', '</span><span class="o">+</span><span class="n">that</span><span class="o">.</span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>

<span class="n">function</span><span class="w"> </span><span class="n">Circle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">that</span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>

<span class="w">    </span><span class="n">Shape</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>

<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">_baseToString</span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">toString</span><span class="p">;</span>
<span class="w">    </span><span class="n">this</span><span class="o">.</span><span class="n">toString</span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s1">'Circular '</span><span class="o">+</span><span class="n">_baseToString</span><span class="p">(</span><span class="n">that</span><span class="p">)</span><span class="o">+</span><span class="s1">' with radius '</span><span class="o">+</span><span class="n">that</span><span class="o">.</span><span class="n">r</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">};</span>

<span class="k">var</span><span class="w"> </span><span class="n">mycircle</span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Circle</span><span class="p">();</span>
</pre></div>

<p>Now every single instance of <code>Shape</code> will have its own copy of the <code>toString</code>
method (and any other methods or other class members we add).</p>
<p>The bad thing about every instance having its own copy of each class member is
that it's less efficient. If you are dealing with large numbers of subclassed
instances, prototypical inheritance may serve you better. Also calling a
method of the base class is slightly annoying as you can see: we have to
remember what the method was before the subclass constructor overwrote it, or
it gets lost.</p>
<p>[Also because there is no inheritance here, the <code>instanceof</code> operator won't
work; you would have to provide your own mechanism for class-sniffing if you
need it. Whilst you <em>could</em> fiddle the prototype objects in a similar way as
with prototype inheritance, it's a bit tricky and not really worth it just to
get <code>instanceof</code> working.]</p>
<p>The good thing about every instance having its own method is that the method
may then be bound to the specific instance that owns it. This is useful
because of JavaScript's weird way of binding <code>this</code> in method calls, which has
the upshot that if you detach a method from its owner:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">ts</span><span class="o">=</span><span class="w"> </span><span class="n">mycircle</span><span class="o">.</span><span class="n">toString</span><span class="p">;</span>
<span class="n">alert</span><span class="p">(</span><span class="n">ts</span><span class="p">());</span>
</pre></div>

<p>then <code>this</code> inside the method won't be the Circle instance as expected (it'll
actually be the global <code>window</code> object, causing widespread debugging woe). In
reality this typically happens when a method is taken and assigned to a
<code>setTimeout</code>, <code>onclick</code> or <code>EventListener</code> in general.</p>
<p>With the prototype way, you have to include a closure for every such
assignment:</p>
<div class="code"><pre class="code literal-block">setTimeout(function() {
    mycircle.move(1, 1);
}, 1000);
</pre></div>

<p>or, in the future (or now if you hack Function.prototype) you can also do it
with <code>function.bind()</code>:</p>
<div class="code"><pre class="code literal-block">setTimeout(mycircle.move.bind(mycircle, 1, 1), 1000);
</pre></div>

<p>if your instances are done the closure way, the binding is done for free by
the closure over the instance variable (usually called <code>that</code> or <code>self</code>,
though personally I would advise against the latter as <code>self</code> already has
another, different meaning in JavaScript). You don't get the arguments <code>1, 1</code>
in the above snippet for free though, so you would still need another closure
or a <code>bind()</code> if you need to do that.</p>
<p>There are lots of variants on the closure method too. You may prefer to omit
<code>this</code> completely, creating a new <code>that</code> and returning it instead of using the
<code>new</code> operator:</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="n">Shape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">that</span><span class="o">=</span><span class="w"> </span><span class="err">{}</span><span class="p">;</span>

<span class="w">    </span><span class="n">that</span><span class="p">.</span><span class="n">x</span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="n">that</span><span class="p">.</span><span class="n">y</span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>

<span class="w">    </span><span class="n">that</span><span class="p">.</span><span class="n">toString</span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s1">'Shape at '</span><span class="o">+</span><span class="n">that</span><span class="p">.</span><span class="n">x</span><span class="o">+</span><span class="s1">', '</span><span class="o">+</span><span class="n">that</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">that</span><span class="p">;</span>
<span class="err">}</span>

<span class="k">function</span><span class="w"> </span><span class="n">Circle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">that</span><span class="o">=</span><span class="w"> </span><span class="n">Shape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>

<span class="w">    </span><span class="n">that</span><span class="p">.</span><span class="n">r</span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>

<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="n">_baseToString</span><span class="o">=</span><span class="w"> </span><span class="n">that</span><span class="p">.</span><span class="n">toString</span><span class="p">;</span>
<span class="w">    </span><span class="n">that</span><span class="p">.</span><span class="n">toString</span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s1">'Circular '</span><span class="o">+</span><span class="n">_baseToString</span><span class="p">(</span><span class="n">that</span><span class="p">)</span><span class="o">+</span><span class="s1">' with radius '</span><span class="o">+</span><span class="n">r</span><span class="p">;</span>
<span class="w">    </span><span class="err">}</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">that</span><span class="p">;</span>
<span class="err">}</span><span class="p">;</span>

<span class="n">var</span><span class="w"> </span><span class="n">mycircle</span><span class="o">=</span><span class="w"> </span><span class="n">Circle</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n n-Quoted">`new`</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">won</span><span class="s1">'t do anything</span>
</pre></div>

<p>Which way is “proper”? Both. Which is “best”? That depends on your situation.
FWIW I tend towards prototyping for real JavaScript inheritance when I'm doing
strongly OO stuff, and closures for simple throwaway page effects.</p>
<p>But both ways are quite counter-intuitive to most programmers. Both have many
potential messy variations. You will meet both (as well as many in-between and
generally broken schemes) if you use other people's code/libraries. There is
no one generally-accepted answer. Welcome to the wonderful world of JavaScript
objects.</p>
<p>[This has been part 94 of Why JavaScript Is Not My Favourite Programming
Language.]</p>
<p><br></p>
<h3>Suggest</h3>
<p>I use this pattern fairly frequently - I've found that it gives me a pretty
huge amount of flexibility when I need it. In use it's rather similar to Java-
style classes.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span>
<span class="p">{</span>

<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">privateStaticMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">privateStaticVariable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">;</span>

<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">Foo</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span><span class="w"> </span><span class="n">bar</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">privateMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">        </span><span class="n">this</span><span class="o">.</span><span class="n">publicMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="n">constructor</span><span class="o">.</span><span class="n">publicStaticMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">constructor</span><span class="p">;</span>
<span class="p">}();</span>
</pre></div>

<p>This uses an anonymous function that is called upon creation, returning a new
constructor function. Because the anonymous function is called only once, you
can create private static variables in it (they're inside the closure, visible
to the other members of the class). The constructor function is basically a
standard Javascript object - you define private attributes inside of it, and
public attributes are attached to the <code>this</code> variable.</p>
<p>Basically, this approach combines the Crockfordian approach with standard
Javascript objects to create a more powerful class.</p>
<p>You can use it just like you would any other Javascript object:</p>
<div class="code"><pre class="code literal-block"><span class="n">Foo</span><span class="o">.</span><span class="n">publicStaticMethod</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="n">calling</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">method</span>
<span class="k">var</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Foo</span><span class="p">();</span><span class="w">     </span><span class="o">//</span><span class="n">instantiation</span>
<span class="n">test</span><span class="o">.</span><span class="n">publicMethod</span><span class="p">();</span><span class="w">      </span><span class="o">//</span><span class="n">calling</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">method</span>
</pre></div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/javascript/" rel="tag">javascript</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-to-clean-node-modules-folder-of-packages-that-are-not-in-package-json/" rel="prev" title="How to clean node_modules folder of packages that are not in package.json?">Previous post</a>
            </li>
            <li class="next">
                <a href="../mysql-error-key-specification-without-a-key-length/" rel="next" title="MySQL error: key specification without a key length">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
