<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>What does "Fatal error: Unexpectedly found nil while unwrapping an Optional value" mean? | StackOverflow Snapshot</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/posts/what-does-fatal-error-unexpectedly-found-nil-while-unwrapping-an-optional-value-mean/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Arya">
<link rel="prev" href="../declaring-a-custom-android-ui-element-using-xml/" title="Declaring a custom android UI element using XML" type="text/html">
<link rel="next" href="../what-are-the-differences-between-struct-and-class-in-c/" title="What are the differences between struct and class in C++?" type="text/html">
<meta property="og:site_name" content="StackOverflow Snapshot">
<meta property="og:title" content='What does "Fatal error: Unexpectedly found nil while unwrapping an Opt'>
<meta property="og:url" content="https://ohstackoverflow.netlify.app/posts/what-does-fatal-error-unexpectedly-found-nil-while-unwrapping-an-optional-value-mean/">
<meta property="og:description" content="My Swift program is crashing with EXC_BAD_INSTRUCTION and one of the
following similar errors. What does this error mean, and how do I fix it?

Fatal error: Unexpectedly found nil while unwrapping an ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-03-03T06:44:16+08:00">
<meta property="article:tag" content="error-handling">
<meta property="article:tag" content="exception">
<meta property="article:tag" content="swift">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../archive.html">Archive</a>
                </li>
<li>
<a href="../../categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">What does "Fatal error: Unexpectedly found nil while unwrapping an Optional value" mean?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T06:44:16+08:00" itemprop="datePublished" title="2023-03-03 06:44">2023-03-03 06:44</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>My Swift program is crashing with <code>EXC_BAD_INSTRUCTION</code> and one of the
following similar errors. What does this error mean, and how do I fix it?</p>
<blockquote>
<p>Fatal error: Unexpectedly found nil while unwrapping an Optional value</p>
</blockquote>
<p><em>or</em></p>
<blockquote>
<p>Fatal error: Unexpectedly found nil while implicitly unwrapping an Optional
value</p>
</blockquote>
<hr>
<p>This post is intended to collect answers to "unexpectedly found nil" issues,
so that they are not scattered and hard to find. Feel free to add your own
answer or edit the existing wiki answer.</p>
<p><br><br></p>
<h2>Answer</h2>
<h3>Background: What’s an Optional?</h3>
<p>In Swift, <code>Optional&lt;Wrapped&gt;</code> is an option type: it can contain any value from
the original ("Wrapped") type, or no value at all (the special value <code>nil</code>).
An optional value must be <strong>unwrapped</strong> before it can be used.</p>
<p>Optional is a generic type, which means that <code>Optional&lt;Int&gt;</code> and
<code>Optional&lt;String&gt;</code> are distinct types — the type inside <code>&lt;&gt;</code> is called the
Wrapped type. Under the hood, an Optional is an enum with two cases:
<code>.some(Wrapped)</code> and <code>.none</code>, where <code>.none</code> is equivalent to <code>nil</code>.</p>
<p>Optionals can be declared using the named type <code>Optional&lt;T&gt;</code>, or (most
commonly) as a shorthand with a <code>?</code> suffix.</p>
<div class="code"><pre class="code literal-block"><span class="n">var</span><span class="w"> </span><span class="n">anInt</span><span class="o">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span>
<span class="n">var</span><span class="w"> </span><span class="n">anOptionalInt</span><span class="o">:</span><span class="w"> </span><span class="kt">Int</span><span class="nv">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span>
<span class="n">var</span><span class="w"> </span><span class="n">anotherOptionalInt</span><span class="o">:</span><span class="w"> </span><span class="kt">Int</span><span class="nv">?</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n n-Quoted">`nil`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">provided</span>
<span class="n">var</span><span class="w"> </span><span class="n">aVerboseOptionalInt</span><span class="o">:</span><span class="w"> </span><span class="k">Optional</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">equivalent</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n n-Quoted">`Int?`</span>

<span class="n">anOptionalInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="k">contains</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="kt">integer</span>
</pre></div>

<p>Optionals are a simple yet powerful tool to express your assumptions while
writing code. The compiler can use this information to prevent you from making
mistakes. From The Swift Programming Language:</p>
<blockquote>
<p>Swift is a <em>type-safe</em> language, which means the language helps you to be
clear about the types of values your code can work with. If part of your
code requires a <code>String</code>, type safety prevents you from passing it an <code>Int</code>
by mistake. <strong>Likewise, type safety prevents you from accidentally passing
an optional<code>String</code> to a piece of code that requires a non-optional
<code>String</code>.</strong> Type safety helps you catch and fix errors as early as possible
in the development process.</p>
</blockquote>
<p>Some other programming languages also have generic option types: for example,
Maybe in Haskell, option in Rust, and optional in C++17.</p>
<p>In programming languages <em>without</em> option types, a particular "sentinel" value
is often used to indicate the absence of a valid value. In Objective-C, for
example, <code>nil</code> (the null pointer) represents the lack of an object. For
primitive types such as <code>int</code>, a null pointer can't be used, so you would need
either a separate variable (such as <code>value: Int</code> and <code>isValid: Bool</code>) or a
designated sentinel value (such as <code>-1</code> or <code>INT_MIN</code>). These approaches are
error-prone because it's easy to forget to check <code>isValid</code> or to check for the
sentinel value. Also, if a particular value is chosen as the sentinel, that
means it can no longer be treated as a <em>valid</em> value.</p>
<p>Option types such as Swift's <code>Optional</code> solve these problems by introducing a
special, separate <code>nil</code> value (so you don't have to designate a sentinel
value), and by leveraging the strong type system so the compiler can help you
remember to check for nil when necessary.</p>
<hr>
<h3>Why did I get “ _Fatal error: Unexpectedly found nil while unwrapping an</h3>
<p>Optional value_ ”?</p>
<p>In order to access an optional’s value (if it has one at all), you need to
<strong>unwrap</strong> it. An optional value can be unwrapped safely or forcibly. If you
force-unwrap an optional, and it <em>didn't</em> have a value, your program will
crash with the above message.</p>
<p>Xcode will show you the crash by highlighting a line of code. The problem
occurs on this line.</p>
<p><img alt="crashed line" src="../../images/dQelz.png"></p>
<p>This crash can occur with two different kinds of force-unwrap:</p>
<h4>1. Explicit Force Unwrapping</h4>
<p>This is done with the <code>!</code> operator on an optional. For example:</p>
<div class="code"><pre class="code literal-block"><span class="n">let</span><span class="w"> </span><span class="n">anOptionalString</span><span class="o">:</span><span class="w"> </span><span class="n">String</span><span class="o">?</span>
<span class="nf">print</span><span class="p">(</span><span class="n">anOptionalString</span><span class="o">!</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">CRASH</span>
</pre></div>

<blockquote>
<p>Fatal error: Unexpectedly found nil while unwrapping an Optional value</p>
</blockquote>
<p>As <code>anOptionalString</code> is <code>nil</code> here, you will get a crash on the line where
you force unwrap it.</p>
<h4>2. Implicitly Unwrapped Optionals</h4>
<p>These are defined with a <code>!</code>, rather than a <code>?</code> after the type.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">optionalDouble</span><span class="p">:</span><span class="w"> </span><span class="n">Double</span><span class="o">!</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">implicitly</span><span class="w"> </span><span class="n">unwrapped</span><span class="w"> </span><span class="n">wherever</span><span class="w"> </span><span class="n">it</span><span class="s1">'s used</span>
</pre></div>

<p>These optionals are assumed to contain a value. Therefore whenever you access
an implicitly unwrapped optional, it will automatically be force unwrapped for
you. If it doesn’t contain a value, it will crash.</p>
<div class="code"><pre class="code literal-block"><span class="nf">print</span><span class="p">(</span><span class="n">optionalDouble</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">CRASH</span>
</pre></div>

<blockquote>
<p>Fatal error: Unexpectedly found nil while <strong>implicitly</strong> unwrapping an
Optional value</p>
</blockquote>
<p>In order to work out which variable caused the crash, you can hold <code>⌥</code> while
clicking to show the definition, where you might find the optional type.</p>
<p><img alt="" src="../../images/zZmlK.gif"></p>
<p>IBOutlets, in particular, are usually implicitly unwrapped optionals. This is
because your xib or storyboard will link up the outlets at runtime, <em>after</em>
initialization. You should therefore ensure that you’re not accessing outlets
before they're loaded in. You also should check that the connections are
correct in your storyboard/xib file, otherwise the values will be <code>nil</code> at
runtime, and therefore crash when they are implicitly unwrapped. When fixing
connections, try deleting the lines of code that define your outlets, then
reconnect them.</p>
<hr>
<h3>When should I ever force unwrap an Optional?</h3>
<h4>Explicit Force Unwrapping</h4>
<p>As a general rule, you should never explicitly force unwrap an optional with
the <code>!</code> operator. There may be cases where using <code>!</code> is acceptable – but you
should only ever be using it if you are 100% sure that the optional contains a
value.</p>
<p>While there <em>may</em> be an occasion where you can use force unwrapping, as you
know for a <em>fact</em> that an optional contains a value – there is not a <em>single</em>
place where you cannot safely unwrap that optional instead.</p>
<hr>
<h4>Implicitly Unwrapped Optionals</h4>
<p>These variables are designed so that you can defer their assignment until
later in your code. It is <em>your</em> responsibility to ensure they have a value
before you access them. However, because they involve force unwrapping, they
are still inherently unsafe – as they <em>assume</em> your value is non-nil, even
though assigning nil is valid.</p>
<p>You should only be using implicitly unwrapped optionals as a <em>last resort</em>. If
you can use a lazy variable, or provide a default value for a variable – you
should do so instead of using an implicitly unwrapped optional.</p>
<p>However, there are a few scenarios where implicitly unwrapped optionals are
beneficial, and you are still able to use various ways of safely unwrapping
them as listed below – but you should <em>always</em> use them with due caution.</p>
<hr>
<h3>How can I safely deal with Optionals?</h3>
<p>The simplest way to check whether an optional contains a value, is to compare
it to <code>nil</code>.</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="nv">anOptionalInt</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">nil</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Contains a value!"</span><span class="ss">)</span>
}<span class="w"> </span><span class="k">else</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Doesn’t contain a value."</span><span class="ss">)</span>
}
</pre></div>

<p>However, 99.9% of the time when working with optionals, you’ll actually want
to access the value it contains, if it contains one at all. To do this, you
can use <em>Optional Binding</em>.</p>
<h4>Optional Binding</h4>
<p>Optional Binding allows you to check if an optional contains a value – and
allows you to assign the unwrapped value to a new variable or constant. It
uses the syntax <code>if let x = anOptional {...}</code> or <code>if var x = anOptional
{...}</code>, depending if you need to modify the value of the new variable after
binding it.</p>
<p>For example:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="nv">let</span><span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">anOptionalInt</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Contains a value! It is \(number)!"</span><span class="ss">)</span>
}<span class="w"> </span><span class="k">else</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"Doesn’t contain a number"</span><span class="ss">)</span>
}
</pre></div>

<p>What this does is first check that the optional contains a value. If it <em>does</em>
, then the ‘unwrapped’ value is assigned to a new variable (<code>number</code>) – which
you can then freely use as if it were non-optional. If the optional <em>doesn’t</em>
contain a value, then the else clause will be invoked, as you would expect.</p>
<p>What’s neat about optional binding, is you can unwrap multiple optionals at
the same time. You can just separate the statements with a comma. The
statement will succeed if all the optionals were unwrapped.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">anOptionalInt</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="err">?</span>
<span class="k">var</span><span class="w"> </span><span class="n">anOptionalString</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nb nb-Type">String</span><span class="err">?</span>

<span class="k">if</span><span class="w"> </span><span class="n">let</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anOptionalInt</span><span class="p">,</span><span class="w"> </span><span class="n">let</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anOptionalString</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">"anOptionalInt contains a value: \(number). And so does anOptionalString, it’s: \(text)"</span><span class="p">)</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">"One or more of the optionals don’t contain a value"</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

<p>Another neat trick is that you can also use commas to check for a certain
condition on the value, after unwrapping it.</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="nv">let</span><span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">anOptionalInt</span>,<span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"anOptionalInt contains a value: \(number), and it’s greater than zero!"</span><span class="ss">)</span>
}
</pre></div>

<p>The only catch with using optional binding within an if statement, is that you
can only access the unwrapped value from within the scope of the statement. If
you need access to the value from outside of the scope of the statement, you
can use a <em>guard statement</em>.</p>
<p>A guard statement allows you to define a condition for success – and the
current scope will only continue executing if that condition is met. They are
defined with the syntax <code>guard condition else {...}</code>.</p>
<p>So, to use them with an optional binding, you can do this:</p>
<div class="code"><pre class="code literal-block"><span class="nv">guard</span><span class="w"> </span><span class="nv">let</span><span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">anOptionalInt</span><span class="w"> </span><span class="k">else</span><span class="w"> </span>{
<span class="w">    </span><span class="k">return</span>
}
</pre></div>

<p>(Note that within the guard body, you <strong>must</strong> use one of the control transfer
statements in order to exit the scope of the currently executing code).</p>
<p>If <code>anOptionalInt</code> contains a value, it will be unwrapped and assigned to the
new <code>number</code> constant. The code <em>after</em> the guard will then continue
executing. If it doesn’t contain a value – the guard will execute the code
within the brackets, which will lead to transfer of control, so that the code
immediately after will not be executed.</p>
<p>The real neat thing about guard statements is the unwrapped value is now
available to use in code that follows the statement (as we know that future
code can <em>only</em> execute if the optional has a value). This is a great for
eliminating ‘pyramids of doom’ created by nesting multiple if statements.</p>
<p>For example:</p>
<div class="code"><pre class="code literal-block"><span class="nv">guard</span><span class="w"> </span><span class="nv">let</span><span class="w"> </span><span class="nv">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">anOptionalInt</span><span class="w"> </span><span class="k">else</span><span class="w"> </span>{
<span class="w">    </span><span class="k">return</span>
}

<span class="nv">print</span><span class="ss">(</span><span class="s2">"anOptionalInt contains a value, and it’s: \(number)!"</span><span class="ss">)</span>
</pre></div>

<p>Guards also support the same neat tricks that the if statement supported, such
as unwrapping multiple optionals at the same time and using the <code>where</code>
clause.</p>
<p>Whether you use an if or guard statement completely depends on whether any
future code <em>requires</em> the optional to contain a value.</p>
<h4>Nil Coalescing Operator</h4>
<p>The Nil Coalescing Operator is a nifty shorthand version of the ternary
conditional operator, primarily designed to convert optionals to non-
optionals. It has the syntax <code>a ?? b</code>, where <code>a</code> is an optional type and <code>b</code>
is the same type as <code>a</code> (although usually non-optional).</p>
<p>It essentially lets you say “If <code>a</code> contains a value, unwrap it. If it doesn’t
then return <code>b</code> instead”. For example, you could use it like this:</p>
<div class="code"><pre class="code literal-block">let number = anOptionalInt ?? 0
</pre></div>

<p>This will define a <code>number</code> constant of <code>Int</code> type, that will either contain
the value of <code>anOptionalInt</code>, if it contains a value, or <code>0</code> otherwise.</p>
<p>It’s just shorthand for:</p>
<div class="code"><pre class="code literal-block">let number = anOptionalInt != nil ? anOptionalInt! : 0
</pre></div>

<h4>Optional Chaining</h4>
<p>You can use Optional Chaining in order to call a method or access a property
on an optional. This is simply done by suffixing the variable name with a <code>?</code>
when using it.</p>
<p>For example, say we have a variable <code>foo</code>, of type an optional <code>Foo</code> instance.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Foo</span><span class="err">?</span>
</pre></div>

<p>If we wanted to call a method on <code>foo</code> that doesn’t return anything, we can
simply do:</p>
<div class="code"><pre class="code literal-block">foo?.doSomethingInteresting()
</pre></div>

<p>If <code>foo</code> contains a value, this method will be called on it. If it doesn’t,
nothing bad will happen – the code will simply continue executing.</p>
<p>(This is similar behaviour to sending messages to <code>nil</code> in Objective-C)</p>
<p>This can therefore also be used to set properties as well as call methods. For
example:</p>
<div class="code"><pre class="code literal-block">foo?.bar = Bar()
</pre></div>

<p>Again, nothing bad will happen here if <code>foo</code> is <code>nil</code>. Your code will simply
continue executing.</p>
<p>Another neat trick that optional chaining lets you do is check whether setting
a property or calling a method was successful. You can do this by comparing
the return value to <code>nil</code>.</p>
<p>(This is because an optional value will return <code>Void?</code> rather than <code>Void</code> on a
method that doesn’t return anything)</p>
<p>For example:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">foo</span>?.<span class="nv">bar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Bar</span><span class="ss">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">nil</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"bar was set successfully"</span><span class="ss">)</span>
}<span class="w"> </span><span class="k">else</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"bar wasn’t set successfully"</span><span class="ss">)</span>
}
</pre></div>

<p>However, things become a little bit more tricky when trying to access
properties or call methods that return a value. Because <code>foo</code> is optional,
anything returned from it will also be optional. To deal with this, you can
either unwrap the optionals that get returned using one of the above methods –
or unwrap <code>foo</code> itself before accessing methods or calling methods that return
values.</p>
<p>Also, as the name suggests, you can ‘chain’ these statements together. This
means that if <code>foo</code> has an optional property <code>baz</code>, which has a property <code>qux</code>
– you could write the following:</p>
<div class="code"><pre class="code literal-block">let optionalQux = foo?.baz?.qux
</pre></div>

<p>Again, because <code>foo</code> and <code>baz</code> are optional, the value returned from <code>qux</code>
will always be an optional regardless of whether <code>qux</code> itself is optional.</p>
<h4>
<code>map</code> and <code>flatMap</code>
</h4>
<p>An often underused feature with optionals is the ability to use the <code>map</code> and
<code>flatMap</code> functions. These allow you to apply non-optional transforms to
optional variables. If an optional has a value, you can apply a given
transformation to it. If it doesn’t have a value, it will remain <code>nil</code>.</p>
<p>For example, let’s say you have an optional string:</p>
<div class="code"><pre class="code literal-block">let anOptionalString:String?
</pre></div>

<p>By applying the <code>map</code> function to it – we can use the
<code>stringByAppendingString</code> function in order to concatenate it to another
string.</p>
<p>Because <code>stringByAppendingString</code> takes a non-optional string argument, we
cannot input our optional string directly. However, by using <code>map</code>, we can use
allow <code>stringByAppendingString</code> to be used if <code>anOptionalString</code> has a value.</p>
<p>For example:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">anOptionalString</span><span class="p">:</span><span class="nb nb-Type">String</span><span class="err">?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bar"</span>

<span class="n">anOptionalString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anOptionalString</span><span class="o">.</span><span class="n">map</span><span class="w"> </span><span class="p">{</span><span class="n">unwrappedString</span><span class="w"> </span><span class="ow">in</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">"foo"</span><span class="o">.</span><span class="n">stringByAppendingString</span><span class="p">(</span><span class="n">unwrappedString</span><span class="p">)</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="n">anOptionalString</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Optional</span><span class="p">(</span><span class="s2">"foobar"</span><span class="p">)</span>
</pre></div>

<p>However, if <code>anOptionalString</code> doesn’t have a value, <code>map</code> will return <code>nil</code>.
For example:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">anOptionalString</span><span class="p">:</span><span class="nb nb-Type">String</span><span class="err">?</span>

<span class="n">anOptionalString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anOptionalString</span><span class="o">.</span><span class="n">map</span><span class="w"> </span><span class="p">{</span><span class="n">unwrappedString</span><span class="w"> </span><span class="ow">in</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">"foo"</span><span class="o">.</span><span class="n">stringByAppendingString</span><span class="p">(</span><span class="n">unwrappedString</span><span class="p">)</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="n">anOptionalString</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">nil</span>
</pre></div>

<p><code>flatMap</code> works similarly to <code>map</code>, except it allows you to return <em>another</em>
optional from within the closure body. This means you can input an optional
into a process that requires a non-optional input, but can output an optional
itself.</p>
<h3><code>try!</code></h3>
<p>Swift's error handling system can be safely used with Do-Try-Catch:</p>
<div class="code"><pre class="code literal-block"><span class="k">do</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">let</span><span class="w"> </span><span class="nb">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">try</span><span class="w"> </span><span class="nv">someThrowingFunc</span><span class="ss">()</span><span class="w"> </span>
}<span class="w"> </span><span class="nv">catch</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="nv">error</span><span class="ss">)</span>
}
</pre></div>

<p>If <code>someThrowingFunc()</code> throws an error, the error will be safely caught in
the <code>catch</code> block.</p>
<p>The <code>error</code> constant you see in the <code>catch</code> block has not been declared by us
- it's automatically generated by <code>catch</code>.</p>
<p>You can also declare <code>error</code> yourself, it has the advantage of being able to
cast it to a useful format, for example:</p>
<div class="code"><pre class="code literal-block"><span class="k">do</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">let</span><span class="w"> </span><span class="nb">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">try</span><span class="w"> </span><span class="nv">someThrowingFunc</span><span class="ss">()</span><span class="w">    </span>
}<span class="w"> </span><span class="nv">catch</span><span class="w"> </span><span class="nv">let</span><span class="w"> </span><span class="nv">error</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">NSError</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="nv">error</span>.<span class="nv">debugDescription</span><span class="ss">)</span>
}
</pre></div>

<p>Using <code>try</code> this way is the proper way to try, catch and handle errors coming
from throwing functions.</p>
<p>There's also <code>try?</code> which absorbs the error:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="nv">let</span><span class="w"> </span><span class="nb">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">try</span>?<span class="w"> </span><span class="nv">someThrowingFunc</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">cool</span>
}<span class="w"> </span><span class="k">else</span><span class="w"> </span>{
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">handle</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">failure</span>,<span class="w"> </span><span class="nv">but</span><span class="w"> </span><span class="nv">there</span><span class="err">'s no error information available</span>
<span class="err">}</span>
</pre></div>

<p>But Swift's error handling system also provides a way to "force try" with
<code>try!</code>:</p>
<div class="code"><pre class="code literal-block">let result = try! someThrowingFunc()
</pre></div>

<p>The concepts explained in this post also apply here: if an error is thrown,
the application will crash.</p>
<p><em>You should only ever use<code>try!</code> if you can prove that its result will never
fail in your context - and this is very rare.</em></p>
<p>Most of the time you will use the complete Do-Try-Catch system - and the
optional one, <code>try?</code>, in the rare cases where handling the error is not
important.</p>
<hr>
<h3>Resources</h3>
<ul>
<li>Apple documentation on Swift Optionals</li>
<li>When to use and when not to use implicitly unwrapped optionals</li>
<li>Learn how to debug an iOS app crash</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<h2>TL;DR answer</h2>
<p>With very few exceptions, this rule is golden:</p>
<h2>Avoid use of <code>!</code>
</h2>
<h4>Declare variable optional (<code>?</code>), not implicitly unwrapped optionals (IUO)</h4>
<p>(<code>!</code>)</p>
<p>In other words, rather use:<br><code>var nameOfDaughter: String?</code></p>
<p>Instead of:<br><code>var nameOfDaughter: String!</code></p>
<h4>Unwrap optional variable using <code>if let</code> or <code>guard let</code>
</h4>
<p>Either unwrap variable like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">if</span><span class="w"> </span><span class="nv">let</span><span class="w"> </span><span class="nv">nameOfDaughter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">nameOfDaughter</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">print</span><span class="ss">(</span><span class="s2">"My daughters name is: \(nameOfDaughter)"</span><span class="ss">)</span>
}
</pre></div>

<p>Or like this:</p>
<div class="code"><pre class="code literal-block"><span class="nv">guard</span><span class="w"> </span><span class="nv">let</span><span class="w"> </span><span class="nv">nameOfDaughter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">nameOfDaughter</span><span class="w"> </span><span class="k">else</span><span class="w"> </span>{<span class="w"> </span><span class="k">return</span><span class="w"> </span>}
<span class="nv">print</span><span class="ss">(</span><span class="s2">"My daughters name is: \(nameOfDaughter)"</span><span class="ss">)</span>
</pre></div>

<p>This answer was intended to be concise, for full comprehension read accepted
answer</p>
<hr>
<h3>Resources</h3>
<ul>
<li>Avoiding force unwrapping</li>
</ul>
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/error-handling/" rel="tag">error-handling</a></li>
            <li><a class="tag p-category" href="../../categories/exception/" rel="tag">exception</a></li>
            <li><a class="tag p-category" href="../../categories/swift/" rel="tag">swift</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../declaring-a-custom-android-ui-element-using-xml/" rel="prev" title="Declaring a custom android UI element using XML">Previous post</a>
            </li>
            <li class="next">
                <a href="../what-are-the-differences-between-struct-and-class-in-c/" rel="next" title="What are the differences between struct and class in C++?">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/search.js"></script>
</body>
</html>
