<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2515) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2515.html">
<link rel="prev" href="index-2516.html" type="text/html">
<link rel="next" href="index-2514.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-is-final-not-allowed-in-java-8-interface-methods/" class="u-url">Why is "final" not allowed in Java 8 interface methods?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-is-final-not-allowed-in-java-8-interface-methods/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T21:51:56+08:00" itemprop="datePublished" title="2023-03-04 21:51">2023-03-04 21:51</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>One of the most useful features of Java 8 are the new <code>default</code> methods on
interfaces. There are essentially two reasons (there may be others) why they
have been introduced:</p>
<ul>
<li>Providing actual default implementations. Example: <code>Iterator.remove()</code>
</li>
<li>Allowing for JDK API evolution. Example: <code>Iterable.forEach()</code>
</li>
</ul>
<p>From an API designer's perspective, I would have liked to be able to use other
modifiers on interface methods, e.g. <code>final</code>. This would be useful when adding
convenience methods, preventing "accidental" overrides in implementing
classes:</p>
<div class="code"><pre class="code literal-block"><span class="nv">interface</span><span class="w"> </span><span class="nv">Sender</span><span class="w"> </span>{

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">Convenience</span><span class="w"> </span><span class="nv">method</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="k">send</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">empty</span><span class="w"> </span><span class="nv">message</span>
<span class="w">    </span><span class="nv">default</span><span class="w"> </span><span class="nv">final</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="k">send</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">        </span><span class="k">send</span><span class="ss">(</span><span class="nv">null</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">Implementations</span><span class="w"> </span><span class="nv">should</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">implement</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">method</span>
<span class="w">    </span><span class="nv">void</span><span class="w"> </span><span class="k">send</span><span class="ss">(</span><span class="nv">String</span><span class="w"> </span><span class="nv">message</span><span class="ss">)</span><span class="c1">;</span>
}
</pre></div>

<p>The above is already common practice if <code>Sender</code> were a class:</p>
<div class="code"><pre class="code literal-block"><span class="nv">abstract</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">Sender</span><span class="w"> </span>{

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">Convenience</span><span class="w"> </span><span class="nv">method</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="k">send</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">empty</span><span class="w"> </span><span class="nv">message</span>
<span class="w">    </span><span class="nv">final</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="k">send</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">        </span><span class="k">send</span><span class="ss">(</span><span class="nv">null</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="nv">Implementations</span><span class="w"> </span><span class="nv">should</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">implement</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">method</span>
<span class="w">    </span><span class="nv">abstract</span><span class="w"> </span><span class="nv">void</span><span class="w"> </span><span class="k">send</span><span class="ss">(</span><span class="nv">String</span><span class="w"> </span><span class="nv">message</span><span class="ss">)</span><span class="c1">;</span>
}
</pre></div>

<p>Now, <code>default</code> and <code>final</code> are obviously contradicting keywords, but the
default keyword itself would not have been strictly required, so I'm assuming
that this contradiction is deliberate, to reflect the subtle differences
between <em>"class methods with body"</em> (just methods) and <em>"interface methods
with body"</em> (default methods), i.e. differences which I have not yet
understood.</p>
<p>At some point of time, support for modifiers like <code>static</code> and <code>final</code> on
interface methods was not yet fully explored, citing Brian Goetz:</p>
<blockquote>
<p>The other part is how far we're going to go to support class-building tools
in interfaces, such as final methods, private methods, protected methods,
static methods, etc. The answer is: we don't know yet</p>
</blockquote>
<p>Since that time in late 2011, obviously, support for <code>static</code> methods in
interfaces was added. Clearly, this added a lot of value to the JDK libraries
themselves, such as with <code>Comparator.comparing()</code>.</p>
<h4>Question:</h4>
<p>What is the reason <code>final</code> (and also <code>static final</code>) never made it to Java 8
interfaces?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This question is, to some degree, related to What is the reason why
“synchronized” is not allowed in Java 8 interface methods?</p>
<p>The key thing to understand about default methods is that the primary design
goal is <em>interface evolution</em> , not "turn interfaces into (mediocre) traits".
While there's some overlap between the two, and we tried to be accommodating
to the latter where it didn't get in the way of the former, these questions
are best understood when viewed in this light. (Note too that class methods
<em>are</em> going to be different from interface methods, no matter what the intent,
by virtue of the fact that interface methods can be multiply inherited.)</p>
<p>The basic idea of a default method is: it is an interface method with a
default implementation, and a derived class can provide a more specific
implementation. And because the design center was interface evolution, it was
a critical design goal that default methods be able to be added to interfaces
<em>after the fact</em> in a source-compatible and binary-compatible manner.</p>
<p>The too-simple answer to "why not final default methods" is that then the body
would then not simply be the default implementation, it would be the only
implementation. While that's a little too simple an answer, it gives us a clue
that the question is already heading in a questionable direction.</p>
<p>Another reason why final interface methods are questionable is that they
create impossible problems for implementors. For example, suppose you have:</p>
<div class="code"><pre class="code literal-block">interface A { 
    default void foo() { ... }
}

interface B { 
}

class C implements A, B { 
}
</pre></div>

<p>Here, everything is good; <code>C</code> inherits <code>foo()</code> from <code>A</code>. Now supposing <code>B</code> is
changed to have a <code>foo</code> method, with a default:</p>
<div class="code"><pre class="code literal-block">interface B { 
    default void foo() { ... }
}
</pre></div>

<p>Now, when we go to recompile <code>C</code>, the compiler will tell us that it doesn't
know what behavior to inherit for <code>foo()</code>, so <code>C</code> has to override it (and
could choose to delegate to <code>A.super.foo()</code> if it wanted to retain the same
behavior.) But what if <code>B</code> had made its default <code>final</code>, and <code>A</code> is not under
the control of the author of <code>C</code>? Now <code>C</code> is irretrievably broken; it can't
compile without overriding <code>foo()</code>, but it can't override <code>foo()</code> if it was
final in <code>B</code>.</p>
<p>This is just one example, but the point is that finality for methods is really
a tool that makes more sense in the world of single-inheritance classes
(generally which couple state to behavior), than to interfaces which merely
contribute behavior and can be multiply inherited. It's too hard to reason
about "what other interfaces might be mixed into the eventual implementor",
and allowing an interface method to be final would likely cause these problems
(and they would blow up not on the person who wrote the interface, but on the
poor user who tries to implement it.)</p>
<p>Another reason to disallow them is that they wouldn't mean what you think they
mean. A default implementation is only considered if the class (or its
superclasses) don't provide a declaration (concrete or abstract) of the
method. If a default method were final, but a superclass already implemented
the method, the default would be ignored, which is probably not what the
default author was expecting when declaring it final. (This inheritance
behavior is a reflection of the design center for default methods -- interface
evolution. It should be possible to add a default method (or a default
implementation to an existing interface method) to existing interfaces that
already have implementations, without changing the behavior of existing
classes that implement the interface, guaranteeing that classes that already
worked before default methods were added will work the same way in the
presence of default methods.)</p>
<p><br></p>
<h3>Suggest</h3>
<p>In the lambda mailing list there are plenty of discussions about it. One of
those that seems to contain a lot of discussion about all that stuff is the
following: On Varied interface method visibility (was Final defenders).</p>
<p>In this discussion, Talden, the author of the original question asks something
very similar to your question:</p>
<blockquote>
<p>The decision to make all interface members public was indeed an unfortunate
decision. That any use of interface in internal design exposes
implementation private details is a big one.</p>
<p>It's a tough one to fix without adding some obscure or compatibility
breaking nuances to the language. A compatibility break of that magnitude
and potential subtlety would seen unconscionable so a solution has to exist
that doesn't break existing code.</p>
<p>Could reintroducing the 'package' keyword as an access-specifier be viable.
It's absence of a specifier in an interface would imply public-access and
the absence of a specifier in a class implies package-access. Which
specifiers make sense in an interface is unclear - especially if, to
minimise the knowledge burden on developers, we have to ensure that access-
specifiers mean the same thing in both class and interface if they're
present.</p>
<p>In the absence of default methods I'd have speculated that the specifier of
a member in an interface has to be at least as visible as the interface
itself (so the interface can actually be implemented in all visible
contexts) - with default methods that's not so certain.</p>
<p>Has there been any clear communication as to whether this is even a possible
in-scope discussion? If not, should it be held elsewhere.</p>
</blockquote>
<p>Eventually Brian Goetz's answer was:</p>
<blockquote>
<p>Yes, this is already being explored.</p>
<p>However, let me set some realistic expectations -- language / VM features
have a long lead time, even trivial-seeming ones like this. The time for
proposing new language feature ideas for Java SE 8 has pretty much passed.</p>
</blockquote>
<p>So, most likely it was never implemented because it was never part of the
scope. It was never proposed in time to be considered.</p>
<p>In another heated discussion about final defender methods on the subject,
Brian said again:</p>
<blockquote>
<p>And you have gotten exactly what you wished for. That's exactly what this
feature adds -- multiple inheritance of behavior. Of course we understand
that people will use them as traits. And we've worked hard to ensure that
the the model of inheritance they offer is simple and clean enough that
people can get good results doing so in a broad variety of situations. We
have, at the same time, chosen not to push them beyond the boundary of what
works simply and cleanly, and that leads to "aw, you didn't go far enough"
reactions in some case. But really, most of this thread seems to be
grumbling that the glass is merely 98% full. I'll take that 98% and get on
with it!</p>
</blockquote>
<p>So this reinforces my theory that it simply was not part of the scope or part
of their design. What they did was to provide enough functionality to deal
with the issues of API evolution.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/preloading-images-with-javascript/" class="u-url">Preloading images with JavaScript</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/preloading-images-with-javascript/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T21:50:31+08:00" itemprop="datePublished" title="2023-03-04 21:50">2023-03-04 21:50</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Is the function I wrote below enough to preload images in most, if not all,
browsers commonly used today?</p>
<div class="code"><pre class="code literal-block"><span class="k">function</span><span class="w"> </span><span class="nf">preloadImage</span><span class="p">(</span>url<span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nb">var</span><span class="w"> </span><span class="n">img</span><span class="p">=</span><span class="n">new</span><span class="w"> </span><span class="n">Image</span><span class="p">();</span>
<span class="w">    </span><span class="n">img</span><span class="p">.</span><span class="n">src</span><span class="p">=</span><span class="n">url</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>I have an array of image URLs that I loop over and call the <code>preloadImage</code>
function for each URL.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Yes. This should work on all major browsers.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Try this I think this is better.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">images</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="n">function</span><span class="w"> </span><span class="nb">preload</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">var</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">arguments</span><span class="o">.</span><span class="n">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Image</span><span class="p">();</span>
<span class="w">        </span><span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">preload</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="o">//--</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="o">--//</span>
<span class="nb">preload</span><span class="p">(</span>
<span class="w">    </span><span class="s2">"http://domain.tld/gallery/image-001.jpg"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"http://domain.tld/gallery/image-002.jpg"</span><span class="p">,</span>
<span class="w">    </span><span class="s2">"http://domain.tld/gallery/image-003.jpg"</span>
<span class="p">)</span>
</pre></div>

<p>Source: http://perishablepress.com/3-ways-preload-images-css-javascript-ajax/</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-fastest-way-to-send-100000-http-requests-in-python/" class="u-url">What is the fastest way to send 100,000 HTTP requests in Python?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-fastest-way-to-send-100000-http-requests-in-python/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T21:48:59+08:00" itemprop="datePublished" title="2023-03-04 21:48">2023-03-04 21:48</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am opening a file which has 100,000 URL's. I need to send an HTTP request to
each URL and print the status code. I am using Python 2.6, and so far looked
at the many confusing ways Python implements threading/concurrency. I have
even looked at the python concurrence library, but cannot figure out how to
write this program correctly. Has anyone come across a similar problem? I
guess generally I need to know how to perform thousands of tasks in Python as
fast as possible - I suppose that means 'concurrently'.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Twistedless solution:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">urlparse</span> <span class="kn">import</span> <span class="n">urlparse</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<span class="kn">import</span> <span class="nn">httplib</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">Queue</span> <span class="kn">import</span> <span class="n">Queue</span>

<span class="n">concurrent</span> <span class="o">=</span> <span class="mi">200</span>

<span class="k">def</span> <span class="nf">doWork</span><span class="p">():</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">getStatus</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">doSomethingWithResult</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">q</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">getStatus</span><span class="p">(</span><span class="n">ourl</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">ourl</span><span class="p">)</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">netloc</span><span class="p">)</span>   
        <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">"HEAD"</span><span class="p">,</span> <span class="n">url</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">ourl</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">"error"</span><span class="p">,</span> <span class="n">ourl</span>

<span class="k">def</span> <span class="nf">doSomethingWithResult</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
    <span class="nb">print</span> <span class="n">status</span><span class="p">,</span> <span class="n">url</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">(</span><span class="n">concurrent</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">concurrent</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">doWork</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'urllist.txt'</span><span class="p">):</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">q</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

<p>This one is slighty faster than the twisted solution and uses less CPU.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Things have changed quite a bit since 2010 when this was posted and I haven't
tried all the other answers but I have tried a few, and I found this to work
the best for me using python3.6.</p>
<p>I was able to fetch about ~150 unique domains per second running on AWS.</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">concurrent.futures</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">CONNECTIONS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">tlds</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'../data/sample_1k.txt'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'http://</span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tlds</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>

<span class="k">def</span> <span class="nf">load_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ans</span><span class="o">.</span><span class="n">status_code</span>

<span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">CONNECTIONS</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
    <span class="n">future_to_url</span> <span class="o">=</span> <span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">load_url</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">TIMEOUT</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">)</span>
    <span class="n">time1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_url</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)),</span><span class="n">end</span><span class="o">=</span><span class="s2">"</span><span class="se">\r</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">time2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Took </span><span class="si">{</span><span class="n">time2</span><span class="o">-</span><span class="n">time1</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> s'</span><span class="p">)</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2516.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2514.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
