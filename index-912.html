<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 912) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-912.html">
<link rel="prev" href="index-913.html" type="text/html">
<link rel="next" href="index-911.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/find-first-element-by-predicate/" class="u-url">Find first element by predicate</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/find-first-element-by-predicate/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T19:19:43+08:00" itemprop="datePublished" title="2023-02-17 19:19">2023-02-17 19:19</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I've just started playing with Java 8 lambdas and I'm trying to implement some
of the things that I'm used to in functional languages.</p>
<p>For example, most functional languages have some kind of find function that
operates on sequences, or lists that returns the first element, for which the
predicate is <code>true</code>. The only way I can see to achieve this in Java 8 is:</p>
<div class="code"><pre class="code literal-block"><span class="n">lst</span><span class="p">.</span><span class="n">stream</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">findFirst</span><span class="p">()</span>
</pre></div>

<p>However this seems inefficient to me, as the filter will scan the whole list,
at least to my understanding (which could be wrong). Is there a better way?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>No, filter does not scan the whole stream. It's an intermediate operation,
which returns a lazy stream (actually all intermediate operations return a
lazy stream). To convince you, you can simply do the following test:</p>
<div class="code"><pre class="code literal-block"><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="n">asList</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="n">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list</span><span class="p">.</span><span class="n">stream</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">peek</span><span class="p">(</span><span class="n">num</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"will filter "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">num</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">findFirst</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</pre></div>

<p>Which outputs:</p>
<div class="code"><pre class="code literal-block">will filter 1
will filter 10
10
</pre></div>

<p>You see that only the two first elements of the stream are actually processed.</p>
<p>So you can go with your approach which is perfectly fine.</p>
<p><br></p>
<h3>Suggest</h3>
<blockquote>
<p>However this seems inefficient to me, as the filter will scan the whole list</p>
</blockquote>
<p>No it won't - it will "break" as soon as the first element satisfying the
predicate is found. You can read more about laziness in the stream package
javadoc, in particular (emphasis mine):</p>
<blockquote>
<p>Many stream operations, such as filtering, mapping, or duplicate removal,
can be implemented lazily, exposing opportunities for optimization. For
example, "find the first String with three consecutive vowels" need not
examine all the input strings. Stream operations are divided into
intermediate (Stream-producing) operations and terminal (value- or side-
effect-producing) operations. <strong><em>Intermediate operations are always lazy.</em></strong></p>
</blockquote>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/why-does-printf-not-flush-after-the-call-unless-a-newline-is-in-the-format-string/" class="u-url">Why does printf not flush after the call unless a newline is in the format string?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/why-does-printf-not-flush-after-the-call-unless-a-newline-is-in-the-format-string/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T19:19:16+08:00" itemprop="datePublished" title="2023-02-17 19:19">2023-02-17 19:19</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Why does <code>printf</code> not flush after the call unless a newline is in the format
string? Is this POSIX behavior? How might I have <code>printf</code> immediately flush
every time?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The <code>stdout</code> stream is line buffered by default, so will only display what's
in the buffer after it reaches a newline (or when it's told to). You have a
few options to print immediately:</p>
<ul>
<li>
<p>Print to <code>stderr</code>instead using <code>fprintf</code> (<code>stderr</code> is unbuffered by default):</p>
<div class="code"><pre class="code literal-block">fprintf(stderr, "I will be printed immediately");
</pre></div>

</li>
<li>
<p>Flush <code>stdout</code> whenever you need it to using <code>fflush</code>:</p>
<div class="code"><pre class="code literal-block">printf("Buffered, will be flushed");
</pre></div>

<p>fflush(stdout); // Will now print everything in the stdout buffer</p>
</li>
<li>
<p>Disable buffering on stdout by using <code>setbuf</code>:</p>
<div class="code"><pre class="code literal-block">setbuf(stdout, NULL);
</pre></div>

</li>
<li>
<p>Or use the more flexible <code>setvbuf</code>:</p>
<div class="code"><pre class="code literal-block">setvbuf(stdout, NULL, _IONBF, 0);
</pre></div>

</li>
</ul>
<p><br></p>
<h3>Suggest</h3>
<p>No, it's not POSIX behaviour, it's ISO behaviour (well, it <em>is</em> POSIX
behaviour but only insofar as they conform to ISO).</p>
<p>Standard output is line buffered if it can be detected to refer to an
interactive device, otherwise it's fully buffered. So there are situations
where <code>printf</code> won't flush, even if it gets a newline to send out, such as:</p>
<div class="code"><pre class="code literal-block">myprog &gt;myfile.txt
</pre></div>

<p>This makes sense for efficiency since, if you're interacting with a user, they
probably want to see every line. If you're sending the output to a file, it's
most likely that there's not a user at the other end (though not impossible,
they could be tailing the file). Now you <em>could</em> argue that the user wants to
see every character but there are two problems with that.</p>
<p>The first is that it's not very efficient. The second is that the original
ANSI C mandate was to primarily codify <em>existing</em> behaviour, rather than
invent <em>new</em> behaviour, and those design decisions were made long before ANSI
started the process. Even ISO nowadays treads very carefully when changing
existing rules in the standards.</p>
<p>As to how to deal with that, if you <code>fflush (stdout)</code> after every output call
that you want to see immediately, that will solve the problem.</p>
<p>Alternatively, you can use <code>setvbuf</code> before operating on <code>stdout</code>, to set it
to unbuffered and you won't have to worry about adding all those <code>fflush</code>
lines to your code:</p>
<div class="code"><pre class="code literal-block">setvbuf (stdout, NULL, _IONBF, BUFSIZ);
</pre></div>

<p>Just keep in mind that may affect performance quite a bit if you <em>are</em> sending
the output to a file. Also keep in mind that support for this is
implementation-defined, not guaranteed by the standard.</p>
<p>ISO C99 section <code>7.19.3/3</code> is the relevant bit:</p>
<blockquote>
<p>When a stream is <em>unbuffered</em> , characters are intended to appear from the
source or at the destination as soon as possible. Otherwise characters may
be accumulated and transmitted to or from the host environment as a block.</p>
<p>When a stream is <em>fully buffered</em> , characters are intended to be
transmitted to or from the host environment as a block when a buffer is
filled.</p>
<p>When a stream is <em>line buffered</em> , characters are intended to be transmitted
to or from the host environment as a block when a new-line character is
encountered.</p>
<p>Furthermore, characters are intended to be transmitted as a block to the
host environment when a buffer is filled, when input is requested on an
unbuffered stream, or when input is requested on a line buffered stream that
requires the transmission of characters from the host environment.</p>
<p>Support for these characteristics is implementation-defined, and may be
affected via the <code>setbuf</code> and <code>setvbuf</code> functions.</p>
</blockquote>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-the-maximum-recursion-depth-in-python-and-how-to-increase-it/" class="u-url">What is the maximum recursion depth in Python, and how to increase it?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-the-maximum-recursion-depth-in-python-and-how-to-increase-it/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T19:18:44+08:00" itemprop="datePublished" title="2023-02-17 19:18">2023-02-17 19:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have this tail recursive function here:</p>
<div class="code"><pre class="code literal-block"><span class="nv">def</span><span class="w"> </span><span class="nv">recursive_function</span><span class="ss">(</span><span class="nv">n</span>,<span class="w"> </span><span class="nv">sum</span><span class="ss">)</span>:
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span>:
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">sum</span>
<span class="w">    </span><span class="k">else</span>:
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">recursive_function</span><span class="ss">(</span><span class="nv">n</span><span class="o">-</span><span class="mi">1</span>,<span class="w"> </span><span class="nv">sum</span><span class="o">+</span><span class="nv">n</span><span class="ss">)</span>

<span class="nv">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">998</span>
<span class="nv">print</span><span class="ss">(</span><span class="nv">recursive_function</span><span class="ss">(</span><span class="nv">c</span>,<span class="w"> </span><span class="mi">0</span><span class="ss">))</span>
</pre></div>

<p>It works up to <code>n=997</code>, then it just breaks and spits out a <code>RecursionError:
maximum recursion depth exceeded in comparison</code>. Is this just a stack
overflow? Is there a way to get around it?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>It is a guard against a stack overflow, yes. Python (or rather, the CPython
implementation) doesn't optimize tail recursion, and unbridled recursion
causes stack overflows. You can check the recursion limit with
<code>sys.getrecursionlimit</code>:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">sys</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getrecursionlimit</span><span class="p">())</span>
</pre></div>

<p>and change the recursion limit with <code>sys.setrecursionlimit</code>:</p>
<div class="code"><pre class="code literal-block">sys.setrecursionlimit(1500)
</pre></div>

<p>but doing so is dangerous -- the standard limit is a little conservative, but
Python stackframes can be quite big.</p>
<p>Python isn't a functional language and tail recursion is not a particularly
efficient technique. Rewriting the algorithm iteratively, if possible, is
generally a better idea.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Looks like you just need to set a higher recursion depth:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setrecursionlimit</span><span class="p">(</span><span class="mi">1500</span><span class="p">)</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-913.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-911.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
