<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2654) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2654.html">
<link rel="prev" href="index-2655.html" type="text/html">
<link rel="next" href="index-2653.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/setting-a-property-by-reflection-with-a-string-value/" class="u-url">Setting a property by reflection with a string value</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/setting-a-property-by-reflection-with-a-string-value/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T07:58:01+08:00" itemprop="datePublished" title="2023-03-05 07:58">2023-03-05 07:58</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'd like to set a property of an object through Reflection, with a value of
type <code>string</code>. So, for instance, suppose I have a <code>Ship</code> class, with a
property of <code>Latitude</code>, which is a <code>double</code>.</p>
<p>Here's what I'd like to do:</p>
<div class="code"><pre class="code literal-block">Ship ship = new Ship();
string value = "5.5";
PropertyInfo propertyInfo = ship.GetType().GetProperty("Latitude");
propertyInfo.SetValue(ship, value, null);
</pre></div>

<p>As is, this throws an <code>ArgumentException</code>:</p>
<blockquote>
<p>Object of type 'System.String' cannot be converted to type 'System.Double'.</p>
</blockquote>
<p>How can I convert value to the proper type, based on <code>propertyInfo</code>?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can use <code>Convert.ChangeType()</code> - It allows you to use runtime information
on any <code>IConvertible</code> type to change representation formats. Not all
conversions are possible, though, and you may need to write special case logic
if you want to support conversions from types that are not <code>IConvertible</code>.</p>
<p>The corresponding code (without exception handling or special case logic)
would be:</p>
<div class="code"><pre class="code literal-block">Ship ship = new Ship();
string value = "5.5";
PropertyInfo propertyInfo = ship.GetType().GetProperty("Latitude");
propertyInfo.SetValue(ship, Convert.ChangeType(value, propertyInfo.PropertyType), null);
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>As several others have said, you want to use <code>Convert.ChangeType</code>:</p>
<div class="code"><pre class="code literal-block">propertyInfo.SetValue(ship,
    Convert.ChangeType(value, propertyInfo.PropertyType),
    null);
</pre></div>

<p>In fact, I recommend you look at the entire <code>Convert</code> Class.</p>
<p>This class, and many other useful classes are part of the <code>System</code> Namespace.
I find it useful to scan that namespace every year or so to see what features
I've missed. Give it a try!</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-define-the-basic-http-authentication-using-curl-correctly/" class="u-url">How to define the basic HTTP authentication using cURL correctly?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-define-the-basic-http-authentication-using-curl-correctly/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T07:56:38+08:00" itemprop="datePublished" title="2023-03-05 07:56">2023-03-05 07:56</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I'm learning Apigility (Apigility docu -&gt; REST Service Tutorial) and trying to
send a POST request with basic authentication via cURL:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-i<span class="w"> </span>-H<span class="w"> </span><span class="s2">"Content-Type: application/hal+json"</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">"Authorization: Basic YXBpdXNlcjphcGlwd2Q="</span><span class="w"> </span>http://apigilityhw.sandbox.loc/status
</pre></div>

<p><code>YXBpdXNlcjphcGlwd2Q=</code> is the base 64 encoded string with my credentials
<code>apiuser:apipwd</code>. The credentials are saved in the <code>/data/htpasswd</code>
(<code>apiuser:$apr1$3J4cyqEw$WKga3rQMkxvnevMuBaekg/</code>).</p>
<p>The looks like this:</p>
<div class="code"><pre class="code literal-block">HTTP/1.1 401 Unauthorized
Server: nginx/1.4.7
Date: Mon, 22 Sep 2014 07:48:47 GMT
Content-Type: application/problem+json
Transfer-Encoding: chunked
Connection: keep-alive
X-Powered-By: PHP/5.5.12-1~dotdeb.1
WWW-Authenticate: Basic realm="api"
</pre></div>

<p>Where is the mistake here? How to get it work?</p>
<p><br><br></p>
<h2>Answer</h2>
<div class="code"><pre class="code literal-block">curl -u username:password http://
curl -u username http://
</pre></div>

<p>From the documentation page:</p>
<blockquote>
<p><strong>-u, --user <password></password></strong></p>
<p>Specify the user name and password to use for server authentication.
Overrides -n, --netrc and --netrc-optional.</p>
<p>If you simply specify the user name, curl will prompt for a password.</p>
<p>The user name and passwords are split up on the first colon, which makes it
impossible to use a colon in the user name with this option. The password
can, still.</p>
<p>When using Kerberos V5 with a Windows based server you should include the
Windows domain name in the user name, in order for the server to succesfully
obtain a Kerberos Ticket. If you don't then the initial authentication
handshake may fail.</p>
<p>When using NTLM, the user name can be specified simply as the user name,
without the domain, if there is a single domain and forest in your setup for
example.</p>
<p>To specify the domain name use either Down-Level Logon Name or UPN (User
Principal Name) formats. For example, EXAMPLE\user and user@example.com
respectively.</p>
<p>If you use a Windows SSPI-enabled curl binary and perform Kerberos V5,
Negotiate, NTLM or Digest authentication then you can tell curl to select
the user name and password from your environment by specifying a single
colon with this option: "-u :".</p>
<p>If this option is used several times, the last one will be used.</p>
</blockquote>
<p>http://curl.haxx.se/docs/manpage.html#-u</p>
<p>Note that you do not need <code>--basic</code> flag as it is the default.</p>
<p><br></p>
<h3>Suggest</h3>
<p>as header</p>
<div class="code"><pre class="code literal-block">AUTH=$(echo -ne "$BASIC_AUTH_USER:$BASIC_AUTH_PASSWORD" | base64 --wrap 0)

curl \
  --header "Content-Type: application/json" \
  --header "Authorization: Basic $AUTH" \
  --request POST \
  --data  '{"key1":"value1", "key2":"value2"}' \
  https://example.com/
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/any-difference-between-await-promise-all-and-multiple-await/" class="u-url">Any difference between await Promise.all() and multiple await?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/any-difference-between-await-promise-all-and-multiple-await/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-05T07:55:16+08:00" itemprop="datePublished" title="2023-03-05 07:55">2023-03-05 07:55</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>Is there any difference between:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="p">[</span><span class="n">result1</span><span class="p">,</span><span class="w"> </span><span class="n">result2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">task1</span><span class="p">(),</span><span class="w"> </span><span class="n">task2</span><span class="p">()]);</span>
</pre></div>

<p>and</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task1</span><span class="p">();</span>
<span class="k">const</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task2</span><span class="p">();</span>

<span class="k">const</span><span class="w"> </span><span class="n">result1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">t1</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="n">result2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">t2</span><span class="p">;</span>
</pre></div>

<p>and</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="p">[</span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">task1</span><span class="p">(),</span><span class="w"> </span><span class="n">task2</span><span class="p">()];</span>
<span class="k">const</span><span class="w"> </span><span class="p">[</span><span class="n">result1</span><span class="p">,</span><span class="w"> </span><span class="n">result2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">await</span><span class="w"> </span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">t2</span><span class="p">];</span>
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<blockquote>
<p><strong>Note</strong> :</p>
<p>This answer just covers the timing differences between <code>await</code> in series and
<code>Promise.all</code>. Be sure to read @mikep's comprehensive answer that also
covers the more important differences in error handling.</p>
</blockquote>
<hr>
<p>For the purposes of this answer I will be using some example methods:</p>
<ul>
<li>
<code>res(ms)</code> is a function that takes an integer of milliseconds and returns a promise that resolves after that many milliseconds.</li>
<li>
<code>rej(ms)</code> is a function that takes an integer of milliseconds and returns a promise that rejects after that many milliseconds.</li>
</ul>
<p>Calling <code>res</code> starts the timer. Using <code>Promise.all</code> to wait for a handful of
delays will resolve after all the delays have finished, but remember they
execute at the same time:</p>
<p>Example #1</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">res</span><span class="p">(</span><span class="mi">3000</span><span class="p">),</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="mi">2000</span><span class="p">),</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="mi">1000</span><span class="p">)])</span>
<span class="o">//</span><span class="w">                              </span><span class="o">^^^^^^^^^</span><span class="w">  </span><span class="o">^^^^^^^^^</span><span class="w">  </span><span class="o">^^^^^^^^^</span>
<span class="o">//</span><span class="w">                               </span><span class="n">delay</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="n">delay</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="n">delay</span><span class="w"> </span><span class="mi">3</span>
<span class="o">//</span>
<span class="o">//</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="o">------</span><span class="mi">1</span><span class="o">---------</span><span class="mi">2</span><span class="o">---------</span><span class="mi">3</span>
<span class="o">//</span><span class="w"> </span><span class="o">=============================</span><span class="n">O</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="mi">1</span>
<span class="o">//</span><span class="w"> </span><span class="o">===================</span><span class="n">O</span><span class="w">           </span><span class="n">delay</span><span class="w"> </span><span class="mi">2</span>
<span class="o">//</span><span class="w"> </span><span class="o">=========</span><span class="n">O</span><span class="w">                     </span><span class="n">delay</span><span class="w"> </span><span class="mi">3</span>
<span class="o">//</span>
<span class="o">//</span><span class="w"> </span><span class="o">=============================</span><span class="n">O</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span>
</pre></div>

<p>Show code snippet</p>
<div class="code"><pre class="code literal-block"><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">example</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">function</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">++</span><span class="n">i</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Promise</span><span class="p">((</span><span class="n">resolve</span><span class="p">,</span><span class="w"> </span><span class="n">reject</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resolve</span><span class="p">()</span>
<span class="w">        </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">res</span><span class="w"> </span><span class="c1">#${id} called after ${n} milliseconds`, Date.now() - start)</span>
<span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">res</span><span class="p">(</span><span class="mi">3000</span><span class="p">),</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="mi">2000</span><span class="p">),</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="mi">1000</span><span class="p">)])</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="w"> </span><span class="n">finished</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">()</span>
</pre></div>

<p>This means that <code>Promise.all</code> will resolve with the data from the inner
promises after 3 seconds.</p>
<p>But, <code>Promise.all</code> has a "fail fast" behavior:</p>
<p>Example #2</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">res</span><span class="p">(</span><span class="mi">3000</span><span class="p">),</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="mi">2000</span><span class="p">),</span><span class="w"> </span><span class="n">rej</span><span class="p">(</span><span class="mi">1000</span><span class="p">)])</span>
<span class="o">//</span><span class="w">                              </span><span class="o">^^^^^^^^^</span><span class="w">  </span><span class="o">^^^^^^^^^</span><span class="w">  </span><span class="o">^^^^^^^^^</span>
<span class="o">//</span><span class="w">                               </span><span class="n">delay</span><span class="w"> </span><span class="mi">1</span><span class="w">    </span><span class="n">delay</span><span class="w"> </span><span class="mi">2</span><span class="w">    </span><span class="n">delay</span><span class="w"> </span><span class="mi">3</span>
<span class="o">//</span>
<span class="o">//</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="o">------</span><span class="mi">1</span><span class="o">---------</span><span class="mi">2</span><span class="o">---------</span><span class="mi">3</span>
<span class="o">//</span><span class="w"> </span><span class="o">=============================</span><span class="n">O</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="mi">1</span>
<span class="o">//</span><span class="w"> </span><span class="o">===================</span><span class="n">O</span><span class="w">           </span><span class="n">delay</span><span class="w"> </span><span class="mi">2</span>
<span class="o">//</span><span class="w"> </span><span class="o">=========</span><span class="n">X</span><span class="w">                     </span><span class="n">delay</span><span class="w"> </span><span class="mi">3</span>
<span class="o">//</span>
<span class="o">//</span><span class="w"> </span><span class="o">=========</span><span class="n">X</span><span class="w">                     </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span>
</pre></div>

<p>Show code snippet</p>
<div class="code"><pre class="code literal-block"><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">example</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">function</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">++</span><span class="n">i</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Promise</span><span class="p">((</span><span class="n">resolve</span><span class="p">,</span><span class="w"> </span><span class="n">reject</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resolve</span><span class="p">()</span>
<span class="w">        </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">res</span><span class="w"> </span><span class="c1">#${id} called after ${n} milliseconds`, Date.now() - start)</span>
<span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">function</span><span class="w"> </span><span class="n">rej</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">++</span><span class="n">i</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Promise</span><span class="p">((</span><span class="n">resolve</span><span class="p">,</span><span class="w"> </span><span class="n">reject</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">reject</span><span class="p">()</span>
<span class="w">        </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">rej</span><span class="w"> </span><span class="c1">#${id} called after ${n} milliseconds`, Date.now() - start)</span>
<span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">res</span><span class="p">(</span><span class="mi">3000</span><span class="p">),</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="mi">2000</span><span class="p">),</span><span class="w"> </span><span class="n">rej</span><span class="p">(</span><span class="mi">1000</span><span class="p">)])</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="w"> </span><span class="n">finished</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">()</span>
</pre></div>

<p>If you use <code>async-await</code> instead, you will have to wait for each promise to
resolve sequentially, which may not be as efficient:</p>
<p>Example #3</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">delay1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span>
<span class="k">const</span><span class="w"> </span><span class="n">delay2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
<span class="k">const</span><span class="w"> </span><span class="n">delay3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rej</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="k">const</span><span class="w"> </span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">delay1</span>
<span class="k">const</span><span class="w"> </span><span class="n">data2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">delay2</span>
<span class="k">const</span><span class="w"> </span><span class="n">data3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">delay3</span>

<span class="o">//</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="o">------</span><span class="mi">1</span><span class="o">---------</span><span class="mi">2</span><span class="o">---------</span><span class="mi">3</span>
<span class="o">//</span><span class="w"> </span><span class="o">=============================</span><span class="n">O</span><span class="w"> </span><span class="n">delay</span><span class="w"> </span><span class="mi">1</span>
<span class="o">//</span><span class="w"> </span><span class="o">===================</span><span class="n">O</span><span class="w">           </span><span class="n">delay</span><span class="w"> </span><span class="mi">2</span>
<span class="o">//</span><span class="w"> </span><span class="o">=========</span><span class="n">X</span><span class="w">                     </span><span class="n">delay</span><span class="w"> </span><span class="mi">3</span>
<span class="o">//</span>
<span class="o">//</span><span class="w"> </span><span class="o">=============================</span><span class="n">X</span><span class="w"> </span><span class="n">await</span>
</pre></div>

<p>Show code snippet</p>
<div class="code"><pre class="code literal-block"><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">example</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="n">function</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">++</span><span class="n">i</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Promise</span><span class="p">((</span><span class="n">resolve</span><span class="p">,</span><span class="w"> </span><span class="n">reject</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resolve</span><span class="p">()</span>
<span class="w">        </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">res</span><span class="w"> </span><span class="c1">#${id} called after ${n} milliseconds`, Date.now() - start)</span>
<span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">function</span><span class="w"> </span><span class="n">rej</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">++</span><span class="n">i</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Promise</span><span class="p">((</span><span class="n">resolve</span><span class="p">,</span><span class="w"> </span><span class="n">reject</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">reject</span><span class="p">()</span>
<span class="w">        </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">rej</span><span class="w"> </span><span class="c1">#${id} called after ${n} milliseconds`, Date.now() - start)</span>
<span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">delay1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">delay2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">delay3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rej</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">data1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">delay1</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">data2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">delay2</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">data3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">delay3</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="err">`</span><span class="n">await</span><span class="w"> </span><span class="n">finished</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">Date</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="n">example</span><span class="p">()</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<h3>First difference - Fail Fast</h3>
<p>I agree with @zzzzBov's answer, but the "fail fast" advantage of <code>Promise.all</code>
is not the only difference. Some users in the comments have asked why using
<code>Promise.all</code> is worth it when it's only faster in the negative scenario (when
some task fails). And I ask, why not? If I have two independent async parallel
tasks and the first one takes a very long time to resolve but the second is
rejected in a very short time, why leave the user to wait for the longer call
to finish to receive an error message? In real-life applications we must
consider the negative scenario. But OK - in this first difference you can
decide which alternative to use: <code>Promise.all</code> vs. multiple <code>await</code>.</p>
<h3>Second difference - Error Handling</h3>
<p>But when considering error handling, YOU MUST use <code>Promise.all</code>. It is not
possible to correctly handle errors of async parallel tasks triggered with
multiple <code>await</code>s. In the negative scenario, you will always end with
<code>UnhandledPromiseRejectionWarning</code> and <code>PromiseRejectionHandledWarning</code>,
regardless of where you use try/ catch. That is why <code>Promise.all</code> was
designed. Of course someone could say that we can suppress those errors using
<code>process.on('unhandledRejection', err =&gt; {})</code> and
<code>process.on('rejectionHandled', err =&gt; {})</code> but this is not good practice.
I've found many examples on the internet that do not consider error handling
for two or more independent async parallel tasks at all, or consider it but in
the wrong way - just using try/ catch and hoping it will catch errors. It's
almost impossible to find good practice in this.</p>
<h3>Summary</h3>
<p><strong>TL;DR: Never use multiple<code>await</code> for two or more independent async parallel
tasks, because you will not be able to handle errors correctly. Always use
<code>Promise.all()</code> for this use case.</strong></p>
<p>Async/ <code>await</code> is not a replacement for Promises, it's just a pretty way to
use promises. Async code is written in "sync style" and we can avoid multiple
<code>then</code>s in promises.</p>
<p>Some people say that when using <code>Promise.all()</code> we can't handle task errors
separately, and that we can only handle the error from the first rejected
promise (separate handling can be useful e.g. for logging). This is not a
problem - see "Addition" heading at the bottom of this answer.</p>
<h3>Examples</h3>
<p>Consider this async task...</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">taskNum</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">negativeScenario</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Promise</span><span class="p">((</span><span class="n">resolve</span><span class="p">,</span><span class="w"> </span><span class="n">reject</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">setTimeout</span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">negativeScenario</span><span class="p">)</span>
<span class="w">        </span><span class="n">reject</span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="s1">'Task '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">taskNum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' failed!'</span><span class="p">));</span>
<span class="w">      </span><span class="k">else</span>
<span class="w">        </span><span class="n">resolve</span><span class="p">(</span><span class="s1">'Task '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">taskNum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' succeed!'</span><span class="p">);</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="n">seconds</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">};</span>
</pre></div>

<p>When you run tasks in the positive scenario there is no difference between
<code>Promise.all</code> and multiple <code>await</code>s. Both examples end with <code>Task 1 succeed!
Task 2 succeed!</code> after 5 seconds.</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="w"> </span><span class="n">alternative</span>
<span class="k">const</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">immediately</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">wait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">results</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="p">[</span><span class="n">r1</span><span class="p">,</span><span class="w"> </span><span class="n">r2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">([</span>
<span class="w">    </span><span class="n">task</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">),</span>
<span class="w">    </span><span class="n">task</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">)</span>
<span class="w">  </span><span class="p">]);</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r2</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">run</span><span class="p">();</span>
<span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">5</span><span class="n">th</span><span class="w"> </span><span class="n">sec</span><span class="p">:</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">succeed</span><span class="o">!</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">succeed</span><span class="o">!</span>



<span class="o">//</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">alternative</span>
<span class="k">const</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">immediately</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parallel</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
<span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">wait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">results</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">t1</span><span class="p">;</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">t2</span><span class="p">;</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r2</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">run</span><span class="p">();</span>
<span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">5</span><span class="n">th</span><span class="w"> </span><span class="n">sec</span><span class="p">:</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">succeed</span><span class="o">!</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">succeed</span><span class="o">!</span>
</pre></div>

<p>However, when the first task takes 10 seconds and succeeds, and the second
task takes 5 seconds but fails, there are differences in the errors issued.</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="w"> </span><span class="n">alternative</span>
<span class="k">const</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="p">[</span><span class="n">r1</span><span class="p">,</span><span class="w"> </span><span class="n">r2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">([</span>
<span class="w">    </span><span class="n">task</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">),</span>
<span class="w">    </span><span class="n">task</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">)</span>
<span class="w">  </span><span class="p">]);</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r2</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">run</span><span class="p">();</span>
<span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">5</span><span class="n">th</span><span class="w"> </span><span class="n">sec</span><span class="p">:</span><span class="w"> </span><span class="n">UnhandledPromiseRejectionWarning</span><span class="p">:</span><span class="w"> </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">failed</span><span class="o">!</span>



<span class="o">//</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">alternative</span>
<span class="k">const</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">);</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">t1</span><span class="p">;</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">t2</span><span class="p">;</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r2</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">run</span><span class="p">();</span>
<span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">5</span><span class="n">th</span><span class="w"> </span><span class="n">sec</span><span class="p">:</span><span class="w"> </span><span class="n">UnhandledPromiseRejectionWarning</span><span class="p">:</span><span class="w"> </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">failed</span><span class="o">!</span>
<span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">10</span><span class="n">th</span><span class="w"> </span><span class="n">sec</span><span class="p">:</span><span class="w"> </span><span class="n">PromiseRejectionHandledWarning</span><span class="p">:</span><span class="w"> </span><span class="n">Promise</span><span class="w"> </span><span class="n">rejection</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">handled</span><span class="w"> </span><span class="n">asynchronously</span><span class="w"> </span><span class="p">(</span><span class="n">rejection</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">10</span><span class="n">th</span><span class="w"> </span><span class="n">sec</span><span class="p">:</span><span class="w"> </span><span class="n">UnhandledPromiseRejectionWarning</span><span class="p">:</span><span class="w"> </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">failed</span><span class="o">!</span>
</pre></div>

<p>We should already notice here that we are doing something wrong when using
multiple <code>await</code>s in parallel. Let's try handling the errors:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="w"> </span><span class="n">alternative</span>
<span class="k">const</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="p">[</span><span class="n">r1</span><span class="p">,</span><span class="w"> </span><span class="n">r2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">([</span>
<span class="w">    </span><span class="n">task</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">),</span>
<span class="w">    </span><span class="n">task</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">)</span>
<span class="w">  </span><span class="p">]);</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r2</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'Caught error'</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
<span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">5</span><span class="n">th</span><span class="w"> </span><span class="n">sec</span><span class="p">:</span><span class="w"> </span><span class="n">Caught</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">failed</span><span class="o">!</span>
</pre></div>

<p>As you can see, to successfully handle errors, we need to add just one catch
to the <code>run</code> function and add code with catch logic into the callback. We do
not need to handle errors inside the <code>run</code> function because async functions do
this automatically - promise rejection of the <code>task</code> function causes rejection
of the <code>run</code> function.</p>
<p>To avoid a callback we can use "sync style" (async/ <code>await</code> + try/ catch)<br><code>try { await run(); } catch(err) { }</code><br>
but in this example it's not possible, because we can't use <code>await</code> in the
main thread - it can only be used in async functions (because nobody wants to
block main thread). To test if handling works in "sync style" we can call the
<code>run</code> function from another async function or use an IIFE (Immediately Invoked
Function Expression: MDN):</p>
<div class="code"><pre class="code literal-block">(async function() { 
  try { 
    await run(); 
  } catch(err) { 
    console.log('Caught error', err); 
  }
})();
</pre></div>

<p><strong>This is the only correct way to run two or more async parallel tasks and
handle errors. You should avoid the examples below.</strong></p>
<h3>Bad Examples</h3>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">alternative</span>
<span class="k">const</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">);</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">t1</span><span class="p">;</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">t2</span><span class="p">;</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r2</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>

<p>We can try to handle errors in the code above in several ways...</p>
<div class="code"><pre class="code literal-block">try { run(); } catch(err) { console.log('Caught error', err); };
// at 5th sec: UnhandledPromiseRejectionWarning: Error: Task 2 failed!
// at 10th sec: UnhandledPromiseRejectionWarning: Error: Task 2 failed!
// at 10th sec: PromiseRejectionHandledWarning: Promise rejection was handled
</pre></div>

<p>... nothing got caught because it handles sync code but <code>run</code> is async.</p>
<div class="code"><pre class="code literal-block">run().catch(err =&gt; { console.log('Caught error', err); });
// at 5th sec: UnhandledPromiseRejectionWarning: Error: Task 2 failed!
// at 10th sec: Caught error Error: Task 2 failed!
// at 10th sec: PromiseRejectionHandledWarning: Promise rejection was handled asynchronously (rejection id: 1)
</pre></div>

<p>... huh? We see firstly that the error for task 2 was not handled and later
that it was caught. Misleading and still full of errors in console, it's still
unusable this way.  </p>
<div class="code"><pre class="code literal-block">(async function() { try { await run(); } catch(err) { console.log('Caught error', err); }; })();
// at 5th sec: UnhandledPromiseRejectionWarning: Error: Task 2 failed!
// at 10th sec: Caught error Error: Task 2 failed!
// at 10th sec: PromiseRejectionHandledWarning: Promise rejection was handled asynchronously (rejection id: 1)
</pre></div>

<p>... the same as above. User @Qwerty in his deleted answer asked about this
strange behaviour where an error seems to be caught but are also unhandled. We
catch error the because <code>run()</code> is rejected on the line with the <code>await</code>
keyword and can be caught using try/ catch when calling <code>run()</code>. We also get
an <em>unhandled</em> error because we are calling an async task function
synchronously (without the <code>await</code> keyword), and this task runs and fails
outside the <code>run()</code> function.<br>
It is similar to when we are not able to handle errors by try/ catch when
calling some sync function which calls setTimeout:</p>
<div class="code"><pre class="code literal-block">function test() {
  setTimeout(function() { 
    console.log(causesError); 
  }, 0);
};

try { 
  test(); 
} catch(e) { 
  /* this will never catch error */ 
}`.
</pre></div>

<p>Another poor example:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">);</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">);</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">t1</span><span class="p">;</span>
<span class="w">    </span><span class="n">let</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">t2</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">catch</span><span class="w"> </span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r2</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'Caught error'</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
<span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">5</span><span class="n">th</span><span class="w"> </span><span class="n">sec</span><span class="p">:</span><span class="w"> </span><span class="n">UnhandledPromiseRejectionWarning</span><span class="p">:</span><span class="w"> </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">failed</span><span class="o">!</span>
<span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">10</span><span class="n">th</span><span class="w"> </span><span class="n">sec</span><span class="p">:</span><span class="w"> </span><span class="n">PromiseRejectionHandledWarning</span><span class="p">:</span><span class="w"> </span><span class="n">Promise</span><span class="w"> </span><span class="n">rejection</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">handled</span><span class="w"> </span><span class="n">asynchronously</span><span class="w"> </span><span class="p">(</span><span class="n">rejection</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</pre></div>

<p>... "only" two errors (3rd one is missing) but nothing is caught.</p>
<h3>Addition (handling separate task errors and also first-fail error)</h3>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">let</span><span class="w"> </span><span class="p">[</span><span class="n">r1</span><span class="p">,</span><span class="w"> </span><span class="n">r2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">Promise</span><span class="o">.</span><span class="n">all</span><span class="p">([</span>
<span class="w">    </span><span class="n">task</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">)</span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'Task 1 failed!'</span><span class="p">);</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"> </span><span class="p">}),</span>
<span class="w">    </span><span class="n">task</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="bp">true</span><span class="p">)</span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'Task 2 failed!'</span><span class="p">);</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"> </span><span class="p">})</span>
<span class="w">  </span><span class="p">]);</span>
<span class="w">  </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r2</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">err</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'Run failed (does not matter which task)!'</span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
<span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">5</span><span class="n">th</span><span class="w"> </span><span class="n">sec</span><span class="p">:</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">failed</span><span class="o">!</span>
<span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">5</span><span class="n">th</span><span class="w"> </span><span class="n">sec</span><span class="p">:</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="p">(</span><span class="n">does</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">matter</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">task</span><span class="p">)</span><span class="o">!</span>
<span class="o">//</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="mi">10</span><span class="n">th</span><span class="w"> </span><span class="n">sec</span><span class="p">:</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">failed</span><span class="o">!</span>
</pre></div>

<p>... note that in this example I rejected both tasks to better demonstrate what
happens (<code>throw err</code> is used to fire final error).</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2655.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2653.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
