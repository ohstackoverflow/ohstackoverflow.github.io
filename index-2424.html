<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2424) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2424.html">
<link rel="prev" href="index-2425.html" type="text/html">
<link rel="next" href="index-2423.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/angularjs-ui-router-login-authentication/" class="u-url">AngularJS ui-router login authentication</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/angularjs-ui-router-login-authentication/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T15:07:23+08:00" itemprop="datePublished" title="2023-03-04 15:07">2023-03-04 15:07</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am new to AngularJS, and I am a little confused of how I can use
angular-"ui-router" in the following scenario:</p>
<p>I am building a web application which consists of two sections. The first
section is the homepage with its login and signup views, and the second
section is the dashboard (after successful login).</p>
<p>I have created an <code>index.html</code> for the home section with its angular app and
<code>ui-router</code> config to handle <code>/login</code> and <code>/signup</code> views, and there is
another file <code>dashboard.html</code> for the dashboard section with its app and <code>ui-
router</code> config to handle many sub views.</p>
<p>Now I finished the dashboard section and don't know how to combine the two
sections with their different angular apps. How could I tell the home app to
redirect to the dashboard app?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I'm in the process of making a nicer demo as well as cleaning up some of these
services into a usable module, but here's what I've come up with. This is a
complex process to work around some caveats, so hang in there. You'll need to
break this down into several pieces.</p>
<p>Take a look at this plunk.</p>
<p>First, you need a service to store the user's identity. I call this
<code>principal</code>. It can be checked to see if the user is logged in, and upon
request, it can resolve an object that represents the essential information
about the user's identity. This can be whatever you need, but the essentials
would be a display name, a username, possibly an email, and the roles a user
belongs to (if this applies to your app). Principal also has methods to do
role checks.</p>
<div class="code"><pre class="code literal-block"><span class="p">.</span><span class="n">factory</span><span class="p">(</span><span class="s1">'principal'</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">'$q', '$http', '$timeout',</span>
<span class="n">  function($q, $http, $timeout) {</span>
<span class="n">    var _identity = undefined,</span>
<span class="n">      _authenticated = false;</span>

<span class="n">    return {</span>
<span class="n">      isIdentityResolved: function() {</span>
<span class="n">        return angular.isDefined(_identity);</span>
<span class="n">      },</span>
<span class="n">      isAuthenticated: function() {</span>
<span class="n">        return _authenticated;</span>
<span class="n">      },</span>
<span class="n">      isInRole: function(role) {</span>
<span class="n">        if (!_authenticated || !_identity.roles) return false;</span>

<span class="n">        return _identity.roles.indexOf(role) != -1;</span>
<span class="n">      },</span>
<span class="n">      isInAnyRole: function(roles) {</span>
<span class="n">        if (!_authenticated || !_identity.roles) return false;</span>

<span class="n">        for (var i = 0; i &lt; roles.length; i++) {</span>
<span class="n">          if (this.isInRole(roles[i</span><span class="o">]</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">      </span><span class="err">}</span><span class="p">,</span>
<span class="w">      </span><span class="nl">authenticate</span><span class="p">:</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="k">identity</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">_identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">identity</span><span class="p">;</span>
<span class="w">        </span><span class="n">_authenticated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">identity</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">      </span><span class="err">}</span><span class="p">,</span>
<span class="w">      </span><span class="k">identity</span><span class="err">:</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">force</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="nf">var</span><span class="w"> </span><span class="k">deferred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">q</span><span class="p">.</span><span class="n">defer</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">force</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="k">true</span><span class="p">)</span><span class="w"> </span><span class="n">_identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">;</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">retrieved</span><span class="w"> </span><span class="n">the</span><span class="w"> </span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">identity</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">have</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">reuse</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">immediately</span><span class="w"> </span><span class="n">resolving</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">angular</span><span class="p">.</span><span class="n">isDefined</span><span class="p">(</span><span class="n">_identity</span><span class="p">))</span><span class="w"> </span><span class="err">{</span>
<span class="w">          </span><span class="k">deferred</span><span class="p">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">_identity</span><span class="p">);</span>

<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">deferred</span><span class="p">.</span><span class="n">promise</span><span class="p">;</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">otherwise</span><span class="p">,</span><span class="w"> </span><span class="n">retrieve</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">identity</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">the</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">identity</span><span class="w"> </span><span class="k">object</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">then</span><span class="w"> </span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">resolve</span><span class="p">.</span>
<span class="w">        </span><span class="o">//</span><span class="w">           </span><span class="err">$</span><span class="n">http</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">'/svc/account/identity'</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="o">//</span><span class="w">                     </span><span class="err">{</span><span class="w"> </span><span class="nl">ignoreErrors</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="err">}</span><span class="p">)</span>
<span class="w">        </span><span class="o">//</span><span class="w">                </span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="w">                    </span><span class="n">_identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">data</span><span class="p">;</span>
<span class="w">        </span><span class="o">//</span><span class="w">                    </span><span class="n">_authenticated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="o">//</span><span class="w">                    </span><span class="k">deferred</span><span class="p">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">_identity</span><span class="p">);</span>
<span class="w">        </span><span class="o">//</span><span class="w">                </span><span class="err">}</span><span class="p">)</span>
<span class="w">        </span><span class="o">//</span><span class="w">                </span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="k">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="o">//</span><span class="w">                    </span><span class="n">_identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">        </span><span class="o">//</span><span class="w">                    </span><span class="n">_authenticated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">        </span><span class="o">//</span><span class="w">                    </span><span class="k">deferred</span><span class="p">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">_identity</span><span class="p">);</span>
<span class="w">        </span><span class="o">//</span><span class="w">                </span><span class="err">}</span><span class="p">);</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">sake</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">demo</span><span class="p">,</span><span class="w"> </span><span class="n">fake</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">lookup</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">valid</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">fake</span><span class="w"> </span><span class="k">identity</span><span class="p">.</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">reality</span><span class="p">,</span><span class="w">  </span><span class="n">you</span><span class="err">'</span><span class="n">ll</span><span class="w"> </span><span class="n">want</span><span class="w"> </span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="ow">like</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">$</span><span class="n">http</span><span class="w"> </span><span class="n">request</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">commented</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">above</span><span class="p">.</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">example</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">fake</span><span class="w"> </span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">looking</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="k">is</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">logged</span><span class="w"> </span><span class="ow">in</span>
<span class="w">        </span><span class="nf">var</span><span class="w"> </span><span class="n">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="w">        </span><span class="err">$</span><span class="n">timeout</span><span class="p">(</span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">          </span><span class="n">self</span><span class="p">.</span><span class="n">authenticate</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
<span class="w">          </span><span class="k">deferred</span><span class="p">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">_identity</span><span class="p">);</span>
<span class="w">        </span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">deferred</span><span class="p">.</span><span class="n">promise</span><span class="p">;</span>
<span class="w">      </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span><span class="p">;</span>
<span class="w">  </span><span class="err">}</span>
<span class="err">]</span><span class="p">)</span>
</pre></div>

<p>Second, you need a service that checks the state the user wants to go to,
makes sure they're logged in (if necessary; not necessary for signin, password
reset, etc.), and then does a role check (if your app needs this). If they are
not authenticated, send them to the sign-in page. If they are authenticated,
but fail a role check, send them to an access denied page. I call this service
<code>authorization</code>.</p>
<div class="code"><pre class="code literal-block"><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s1">'authorization'</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">'$rootScope'</span><span class="p">,</span><span class="w"> </span><span class="s1">'$state'</span><span class="p">,</span><span class="w"> </span><span class="s1">'principal'</span><span class="p">,</span>
<span class="w">  </span><span class="n">function</span><span class="p">(</span><span class="o">$</span><span class="n">rootScope</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">principal</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">authorize</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">principal</span><span class="o">.</span><span class="n">identity</span><span class="p">()</span>
<span class="w">          </span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">var</span><span class="w"> </span><span class="n">isAuthenticated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">principal</span><span class="o">.</span><span class="n">isAuthenticated</span><span class="p">();</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">$</span><span class="n">rootScope</span><span class="o">.</span><span class="n">toState</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">roles</span>
<span class="w">                </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">$</span><span class="n">rootScope</span><span class="o">.</span><span class="n">toState</span>
<span class="w">                             </span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
<span class="w">                </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">principal</span><span class="o">.</span><span class="n">isInAnyRole</span><span class="p">(</span>
<span class="w">                   </span><span class="o">$</span><span class="n">rootScope</span><span class="o">.</span><span class="n">toState</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">roles</span><span class="p">))</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isAuthenticated</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                  </span><span class="o">//</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">signed</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="ow">not</span>
<span class="w">                  </span><span class="o">//</span><span class="w"> </span><span class="n">authorized</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">desired</span><span class="w"> </span><span class="n">state</span>
<span class="w">                  </span><span class="o">$</span><span class="n">state</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="s1">'accessdenied'</span><span class="p">);</span>
<span class="w">              </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">authenticated</span><span class="o">.</span><span class="w"> </span><span class="n">Stow</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">wanted</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">you</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nb">sign</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">so</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">you</span><span class="s1">'re done</span>
<span class="w">                </span><span class="o">$</span><span class="n">rootScope</span><span class="o">.</span><span class="n">returnToState</span>
<span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">rootScope</span><span class="o">.</span><span class="n">toState</span><span class="p">;</span>
<span class="w">                </span><span class="o">$</span><span class="n">rootScope</span><span class="o">.</span><span class="n">returnToStateParams</span>
<span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">rootScope</span><span class="o">.</span><span class="n">toStateParams</span><span class="p">;</span>

<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">now</span><span class="p">,</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">signin</span><span class="w"> </span><span class="n">state</span>
<span class="w">                </span><span class="o">//</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="nb">log</span><span class="w"> </span><span class="ow">in</span>
<span class="w">                </span><span class="o">$</span><span class="n">state</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="s1">'signin'</span><span class="p">);</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">});</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">])</span>
</pre></div>

<p>Now all you need to do is listen in on <code>ui-router</code>'s <code>$stateChangeStart</code>. This
gives you a chance to examine the current state, the state they want to go to,
and insert your authorization check. If it fails, you can cancel the route
transition, or change to a different route.</p>
<div class="code"><pre class="code literal-block"><span class="na">.run</span><span class="p">([</span><span class="err">'</span><span class="no">$rootScope</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">'</span><span class="no">$state</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">'</span><span class="no">$stateParams</span><span class="err">'</span><span class="p">,</span><span class="w"> </span>
<span class="w">      </span><span class="err">'</span><span class="no">authorization</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">'</span><span class="no">principal</span><span class="err">'</span><span class="p">,</span>
<span class="w">    </span><span class="nf">function</span><span class="p">(</span><span class="no">$rootScope</span><span class="p">,</span><span class="w"> </span><span class="no">$state</span><span class="p">,</span><span class="w"> </span><span class="no">$stateParams</span><span class="p">,</span><span class="w"> </span>
<span class="w">             </span><span class="no">authorization</span><span class="p">,</span><span class="w"> </span><span class="no">principal</span><span class="p">)</span>
<span class="err">{</span>
<span class="w">      </span><span class="nf">$rootScope.$on</span><span class="p">(</span><span class="err">'</span><span class="no">$stateChangeStart</span><span class="err">'</span><span class="p">,</span><span class="w"> </span>
<span class="w">          </span><span class="no">function</span><span class="p">(</span><span class="no">event</span><span class="p">,</span><span class="w"> </span><span class="no">toState</span><span class="p">,</span><span class="w"> </span><span class="no">toStateParams</span><span class="p">)</span>
<span class="w">      </span><span class="err">{</span>
<span class="w">        </span><span class="c1">// track the state the user wants to go to; </span>
<span class="w">        </span><span class="c1">// authorization service needs this</span>
<span class="w">        </span><span class="nf">$rootScope.toState</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">toState</span><span class="c1">;</span>
<span class="w">        </span><span class="nf">$rootScope.toStateParams</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">toStateParams</span><span class="c1">;</span>
<span class="w">        </span><span class="c1">// if the principal is resolved, do an </span>
<span class="w">        </span><span class="c1">// authorization check immediately. otherwise,</span>
<span class="w">        </span><span class="c1">// it'll be done when the state it resolved.</span>
<span class="w">        </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="no">principal.isIdentityResolved</span><span class="p">())</span><span class="w"> </span>
<span class="w">            </span><span class="no">authorization.authorize</span><span class="p">()</span><span class="c1">;</span>
<span class="w">      </span><span class="err">})</span><span class="c1">;</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">  </span><span class="err">])</span><span class="c1">;</span>
</pre></div>

<p>The tricky part about tracking a user's identity is looking it up if you've
already authenticated (say, you're visiting the page after a previous session,
and saved an auth token in a cookie, or maybe you hard refreshed a page, or
dropped onto a URL from a link). Because of the way <code>ui-router</code> works, you
need to do your identity resolve once, before your auth checks. You can do
this using the <code>resolve</code> option in your state config. I have one parent state
for the site that all states inherit from, which forces the principal to be
resolved before anything else happens.</p>
<div class="code"><pre class="code literal-block"><span class="o">$</span><span class="nt">stateProvider</span><span class="p">.</span><span class="nc">state</span><span class="o">(</span><span class="s1">'site'</span><span class="o">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="err">'abstract':</span><span class="w"> </span><span class="err">true,</span>
<span class="w">  </span><span class="n">resolve</span><span class="p">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">authorize</span><span class="o">:</span><span class="w"> </span><span class="cp">[</span><span class="s1">'authorization'</span><span class="p">,</span>
<span class="w">      </span><span class="nx">function</span><span class="p">(</span><span class="nx">authorization</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">authorization.authorize</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="cp">]</span>
<span class="w">  </span><span class="p">}</span><span class="o">,</span>
<span class="w">  </span><span class="nt">template</span><span class="o">:</span><span class="w"> </span><span class="s1">'&lt;div ui-view /&gt;'</span>
<span class="err">}</span><span class="o">)</span>
</pre></div>

<p>There's another problem here... <code>resolve</code> only gets called once. Once your
promise for identity lookup completes, it won't run the resolve delegate
again. So we have to do your auth checks in two places: once pursuant to your
identity promise resolving in <code>resolve</code>, which covers the first time your app
loads, and once in <code>$stateChangeStart</code> if the resolution has been done, which
covers any time you navigate around states.</p>
<p>OK, so what have we done so far?</p>
<ol>
<li>We check to see when the app loads if the user is logged in.</li>
<li>We track info about the logged in user.</li>
<li>We redirect them to sign in state for states that require the user to be logged in.</li>
<li>We redirect them to an access denied state if they do not have authorization to access it.</li>
<li>We have a mechanism to redirect users back to the original state they requested, if we needed them to log in.</li>
<li>We can sign a user out (needs to be wired up in concert with any client or server code that manages your auth ticket).</li>
<li>We <em>don't</em> need to send users back to the sign-in page every time they reload their browser or drop on a link.</li>
</ol>
<p>Where do we go from here? Well, you can organize your states into regions that
require sign in. You can require authenticated/authorized users by adding
<code>data</code> with <code>roles</code> to these states (or a parent of them, if you want to use
inheritance). Here, we restrict a resource to Admins:</p>
<div class="code"><pre class="code literal-block"><span class="na">.state</span><span class="p">(</span><span class="err">'</span><span class="no">restricted</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nl">parent:</span><span class="w"> </span><span class="err">'</span><span class="nf">site</span><span class="err">'</span><span class="p">,</span>
<span class="w">    </span><span class="nl">url:</span><span class="w"> </span><span class="err">'/</span><span class="nf">restricted</span><span class="err">'</span><span class="p">,</span>
<span class="w">    </span><span class="nl">data:</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="nl">roles:</span><span class="w"> </span><span class="err">['</span><span class="nf">Admin</span><span class="err">'</span><span class="p">]</span>
<span class="w">    </span><span class="err">},</span>
<span class="w">    </span><span class="nl">views:</span><span class="w"> </span><span class="err">{</span>
<span class="w">      </span><span class="err">'</span><span class="nf">content@</span><span class="err">'</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">templateUrl:</span><span class="w"> </span><span class="err">'</span><span class="nf">restricted.html</span><span class="err">'</span>
<span class="w">      </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">  </span><span class="err">})</span>
</pre></div>

<p>Now you can control state-by-state what users can access a route. Any other
concerns? Maybe varying only part of a view based on whether or not they are
logged in? No problem. Use the <code>principal.isAuthenticated()</code> or even
<code>principal.isInRole()</code> with any of the numerous ways you can conditionally
display a template or an element.</p>
<p>First, inject <code>principal</code> into a controller or whatever, and stick it to the
scope so you can use it easily in your view:</p>
<div class="code"><pre class="code literal-block"><span class="na">.scope</span><span class="p">(</span><span class="err">'</span><span class="no">HomeCtrl</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="err">'</span><span class="no">$scope</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="err">'</span><span class="no">principal</span><span class="err">'</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="no">function</span><span class="p">(</span><span class="no">$scope</span><span class="p">,</span><span class="w"> </span><span class="no">principal</span><span class="p">)</span>
<span class="err">{</span>
<span class="w">  </span><span class="nf">$scope.principal</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="no">principal</span><span class="c1">;</span>
<span class="err">})</span><span class="c1">;</span>
</pre></div>

<p>Show or hide an element:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">ng-show=</span><span class="s">"principal.isAuthenticated()"</span><span class="nt">&gt;</span>
<span class="w">   </span>I'm<span class="w"> </span>logged<span class="w"> </span>in
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="na">ng-hide=</span><span class="s">"principal.isAuthenticated()"</span><span class="nt">&gt;</span>
<span class="w">  </span>I'm<span class="w"> </span>not<span class="w"> </span>logged<span class="w"> </span>in
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>Etc., so on, so forth. Anyways, in your example app, you would have a state
for home page that would let unauthenticated users drop by. They could have
links to the sign-in or sign-up states, or have those forms built into that
page. Whatever suits you.</p>
<p>The dashboard pages could all inherit from a state that requires the users to
be logged in and, say, be a <code>User</code> role member. All the authorization stuff
we've discussed would flow from there.</p>
<p><br></p>
<h3>Suggest</h3>
<p>The solutions posted so far are needlessly complicated, in my opinion. There's
a simpler way. The documentation of <code>ui-router</code> says listen to
<code>$locationChangeSuccess</code> and use <code>$urlRouter.sync()</code> to check a state
transition, halt it, or resume it. But even that actually doesn't work.</p>
<p>However, here are two simple alternatives. Pick one:</p>
<h2>Solution 1: listening on <code>$locationChangeSuccess</code>
</h2>
<p>You can listen to <code>$locationChangeSuccess</code> and you can perform some logic,
even asynchronous logic there. Based on that logic, you can let the function
return undefined, which will cause the state transition to continue as normal,
or you can do <code>$state.go('logInPage')</code>, if the user needs to be authenticated.
Here's an example:</p>
<div class="code"><pre class="code literal-block"><span class="nf">angular.module</span><span class="p">(</span><span class="err">'</span><span class="no">App</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="err">'</span><span class="no">ui.router</span><span class="err">'</span><span class="p">])</span>

<span class="c1">// In the run phase of your Angular application  </span>
<span class="na">.run</span><span class="p">(</span><span class="no">function</span><span class="p">(</span><span class="no">$rootScope</span><span class="p">,</span><span class="w"> </span><span class="no">user</span><span class="p">,</span><span class="w"> </span><span class="no">$state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="c1">// Listen to '$locationChangeSuccess', not '$stateChangeStart'</span>
<span class="w">  </span><span class="nf">$rootScope.$on</span><span class="p">(</span><span class="err">'</span><span class="no">$locationChangeSuccess</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="no">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nf">user</span>
<span class="w">      </span><span class="na">.logIn</span><span class="p">()</span>
<span class="w">      </span><span class="na">.catch</span><span class="p">(</span><span class="no">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// log-in promise failed. Redirect to log-in page.</span>
<span class="w">        </span><span class="nf">$state.go</span><span class="p">(</span><span class="err">'</span><span class="no">logInPage</span><span class="err">'</span><span class="p">)</span>
<span class="w">      </span><span class="err">})</span>
<span class="w">  </span><span class="err">})</span>
<span class="err">})</span>
</pre></div>

<p>Keep in mind that this doesn't actually prevent the target state from loading,
but it does redirect to the log-in page if the user is unauthorized. That's
okay since real protection is on the server, anyway.</p>
<h2>Solution 2: using state <code>resolve</code>
</h2>
<p>In this solution, you use <code>ui-router</code> resolve feature.</p>
<p>You basically reject the promise in <code>resolve</code> if the user is not authenticated
and then redirect them to the log-in page.</p>
<p>Here's how it goes:</p>
<div class="code"><pre class="code literal-block"><span class="n">angular</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">'App'</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">'ui.router'</span><span class="p">])</span>

<span class="o">.</span><span class="n">config</span><span class="p">(</span>
<span class="w">  </span><span class="n">function</span><span class="p">(</span><span class="o">$</span><span class="n">stateProvider</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">$</span><span class="n">stateProvider</span>
<span class="w">      </span><span class="o">.</span><span class="n">state</span><span class="p">(</span><span class="s1">'logInPage'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="s1">'/logInPage'</span><span class="p">,</span>
<span class="w">        </span><span class="n">templateUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">'sections/logInPage.html'</span><span class="p">,</span>
<span class="w">        </span><span class="n">controller</span><span class="p">:</span><span class="w"> </span><span class="s1">'logInPageCtrl'</span><span class="p">,</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="o">.</span><span class="n">state</span><span class="p">(</span><span class="s1">'myProtectedContent'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="s1">'/myProtectedContent'</span><span class="p">,</span>
<span class="w">        </span><span class="n">templateUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">'sections/myProtectedContent.html'</span><span class="p">,</span>
<span class="w">        </span><span class="n">controller</span><span class="p">:</span><span class="w"> </span><span class="s1">'myProtectedContentCtrl'</span><span class="p">,</span>
<span class="w">        </span><span class="n">resolve</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">authenticate</span><span class="p">:</span><span class="w"> </span><span class="n">authenticate</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">})</span>
<span class="w">      </span><span class="o">.</span><span class="n">state</span><span class="p">(</span><span class="s1">'alsoProtectedContent'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="s1">'/alsoProtectedContent'</span><span class="p">,</span>
<span class="w">        </span><span class="n">templateUrl</span><span class="p">:</span><span class="w"> </span><span class="s1">'sections/alsoProtectedContent.html'</span><span class="p">,</span>
<span class="w">        </span><span class="n">controller</span><span class="p">:</span><span class="w"> </span><span class="s1">'alsoProtectedContentCtrl'</span><span class="p">,</span>
<span class="w">        </span><span class="n">resolve</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">authenticate</span><span class="p">:</span><span class="w"> </span><span class="n">authenticate</span><span class="w"> </span><span class="p">}</span>
<span class="w">      </span><span class="p">})</span>

<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">authenticate</span><span class="p">(</span><span class="o">$</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">timeout</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">isAuthenticated</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Resolve</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">promise</span><span class="w"> </span><span class="n">successfully</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">q</span><span class="o">.</span><span class="n">when</span><span class="p">()</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="n">bit</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">asynchronously</span><span class="w"> </span><span class="n">tricky</span><span class="o">.</span>

<span class="w">        </span><span class="o">$</span><span class="n">timeout</span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">runs</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">authentication</span><span class="w"> </span><span class="n">promise</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">rejected</span><span class="o">.</span>
<span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">Go</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nb">log</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="n">page</span>
<span class="w">          </span><span class="o">$</span><span class="n">state</span><span class="o">.</span><span class="n">go</span><span class="p">(</span><span class="s1">'logInPage'</span><span class="p">)</span>
<span class="w">        </span><span class="p">})</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Reject</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">authentication</span><span class="w"> </span><span class="n">promise</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">prevent</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">loading</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">q</span><span class="o">.</span><span class="n">reject</span><span class="p">()</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">)</span>
</pre></div>

<p>Unlike the first solution, this solution actually prevents the target state
from loading.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/redirect-parent-window-from-an-iframe-action/" class="u-url">Redirect parent window from an iframe action</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/redirect-parent-window-from-an-iframe-action/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T15:05:57+08:00" itemprop="datePublished" title="2023-03-04 15:05">2023-03-04 15:05</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What JavaScript do I need to use to redirect a parent window from an iframe?</p>
<p>I want them to click a hyperlink which, using JavaScript or any other method,
would redirect the parent window to a new URL.</p>
<p><br><br></p>
<h2>Answer</h2>
<div class="code"><pre class="code literal-block"><span class="nt">window</span><span class="p">.</span><span class="nc">top</span><span class="p">.</span><span class="nc">location</span><span class="p">.</span><span class="nc">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://www.example.com"</span><span class="o">;</span>
</pre></div>

<p>Will redirect the top most parent Iframe.</p>
<div class="code"><pre class="code literal-block"><span class="nt">window</span><span class="p">.</span><span class="nc">parent</span><span class="p">.</span><span class="nc">location</span><span class="p">.</span><span class="nc">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://www.example.com"</span><span class="o">;</span>
</pre></div>

<p>Will redirect the parent iframe.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I found that <code>&lt;a href="..." target="_top"&gt;link&lt;/a&gt;</code> works too</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/exclude-file-from-git-diff/" class="u-url">Exclude file from "git diff"</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/exclude-file-from-git-diff/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T15:04:33+08:00" itemprop="datePublished" title="2023-03-04 15:04">2023-03-04 15:04</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am trying to exclude a file (<code>db/irrelevant.php</code>) from a Git diff. I have
tried putting a file in the <code>db</code> subdirectory called <code>.gitattributes</code> with the
line <code>irrelevant.php -diff</code> and I have also tried creating a file called
<code>.git/info/attributes</code> containing <code>db/irrelevant.php</code>.</p>
<p>In all cases, the <code>db/irrelevant.php</code> file is included in the diff as a Git
binary patch. What I want is for the changes to that file to be ignore by the
diff command. What am I doing wrong?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Omg, drivers and <code>awk</code> to exclude a lousy file? Since Git 1.9 something you
can:</p>
<div class="code"><pre class="code literal-block">git diff -- . ':(exclude)db/irrelevant.php' ':(exclude)db/irrelevant2.php'
</pre></div>

<p>(On Windows, replace the single quotes <code>'</code> by double quotes <code>"</code>.)</p>
<p>Ah, elegance! See the quoted answer and for details this answer by @torek.</p>
<p><br></p>
<h3>Suggest</h3>
<p>This method is shorter than the accepted answers.</p>
<div class="code"><pre class="code literal-block">git diff 987200fbfb 878cee40ba -- ':!*.cs'
</pre></div>

<p>For more information about the different inclusion/exclusion possibilities
read this other post</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2425.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2423.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
