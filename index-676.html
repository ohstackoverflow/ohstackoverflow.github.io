<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 676) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-676.html">
<link rel="prev" href="index-677.html" type="text/html">
<link rel="next" href="index-675.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/ru-he-shi-xian-ji-ben-de-chang-lun-xun/" class="u-url">如何实现基本的“长轮询”？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/ru-he-shi-xian-ji-ben-de-chang-lun-xun/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T13:11:47+08:00" itemprop="datePublished" title="2023-02-17 13:11">2023-02-17 13:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我可以找到很多关于长轮询如何工作的信息（例如，this和this），但没有关于如何在代码中实现它的 <em>简单示例。</em></p>
<p>我能找到的只有cometd，它依赖于 Dojo JS 框架和一个相当复杂的服务器系统。</p>
<p>基本上，我将如何使用 Apache 来处理请求，以及我将如何编写一个简单的脚本（例如，用 PHP）来“长时间轮询”服务器以获取新消息？</p>
<p>该示例不必是可扩展的、安全的或完整的，它只需要工作！</p>
<p><br><br></p>
<h2>解答</h2>
<p>它比我最初想象的要简单。基本上你有一个什么都不做的页面，直到你想要发送的数据可用（比如，一条新消息到达）。</p>
<p>这是一个非常基本的示例，它会在 2-10 秒后发送一个简单的字符串。三分之一的机会返回错误 404（在接下来的 Javascript 示例中显示错误处理）</p>
<p><code>msgsrv.php</code></p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?php</span>
<span class="k">if</span><span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
    <span class="cm">/* Fake an error */</span>
    <span class="nb">header</span><span class="p">(</span><span class="s2">"HTTP/1.0 404 Not Found"</span><span class="p">);</span>
    <span class="k">die</span><span class="p">();</span>
<span class="p">}</span>

<span class="cm">/* Send a string after a random number of seconds (2-10) */</span>
<span class="nb">sleep</span><span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">));</span>
<span class="k">echo</span><span class="p">(</span><span class="s2">"Hi! Have a random number: "</span> <span class="o">.</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">));</span>
<span class="cp">?&gt;</span>
</pre></div>

<p>注意：对于真实站点，在像 Apache 这样的常规 Web
服务器上运行它会很快占用所有“工作线程”并使其无法响应其他请求。有很多方法可以解决这个问题，但建议编写类似于 Python 的twisted
的“长轮询服务器” ，它不依赖于每个请求的一个线程。cometD是一个流行的框架（有多种语言版本），而Tornado是专门为此类任务制作的新框架（它是为
FriendFeed 的长轮询代码构建的）......但作为一个简单的例子，A​​pache 绰绰有余！这个脚本可以很容易地用任何语言编写（我选择了
Apache/PHP，因为它们很常见，而且我恰好在本地运行它们）</p>
<p>然后，在 Javascript 中，您请求上述文件 (
<code>msg_srv.php</code>)，并等待响应。当你得到一个时，你就根据数据采取行动。然后你请求文件并再次等待，对数据采取行动（并重复）</p>
<p>下面是这样一个页面的示例。当页面加载时，它会发送对文件的初始请求。如果<code>msgsrv.php</code>成功，我们将消息附加到<code>#messages</code>div，然后在 1
秒后我们再次调用 waitForMsg 函数，这会触发等待。</p>
<p>1 秒<code>setTimeout()</code>是一个非常基本的速率限制器，没有这个它也能正常工作，但如果<code>msgsrv.php</code> <em>总是</em>
立即返回（例如，有语法错误）——你会淹没浏览器，它会很快冻结。最好检查文件是否包含有效的 JSON 响应，和/或保持每分钟/秒的运行总请求数，并适当暂停。</p>
<p>如果页面出错，它会将错误附加到<code>#messages</code>div，等待 15 秒，然后重试（与我们在每条消息后等待 1 秒的方式相同）</p>
<p>这种方法的好处是它非常有弹性。如果客户端 Internet 连接中断，它将超时，然后尝试重新连接 - 这是轮询工作时间所固有的，不需要复杂的错误处理</p>
<p>无论如何，<code>long_poller.htm</code>代码，使用 jQuery 框架：</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="w">    </span><span class="nt">&lt;title&gt;</span>BargePoller<span class="nt">&lt;/title&gt;</span>
<span class="w">    </span><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"</span><span class="w"> </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="w"> </span><span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="w">    </span><span class="nt">&lt;style</span><span class="w"> </span><span class="na">type=</span><span class="s">"text/css"</span><span class="w"> </span><span class="na">media=</span><span class="s">"screen"</span><span class="nt">&gt;</span>
<span class="w">      </span>body{<span class="w"> </span>background:#000;color:#fff;font-size:.9em;<span class="w"> </span>}
<span class="w">      </span>.msg{<span class="w"> </span>background:#aaa;padding:.2em;<span class="w"> </span>border-bottom:1px<span class="w"> </span>#000<span class="w"> </span>solid}
<span class="w">      </span>.old{<span class="w"> </span>background-color:#246499;}
<span class="w">      </span>.new{<span class="w"> </span>background-color:#3B9957;}
<span class="w">    </span>.error{<span class="w"> </span>background-color:#992E36;}
<span class="w">    </span><span class="nt">&lt;/style&gt;</span>

<span class="w">    </span><span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="w"> </span><span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
<span class="w">    </span>function<span class="w"> </span>addmsg(type,<span class="w"> </span>msg){
<span class="w">        </span>/*<span class="w"> </span>Simple<span class="w"> </span>helper<span class="w"> </span>to<span class="w"> </span>add<span class="w"> </span>a<span class="w"> </span>div.
<span class="w">        </span>type<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>name<span class="w"> </span>of<span class="w"> </span>a<span class="w"> </span>CSS<span class="w"> </span>class<span class="w"> </span>(old/new/error).
<span class="w">        </span>msg<span class="w"> </span>is<span class="w"> </span>the<span class="w"> </span>contents<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>div<span class="w"> </span>*/
<span class="w">        </span>$("#messages").append(
<span class="w">            </span>"<span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">'msg "+ type +"'</span><span class="nt">&gt;</span>"+<span class="w"> </span>msg<span class="w"> </span>+"<span class="nt">&lt;/div&gt;</span>"
<span class="w">        </span>);
<span class="w">    </span>}

<span class="w">    </span>function<span class="w"> </span>waitForMsg(){
<span class="w">        </span>/*<span class="w"> </span>This<span class="w"> </span>requests<span class="w"> </span>the<span class="w"> </span>url<span class="w"> </span>"msgsrv.php"
<span class="w">        </span>When<span class="w"> </span>it<span class="w"> </span>complete<span class="w"> </span>(or<span class="w"> </span>errors)*/
<span class="w">        </span>$.ajax({
<span class="w">            </span>type:<span class="w"> </span>"GET",
<span class="w">            </span>url:<span class="w"> </span>"msgsrv.php",

<span class="w">            </span>async:<span class="w"> </span>true,<span class="w"> </span>/*<span class="w"> </span>If<span class="w"> </span>set<span class="w"> </span>to<span class="w"> </span>non-async,<span class="w"> </span>browser<span class="w"> </span>shows<span class="w"> </span>page<span class="w"> </span>as<span class="w"> </span>"Loading.."*/
<span class="w">            </span>cache:<span class="w"> </span>false,
<span class="w">            </span>timeout:50000,<span class="w"> </span>/*<span class="w"> </span>Timeout<span class="w"> </span>in<span class="w"> </span>ms<span class="w"> </span>*/

<span class="w">            </span>success:<span class="w"> </span>function(data){<span class="w"> </span>/*<span class="w"> </span>called<span class="w"> </span>when<span class="w"> </span>request<span class="w"> </span>to<span class="w"> </span>barge.php<span class="w"> </span>completes<span class="w"> </span>*/
<span class="w">                </span>addmsg("new",<span class="w"> </span>data);<span class="w"> </span>/*<span class="w"> </span>Add<span class="w"> </span>response<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>.msg<span class="w"> </span>div<span class="w"> </span>(with<span class="w"> </span>the<span class="w"> </span>"new"<span class="w"> </span>class)*/
<span class="w">                </span>setTimeout(
<span class="w">                    </span>waitForMsg,<span class="w"> </span>/*<span class="w"> </span>Request<span class="w"> </span>next<span class="w"> </span>message<span class="w"> </span>*/
<span class="w">                    </span>1000<span class="w"> </span>/*<span class="w"> </span>..after<span class="w"> </span>1<span class="w"> </span>seconds<span class="w"> </span>*/
<span class="w">                </span>);
<span class="w">            </span>},
<span class="w">            </span>error:<span class="w"> </span>function(XMLHttpRequest,<span class="w"> </span>textStatus,<span class="w"> </span>errorThrown){
<span class="w">                </span>addmsg("error",<span class="w"> </span>textStatus<span class="w"> </span>+<span class="w"> </span>"<span class="w"> </span>("<span class="w"> </span>+<span class="w"> </span>errorThrown<span class="w"> </span>+<span class="w"> </span>")");
<span class="w">                </span>setTimeout(
<span class="w">                    </span>waitForMsg,<span class="w"> </span>/*<span class="w"> </span>Try<span class="w"> </span>again<span class="w"> </span>after..<span class="w"> </span>*/
<span class="w">                    </span>15000);<span class="w"> </span>/*<span class="w"> </span>milliseconds<span class="w"> </span>(15seconds)<span class="w"> </span>*/
<span class="w">            </span>}
<span class="w">        </span>});
<span class="w">    </span>};

<span class="w">    </span>$(document).ready(function(){
<span class="w">        </span>waitForMsg();<span class="w"> </span>/*<span class="w"> </span>Start<span class="w"> </span>the<span class="w"> </span>inital<span class="w"> </span>request<span class="w"> </span>*/
<span class="w">    </span>});
<span class="w">    </span><span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">"messages"</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">"msg old"</span><span class="nt">&gt;</span>
<span class="w">            </span>BargePoll<span class="w"> </span>message<span class="w"> </span>requester!
<span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>

<p><br></p>
<h3>更多建议</h3>
<p>作为slosh的一部分，我有一个非常简单的聊天示例。</p>
<p><strong>编辑</strong> ：（因为每个人都在这里粘贴他们的代码）</p>
<p>这是使用长轮询和slosh的完整的基于 JSON 的多用户聊天。这是一个如何进行调用的 <strong>演示，所以请忽略 XSS 问题。</strong>
没有人应该先对其进行消毒，然后再进行部署。</p>
<p>请注意，客户端 <em>始终</em> 与服务器建立连接，一旦有人发送消息，每个人都应该立即大致看到它。</p>
<div class="code"><pre class="code literal-block"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"</span>
<span class="cp">  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;</span>
<span class="cm">&lt;!-- Copyright (c) 2008 Dustin Sallings &lt;dustin+html@spy.net&gt; --&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">"en"</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>slosh chat<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span>
      <span class="na">src</span><span class="o">=</span><span class="s">"http://code.jquery.com/jquery-latest.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">title</span><span class="o">=</span><span class="s">"Default"</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">media</span><span class="o">=</span><span class="s">"screen"</span> <span class="na">href</span><span class="o">=</span><span class="s">"style.css"</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome to Slosh Chat<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"messages"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"from"</span><span class="p">&gt;</span>First!:<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"msg"</span><span class="p">&gt;</span>Welcome to chat. Please don't hurt each other.<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">"post"</span> <span class="na">action</span><span class="o">=</span><span class="s">"#"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Nick: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">'from'</span> <span class="na">type</span><span class="o">=</span><span class="s">"text"</span> <span class="na">name</span><span class="o">=</span><span class="s">"from"</span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Message:<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">textarea</span> <span class="na">id</span><span class="o">=</span><span class="s">'msg'</span> <span class="na">name</span><span class="o">=</span><span class="s">"msg"</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Say it"</span> <span class="na">id</span><span class="o">=</span><span class="s">"submit"</span><span class="p">/&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"text/javascript"</span><span class="p">&gt;</span>
<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">gotData</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span><span class="w"> </span><span class="nx">st</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">msgs</span><span class="o">=</span><span class="nx">$</span><span class="p">(</span><span class="s1">'#messages'</span><span class="p">);</span>
<span class="w">        </span><span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">res</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="kd">var</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="kr">from</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span>
<span class="w">          </span><span class="kd">var</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">msg</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span>
<span class="w">          </span><span class="nx">msgs</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"&lt;div&gt;&lt;span class='from'&gt;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">":&lt;/span&gt;"</span><span class="w"> </span><span class="o">+</span>
<span class="w">            </span><span class="s2">" &lt;span class='msg'&gt;"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"&lt;/span&gt;&lt;/div&gt;"</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="c1">// The jQuery wrapped msgs above does not work here.</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">msgs</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"messages"</span><span class="p">);</span>
<span class="w">        </span><span class="nx">msgs</span><span class="p">.</span><span class="nx">scrollTop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">msgs</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="kd">function</span><span class="w"> </span><span class="nx">getNewComments</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">'/topics/chat.json'</span><span class="p">,</span><span class="w"> </span><span class="nx">gotData</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ajaxStop</span><span class="p">(</span><span class="nx">getNewComments</span><span class="p">);</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s2">"form"</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/topics/chat'</span><span class="p">,</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">'form'</span><span class="p">).</span><span class="nx">serialize</span><span class="p">());</span>
<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="nx">getNewComments</span><span class="p">();</span>
<span class="w">      </span><span class="p">});</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>

<p><br><br><a href="posts/how-do-i-implement-basic-long-polling/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/git-cherry-pick-shuo-38c74d-shi-he-bing-dan-mei-you-gei-chu-m-xuan-xiang/" class="u-url">git cherry-pick 说“...38c74d 是合并但没有给出 -m 选项”</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/git-cherry-pick-shuo-38c74d-shi-he-bing-dan-mei-you-gei-chu-m-xuan-xiang/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T13:11:19+08:00" itemprop="datePublished" title="2023-02-17 13:11">2023-02-17 13:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>我在我的 master 分支中做了一些更改，并想将它们带到上游。当我挑选以下提交时。但是，我卡在 fd9f578 上，git 说：</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>git<span class="w"> </span>cherry-pick<span class="w"> </span>fd9f578
fatal:<span class="w"> </span>Commit<span class="w"> </span>fd9f57850f6b94b7906e5bbe51a0d75bf638c74d<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>merge<span class="w"> </span>but<span class="w"> </span>no<span class="w"> </span>-m<span class="w"> </span>option<span class="w"> </span>was<span class="w"> </span>given.
</pre></div>

<p>git 试图告诉我什么，cherry-pick 是否适合在这里使用？master
分支确实包含对上游分支中已修改的文件的更改，因此我确定会有一些合并冲突，但这些冲突并不太糟糕，无法理顺。我知道哪里需要进行哪些更改。</p>
<p>这些是我想带到上游的提交。</p>
<div class="code"><pre class="code literal-block">e7d4cff added some comments...
23e6d2a moved static strings...
44cc65a incorporated test ...
40b83d5 whoops delete whitspace...
24f8a50 implemented global.c...
43651c3 cleaned up ...
068b2fe cleaned up version.c ...
fd9f578 Merge branch 'master' of ssh://extgit/git/sessions_common
4172caa cleaned up comments in sessions.c ...
</pre></div>

<p><br><br></p>
<h2>解答</h2>
<p>cherry-pick 的工作方式是获取变更集所代表的差异（此时的工作树与其父级的工作树之间的差异），并将其应用于当前分支。</p>
<p>因此，如果一个提交有两个或多个父项，它也代表两个或多个差异——应该应用哪一个？</p>
<p>您正在尝试 cherry pick <code>fd9f578</code>，这是与两个父母的合并。因此，您需要使用选项告诉 cherry-pick 命令应该针对哪个 diff
进行计算<code>-m</code>。例如，<code>git cherry-pick -m 1 fd9f578</code>使用父 1 作为基础。</p>
<p>对于您的特定情况，我不能肯定地说，但通常建议使用<code>git merge</code>而不是<code>git cherry-
pick</code>。当您挑选合并提交时，它会将您未指定的父项中所做的 <strong>所有</strong> 更改折叠<code>-m</code>到该 <strong>提交</strong>
中。你失去了他们所有的历史，并把他们所有的差异放在一起。你的来电。</p>
<p><br></p>
<h3>更多建议</h3>
<p><code>-m</code>指父母号码。</p>
<p>来自 git 文档：</p>
<blockquote>
<p>通常你不能挑选合并，因为你不知道合并的哪一边应该被认为是主线。此选项指定主线的父编号（从 1 开始），并允许 cherry-pick
重播相对于指定父级的更改。</p>
</blockquote>
<p>例如，如果您的提交树如下所示：</p>
<div class="code"><pre class="code literal-block">- A - D - E - F -   master
   \     /
    B - C           branch one
</pre></div>

<p>然后<code>git cherry-pick E</code>会产生你面临的问题。</p>
<p><code>git cherry-pick E -m 1</code>表示使用<code>D-E</code>，而<code>git cherry-pick E -m 2</code>表示使用<code>B-C-E</code>。</p>
<p><br><br><a href="posts/git-cherry-pick-says-38c74d-is-a-merge-but-no-m-option-was-given/">查看原文</a></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/shi-shi-yu-kuo-zhan-he-shi-shi-yong-you-shi-yao-bu-tong/" class="u-url">实施与扩展：何时使用？有什么不同？</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/shi-shi-yu-kuo-zhan-he-shi-shi-yong-you-shi-yao-bu-tong/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T13:10:52+08:00" itemprop="datePublished" title="2023-02-17 13:10">2023-02-17 13:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>请用通俗易懂的语言或某篇文章的链接进行说明。</p>
<p><br><br></p>
<h2>解答</h2>
<p><code>extends</code>用于 <em>扩展</em> 类。</p>
<p><code>implements</code>用于 <em>实现</em> 接口</p>
<p>接口和常规类之间的区别在于，在接口中您不能实现任何已声明的方法。只有“实现”接口的类才能实现这些方法。接口的 C++
等价物是一个抽象类（不完全相同，但差不多）。</p>
<p>java也不支持类的 <strong>多重继承。</strong> 这是通过使用多个接口来解决的。</p>
<div class="code"><pre class="code literal-block"> public interface ExampleInterface {
    public void doAction();
    public String doThis(int number);
 }

 public class sub implements ExampleInterface {
     public void doAction() {
       //specify what must happen
     }

     public String doThis(int number) {
       //specfiy what must happen
     }
 }
</pre></div>

<p>现在扩展一个类</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">SuperClass</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getNb</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="o">//</span><span class="n">specify</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">happen</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getNb2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="o">//</span><span class="n">specify</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">happen</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">SubClass</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="n">SuperClass</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="o">//</span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">override</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">implementation</span>
<span class="w">      </span><span class="err">@</span><span class="n">Override</span>
<span class="w">      </span><span class="n">public</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">getNb2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>

<p>在这种情况下</p>
<div class="code"><pre class="code literal-block">  Subclass s = new SubClass();
  s.getNb(); //returns 1
  s.getNb2(); //returns 3

  SuperClass sup = new SuperClass();
  sup.getNb(); //returns 1
  sup.getNb2(); //returns 2
</pre></div>

<p>另外，请注意<code>@Override</code>实现接口不需要标记，因为原始接口方法中没有任何内容 <em>可以被覆盖</em></p>
<p><strong>我建议你对面向对象编程中的动态绑定、多态性和一般继承</strong> 做更多的研究 ****</p>
<p><br></p>
<h3>更多建议</h3>
<p>我注意到您的个人资料中有一些 C++ 问题。 <em>如果你从 C++ 中理解多重继承</em> 的概念（指的是从多个其他类继承特征的类），Java
不允许这样做，但它确实有关键字<code>interface</code>，这有点像 C++
中的纯虚拟类。正如很多人提到的那样，您是<code>extend</code>一个类（并且您只能从一个类扩展），而您<code>implement</code>是一个接口——但是您的类可以实现任意数量的接口。</p>
<p>即，这些关键字及其使用规则描述了 Java 中多重继承的可能性（您只能拥有一个超类，但您可以实现多个接口）。</p>
<p><br><br><a href="posts/implements-vs-extends-when-to-use-what-s-the-difference/">查看原文</a></p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-677.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-675.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
