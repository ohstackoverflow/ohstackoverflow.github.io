<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 2522) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-2522.html">
<link rel="prev" href="index-2523.html" type="text/html">
<link rel="next" href="index-2521.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/understanding-esmoduleinterop-in-tsconfig-file/" class="u-url">Understanding esModuleInterop in tsconfig file</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/understanding-esmoduleinterop-in-tsconfig-file/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T22:21:48+08:00" itemprop="datePublished" title="2023-03-04 22:21">2023-03-04 22:21</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I was checking out someone <code>.tsconfig</code> file and there I spotted
<code>--esModuleInterop</code></p>
<p>This is his <code>.tsconfig</code> file</p>
<div class="code"><pre class="code literal-block"><span class="err">{</span>
<span class="w">  </span><span class="ss">"compilerOptions"</span><span class="err">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="ss">"moduleResolution"</span><span class="err">:</span><span class="w"> </span><span class="ss">"node"</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"target"</span><span class="err">:</span><span class="w"> </span><span class="ss">"es6"</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"module"</span><span class="err">:</span><span class="w"> </span><span class="ss">"commonjs"</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"lib"</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">"esnext"</span><span class="o">]</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"strict"</span><span class="err">:</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"sourceMap"</span><span class="err">:</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"declaration"</span><span class="err">:</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"esModuleInterop"</span><span class="err">:</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"allowSyntheticDefaultImports"</span><span class="err">:</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"experimentalDecorators"</span><span class="err">:</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"emitDecoratorMetadata"</span><span class="err">:</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"declarationDir"</span><span class="err">:</span><span class="w"> </span><span class="ss">"./dist"</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"outDir"</span><span class="err">:</span><span class="w"> </span><span class="ss">"./dist"</span><span class="p">,</span>
<span class="w">    </span><span class="ss">"typeRoots"</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">"node_modules/@types"</span><span class="o">]</span>
<span class="w">  </span><span class="err">}</span><span class="p">,</span>
<span class="w">  </span><span class="ss">"include"</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">"src/**/*.ts"</span><span class="o">]</span><span class="p">,</span>
<span class="w">  </span><span class="ss">"exclude"</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">"node_modues"</span><span class="o">]</span>
<span class="err">}</span>
</pre></div>

<p>Here, My primary question is what is <code>"esModuleInterop": true,</code> and
<code>"allowSyntheticDefaultImports": true,</code>. I know they are sort of dependent on
the <code>"module": "commonjs",</code> . Can someone try to explain it in the best human
language possible?</p>
<p>The official docs for <code>allowSyntheticDefaultImports</code> states</p>
<blockquote>
<p>Allow default imports from modules with no default export. This does not
affect code emit, just typechecking.</p>
</blockquote>
<p>What does that mean? If there isn't any export default then I think the only
use case of the import default would be to initialize something? Like a
singleton?</p>
<p>The following question/answer does not make sense as well Is there a way to
use --esModuleInterop in tsconfig as opposed to it being a flag?</p>
<p>And <code>--esModuleInterop</code> definition on the compiler page</p>
<blockquote>
<p>Emit __importStar and __importDefault helpers for runtime babel ecosystem
compatibility and enable --allowSyntheticDefaultImports for typesystem
compatibility.</p>
</blockquote>
<p>Also seemed difficult for me to understand/comprehend</p>
<p><br><br></p>
<h2>Answer</h2>
<h2>Problem statement</h2>
<p>Problem occurs when we want to import CommonJS module into ES6 module
codebase.</p>
<p>Before these flags we had to import CommonJS modules with star (<code>* as
something</code>) import:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span> <span class="n">node_modules</span><span class="o">/</span><span class="n">moment</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">js</span>
<span class="n">exports</span> <span class="o">=</span> <span class="n">moment</span>



<span class="o">//</span> <span class="n">index</span><span class="o">.</span><span class="n">ts</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">our</span> <span class="n">app</span>
<span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">moment</span> <span class="kn">from</span> <span class="s1">'moment'</span>
<span class="n">moment</span><span class="p">();</span> <span class="o">//</span> <span class="ow">not</span> <span class="n">compliant</span> <span class="k">with</span> <span class="n">es6</span> <span class="n">module</span> <span class="n">spec</span>

<span class="o">//</span> <span class="n">transpiled</span> <span class="n">js</span> <span class="p">(</span><span class="n">simplified</span><span class="p">):</span>
<span class="n">const</span> <span class="n">moment</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">"moment"</span><span class="p">);</span>
<span class="n">moment</span><span class="p">();</span>
</pre></div>

<p>We can see that <code>*</code> was somehow equivalent to <code>exports</code> variable. It worked
fine, but it wasn't compliant with es6 modules spec. In spec, the namespace
record in star import (<code>moment</code> in our case) can be only a plain object, not
callable (<code>moment()</code> is not allowed).</p>
<h2>Solution</h2>
<p>With flag <code>esModuleInterop</code> we can import CommonJS modules in compliance with
<code>es6</code> modules spec. Now our import code looks like this:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span> <span class="n">index</span><span class="o">.</span><span class="n">ts</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">our</span> <span class="n">app</span>
<span class="kn">import</span> <span class="nn">moment</span> <span class="kn">from</span> <span class="s1">'moment'</span>
<span class="n">moment</span><span class="p">();</span> <span class="o">//</span> <span class="n">compliant</span> <span class="k">with</span> <span class="n">es6</span> <span class="n">module</span> <span class="n">spec</span>

<span class="o">//</span> <span class="n">transpiled</span> <span class="n">js</span> <span class="k">with</span> <span class="n">esModuleInterop</span> <span class="p">(</span><span class="n">simplified</span><span class="p">):</span>
<span class="n">const</span> <span class="n">moment</span> <span class="o">=</span> <span class="n">__importDefault</span><span class="p">(</span><span class="n">require</span><span class="p">(</span><span class="s1">'moment'</span><span class="p">));</span>
<span class="n">moment</span><span class="o">.</span><span class="n">default</span><span class="p">();</span>
</pre></div>

<p>It works and it's perfectly valid with es6 modules spec, because <code>moment</code> is
not namespace from star import, it's default import.</p>
<p>But how does it work? As you can see, because we did a default import, we
called the <code>default</code> property on a <code>moment</code> object. But we didn't declare a
<code>default</code> property on the <code>exports</code> object in the moment library. The key is
the <code>__importDefault</code> function. It assigns module (<code>exports</code>) to the <code>default</code>
property for CommonJS modules:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">__importDefault</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">this</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">__importDefault</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">mod</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">mod</span><span class="o">.</span><span class="n">__esModule</span><span class="p">)</span><span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="n">mod</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"default"</span><span class="p">:</span><span class="w"> </span><span class="n">mod</span><span class="w"> </span><span class="p">};</span>
<span class="p">};</span>
</pre></div>

<p>As you can see, we import es6 modules as they are, but CommonJS modules are
wrapped into an object with the <code>default</code> key. This makes it possible to
import defaults on CommonJS modules.</p>
<p><code>__importStar</code> does the similar job - it returns untouched esModules, but
translates CommonJS modules into modules with a <code>default</code> property:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span> <span class="n">index</span><span class="o">.</span><span class="n">ts</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">our</span> <span class="n">app</span>
<span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">moment</span> <span class="kn">from</span> <span class="s1">'moment'</span>

<span class="o">//</span> <span class="n">transpiled</span> <span class="n">js</span> <span class="k">with</span> <span class="n">esModuleInterop</span> <span class="p">(</span><span class="n">simplified</span><span class="p">):</span>
<span class="n">const</span> <span class="n">moment</span> <span class="o">=</span> <span class="n">__importStar</span><span class="p">(</span><span class="n">require</span><span class="p">(</span><span class="s2">"moment"</span><span class="p">));</span>
<span class="o">//</span> <span class="n">note</span> <span class="n">that</span> <span class="s2">"moment"</span> <span class="ow">is</span> <span class="n">now</span> <span class="n">uncallable</span> <span class="o">-</span> <span class="n">ts</span> <span class="n">will</span> <span class="n">report</span> <span class="n">error</span><span class="err">!</span>



<span class="n">var</span> <span class="n">__importStar</span> <span class="o">=</span> <span class="p">(</span><span class="n">this</span> <span class="o">&amp;&amp;</span> <span class="n">this</span><span class="o">.</span><span class="n">__importStar</span><span class="p">)</span> <span class="o">||</span> <span class="n">function</span> <span class="p">(</span><span class="n">mod</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mod</span> <span class="o">&amp;&amp;</span> <span class="n">mod</span><span class="o">.</span><span class="n">__esModule</span><span class="p">)</span> <span class="k">return</span> <span class="n">mod</span><span class="p">;</span>
    <span class="n">var</span> <span class="n">result</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mod</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">var</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">Object</span><span class="o">.</span><span class="n">hasOwnProperty</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">"default"</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>

<h2>Synthetic imports</h2>
<p>And what about <code>allowSyntheticDefaultImports</code> - what is it for? Now the docs
should be clear:</p>
<p><code>Allow default imports from modules with no default export. This does not
affect code emit, just typechecking.</code></p>
<p>In <code>moment</code> typings we don't have specified default export, and we shouldn't
have, because it's available only with flag <code>esModuleInterop</code> on. So
<code>allowSyntheticDefaultImports</code> will not report an error if we want to import
default from a third-party module which doesn't have a default export.</p>
<p><br></p>
<h3>Suggest</h3>
<p><code>esModuleInterop</code> generates the helpers outlined in the docs. Looking at the
generated code, we can see exactly what these do:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span><span class="n">ts</span> 
<span class="kn">import</span> <span class="nn">React</span> <span class="kn">from</span> <span class="s1">'react'</span>
<span class="o">//</span><span class="n">js</span> 
<span class="n">var</span> <span class="n">__importDefault</span> <span class="o">=</span> <span class="p">(</span><span class="n">this</span> <span class="o">&amp;&amp;</span> <span class="n">this</span><span class="o">.</span><span class="n">__importDefault</span><span class="p">)</span> <span class="o">||</span> <span class="n">function</span> <span class="p">(</span><span class="n">mod</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">mod</span> <span class="o">&amp;&amp;</span> <span class="n">mod</span><span class="o">.</span><span class="n">__esModule</span><span class="p">)</span> <span class="err">?</span> <span class="n">mod</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">"default"</span><span class="p">:</span> <span class="n">mod</span> <span class="p">};</span>
<span class="p">};</span>
<span class="n">Object</span><span class="o">.</span><span class="n">defineProperty</span><span class="p">(</span><span class="n">exports</span><span class="p">,</span> <span class="s2">"__esModule"</span><span class="p">,</span> <span class="p">{</span> <span class="n">value</span><span class="p">:</span> <span class="n">true</span> <span class="p">});</span>
<span class="n">var</span> <span class="n">react_1</span> <span class="o">=</span> <span class="n">__importDefault</span><span class="p">(</span><span class="n">require</span><span class="p">(</span><span class="s2">"react"</span><span class="p">));</span>
</pre></div>

<p><code>__importDefault</code>: If the module is not an <code>es</code> module then what is returned
by require becomes the default. This means that if you use default import on a
<code>commonjs</code> module, the whole module is actually the default.</p>
<p><code>__importStar</code> is best described in this PR:</p>
<blockquote>
<p>TypeScript treats a namespace import (i.e. <code>import * as foo from "foo"</code>) as
equivalent to <code>const foo = require("foo")</code>. Things are simple here, but they
don't work out if the primary object being imported is a primitive or a
value with call/construct signatures. ECMAScript basically says a namespace
record is a plain object.</p>
<p>Babel first requires in the module, and checks for a property named
<code>__esModule</code>. If <code>__esModule</code> is set to <code>true</code>, then the behavior is the
same as that of TypeScript, but otherwise, it synthesizes a namespace record
where:</p>
<ol>
<li>All properties are plucked off of the require'd module and made
available as named imports.</li>
<li>The originally require'd module is made available as a default import.
</li>
</ol>
</blockquote>
<p>So we get this:</p>
<div class="code"><pre class="code literal-block"><span class="o">//</span> <span class="n">ts</span>
<span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">React</span> <span class="kn">from</span> <span class="s1">'react'</span>

<span class="o">//</span> <span class="n">emitted</span> <span class="n">js</span>
<span class="n">var</span> <span class="n">__importStar</span> <span class="o">=</span> <span class="p">(</span><span class="n">this</span> <span class="o">&amp;&amp;</span> <span class="n">this</span><span class="o">.</span><span class="n">__importStar</span><span class="p">)</span> <span class="o">||</span> <span class="n">function</span> <span class="p">(</span><span class="n">mod</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mod</span> <span class="o">&amp;&amp;</span> <span class="n">mod</span><span class="o">.</span><span class="n">__esModule</span><span class="p">)</span> <span class="k">return</span> <span class="n">mod</span><span class="p">;</span>
    <span class="n">var</span> <span class="n">result</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mod</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">var</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">Object</span><span class="o">.</span><span class="n">hasOwnProperty</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">"default"</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">Object</span><span class="o">.</span><span class="n">defineProperty</span><span class="p">(</span><span class="n">exports</span><span class="p">,</span> <span class="s2">"__esModule"</span><span class="p">,</span> <span class="p">{</span> <span class="n">value</span><span class="p">:</span> <span class="n">true</span> <span class="p">});</span>
<span class="n">var</span> <span class="n">React</span> <span class="o">=</span> <span class="n">__importStar</span><span class="p">(</span><span class="n">require</span><span class="p">(</span><span class="s2">"react"</span><span class="p">));</span>
</pre></div>

<p><code>allowSyntheticDefaultImports</code> is the companion to all of this, setting this
to false will not change the emitted helpers (both of them will still look the
same). But it will raise a typescript error if you are using default import
for a commonjs module. So this <code>import React from 'react'</code> will raise the
error <code>Module '".../node_modules/@types/react/index"' has no default export.</code>
if <code>allowSyntheticDefaultImports</code> is <code>false</code>.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-column-type-length-should-i-use-for-storing-a-bcrypt-hashed-password-in-a-database/" class="u-url">What column type/length should I use for storing a Bcrypt hashed password in a Database?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-column-type-length-should-i-use-for-storing-a-bcrypt-hashed-password-in-a-database/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T22:21:07+08:00" itemprop="datePublished" title="2023-03-04 22:21">2023-03-04 22:21</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to store a hashed password (using BCrypt) in a database. What would be
a good type for this, and which would be the correct length? Are passwords
hashed with BCrypt always of same length?</p>
<p><strong>EDIT</strong></p>
<p>Example hash:</p>
<p><code>$2a$10$KssILxWNR6k62B7yiX0GAe2Q7wwHlrzhF3LqtVvpyvHZf0MwvNfVu</code></p>
<p>After hashing some passwords, it seems that BCrypt always generates 60
character hashes.</p>
<p><strong>EDIT 2</strong></p>
<p>Sorry for not mentioning the implementation. I am using jBCrypt.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>The modular crypt format for bcrypt consists of</p>
<ul>
<li>
<code>$2$</code>, <code>$2a$</code> or <code>$2y$</code> identifying the hashing algorithm and format</li>
<li>a two digit value denoting the cost parameter, followed by <code>$</code>
</li>
<li>a 53 characters long base-64-encoded value (they use the alphabet <code>.</code>, <code>/</code>, <code>0</code>–<code>9</code>, <code>A</code>–<code>Z</code>, <code>a</code>–<code>z</code> that is different to the standard Base 64 Encoding alphabet) consisting of: <ul>
<li>22 characters of salt (effectively only 128 bits of the 132 decoded bits)</li>
<li>31 characters of encrypted output (effectively only 184 bits of the 186 decoded bits)</li>
</ul>
</li>
</ul>
<p>Thus the total length is 59 or 60 bytes respectively.</p>
<p>As you use the 2a format, you’ll need 60 bytes. And thus for MySQL I’ll
recommend to use the <code>CHAR(60) BINARY</code>or <code>BINARY(60)</code> (see The __bin_ and
<em>binary</em> Collations for information about the difference).</p>
<p><code>CHAR</code> is not binary safe and equality does not depend solely on the byte
value but on the actual collation; in the worst case <code>A</code> is treated as equal
to <code>a</code>. See The <code>_bin</code> and <code>binary</code> Collations for more information.</p>
<p><br></p>
<h3>Suggest</h3>
<p>A Bcrypt hash can be stored in a <code>BINARY(40)</code> column.</p>
<p><code>BINARY(60)</code>, as the other answers suggest, is the easiest and most natural
choice, but if you want to maximize storage efficiency, you can save 20 bytes
by losslessly deconstructing the hash. I've documented this more thoroughly on
GitHub: https://github.com/ademarre/binary-mcf</p>
<p>Bcrypt hashes follow a structure referred to as modular crypt format (MCF).
<em>Binary</em> MCF (BMCF) decodes these textual hash representations to a more
compact binary structure. In the case of Bcrypt, the resulting binary hash is
40 bytes.</p>
<p>Gumbo did a nice job of explaining the four components of a Bcrypt MCF hash:</p>
<div class="code"><pre class="code literal-block">$&lt;id&gt;$&lt;cost&gt;$&lt;salt&gt;&lt;digest&gt;
</pre></div>

<p>Decoding to BMCF goes like this:</p>
<ol>
<li>
<code>$&lt;id&gt;$</code> can be represented in 3 bits.</li>
<li>
<code>&lt;cost&gt;$</code>, 04-31, can be represented in 5 bits. Put these together for 1 byte.</li>
<li>The 22-character salt is a (non-standard) base-64 representation of 128 bits. Base-64 decoding yields 16 bytes.</li>
<li>The 31-character hash digest can be base-64 decoded to 23 bytes.</li>
<li>Put it all together for 40 bytes: <code>1 + 16 + 23</code>
</li>
</ol>
<p>You can read more at the link above, or examine my PHP implementation, also on
GitHub.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-x-content-type-options-nosniff/" class="u-url">What is "X-Content-Type-Options=nosniff"?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-x-content-type-options-nosniff/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-04T22:18:38+08:00" itemprop="datePublished" title="2023-03-04 22:18">2023-03-04 22:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am doing some penetration testing on my localhost with OWASP ZAP, and it
keeps reporting this message:</p>
<blockquote>
<p>The Anti-MIME-Sniffing header X-Content-Type-Options was not set to
'nosniff'</p>
<p>This check is specific to Internet Explorer 8 and Google Chrome. Ensure each
page sets a Content-Type header and the X-CONTENT-TYPE-OPTIONS if the
Content-Type header is unknown</p>
</blockquote>
<p>I have no idea what this means, and I couldn't find anything online. I have
tried adding:</p>
<div class="code"><pre class="code literal-block">&lt;meta content="text/html; charset=UTF-8; X-Content-Type-Options=nosniff" http-equiv="Content-Type" /&gt;
</pre></div>

<p>but the I still get the alert.</p>
<p>What is the correct way of setting the parameter?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>It prevents the browser from doing MIME-type sniffing. Most browsers are now
respecting this header, including Chrome/Chromium, Edge, IE &gt;= 8.0, Firefox &gt;=
50 and Opera &gt;= 13. See :</p>
<p>https://blogs.msdn.com/b/ie/archive/2008/09/02/ie8-security-part-vi-
beta-2-update.aspx?Redirected=true</p>
<blockquote>
<p>Sending the new X-Content-Type-Options response header with the value
nosniff will prevent Internet Explorer from MIME-sniffing a response away
from the declared content-type.</p>
</blockquote>
<p>EDIT:</p>
<p>Oh and, that's an HTTP header, not a HTML meta tag option.</p>
<p>See also : http://msdn.microsoft.com/en-us/library/ie/gg622941(v=vs.85).aspx</p>
<p><br></p>
<h3>Suggest</h3>
<p><strong>Description</strong></p>
<p>Setting a server's <code>X-Content-Type-Options</code> HTTP response header to <code>nosniff</code>
instructs browsers to disable content or MIME sniffing which is used to
override response <code>Content-Type</code> headers to guess and process the data using
an implicit content type. While this can be convenient in some scenarios, it
can also lead to some attacks listed below. Configuring your server to return
the <code>X-Content-Type-Options</code> HTTP response header set to <code>nosniff</code> will
instruct browsers that support MIME sniffing to use the server-provided
<code>Content-Type</code> and not interpret the content as a different content type.</p>
<p><strong>Browser Support</strong></p>
<p>The <code>X-Content-Type-Options</code> HTTP response header is supported in Chrome,
Firefox and Edge as well as other browsers. The latest browser support is
available on the Mozilla Developer Network (MDN) Browser Compatibility Table
for X-Content-Type-Options:</p>
<p>https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-
Options</p>
<p><strong>Attacks Countered</strong></p>
<ol>
<li>
<strong>MIME Confusion Attack</strong> enables attacks via user generated content sites by allowing users uploading malicious code that is then executed by browsers which will interpret the files using alternate content types, e.g. implicit <code>application/javascript</code> vs. explicit <code>text/plain</code>. This can result in a "drive-by download" attack which is a common attack vector for phishing. Sites that host user generated content should use this header to protect their users. This is mentioned by VeraCode and OWASP which says the following:</li>
</ol>
<blockquote>
<p>This reduces exposure to drive-by download attacks and sites serving user
uploaded content that, by clever naming, could be treated by MSIE as
executable or dynamic HTML files.</p>
</blockquote>
<ol>
<li>
<strong>Unauthorized Hotlinking</strong> can also be enabled by <code>Content-Type</code> sniffing. By hotlinking to sites with resources for one purpose, e.g. viewing, apps can rely on content-type sniffing and generate a lot of traffic on sites for another purpose where it may be against their terms of service, e.g. GitHub displays JavaScript code for viewing, but not for execution:</li>
</ol>
<blockquote>
<p>Some pesky non-human users (namely computers) have taken to "hotlinking"
assets via the raw view feature -- using the raw URL as the <code>src</code> for a
<code>&lt;script&gt;</code> or <code>&lt;img&gt;</code> tag. The problem is that these are not static assets.
The raw file view, like any other view in a Rails app, must be rendered
before being returned to the user. This quickly adds up to a big toll on
performance. In the past we've been forced to block popular content served
this way because it put excessive strain on our servers.</p>
</blockquote>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2523.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2521.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
