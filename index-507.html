<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 507) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-507.html">
<link rel="prev" href="index-508.html" type="text/html">
<link rel="next" href="index-506.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/simplest-code-for-array-intersection-in-javascript/" class="u-url">Simplest code for array intersection in javascript</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/simplest-code-for-array-intersection-in-javascript/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T08:37:04+08:00" itemprop="datePublished" title="2023-02-17 08:37">2023-02-17 08:37</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What's the simplest, library-free code for implementing array intersections in
javascript? I want to write</p>
<div class="code"><pre class="code literal-block">intersection([1,2,3], [2,3,4,5])
</pre></div>

<p>and get</p>
<div class="code"><pre class="code literal-block">[2, 3]
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p>Use a combination of <code>Array.prototype.filter</code> and <code>Array.prototype.includes</code>:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="n">filteredArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array1</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">array2</span><span class="o">.</span><span class="n">includes</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
</pre></div>

<p>For older browsers, with <code>Array.prototype.indexOf</code> and without an arrow
function:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">filteredArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array1</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">array2</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>

<p>NB! Both <code>.includes</code> and <code>.indexOf</code> internally compares elements in the array
by using <code>===</code>, so if the array contains objects it will only compare object
references (not their content). If you want to specify your own comparison
logic, use <code>Array.prototype.some</code> instead.</p>
<p><br></p>
<h3>Suggest</h3>
<p>Destructive seems simplest, especially if we can assume the input is sorted:</p>
<div class="code"><pre class="code literal-block"><span class="o">/*</span><span class="w"> </span><span class="n">destructively</span><span class="w"> </span><span class="n">finds</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">intersection</span><span class="w"> </span><span class="n">of</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">arrays</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">simple</span><span class="w"> </span><span class="n">fashion</span><span class="o">.</span><span class="w">  </span>
<span class="w"> </span><span class="o">*</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">PARAMS</span>
<span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">sorted</span>
<span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">second</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">sorted</span>
<span class="w"> </span><span class="o">*</span>
<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NOTES</span>
<span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">State</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">arrays</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">undefined</span><span class="w"> </span><span class="n">when</span>
<span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">the</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">returns</span><span class="o">.</span><span class="w">  </span><span class="n">They</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="p">(</span><span class="n">prolly</span><span class="p">)</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">dumped</span><span class="o">.</span>
<span class="w"> </span><span class="o">*</span>
<span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="n">Should</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">O</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="n">operations</span><span class="p">,</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">is</span><span class="w"> </span>
<span class="w"> </span><span class="o">*</span><span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MIN</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
<span class="w"> </span><span class="o">*/</span>
<span class="n">function</span><span class="w"> </span><span class="n">intersection_destructive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
<span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="n">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span><span class="w">  </span>
<span class="w">     </span><span class="k">if</span><span class="w">      </span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">){</span><span class="w"> </span><span class="n">a</span><span class="o">.</span><span class="n">shift</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="p">){</span><span class="w"> </span><span class="n">b</span><span class="o">.</span><span class="n">shift</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="o">/*</span><span class="w"> </span><span class="n">they</span><span class="s1">'re equal */</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">       </span><span class="n">result</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shift</span><span class="p">());</span>
<span class="w">       </span><span class="n">b</span><span class="o">.</span><span class="n">shift</span><span class="p">();</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>Non-destructive has to be a hair more complicated, since we’ve got to track
indices:</p>
<div class="code"><pre class="code literal-block"><span class="cm">/* finds the intersection of </span>
<span class="cm"> * two arrays in a simple fashion.  </span>
<span class="cm"> *</span>
<span class="cm"> * PARAMS</span>
<span class="cm"> *  a - first array, must already be sorted</span>
<span class="cm"> *  b - second array, must already be sorted</span>
<span class="cm"> *</span>
<span class="cm"> * NOTES</span>
<span class="cm"> *</span>
<span class="cm"> *  Should have O(n) operations, where n is </span>
<span class="cm"> *    n = MIN(a.length(), b.length())</span>
<span class="cm"> */</span>
<span class="k">function</span><span class="w"> </span><span class="n">intersect_safe</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
<span class="err">{</span>
<span class="w">  </span><span class="nf">var</span><span class="w"> </span><span class="n">ai</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">bi</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="nf">var</span><span class="w"> </span><span class="k">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span><span class="p">;</span>

<span class="w">  </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">ai</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">bi</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="p">)</span>
<span class="w">  </span><span class="err">{</span>
<span class="w">     </span><span class="k">if</span><span class="w">      </span><span class="p">(</span><span class="n">a</span><span class="o">[</span><span class="n">ai</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="o">[</span><span class="n">bi</span><span class="o">]</span><span class="w"> </span><span class="p">)</span><span class="err">{</span><span class="w"> </span><span class="n">ai</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="err">}</span>
<span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="o">[</span><span class="n">ai</span><span class="o">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="o">[</span><span class="n">bi</span><span class="o">]</span><span class="w"> </span><span class="p">)</span><span class="err">{</span><span class="w"> </span><span class="n">bi</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="err">}</span>
<span class="w">     </span><span class="k">else</span><span class="w"> </span><span class="cm">/* they're equal */</span>
<span class="w">     </span><span class="err">{</span>
<span class="w">       </span><span class="k">result</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">a</span><span class="o">[</span><span class="n">ai</span><span class="o">]</span><span class="p">);</span>
<span class="w">       </span><span class="n">ai</span><span class="o">++</span><span class="p">;</span>
<span class="w">       </span><span class="n">bi</span><span class="o">++</span><span class="p">;</span>
<span class="w">     </span><span class="err">}</span>
<span class="w">  </span><span class="err">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">result</span><span class="p">;</span>
<span class="err">}</span>
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/posting-a-file-and-associated-data-to-a-restful-webservice-preferably-as-json/" class="u-url">Posting a File and Associated Data to a RESTful WebService preferably as JSON</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/posting-a-file-and-associated-data-to-a-restful-webservice-preferably-as-json/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T08:36:36+08:00" itemprop="datePublished" title="2023-02-17 08:36">2023-02-17 08:36</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>In an application I am developing RESTful API and we want the client to send
data as JSON. Part of this application requires the client to upload a file
(usually an image) as well as information about the image.</p>
<p>I'm having a hard time tracking down how this happens in a single request. Is
it possible to Base64 the file data into a JSON string? Am I going to need to
perform 2 posts to the server? Should I not be using JSON for this?</p>
<p>As a side note, we're using Grails on the backend and these services are
accessed by native mobile clients (iPhone, Android, etc), if any of that makes
a difference.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I asked a similar question here:</p>
<p>How do I upload a file with metadata using a REST web service?</p>
<p>You basically have three choices:</p>
<ol>
<li>Base64 encode the file, at the expense of increasing the data size by around 33%, and add processing overhead in both the server and the client for encoding/decoding.</li>
<li>Send the file first in a <code>multipart/form-data</code> POST, and return an ID to the client. The client then sends the metadata with the ID, and the server re-associates the file and the metadata.</li>
<li>Send the metadata first, and return an ID to the client. The client then sends the file with the ID, and the server re-associates the file and the metadata.</li>
</ol>
<p><br></p>
<h3>Suggest</h3>
<p>You can send the file and data over in one request using the multipart/form-
data content type:</p>
<blockquote>
<p>In many applications, it is possible for a user to be presented with a form.
The user will fill out the form, including information that is typed,
generated by user input, or included from files that the user has selected.
When the form is filled out, the data from the form is sent from the user to
the receiving application.</p>
<p>The definition of MultiPart/Form-Data is derived from one of those
applications...</p>
</blockquote>
<p>From http://www.faqs.org/rfcs/rfc2388.html:</p>
<blockquote>
<p>"multipart/form-data" contains a series of parts. Each part is expected to
contain a content-disposition header [RFC 2183] where the disposition type
is "form-data", and where the disposition contains an (additional) parameter
of "name", where the value of that parameter is the original field name in
the form. For example, a part might contain a header:</p>
<p>Content-Disposition: form-data; name="user"</p>
<p>with the value corresponding to the entry of the "user" field.</p>
</blockquote>
<p>You can include file information or field information within each section
between boundaries. I've successfully implemented a RESTful service that
required the user to submit both data and a form, and multipart/form-data
worked perfectly. The service was built using Java/Spring, and the client was
using C#, so unfortunately I don't have any Grails examples to give you
concerning how to set up the service. You don't need to use JSON in this case
since each "form-data" section provides you a place to specify the name of the
parameter and its value.</p>
<p>The good thing about using multipart/form-data is that you're using HTTP-
defined headers, so you're sticking with the REST philosophy of using existing
HTTP tools to create your service.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-does-trello-access-the-user-s-clipboard/" class="u-url">How does Trello access the user's clipboard?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-does-trello-access-the-user-s-clipboard/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T08:36:10+08:00" itemprop="datePublished" title="2023-02-17 08:36">2023-02-17 08:36</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>When you hover over a card in Trello and press <code>Ctrl</code>+<code>C</code>, the URL of this
card is copied to the clipboard. How do they do this?</p>
<p>As far as I can tell, there is no Flash movie involved. I've got Flashblock
installed, and the Firefox network tab shows no Flash movie loaded. (That's
the usual method, for example, by ZeroClipboard.)</p>
<p>How do they achieve this magic?</p>
<p>(Right at this moment I think I had an epiphany: You cannot select text on the
page, so I assume they have an invisible element, where they create a text
selection via JavaScript code, and <code>Ctrl</code>+<code>C</code> triggers the browser's default
behaviour, copying that invisible node's text value.)</p>
<p><br><br></p>
<h2>Answer</h2>
<p><strong>Disclosure:</strong> I wrote the code that Trello uses; the code below is the
actual source code Trello uses to accomplish the clipboard trick.</p>
<hr>
<p>We don't actually "access the user's clipboard", instead we help the user out
a bit by selecting something useful when they press <code>Ctrl</code>+<code>C</code>.</p>
<p>Sounds like you've figured it out; we take advantage of the fact that when you
want to hit <code>Ctrl</code>+<code>C</code>, you have to hit the <code>Ctrl</code> key first. When the <code>Ctrl</code>
key is pressed, we pop in a textarea that contains the text we want to end up
on the clipboard, and select all the text in it, so the selection is all set
when the <code>C</code> key is hit. (Then we hide the textarea when the <code>Ctrl</code> key comes
up.)</p>
<p>Specifically, Trello does this:</p>
<div class="code"><pre class="code literal-block">TrelloClipboard<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>class
<span class="w">  </span>constructor:<span class="w"> </span>-&gt;
<span class="w">    </span>@value<span class="w"> </span>=<span class="w"> </span>""

<span class="w">    </span>$(document).keydown<span class="w"> </span>(e)<span class="w"> </span>=&gt;
<span class="w">      </span>#<span class="w"> </span>Only<span class="w"> </span>do<span class="w"> </span>this<span class="w"> </span>if<span class="w"> </span>there's<span class="w"> </span>something<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>put<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>clipboard,<span class="w"> </span>and<span class="w"> </span>it
<span class="w">      </span>#<span class="w"> </span>looks<span class="w"> </span>like<span class="w"> </span>they're<span class="w"> </span>starting<span class="w"> </span>a<span class="w"> </span>copy<span class="w"> </span>shortcut
<span class="w">      </span>if<span class="w"> </span>!@value<span class="w"> </span>||<span class="w"> </span>!(e.ctrlKey<span class="w"> </span>||<span class="w"> </span>e.metaKey)
<span class="w">        </span>return

<span class="w">      </span>if<span class="w"> </span>$(e.target).is("input:visible,textarea:visible")
<span class="w">        </span>return

<span class="w">      </span>#<span class="w"> </span>Abort<span class="w"> </span>if<span class="w"> </span>it<span class="w"> </span>looks<span class="w"> </span>like<span class="w"> </span>they've<span class="w"> </span>selected<span class="w"> </span>some<span class="w"> </span>text<span class="w"> </span>(maybe<span class="w"> </span>they're<span class="w"> </span>trying
<span class="w">      </span>#<span class="w"> </span>to<span class="w"> </span>copy<span class="w"> </span>out<span class="w"> </span>a<span class="w"> </span>bit<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>description<span class="w"> </span>or<span class="w"> </span>something)
<span class="w">      </span>if<span class="w"> </span>window.getSelection?()?.toString()
<span class="w">        </span>return

<span class="w">      </span>if<span class="w"> </span>document.selection?.createRange().text
<span class="w">        </span>return

<span class="w">      </span>_.defer<span class="w"> </span>=&gt;
<span class="w">        </span>$clipboardContainer<span class="w"> </span>=<span class="w"> </span>$("#clipboard-container")
<span class="w">        </span>$clipboardContainer.empty().show()
<span class="w">        </span>$("<span class="nt">&lt;textarea</span><span class="w"> </span><span class="na">id=</span><span class="s">'clipboard'</span><span class="nt">&gt;&lt;/textarea&gt;</span>")
<span class="w">        </span>.val(@value)
<span class="w">        </span>.appendTo($clipboardContainer)
<span class="w">        </span>.focus()
<span class="w">        </span>.select()

<span class="w">    </span>$(document).keyup<span class="w"> </span>(e)<span class="w"> </span>-&gt;
<span class="w">      </span>if<span class="w"> </span>$(e.target).is("#clipboard")
<span class="w">        </span>$("#clipboard-container").empty().hide()

<span class="w">  </span>set:<span class="w"> </span>(@value)<span class="w"> </span>-&gt;
</pre></div>

<p>In the DOM we've got:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">"clipboard-container"</span><span class="nt">&gt;&lt;textarea</span><span class="w"> </span><span class="na">id=</span><span class="s">"clipboard"</span><span class="nt">&gt;&lt;/textarea&gt;&lt;/div&gt;</span>
</pre></div>

<p>CSS for the clipboard stuff:</p>
<div class="code"><pre class="code literal-block"><span class="p">#</span><span class="nn">clipboard-container</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">fixed</span><span class="p">;</span>
<span class="w">  </span><span class="k">left</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">top</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">z-index</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">  </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">none</span><span class="p">;</span>
<span class="w">  </span><span class="k">opacity</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">#</span><span class="nn">clipboard</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="p">;</span>
<span class="w">  </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>... and the CSS makes it so you can't actually see the textarea when it pops
in ... but it's "visible" enough to copy from.</p>
<p>When you hover over a card, it calls</p>
<div class="code"><pre class="code literal-block">TrelloClipboard.set(cardUrl)
</pre></div>

<p>... so then the clipboard helper knows what to select when the <code>Ctrl</code> key is
pressed.</p>
<p><br></p>
<h3>Suggest</h3>
<p>I actually built a Chrome extension that does exactly this, and for all web
pages. The source code is on GitHub.</p>
<p>I find three bugs with Trello's approach, which I know because I've faced them
myself :)</p>
<p>The copy doesn't work in these scenarios:</p>
<ol>
<li>If you already have <code>Ctrl</code> pressed and then hover a link and hit <code>C</code>, the copy doesn't work.</li>
<li>If your cursor is in some other text field in the page, the copy doesn't work. </li>
<li>If your cursor is in the address bar, the copy doesn't work.</li>
</ol>
<p>I solved #1 by always having a hidden span, rather than creating one when user
hits <code>Ctrl</code>/<code>Cmd</code>.</p>
<p>I solved #2 by temporarily clearing the zero-length selection, saving the
caret position, doing the copy and restoring the caret position.</p>
<p>I haven't found a fix for #3 yet :) (For information, check the open issue in
my GitHub project).</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-508.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-506.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
