<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1076) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1076.html">
<link rel="prev" href="index-1077.html" type="text/html">
<link rel="next" href="index-1075.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/directory-tree-listing-in-python/" class="u-url">Directory-tree listing in Python</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/directory-tree-listing-in-python/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T00:36:46+08:00" itemprop="datePublished" title="2023-02-18 00:36">2023-02-18 00:36</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>How do I get a list of all files (and directories) in a given directory in
Python?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>This is a way to traverse every file and directory in a directory tree:</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span> <span class="nn">os</span>

<span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s1">'.'</span><span class="p">):</span>
    <span class="c1"># print path to all subdirectories first.</span>
    <span class="k">for</span> <span class="n">subdirname</span> <span class="ow">in</span> <span class="n">dirnames</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">subdirname</span><span class="p">))</span>

    <span class="c1"># print path to all filenames.</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>

    <span class="c1"># Advanced usage:</span>
    <span class="c1"># editing the 'dirnames' list will stop os.walk() from recursing into there.</span>
    <span class="k">if</span> <span class="s1">'.git'</span> <span class="ow">in</span> <span class="n">dirnames</span><span class="p">:</span>
        <span class="c1"># don't go into any .git directories.</span>
        <span class="n">dirnames</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">'.git'</span><span class="p">)</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>You can use</p>
<div class="code"><pre class="code literal-block">os.listdir(path)
</pre></div>

<p>For reference and more os functions look here:</p>
<ul>
<li>Python 2 docs: https://docs.python.org/2/library/os.html#os.listdir</li>
<li>Python 3 docs: https://docs.python.org/3/library/os.html#os.listdir</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/make-first-letter-of-a-string-upper-case-with-maximum-performance/" class="u-url">Make first letter of a string upper case (with maximum performance)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/make-first-letter-of-a-string-upper-case-with-maximum-performance/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T00:36:07+08:00" itemprop="datePublished" title="2023-02-18 00:36">2023-02-18 00:36</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a <code>DetailsView</code> with a <code>TextBox</code> and I want the <em>input data</em> be <em>saved
always</em> with the <em><strong>first letter in capital</strong></em>.</p>
<p><strong>Example:</strong></p>
<div class="code"><pre class="code literal-block"><span class="s">"red"</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="s">"Red"</span>
<span class="s">"red house"</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="s">" Red house"</span>
</pre></div>

<p>How can I achieve this <strong>maximizing performance</strong>?</p>
<hr>
<p><strong>Note</strong> :</p>
<p>Based on the answers and the comments under the answers, many people think
this is asking about capitalizing <em>all</em> words in the string. E.g. <code>=&gt; Red
House</code> <strong>It isn't, but if that is what you seek</strong> , look for one of the
answers that uses <code>TextInfo</code>'s <code>ToTitleCase</code> method. (Note: Those answers are
<em>incorrect</em> for the question actually asked.) See TextInfo.ToTitleCase
documentation for caveats (doesn't touch all-caps words - they are considered
acronyms; may lowercase letters in middle of words that "shouldn't" be
lowered, e.g., "McDonald" → "Mcdonald"; not guaranteed to handle all culture-
specific subtleties re capitalization rules.)</p>
<hr>
<p><strong>Note</strong> :</p>
<p>The question is <em>ambiguous</em> as to whether letters after the first should be
<strong>forced</strong> to <em>lower case</em>. The accepted answer assumes that <em>only the first
letter should be altered</em>. If you want to force <em>all letters in the string
except the first</em> to be lower case, look for an answer containing <code>ToLower</code>,
and <em>not containing ToTitleCase</em>.</p>
<p><br><br></p>
<h2>Answer</h2>
<h2>Solution in different C# versions</h2>
<h3>C# 8 with at least .NET Core 3.0 or .NET Standard 2.1</h3>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">StringExtensions</span>
{
<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="nv">FirstCharToUpper</span><span class="ss">(</span><span class="nv">this</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="nv">input</span><span class="ss">)</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">        </span><span class="nv">input</span><span class="w"> </span><span class="nv">switch</span>
<span class="w">        </span>{
<span class="w">            </span><span class="nv">null</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">throw</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ArgumentNullException</span><span class="ss">(</span><span class="nv">nameof</span><span class="ss">(</span><span class="nv">input</span><span class="ss">))</span>,
<span class="w">            </span><span class="s2">""</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">throw</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ArgumentException</span><span class="ss">(</span>$<span class="s2">"{nameof(input)} cannot be empty"</span>,<span class="w"> </span><span class="nv">nameof</span><span class="ss">(</span><span class="nv">input</span><span class="ss">))</span>,
<span class="w">            </span><span class="nv">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">string</span>.<span class="nv">Concat</span><span class="ss">(</span><span class="nv">input</span>[<span class="mi">0</span>].<span class="nv">ToString</span><span class="ss">()</span>.<span class="k">ToUpper</span><span class="ss">()</span>,<span class="w"> </span><span class="nv">input</span>.<span class="nv">AsSpan</span><span class="ss">(</span><span class="mi">1</span><span class="ss">))</span>
<span class="w">        </span>}<span class="c1">;</span>
}
</pre></div>

<p>Since .NET Core 3.0 / .NET Standard 2.1 <code>String.Concat()</code> supports
<code>ReadonlySpan&lt;char&gt;</code> which saves one allocation if we use <code>.AsSpan(1)</code> instead
of <code>.Substring(1)</code>.</p>
<h3>C# 8</h3>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">StringExtensions</span>
{
<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="nv">FirstCharToUpper</span><span class="ss">(</span><span class="nv">this</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="nv">input</span><span class="ss">)</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">        </span><span class="nv">input</span><span class="w"> </span><span class="nv">switch</span>
<span class="w">        </span>{
<span class="w">            </span><span class="nv">null</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">throw</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ArgumentNullException</span><span class="ss">(</span><span class="nv">nameof</span><span class="ss">(</span><span class="nv">input</span><span class="ss">))</span>,
<span class="w">            </span><span class="s2">""</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">throw</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ArgumentException</span><span class="ss">(</span>$<span class="s2">"{nameof(input)} cannot be empty"</span>,<span class="w"> </span><span class="nv">nameof</span><span class="ss">(</span><span class="nv">input</span><span class="ss">))</span>,
<span class="w">            </span><span class="nv">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nv">input</span>[<span class="mi">0</span>].<span class="nv">ToString</span><span class="ss">()</span>.<span class="k">ToUpper</span><span class="ss">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">input</span>.<span class="nv">Substring</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span>
<span class="w">        </span>}<span class="c1">;</span>
}
</pre></div>

<h3>C# 7</h3>
<div class="code"><pre class="code literal-block"><span class="nt">public</span><span class="w"> </span><span class="nt">static</span><span class="w"> </span><span class="nt">class</span><span class="w"> </span><span class="nt">StringExtensions</span>
<span class="p">{</span>
<span class="w">    </span><span class="err">public</span><span class="w"> </span><span class="err">static</span><span class="w"> </span><span class="err">string</span><span class="w"> </span><span class="err">FirstCharToUpper(this</span><span class="w"> </span><span class="err">string</span><span class="w"> </span><span class="err">input)</span>
<span class="w">    </span><span class="err">{</span>
<span class="w">        </span><span class="err">switch</span><span class="w"> </span><span class="err">(input)</span>
<span class="w">        </span><span class="err">{</span>
<span class="w">            </span><span class="err">case</span><span class="w"> </span><span class="n">null</span><span class="p">:</span><span class="w"> </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nf">ArgumentNullException</span><span class="p">(</span><span class="nf">nameof</span><span class="p">(</span><span class="n">input</span><span class="p">));</span>
<span class="w">            </span><span class="err">case</span><span class="w"> </span><span class="err">"":</span><span class="w"> </span><span class="err">throw</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">ArgumentException($"{nameof(input)</span><span class="p">}</span><span class="w"> </span><span class="nt">cannot</span><span class="w"> </span><span class="nt">be</span><span class="w"> </span><span class="nt">empty</span><span class="err">"</span><span class="o">,</span><span class="w"> </span><span class="nt">nameof</span><span class="o">(</span><span class="nt">input</span><span class="o">));</span>
<span class="w">            </span><span class="nt">default</span><span class="o">:</span><span class="w"> </span><span class="nt">return</span><span class="w"> </span><span class="nt">input</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="p">.</span><span class="nc">ToString</span><span class="o">()</span><span class="p">.</span><span class="nc">ToUpper</span><span class="o">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nt">input</span><span class="p">.</span><span class="nc">Substring</span><span class="o">(</span><span class="nt">1</span><span class="o">);</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</pre></div>

<h3>Really old answers</h3>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="nv">FirstCharToUpper</span><span class="ss">(</span><span class="nv">string</span><span class="w"> </span><span class="nv">input</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">String</span>.<span class="nv">IsNullOrEmpty</span><span class="ss">(</span><span class="nv">input</span><span class="ss">))</span>
<span class="w">        </span><span class="nv">throw</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ArgumentException</span><span class="ss">(</span><span class="s2">"ARGH!"</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">input</span>.<span class="nv">First</span><span class="ss">()</span>.<span class="nv">ToString</span><span class="ss">()</span>.<span class="k">ToUpper</span><span class="ss">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">String</span>.<span class="nv">Join</span><span class="ss">(</span><span class="s2">""</span>,<span class="w"> </span><span class="nv">input</span>.<span class="nv">Skip</span><span class="ss">(</span><span class="mi">1</span><span class="ss">))</span><span class="c1">;</span>
}
</pre></div>

<p>This version is shorter. For a faster solution, take a look at Diego's answer.</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="nv">FirstCharToUpper</span><span class="ss">(</span><span class="nv">string</span><span class="w"> </span><span class="nv">input</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">String</span>.<span class="nv">IsNullOrEmpty</span><span class="ss">(</span><span class="nv">input</span><span class="ss">))</span>
<span class="w">        </span><span class="nv">throw</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ArgumentException</span><span class="ss">(</span><span class="s2">"ARGH!"</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">input</span>.<span class="nv">First</span><span class="ss">()</span>.<span class="nv">ToString</span><span class="ss">()</span>.<span class="k">ToUpper</span><span class="ss">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">input</span>.<span class="nv">Substring</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span><span class="c1">;</span>
}
</pre></div>

<p>Probably the fastest solution is Darren's (There's even a benchmark) although
I would change it's <code>string.IsNullOrEmpty(s)</code> validation to throw an exception
since the original requirement expects for a first letter to exist so it can
be uppercased. Note that this code works for a generic string and not
particularly on valid values from the <code>Textbox</code>.</p>
<p><br></p>
<h3>Suggest</h3>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="nv">FirstLetterToUpper</span><span class="ss">(</span><span class="nv">string</span><span class="w"> </span><span class="nv">str</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">str</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">null</span><span class="ss">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">null</span><span class="c1">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">str</span>.<span class="nv">Length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="ss">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">char</span>.<span class="k">ToUpper</span><span class="ss">(</span><span class="nv">str</span>[<span class="mi">0</span>]<span class="ss">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">str</span>.<span class="nv">Substring</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span><span class="c1">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">str</span>.<span class="k">ToUpper</span><span class="ss">()</span><span class="c1">;</span>
}
</pre></div>

<p>Old answer: This makes every first letter to upper case</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="nv">ToTitleCase</span><span class="ss">(</span><span class="nv">string</span><span class="w"> </span><span class="nv">str</span><span class="ss">)</span>
{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">CultureInfo</span>.<span class="nv">CurrentCulture</span>.<span class="nv">TextInfo</span>.<span class="nv">ToTitleCase</span><span class="ss">(</span><span class="nv">str</span>.<span class="k">ToLower</span><span class="ss">())</span><span class="c1">;</span>
}
</pre></div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-can-i-fix-the-git-error-object-file-is-empty/" class="u-url">How can I fix the Git error "object file ... is empty"?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-can-i-fix-the-git-error-object-file-is-empty/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-18T00:35:33+08:00" itemprop="datePublished" title="2023-02-18 00:35">2023-02-18 00:35</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>When I try to commit changes, I get this error:</p>
<div class="code"><pre class="code literal-block"><span class="n">error</span><span class="o">:</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">.</span><span class="na">git</span><span class="sr">/objects/31/</span><span class="mi">65329</span><span class="n">bb680e30595f242b7c4d8406ca63eeab0</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">empty</span>
<span class="n">fatal</span><span class="o">:</span><span class="w"> </span><span class="n">loose</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="mi">3165329</span><span class="n">bb680e30595f242b7c4d8406ca63eeab0</span><span class="w"> </span><span class="o">(</span><span class="n">stored</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">.</span><span class="na">git</span><span class="sr">/objects/31/</span><span class="mi">65329</span><span class="n">bb680e30595f242b7c4d8406ca63eeab0</span><span class="o">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">corrupt</span>
</pre></div>

<p>I tried <code>git fsck</code> I've got:</p>
<div class="code"><pre class="code literal-block"><span class="n">error</span><span class="o">:</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">.</span><span class="na">git</span><span class="sr">/objects/03/</span><span class="n">dfd60a4809a3ba7023cbf098eb322d08630b71</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">empty</span>
<span class="n">fatal</span><span class="o">:</span><span class="w"> </span><span class="n">loose</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="mi">03</span><span class="n">dfd60a4809a3ba7023cbf098eb322d08630b71</span><span class="w"> </span><span class="o">(</span><span class="n">stored</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">.</span><span class="na">git</span><span class="sr">/objects/03/</span><span class="n">dfd60a4809a3ba7023cbf098eb322d08630b71</span><span class="o">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">corrupt</span>
</pre></div>

<p>How can I solve this error?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>I had a similar problem. My laptop ran out of battery during a Git operation.
Boo.</p>
<p>I didn't have any backups. (N.B. Ubuntu One is not a backup solution for Git;
it will helpfully overwrite your sane repository with your corrupted one.)</p>
<p>To the Git wizards, if this was a bad way to fix it, please leave a comment.
It did, however, work for me... at least temporarily.</p>
<p>Step 1: Make a backup of folder <em>.git</em> (in fact I do this in between every
step that changes something, but with a new copy-to name, e.g., <em>.git-old-1</em> ,
<em>.git-old-2</em> , etc.):</p>
<div class="code"><pre class="code literal-block">cd ~/workspace/mcmc-chapter
cp -a .git .git-old
</pre></div>

<p>Step 2: Run <code>git fsck --full</code></p>
<div class="code"><pre class="code literal-block">git fsck --full

error: object file .git/objects/8b/61d0135d3195966b443f6c73fb68466264c68e is empty
fatal: loose object 8b61d0135d3195966b443f6c73fb68466264c68e (stored in .git/objects/8b/61d0135d3195966b443f6c73fb68466264c68e) is corrupt
</pre></div>

<p>Step 3: Remove the empty file. I figured what the heck; it's blank anyway.</p>
<div class="code"><pre class="code literal-block"><span class="n">rm</span><span class="w"> </span><span class="p">.</span><span class="n">git</span><span class="o">/</span><span class="n">objects</span><span class="o">/</span><span class="mh">8</span><span class="n">b</span><span class="o">/</span><span class="mh">61</span><span class="n">d0135d3195966b443f6c73fb68466264c68e</span>

<span class="nl">rm:</span><span class="w"> </span><span class="n">remove</span><span class="w"> </span><span class="n">write</span><span class="o">-</span><span class="n">protected</span><span class="w"> </span><span class="n">regular</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="err">`</span><span class="p">.</span><span class="n">git</span><span class="o">/</span><span class="n">objects</span><span class="o">/</span><span class="mh">8</span><span class="n">b</span><span class="o">/</span><span class="mh">61</span><span class="n">d0135d3195966b443f6c73fb68466264c68e</span><span class="p">'</span><span class="o">?</span><span class="w"> </span><span class="n">y</span>
</pre></div>

<p>Step 3: Run <code>git fsck</code> again. Continue deleting the empty files. You can also
<code>cd</code> into the <code>.git</code> directory and run <code>find . -type f -empty -delete -print</code>
to remove all empty files. Eventually Git started telling me it was actually
doing something with the object directories:</p>
<div class="code"><pre class="code literal-block">git fsck --full

Checking object directories: 100% (256/256), done.
error: object file .git/objects/e0/cbccee33aea970f4887194047141f79a363636 is empty
fatal: loose object e0cbccee33aea970f4887194047141f79a363636 (stored in .git/objects/e0/cbccee33aea970f4887194047141f79a363636) is corrupt
</pre></div>

<p>Step 4: After deleting all of the empty files, I eventually came to <code>git fsck</code>
actually running:</p>
<div class="code"><pre class="code literal-block">git fsck --full

Checking object directories: 100% (256/256), done.
error: HEAD: invalid sha1 pointer af9fc0c5939eee40f6be2ed66381d74ec2be895f
error: refs/heads/master does not point to a valid object!
error: refs/heads/master.u1conflict does not point to a valid object!
error: 0e31469d372551bb2f51a186fa32795e39f94d5c: invalid sha1 pointer in cache-tree
dangling blob 03511c9868b5dbac4ef1343956776ac508c7c2a2
missing blob 8b61d0135d3195966b443f6c73fb68466264c68e
missing blob e89896b1282fbae6cf046bf21b62dd275aaa32f4
dangling blob dd09f7f1f033632b7ef90876d6802f5b5fede79a
missing blob caab8e3d18f2b8c8947f79af7885cdeeeae192fd
missing blob e4cf65ddf80338d50ecd4abcf1caf1de3127c229
</pre></div>

<p>Step 5: Try <code>git reflog</code>. Fail because my HEAD is broken.</p>
<div class="code"><pre class="code literal-block">git reflog

fatal: bad object HEAD
</pre></div>

<p>Step 6: Google. Find this. Manually get the last two lines of the reflog:</p>
<div class="code"><pre class="code literal-block"><span class="n">tail</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="n">git</span><span class="o">/</span><span class="n">logs</span><span class="o">/</span><span class="n">refs</span><span class="o">/</span><span class="n">heads</span><span class="o">/</span><span class="n">master</span>

<span class="n">f2d4c4868ec7719317a8fce9dc18c4f2e00ede04</span><span class="w"> </span><span class="mi">9</span><span class="n">f0abf890b113a287e10d56b66dbab66adc1662d</span><span class="w"> </span><span class="n">Nathan</span><span class="w"> </span><span class="n">VanHoudnos</span><span class="w"> </span><span class="o">&lt;</span><span class="n">nathanvan</span><span class="nv">@gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1347306977</span><span class="w"> </span><span class="o">-</span><span class="mi">0400</span><span class="w">    </span><span class="k">commit</span><span class="err">:</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="w"> </span><span class="mi">24</span><span class="p">,</span><span class="w"> </span><span class="n">including</span><span class="w"> </span><span class="n">correcting</span><span class="w"> </span><span class="n">spelling</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">name</span>
<span class="mi">9</span><span class="n">f0abf890b113a287e10d56b66dbab66adc1662d</span><span class="w"> </span><span class="n">af9fc0c5939eee40f6be2ed66381d74ec2be895f</span><span class="w"> </span><span class="n">Nathan</span><span class="w"> </span><span class="n">VanHoudnos</span><span class="w"> </span><span class="o">&lt;</span><span class="n">nathanvan</span><span class="nv">@gmail</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1347358589</span><span class="w"> </span><span class="o">-</span><span class="mi">0400</span><span class="w">    </span><span class="k">commit</span><span class="err">:</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="mi">28</span>
</pre></div>

<p>Step 7: Note that from Step 6 we learned that the HEAD is currently pointing
to the very last commit. So let's try to just look at the parent commit:</p>
<div class="code"><pre class="code literal-block"><span class="n">git</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="mi">9</span><span class="n">f0abf890b113a287e10d56b66dbab66adc1662d</span>

<span class="k">commit</span><span class="w"> </span><span class="mi">9</span><span class="n">f0abf890b113a287e10d56b66dbab66adc1662d</span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Nathan</span><span class="w"> </span><span class="n">VanHoudnos</span><span class="w"> </span><span class="o">&lt;</span><span class="n">nathanvan</span><span class="nv">@XXXXXX</span><span class="o">&gt;</span>
<span class="nc">Date</span><span class="err">:</span><span class="w">   </span><span class="n">Mon</span><span class="w"> </span><span class="n">Sep</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">15</span><span class="err">:</span><span class="mi">56</span><span class="err">:</span><span class="mi">17</span><span class="w"> </span><span class="mi">2012</span><span class="w"> </span><span class="o">-</span><span class="mi">0400</span>

<span class="w">    </span><span class="n">up</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="w"> </span><span class="mi">24</span><span class="p">,</span><span class="w"> </span><span class="n">including</span><span class="w"> </span><span class="n">correcting</span><span class="w"> </span><span class="n">spelling</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">name</span>

<span class="n">diff</span><span class="w"> </span><span class="o">--</span><span class="n">git</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">tex</span><span class="o">/</span><span class="n">MCMC</span><span class="o">-</span><span class="ow">in</span><span class="o">-</span><span class="n">IRT</span><span class="p">.</span><span class="n">tex</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">tex</span><span class="o">/</span><span class="n">MCMC</span><span class="o">-</span><span class="ow">in</span><span class="o">-</span><span class="n">IRT</span><span class="p">.</span><span class="n">tex</span>
<span class="k">index</span><span class="w"> </span><span class="mf">86e67</span><span class="n">a1</span><span class="p">..</span><span class="n">b860686</span><span class="w"> </span><span class="mi">100644</span>
<span class="o">---</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">tex</span><span class="o">/</span><span class="n">MCMC</span><span class="o">-</span><span class="ow">in</span><span class="o">-</span><span class="n">IRT</span><span class="p">.</span><span class="n">tex</span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">tex</span><span class="o">/</span><span class="n">MCMC</span><span class="o">-</span><span class="ow">in</span><span class="o">-</span><span class="n">IRT</span><span class="p">.</span><span class="n">tex</span>
</pre></div>

<p>It worked!</p>
<p>Step 8: So now we need to point HEAD to
9f0abf890b113a287e10d56b66dbab66adc1662d.</p>
<div class="code"><pre class="code literal-block">git update-ref HEAD 9f0abf890b113a287e10d56b66dbab66adc1662d
</pre></div>

<p>Which didn't complain.</p>
<p>Step 9: See what fsck says:</p>
<div class="code"><pre class="code literal-block">git fsck --full

Checking object directories: 100% (256/256), done.
error: refs/heads/master.u1conflict does not point to a valid object!
error: 0e31469d372551bb2f51a186fa32795e39f94d5c: invalid sha1 pointer in cache-tree
dangling blob 03511c9868b5dbac4ef1343956776ac508c7c2a2
missing blob 8b61d0135d3195966b443f6c73fb68466264c68e
missing blob e89896b1282fbae6cf046bf21b62dd275aaa32f4
dangling blob dd09f7f1f033632b7ef90876d6802f5b5fede79a
missing blob caab8e3d18f2b8c8947f79af7885cdeeeae192fd
missing blob e4cf65ddf80338d50ecd4abcf1caf1de3127c229
</pre></div>

<p>Step 10: The invalid sha1 pointer in cache-tree seemed like it was from a (now
outdated) index file (source). So I killed it and reset the repository.</p>
<div class="code"><pre class="code literal-block">rm .git/index
git reset

Unstaged changes after reset:
M    tex/MCMC-in-IRT.tex
M    tex/recipe-example/build-example-plots.R
M    tex/recipe-example/build-failure-plots.R
</pre></div>

<p>Step 11: Looking at the fsck again...</p>
<div class="code"><pre class="code literal-block">git fsck --full

Checking object directories: 100% (256/256), done.
error: refs/heads/master.u1conflict does not point to a valid object!
dangling blob 03511c9868b5dbac4ef1343956776ac508c7c2a2
dangling blob dd09f7f1f033632b7ef90876d6802f5b5fede79a
</pre></div>

<p>The dangling blobs are not errors. I'm not concerned with master.u1conflict,
and now that it is working I don't want to touch it anymore!</p>
<p>Step 12: Catching up with my local edits:</p>
<div class="code"><pre class="code literal-block"><span class="nv">git</span><span class="w"> </span><span class="nv">status</span>

#<span class="w"> </span><span class="nv">On</span><span class="w"> </span><span class="nv">branch</span><span class="w"> </span><span class="nv">master</span>
#<span class="w"> </span><span class="nv">Changes</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">staged</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">commit</span>:
#<span class="w">   </span><span class="ss">(</span><span class="nv">use</span><span class="w"> </span><span class="s2">"git add &lt;file&gt;..."</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">update</span><span class="w"> </span><span class="nv">what</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">committed</span><span class="ss">)</span>
#<span class="w">   </span><span class="ss">(</span><span class="nv">use</span><span class="w"> </span><span class="s2">"git checkout -- &lt;file&gt;..."</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">discard</span><span class="w"> </span><span class="nv">changes</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">working</span><span class="w"> </span><span class="nv">directory</span><span class="ss">)</span>
#
#<span class="w">    </span><span class="nv">modified</span>:<span class="w">   </span><span class="nv">tex</span><span class="o">/</span><span class="nv">MCMC</span><span class="o">-</span><span class="nv">in</span><span class="o">-</span><span class="nv">IRT</span>.<span class="nv">tex</span>
#<span class="w">    </span><span class="nv">modified</span>:<span class="w">   </span><span class="nv">tex</span><span class="o">/</span><span class="nv">recipe</span><span class="o">-</span><span class="nv">example</span><span class="o">/</span><span class="nv">build</span><span class="o">-</span><span class="nv">example</span><span class="o">-</span><span class="nv">plots</span>.<span class="nv">R</span>
#<span class="w">    </span><span class="nv">modified</span>:<span class="w">   </span><span class="nv">tex</span><span class="o">/</span><span class="nv">recipe</span><span class="o">-</span><span class="nv">example</span><span class="o">/</span><span class="nv">build</span><span class="o">-</span><span class="nv">failure</span><span class="o">-</span><span class="nv">plots</span>.<span class="nv">R</span>
#
<span class="o">&lt;</span><span class="w"> </span>...<span class="w"> </span><span class="nv">snip</span><span class="w"> </span>...<span class="w"> </span><span class="o">&gt;</span>
<span class="nv">no</span><span class="w"> </span><span class="nv">changes</span><span class="w"> </span><span class="nv">added</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">commit</span><span class="w"> </span><span class="ss">(</span><span class="nv">use</span><span class="w"> </span><span class="s2">"git add"</span><span class="w"> </span><span class="nv">and</span><span class="o">/</span><span class="nv">or</span><span class="w"> </span><span class="s2">"git commit -a"</span><span class="ss">)</span>


<span class="nv">git</span><span class="w"> </span><span class="nv">commit</span><span class="w"> </span><span class="o">-</span><span class="nv">a</span><span class="w"> </span><span class="o">-</span><span class="nv">m</span><span class="w"> </span><span class="s2">"recovering from the git fiasco"</span>

[<span class="nv">master</span><span class="w"> </span><span class="mi">7922876</span>]<span class="w"> </span><span class="nv">recovering</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">git</span><span class="w"> </span><span class="nv">fiasco</span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nv">files</span><span class="w"> </span><span class="nv">changed</span>,<span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="nv">insertions</span><span class="ss">(</span><span class="o">+</span><span class="ss">)</span>,<span class="w"> </span><span class="mi">94</span><span class="w"> </span><span class="nv">deletions</span><span class="ss">(</span><span class="o">-</span><span class="ss">)</span>

<span class="nv">git</span><span class="w"> </span><span class="nv">add</span><span class="w"> </span><span class="nv">tex</span><span class="o">/</span><span class="nv">sept2012_code</span><span class="o">/</span><span class="nv">example</span><span class="o">-</span><span class="nv">code</span><span class="o">-</span><span class="nv">testing</span>.<span class="nv">R</span>
<span class="nv">git</span><span class="w"> </span><span class="nv">commit</span><span class="w"> </span><span class="o">-</span><span class="nv">a</span><span class="w"> </span><span class="o">-</span><span class="nv">m</span><span class="w"> </span><span class="s2">"adding in the example code"</span>

[<span class="nv">master</span><span class="w"> </span><span class="mi">385</span><span class="nv">c023</span>]<span class="w"> </span><span class="nv">adding</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">example</span><span class="w"> </span><span class="nv">code</span>
<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="nv">changed</span>,<span class="w"> </span><span class="mi">331</span><span class="w"> </span><span class="nv">insertions</span><span class="ss">(</span><span class="o">+</span><span class="ss">)</span>
<span class="w"> </span><span class="nv">create</span><span class="w"> </span><span class="nv">mode</span><span class="w"> </span><span class="mi">100644</span><span class="w"> </span><span class="nv">tex</span><span class="o">/</span><span class="nv">sept2012_code</span><span class="o">/</span><span class="nv">example</span><span class="o">-</span><span class="nv">code</span><span class="o">-</span><span class="nv">testing</span>.<span class="nv">R</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>The Git object files have gone corrupt (as pointed out in other answers as
well). This can happen during machine crashes, etc.</p>
<p>I had the same thing. After reading the other top answers here I found the
quickest way to fix the broken Git repository with the following commands
(execute in the Git working directory that contains the <code>.git</code> folder):</p>
<blockquote>
<p>(Be sure to back up your Git repository folder first!)</p>
</blockquote>
<div class="code"><pre class="code literal-block">find .git/objects/ -type f -empty | xargs rm
git fetch -p
git fsck --full
</pre></div>

<p>This will first <strong>remove any empty object files</strong> that cause corruption of the
repository as a whole, and then <strong>fetch down the missing objects</strong> (as well as
latest changes) from the remote repository, and then do a full <strong>object store
check</strong>. Which, at this point, should succeed without any errors (there may be
still some warnings though!)</p>
<blockquote>
<p>PS. This answer suggests you have a remote copy of your Git repository
somewhere (e.g. on GitHub) and the broken repository is the local repository
that is tied to the remote repository which is still intact. If that is not
the case, then do not attempt to fix it the way I recommend.</p>
</blockquote>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1077.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1075.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow-ZH</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
