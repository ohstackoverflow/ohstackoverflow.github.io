<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 1742) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-1742.html">
<link rel="prev" href="index-1743.html" type="text/html">
<link rel="next" href="index-1741.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-s-the-correct-way-to-communicate-between-controllers-in-angularjs/" class="u-url">What's the correct way to communicate between controllers in AngularJS?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-s-the-correct-way-to-communicate-between-controllers-in-angularjs/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T08:17:42+08:00" itemprop="datePublished" title="2023-03-03 08:17">2023-03-03 08:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>What's the correct way to communicate between controllers?</p>
<p>I'm currently using a horrible fudge involving <code>window</code>:</p>
<div class="code"><pre class="code literal-block">function StockSubgroupCtrl($scope, $http) {
    $scope.subgroups = [];
    $scope.handleSubgroupsLoaded = function(data, status) {
        $scope.subgroups = data;
    }
    $scope.fetch = function(prod_grp) {
        $http.get('/api/stock/groups/' + prod_grp + '/subgroups/').success($scope.handleSubgroupsLoaded);
    }
    window.fetchStockSubgroups = $scope.fetch;
}

function StockGroupCtrl($scope, $http) {
    ...
    $scope.select = function(prod_grp) {
        $scope.selectedGroup = prod_grp;
        window.fetchStockSubgroups(prod_grp);
    }
}
</pre></div>

<p><br><br></p>
<h2>Answer</h2>
<p><strong>Edit</strong> : The issue addressed in this answer have been resolved in angular.js
version 1.2.7. <code>$broadcast</code> now avoids bubbling over unregistered scopes and
runs just as fast as $emit. <img alt="$broadcast performances are identical to $emit
with angular 1.2.16" src="images/ti7Ph.png"></p>
<p><strong>So, now you can:</strong></p>
<ul>
<li>use <code>$broadcast</code> from the <code>$rootScope</code>
</li>
<li>listen using <code>$on</code> <strong>from the local<code>$scope</code></strong> that needs to know about the event</li>
</ul>
<hr>
<p><strong>Original Answer Below</strong></p>
<p>I highly advise not to use <code>$rootScope.$broadcast</code> + <code>$scope.$on</code> but rather
<code>$rootScope.$emit</code>+ <code>$rootScope.$on</code>. The former can cause serious
performance problems as raised by @numan. That is because the event will
bubble down through <strong>all</strong> scopes.</p>
<p>However, the latter (using <code>$rootScope.$emit</code> + <code>$rootScope.$on</code>) does
<strong>not</strong> suffer from this and can therefore be used as a fast communication
channel!</p>
<p>From the angular documentation of <code>$emit</code>:</p>
<blockquote>
<p>Dispatches an event name upwards through the scope hierarchy notifying the
registered</p>
</blockquote>
<p>Since there is no scope above <code>$rootScope</code>, there is no bubbling happening. It
is totally safe to use <code>$rootScope.$emit()</code>/ <code>$rootScope.$on()</code> as an
EventBus.</p>
<p>However, there is one gotcha when using it from within Controllers. If you
directly bind to <code>$rootScope.$on()</code> from within a controller, you'll have to
clean up the binding yourself when your local <code>$scope</code> gets destroyed. This is
because controllers (in contrast to services) can get instantiated multiple
times over the lifetime of an application which would result into bindings
summing up eventually creating memory leaks all over the place :)</p>
<p>To unregister, just listen on your <code>$scope</code>'s <code>$destroy</code> event and then call
the function that was returned by <code>$rootScope.$on</code>.</p>
<div class="code"><pre class="code literal-block"><span class="n">angular</span>
<span class="w">    </span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">'MyApp'</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">controller</span><span class="p">(</span><span class="s1">'MyController'</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span><span class="w"> </span><span class="s1">'$rootScope'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">MyController</span><span class="p">(</span><span class="o">$</span><span class="n">scope</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">rootScope</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="k">var</span><span class="w"> </span><span class="n">unbind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">rootScope</span><span class="o">.$</span><span class="n">on</span><span class="p">(</span><span class="s1">'someComponent.someCrazyEvent'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(){</span>
<span class="w">                </span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="o">$</span><span class="n">scope</span><span class="o">.$</span><span class="n">on</span><span class="p">(</span><span class="s1">'$destroy'</span><span class="p">,</span><span class="w"> </span><span class="n">unbind</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]);</span>
</pre></div>

<p>I would say, that's not really an angular specific thing as it applies to
other EventBus implementations as well, that you have to clean up resources.</p>
<p>However, you <em>can</em> make your life easier for those cases. For instance, you
could monkey patch <code>$rootScope</code> and give it a <code>$onRootScope</code> that subscribes
to events emitted on the <code>$rootScope</code> but also directly cleans up the handler
when the local <code>$scope</code> gets destroyed.</p>
<p>The cleanest way to monkey patch the <code>$rootScope</code> to provide such
<code>$onRootScope</code> method would be through a decorator (a run block will probably
do it just fine as well but pssst, don't tell anybody)</p>
<p>To make sure the <code>$onRootScope</code> property doesn't show up unexpected when
enumerating over <code>$scope</code> we use <code>Object.defineProperty()</code> and set
<code>enumerable</code> to <code>false</code>. Keep in mind that you might need an ES5 shim.</p>
<div class="code"><pre class="code literal-block"><span class="n">angular</span>
<span class="w">    </span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s1">'MyApp'</span><span class="p">)</span>
<span class="w">    </span><span class="o">.</span><span class="n">config</span><span class="p">([</span><span class="s1">'$provide'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="o">$</span><span class="n">provide</span><span class="p">){</span>
<span class="w">        </span><span class="o">$</span><span class="n">provide</span><span class="o">.</span><span class="n">decorator</span><span class="p">(</span><span class="s1">'$rootScope'</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s1">'$delegate'</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="o">$</span><span class="n">delegate</span><span class="p">){</span>

<span class="w">            </span><span class="nb nb-Type">Object</span><span class="o">.</span><span class="n">defineProperty</span><span class="p">(</span><span class="o">$</span><span class="n">delegate</span><span class="o">.</span><span class="n">constructor</span><span class="o">.</span><span class="n">prototype</span><span class="p">,</span><span class="w"> </span><span class="s1">'$onRootScope'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">listener</span><span class="p">){</span>
<span class="w">                    </span><span class="k">var</span><span class="w"> </span><span class="n">unsubscribe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">delegate</span><span class="o">.$</span><span class="n">on</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">listener</span><span class="p">);</span>
<span class="w">                    </span><span class="n">this</span><span class="o">.$</span><span class="n">on</span><span class="p">(</span><span class="s1">'$destroy'</span><span class="p">,</span><span class="w"> </span><span class="n">unsubscribe</span><span class="p">);</span>

<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">unsubscribe</span><span class="p">;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">enumerable</span><span class="p">:</span><span class="w"> </span><span class="bp">false</span>
<span class="w">            </span><span class="p">});</span>


<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">delegate</span><span class="p">;</span>
<span class="w">        </span><span class="p">}]);</span>
<span class="w">    </span><span class="p">}]);</span>
</pre></div>

<p>With this method in place the controller code from above can be simplified to:</p>
<div class="code"><pre class="code literal-block">angular
    .module('MyApp')
    .controller('MyController', ['$scope', function MyController($scope) {

            $scope.$onRootScope('someComponent.someCrazyEvent', function(){
                console.log('foo');
            });
        }
    ]);
</pre></div>

<p>So as a final outcome of all this I highly advise you to use
<code>$rootScope.$emit</code> + <code>$scope.$onRootScope</code>.</p>
<p>Btw, I'm trying to convince the angular team to address the problem within
angular core. There's a discussion going on here:
https://github.com/angular/angular.js/issues/4574</p>
<p>Here is a jsperf that shows how much of a perf impact <code>$broadcast</code>brings to
the table in a decent scenario with just 100 <code>$scope</code>'s.</p>
<p>http://jsperf.com/rootscope-emit-vs-rootscope-broadcast</p>
<p><img alt="jsperf results" src="images/FQ9dE.png"></p>
<p><br></p>
<h3>Suggest</h3>
<p>The top answer here was a work around from an Angular problem which no longer
exists (at least in versions &gt;1.2.16 and "probably earlier") as @zumalifeguard
has mentioned. But I'm left reading all these answers without an actual
solution.</p>
<p>It seems to me that the answer now should be</p>
<ul>
<li>use <code>$broadcast</code> from the <code>$rootScope</code>
</li>
<li>listen using <code>$on</code> <strong>from the local<code>$scope</code></strong> that needs to know about the event</li>
</ul>
<p>So to publish</p>
<div class="code"><pre class="code literal-block"><span class="c1">// EXAMPLE PUBLISHER</span>
<span class="n">angular</span><span class="p">.</span><span class="n">module</span><span class="p">(</span><span class="s">'test'</span><span class="p">).</span><span class="n">controller</span><span class="p">(</span><span class="s">'CtrlPublish'</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">'$rootScope'</span><span class="p">,</span><span class="w"> </span><span class="s">'$scope'</span><span class="p">,</span>
<span class="k">function</span><span class="nf"> </span><span class="p">(</span>$rootScope, $scope<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="no">$</span><span class="n">rootScope</span><span class="p">.</span><span class="no">$</span><span class="n">broadcast</span><span class="p">(</span><span class="s">'topic'</span><span class="p">,</span><span class="w"> </span><span class="s">'message'</span><span class="p">);</span>

<span class="p">}]);</span>
</pre></div>

<p>And subscribe</p>
<div class="code"><pre class="code literal-block"><span class="c1">// EXAMPLE SUBSCRIBER</span>
<span class="n">angular</span><span class="p">.</span><span class="n">module</span><span class="p">(</span><span class="s">'test'</span><span class="p">).</span><span class="n">controller</span><span class="p">(</span><span class="s">'ctrlSubscribe'</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">'$scope'</span><span class="p">,</span>
<span class="k">function</span><span class="nf"> </span><span class="p">(</span>$scope<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="no">$</span><span class="n">scope</span><span class="p">.</span><span class="no">$</span><span class="n">on</span><span class="p">(</span><span class="s">'topic'</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="no">$</span><span class="n">scope</span><span class="p">.</span><span class="n">receiver</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">'got your '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">arg</span><span class="p">;</span>
<span class="w">  </span><span class="p">});</span>

<span class="p">}]);</span>
</pre></div>

<p>Plunkers</p>
<ul>
<li>Regular $scope syntax (as you see above)</li>
<li>new <code>Controller As</code> syntax</li>
</ul>
<p>If you register the listener on the local <code>$scope</code>, it will be destroyed
automatically by <code>$destroy</code> itself when the associated controller is removed.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/early-exit-from-function/" class="u-url">Early exit from function?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/early-exit-from-function/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T08:17:11+08:00" itemprop="datePublished" title="2023-03-03 08:17">2023-03-03 08:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I have a function:</p>
<div class="code"><pre class="code literal-block"><span class="nv">function</span><span class="w"> </span><span class="nv">myfunction</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'stop'</span><span class="ss">)</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="nv">How</span><span class="w"> </span><span class="nv">can</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="nv">stop</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">function</span><span class="w"> </span><span class="nv">here</span>?
}
</pre></div>

<p>Is there something like <code>exit()</code> in JavaScript?</p>
<p><br><br></p>
<h2>Answer</h2>
<p>You can just use <code>return</code>.</p>
<div class="code"><pre class="code literal-block"><span class="nv">function</span><span class="w"> </span><span class="nv">myfunction</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">     </span><span class="k">if</span><span class="ss">(</span><span class="nv">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'stop'</span><span class="ss">)</span><span class="w"> </span>
<span class="w">         </span><span class="k">return</span><span class="c1">;</span>
}
</pre></div>

<p>This will send a return value of <code>undefined</code> to whatever called the function.</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myfunction</span><span class="p">();</span>

<span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">console</span><span class="w"> </span><span class="n">shows</span><span class="w"> </span><span class="n">undefined</span>
</pre></div>

<p>Of course, you can specify a different return value. Whatever value is
returned will be logged to the console using the above example.</p>
<div class="code"><pre class="code literal-block"><span class="k">return</span><span class="w"> </span><span class="nv">false</span><span class="c1">;</span>
<span class="k">return</span><span class="w"> </span><span class="nv">true</span><span class="c1">;</span>
<span class="k">return</span><span class="w"> </span><span class="s2">"some string"</span><span class="c1">;</span>
<span class="k">return</span><span class="w"> </span><span class="mi">12345</span><span class="c1">;</span>
</pre></div>

<p><br></p>
<h3>Suggest</h3>
<p>Apparently you can do this:</p>
<div class="code"><pre class="code literal-block"><span class="nt">function</span><span class="w"> </span><span class="nt">myFunction</span><span class="o">()</span><span class="w"> </span><span class="p">{</span><span class="n">myFunction</span><span class="p">:</span><span class="err">{</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="nf">log</span><span class="p">(</span><span class="s1">'i get executed'</span><span class="p">);</span>
<span class="w">    </span><span class="err">break</span><span class="w"> </span><span class="err">myFunction</span><span class="p">;</span>
<span class="w">    </span><span class="err">console.log('i</span><span class="w"> </span><span class="err">do</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">get</span><span class="w"> </span><span class="err">executed')</span><span class="p">;</span>
<span class="p">}</span><span class="err">}</span>
</pre></div>

<p>See block scopes through the use of a label: https://developer.mozilla.org/en-
US/docs/Web/JavaScript/Reference/Statements/label</p>
<p>I can't see any downsides yet. But it doesn't seem like a common use.</p>
<p>Derived this answer: JavaScript equivalent of PHP’s die</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-viewmodel-in-mvc/" class="u-url">What is ViewModel in MVC?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-viewmodel-in-mvc/" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-03T08:16:43+08:00" itemprop="datePublished" title="2023-03-03 08:16">2023-03-03 08:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I am new to ASP.NET MVC. I have a problem with understanding the purpose of a
ViewModel.</p>
<p>What is a ViewModel and why do we need a ViewModel for an ASP.NET MVC
Application?</p>
<p>If I get a good example about its working and explanation that would be
better.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>A <code>view model</code> represents the data that you want to display on your view/page,
whether it be used for static text or for input values (like textboxes and
dropdown lists) that can be added to the database (or edited). It is something
different than your <code>domain model</code>. It is a model for the view.</p>
<p>Let us say that you have an <code>Employee</code> class that represents your employee
domain model and it contains the following properties (unique identifier,
first name, last name and date created):</p>
<div class="code"><pre class="code literal-block">public class Employee : IEntity
{
     public int Id { get; set; }

     public string FirstName { get; set; }

     public string LastName { get; set; }

     public DateTime DateCreated { get; set; }
}
</pre></div>

<p>View models differ from domain models in that view models only contain the
data (represented by properties) that you want to use on your view. For
example, lets say that you want to add a new employee record, your view model
might look like this:</p>
<div class="code"><pre class="code literal-block">public class CreateEmployeeViewModel
{
     public string FirstName { get; set; }

     public string LastName { get; set; }
}
</pre></div>

<p>As you can see it only contains two of the properties. These two properties
are also in the employee domain model. Why is this you may ask? <code>Id</code> might not
be set from the view, it might be auto generated by the Employee table. And
<code>DateCreated</code> might also be set in the stored procedure or in the service
layer of your application. So <code>Id</code> and <code>DateCreated</code> are not needed in the
view model. You might want to display these two properties when you view an
employee’s details (an employee that has already been captured) as static
text.</p>
<p>When loading the view/page, the create action method in your employee
controller will create an instance of this view model, populate any fields if
required, and then pass this view model to the view/page:</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">EmployeeController</span><span class="w"> </span>:<span class="w"> </span><span class="nv">Controller</span>
{
<span class="w">     </span><span class="nv">private</span><span class="w"> </span><span class="nv">readonly</span><span class="w"> </span><span class="nv">IEmployeeService</span><span class="w"> </span><span class="nv">employeeService</span><span class="c1">;</span>

<span class="w">     </span><span class="nv">public</span><span class="w"> </span><span class="nv">EmployeeController</span><span class="ss">(</span><span class="nv">IEmployeeService</span><span class="w"> </span><span class="nv">employeeService</span><span class="ss">)</span>
<span class="w">     </span>{
<span class="w">          </span><span class="nv">this</span>.<span class="nv">employeeService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">employeeService</span><span class="c1">;</span>
<span class="w">     </span>}

<span class="w">     </span><span class="nv">public</span><span class="w"> </span><span class="nv">ActionResult</span><span class="w"> </span><span class="nv">Create</span><span class="ss">()</span>
<span class="w">     </span>{
<span class="w">          </span><span class="nv">CreateEmployeeViewModel</span><span class="w"> </span><span class="nv">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">CreateEmployeeViewModel</span><span class="ss">()</span><span class="c1">;</span>

<span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="nv">View</span><span class="ss">(</span><span class="nv">model</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">     </span>}

<span class="w">     </span><span class="nv">public</span><span class="w"> </span><span class="nv">ActionResult</span><span class="w"> </span><span class="nv">Create</span><span class="ss">(</span><span class="nv">CreateEmployeeViewModel</span><span class="w"> </span><span class="nv">model</span><span class="ss">)</span>
<span class="w">     </span>{
<span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="k">Do</span><span class="w"> </span><span class="nv">what</span><span class="w"> </span><span class="nv">ever</span><span class="w"> </span><span class="nv">needs</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">done</span><span class="w"> </span><span class="nv">before</span><span class="w"> </span><span class="nv">adding</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">employee</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">database</span>
<span class="w">     </span>}
}
</pre></div>

<p>Your view/page might look like this (assuming you are using <code>ASP.NET MVC</code> and
the <code>Razor</code> view engine):</p>
<div class="code"><pre class="code literal-block">@model<span class="w"> </span>MyProject.Web.ViewModels.CreateEmployeeViewModel

<span class="nt">&lt;table&gt;</span>
<span class="w">     </span><span class="nt">&lt;tr&gt;</span>
<span class="w">          </span><span class="nt">&lt;td&gt;&lt;b&gt;</span>First<span class="w"> </span>Name:<span class="nt">&lt;/b&gt;&lt;/td&gt;</span>
<span class="w">          </span><span class="nt">&lt;td&gt;</span>@Html.TextBoxFor(m<span class="w"> </span>=&gt;<span class="w"> </span>m.FirstName,<span class="w"> </span>new<span class="w"> </span>{<span class="w"> </span>maxlength<span class="w"> </span>=<span class="w"> </span>"50",<span class="w"> </span>size<span class="w"> </span>=<span class="w"> </span>"50"<span class="w"> </span>})
<span class="w">              </span>@Html.ValidationMessageFor(m<span class="w"> </span>=&gt;<span class="w"> </span>m.FirstName)
<span class="w">          </span><span class="nt">&lt;/td&gt;</span>
<span class="w">     </span><span class="nt">&lt;/tr&gt;</span>
<span class="w">     </span><span class="nt">&lt;tr&gt;</span>
<span class="w">          </span><span class="nt">&lt;td&gt;&lt;b&gt;</span>Last<span class="w"> </span>Name:<span class="nt">&lt;/b&gt;&lt;/td&gt;</span>
<span class="w">          </span><span class="nt">&lt;td&gt;</span>@Html.TextBoxFor(m<span class="w"> </span>=&gt;<span class="w"> </span>m.LastName,<span class="w"> </span>new<span class="w"> </span>{<span class="w"> </span>maxlength<span class="w"> </span>=<span class="w"> </span>"50",<span class="w"> </span>size<span class="w"> </span>=<span class="w"> </span>"50"<span class="w"> </span>})
<span class="w">              </span>@Html.ValidationMessageFor(m<span class="w"> </span>=&gt;<span class="w"> </span>m.LastName)
<span class="w">          </span><span class="nt">&lt;/td&gt;</span>
<span class="w">     </span><span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></div>

<p>Validation would thus be done only on <code>FirstName</code> and <code>LastName</code>. Using
FluentValidation you might have validation like this:</p>
<div class="code"><pre class="code literal-block">public class CreateEmployeeViewModelValidator : AbstractValidator&lt;CreateEmployeeViewModel&gt;
{
     public CreateEmployeeViewModelValidator()
     {
          RuleFor(m =&gt; m.FirstName)
               .NotEmpty()
               .WithMessage("First name required")
               .Length(1, 50)
               .WithMessage("First name must not be greater than 50 characters");

          RuleFor(m =&gt; m.LastName)
               .NotEmpty()
               .WithMessage("Last name required")
               .Length(1, 50)
               .WithMessage("Last name must not be greater than 50 characters");
     }
}
</pre></div>

<p>And with Data Annotations it might look this:</p>
<div class="code"><pre class="code literal-block">public class CreateEmployeeViewModel : ViewModelBase
{
    [Display(Name = "First Name")]
    [Required(ErrorMessage = "First name required")]
    public string FirstName { get; set; }

    [Display(Name = "Last Name")]
    [Required(ErrorMessage = "Last name required")]
    public string LastName { get; set; }
}
</pre></div>

<p><strong>The key thing to remember is that the view model only represents the data
that you want to use</strong> , nothing else. You can imagine all the unnecessary
code and validation if you have a domain model with 30 properties and you only
want to update a single value. Given this scenario you would only have this
one value/property in the view model and not all the properties that are in
the domain object.</p>
<p>A view model might not only have data from one database table. It can combine
data from another table. Take my example above about adding a new employee
record. Besides adding just the first and last names you might also want to
add the department of the employee. This list of departments will come from
your <code>Departments</code> table. So now you have data from the <code>Employees</code> and
<code>Departments</code> tables in one view model. You will just then need to add the
following two properties to your view model and populate it with data:</p>
<div class="code"><pre class="code literal-block">public int DepartmentId { get; set; }

public IEnumerable&lt;Department&gt; Departments { get; set; }
</pre></div>

<p>When editing employee data (an employee that has already been added to the
database) it wouldn’t differ much from my example above. Create a view model,
call it for example <code>EditEmployeeViewModel</code>. Only have the data that you want
to edit in this view model, like first name and last name. Edit the data and
click the submit button. I wouldn’t worry too much about the <code>Id</code> field
because the <code>Id</code> value will probably been in the URL, for example:</p>
<div class="code"><pre class="code literal-block">http://www.yourwebsite.com/Employee/Edit/3
</pre></div>

<p>Take this <code>Id</code> and pass it through to your repository layer, together with
your first name and last name values.</p>
<p>When deleting a record, I normally follow the same path as with the edit view
model. I would also have a URL, for example:</p>
<div class="code"><pre class="code literal-block">http://www.yourwebsite.com/Employee/Delete/3
</pre></div>

<p>When the view loads up for the first time I would get the employee’s data from
the database using the <code>Id</code> of 3. I would then just display static text on my
view/page so that the user can see what employee is being deleted. When the
user clicks the Delete button, I would just use the <code>Id</code> value of 3 and pass
it to my repository layer. You only need the <code>Id</code> to delete a record from the
table.</p>
<p>Another point, you don’t really need a view model for every action. If it is
simple data then it would be fine to only use <code>EmployeeViewModel</code>. If it is
complex views/pages and they differ from each other then I would suggest you
use separate view models for each.</p>
<p>I hope this clears up any confusion that you had about view models and domain
models.</p>
<p><br></p>
<h3>Suggest</h3>
<p><strong>View model</strong> is a class that represents the data model used in a specific
view. We could use this class as a model for a login page:</p>
<div class="code"><pre class="code literal-block"><span class="nt">public</span><span class="w"> </span><span class="nt">class</span><span class="w"> </span><span class="nt">LoginPageVM</span>
<span class="p">{</span>
<span class="w">    </span><span class="cp">[</span><span class="nx">Required</span><span class="p">(</span><span class="nx">ErrorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Are you really trying to login without entering username?"</span><span class="p">)</span><span class="cp">]</span>
<span class="w">    </span><span class="cp">[</span><span class="nx">DisplayName</span><span class="p">(</span><span class="s2">"Username/e-mail"</span><span class="p">)</span><span class="cp">]</span>
<span class="w">    </span><span class="err">public</span><span class="w"> </span><span class="err">string</span><span class="w"> </span><span class="err">UserName</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="cp">[</span><span class="nx">Required</span><span class="p">(</span><span class="nx">ErrorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Please enter password:)"</span><span class="p">)</span><span class="cp">]</span>
<span class="w">    </span><span class="cp">[</span><span class="nx">DisplayName</span><span class="p">(</span><span class="s2">"Password"</span><span class="p">)</span><span class="cp">]</span>
<span class="w">    </span><span class="nt">public</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">Password</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="cp">[</span><span class="nx">DisplayName</span><span class="p">(</span><span class="s2">"Stay logged in when browser is closed"</span><span class="p">)</span><span class="cp">]</span>
<span class="w">    </span><span class="nt">public</span><span class="w"> </span><span class="nt">bool</span><span class="w"> </span><span class="nt">RememberMe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">get</span><span class="p">;</span><span class="w"> </span><span class="err">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="err">}</span>
</pre></div>

<p>Using this view model you can define the view (Razor view engine):</p>
<div class="code"><pre class="code literal-block"><span class="nv">@model</span><span class="w"> </span><span class="n">CamelTrap</span><span class="p">.</span><span class="n">Models</span><span class="p">.</span><span class="n">ViewModels</span><span class="p">.</span><span class="n">LoginPageVM</span>

<span class="nv">@using</span><span class="w"> </span><span class="p">(</span><span class="n">Html</span><span class="p">.</span><span class="n">BeginForm</span><span class="p">())</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="nv">@Html</span><span class="p">.</span><span class="n">EditorFor</span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">m</span><span class="p">);</span>
<span class="w">    </span><span class="o">&lt;</span><span class="k">input</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="ss">"submit"</span><span class="w"> </span><span class="k">value</span><span class="o">=</span><span class="ss">"Save"</span><span class="w"> </span><span class="k">class</span><span class="o">=</span><span class="ss">"submit"</span><span class="w"> </span><span class="o">/&gt;</span>
<span class="err">}</span>
</pre></div>

<p>And actions:</p>
<div class="code"><pre class="code literal-block"><span class="k">[HttpGet]</span>
<span class="na">public ActionResult LoginPage()</span>
<span class="na">{</span>
<span class="w">    </span><span class="na">return View();</span>
<span class="na">}</span>

<span class="k">[HttpPost]</span>
<span class="na">public ActionResult LoginPage(LoginPageVM model)</span>
<span class="na">{</span>
<span class="w">    </span><span class="na">...code to login user to application...</span>
<span class="w">    </span><span class="na">return View(model);</span>
<span class="na">}</span>
</pre></div>

<p>Which produces this result (screen is taken after submitting form, with
validation messages):</p>
<p><img alt="" src="images/xfiZ2.jpg"></p>
<p>As you can see, a view model has many roles:</p>
<ul>
<li>View models documents a view by consisting only fields, that are represented in view.</li>
<li>View models may contain specific validation rules using data annotations or IDataErrorInfo.</li>
<li>View model defines how a view should look (for <code>LabelFor</code>,<code>EditorFor</code>,<code>DisplayFor</code> helpers).</li>
<li>View models can combine values from different database entities.</li>
<li>You can specify easily display templates for view models and reuse them in many places using DisplayFor or EditorFor helpers.</li>
</ul>
<p>Another example of a view model and its retrieval: We want to display basic
user data, his privileges and users name. We create a special view model,
which contains only the required fields. We retrieve data from different
entities from database, but the view is only aware of the view model class:</p>
<div class="code"><pre class="code literal-block">public class UserVM {
    public int ID { get; set; }
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public bool IsAdministrator { get; set; }
    public string MothersName { get; set; }
}
</pre></div>

<p>Retrieval:</p>
<div class="code"><pre class="code literal-block"><span class="k">var</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db</span><span class="o">.</span><span class="n">userRepository</span><span class="o">.</span><span class="n">GetUser</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

<span class="k">var</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">UserVM</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span>
<span class="w">   </span><span class="n">FirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">FirstName</span><span class="p">,</span>
<span class="w">   </span><span class="n">LastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">LastName</span><span class="p">,</span>
<span class="w">   </span><span class="n">IsAdministrator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">Proviledges</span><span class="o">.</span><span class="n">IsAdministrator</span><span class="p">,</span>
<span class="w">   </span><span class="n">MothersName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">Mother</span><span class="o">.</span><span class="n">FirstName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">" "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">Mother</span><span class="o">.</span><span class="n">LastName</span>
<span class="p">}</span>
</pre></div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-1743.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-1741.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
