<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a snapshot site for StackOverflow">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StackOverflow Snapshot (old posts, page 770) | StackOverflow Snapshot</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://ohstackoverflow.netlify.app/index-770.html">
<link rel="prev" href="index-771.html" type="text/html">
<link rel="next" href="index-769.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://ohstackoverflow.netlify.app/">

                <span id="blog-title">StackOverflow Snapshot</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<div style="display:table;min-height:5rem;min-width:27rem;">
					<div class="input-group" style="display: table-cell;vertical-align: middle;">
						<input id="words" type="text" class="form-control" style="max-width:22rem;" onkeydown="if(event.keyCode==13){btn.click()}"><span class="input-group-btn" style="float:left">
							<button id="btn" class="btn btn-default" type="button" data-toggle="modal" data-target="#myModal">
								<span class="glyphicon glyphicon-search">
							</span></button>
						</span>
					</div>
<!-- /input-group -->
				</div>

				
                
                
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><!-- 模态框（Modal） --><div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					查找结果
				</h4>
			</div>
			<div class="modal-body">
				<div id="search-count" style="min-height:4rem;">
				查找中，请稍后...
				</div>
				<div id="search-result">
				</div>

				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">
					关闭
				</button>
			</div>
		</div>
<!-- /.modal-content -->
	</div>
<!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-an-application-binary-interface-abi/" class="u-url">What is an application binary interface (ABI)?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-an-application-binary-interface-abi/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T15:30:56+08:00" itemprop="datePublished" title="2023-02-17 15:30">2023-02-17 15:30</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I never clearly understood what an ABI is. Please don't point me to a
Wikipedia article. If I could understand it, I wouldn't be here posting such a
lengthy post.</p>
<p>This is my mindset about different interfaces:</p>
<p>A TV remote is an interface between the user and the TV. It is an existing
entity, but useless (doesn't provide any functionality) by itself. All the
functionality for each of those buttons on the remote is implemented in the
television set.</p>
<blockquote>
<p><strong>Interface:</strong> It is an "existing entity" layer between the <code>functionality</code>
and <code>consumer</code> of that functionality. An interface by itself doesn't do
anything. It just invokes the functionality lying behind.</p>
<p>Now depending on who the user is there are different type of interfaces.</p>
<p><strong>Command Line Interface (CLI)</strong> commands are the existing entities, the
consumer is the user and functionality lies behind.</p>
<p><code>functionality:</code> my software functionality which solves some purpose to
which we are describing this interface.</p>
<p><code>existing entities:</code> commands</p>
<p><code>consumer:</code> user</p>
<p><strong>Graphical User Interface(GUI)</strong> window, buttons, etc. are the existing
entities, and again the consumer is the user and functionality lies behind.</p>
<p><code>functionality:</code> my software functionality which solves some problem to
which we are describing this interface.</p>
<p><code>existing entities:</code> window, buttons etc..</p>
<p><code>consumer:</code> user</p>
<p><strong>Application Programming Interface(API)</strong> functions (or to be more correct)
interfaces (in interfaced based programming) are the existing entities,
consumer here is another program not a user, and again functionality lies
behind this layer.</p>
<p><code>functionality:</code> my software functionality which solves some problem to
which we are describing this interface.</p>
<p><code>existing entities:</code> functions, Interfaces (array of functions).</p>
<p><code>consumer:</code> another program/application.</p>
<p><strong>Application Binary Interface (ABI)</strong> Here is where my problem starts.</p>
<p><code>functionality:</code> ???</p>
<p><code>existing entities:</code> ???</p>
<p><code>consumer:</code> ???</p>
</blockquote>
<ul>
<li>I've written software in different languages and provided different kinds of interfaces (CLI, GUI, and API), but I'm not sure if I have ever provided any ABI.</li>
</ul>
<p>Wikipedia says:</p>
<blockquote>
<p>ABIs cover details such as</p>
<ul>
<li>data type, size, and alignment;</li>
<li>the calling convention, which controls how functions' arguments are
passed and return values retrieved;</li>
<li>the system call numbers and how an application should make system calls
to the operating system;
</li>
</ul>
<p>Other ABIs standardize details such as</p>
<ul>
<li>the C++ name mangling,</li>
<li>exception propagation, and</li>
<li>calling convention between compilers on the same platform, but do not
require cross-platform compatibility.
</li>
</ul>
</blockquote>
<ul>
<li>
<p>Who needs these details? Please don't say the OS. I know assembly programming. I know how linking &amp; loading works. I know exactly what happens inside.</p>
</li>
<li>
<p>Why did C++ name mangling come in? I thought we are talking at the binary level. Why do languages come in?</p>
</li>
</ul>
<p>Anyway, I've downloaded the [PDF] System V Application Binary Interface
<em>Edition 4.1 (1997-03-18)</em> to see what exactly it contains. Well, most of it
didn't make any sense.</p>
<ul>
<li>
<p>Why does it contain two chapters (4th &amp; 5th) to describe the ELF file format? In fact, these are the only two significant chapters of that specification. The rest of the chapters are "processor specific". Anyway, I though that it is a completely different topic. Please don't say that ELF file format specifications <em>are</em> the ABI. It doesn't qualify to be an <em>interface</em> according to the definition.</p>
</li>
<li>
<p>I know, since we are talking at such a low level it must be very specific. But I'm not sure how is it "instruction set architecture (ISA)" specific?</p>
</li>
<li>
<p>Where can I find Microsoft Windows' ABI?</p>
</li>
</ul>
<p>So, these are the major queries that are bugging me.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>One easy way to understand "ABI" is to compare it to "API".</p>
<p>You are already familiar with the concept of an API. If you want to use the
features of, say, some library or your OS, you will program against an API.
The API consists of data types/structures, constants, functions, etc that you
can use in your code to access the functionality of that external component.</p>
<p>An ABI is very similar. Think of it as the compiled version of an API (or as
an API on the machine-language level). When you write source code, you access
the library through an API. Once the code is compiled, your application
accesses the binary data in the library through the ABI. The ABI defines the
structures and methods that your compiled application will use to access the
external library (just like the API did), only on a lower level. Your API
defines the order in which you pass arguments to a function. Your ABI defines
the mechanics of <em>how</em> these arguments are passed (registers, stack, etc.).
Your API defines which functions are part of your library. Your ABI defines
how your code is stored inside the library file, so that any program using
your library can locate the desired function and execute it.</p>
<p>ABIs are important when it comes to applications that use external libraries.
Libraries are full of code and other resources, but your program has to know
how to locate what it needs inside the library file. Your ABI defines how the
contents of a library are stored inside the file, and your program uses the
ABI to search through the file and find what it needs. If everything in your
system conforms to the same ABI, then any program is able to work with any
library file, no matter who created them. Linux and Windows use different
ABIs, so a Windows program won't know how to access a library compiled for
Linux.</p>
<p>Sometimes, ABI changes are unavoidable. When this happens, any programs that
use that library will not work unless they are re-compiled to use the new
version of the library. If the ABI changes but the API does not, then the old
and new library versions are sometimes called "source compatible". This
implies that while a program compiled for one library version will not work
with the other, source code written for one will work for the other if re-
compiled.</p>
<p>For this reason, developers tend to try to keep their ABI stable (to minimize
disruption). Keeping an ABI stable means not changing function interfaces
(return type and number, types, and order of arguments), definitions of data
types or data structures, defined constants, etc. New functions and data types
can be added, but existing ones must stay the same. If, for instance, your
library uses 32-bit integers to indicate the offset of a function and you
switch to 64-bit integers, then already-compiled code that uses that library
will not be accessing that field (or any following it) correctly. Accessing
data structure members gets converted into memory addresses and offsets during
compilation and if the data structure changes, then these offsets will not
point to what the code is expecting them to point to and the results are
unpredictable at best.</p>
<p>An ABI isn't necessarily something you will explicitly provide unless you are
doing very low-level systems design work. It isn't language-specific either,
since (for example) a C application and a Pascal application can use the same
ABI after they are compiled.</p>
<p><strong>Edit:</strong> Regarding your question about the chapters regarding the ELF file
format in the SysV ABI docs: The reason this information is included is
because the ELF format defines the interface between operating system and
application. When you tell the OS to run a program, it expects the program to
be formatted in a certain way and (for example) expects the first section of
the binary to be an ELF header containing certain information at specific
memory offsets. This is how the application communicates important information
about itself to the operating system. If you build a program in a non-ELF
binary format (such as a.out or PE), then an OS that expects ELF-formatted
applications will not be able to interpret the binary file or run the
application. This is one big reason why Windows apps cannot be run directly on
a Linux machine (or vice versa) without being either re-compiled or run inside
some type of emulation layer that can translate from one binary format to
another.</p>
<p>IIRC, Windows currently uses the Portable Executable (or, PE) format. There
are links in the "external links" section of that Wikipedia page with more
information about the PE format.</p>
<p>Also, regarding your note about C++ name mangling: When locating a function in
a library file, the function is typically looked up by name. C++ allows you to
overload function names, so name alone is not sufficient to identify a
function. C++ compilers have their own ways of dealing with this internally,
called <em>name mangling</em>. An ABI can define a standard way of encoding the name
of a function so that programs built with a different language or compiler can
locate what they need. When you use <code>extern "c"</code> in a C++ program, you're
instructing the compiler to use a standardized way of recording names that's
understandable by other software.</p>
<p><br></p>
<h3>Suggest</h3>
<p>If you know assembly and how things work at the OS-level, you are conforming
to a certain ABI. The ABI govern things like how parameters are passed, where
return values are placed. For many platforms there is only one ABI to choose
from, and in those cases the ABI is just "how things work".</p>
<p>However, the ABI also govern things like how classes/objects are laid out in
C++. This is necessary if you want to be able to pass object references across
module boundaries or if you want to mix code compiled with different
compilers.</p>
<p>Also, if you have an 64-bit OS which can execute 32-bit binaries, you will
have different ABIs for 32- and 64-bit code.</p>
<p>In general, any code you link into the same executable must conform to the
same ABI. If you want to communicate between code using different ABIs, you
must use some form of RPC or serialization protocols.</p>
<p>I think you are trying too hard to squeeze in different types of interfaces
into a fixed set of characteristics. For example, an interface doesn't
necessarily have to be split into consumers and producers. An interface is
just a convention by which two entities interact.</p>
<p>ABIs can be (partially) ISA-agnostic. Some aspects (such as calling
conventions) depend on the ISA, while other aspects (such as C++ class layout)
do not.</p>
<p>A well defined ABI is very important for people writing compilers. Without a
well defined ABI, it would be impossible to generate interoperable code.</p>
<p>EDIT: Some notes to clarify:</p>
<ul>
<li>"Binary" in ABI does not exclude the use of strings or text. If you want to link a DLL exporting a C++ class, somewhere in it the methods and type signatures must be encoded. That's where C++ name-mangling comes in.</li>
<li>The reason why you never provided an ABI is that the vast majority of programmers will never do it. ABIs are provided by the same people designing the platform (i.e. operating system), and very few programmers will ever have the privilege to design a widely-used ABI.</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/what-is-a-slug-in-django/" class="u-url">What is a "slug" in Django?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/what-is-a-slug-in-django/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T15:30:30+08:00" itemprop="datePublished" title="2023-02-17 15:30">2023-02-17 15:30</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>When I read Django code I often see in models what is called a "slug". I am
not quite sure what this is, but I do know it has something to do with URLs.
How and when is this slug-thing supposed to be used?</p>
<p>(I have read its definition in this glossary.)</p>
<blockquote>
<p><strong>Slug</strong><br>
 A short label for something, containing only letters, numbers, underscores
or hyphens. They’re generally used in URLs. For example, in a typical blog
entry URL:</p>
<p>https://www.djangoproject.com/weblog/2008/apr/12/spring/ the last bit
(spring) is the slug.</p>
</blockquote>
<p><br><br></p>
<h2>Answer</h2>
<p>A "slug" is a way of generating a valid URL, generally using data already
obtained. For instance, a slug uses the title of an article to generate a URL.
I advise to generate the slug by means of a function, given the title (or
another piece of data), rather than setting it manually.</p>
<p>An example:</p>
<div class="code"><pre class="code literal-block"><span class="nt">&lt;title&gt;</span><span class="w"> </span>The<span class="w"> </span>46<span class="w"> </span>Year<span class="w"> </span>Old<span class="w"> </span>Virgin<span class="w"> </span><span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;content&gt;</span><span class="w"> </span>A<span class="w"> </span>silly<span class="w"> </span>comedy<span class="w"> </span>movie<span class="w"> </span><span class="nt">&lt;/content&gt;</span>
<span class="nt">&lt;slug&gt;</span><span class="w"> </span>the-46-year-old-virgin<span class="w"> </span><span class="nt">&lt;/slug&gt;</span>
</pre></div>

<p>Now let's pretend that we have a Django model such as:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="n">Article</span>(<span class="n">models</span>.<span class="n">Model</span>):
    <span class="n">title</span> = <span class="n">models</span>.<span class="n">CharField</span>(<span class="n">max_length</span>=<span class="mi">100</span>)
    <span class="n">content</span> = <span class="n">models</span>.<span class="n">TextField</span>(<span class="n">max_length</span>=<span class="mi">1000</span>)
    <span class="n">slug</span> = <span class="n">models</span>.<span class="n">SlugField</span>(<span class="n">max_length</span>=<span class="mi">40</span>)
</pre></div>

<p>How would you reference this object with a URL and with a meaningful name? You
could for instance use Article.id so the URL would look like this:</p>
<div class="code"><pre class="code literal-block">www.example.com/article/23
</pre></div>

<p>Or, you might want to reference the title like this:</p>
<div class="code"><pre class="code literal-block">www.example.com/article/The 46 Year Old Virgin
</pre></div>

<p>Since spaces aren't valid in URLs, they must be replaced by <code>%20</code>, which
results in:</p>
<div class="code"><pre class="code literal-block">www.example.com/article/The%2046%20Year%20Old%20Virgin
</pre></div>

<p>Both attempts are not resulting in very meaningful, easy-to-read URL. This is
better:</p>
<div class="code"><pre class="code literal-block">www.example.com/article/the-46-year-old-virgin
</pre></div>

<p>In this example, <code>the-46-year-old-virgin</code> is a slug: it is created from the
title by down-casing all letters, and replacing spaces by hyphens <code>-</code>.</p>
<p>Also see the URL of this very web page for another example.</p>
<p><br></p>
<h3>Suggest</h3>
<p>If I may provide some historical context :</p>
<p>The term <strong>"slug"</strong> has to do with casting metal—lead, in this case—out of
which the press fonts were made. Every paper then had its fonts factory
regularly re-melted and recast in fresh molds, since after many prints they
became worn out. Apprentices like me started their career there, and went all
the way to the top (not anymore).</p>
<p>Typographs had to compose the text of an article in a backward manner with
lead characters stacked in a wise. So at printing time the letters would be
straight on the paper. All typographs could read the newspaper mirrored as
fast as the printed one. Therefore the slugs, (like snails) also the slow
stories (the last to be fixed) were many on the bench waiting, solely
identified by their fist letters, mostly the whole title generally more
readable. Some "hot" news were waiting there on the bench, for possible last
minute correction, (Evening paper) before last assembly and definitive
printing.</p>
<p>Django emerged from the offices of the Lawrence journal in Kansas. Where
probably some printing jargon still lingers. <strong>A-django-enthusiast-
&amp;-friendly-old-slug-boy-from-France.</strong></p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/how-to-filter-a-java-collection-based-on-predicate/" class="u-url">How to filter a Java Collection (based on predicate)?</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                <a href="authors/arya/">Arya</a>
            </span></p>
            <p class="dateline">
            <a href="posts/how-to-filter-a-java-collection-based-on-predicate/" rel="bookmark">
            <time class="published dt-published" datetime="2023-02-17T15:29:59+08:00" itemprop="datePublished" title="2023-02-17 15:29">2023-02-17 15:29</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>I want to filter a <code>java.util.Collection</code> based on a predicate.</p>
<p><br><br></p>
<h2>Answer</h2>
<p>Java 8 (2014) solves this problem using streams and lambdas in one line of
code:</p>
<div class="code"><pre class="code literal-block"><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="n">beerDrinkers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">persons</span><span class="p">.</span><span class="n">stream</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">).</span><span class="n">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="n">toList</span><span class="p">());</span>
</pre></div>

<p>Here's a tutorial.</p>
<p>Use <code>Collection#removeIf</code> to modify the collection in place. (Notice: In this
case, the predicate will remove objects who satisfy the predicate):</p>
<div class="code"><pre class="code literal-block"><span class="n">persons</span><span class="p">.</span><span class="n">removeIf</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">getAge</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span>
</pre></div>

<hr>
<p>lambdaj allows filtering collections without writing loops or inner classes:</p>
<div class="code"><pre class="code literal-block">List&lt;Person&gt; beerDrinkers = select(persons, having(on(Person.class).getAge(),
    greaterThan(16)));
</pre></div>

<p>Can you imagine something more readable?</p>
<p><strong>Disclaimer:</strong> I am a contributor on lambdaj</p>
<p><br></p>
<h3>Suggest</h3>
<p>Assuming that you are using Java 1.5, and that you cannot add Google
Collections, I would do something very similar to what the Google guys did.
This is a slight variation on Jon's comments.</p>
<p>First add this interface to your codebase.</p>
<div class="code"><pre class="code literal-block">public interface IPredicate&lt;T&gt; { boolean apply(T type); }
</pre></div>

<p>Its implementers can answer when a certain predicate is true of a certain
type. E.g. If <code>T</code> were <code>User</code> and <code>AuthorizedUserPredicate&lt;User&gt;</code> implements
<code>IPredicate&lt;T&gt;</code>, then <code>AuthorizedUserPredicate#apply</code> returns whether the
passed in <code>User</code> is authorized.</p>
<p>Then in some utility class, you could say</p>
<div class="code"><pre class="code literal-block"><span class="nt">public</span><span class="w"> </span><span class="nt">static</span><span class="w"> </span><span class="o">&lt;</span><span class="nt">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">Collection</span><span class="o">&lt;</span><span class="nt">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">filter</span><span class="o">(</span><span class="nt">Collection</span><span class="o">&lt;</span><span class="nt">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">target</span><span class="o">,</span><span class="w"> </span><span class="nt">IPredicate</span><span class="o">&lt;</span><span class="nt">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">predicate</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">Collection&lt;T&gt;</span><span class="w"> </span><span class="err">result</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">ArrayList&lt;T&gt;()</span><span class="p">;</span>
<span class="w">    </span><span class="err">for</span><span class="w"> </span><span class="err">(T</span><span class="w"> </span><span class="n">element</span><span class="p">:</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">if</span><span class="w"> </span><span class="p">(</span><span class="n">predicate</span><span class="o">.</span><span class="nf">apply</span><span class="p">(</span><span class="n">element</span><span class="p">))</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">result</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">element</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="nt">return</span><span class="w"> </span><span class="nt">result</span><span class="o">;</span>
<span class="err">}</span>
</pre></div>

<p>So, assuming that you have the use of the above might be</p>
<div class="code"><pre class="code literal-block"><span class="nv">Predicate</span><span class="o">&lt;</span><span class="nv">User</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">isAuthorized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">Predicate</span><span class="o">&lt;</span><span class="nv">User</span><span class="o">&gt;</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">boolean</span><span class="w"> </span><span class="nv">apply</span><span class="ss">(</span><span class="nv">User</span><span class="w"> </span><span class="nv">user</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="nv">binds</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">boolean</span><span class="w"> </span><span class="nv">method</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">User</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">reference</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nv">user</span>.<span class="nv">isAuthorized</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">    </span>}
}<span class="c1">;</span>
<span class="o">//</span><span class="w"> </span><span class="nv">allUsers</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">Collection</span><span class="o">&lt;</span><span class="nv">User</span><span class="o">&gt;</span>
<span class="nv">Collection</span><span class="o">&lt;</span><span class="nv">User</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">authorizedUsers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">filter</span><span class="ss">(</span><span class="nv">allUsers</span>,<span class="w"> </span><span class="nv">isAuthorized</span><span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>If performance on the linear check is of concern, then I might want to have a
domain object that has the target collection. The domain object that has the
target collection would have filtering logic for the methods that initialize,
add and set the target collection.</p>
<p>UPDATE:</p>
<p>In the utility class (let's say Predicate), I have added a select method with
an option for default value when the predicate doesn't return the expected
value, and also a static property for params to be used inside the new
IPredicate.</p>
<div class="code"><pre class="code literal-block"><span class="nv">public</span><span class="w"> </span><span class="nv">class</span><span class="w"> </span><span class="nv">Predicate</span><span class="w"> </span>{
<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">Object</span><span class="w"> </span><span class="nv">predicateParams</span><span class="c1">;</span>

<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">Collection</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">filter</span><span class="ss">(</span><span class="nv">Collection</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">target</span>,<span class="w"> </span><span class="nv">IPredicate</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">predicate</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">Collection</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">ArrayList</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">T</span><span class="w"> </span><span class="nv">element</span><span class="w"> </span>:<span class="w"> </span><span class="nv">target</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="nv">predicate</span>.<span class="nv">apply</span><span class="ss">(</span><span class="nv">element</span><span class="ss">))</span><span class="w"> </span>{
<span class="w">                </span><span class="nb">result</span>.<span class="nv">add</span><span class="ss">(</span><span class="nv">element</span><span class="ss">)</span><span class="c1">;</span>
<span class="w">            </span>}
<span class="w">        </span>}
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">result</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">select</span><span class="ss">(</span><span class="nv">Collection</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">target</span>,<span class="w"> </span><span class="nv">IPredicate</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">predicate</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">T</span><span class="w"> </span><span class="nb">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">null</span><span class="c1">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">T</span><span class="w"> </span><span class="nv">element</span><span class="w"> </span>:<span class="w"> </span><span class="nv">target</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="o">!</span><span class="nv">predicate</span>.<span class="nv">apply</span><span class="ss">(</span><span class="nv">element</span><span class="ss">))</span>
<span class="w">                </span><span class="k">continue</span><span class="c1">;</span>
<span class="w">            </span><span class="nb">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">element</span><span class="c1">;</span>
<span class="w">            </span><span class="k">break</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">result</span><span class="c1">;</span>
<span class="w">    </span>}

<span class="w">    </span><span class="nv">public</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">select</span><span class="ss">(</span><span class="nv">Collection</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">target</span>,<span class="w"> </span><span class="nv">IPredicate</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">predicate</span>,<span class="w"> </span><span class="nv">T</span><span class="w"> </span><span class="nv">defaultValue</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">T</span><span class="w"> </span><span class="nb">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">defaultValue</span><span class="c1">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="ss">(</span><span class="nv">T</span><span class="w"> </span><span class="nv">element</span><span class="w"> </span>:<span class="w"> </span><span class="nv">target</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ss">(</span><span class="o">!</span><span class="nv">predicate</span>.<span class="nv">apply</span><span class="ss">(</span><span class="nv">element</span><span class="ss">))</span>
<span class="w">                </span><span class="k">continue</span><span class="c1">;</span>
<span class="w">            </span><span class="nb">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">element</span><span class="c1">;</span>
<span class="w">            </span><span class="k">break</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">result</span><span class="c1">;</span>
<span class="w">    </span>}
}
</pre></div>

<p>The following example looks for missing objects between collections:</p>
<div class="code"><pre class="code literal-block"><span class="nv">List</span><span class="o">&lt;</span><span class="nv">MyTypeA</span><span class="o">&gt;</span><span class="w"> </span><span class="nv">missingObjects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">(</span><span class="nv">List</span><span class="o">&lt;</span><span class="nv">MyTypeA</span><span class="o">&gt;</span><span class="ss">)</span><span class="w"> </span><span class="nv">Predicate</span>.<span class="nv">filter</span><span class="ss">(</span><span class="nv">myCollectionOfA</span>,
<span class="w">    </span><span class="nv">new</span><span class="w"> </span><span class="nv">IPredicate</span><span class="o">&lt;</span><span class="nv">MyTypeA</span><span class="o">&gt;</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">        </span><span class="nv">public</span><span class="w"> </span><span class="nv">boolean</span><span class="w"> </span><span class="nv">apply</span><span class="ss">(</span><span class="nv">MyTypeA</span><span class="w"> </span><span class="nv">objectOfA</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">            </span><span class="nv">Predicate</span>.<span class="nv">predicateParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">objectOfA</span>.<span class="nv">getName</span><span class="ss">()</span><span class="c1">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nv">Predicate</span>.<span class="nv">select</span><span class="ss">(</span><span class="nv">myCollectionB</span>,<span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">IPredicate</span><span class="o">&lt;</span><span class="nv">MyTypeB</span><span class="o">&gt;</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">                </span><span class="nv">public</span><span class="w"> </span><span class="nv">boolean</span><span class="w"> </span><span class="nv">apply</span><span class="ss">(</span><span class="nv">MyTypeB</span><span class="w"> </span><span class="nv">objectOfB</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="nv">objectOfB</span>.<span class="nv">getName</span><span class="ss">()</span>.<span class="nv">equals</span><span class="ss">(</span><span class="nv">Predicate</span>.<span class="nv">predicateParams</span>.<span class="nv">toString</span><span class="ss">())</span><span class="c1">;</span>
<span class="w">                </span>}
<span class="w">            </span>}<span class="ss">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">null</span><span class="c1">;</span>
<span class="w">        </span>}
<span class="w">    </span>}<span class="ss">)</span><span class="c1">;</span>
</pre></div>

<p>The following example, looks for an instance in a collection, and returns the
first element of the collection as default value when the instance is not
found:</p>
<div class="code"><pre class="code literal-block"><span class="nv">MyType</span><span class="w"> </span><span class="nv">myObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Predicate</span>.<span class="nv">select</span><span class="ss">(</span><span class="nv">collectionOfMyType</span>,<span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">IPredicate</span><span class="o">&lt;</span><span class="nv">MyType</span><span class="o">&gt;</span><span class="ss">()</span><span class="w"> </span>{
<span class="nv">public</span><span class="w"> </span><span class="nv">boolean</span><span class="w"> </span><span class="nv">apply</span><span class="ss">(</span><span class="nv">MyType</span><span class="w"> </span><span class="nv">objectOfMyType</span><span class="ss">)</span><span class="w"> </span>{
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nv">objectOfMyType</span>.<span class="nv">isDefault</span><span class="ss">()</span><span class="c1">;</span>
}},<span class="w"> </span><span class="nv">collectionOfMyType</span>.<span class="nv">get</span><span class="ss">(</span><span class="mi">0</span><span class="ss">))</span><span class="c1">;</span>
</pre></div>

<p>UPDATE (after Java 8 release):</p>
<p>It's been several years since I (Alan) first posted this answer, and I still
cannot believe I am collecting SO points for this answer. At any rate, now
that Java 8 has introduced closures to the language, my answer would now be
considerably different, and simpler. With Java 8, there is no need for a
distinct static utility class. So if you want to find the 1st element that
matches your predicate.</p>
<div class="code"><pre class="code literal-block"><span class="n">final</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="n">userService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="c1">// perhaps injected IoC</span>
<span class="n">final</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">UserModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userOption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userCollection</span><span class="p">.</span><span class="n">stream</span><span class="p">().</span><span class="n">filter</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isAuthorized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="n">isAuthorized</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="n">isAuthorized</span><span class="p">;</span>
<span class="p">}).</span><span class="n">findFirst</span><span class="p">();</span>
</pre></div>

<p>The JDK 8 API for optionals has the ability to <code>get()</code>, <code>isPresent()</code>,
<code>orElse(defaultUser)</code>, <code>orElseGet(userSupplier)</code> and
<code>orElseThrow(exceptionSupplier)</code>, as well as other 'monadic' functions such as
<code>map</code>, <code>flatMap</code> and <code>filter</code>.</p>
<p>If you want to simply collect all the users which match the predicate, then
use the <code>Collectors</code> to terminate the stream in the desired collection.</p>
<div class="code"><pre class="code literal-block"><span class="n">final</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="n">userService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="c1">// perhaps injected IoC</span>
<span class="n">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">UserModel</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userOption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userCollection</span><span class="p">.</span><span class="n">stream</span><span class="p">().</span><span class="n">filter</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isAuthorized</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="n">isAuthorized</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="n">isAuthorized</span><span class="p">;</span>
<span class="p">}).</span><span class="n">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="n">toList</span><span class="p">());</span>
</pre></div>

<p>See here for more examples on how Java 8 streams work.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-771.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-769.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         Go to StackOverflow Chinese Site  <a href="http://stackoverflow.ink">StackOverflow中文网</a>  
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="assets/js/search.js"></script>
</body>
</html>
